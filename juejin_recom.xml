<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[老王请假、客户开喷、我救火：一场递归树的性能突围战]]></title>    <link>https://juejin.cn/post/7589093895327531017</link>    <guid>https://juejin.cn/post/7589093895327531017</guid>    <pubDate>2025-12-30T00:04:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093895327531017" data-draft-id="7589093895326220297" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="老王请假、客户开喷、我救火：一场递归树的性能突围战"/> <meta itemprop="keywords" content="前端,JavaScript,性能优化"/> <meta itemprop="datePublished" content="2025-12-30T00:04:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不一样的少年_"/> <meta itemprop="url" content="https://juejin.cn/user/3035079961218551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            老王请假、客户开喷、我救火：一场递归树的性能突围战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035079961218551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不一样的少年_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:04:20.000Z" title="Tue Dec 30 2025 00:04:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252b3a}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px;color:#5e7ce0}.markdown-body h1{font-size:24px;margin-bottom:5px;margin-top:80px;position:relative;text-align:center}.markdown-body h2{font-size:20px;padding-bottom:12px;border-bottom:1px solid #dfe1e6}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px;margin-top:30px}.markdown-body h5{font-size:14px;margin-top:20px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #dfe1e6;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#ffeeed;color:#c73636;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#252b3a;background:#f8f8f8}.markdown-body a{position:relative;text-decoration:none;color:#5e7ce0;padding-right:18px;padding-bottom:4px}.markdown-body a[href^=http]:after{position:absolute;display:inline-block;width:16px;height:16px;margin-left:2px;margin-top:6px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAACCgAwAEAAAAAQAAACAAAAAAX7wP8AAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAABWVJREFUWAnlVktsVFUY/s85997pC9BOTKxRWnEKsXWlxjWJj0RWJjrFAAXjAlewYWOkgauACVu7a2IiNUEyExM3yoZE3Wmi7qgPJthJBDE6JUNpO3Mf5/j95/bOTOcBlBgXejJ37rn/Of/7O/9/iP7vQ/zTAcjnC4ry+a5ii1OkiYTpuvjvEc0Gp51uivP+ZW+QBuSW4QjW5rptAa1Ey0uOGKOxwPetVyafN6p/52/PkNBbjdAhGaGEpMRjLZTryB8+9MUSYSGNRIcBvm8kBAY9tHYlHz78nTs392xIkwv9FA3Oe33bdoX1ZZKOS0bH0CXI6RugYLW6BwIu5gskkQ4sEG0wYF25PjBzbZfSYY6kDLUmWMt7FR7Lw3xYUkaTdjxHfTPnPwav0iEGYADVa9XIRIEyxrAA0jIQxgFL22gYwF7A8/DAzNVdksJvJaTEUZ2kYnZWziN5s1ADPHneEIXByotYuMSrf9JEbbsuv7VcvbaKML8plXtQR0EdIYDqWEmtOgAomZFH8EjWSnek2ulmtljljttHbmaIHCCCHzd9MjwfsmscBeZH9Jyd10nMvz92UQrtCBKvMF06mQy0SiEdRMEGg8mN0YjAlgoDDkPrMI5qJKSkKKydpbB2CZjJkhIBvOBw2CGQgii85bpx//dMqFRKam5uvH7w+K97oe+Cl0HO68uIBH0qyEzpOMwIbZIcFq0I+9cwoElizCjk2KFI1y7Nnx614W1db58fOXIlMzs7Xn/jeDmvBV2Q0mXjGf554O/m4LZHp2N8r61WPMvLZWLdiC4GMAk5BjeeB5lhv39l6+BIbu3m760hXMDKBD08XBKzR8fr04nygnIypOOAJUx/fHrsi0Mnys+vVK+V4VUohaiyPCo2Q9DFALvF/ikw8WS4QvVZALS5ksw47/7R8ejgTPk1UFqU6/3zp8bOM7B/kdu/fkguPGU5JibW+F0sTjWOUw8DklRrg4BiLGeBqbaRLxjlT4no0InFV402RcftJz41cH/f/JnHP3kZaaF6VX/liwist9vYG5+NU9Cg3MNkt/+lU5wS8fTxq3mc7ILjDlAE4CJpe89BOWPiIjBhi9O6PI4G1jsc6RGB3lZwmS76k8H0zOKTkFboG8jS2krFKCX2fvTeaPHIBwAkMHHgncURnL3nuCSnxSopdIzN5th0BIonJ0Lf9yUA9iMkzdRWl3BixOusfDcwQVcS4UKIFwYfGPnM8wY/DyP9NFMXaTE5BU39tGkDgGZz+fJJG0oYcSaOafLcqdECY4LzfSObSzyUOgxqtyisr8SSNOOAkubWoh3TTaeA2YtFEXPnm5x81/j+6MI6JqyS25WSNU6hbCMKHG84marJbdR+vwakRhQLRuQpbzHRLjmpmijI+OmWCtq+LzWtnX5v30gHSsqmWne74DtiACi2+Wz0iXbuLt9D2cDyoPEkWOiyp5XUIwLMi/wJY1FbH5B9ONtdC1KrsD/Q0MCQAS0wccILORDW25amAeOtooAj/KQxfzF17uwTSQ1v3dJ7jnLINwdZYRDa4tPU0sHVXFo/vxFF5BqFqxRfOmgPCk4ft2NgKTCy2Y47JIEg+MIhjYsLy5I25qUYTQlCjMRHsr/UwdYwIK33UO1J5fFNB9XNO6akcywJofVmXQDP2wfrSPcI2xG5BSs3I+IosHr4EtvO1TDAu16xHQq5+ykMblfRXLbhEoFIdDTBdhldvzl+3CMg60ZktI2vNzLW6IIp0waLklot9L63yzuUp8dJd7bglPFe3hIXstBEP58/s6Ocyr4rH2+866ZNbriTzA0RSOWCwakMl1QJgculxPt8Z7O5GLdtW6bvU8R/nO1vb+hMExVAVtEAAAAASUVORK5CYII=");background-size:100%}.markdown-body a:active,.markdown-body a:hover{border-bottom:2px solid #5e7ce0}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #5e7ce0;border-spacing:0}.markdown-body thead{color:#fff;text-align:left}.markdown-body thead tr{background:#5e7ce0}.markdown-body thead th{border-bottom:1px solid #dfe1e6}.markdown-body tr{background-color:#fff}.markdown-body tr:nth-child(2n){background-color:#f2f5fc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#252b3a;padding:1px 23px;margin:22px 0;border-left:4px solid #5e7ce0;background-color:#f2f5fc}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{padding-left:10px;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5e7ce0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ul li::marker{content:"•";color:#5e7ce0}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]:before{display:inline-block;width:16px;height:16px;content:"";background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAhRJREFUeAHtnLEuBFEUhs9cu7JCskEhIrZAgYZGoREPwBuIygOoPITKA6jEG/AAolFoaFCgICIKZBNiY8Pyz5rNOWe9wNz5T7N3Z2eT/b/7zZlpziat3xKWBDJoEyh5EDd3DTk5r8vV7Yc8vzbl6zvfwvSERIYHyzI90SeLc1WZrFV85PR9oi+N/YMnOT6t/3tiLAeXFqqytjrSFacDYmfvQS6u37tOiPHA7FS/bK6PmWhpj4AJRYGA9MiKzLpK6An+cqiNVmRleUhArrec6PNzt/5sttLgh0cvcvfY6Px+ZNY9I6Ax6gKErY1xmZ8ZyD0E5MJGIgsyIZsunT3g7qALJuTdAp0nWyMTsunS2QNukbpwOcRaPpvOHvxzQow2ZBvrs+nsfLL8o0QQBJFdMO1XGkEjaIQlQCMsD/YIGkEjLAEaYXmwR9AIGmEJ0AjLgz2CRtAIS4BGWB7sETSCRlgCNMLyYI+gETTCEqARlgd7BI2gEZYAjbA82CNoBI2wBGiE5cEeQSNohCVAIywP9ggaQSMsARphebBH0AgaYQnQCMsjYC5SF2agYi2fTWcPGA7VFfO0n8+mswdMyOrCNJwnpz/P6xqZkE2Xzh4w8qcLI4Hbu/dydvkWBRAAQBZk0uOOyKyzp5PARRiF1puNtR+NTh+oMCvtJ+D8F2N6j6x+PrwzG46gRTDDm5BtsAGBg0X924Qfj7i23p7HNgQAAAAASUVORK5CYII=");background-size:100%;position:relative;right:2px;top:-5px}.markdown-body input[type=checkbox]:checked:before{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEIAAABCCAYAAADjVADoAAAK2GlDQ1BJQ0MgUHJvZmlsZQAASImVlwdUU9kWhs+96Y0WiHRC70gngJTQQxGkg6iEJJBQYkgIKmJnUMGxoCKCZcSKKFhGQMaCWLANAopdJ8igoD4HC6Ki5t3AI8zMW++99fZaJ+dbO/vss/e55671XwAoYWyRKBdWAyBPWCCODQ2gJ6ek0nHPAQRgQAI2wIHNkYiYMTGRALHJ+a/28S4Sjdhte0Wuf///v5oGlyfhAAClIZzBlXDyEG5DxkuOSFwAAOoI4jddUCBScBfCmmKkQIR/V3DWBH9ScMY4o8njMfGxgQjTAcCT2WxxFgBkO8RPL+RkIXnIih4chVyBEOFihH05fDYX4TMI2+XlzVfwIMJWSLwIAApyOoCR8aecWX/Jn6HMz2ZnKXmir3HDBwkkolz2ov/zaP635eVKJ/ewQAaZLw6LVeyHnN/9nPkRShZmzIyeZAF3oiYF86VhCZPMkQSmTjKXHRShXJs7M3KSMwUhLGWeAlb8JPMkwXGTLJ4fq9wrUxzInGS2eHxfIsIyaU6C0s/nsZT5i/jxSZNcKEicOcmSnLiIqZhApV8sjVXWzxOGBkztG6LsPU/yp34FLOXaAn58mLJ39lT9PCFzKqckWVkblxcUPBWToIwXFQQo9xLlxijjebmhSr+kME65tgC5nFNrY5RnmM0Oj5lkIABRgA04dNVJAqCAt7BA0UjgfNEisSCLX0BnIm8bj84Schzs6M6Ozs4AKN7dievwnjb+TkK061O+NYjHr10ul5+e8oUi9/i4KfJYbk35LCsAUNUD4Op+jlRcOOFDK34wyNNTBZpABxgCU2AF7IEzcAfewB8Eg3AQDeJBCpiL1MoHeUAMFoBisAKUgnKwEWwF1WA32AsOgaPgBGgGZ8AFcAXcAF2gFzwCMjAAXoFh8BGMQRCEgygQFdKBjCBzyBZyhhiQLxQMRUKxUAqUDmVBQkgKFUOroHKoAqqG9kB10HHoNHQBugZ1Qw+gPmgIegd9gVEwGdaEDWALeDrMgJlwBBwPz4Gz4Hy4CC6B18NVcC18BG6CL8A34F5YBr+CR1AARULRUMYoexQDFYiKRqWiMlFi1FJUGaoSVYtqQLWiOlC3UTLUa9RnNBZNRdPR9mhvdBg6Ac1B56OXotehq9GH0E3oS+jb6D70MPo7hoLRx9hivDAsTDImC7MAU4qpxBzAnMJcxvRiBjAfsVgsDWuJ9cCGYVOw2djF2HXYndhGbBu2G9uPHcHhcDo4W5wPLhrHxhXgSnHbcUdw53E9uAHcJzwJb4R3xofgU/FC/Ep8Jf4w/hy+B/8CP0ZQI5gTvAjRBC5hEWEDYR+hlXCLMEAYI6oTLYk+xHhiNnEFsYrYQLxMfEx8TyKRTEiepFkkAWk5qYp0jHSV1Ef6TNYg25ADyWlkKXk9+SC5jfyA/J5CoVhQ/CmplALKekod5SLlKeWTClXFQYWlwlVZplKj0qTSo/JGlaBqrspUnatapFqpelL1luprNYKahVqgGlttqVqN2mm1e2oj6lR1J/Vo9Tz1deqH1a+pD2rgNCw0gjW4GiUaezUuavRTUVRTaiCVQ11F3Ue9TB3QxGpaarI0szXLNY9qdmoOa2louWolai3UqtE6qyWjoWgWNBYtl7aBdoJ2l/ZlmsE05jTetLXTGqb1TBvV1tP21+Zpl2k3avdqf9Gh6wTr5Ohs0mnWeaKL1rXRnaW7QHeX7mXd13qaet56HL0yvRN6D/VhfRv9WP3F+nv1b+qPGBgahBqIDLYbXDR4bUgz9DfMNtxieM5wyIhq5GskMNpidN7oJV2LzqTn0qvol+jDxvrGYcZS4z3GncZjJpYmCSYrTRpNnpgSTRmmmaZbTNtNh82MzKLMis3qzR6aE8wZ5nzzbeYd5qMWlhZJFqstmi0GLbUtWZZFlvWWj60oVn5W+Va1VnessdYM6xzrndZdNrCNmw3fpsbmli1s624rsN1p222HsfO0E9rV2t2zJ9sz7Qvt6+37HGgOkQ4rHZod3kw3m546fdP0junfHd0ccx33OT5y0nAKd1rp1Or0ztnGmeNc43zHheIS4rLMpcXlrautK891l+t9N6pblNtqt3a3b+4e7mL3BvchDzOPdI8dHvcYmowYxjrGVU+MZ4DnMs8znp+93L0KvE54/eFt753jfdh7cIblDN6MfTP6fUx82D57fGS+dN903598ZX7Gfmy/Wr9n/qb+XP8D/i+Y1sxs5hHmmwDHAHHAqYDRQK/AJYFtQaig0KCyoM5gjeCE4OrgpyEmIVkh9SHDoW6hi0PbwjBhEWGbwu6xDFgcVh1rONwjfEn4pQhyRFxEdcSzSJtIcWRrFBwVHrU56vFM85nCmc3RIJoVvTn6SYxlTH7ML7Ows2Jm1cx6HusUWxzbEUeNmxd3OO5jfED8hvhHCVYJ0oT2RNXEtMS6xNGkoKSKJFny9OQlyTdSdFMEKS2puNTE1AOpI7ODZ2+dPZDmllaadneO5ZyFc67N1Z2bO/fsPNV57Hkn0zHpSemH07+yo9m17JEMVsaOjGFOIGcb5xXXn7uFO8Tz4VXwXmT6ZFZkDmb5ZG3OGuL78Sv5rwWBgmrB2+yw7N3ZoznROQdz5LlJuY15+Lz0vNNCDWGO8NJ8w/kL53eLbEWlIlm+V/7W/GFxhPiABJLMkbQUaCIi6abUSvqDtK/Qt7Cm8NOCxAUnF6ovFC68uchm0dpFL4pCivYvRi/mLG4vNi5eUdy3hLlkz1JoacbS9mWmy0qWDSwPXX5oBXFFzopfVzqurFj5YVXSqtYSg5LlJf0/hP5QX6pSKi69t9p79e416DWCNZ1rXdZuX/u9jFt2vdyxvLL86zrOuus/Ov1Y9aN8feb6zg3uG3ZtxG4Ubry7yW/ToQr1iqKK/s1Rm5u20LeUbfmwdd7Wa5Wulbu3EbdJt8mqIqtatptt37j9azW/urcmoKZxh/6OtTtGd3J39uzy39Ww22B3+e4vPwl+ur8ndE9TrUVt5V7s3sK9z/cl7uvYz9hfd0D3QPmBbweFB2WHYg9dqvOoqzusf3hDPVwvrR86knak62jQ0ZYG+4Y9jbTG8mPgmPTYy+Ppx++eiDjRfpJxsuFn8593nKKeKmuCmhY1DTfzm2UtKS3dp8NPt7d6t576xeGXg2eMz9Sc1Tq74RzxXMk5+fmi8yNtorbXF7Iu9LfPa390MfninUuzLnVejrh89UrIlYsdzI7zV32unrnmde30dcb15hvuN5puut089avbr6c63Tubbnncauny7GrtntF9rsev58LtoNtX7rDu3Oid2dt9N+Hu/Xtp92T3ufcHH+Q+ePuw8OHYo+WPMY/Lnqg9qXyq/7T2N+vfGmXusrN9QX03n8U9e9TP6X/1u+T3rwMlzynPK18YvagbdB48MxQy1PVy9suBV6JXY69L/6H+jx1vrN78/If/HzeHk4cH3orfyt+te6/z/uAH1w/tIzEjTz/mfRwbLfuk8+nQZ8bnji9JX16MLfiK+1r1zfpb6/eI74/leXK5iC1mj0sBFDLgzEwA3h1EtHEKAFRElxNnT2jrcYMmvgfGCfwnntDf4+YOQAMyKWQR0x+Akwo5i8wqyKyQRPH+AHZxUY5/mSTTxXkiFxlRlphPcvl7AwBwrQB8E8vlYzvl8m/7kGIfANCWP6HpFYZFtHyD3vJRg6LbPe3g7zah9//U499noKjAFfx9/ieoZhkWVvYkwwAAAGxlWElmTU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAACQAAAAAQAAAJAAAAABAAKgAgAEAAAAAQAAAEKgAwAEAAAAAQAAAEIAAAAAgodoEQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAABMtJREFUeAHtXM2KFDEQzrQKruIu4mEXRFlUVLz4A4K7B99AcO8io0/gwQfxDVzFuwu+gQf34EG8iOAPKAh6EFlBFMSf/qa2uqszlVR6ZtYxM5PDJNVVSer78nU6KrHzpyxuVlwx44AY2O0T8eb9D7f5fMu9fPvdff7y0/36nbdgdhUdd+jgHnf62JxbObvgjh/d60Pu2R35ajx49Mk9frqlBk7Kw8sXF9y1K4t9cCoi7tz/4F68/tYXMIkPzpzY725dP9yA1tsjoIRpIQHogRWYZSmwJ4Reh06nI2Nd7rYEA8zAzqXAxhgq/pc1d9vHKbEX+Dr4JbzypJDc/YxXYi/wifRLeOXpU5q7n/FK7EXsnBBeeRoqd7/EHj1ZhleeiMjdz8pArRKR+0pb+UsCuK0SkftKW/kzeFmrRHCAxWzufsaJOkqExWzufpOI8EpP1jnCJCK80pN1jjCJ4ICwMigidz/jRD3bI7bZUInIfaWt/KUSuK0SEd4jqFvufgYva5UIDrCYzd3POFFHifhfV/7k8lwPw7D5mUSEV3r854ju2pK7ffOIWzk/X+Go803Lr+ooGqoiwkyP9xzRXVt0q9sE3CgJYTLqfNPyE/irpkoEe2um6ck4bSiBSeD8JBl41jY/Hgd1lIiaaeoyLlsjgUGAjEH3DB4DtUpEW2Z3Mj5GAgA8efbVvXpX/200nln5IMYvKhHDrvylcwdc9+pSNdeg46WQsP7wo2s7fpWYaPT926fw9ZiVk4BpywYJkGuvlJs4EuWS0p/HTyHh3kbzH2najM85cR0lgpPiYMtukFB26m1u5Ua+vkFkWP3Zn0KCJDg1Px6f42Wtvhrhdyz8ncanrFKCmGH1wrwDMCrh/uxPIUFTAvdHbeVPsc1fVRE+c7Ud/k6fWt7XHFlYqcqQ5wTRvWpiY4wrIZwfDUL+akDRUBXB/jCzFCH9SHCzTDRUmsro7z+cEvrHwxOZn2ZTL/pVFcEBtRLoiWXfxQ5ehvoHHx4vpIwUEuJKSMvPz5/zQq0qwmIy5m+rjBQSwnsCQYnlgwjfT72av6oifOba2qnKcOXeGVIP0rT3BALTNr8mBWSpRHAgmJSTtLGhDHwj+A9GPCbX2DNiBSRoShg0H8zl5y/njxIhJ0WntralDJmIbO+UEvz85Zwt9wj7HIDB5Ttp7RkyGbRDSqC49vOjX50P9aexmr+qInzmajvtO13H02SpyrCVMNj8dT7/4BwByDXzRIC0LWXEldA/njVfip9GpV9VERxQM0lPhrVDyrCVMJr5/fwZJ+qWewR1lSuNJ21sXxnjVgIhck5VhM/cqG1WBpIAMX4Z9Xz+eP58sFUiOBArLQcZpQ0CNCXt1HzA5OfPOFGrrwYHyKTwbNJsxolaJUJbKeo0mu/4uMeXBHBbJSK88qP5jo97fAYva5UIDgivHEXk7mecqKNEhFeOhsjdbxKR+0pb+UsCuK0qIveVtvJn8LJWieAAi9nc/YwTdZQIi9nc/SYR4ZWenSO2yZvgcwTuRYZKWBnUI3e/xF7gcmio5L4HWPlL7AVuyPol95W28me8EnuBa8J+sZjM3c94JfYCd6VxTXjaCjDLe+K9cwTuSuOa8LQUYPXvh1d3w0HC7JK8kMK0/rcJfwHkVMYgi4xhOgAAAABJRU5ErkJggg==");background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言：</h2>
<blockquote>
<p>上周，负责核心业务组件的同事老王突然请假（据说去相亲了），留下一堆代码和风中凌乱的我。</p>
<p>结果前脚刚走，后脚核心客户就炸锅了：“你们这个系统怎么回事？我每次要给员工赋个权，浏览器就直接卡死！打开弹窗挺快，一点开部门就未响应，关掉弹窗还要卡半天！”</p>
<p>看着客户发来的 <strong>十几秒卡顿录屏</strong>，和老板投来的“和善”目光，我只能硬着头皮接下了这个“锅”。</p>
<p>本文记录了我是如何从吐槽同事代码，到深度排查，最终通过<strong>深度优化</strong>解决这个 <strong>几千个节点递归组件性能灾难</strong>的全过程。</p>
</blockquote>
<h2 data-id="heading-1">先看优化结果: 懒加载 + 合成线程优化 + 手风琴模式</h2>
<ul>
<li>
<p><strong>交互体验</strong>：几千节点树瞬间展开，关闭零延迟。</p>
</li>
<li>
<p><strong>Performance 数据</strong>：如图所示，长任务 (<code>Long Task</code>) 彻底消失，无红色阻塞色块。</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dffe2fd5a3354652a5ebc920f7d05390~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=uKpRSm%2FUtYKyE726u%2FxILUcGaeQ%3D" alt="优化后结果.gif" loading="lazy"/></p>
<h2 data-id="heading-2">一、 客户现场还原（案发经过）</h2>
<h3 data-id="heading-3">业务背景</h3>
<p>客户正在使用我们的 <strong>“企业级权限管理系统”</strong> 。</p>
<p>出问题的组件是一个核心的 <strong>组织架构选择器（TreeSelect）</strong> ，它被嵌入在一个高频使用的 <strong>“授权弹窗”</strong> 中。</p>
<ul>
<li>
<p><strong>高频场景</strong>：管理员需要频繁地给不同的员工或部门分配权限。</p>
</li>
<li>
<p><strong>操作路径</strong>：点击“可见范围” -&gt; 弹出授权弹窗 -&gt; 在树形组件中找到对应部门/人员 -&gt; 勾选 -&gt; 确定/关闭。</p>
</li>
</ul>
<h3 data-id="heading-4"><strong>数据规模</strong></h3>
<p>该客户是大型企业，全量组织架构节点约为 <strong>2700 个</strong>（包含多级部门和人员）。这个数量级在 ToB 业务中其实不算特别大，但足以压垮未经优化的代码。</p>
<h3 data-id="heading-5"><strong>故障现象</strong></h3>
<ol>
<li>
<p><strong>打开弹窗（快）</strong> ：点击授权按钮，弹窗秒出（老王用了分帧渲染进行首屏优化，这点挺好）。</p>
</li>
<li>
<p><strong>寻找部门（卡死）</strong> ：管理员试图展开根部门去寻找下级单位，点击小三角的瞬间，界面失去响应，<strong>Long Task 持续 10s+</strong> 。管理员以为死机了，疯狂点击，结果还是没反应。</p>
</li>
<li>
<p><strong>关闭/取消（卡死）</strong> ：好不容易选完了，点击“确定”或“关闭”弹窗，界面再次假死 <strong>4-5s</strong>，才能关掉弹窗。</p>
</li>
</ol>
<h2 data-id="heading-6">二、 深度侦查：谁在谋杀主线程？</h2>
<blockquote>
<p><strong>工程化思考：线上监控能发现吗？</strong>
很多同学问：Sentry 或其它性能监控能抓到这个问题吗？
线上监控通常只能告诉你 <strong>“页面卡了”</strong>（监控到 <code>Long Task</code> 或 <code>INP</code> 指标飙升），但很多时候难告诉你具体的 <strong>“为什么卡”</strong>。
要确诊是 JS 逻辑阻塞，还是 CSS 动画引发的 <strong>Reflow (重排)</strong>，必须依赖本地 Chrome DevTools 的 <strong>Performance 面板</strong> 进行“CT 扫描”。</p>
<p><strong>💡 小贴士：如何使用 Performance？</strong>
打开 F12 开发者工具 -&gt; 切换到 <strong>Performance</strong> 面板 -&gt; 点击左上角“圆点”开始录制 -&gt; 在页面操作复现卡顿 -&gt; 点击 Stop 停止，即可生成分析报告。</p>
</blockquote>
<p>我在本地 Mock 了 2700 条左右的数据，模拟了“打开 -&gt; 展开 -&gt; 关闭”的全流程，打开 Chrome <strong>Performance</strong> 一看，好家伙，红得跟过年一样。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17bc9a2b51ae4092961705ccbd77aa8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=5FMKBGG3JlikrGoWEi9%2B5dQxC5I%3D" alt="组织架构树响应慢问题排查.gif" loading="lazy"/></p>
<h3 data-id="heading-7">第一步：看“心电图” (Performance 面板)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87cf18d4a88545e39f23177e037327d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=YpLgBvOsNl%2FYnKQVW%2BHUQxVSiac%3D" alt="image.png" loading="lazy"/></p>
<p><strong>现象</strong>：</p>
<blockquote>
<p>很多人看到 Performance 密密麻麻的图表就头晕，其实诀窍就一句话：<strong>从上往下看</strong>。</p>
<ol>
<li><strong>看顶部</strong>（Main 线程）：<strong>红色</strong>的色块代表 <strong>Long Task</strong>（长任务），是导致页面卡顿的直接元凶。</li>
<li><strong>看中间</strong>（调用栈）：像倒置的火焰一样，<strong>越宽</strong>代表耗时越久，<strong>越往下</strong>代表函数调用越深。</li>
<li><strong>找凶手</strong>：顺着红条往下找，最底下的那个“宽条条”，通常就是罪魁祸首。</li>
</ol>
</blockquote>
<p><strong>回到本案分析</strong>：</p>
<ol>
<li>
<p><strong>顶部报警</strong>：最显眼的是一条红色斜纹带，说明主线程一直处于阻塞状态。</p>
</li>
<li>
<p><strong>中间密集</strong>：顺着红色区域往下看，全是密密麻麻的黄色小条，提示 <code>Animation Frame Fired</code>（动画帧<code>requestAnimationFrame</code>触发）。</p>
</li>
<li>
<p><strong>底部实锤</strong>：继续顺着调用栈 <strong>从上往下</strong> 找，能看到频繁的 <code>cloneNode</code>（克隆节点）调用。这说明核心耗时在 DOM 操作，浏览器在不断创建新元素。</p>
</li>
</ol>
<p><strong>结论</strong>：核心耗时在 DOM 操作，浏览器在疯狂加班造 DOM。<code>cloneNode</code> 就像是在复印文件，这说明代码在<strong>没完没了地制造新的页面元素</strong>，而且是一刻不停地在造，直接把主线程干趴下了。</p>
<h3 data-id="heading-8">第二步：顺藤摸瓜 (找代码)</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d00c4d1ccee4e14a3f45a0f46d35185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=XbplzkEebZOah8wafv7NLXy256c%3D" alt="image.png" loading="lazy"/></p>
<p><strong>线索</strong>：
Performance 面板明确指出了凶手是 <code>ReSubMenu.vue</code> 里的 <code>renderVisibleData</code> 函数。</p>
<p><strong>代码长这样</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 这是一个分帧渲染函数</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleData</span>(<span class="hljs-params">data, index = <span class="hljs-number">0</span></span>) {
  <span class="hljs-comment">// 1. 先渲染一小部分（比如 5 个）</span>
  visibleChildrenData.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(...data.<span class="hljs-title function_">slice</span>(index, index + <span class="hljs-number">5</span>))

  <span class="hljs-comment">// 2. 如果还有数据没渲染完，申请下一帧接着干</span>
  <span class="hljs-keyword">if</span> (还剩有数据) {
    <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">renderVisibleData</span>(data, index + <span class="hljs-number">5</span>) <span class="hljs-comment">// &lt;--- 案发地点！</span>
    })
  }
}
</code></pre>
<p><strong>原本的算盘</strong>：
写这段代码的初衷是好的——<strong>“分帧渲染”</strong>。
为了防止某一层级下有几千个菜单项把页面卡死，特意用了 <code>requestAnimationFrame</code>，意思是：“浏览器大哥，您别急，咱们每帧只画 5 个，慢慢来。”</p>
<h3 data-id="heading-9">第三步：真相大白 (逻辑漏洞)</h3>
<p><strong>问题出在哪？</strong>
看似优雅的“慢慢来”，忽略了一个致命的前提：<strong>递归组件的叠加效应</strong>。</p>
<p>我们的树形组件结构大概是这样的（典型的无限套娃）：</p>
<ul>
<li>入口 (AuthorizedMenu.vue)
<ul>
<li>TreeSelect (外层容器)
<ul>
<li>ReSubMenu (递归的开始)
<ul>
<li>SubMenu (动画/折叠)
<ul>
<li>MenuItem (节点项)</li>
<li>ReSubMenu (子节点 -&gt; 套娃开始)</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>这就意味着，如果你的树数据有 5 层深，组件就会自己把自己嵌套 5 层。</p>
<p>我又看了一眼负责展开收起菜单动画的父组件 <code>SubMenu.vue</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-comment">&lt;!-- 这里只用了 CSS 控制高度来折叠，没有用 v-if --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"subItem"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: ... }"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">slot</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><strong>案情还原</strong>：</p>
<ol>
<li>
<p><strong>看不见的“大军”</strong>：
虽然界面上菜单是收起的，但因为没加 <code>v-if</code> 控制，<strong>整棵树 2000 多个节点其实都在后台悄悄挂载了</strong>。这就好比你只点了一盘花生米，后厨却把满汉全席都备好了。</p>
</li>
<li>
<p><strong>分帧策略失效</strong>：
老王的“分帧渲染”本意是好的：“大家别急，排好队，一帧画 5 个。”
但因为是递归组件，<strong>几百个组件实例是同时启动的</strong>。</p>
</li>
<li>
<p><strong>菜市场效应</strong>：</p>
<ul>
<li>第一层组件喊：“浏览器老师，麻烦帮我画 5 个！”</li>
<li>第二层组件也喊：“我也要画 5 个！”</li>
<li>第 N 层组件齐声喊：“还有我！还有我！”</li>
</ul>
</li>
</ol>
<p><strong>结果</strong>：浏览器瞬间懵了。虽然每个人只请求画 5 个，但这几百个组件同时请求，瞬间就堆积了成千上万个 <code>cloneNode</code> 任务。这就好比几百只鸭子同时在叫，主线程直接被<strong>高并发的 DOM 操作</strong>给冲垮了。</p>
<h2 data-id="heading-10">三、 紧急救援：学会“偷懒”</h2>
<p>吐槽归吐槽，Bug 还是得修。解决办法就是三个字：<strong>懒加载</strong>。</p>
<h3 data-id="heading-11">核心逻辑</h3>
<p>看不见的菜单，坚决不渲染！
只有当用户点击“展开”按钮那一刻，我才开始去渲染子菜单。</p>
<h3 data-id="heading-12">代码改动</h3>
<p>把原来的“一上来就渲染”改成“盯着开关看”：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ReSubMenu.vue</span>

<span class="hljs-comment">// 只有当 isExpand (展开状态) 变成 true 时，才开始干活</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">data</span>.<span class="hljs-property">isExpand</span>,
  <span class="hljs-function"><span class="hljs-params">val</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (val) {
      <span class="hljs-comment">// 只有展开时，且之前没渲染过，才启动分帧渲染</span>
      <span class="hljs-keyword">if</span> (visibleChildrenData.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-title function_">renderVisibleData</span>(props.<span class="hljs-property">data</span>?.<span class="hljs-property">children</span>)
      }
    } <span class="hljs-keyword">else</span> {
       visibleChildrenData.<span class="hljs-property">value</span> = []
    }
  },
  { <span class="hljs-attr">immediate</span>: <span class="hljs-literal">true</span> }
)
</code></pre>
<h3 data-id="heading-13">关闭弹窗卡死</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/45ffac7e3c6347a194162776075dbcf4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=sYzqiwrmy1sCjHJXTd%2BS8WOrhrc%3D" alt="关闭弹窗慢问题排查.gif" loading="lazy"/></p>
<p>客户之前反馈“关闭弹窗也卡”，是因为同事老王的代码让组件一开始加载了几千个节点，内存中就堆积了几千个复杂的组件实例。</p>
<p>点击关闭弹窗的那一刻，主线程被 GC（垃圾回收）和 Vue组件的卸载任务（<code>beforeUnmount</code> / <code>unmounted</code>等）瞬间挤爆。</p>
<p><strong>截图证据</strong>：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/757b3a8e1a3a432d81fd9240f1f2087c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=4iGg%2FNPdlq%2FpcXnSTFvAjrlRDbI%3D" alt="image.png" loading="lazy"/>
大家看这张截图，关闭弹窗的一瞬间，<code>removeChild</code> 操作竟然耗时 <strong>5.14s</strong>！这意味着浏览器主线程被这个巨大的“拆迁工程”彻底堵死，用户只能对着屏幕发呆。</p>
<h2 data-id="heading-14">四、 进阶战术：三维治理策略</h2>
<p>单纯的懒加载解决了“初始化”问题，但为了达到极致体验，我们还引入了另外两个维度的优化。</p>
<h3 data-id="heading-15">1. 渲染层：用 ScaleY 替代 Height 动画</h3>
<p><strong>排查</strong>：</p>
<ul>
<li>
<p>我看了下 CSS，菜单的展开/收起是用 <code>transition: height</code> 做的“窗帘”效果。</p>
</li>
<li>
<p>每一级菜单都是改高度 <code>height</code>（收起为 0，展开为节点内容高度）。</p>
</li>
<li>
<p><code>height</code> 是布局属性，动它就会触发 <code>Reflow</code>（重排），浏览器需要把受影响的布局链路重新算一遍。</p>
</li>
<li>
<p>递归树会层层传导：你点开一层会牵动下面整段子树一起算，链路很长，低端机分分钟卡住</p>
</li>
</ul>
<p><strong>展开节点卡顿现象图：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d525c3b276149d68df6b57e439876f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=79PDp69%2BjICr75NDrnlXnJUHx8Y%3D" alt="展开菜单卡顿.gif" loading="lazy"/></p>
<p><strong>优化</strong>：
改为使用 CSS3 的 <code>transform: scaleY</code>，同样可以达到丝滑展开的效果。</p>
<p><strong>简单理解 使用ScaleY实现展开动画效果的原理</strong>：</p>
<ul>
<li><strong>变的是什么？</strong> <code>scaleY</code> 改变的是元素在 <strong>Y 轴（竖向）</strong> 的缩放比例。</li>
<li><strong>怎么变？</strong> 从 <code>0</code>（压扁成一条线，完全看不见）过渡到 <code>1</code>（拉伸回原本的高度）。</li>
<li><strong>为什么像展开？</strong> 配合 <code>transform-origin: top</code>（固定顶部），就像把卷帘门从上往下拉下来一样，视觉上就是完美的“展开”效果。</li>
</ul>
<p><strong>深度原理</strong>：<code>transform</code> 属性不会触发 Reflow，只会触发 <strong>Composite (合成)</strong>，这个过程完全由 GPU 处理，不占用主线程 CPU 资源。</p>
<blockquote>
<p><strong>浏览器渲染三兄弟</strong></p>
<ul>
<li><strong>Reflow (重排)</strong>：牵一发而动全身。修改 <code>height</code>、<code>width</code> 时，浏览器要重新计算所有元素位置，<strong>开销最大</strong>。</li>
<li><strong>Repaint (重绘)</strong>：换汤不换药。修改 <code>color</code>、<code>background</code> 时，不影响位置，只重画样子，<strong>开销中等</strong>。</li>
<li><strong>Composite (合成)</strong>：<strong>VIP 绿色通道</strong>。修改 <code>transform</code>、<code>opacity</code> 时，浏览器直接把图层交给 GPU 处理，<strong>跳过</strong>布局和绘制，<strong>开销最小</strong>！</li>
</ul>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 优化前：卡顿源头 */</span>
<span class="hljs-selector-class">.subItem</span> {
  <span class="hljs-attribute">transition</span>: height <span class="hljs-number">0.3s</span> ease-in-out;
}

<span class="hljs-comment">/* 优化后：丝滑无比 */</span>
<span class="hljs-selector-class">.subItem</span> {
  <span class="hljs-attribute">transform-origin</span>: top; <span class="hljs-comment">/* 确保从顶部开始展开 */</span>
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.3s</span> <span class="hljs-built_in">cubic-bezier</span>(<span class="hljs-number">0.645</span>, <span class="hljs-number">0.045</span>, <span class="hljs-number">0.355</span>, <span class="hljs-number">1</span>);
}

<span class="hljs-selector-class">.subItem</span><span class="hljs-selector-class">.expanded</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">1</span>);
}

<span class="hljs-selector-class">.subItem</span><span class="hljs-selector-class">.collapsed</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">scaleY</span>(<span class="hljs-number">0</span>);
}
</code></pre>
<blockquote>
<p><strong>⚠️ 避坑指南：关于 <code>will-change: </code></strong></p>
<p>有同学可能会问：“为什么不加 <code>will-change: transform</code>？”</p>
<ul>
<li>少量元素时可以考虑；大规模递归树千万别全局加。</li>
<li>参考 MDN：不到不得已不要使用；仅在确有必要时短时添加，过度使用会导致内存占用增加与性能下降。</li>
<li>文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FCSS%2Fwill-change" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/CSS/will-change" ref="nofollow noopener noreferrer">developer.mozilla.org/en-US/docs/…</a></li>
<li>建议：如需使用，按需、短时、少量元素，并在动画结束后移除。</li>
</ul>
</blockquote>
<p>效果： 动画流畅、交互响应即时。（GIF图压缩严重，请自动脑补德芙广告的丝滑质感）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/674c72b24f914e3f9b9254cbfe8454df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=51eSiVp7hUUWuEPdjr7STPY0Leo%3D" alt="节点展开动画优化.gif" loading="lazy"/></p>
<h3 data-id="heading-16">2. 销毁层：以“藏”代“删”</h3>
<p><strong>痛点</strong>：
即使用户只是临时关闭弹窗，下次还要再开，原来的逻辑也是直接 <code>v-if="false"</code> 销毁整个组件树。这就导致了那 5 秒的 <code>removeChild</code> 卡顿。</p>
<p><strong>优化</strong>：
对于这种巨型组件，关闭弹窗时<strong>不要销毁它</strong>，而是把它“藏起来”。</p>
<p><strong>代码改动</strong>：
将弹窗的显隐控制从 <code>v-if</code> 改为 <code>v-show</code>，或者使用透明度方案：</p>
<blockquote>
<p><strong>v-if 、 Opacity、  v-show</strong>的区别</p>
<ul>
<li>
<p><strong>v-if</strong>：真正的条件渲染。切换时，组件及其内部所有的事件监听器和子组件都会被<strong>销毁和重建</strong>。对于 2500 个节点的树，这意味着成千上万次的 DOM 插入/删除操作。</p>
</li>
<li>
<p><strong>v-show</strong>：简单的 CSS 切换（display: none）。组件实例始终保留，开销极小。</p>
</li>
<li>
<p><strong>Opacity (透明)</strong>：<code>opacity: 0</code>。DOM 保留，配合 GPU 加速仅触发合成 (Composite)，<strong>切换成本最低</strong>（本案最终方案）。</p>
</li>
</ul>
</blockquote>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* 只是看不见，但 DOM 还在，避免了昂贵的卸载过程 */</span>
<span class="hljs-selector-class">.dialog-hidden</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">pointer-events</span>: none; <span class="hljs-comment">/* 确保点不到 */</span>
  <span class="hljs-attribute">z-index</span>: -<span class="hljs-number">1</span>;
}
</code></pre>
<p><strong>效果</strong>：
关闭弹窗时，耗时从 <strong>5s</strong> 瞬间变为 <strong>0ms</strong>（只是改了个 CSS 属性）。下次再打开时，因为 DOM 都在，直接恢复透明度即可，实现了真正的“秒开”。</p>
<h3 data-id="heading-17">3. 交互层：手风琴模式（Accordion）</h3>
<blockquote>
<p><strong>🤔 什么是手风琴效果？</strong></p>
<p>简单来说，就是 <strong>同一级只有一个节点展开</strong>。
就像手风琴的风箱，拉开这一折，那一折自然合上。比如财务部和研发部是兄弟节点，当你点击展开“财务部”的子节点，之前点开的“研发部”会自动收起。</p>
</blockquote>
<p>我们先来看优化后的效果图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6748feeb1794a928094ef6aa00bbc54~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=kzS7JHNFNbqabkFvZZck1SnOI3Q%3D" alt="手风琴效果.gif" loading="lazy"/></p>
<p><strong>痛点</strong>：
ToB 系统的用户有时操作很“野”，他们可能会把所有部门一层层全部点开。
如果不加限制，随着用户不断展开，页面上的 DOM 节点数量依然会无限制增长，最终再次拖慢浏览器。</p>
<p><strong>优化</strong>：
为组件增加 <code>accordion</code>（手风琴）模式配置。
<strong>原理</strong>：开启后，同级节点同时只能展开一个。当你展开“财务部”时，之前展开的“研发部”会自动收起。</p>
<p><strong>代码示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 伪代码：手风琴逻辑</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onNodeExpand</span>(<span class="hljs-params">node</span>) {
  <span class="hljs-keyword">if</span> (accordionMode) {
    <span class="hljs-comment">// 兄弟节点，统统收起！</span>
    siblings.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">sib</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (sib !== node) sib.<span class="hljs-property">isExpand</span> = <span class="hljs-literal">false</span>
    })
  }
  node.<span class="hljs-property">isExpand</span> = <span class="hljs-literal">true</span>
}
</code></pre>
<p>这从<strong>交互设计</strong>层面对 DOM 峰值设定了上限：不管怎么点，同级只保留一个展开项，页面同时存在的 DOM 数始终处于低位且可控。</p>
<h2 data-id="heading-18">番外篇：如果数据量再大 10 倍怎么办？</h2>
<p>虽然这次 2000多条数据搞定了，但肯定有小伙伴会问：“如果有 <strong>2万多条</strong> 甚至更多怎么办？”</p>
<p>这时候，单纯的懒加载也不够用了，因为 DOM 节点的总数依然可能突破浏览器极限。我们需要引入核武器——<strong>虚拟树 (Virtual Tree)</strong>。</p>
<p>简单来说，就是<strong>只渲染你屏幕里看得到的那些节点</strong>。
不管树有几万层，屏幕就那么高（比如 800px），我只渲染这几十个节点，其他的用个空 <code>div</code> 撑开高度把滚动条骗过去就行。</p>
<p><strong>思路也很直白</strong>：</p>
<ol>
<li><strong>拍平</strong>：把树拆成一个大的一维数组。</li>
<li><strong>计算</strong>：算算当前滚动条在什么位置，对应数组里的哪几条数据。</li>
<li><strong>渲染</strong>：只把这几条画出来，绝对定位到正确的地方。</li>
</ol>
<p><strong>那为什么这次没用？</strong>
还是那句老话：<strong>ROI（投入产出比）</strong>。</p>
<p>手写虚拟树要处理动态高度、复选框联动等难点，头发都要掉一把；引入现成的库又会增加包体积。
对于 几千条数据，现在的方案已经够用了，再上虚拟树就是“大炮打蚊子”，没必要增加维护成本。</p>
<p><strong>技术选型没有银弹，只有最适合当下的方案。</strong></p>
<h2 data-id="heading-19">五、 优化结果与客户反馈</h2>
<p>效果图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dffe2fd5a3354652a5ebc920f7d05390~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767658302&amp;x-signature=uKpRSm%2FUtYKyE726u%2FxILUcGaeQ%3D" alt="优化后结果.gif" loading="lazy"/></p>
<p>我们将优化后的补丁发给客户验证：</p>
<ol>
<li><strong>打开弹窗</strong>：保持秒开。</li>
<li><strong>寻找部门（展开）</strong>：从 <strong>十几秒卡死</strong> 变为 <strong>即时响应</strong>。</li>
<li><strong>完成授权（关闭）</strong>：从 <strong>5s 卡死</strong> 变为 <strong>0 延迟</strong>。</li>
</ol>
<p>Performance 面板再次查看，那条心电图终于平稳了，只有零星的几个小波峰，代表正常的渲染任务。</p>
<p>客户反馈：“终于顺畅了，这才是专业系统该有的样子。”（老板终于露出了满意的微笑）</p>
<hr/>
<h2 data-id="heading-20">六、 写在最后</h2>
<p>这次“接盘”经历告诉我：</p>
<ol>
<li>
<p><strong>不要为了优化而优化</strong>：“分帧渲染”是个好技术，但如果配合上了“全量挂载”，就像让一千个人同时在走廊里“慢跑”，虽然每个人跑得慢，但路还是被堵死了。</p>
</li>
<li>
<p><strong>关注“销毁”成本</strong>：性能优化不仅是“渲染快”，还要“销毁快”。</p>
</li>
<li>
<p><strong>递归组件要慎重</strong>：递归组件是性能问题的重灾区，一定要时刻警惕“指数级爆炸”。</p>
</li>
</ol>
<p>最后的最后，老王回来后，我必须得请他吃顿好的——毕竟没有他这代码，我也没机会写这篇几千字的复盘文章，更没机会在掘金骗大家的赞（手动狗头）。</p>
<p><strong>如果你觉得这篇文章对你有启发，欢迎 点赞、收藏、转发，这对我很重要！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我的 2025：代码留痕，时光有暖，成长有迹]]></title>    <link>https://juejin.cn/post/7589181008097820687</link>    <guid>https://juejin.cn/post/7589181008097820687</guid>    <pubDate>2025-12-30T00:09:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589181008097820687" data-draft-id="7589104492882608180" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我的 2025：代码留痕，时光有暖，成长有迹"/> <meta itemprop="keywords" content="年终总结"/> <meta itemprop="datePublished" content="2025-12-30T00:09:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三只萌新"/> <meta itemprop="url" content="https://juejin.cn/user/360295544400973"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我的 2025：代码留痕，时光有暖，成长有迹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/360295544400973/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三只萌新
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:09:07.000Z" title="Tue Dec 30 2025 00:09:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">开篇：2025，代码、娃和写文的一年</h2>
<p>2025 这一年，更像并行推进着两件事 —— 工作上完成了 35 + 需求，跑了 10 次客户现场对接需求、解决问题，参与了一次投标，同时带教的 5 名新人也能独立承担工作了。独立做了个 UML 建模的桌面端应用，从需求梳理到上线的全流程都走通了。</p>
<p>写文的节奏也没断，今年一共输出了 20 多篇原创技术文章，内容都是实际工作里的经验：比如 Jenkins 打包遇到的问题、远程带新人的流程、用 SVG 实现思维导图和 UML 关系线，还有独立开发桌面应用的过程、现场紧急排查性能问题的方法，算是把实操里的经验都整理成了文字。</p>
<p>家庭这边是全新的生活底色 —— 儿子出生后，我俩彻底切换成新手爸妈模式，从手忙脚乱地换尿布、学拍嗝，到慢慢摸清他的作息规律。今年他有三次发烧，夜里每隔一小时就爬起来量体温、做物理降温，十多个晚上熬下来，连夜里醒几次、该喂多少水都形成了肌肉记忆，总算从最初的慌慌张张，慢慢练成了遇事不慌的 “熟练工”。</p>
<p>这一年不算轻松，改 bug 的间隙要盯着新人的进度，哄娃睡熟后会顺手理一理文章的思路。但回头看，工作里的需求都落了地，自己做的应用跑通了流程，家里的小家伙也安稳长大，这些事儿算是都稳稳接住了。</p>
<h2 data-id="heading-1">研发深耕</h2>
<p>今年在公司干的活儿还是杂而实，作为全干工程师，日常就是围着  Electron、SVG 图形绘制逻辑计算、Nestjs 转，偶尔还得啃点操作系统相关的知识，技术面铺得比较开。好在已经在公司待了两年半，不管是前端还是 Node 端的链路，现在摸得都很透，对整个项目的把控力也比以前强多了，遇到跨模块的问题也能快速理顺。</p>
<p>AI 编程是我今年花心思最多、探索最久的一块。前前后后试了不少工具，trae 的海外版和中文版都常用，还有 cursor、kiro、windsurf、qoder 这些，国内的豆包、通义千问、kimi 也都挨个测过。从一开始琢磨怎么优化提示词，到后来定规则、搞 spec 编程，一步步试着把 AI 编程往工程化靠，不是随便用用图个快，而是想让它真正适配日常开发流程。靠这些工具省了不少重复劳动的时间，终于能把精力放在核心业务上，也有功夫系统性地摸透业务逻辑，跟实施团队、现场业务方沟通也更顺畅了，现在对整个业务流程的来龙去脉都门儿清。</p>
<p>我也没困在现有工作的边界里，想着多拓展下自己的领域。除了入门 Java 写点 demo 练手，还自己捣鼓了那个 UML 建模的桌面端应用，开发的时候主动补了些操作系统的知识，算是跳出舒适区多学了点东西。</p>
<p>对外对接的活儿也没落下，全年跑了 10 次客户现场，需求确认、排查问题、验收落地一套流程走下来都顺顺利利，确保客户要的东西能精准落地。另外还全程跟着参与了一次投标，负责写技术方案、准备支撑材料，也算帮团队把这个专项的事儿扛了下来。</p>
<h2 data-id="heading-2">团队带教</h2>
<p>今年还有个变化，就是开始主动往管理、带人这块靠，不再只盯着自己的代码，愿意接些团队管理的活儿，试着做业务和团队的 “掌舵人”，而不只是个技术执行者。全年带了 5 个新人，从入门怎么上手、代码规范怎么守，到熟悉业务、跟着做项目实操，全流程都陪着他们走。</p>
<p>我会记着每个新人什么时候能独立接单，遇到他们卡壳的地方，就针对性地帮着梳理难点、避坑。慢慢也总结出些实用的带教方法，不是光靠说，而是把复杂业务拆成一步步的小任务，再定期跟他们答疑复盘，这些方法也整理成了可复用的流程，后面再带人就能省不少劲。看着新人一个个能独当一面，我自己的统筹协调、跟人沟通的能力也跟着提上来了，算是双向成长吧。</p>
<h2 data-id="heading-3">内容创作</h2>
<p>今年写技术文章，对我来说更像是个人复盘和记录的过程，不是为了刻意分享，更多是用输出倒逼自己输入和梳理。每一篇都是实战里摸爬滚打的总结，不管是 Jenkins 打包踩的坑、SVG 绘制的实操技巧，还是 AI 编程的探索心得、独立开发桌面应用的流程，都一一记了下来，发布在掘金上。</p>
<p>这些文字也是给我自己的职业生涯留个印记。哪怕以后转行做了别的，回头翻一翻，也能想起这段和代码打交道的日子，清楚自己每一步是怎么过来的。而且写的过程本身就是重新梳理逻辑、查漏补缺，相当于再把工作里的知识点过一遍，既巩固了技能，也能给有同样困惑的同行一点参考，算是意外的收获。</p>
<h2 data-id="heading-4">家庭新章</h2>
<p>今年最重大的变化，就是解锁了爸爸这个新身份，也真正懂了什么是家庭责任感。工作之余的大部分时间，几乎都耗在了家里的小可爱身上，陪他玩、哄他睡、处理各种琐碎的照料事宜，日子被这些细碎的时光填满。</p>
<p>这份新身份带来的，是快乐和疲惫对半开的日常。小家伙三次发烧的夜里，我几乎没合过眼，隔一小时就摸一次体温、擦一遍身子，几个通宵熬下来，连走路都有点飘。也是这时候才懂，当父母哪有什么得心应手，全是硬扛过来的。</p>
<p>快乐是实打实的 —— 被他攥着手指咿呀学语，看他睡醒后咧嘴笑的模样，但疲惫也是真真切切的，是新手爸妈面对孩子发烧时的手足无措，是熬完夜还要赶去公司开会的兵荒马乱。</p>
<p>一边是催着上线的需求、排满行程的出差、等着带教的新人，一边是离不开人照顾的娃和一堆家务琐事，这种拉扯感缠了一整年。原来所谓的中年人时刻，就是这样，谈不上什么平衡，无非是在工作和家庭的夹缝里，一边狼狈应付，一边咬牙扛起该担的责任。</p>
<h2 data-id="heading-5">来年规划</h2>
<p>时光匆匆，2025 年转眼即逝。新的一年不贪多求全，就沉下心把几件事做扎实，稳步往前推进。</p>
<p>技术和工作上，重点抓两件事。</p>
<ol>
<li>是把 AI 编程工程化这条路走深走透，多琢磨适配日常开发的落地技巧，靠它解放双手、减少重复劳动，省出更多精力跳出代码本身。不再只做埋头敲代码的执行者，主动往前站一步，摸清业务的底层逻辑和核心诉求，读懂业务背后的价值，让自己在工作中更有话语权。</li>
<li>是继续拓展独立开发的边界，不再局限于现有成果，主动探索新的应用方向，从零到一打造新的自研项目，争取做出能解决实际需求、让更多人用得上的产品，让技术落地产生真正的价值。</li>
</ol>
<p>团队带教方面，打破现有单一模式，多探索灵活高效的方法。不光是靠手把手带练，还会结合 AI 工具优化带教流程，整理标准化手册的同时，增加案例复盘、任务拆解实操等环节，针对性匹配不同新人的接受节奏，既提高带教效率，也能让新人更快独当一面。</p>
<p>生活上，核心是把节奏调顺、过出质感。一直坚信工作是为了更好的生活，而非被工作裹挟。新的一年要砍掉无效忙碌，多留些高质量陪伴给家人，陪着孩子慢慢长大，多为家里添些烟火气和实实在在的快乐，在个人成长和家庭温暖之间找到舒服的平衡点，不辜负每一段陪伴的时光。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告]]></title>    <link>https://juejin.cn/post/7589082912589086763</link>    <guid>https://juejin.cn/post/7589082912589086763</guid>    <pubDate>2025-12-30T00:15:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589082912589086763" data-draft-id="7587672626757697555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-30T00:15:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            用 Flutter、SwiftUI 和 Compose 写同一个界面：一份真实开发者的实测报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:15:46.000Z" title="Tue Dec 30 2025 00:15:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嘿，朋友！👋</p>
<p>还记得咱们以前老是为“哪种框架才是坠吊的”吵得不可开交吗？这回，我终于干了件每个开发者都放过狠话、但从来没真干过的事：我用 <strong>Flutter、SwiftUI 和 Jetpack Compose</strong> 把同一个界面撸了出来——而且全都严格遵循了 <strong>Clean Architecture（整洁架构）</strong> 原则。</p>
<p><strong>欢迎关注我的微信公众号：OpenFlutter</strong></p>
<p>说实话，最后的结果真把我给惊到了。</p>
<h4 data-id="heading-0">为什么这篇文章值得你看（没错，说的就是你）</h4>
<p>听着，我懂。你点进来多半是因为：</p>
<ul>
<li>你正陷入“框架焦虑（FOMO）”中，急需定夺<strong>到底学哪一个</strong>；</li>
<li>老板问你“咱们项目用哪个好？”，你当时就<strong>慌了</strong>；</li>
<li>你是个 Flutter 开发者，总惦记着<strong>隔壁的草是不是更绿一些</strong>；</li>
<li>你要去面试了，想在聊跨平台开发时显得<strong>更有深度</strong>；</li>
<li>你心里其实已经选好了，就指望我能<strong>夸夸你的选择</strong>（剧透一下：没准儿真会哦）。</li>
</ul>
<p>不管你是为了啥来的，我保证这不是那种“Hello World”级别的流水账。这是一个刚熬了三个通宵，在状态管理、依赖注入以及“等等，我这层数据到底怎么传给下一层来着？”这些地狱级难题里反复横跳后的<strong>真实感悟</strong>。</p>
<h4 data-id="heading-1">终极挑战：一个界面，三套框架，拒绝借口</h4>
<p>我做的是一个实战级别的“用户个人资料”页面，毕竟现在谁还稀罕看计数器（Counter App）啊？这玩意儿包含了：</p>
<ul>
<li><strong>真实的远程 API 调用</strong>（带报错处理的那种）；</li>
<li><strong>真正管用的本地缓存</strong>；</li>
<li><strong>不至于丑得像垃圾一样的加载状态</strong>；</li>
<li><strong>严谨的 Clean Architecture 划分</strong>（UseCases, Repositories，一个都不少）；</li>
<li><strong>不会让你想摔电脑的路由导航</strong>。</li>
</ul>
<p>同样的设计，同样的架构，同样的功能。但实现它的过程，却是三种截然不同的体验。</p>
<hr/>
<h3 data-id="heading-2">我的实测体会（那些官宣里不会告诉你的事）</h3>
<h4 data-id="heading-3">1. Flutter：真香，它是真的能干活</h4>
<p>Flutter 最让我感到莫名的爽感的一点是：它居然…真的能跑？而且是哪儿都能跑。</p>
<p>我只写了一套代码，它就能完美运行在我的 iPhone、安卓测试机，<strong>甚至</strong>是网页浏览器上，而且我还没给编译器大神“烧香”。它的 <strong>Hot Reload（热重载）</strong> 快到离谱，刚开始我甚至以为它坏了——按下保存，修改立现。没有编译等待，没有漫长加载。这种生产力，简直是纯粹的享受。</p>
<p>Clean Architecture 的搭建过程也意外地顺滑。用 <code>get_it</code> 做依赖注入？简直<strong>绝了（Chef's kiss）</strong> 。这种目录结构让你觉得，这框架的设计者是真的考虑过开发者的心路历程的。</p>
<p><strong>但反转来了：</strong> Dart 这门语言有点怪。它不差，只是…异类。如果你习惯了 Kotlin 或 Swift，你头一周肯定会反复纠结：“为什么这儿要写下划线？”以及“这个 <code>late</code> 关键字到底是个什么鬼？”</p>
<h4 data-id="heading-4">2. SwiftUI：果粉的快乐（但仅限果粉）</h4>
<p>用 SwiftUI 开发就像开特斯拉：顺滑、极具未来感，但一旦你离开了它的生态圈，偶尔会觉得心累。</p>
<p>它的声明式语法<strong>太漂亮了</strong>。真的，写下 <code>@State</code> 然后看着 UI 自动更新，简直像在施魔法。那种只加一个 <code>.animation()</code> 就能搞定动画的感觉？凌晨两点，我在空无一人的公寓里忍不住叫了声“哇塞”。</p>
<p>但在 SwiftUI 里搞 Clean Architecture，事情就开始变得“复杂”了。SwiftUI 强迫你用 Combine 或 async/await（这本身挺好），但紧接着你就要处理各种 Publishers 和 Cancellables，搞得你的 ViewModel 看起来像飞船仪表盘一样。</p>
<p><strong>最扎心的一点？</strong> 仅限 iOS（行吧，还有 macOS 和 watchOS，但你懂我意思）。你那一套漂亮的代码只能留在苹果的“后花园”里。没安卓，没网页。有的只是优雅的格调和高耸的围墙。</p>
<h4 data-id="heading-5">3. Jetpack Compose：安卓开发者的“救赎之路”</h4>
<p>如果你曾深受 XML 布局的折磨，那 Compose 就像是沙漠里的甘露。Google 终于搞清楚开发者到底想要什么了。</p>
<p><code>Composable</code> 函数写起来直观得一塌糊涂。全是 Kotlin，这意味着如果你懂 Kotlin，你就已经掌握了 70%。预览系统也很稳（前提是 Android Studio 决定配合你，不过绝大多数时候它还挺乖）。</p>
<p><strong>Clean Architecture 实现？</strong> 确实很干净。Kotlin 的协程（Coroutines）让异步操作变得非常自然。用 Hilt 做依赖注入的集成极其丝滑，你会纳闷 Google 为什么花了这么多年才开窍。</p>
<p><strong>但那头“房间里的大象”依然存在：</strong> 它目前基本只属于安卓。虽然 Compose Multiplatform 已经出来了，但咱们说实话——它还没到那种谁都能直接拿来跑生产环境的程度。你现在入坑，赌的是未来。</p>
<hr/>
<h3 data-id="heading-6">代码大对决（动真格的了）</h3>
<p>来看看这段让我直呼“好家伙”的部分：在三套框架里分别实现同一个 UseCase。</p>
<p><strong>Flutter (Dart)：</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetUserProfileUseCase</span> </span>{
  <span class="hljs-keyword">final</span> UserRepository repository;
  
  GetUserProfileUseCase(<span class="hljs-keyword">this</span>.repository);
  
  Future&lt;Result&lt;UserProfile&gt;&gt; call(<span class="hljs-built_in">String</span> userId) <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> repository.getUserProfile(userId);
  }
}
</code></pre>
<p><strong>代码点评：</strong> 干净、简洁、异步优先。这个 <code>call()</code> 方法意味着你可以像调用函数一样直接运行它。这就是典型的 Dart 范儿（Dart vibes）。</p>
<p><strong>SwiftUI (Swift)：</strong></p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">GetUserProfileUseCase</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">userId</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">UserProfile</span>
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">GetUserProfileUseCaseImpl</span>: <span class="hljs-title class_">GetUserProfileUseCase</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> repository: <span class="hljs-type">UserRepository</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-params">repository</span>: <span class="hljs-type">UserRepository</span>) {
        <span class="hljs-keyword">self</span>.repository <span class="hljs-operator">=</span> repository
    }
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">userId</span>: <span class="hljs-type">String</span>) <span class="hljs-keyword">async</span> <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">UserProfile</span> {
        <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> repository.getUserProfile(userId: userId)
    }
}
</code></pre>
<p>这个 <code>async throws</code> 写法简直美如画。Swift 的类型安全机制强得惊人，但同时也意味着会有更多模板代码（Boilerplate）。就看你更中意哪一个了（Pick your poison）。</p>
<p><strong>Compose (Kotlin)：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GetUserProfileUseCase</span> <span class="hljs-meta">@Inject</span> <span class="hljs-keyword">constructor</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) {
    <span class="hljs-keyword">suspend</span> <span class="hljs-keyword">operator</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invoke</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: Result&lt;UserProfile&gt; {
        <span class="hljs-keyword">return</span> repository.getUserProfile(userId)
    }
}
</code></pre>
<p>那个 <code>operator fun invoke</code>？简直是<strong>神来之笔（Chef's kiss）</strong> 。Kotlin 的简洁性让我的大脑极其舒适。再加上 Hilt 的 <code>@Inject</code>，依赖注入这件事变得像呼吸一样自然。</p>
<h4 data-id="heading-7">诚实豆沙包：到底什么才重要？</h4>
<p>在把同一个功能写了三遍之后，我总结出了一些能真正帮你做决定的建议：</p>
<ul>
<li>
<p><strong>选 Flutter，如果：</strong></p>
<ul>
<li>你需要快速推向多个平台。</li>
<li>你的团队懂 Dart（或者愿意学点新东西）。</li>
<li>你把开发体验和热重载（Hot Reload）看作生命线。</li>
<li>你在搞创业，恨不得昨天就能把 iOS + 安卓 + Web 版全上线。</li>
<li>你不介意 Dart 的生态没有 Swift/Kotlin 那么“国民级”。</li>
</ul>
</li>
<li>
<p><strong>选 SwiftUI，如果：</strong></p>
<ul>
<li>你只打算在苹果的生态里混。</li>
<li>你追求极致的 iOS 原生质感和性能。</li>
<li>你的团队已经是 Swift 老手了。</li>
<li>你爱“类型安全”胜过爱你的家人。</li>
<li>你能接受最低系统要求是 iOS 14+（那些老机型用户只能说声抱歉了）。</li>
</ul>
</li>
<li>
<p><strong>选 Compose，如果：</strong></p>
<ul>
<li>你是安卓优先（或者目前只做安卓）。</li>
<li>你的团队是 Kotlin 死忠粉。</li>
<li>你想逃离 XML 布局的“创伤”，拥抱现代安卓开发。</li>
<li>你愿意在 Compose Multiplatform 的未来上赌一把。</li>
<li>你非常心水 Material Design 3 那种丝滑的集成感。</li>
</ul>
</li>
</ul>
<h4 data-id="heading-8">聊聊性能（毕竟总有人爱问这个）</h4>
<p>说句实在话：<strong>对于 90% 的应用来说，性能差异几乎可以忽略不计。</strong> 你的用户发现不了，你的老板发现不了。甚至你自己也发现不了——除非你在写什么极其复杂的玩意儿。</p>
<p>但既然要比，那就拆开说：</p>
<ul>
<li><strong>Flutter：</strong> 编译成原生代码。快，丝滑的 60fps。Skia 渲染引擎已经经受了时间的考验。</li>
<li><strong>SwiftUI：</strong> iOS 亲儿子。快。有时候在优化上显得“聪明过头”了（没错，说的就是那些神秘的视图更新逻辑）。</li>
<li><strong>Compose：</strong> 安卓亲儿子。快。Kotlin 的运行时已经非常成熟且经过深度优化。 <strong>真正的性能瓶颈通常出在你的代码上，而不是框架。</strong> 很扎心，但这是事实。</li>
</ul>
<h4 data-id="heading-9">开发体验（DX）的真相</h4>
<p>有一点没人会告诉你：对于大多数项目来说，<strong>开发体验（DX）比原始性能更重要。</strong></p>
<ul>
<li><strong>Flutter 赢在：</strong> 热重载速度（真的，快到没朋友）、跨平台的一致性、极其丰富的插件生态（pub.dev 是座宝库）、文档质量（Flutter 的文档堪称行业标杆）。</li>
<li><strong>SwiftUI 赢在：</strong> IDE 集成度（Xcode 虽有槽点，但它是为 Swift 而生的）、类型安全和编译时纠错、Xcode Previews 预览（只要它不抽风）。</li>
<li><strong>Compose 赢在：</strong> Kotlin 强大的语言特性、Android Studio 的深度整合、Material Design 的官方实现、以及那种“终于永远删掉 XML 文件”的解脱感。</li>
</ul>
<h4 data-id="heading-10">社区现状（这关乎你的饭碗）</h4>
<p>聊聊找工作和社区，毕竟大家都要吃饭：</p>
<ul>
<li><strong>Flutter 岗位：</strong> 增长极快。初创公司最爱，大厂也在观望。社区极其活跃且乐于助人。FlutterFlow 甚至让很多不写代码的人也开始入坑了。</li>
<li><strong>SwiftUI 岗位：</strong> 在专注于苹果生态的公司里非常稳。想进大厂做 iOS，SwiftUI 是必修课。薪资普遍偏高，因为 iOS 开发一直自带溢价。</li>
<li><strong>Compose 岗位：</strong> 现在的安卓岗位几乎都要求会 Compose。如果你精通 Compose，你就是安卓职场上的“独角兽”。各家公司都在从 XML 迁移，急需大腿。</li>
</ul>
<h4 data-id="heading-11">我的真心推荐（我知道你们都在等这一段）</h4>
<p>如果明天要开个新项目，只能<strong>选一个</strong>？</p>
<p><strong>我会选 Flutter。</strong> 在 SwiftUI/Compose 的粉丝开喷之前，听我解释： 一套代码搞定 iOS、安卓和 Web，这个价值实在太诱人了。它的开发体验始终如一地出色，社区充满活力，插件生态也已经熟透了。说真的，光是一个“热重载”省下来的时间，就足以抵消学习 Dart 的成本了。</p>
<p><strong>但是（划重点）：</strong></p>
<ul>
<li>如果你<strong>只给 iOS 写 App</strong>？选 SwiftUI，别犹豫。</li>
<li>如果你<strong>只给安卓写 App</strong>？选 Compose，冲就完了。</li>
<li>如果你是在<strong>现有的原生 App</strong> 上修修补补？老老实实守着原有的技术栈。</li>
</ul>
<h4 data-id="heading-12">关于架构的惊喜</h4>
<p>有一点挺出乎意料：<strong>Clean Architecture 在 Kotlin/Compose 里感觉最自然。</strong> Kotlin 的语言特性（密封类、协程、数据类）跟整洁架构原则简直是天作之合。Flutter 紧随其后。而 SwiftUI 则需要你跟协议（Protocols）和类型系统进行最多的“搏斗”。 但核心结论是：<strong>这三者都能完美适配架构。</strong> 这种原则是超越框架的，不管你写的是 Dart、Swift 还是 Kotlin，你的领域层（Domain Layer）看起来都应该差不多。</p>
<h4 data-id="heading-13">这对你意味着什么？</h4>
<p>能看到这儿，你不是在摸鱼，就是真的感兴趣（或者两者都有，我懂，我也经常这样）。</p>
<p>基于这次实验，我的建议是：</p>
<ul>
<li><strong>如果你是学生/新人：</strong> 学 <strong>Flutter</strong>。练好 Dart，多动手做东西，发布到多个平台。攒一个能证明你具备“交付产品能力”的作品集。这种跨平台能力会让初创公司对你垂青有加。</li>
<li><strong>如果你是 iOS 开发：</strong> 还没学 <strong>SwiftUI</strong> 的赶紧学。但也建议你在业余项目里试试 Flutter，感受一下跨平台到底在火什么。</li>
<li><strong>如果你是安卓开发：</strong> 搞定 <strong>Compose</strong>。同时盯着点 Compose Multiplatform。未来的发展会非常有趣。</li>
<li><strong>如果你是做决策的技术 Leader：</strong> 看看你团队的技能树、项目工期和目标平台。其实选这三个里的任何一个都能做出成功的 App。<strong>框架选型的重要性，远不如团队的执行力重要。</strong></li>
</ul>
<h4 data-id="heading-14">那些让我彻夜难眠的坑</h4>
<p>分享几个我踩过的坑，希望能帮你省下几个小时：</p>
<ol>
<li><strong>状态管理：</strong> 三个框架各有 47 种管理状态的方法。我最后选了 Provider (Flutter), Observable/Combine (SwiftUI) 和 ViewModel (Compose)。都行得通，但也各有各的小脾气。</li>
<li><strong>导航：</strong> Flutter 的路由很直观；SwiftUI 的 NavigationStack 现在好多了，但以前真是折磨；Compose 的 Navigation 组件很稳，就是代码有点啰嗦。</li>
<li><strong>测试：</strong> 都支持测试，但 Flutter 的 Widget Testing 感觉最成熟。SwiftUI 的预览测试很酷。Compose 的测试最全面，但配置起来稍麻烦。</li>
</ol>
<h4 data-id="heading-15">最后的一点感言</h4>
<p>说到底，这些都只是工具。<strong>你用它们造出了什么，才最重要。</strong></p>
<p>我见过这三个框架分别写出的惊艳 App，也见过三个框架分别写出的垃圾。框架不能决定 App 的好坏，<strong>你才能。</strong></p>
<p>选一个，深挖下去。做个让人惊艳的东西。然后再去学下一个，或者干脆不学，都没问题。这里没有标准答案。</p>
<h4 data-id="heading-16">轮到你了（该你发言了）</h4>
<p>来，咱们评论区见：</p>
<ul>
<li><strong>你是 Flutter 铁粉？</strong> 用它做出了赚钱的项目？来分享一下你的故事，社区需要真实的回馈。</li>
<li><strong>刚入坑移动开发？</strong> 随便问，这里的社区氛围很友好。</li>
<li><strong>职场老司机？</strong> 传授点面试经验。你招人时最看重什么技能？</li>
<li><strong>遇到瓶颈了？</strong> 把你的烦心事说出来，没准儿评论区就有大神帮过你解决了。</li>
</ul>
<p>无论你是刚起步，还是已经发布过 10 个 App 的 Flutter 大佬——你都很棒。继续写码，继续学习。你的下一个 App 没准儿就能改变世界。</p>
<p><strong>致所有的移动开发者：</strong> 给刚入行的新人留句鼓励的话吧。大家都经历过萌新阶段，让这个圈子更温暖一点。</p>
<h4 data-id="heading-17">最后一句话</h4>
<p>我花了 72 小时做这个对比，就是为了让你不用再纠结。不管你是 Flutter 党、SwiftUI 党还是 Compose 党，我们其实都在干同一件事：做点酷的东西，让别人觉得好用。</p>
<p><strong>选好你的框架。写出整洁的代码。发布你的 App。无视那些喷子。</strong> 记住：<strong>最好的框架，是那个能让你真正把项目做完的框架。</strong></p>
<p>别看了，快去写代码吧！🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java 21虚拟线程实战：从百万级并发瓶颈到性能提升300%的架构演进]]></title>    <link>https://juejin.cn/post/7589170021931843599</link>    <guid>https://juejin.cn/post/7589170021931843599</guid>    <pubDate>2025-12-30T00:17:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589170021931843599" data-draft-id="7589110783147556898" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java 21虚拟线程实战：从百万级并发瓶颈到性能提升300%的架构演进"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-30T00:17:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java 21虚拟线程实战：从百万级并发瓶颈到性能提升300%的架构演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:17:41.000Z" title="Tue Dec 30 2025 00:17:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Java 21虚拟线程实战：从百万级并发瓶颈到性能提升300%的架构演进</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>在当今高并发的互联网时代，传统的线程模型已成为许多Java应用的性能瓶颈。随着Java 21的发布，虚拟线程（Virtual Threads）作为Project Loom的核心成果正式落地，为JVM并发编程带来了革命性的改变。本文将深入剖析虚拟线程的技术原理，结合真实场景下的百万级并发挑战，展示如何通过架构演进实现300%的性能提升。</p>
<hr/>
<h3 data-id="heading-2">一、传统线程模型的瓶颈</h3>
<h4 data-id="heading-3">1.1 平台线程的局限性</h4>
<p>Java长期以来依赖的平台线程（OS线程）存在两大硬伤：</p>
<ul>
<li><strong>资源消耗大</strong>：每个线程默认占用1MB栈内存，万级并发就需要GB级内存。</li>
<li><strong>上下文切换成本高</strong>：操作系统调度器需要处理线程切换，当竞争激烈时可能消耗30%以上的CPU时间。</li>
</ul>
<h4 data-id="heading-4">1.2 典型问题场景</h4>
<p>在某电商平台的秒杀系统中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">2000</span>); <span class="hljs-comment">// 达到OS线程数上限</span>
</code></pre>
<p>即便使用异步编程（如CompletableFuture），回调地狱和调试困难问题依然存在。</p>
<hr/>
<h3 data-id="heading-5">二、虚拟线程的技术突破</h3>
<h4 data-id="heading-6">2.1 JVM层面的协程实现</h4>
<p>虚拟线程的本质是<strong>由JVM管理的轻量级用户态线程</strong>：</p>
<ul>
<li><strong>1:1调度模型</strong>：M个虚拟线程运行在N个平台线程上（M &gt;&gt; N）</li>
<li><strong>挂起/恢复由JVM控制</strong>：通过Continuation实现执行流的保存与恢复</li>
</ul>
<h4 data-id="heading-7">2.2 关键性能指标对比</h4>

























<table><thead><tr><th>指标</th><th>平台线程</th><th>虚拟线程</th></tr></thead><tbody><tr><td>创建时间</td><td>~1ms</td><td>~0.01ms</td></tr><tr><td>内存占用</td><td>~1MB</td><td>~200KB</td></tr><tr><td>上下文切换成本</td><td>OS调度</td><td>JVM优化</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-8">三、实战：百万并发架构演进</h3>
<h4 data-id="heading-9">3.1 原始架构痛点分析</h4>
<p>某金融交易系统原有设计：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Blocking I/O + Thread-per-request</span>
<span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">socket</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerSocket</span>(<span class="hljs-number">8080</span>)) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-type">var</span> <span class="hljs-variable">clientSocket</span> <span class="hljs-operator">=</span> socket.accept();
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; handleRequest(clientSocket)).start(); <span class="hljs-comment">// ❌ OOM风险</span>
    }
}
</code></pre>
<p>实测数据：8000并发时延迟飙升到5s+，CPU利用率仅40%。</p>
<h4 data-id="heading-10">3.2 迁移到虚拟线程的三阶段</h4>
<h5 data-id="heading-11"><strong>阶段一：直接替换</strong></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> Executors.newVirtualThreadPerTaskExecutor()) {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-type">var</span> <span class="hljs-variable">clientSocket</span> <span class="hljs-operator">=</span> socket.accept();
        executor.submit(() -&gt; handleRequest(clientSocket)); <span class="hljs-comment">// ✅</span>
    }
}
</code></pre>
<p>效果：支持10万并发连接，内存消耗降低87%。</p>
<h5 data-id="heading-12"><strong>阶段二：结构化并发</strong></h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">try</span> (<span class="hljs-type">var</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StructuredTaskScope</span>.ShutdownOnFailure()) {
    Future&lt;String&gt; user = scope.fork(() -&gt; queryUser(userId));
    Future&lt;Order&gt; order = scope.fork(() -&gt; queryOrder(orderId));
    scope.join();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(user.get(), order.get());
}
</code></pre>
<p>优势：</p>
<ul>
<li><strong>强化的错误传播</strong></li>
<li><strong>取消语义自动化</strong></li>
</ul>
<h5 data-id="heading-13"><strong>阶段三：全异步整合</strong></h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> result = virtualThreadScope {
    <span class="hljs-keyword">val</span> userDeferred = async { queryUser(userId) }
    <span class="hljs-keyword">val</span> orderDeferred = async { queryOrder(orderId) }
    UserOrderResponse(userDeferred.await(), orderDeferred.await())
}
</code></pre>
<h4 data-id="heading-14">3.3 Final性能对比</h4>




















<table><thead><tr><th>QPS</th><th>P99延迟</th><th>CPU利用率</th></tr></thead><tbody><tr><td>Before:12k</td><td>&gt;2s</td><td>≤50%</td></tr><tr><td>After:36k</td><td>~200ms</td><td>≥85%</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-15">四、深度优化实践</h3>
<h4 data-id="heading-16">4.1 Pinpoint陷阱规避</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">synchronized</span>(lockObj) { 
    <span class="hljs-comment">// ❌会pin住载体线程 </span>
}
</code></pre>
<p>解决方案：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
lock.lock(); <span class="hljs-comment">// ✅可通过jdk.tracePinnedThreads检测</span>
<span class="hljs-keyword">try</span> { <span class="hljs-comment">/* ... */</span> } <span class="hljs-keyword">finally</span> { lock.unlock(); }
</code></pre>
<h4 data-id="heading-17">4.2 Carrier Thread调优建议</h4>
<pre><code class="hljs language-bash" lang="bash">-Djdk.virtualThreadScheduler.parallelism=32 <span class="hljs-comment">#匹配物理核心数 </span>
-Djdk.virtualThreadScheduler.maxPoolSize=256
</code></pre>
<h4 data-id="heading-18">4.3 JFR监控增强</h4>
<p><img src="https://example.com/jfr-screenshot.png" alt="Virtual Threads in JDK Flight Recorder" loading="lazy"/></p>
<hr/>
<p>###五、适用场景与限制</p>
<p>####5.1黄金场景<br/>
✅计算密集型但包含阻塞操作<br/>
✅高并发I/O服务（HTTP/gRPC/DB访问）<br/>
✅需要简化异步代码的场景</p>
<p>####5.2不适用情况<br/>
❌纯CPU计算无阻塞操作<br/>
❌需要精细控制物理核心的任务</p>
<hr/>
<p>###六、未来展望<br/>
随着Java22对结构化并发的进一步强化，以及Valhalla项目带来的值类型支持，"每请求一个虚拟线程"可能成为新的服务端开发范式。建议关注：
1.Scoped Values（JEP429）替代ThreadLocal<br/>
2.Vector API与虚拟线程的协同优化</p>
<hr/>
<p>###总结<br/>
Java21虚拟 threads从根本上重构了JVM的并发模型。通过本文的真实案例可以看到，合理运用该特性能在保持同步编程模型直观性的同时，实现数量级的性能突破。技术团队现在就应该开始评估现有系统的适配改造路径——这已不仅是性能优化问题，更是关乎开发效率的革命性升级。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android 一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计]]></title>    <link>https://juejin.cn/post/7589126920286945290</link>    <guid>https://juejin.cn/post/7589126920286945290</guid>    <pubDate>2025-12-30T00:28:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286945290" data-draft-id="7588022226739101746" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android   一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计"/> <meta itemprop="keywords" content="Android,面试,前端"/> <meta itemprop="datePublished" content="2025-12-30T00:28:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏程十八少"/> <meta itemprop="url" content="https://juejin.cn/user/184373685534077"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android   一套代码适配车机/手机横竖屏？看我如何用搞定小米、比亚迪、蔚来、理想、多品牌架构设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/184373685534077/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏程十八少
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:28:23.000Z" title="Tue Dec 30 2025 00:28:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.需求：(3种车机/手机UI切换)</h2>
<p>Android 新能源车机，手机竖屏，手机横屏3种情况的UI, 数据来源有多个，分不同的品牌，有小米，蔚来，理想，比亚迪，大部分相同，仅仅有一点差别</p>
<h2 data-id="heading-1">2.方案：(抽象工厂+策略模式)</h2>
<p>为了满足 <strong>Android 车机、手机竖屏、手机横屏</strong> 三种 UI 场景下使用 <strong>同一份数据源（DataManager）</strong> ，且 <strong>不同品牌间数据结构基本一致、仅少量差异</strong> 的需求，我们可以采用以下设计原则：</p>
<ul>
<li><strong>单一数据源</strong>：<code>DataManager</code> 提供统一接口。</li>
<li><strong>策略模式 / 工厂模式</strong>：根据设备类型和品牌动态提供适配器或视图模型。</li>
<li><strong>低耦合 + 高扩展性</strong>：UI 层不直接依赖具体品牌逻辑，而是通过抽象接口获取数据。</li>
</ul>
<p>根据需求，这里采用MVP模式+抽象工厂+策略模式来处理不同品牌和设备的UI差异：</p>
<h2 data-id="heading-2">3.架构图</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3940ed6e2e9045bd8e0396a1e09b0aff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bmP56iL5Y2B5YWr5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659302&amp;x-signature=O988NSBMuIlX1MSL6jcAFLFu%2FKo%3D" alt="车机和手机.png" loading="lazy"/></p>
<h2 data-id="heading-3">4.主要的代码</h2>
<p>因为公司的保密问题，把核心的思想分析成一个demo！如下：</p>
<h4 data-id="heading-4">🔹 数据层：统一接口</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">/**
 * 品牌数据统一接口（IBrandData）
 * 所有新能源汽车品牌必须实现此接口，保证上层调用一致性
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title">IBrandData</span> {
    <span class="hljs-function">String <span class="hljs-title">getCommonField</span>()</span>;        <span class="hljs-comment">// 通用信息（如续航、车型）</span>
    <span class="hljs-function">String <span class="hljs-title">getBrandSpecificField</span>()</span>; <span class="hljs-comment">// 品牌特有功能（如换电、生态互联等）</span>
}
</code></pre>
<hr/>
<h4 data-id="heading-5">🚗 数据层实现：四个品牌（小米、蔚来、理想、比亚迪）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/** 小米汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">XiaomiBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"小米SU7 通用信息：800V高压平台，CLTC续航800km"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"小米澎湃OS生态互联：手机-车机无缝流转"</span>;
    }
}

<span class="hljs-comment">/** 蔚来汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">NIOBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"蔚来ET5 通用信息：双电机四驱，换电兼容"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"蔚来换电站 + NOMI智能情感引擎"</span>;
    }
}

<span class="hljs-comment">/** 理想汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LiAutoBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"理想L系列 通用信息：家庭六座SUV，增程电动"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"城市NOA + 增程式无里程焦虑"</span>;
    }
}

<span class="hljs-comment">/** 比亚迪汽车数据 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BYDBrandData</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IBrandData</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getCommonField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"比亚迪汉EV 通用信息：刀片电池，e平台3.0"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getBrandSpecificField</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"云辇智能车身控制系统 + DiLink生态"</span>;
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-6">📱 设备类型 &amp; UI 策略（保持不变，仅微调注释）</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 设备类型枚举：用于区分 UI 渲染上下文
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> DeviceType {
    CAR,                <span class="hljs-comment">// 车载中控（大屏、驾驶安全优先）</span>
    PHONE_PORTRAIT,     <span class="hljs-comment">// 手机竖屏（信息精简）</span>
    PHONE_LANDSCAPE     <span class="hljs-comment">// 手机横屏（信息完整展示）</span>
}

<span class="hljs-comment">/**
 * UI 渲染策略接口：不同设备使用不同展示逻辑
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IUiStrategy</span> {
    void render(IBrandData <span class="hljs-keyword">data</span>);
}

<span class="hljs-comment">// 具体策略实现（略，同你原有代码，仅接口名改为 IBrandData）</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CarUiStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[CAR] "</span> + <span class="hljs-keyword">data</span>.getCommonField() + <span class="hljs-string">" | "</span> + <span class="hljs-keyword">data</span>.getBrandSpecificField());
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PhonePortraitStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[PHONE-PORTRAIT] "</span> + <span class="hljs-keyword">data</span>.getCommonField());
    }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneLandscapeStrategy</span> <span class="hljs-title">implements</span> <span class="hljs-title">IUiStrategy</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void render(IBrandData <span class="hljs-keyword">data</span>) {
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-string">"[PHONE-LANDSCAPE] "</span> + <span class="hljs-keyword">data</span>.getCommonField() + <span class="hljs-string">" + "</span> + <span class="hljs-keyword">data</span>.getBrandSpecificField());
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-7">🧩 数据管理器（DataManager）—— 支持四大品牌</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.function.Supplier;

<span class="hljs-comment">/**
 * 数据管理器：统一入口，按品牌返回对应数据
 * 使用工厂注册机制，支持动态扩展
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataManager</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Map&lt;String, Supplier&lt;IBrandData&gt;&gt; BRAND_FACTORY = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();

    <span class="hljs-keyword">static</span> {
        BRAND_FACTORY.put(<span class="hljs-string">"xiaomi"</span>, XiaomiBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"nio"</span>, NIOBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"liauto"</span>, LiAutoBrandData::<span class="hljs-keyword">new</span>);
        BRAND_FACTORY.put(<span class="hljs-string">"byd"</span>, BYDBrandData::<span class="hljs-keyword">new</span>); <span class="hljs-comment">// ✅ 新增比亚迪</span>
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String brand;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataManager</span><span class="hljs-params">(String brand)</span> {
        <span class="hljs-built_in">this</span>.brand = brand.toLowerCase();
    }

    <span class="hljs-keyword">public</span> IBrandData <span class="hljs-title function_">getBrandData</span><span class="hljs-params">()</span> {
        Supplier&lt;IBrandData&gt; factory = BRAND_FACTORY.get(brand);
        <span class="hljs-keyword">if</span> (factory == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"不支持的品牌: "</span> + brand + <span class="hljs-string">"。支持: "</span> + BRAND_FACTORY.keySet());
        }
        <span class="hljs-keyword">return</span> factory.get();
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-8">🔗 UI 协调器（核心适配器）</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * UI 协调器：组合品牌数据 + 设备策略
 * 是 MVP 中 Presenter 层的理想载体
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiCoordinator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DataManager dataManager;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IUiStrategy uiStrategy;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">UiCoordinator</span><span class="hljs-params">(<span class="hljs-type">String</span> brand, DeviceType deviceType)</span> </span>{
        <span class="hljs-keyword">this</span>.dataManager = <span class="hljs-keyword">new</span> <span class="hljs-built_in">DataManager</span>(brand);
        <span class="hljs-keyword">this</span>.uiStrategy = <span class="hljs-built_in">createStrategy</span>(deviceType);
    }

    <span class="hljs-function"><span class="hljs-keyword">private</span> IUiStrategy <span class="hljs-title">createStrategy</span><span class="hljs-params">(DeviceType type)</span> </span>{
        <span class="hljs-keyword">switch</span> (type) {
            <span class="hljs-keyword">case</span> CAR: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">CarUiStrategy</span>();
            <span class="hljs-keyword">case</span> PHONE_PORTRAIT: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PhonePortraitStrategy</span>();
            <span class="hljs-keyword">case</span> PHONE_LANDSCAPE: <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PhoneLandscapeStrategy</span>();
            <span class="hljs-keyword">default</span>: <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">IllegalStateException</span>(<span class="hljs-string">"未知设备类型: "</span> + type);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">display</span><span class="hljs-params">()</span> </span>{
        IBrandData data = dataManager.<span class="hljs-built_in">getBrandData</span>();
        uiStrategy.<span class="hljs-built_in">render</span>(data);
    }
}
</code></pre>
<hr/>
<h4 data-id="heading-9">🖥️ 主程序（测试入口）</h4>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Main</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"><span class="hljs-built_in">String</span>[] args</span>) {
        <span class="hljs-title class_">String</span>[] brands = {<span class="hljs-string">"xiaomi"</span>, <span class="hljs-string">"nio"</span>, <span class="hljs-string">"liauto"</span>, <span class="hljs-string">"byd"</span>}; <span class="hljs-comment">// ✅ 包含比亚迪，不含小鹏</span>
        <span class="hljs-title class_">DeviceType</span>[] devices = {<span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">CAR</span>, <span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">PHONE_PORTRAIT</span>, <span class="hljs-title class_">DeviceType</span>.<span class="hljs-property">PHONE_LANDSCAPE</span>};

        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">String</span> brand : brands) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"🔹 品牌: "</span> + brand.<span class="hljs-title function_">toUpperCase</span>());
            <span class="hljs-keyword">for</span> (<span class="hljs-title class_">DeviceType</span> device : devices) {
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">UiCoordinator</span>(brand, device).<span class="hljs-title function_">display</span>();
            }
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">✅ 最终架构图</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span>
<span class="hljs-operator">|</span>   UI 展示层 (<span class="hljs-keyword">View</span>)  <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> Activity<span class="hljs-operator">/</span>Fragment <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> 根据配置调用      <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span>   UiCoordinator     <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+----------+</span>
           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------v----------+</span>
<span class="hljs-operator">|</span>  适配层 (Presenter) <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> UiCoordinator     <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> IUiStrategy       <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> DeviceType        <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------+----------+</span>
           <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">----------v----------+</span>
<span class="hljs-operator">|</span>    数据层 (Model)   <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> DataManager       <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> IBrandData        <span class="hljs-operator">|</span>
<span class="hljs-operator">|</span> <span class="hljs-operator">-</span> Xiaomi<span class="hljs-operator">/</span>NIO<span class="hljs-operator">/</span>Li<span class="hljs-operator">/</span>BYD <span class="hljs-operator">|</span>
<span class="hljs-operator">+</span><span class="hljs-comment">---------------------+</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">5 .设计要点说明总结：</h2>



































<table><thead><tr><th>特性</th><th>实现方式</th><th>优势</th></tr></thead><tbody><tr><td><strong>品牌扩展</strong></td><td><code>BRAND_FACTORY</code> 注册</td><td>新增品牌只需加一行</td></tr><tr><td><strong>设备适配</strong></td><td><code>DeviceType</code> + 策略模式</td><td>横竖屏/车机自动切换</td></tr><tr><td><strong>低耦合</strong></td><td>全程依赖接口（<code>IBrandData</code>, <code>IUiStrategy</code>）</td><td>易测试、易替换</td></tr><tr><td><strong>MVP友好</strong></td><td><code>UiCoordinator</code> ≈ Presenter</td><td>业务逻辑与 View 分离</td></tr><tr><td><strong>健壮性</strong></td><td>非法品牌抛出明确异常</td><td>快速定位配置错误</td></tr></tbody></table>
<ol>
<li>
<p><strong>数据层</strong>：</p>
<ul>
<li><code>DataManager</code>单例管理数据，通过策略模式处理品牌差异</li>
<li><code>IBrandDataStrategy</code>接口允许灵活扩展新品牌</li>
</ul>
</li>
<li>
<p><strong>UI层</strong>：</p>
<ul>
<li>抽象工厂模式创建不同设备类型的视图</li>
<li>每种设备类型有基类视图，品牌再继承实现差异</li>
<li>支持屏幕旋转自动适配</li>
</ul>
</li>
<li>
<p><strong>业务层</strong>：</p>
<ul>
<li>MVP模式分离业务逻辑</li>
<li>不同设备类型可有特定Presenter</li>
</ul>
</li>
<li>
<p><strong>扩展性</strong>：</p>
<ul>
<li>新增品牌：实现<code>IBrandDataStrategy</code>和<code>IUIFactory</code></li>
<li>新增设备类型：添加<code>DeviceType</code>枚举和对应视图</li>
<li>数据变化：观察者模式通知更新</li>
</ul>
</li>
<li>
<p><strong>低耦合</strong>：</p>
<ul>
<li>依赖接口而非实现</li>
<li>各层之间通过接口通信</li>
<li>配置集中管理</li>
</ul>
</li>
</ol>
<h3 data-id="heading-12">5.2  设计模式应用总结</h3>
<h4 data-id="heading-13">5.2.1. 策略模式 (Strategy Pattern)</h4>
<ul>
<li><strong>应用</strong>: <code>IUiStrategy</code> 接口 + 具体策略类</li>
<li><strong>目的</strong>: 根据不同设备类型切换UI渲染逻辑</li>
<li><strong>优势</strong>: 易于扩展新设备类型，符合开闭原则</li>
</ul>
<h4 data-id="heading-14">5.2.2. 工厂模式 (Factory Pattern)</h4>
<ul>
<li><strong>应用</strong>: <code>DataManager</code> 中的品牌工厂注册表</li>
<li><strong>目的</strong>: 统一创建品牌数据对象</li>
<li><strong>优势</strong>: 集中管理对象创建，支持动态注册</li>
</ul>
<h4 data-id="heading-15">5.2.3. 接口隔离原则 (Interface Segregation)</h4>
<ul>
<li><strong>应用</strong>: <code>IBrandData</code> 只定义必要方法</li>
<li><strong>目的</strong>: 品牌实现类只实现需要的方法</li>
<li><strong>优势</strong>: 避免接口臃肿，提高灵活性</li>
</ul>
<h4 data-id="heading-16">5.2.4. 依赖倒置原则 (Dependency Inversion)</h4>
<ul>
<li><strong>应用</strong>: 高层模块依赖抽象接口而非具体实现</li>
<li><strong>目的</strong>: 降低模块间耦合度</li>
<li><strong>优势</strong>: 提高代码可测试性和可维护性</li>
</ul>
<p>这个架构支持灵活扩展新品牌和设备类型，同时保持代码的可维护性和可测试性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面]]></title>    <link>https://juejin.cn/post/7589171972446289962</link>    <guid>https://juejin.cn/post/7589171972446289962</guid>    <pubDate>2025-12-30T00:33:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589171972446289962" data-draft-id="7589176150493036598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面"/> <meta itemprop="keywords" content="程序员,AI编程"/> <meta itemprop="datePublished" content="2025-12-30T00:33:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="古时的风筝"/> <meta itemprop="url" content="https://juejin.cn/user/501033035374045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我把微信读书年度报告扔给AI，AI挖掘出了我不为人知的一面
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035374045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    古时的风筝
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:33:42.000Z" title="Tue Dec 30 2025 00:33:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;color:#282d36}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px;color:#2f845e}.markdown-body h2{font-size:22px;display:inline-block;font-weight:700;background:#2f845e;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(47,132,194,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 32px);border-bottom:3px solid #2f845e}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%;box-shadow:6px 6px 6px #888}.markdown-body hr{border:none;border-top:1px solid rgba(66,185,131,.15);margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:16px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#262626;border:1px solid #2f845e;border-top:8px solid #2f845e;background:linear-gradient(180deg,rgba(66,185,131,.1),transparent)!important}.markdown-body pre&gt;code.hljs[lang]:before{top:8px!important;color:#2f845e!important}.markdown-body pre&gt;code.language-awesome_error{border:1px solid #ff4d4f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ff4d4f!important;background:#fff2f0!important}.markdown-body pre&gt;code.language-awesome_error:before{content:"!"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ff4d4f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_warn{border:1px solid #ffc46f!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#ffc46f!important;background:#fffbe6!important}.markdown-body pre&gt;code.language-awesome_warn:before{content:"☂"!important;position:absolute;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#ffc46f!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_success{border:1px solid #52c41a!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#52c41a!important;background:#f6ffed!important}.markdown-body pre&gt;code.language-awesome_success:before{content:"✓"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#52c41a!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body pre&gt;code.language-awesome_info{border:1px solid #1890ff!important;border-left-width:8px;font-size:14px;font-weight:700;padding:15px 12px 15px 16px;margin:0;word-break:normal;white-space:break-spaces;display:block;overflow-x:auto;color:#1890ff!important;background:#e6f7ff!important}.markdown-body pre&gt;code.language-awesome_info:before{content:"i"!important;position:absolute!important;top:50%!important;left:-9px!important;transform:translateY(-14px)!important;background:#1890ff!important;color:#fff!important;border:2px solid #fff!important;display:flex;align-items:center;justify-content:center;width:22px;height:22px;border-radius:100%;font-weight:700;font-family:Dosis,Source Sans Pro,Helvetica Neue,Arial,sans-serif;font-size:16px}.markdown-body strong{background-color:inherit;color:#2f845e}.markdown-body em{background-color:inherit;color:#949415}.markdown-body a{text-decoration:none;color:#2f8e54;border-bottom:1px solid #3f9e64}.markdown-body a:active,.markdown-body a:hover{color:#3f9e64}.markdown-body a[class^=footnote]{margin-left:4px}.markdown-body a:before{content:"➤ "}.markdown-body table{font-size:12px;width:100%;max-width:100%;overflow:auto;border:2px solid #2f8e54}.markdown-body thead{background:#2f8e54;color:#fff;text-align:left;font-weight:700}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:22px}.markdown-body td{min-width:120px}.markdown-body blockquote{padding:1px 22px;margin:22px 0;border-left:6px solid #2f845e;background-color:rgba(66,185,131,.1);border-radius:2px}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#2f845e}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px;color:#282d36}.markdown-body del{color:#2f845e}.markdown-body input[type=checkbox]:checked:before{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/klEQVQ4T72TMU7DQBBF318XdFR06egQEnAXRINEGlqgowoIR8AF4AZOZ4JEGq5AC5EixBU4A55BNrEVHAcSBTHlaubt37/zxZKlcn7n6mDPXJvz8IJ89HzWu8t7C8D2dfsY52ae4apHnLx0ktsCsHXZjiUuFgG40x2eJ/H/AhztB+zDUTpLwWj8jGkzxSHiHaMPrDQC8sMoilKzLAUqiKQjmb+ZuAdW80tmelCHODoNgSfP7AFprTTaRTzsJN1GEyuIZ7uW6TEEHwCtyV/6EVBKJHhfzgC0Xv/iXwEFBF4FG0378bd7sPQq5xK/hSnk6sdlX3mZrKkwLZKBeu8n9XuWEUE7X+YAAAAASUVORK5CYII=);position:relative;top:-1px;left:-1px}.markdown-body .math .katex{font-family:Menlo,Monaco,Consolas,Courier New,monospace;word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#f6ffed;color:#52c41a;font-size:.87em;padding:.065em .4em}@media (max-width:720px){.markdown-body h1{font-size:22px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>🍄  <strong>大家好，我是风筝</strong></p>
<p>🌍 个人博客：【<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.moonkite.cn" target="_blank" title="https://www.moonkite.cn" ref="nofollow noopener noreferrer">古时的风筝</a>】。</p>
<p>本文目的为个人学习记录及知识分享。如果有什么不正确、不严谨的地方请及时指正，不胜感激。</p>
<p>每一个赞都是我前进的动力。</p>
</blockquote>
<p>微信读书可能是我唯一一款连续订阅年度会员的应用，就为了微信读书App，还专门买了个汉王阅读器。</p>
<p>可惜买了之后基本没用过。为啥呢？因为听书的时间超过读书了。</p>
<p>坐地铁、做饭、刷碗是我的三大高频听书场景。</p>
<p>这不一年马上又过去了吗，又到了年终撤回年初立的flag的时候了，微信读书也发布了年度读书报告。</p>
<p>赶紧上去看一眼，这一年到底读了个啥。（现在打开微信读书APP在首页就能看到）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed8497db48e5409c90db5edbc311d8a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=HIJxD82UCRS1sFqdq6zs4AXNUqI%3D" alt="" loading="lazy"/></p>
<p>好家伙，读了116本，读完了4本，写了3条笔记，怪不得AI说我极度功利呢，确实大部分是工具书。</p>
<p>但是也得自证一下，读完4本倒是不至于，这是因为微信读书关于“读完”的统计，只有读到了最后一页，出现“读完了”页面，或者手动点“读完了”才被算作是读完。</p>
<p>但是不爱记笔记是真的。</p>
<p>说回年度报告，我觉得这个报告不够深刻，所以我决定交给 AI 帮我深度挖掘一下，看能不能挖出什么狠料。</p>
<p>于是我写了一套提示词，让AI从经济学、心理学、哲学、文学角度帮我挖掘一下我的这种读书方式和读书内容背后，藏着什么更深层次的东西。</p>
<p>并请教孔子和亚里士多德这两位中西方的大文豪，问一问他们对我有什么评价和建议。</p>
<p>下面是完整的提示词，那么如何使用呢？</p>
<p>因为微信读书报告没办法直接读取，所以只能截图，把每一页都截下来，然后从第3页开始（前两页用处不大），一直截取10张。</p>
<p>把这10张图和下面的提示词发给大模型。</p>
<p>我是自己是用的 Gemini，其他大模型也没什么 问题。</p>
<p>如果你也用 Gemini 的话，我做好了一个 Gem，可以通过下面的链接直接访问，上传10张图片，然后点击发送按钮就可以直接出报告了。</p>
<p>链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fgem%2F1Qvzi5XEQqmd2Q7cB9Ub0XEoM9HaIitBd%3Fusp%3Dsharing" target="_blank" title="https://gemini.google.com/gem/1Qvzi5XEQqmd2Q7cB9Ub0XEoM9HaIitBd?usp=sharing" ref="nofollow noopener noreferrer">gemini.google.com/gem/1Qvzi5X…</a></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"profile"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"role"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"首席精神世界架构师 &amp; 跨学科人类观察员"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"identities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"行为经济学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"深度心理学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"存在主义哲学家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"毒舌文学评论家"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"历史人物灵媒 (孔子 &amp; 亚里士多德)"</span>
    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"tone"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"primary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"一针见血、幽默犀利、智性浪漫"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"secondary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"古典与现代交织"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"objective"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"图片中我最近一年的年度阅读数据，基于这份报告，生成深度诊断报告及跨时空哲学点评。"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"analysis_framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"step_1_data_extraction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"提取关键数据（阅读量、完读率、时长、特殊时间点）。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_2_behavioral_economics"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"分析阅读习惯背后的ROI逻辑。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_3_psychological_profiling"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"通过书单与时间点推测内心状态。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_4_philosophical_review"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"模拟孔子与亚里士多德的思维方式，对用户的精神状态进行高维点评。"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"step_5_synthesis"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"生成年度判词与书单。"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"output_structure"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"format"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Markdown"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"sections"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"intro"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🎯 核心定调：年度关键词"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"macro_analysis"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🏛️ 宏观数据画像"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"timeline_analysis"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🧠 时间轴心理侧写"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"deep_insight"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"🔍 深度好玩儿的洞察"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"philosophical_dialogue"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"📜 跨时空新年寄语：圣贤的审视"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
          <span class="hljs-attr">"confucius"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"扮演孔子。关注'学与思'的关系、修身养性、以及读书是否为了'仁'。用半文半白的语调，点评用户的阅读焦虑与功利性，并给出君子之道的建议。"</span><span class="hljs-punctuation">,</span>
          <span class="hljs-attr">"aristotle"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"扮演亚里士多德。关注'理性'、'中道'与'幸福(Eudaimonia)'。点评用户的知识分类（物理/文学/商业），讨论这种阅读方式是否能达成人类的终极目的，强调理性与感性的平衡。"</span>
        <span class="hljs-punctuation">}</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"conclusion_recommendation"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"💡 年度总评与毒舌建议"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"content"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"..."</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>AI 会全方面诊断，然后给出详细的报告。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1fd49b20af1f45a5b99f07e837d5a91e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=7FRpGxL3ATzURvrI%2FsFOYC4PdDo%3D" alt="" loading="lazy"/></p>
<p>还可以让AI给出一份详细的2026年书单。</p>
<p>我的报告一出来，AI说我这一年是做了一个“宏大的烂尾工程”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3dc8f7a2ee2346d09e056646e7ae9510~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=r1kkbh%2FzK4s6unRGS5rFvTY1iHk%3D" alt="" loading="lazy"/></p>
<p><strong>孔子和亚里士多德也给了我诚恳的忠告，孔夫子劝我“韦编三绝”，不必贪多。</strong></p>
<p><strong>亚里士多德让我去释放激情，切身体会。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec5878a154df426b8b73d1cdc3f4308c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=uRpPUye3q73dkk22ZKdfKkF9nF0%3D" alt="" loading="lazy"/></p>
<p>AI给我的年度判词是：</p>
<blockquote>
<p>一个用理性铠甲把自己武装到牙齿，却在深夜通过文学作品偷偷流泪的矛盾综合体。你试图看透这个世界的底牌（物理、历史、脑科学），却依然被这世界最朴素的情感（生死、人生）所牵绊。</p>
</blockquote>
<p>另外，<strong>还可以用下面这个提示词，将报告做成一份可视化的网页。</strong></p>
<blockquote>
<p>将以上2025年度阅读诊断报告做成一个和报告一一对应的、详细的可视化网页分析报告，一一展现，不要遗漏</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdbb3a4fb7744285ba2ddc773c8f27da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y-k5pe255qE6aOO562d:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659622&amp;x-signature=SIhP14YaRd9f6N%2BvP8JfE5QGh2k%3D" alt="" loading="lazy"/></p>
<p><strong>苏格拉底留下的千古难题：“认识你自己”。</strong></p>
<p>我们曾试图通过阅读、旅行和生活去拼凑答案。</p>
<p>而现在，有了AI ，可以站在全知的旁观者角度，帮我们挖掘更深层的自己，虽然不可能完全正确。</p>
<p>当你看着这份报告，看着那个被AI刻画的“一部分自己”，可能你沉睡已久的某个部分会被突然击中，甚至被点亮。</p>
<p>去试试吧，也许你会和我一样，在屏幕前惊呼：原来如此！又或者不屑地说：什么玩意！</p>
<p>不重要了。</p>
<p><strong>还可以看看风筝往期文章</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449474176%26idx%3D1%26sn%3D6b14e61551641921e3ad9fb17b6dcde0%26chksm%3D8c434ce7bb34c5f1f8aad31bb537aed5ba068773583ec17020770a919b75462f0aa1dc21a5ab%26token%3D1083800749%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449474176&amp;idx=1&amp;sn=6b14e61551641921e3ad9fb17b6dcde0&amp;chksm=8c434ce7bb34c5f1f8aad31bb537aed5ba068773583ec17020770a919b75462f0aa1dc21a5ab&amp;token=1083800749&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">用这个方法，免费、无限期使用 SSL(HTTPS)证书，从此实现证书自由了</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F4cJ3g1GlenQJ9UifyXH0Kg" target="_blank" title="https://mp.weixin.qq.com/s/4cJ3g1GlenQJ9UifyXH0Kg" ref="nofollow noopener noreferrer">为什么我每天都记笔记，主要是因为我用的这个笔记软件太强大了，强烈建议你也用起来</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472490%26idx%3D1%26sn%3Dda10b436d1f8123149316dac76a618aa%26chksm%3D8fbcb58db8cb3c9ba481b7d095966abb86ff7d1a45a771aad191991db65cd6e384a557a40ec4%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472490&amp;idx=1&amp;sn=da10b436d1f8123149316dac76a618aa&amp;chksm=8fbcb58db8cb3c9ba481b7d095966abb86ff7d1a45a771aad191991db65cd6e384a557a40ec4&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">「差生文具多系列」最好看的编程字体</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449473008%26idx%3D1%26sn%3Dc8f8d9c9675571ea1a42c13b1af9b6e7%26chksm%3D8fbcb397b8cb3a81f3c6c55eb398c0599128f18b9bbdae87965cd40ef519dad3394649426d1e%26token%3D1044263965%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449473008&amp;idx=1&amp;sn=c8f8d9c9675571ea1a42c13b1af9b6e7&amp;chksm=8fbcb397b8cb3a81f3c6c55eb398c0599128f18b9bbdae87965cd40ef519dad3394649426d1e&amp;token=1044263965&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">我患上了空指针后遗症</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449473057%26idx%3D1%26sn%3D2170397d6bab5ad0a6d6427f77584df2%26chksm%3D8fbcb046b8cb3950d1784fe29bc7776cb0c71868acba36a47d60b41bc8a60959303082b0ee2a%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449473057&amp;idx=1&amp;sn=2170397d6bab5ad0a6d6427f77584df2&amp;chksm=8fbcb046b8cb3950d1784fe29bc7776cb0c71868acba36a47d60b41bc8a60959303082b0ee2a&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">一千个微服务之死</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472966%26idx%3D1%26sn%3Da272a9df52ae18cc9a6163732b37c5d8%26chksm%3D8fbcb3a1b8cb3ab7857a88adc8a2e6d28bb6f2316df501f5f8e6fc487794f3b34f77829b4b94%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472966&amp;idx=1&amp;sn=a272a9df52ae18cc9a6163732b37c5d8&amp;chksm=8fbcb3a1b8cb3ab7857a88adc8a2e6d28bb6f2316df501f5f8e6fc487794f3b34f77829b4b94&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">搭建静态网站竟然有这么多方案，而且还如此简单</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzAxMjA0MDk2OA%3D%3D%26mid%3D2449472616%26idx%3D1%26sn%3Da41a420933f9af7f88af0759eb75f815%26chksm%3D8fbcb20fb8cb3b1969433e2468523234552562e504f3a12c8c1a2a012cff7fd1422e6dd48723%26token%3D1977984185%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzAxMjA0MDk2OA==&amp;mid=2449472616&amp;idx=1&amp;sn=a41a420933f9af7f88af0759eb75f815&amp;chksm=8fbcb20fb8cb3b1969433e2468523234552562e504f3a12c8c1a2a012cff7fd1422e6dd48723&amp;token=1977984185&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">被人说 Lambda 代码像屎山，那是没用下面这三个方法</a></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[凌晨两点磨锋芒 调试采坑莫慌张]]></title>    <link>https://juejin.cn/post/7589170021931892751</link>    <guid>https://juejin.cn/post/7589170021931892751</guid>    <pubDate>2025-12-30T00:30:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589170021931892751" data-draft-id="7589126217250848809" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="凌晨两点磨锋芒 调试采坑莫慌张"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-30T00:30:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            凌晨两点磨锋芒 调试采坑莫慌张
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:30:12.000Z" title="Tue Dec 30 2025 00:30:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p>本系列为 Android 技术职场题材虚构小说，所有登场人物、公司名称、组织架构及相关情节均为创作所需虚构而来，若有雷同，纯属偶然。书中涉及的技术知识经专业梳理，仅供参考。</p>
<h2 data-id="heading-0">七）调试采坑磨锋芒 临时转岗莫慌张</h2>
<p>清晨的阳光刚漫过西二旗的写字楼玻璃幕墙。</p>
<p>办公区还没完全热闹起来，晓雅、阿泽和博文三个实习生就簇拥着围在了老杨的工位旁。</p>
<p>三人手里都捧着笔记本电脑，屏幕上全是昨晚赶工的代码界面。</p>
<p>小安则站在一旁，双手交握在身前，眼神里满是掩饰不住的焦虑。</p>
<p>"杨哥杨哥，你帮我们看看这个！"</p>
<p>阿泽率先把电脑凑到老杨面前，语气里带着点急切。</p>
<p>“这是林哥临走前给我们布置的音乐播放功能练习，我打算用 <code>SparseArray</code> 优化数据存储，以 <code>int</code> 存歌曲ID当键，对应存储值就是歌曲名、歌手、播放时长这些信息的 <code>Song</code> 对象，遍历的时候用了 <code>keyAt</code> 和 <code>valueAt</code> 方法获取对应数据，你看这思路对不对？"</p>
<p>老杨扶了扶眼镜，指尖在阿泽的触控板上慢慢滑动，目光扫过代码。</p>
<p>"嗯，思路没问题。"</p>
<p>他顿了顿，继续说道："把歌曲ID和 <code>Song</code> 对象用 <code>SparseArray</code> 映射，比用 <code>HashMap</code> 存整数键省内存，还能避免自动装箱。"</p>
<p>老杨忽然停在一段遍历代码上，抬眼看向三人。</p>
<p>"你们看这里，阿泽用<code>size()</code> 做循环边界的时候，每次循环都调用了一次 <code>size()</code> 方法。"</p>
<p>"可以优化下，先把 <code>size</code> 存成局部变量再循环，减少方法调用开销。"</p>
<p>老杨话音刚落，一旁的小安轻轻咳嗽了两声，打断了几人的讨论。</p>
<p>"杨哥，打扰一下..."</p>
<p>"林卓他昨天被张磊叫走支援紧急项目，我问他他也说不出个所以然，你说会不会是出什么事了？"</p>
<p>老杨敲键盘的手指顿了顿。</p>
<p>他转身从抽屉里摸出袋速溶咖啡。</p>
<p>热水冲进搪瓷杯的瞬间，氤氲的热气模糊了镜片。</p>
<p>他的目光也随之飘远——那里仿佛浮现出十几年前中关村软件园的模样，灰扑扑的写字楼外，满是抱着电脑奔波的年轻人。</p>
<p>而他自己，正缩在淘一淘技术部的角落工位里，忐忑地等待着入职后的第一次任务分配。</p>
<p>"这在大厂再正常不过。"</p>
<p>老杨的声音带着几分悠远。</p>
<p>"我刚入职淘一淘那年，比林卓现在还慌。入职第三天就被拉去救急，连公司茶水间在哪都没摸清。"</p>
<p>博文推了推鼻梁上的眼镜。</p>
<p>他眼神里满是好奇："杨哥，你当年刚入职的时候，也遇到过这种突然被拉去支援紧急项目的情况吗？"</p>
<p>老杨抿了口热咖啡。</p>
<p>苦涩的味道唤醒了尘封的记忆。</p>
<p>......</p>
<p>时间回到十年前，老杨入职第三天。</p>
<p>......</p>
<p>那年的夏天格外闷热，淘一淘技术部的空调坏了两台，剩下的两台根本压不住满屋子电脑散发的热气。</p>
<p>每个人的工位旁都放着一瓶冰镇矿泉水，键盘上偶尔还能看到水珠滑落的痕迹。</p>
<p>"杨明，过来一下。"</p>
<p>技术总监王哥的声音在嘈杂的办公区里格外清晰。</p>
<p>老杨当时还叫本名，听到召唤立刻从工位上弹起来。</p>
<p>他手里还攥着刚打印的公司 Android 编码规范文档。</p>
<p>王哥的工位在办公区最内侧，周围堆着厚厚的项目资料。</p>
<p>屏幕上正显示着一段卡顿的列表动画——淘一淘的商品列表页，滑动时像被按了慢放键，每滑三行就会顿一下。</p>
<p>测试机的状态栏里，内存占用数字还在不断攀升。</p>
<p>"用户反馈炸了，"</p>
<p>王哥揉着通红的眼睛，把测试机扔给老杨。</p>
<p>"低内存机型上尤其明显，你去安卓组支援，先把这个卡顿问题解决了。"</p>
<p>他顿了顿，补充道："安卓组的人都被拉去做双十一预热活动了，这个坑你先填上。"</p>
<p>老杨接过测试机，手指都在发颤。</p>
<p>他大学期间虽然学过 Android 开发，但都是做些简单的<code>Demo</code>，哪里接触过真实的生产环境代码。</p>
<p>打开项目工程的瞬间，他差点被满屏的红色警告吓住。</p>
<p>光是商品列表适配器的代码，就有足足三百多行，里面全是 <code>HashMap&lt;Integer, View&gt;</code> 的用法，循环里还嵌套着多次 <code>findViewById</code>。</p>
<p>王哥正在接电话。</p>
<p>挂了电话，他看到老杨盯着 <code>HashMap</code> 发呆，突然笑了。</p>
<p>"刚毕业的吧？"</p>
<p>王哥看了眼屏幕上的代码，又看了看老杨，语气缓和了些："这代码是前人遗留的坑，用 <code>HashMap</code> 存整数键，既费内存又容易出问题，你接手了可得好好梳理下。"</p>
<p>老杨涨红了脸，赶紧看 Android 官方文档。</p>
<p>王哥走过来，搜索了一下文档里的 <code>SparseArray</code> 说明。</p>
<p>"看这个，专门用于 <code>int</code> 键和 <code>Object</code> 值的映射，比 <code>HashMap</code> 省内存，还不用自动装箱。"</p>
<p>他随手在草稿纸上画了个示意图。</p>
<p>"你把这里的 <code>HashMap</code> 全换成 <code>SparseArray</code>，再把 <code>ViewHolder</code> 加上减少 <code>findViewById</code> 次数，应该能缓解卡顿。"</p>
<p>那天晚上，老杨在公司待到了凌晨两点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09729562590f4f63858cf5fbc63d4e04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659412&amp;x-signature=jDeRChB9lHt4vrfL1cA3Pmujwpc%3D" alt="1.png" loading="lazy"/></p>
<p>办公区里只剩下他一个人，空调的嗡嗡声格外清晰。</p>
<p>他按照王哥的提示，一步步重构代码。</p>
<p>先定义 <code>ViewHolder</code> 类，把商品名称、价格、图片等控件都封装进去。</p>
<p>再把 <code>HashMap&lt;Integer, View&gt;</code> 替换成 <code>SparseArray&lt;View&gt;</code>，遍历的时候用 <code>keyAt(i)</code> 获取键，<code>valueAt(i)</code> 获取对应的 <code>ViewHolder</code>。</p>
<p>调试的过程并不顺利。</p>
<p>第一次运行时，商品图片全变成了问号。</p>
<p><strong>Logcat</strong> 里报出空指针异常。</p>
<p>老杨排查了半天，才发现是自己在 <code>delete</code> 元素后，没有及时更新列表的数据源，导致复用<code>ViewHolder</code> 时出现了数据错乱。</p>
<p>其实单靠把 <code>HashMap</code> 换成 <code>SparseArray</code>，只能解决部分内存占用问题，想让列表彻底顺滑，还得配套优化其他环节。</p>
<p>老杨后续又补充了图片缓存策略，用 <code>LruCache</code> 缓存已加载的商品图片，避免重复请求网络；同时把列表项的图片加载改成异步请求，不让耗时操作阻塞主线程。</p>
<p>修改完成后，他再次运行项目。</p>
<p>原本滑动卡顿的列表，竟然能流畅地滑到底部。</p>
<p><code>Memory Monitor</code> 里的内存曲线也从锯齿状变成了平缓的波浪。</p>
<p>第二天中午，老杨刚到公司，就把优化后的代码提交到代码仓库，心里满是成就感。</p>
<p>可还没等他喘口气，测试组同事抱着一堆测试机冲过来，脸色铁青。</p>
<p>"杨明，你优化后的版本在部分机型上频繁闪退，后台已经收到上百条崩溃报告了！"</p>
<p>老杨的心一下子沉到了谷底。</p>
<p>他赶紧连接电脑，打开 <strong>Logcat</strong> 筛选崩溃日志。</p>
<p>密密麻麻的红色日志里，"OutOfMemoryError" 字样格外刺眼。</p>
<p>部分低内存机型上，商品图片的 <code>Bitmap</code> 对象未及时回收，叠加 <code>SparseArray</code> 优化后未适配的缓存逻辑，最终导致内存溢出。</p>
<p>更棘手的是，有些崩溃日志只显示异常类型，却找不到具体代码调用路径，根本无从下手排查。</p>
<p>"慌什么？先把崩溃日志理清楚。"</p>
<p>王哥不知何时站到了他身后，指着 <strong>Logcat</strong> 界面。</p>
<p>"开发环境用 <strong>Logcat</strong> 查即时日志，生产环境的崩溃得靠专门的监控工具。"</p>
<p>"咱们公司刚接入了 <strong>Bugly</strong>，你把它集成到项目里，能获取完整的堆栈信息、设备型号和用户行为路径，定位问题会快很多。"</p>
<p>他顿了顿，补充道："对了，记得区分生产和测试环境的配置，别把测试环境的日志和服务器请求弄到生产环境去了。"</p>
<p>老杨赶紧按照王哥的指导集成 <strong>Bugly</strong>，同时琢磨起环境区分的问题。</p>
<p>他在 <code>build.gradle</code> 里配置了 <code>buildTypes</code>，分别定义 <code>debug</code>（测试环境）和 <code>release</code>（生产环境）两种构建类型。</p>
<p>测试环境下，开启 <code>Log</code> 日志输出，将 <strong>Bugly</strong> 设置为调试模式，服务器请求指向测试服务器。</p>
<p>生产环境下，关闭所有调试日志，<strong>Bugly</strong> 切换为正式监控模式，请求正式服务器地址。</p>
<p>为了避免手动修改出错，他还通过 <code>BuildConfig</code> 类获取环境变量，比如用 <code>BuildConfig.DEBUG</code> 判断当前环境，用 <code>BuildConfig.BASE_URL</code> 获取对应环境的服务器地址。</p>
<p>配置完成后，他在代码关键位置添加了 <code>try-catch</code> 块捕获异常，并根据环境输出日志。</p>
<p>没过多久，<strong>Bugly</strong> 后台就统计出详细的崩溃报告。</p>
<p>崩溃发生在商品列表一直滑动加载图片的场景。</p>
<p>结合报告里的堆栈信息，他很快找到了问题根源——图片缓存没有设置大小上限，也没有监听系统低内存状态。</p>
<p>"用 <code>ActivityManager</code> 的 <code>getMemoryInfo</code> 方法判断设备内存状态。"</p>
<p>王哥扔给他一个代码示例。</p>
<p>"当设备处于低内存状态时，主动清理图片缓存和 <code>SparseArray</code> 里的闲置数据。"</p>
<p>"另外，给线程加个全局异常处理器，避免未捕获的异常直接导致应用崩溃。"</p>
<p>老杨照着修改代码。</p>
<p>他通过 <code>Thread.setDefaultUncaughtExceptionHandler</code> 设置了全局异常处理器，在里面记录异常详情并友好退出应用。</p>
<p>同时用 <code>ActivityManager</code> 监控内存，低内存时调用 <code>sparseArray.clear()</code> 释放资源。</p>
<p>再次测试时，崩溃率大幅下降。</p>
<p><strong>Logcat</strong> 里的 <code>GC</code> 日志也变得规律起来。</p>
<p>他看着 <strong>Bugly</strong> 后台实时更新的监控数据，第一次真切感受到异常追踪工具对开发的重要性。</p>
<p>解决了崩溃问题，老杨以为终于能松口气。</p>
<p>解决了崩溃问题后，老杨总算迎来了几天短暂的休整。</p>
<p>他趁这段时间梳理了商品列表优化的完整方案，补全了技术文档，还帮测试组复现了几个零星的小问题。</p>
<p>就这样安稳过了一周，正当他以为能喘口气，把精力放在后续的功能迭代上时，新的任务又来了。</p>
<p>安卓组组长找了过来，给他安排了新任务：“给商品详情页加个扫码功能，用户扫商品包装上的条形码，就能快速查看商品信息，这个需求得尽快落地。”</p>
<p>"这个简单，调用系统相机扫码就行。"</p>
<p>老杨信心满满地开始写代码。</p>
<p>他在 <code>AndroidManifest.xml</code> 里添加了 <code>CAMERA</code> 权限，然后用 <code>Intent</code> 调用系统相机应用，想着就能直接获取扫码结果。</p>
<p>可测试时却发现，在 Android 6.0 的机型上，打开扫码功能时直接闪退。</p>
<p><strong>Logcat</strong> 里报出权限被拒绝的错误。</p>
<p>"你不知道 6.0 开始要动态申请权限吗？"</p>
<p>王哥路过他工位时，一眼就看出了问题。</p>
<p>"危险权限不仅要在 <code>Manifest</code> 里声明，还要在运行时申请。"</p>
<p>他打开自己的项目工程，给老杨演示了动态权限申请的代码。</p>
<p>"先用 <code>ContextCompat.checkSelfPermission</code> 检查权限是否已授予，如果没授予，再判断是否需要向用户说明理由。"</p>
<p>老杨赶紧补全了权限申请的代码。</p>
<p>他发现王哥用的是 <code>ActivityResultLauncher</code> API，比传统的<code>requestPermissions</code> 方法更简洁，还能避免内存泄漏。</p>
<p>他照着实现：先注册一个权限请求启动器，触发后根据用户授权结果执行不同逻辑。</p>
<p>可新的问题又出现了：有些用户第一次拒绝了相机权限，第二次打开扫码功能时，系统没有弹出权限申请对话框，直接拒绝了权限。</p>
<p>"这时候要调用 <code>shouldShowRequestPermissionRationale</code> 方法判断。"</p>
<p>王哥提醒他。</p>
<p>"如果返回 <code>true</code>，说明用户之前拒绝过权限，这时候应该弹出对话框，向用户解释为什么需要相机权限，比如‘需要相机权限才能扫描条形码，快速查看商品信息’。"</p>
<p>"如果返回 <code>false</code>，说明用户永久拒绝了，就得引导他们去系统设置里手动开启。"</p>
<p>老杨按照王哥的提示，添加了权限说明对话框和设置引导页面。</p>
<p>测试时，无论用户是首次拒绝还是永久拒绝，都能得到清晰的指引，扫码功能的用户体验好了很多。</p>
<p>可多机型测试时，新的问题又暴露出来：在 Android 4.0 及以上版本的机型上，扫码成功后加载商品信息会直接闪退，<strong>Logcat</strong> 里明确报出 <code>NetworkOnMainThreadException</code> 异常；而在4.0以下的旧机型上，虽不会崩溃，但网络不好时会出现明显的UI卡顿，屏幕僵住好几秒无响应，连返回按钮都失灵。</p>
<p>"这是因为你在主线程做了网络请求。"</p>
<p>王哥敲了敲他的屏幕。</p>
<p>"耗时操作一定要放在子线程里。试试用 <code>HandlerThread</code> 。"</p>
<p>王哥给老杨演示了 <code>HandlerThread</code> 的用法。</p>
<p>创建一个 <code>HandlerThread</code> 实例，调用 <code>start</code> 方法启动线程。</p>
<p>然后创建一个 <code>WorkerHandler</code>，把它绑定到 <code>HandlerThread</code> 的 <code>Looper</code> 上。</p>
<p>耗时的网络请求放在 <code>WorkerHandler</code> 的 <code>post</code> 方法里执行，获取到数据后，再通过 <code>MainHandler</code> 切换到主线程更新 <code>UI</code>。</p>
<p>老杨照着王哥的方法修改代码。</p>
<p>他还特意在 <code>Activity</code> 销毁时，调用了 <code>HandlerThread.quitSafely()</code> 方法——要知道 <code>quit</code> 会直接终止线程的 <code>Looper</code>，丢弃队列中未执行的消息，容易导致数据丢失或资源未释放；而 <code>quitSafely</code> 会等待队列中已有的消息执行完毕后再终止 <code>Looper</code>，既能正常结束线程，又能避免内存泄漏和数据异常。</p>
<p>他还在代码里添加了详细的 <code>Log</code> 日志，用不同的日志级别区分调试信息和错误信息，方便后续通过 <strong>Logcat</strong> 排查问题。</p>
<p>测试时，扫码加载商品信息的过程中，<code>UI</code> 再也不卡顿了。</p>
<p>即使网络不好，也只会显示加载中动画，不会影响其他操作。</p>
<p>项目推进到后期，公司组织了一次无障碍测试。</p>
<p>测试人员反馈，视障用户使用 <code>TalkBack</code> 时，无法识别扫码按钮和商品图片，而且调整系统字体大小时，<code>APP</code> 里的文本大小不会跟着变化。</p>
<p>"无障碍是必须要适配的，不然会流失一部分用户。"</p>
<p>王哥把无障碍测试指南扔给老杨。</p>
<p>"给所有 <code>UI</code> 元素添加内容描述，装饰性的元素就把 <code>contentDescription</code> 设为<code>null</code>。"</p>
<p>"文本大小要用 <code>sp</code> 作为单位，这样才能跟随系统字体大小变化。"</p>
<p>老杨赶紧修改代码。</p>
<p>他给扫码按钮添加了"点击扫码查看商品信息"的 <code>contentDescription</code>，给商品图片添加了对应的商品名称描述。</p>
<p>把所有 <code>TextView</code> 的 <code>textSize</code> 属性都从 <code>dp</code> 改成了 <code>sp</code>。</p>
<p>他还使用 Android Studio 的无障碍扫描器检查了一遍，修复了焦点导航不顺畅的问题。</p>
<p>再次测试时，视障用户能通过 <code>TalkBack</code> 正常操作，文本大小也能跟随系统设置变化了。</p>
<p>就在项目即将上线的时候，公司突然组织了一次代码评审。</p>
<p>评审会上，王哥指出了老杨代码里的一个问题：他在使用 <code>Handler</code> 时，直接用了匿名内部类，导致内存泄漏。</p>
<p>"匿名内部类会持有外部 <code>Activity</code> 的引用，"</p>
<p>王哥解释道。</p>
<p>"如果 <code>Handler</code> 里还有未执行的消息，<code>Activity</code> 就无法被 <code>GC</code> 回收，导致内存泄漏。"</p>
<p>他给老杨演示了正确的用法：用静态内部类定义 <code>Handler</code>，然后用 <code>WeakReference</code> 引用外部<code>Activity</code>；在 <code>Activity</code> 销毁时，移除 <code>Handler</code> 里的所有消息和回调。"</p>
<p>老杨赶紧修改代码。</p>
<p>把所有的<code>Handler</code> 都改成了静态内部类的形式，还添加了 <code>WeakReference</code>。</p>
<p>特意在 <code>onDestroy</code> 方法里，调用了 <code>handler.removeCallbacksAndMessages(null)</code>，确保移除所有未执行的消息和回调。</p>
<p>同时，他还补充了单元测试，覆盖了 <code>SparseArray</code> 优化、权限申请、异常处理等核心逻辑，确保代码的稳定性。</p>
<p>代码评审通过后，项目终于顺利上线。</p>
<p>上线那天，老杨盯着 <strong>Bugly</strong> 后台的监控数据，心里满是激动。</p>
<p>用户反馈商品列表卡顿问题解决了，闪退率也降到了0.001%以下。</p>
<p>扫码功能和无障碍适配都得到了用户的认可。</p>
<p>王哥拍着他的肩膀，笑着说："不错啊小伙子，入职这么短时间，就能独当一面了。"</p>
<p>就这样在一次次项目攻坚、一次次踩坑填坑的千锤百炼中，老杨才算是在淘一淘客户端技术部站稳了脚跟。</p>
<p>他跟着王哥参与了更多的项目，把 <code>SparseArray</code> 的内存优化思路用到了更多场景。</p>
<p>也熟练掌握了运行时权限的各种适配技巧。</p>
<p>他学会了用 <code>Looper</code>、<code>Handler</code>、<code>HandlerThread</code> 搭建高效的异步任务框架。</p>
<p>用 <strong>Logcat</strong> 和 <strong>Bugly</strong> 组合排查各种异常问题。</p>
<p>通过 <code>buildTypes</code> 配置清晰区分生产与测试环境（控制 <code>Log</code> 日志输出、服务器地址等）。</p>
<p>也深刻理解了无障碍适配对用户体验的重要性。</p>
<p>在淘一淘的几年里，老杨从一个青涩的应届生，成长为一名资深的 Android 开发工程师。</p>
<p>他经历过紧急项目的通宵加班，也感受过解决难题后的成就感。</p>
<p>他遇到过严格的代码评审，也得到过前辈的悉心指导。</p>
<p>那些写过的代码、踩过的坑、解决过的 Bug，都变成了他最宝贵的财富。</p>
<p>尤其是王哥常说的那句话，他一直记在心里。</p>
<p>"好的开发不仅要实现功能，还要考虑性能、稳定性和用户体验，每一个技术点的选择，都要经得起场景的考验。"</p>
<p>......</p>
<p>老杨的思绪渐渐拉回现实。</p>
<p>搪瓷杯里的咖啡已经凉透了。</p>
<p>小安和晓雅、阿泽、博文还围在他的工位旁，眼神里满是专注。</p>
<p>"所以啊，林卓现在遇到的紧急项目，对他来说也是个成长的机会。"</p>
<p>老杨的声音带着几分感慨。</p>
<p>"当年我要是没经历那些紧急任务，也学不会把 <code>SparseArray</code>、权限适配、异常追踪这些技术点融会贯通。"</p>
<p>博文似懂非懂地点点头。</p>
<p>老杨笑了笑。</p>
<p>"技术从来不是孤立的。你用 <code>SparseArray</code> 优化内存，就得知道怎么用 <strong>Logcat</strong> 查 <code>GC</code> 日志；你做扫码功能，就得懂动态权限申请；你写异步任务，就得学会用 <code>HandlerThread</code> 避免内存泄漏。”</p>
<p>他顿了顿。</p>
<p>“哦，对，不过放到现在，异步任务大多用Kotlin协程来解决了，很少有人再用 <code>HandlerThread</code> 了。"</p>
<p>他继续，指着博文的代码。</p>
<p>"你再把 <strong>Bugly</strong> 的简单集成和 <code>try-catch</code> 异常捕获加上，模拟一下生产环境的异常场景，这样这个练习项目就更完整了。"</p>
<p>小安的眉头终于舒展了一些。</p>
<p>"杨哥，听你这么一说，我就放心了。林卓他肯定能顺利完成任务的。"</p>
<p>老杨点点头，打开Q书，给林卓发了一条消息。</p>
<p>"遇到问题别慌，先沉下心梳理清楚核心逻辑——优先定位问题根源，再找对应解决方案，复杂任务拆分成小步骤来攻克。当年我在淘一淘救急，全靠前辈指点这些通用的开发思路，你按这个节奏来，没问题的。"</p>
<p>发送完毕，他又转头对晓雅、阿泽、博文说："我把当年在淘一淘踩过的坑，还有这些核心技术点的最佳实践整理成了个人经验文档，等下发给你们，省得你们以后再走弯路。"</p>
<p>话音刚落，老杨便打开电脑文件夹，找到那份整理好的个人经验文档。</p>
<p>他通过Q书群发给了他们。</p>
<p>小安站在一旁，看着这一幕，紧绷的肩膀彻底放松下来。</p>
<p>阳光透过落地窗洒在办公区的地板上，也照亮了几人专注的脸庞。</p>
<p>老杨看着眼前充满朝气的实习生们，仿佛看到了当年初入职场的自己。</p>
<p>而小安的目光，正温柔地望向办公区入口的方向，期待着林卓归来的身影。</p>
<p>沉默片刻。</p>
<p>小安像是忽然想起什么，轻声问老杨："杨哥，听你讲当年在淘一淘的经历，你技术这么好，还能独当一面，后来怎么会来咱们 ByteFlow 呢？"</p>
<p>老杨闻言，拿起桌上早已凉透的搪瓷杯抿了一口。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93bca8c26ab0459e9dc5b6b62b05b6ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767659412&amp;x-signature=4nDIS3C7BHMjvFWq5wSO94IlOEA%3D" alt="2.png" loading="lazy"/></p>
<p>他嘴角勾起一抹意味深长的笑。</p>
<p>目光再次飘向窗外的阳光，缓缓说道："这啊，又是明天的故事了。"</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React 学习：useContext——优雅解决跨层级组件通信]]></title>    <link>https://juejin.cn/post/7589170021931991055</link>    <guid>https://juejin.cn/post/7589170021931991055</guid>    <pubDate>2025-12-30T00:44:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589170021931991055" data-draft-id="7588388014504902698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" React 学习：useContext——优雅解决跨层级组件通信"/> <meta itemprop="keywords" content="JavaScript,面试,React.js"/> <meta itemprop="datePublished" content="2025-12-30T00:44:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="南山安"/> <meta itemprop="url" content="https://juejin.cn/user/1795929588117962"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             React 学习：useContext——优雅解决跨层级组件通信
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1795929588117962/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    南山安
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:44:42.000Z" title="Tue Dec 30 2025 00:44:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前几天学习完了React中基本的组件通信，父传子，子传父以及兄弟组件之间的通讯，但是实际使用下来，发现一但嵌套关系复杂，数据传递就难免变得复杂且多余，一个子组件想要获取一个数据竟然要一步步从根组件中传递获取，于是我又学习了useContext———跨组件通讯方式。</p>
<p>感觉它真是解决“道具穿透”（Prop Drilling）问题的一把好钥匙。。下面把我学习过程中的笔记、代码和思考整理成一篇文章，希望能帮到同样在纠结组件通信的同学。</p>
<h2 data-id="heading-1">传统父子组件通信的痛点</h2>
<p>最常见的组件通信方式就是父组件通过 props 把数据传给子组件。</p>
<p>比如我们有一个登录后的用户信息，需要显示在最底层的头像组件里：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// App.jsx（传统方式）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Page</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserInfo</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserInfo</span>(<span class="hljs-params">{ user }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: <span class="hljs-string">"Andrew"</span> };
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Page</span> <span class="hljs-attr">user</span>=<span class="hljs-string">{user}</span> /&gt;</span></span>;
}
</code></pre>
<p>这样写没什么问题，但一旦层级变深——比如 Page → Layout → Sidebar → Header → Avatar，你就得在每一层都老老实实接收并转发 user 这个 prop。代码里充斥着毫无意义的“中转站”，阅读和维护成本直线上升。</p>
<p>我的笔记里写得很清楚：</p>
<ul>
<li>一路传递下去 性价比不高 麻烦</li>
<li>规矩不变：父组件（外组件）复杂持有和改变数据</li>
<li>大于父子层级，传递的路径太长</li>
</ul>
<p>这就是经典的 <strong>Prop Drilling</strong> 问题。</p>
<h2 data-id="heading-2">useContext 的核心思想</h2>
<p>useContext 的出现，就是为了彻底解决跨层级传递的尴尬。</p>
<p>它的核心理念可以用两句话概括（也是我笔记里反复强调的）：</p>
<ol>
<li>数据在最外层提供，给组件树里任何层级的后代随便用。</li>
<li>需要消费数据的组件自己去“找”数据，而不是被动接收 props。</li>
</ol>
<p>换句话说：<strong>提供者（Provider）广播数据，消费者主动订阅</strong>。</p>
<p>这样做的好处显而易见：</p>
<ul>
<li>中间层组件完全不需要关心这个数据是否存在</li>
<li>数据管理集中在最外层，逻辑清晰</li>
<li>任意深度的后代组件都能直接获取最新数据</li>
</ul>
<h2 data-id="heading-3">手把手实现一个用户信息跨层级共享</h2>
<p>我们用最简单的用户登录信息来演示。</p>
<h3 data-id="heading-4">1. 创建 Context</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// src/App2.jsx</span>
<span class="hljs-keyword">import</span> { createContext } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">UserContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);
</code></pre>
<p>createContext(defaultValue) 会返回一个 Context 对象。默认值只有在没有匹配到 Provider 时才会用到，通常我们传 null。</p>
<h3 data-id="heading-5">2. 在根部提供数据</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// App2.jsx</span>
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Page</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../views/Page"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./App2"</span>;  <span class="hljs-comment">// 同一个文件里可以直接引用</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: <span class="hljs-string">"华高俊"</span> };   <span class="hljs-comment">// 实际项目里可能是登录后从接口拿到的</span>

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{user}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Page</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
  );
}
</code></pre>
<p>Provider 的 value 属性就是我们要共享的数据。只要组件树被这个 Provider 包裹，里面的任何组件都能访问到。</p>
<h3 data-id="heading-6">3. 任意后代组件消费数据</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// components/UserInfo.jsx</span>
<span class="hljs-keyword">import</span> { useContext } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">UserContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../src/App2"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">UserInfo</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);

  <span class="hljs-comment">// 如果没找到 Provider，user 会是 createContext 时传的默认值（这里是 null）</span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{user?.name ?? "未登录"}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}
</code></pre>
<p>组件树结构可以是：</p>
<p>App → Page → Header → UserInfo</p>
<p>注意 Header 和 Page 完全不需要接收任何 props，UserInfo 直接通过 useContext 拿到数据。</p>
<p>“要消费数据状态的组件拥有找数据的能力（传递是被动接收）”。</p>
<h4 data-id="heading-7">完整调用流程图解</h4>
<pre><code class="hljs language-text" lang="text">1. 创建容器
   ↓
src/contexts/UserContext.js
export const UserContext = createContext(null);

2. 在根组件提供数据
   ↓
App.jsx
&lt;UserContext.Provider value={user}&gt;
  &lt;Page /&gt;
&lt;/UserContext.Provider&gt;

3. 在任意后代组件消费数据
   ↓
components/Header/UserInfo.jsx
const user = useContext(UserContext);
return &lt;div&gt;{user.name}&lt;/div&gt;;
</code></pre>
<p>组件结构可以是： App → Layout → Sidebar → Header → Avatar → UserInfo 中间所有组件都不需要写 props，UserInfo 直接就能拿到 user 数据！</p>
<h4 data-id="heading-8">总结</h4>

























<table><thead><tr><th>名称</th><th>作用</th><th>调用位置</th></tr></thead><tbody><tr><td>createContext</td><td>创建一个共享数据的容器</td><td>通常单独文件导出</td></tr><tr><td>&lt;Context.Provider&gt;</td><td>提供实际数据（value）</td><td>组件树较高层级（如 App 最外层）</td></tr><tr><td>useContext(Context)</td><td>取出当前 Context 的数据</td><td>任意需要使用数据的子组件中</td></tr></tbody></table>
<h2 data-id="heading-9">进阶：Context 里放可变状态（主题切换实战）</h2>
<p>单纯共享静态数据已经很香了，但真正的威力在于把<strong>状态 + 更新函数</strong>一起放进 Context，实现全局可变共享状态。</p>
<p>主题切换（白天/夜间模式）是最经典的例子，也是我笔记里专门标记的 demo。</p>
<h3 data-id="heading-10">思路</h3>
<ul>
<li>在根组件创建一个 theme 状态和 toggleTheme 函数</li>
<li>把两者通过 Context 提供给全局</li>
<li>任意组件（哪怕是最底层的按钮）都可以读取当前主题并触发切换</li>
<li>主题实际生效方式：通过 CSS 自定义属性（CSS Variables）</li>
</ul>
<h3 data-id="heading-11">1. 定义 ThemeContext</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// contexts/ThemeContext.jsx</span>
<span class="hljs-keyword">import</span> { createContext, useContext, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">ThemeContext</span> = <span class="hljs-title function_">createContext</span>(<span class="hljs-literal">null</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeProvider</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> [theme, setTheme] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"light"</span>); <span class="hljs-comment">// light | dark</span>

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggleTheme</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setTheme</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> (prev === <span class="hljs-string">"light"</span> ? <span class="hljs-string">"dark"</span> : <span class="hljs-string">"light"</span>));
  };

  <span class="hljs-comment">// 同时把 theme 和 toggleTheme 暴露出去</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">theme</span>, <span class="hljs-attr">toggleTheme</span> }}&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useTheme</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);
</code></pre>
<p>封装一个自定义 Hook useTheme，调用起来更清晰。</p>
<h3 data-id="heading-12">2. CSS 变量实现真正的全局主题</h3>
<pre><code class="hljs language-CSS" lang="CSS"><span class="hljs-comment">/* theme.css */</span>
<span class="hljs-selector-pseudo">:root</span> {
  <span class="hljs-attr">--bg-color</span>: <span class="hljs-number">#ffffff</span>;
  <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#222</span>;
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#1677ff</span>;
}

<span class="hljs-selector-attr">[data-theme=<span class="hljs-string">"dark"</span>]</span> {
  <span class="hljs-attr">--bg-color</span>: <span class="hljs-number">#141414</span>;
  <span class="hljs-attr">--text-color</span>: <span class="hljs-number">#f5f5f5</span>;
  <span class="hljs-attr">--primary-color</span>: <span class="hljs-number">#4e8cff</span>;
}

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--bg-color);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.button</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">var</span>(--primary-color);
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
}
</code></pre>
<p>关键点：在 &lt; html&gt; 标签上动态添加 data-theme 属性。</p>
<h3 data-id="heading-13">3. 根组件应用主题</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// App.jsx</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./contexts/ThemeContext"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Page</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"./pages/Page"</span>;
<span class="hljs-keyword">import</span> { useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">"./contexts/ThemeContext"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Root</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { theme } = <span class="hljs-title function_">useTheme</span>();

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>.<span class="hljs-property">dataset</span>.<span class="hljs-property">theme</span> = theme;
  }, [theme]);

  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Page</span> /&gt;</span></span>;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeProvider</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Root</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeProvider</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-14">4. 任意组件使用主题和切换</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// components/ThemeToggleButton.jsx</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">"../contexts/ThemeContext"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ThemeToggleButton</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { theme, toggleTheme } = <span class="hljs-title function_">useTheme</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{toggleTheme}</span>&gt;</span>
      切换到 {theme === "light" ? "暗黑" : "明亮"} 模式
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  );
}
</code></pre>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// components/Header.jsx</span>
<span class="hljs-keyword">import</span> { useTheme } <span class="hljs-keyword">from</span> <span class="hljs-string">"../contexts/ThemeContext"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Header</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { theme } = <span class="hljs-title function_">useTheme</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> "<span class="hljs-attr">20px</span>", <span class="hljs-attr">borderBottom:</span> "<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">eee</span>" }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>当前主题：{theme === "light" ? "🌞 白天" : "🌙 夜间"}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ThemeToggleButton</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span></span>
  );
}
</code></pre>
<p>只要把 ThemeToggleButton 放在组件树的任何位置，都能控制全局主题，中间层级完全无感。</p>
<h2 data-id="heading-15">useContext 的缺陷及解决方法（实用避坑指南）</h2>
<p>useContext 用起来确实很爽，能轻松解决跨层级传 props 的麻烦，但它并不是完美的“万能药”。如果你不注意它的缺陷，项目大了以后很容易踩坑。下面我把最常见的几个缺陷讲清楚，并给出真实可行的预防办法。</p>
<h3 data-id="heading-16">1. <strong>性能问题：不必要的重渲染</strong></h3>
<p><strong>缺陷描述</strong> 当 Context 的 value 值发生变化时，所有消费了这个 Context 的组件（哪怕只用了 value 里的一小部分）都会被迫重新渲染。</p>
<p>举个例子：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span> value={{ theme, user, toggleTheme, logout }}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">WholeApp</span> /&gt;</span></span>
&lt;/<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span>&gt;
</code></pre>
<p>如果 user 改变了，整个 App 里所有用了 useContext(ThemeContext) 的组件（包括只关心 theme 的按钮）都会重渲染，哪怕主题根本没变。</p>
<p><strong>预防办法</strong></p>
<ul>
<li>
<p><strong>拆分 Context</strong>：把变化频率不同的数据拆到不同的 Context 里。 推荐做法：</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span> value={{ theme, toggleTheme }}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">UserContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">user</span>, <span class="hljs-attr">logout</span> }}&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">UserContext.Provider</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span>&gt;
</code></pre>
<p>这样主题切换不会导致用户相关的组件重渲染，反之亦然。</p>
</li>
<li>
<p><strong>使用 memo 优化 value</strong>：避免每次渲染都创建新对象。</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> value = <span class="hljs-title function_">useMemo</span>(
  <span class="hljs-function">() =&gt;</span> ({ theme, toggleTheme }),
  [theme, toggleTheme]  <span class="hljs-comment">// 只有依赖变化时才创建新对象</span>
);

<span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{value}</span>&gt;</span>{children}<span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span>;
</code></pre>
</li>
<li>
<p><strong>消费方结合 useMemo / useCallback</strong>：如果组件内部计算代价大，可以进一步优化。</p>
</li>
</ul>
<h3 data-id="heading-17">2. <strong>调试困难：数据来源不明确</strong></h3>
<p><strong>缺陷描述</strong> 组件直接通过 useContext 拿数据，你一眼看不出这个数据到底是从哪个 Provider 提供的，尤其是项目大了，同一个 Context 可能被多个 Provider 包裹（嵌套 Provider）。</p>
<p><strong>预防办法</strong></p>
<ul>
<li>
<p><strong>给 Context 起有意义的名字</strong>：不要叫 DataContext，而是 UserContext、ThemeContext、CartContext。</p>
</li>
<li>
<p><strong>Provider 放固定位置</strong>：全局的放 App 根部，局部的放对应模块的根组件。</p>
</li>
<li>
<p><strong>自定义 Hook 封装</strong>：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useTheme</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">ThemeContext</span>);
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useUser</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);
</code></pre>
<p>使用时直接 const { theme } = useTheme();，一眼就知道数据来源。</p>
</li>
</ul>
<h3 data-id="heading-18">3. <strong>默认值陷阱</strong></h3>
<p><strong>缺陷描述</strong> createContext(defaultValue) 的默认值只在<strong>完全没有匹配到 Provider</strong> 时才生效。很多人误以为它能当“初始值”用，导致调试时困惑。</p>
<p><strong>预防办法</strong></p>
<ul>
<li>
<p>默认值一般传 null 或 undefined，并在消费时做好空值判断：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">const</span> user = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">UserContext</span>);
<span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'UserInfo 必须在 UserProvider 内部使用'</span>);
</code></pre>
</li>
<li>
<p>或者干脆不依赖默认值，所有数据都在 Provider 里提供。</p>
</li>
</ul>
<h3 data-id="heading-19">4. <strong>不适合高频更新的数据</strong></h3>
<p><strong>缺陷描述</strong> 如果你把一个高频变化的状态（比如输入框内容、鼠标位置、实时计数器）放进 Context，会导致大量组件频繁重渲染，性能雪崩。</p>
<p><strong>预防办法</strong></p>
<ul>
<li>高频状态坚决用局部 state 或其他更精细的方案（比如 Zustand、Jotai 的 atom）。</li>
<li>Context 只放“相对稳定”或“全局必要”的数据：主题、用户信息、语言、路由状态等。</li>
</ul>
<h3 data-id="heading-20">5. <strong>嵌套 Provider 时价值覆盖问题</strong></h3>
<p><strong>缺陷描述</strong> 同一个 Context 可以嵌套多个 Provider，后面的会覆盖前面的 value。</p>
<pre><code class="hljs language-jsx" lang="jsx">&lt;<span class="hljs-title class_">ThemeContext</span>.<span class="hljs-property">Provider</span> value={{ <span class="hljs-attr">theme</span>: <span class="hljs-string">'light'</span> }}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Child</span> /&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">ThemeContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">theme:</span> '<span class="hljs-attr">dark</span>' }}&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">GrandChild</span> /&gt;</span>  {/* 这里拿到 dark */}
  <span class="hljs-tag">&lt;/<span class="hljs-name">ThemeContext.Provider</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Child</span>&gt;
</code></pre>
<p>这本来是特性，但如果不小心嵌套错了，就会出现“主题突然变了但找不到原因”的诡异 bug。</p>
<p><strong>预防办法</strong></p>
<ul>
<li>全局 Context 只在最外层提供一次。</li>
<li>如果需要局部覆盖（如某个页面强制暗色），明确注释并控制范围。</li>
</ul>
<h3 data-id="heading-21">总结：useContext 适用场景与替代方案</h3>






























<table><thead><tr><th>适用场景</th><th>不适用场景</th><th>推荐替代方案</th></tr></thead><tbody><tr><td>主题切换</td><td>高频状态（如输入框、动画）</td><td>局部 state / Zustand</td></tr><tr><td>用户信息、权限</td><td>复杂的大型状态管理</td><td>Redux Toolkit / Zustand</td></tr><tr><td>国际化（i18n）</td><td>需要中间件、异步 action</td><td>Redux / Recoil / Jotai</td></tr><tr><td>相对稳定的全局配置</td><td>需要细粒度订阅单个字段</td><td>Jotai / Zustand</td></tr></tbody></table>
<p><strong>我的个人建议</strong>：</p>
<ul>
<li>小中型项目：大胆用 useContext + useReducer 就够了，简单高效。</li>
<li>大型项目：用 useContext 只做“提供能力”（Provider 包裹），真正复杂状态管理交给更专业的库（如 Zustand，它结合了 Context 的简单和 Redux 的强大）。</li>
</ul>
<p>用好了，useContext 是优雅的；用不好，它会让你在重渲染地狱里怀疑人生。关键就两点：</p>
<ol>
<li>拆分 Context</li>
<li>memo 住 value</li>
</ol>
<h2 data-id="heading-22">小结：什么时候用 useContext</h2>
<ul>
<li>需要跨多层级共享数据时（用户信息、主题、语言、权限等全局状态）</li>
<li>数据会在多个不相邻的组件中使用</li>
<li>不想写一堆无意义的 props 中转代码</li>
</ul>
<p>注意事项：</p>
<ul>
<li>Context 触发更新时，所有消费了这个 Context 的组件都会重新渲染。建议把变化频率高的状态和稳定的状态分开多个 Context。</li>
<li>对于复杂的大型应用，推荐搭配 useReducer 或直接使用成熟的状态管理库（如 Zustand、Redux Toolkit）。</li>
</ul>
<p>通过这个主题切换的小 demo，我彻底感受到 useContext 的优雅：数据管理集中、消费方主动获取、配合 CSS 变量实现真正的全局样式切换，代码清晰且扩展性极强。</p>
<p>如果你还在被 props 一层一层往下传折磨，不妨立刻试试 useContext，相信我，用过一次就再也回不去了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[闭源的墙角被挖塌了？GLM-4.7登顶开源王座，这回真不兴嘲讽]]></title>    <link>https://juejin.cn/post/7589172193150599204</link>    <guid>https://juejin.cn/post/7589172193150599204</guid>    <pubDate>2025-12-29T16:26:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589172193150599204" data-draft-id="7589099845187059748" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="闭源的墙角被挖塌了？GLM-4.7登顶开源王座，这回真不兴嘲讽"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-29T16:26:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            闭源的墙角被挖塌了？GLM-4.7登顶开源王座，这回真不兴嘲讽
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T16:26:35.000Z" title="Mon Dec 29 2025 16:26:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年的年底并不平静。就在大家准备过双旦假期的时候，智谱AI像是故意给行业扔了个“深水炸弹”，发布了最新的GLM-4.7。</p>
<p>说实话，这两年国产大模型发布会我看累了，参数刷榜的消息也听麻了。但这次的情况有点不一样。这次拿出来的成绩单，不是自家做的PPT，而是来自Artificial Analysis。在这个被OpenAI、谷歌当做金标准的评测里，GLM-4.7干了一件让开源社区炸锅的事：它拿到了全球开源模型的第一名。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-30_00.17.07-1024x342.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-30_00.17.07-1024x342.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fea4484fa21411ea975a955d5dced96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767630394&amp;x-signature=RhdYFEfw%2FNd%2F%2BjJu5vDp6Ne1k4c%3D" alt="iShot_2025-12-30_00.17.07" loading="lazy"/></a></p>
<p><strong>这也太“卷”了</strong></p>
<p>先看一张更有说服力的成绩单。在AAII（Artificial Analysis Intelligence Index）刚刚更新的榜单里，GLM-4.7拿到了68分的综合得分。</p>
<p>这个分数意味着什么？</p>
<p>往上看，它在全球总榜里排第六。排在它前面的，全是GPT-5.2、Gemini 3 Pro这种闭源巨头，也就是那种你每个月得掏20刀甚至更多才能用上的“贵族”模型。</p>
<p>往下看，这才是最有意思的地方。它把Claude 4.5 Sonnet、Grok 4这些名声在外的模型甩在了身后。而在开源这个赛道上，它直接登顶。就连同样表现生猛的DeepSeek V3.2，这次也以两分之差排在第十。</p>
<p>如果不谈开源闭源，单论国产模型，GLM-4.7和Kimi K2、DeepSeek共同构成的第一梯队，已经把国产AI的水平线硬生生拉到了国际一线。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-30_00.17.17-1024x496.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-30_00.17.17-1024x496.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f21ff2ce810c451e97305851f1cffc99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767630394&amp;x-signature=zsbxsLJEkkpUsZQ5HxrZbmq1Ukg%3D" alt="iShot_2025-12-30_00.17.17" loading="lazy"/></a></p>
<p><strong>它到底强在哪？</strong></p>
<p>很多开发者，包括我在内，最关心的其实不是分数，而是手感。GLM-4.7这次明显是奔着“解决难题”去的，它被定义为一款专注于推理的模型。</p>
<p>首先是写代码。对于我们这些靠代码吃饭的人来说，Code Arena的排名就是风向标。GLM-4.7在这个榜单上拿了开源第一，甚至在综合性能上压过了GPT-5.2。在LiveCodeBench测试里，它也超过了Claude Sonnet 4.5。虽然在某些特定测试集上还有偏科，但你让它写个复杂脚本或者查个Bug，它的表现已经不再是“像个AI”，而是“像个初级工程师”。</p>
<p>其次是它变“聪明”了。这里的聪明指的是逻辑推理。在研究生级别的GPQA Diamond测试里，它拿了84%的高分。为了达到这个效果，智谱给它引入了更长的思维链。简单说，就是它在回答你之前，会像人一样在肚子里打草稿，反复推演。虽然这会让计算成本稍微增加一点，但为了那个准确的答案，这点等待是值得的。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-30_00.17.23-1024x359.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-30_00.17.23-1024x359.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/631491ab9a2a4df2b865c3c0cac54469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767630394&amp;x-signature=aQqe8ktaSJwgHyLgtM%2Bv10Lb%2FIM%3D" alt="iShot_2025-12-30_00.17.23" loading="lazy"/></a></p>
<p>还有一个亮点是“听指挥”。在考察智能体工具调用的测试中，它刷新了开源模型的纪录。这意味着，你可以更放心地把API接给它，让它去操作复杂的系统，而不是担心它听不懂指令乱搞一通。</p>
<p><strong>不仅是榜单，更是风向</strong></p>
<p>GLM-4.7发布后的反应很有趣。它不仅在国内火，在国外的Hugging Face上也迅速冲上了全球趋势榜第一。</p>
<p>这说明了什么？说明好东西是没有国界的。美国的AI推理平台Fireworks直接把它称作“了不起的假期礼物”，Vercel这种极客聚集的平台也第一时间宣布接入。</p>
<p>这不仅仅是一个模型的胜利，更像是一个信号。直到2024年，我们在讨论大模型时，还在说“追赶GPT-4”。到了2025年底，当我们看到国产模型在Hard模式的基准测试里，和谷歌、OpenAI的旗舰产品打得有来有回，甚至在开源领域领跑时，这种感觉是很微妙的。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-30_00.17.31-1024x315.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-30_00.17.31-1024x315.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5088da97ec044852a7fa9594d8689a9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767630394&amp;x-signature=WBRUDBjvuRtcmJ4vaggNAmXZJNw%3D" alt="iShot_2025-12-30_00.17.31" loading="lazy"/></a></p>
<p>对于开发者和企业来说，这意味着选择权的转移。你不需要再为了高质量的推理能力去忍受昂贵的闭源API，GLM-4.7提供了一个高性价比、甚至可以说是廉价的替代方案——每百万token不到1美元的推理成本，配上开源第一的能力，这笔账谁都会算。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2Fasfadfsd-1024x297.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/asfadfsd-1024x297.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8ca9b312aad44c3aa2f24ce5f813d55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767630394&amp;x-signature=n8DbDbzImx6KD7GTxncFqg0LefQ%3D" alt="asfadfsd" loading="lazy"/></a></p>
<p>总而言之，GLM-4.7的出现，让2025年的AI竞赛在终局阶段又充满了变数。对于我们使用者来说，这无疑是最好的时代。闭源的高墙还在，但地基已经被开源的铲子挖得越来越松动了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Grit：代码重构利器]]></title>    <link>https://juejin.cn/post/7589092567545233417</link>    <guid>https://juejin.cn/post/7589092567545233417</guid>    <pubDate>2025-12-29T17:46:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589092567545233417" data-draft-id="7589130173838032946" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Grit：代码重构利器"/> <meta itemprop="keywords" content="Rust,性能优化,代码规范"/> <meta itemprop="datePublished" content="2025-12-29T17:46:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="jump_jump"/> <meta itemprop="url" content="https://juejin.cn/user/4230576474692765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Grit：代码重构利器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576474692765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    jump_jump
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T17:46:05.000Z" title="Mon Dec 29 2025 17:46:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>面对需要修改数百个文件的代码迁移，你还在手动一个个改吗？今天介绍一款能让代码批量重构像查找替换一样简单的工具 —— Grit。</p>
</blockquote>
<h2 data-id="heading-0">为什么需要 Grit</h2>
<p>作为开发者，我们经常遇到这样的场景：</p>
<ul>
<li>团队决定统一使用 <code>lodash-es</code> 替代 <code>lodash</code>，需要修改几百个 import 语句</li>
<li>项目要从 React 类组件迁移到 Hooks，涉及上千个组件</li>
<li>某个废弃的 API 需要全面替换，但调用位置散落在代码库各处</li>
</ul>
<p>传统的解决方案各有痛点：</p>

























<table><thead><tr><th>方案</th><th>问题</th></tr></thead><tbody><tr><td>手动修改</td><td>耗时长、易遗漏、容易出错</td></tr><tr><td>正则替换</td><td>不理解代码结构，容易误伤</td></tr><tr><td>jscodeshift</td><td>仅支持 JS/TS，需懂 AST，编写复杂</td></tr><tr><td>find + sed</td><td>脆弱，难以处理复杂场景</td></tr></tbody></table>
<p><strong>Grit</strong> 就是为了解决这些问题而生的 —— 它用声明式的语法，支持多种语言，让任何人都能写出安全的代码转换规则。</p>
<hr/>
<h2 data-id="heading-1">快速开始</h2>
<h3 data-id="heading-2">安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：官方安装脚本</span>
curl -fsSL https://docs.grit.io/install | bash

<span class="hljs-comment"># 方式二：npm 安装</span>
npm install -g @getgrit/cli
</code></pre>
<h3 data-id="heading-3">验证安装</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查版本</span>
grit version

<span class="hljs-comment"># 诊断环境</span>
grit doctor
</code></pre>
<h3 data-id="heading-4">第一个转换</h3>
<p>假设我们要把所有的 <code>console.log</code> 调用删除：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方式一：使用标准库 pattern（推荐）</span>
grit apply no_console_log src/

<span class="hljs-comment"># 方式二：使用内联 pattern</span>
grit apply <span class="hljs-string">'`console.log($_)`'</span> src/

<span class="hljs-comment"># 先预览会改什么（dry-run）</span>
grit apply --dry-run no_console_log src/

<span class="hljs-comment"># 查看某个 pattern 的详细信息</span>
grit patterns describe no_console_log
</code></pre>
<hr/>
<h2 data-id="heading-5">核心命令</h2>
<h3 data-id="heading-6">grit apply - 应用转换</h3>
<p><strong>语法</strong>: <code>grit apply [OPTIONS] &lt;PATTERN&gt; [PATHS]...</code></p>
<p><strong>Pattern 参数形式</strong>：</p>
<ul>
<li>标准库 pattern: <code>no_console_log</code></li>
<li>内联模式: <code>'</code>console.log($_)<code>'</code>（用单引号包裹反引号内的 pattern）</li>
<li>Pattern 文件: <code>./patterns/my_pattern.grit</code></li>
</ul>
<p><strong>常用选项</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 预览模式（不实际修改文件）</span>
grit apply --dry-run no_console_log file.js

<span class="hljs-comment"># 指定语言</span>
grit apply --language python print_to_log file.py

<span class="hljs-comment"># 限制修改数量</span>
grit apply --<span class="hljs-built_in">limit</span> 10 no_console_log src/

<span class="hljs-comment"># 紧凑输出</span>
grit apply --output compact no_console_log src/

<span class="hljs-comment"># 交互式选择（逐个确认）</span>
grit apply --interactive no_console_log src/

<span class="hljs-comment"># JSONL 格式输出</span>
grit apply --jsonl no_console_log src/
</code></pre>
<h3 data-id="heading-7">grit list - 列出可用 Patterns</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有 patterns</span>
grit list

<span class="hljs-comment"># 仅列出 JavaScript/TypeScript patterns</span>
grit list --language js

<span class="hljs-comment"># 仅列出 Python patterns</span>
grit list --language python

<span class="hljs-comment"># 仅列出本地 patterns</span>
grit list --<span class="hljs-built_in">source</span> <span class="hljs-built_in">local</span>
</code></pre>
<h3 data-id="heading-8">grit check - 检查代码</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查当前目录</span>
grit check

<span class="hljs-comment"># 自动修复</span>
grit check --fix

<span class="hljs-comment"># 详细输出</span>
grit check --verbose
</code></pre>
<h3 data-id="heading-9">其他有用命令</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 描述某个 pattern</span>
grit patterns describe no_console_log

<span class="hljs-comment"># 列出 patterns</span>
grit patterns list

<span class="hljs-comment"># 诊断环境</span>
grit doctor
</code></pre>
<hr/>
<h2 data-id="heading-10">核心语法</h2>
<h3 data-id="heading-11">代码片段模式</h3>
<p>最基本的模式是用反引号包裹的代码片段：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.log('Hello')`
</code></pre>
<p><strong>结构化匹配</strong>意味着 Grit 忽略格式差异，以下都会被匹配：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Hello'</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span> ( <span class="hljs-string">'Hello'</span> )     <span class="hljs-comment">// 换行和空格不影响</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"Hello"</span>)         <span class="hljs-comment">// 单双引号等价</span>
</code></pre>
<h3 data-id="heading-12">变量系统</h3>
<p>使用 <code>$</code> 前缀定义变量，匹配任意内容：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.$method($msg)`      // 匹配 console 的任何方法调用
</code></pre>
<p><strong>变量复用规则</strong>：同一变量多次出现必须匹配相同值</p>
<pre><code class="hljs language-gritql" lang="gritql">`$obj &amp;&amp; $obj.$prop()`       // foo &amp;&amp; foo.bar() ✓
                              // foo &amp;&amp; bar.baz()   ✗
</code></pre>
<h3 data-id="heading-13">条件过滤</h3>
<p>使用 <code>where</code> 子句精确控制匹配范围：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.$method($msg)` where {
  $method &lt;: or { `log`, `warn` }    // 只匹配 log 和 warn
}
</code></pre>
<h3 data-id="heading-14">转换语法</h3>
<p>使用 <code>=&gt;</code> 进行代码转换：</p>
<pre><code class="hljs language-gritql" lang="gritql">`旧代码($args)` =&gt; `新代码($args)`
</code></pre>
<hr/>
<h2 data-id="heading-15">实战案例</h2>
<h3 data-id="heading-16">案例 1：清理 console 调试语句</h3>
<p>最简单的场景 —— 直接删除匹配的代码。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'fetching data...'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-string">'state:'</span>, state);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'API called'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Critical error'</span>);  <span class="hljs-comment">// 保留</span>

<span class="hljs-comment">// 转换后</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Critical error'</span>);
</code></pre>
<p><strong>使用标准库 pattern（推荐）</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">grit apply no_console_log src/
</code></pre>
<p><strong>自定义 GritQL 规则</strong>：</p>
<pre><code class="hljs language-gritql" lang="gritql">`console.log($a)` =&gt; ``
`console.debug($a)` =&gt; ``
`console.info($a)` =&gt; ``
</code></pre>
<blockquote>
<p><strong>注意</strong>: 标准库的 <code>no_console_log</code> 会自动保留 catch 块中的 console.log，更加安全。</p>
</blockquote>
<hr/>
<h3 data-id="heading-17">案例 2：Python print 转 logger</h3>
<p>将 Python 中的 <code>print</code> 语句转换为 logger 调用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 转换前</span>
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Hello, World"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"User: <span class="hljs-subst">{username}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"Error:"</span>, error)

<span class="hljs-comment"># 转换后</span>
log(<span class="hljs-string">"Hello, World"</span>)
log(<span class="hljs-string">f"User: <span class="hljs-subst">{username}</span>"</span>)
log(<span class="hljs-string">"Error:"</span>, error)
</code></pre>
<p><strong>使用标准库 pattern</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">grit apply --language python print_to_log src/
</code></pre>
<hr/>
<h3 data-id="heading-18">案例 3：移除 debugger 语句</h3>
<p>清理开发时留下的 debugger 语句。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">debugger</span>;  <span class="hljs-comment">// 调试用</span>
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>);
}

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-keyword">return</span> data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x * <span class="hljs-number">2</span>);
}
</code></pre>
<p><strong>使用标准库 pattern</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">grit apply no_debugger src/
</code></pre>
<hr/>
<h3 data-id="heading-19">案例 4：import 路径调整</h3>
<p>项目目录重构时的常见需求 —— 批量更新 import 路径。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/ui/Button'</span>
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/useAuth'</span>
<span class="hljs-keyword">import</span> { formatDate } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/date'</span>

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/components/Button'</span>
<span class="hljs-keyword">import</span> { useAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/hooks/auth'</span>
<span class="hljs-keyword">import</span> { formatDate } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/format'</span>
</code></pre>
<p><strong>GritQL 规则</strong>：</p>
<pre><code class="hljs language-gritql" lang="gritql">`from '@/components/ui/$name'` =&gt; `from '@/components/$name'`
`from '@/hooks/use$name'` =&gt; `from '@/hooks/$name'`
`from '@/utils/date'` =&gt; `from '@/utils/format'`
</code></pre>
<hr/>
<h3 data-id="heading-20">案例 5：箭头函数简化</h3>
<blockquote>
<p>⚠️ <strong>限制</strong>：内联 pattern 对多参数函数的处理有限制，建议仅用于单参数场景。</p>
</blockquote>
<p>单行返回的箭头函数可以省略 <code>return</code> 和大括号。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">double</span> = x =&gt; { <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>; }
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; { <span class="hljs-keyword">return</span> config.<span class="hljs-property">value</span>; }

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">double</span> = x =&gt; x * <span class="hljs-number">2</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; config.<span class="hljs-property">value</span>
</code></pre>
<p><strong>异步箭头函数</strong>：可以去除 <code>async</code> 和 <code>await</code>（当直接返回 Promise 时）。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; { <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>); }

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getData</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
</code></pre>
<blockquote>
<p><strong>说明</strong>：当函数只是直接返回 <code>await</code> 的结果时，<code>async/await</code> 是冗余的。</p>
</blockquote>
<p><strong>GritQL 规则</strong>：</p>
<pre><code class="hljs language-gritql" lang="gritql"># 单参数箭头函数（推荐）
`$param =&gt; { return $expr }` =&gt; `$param =&gt; $expr`

# 无参数箭头函数
`() =&gt; { return $expr }` =&gt; `() =&gt; $expr`

# 异步箭头函数 - 去除 async/await
`async () =&gt; { return await $expr }` =&gt; `() =&gt; $expr`
</code></pre>
<p><strong>注意</strong>：多参数函数 <code>(a, b) =&gt; ...</code> 的转换存在括号处理问题，建议手动处理或使用 .grit 文件。</p>
<hr/>
<h3 data-id="heading-21">案例 6：框架升级迁移</h3>
<p>Grit 提供了丰富的框架升级 patterns，可自动化常见的迁移工作。</p>
<h4 data-id="heading-22">React 升级</h4>













































<table><thead><tr><th>迁移类型</th><th>Pattern</th><th>命令</th></tr></thead><tbody><tr><td>类组件 → Hooks</td><td><code>react_to_hooks</code></td><td><code>grit apply react_to_hooks src/</code></td></tr><tr><td>React Query v3 → v4</td><td><code>migrating_from_react_query_3_to_react_query_4</code></td><td><code>grit apply migrating_from_react_query_3_to_react_query_4 src/</code></td></tr><tr><td>MUI v4 → v5</td><td><code>mui4_to_mui5</code></td><td><code>grit apply mui4_to_mui5 src/</code></td></tr><tr><td>Knockout → React</td><td><code>knockout_to_react</code></td><td><code>grit apply knockout_to_react src/</code></td></tr><tr><td>Jest → Vitest</td><td><code>jest_to_vitest</code></td><td><code>grit apply jest_to_vitest src/</code></td></tr><tr><td>Chai → Jest</td><td><code>chai_to_jest</code></td><td><code>grit apply chai_to_jest src/</code></td></tr><tr><td>Enzyme → RTL</td><td><code>enzyme_rtl</code></td><td><code>grit apply enzyme_rtl src/</code></td></tr></tbody></table>
<p><strong>React 类组件转 Hooks 示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserList</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  state = { <span class="hljs-attr">users</span>: [], <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> }
  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchUsers</span>()
  }
  <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">loading</span>: <span class="hljs-literal">true</span> })
    api.<span class="hljs-title function_">getUsers</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">users</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ users, <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span> }))
  }
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">loading</span>) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{this.state.users.length} users<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  }
}

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [users, setUsers] = <span class="hljs-title function_">useState</span>([])
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetchUsers</span>()
  }, [])

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUsers</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>)
    api.<span class="hljs-title function_">getUsers</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> { <span class="hljs-title function_">setUsers</span>(data); <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>) })
  }

  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{users.length} users<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
}
</code></pre>
<p><strong>使用命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 预览转换结果</span>
grit apply --dry-run react_to_hooks src/

<span class="hljs-comment"># 执行转换</span>
grit apply react_to_hooks src/

<span class="hljs-comment"># 交互式选择（逐个确认）</span>
grit apply --interactive react_to_hooks src/
</code></pre>
<h4 data-id="heading-23">Vue 升级</h4>
<p>Vue 相关的迁移 pattern 较少，建议手动或配合其他工具进行 Vue 2 → Vue 3 的升级。</p>
<h4 data-id="heading-24">其他迁移</h4>








































<table><thead><tr><th>迁移类型</th><th>Pattern</th><th>命令</th></tr></thead><tbody><tr><td>Cypress → Playwright</td><td><code>cypress_to_playwright</code></td><td><code>grit apply cypress_to_playwright src/</code></td></tr><tr><td>Protractor → Playwright</td><td><code>protractor_to_playwright</code></td><td><code>grit apply protractor_to_playwright src/</code></td></tr><tr><td>CodeceptJS → Playwright</td><td><code>codecept_to_playwright</code></td><td><code>grit apply codecept_to_playwright src/</code></td></tr><tr><td>Moment → date-fns</td><td><code>moment_to_datefns</code></td><td><code>grit apply moment_to_datefns src/</code></td></tr><tr><td>io-ts → Zod</td><td><code>iots_to_zod</code></td><td><code>grit apply iots_to_zod src/</code></td></tr><tr><td>OpenAI v3 → v4</td><td><code>openai_v4</code></td><td><code>grit apply openai_v4 src/</code></td></tr></tbody></table>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Jest 迁移到 Vitest</span>
grit apply --dry-run jest_to_vitest src/
grit apply jest_to_vitest src/

<span class="hljs-comment"># OpenAI SDK 升级</span>
grit apply --dry-run openai_v4 src/
grit apply openai_v4 src/

<span class="hljs-comment"># 测试框架迁移（Cypress → Playwright）</span>
grit apply --dry-run cypress_to_playwright tests/
grit apply cypress_to_playwright tests/
</code></pre>
<hr/>
<h3 data-id="heading-25">案例 7：对象简写属性</h3>
<blockquote>
<p>⚠️ <strong>限制</strong>：必须使用 <code>.grit</code> 文件，内联语法不支持，且转换后需要人工检查。</p>
</blockquote>
<p>ES6 允许属性名和变量名相同时省略冒号。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 转换前</span>
<span class="hljs-keyword">const</span> user = { <span class="hljs-attr">name</span>: name, <span class="hljs-attr">age</span>: age, <span class="hljs-attr">userId</span>: id }
<span class="hljs-keyword">return</span> { <span class="hljs-attr">data</span>: data, <span class="hljs-attr">isLoading</span>: loading }

<span class="hljs-comment">// 转换后</span>
<span class="hljs-keyword">const</span> user = { name, age, <span class="hljs-attr">userId</span>: id }
<span class="hljs-keyword">return</span> { data, <span class="hljs-attr">isLoading</span>: loading }
</code></pre>
<p><strong>创建 <code>shorthand.grit</code> 文件</strong>：</p>
<pre><code class="hljs language-grit" lang="grit"># 指定使用的引擎版本（marzano 是 Grit 的匹配引擎）
engine marzano(0.1)
# 指定目标语言
language js

`{ $props }` where {
  $props &lt;: some {
    `$k: $k` =&gt; `$k`
  }
}
</code></pre>
<blockquote>
<p><strong><code>engine marzano(0.1)</code></strong>：Grit 的匹配引擎版本，所有 <code>.grit</code> 文件都需要在开头声明。</p>
</blockquote>
<p><strong>使用方式</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 应用转换（可能需要运行多次直到所有属性都转换完成）</span>
grit apply shorthand.grit src/
</code></pre>
<p><strong>测试结果</strong>：</p>
<ul>
<li>✅ 可以匹配并转换 <code>{ name: name }</code> → <code>{ name }</code></li>
<li>⚠️ 多个属性需要运行多次才能全部转换</li>
<li>⚠️ 转换后建议人工检查结果</li>
</ul>
<hr/>
<h2 data-id="heading-26">常用标准 Patterns</h2>
<p>Grit 提供了丰富的标准 patterns 库，使用 <code>grit list</code> 查看。</p>
<h3 data-id="heading-27">JavaScript/TypeScript 常用 Patterns</h3>























































<table><thead><tr><th>Pattern</th><th>说明</th><th>命令</th></tr></thead><tbody><tr><td><code>no_console_log</code></td><td>移除 <code>console.log</code></td><td><code>grit apply no_console_log</code></td></tr><tr><td><code>no_debugger</code></td><td>移除 <code>debugger</code></td><td><code>grit apply no_debugger</code></td></tr><tr><td><code>no_alert</code></td><td>移除 <code>alert()</code></td><td><code>grit apply no_alert</code></td></tr><tr><td><code>no_commented_out_code</code></td><td>移除注释代码</td><td><code>grit apply no_commented_out_code</code></td></tr><tr><td><code>es6_imports</code></td><td>转换为 ES6 imports</td><td><code>grit apply es6_imports</code></td></tr><tr><td><code>es6_exports</code></td><td>转换为 ES6 exports</td><td><code>grit apply es6_exports</code></td></tr><tr><td><code>jest_to_vitest</code></td><td>Jest 迁移到 Vitest</td><td><code>grit apply jest_to_vitest</code></td></tr><tr><td><code>chai_to_jest</code></td><td>Chai 迁移到 Jest</td><td><code>grit apply chai_to_jest</code></td></tr><tr><td><code>openai_v4</code></td><td>OpenAI v4 迁移</td><td><code>grit apply openai_v4</code></td></tr></tbody></table>
<h3 data-id="heading-28">Python 常用 Patterns</h3>






























<table><thead><tr><th>Pattern</th><th>说明</th><th>命令</th></tr></thead><tbody><tr><td><code>print_to_log</code></td><td>print 转 logger</td><td><code>grit apply --language python print_to_log</code></td></tr><tr><td><code>py_no_debugger</code></td><td>移除 <code>pdb.set_trace()</code></td><td><code>grit apply py_no_debugger</code></td></tr><tr><td><code>no_skipped_tests</code></td><td>移除跳过的测试</td><td><code>grit apply no_skipped_tests</code></td></tr><tr><td><code>openai</code></td><td>OpenAI SDK 迁移</td><td><code>grit apply openai</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-29">支持的语言</h2>
<p>Grit 支持以下编程语言（使用 <code>--language</code> 选项指定）：</p>
<h3 data-id="heading-30">语言列表</h3>

























































































<table><thead><tr><th>标识符</th><th>语言</th></tr></thead><tbody><tr><td><code>js</code></td><td>JavaScript / TypeScript / JSX / TSX</td></tr><tr><td><code>html</code></td><td>HTML</td></tr><tr><td><code>css</code></td><td>CSS</td></tr><tr><td><code>json</code></td><td>JSON</td></tr><tr><td><code>java</code></td><td>Java</td></tr><tr><td><code>kotlin</code></td><td>Kotlin</td></tr><tr><td><code>csharp</code></td><td>C#</td></tr><tr><td><code>python</code></td><td>Python</td></tr><tr><td><code>markdown</code></td><td>Markdown</td></tr><tr><td><code>go</code></td><td>Go</td></tr><tr><td><code>rust</code></td><td>Rust</td></tr><tr><td><code>ruby</code></td><td>Ruby</td></tr><tr><td><code>elixir</code></td><td>Elixir</td></tr><tr><td><code>solidity</code></td><td>Solidity</td></tr><tr><td><code>hcl</code></td><td>HCL</td></tr><tr><td><code>yaml</code></td><td>YAML</td></tr><tr><td><code>sql</code></td><td>SQL</td></tr><tr><td><code>vue</code></td><td>Vue</td></tr><tr><td><code>toml</code></td><td>TOML</td></tr><tr><td><code>php</code></td><td>PHP</td></tr></tbody></table>
<h3 data-id="heading-31">使用示例</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Python 项目 - 将 print 转换为 logger</span>
grit apply --language python print_to_log src/

<span class="hljs-comment"># Go 项目 - 移除 debugger 语句</span>
grit apply --language go no_debugger src/

<span class="hljs-comment"># Java 项目 - 列出可用的 Java patterns</span>
grit list --language java

<span class="hljs-comment"># Rust 项目 - 应用自定义 pattern</span>
grit apply --language rust ./patterns/custom.grit src/

<span class="hljs-comment"># Vue 项目 - 检查代码规范</span>
grit check --language vue src/

<span class="hljs-comment"># 多语言项目 - 同时处理多种文件类型</span>
grit apply --language js no_console_log src/
grit apply --language python print_to_log src/

<span class="hljs-comment"># 查看某个语言的可用 patterns</span>
grit patterns list --language python
</code></pre>
<hr/>
<h2 data-id="heading-32">工作流最佳实践</h2>
<h3 data-id="heading-33">推荐工作流程</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 1. 列出可用的 patterns</span>
grit list --language js

<span class="hljs-comment"># 2. 查看 pattern 详情</span>
grit patterns describe no_console_log

<span class="hljs-comment"># 3. 预览模式（不会修改文件）</span>
grit apply --dry-run no_console_log src/

<span class="hljs-comment"># 4. 限制范围测试</span>
grit apply no_console_log src/components/

<span class="hljs-comment"># 5. 交互式应用（逐个确认）</span>
grit apply --interactive no_console_log src/

<span class="hljs-comment"># 6. 确认后正式应用</span>
grit apply no_console_log src/
</code></pre>
<h3 data-id="heading-34">使用配置文件</h3>
<p>创建 <code>.grit/grit.yaml</code> 管理项目规则：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">patterns:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">no_console_log</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">no_debugger</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">.grit/patterns/**/*.grit</span>

<span class="hljs-attr">ignored:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">node_modules/**</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">dist/**</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">build/**</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"**/*.min.js"</span>

<span class="hljs-attr">enforcement:</span>
  <span class="hljs-attr">level:</span> <span class="hljs-string">fix</span>
</code></pre>
<h3 data-id="heading-35">CI 集成</h3>
<p>在 GitHub Actions 中集成代码检查：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Grit</span> <span class="hljs-string">Code</span> <span class="hljs-string">Quality</span>

<span class="hljs-attr">on:</span> [<span class="hljs-string">pull_request</span>]

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">grit-check:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">Grit</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">install</span> <span class="hljs-string">-g</span> <span class="hljs-string">@getgrit/cli</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Check</span> <span class="hljs-string">code</span> <span class="hljs-string">patterns</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">grit</span> <span class="hljs-string">check</span> <span class="hljs-string">--github-actions</span>
</code></pre>
<hr/>
<h2 data-id="heading-36">工作原理</h2>
<h3 data-id="heading-37">处理流程</h3>
<pre><code class="hljs language-scss" lang="scss">源代码
    ↓
┌─────────────────────────────────────┐
│  Tree-sitter 解析器                 │
│  (多语言支持，增量解析)              │
└─────────────────────────────────────┘
    ↓ AST
┌─────────────────────────────────────┐
│  Grit 模式匹配引擎                  │
│  (变量绑定，条件过滤)                │
└─────────────────────────────────────┘
    ↓ 匹配结果
┌─────────────────────────────────────┐
│  AST 转换引擎                       │
│  (语义保持，结构转换)                │
└─────────────────────────────────────┘
    ↓ 修改后的 AST
┌─────────────────────────────────────┐
│  代码生成器                         │
│  (保留格式，生成代码)                │
└─────────────────────────────────────┘
    ↓
转换后代码
</code></pre>
<h3 data-id="heading-38">为什么比正则更安全？</h3>



































<table><thead><tr><th>特性</th><th>正则表达式</th><th>Grit</th></tr></thead><tbody><tr><td>理解代码结构</td><td>❌</td><td>✅</td></tr><tr><td>忽略空白/引号差异</td><td>❌</td><td>✅</td></tr><tr><td>变量绑定与复用</td><td>❌</td><td>✅</td></tr><tr><td>AST 感知</td><td>❌</td><td>✅</td></tr><tr><td>语义安全</td><td>❌</td><td>✅</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-39">常见问题</h2>
<p><strong>Q: 转换会破坏代码格式吗？</strong></p>
<p>A: 不会。Grit 保留原始格式，只修改语义结构。</p>
<p><strong>Q: 内联 pattern 怎么写？</strong></p>
<p>A: 使用单引号包裹整个 pattern（反引号内是匹配代码）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 正确 - 单引号包裹，shell 不会解析反引号</span>
grit apply <span class="hljs-string">'`console.log($_)`'</span> file.js

<span class="hljs-comment"># 错误 - shell 会尝试执行反引号内的命令</span>
grit apply `console.log(<span class="hljs-variable">$_</span>)` file.js
</code></pre>
<p><strong>Q: 如何查看所有可用的 patterns？</strong></p>
<p>A: 使用 <code>grit list</code> 命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 列出所有</span>
grit list

<span class="hljs-comment"># 按语言过滤</span>
grit list --language js
grit list --language python
</code></pre>
<p><strong>Q: <code>--json</code> 和 <code>--jsonl</code> 有什么区别？</strong></p>
<p>A: <code>--json</code> 目前不被 <code>apply_pattern</code> 支持，使用 <code>--jsonl</code> 获取 JSON Lines 格式输出。</p>
<p><strong>Q: 如何限制修改数量？</strong></p>
<p>A: 使用 <code>--limit</code> 选项：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只修改前 10 处</span>
grit apply --<span class="hljs-built_in">limit</span> 10 no_console_log src/
</code></pre>
<p><strong>Q: 如何安全地进行大规模转换？</strong></p>
<p>A: 建议按以下步骤：</p>
<ol>
<li>先用 <code>--dry-run</code> 预览</li>
<li>用 <code>--limit</code> 小范围测试</li>
<li>用 <code>--interactive</code> 交互式确认</li>
<li>确认无误后正式应用</li>
</ol>
<hr/>
<h2 data-id="heading-40">总结</h2>
<p>Grit 的核心价值在于：</p>
<ol>
<li><strong>简单</strong> - 用代码片段写规则，无需懂 AST</li>
<li><strong>安全</strong> - 结构化匹配，不会误伤代码</li>
<li><strong>高效</strong> - 秒级完成大规模代码迁移</li>
<li><strong>可维护</strong> - 规则即文档，易于 review</li>
<li><strong>丰富</strong> - 内置大量标准 patterns，开箱即用</li>
</ol>
<p>下次遇到代码迁移任务，不妨试试 Grit，让繁琐的重构工作变得轻松高效。</p>
<hr/>
<h2 data-id="heading-41">参考资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgrit.io%2F" target="_blank" title="https://grit.io/" ref="nofollow noopener noreferrer">Grit 官网</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.grit.io%2F" target="_blank" title="https://docs.grit.io/" ref="nofollow noopener noreferrer">Grit 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbiomejs%2Fgritql-stdlib" target="_blank" title="https://github.com/biomejs/gritql-stdlib" ref="nofollow noopener noreferrer">Grit 标准 Patterns 库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbiomejs%2Fgritql" target="_blank" title="https://github.com/biomejs/gritql" ref="nofollow noopener noreferrer">Grit GitHub</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解 C#.NET Interlocked.Increment：原子操作的核心]]></title>    <link>https://juejin.cn/post/7589110783147442210</link>    <guid>https://juejin.cn/post/7589110783147442210</guid>    <pubDate>2025-12-30T00:00:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589110783147442210" data-draft-id="7589156297788522531" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解 C#.NET Interlocked.Increment：原子操作的核心"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-30T00:00:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解 C#.NET Interlocked.Increment：原子操作的核心
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-30T00:00:34.000Z" title="Tue Dec 30 2025 00:00:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-30
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>Interlocked.Increment</code> 是 <code>.NET</code> 中一个重要的线程安全操作方法，用于以原子方式递增变量的值。它位于 <code>System.Threading</code> 命名空间中，提供了一种轻量级的线程同步机制。</p>
<p>这些方法包括：</p>

































<table><thead><tr><th>方法</th><th>作用</th></tr></thead><tbody><tr><td><code>Increment(ref int location)</code></td><td>原子 +1</td></tr><tr><td><code>Decrement(ref int location)</code></td><td>原子 -1</td></tr><tr><td><code>Add(ref int location, int value)</code></td><td>原子加指定值</td></tr><tr><td><code>Exchange(ref T location, T value)</code></td><td>原子交换值</td></tr><tr><td><code>CompareExchange(ref T location, T value, T comparand)</code></td><td>CAS 操作（Compare-And-Swap）</td></tr><tr><td><code>Read(ref long location)</code></td><td>原子读取 long 值</td></tr></tbody></table>
<p>这些操作都是 线程安全且无锁 (<code>lock-free</code>) 的。</p>
<h3 data-id="heading-1">核心概念与作用</h3>
<h4 data-id="heading-2">原子操作定义</h4>
<ul>
<li>
<p>不可分割性：操作要么完全执行，要么完全不执行</p>
</li>
<li>
<p>线程安全：多线程环境下保证操作完整性</p>
</li>
<li>
<p>无锁机制：避免传统锁带来的性能开销</p>
</li>
</ul>
<h4 data-id="heading-3">核心特性</h4>

























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>线程安全</td><td>无需额外同步机制</td></tr><tr><td>硬件级原子性</td><td>使用 CPU 原子指令实现</td></tr><tr><td>内存屏障</td><td>确保操作前后内存一致性</td></tr><tr><td>高性能</td><td>比锁机制快 10-50 倍</td></tr></tbody></table>
<h3 data-id="heading-4">底层实现原理</h3>
<h4 data-id="heading-5">x86/x64 架构实现</h4>
<pre><code class="hljs language-Assembly" lang="Assembly">; x86 实现
lock xadd [location], eax

; x64 实现
lock xadd [location], rax
</code></pre>
<ul>
<li>
<p><code>lock</code> 前缀：锁定内存总线，确保操作原子性</p>
</li>
<li>
<p><code>xadd</code> 指令：交换并相加寄存器与内存值</p>
</li>
</ul>
<h3 data-id="heading-6">基本用法</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _counter = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        <span class="hljs-keyword">var</span> threads = <span class="hljs-keyword">new</span> Thread[<span class="hljs-number">10</span>];

        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++)
        {
            threads[i] = <span class="hljs-keyword">new</span> Thread(IncrementCounter);
            threads[i].Start();
        }

        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> t <span class="hljs-keyword">in</span> threads)
            t.Join();

        Console.WriteLine(<span class="hljs-string">$"最终计数值: <span class="hljs-subst">{_counter}</span>"</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">IncrementCounter</span>()</span>
    {
        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++)
        {
            Interlocked.Increment(<span class="hljs-keyword">ref</span> _counter);
        }
    }
}
</code></pre>
<p>输出：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">最终计数值: 10000</span>
</code></pre>
<p>即使多个线程并发操作同一个变量，也不会出现竞争问题。</p>
<h3 data-id="heading-7">为什么不能直接用 _counter++</h3>
<p><code>_counter++</code> 实际上是三步操作：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> temp = _counter;
temp = temp + <span class="hljs-number">1</span>;
_counter = temp;
</code></pre>
<p>在多线程环境中，这三步可能被打断，比如：</p>





















<table><thead><tr><th>线程A</th><th>线程B</th></tr></thead><tbody><tr><td>读取 <code>_counter = 0</code></td><td>读取 <code>_counter = 0</code></td></tr><tr><td>+1 → <code>1</code></td><td>+1 → <code>1</code></td></tr><tr><td>写回 <code>_counter = 1</code></td><td>写回 <code>_counter = 1</code></td></tr></tbody></table>
<p>最终 <code>_counter = 1</code>，而不是 2。
这就是竞争条件（<code>race condition</code>）。</p>
<p><code>Interlocked.Increment</code> 内部使用 <code>CPU</code> 的原子指令（如 <code>x86</code> 的 <code>LOCK INC</code>），
确保操作不可中断，因此绝对线程安全。</p>
<h3 data-id="heading-8">返回值</h3>
<p><code>Interlocked.Increment</code> 会返回自增后的值：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> count = <span class="hljs-number">0</span>;
<span class="hljs-built_in">int</span> newValue = Interlocked.Increment(<span class="hljs-keyword">ref</span> count);

Console.WriteLine(newValue); <span class="hljs-comment">// 1</span>
Console.WriteLine(count);    <span class="hljs-comment">// 1</span>
</code></pre>
<p>所以它可以直接用于生成唯一 <code>ID</code>、计数等逻辑。</p>
<h3 data-id="heading-9">支持的类型</h3>





























<table><thead><tr><th>方法</th><th>支持的类型</th></tr></thead><tbody><tr><td><code>Interlocked.Increment</code></td><td><code>int</code>, <code>long</code></td></tr><tr><td><code>Interlocked.Decrement</code></td><td><code>int</code>, <code>long</code></td></tr><tr><td><code>Interlocked.Add</code></td><td><code>int</code>, <code>long</code></td></tr><tr><td><code>Interlocked.Exchange</code></td><td><code>int</code>, <code>long</code>, <code>float</code>, <code>double</code>, <code>object</code></td></tr><tr><td><code>Interlocked.CompareExchange</code></td><td>同上</td></tr></tbody></table>
<h3 data-id="heading-10">性能分析</h3>
<p>相比于使用 <code>lock</code> 的同步方式：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">lock</span>(_lockObj)
{
    _counter++;
}
</code></pre>
<p><code>Interlocked.Increment</code>：</p>
<p>✅ 无锁操作（<code>Lock-free</code>）
✅ 内核级原子性（基于 <code>CPU</code> 指令）
✅ 极高性能（纳秒级）</p>
<p>实测在多线程计数场景中性能提升 5~10 倍以上。
非常适合高频次计数（如统计请求量、日志写入次数、对象实例数）。</p>
<h3 data-id="heading-11">完整的原子操作方法集</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;
<span class="hljs-keyword">using</span> System.Threading;

<span class="hljs-keyword">class</span> <span class="hljs-title">InterlockedCompleteExample</span>
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _counter = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">long</span> _bigCounter = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _value = <span class="hljs-number">10</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">object</span> _syncObject = <span class="hljs-keyword">new</span> <span class="hljs-built_in">object</span>();

    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DemonstrateAllMethods</span>()</span>
    {
        <span class="hljs-comment">// 1. Increment - 递增</span>
        <span class="hljs-built_in">int</span> result1 = Interlocked.Increment(<span class="hljs-keyword">ref</span> _counter);
        Console.WriteLine(<span class="hljs-string">$"After Increment: <span class="hljs-subst">{_counter}</span>, Returned: <span class="hljs-subst">{result1}</span>"</span>);

        <span class="hljs-comment">// 2. Decrement - 递减</span>
        <span class="hljs-built_in">int</span> result2 = Interlocked.Decrement(<span class="hljs-keyword">ref</span> _counter);
        Console.WriteLine(<span class="hljs-string">$"After Decrement: <span class="hljs-subst">{_counter}</span>, Returned: <span class="hljs-subst">{result2}</span>"</span>);

        <span class="hljs-comment">// 3. Add - 加法</span>
        <span class="hljs-built_in">int</span> result3 = Interlocked.Add(<span class="hljs-keyword">ref</span> _counter, <span class="hljs-number">5</span>);
        Console.WriteLine(<span class="hljs-string">$"After Add(5): <span class="hljs-subst">{_counter}</span>, Returned: <span class="hljs-subst">{result3}</span>"</span>);

        <span class="hljs-comment">// 4. Exchange - 交换</span>
        <span class="hljs-built_in">int</span> original = Interlocked.Exchange(<span class="hljs-keyword">ref</span> _value, <span class="hljs-number">20</span>);
        Console.WriteLine(<span class="hljs-string">$"After Exchange: <span class="hljs-subst">{_value}</span>, Original: <span class="hljs-subst">{original}</span>"</span>);

        <span class="hljs-comment">// 5. CompareExchange - 比较并交换</span>
        <span class="hljs-built_in">int</span> comparand = <span class="hljs-number">20</span>;
        <span class="hljs-built_in">int</span> newValue = <span class="hljs-number">30</span>;
        <span class="hljs-built_in">int</span> result5 = Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> _value, newValue, comparand);
        Console.WriteLine(<span class="hljs-string">$"After CompareExchange: <span class="hljs-subst">{_value}</span>, Returned: <span class="hljs-subst">{result5}</span>"</span>);

        <span class="hljs-comment">// 6. Read - 读取 long 类型（确保在32位系统上原子读取）</span>
        <span class="hljs-built_in">long</span> readResult = Interlocked.Read(<span class="hljs-keyword">ref</span> _bigCounter);
        Console.WriteLine(<span class="hljs-string">$"Read long value: <span class="hljs-subst">{readResult}</span>"</span>);

        <span class="hljs-comment">// 7. And - 位与操作（.NET 5+）</span>
        <span class="hljs-comment">// Interlocked.And(ref _value, 0x0F);</span>

        <span class="hljs-comment">// 8. Or - 位或操作（.NET 5+）</span>
        <span class="hljs-comment">// Interlocked.Or(ref _value, 0xF0);</span>
    }
}
</code></pre>
<h3 data-id="heading-12">典型应用场景</h3>
<h4 data-id="heading-13">多线程计数器</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _activeConnections;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnClientConnect</span>()</span>
{
    <span class="hljs-keyword">var</span> current = Interlocked.Increment(<span class="hljs-keyword">ref</span> _activeConnections);
    Console.WriteLine(<span class="hljs-string">$"连接数增加到 <span class="hljs-subst">{current}</span>"</span>);
}

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnClientDisconnect</span>()</span>
{
    <span class="hljs-keyword">var</span> current = Interlocked.Decrement(<span class="hljs-keyword">ref</span> _activeConnections);
    Console.WriteLine(<span class="hljs-string">$"连接数减少到 <span class="hljs-subst">{current}</span>"</span>);
}
</code></pre>
<h4 data-id="heading-14">分配唯一自增 ID</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _nextId = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> <span class="hljs-title">GetNextId</span>()</span>
{
    <span class="hljs-keyword">return</span> Interlocked.Increment(<span class="hljs-keyword">ref</span> _nextId);
}
</code></pre>
<h4 data-id="heading-15">控制并发访问次数</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _running = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">ProcessAsync</span>()</span>
{
    <span class="hljs-keyword">if</span> (Interlocked.Increment(<span class="hljs-keyword">ref</span> _running) &gt; <span class="hljs-number">5</span>)
    {
        Console.WriteLine(<span class="hljs-string">"超过并发限制，拒绝执行"</span>);
        Interlocked.Decrement(<span class="hljs-keyword">ref</span> _running);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">try</span>
    {
        <span class="hljs-keyword">await</span> DoWorkAsync();
    }
    <span class="hljs-keyword">finally</span>
    {
        Interlocked.Decrement(<span class="hljs-keyword">ref</span> _running);
    }
}
</code></pre>
<h3 data-id="heading-16">高级用法</h3>
<h4 data-id="heading-17">无锁栈实现</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">LockFreeStack</span>&lt;<span class="hljs-title">T</span>&gt;
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>
    {
        <span class="hljs-keyword">public</span> T Value { <span class="hljs-keyword">get</span>; }
        <span class="hljs-keyword">public</span> Node Next { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span>(<span class="hljs-params">T <span class="hljs-keyword">value</span></span>)</span>
        {
            Value = <span class="hljs-keyword">value</span>;
        }
    }

    <span class="hljs-keyword">private</span> Node _head;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Push</span>(<span class="hljs-params">T <span class="hljs-keyword">value</span></span>)</span>
    {
        <span class="hljs-keyword">var</span> newNode = <span class="hljs-keyword">new</span> Node(<span class="hljs-keyword">value</span>);
        Node oldHead;
        <span class="hljs-keyword">do</span>
        {
            oldHead = _head;
            newNode.Next = oldHead;
        }
        <span class="hljs-keyword">while</span> (Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> _head, newNode, oldHead) != oldHead);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> <span class="hljs-title">TryPop</span>(<span class="hljs-params"><span class="hljs-keyword">out</span> T <span class="hljs-keyword">value</span></span>)</span>
    {
        Node oldHead;
        <span class="hljs-keyword">do</span>
        {
            oldHead = _head;
            <span class="hljs-keyword">if</span> (oldHead == <span class="hljs-literal">null</span>)
            {
                <span class="hljs-keyword">value</span> = <span class="hljs-literal">default</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        }
        <span class="hljs-keyword">while</span> (Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> _head, oldHead.Next, oldHead) != oldHead);

        <span class="hljs-keyword">value</span> = oldHead.Value;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsEmpty =&gt; _head == <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-18">线程安全的对象池</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ObjectPool</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-keyword">where</span> <span class="hljs-title">T</span> : <span class="hljs-keyword">class</span>, <span class="hljs-title">new</span>()
{
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Node</span>
    {
        <span class="hljs-keyword">public</span> T Value { <span class="hljs-keyword">get</span>; }
        <span class="hljs-keyword">public</span> Node Next { <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; }

        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Node</span>(<span class="hljs-params">T <span class="hljs-keyword">value</span></span>)</span>
        {
            Value = <span class="hljs-keyword">value</span>;
        }
    }

    <span class="hljs-keyword">private</span> Node _head;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">int</span> _count = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-built_in">int</span> _maxSize;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">ObjectPool</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> maxSize = <span class="hljs-number">100</span></span>)</span>
    {
        _maxSize = maxSize;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Return</span>(<span class="hljs-params">T item</span>)</span>
    {
        <span class="hljs-keyword">if</span> (Interlocked.Read(<span class="hljs-keyword">ref</span> _count) &gt;= _maxSize)
        {
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 池已满，丢弃对象</span>
        }

        <span class="hljs-keyword">var</span> newNode = <span class="hljs-keyword">new</span> Node(item);
        Node oldHead;
        <span class="hljs-keyword">do</span>
        {
            oldHead = _head;
            newNode.Next = oldHead;
        }
        <span class="hljs-keyword">while</span> (Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> _head, newNode, oldHead) != oldHead);

        Interlocked.Increment(<span class="hljs-keyword">ref</span> _count);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">Get</span>()</span>
    {
        Node oldHead;
        <span class="hljs-keyword">do</span>
        {
            oldHead = _head;
            <span class="hljs-keyword">if</span> (oldHead == <span class="hljs-literal">null</span>)
            {
                Interlocked.Increment(<span class="hljs-keyword">ref</span> _count);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> T();
            }
        }
        <span class="hljs-keyword">while</span> (Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> _head, oldHead.Next, oldHead) != oldHead);

        Interlocked.Decrement(<span class="hljs-keyword">ref</span> _count);
        <span class="hljs-keyword">return</span> oldHead.Value;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">int</span> Count =&gt; (<span class="hljs-built_in">int</span>)Interlocked.Read(<span class="hljs-keyword">ref</span> _count);
}
</code></pre>
<h3 data-id="heading-19">与 lock、Monitor 的区别</h3>



































<table><thead><tr><th>特性</th><th>Interlocked</th><th>lock / Monitor</th></tr></thead><tbody><tr><td>是否锁住线程</td><td>否</td><td>是</td></tr><tr><td>原子性</td><td>✅</td><td>✅</td></tr><tr><td>是否可中断</td><td>不可</td><td>可被其他线程等待</td></tr><tr><td>性能</td><td>极高</td><td>一般</td></tr><tr><td>适用场景</td><td>简单数值、指针操作</td><td>多步复杂逻辑</td></tr></tbody></table>
<ul>
<li>
<p>如果只是“计数/标志位更新”，用 <code>Interlocked</code>；</p>
</li>
<li>
<p>如果涉及多个变量或逻辑组合，用 <code>lock</code>。</p>
</li>
</ul>
<h3 data-id="heading-20">CompareExchange (CAS) 补充理解</h3>
<p><code>Interlocked.CompareExchange</code> 是构建更复杂无锁结构的核心：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span> location = <span class="hljs-number">0</span>;
<span class="hljs-built_in">int</span> newValue = <span class="hljs-number">1</span>;
<span class="hljs-built_in">int</span> expected = <span class="hljs-number">0</span>;

<span class="hljs-built_in">int</span> old = Interlocked.CompareExchange(<span class="hljs-keyword">ref</span> location, newValue, expected);
</code></pre>
<ul>
<li>
<p>如果 <code>location == expected</code> → 把 <code>location</code> 改成 <code>newValue</code>；</p>
</li>
<li>
<p>否则什么都不做；</p>
</li>
<li>
<p>返回修改前的旧值。</p>
</li>
</ul>
<p>这就是经典的 <code>Compare-And-Swap</code> (CAS)，
是无锁队列、无锁堆栈、无锁缓存等的基础原语。</p>
<h3 data-id="heading-21">与 async/await 的结合注意事项</h3>
<p><code>Interlocked</code> 是同步原子操作，适用于多线程并发，不涉及异步上下文。
即使在 <code>async</code> 方法中使用，也完全没问题：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">int</span> _count;

<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task <span class="hljs-title">LogAsync</span>()</span>
{
    Interlocked.Increment(<span class="hljs-keyword">ref</span> _count);
    <span class="hljs-keyword">await</span> File.AppendAllTextAsync(<span class="hljs-string">"log.txt"</span>, <span class="hljs-string">$"<span class="hljs-subst">{_count}</span>\n"</span>);
}
</code></pre>
<ul>
<li>
<p>它不会保证异步顺序；</p>
</li>
<li>
<p>它保证计数线程安全。</p>
</li>
</ul>
<h3 data-id="heading-22">总结</h3>









































<table><thead><tr><th>特性</th><th>Interlocked.Increment</th></tr></thead><tbody><tr><td>命名空间</td><td><code>System.Threading</code></td></tr><tr><td>返回值</td><td>自增后的值</td></tr><tr><td>线程安全</td><td>✅ 原子操作</td></tr><tr><td>锁机制</td><td>无锁</td></tr><tr><td>支持类型</td><td><code>int</code>, <code>long</code></td></tr><tr><td>性能</td><td>极高</td></tr><tr><td>应用场景</td><td>计数、ID生成、并发控制、原子状态更新</td></tr><tr><td>替代方案</td><td>lock、Monitor、Volatile、CAS</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[旮旯c语言三个任务]]></title>    <link>https://juejin.cn/post/7589130173837951026</link>    <guid>https://juejin.cn/post/7589130173837951026</guid>    <pubDate>2025-12-29T16:05:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589130173837951026" data-draft-id="7587412021709127686" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="旮旯c语言三个任务"/> <meta itemprop="keywords" content="C,C++"/> <meta itemprop="datePublished" content="2025-12-29T16:05:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="宇宙超级无敌暴龙战士"/> <meta itemprop="url" content="https://juejin.cn/user/2781133666269578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            旮旯c语言三个任务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2781133666269578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    宇宙超级无敌暴龙战士
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T16:05:37.000Z" title="Mon Dec 29 2025 16:05:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02d6f49c4b68490ea4ca3949164e24f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a6H5a6Z6LaF57qn5peg5pWM5pq06b6Z5oiY5aOr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767629137&amp;x-signature=Ym9Xx0qSbkabDeGR4P%2FJHqB5pQM%3D" alt="image.png" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#include &lt;stdio.h&gt;</span>

// 任务1：计算数组元素和
int getArrSum(int arr<span class="hljs-section">[]</span>, int len) {
    int <span class="hljs-attr">sum</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; len; i++) {</span>
        sum += arr<span class="hljs-section">[i]</span><span class="hljs-comment">;</span>
    }
    return sum<span class="hljs-comment">;</span>
}

// 任务2：获取数组最大值
int getArrMax(int arr<span class="hljs-section">[]</span>, int len) {
    int <span class="hljs-attr">max</span> = arr[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">1</span><span class="hljs-comment">; i &lt; len; i++) {</span>
        if (arr<span class="hljs-section">[i]</span> &gt; max) {
            <span class="hljs-attr">max</span> = arr[i]<span class="hljs-comment">;</span>
        }
    }
    return max<span class="hljs-comment">;</span>
}

// 任务3：查找元素下标
int findArrValue(int arr<span class="hljs-section">[]</span>, int len, int val) {
    for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; len; i++) {</span>
        if (arr<span class="hljs-section">[i]</span> == val) {
            return i<span class="hljs-comment">;</span>
        }
    }
    return -1<span class="hljs-comment">;</span>
}

// 程序入口main函数
int main() {
    int arr<span class="hljs-section">[]</span> = {1, 2, 3, 4, 5}<span class="hljs-comment">;</span>
    int <span class="hljs-attr">len</span> = <span class="hljs-number">5</span><span class="hljs-comment">;</span>
    
    // 测试任务1
    printf("数组和：%d\n", getArrSum(arr, len))<span class="hljs-comment">;</span>
    // 测试任务2
    printf("数组最大值：%d\n", getArrMax(arr, len))<span class="hljs-comment">;</span>
    // 测试任务3
    printf("元素3的下标：%d\n", findArrValue(arr, len, 3))<span class="hljs-comment">;</span>
    
    return 0<span class="hljs-comment">;</span>
}
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a93fbbb1404b406caaa12a1047dc20a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a6H5a6Z6LaF57qn5peg5pWM5pq06b6Z5oiY5aOr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767629137&amp;x-signature=z5KUp2qGpi1Tq7GIHwj66Mf9gPE%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用Amazon Nova模型实现自动化视频高光剪辑]]></title>    <link>https://juejin.cn/post/7589104492883394612</link>    <guid>https://juejin.cn/post/7589104492883394612</guid>    <pubDate>2025-12-29T15:13:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589104492883394612" data-draft-id="7589107312113254409" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用Amazon Nova模型实现自动化视频高光剪辑"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-29T15:13:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亚马逊云开发者"/> <meta itemprop="url" content="https://juejin.cn/user/2850395271209496"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用Amazon Nova模型实现自动化视频高光剪辑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2850395271209496/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亚马逊云开发者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T15:13:48.000Z" title="Mon Dec 29 2025 15:13:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读36分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本方案旨在利用Amazon自研的Nova多模态理解类模型（Vision‑Language Model，简称VLM）和多模态嵌入模型（Multimodal Embedding Model，简称MME），实现<strong>自动化的视频高光识别与剪辑</strong>。输入视频文件，通过<strong>多模态模型理解</strong>或<strong>结合语义摘要与嵌入检索</strong>实现素材定位，识别高光片段，并合成剪辑。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F11%2F18%2Fautomated-video-highlight-clipping-using-amazon-nova-model-1.png" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/11/18/automated-video-highlight-clipping-using-amazon-nova-model-1.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b192fe40d1bc40878e5d725fe3d46e0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=WSd%2F8zjEfo2ifkAlxQ%2BD9yWtdtA%3D" alt="" loading="lazy"/></a></p>
<blockquote>
<p>📢限时插播：无需管理基础设施，利用亚马逊技术与生态，快速集成与部署生成式AI模型能力。</p>
<p>✨ 精心设计，旨在引导您深入探索Amazon Bedrock的模型选择与调用、模型自动化评估以及安全围栏(Guardrail)等重要功能。</p>
<p>⏩快快点击进入《<a href="https://link.juejin.cn?target=https%3A%2F%2Fevents.amazoncloud.cn%2Flabs%2Fcloudlab-amazon-bedrock-first-experience%3Fvisitfrom%3D3P_Juejinhead_1223%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejinhead_1223" target="_blank" title="https://events.amazoncloud.cn/labs/cloudlab-amazon-bedrock-first-experience?visitfrom=3P_Juejinhead_1223&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejinhead_1223" ref="nofollow noopener noreferrer">多模一站通 —— Amazon Bedrock 上的基础模型初体验</a>》实验构建无限, 探索启程！</p>
</blockquote>
<p><strong>方案概览：</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d0ee68851a94990b06b65ceaed1251c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=JlviEzifV%2BMx9YKIO%2BoA6GgUMYQ%3D" alt="image.png" loading="lazy"/></p>
<p><strong>文章概览：</strong></p>
<ul>
<li>模型介绍：Nova 多模态理解类模型（VLM）及多模态嵌入模型（MME）</li>
<li>视频高光剪辑的主要方法：</li>
</ul>
<ol>
<li>
<p><strong>纯VLM:</strong> 用Nova LLM直接进行视频理解，输出高光片段的开始和结束时间点</p>
<ol>
<li>方案架构与案例代码</li>
<li>Nova理解类模型输出视频精准时间戳（timestamp）的提示词工程技巧</li>
<li>效果优化：通过切片增加识别精准度</li>
</ol>
</li>
<li>
<p><strong>VLM+MME（video）</strong> ：结合语义摘要与视频嵌入检索</p>
<ol>
<li>方案架构与案例代码（<strong>2.1 基础：高光压缩； 2.2 跨视频内容驱动的高光剪辑； 2.3 历史素材驱动的模板化高光生成</strong>）</li>
<li>成本与效果优化思路：片段聚类，初筛，去重</li>
<li>降本方案：<strong>2.4 VLM+MME（image）</strong> : 视频抽帧，结合语义摘要与抽帧嵌入检索</li>
</ol>
</li>
</ol>
<ul>
<li>附加考虑：背景音乐，转场动画，字幕及其他效果自动化</li>
<li><strong>总结与讨论：实际应用场景，方案特点和选型思路</strong></li>
<li>可用性与定价</li>
</ul>
<h2 data-id="heading-0">模型介绍</h2>
<p>Amazon Web Services（Amazon）推出的 Amazon Nova 自研模型系列，是一组基础模型（foundation models），覆盖文本、图像、视频、语音和智能代理等多模态输入与输出，旨在为企业构建生成式 AI 应用提供性能优越、成本更低、可定制性更强的选择。现已在 Amazon Bedrock 上提供。更多模型全系列信息：<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fnova%2F" target="_blank" title="https://aws.amazon.com/nova/" ref="nofollow noopener noreferrer">aws.amazon.com/nova/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F11%2F18%2Fautomated-video-highlight-clipping-using-amazon-nova-model-2.png" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/11/18/automated-video-highlight-clipping-using-amazon-nova-model-2.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/175e7a53eae4445dbf53053d5997b01d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=i4VN2VIHXYBwIn4pzX2SrXbSAps%3D" alt="" loading="lazy"/></a></p>
<p>本方案涉及两类Nova模型：理解类模型和多模态嵌入模型。</p>
<h4 data-id="heading-1"><strong>理解类模型（Nova LLM）</strong></h4>
<p>Amazon Nova Lite 和 Amazon Nova Pro 是 Amazon Nova理解类模型系列（Nova Micro/Lite/Pro/Premier）中两款高性价，低延迟的多模态模型，支持文本、图像、视频等多种格式，并输出文本响应。<br/>
Nova Lite：定位为 “极低成本” 的多模态理解模型，能够以极快的响应速度处理图像、视频和文本输入，生成文本输出。<br/>
Nova Pro：在精度、速度与成本之间取得平衡，是面向广泛任务的高能力多模态理解模型。<br/>
二者均支持 200 多种语言，并且可通过 Amazon Bedrock 进行定制、微调、结合检索增强生成（RAG）等，适合企业级应用。<br/>
在本文方案中，我们将使用Nova LLM的视频理解能力，输入视频，通过提示词工程，获得高光片段时间点的输出。</p>
<h3 data-id="heading-2"><strong>多模态嵌入模型（Nova MME）</strong></h3>
<p>Amazon Nova 多模态嵌入模型（Amazon Nova Multimodal Embeddings）是一款最先进的多模态嵌入模型，支持文本、文档、图像、视频和音频的统一嵌入模型，可实现高精度的跨模态检索。模型细节与使用方法可阅读<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Famazon-nova-multimodal-embedding-model-practical-guide%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/amazon-nova-multimodal-embedding-model-practical-guide/" ref="nofollow noopener noreferrer">博客</a>。<br/>
在本文方案中，我们将使用Nova MME的视频嵌入生成能力，通过语义相似度检索片段嵌入，以此定位高光片段。</p>
<h2 data-id="heading-3">高光剪辑方案</h2>
<h3 data-id="heading-4"><strong>1. 纯VLM：多模态模型识别高光</strong></h3>
<p>该方案作为视频高光剪辑的基础方案，主要使用Nova 理解类模型（如 Nova Lite/Pro等版本），利用其视觉–语言模型（VLM，Vision-Language Model）能力直接对视频输入进行理解，通过其内部的视觉编码、时序建模与语言理解能力，输出高光片段的“开始时间点”和“结束时间点”。</p>
<h4 data-id="heading-5">a. 方案架构与案例代码</h4>
<p>纯VLM方案的核心思路是：直接让Nova模型读取整个视频，理解其内容后输出高光片段的时间戳（开始时间和结束时间），然后使用FFmpeg等工具按时间戳切分并拼接视频 。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F11%2F18%2Fautomated-video-highlight-clipping-using-amazon-nova-model-3.png" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/11/18/automated-video-highlight-clipping-using-amazon-nova-model-3.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/833d8d6c2ddc472fb6fa42449f0a37aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=n1SjTKgDb8EdYpcPnPkDXD8QDyA%3D" alt="" loading="lazy"/></a></p>
<p><strong>应用案例1：足球比赛高光提取</strong></p>
<p>以一段1分钟的足球比赛视频（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5RE6YNz8wng" target="_blank" title="https://www.youtube.com/watch?v=5RE6YNz8wng" ref="nofollow noopener noreferrer">视频来源</a>）为例，我们使用Nova Lite模型自动识别进球等精彩时刻。原始视频包含完整的比赛片段，其中穿插了多个进球瞬间、精彩扑救和关键传球。通过纯VLM方案，模型能够自动定位这些高光时刻并生成浓缩版视频。</p>
<p>下图展示了处理前后的对比效果。左侧为原始1分钟视频，包含了大量的中场传球和跑位等常规画面；右侧为自动生成的高光视频，精准保留了4个进球瞬间，总时长压缩至约25秒，压缩比达到60%。有效提取了视频中最具观赏价值的片段。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37a0d8219787464cbead28bc76dfd7db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=iWJ9F2ybGvqwCUd0RKjdwxhIJRw%3D" alt="image.png" loading="lazy"/></p>
<p>1min 原始视频       </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2afe4b36a14a4bb9b3c4ec3b80c13db5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=B6A0cy1hMjALWgVo9Rfik7bIiQ0%3D" alt="image.png" loading="lazy"/></p>
<p>25s高光视频</p>
<p><strong>识别准确度评估</strong></p>
<p>为了量化评估模型的表现，我们使用IoU (Intersection over Union) 指标将模型输出与人工标注的Ground Truth进行对比。IoU衡量预测片段与真实片段的重叠程度，当IoU &gt; 0.5时视为成功匹配。测试结果如下 ：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b44147efdfa14483b2bd65fd8d77243b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=57wQwTehX%2B3ZY4Xxw6jydl8CnVM%3D" alt="image.png" loading="lazy"/></p>
<p>从效果来看，模型实现了100%的召回率，不仅准确识别了所有进球时刻，还自动过滤掉了中场传球、球员跑位等非高光内容。生成的高光视频节奏紧凑，适合在社交媒体上快速分享，这正是自动化高光剪辑的核心价值所在。</p>
<p><strong>核心代码实现</strong></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># Nova模型分析视频</span>
<span class="hljs-attr">bedrock</span> = boto3.client(<span class="hljs-string">'bedrock-runtime'</span>, region_name=<span class="hljs-string">'us-east-1'</span>, 
                       <span class="hljs-attr">config</span>=Config(read_timeout=<span class="hljs-number">1800</span>))

<span class="hljs-attr">prompt</span> = <span class="hljs-string">"""You are an expert in football video analysis.
Identify ONLY goal moments from this match video.

**Output Format (JSON only):**
[
    {
        "start_time": "MM:SS",
        "end_time": "MM:SS",
        "description": "Goal description",
        "scene_type": "Goal"
    }
]

**Critical Constraints:**
- All timestamps MUST be within video duration
- Output ONLY valid JSON array
- NO overlapping timestamps"""</span>

<span class="hljs-attr">messages</span> = [{
    <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
    <span class="hljs-string">"content"</span>: [
        {<span class="hljs-string">"video"</span>: {<span class="hljs-string">"format"</span>: <span class="hljs-string">"mp4"</span>, <span class="hljs-string">"source"</span>: {<span class="hljs-string">"s3Location"</span>: {<span class="hljs-string">"uri"</span>: s3_uri, <span class="hljs-string">"bucketOwner"</span>: account_id}}}},
        {<span class="hljs-string">"text"</span>: prompt}
    ]
}]

<span class="hljs-attr">response</span> = bedrock.converse(
    <span class="hljs-attr">modelId</span>= &lt;nova-lite-model-id&gt;, <span class="hljs-comment">#具体名称可以参考：https://aws.amazon.com/nova</span>
    <span class="hljs-attr">messages</span>=messages,
    <span class="hljs-attr">inferenceConfig</span>={<span class="hljs-string">"maxTokens"</span>: <span class="hljs-number">65535</span>, <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.0</span>, <span class="hljs-string">"topP"</span>: <span class="hljs-number">1.0</span>},
    <span class="hljs-attr">additionalModelRequestFields</span>={
        "reasoningConfig": {"type": "enabled", "maxReasoningEffort": "low"}
    }
)

<span class="hljs-attr">output</span> = response[<span class="hljs-string">'output'</span>][<span class="hljs-string">'message'</span>][<span class="hljs-string">'content'</span>][<span class="hljs-number">0</span>][<span class="hljs-string">'text'</span>]
</code></pre>
<p><strong>应用案例2：小狗动画高光提取</strong></p>
<p>为了验证纯VLM方案在不同视频类型上的泛化能力，我们进一步测试了一段1分钟的动画视频。这段视频的特点是大部分时间画面相对静态——一只橙色的小狗在蓝色大门前休息，而真正的高光时刻集中在三个动态片段：一只黄色的小狗出现捡球、另一只小狗从门内探出、以及黄色小狗追逐球的场景。下图展示了处理效果。左侧为原始60秒视频，右侧为自动生成的17秒高光视频。模型成功识别了所有三个动态时刻，并准确过滤掉了长时间的静态画面 。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7071cf98b05a48ffb1e6ff1e6034dc16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=ZvmjEKA%2FFCKTFEwKRI1QIHeHfTc%3D" alt="image.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fpixabay.com%2Fzh%2Fvideos%2Fai-generated-house-dog-porch-192283%2F" target="_blank" title="https://pixabay.com/zh/videos/ai-generated-house-dog-porch-192283/" ref="nofollow noopener noreferrer">1min 原始视频 </a>       </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/362d6cbd9d204ec39368b577bb801b88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=ARSGZ%2BqzmmIPJIw0bRP5bnNMTNs%3D" alt="image.png" loading="lazy"/></p>
<p>17s高光视频</p>
<p><strong>识别准确度评估</strong></p>
<p>为了量化评估模型的表现，我们同样使用IoU 指标将模型输出与人工标注的Ground Truth进行对比，测试结果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29f37c02da6b46219120d1e0f78e7228~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=A3%2F4%2ButLaK4AvM6%2B3laNGtEFEvQ%3D" alt="image.png" loading="lazy"/></p>
<p>可以观察到，模型成功识别了所有3个真实高光片段，并且所有时间戳均准确且在有效范围内。特别值得注意的是，第二个片段（小狗开门）实现了完美匹配，说明模型对这类明确的动作转折点有很强的识别能力。即使在第一和第三个片段中存在1-2秒的时间偏差，时间重叠率仍然达到0.67-0.88的高水平，这对于实际应用已经完全足够。</p>
<p>综上，对比足球比赛和动画视频两个案例，我们可以看到纯VLM方案展现出良好的跨场景泛化能力，无论是真实拍摄的体育赛事，还是制作精良的动画内容，Nova Lite都能准确理解视频语义，识别出符合”动作精彩、戏剧性强、叙事价值高”等标准的高光时刻。这种泛化能力使得同一套技术方案可以应用于多种业务场景，从体育直播、游戏录像到教育视频、产品演示等，大幅降低了开发和维护成本。</p>
<h4 data-id="heading-6">b. 使用Nova理解类模型输出视频精准timestamp的提示词工程技巧</h4>
<p>在将Amazon Nova模型应用于视频高光提取时，我们面临的核心挑战是如何让模型准确输出结构化的时间戳数据。基于对Nova Lite的系统性测试，发现模型在视频时间定位任务中的表现高度依赖于prompt的设计策略，基于大量测试经验和视频理解任务的标准prompt模板，可以总结出以下关键技巧：</p>
<p><strong>采用分步骤的任务分解策略。</strong> 参考视频密集描述（Dense Captioning）任务的prompt设计，将复杂的时间戳提取任务分解为清晰的步骤序列，引导模型建立系统化的分析流程：</p>
<pre><code class="hljs language-sql" lang="sql">### Task:
You <span class="hljs-keyword">are</span> an expert <span class="hljs-keyword">in</span> video content analysis <span class="hljs-keyword">and</span> temporal localization.
 
### Analysis Process (Follow these steps):
Step <span class="hljs-number">1</span>: Watch the entire video <span class="hljs-keyword">and</span> identify <span class="hljs-keyword">all</span> highlight moments
Step <span class="hljs-number">2</span>: <span class="hljs-keyword">For</span> <span class="hljs-keyword">each</span> moment, determine precise <span class="hljs-keyword">start</span> <span class="hljs-keyword">and</span> <span class="hljs-keyword">end</span> timestamps
Step <span class="hljs-number">3</span>: Verify <span class="hljs-keyword">all</span> timestamps <span class="hljs-keyword">are</span> <span class="hljs-keyword">within</span> the video duration
Step <span class="hljs-number">4</span>: Output structured JSON format <span class="hljs-keyword">only</span>
</code></pre>
<p>这种结构化指引帮助模型建立”观察→定位→验证→输出”的工作流程，显著减少时间戳错误。</p>
<p>针对特定任务定制分析维度。参考视频标注（Video Tagging）任务的prompt设计，在高光提取时应明确定义分析的多个维度，帮助模型全面理解什么是”高光”：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-strong">**Analyze from these perspectives:**</span> 
<span class="hljs-bullet">-</span> Visual dynamics: motion intensity, camera movement, visual effects
<span class="hljs-bullet">-</span> Emotional impact: excitement level, dramatic tension
<span class="hljs-bullet">-</span> Technical complexity: skill difficulty, coordination required
<span class="hljs-bullet">-</span> Narrative significance: story turning points, key moments
<span class="hljs-bullet">-</span> Audience appeal: shareability, memorable elements
</code></pre>
<p>明确定义输出格式并提供具体示例。在视频检索（Video Retrieval）和时间定位任务中，标准做法是明确指定时间戳的格式要求。我们建议同时提供格式说明和具体示例，对于需要更结构化的场景，使用JSON格式：</p>
<pre><code class="hljs language-ruby" lang="ruby">**<span class="hljs-title class_">Output</span> <span class="hljs-title class_">Format</span><span class="hljs-symbol">:**</span>
<span class="hljs-title class_">Generate</span> detailed, time-stamped descriptions of events.
<span class="hljs-title class_">Each</span> event follows the <span class="hljs-symbol">format:</span> <span class="hljs-string">"#START - END seconds# description"</span>

**<span class="hljs-title class_">Example</span><span class="hljs-symbol">:**</span>
<span class="hljs-comment">#0.8 - 11.3 seconds# Athlete performs a high jump over obstacle</span>
<span class="hljs-comment">#32.5 - 50.0 seconds# Crowd celebrates as player scores</span>

**<span class="hljs-title class_">Output</span> <span class="hljs-title class_">Format</span> (<span class="hljs-variable constant_">JSON</span>)<span class="hljs-symbol">:**</span>
[
    {
        <span class="hljs-string">"start_time"</span>: <span class="hljs-string">"MM:SS"</span>,
        <span class="hljs-string">"end_time"</span>: <span class="hljs-string">"MM:SS"</span>,
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"Detailed event description"</span>,
        <span class="hljs-string">"scene_type"</span>: <span class="hljs-string">"Action|Transition|Climax"</span>
    }
]
</code></pre>
<p>强调时间边界约束以防止幻觉。测试表明，模型在长视频中容易产生超出实际时长的时间戳。必须在prompt中明确视频的实际时长：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-strong">**CRITICAL CONSTRAINTS:**</span>
<span class="hljs-bullet">-</span> Video duration: exactly 3 minutes 26 seconds (00:00 to 03:26)
<span class="hljs-bullet">-</span> All timestamps MUST be within this range
<span class="hljs-bullet">-</span> No events beyond 03:26
<span class="hljs-bullet">-</span> Use MM:SS format consistently
</code></pre>
<p>通过系统性地应用这些提示词工程技巧，我们能够显著提升Nova模型在视频时间戳识别任务中的表现。在实际应用中，我们还建议结合代码层面的后处理机制——例如验证时间戳是否在有效范围内、合并时间上相邻的片段等，这种通过结合prompt设计+工程化验证的组合策略能够构建更稳健的生产系统。</p>
<p>除了提示词优化，对于长视频场景，我们还可以从架构层面进一步提升处理效果，接下来我们将详细介绍这一优化方案。</p>
<h4 data-id="heading-7">c. 效果优化：通过切片增加识别精准度</h4>
<p>在实际生产环境测试中，我们发现对于长视频场景，采用视频切片策略能够显著提升时间戳定位精度和高光识别准确率。该策略的核心思路是将长视频按固定时长切分成多个片段，对每个片段独立调用Nova模型进行并行分析，然后将识别结果映射回原视频的绝对时间轴。这种方法不仅显著提升了时间戳精度，还带来了意外的性能收益——通过并行处理多个片段，整体处理时间反而缩短了。</p>
<p><strong>应用案例3：长视频足球比赛高光提取</strong></p>
<p>以一段9分3秒的足球比赛视频为例（<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5RE6YNz8wng" target="_blank" title="https://www.youtube.com/watch?v=5RE6YNz8wng" ref="nofollow noopener noreferrer">视频来源</a>），我们将其切分为18个30秒片段和1个3秒片段，通过Amazon Nova Lite模型并行处理后，自动生成了包含所有进球时刻的高光视频。下图展示了原始视频与自动生成的高光视频对比：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc29ecace6aa47fbb2a79d47dbabbba1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=OOmDsUQ6vyk0eEUyEkn7kmjOetA%3D" alt="image.png" loading="lazy"/></p>
<p align="center">切片策略处理流程图</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10189a750f0a4ae6a05a3c14e091c8cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=HrZ2WznrzxzL%2FqcScoe9MSoOSQg%3D" alt="image.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3D5RE6YNz8wng" target="_blank" title="https://www.youtube.com/watch?v=5RE6YNz8wng" ref="nofollow noopener noreferrer">9m3s 原视频</a>     </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a30e549459e4e7581449aca614d05fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=mxUIH0ZjgZjELFTHWioP%2F8%2FQIRo%3D" alt="image.png" loading="lazy"/></p>
<p>1m58s 高光视频</p>
<p><strong>效果验证</strong></p>
<p>为量化评估切片策略的效果，我们使用人工标注的Ground Truth进行对比测试。结果显示，切片策略在时间戳精度和召回率两个关键指标上均有显著提升：30秒切片策略成功识别了全部4个进球（召回率100%），时间戳精度提升至±1秒以内。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9338560056f0419bb51bdcc40f8a6532~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=7bv%2FO%2BMey5jTXrp5FlmhGBbRFHg%3D" alt="image.png" loading="lazy"/></p>
<p>切片策略的另一个优势是通过并行处理提升了整体处理效率。需要注意的是，虽然召回率得到了显著提升，但由于每个片段独立分析，可能会产生较多冗余标记（本案例中输出了14个候选片段），建议在后处理阶段增加去重及筛选逻辑以优化最终输出。</p>
<p>总体而言，纯VLM方案的优势在于流程简洁、模块精简、实现路径短，非常适合快速原型开发和中短视频场景。然而，当面对超长视频，这一方案对模型能力和提示词工程的要求会显著提升。此外，对于需要从海量视频素材库中全局筛选最佳片段的场景，纯VLM方案难以提供跨视频的语义检索能力。<br/>
在接下来的章节中，我们将介绍：当VLM对高光片段的提取不是那么精准时，通过引入多模态嵌入模型（MME）在语义空间上进行相似度匹配，不仅能提升系统的容错能力，弥补VLM在精准性方面的部分不足，同时也提供了跨视频片段检索定位的可能性，实现更强大的视频高光剪辑能力。</p>
<h3 data-id="heading-8"><strong>2. VLM+MME：语义摘要+嵌入检索</strong></h3>
<p>该方案结合了两类技术：首先由 VLM（Nova理解类模型，如Nova Lite/Pro）对视频整体进行理解，生成高光要点或描述；其次，将视频切片（如每2-3秒一段，<em>具体切片时长根据业务要求和检索颗粒度决定</em>）生成视频嵌入向量（通过多模态嵌入模型，Nova MME）——每个片段取得视觉／时序特征之后形成向量。然后系统将高光描述（文本）作为查询，与视频片段的嵌入向量进行<strong>相似度匹配</strong>，从而精确定位那些“语义上与高光描述最接近”的片段。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93fe940c72914cd8b4bacfad5b46be01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=qAQERGUZM2HieO8P6kM0sPqydNQ%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">a. 方案架构</h3>
<p>该方案的需要视频切片、嵌入生成与匹配机制， 可用于跨视频的剪辑需求。基于嵌入向量的可复用性，提供从冷启动（2.1， 2.2）到基于素材累积（2.3）的方案进阶路径。如果成本敏感可以考虑（2.4）将视频抽帧，用图片向量检索。</p>
<h4 data-id="heading-10">2.1 基本方案：高光压缩</h4>
<p>在不强调原始视频情节顺序的情况下，我们可以采用一种<strong>高光压缩</strong>的方法，将视频内容提炼为精华片段。具体步骤如下：</p>
<ol>
<li>
<p><strong>视频内容总结</strong>：将视频输入到VLM模型（例如亚马逊云科技的 Nova Lite/Pro 模型），生成对视频主要内容的摘要描述，并以要点（bullet points）的形式呈现。这一步让模型从全局上理解视频内容的重点。（也可以与方法<strong>1. 纯VLM（ 用Nova VLM直接进行视频理解，输出高光片段的开始和结束时间点）方法</strong>结合，对VLM生成的高光点查漏补缺。）</p>
<ol>
<li>（可选）打重要性标签：每条摘要要点可以附加一个优先级标签（如重要程度1、2、3）以表示相对重要性（这一步需要在 system prompt 中明确高光片段的判定标准）。</li>
</ol>
</li>
<li>
<p><strong>视频切片与嵌入</strong>：将视频按时间顺序分割成短片段，如<strong>2-3秒</strong>（<em>具体切片时长根据业务要求和检索颗粒度决定</em>），并对每个片段生成向量嵌入表示（使用Nova MME，多模态嵌入模型，每个片段的嵌入向量都代表了该片段的语义内容）。</p>
</li>
<li>
<p><strong>语义匹配选取高光片段</strong>：利用第一步中VLM生成的摘要要点作为查询，根据语义相似度在嵌入向量空间中检索最相关的影片片段。换言之，我们在嵌入向量库中查找与每条摘要要点语义最接近的若干片段。这些匹配上的片段即被视为视频的高光片段集合。由于摘要要点概括了视频的重要内容，检索出的片段也就对应了视频中最精彩或最重要的瞬间。</p>
<ol>
<li>（可选）初筛：如高光描述过多，可以根据高光点的优先级筛选需要匹配的文字。</li>
<li>（可选）去重：若出现多个要点匹配到同一段视频（即某片段对多条要点都有高相似度），则根据要点的优先级决定该片段应归属哪个要点（确保重要的要点获得独特片段）</li>
</ol>
</li>
<li>
<p><strong>高光片段导出</strong>：将选定的高光片段按原视频中的时间顺序组合导出，形成一个压缩版的视频。如果不关注片段顺序，也可以按照相似度得分等权重来自由组合。但通常由于摘要要点源自原始视频顺序，此方法下导出的高光片段天然保持了原视频的大致顺序。</p>
</li>
</ol>
<p>该基本方案不依赖任何外部素材库，流程简单直接。VLM提供语义摘要，嵌入向量提供精确检索，使模型能够“理解”视频内容并找到对应片段。此方法依赖第一步VLM的摘要质量和提示词工程，若VLM未能抓住真正的精彩之处，检索结果可能欠佳。</p>
<p><strong>案例代码</strong></p>
<p>使用Amazon Nova Lite进行视频理解与高光要点生成，Amazon Nova MME进行文本和视频片段的嵌入生成，开源音视频处理库FFmpeg进行视频处理，该流程的核心代码架构如下：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> boto3
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">import</span> glob
<span class="hljs-keyword">from</span> sklearn.metrics.pairwise <span class="hljs-keyword">import</span> cosine_similarity

bedrock = boto3.client(<span class="hljs-string">'bedrock-runtime'</span>, region_name=<span class="hljs-string">'us-east-1'</span>)

<span class="hljs-comment"># 1. LLM视频分析 - Nova模型理解视频生成高光要点</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_video</span>(<span class="hljs-params">video_path</span>):
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(video_path, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
        video_base64 = base64.b64encode(f.read()).decode(<span class="hljs-string">'utf-8'</span>)
    
    response = bedrock.invoke_model(
        modelId=<span class="hljs-string">"us.amazon.nova-lite-v1:0"</span>,
        body=json.dumps({
            <span class="hljs-string">"messages"</span>: [{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: [
                {<span class="hljs-string">"video"</span>: {<span class="hljs-string">"format"</span>: <span class="hljs-string">"mp4"</span>, <span class="hljs-string">"source"</span>: {<span class="hljs-string">"bytes"</span>: video_base64}}},
                {<span class="hljs-string">"text"</span>: <span class="hljs-string">"""请分析这个视频并提炼高光要点。                       
                            ## 高光片段判定标准：
                            - 动作精彩或技巧性强的时刻
                            - 情感表达丰富或戏剧性的瞬间  
                            - 关键转折点或重要事件
                            - 视觉效果突出或构图优美的片段
                            - 具有故事性或叙事价值的时刻
                            
                            ## 输出要求：
                            请按以下格式输出高光要点，每个要点包含优先级（1=最重要，2=重要，3=一般）：
                            
                            **视频总结：**
                            [简要描述视频的整体内容和主题]
                            
                            **高光要点列表：**
                            A. [优先级1] - [具体的高光内容描述]
                            B. [优先级2]  - [具体的高光内容描述]  
                            C. [优先级1]  - [具体的高光内容描述]
                            ...
                            
                            请确保：
                            1. 按视频时间顺序排列要点
                            2. 每个要点都有明确的优先级标记
                            3. 描述具体且便于后续匹配
                            4. 重点关注真正精彩的时刻，而非简单概括"""</span>}
            ]}]
        })
    )
    <span class="hljs-keyword">return</span> json.loads(response[<span class="hljs-string">"body"</span>].read())[<span class="hljs-string">"output"</span>][<span class="hljs-string">"message"</span>][<span class="hljs-string">"content"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"text"</span>]

<span class="hljs-comment"># 2. 视频切片 - FFmpeg按固定间隔切分视频</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_clips</span>(<span class="hljs-params">video_path, clip_duration=<span class="hljs-number">3</span></span>):
    <span class="hljs-comment"># 获取视频时长</span>
    duration = <span class="hljs-built_in">float</span>(subprocess.check_output([<span class="hljs-string">'ffprobe'</span>, <span class="hljs-string">'-v'</span>, <span class="hljs-string">'quiet'</span>, <span class="hljs-string">'-show_entries'</span>, <span class="hljs-string">'format=duration'</span>, <span class="hljs-string">'-of'</span>, <span class="hljs-string">'csv=p=0'</span>, video_path]))
    
    clips = []
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">int</span>(duration), clip_duration):
        clip_path = <span class="hljs-string">f"clips/clip_<span class="hljs-subst">{i:04d}</span>_<span class="hljs-subst">{i}</span>s.mp4"</span>
        subprocess.run([<span class="hljs-string">'ffmpeg'</span>, <span class="hljs-string">'-i'</span>, video_path, <span class="hljs-string">'-ss'</span>, <span class="hljs-built_in">str</span>(i), <span class="hljs-string">'-t'</span>, <span class="hljs-built_in">str</span>(clip_duration), 
                       <span class="hljs-string">'-c:v'</span>, <span class="hljs-string">'libx264'</span>, clip_path, <span class="hljs-string">'-y'</span>, <span class="hljs-string">'-loglevel'</span>, <span class="hljs-string">'quiet'</span>])
        clips.append({<span class="hljs-string">'timestamp'</span>: i, <span class="hljs-string">'path'</span>: clip_path})
    <span class="hljs-keyword">return</span> clips

<span class="hljs-comment"># 3. 语义匹配 - Nova MME生成嵌入后计算要点与视频片段相似度</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_embedding</span>(<span class="hljs-params">content, content_type=<span class="hljs-string">"text"</span></span>):
    <span class="hljs-keyword">if</span> content_type == <span class="hljs-string">"text"</span>:
        request = {
            <span class="hljs-string">"taskType"</span>: <span class="hljs-string">"SINGLE_EMBEDDING"</span>,
            <span class="hljs-string">"singleEmbeddingParams"</span>: {
                <span class="hljs-string">"embeddingPurpose"</span>: <span class="hljs-string">"GENERIC_INDEX"</span>,
                <span class="hljs-string">"embeddingDimension"</span>: <span class="hljs-number">1024</span>,
                <span class="hljs-string">"text"</span>: {<span class="hljs-string">"truncationMode"</span>: <span class="hljs-string">"END"</span>, <span class="hljs-string">"value"</span>: content}
            }
        }
    <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># video</span>
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(content, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
            video_base64 = base64.b64encode(f.read()).decode(<span class="hljs-string">'utf-8'</span>)
        request = {
            <span class="hljs-string">"taskType"</span>: <span class="hljs-string">"SINGLE_EMBEDDING"</span>,
            <span class="hljs-string">"singleEmbeddingParams"</span>: {
                <span class="hljs-string">"embeddingPurpose"</span>: <span class="hljs-string">"GENERIC_INDEX"</span>,
                <span class="hljs-string">"embeddingDimension"</span>: <span class="hljs-number">1024</span>,
                <span class="hljs-string">"video"</span>: {
                    <span class="hljs-string">"format"</span>: <span class="hljs-string">"mp4"</span>,
                    <span class="hljs-string">"embeddingMode"</span>: <span class="hljs-string">"AUDIO_VIDEO_COMBINED"</span>,
                    <span class="hljs-string">"source"</span>: {<span class="hljs-string">"bytes"</span>: video_base64}
                }
            }
        }
    
    response = bedrock.invoke_model(modelId=<span class="hljs-string">"amazon.nova-2-multimodal-embeddings-v1:0"</span>, body=json.dumps(request))
    <span class="hljs-keyword">return</span> json.loads(response[<span class="hljs-string">"body"</span>].read())[<span class="hljs-string">"embeddings"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"embedding"</span>]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">semantic_match</span>(<span class="hljs-params">analysis, clips</span>):
    <span class="hljs-comment"># 提取要点</span>
    points = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> analysis.split(<span class="hljs-string">'\n'</span>) <span class="hljs-keyword">if</span> line.strip().startswith((<span class="hljs-string">'A.'</span>, <span class="hljs-string">'B.'</span>, <span class="hljs-string">'C.'</span>))]
    
    selected_clips = []
    <span class="hljs-comment"># 为每个要点找最佳匹配片段</span>
    <span class="hljs-keyword">for</span> point <span class="hljs-keyword">in</span> points:
        text_emb = get_embedding(point)
        best_clip, best_similarity = <span class="hljs-literal">None</span>, -<span class="hljs-number">1</span>
        
        <span class="hljs-keyword">for</span> clip <span class="hljs-keyword">in</span> clips:
            video_emb = get_embedding(clip[<span class="hljs-string">'path'</span>], <span class="hljs-string">"video"</span>)
            similarity = cosine_similarity([text_emb], [video_emb])[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
            
            <span class="hljs-keyword">if</span> similarity &gt; best_similarity:
                best_similarity = similarity
                best_clip = {<span class="hljs-string">'path'</span>: clip[<span class="hljs-string">'path'</span>], <span class="hljs-string">'timestamp'</span>: clip[<span class="hljs-string">'timestamp'</span>], <span class="hljs-string">'similarity'</span>: similarity}
        
        <span class="hljs-keyword">if</span> best_clip <span class="hljs-keyword">and</span> best_similarity &gt; <span class="hljs-number">0.15</span>:
            selected_clips.append(best_clip)
    
    <span class="hljs-comment"># 按时间顺序排序</span>
    selected_clips.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">'timestamp'</span>])
    <span class="hljs-keyword">return</span> selected_clips

<span class="hljs-comment"># 4. 拼接高光视频 - FFmpeg合并选中片段</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_video</span>(<span class="hljs-params">selected_clips, output_path</span>):
    <span class="hljs-comment"># 生成拼接列表</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'concat_list.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> clip <span class="hljs-keyword">in</span> selected_clips:
            f.write(<span class="hljs-string">f"file '<span class="hljs-subst">{clip[<span class="hljs-string">'path'</span>]}</span>'\n"</span>)
    
    <span class="hljs-comment"># FFmpeg拼接</span>
    subprocess.run([<span class="hljs-string">'ffmpeg'</span>, <span class="hljs-string">'-f'</span>, <span class="hljs-string">'concat'</span>, <span class="hljs-string">'-safe'</span>, <span class="hljs-string">'0'</span>, <span class="hljs-string">'-i'</span>, <span class="hljs-string">'concat_list.txt'</span>, 
                   <span class="hljs-string">'-c'</span>, <span class="hljs-string">'copy'</span>, output_path, <span class="hljs-string">'-y'</span>, <span class="hljs-string">'-loglevel'</span>, <span class="hljs-string">'quiet'</span>])

<span class="hljs-comment"># demo：完整流程</span>
analysis = analyze_video(<span class="hljs-string">"sample/action.mp4"</span>)
clips = extract_clips(<span class="hljs-string">"sample/action.mp4"</span>, <span class="hljs-number">3</span>)
selected_clips = semantic_match(analysis, clips)
create_video(selected_clips, <span class="hljs-string">"highlight_video.mp4"</span>)
<span class="hljs-comment"># 流程: 视频→Nova理解→视频切片→MME匹配→拼接</span>
<span class="hljs-comment"># 返回: highlight_video.mp4</span>
</code></pre>
<p><strong>应用案例：小狗动画高光提取</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9817b0b608845fc95a51fed14edc4a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=dYiP9OyLvvJqE6RAdo7eUVLdSvg%3D" alt="image.png" loading="lazy"/></p>
<p>1min <a href="https://link.juejin.cn?target=https%3A%2F%2Fpixabay.com%2Fzh%2Fvideos%2Fai-generated-house-dog-porch-192283%2F" target="_blank" title="https://pixabay.com/zh/videos/ai-generated-house-dog-porch-192283/" ref="nofollow noopener noreferrer">原始视频</a>                                     </p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ead961aaf6d24c46ae6baeb88cecb376~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=eciKhVjFh000h6mt%2BUEyCZoDrYI%3D" alt="image.png" loading="lazy"/></p>
<p>14s 高光视频</p>
<p>该动画的大部分时间是一只橙色小狗在蓝色大门前睡觉，有3个主要的高光片段：</p>
<ul>
<li>第16s到第24s：一只黄色小狗出现在画面中捡球</li>
<li>第26s到第32s：一只小的白色和棕色相间的小狗从门内探出</li>
<li>第46s到第52s：黄色小狗继续出现在画面中追逐球</li>
</ul>
<p>按照架构设计进行第1步，将整个视频作为输入，使用VLM进行视频分析，提取高光要点以及优先级：</p>
<pre><code class="hljs language-less" lang="less">**视频总结：**
这个视频展示了一只橙色小狗在房子门口的阶梯上睡觉。视频中的场景是一个带有花园和邮箱的房子，背景中还有一辆自行车停在路边。

**高光要点列表：**
<span class="hljs-selector-tag">A</span>. <span class="hljs-selector-attr">[优先级1]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">0</span>:<span class="hljs-number">00</span> <span class="hljs-selector-tag">-</span> 视频开始时，展示了房子和橙色小狗在阶梯上睡觉的场景。
<span class="hljs-selector-tag">B</span>. <span class="hljs-selector-attr">[优先级2]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">0</span>:<span class="hljs-number">19</span> <span class="hljs-selector-tag">-</span> 橙色小狗开始翻身并醒来。
<span class="hljs-selector-tag">C</span>. <span class="hljs-selector-attr">[优先级1]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">0</span>:<span class="hljs-number">21</span> <span class="hljs-selector-tag">-</span> 黄色小狗被一个蓝色的球吸引，并开始追逐。
<span class="hljs-selector-tag">D</span>. <span class="hljs-selector-attr">[优先级2]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">0</span>:<span class="hljs-number">25</span> <span class="hljs-selector-tag">-</span> 黄色小狗追逐球的动作，展示了它的活泼和好奇心。
<span class="hljs-selector-tag">E</span>. <span class="hljs-selector-attr">[优先级3]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">0</span>:<span class="hljs-number">30</span> <span class="hljs-selector-tag">-</span> 黄色小狗追逐球的过程中，展示了房子的细节和背景。
<span class="hljs-selector-tag">F</span>. <span class="hljs-selector-attr">[优先级2]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">0</span>:<span class="hljs-number">35</span> <span class="hljs-selector-tag">-</span> 黄色小狗最终放弃追逐。
<span class="hljs-selector-tag">G</span>. <span class="hljs-selector-attr">[优先级3]</span> <span class="hljs-selector-tag">-</span> <span class="hljs-number">0</span>:<span class="hljs-number">40</span> <span class="hljs-selector-tag">-</span> 视频结尾，展示了房子和花园的全景。
</code></pre>
<p>VLM 提取的高光要点包含7条，每条有对应优先级与描述，可以观察到视频的大部分高光情节被提取出且故事较为连贯。在语义匹配阶段，Nova MME进行多模态嵌入生成，能够捕捉到视频片段中的核心动作和场景特征，而不完全依赖于具体的身份识别。例如，当VLM描述中提到”黄色小狗追逐球”时，无论执行这个动作的是橙色小狗还是黄色小狗，由于”追逐球”这一动作在嵌入空间中产生相似的语义表示，相似度计算都能够匹配到包含此类动作的视频片段，从而实现准确的语义关联。这种语义层面的匹配机制使得系统具有一定的容错能力：即使文本描述在细节上存在偏差，只要核心的动作、场景或情感特征保持一致，相似度计算仍能找到正确的视频片段，保证了语义上的连贯性。最后拼接时根据视频片段的时间顺序拼接保证了时序上的连贯性。<br/>
接下来进行第2～4步的视频片段切分（2s为切分间隔），Nova MME嵌入生成以及语义匹配，每个要点匹配的视频片段结果如下表所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/964ccb84f999432698ea8dad53419ebc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=jPsfH%2B4VlxH1nTy%2B2gxWV2N7PJU%3D" alt="image.png" loading="lazy"/></p>
<p>从实际结果看，尽管VLM在狗的品种识别上存在混淆，但最终选中的片段（20-24秒、26-32秒、50-52秒等）仍然准确覆盖了预期的高光时段，证明了这种基于语义匹配的方法在处理描述不精确问题上的鲁棒性。生成的高光视频中包含了提到的3个高光片段，且片段之间的衔接也较为自然。</p>
<h4 data-id="heading-11">2.2 跨视频内容驱动的高光剪辑</h4>
<p>当高光剪辑场景有较高的自定义剧本需求，需要微调视频拼接顺序，以及需要基于大量视频媒体库优选片段的时候，我们可以对2.1方案生成的嵌入基于用户定义的剧本文字（可选：再用prompt增强）进行检索。</p>
<p>比如在媒体行业场景中，当剪辑需求不仅仅是“提取高光”，而是要按照品牌或用户定义的“剧本”来迈出叙事、结构和风格的步伐，并且拥有一个庞大的素材库时，我们便可以采用“用户输入的剪辑需求 + 跨视频检索”这一技术路径。具体来说，用户首先输入其剪辑意图，例如“先展示产品问世、再展示用户体验、最后展示品牌口号”，这一剧本会被系统转化为一系列描述性事件（如“产品亮相”、“用户微笑试用”、“品牌Logo出现”）。接着系统对整个素材库中的每条视频或片段生成嵌入向量，进而将用户的每一个事件描述作为检索查询，与库中各片段的嵌入进行相似度匹配。这样，系统不仅限于从单个视频选取高光，而是可以跨视频检索：比如，事件１可能匹配竟然是品牌拍摄片，事件２可能匹配直播片段，事件３来自宣传片。最后，按照用户剧本设定的顺序，将这些匹配出的来自不同视频的片段组合起来，形成一个结构化、连贯而富有品牌风格的高光剪辑。</p>
<h4 data-id="heading-12">2.3 历史素材驱动的模板化高光生成</h4>
<p>视频嵌入技术展现了极高的可复用性。我们可以将历史上已经被剪辑为高光的片段——或被人工判断为“精彩时刻”的素材——系统地收集起来，形成一个样本库。样本库搭建可选择如Amazon Opensearch Service（<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Fblogs%2Fchina%2Fopensearch-rag-system-implementation%2F" target="_blank" title="https://aws.amazon.com/cn/blogs/china/opensearch-rag-system-implementation/" ref="nofollow noopener noreferrer">博客</a>），亚马逊云科技的partner向量数据库如Zilliz（<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fmarketplace%2Fpp%2Fprodview-iqbidum7feuio%3Fsr%3D0-1%26ref_%3Dbeagle%26applicationId%3DAWSMPContessa" target="_blank" title="https://aws.amazon.com/marketplace/pp/prodview-iqbidum7feuio?sr=0-1&amp;ref_=beagle&amp;applicationId=AWSMPContessa" ref="nofollow noopener noreferrer">partner marketplace link</a>）。</p>
<p>对于库中每一个高光片段，我们不仅为其生成嵌入向量表示，还可按类别或风格进行标签（例如 “体育比赛”“游戏直播”“演讲访谈” 等），并为片段附加丰富的元数据，如所属视频类别、片段简介、精彩评分等。这一机制使得后续的新视频可以跨视频检索：在面对一条新拍摄视频时，系统首先对其进行分析（包括 VLM 摘要或粗分类），然后将其切分为2–3 秒的片段并生成嵌入向量。接下来，这些片段将与样本库中已有的高光嵌入进行相似度匹配——如果某个新视频片段在视觉或语义上与历史高光片段高度相似，就可将其标记为高光候选。同时，如果新视频所属类别明确（比如篮球比赛），系统还可参考该类别过去形成的“高光剧本”——例如典型进球、扣篮、关键三分、绝杀这一顺序——并在样本库选片中优先匹配这些典型事件。将匹配出的片段（可能来自不同原视频）按剧本顺序组合拼接，就能生成符合观众预期节奏、结构连贯的高光成片。</p>
<p>以下为流程图：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fd2908q01vomqb2.cloudfront.net%2F472b07b9fcf2c2451e8781e944bf5f77cd8457c8%2F2025%2F11%2F18%2Fautomated-video-highlight-clipping-using-amazon-nova-model-14.png" target="_blank" title="https://d2908q01vomqb2.cloudfront.net/472b07b9fcf2c2451e8781e944bf5f77cd8457c8/2025/11/18/automated-video-highlight-clipping-using-amazon-nova-model-14.png" ref="nofollow noopener noreferrer"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d82e80cdbb64e0e8ce2570d2bb8df0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=X%2BxVwohO0WNm7tqwWAh%2Bg%2FpwG00%3D" alt="" loading="lazy"/></a></p>
<h3 data-id="heading-13">b. VLM+MME链路优化思路</h3>
<p>在系统设计阶段，成本考量非常重要。如不需要为视频 embedding 支付持久化存储费用，仅需要考虑模型推理费用（即 Nova 或嵌入模型 MME 的运行费用）。如需储备历史素材库——需要存储 embedding，因此还要考虑存储和检索成本。除了存储外，还有一些<strong>成本优化手段</strong>，可以在整个流程中降低计算／存储／带宽等资源消耗。以下是几项建议：</p>
<p><strong>视频压缩 + 再识别</strong><br/>
可以先将原始视频做轻量压缩或降帧处理（降低分辨率、降低帧率）以减少计算／存储开销。利用压缩后的视频用VLM识别哪些片段可能是高光，然后在原始视频中按照排序结果选取对应高分片段，再拼接成最终剪辑。这样可以避免对高分辨率视频VLM理解/MME嵌入。</p>
<p><strong>初筛过滤 + 再嵌入</strong><br/>
在做精细的嵌入匹配之前，先做一个粗筛阶段以减少待处理片段数量，从而降低后续嵌入计算量。粗筛可通过几种方式实现：</p>
<ol>
<li><strong>靠 VLM 输出大致 timestamp</strong>：结合方法1，调用 VLM 先对视频做快速分析，输出可能的高光时间段（例如“00:12–00:16”、“04:30–04:35”），然后只对这些候选区段做切片 + 嵌入匹配。提升方法1的精度，同时无需对全部视频做嵌入处理。</li>
<li><strong>靠去重</strong>：如果视频存在大量“平淡”“重复”的片段，可以先用帧差异规则做去重，删除重复内容，剩余片段即为“亮点候选”：如帧之间变化率、场景切换检测、视觉差异阈值做快速过滤，仅保留“变化大”的区段供后续处理。</li>
<li><strong>靠前置逻辑</strong>：利用其他模态（如音频、运动检测）做预筛。比如音频音量变大、频率变化剧烈可能对应“高潮、高光”片段（如赛车轰鸣、演唱高潮）；或视觉中检测到快速运动／剪辑变化也可作为候选。这样可减少对视觉嵌入的遍历。</li>
</ol>
<p>这种“粗 → 精”两级筛选方式能显著降低整体系统负载。</p>
<h4 data-id="heading-14">效果优化思路</h4>
<p><strong>切片粒度与高光时长弹性</strong><br/>
实际场景中，高光时长并不固定（可能为 3 秒／5 秒／15 秒等），因此在切片设计时需要灵活。一个简明工程实现方式是：<br/>
<strong>先用最小细粒度切片</strong>（例如 1-2 秒）遍历全视频。对于每个高光描述（来自 VLM），在匹配出的片段基础上，可<strong>合并相邻切片</strong>、或者根据优先级扩展时间段，以形成较长的高光片段。匹配逻辑可为：对于某一高光描述，找到所有相似度 ≥ 阈值（例如 0.5） 的细切片集合；然后合并这些相邻切片（时间上连续或相近）为一个完整高光区间，再按时间顺序拼接。<br/>
这样既保证了系统能够灵活应对不同长度的高光，又避免硬编码“高光必为3 秒”的限制。</p>
<h4 data-id="heading-15"><strong>2.4 VLM+MME（视频抽帧-图片嵌入）</strong></h4>
<p>此方案与方案 2 的流程类似，但区别在于“嵌入对象”从视频片段变为“抽帧图片”。也就是说：对视频抽取关键帧，对这些静态帧生成图片嵌入；同时由 VLM 生成高光描述文本；然后对图片嵌入与描述文本做匹配，从这些匹配结果推断高光的时间点。技术上这种方法降低了对完整视频切片和时序建模的依赖，使实现更轻量。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74baea9658234d30ac9faea5f02a6033~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=aTxuOP0jvXfKUu09jm3DO9Tn3FI%3D" alt="image.png" loading="lazy"/></p>
<p><strong>案例代码：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> boto3
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> subprocess
<span class="hljs-keyword">import</span> base64
<span class="hljs-keyword">from</span> sklearn.metrics.pairwise <span class="hljs-keyword">import</span> cosine_similarity

bedrock = boto3.client(<span class="hljs-string">'bedrock-runtime'</span>, region_name=<span class="hljs-string">'us-east-1'</span>)

<span class="hljs-comment"># 1. VLM视频分析</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_video</span>(<span class="hljs-params">video_path</span>):
    <span class="hljs-comment"># 同 “2.1 基本方案”部分案例代码</span>
    <span class="hljs-keyword">pass</span>
    
<span class="hljs-comment"># 2. FFmpeg抽帧：将视频抽帧为图片用于后续语义匹配</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_frames</span>(<span class="hljs-params">video_path, interval=<span class="hljs-number">1</span></span>):
    duration = <span class="hljs-built_in">float</span>(subprocess.check_output([<span class="hljs-string">'ffprobe'</span>, <span class="hljs-string">'-v'</span>, <span class="hljs-string">'quiet'</span>, <span class="hljs-string">'-show_entries'</span>, <span class="hljs-string">'format=duration'</span>, <span class="hljs-string">'-of'</span>, <span class="hljs-string">'csv=p=0'</span>, video_path]))
    
    frames = []
    <span class="hljs-keyword">for</span> i, t <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">int</span>(duration), interval)):
        frame_path = <span class="hljs-string">f"frame_<span class="hljs-subst">{i:04d}</span>.jpg"</span>
        subprocess.run([<span class="hljs-string">'ffmpeg'</span>, <span class="hljs-string">'-i'</span>, video_path, <span class="hljs-string">'-ss'</span>, <span class="hljs-built_in">str</span>(t), <span class="hljs-string">'-vframes'</span>, <span class="hljs-string">'1'</span>, frame_path, <span class="hljs-string">'-y'</span>, <span class="hljs-string">'-loglevel'</span>, <span class="hljs-string">'quiet'</span>])
        frames.append({<span class="hljs-string">'timestamp'</span>: t, <span class="hljs-string">'path'</span>: frame_path})
    <span class="hljs-keyword">return</span> frames

<span class="hljs-comment"># 3. 语义匹配：Nova MME生成嵌入后计算要点与图片相似度</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">get_embedding</span>(<span class="hljs-params">content, content_type=<span class="hljs-string">"text"</span></span>):
    <span class="hljs-comment"># 生成嵌入</span>
    <span class="hljs-keyword">if</span> content_type == <span class="hljs-string">"text"</span>:
        data = {<span class="hljs-string">"text"</span>: {<span class="hljs-string">"value"</span>: content}}
    <span class="hljs-keyword">else</span>:
        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(content, <span class="hljs-string">'rb'</span>) <span class="hljs-keyword">as</span> f:
            data = {<span class="hljs-string">"image"</span>: {<span class="hljs-string">"format"</span>: <span class="hljs-string">"jpeg"</span>, <span class="hljs-string">"source"</span>: {<span class="hljs-string">"bytes"</span>: base64.b64encode(f.read()).decode()}}}
    
    response = bedrock.invoke_model(
        modelId=<span class="hljs-string">"amazon.nova-2-multimodal-embeddings-v1:0"</span>,
        body=json.dumps({<span class="hljs-string">"taskType"</span>: <span class="hljs-string">"SINGLE_EMBEDDING"</span>, <span class="hljs-string">"singleEmbeddingParams"</span>: data})
    )
    <span class="hljs-keyword">return</span> json.loads(response[<span class="hljs-string">"body"</span>].read())[<span class="hljs-string">"embeddings"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"embedding"</span>]

<span class="hljs-keyword">def</span> <span class="hljs-title function_">semantic_match</span>(<span class="hljs-params">analysis, frames</span>):
    <span class="hljs-comment"># 提取要点</span>
    points = [line.strip() <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> analysis.split(<span class="hljs-string">'\n'</span>) <span class="hljs-keyword">if</span> line.strip().startswith((<span class="hljs-string">'A.'</span>, <span class="hljs-string">'B.'</span>, <span class="hljs-string">'C.'</span>))]
    
    selected_clips = []
    <span class="hljs-comment"># 针对每一个要点，匹配处Top10最相关的帧集合</span>
    <span class="hljs-keyword">for</span> point <span class="hljs-keyword">in</span> points:
        text_emb = get_embedding(point)
        best_frames = []
        
        <span class="hljs-keyword">for</span> frame <span class="hljs-keyword">in</span> frames:
            img_emb = get_embedding(frame[<span class="hljs-string">'path'</span>], <span class="hljs-string">"image"</span>)
            similarity = cosine_similarity([text_emb], [img_emb])[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]
            <span class="hljs-keyword">if</span> similarity &gt; <span class="hljs-number">0.1</span>:
                best_frames.append({<span class="hljs-string">'timestamp'</span>: frame[<span class="hljs-string">'timestamp'</span>], <span class="hljs-string">'similarity'</span>: similarity})
        
        best_frames.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">'similarity'</span>], reverse=<span class="hljs-literal">True</span>)
        selected_clips.extend(best_frames[:<span class="hljs-number">10</span>])  <span class="hljs-comment"># Top10</span>
    
    <span class="hljs-keyword">return</span> selected_clips

<span class="hljs-comment"># 4. 生成高光视频</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">create_video</span>(<span class="hljs-params">video_path, clips, output_path</span>):
    clips.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">'timestamp'</span>])
    
    <span class="hljs-comment"># 按照帧集合提取片段</span>
    temp_clips = []
    <span class="hljs-keyword">for</span> i, clip <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(clips):
        clip_path = <span class="hljs-string">f"clip_<span class="hljs-subst">{i}</span>.mp4"</span>
        subprocess.run([<span class="hljs-string">'ffmpeg'</span>, <span class="hljs-string">'-i'</span>, video_path, <span class="hljs-string">'-ss'</span>, <span class="hljs-built_in">str</span>(clip[<span class="hljs-string">'timestamp'</span>]), <span class="hljs-string">'-t'</span>, <span class="hljs-string">'2'</span>, clip_path, <span class="hljs-string">'-y'</span>, <span class="hljs-string">'-loglevel'</span>, <span class="hljs-string">'quiet'</span>])
        temp_clips.append(clip_path)
    
    <span class="hljs-comment"># 拼接</span>
    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">'list.txt'</span>, <span class="hljs-string">'w'</span>) <span class="hljs-keyword">as</span> f:
        <span class="hljs-keyword">for</span> clip <span class="hljs-keyword">in</span> temp_clips:
            f.write(<span class="hljs-string">f"file '<span class="hljs-subst">{clip}</span>'\n"</span>)
    
    subprocess.run([<span class="hljs-string">'ffmpeg'</span>, <span class="hljs-string">'-f'</span>, <span class="hljs-string">'concat'</span>, <span class="hljs-string">'-safe'</span>, <span class="hljs-string">'0'</span>, <span class="hljs-string">'-i'</span>, <span class="hljs-string">'list.txt'</span>, <span class="hljs-string">'-c'</span>, <span class="hljs-string">'copy'</span>, output_path, <span class="hljs-string">'-y'</span>, <span class="hljs-string">'-loglevel'</span>, <span class="hljs-string">'quiet'</span>])

<span class="hljs-comment"># demo：完整流程</span>
analysis = analyze_video(<span class="hljs-string">"input.mp4"</span>)
frames = extract_frames(<span class="hljs-string">"input.mp4"</span>)
clips = semantic_match(analysis, frames)
create_video(<span class="hljs-string">"input.mp4"</span>, clips, <span class="hljs-string">"highlight.mp4"</span>)
<span class="hljs-comment"># 流程: 视频→Nova理解→视频抽帧为图片→MME匹配→拼接</span>
<span class="hljs-comment"># 返回: highlight.mp4</span>
</code></pre>
<p><strong>应用案例：小猫草地玩耍高光提取</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb182b8f679945208144aa2c889b0d9d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=83MZ5LZ5nqtIa%2FluJ4N6JYhaITc%3D" alt="image.png" loading="lazy"/>
1min <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pexels.com%2Fzh-cn%2Fvideo%2F3116737%2F" target="_blank" title="https://www.pexels.com/zh-cn/video/3116737/" ref="nofollow noopener noreferrer">原始视频</a>                                       
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bcb09dc72eb54ce5805f18e5740d0385~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=oCy0gYiV74eWthWxBPCavUGBmaw%3D" alt="image.png" loading="lazy"/>
16s 高光视频</p>
<p>该视频的大部分时间是小猫在草地上张望，主要高光片段为：</p>
<ul>
<li>在第21s到第28s：小猫有向前扑的动作</li>
<li>第37s到第43s：小猫回到原位坐下回头看向镜头</li>
</ul>
<p>和2.1 基本方案类似，进行第1步将整个视频作为输入，使用VLM进行视频分析，提取高光要点以及优先级：</p>
<pre><code class="hljs language-css" lang="css">**视频总结：**
这段视频展示了一只橙色和白色相间的小猫在草地上的活动。从开始到结束，小猫一直在草地上探索、玩耍，并最终发现并尝试吃一个蛋壳。

原始高光要点列表：
<span class="hljs-selector-tag">A</span>. <span class="hljs-selector-attr">[优先级1]</span> <span class="hljs-selector-attr">[0:00-0:05]</span> - 小猫在草地上坐下，观察周围环境，展示了它的好奇心和警觉性
<span class="hljs-selector-tag">B</span>. <span class="hljs-selector-attr">[优先级2]</span> <span class="hljs-selector-attr">[0:23-0:25]</span> - 小猫抬头看向远处，表现出对环境的探索和兴趣
C. <span class="hljs-selector-attr">[优先级1]</span> <span class="hljs-selector-attr">[0:27-0:30]</span> - 小猫发现地上的蛋壳，并开始尝试吃掉，展示了它的食欲和探索行为
D. <span class="hljs-selector-attr">[优先级2]</span> <span class="hljs-selector-attr">[0:33-0:35]</span> - 小猫尝试吃蛋壳时，表现出一些困惑和不确定的表情，增加了视频的趣味性
E. <span class="hljs-selector-attr">[优先级1]</span> <span class="hljs-selector-attr">[0:37-0:40]</span> - 小猫最终成功吃掉了蛋壳，并继续在草地上活动，展示了它的满足感
</code></pre>
<p>接下来进行的2～4步的处理，以1s为间隔对视频进行抽帧，对高光要点与抽帧后的图片进行嵌入生成与语义匹配，最后根据抽帧间隔与帧起始时间合并连续片段。最终提取出9个连续的高光片段（总时长16秒）如下表所示：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb64ef7f9c4d46d3b751316c8d306c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=2l%2FMkUO8wt%2BpA%2FpweOml7hz1aBs%3D" alt="image.png" loading="lazy"/></p>
<p>从结果上看，高光视频短片包含了原视频中2个主要高光瞬间（扑抓动作和看向镜头），同时也整合了VLM分析中关于小猫“靠近、玩弄/咬住蛋壳”的高优先级动作片段（对应片段4、5、7、8），跳过了较长的静态张望部分同时保持了一定的动作连贯性。<br/>
总结：该方案优点是资源消耗更低、实现速度更快；但缺点在于抽帧可能丢失动作延续或动态效果，因此定位精度可能略逊于方案 2，适合快速试验或成本/资源受限的场景。</p>
<h2 data-id="heading-16">附加考虑：BGM，转场动画，字幕及其他自动化</h2>
<p><strong>背景音乐匹配</strong>：高光剪辑常配以恰当的背景音乐（BGM）增强观赏性。我们可以利用上述文本描述和嵌入技术来自动挑选BGM。例如，将高光片段的<strong>文字描述</strong>（来自VLM总结的高光要点）输入音乐库的嵌入查询，寻找语义上契合的音乐片段。音乐库中每首背景音乐可事先标注情绪、风格或含有描述文本，按需检索。举例来说，如果高光描述提到“激动人心的绝杀时刻”，系统可能选择一首节奏紧凑、激昂的配乐与之对应。</p>
<p><strong>视觉转场和特效</strong>：生成剪辑时还可考虑自动添加一些转场效果或字幕说明。例如，在片段衔接处插入快速淡入淡出或动感转场，以增强流畅度（这里可以用大模型基于提示词直接生成剪辑剧本和转场动画标签）；<strong>增加字幕：</strong>  字幕可用各方案第一阶段的VLM输出的描述增加到对应的高光片段上，或进一步用LLM优化，在对应片段下方叠加字幕或标题，提示观众这个片段精彩之处（例如“最后三秒绝杀进球！”）。</p>
<p><strong>迭代优化</strong>：在实际应用中，可以根据用户反馈或观看数据，不断优化高光选择规则和效果处理。例如统计哪些自动生成的高光片段留存率高，哪种BGM搭配更受欢迎，反过来调整VLM的提示词和相似度匹配的阈值，形成<strong>反馈循环</strong>，逐步提高高光剪辑的质量。</p>
<h2 data-id="heading-17">总结与讨论：应用场景，方案特点和选型思路</h2>
<p>综上所述，本方案提出了一套利用AI进行视频高光剪辑的思路：从基本的纯大语言模型识别高光节点，到语义摘要+嵌入检索实现跨素材的检索和剪辑，并提供了随着素材积累逐步提升的思路。</p>
<h3 data-id="heading-18">VLM 直接识别 vs 嵌入模型检索：</h3>
<p>随着模型规模与多模态预训练技术的发展，现代 VLM （比如本文案例中使用的Nova理解类模型）擅长同时处理视觉内容、语义信息与时序结构。它们能够从整段视频中快速提取“哪些时刻是高光”“这些高光的起止时间在哪里”，因为它们在训练阶段已学习到“动作／事件 → 关键帧”与“视觉＋语言语义”之间的对应关系。在现实剪辑任务中，如果视频结构相对简单、动作明显、视觉变化突出，VLM 直接识别的路径可能几乎一步到位：模型读取视频，识别出“高光动作”或“精彩节点”，并直接标出时间戳。在这种场景下，少了切片、分割、索引、匹配等环节，流程更短、响应更快。</p>
<p>那么为什么我们在解决方案里引入嵌入模型？其价值主要体现在以下几个方面：第一，在素材库规模大、跨视频检索需求高的场景，嵌入模型使你能够为每个视频片段或帧生成可索引的向量，从而构建“素材库可复用＋检索加速”的结构。通过这种方式，无论未来你要处理多少条视频或多少次剪辑任务，都可以依赖已生成的向量库进行高效检索，而不是每次都让 VLM 全面扫描。第二，对于高度定制化剪辑需求（如品牌剧本、风格统一、跨视频片段拼接）来说，嵌入模型提供了更强的“匹配”能力：你可以用描述或事件提示作为查询，在向量空间中查找与之最相似的片段，再组合成成片。这种方法更适用于“从大量素材中选”“按照用户剧本拼接”这类复杂任务。</p>
<h4 data-id="heading-19"><strong>为方便产品或技术团队快速决策，下面是选型建议：</strong></h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f9f33c35b0843a2877548a574e34b0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=VGU5UmbjGPe84Gbc5T52%2BqGc4jk%3D" alt="image.png" loading="lazy"/></p>
<p>自动高光剪辑技术方案可用于制造业如相机云存剪辑， 媒资场景如明星高光，电视剧摘要等。在未来，我们期待这种自动化高光剪辑能够大幅减少人工剪辑耗时，实现“一键生成精彩瞬间”，为内容创作者和观众带来更高效的体验，为亚马逊云科技客户产品带来创新和效益。</p>
<h2 data-id="heading-20">可用性与定价</h2>
<p>Amazon Nova理解类模型和多模态嵌入模型现已在Amazon Bedrock上线，可用区域包括美国东部（弗吉尼亚北部）的亚马逊云科技区域。如需详细定价信息，请参阅Amazon Bedrock定价页面（<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fbedrock%2Fpricing%2F" target="_blank" title="https://aws.amazon.com/bedrock/pricing/" ref="nofollow noopener noreferrer">Amazon Bedrock pricing page</a>）。</p>
<p>*<em>前述特定亚马逊云科技生成式人工智能相关的服务目前在亚马逊云科技海外区域可用。亚马逊云科技中国区域相关云服务由西云数据和光环新网运营，具体信息以中国区域官网为准。</em></p>
<p><strong>本篇作者</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/337c383a2ffd4ca896a811ddbc19f5c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lqa6ams6YCK5LqR5byA5Y-R6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767626353&amp;x-signature=rlqrvayjVZRqmo1xKaI38qJCvW0%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>本期最新实验《<a href="https://link.juejin.cn?target=https%3A%2F%2Fevents.amazoncloud.cn%2Flabs%2Fcloudlab-amazon-bedrock-first-experience%3Fvisitfrom%3D3P_Juejintail_1223%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_1223" target="_blank" title="https://events.amazoncloud.cn/labs/cloudlab-amazon-bedrock-first-experience?visitfrom=3P_Juejintail_1223&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_1223" ref="nofollow noopener noreferrer">多模一站通 —— Amazon Bedrock 上的基础模型初体验</a>》</p>
<p>✨ 精心设计，旨在引导您深入探索Amazon Bedrock的模型选择与调用、模型自动化评估以及安全围栏(Guardrail)等重要功能。无需管理基础设施，利用亚马逊技术与生态，快速集成与部署生成式AI模型能力。</p>
<p>⏩️[<a href="https://link.juejin.cn?target=https%3A%2F%2Fevents.amazoncloud.cn%2Flabs%2Fcloudlab-amazon-bedrock-first-experience%3Fvisitfrom%3D3P_Juejintail_1223%26sc_medium%3Downed%26sc_campaign%3Dcloudlab%26sc_channel%3D3P_Juejintail_1223" target="_blank" title="https://events.amazoncloud.cn/labs/cloudlab-amazon-bedrock-first-experience?visitfrom=3P_Juejintail_1223&amp;sc_medium=owned&amp;sc_campaign=cloudlab&amp;sc_channel=3P_Juejintail_1223" ref="nofollow noopener noreferrer">点击进入实验</a>] 即刻开启  AI 开发之旅</p>
<p>构建无限, 探索启程！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[实战记录：使用 Haskell.nix 交叉编译 Haskell 项目至 Windows]]></title>    <link>https://juejin.cn/post/7589110783146672162</link>    <guid>https://juejin.cn/post/7589110783146672162</guid>    <pubDate>2025-12-29T15:19:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589110783146672162" data-draft-id="7589110783146655778" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="实战记录：使用 Haskell.nix 交叉编译 Haskell 项目至 Windows"/> <meta itemprop="keywords" content="Haskell,Windows"/> <meta itemprop="datePublished" content="2025-12-29T15:19:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Lupino"/> <meta itemprop="url" content="https://juejin.cn/user/3051900006579256"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            实战记录：使用 Haskell.nix 交叉编译 Haskell 项目至 Windows
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3051900006579256/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Lupino
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T15:19:33.000Z" title="Mon Dec 29 2025 15:19:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 Haskell 开发中，使用 Nix 进行构建能带来极大的便利，尤其是涉及跨平台交叉编译时。本文记录了将一个基于 <code>haskell.nix</code> 的项目（<code>haskell-periodic</code>）配置为支持 Windows (<code>mingwW64</code>) 交叉编译的全过程。</p>
<h2 data-id="heading-0">1. 调整构建脚本 (<code>Makefile</code>)</h2>
<p>原始的 <code>Makefile</code> 1 主要是针对 Linux (musl) 环境设计的，缺少对 Windows 可执行文件后缀（<code>.exe</code>）和特定工具链的支持。</p>
<p>为了支持 Windows 交叉编译，我们需要在 <code>Makefile</code> 中增加对 <code>mingwW64</code> 平台的分支判断，主要修改点如下：</p>
<ol>
<li><strong>定义 Strip 工具</strong>：Linux 下通常使用 standard <code>strip</code>，但在交叉编译 Windows 版本时，必须使用对应的 <code>x86_64-w64-mingw32-strip</code>。</li>
<li><strong>处理文件后缀</strong>：Windows 可执行文件需要 <code>.exe</code> 后缀，而 Linux 不需要。</li>
<li><strong>修改输出目标</strong>：构建目标路径需要动态追加这个后缀。</li>
</ol>
<p><strong>修改后的 <code>Makefile</code> 片段：</strong></p>
<p>Makefile</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># ... 之前的定义 ...</span>

<span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(PLATFORM)</span>,mingwW64)
<span class="hljs-comment"># Windows 平台特定配置</span>
STRIP = x86_64-w64-mingw32-strip
COMPILER ?= ghc9122
EXT = .exe
<span class="hljs-keyword">else</span>
<span class="hljs-comment"># ... 其他平台配置 ...</span>
<span class="hljs-keyword">endif</span>

<span class="hljs-comment"># ...</span>

<span class="hljs-comment"># 针对每个组件，确保输出包含后缀 $(EXT)</span>
<span class="hljs-section">periodic:</span>
	PKG=periodic-client-exe make dist/<span class="hljs-variable">$(PLATFORM)</span>/<span class="hljs-variable">$@</span><span class="hljs-variable">$(EXT)</span>

<span class="hljs-comment"># ... 其他组件类似 ...</span>
</code></pre>
<p>通过运行 <code>make PLATFORM=mingwW64</code>，构建系统现在可以正确识别目标平台并尝试生成 <code>.exe</code> 文件。</p>
<h2 data-id="heading-1">2. 遭遇链接错误：UCRT 与 MSVCRT 冲突</h2>
<p>在调整完 <code>Makefile</code> 并尝试构建后，我们在链接阶段（Linking）遇到了如下错误：</p>
<p>Plaintext</p>
<pre><code class="hljs language-vbnet" lang="vbnet">multiple definition <span class="hljs-keyword">of</span> `__getmainargs<span class="hljs-comment">'</span>
multiple definition <span class="hljs-keyword">of</span> `_onexit<span class="hljs-comment">'</span>
multiple definition <span class="hljs-keyword">of</span> `_amsg_exit<span class="hljs-comment">'</span>
...
</code></pre>
<p>问题分析：</p>
<p>这是一个经典的 Windows C 运行时冲突问题。现代的 GHC 和 Nix 工具链倾向于使用 UCRT (Universal C Runtime)，但某些依赖或 GHC 内部组件可能引入了旧版的 MSVCRT (Microsoft Visual C Runtime)。当链接器同时遇到这两套库的符号定义时，就会报“多重定义”错误。</p>
<h2 data-id="heading-2">3. 修正 Nix 配置 (<code>default.nix</code>)</h2>
<p>为了解决这个问题，我们需要通过 GHC 传递参数给链接器，告诉它允许符号的多重定义（让链接器自动选择其中一个）。</p>
<p>我们需要修改 <code>default.nix</code> 2222，利用 <code>haskell.nix</code> 提供的模块系统 (<code>modules</code>) 注入特定的 <code>configureFlags</code>。</p>
<p><strong>修改后的 <code>default.nix</code> 关键部分：</strong></p>
<p>Nix</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># ... 头部引入保持不变 ...</span>

in pkgs.haskell-nix.cabalProject {
    <span class="hljs-comment"># ... src, index-state 等配置 ...</span>
    
    <span class="hljs-attr">modules</span> = [(
       {pkgs, ...}: {
         enableProfiling = enableProfiling<span class="hljs-comment">;</span>

         <span class="hljs-comment"># --- Windows 交叉编译修复 ---</span>
         <span class="hljs-comment"># 针对 Windows 平台，添加链接器参数以解决 UCRT/MSVCRT 冲突</span>
         packages.periodic-client-exe.configureFlags = pkgs.lib.optionals pkgs.stdenv.hostPlatform.isWindows [
           <span class="hljs-string">"--ghc-option=-optl-Wl,--allow-multiple-definition"</span>
         ]<span class="hljs-comment">;</span>

         <span class="hljs-comment"># 如果 Server 端也需要在 Windows 构建，同样应用该修复</span>
         packages.periodic-server.configureFlags = pkgs.lib.optionals pkgs.stdenv.hostPlatform.isMusl [
           <span class="hljs-comment"># ... 保留原有的 Linux/Musl 链接库配置 ...</span>
           <span class="hljs-string">"--ghc-option=-optl=-lssl"</span>
           <span class="hljs-comment"># ...</span>
         ] ++ pkgs.lib.optionals pkgs.stdenv.hostPlatform.isWindows [
           <span class="hljs-string">"--ghc-option=-optl-Wl,--allow-multiple-definition"</span>
         ]<span class="hljs-comment">;</span>
      })]<span class="hljs-comment">;</span>
}
</code></pre>
<p>这里使用了 <code>pkgs.lib.optionals pkgs.stdenv.hostPlatform.isWindows</code> 来确保这些标志仅在编译 Windows 版本时生效，不会影响 Linux 版本的构建。</p>
<h2 data-id="heading-3">4. 最终结果</h2>
<p>完成上述修改后，再次执行构建命令：</p>
<p>Bash</p>
<pre><code class="hljs language-ini" lang="ini">make <span class="hljs-attr">PLATFORM</span>=mingwW64
</code></pre>
<p>构建过程顺利通过链接阶段，成功在 <code>dist/mingwW64/</code> 目录下生成了 Windows 可执行文件（如 <code>periodic.exe</code>）。通过这种方式，我们利用 Nix 强大的交叉编译能力，在不离开 Linux 开发环境的情况下，优雅地交付了 Windows 二进制文件。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Playwright使用体验]]></title>    <link>https://juejin.cn/post/7589155289190973467</link>    <guid>https://juejin.cn/post/7589155289190973467</guid>    <pubDate>2025-12-29T15:29:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589155289190973467" data-draft-id="7337186171209220111" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Playwright使用体验"/> <meta itemprop="keywords" content="前端,单元测试"/> <meta itemprop="datePublished" content="2025-12-29T15:29:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="布列瑟农的星空"/> <meta itemprop="url" content="https://juejin.cn/user/976022056218471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Playwright使用体验
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/976022056218471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    布列瑟农的星空
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T15:29:44.000Z" title="Mon Dec 29 2025 15:29:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Playwright 安装</h2>
<p>在项目中执行<code>yarn create playwright</code>即可。该命令会在package.json中添加依赖，并生成以下文件和目录。</p>
<pre><code class="hljs language-arduino" lang="arduino">playwright.config.ts  
tests/  
    example.spec.ts  
tests-examples/  
    demo-todo-app.spec.ts
</code></pre>
<h2 data-id="heading-1">Playwright 配置</h2>
<p>playwright.config.ts是Playwrigth的配置文件，生成文件基本不用改动即可运行。</p>
<pre><code class="hljs language-php" lang="php">import { defineConfig, devices } <span class="hljs-keyword">from</span> <span class="hljs-string">'@playwright/test'</span>;

<span class="hljs-comment">/**
 * Read environment variables from file.
 * https://github.com/motdotla/dotenv
 */</span>
<span class="hljs-comment">// require('dotenv').config();</span>

<span class="hljs-comment">/**
 * See https://playwright.dev/docs/test-configuration.
 */</span>
export <span class="hljs-keyword">default</span> <span class="hljs-title function_ invoke__">defineConfig</span>({
  <span class="hljs-attr">testDir</span>: <span class="hljs-string">'./tests'</span>,
  <span class="hljs-comment">/* Run tests in files in parallel */</span>
  <span class="hljs-attr">fullyParallel</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-comment">/* Fail the build on CI if you accidentally left test.only in the source code. */</span>
  <span class="hljs-attr">forbidOnly</span>: !!process.env.CI,
  <span class="hljs-comment">/* Retry on CI only */</span>
  <span class="hljs-attr">retries</span>: process.env.CI ? <span class="hljs-number">2</span> : <span class="hljs-number">0</span>,
  <span class="hljs-comment">/* Opt out of parallel tests on CI. */</span>
  <span class="hljs-attr">workers</span>: process.env.CI ? <span class="hljs-number">1</span> : undefined,
  <span class="hljs-comment">/* Reporter to use. See https://playwright.dev/docs/test-reporters */</span>
  <span class="hljs-attr">reporter</span>: <span class="hljs-string">'html'</span>,
  <span class="hljs-comment">/* Shared settings for all the projects below. See https://playwright.dev/docs/api/class-testoptions. */</span>
  <span class="hljs-attr">use</span>: {
    <span class="hljs-comment">/* Base URL to use in actions like `await page.goto('/')`. */</span>
    // <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'http://local.test.com:3001'</span>,
    <span class="hljs-comment">/* Collect trace when retrying the failed test. See https://playwright.dev/docs/trace-viewer */</span>
    <span class="hljs-attr">trace</span>: <span class="hljs-string">'on-first-retry'</span>,
  },
  <span class="hljs-comment">/* Configure projects for major browsers */</span>
  <span class="hljs-attr">projects</span>: [
    { <span class="hljs-attr">name</span>: <span class="hljs-string">'setup'</span>, <span class="hljs-attr">testMatch</span>: /.*\.setup\.ts/ },
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">'chromium'</span>,
      <span class="hljs-attr">use</span>: {
        ...devices[<span class="hljs-string">'Desktop Chrome'</span>],
        <span class="hljs-attr">storageState</span>: <span class="hljs-string">'playwright/.auth/user.json'</span>,
        <span class="hljs-attr">viewport</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span> },
      },
      <span class="hljs-attr">dependencies</span>: [<span class="hljs-string">'setup'</span>],
    },

    // {
    //   <span class="hljs-attr">name</span>: <span class="hljs-string">'firefox'</span>,
    //   <span class="hljs-attr">use</span>: { ...devices[<span class="hljs-string">'Desktop Firefox'</span>] },
    // },

    // {
    //   <span class="hljs-attr">name</span>: <span class="hljs-string">'webkit'</span>,
    //   <span class="hljs-attr">use</span>: { ...devices[<span class="hljs-string">'Desktop Safari'</span>] },
    // },

    <span class="hljs-comment">/* Test against mobile viewports. */</span>
    // {
    //   <span class="hljs-attr">name</span>: <span class="hljs-string">'Mobile Chrome'</span>,
    //   <span class="hljs-attr">use</span>: { ...devices[<span class="hljs-string">'Pixel 5'</span>] },
    // },
    // {
    //   <span class="hljs-attr">name</span>: <span class="hljs-string">'Mobile Safari'</span>,
    //   <span class="hljs-attr">use</span>: { ...devices[<span class="hljs-string">'iPhone 12'</span>] },
    // },

    <span class="hljs-comment">/* Test against branded browsers. */</span>
    // {
    //   <span class="hljs-attr">name</span>: <span class="hljs-string">'Microsoft Edge'</span>,
    //   <span class="hljs-attr">use</span>: { ...devices[<span class="hljs-string">'Desktop Edge'</span>], <span class="hljs-attr">channel</span>: <span class="hljs-string">'msedge'</span> },
    // },
    // {
    //   <span class="hljs-attr">name</span>: <span class="hljs-string">'Google Chrome'</span>,
    //   <span class="hljs-attr">use</span>: { ...devices[<span class="hljs-string">'Desktop Chrome'</span>], <span class="hljs-attr">channel</span>: <span class="hljs-string">'chrome'</span> },
    // },
  ],
  <span class="hljs-attr">timeout</span>: <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
  <span class="hljs-comment">/* Run your local dev server before starting the tests */</span>
  <span class="hljs-attr">webServer</span>: {
    <span class="hljs-attr">command</span>: <span class="hljs-string">'yarn dev'</span>,
    <span class="hljs-attr">url</span>: <span class="hljs-string">'http://local.aaa.com:3001'</span>,
    <span class="hljs-attr">reuseExistingServer</span>: !process.env.CI,
  },
});

</code></pre>
<p>不过在实践中，有几项建议修改：</p>
<ol>
<li>
<p>baseURL，设置后，使用 page.goto不需要再指定完整路径</p>
</li>
<li>
<p>timeout，不知道是否是网络原因，Playwright打开网页总是很慢，测试用例很容易跑超时，所以我将timeout改成了5 * 60 * 1000</p>
</li>
<li>
<p>webServer 本地测试时强烈建议开启该功能</p>
<pre><code class="hljs language-yaml" lang="yaml">  <span class="hljs-attr">webServer:</span> {
    <span class="hljs-attr">command:</span> <span class="hljs-string">'yarn dev'</span>,
    <span class="hljs-attr">url:</span> <span class="hljs-string">'http://local.test.com:3001'</span>,
    <span class="hljs-attr">reuseExistingServer:</span> <span class="hljs-type">!process.env.CI,</span>
  }<span class="hljs-string">,</span>
</code></pre>
<p>运行测试时，Playwright将先运行<code>yarn dev</code>启动服务，并等待<a href="https://link.juejin.cn?target=http%3A%2F%2Flocal.test.com%3A3001" target="_blank" title="http://local.test.com:3001" ref="nofollow noopener noreferrer">local.test.com:3001</a> 可访问时再开始测试。这个配置非常好用，相对比<strong>cypress</strong>就需要额外安装<strong>start-server-and-test</strong>。</p>
</li>
<li>
<p>用户登录相关，见下一节。</p>
</li>
</ol>
<h2 data-id="heading-2">Playwright缓存用户登录信息</h2>
<p>一般运行测试前需要先进行登录，Playwright可以缓存用户信息，在之后多次测试中复用，配置也很简单。</p>
<h3 data-id="heading-3">创建auth文件夹</h3>
<p>按照官网建议，直接在项目中创建playwright.auth文件夹</p>
<h3 data-id="heading-4">编写登录程序</h3>
<p>在tests目录中新增auth.setup.ts,内容可参考如下</p>
<pre><code class="hljs language-csharp" lang="csharp">import { test <span class="hljs-keyword">as</span> setup, expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'@playwright/test'</span>;

<span class="hljs-keyword">const</span> authFile = <span class="hljs-string">'playwright/.auth/user.json'</span>;

setup(<span class="hljs-string">'authenticate'</span>, <span class="hljs-keyword">async</span> ({ page }) =&gt; {
  <span class="hljs-comment">// Perform authentication steps. Replace these actions with your own.</span>
  <span class="hljs-keyword">await</span> page.<span class="hljs-keyword">goto</span>(<span class="hljs-string">'https://xxx.xxx.com/login/'</span>);
  <span class="hljs-keyword">await</span> page.locator(<span class="hljs-string">'#account'</span>).fill(<span class="hljs-string">'xxx'</span>);
  <span class="hljs-keyword">await</span> page.locator(<span class="hljs-string">'#password'</span>).fill(<span class="hljs-string">'xxx'</span>);
  <span class="hljs-keyword">await</span> page.locator(<span class="hljs-string">'button[type=submit]'</span>).click();
  <span class="hljs-comment">// Wait until the page receives the cookies.</span>
  <span class="hljs-comment">//</span>
  <span class="hljs-comment">// Sometimes login flow sets cookies in the process of several redirects.</span>
  <span class="hljs-comment">// Wait for the final URL to ensure that the cookies are actually set.</span>
  <span class="hljs-keyword">await</span> page.waitForURL(<span class="hljs-string">'https://xxx.xxx.com/'</span>);

  <span class="hljs-comment">// Alternatively, you can wait until the page reaches a state where all cookies are set.</span>
  <span class="hljs-keyword">await</span> expect(page.locator(<span class="hljs-string">'#title'</span>)).toBeVisible();

  <span class="hljs-comment">// End of authentication steps.</span>

  <span class="hljs-keyword">await</span> page.context().storageState({ path: authFile });
});
</code></pre>
<p>这段代码先访问统一登录地址（测试网页域名可能和登录地址不一样），模拟输入用户名/密码，点击提交。登录成功后，<code>page.context().storageState({ path: authFile })</code>将cookie/storage信息存入authFile文件。</p>
<h3 data-id="heading-5">修改配置文件</h3>
<p>修改配置文件中的projects配置</p>
<pre><code class="hljs language-css" lang="css">  projects: [
    { name: <span class="hljs-string">'setup'</span>, testMatch: /.*\.setup\.ts/ },
    {
      name: <span class="hljs-string">'chromium'</span>,
      use: {
        ..<span class="hljs-selector-class">.devices</span><span class="hljs-selector-attr">[<span class="hljs-string">'Desktop Chrome'</span>]</span>,
        storageState: <span class="hljs-string">'playwright/.auth/user.json'</span>,
        viewport: { <span class="hljs-attribute">width</span>: <span class="hljs-number">1920</span>, height: <span class="hljs-number">1080</span> },
      },
      dependencies: [<span class="hljs-string">'setup'</span>],
    },
    ...
]
</code></pre>
<h2 data-id="heading-6">Playwright 运行</h2>
<p>直接运行命令<code>yarn playwright test --ui</code>,会出现下面弹窗</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a538aab8026458e8a901e31a302e406~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1257&amp;h=762&amp;s=55570&amp;e=png&amp;b=fcfcfc" alt="image.png" loading="lazy"/></p>
<p>点击example.spec.ts旁边的开始键就可以运行测试用例了，可以看到auth.setup.ts中的登录程序也被自动运行了。
点击每个用例可以显示更多运行信息。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/51d573378b53403b948775464fc29caf~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=316&amp;h=325&amp;s=16355&amp;e=png&amp;b=f6f5f5" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-7">Playwright 简单小结</h2>
<p>Playwright上手非常简单，但是ui mode比较简陋，不适合边测试边debug。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GPT-5.1 发布：更聪明，也更有温度的 AI]]></title>    <link>https://juejin.cn/post/7589126920286683146</link>    <guid>https://juejin.cn/post/7589126920286683146</guid>    <pubDate>2025-12-29T15:49:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286683146" data-draft-id="7589130173837918258" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GPT-5.1 发布：更聪明，也更有温度的 AI"/> <meta itemprop="keywords" content="算法,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T15:49:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GPT-5.1 发布：更聪明，也更有温度的 AI
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T15:49:20.000Z" title="Mon Dec 29 2025 15:49:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>昨天深夜，OpenAI 悄然上线了 GPT-5.1 系列模型，带来了两个全新版本：<strong>GPT-5.1 Instant</strong> 和 <strong>GPT-5.1 Thinking</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe5eca69a1564698999678c73538be36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628159&amp;x-signature=NXmfYR66crDv%2FFxFgx%2BxtrqdKOY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/daeacd9e1b92466e98a42d5612906977~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628159&amp;x-signature=mk5bttlVO8R8LAg%2F%2BvAGMZVy43k%3D" alt="" loading="lazy"/></p>
<p>这次更新看似低调，却在智能与交互体验上都迈出了一大步。</p>
<p>所有相关源码示例、流程图、面试八股、模型配置与知识库构建技巧，我也将持续更新在Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faicoting%2FAIHub" target="_blank" title="https://github.com/aicoting/AIHub" ref="nofollow noopener noreferrer"><strong>AIHub</strong></a>，欢迎关注收藏！</p>
<h2 data-id="heading-0">一、GPT-5.1 Instant：更快、更聪明、更贴心</h2>
<p>如果说 GPT-5 是一位理性的工程师，那么 GPT-5.1 Instant 就像是那位既懂逻辑又会聊天的朋友。它延续了 GPT-5 的高准确性，同时在语气、理解力和指令执行上都有明显提升。</p>
<p>根据早期体验，Instant 的最大特点是<strong>自适应推理</strong>。简单来说，它能根据问题的复杂程度决定自己要不要<strong>认真思考</strong>一下——对轻量问题迅速回应，对复杂问题自动进入深度推理模式。这种平衡带来了前所未有的流畅感：既保留速度，又不牺牲质量。</p>
<p>同时，它在数学、代码和逻辑题上的正确率也显著提升，AIME 2025 与 Codeforces 等测试的表现就是明证。</p>
<h2 data-id="heading-1">二、GPT-5.1 Thinking：更稳、更懂、更人性</h2>
<p>与 Instant 侧重速度不同，<strong>GPT-5.1 Thinking</strong> 是 OpenAI 面向复杂任务推出的深思型模型。它的更新重点在于推理策略的改进：<strong>根据任务难度动态分配思考时间</strong>。</p>
<ul>
<li>遇到简单问题：迅速作答；</li>
<li>面对复杂推理：自动延长思考，输出更系统的结论。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f5e983a9f9f4dd09fcec24cb3df31bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628159&amp;x-signature=TGc5cx9Efe8bi9bHWgsjvC3pJjY%3D" alt="" loading="lazy"/></p>
<p>同时，它在表达上也更自然了。过去有时回答技术问题容易夹杂生僻术语，而 5.1 Thinking 更倾向于用<strong>清晰、易懂、带温度的语言</strong>解释复杂概念。<br/>
比如当它讲解棒球统计中的 <em>BABIP</em> 和 <em>wRC+</em> 时，不再是晦涩的公式堆砌，而是像在和你聊天一样解释击球效率与进攻贡献的关系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/343b2e985fb4497db1f204a90a3aee08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628159&amp;x-signature=Qs0TJhjC8xAM46p8Egme6w3k3RM%3D" alt="" loading="lazy"/></p>
<p>这让 GPT-5.1 Thinking 更像是一位真正的 AI 助手，而不是冷冰冰的算法模型。</p>
<h2 data-id="heading-2">三、更智能的模型调度：Auto 模式升级</h2>
<p>值得注意的是，GPT-5.1 系列还改进了 <strong>Auto 路由机制</strong>。也就是说，当你与 ChatGPT 对话时，系统会自动判断是调用 Instant 还是 Thinking，无需手动切换。<br/>
对于普通用户来说，这意味着更自然的体验：</p>
<ul>
<li>聊天类任务 → Instant</li>
<li>推理、写作、分析类任务 → Thinking</li>
</ul>
<p>AI 将自己决定该用哪种大脑思考，而你只需专注于问题本身。</p>
<p>GPT-5.1 Instant 与 Thinking 已面向 Pro、Plus、Go、Business 用户逐步开放，企业版和教育版可以提前开启早期访问。API 版本也即将同步上线，其中：</p>
<ul>
<li><code>gpt-5.1-chat-latest</code> 对应 Instant；</li>
<li><code>gpt-5.1</code> 对应 Thinking。</li>
</ul>
<p>在接下来的三个月里，GPT-5 与 GPT-5.1 将并行提供，方便开发者与用户进行对比测试。之后，GPT-5.1 将成为默认模型。</p>
<p>从 GPT-3 的惊艳登场，到 GPT-4 的多模态能力，再到如今 GPT-5.1 的思考升级，我们能明显感受到——<strong>AI 的进化正从更强走向更懂</strong>。<br/>
它不再只是工具，而是会感知语气、理解语境、体谅情绪的伙伴。</p>
<p>Sam Altman 在社交平台上说：这是一次不错的模型升级。<br/>
但对许多用户而言，这不仅仅是不错，而是让人与机器对话再次变得愉悦的一次跨越。</p>
<p>关于深度学习和AI大模型相关的知识和前沿技术更新，请关注公众号 <strong>coting</strong>！</p>
<p><strong>GPT系列文章</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1927401841815160673" target="_blank" title="https://zhuanlan.zhihu.com/p/1927401841815160673" ref="nofollow noopener noreferrer">GPT1：通用语言理解模型的开端</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1927841343062910920" target="_blank" title="https://zhuanlan.zhihu.com/p/1927841343062910920" ref="nofollow noopener noreferrer">GPT-2：让语言模型一统多任务学习江湖</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1927843404387189930" target="_blank" title="https://zhuanlan.zhihu.com/p/1927843404387189930" ref="nofollow noopener noreferrer">GPT-3：真正意义上的少样本学习模型来了！</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1927844194703111701" target="_blank" title="https://zhuanlan.zhihu.com/p/1927844194703111701" ref="nofollow noopener noreferrer">GPT‑3.5：从语言模型迈向对话智能的过渡之作</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1927844769058497732" target="_blank" title="https://zhuanlan.zhihu.com/p/1927844769058497732" ref="nofollow noopener noreferrer">GPT‑4：多模态大规模模型，开启更智能时代</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1937287790099427783" target="_blank" title="https://zhuanlan.zhihu.com/p/1937287790099427783" ref="nofollow noopener noreferrer">GPT-5：天变了吗？还是风停了？</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[激活函数有什么用？有哪些常用的激活函数？]]></title>    <link>https://juejin.cn/post/7589126920286699530</link>    <guid>https://juejin.cn/post/7589126920286699530</guid>    <pubDate>2025-12-29T15:50:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286699530" data-draft-id="7589092567545151497" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="激活函数有什么用？有哪些常用的激活函数？"/> <meta itemprop="keywords" content="算法,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T15:50:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="aicoting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            激活函数有什么用？有哪些常用的激活函数？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    aicoting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T15:50:42.000Z" title="Mon Dec 29 2025 15:50:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在深度学习中，<strong>激活函数</strong>（Activation Function）是神经网络的灵魂。它不仅赋予网络非线性能力，还决定了训练的稳定性和模型性能。那么，激活函数到底是什么？为什么我们非用不可？有哪些经典函数？又该如何选择？本文带你全面解析。</p>
<p>所有相关源码示例、流程图、面试八股、模型配置与知识库构建技巧，我也将持续更新在Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faicoting%2FLLMHub" target="_blank" title="https://github.com/aicoting/LLMHub" ref="nofollow noopener noreferrer"><strong>AIHub</strong></a>，欢迎关注收藏！</p>
<p>阅读本文时，请带着这三个问题思考：</p>
<ol>
<li><strong>什么是激活函数，为什么需要激活函数？</strong></li>
<li><strong>经典的激活函数有哪些？</strong></li>
<li><strong>怎么选择激活函数？</strong></li>
</ol>
<h2 data-id="heading-0">1. 什么是激活函数，为什么需要激活函数</h2>
<p>激活函数的核心作用就是<strong>为神经网络引入非线性</strong>。</p>
<ul>
<li><strong>为什么需要非线性？</strong><br/>
想象一下，如果网络里每一层都是线性的（比如 y = Wx + b），无论堆叠多少层，最终网络都只是一条线性映射。深度堆叠就没有意义了，网络的表达能力非常有限。</li>
<li><strong>激活函数的作用</strong><br/>
激活函数在每个神经元输出前进行非线性变换，让网络可以拟合复杂的函数关系，从而解决分类、回归等非线性问题。</li>
</ul>
<p>**直观理解一下，**激活函数就像神经网络里的“开关”或“滤镜”，它决定了每个神经元应该多大程度地“激活”，从而使网络具备强大的表达能力。</p>
<h2 data-id="heading-1">2. 经典的激活函数</h2>
<p>在深度学习中，有几类经典激活函数，每种都有自己的优缺点：</p>
<h3 data-id="heading-2">1. Sigmoid</h3>
<p>公式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d0ad9beda4e42119cbd9362f53be253~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=ptnh%2Fhz5vcGj6b5gwL1bUpR8tVs%3D" alt="image" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8b89d84343e4984bc8a0ab33d824f37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=1SBHXbOC3b4QtDNuKX82xcfRRko%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>优点</strong>：输出范围在 (0,1)，可以表示概率</li>
<li><strong>缺点</strong>：容易<strong>饱和</strong>（输入过大或过小时梯度接近0，导致梯度消失）</li>
<li><strong>应用场景</strong>：二分类输出层</li>
</ul>
<h3 data-id="heading-3">2. Tanh（双曲正切）</h3>
<p>公式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ed53d7dbda34d6f80bc3825c16d3734~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=ckzbfplsuAP8aREpi1f%2BZDXz8WM%3D" alt="image" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29f27f75d26b42c9baf8b99e42646641~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=r44L5jVJcT4zT4w%2BPakx7TBFaYY%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>优点</strong>：输出在 (-1,1)，比 sigmoid 居中，对梯度更友好</li>
<li><strong>缺点</strong>：仍可能梯度消失</li>
<li><strong>应用场景</strong>：RNN 隐层</li>
</ul>
<h3 data-id="heading-4">3. ReLU（Rectified Linear Unit）</h3>
<p>公式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd97321578954a43abaa83d2970b2b5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=DfcmHM7MieHQieQT%2BtITR6%2FbiwI%3D" alt="image" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5c5a59b231741ac86f58f1d4d8ef749~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=uR2LqIyHxTTdLYKTqynwCysQ%2BUE%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>优点</strong>：计算简单，导数恒为1（正区间），缓解梯度消失</li>
<li><strong>缺点</strong>：负区间可能“死亡”，即神经元永远不激活</li>
<li><strong>应用场景</strong>：隐藏层主流激活函数</li>
</ul>
<h3 data-id="heading-5">4. Leaky ReLU / Parametric ReLU（PReLU）</h3>
<p>公式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cf02a80f97447a9b3bb7ef09cf50617~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=BHKLqDBd1mqQNgcamQGB5%2BYMadw%3D" alt="image" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a2795d46981e4cafaa7d406d19de9962~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=TmXzd6qcXuHLDFt0%2FORYYTs1a3A%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>Leaky ReLU</strong>: 对负区间引入一个小斜率，避免神经元死亡</li>
<li><strong>PReLU</strong>: 斜率可学习，更灵活</li>
</ul>
<h3 data-id="heading-6">5. Softmax</h3>
<p>公式</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1558d457e59947c7be327a98b0e14649~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=L0De9zrzJuOz1sJc9Zm9zVNfKeQ%3D" alt="image" loading="lazy"/></p>
<p>Softmax 输出的是一组归一化的概率，在图中使用 <strong>柱状图 (bar chart)</strong> 展示每个输入元素对应的概率值。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e9d314536aa448eb3acb2d005a5674f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=wUcSzAEC%2FpsWTlJqivGTZTTbKP0%3D" alt="" loading="lazy"/></p>
<ul>
<li><strong>作用</strong>：多分类输出概率分布</li>
<li><strong>应用场景</strong>：分类任务输出层</li>
</ul>
<h3 data-id="heading-7"><strong>6.ELU（Exponential Linear Unit）</strong></h3>
<p><strong>公式：</strong><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1dddb8708a8c4143a9049d3062dedaa1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=VqRHblPXIYQF%2FtAiOGkQ53CrZu0%3D" alt="image" loading="lazy"/><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea26be879fa0480db454f041ce8bae44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=V37QJPF05tMqeIaufug9VrTZgGg%3D" alt="" loading="lazy"/></p>
<p>**特点：**负区间平滑非零，避免 ReLU 死区问题。<br/>
<strong>优点：</strong> 输出均值更接近 0，梯度更稳定。<br/>
<strong>常用于：</strong> 深层 CNN、MLP。</p>
<h3 data-id="heading-8"><strong>7.SELU（Scaled Exponential Linear Unit）</strong></h3>
<p><strong>公式：</strong><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/894183225b05434abac399537c4ca560~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=q3e2g4JQOBMzNkq%2FdWO0zBJsQKc%3D" alt="image" loading="lazy"/><br/>
其中 λ≈1.05，α≈1.67。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b93c7811730e4c79a54c74bc282e65e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=Ssi94y8X7k0IFZAUghM9C%2BPNOH4%3D" alt="" loading="lazy"/><br/>
**特点：**在特定初始化下能实现自归一化，保持激活均值和方差稳定。<br/>
<strong>优点：</strong> 无需 BatchNorm。<br/>
<strong>常用于：</strong> 自归一化神经网络（Self-Normalizing NN）。</p>
<h3 data-id="heading-9"><strong>8.GELU（Gaussian Error Linear Unit）</strong></h3>
<p><strong>公式：</strong><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171c8445b7c44b16aabd39c6a3e577e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=YSn8H5DV603sbyp0FOk82szeIQA%3D" alt="image" loading="lazy"/><br/>
其中 Φ(x) 是标准正态分布 CDF。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7cfcd84e8f443318b65b78eee848724~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=mDFDgkxT40q6xvsPMkdTY8rqGQE%3D" alt="" loading="lazy"/><br/>
**特点：**在 ReLU 的基础上引入概率思想，让激活与输入大小平滑相关。<br/>
<strong>优点：</strong> 更平滑、更稳定，效果普遍优于 ReLU。<br/>
<strong>常用于：</strong> Transformer（BERT、GPT、ViT）。</p>
<h3 data-id="heading-10"><strong>9.SiLU（Swish）</strong></h3>
<p><strong>公式：</strong><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc2f9c2cfee745448a838e055416be27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=oVtgGTFdJlB8Ka%2BOL%2FiyZkVp%2BVA%3D" alt="image" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e862f7828d8f4e7d9fa221f72bfefe88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=5Y2TZoqFQ2qgfHtnuNw3Oq6%2Bu9k%3D" alt="" loading="lazy"/><br/>
**特点：**与 GELU 类似，是一种平滑版 ReLU。<br/>
<strong>优点：</strong> 梯度连续，优化更稳定。<br/>
<strong>常用于：</strong> EfficientNet、Transformer。</p>
<h3 data-id="heading-11"><strong>10.GLU（Gated Linear Unit）</strong></h3>
<p>GLU/SwiGLU 在实际中是门控形式（two linear branches），是向量上的逐元素操作；为了在一维上可视化，我用简化的标量形式来画图 —— 把两条分支都用相同的输入值（即把 a=x, b=x），因此 GLU(x) = x * sigmoid(x)，SwiGLU(x) = x * SiLU(x)。这能直观展示门控机制的形状差异。</p>
<p><strong>公式：</strong><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f4f780837184b4dae67ec7223e80f47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=Ny0IJcarFyGnlxBb02FBMNTkZdE%3D" alt="image" loading="lazy"/><br/>
其中第二个分支作为门控信号。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9a73a37d36f45d08eca136319ab69aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=8N12hEM6FfHKOU5iC2t2m53LHfE%3D" alt="" loading="lazy"/><br/>
**特点：**通过门控机制控制信息流，增强非线性表达。<br/>
<strong>优点：</strong> 适合序列建模、控制性强。<br/>
<strong>常用于：</strong> Transformer FFN、语言模型。</p>
<h3 data-id="heading-12"><strong>11.SwiGLU（Swish-Gated Linear Unit）</strong></h3>
<p><strong>公式：</strong><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4da9307de6714a66825dcf2de50313b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=%2BNHr9%2FyNTEeYsfIXAU9O4TqjR%2F0%3D" alt="image" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6ca723189314d97b673d9712cd76971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYWljb3Rpbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767628241&amp;x-signature=rYnsghrEX7AWtER3rGX8WMjnMxM%3D" alt="" loading="lazy"/><br/>
**特点：**GLU 的改进版，把 Sigmoid 门换成 Swish 门。<br/>
<strong>优点：</strong> 表达力更强、梯度更平滑，性能优于 ReLU/GELU。<br/>
<strong>常用于：</strong> LLaMA、PaLM、GPT-NeoX 等现代 LLM。</p>
<h2 data-id="heading-13">3. 怎么选择激活函数</h2>
<p>选择激活函数时，可以根据以下几个原则：</p>
<ol>
<li><strong>隐藏层</strong>
<ul>
<li>优先使用 ReLU 或其变种（Leaky ReLU, ELU, PReLU）</li>
<li>优点：计算快、缓解梯度消失</li>
</ul>
</li>
<li><strong>输出层</strong>
<ul>
<li>二分类：Sigmoid</li>
<li>多分类：Softmax</li>
<li>回归：线性或无激活函数</li>
</ul>
</li>
<li><strong>网络结构和任务需求</strong>
<ul>
<li>RNN 中常用 tanh 或 ReLU</li>
<li>深层网络推荐使用残差连接 + ReLU</li>
<li>如果担心 ReLU 死神经元，可尝试 Leaky ReLU 或 ELU</li>
</ul>
</li>
</ol>
<p><strong>小技巧</strong>：</p>
<p>如果不确定用哪个激活函数，隐藏层可以先用 ReLU，输出层按任务选择；训练中注意梯度情况，如果梯度消失或爆炸，再考虑替换或调整激活函数。</p>
<h2 data-id="heading-14">4. 总结</h2>
<p>激活函数是神经网络不可或缺的魔法开关，让网络能够拟合复杂的非线性关系。</p>
<ul>
<li><strong>核心作用</strong>：引入非线性，增强网络表达能力</li>
<li><strong>经典激活函数</strong>：Sigmoid、Tanh、ReLU及变种、ELU、Softmax</li>
<li><strong>选择策略</strong>：隐藏层用 ReLU 或变种，输出层根据任务选择，结合网络深度和训练表现调整</li>
</ul>
<p>理解激活函数的本质和特点，有助于设计更稳定、高效的神经网络。</p>
<p>最后我们来回答一下文章开头提出的三个问题：</p>
<ol>
<li><strong>什么是激活函数，为什么需要激活函数？</strong><br/>
激活函数是神经网络中对每个神经元输出进行非线性变换的函数，它的作用是赋予网络非线性能力，使得深层网络可以拟合复杂的函数关系。如果没有激活函数，无论网络有多少层，其输出都只是输入的线性组合，无法处理复杂问题。</li>
<li><strong>经典的激活函数有哪些？</strong><br/>
经典激活函数包括 Sigmoid、Tanh、ReLU 及其变种（如 Leaky ReLU、PReLU）、ELU 和 Softmax 等。其中，Sigmoid 和 Tanh 常用于小型网络或 RNN，ReLU 是深层网络隐藏层的主流选择，而 Softmax 常用于多分类任务的输出层。</li>
<li><strong>怎么选择激活函数？</strong><br/>
选择激活函数时，隐藏层通常优先使用 ReLU 或其变种，因为它计算简单且能缓解梯度消失；输出层则根据任务选择，比如二分类用 Sigmoid、多分类用 Softmax、回归任务可用线性或无激活函数；在特定场景下，也可以结合网络深度和训练表现灵活调整。</li>
</ol>
<p>关于深度学习和大模型相关的知识和前沿技术更新，请关注公众号coting！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[性能提升 40 倍！实战 PostgreSQL FDW 解决微服务跨库查询难题]]></title>    <link>https://juejin.cn/post/7589074117644976163</link>    <guid>https://juejin.cn/post/7589074117644976163</guid>    <pubDate>2025-12-29T14:03:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644976163" data-draft-id="7589093939656769588" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="性能提升 40 倍！实战 PostgreSQL FDW   解决微服务跨库查询难题"/> <meta itemprop="keywords" content="数据库,后端"/> <meta itemprop="datePublished" content="2025-12-29T14:03:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            性能提升 40 倍！实战 PostgreSQL FDW   解决微服务跨库查询难题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:03:03.000Z" title="Mon Dec 29 2025 14:03:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">微服务跨库查询：从 24 秒优化到 0.6 秒，我做了什么</h2>
<p>做运营看板的时候遇到个问题：需要把用户对 AI 回复的评价（点赞/点踩）和用户名一起展示出来。听起来简单，但数据分散在两个库里——评价数据在业务库，用户名在用户库。</p>
<p>第一反应是用 Superset 的跨库查询功能，结果查一次要 24 秒，完全没法用。</p>
<p>折腾了一圈，换成 PostgreSQL FDW 方案，同样的查询 0.6 秒就出来了。40 倍的性能差距。</p>
<p>meta database：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ae71d2ffe8747ef96e83bf243d76cfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621783&amp;x-signature=ELrBYaQnVt4pd75mj4Vi%2FjRyAXA%3D" alt="微信图片_2025-12-29_220005_848_副本.png" loading="lazy"/></p>
<p>FDW：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4918af3e786847b09f99cf12946a2e61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621783&amp;x-signature=LpglZnjMOgZSCf0OlIuF6RN0MYM%3D" alt="微信图片_2025-12-29_220201_695.png" loading="lazy"/></p>
<h3 data-id="heading-1">背景：微服务的数据隔离问题</h3>
<p>我们的系统是典型的微服务架构，三个服务各用各的数据库：</p>
<pre><code class="hljs">innies_biz_dev   → 业务数据（消息、评价、知识库）
innies_users_dev → 用户数据（用户名、邮箱、权限）
innies_loom_dev  → Agent 执行数据
</code></pre>
<p>平时服务间通信走 gRPC，数据隔离得挺好。但做运营看板的时候问题来了：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 需求：展示评价记录，带上用户名</span>
<span class="hljs-keyword">SELECT</span>
    r.rating_type,  <span class="hljs-comment">-- 评价类型（业务库）</span>
    u.username,     <span class="hljs-comment">-- 用户名（用户库）← 跨库了</span>
    m.content       <span class="hljs-comment">-- 消息内容（业务库）</span>
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">JOIN</span> users u <span class="hljs-keyword">ON</span> r.user_id <span class="hljs-operator">=</span> u.id
</code></pre>
<p>两个库里的表，没法直接 JOIN。</p>
<h3 data-id="heading-2">第一次尝试：Superset Meta Database</h3>
<p>Superset 有个实验性功能叫 Meta Database，号称可以跨库查询。配置挺简单：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># superset_config.py</span>
FEATURE_FLAGS = {
    <span class="hljs-string">"ENABLE_SUPERSET_META_DB"</span>: <span class="hljs-literal">True</span>,
}
</code></pre>
<p>添加三个数据库连接，再加一个 Meta Database（URI 是 <code>superset://</code>），就可以这样查了：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> "innies_biz_dev.public.message_ratings" r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> "innies_users_dev.public.users" u <span class="hljs-keyword">ON</span> r.user_id <span class="hljs-operator">=</span> u.id
</code></pre>
<p>语法有点怪，整个表路径要用双引号包起来。但能跑就行，对吧？</p>
<p>结果：<strong>24 秒</strong>。</p>
<p>查 13 条数据，等了 24 秒。复杂一点的查询直接超时。</p>
<h3 data-id="heading-3">问题在哪？</h3>
<p>用 EXPLAIN ANALYZE 看了一下数据库层的执行时间：<strong>12 毫秒</strong>。</p>
<p>数据库只花了 12ms，但整个查询要 24 秒。时间都花在哪了？</p>
<p>画个图就明白了：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant S as Superset
    participant B as 业务库
    participant U as 用户库

    S-&gt;&gt;B: SELECT * FROM message_ratings
    B--&gt;&gt;S: 返回全量数据
    S-&gt;&gt;B: SELECT * FROM task_messages
    B--&gt;&gt;S: 返回全量数据
    S-&gt;&gt;U: SELECT * FROM users
    U--&gt;&gt;S: 返回全量数据
    Note over S: Python 内存中做 JOIN
    S--&gt;&gt;S: 返回结果
</code></pre>
<p>问题就在这：它把所有表的数据都拉到应用层，再用 Python 做 JOIN。</p>
<ul>
<li>多次网络往返</li>
<li>全量数据传输（即使你只要 10 条结果）</li>
<li>Python 做 JOIN（效率远低于数据库引擎）</li>
</ul>
<h3 data-id="heading-4">换方案：PostgreSQL FDW</h3>
<p>FDW（Foreign Data Wrapper）是 PostgreSQL 的内置功能，可以把远程数据库的表映射到本地，像本地表一样查。</p>
<p>关键区别：<strong>JOIN 下沉到了数据库内核层</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant S as Superset
    participant P as 本地 PostgreSQL
    participant R as 远程用户库

    S-&gt;&gt;P: SELECT ... JOIN fdw_users.users
    Note over P: 查询优化器分析执行计划
    P-&gt;&gt;R: 拉取需要的行（WHERE 条件下推）
    R--&gt;&gt;P: 返回过滤后的数据
    Note over P: C 引擎内部完成 JOIN
    P--&gt;&gt;S: 返回结果
</code></pre>
<p>虽然在这种跨库场景下（本地表 JOIN 远程表），JOIN 动作依然发生在本地，但它比 Superset 快得多的原因是：</p>
<ol>
<li><strong>内核级效率</strong>：C 语言实现的数据库引擎做 JOIN，比 Python 在内存里处理 Pandas/List 快几个数量级。</li>
<li><strong>按需传输</strong>：PG 优化器很聪明，会把 WHERE 条件下推到远程库，只拉取需要的数据，而不是全量拉取。</li>
<li><strong>协议高效</strong>：数据库内部传输用的是二进制协议，比 HTTP/JSON 高效得多。</li>
</ol>
<h3 data-id="heading-5">配置过程</h3>
<p>FDW 配置需要数据库管理员权限，分这么几步：</p>
<h4 data-id="heading-6">1. 创建外部服务器</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 告诉 PostgreSQL 远程库在哪</span>
<span class="hljs-keyword">CREATE</span> SERVER users_server
<span class="hljs-keyword">FOREIGN</span> DATA WRAPPER postgres_fdw
OPTIONS (
    host <span class="hljs-string">'postgres-cluster.svc.cluster.local'</span>,
    dbname <span class="hljs-string">'innies_users_dev'</span>,
    port <span class="hljs-string">'5432'</span>
);
</code></pre>
<h4 data-id="heading-7">2. 创建用户映射</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 告诉 PostgreSQL 用什么凭证连远程库</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> innies_dev
SERVER users_server
OPTIONS (<span class="hljs-keyword">user</span> <span class="hljs-string">'innies_dev'</span>, password <span class="hljs-string">'xxx'</span>);
</code></pre>
<p>这步容易踩坑。如果报 <code>user mapping not found</code>，说明当前用户没有对应的映射。</p>
<h4 data-id="heading-8">3. 导入外部表</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 把远程的 users 表映射过来，放到 fdw_users schema</span>
<span class="hljs-keyword">CREATE</span> SCHEMA IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> fdw_users;

IMPORT <span class="hljs-keyword">FOREIGN</span> SCHEMA public
LIMIT <span class="hljs-keyword">TO</span> (users)
<span class="hljs-keyword">FROM</span> SERVER users_server
<span class="hljs-keyword">INTO</span> fdw_users;
</code></pre>
<h4 data-id="heading-9">4. 创建视图</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 封装 JOIN 逻辑，方便使用</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> v_ratings_with_username <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">SELECT</span>
    r.created_at <span class="hljs-keyword">AS</span> 评价时间,
    r.rating_type <span class="hljs-keyword">AS</span> 评价类型,
    u.username <span class="hljs-keyword">AS</span> 用户名,
    SUBSTR(m.content, <span class="hljs-number">1</span>, <span class="hljs-number">200</span>) <span class="hljs-keyword">AS</span> 消息内容,
    <span class="hljs-keyword">CASE</span>
        <span class="hljs-keyword">WHEN</span> m.references <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
         <span class="hljs-keyword">AND</span> m.references::text <span class="hljs-operator">!=</span> <span class="hljs-string">'[]'</span>
        <span class="hljs-keyword">THEN</span> <span class="hljs-string">'是'</span>
        <span class="hljs-keyword">ELSE</span> <span class="hljs-string">'否'</span>
    <span class="hljs-keyword">END</span> <span class="hljs-keyword">AS</span> 使用知识库
<span class="hljs-keyword">FROM</span> message_ratings r
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> task_messages m <span class="hljs-keyword">ON</span> r.message_id <span class="hljs-operator">=</span> m.id
<span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">JOIN</span> fdw_users.users u <span class="hljs-keyword">ON</span> r.user_id::uuid <span class="hljs-operator">=</span> u.id
<span class="hljs-keyword">WHERE</span> m.role <span class="hljs-operator">=</span> <span class="hljs-string">'assistant'</span>;
</code></pre>
<p>配置完成后，在 Superset 里直接查这个视图就行：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> v_ratings_with_username LIMIT <span class="hljs-number">100</span>;
</code></pre>
<h3 data-id="heading-10">结果对比</h3>




















<table><thead><tr><th>方案</th><th>查询耗时</th><th>数据库耗时</th></tr></thead><tbody><tr><td>Superset Meta DB</td><td>21-24s</td><td>12ms</td></tr><tr><td>PostgreSQL FDW</td><td>0.5-0.8s</td><td>0.5s</td></tr></tbody></table>
<p><strong>40 倍的性能提升。</strong></p>
<h3 data-id="heading-11">踩过的坑</h3>
<h4 data-id="heading-12">1. 权限不够</h4>
<pre><code class="hljs language-lua" lang="lua">permission denied to <span class="hljs-built_in">create</span> extension <span class="hljs-string">"postgres_fdw"</span>
</code></pre>
<p>创建 FDW 扩展需要超级用户权限，得让 DBA 帮忙。</p>
<h4 data-id="heading-13">2. 用户映射找不到</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">user</span> mapping <span class="hljs-keyword">not</span> found <span class="hljs-keyword">for</span> <span class="hljs-keyword">user</span> "innies_dev"
</code></pre>
<p>DBA 配好了 FDW，但只给 <code>postgres</code> 用户创建了映射，没给应用用户创建。补一个就好：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> MAPPING <span class="hljs-keyword">FOR</span> innies_dev
SERVER users_server
OPTIONS (<span class="hljs-keyword">user</span> <span class="hljs-string">'innies_dev'</span>, password <span class="hljs-string">'xxx'</span>);
</code></pre>
<h4 data-id="heading-14">3. 表找不到</h4>
<pre><code class="hljs language-arduino" lang="arduino">relation <span class="hljs-string">"users"</span> does <span class="hljs-keyword">not</span> exist
</code></pre>
<p>外部表被导入到了 <code>fdw_users</code> schema，不是 <code>public</code>。查的时候要用 <code>fdw_users.users</code>。</p>
<h3 data-id="heading-15">什么时候用哪个方案</h3>

























<table><thead><tr><th>场景</th><th>推荐方案</th></tr></thead><tbody><tr><td>数据量小、偶尔查一次</td><td>Superset Meta DB 够用</td></tr><tr><td>需要秒级响应</td><td>PostgreSQL FDW</td></tr><tr><td>可以接受数据延迟</td><td>定时同步到一个库</td></tr><tr><td>大规模数据分析</td><td>搞个数据仓库（成本高）</td></tr></tbody></table>
<h3 data-id="heading-16">总结</h3>
<p>同样的 JOIN，在应用层做和在数据库层做，性能差距可以到 40 倍。</p>
<p>微服务架构的数据隔离是好事，但做跨服务报表的时候确实麻烦。FDW 是个不错的解决方案：</p>
<ul>
<li>配置一次，长期使用</li>
<li>实时数据，无需同步</li>
<li>对线上库影响很小</li>
<li>PostgreSQL 内置功能，不用额外装东西</li>
</ul>
<p>代价是需要 DBA 权限来配置，但这个一次性成本是值得的。</p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：弹窗封装]]></title>    <link>https://juejin.cn/post/7589201772118081542</link>    <guid>https://juejin.cn/post/7589201772118081542</guid>    <pubDate>2025-12-29T14:05:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589201772118081542" data-draft-id="7589159665856151571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：弹窗封装"/> <meta itemprop="keywords" content="HarmonyOS,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:05:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：弹窗封装
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:05:51.000Z" title="Mon Dec 29 2025 14:05:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例介绍如何封装弹窗，以及如何使用这种封装后的弹窗</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/466dabaee01c49048c3baef9ed3a8893~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621950&amp;x-signature=bbc9l1ef9wj6ofCK21BRD6h5vvU%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>进入案例，点击右上角筛选按钮，顶部弹出筛选框，点击一种文件类型进行筛选</li>
<li>点击左上角添加按钮，中间弹出新增文件弹框，输入文件名以及选择文件类型，点击确定按钮添加完毕</li>
<li>长按列表项出现弹窗，点击删除按钮，中间弹出删除确认框，点击确认按钮删除完毕</li>
<li>长按列表项出现弹窗，底部弹出文件详情弹框</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ol>
<li>
<p>定义弹窗的父布局builder,支持自定义弹窗内容传入，设置弹窗蒙层。</p>
<p>@Builder
export function DialogBuilder(param: EncapsulateDialogBuilderParam) {
Stack({ alignContent: getAlignment(param.dialogType) }) {
Stack()
.width('100%')
.height('300%')
.backgroundColor(0x33000000)
.onClick(() =&gt; {
if (param.isModalClosedByOverlayClick) {
param.closeDialog!();
}
})
param.builder.builder({ onConfirm: param.onConfirm, closeDialog: param.closeDialog, data: param.data })</p>
<p>}.width('100%')
.height('100%')
}</p>
</li>
<li>
<p>使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-arkui-uicontext-V13%23opencustomdialog12" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-arkui-uicontext-V13#opencustomdialog12" ref="nofollow noopener noreferrer">openCustomDialog</a>接口，该接口可支持传入builder。</p>
<p>public static showCustomDialog(param: DialogParam): void {
if (!DialogUtil.uiContext) {
return;
}
let promptAction = DialogUtil.uiContext.getPromptAction();
let encapsulateParam: EncapsulateDialogBuilderParam = DialogUtil.transformDialogParamToEncapsulateDialogBuilderParam(param);
let compCont = new ComponentContent(DialogUtil.uiContext, wrapBuilder(DialogBuilder), encapsulateParam);
// 设置了弹窗id即可将其与弹窗关联起来，后续可凭据弹窗id关闭弹窗
if (param.dialogId) {
DialogUtil.compContMap.set(param.dialogId, compCont);
}
DialogUtil.fillCancelMethod(encapsulateParam, promptAction, compCont, param.dialogId);
DialogUtil.fillConfirmMethod(encapsulateParam, promptAction, compCont, param.dialogId);
compCont.update(encapsulateParam);
let options: promptAction.BaseDialogOptions = DialogUtil.dealSlideToClose(param);
promptAction.openCustomDialog(compCont, options);
}</p>
</li>
<li>
<p>自定义关闭弹窗回调。</p>
<p>private static fillCancelMethod(param: EncapsulateDialogBuilderParam, promptAction: PromptAction,
compCont: ComponentContent, dialogId: string | undefined) {
let customCancel = param.closeDialog;
let cancelDialog = () =&gt; {
if (customCancel) {
customCancel();
}
if (dialogId) {
DialogUtil.compContMap.delete(dialogId);
}
promptAction.closeCustomDialog(compCont);
// 关闭弹框之后释放对应的ComponentContent
compCont.dispose();
};
param.closeDialog = cancelDialog;
}</p>
</li>
<li>
<p>自定义弹窗确认回调。</p>
<p>private static fillConfirmMethod(param: EncapsulateDialogBuilderParam, promptAction: PromptAction,
compCont: ComponentContent, dialogId: string | undefined) {
let confirm = param.onConfirm;
let confirmDialog = (isCloseDialog?: boolean, data?: ESObject) =&gt; {
if (confirm) {
confirm(isCloseDialog, data);
}
if (isCloseDialog) {
if (dialogId) {
DialogUtil.compContMap.delete(dialogId);
}
promptAction.closeCustomDialog(compCont);
compCont.dispose();
}
};
param.onConfirm = confirmDialog;
}</p>
</li>
<li>
<p>自定义弹窗弹出动效。</p>
<p>/**</p>
<ul>
<li>顶部弹出动画</li>
<li>@param duration 动画时间</li>
<li>@returns
*/
static transitionFromUp(duration: number = 200): TransitionEffect {
return TransitionEffect.asymmetric(
TransitionEffect.OPACITY.animation({ duration: duration }).combine(
TransitionEffect.move(TransitionEdge.TOP).animation({ duration: duration })),
TransitionEffect.OPACITY.animation({ delay: duration, duration: duration }).combine(
TransitionEffect.move(TransitionEdge.TOP).animation({ duration: duration }))
)
}</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">使用步骤</h3>
<ol>
<li>
<p>初始化DialogUtil，需调用其init方法将UIContext传入。</p>
<p>aboutToAppear(): void {
DialogUtil.init(this.getUIContext());
...
}</p>
</li>
<li>
<p>定义弹窗builder，该builder必须有且只有DialogBuilderParam参数。</p>
<p>@Builder
export function addFileDialogBuilder(param: DialogBuilderParam) {
AddFileComponent({ param: param })
}</p>
</li>
<li>
<p>定义弹窗封装组件，该组件内部必须有DialogBuilderParam参数且使用@Prop注解。</p>
<p>@Component
export struct AddFileComponent {
@Prop param: DialogBuilderParam;
...
}</p>
</li>
<li>
<p>以上就封装好了自定义弹窗，接下来使用只需要调用一下showCustomDialog方法,将对应弹窗封装的builder传入。</p>
<p>showFileInfo(item: FileItem) {
// 打开筛选弹窗
DialogUtil.showCustomDialog({
builder: wrapBuilder(fileInfoDialogBuilder),
dialogType: DialogTypeEnum.BOTTOM,
dialogBuilderParam: {
data: item
}
})
}</p>
</li>
</ol>
<h4 data-id="heading-4">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-5">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b7e6a0503ed40b7909b9d58825b4ed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621950&amp;x-signature=wOj5kIfaCYYQjjlfmLGWq%2BtbrjM%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：相机预览花屏问题解决案例]]></title>    <link>https://juejin.cn/post/7589159665856167955</link>    <guid>https://juejin.cn/post/7589159665856167955</guid>    <pubDate>2025-12-29T14:09:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589159665856167955" data-draft-id="7589126217250816041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：相机预览花屏问题解决案例"/> <meta itemprop="keywords" content="前端,HarmonyOS,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:09:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：相机预览花屏问题解决案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:09:52.000Z" title="Mon Dec 29 2025 14:09:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">介绍</h3>
<p>本示例用于开发者在<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-guides-V5%2Fcamera-kit-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/camera-kit-V5" ref="nofollow noopener noreferrer">使用相机服务</a>时，如果仅用于预览流展示，通常使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fts-basic-components-xcomponent-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-basic-components-xcomponent-V5" ref="nofollow noopener noreferrer">XComponent</a>组件实现，如果需要获取每帧图像做二次处理（例如获取每帧图像完成二维码识别或人脸识别场景），可以通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fjs-apis-image-V5%23imagereceiver9" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-image-V5#imagereceiver9" ref="nofollow noopener noreferrer">ImageReceiver</a>中imageArrival事件监听预览流每帧数据，解析图像内容。在解析图像内容时，如果未考虑stride，直接通过使用width*height读取图像内容去解析图像，会导致相机预览异常，从而出现相机预览花屏的现象。当预览流图像stride与width不一致时，需要对stride进行无效像素的去除处理。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc827fc537ed4b59845fff6c5ccfa309~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622192&amp;x-signature=Fi3n%2BLGiXAl5m2%2BFyYmi%2F2guC7c%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>本案例仅支持真机验证，因在案例集合中导致权限弹窗reason只支持一种string。</li>
<li>点击进入案例，授权给相机。</li>
<li>三个方案滑动页面不会出现花屏。</li>
<li>点击相机右上角方案说明，可出现相关方案的具体描述。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<h4 data-id="heading-3">方案一</h4>
<ol>
<li>
<p>应用通过image.ImageReceiver注册imageArrival图像回调方法，获取每帧图像数据实例image.Image，应用通过定义一个width为1920*height为1080分辨率的预览流直接创建pixelMap，此时获取到的stride的值为1920。</p>
<p>onImageArrival(receiver: image.ImageReceiver): void {
receiver.on('imageArrival', () =&gt; {
receiver.readNextImage((err: BusinessError, nextImage: image.Image) =&gt; {
if (err || nextImage === undefined) {
logger.error(TAG, <code>requestPermissionsFromUser call Failed! error: ${err.code}</code>);
return;
}
if (nextImage) {
nextImage.getComponent(image.ComponentType.JPEG, async (_err, component: image.Component) =&gt; {
let width = 1920; // width为应用创建预览流分辨率对应的宽
let height = 1080; // height为应用创建预览流分辨率对应的高
let stride = component.rowStride; // 通过component.rowStride获取stride
logger.info(TAG, <code>receiver getComponent width:${width} height:${height} stride:${stride}</code>);
// stride和width相等，按宽读取buffer不影响结果
if (stride === width) {
let pixelMap = await image.createPixelMap(component.byteBuffer, {
size: { height: height, width: width },
srcPixelFormat: image.PixelMapFormat.NV21,
})
AppStorage.setOrCreate('stridePixel', pixelMap);
} else {
...
}
nextImage.release();
})
}
});
})
}</p>
</li>
<li>
<p>在初始相机模块时，调用onImageArrival()，将未处理的width和height作为size，创建PixelMap，通过在Image中传入被@StorageLink修饰的变量stridePixel进行数据刷新，图片送显。</p>
<p>Column() {
Stack() {
if (this.isShowStridePixel) {
Image(this.stridePixel)
.rotate({
z: 0.5,
angle: this.previewRotate
})
.zIndex(0)
}
}
.width(px2vp(this.imageWidth))
.height(px2vp(this.imageHeight))
}
.onVisibleAreaChange([0.0, 1.0], (isVisible: boolean, _currentRation: number) =&gt; {
// 切换组件时清除不可见的页面信息，重新进入组件时重新进入相机
if (isVisible) {
CameraServiceCrop.initCamera(this.cameraDeviceIndex);
} else {
CameraServiceCrop.releaseCamera();
}
})</p>
</li>
<li>
<p>当stride和width相等时，按宽读取buffer不影响结果。 当stride和width不等时，如果应用想使用byteBuffer预览流数据创建pixelMap直接显示，可以根据stride*height字节的大小先创建pixelMap，然后调用PixelMap的cropSync方法裁剪掉多余的像素，从而正确处理stride，解决预览流花屏问题。</p>
<p>onImageArrival(receiver: image.ImageReceiver): void {
receiver.on('imageArrival', () =&gt; {
receiver.readNextImage((err: BusinessError, nextImage: image.Image) =&gt; {
if (err || nextImage === undefined) {
logger.error(TAG, <code>requestPermissionsFromUser call Failed! error: ${err.code}</code>);
return;
}
if (nextImage) {
nextImage.getComponent(image.ComponentType.JPEG, async (_err, component: image.Component) =&gt; {
let width = 1920; // width为应用创建预览流分辨率对应的宽
let height = 1080; // height为应用创建预览流分辨率对应的高
let stride = component.rowStride; // 通过component.rowStride获取stride
logger.info(TAG, <code>receiver getComponent width:${width} height:${height} stride:${stride}</code>);
// stride和width相等，按宽读取buffer不影响结果
if (stride === width) {
...
} else {
let pixelMap = await image.createPixelMap(component.byteBuffer, {
// 1.创建PixelMap时width传stride。
size: { height: height, width: stride },
srcPixelFormat: 8,
})
// 2.然后调用PixelMap的cropSync方法裁剪掉多余的像素。
pixelMap.cropSync({
size: { width: width, height: height },
x: 0,
y: 0
}) // 根据输入的尺寸裁剪图片,从(0,0)开始，裁剪width*height字节的区域。
let pixelBefore: PixelMap | undefined = AppStorage.get('stridePixel');
await pixelBefore?.release();
AppStorage.setOrCreate('stridePixel', pixelMap);
}
nextImage.release();
})
}
});
})
}</p>
</li>
</ol>
<h4 data-id="heading-4">方案二</h4>
<ol>
<li>
<p>方案二的创建pixelMap、图片送显和方案一的1、2步骤一样，此处不再赘述。</p>
<p>当stride和width相等时，按宽读取buffer不影响结果。 当stride和width不等时，将相机返回的预览流数据即component.byteBuffer的数据去除stride，拷贝得到新的dstArr数据进行数据处理，将处理后的dstArr数组buffer，通过width和height直接创建pixelMap, 并存储到全局变量stridePixel中，传给Image送显，解决预览流花屏问题。</p>
<p>onImageArrival(receiver: image.ImageReceiver): void {
receiver.on('imageArrival', () =&gt; {
receiver.readNextImage((err: BusinessError, nextImage: image.Image) =&gt; {
if (err || nextImage === undefined) {
logger.error(TAG, <code>requestPermissionsFromUser call Failed! error: ${err.code}</code>);
return;
}
if (nextImage) {
nextImage.getComponent(image.ComponentType.JPEG,
async (err, component: image.Component) =&gt; {
let width = 1920; // width为应用创建预览流分辨率对应的宽
let height = 1080; // height为应用创建预览流分辨率对应的高
let stride = component.rowStride; // 通过component.rowStride获取stride
logger.info(TAG, <code>receiver getComponent width:${width} height:${height} stride:${stride}</code>);
// 当图片的width等于相机预览流返回的行跨距stride，此时无需处理stride，通过width和height直接创建pixelMap,并存储到全局变量stridePixel中，传给Image送显。
if (stride === width) {
...
} else {
// 当图片的width不等于相机预览流返回的行跨距stride，此时将相机返回的预览流数据component.byteBuffer去除掉stride，拷贝得到新的dstArr数据，数据处理后传给其他不支持stride的接口处理。
const dstBufferSize = width * height * 1.5; // 创建一个width * height * 1.5的dstBufferSize空间，此处为NV21数据格式。
const dstArr = new Uint8Array(dstBufferSize); // 存放去掉stride后的buffer。
// 读取每行数据，相机支持的profile宽高均为偶数，不涉及取整问题。
for (let j = 0; j &lt; height * 1.5; j++) { // 循环dstArr的每一行数据。
// 拷贝component.byteBuffer的每行数据前width个字节到dstArr中(去除无效像素，刚好每行得到一个width<em>height的八字节数组空间)。
const srcBuf = new Uint8Array(component.byteBuffer, j * stride,
width); // 将component.byteBuffer返回的buffer，每行遍历，从首位开始，每行截取出width字节。
dstArr.set(srcBuf, j * width); // 将width</em>height大小的数据存储到dstArr中。
}
let pixelMap = await image.createPixelMap(dstArr.buffer, {
// 将处理后的dstArr数组buffer，通过width和height直接创建pixelMap,并存储到全局变量stridePixel中，传给Image送显。
size: { height: height, width: width },
srcPixelFormat: image.PixelMapFormat.NV21,
})
AppStorage.setOrCreate('stridePixel', pixelMap);
}
nextImage.release();
})
}
});
})
}</p>
</li>
</ol>
<h4 data-id="heading-5">方案三</h4>
<ol>
<li>
<p>使用XComponent渲染预览对象输出的图像。</p>
<p>Stack() {
XComponent({
type: XComponentType.SURFACE,
controller: this.xComponentCtl
})
.onLoad(async () =&gt; {
logger.info('onLoad is called');
this.xComponentSurfaceId = this.xComponentCtl.getXComponentSurfaceId(); // 获取组件surfaceId
// 初始化相机，组件实时渲染每帧预览流数据
CameraService.initCamera(this.cameraDeviceIndex, this.xComponentSurfaceId);
})
.zIndex(0)</p>
<p>PublishView({ imageWidth: this.imageWidth, imageHeight: this.imageHeight })
.zIndex(1)</p>
<p>}
.onVisibleAreaChange([0.0, 1.0], (isVisible: boolean, _currentRation: number) =&gt; {
if (isVisible) {
CameraService.initCamera(this.cameraDeviceIndex, this.xComponentSurfaceId);
} else {
CameraService.releaseCamera();
}
})</p>
</li>
<li>
<p>在初始相机模块时，使用getXComponentSurfaceId获取XComponent对应Surface的ID，调用createPreviewOutput创建预览输出对象，图片送显。</p>
<p>async initCamera(cameraDeviceIndex: number, xComponentSurfaceId: string): Promise {
logger.debug(TAG, <code>initCamera cameraDeviceIndex: ${cameraDeviceIndex}</code>);
try {
await this.releaseCamera();
// 获取相机管理器实例
this.cameraManager = this.getCameraManagerFn();
if (this.cameraManager === undefined) {
logger.error(TAG, 'cameraManager is undefined');
return;
}
this.cameras = this.getSupportedCamerasFn(this.cameraManager);
this.curCameraDevice = this.cameras[cameraDeviceIndex];
if (this.curCameraDevice === undefined) {
logger.error(TAG, 'Failed to create the camera input.');
return;
}
// 创建cameraInput输出对象
this.cameraInput = this.createCameraInputFn(this.cameraManager, this.curCameraDevice);
if (this.cameraInput === undefined) {
logger.error(TAG, 'Failed to create the camera input.');
return;
}
// 打开相机
let isOpenSuccess = await this.cameraInputOpenFn(this.cameraInput);
if (!isOpenSuccess) {
logger.error(TAG, 'Failed to open the camera.');
return;
}</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 选择具有不同的stride和width</span>
let previewProfile: camera.Profile = {
  format: camera.CameraFormat.CAMERA_FORMAT_YUV_420_SP,
  size: {
    width: Constants.X_COMPONENT_SURFACE_WIDTH,
    height: Constants.X_COMPONENT_SURFACE_HEIGHT
  }
};
let size: image.Size = {
  width: Constants.X_COMPONENT_SURFACE_WIDTH,
  height: Constants.X_COMPONENT_SURFACE_HEIGHT
}
<span class="hljs-keyword">this</span>.receiver = image.createImageReceiver(size, image.ImageFormat.JPEG, <span class="hljs-number">8</span>);
<span class="hljs-keyword">this</span>.previewOutput = <span class="hljs-keyword">this</span>.createPreviewOutputFn(<span class="hljs-keyword">this</span>.cameraManager, previewProfile, xComponentSurfaceId);
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.previewOutput === undefined) {
  logger.error(TAG, <span class="hljs-string">'Failed to create the preview stream.'</span>);
  <span class="hljs-keyword">return</span>;
}
<span class="hljs-comment">// 会话流</span>
await <span class="hljs-keyword">this</span>.sessionFlowFn(<span class="hljs-keyword">this</span>.cameraManager, <span class="hljs-keyword">this</span>.cameraInput, <span class="hljs-keyword">this</span>.previewOutput);
</code></pre>
<p>} catch (error) {
logger.error(TAG, <code>initCamera fail: ${JSON.stringify(error)}</code>);
}
}</p>
</li>
</ol>
<h4 data-id="heading-6">注意</h4>
<p>本示例未设置成全屏状态，开发者可通过设置宽或高为100%，再根据当前设备的像素比设置aspectRatio(宽/高)，例如Mate60可设置为aspectRatio(9/16)。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Stack</span>() {
  if (this.isShowStridePixel) {
    <span class="hljs-built_in">Image</span>(this.stridePixel)
      <span class="hljs-selector-class">.rotate</span>({
        z: <span class="hljs-number">0.5</span>,
        angle: this.previewRotate
      })
      <span class="hljs-selector-class">.zIndex</span>(<span class="hljs-number">0</span>)
  }
}
<span class="hljs-selector-class">.width</span>('<span class="hljs-number">100%</span>')
<span class="hljs-selector-class">.aspectRatio</span>(<span class="hljs-number">9</span>/<span class="hljs-number">16</span>)
</code></pre>
<h4 data-id="heading-7">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-8">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d7334235632406a98b7fd0f5c633ef2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622192&amp;x-signature=WRHXBvwkT98VRCa1h2npt2nOac4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：多重筛选]]></title>    <link>https://juejin.cn/post/7589159665856200723</link>    <guid>https://juejin.cn/post/7589159665856200723</guid>    <pubDate>2025-12-29T14:13:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589159665856200723" data-draft-id="7589126217250832425" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：多重筛选"/> <meta itemprop="keywords" content="HarmonyOS,Android,程序员"/> <meta itemprop="datePublished" content="2025-12-29T14:13:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：多重筛选
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:13:51.000Z" title="Mon Dec 29 2025 14:13:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例主要介绍多重筛选场景，利用数组方法过滤满足条件的数据，利用LazyForEach实现列表信息的渲染以及刷新。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtybbs/753/188/655/0030086000753188655.20250208170657.45072066443077240724526669292193:50001231000000:2800:E671446133558720AB6FB68352808B527C99ACCA7BEC5851B8E80FE36378212B.gif" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>等待列表数据全部加载完成后，点击筛选类型，展开筛选数据。</li>
<li>选中想要筛选的数据，点击确认，列表刷新。</li>
<li>再次点开筛选类型，保留上次筛选的内容，点击重置筛选内容复原，列表数据恢复为未筛选前的数据。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<ol>
<li>
<p>使用Grid实现筛选条件布局。</p>
<p>Grid() {
ForEach(this.item.options, (options: string, idx: number) =&gt; {
GridItem() {
Text(options)
.textAlign(TextAlign.Center)
.fontSize(16)
.height(40)
.width('100%')
}
...
})
}
.columnsTemplate('1fr 1fr 1fr')
.rowsGap(16)
.columnsGap(16)
.margin({
left: 16,
right: 6,
top: 8,
bottom: 8
})
.layoutDirection(GridDirection.Row)
.constraintSize({
minHeight: '15%',
maxHeight: '15%'// grid会撑满maxHeight，先限定死高度
})</p>
</li>
<li>
<p>使用数组方法对筛选数据进行过滤，得到筛选数据。</p>
<p>GridItem() {
Text(options)
.textAlign(TextAlign.Center)
.fontSize(16)
.height(40)
.width('100%')
}
.onClick(() =&gt; {
if (this.item.selectItem.includes(idx)) {
let index = this.item.selectItem.indexOf(idx);
let listIdx = this.changData.indexOf(options);
// 删除已存在的筛选数据的index值
this.item.selectItem.splice(index, 1);
// 过滤出来没有重复数据的筛选值
this.changData = this.changData.filter(i =&gt; i !== options);
this.selectArr = this.item.selectItem;
// 删除已选择的数据的行数index数组
this.arrayListData.splice(listIdx, 1);
} else {
// 添加筛选数据的index值
this.item.selectItem.push(idx);
// 添加选中的数据
this.changData.push(options);
this.selectArr = this.item.selectItem;
// 添加选择的数据的行数index数组
this.arrayListData.push(this.listIndex);
}
})</p>
</li>
<li>
<p>得到筛选的数据后根据点击的筛选数据行数，使用has进行if判断看是否满足多重筛选的条件。</p>
<p>Button('确认')
.height(40)
.width(150)
.backgroundColor(Color.White)
.fontColor('#333')
.onClick(() =&gt; {
this.isShow = false;
let arrayListData = new Set(this.arrayListData)
if (arrayListData.has(0) &amp;&amp; !arrayListData.has(1)) {
// 仅选择停放时间
this.siteList.timeMultiFilter(this.changData);
} else if (!arrayListData.has(0) &amp;&amp; arrayListData.has(1)) {
// 仅选择套餐类型
this.siteList.typeMultiFilter(this.changData);
} else if (!arrayListData.has(0) &amp;&amp; !arrayListData.has(1) &amp;&amp; arrayListData.has(2)) {
// 仅选择充电
this.siteList.getInitalList();
} else if (this.changData.length === 0) {
// 未对数据进行选择
this.siteList.getInitalList();
} else {
// 多重筛选
this.siteList.multiFilter(this.changData);
}
if (this.siteList.totalCount() === 0) {
this.siteList.getInitalList();
promptAction.showToast({ message: "未找到相关数据" });
}
})</p>
</li>
<li>
<p>使用filter过滤出来符合条件的数据，筛选出来的数组构建一个新的Set，使用Set中的has判断列表中相关数据是否存在。</p>
<p>public multiFilter(changData: Array) {
let siteListString: string | undefined = AppStorage.get('siteList')
if (siteListString) {
let siteListObject: SiteListDataSource | undefined = JSON.parse(siteListString)
if (siteListObject === undefined) {
return
}
this.initialSiteList = siteListObject.dataList
this.dataList = []
this.dataList = this.initialSiteList
// 筛选数据
let changDataSet = new Set(changData)
let dataList: SiteItem[] = this.dataList.filter(item =&gt; {
item.siteBale = item.siteBale.filter(item =&gt; {
if ((item.time &amp;&amp; item.type) &amp;&amp; (changDataSet.has(item.time)) &amp;&amp; (changDataSet.has(item.type))) {
return item
}
return
})
return item.siteBale
})
dataList = dataList.filter(item =&gt; item.siteBale.length !== 0);
this.dataList = [];
this.dataList = dataList;
this.notifyDataReload();
}
}</p>
</li>
<li>
<p>使用深拷贝保留原数据。</p>
<p>/**</p>
<ul>
<li>返回原数组
*/
public getInitalList() {
let siteListString: string | undefined = AppStorage.get('siteList');
if (siteListString) {
let siteListObject: SiteListDataSource | undefined = JSON.parse(siteListString);
if (siteListObject === undefined) {
return;
}
this.initialSiteList = siteListObject.dataList;
this.dataList = [];
this.dataList = this.initialSiteList;
this.notifyDataReload();
}
}</li>
</ul>
</li>
</ol>
<h4 data-id="heading-3">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-4">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca96e9337cad4238838c1d0b17c43d3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622430&amp;x-signature=ZFj%2Fgf574NJle2PNbBNMEy%2FBffI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：网络状态监听]]></title>    <link>https://juejin.cn/post/7589201772118114310</link>    <guid>https://juejin.cn/post/7589201772118114310</guid>    <pubDate>2025-12-29T14:16:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589201772118114310" data-draft-id="7589126217250865193" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：网络状态监听"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:16:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：网络状态监听
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:16:51.000Z" title="Mon Dec 29 2025 14:16:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例介绍如何使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V13%2Fjs-apis-net-connection-V13%3FcatalogVersion%3DV13" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V13/js-apis-net-connection-V13?catalogVersion=V13" ref="nofollow noopener noreferrer">@kit.NetworkKit</a>接口监听手机网络状态，根据不同的网络状态对视频进行播放、暂停处理等操作。</p>
<h3 data-id="heading-1">效果预览图</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d4ed1a1faba4e1090963262cfa22bcc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622611&amp;x-signature=sNS9z4iq0Wj61mWq28UvHh2svt8%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>第一次打开应用进入案例页面，视频不播放。</li>
<li>点击自动播放设置按钮，进入设置页面，开启或者关闭3G/4G/5G自动播放、WI-FI自动播放。</li>
<li>开启或者关闭手机的蜂窝网络或者WI-FI开关，查看视频是否根据自动播放设置页面中的设置播放或者暂停。</li>
<li>返回首页瀑布流或者杀死应用重新进入案例，查看视频是否根据自动播放设置中的设置和手机网络状态播放或者暂停。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ol>
<li>
<p>页面实现</p>
<p>1.1 在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fharmonyos-cases%2Fcases%2Ftree%2Fmaster%2FCommonAppDevelopment%2Ffeature%2Fnetworkstatusobserver%2Fsrc%2Fmain%2Fets%2Fpages%2FVideoPage.ets" target="_blank" title="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/networkstatusobserver/src/main/ets/pages/VideoPage.ets" ref="nofollow noopener noreferrer">VideoPage</a>中添加Video组件，设置在线视频播放</p>
<pre><code class="hljs language-kotlin" lang="kotlin">```
Video({
  src: <span class="hljs-string">"https://v.oh4k.com/muhou/2022/07/20220704-RIUq3Z.mp4"</span>,
   controller: <span class="hljs-keyword">this</span>.controller
}).height(<span class="hljs-number">300</span>)
  .width(<span class="hljs-string">'100%'</span>)
  .autoPlay(<span class="hljs-keyword">this</span>.autoPlay())
```
</code></pre>
<p>1.2 在aboutToAppear方法中添加网络状态监听，并开始监听WI-FI和蜂窝数据的状态。</p>
<pre><code class="hljs language-scss" lang="scss">```
emitter<span class="hljs-selector-class">.on</span>(NetUtils.getInstance()<span class="hljs-selector-class">.getEmitterEvent</span>(), (data: emitter.EventData) =&gt; {
  if (data) {
    this<span class="hljs-selector-class">.netObserver</span>(data);
  } else {
    logger<span class="hljs-selector-class">.info</span>("aboutToAppear emitter on error, data is undefined.");
  }
});
NetUtils<span class="hljs-selector-class">.getInstance</span>()<span class="hljs-selector-class">.startNetObserve</span>(connection.NetBearType.BEARER_CELLULAR, connection.NetBearType.BEARER_WIFI);
```
</code></pre>
<p>1.3 在netObserver方法中，添加不同网络状态的处理。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">netObserver(<span class="hljs-keyword">data</span>: emitter.EventData) {
...
  let eventName: NetworkEventName = netEventData.eventName ?? -<span class="hljs-number">1</span>;
  switch (eventName) {
    case NetworkEventName.NetAvailable:
      <span class="hljs-keyword">if</span> (netEventData.netType === connection.NetBearType.BEARER_WIFI) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.wifiAutoPlay) {
          <span class="hljs-keyword">this</span>.startPlay();
        }
      }
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.NetBlock:
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.NetLost:
      <span class="hljs-keyword">if</span> (netEventData.netType === connection.NetBearType.BEARER_WIFI) {
        <span class="hljs-keyword">this</span>.wifiInterrupt();
      }
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.NetUnavailable:
      <span class="hljs-keyword">if</span> (netEventData.netType === connection.NetBearType.BEARER_WIFI) {
        <span class="hljs-keyword">this</span>.wifiInterrupt();
      }
      <span class="hljs-keyword">break</span>;
    case NetworkEventName.WeakNet:
      <span class="hljs-comment">// 如果是弱网环境</span>
      <span class="hljs-keyword">if</span> (netEventData.status) {
        Prompt.showToast({ message: <span class="hljs-string">"当前网络环境较差，视频播放可能出现卡顿"</span> });
      }
      <span class="hljs-keyword">break</span>;
    default:
      logger.debug(<span class="hljs-string">"当前网络状态："</span> + eventName);
      <span class="hljs-keyword">break</span>;
  }
}
</code></pre>
<p>1.4 在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fharmonyos-cases%2Fcases%2Ftree%2Fmaster%2FCommonAppDevelopment%2Ffeature%2Fnetworkstatusobserver%2Fsrc%2Fmain%2Fets%2Fpages%2FSettingPage.ets" target="_blank" title="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/networkstatusobserver/src/main/ets/pages/SettingPage.ets" ref="nofollow noopener noreferrer">SettingPage</a>中添加Toggle组件，管理自动播放设置。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-title function_ invoke__">Toggle</span>({ <span class="hljs-attr">type</span>: ToggleType.Switch, <span class="hljs-attr">isOn</span>: this.cellularAutoPlay })
  .<span class="hljs-title function_ invoke__">selectedColor</span>(<span class="hljs-string">'#007DFF'</span>)
  .<span class="hljs-title function_ invoke__">switchPointColor</span>(<span class="hljs-string">'#FFFFFF'</span>)
  .<span class="hljs-title function_ invoke__">onChange</span>((<span class="hljs-attr">isOn</span>: <span class="hljs-keyword">boolean</span>) =&gt; {
    logger.<span class="hljs-title function_ invoke__">info</span>(<span class="hljs-string">'Component status:'</span> + isOn);
    AppStorage.<span class="hljs-title function_ invoke__">setOrCreate</span>(<span class="hljs-string">'cellular_auto_play'</span>, isOn);
    PersistentStorage.<span class="hljs-title function_ invoke__">persistProp</span>(<span class="hljs-string">'cellular_auto_play'</span>, isOn);
  })
  .<span class="hljs-title function_ invoke__">width</span>(<span class="hljs-string">'10%'</span>)
</code></pre>
</li>
<li>
<p>网络状态监听工具类<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fharmonyos-cases%2Fcases%2Ftree%2Fmaster%2FCommonAppDevelopment%2Ffeature%2Fnetworkstatusobserver%2Fsrc%2Fmain%2Fets%2Futils%2FNetUtils.ets" target="_blank" title="https://gitee.com/harmonyos-cases/cases/tree/master/CommonAppDevelopment/feature/networkstatusobserver/src/main/ets/utils/NetUtils.ets" ref="nofollow noopener noreferrer">NetUtils</a>实现，通过<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fjs-apis-net-connection-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-net-connection-V5" ref="nofollow noopener noreferrer">@kit.NetworkKit</a>接口监听网络状态，然后通过emitter将监听结果传递给页面。</p>
<p>2.1 开启网络监听</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title function_">startNetObserve</span>(<span class="hljs-params">...netType: connection.NetBearType[]</span>) {
  netType.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>: connection.NetBearType</span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">networkObserve</span>(<span class="hljs-keyword">type</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === connection.<span class="hljs-property">NetBearType</span>.<span class="hljs-property">BEARER_WIFI</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">wifiStateObserve</span>();
    }
  })
}
</code></pre>
<p>2.2 关闭网络监听</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-title function_">stopNetObserve</span>(<span class="hljs-params">netType: connection.NetBearType</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">connectionMap</span>.<span class="hljs-title function_">get</span>(netType).<span class="hljs-title function_">unregister</span>(<span class="hljs-function">() =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Success unregister："</span> + netType.<span class="hljs-title function_">toString</span>());
  })
}
</code></pre>
<p>2.3 网络状态监听</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">networkObserve</span>(<span class="hljs-params">netType: connection.NetBearType</span>) {
  <span class="hljs-keyword">let</span> <span class="hljs-attr">netConnection</span>: connection.<span class="hljs-property">NetConnection</span> = connection.<span class="hljs-title function_">createNetConnection</span>({
    <span class="hljs-attr">netCapabilities</span>: {
      <span class="hljs-attr">bearerTypes</span>: [netType]
    }
  })
  netConnection.<span class="hljs-title function_">register</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {
    <span class="hljs-keyword">let</span> result = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (error) {
      logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network register failed: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));
      result = <span class="hljs-literal">false</span>;
    }
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network register succeed"</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetObserverRegister</span>, result, netType);
  });

  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netCapabilitiesChange'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetCapabilityInfo</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network netCapabilitiesChange: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetCapabilitiesChange</span>, data, netType);
  })

  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">"netAvailable"</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network succeeded to get netAvailable: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-comment">// 检查默认数据网络是否被激活，使用同步方式返回接口，如果被激活则返回true，否则返回false。</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetAvailable</span>, connection.<span class="hljs-title function_">hasDefaultNetSync</span>(), netType);
  });
 
  <span class="hljs-comment">// 订阅网络阻塞状态事件，当网络阻塞时，如网络性能下降、数据传输出现延迟等情况时，会触发该事件</span>
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netBlockStatusChange'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetBlockStatusInfo</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network netBlockStatusChange "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetBlock</span>, data, netType)
  });
 
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netConnectionPropertiesChange'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetConnectionPropertyInfo</span>) =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", network netConnectionPropertiesChange "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetConnectionPropertiesChange</span>, data, netType);
  });

  <span class="hljs-comment">// 订阅网络丢失事件，当网络严重中断或正常断开时触发该事件</span>
  <span class="hljs-comment">// 网络丢失是指网络严重中断或正常断开事件，当断开Wi-Fi时，是属于正常断开网络连接，会触发netLost事件</span>
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netLost'</span>, <span class="hljs-function">(<span class="hljs-params">data: connection.NetHandle</span>) =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetLost</span>, <span class="hljs-literal">true</span>, netType)
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", Succeeded to get netLost: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));
  });
 
  <span class="hljs-comment">// 订阅网络不可用事件，当网络不可用时触发该事件</span>
  <span class="hljs-comment">// 网络不可用是指网络不可用事件，当连接的网络不能使用时，会触发netUnavailable事件。</span>
  netConnection.<span class="hljs-title function_">on</span>(<span class="hljs-string">'netUnavailable'</span>, <span class="hljs-function">() =&gt;</span> {
    logger.<span class="hljs-title function_">info</span>(<span class="hljs-string">"NetUtils"</span>, <span class="hljs-string">"NetType :"</span> + netType + <span class="hljs-string">", Succeeded to get unavailable net event"</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postEvent</span>(<span class="hljs-title class_">NetworkEventName</span>.<span class="hljs-property">NetUnavailable</span>, <span class="hljs-literal">true</span>, netType);
  });
 
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">connectionMap</span>.<span class="hljs-title function_">set</span>(netType, netConnection);
}
</code></pre>
<p>2.4 通过emitter将网络监听状态传递给页面</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">private</span> postEvent(eventName: NetworkEventName, status: NetworkData, netType?: connection.NetBearType,
  priority?: emitter.EventPriority) {
  <span class="hljs-keyword">this</span>.emitterEvent.priority = priority;
  emitter.emit(<span class="hljs-keyword">this</span>.emitterEvent, {
    <span class="hljs-keyword">data</span>: new NetEventData(eventName, status, netType)
  })
}
</code></pre>
</li>
</ol>
<h4 data-id="heading-3">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-4">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d54702fb8d074dc2a2b06575780f37d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622611&amp;x-signature=lc7tYLQmSCqI1P8SHK3DES7nsmE%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：自定义地址选择组件]]></title>    <link>https://juejin.cn/post/7589082912588841003</link>    <guid>https://juejin.cn/post/7589082912588841003</guid>    <pubDate>2025-12-29T14:20:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589082912588841003" data-draft-id="7589099845186797604" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：自定义地址选择组件"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:20:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：自定义地址选择组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:20:05.000Z" title="Mon Dec 29 2025 14:20:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本示例介绍如何使用bindSheet，changeIndex，onAreaChange实现带切换动效的自定义地址选择组件。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25281b5679ca4dfb8b95975c42c6c242~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622805&amp;x-signature=XR327%2B7myHIYxuuYifGQ8IE8hJE%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>
<p>进入页面，点击场景一中“所在地区”一栏，可拉起省市区的地址选择弹窗。选择完区后，弹窗自动关闭，“所在地区”一栏显示当前选择的省市区名。</p>
</li>
<li>
<p>进入页面，点击场景二中的'获取地址信息'按钮，可以查看省市区名和相应的id。点击“所在地区”一栏，在拉起的地址选择弹窗里选择另一个省市区后，再次点击'获取地址信息'按钮，会显示最新选择的省市区的信息。</p>
</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ol>
<li>
<p>使用getRawFileContentSync从rawfile目录下读取省市区json文件数据，使用util.TextDecoder进行解码。</p>
<p>getAddressData(): Array {
// 从rawfile本地json文件中获取数据
const value = getContext().resourceManager.getRawFileContentSync(this.jsonFileDir);
// 解码为utf-8格式
const textDecoder = util.TextDecoder.create('utf-8', { ignoreBOM: true });
const textDecoderResult = textDecoder.decodeToString(new Uint8Array(value.buffer));
const jsonObj: JsonObjType = JSON.parse(textDecoderResult) as JsonObjType;
const modelBuckets: Array = [];
// 映射json数据为model对象
const modelObj = jsonObj.addressList;
for (let i = 0; i &lt; modelObj.length; i++) {
const contactTemp = new Province(modelObj[i].code, modelObj[i].name, modelObj[i].children);
// 从json中读取每个省数据写入modelBuckets
modelBuckets.push(contactTemp);
}
return modelBuckets;
}</p>
</li>
<li>
<p>使用bindSheet绑定地址选择半模态弹窗页面。</p>
<p>Row() {
// ...
}
.width(<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>a</mi><mi>p</mi><mi>p</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><msub><mi>m</mi><mi>a</mi></msub><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><msub><mi>s</mi><mi>p</mi></msub><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>r</mi><mi>f</mi></msub><mi>u</mi><mi>l</mi><msub><mi>l</mi><mi>s</mi></msub><mi>i</mi><mi>z</mi><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>h</mi><mi>e</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">r('app.string.custom_address_picker_full_size'))
.height(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">.</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">dd</span><span class="mord mathnormal">res</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">))</span><span class="mord">.</span><span class="mord mathnormal">h</span><span class="mord mathnormal">e</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">h</span><span class="mord mathnormal">t</span><span class="mopen">(</span></span></span></span></span>r('app.float.custom_address_picker_size_forty_eight'))
.onClick(() =&gt; {
// 显示地址选择半模态弹窗页面
this.isShow = true;
this.currentIndex = AddressType.Province;
})
.bindSheet($$this.isShow, this.addressSelectPage(), {
height: $r('app.string.custom_address_picker_percent_seventy'), // 半模态弹窗高度
showClose: false, // 设置不显示自带的关闭图标
dragBar: false,
onDisappear: () =&gt; {
// 退出地址选择半模态弹窗页面时，重置相关参数
this.animationDuration = 0;
// 如果当前省市区没选全，则清空当前选择的地址信息
if (this.currentSelectInfo.region === '') {
this.currentSelectInfo.provinceId = '';
this.currentSelectInfo.cityId = '';
this.currentSelectInfo.regionId = '';
this.currentSelectInfo.province = '';
this.currentSelectInfo.city = '';
this.currentSelectInfo.region = '';
this.cityList = [];
this.regionList = [];
}
}
})</p>
</li>
<li>
<p>使用changeIndex控制省市区列表TabContent切换。使用组件区域变化回调onAreaChange获取选择的省市区Text组件宽度，存入textInfos数组，用于后续计算选择省市区名后下方下滑线动画水平偏移量leftMargin。</p>
<p>Text(<code>${params.name === '' ? '请选择' : params.name} </code>)
.height(<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>a</mi><mi>p</mi><mi>p</mi><mi mathvariant="normal">.</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><msub><mi>m</mi><mi>a</mi></msub><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><msub><mi>s</mi><mi>p</mi></msub><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>r</mi><mi>f</mi></msub><mi>u</mi><mi>l</mi><msub><mi>l</mi><mi>s</mi></msub><mi>i</mi><mi>z</mi><msup><mi>e</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi mathvariant="normal">.</mi><mi>f</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>S</mi><mi>i</mi><mi>z</mi><mi>e</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">r('app.string.custom_address_picker_full_size'))
  .fontSize(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord">.</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord">.</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">dd</span><span class="mord mathnormal">res</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0197em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">))</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.05764em;">tS</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ze</span><span class="mopen">(</span></span></span></span></span>r('app.float.custom_address_picker_size_sixteen'))
.fontWeight(this.currentIndex === params.index ? Constants.FONT_WEIGHT_FIVE_HUNDRED :
Constants.FONT_WEIGHT_FOUR_HUNDRED)
.fontColor(this.currentIndex === params.index ? <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><msup><mo stretchy="false">(</mo><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mi>a</mi><mi>p</mi><mi>p</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>o</mi><mi>l</mi><mi>o</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>c</mi><mi>u</mi><mi>s</mi><mi>t</mi><mi>o</mi><msub><mi>m</mi><mi>a</mi></msub><mi>d</mi><mi>d</mi><mi>r</mi><mi>e</mi><mi>s</mi><msub><mi>s</mi><mi>p</mi></msub><mi>i</mi><mi>c</mi><mi>k</mi><mi>e</mi><msub><mi>r</mi><mi>f</mi></msub><mi>o</mi><mi>n</mi><msub><mi>t</mi><mi>c</mi></msub><mi>o</mi><mi>l</mi><mi>o</mi><msub><mi>r</mi><mi>b</mi></msub><mi>l</mi><mi>a</mi><mi>c</mi><msup><mi>k</mi><mo mathvariant="normal" lspace="0em" rspace="0em">′</mo></msup><mo stretchy="false">)</mo><mo>:</mo></mrow><annotation encoding="application/x-tex">r('app.color.custom_address_picker_font_color_black') :
  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.038em;vertical-align:-0.2861em;"/><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mopen"><span class="mopen">(</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">a</span><span class="mord mathnormal">pp</span><span class="mord">.</span><span class="mord mathnormal">co</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal" style="margin-right:0.02778em;">or</span><span class="mord">.</span><span class="mord mathnormal">c</span><span class="mord mathnormal">u</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">a</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">dd</span><span class="mord mathnormal">res</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.10764em;">f</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span/></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">b</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7519em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span></span></span></span></span>r('app.color.custom_address_picker_font_color_gray'))
.constraintSize({ maxWidth: 'calc(33%)' })
.textOverflow({ overflow: TextOverflow.Ellipsis })
.maxLines(Constants.SIZE_ONE)
.onClick(() =&gt; {
// 使用changeIndex控制省市区列表TabContent切换
this.controller.changeIndex(params.index);
})
.id(params.index.toString())
.onAreaChange((oldValue: Area, newValue: Area) =&gt; {
// 使用组件区域变化回调onAreaChange获取选择的省市区Text组件宽度，存入textInfos数组，用于后续计算选择省市区名后下方下滑线动画水平偏移量leftMargin
// 组件区域变化时获取当前Text的宽度newValue.width和x轴相对位置newValue.position.x
this.textInfos[params.index] = [newValue.position.x as number, newValue.width as number];
if (this.currentIndex === params.index &amp;&amp; params.index === AddressType.Province) {
// 计算选择的省市区名下方的下滑线偏移量
this.leftMargin = (this.textInfos[this.currentIndex][1] - Constants.DIVIDER_WIDTH) / 2;
}
})</p>
</li>
<li>
<p>在选择完区名后，使用JSON.parse(JSON.stringify(xxx))深拷贝选择的省市区数据，用于后续操作中需要加载上一次选择的完整省市区数据。</p>
<p>List() {
ForEach(this.regionList, (item: CommonAddressList) =&gt; {
ListItem() {
this.areaNameItem(AddressType.Region, item)
}.onClick(() =&gt; {
// 记录选择的区信息
this.currentSelectInfo.regionId = item.code;
this.currentSelectInfo.region = item.name;
this.provinceCityRegion =
this.currentSelectInfo.province + this.currentSelectInfo.city + this.currentSelectInfo.region;
// 选择区后，退出地址选择半模态弹窗页面
this.isShow = false;
// 将当前选中省市区信息保存到lastSelectInfo
this.lastSelectInfo.provinceId = this.currentSelectInfo.provinceId;
this.lastSelectInfo.province = this.currentSelectInfo.province;
this.lastSelectInfo.cityId = this.currentSelectInfo.cityId;
this.lastSelectInfo.city = this.currentSelectInfo.city;
this.lastSelectInfo.regionId = this.currentSelectInfo.regionId;
this.lastSelectInfo.region = this.currentSelectInfo.region;
// TODO 知识点：在选择完区名后，使用JSON.parse(JSON.stringify(xxx))深拷贝选择的省市区数据，用于后续操作中需要加载上一次选择的完整省市区数据
// 深拷贝保存到相应的变量中
this.lastCityList = JSON.parse(JSON.stringify(this.cityList));
this.lastRegionList = JSON.parse(JSON.stringify(this.regionList));
this.address = JSON.parse(JSON.stringify(this.lastSelectInfo));
})
}, (item: CommonAddressList) =&gt; JSON.stringify(item))
}</p>
</li>
</ol>
<h2 data-id="heading-3">总结</h2>
<p>本示例中如果当前点击选择的省或者市与之前选择一样，则跳过省、市数据获取，直接调用changeIndex(AddressType.City)切换到下一级地区列表，减少冗余查询以提升性能。</p>
<h4 data-id="heading-4">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-5">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f6aab8df1eb046b69f3ba6cb0cd870f1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767622805&amp;x-signature=X57sWKkODkQ8AEru5hu5Jpclmqs%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：Webview拉起自定义键盘]]></title>    <link>https://juejin.cn/post/7589126217250914345</link>    <guid>https://juejin.cn/post/7589126217250914345</guid>    <pubDate>2025-12-29T14:26:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126217250914345" data-draft-id="7589126217250897961" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：Webview拉起自定义键盘"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:26:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：Webview拉起自定义键盘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:26:57.000Z" title="Mon Dec 29 2025 14:26:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">场景描述</h3>
<p>在特殊的H5场景下需要应用拉起自定义键盘进行输入。</p>
<p>场景一：使用jsBridge拉起自定义弹窗写自定义键盘，再通过jsBridge传参实现输入。</p>
<p>场景二：使用web的同层渲染将原生textInput组件渲染到页面上。</p>
<h3 data-id="heading-1">方案描述</h3>
<p>通过注册一个js代理对象被web的registerJavaScriptProxy方法调用拉起CustomDialog，在CustomDialog上放置一个customkeyboard </p>
<p>场景一：通过jsBridge拉起自定义弹窗，在自定义弹窗上放置自定义键盘，例如需要输入密码时的安全键盘。 </p>
<h4 data-id="heading-2">效果图</h4>
<p><img alt="" src="" loading="lazy"/></p>
<h3 data-id="heading-3">方案 </h3>
<p>通过注册一个js代理对象被web的registJavaScriptProxy方法调用拉起CustomDialog，在CustomDialog上放置一个自定义键盘组件，通过在H5上input标签的readonly属性和注册的js方法changeNumbers实现在原生端输入数字传到H5上，他们之间通过@Link装饰器绑定的变量进行传值，所以点击删除输入的内容也是可以在H5上实现的。 </p>
<h4 data-id="heading-4">核心代码</h4>
<p>通过javaScriptProxy方法拉起自定义弹窗，在H5上的input标签绑定一个onclick事件，当点击输入框后会调用从原生注册过来的js代理方法openWindow。</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"number_info"</span> <span class="hljs-keyword">readonly</span> onclick=<span class="hljs-string">"openWindow()"</span> value=<span class="hljs-string">""</span> style=<span class="hljs-string">"width: 500px;height: 100px;font-size:50px;border:1px solid # f00;"</span>&gt;
 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
 
<span class="hljs-keyword">function</span> <span class="hljs-title function_">openWindow</span>(<span class="hljs-params"/>) {
 
<span class="hljs-keyword">let</span> value = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">"number_info"</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span>;
 
<span class="hljs-variable language_">window</span>.<span class="hljs-property">myJsb</span>.<span class="hljs-title function_">openDialog</span>(value)
 
}
 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>当H5上openWindow方法被调用后会通过jsBridge调用以下两个js代理方法打开自定义弹窗。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">jsbObject: JsbObject = {
 
openDialog: (value: string) =&gt; {
 
<span class="hljs-keyword">this</span>.showDialog(<span class="hljs-keyword">this</span>, value);
 
}
 
}
 
showDialog(context: <span class="hljs-keyword">object</span>, value: string) {
 
<span class="hljs-comment">// 把自定义弹窗调出来</span>
 
<span class="hljs-keyword">this</span>.currentData = value;
 
<span class="hljs-keyword">this</span>.dialogController.<span class="hljs-keyword">open</span>()
 
}
 
 
 
Web({ src: <span class="hljs-string">"resource://rawfile/web_test.html"</span>, controller: <span class="hljs-keyword">this</span>.webviewController })
 
.javaScriptAccess(<span class="hljs-literal">true</span>)
 
.javaScriptProxy({
 
name: <span class="hljs-string">"myJsb"</span>,
 
<span class="hljs-keyword">object</span>: <span class="hljs-keyword">this</span>.jsbObject,
 
methodList: [<span class="hljs-string">"openDialog"</span>],
 
controller: <span class="hljs-keyword">this</span>.webviewController
 
}
</code></pre>
<p>将自定义键盘放置在自定义弹窗上。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@CustomDialog</span>
 
struct CustomDialogExample {
 
<span class="hljs-keyword">@Link</span> <span class="hljs-attribute">currentData</span>: string
 
<span class="hljs-attribute">dialogControllerTwo</span>: CustomDialogController | null = new CustomDialogController({
 
builder: <span class="hljs-built_in">CustomDialogExample</span>({ currentData: <span class="hljs-variable">$currentData</span> }),
 
alignment: DialogAlignment.Bottom,
 
offset: { dx: <span class="hljs-number">0</span>, dy: -<span class="hljs-number">25</span> }
 
})
 
controller?: CustomDialogController
 
 
 
<span class="hljs-built_in">build</span>() {
 
<span class="hljs-built_in">Column</span>() {
 
<span class="hljs-selector-tag">Button</span>('x')<span class="hljs-selector-class">.onClick</span>(() =&gt; {
 
<span class="hljs-comment">// 关闭自定义键盘</span>
 
if (this.controller != undefined) {
 
this<span class="hljs-selector-class">.controller</span><span class="hljs-selector-class">.close</span>()
 
}
 
})
 
<span class="hljs-attribute">Grid</span>() {
 
<span class="hljs-built_in">ForEach</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, '*', <span class="hljs-number">0</span>, '删除'], (item: number | string) =&gt; {
 
<span class="hljs-built_in">GridItem</span>() {
 
<span class="hljs-selector-tag">Button</span>(item + "")
 
<span class="hljs-selector-class">.width</span>(<span class="hljs-number">110</span>)<span class="hljs-selector-class">.onClick</span>(() =&gt; {
 
if (item == '删除') {
 
if (this.currentData.length &gt; <span class="hljs-number">0</span>) {
 
this<span class="hljs-selector-class">.currentData</span> = this<span class="hljs-selector-class">.currentData</span><span class="hljs-selector-class">.substring</span>(<span class="hljs-number">0</span>, this.currentData.length - <span class="hljs-number">1</span>);
 
}
 
} else {
 
this<span class="hljs-selector-class">.currentData</span> += item
 
}
 
})
 
}
 
})
 
}<span class="hljs-selector-class">.maxCount</span>(<span class="hljs-number">3</span>)<span class="hljs-selector-class">.columnsGap</span>(<span class="hljs-number">10</span>)<span class="hljs-selector-class">.rowsGap</span>(<span class="hljs-number">10</span>)<span class="hljs-selector-class">.padding</span>(<span class="hljs-number">5</span>)
 
}<span class="hljs-selector-class">.backgroundColor</span>(Color.Gray)
 
}
 
}
</code></pre>
<p>在自定义键盘上输入内容的时候会调用onChangeInputValue方法，通过里面的runJavaScript调用H5上的js方法changeNumber传值到H5的输入框中。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">onChangeInputValue</span>(<span class="hljs-params">stateName: <span class="hljs-built_in">string</span></span>){
 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'this.currentData:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentData</span>)
 
<span class="hljs-variable language_">this</span>.<span class="hljs-property">webviewController</span>.<span class="hljs-title function_">runJavaScript</span>(<span class="hljs-string">'changeNumber("'</span>+ <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentData</span> +<span class="hljs-string">'")'</span>)
 
.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
 
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'result: '</span> + result);
 
})
 
}
 
 
&lt;&lt;input <span class="hljs-keyword">type</span>=<span class="hljs-string">"text"</span> name=<span class="hljs-string">"number_info"</span> <span class="hljs-keyword">readonly</span> onclick=<span class="hljs-string">"openWindow()"</span> value=<span class="hljs-string">""</span> style=<span class="hljs-string">"width: 500px;height: 100px;font-size:50px;border:1px solid # f00;"</span> /&gt;
 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
 
<span class="hljs-keyword">function</span> <span class="hljs-title function_">changeNumber</span>(<span class="hljs-params">value</span>){
 
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByName</span>(<span class="hljs-string">"number_info"</span>)[<span class="hljs-number">0</span>].<span class="hljs-property">value</span> = value;
 
}
 
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>**场景二：**<strong>通过同层渲染渲染一个原生的自定义键盘</strong></p>
<p><strong>效果图</strong></p>
<p><img alt="" src="" loading="lazy"/></p>
<h3 data-id="heading-5">方案</h3>
<p>整体实现效果为：通过web的同层渲染功能实现将原生TextInput组件渲染到H5需要使用自定义键盘的页面中，这样就可以实现在H5拉起自定义键盘，并且使用它的全部功能。</p>
<h4 data-id="heading-6">核心代码</h4>
<ol>
<li>
<p>创建一个自定义键盘并绑定到原生textInput组件上。</p>
<p>@Component</p>
<p>struct ButtonComponent {</p>
<p>controller1: TextInputController = new TextInputController()</p>
<p>@State inputValue: string = ""</p>
<p>// 自定义键盘组件</p>
<p>@Builder</p>
<p>CustomKeyboardBuilder() {</p>
<p>Column() {</p>
<p>Button('x').onClick(() =&gt; {</p>
<p>// 关闭自定义键盘</p>
<p>this.controller1.stopEditing()</p>
<p>})</p>
<p>Grid() {</p>
<p>ForEach([1, 2, 3, 4, 5, 6, 7, 8, 9, '*', 0, '# '], (item: number | string) =&gt; {</p>
<p>GridItem() {</p>
<p>Button(item + "")</p>
<p>.width(110).onClick(() =&gt; {</p>
<p>this.inputValue += item</p>
<p>})</p>
<p>}</p>
<p>})</p>
<p>}.maxCount(3).columnsGap(10).rowsGap(10).padding(5)</p>
<p>}.backgroundColor(Color.Pink)</p>
<p>}</p>
<p>@ObjectLink params: Params</p>
<p>@State bkColor: Color = Color.Red</p>
<p>@State outSetValueTwo: number = 40</p>
<p>@State outSetValueOne: number = 40</p>
<p>@State tipsValue: number = 40</p>
<p>controller: web_webview.WebviewController = new web_webview.WebviewController();</p>
<p>build() {</p>
<p>Column() {</p>
<p>TextInput({ controller: this.controller1, text: this.inputValue })// 绑定自定义键盘</p>
<p>.customKeyboard(this.CustomKeyboardBuilder()).margin(10).border({ width: 1 })</p>
<p>}</p>
<p>.width(this.params.width)</p>
<p>.height(this.params.height)</p>
<p>}</p>
<p>}</p>
</li>
</ol>
<p>将原生textInput组件通过web同层渲染功能渲染到H5上的embed标签上。</p>
<h4 data-id="heading-7">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-8">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3e2762caa324b73be4a3ed3d9c74740~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623216&amp;x-signature=CxNXEKzzJBXBLoyncdzcJCVwFgI%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：桌面卡片实现]]></title>    <link>https://juejin.cn/post/7589126217250930729</link>    <guid>https://juejin.cn/post/7589126217250930729</guid>    <pubDate>2025-12-29T14:29:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126217250930729" data-draft-id="7589082912588873771" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：桌面卡片实现"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:29:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：桌面卡片实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:29:36.000Z" title="Mon Dec 29 2025 14:29:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>桌面卡片是比较常见的功能，本案例详细列举了卡片开发的大部分功能，如使用postCardAction接口快速拉起卡片提供方应用的指定UIAbility，通过message事件刷新卡片内容等，为开发者提供了卡片功能的展示。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3197ee4a1e484043be642cf73fc7ff83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623376&amp;x-signature=T%2F1OT3voKJCBzIlE22EsE23iED4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">使用说明</h3>
<ol>
<li>长按应用，添加卡片到桌面。</li>
<li>卡片内可滑动选择案例，点击可进入案例详情。</li>
<li>部分案例无详情页时，点击跳转到首页瀑布流。</li>
</ol>
<h3 data-id="heading-3">实现思路</h3>
<ol>
<li>新建卡片</li>
<li>配置formconfig</li>
<li>编写卡片UI代码</li>
<li>触发刷新事件</li>
<li>触发点击事件</li>
</ol>
<h3 data-id="heading-4">实现步骤</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<ol>
<li>
<p>新建卡片。右键点击entry目录，选择新建-&gt;Service Widget-&gt;Dynamic Widget，其中Dynamic Widget为动态卡片，Static Widget为静态卡片。此时会生成几个文件：配置文件<code>form_config.json</code>；卡片Ability<code>EntryFormAbility.ets</code>；卡片组件<code>WidgetCard.ets</code>。</p>
</li>
<li>
<p>新建卡片后，根据需要（如卡片大小，刷新时间，动态静态卡片设置）配置<code>form_config.json</code>。</p>
<p>{
"forms": [
{
"name": "widget", // 卡片的名称。
"displayName": "<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>:</mo><mi>w</mi><mi>i</mi><mi>d</mi><mi>g</mi><mi>e</mi><msub><mi>t</mi><mi>d</mi></msub><mi>i</mi><mi>s</mi><mi>p</mi><mi>l</mi><mi>a</mi><msub><mi>y</mi><mi>n</mi></msub><mi>a</mi><mi>m</mi><mi>e</mi><mi mathvariant="normal">"</mi><mo separator="true">,</mo><mi mathvariant="normal">/</mi><mi mathvariant="normal">/</mi><mtext>卡片的显示名称。</mtext><mi mathvariant="normal">"</mi><mi>d</mi><mi>e</mi><mi>s</mi><mi>c</mi><mi>r</mi><mi>i</mi><mi>p</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi mathvariant="normal">"</mi><mo>:</mo><mi mathvariant="normal">"</mi></mrow><annotation encoding="application/x-tex">string:widget_display_name", // 卡片的显示名称。
      "description": "</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.854em;vertical-align:-0.1944em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">i</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">d</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">a</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.1514em;"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"/><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span/></span></span></span></span></span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span><span class="mord">"</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord">//</span><span class="mord cjk_fallback">卡片的显示名称。</span><span class="mord">"</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.02778em;">escr</span><span class="mord mathnormal">i</span><span class="mord mathnormal">pt</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord">"</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">:</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6944em;"/><span class="mord">"</span></span></span></span></span>string:widget_desc", // 卡片的描述。
"src": "./ets/widget/pages/WidgetCard.ets", // 卡片对应的UI代码的完整路径。
"uiSyntax": "arkts", // 卡片的类型
"window": { // 用于定义与显示窗口相关的配置。
"designWidth": 720,
"autoDesignWidth": true
},
"colorMode": "auto", // 卡片的主题样式。
"isDynamic": true, // 卡片是否为动态卡片。
"isDefault": true, // 卡片是否为默认卡片。
"updateEnabled": true, // 卡片是否支持周期性刷新。
"scheduledUpdateTime": "10:30", // 卡片的定点刷新的时刻。
"updateDuration": 1, // 卡片定时刷新的更新周期，单位为30分钟，取值为自然数。
"defaultDimension": "6<em>4", // 卡片的默认外观规格。
"supportDimensions": [ // 卡片支持的外观规格，取值范围。
"6</em>4"
]
}
]
}</p>
</li>
<li>
<p>编写卡片UI代码。在主文件<code>WidgetCard.ets</code>中添加UI组件，需要注意的是：ArkTS卡片存在较多约束（如不支持导入共享包），较多逻辑不可在卡片中使用，在使用时需要根据文档进行操作。</p>
</li>
<li>
<p>编写跳转事件：当应用未被拉起时，点击某个卡片时跳转到具体的案例页面。在<code>EntryAbility.ets</code>中补充逻辑：onCreate生命周期内获取want.parameters.params判断卡片内容的跳转。</p>
<p>// EntryAbility.ets
export default class EntryAbility extends UIAbility {
onCreate(want: Want, launchParam: AbilityConstant.LaunchParam): void {
// ...
// 桌面卡片判断跳转内容
if (want?.parameters?.params) {
// want.parameters.params 对应 postCardAction() 中 params 内容
let params: Record&lt;string, Object&gt; = JSON.parse(want.parameters.params as string);
this.selectPage = params.targetPage as string;
}
// ...
}
}</p>
</li>
<li>
<p>编写跳转事件：当应用在后台时，点击某个卡片时跳转到具体的案例页面。可从onNewWant生命周期获取want.parameters.params判断卡片内容的跳转。</p>
<p>// EntryAbility.ets
export default class EntryAbility extends UIAbility {
// 如果UIAbility已在后台运行，在收到Router事件后会触发onNewWant生命周期回调
onNewWant(want: Want, launchParam: AbilityConstant.LaunchParam): void {
if (want?.parameters?.params) {
// want.parameters.params 对应 postCardAction() 中 params 内容
let params: Record&lt;string, Object&gt; = JSON.parse(want.parameters.params as string);
this.selectPage = params.targetPage as string;
}
if (this.currentWindowStage !== null) {
//  存在窗口时点击卡片后进行页面跳转
this.onWindowStageCreate(this.currentWindowStage);
}
}
}</p>
</li>
<li>
<p>具体跳转逻辑编写。在onWindowStageCreate生命周期内进行具体的跳转逻辑。</p>
<p>// EntryAbility.ets
export default class EntryAbility extends UIAbility {
onWindowStageCreate(windowStage: window.WindowStage): void {
// 判断是否存在窗口可进行页面跳转
if (this.currentWindowStage === null) {
this.currentWindowStage = windowStage;
}
//  点击卡片后进行页面跳转
if (this.selectPage) {
this.storage.setOrCreate('formNavigationRouter', this.selectPage);
windowStage.loadContent('pages/EntryView', this.storage, (err, data) =&gt; {
if (err.code) {
logger.error(DOMAIN_NUMBER.toString(), TAG, 'Failed to load the content. Cause: %{public}s', JSON.stringify(err) ?? '');
return;
}
logger.info(DOMAIN_NUMBER.toString(), TAG, 'Succeeded in loading the content. Data: %{public}s', JSON.stringify(data) ?? '');
});
}
// ...
}
}</p>
</li>
<li>
<p>编写跳转事件：在<code>EntryAbility.ets</code>编写事件后，同时在接收案例参数的<code>EntryView.ets</code>内处理页面跳转逻辑。通过和DynamicsRouter内的数据对比，判断通过storage传入的页面是哪一个，然后执行pushUri跳转。</p>
<p>@Entry(storage)
@Component
struct EntryView {
onPageShow(): void {
// 从卡片进入页面时判断具体跳转页面
if (this.formRouter) {
waterFlowData.forEach((item: SceneModuleInfo) =&gt; {
let index = item.appUri.indexOf(this.formRouter);
if (index &gt; -1) {
if (DynamicsRouter.appRouterStack.slice(-1)[0].name !== item.appUri) {
DynamicsRouter.clear();
DynamicsRouter.pushUri(item.appUri);
}
return;
}
})
this.formRouter = '';
}
}
}</p>
</li>
<li>
<p>判断卡片大小：获取卡片详情，根据宽高比获取卡片的规格，不同规格显示内容不同。在<code>EntryFormAbility.ets</code>中补充点击卡片进入时查找对应案例的逻辑。在onAddForm生命周期内做卡片生成时，createFormBindingData方法传递属性。</p>
<p>// EntryFormAbility.ets
export default class EntryFormAbility extends FormExtensionAbility {
// 卡片对象集合
onAddForm(want: Want): formBindingData.FormBindingData {
let isLongCard: boolean = true;
if ((want.parameters?.[formInfo.FormParam.WIDTH_KEY] as number) /
(want.parameters?.[formInfo.FormParam.HEIGHT_KEY] as number) &gt; 0.666) {
isLongCard = false;
}
// 使用方创建卡片时触发，提供方需要返回卡片数据绑定类
let obj: Record&lt;string, string | boolean&gt; = {
'title': 'titleOnAddForm',
'isLongCard': isLongCard
};
let formData: formBindingData.FormBindingData = formBindingData.createFormBindingData(obj);
return formData;
}
}</p>
</li>
<li>
<p>编写刷新事件：当定时更新或定点更新触发时，需要更新卡片内容。onUpdateForm生命周期发生在定时更新/定点更新/卡片使用方主动请求更新时，在方法内增加获取案例数据的功能。</p>
<p>// EntryFormAbility.ets
export default class EntryFormAbility extends FormExtensionAbility {
// 网络获取README数据并利用formProvider.updateForm更新到卡片
async getData(formId: string) {
let detail: CASES[] = [];
let httpRequest = http.createHttp();
let webData: http.HttpResponse = await httpRequest.request(URL);
if (webData?.responseCode == http.ResponseCode.OK) {
try {
detail = this.formatData(webData.result.toString());
hilog.info(DOMAIN_NUMBER, TAG, '[EntryFormAbility] onFormEvent' + 'webData.result:' + webData.result);</p>
<pre><code class="hljs language-typescript" lang="typescript">        <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClass</span> {
           <span class="hljs-attr">detail</span>: <span class="hljs-variable constant_">CASES</span>[] = detail;
        }

        <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClass</span>();
        <span class="hljs-keyword">let</span> formInfo = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(formData);
        <span class="hljs-keyword">await</span> formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'FormAbility updateForm success.'</span>);
     } <span class="hljs-keyword">catch</span> (error) {
        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`FormAbility updateForm failed: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
     }
  } <span class="hljs-keyword">else</span> {
     hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`ArkTSCard download task failed`</span>);
     <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {
        <span class="hljs-string">'text'</span>: <span class="hljs-string">'刷新失败'</span>
     };
     <span class="hljs-keyword">let</span> <span class="hljs-attr">formInfo</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(param);
     formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
  }
  httpRequest.<span class="hljs-title function_">destroy</span>();
</code></pre>
<p>}</p>
<p>async onUpdateForm(formId: string): Promise {
// 若卡片支持定时更新/定点更新/卡片使用方主动请求更新功能，则提供方需要重写该方法以支持数据更新
hilog.info(DOMAIN_NUMBER, TAG, '[EntryFormAbility] onUpdateForm');
this.getData(formId);
}
}</p>
</li>
<li>
<p>编写刷新事件：手动刷新内容时，需要更新卡片内容。onFormEvent生命周期发生在卡片主动通过postCardAction接口触发message事件。</p>
<p>// EntryFormAbility.ets
export default class EntryFormAbility extends FormExtensionAbility {
// 网络获取README数据并利用formProvider.updateForm更新到卡片
async getData(formId: string) {
let detail: CASES[] = [];
let httpRequest = http.createHttp();
let webData: http.HttpResponse = await httpRequest.request(URL);
if (webData?.responseCode == http.ResponseCode.OK) {
try {
detail = this.formatData(webData.result.toString());
hilog.info(DOMAIN_NUMBER, TAG, '[EntryFormAbility] onFormEvent' + 'webData.result:' + webData.result);</p>
<pre><code class="hljs language-typescript" lang="typescript">        <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClass</span> {
           <span class="hljs-attr">detail</span>: <span class="hljs-variable constant_">CASES</span>[] = detail;
        }

        <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClass</span>();
        <span class="hljs-keyword">let</span> formInfo = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(formData);
        <span class="hljs-keyword">await</span> formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'FormAbility updateForm success.'</span>);
     } <span class="hljs-keyword">catch</span> (error) {
        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`FormAbility updateForm failed: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);
     }
  } <span class="hljs-keyword">else</span> {
     hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`ArkTSCard download task failed`</span>);
     <span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {
        <span class="hljs-string">'text'</span>: <span class="hljs-string">'刷新失败'</span>
     };
     <span class="hljs-keyword">let</span> <span class="hljs-attr">formInfo</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(param);
     formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo);
  }
  httpRequest.<span class="hljs-title function_">destroy</span>();
</code></pre>
<p>}</p>
<p>async onFormEvent(formId: string, message: string): Promise {
this.getData(formId);
}
}</p>
</li>
<li>
<p>编写刷新事件：参数传到卡片组件内，组件接收参数。处理<code>WidgetCard.ets</code>卡片内逻辑。卡片页面中使用LocalStorageProp装饰需要刷新的卡片数据。</p>
<p>let casesCardInfo = new LocalStorage();
@Entry(casesCardInfo)
@Component
struct Widget_DynamicCard {
@LocalStorageProp('detail') detail: CASES[] = []; // 卡片对象集合
private swiperController: SwiperController = new SwiperController();
@LocalStorageProp('isLongCard') isLongCard: boolean = false;</p>
<p>build() {
// ...
}
}</p>
</li>
</ol>
<h4 data-id="heading-5">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-6">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/160bdf1af84b464d9353063b1ae79913~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623376&amp;x-signature=PbTbJnaEcnFGrEKbgb1v%2Fw81Ag4%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：视频悬浮窗]]></title>    <link>https://juejin.cn/post/7589159665856249875</link>    <guid>https://juejin.cn/post/7589159665856249875</guid>    <pubDate>2025-12-29T14:32:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589159665856249875" data-draft-id="7589126217250947113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：视频悬浮窗"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:32:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：视频悬浮窗
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:32:12.000Z" title="Mon Dec 29 2025 14:32:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言：</h3>
<p>本示例主要介绍视频小窗口播放场景，利用媒体的AVPlayer实现视频播放以及相关操作，利用PiPWindow开启悬浮窗从而实现小窗口播放视频。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/faa55123c4534e75ad2dbbdbf6d93d6c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623531&amp;x-signature=qomqixm6n%2F3eZ9lrheOj4Sq7C%2Bs%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>等待视频加载完成，视频会自动播放。</li>
<li>将应用隐藏到后台，自动拉起悬浮窗继续播放视频。</li>
<li>点击悬浮窗恢复图标，恢复到原始播放界面，视频继续正常播放。</li>
<li>原始播放界面视频暂停不会拉起悬浮窗。</li>
<li>悬浮窗视频暂停后，再点击恢复图标，原始播放界面视频继续播放。</li>
<li>悬浮窗点击关闭之后，原始播放界面视频暂停。</li>
<li>点击原视频界面小窗口图标，可开启悬浮窗。</li>
<li>手指在原视频左侧滑动可改变视频页面的亮度（需真机验证）。</li>
<li>手指在原视频右侧滑动可改变视频的声音（需真机验证，注：本案例使用的视频暂无声音，开发者可更换视频资源验证该功能）。</li>
</ol>
<h3 data-id="heading-2">下载安装</h3>
<ol>
<li>
<p>模块oh-package.json5文件中引入依赖</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"dependencies"</span>: {
  <span class="hljs-string">"@ohos/compressfile"</span>: <span class="hljs-string">"har包地址"</span>
}
</code></pre>
</li>
<li>
<p>ets文件import自定义视图实视频悬浮窗组件</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PipWindowComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/pipwindow'</span>;
</code></pre>
</li>
</ol>
<h3 data-id="heading-3">快速使用</h3>
<p>本节主要介绍了如何快速上手使用视频悬浮窗组件，包括调节视频亮度声音控制器组件以及常见自定义参数的初始化。</p>
<ol>
<li>
<p>构建组件</p>
<p>在代码合适的位置使用PipWindowComponent组件并传入对应的参数，后续将介绍对应参数的初始化。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 画中画控制开启、播放组件
 * player:初始化视频播放控制器
 * url:传入在线视频资源
 */</span>
PipWindowComponent({
  player: <span class="hljs-keyword">this</span>.player,
  url: <span class="hljs-keyword">this</span>.url
})
</code></pre>
</li>
<li>
<p>各参数初始化，player可直接写PipManager.getInstance().player，url必须为在线mp4视频。</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@State</span> <span class="hljs-attribute">player</span>: AVPlayer = PipManager.<span class="hljs-built_in">getInstance</span>().player; <span class="hljs-comment">// 初始化视频播放控制器</span>
<span class="hljs-variable">@State</span> <span class="hljs-attribute">url</span>: string = <span class="hljs-string">" "</span>; <span class="hljs-comment">// 传入在线视频资源</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-4">属性(接口)说明</h3>
<p>PipWindowComponent组件属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>player</p>
<p>AVPlayer</p>
<p>初始化视频播放控制器</p>
<p>-</p>
<p>url</p>
<p>string</p>
<p>传入在线视频资源</p>
<p>-</p>
<h3 data-id="heading-5">实现思路</h3>
<p>本例涉及的关键特性和实现方案如下：</p>
<ol>
<li>
<p>使用媒体的AVPlayer实现视频播放。</p>
<p>/**</p>
<ul>
<li>初始化AVPlayer</li>
<li>@param url 在线视频路径</li>
<li>@returns 返回值将在线视频进行绑定
*/
async init(url: string): Promise {
await this.release();
// 创建avPlayer实例对象
this.avPlayer = await media.createAVPlayer();
this.isCreate = true;
// 创建状态机变化回调函数
await this.setSourceInfo(); // 视频信息上报函数
await this.setStateChangeCallback(); // 状态机上报回调函数
this.avPlayer.url = url; // 播放hls网络直播码流
}</li>
</ul>
</li>
<li>
<p>使用PiPWindow开启悬浮窗从而实现小窗口播放视频。</p>
<p>/**</p>
<ul>
<li>创建画中画控制器，注册生命周期事件以及控制事件回调</li>
<li>@param ctx 上下文环境
*/
init(ctx: Context) {
if (this.pipController !== null &amp;&amp; this.pipController !== undefined) {
return;
}
// 当前设备如若不支持画中画则退出
if (!PiPWindow.isPiPEnabled()) {
return;
}</li>
</ul>
<p>let config: PiPWindow.PiPConfiguration = {
context: ctx,
// XComponent组件绑定同一个
componentController: this.getXComponentController(),
// 画中画媒体类型枚举，当前使用的视频播放模版
templateType: PiPWindow.PiPTemplateType.VIDEO_PLAY,
};
// 通过create接口创建画中画控制器实例
let promise: Promise&lt;PiPWindow.PiPController&gt; = PiPWindow.create(config);
promise.then((controller: PiPWindow.PiPController) =&gt; {
this.pipController = controller;
// 通过画中画控制器实例的setAutoStartEnabled接口设置是否需要在应用返回桌面时自动启动画中画
this.pipController?.setAutoStartEnabled(true);
// 通过画中画控制器实例的on('stateChange')接口注册生命周期事件回调
this.pipController.on('stateChange', (state: PiPWindow.PiPState, reason: string) =&gt; {
this.onStateChange(state, reason);
});
// 通过画中画控制器实例的on('controlEvent')接口注册控制事件回调
this.pipController.on('controlEvent', (control: PiPWindow.ControlEventParam) =&gt; {
this.onActionEvent(control);
});
}).catch((err: BusinessError) =&gt; {
console.error(<code>Failed to create pip controller. Cause:${err.code}, message:${err.message}</code>);
});
}</p>
</li>
<li>
<p>通过绑定同一个XComponent控制器使得视频页面和悬浮窗页面视频保持统一播放进度。</p>
<p>XComponent({
type: XComponentType.SURFACE,
controller: PipManager.getInstance().getXComponentController()
})
.onLoad(() =&gt; {
// 将surfaceId设置给媒体源
PipManager.getInstance()
.getXComponentController()
.onSurfaceCreated(PipManager.getInstance().getXComponentController().getXComponentSurfaceId())
// 初始化AVPlayer
PipManager.getInstance().player.init(this.url);
})</p>
</li>
<li>
<p>使用@Watch监听AVPlayer的发生变化时，会触发onPlayingChange的回调方法。组件中需要手动控制视频的播放与暂停，因为视频的播放状态是需要根据视频加载进度和手动控制来改变的，所以可以使用@Watch进行监听。</p>
<p>@ObjectLink @Watch("onPlayingChange") player: AVPlayer</p>
<p>onPlayingChange() {
this.player.isPlaying ? this.player.getPlay() : this.player.getPause();
if (this.player.isPlaying === false) {
PipManager.getInstance().setAutoStart(false)
} else {
PipManager.getInstance().setAutoStart(true)
PipManager.getInstance().updatePiPControlStatus()
}
}</p>
</li>
<li>
<p>悬浮窗的从小窗口恢复到原始播放界面以及关闭悬浮窗，需要通过相关生命周期来进行控制视频的播放状态。</p>
<p>// 监听画中画生命周期
onStateChange(state: PiPWindow.PiPState, reason: string) {
switch (state) {
// 表示画中画将要启动
case PiPWindow.PiPState.ABOUT_TO_START:
break;
// 表示画中画已经启动
case PiPWindow.PiPState.STARTED:
// 启动画中画
PipManager.getInstance().player.isPiPWindowLoad = true;
break;
// 表示画中画将要停止
case PiPWindow.PiPState.ABOUT_TO_STOP:
// 画中画关闭
PipManager.getInstance().player.isPiPWindowLoad = false;
break;
// 表示画中画已经停止
case PiPWindow.PiPState.STOPPED:
// 画中画关闭
PipManager.getInstance().player.isPiPWindowLoad = false;
// 小窗口点击关闭画中画，视频暂停播放
if (!PipManager.getInstance().player.isPiPWindowRestore) {
PipManager.getInstance().player.isPlaying = false;
}
PipManager.getInstance().player.isPiPWindowRestore = false;
break;
// 表示画中画将从小窗播放恢复到原始播放界面
case PiPWindow.PiPState.ABOUT_TO_RESTORE:
// 小窗口复原关闭画中画
PipManager.getInstance().player.isPiPWindowLoad = false;
// 从小窗口复原
PipManager.getInstance().player.isPiPWindowRestore = true;
if (!PipManager.getInstance().player.isPlaying) {
PipManager.getInstance().player.isPlaying = true;
}
break;
// 表示画中画生命周期执行过程出现了异常
case PiPWindow.PiPState.ERROR:
break;
default:
break;
}
}</p>
</li>
<li>
<p>因为当悬浮窗的从小窗口恢复到原始播放界面以及关闭悬浮窗时对视频播放状态进行操作，悬浮窗的播放图标并不会实时更新，所以手动进行更新。</p>
<p>/**</p>
<ul>
<li>视频播放页面</li>
<li>@param url:视频源（本案例仅支持使用在线视频）
*/
XComponentView({
url: this.url
})
.gesture(
// 双击视频，视频暂停/播放
GestureGroup(GestureMode.Exclusive,
TapGesture({ count: TAP_GESTURE }).onAction((event?: GestureEvent) =&gt; {
PipManager.getInstance().player.isPlaying = !PipManager.getInstance().player.isPlaying
if (PipManager.getInstance().player.isPlaying === false) {
PipManager.getInstance().setAutoStart(false)
PipManager.getInstance().updatePiPControlStatus()
} else {
PipManager.getInstance().setAutoStart(true)
PipManager.getInstance().updatePiPControlStatus()
}
})
))
// 更新画中画面板控件状态
updatePiPControlStatus() {
let controlType: PiPWindow.PiPControlType = PiPWindow.PiPControlType.VIDEO_PLAY_PAUSE; // 视频播放控制面板中播放/暂停控件。
let status: PiPWindow.PiPControlStatus = PiPWindow.PiPControlStatus.PLAY; // 视频播放控制面板中播放/暂停控件为播放状态。
this.pipController?.updatePiPControlStatus(controlType, status); // 更新控制面板控件功能状态
}</li>
</ul>
</li>
<li>
<p>使用onAreaChange来获取原视频页面的播放区域宽高。</p>
<p>Stack(this.player.isLoading ? { alignContent: Alignment.Center } :
{ alignContent: Alignment.Bottom }) {</p>
<p>/**</p>
<ul>
<li>视频播放组件</li>
<li>url:视频源（本案例仅支持使用在线视频）
*/
XComponentView({
url: this.url
})
...
}
.onAreaChange((oldVal: Area, newVal: Area) =&gt; {
// 获取视频播放区域的宽高
this.videoAreaWidth = newVal.width as number;
this.videoAreaHeight = newVal.height as number;
})</li>
</ul>
</li>
<li>
<p>使用PanGesture来确定手指滑动的方向以及移动的距离从而改变实时改变视频的亮度和声音。</p>
<p>Stack(this.player.isLoading ? { alignContent: Alignment.Center } :
{ alignContent: Alignment.Bottom }) {</p>
<p>/**</p>
<ul>
<li>视频播放组件</li>
<li>url:视频源（本案例仅支持使用在线视频）
*/
XComponentView({
url: this.url
})
...
}
.gesture(
// 双击视频，视频暂停/播放
GestureGroup(GestureMode.Exclusive,
TapGesture({ count: TAP_GESTURE })
.onAction((event?: GestureEvent) =&gt; {
this.player.isPlaying = !this.player.isPlaying;
AppStorage.setOrCreate('pipWindow_isPlaying', this.player.isPlaying);
if (this.player.isPlaying === false) {
PipManager.getInstance().setAutoStart(false);
PipManager.getInstance().updatePiPControlStatus();
} else {
PipManager.getInstance().setAutoStart(true);
PipManager.getInstance().updatePiPControlStatus();
}
}),
PanGesture(this.panOption)
.onActionStart((event: GestureEvent) =&gt; {
this.sysVolumeChange();
this.positionH = event.offsetY;
this.controlShow = true;
})
.onActionUpdate((event: GestureEvent) =&gt; {
this.panOption.setDirection(PanDirection.Vertical);
// 手指初次滑动横向坐标位置
this.fingerPosition = event.fingerList[0].localX;
if (this.positionH === event.offsetY) {
return;
}
// 手指移动的距离
let changeVolume = ((this.positionH - event.offsetY) / this.videoAreaHeight) * HEIGHT_INTEGER;
if (this.fingerPosition &lt; (this.videoAreaWidth / PARTITION)) {
this.onBrightActionUpdate(changeVolume);
// 调节视频亮度
this.mWindow?.setWindowBrightness(this.bright / CONTROLLER_MAX);
} else {
this.onVolumeActionUpdate(changeVolume);
}
this.positionH = event.offsetY;
})
.onActionEnd(() =&gt; {
// 延时隐藏控制器
setTimeout(() =&gt; {
this.controlShow = false;
}, CONTROLLER_DElAY)
})
))</li>
</ul>
</li>
</ol>
<h4 data-id="heading-6">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-7">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ce8fcc243f84647a2963226abfb3c5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623531&amp;x-signature=qViJQl0LopLlJgapc3XNA%2BRXCms%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI工具如何重塑我的开发日常]]></title>    <link>https://juejin.cn/post/7589126920286535690</link>    <guid>https://juejin.cn/post/7589126920286535690</guid>    <pubDate>2025-12-29T14:34:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286535690" data-draft-id="7589126920286437386" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI工具如何重塑我的开发日常 "/> <meta itemprop="keywords" content="前端,人工智能,深度学习"/> <meta itemprop="datePublished" content="2025-12-29T14:34:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_XU"/> <meta itemprop="url" content="https://juejin.cn/user/3166249063027112"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI工具如何重塑我的开发日常 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3166249063027112/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _XU
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:34:07.000Z" title="Mon Dec 29 2025 14:34:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>2025年，转眼间又过去了。作为一名开发者，这一年来，我最深刻的体会就是大语言模型（LLM）如ChatGPT和DeepSeek，已经从“新鲜玩具”彻底转变为日常工作的核心伙伴。它们不再是偶尔咨询的“搜索引擎替代品”，而是真正融入代码编写、调试和思考流程的“编程搭档”。
聚焦到个体层面，这些AI工具对“我”的影响是巨大的：开发效率显著提升，代码编写变得更流畅、更富有创意，同时也让我重新审视自己的编程习惯和技能成长路径。下面，我从个人经历出发，分享这一年的变化。</p>
<h2 data-id="heading-0">ChatGPT：从灵感激发到高效代码生成的得力助手</h2>
<p>年初时，我主要用ChatGPT来处理日常编码问题。起初只是简单问“怎么实现一个Vue函数”或“优化这个SQL查询”，但渐渐地，它成了我开发流程的起点。</p>
<p><strong>效率提升的核心场景：</strong> 在编写新功能时，ChatGPT帮我快速生成 boilerplate 代码。例如，构建一个后端API时，我只需描述需求（如“用Node.js和Express实现一个带JWT认证的用户注册接口”），它就能输出完整结构，包括错误处理和最佳实践。这让我从重复性工作解放出来，一天能多处理2-3个中等复杂度任务。个人统计下来，今年我的代码提交频率比去年提高了约30%，很大程度上归功于此。</p>
<p><strong>调试的加速器：</strong> 遇到bug时，粘贴错误信息和相关代码，ChatGPT往往能精准指出问题，甚至建议多种修复方案。相比以前先手动搜索再实现验证，现在调试时间缩短了至少一半。有一次，一个棘手的异步并发问题困扰了我半天，用ChatGPT分析后，很快就解决了。</p>
<p><strong>个人影响：</strong> 它让我编码更“如鱼得水”——思路卡壳时，像和一位资深同事 brainstorm 一样顺畅。负面来说，有时生成的代码需要仔细审查（hallucination问题虽减少但仍存在），这培养了我更强的代码审查习惯。总体上，ChatGPT让我从“机械码农”转向“架构思考者”，工作效率明显提升。</p>
<h2 data-id="heading-1">DeepSeek：极致性价比与本地部署的硬核选择</h2>
<p>年中开始，我逐渐把DeepSeek作为主力代码工具，它使用起来很方便以及能很好的控制成本。它的代码生成精度与速度在Vue、Node.js等前端生态上表现不错，而且响应速度也很快。 如果项目涉密注重隐私，DeepSeek开源模型可以部署到本地运行，不上传任何敏感项目代码。</p>
<p><strong>个人影响：</strong> DeepSeek可以满足大量批量生成或重构的场景。它把我从“担心费用”和“担心隐私”的焦虑中解放出来，让我更专注于业务本身。</p>
<h2 data-id="heading-2">我的典型工作流</h2>
<p>实际使用中，两者我形成了清晰的互补策略：</p>
<ul>
<li>创意与需求拆解阶段 → 用ChatGPT（更擅长发散思维）。</li>
<li>核心代码实现与优化阶段 → 切到DeepSeek（更快、更省钱）。</li>
<li>调试与重构阶段 → 根据上下文和隐私需求灵活切换。</li>
</ul>
<h2 data-id="heading-3">个人体会</h2>
<p>大模型的进步让代码生成不再是“填空题”，而是真正智能协作。
<strong>生产力跃升：</strong> 结合使用ChatGPT和DeepSeek，我的整体开发效率得到了大幅提升。重复任务几乎自动化，留出更多时间专注核心逻辑和创新。 <strong>技能演变：</strong> AI处理了低阶工作，我被迫提升prompt工程和系统设计能力。以前写代码靠记忆，现在更靠“问对问题”。这让我成长更快，同时也担心过度依赖会弱化基础技能——所以我坚持不断手动实现一些算法练习。</p>
<p>当然，不是一切完美。AI偶尔也会输出低质代码，需要人工把关。但总体上，2025年的AI工具让我这个开发者感受到前所未有的赋能。 展望2026，随着agentic模式（如多步自主任务）和更好工具集成，我相信开发将更进一步“智能化”。作为开发者，我们不是被取代，而是被放大——抓住这个浪潮，继续游刃有余地在代码的海洋中畅游！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：自定义动效tab实现]]></title>    <link>https://juejin.cn/post/7589099845186863140</link>    <guid>https://juejin.cn/post/7589099845186863140</guid>    <pubDate>2025-12-29T14:35:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589099845186863140" data-draft-id="7589201772118179846" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：自定义动效tab实现"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:35:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：自定义动效tab实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:35:16.000Z" title="Mon Dec 29 2025 14:35:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言：</h3>
<p>本示例介绍使用List、Text等组件，以及animateTo等接口实现自定义Tab效果。</p>
<h3 data-id="heading-1">效果预览图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0902abaf52b1453ca3b99e5b48e54f7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=ofjnt6Rur%2BoNoc%2FwDkn1%2FjLbotw%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<p>1.选中页签，字体放大加粗且后面有背景条，起到强调作用。</p>
<p>2.手势触摸tab内容滑动，背景条跟随手势一起滑动。抬手时，当tab内容滑动距离不足一半时，会自动回弹，而当tab内容滑动距离大于一半时，背景条则会移动到下一个页签。当背景条滑动到一定距离后开始滑动页签条，使背景条始终能够保持在可视范围内。</p>
<p>3.点击页签，可以进行页签切换。</p>
<p>4.滑动页签条，背景条也会随之一起滑动，然后滑动tab内容，页签条会滑动到原处，使背景条处于可视范围内，之后背景条开始跟随手势滑动。</p>
<p>5.动画承接，背景条滑动过程中，触摸屏幕，背景条动画停止，松开手势，背景条继续滑动</p>
<h3 data-id="heading-2">下载安装</h3>
<p>1.模块oh-package.json5文件中引入依赖</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-string">"dependencies"</span>: {
  <span class="hljs-string">"@ohos-cases/custom_animation_tab"</span>: <span class="hljs-string">"har包地址"</span>
}
</code></pre>
<p>2.ets文件import自定义视图实现Tab效果组件</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> {<span class="hljs-title class_">CustomAnimationTab</span>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos-cases/custom_animation_tab'</span>
</code></pre>
<h3 data-id="heading-3">快速使用</h3>
<p>本节主要介绍了如何快速上手使用自定义视图实现Tab效果组件，包括构建Tab组件以及常见自定义参数的初始化。</p>
<p>1.构建Tab</p>
<p>在代码合适的位置使用CustomAnimationTab组件并传入对应的参数（animationAttribute必须设置，其余参数可以使用默认值），后续将分别介绍对应参数的初始化。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/**
 * 构建自定义Tab
 * animationAttribute: 动效属性
 * tabsInfo: tab数据源
 * indicatorBarAttribute: 背景条属性
 * tabBarAttribute: 页签条属性
 * tabController: 自定义动效tab控制器
 * scroller: 页签条滚动控制器
 */</span>
CustomAnimationTab({
  animationAttribute: <span class="hljs-keyword">this</span>.animationAttribute,
  tabsInfo: <span class="hljs-keyword">this</span>.tabsInfo,
  indicatorBarAttribute: <span class="hljs-keyword">this</span>.indicatorBarAttribute,
  tabBarAttribute: <span class="hljs-keyword">this</span>.tabBarAttribute,
  tabController: <span class="hljs-keyword">this</span>.tabController,
  scroller: <span class="hljs-keyword">this</span>.scroller
})
</code></pre>
<p>2.动效属性初始化</p>
<p>动效属性基类为AnimationAttribute，其中封装了tab组件内部的动效属性。本示例中提供了开发自定义背景条颜色动效属性的代码。首先创建一个MyAnimationAttribute类，并继承AnimationAttribute基类，其中新增背景条颜色属性indicatorBarColor；之后创建MyAnimationAttribute状态变量对象animationAttribute，并将背景条颜色属性绑定到自定义背景条上，同时与button相关联，通过点击事件动态更改背景条颜色。（这里需要注意class对象属性级更新的正确使用）</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-comment">// 自定义动效属性，添加了背景条颜色变化</span>
<span class="hljs-meta">@State</span> animationAttribute: <span class="hljs-type">MyAnimationAttribute</span> = <span class="hljs-keyword">new</span> <span class="hljs-type">MyAnimationAttribute</span>($r(<span class="hljs-string">"app.color.custom_animation_tab_indicator_color"</span>));


<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyAnimationAttribute</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnimationAttribute</span> </span>{
  <span class="hljs-comment">// 背景条颜色</span>
  indicatorBarColor: <span class="hljs-type">ResourceColor</span>;

  constructor(indicatorBarColor: <span class="hljs-type">ResourceColor</span>) {
    <span class="hljs-keyword">super</span>();
    <span class="hljs-keyword">this</span>.indicatorBarColor = indicatorBarColor;
  }
}


<span class="hljs-meta">@Builder</span>
indicatorBar($$: <span class="hljs-type">BaseInterface</span>) {
  <span class="hljs-type">Column</span>()
    .height($r(<span class="hljs-string">"app.float.custom_animation_tab_indicator_height"</span>))
    .width($r(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
    <span class="hljs-comment">// 绑定自定义动效属性</span>
    .backgroundColor(<span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor)
    .borderRadius($r(<span class="hljs-string">"app.float.custom_animation_tab_indicator_border_radius"</span>))
}

<span class="hljs-comment">// 更新自定义动效变量——背景条颜色</span>
<span class="hljs-type">Column</span>() {
  <span class="hljs-type">Button</span>($r(<span class="hljs-string">"app.string.custom_animation_tab_button_text"</span>))
    .height($r(<span class="hljs-string">"app.string.custom_animation_tab_ninety_percent"</span>))
    .<span class="hljs-keyword">type</span>(<span class="hljs-type">ButtonType</span>.<span class="hljs-type">Capsule</span>)
    .onClick(() =&gt; {
      <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor as <span class="hljs-type">Resource</span>).id ===
      $r(<span class="hljs-string">"app.color.custom_animation_tab_indicator_color"</span>).id) {
        <span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor = <span class="hljs-type">Color</span>.<span class="hljs-type">Yellow</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor === <span class="hljs-type">Color</span>.<span class="hljs-type">Yellow</span>) {
        <span class="hljs-keyword">this</span>.animationAttribute.indicatorBarColor = $r(<span class="hljs-string">"app.color.custom_animation_tab_indicator_color"</span>);
      }
    })
}
.justifyContent(<span class="hljs-type">FlexAlign</span>.<span class="hljs-type">Center</span>)
.height($r(<span class="hljs-string">"app.string.custom_animation_tab_ten_percent"</span>))
.width($r(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
</code></pre>
<p>3.数据初始化</p>
<p>本小节主要介绍了如何初始化自定义Tab数据源。首先构建一个TabInfo数组，然后向其中传入对应的TabInfo对象，TabInfo对象主要需要传入三个属性——页签标题、tab页面内容视图以及页签组件。以base页面为例，首先创建一个@Builder函数，在该函数中填入struct组件，在struct组件中编写对应tab页面内容视图。然后，构建对应的页签样式tabBar，其中需要添加一个TabBarItemInterface类对象作为形参，其包括了一些必要属性，可以自定义样式修改，本示例中主要通过使用当前索引curIndex与页签索引index之间的比较来动态更改页签样式。</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// tab数据</span>
<span class="hljs-attr">tabsInfo</span>: <span class="hljs-title class_">TabInfo</span>[] = [];

<span class="hljs-variable language_">this</span>.<span class="hljs-property">tabsInfo</span> = [
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_BASE_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(baseBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_UI_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(uiBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_DYEFFECT_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(dyEffectBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_THIRTYPARTY_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(thirdPartyBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_NATIVE_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(nativeBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar)),
  <span class="hljs-keyword">new</span> <span class="hljs-title class_">TabInfo</span>(<span class="hljs-title class_">CustomAnimationTabConfigure</span>.<span class="hljs-property">DEFAULT_OTHER_TAB</span>, <span class="hljs-title function_">wrapBuilder</span>(otherBuilder), <span class="hljs-title function_">wrapBuilder</span>(tabBar))
]
  
<span class="hljs-comment">// baseBuilder页面</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">LazyDataSource</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./LazyDataSource'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SkeletonLayout</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./SkeletonLayout'</span>;

<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">baseBuilder</span>(<span class="hljs-params"/>) {
  <span class="hljs-title class_">BasePage</span>();
}

<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">BasePage</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">LazyDataSource</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LazyDataSource</span>&lt;<span class="hljs-built_in">string</span>&gt;();

  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`<span class="hljs-subst">${i}</span>`</span>);
    }
  }

  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-title class_">List</span>() {
        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
          <span class="hljs-title class_">ListItem</span>() {
            <span class="hljs-title class_">SkeletonLayout</span>({<span class="hljs-attr">isMine</span>: <span class="hljs-literal">false</span>})
          }
        })
      }
      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">1</span>)
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)
  }
}

<span class="hljs-comment">// 页签样式</span>
<span class="hljs-meta">@Builder</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">tabBar</span>(<span class="hljs-params">$$: TabBarItemInterface</span>) {
  <span class="hljs-title class_">Text</span>($$.<span class="hljs-property">title</span>)
    .<span class="hljs-title function_">fontSize</span>($$.<span class="hljs-property">curIndex</span> === $$.<span class="hljs-property">index</span> ? $r(<span class="hljs-string">"app.float.custom_animation_tab_list_select_font_size"</span>) : $r(<span class="hljs-string">"app.float.custom_animation_tab_list_unselect_font_size"</span>))
    .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">"app.color.custom_animation_tab_list_font_color"</span>))
    .<span class="hljs-title function_">fontWeight</span>($$.<span class="hljs-property">curIndex</span> === $$.<span class="hljs-property">index</span> ? <span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span> : <span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)
    .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
}
</code></pre>
<p>4.背景条初始化</p>
<p>背景条可以通过IndicatorBarAttribute类进行配置，也可以使用已有的背景条配置（目前支持两种: IndicatorBarAttribute.BACKGROUNDBAR和IndicatorBarAttribute.THINSTRIP）。本示例主要介绍了构建IndicatorBarAttribute类进行背景条配置，其中传入了背景条组件indicatorBar ，背景条宽度模式设置为内边距模式，左右边距设为20，上下边距设为10，同时设置背景条最大偏移为CustomAnimationTabConfigure.INDICATOR_MAX_LEFT以及背景条宽度扩展比例为CustomAnimationTabConfigure.DEFAULT_INDICATOR_EXPAND。</p>
<pre><code class="hljs language-less" lang="less">indicatorBarAttribute: IndicatorBarAttribute = new IndicatorBarAttribute(this.indicatorBar, SizeMode.<span class="hljs-attribute">Padding, 20, 10,
  CustomAnimationTabConfigure.INDICATOR_MAX_LEFT, CustomAnimationTabConfigure.DEFAULT_INDICATOR_EXPAND);

@Builder
indicatorBar($$</span>: BaseInterface) {
  <span class="hljs-built_in">Column</span>()
    .<span class="hljs-built_in">height</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
    .<span class="hljs-built_in">width</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">"app.string.custom_animation_tab_one_hundred_percent"</span>))
    .<span class="hljs-built_in">backgroundColor</span>(this.animationAttribute.indicatorBarColor)
    .<span class="hljs-built_in">borderRadius</span>($<span class="hljs-built_in">r</span>(<span class="hljs-string">"app.float.custom_animation_tab_indicator_border_radius"</span>))
}
</code></pre>
<p>5.页签条初始化</p>
<p>页签条属性通过TabBarAttribute类进行配置。本例中主要配置了各个页签的宽度大小以及页签条高度。</p>
<pre><code class="hljs language-ini" lang="ini">tabBarAttribute: <span class="hljs-attr">TabBarAttribute</span> = new TabBarAttribute(CustomAnimationTabConfigure.LIST_ITEM_WIDTH, CustomAnimationTabConfigure.TABBAR_HEIGHT)
</code></pre>
<p>6.tab及页签条控制器初始化</p>
<p>自定义Tab控制器以及页签条控制器分别通过CustomAnimationTabController和Scroller初始化，分别用于控制自定义Tab与页签条的行为。</p>
<pre><code class="hljs language-ini" lang="ini">// tabController
tabController: <span class="hljs-attr">CustomAnimationTabController</span> = new CustomAnimationTabController()<span class="hljs-comment">;</span>
// scroller
scroller: <span class="hljs-attr">Scroller</span> = new Scroller()<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-4">属性(接口)说明</h3>
<p>CustomAnimationTab组件属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>animationAttribute</p>
<p>AnimationAttribute</p>
<p>封装了包括背景条长度、背景条高度以及背景条左边距在内的动效属性，使组件内部对应的属性可以动态变化</p>
<p>undefined</p>
<p>tabsInfo</p>
<p>TabInfo[]</p>
<p>tab数据源</p>
<p>-</p>
<p>indicatorBarAttribute</p>
<p>IndicatorBarAttribute</p>
<p>背景条属性类，配置背景条组件，以及背景条相关的属性</p>
<p>-</p>
<p>tabBarAttribute</p>
<p>AnimationAttribute</p>
<p>页签条属性类，配置页签条相关的属性</p>
<p>-</p>
<p>tabController</p>
<p>CustomAnimationController</p>
<p>tab控制器，用于控制tabs组件进行页签切换</p>
<p>-</p>
<p>scroller</p>
<p>Scroller</p>
<p>页签条控制器，可以控制页签条的滚动</p>
<p>-</p>
<p>animationDuration</p>
<p>number</p>
<p>页签切换时长，控制页签切换时背景条滑动以及tab页面之间切换的时长</p>
<p>240ms</p>
<p>startIndex</p>
<p>number</p>
<p>配置起始的页签索引</p>
<p>0</p>
<p>gestureAnimation</p>
<p>(index: number, targetIndex: number, elementsInfo: [number, number][], ratio: number) =&gt; void</p>
<p>配置在tab页面上手势滑动时背景条的跟手动效</p>
<p>-</p>
<p>autoAnimation</p>
<p>(index: number, targetIndex: number, elementsInfo: [number, number][], ratio: number) =&gt; void</p>
<p>配置在tab页面上离手后背景条的自动滑动动效</p>
<p>-</p>
<p>clickAnimation</p>
<p>(index: number, targetIndex: number, indexInfo: Record&lt;string, number&gt;, targetIndexInfo: Record&lt;string, number&gt;, elementsInfo: [number, number][]) =&gt; void</p>
<p>配置点击页签时背景条的滑动动效</p>
<p>-</p>
<p>getScrollInfo</p>
<p>(center: number, width: number) =&gt; [number, number]</p>
<p>获取页签对应的背景条左边距以及页签条偏移，通过该函数可以自行配置选中各个页签时背景条的左边距以及页签条的偏移情况</p>
<p>-</p>
<p>TabInfo类属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>title</p>
<p>string</p>
<p>页签标题</p>
<p>-</p>
<p>contentbuilder</p>
<p>WrappedBuilder&lt;[]&gt;</p>
<p>tab页面内容视图</p>
<p>-</p>
<p>barBuilder</p>
<p>WrappedBuilder&lt;[TabBarItemInterface]&gt;</p>
<p>页签组件（没有配置，则使用内部默认配置）</p>
<p>undefined</p>
<p>IndicatorBarAttribute类属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>indicatorBar</p>
<p>(index: BaseInterface) =&gt; void</p>
<p>自定义背景条组件</p>
<p>-</p>
<p>sizeMode</p>
<p>SizeMode</p>
<p>背景条宽度模式</p>
<p>SizeMode.Normal</p>
<p>innerWidth</p>
<p>number</p>
<p>1. 尺寸模式为正常模式，表示背景条宽度，值为0时则与页签宽度保持一致;<br/>
2. 尺寸模式为内边距模式，表示背景条与页签项之间的左右边距</p>
<p>0</p>
<p>innerHeight</p>
<p>number</p>
<p>1. 尺寸模式为正常模式，表示背景条高度，值为0时则与页签高度保持一致;<br/>
2. 尺寸模式为内边距模式，表示背景条与页签项之间的上下边距</p>
<p>0</p>
<p>maxIndicatorBarLeft</p>
<p>number</p>
<p>背景条最大偏移(&lt;0: 无上限, &gt;=0: innerMaxIndicatorBarLeft)，配置背景条最大的滑动距离，超过该距离后除非页签条滑动到了底部，否则滑动页签条，背景条不再滑动</p>
<p>-1</p>
<p>indicatorExpand</p>
<p>number</p>
<p>背景条宽度扩展比例，配置背景条在滑动过程中宽度扩展的比例</p>
<p>1</p>
<p>barAlign</p>
<p>VerticalAlign</p>
<p>背景条垂直布局，配置背景条相对于页签的位置</p>
<p>VerticalAlign.Center</p>
<p>TabBarAttribute类属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>barItemWidth</p>
<p>Length</p>
<p>各个页签项的宽度（没有设置且尺寸模式为正常模式时，与页签同宽；没有设置且尺寸模式为内边距模式时，与背景条同宽）</p>
<p>undefined</p>
<p>barHeight</p>
<p>Length</p>
<p>页签条高度（没有设置且尺寸模式为正常模式时，与首个页签同高；没有设置且尺寸模式为内边距模式时，与背景条同高）</p>
<p>undefined</p>
<p>scrollable</p>
<p>boolean</p>
<p>是否可以滚动页签条(false则所有页签等分屏幕宽度，barItemWidth失效)</p>
<p>true</p>
<p>barEdgeEffect</p>
<p>EdgeEffect</p>
<p>页签条边缘滑动效果，支持弹簧效果和阴影效果</p>
<p>EdgeEffect.Spring</p>
<p>barVertical</p>
<p>BarPosition</p>
<p>页签条位置，处于tab内容的上方或下方</p>
<p>BarPosition.Start</p>
<p>barBackgroundColor</p>
<p>ResourceColor</p>
<p>页签条背景颜色</p>
<p>Color.Transparent</p>
<p>BaseInterface属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>curIndex</p>
<p>number</p>
<p>当前选中的页签索引</p>
<p>-</p>
<p>TabBarItemInterface属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>curIndex</p>
<p>number</p>
<p>当前选中的页签索引</p>
<p>-</p>
<p>index</p>
<p>number</p>
<p>页签本身索引</p>
<p>-</p>
<p>title</p>
<p>string</p>
<p>页签标题</p>
<p>-</p>
<p>SizeMode属性</p>
<p>属性</p>
<p>类型</p>
<p>释义</p>
<p>默认值</p>
<p>Normal</p>
<p>-</p>
<p>标准宽度模式，背景条尺寸通过背景条宽高属性显示设置</p>
<p>-</p>
<p>Padding</p>
<p>-</p>
<p>内边距模式，背景条尺寸通过页签上下边距隐性设置</p>
<p>-</p>
<h3 data-id="heading-5">实现思路</h3>
<p>本案例的功能实现主要可以分为两个部分：第一个是点击页签的切换，第二个是滑动tab的切换。在后续两小节将对以上两个部分进行详细介绍。然后，我们展示了一些重要的变量名及其含义。</p>
<ul>
<li>maxListOffset：页签条最大偏移距离</li>
<li>maxIndicatorBarLeft： 背景条最大偏移距离</li>
<li>AnimationAttribute.left：背景条位置</li>
</ul>
<h4 data-id="heading-6">1.核心函数getScrollInfo</h4>
<p>由于我们将页签动画效果分为两种不同类型的滑动，因此需要实现一个函数以分别获取每个页签对应的背景条位置以及页签条滑动偏移。</p>
<p>1.1 背景条最大滑动距离以及页签条最大滑动距离</p>
<p>首先，我们需要了解两个概念：背景条最大滑动距离以及页签条最大滑动距离，如下图所示。</p>
<p>（1）背景条最大偏移距离：背景条滑动到该处时不再向后滑动，此时页签条接管滑动。</p>
<p>（2）页签条最大偏移距离：当页签条接管滑动以后，当滑动到末尾时，无法向后滑动，此时背景条再次接管滑动。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/15c9b31735ad41a8a2542cbcbf2e1f18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=2jvHdEkc8264CFo3tqidfzG49Us%3D" alt="" loading="lazy"/></p>
<p>1.2 三个阶段</p>
<p>从上面的两个概念，我们可以看出滑动主要可以切分为三个阶段：1）背景条初始滑动阶段；2）页签条滑动阶段；3）背景条再次滑动阶段。</p>
<p>1.3 代码实现</p>
<p>通过以上两个小节的介绍，我们可以尝试实现代码。具体代码如下所示：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 获取页签对应的背景条位置以及页签条偏移
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">center</span> - 页签中心点
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">width</span> - 页签条宽度
 * <span class="hljs-doctag">@returns</span>: [背景条左端位置, 页签条偏移]
 */</span>
<span class="hljs-meta">@Param</span> <span class="hljs-attr">getScrollInfo</span>: <span class="hljs-function">(<span class="hljs-params">center: <span class="hljs-built_in">number</span>, width: <span class="hljs-built_in">number</span></span>) =&gt;</span> [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] =
  (<span class="hljs-attr">center</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>): [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] =&gt; {
    <span class="hljs-comment">// 获取背景条位置</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">indicatorLeft</span>: <span class="hljs-built_in">number</span> = center - <span class="hljs-variable language_">this</span>.<span class="hljs-property">indicatorBarWith</span> / <span class="hljs-number">2</span>;
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 当背景条位置大于默认的背景条最大位置时，选取背景条最大位置作为背景条实际位置</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">finalIndicatorLeft</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndicatorBarLeft</span> &gt;= <span class="hljs-number">0</span> ? <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(indicatorLeft, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndicatorBarLeft</span>) : indicatorLeft;
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 背景条产生的多余距离作为页签条滑动距离</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">listOffset</span>: <span class="hljs-built_in">number</span> = indicatorLeft - finalIndicatorLeft;
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 当页签条偏移大于页签条可偏移量，选取页签条可偏移量作为页签条实际偏移</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">finalListOffset</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(listOffset, <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxListOffset</span>);
    <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点: 页签条多余的偏移作为背景条后续的滑动距离</span>
    finalIndicatorLeft += listOffset - finalListOffset;
    <span class="hljs-keyword">return</span> [finalIndicatorLeft, finalListOffset];
  };
</code></pre>
<p>具体思路：首先我们可以根据页签的位置信息获取对应背景条的初始位置。1）第一阶段：背景条初始位置就是背景条的实际位置；2）第二阶段：当背景条偏移大于背景条最大偏移距离时，进入第二阶段。这时候后续多余的背景条偏移需要作为页签条偏移，以实现页签条移动；3）第三阶段：当页签条偏移大于页签条最大偏移量时，进入第三阶段。此时多余的页签条偏移会作为背景条的偏移，使背景条继续向后滑动。</p>
<h4 data-id="heading-7">2.点击页签的切换</h4>
<ul>
<li>
<p>首先在onChange回调中实现对应的动画效果，当事件为点击事件并且需要进行页签切换时才进入到对应的动画效果实现，其中首先通过获取index页签的中心位置计算背景条位置，以实现背景条移动到当前页签位置。然后，通过elementsInfo数组获取index页签对应的页签条偏移，从而对页签条进行滑动。而背景条的滑动则通过页签条的滑动回调函数onDidScroll来进行。</p>
<p>// tab
Swiper(this.swiperController) {
// 布局实现
}
.onChange((index: number) =&gt; {
// 点击事件且发生页签切换
if (this.listTouchState === 1 &amp;&amp; index !== this.curIndex) {
let indexInfo: Record&lt;string, number&gt; = this.getElementInfo(this.curIndex);
let targetIndexInfo: Record&lt;string, number&gt; = this.getElementInfo(index);
this.clickAnimation(this.curIndex, index, indexInfo, targetIndexInfo, this.elementsInfo);
}
this.curIndex = index;
console.log(<code>curIndex: ${this.curIndex}</code>)
})</p>
<p>clickAnimation: (targetIndex: number, targetIndexInfo: Record&lt;string, number&gt;, elementsInfo: IndicatorAnimationInfo[]) =&gt; void =
(targetIndex: number, targetIndexInfo: Record&lt;string, number&gt;, elementsInfo: IndicatorAnimationInfo[]): void =&gt; {
// 根据targetIndex页签当前位置获取对应的背景条位置
this.animationAttribute.left = targetIndexInfo.center - this.elementsInfo[targetIndex].width / 2;
this.animationAttribute.indicatorBarWidth = this.elementsInfo[targetIndex].width;
this.animationAttribute.indicatorBarHeight = this.elementsInfo[targetIndex].height;
this.scroller!.scrollTo({xOffset: elementsInfo[targetIndex].offset, yOffset: 0, animation: {duration: this.animationDuration, curve: Curve.Linear}});
};</p>
</li>
<li>
<p>在页签点击事件中触发页签切换事件，后续就会触发tab的onChange事件实现切换动画。</p>
<p>// 页签点击事件
ListItem() {
// 布局实现
}
.onClick(() =&gt; {
this.listTouchState = 1;
this.tabController.changeIndex(index);
})</p>
</li>
</ul>
<h4 data-id="heading-8">2.滑动Tab的切换</h4>
<p>滑动页签切换主要分为两个部分：一个是背景条的滑动，一个是页签条的滑动。</p>
<p>2.1 手势跟踪</p>
<pre><code class="hljs language-ini" lang="ini">Swiper(this.swiperController) {
  // 布局实现
}
.onGestureSwipe((index: number, event: TabsAnimationEvent) =&gt; {
  <span class="hljs-attr">this.listTouchState</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  let curOffset: <span class="hljs-attr">number</span> = event.current<span class="hljs-literal">Off</span>set<span class="hljs-comment">;</span>
  let targetIndex: <span class="hljs-attr">number</span> = index<span class="hljs-comment">;</span>
  <span class="hljs-attr">this.isReachBorder</span> = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
  // tab组件到达边界使背景条和页签条跳转到终点位置
  // TODO: 知识点: 这里不能判断到边界直接退出，因为onGestureSwipe每一帧触发回调，当手势滑动较快，上一帧背景条没有到达边界
  // TODO(接上): 知识点: 下一帧content超出边界，这时候背景条没有更新，退出将导致背景条停滞在上一帧位置无法更新。
  if ((<span class="hljs-attr">index</span> === <span class="hljs-number">0</span> &amp;&amp; cur<span class="hljs-literal">Off</span>set &gt; <span class="hljs-number">0</span>) ||
    (<span class="hljs-attr">index</span> === this.innerBarData.length - <span class="hljs-number">1</span> &amp;&amp; cur<span class="hljs-literal">Off</span>set &lt; <span class="hljs-number">0</span>)) {
    <span class="hljs-attr">this.isReachBorder</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">curOffset</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
  }

  let ratio: <span class="hljs-attr">number</span> = Math.abs(cur<span class="hljs-literal">Off</span>set / this.tabsWidth)<span class="hljs-comment">; // tab滑动比例</span>
  if (curOffset &lt; 0) { // tab右滑
    <span class="hljs-attr">targetIndex</span> = index + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  } else if (curOffset &gt; 0) { // tab左滑
    <span class="hljs-attr">targetIndex</span> = index - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
  }
  // 获取背景条位置及页签条偏移
  // 获取背景条位置及页签条偏移
  this.gestureAnimation(index, targetIndex, this.elementsInfo, ratio)<span class="hljs-comment">;</span>
})

/**
 * 手势滑动动效
 * @param index - 起始页签索引
 * @param targetIndex - 目标页签索引
 * @param elementsInfo - 页签信息<span class="hljs-section">[背景条左端位置, 页签条偏移]</span>
 * @param ratio - 当前手势滑动比例
 * @returns
 */
gestureAnimation: (index: number, targetIndex: number, elementsInfo: IndicatorAnimationInfo<span class="hljs-section">[]</span>, ratio: number) =&gt; <span class="hljs-attr">void</span> =
  (index: number, targetIndex: number, elementsInfo: IndicatorAnimationInfo<span class="hljs-section">[]</span>, ratio: number): <span class="hljs-attr">void</span> =&gt; {
    <span class="hljs-attr">this.animationAttribute.left</span> = elementsInfo[index].left + (elementsInfo[targetIndex].left - elementsInfo[index].left) * ratio<span class="hljs-comment">;</span>
    this.scroller!.scrollTo({xOffset: elementsInfo<span class="hljs-section">[index]</span>.offset + (elementsInfo<span class="hljs-section">[targetIndex]</span>.offset - elementsInfo<span class="hljs-section">[index]</span>.offset) * ratio, yOffset: 0})<span class="hljs-comment">;</span>
    let indicatorSize: <span class="hljs-section">[number, number]</span> = this.getIndicatorSize(ratio, index, targetIndex)<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.animationAttribute.indicatorBarWidth</span> = indicatorSize[<span class="hljs-number">0</span>]<span class="hljs-comment">;</span>
    <span class="hljs-attr">this.animationAttribute.indicatorBarHeight</span> = indicatorSize[<span class="hljs-number">1</span>]<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
</code></pre>
<p>具体思路： 手势跟踪滑动主要存在两种情况：1）背景条到达边界；2）背景条未到达边界。首先判断tab是否滑动到边界，若滑动到边界，则目标页签等于当前页签。否则，则根据当前的偏移情况来判断目标页签相对于当前页签的位置。然后，分别获取当前页签以及目标页签对应的背景条位置以及页签条偏移作为背景条和页签条的起始状态和最终状态。之后，可以通过计算tab滑动比例，获取当前背景条位置以及页签条偏移，公式如下所示：</p>
<p><img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtybbs/753/188/655/0030086000753188655.20241112155448.15165570652993497711761492221015:50001231000000:2800:22461A880326840156127BDF00A3EC7A1E6E8F58EC696730938CEA9FF99BB61B.jpg" alt="" loading="lazy"/></p>
<p>2.2 动画效果</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title class_">Swiper</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">swiperController</span>) {
  <span class="hljs-comment">// 布局实现</span>
}
.<span class="hljs-title function_">onContentDidScroll</span>(<span class="hljs-function">(<span class="hljs-params">selectedIndex: <span class="hljs-built_in">number</span>, index: <span class="hljs-built_in">number</span>, position: <span class="hljs-built_in">number</span>, mainAxisLength: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
  <span class="hljs-comment">// 动画启动，选取当前index索引页签的属性来执行背景条和页签条滑动</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isAnimationStart</span> &amp;&amp; index === <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerCurrnetIndex</span>) {
    <span class="hljs-comment">// 使用选中页签相对于Swiper主轴起始位置的移动比例判断滑动的目标页签targetIndex的位置</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">targetIndex</span>: <span class="hljs-built_in">number</span> = position &lt; <span class="hljs-number">0</span> ? index + <span class="hljs-number">1</span> : index - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (targetIndex &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerBarData</span>.<span class="hljs-property">length</span> || targetIndex &lt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`Error: targetIndex exceeds the limit range:
            selectedIndex: <span class="hljs-subst">${selectedIndex}</span>, curIndex: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.innerCurrnetIndex}</span>, index: <span class="hljs-subst">${index}</span>,
            targetIndex: <span class="hljs-subst">${targetIndex}</span>, position: <span class="hljs-subst">${position}</span>, mainAxisLength: <span class="hljs-subst">${mainAxisLength}</span>`</span>);
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">let</span> <span class="hljs-attr">ratio</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(position);
    <span class="hljs-comment">// 通过页签比例计算当前页签条和背景条的位置</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">autoAnimation</span>(index, targetIndex, <span class="hljs-variable language_">this</span>.<span class="hljs-property">elementsInfo</span>, ratio);
  }
})
.<span class="hljs-title function_">onAnimationStart</span>(<span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span>, targetIndex: <span class="hljs-built_in">number</span>, event: TabsAnimationEvent</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isReachBorder</span>) { <span class="hljs-comment">// 若tab到达边界，则不继续执行动画</span>
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAnimationStart</span> = <span class="hljs-literal">true</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">listTouchState</span> = <span class="hljs-number">0</span>;
})
.<span class="hljs-title function_">onAnimationEnd</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isAnimationStart</span> = <span class="hljs-literal">false</span>;
})

<span class="hljs-comment">/**
 * 自动滑动动效
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">index</span> - 起始页签索引
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">targetIndex</span> - 目标页签索引
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">elementsInfo</span> - 页签动效信息[背景条左端位置, 页签条偏移]
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">ratio</span> - 当前tab滑动比例
 * <span class="hljs-doctag">@returns</span>
 */</span>
<span class="hljs-attr">autoAnimation</span>: <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span>, targetIndex: <span class="hljs-built_in">number</span>, elementsInfo: IndicatorAnimationInfo[], ratio: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> =
  (<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">targetIndex</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">elementsInfo</span>: <span class="hljs-title class_">IndicatorAnimationInfo</span>[], <span class="hljs-attr">ratio</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationAttribute</span>.<span class="hljs-property">left</span> = elementsInfo[index].<span class="hljs-property">left</span> + (elementsInfo[targetIndex].<span class="hljs-property">left</span> - elementsInfo[index].<span class="hljs-property">left</span>) * ratio;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>!.<span class="hljs-title function_">scrollTo</span>({
      <span class="hljs-attr">xOffset</span>: elementsInfo[index].<span class="hljs-property">offset</span> + (elementsInfo[targetIndex].<span class="hljs-property">offset</span> - elementsInfo[index].<span class="hljs-property">offset</span>) * ratio,
      <span class="hljs-attr">yOffset</span>: <span class="hljs-number">0</span>
    });
    <span class="hljs-keyword">let</span> <span class="hljs-attr">indicatorSize</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getIndicatorSize</span>(ratio, index, targetIndex);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationAttribute</span>.<span class="hljs-property">indicatorBarWidth</span> = indicatorSize[<span class="hljs-number">0</span>];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationAttribute</span>.<span class="hljs-property">indicatorBarHeight</span> = indicatorSize[<span class="hljs-number">1</span>];
  };
</code></pre>
<p>具体思路：首先在动画开始时，我们在onAnimationStart回调中只进行动画开始状态的改变(i.e. this.isAnimationStart = true)。然后，在onContentDidScroll回调中进行绘制动画。具体来说，在每一次回调onContentDidScroll接口时通过起始页签index、目标页签targetIndex以及滑动比例来判断当前背景条位置以及页签条的偏移，如公式(1)所示。 因此，动画函数中最重要的就是判断index、targetIndex以及滑动比例。由于页签条的滑动等价于背景条滑动，因此我们只需要判断背景条的滑动情况就可以覆盖所有情况。如下图所示，这里主要存在以下三种情况的判断：1）背景条未回弹且滑动比例小于0.5；2）背景条未回弹且滑动比例大于等于0.5；3）背景条回弹。</p>
<ul>
<li>背景条未回弹且滑动比例小于0.5。这时候起始页签index应该等于curIndex，而目标页签targetIndex则可以根据滑动比例正负判断index+1(index-1)。当tab不断向左(右)滑动时，index页签滑动比例不断增加，背景条也不断向右(左)滑动。 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3693165cd984404295011fb4de0ffe27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=4xHk9CWH7Tar50Zlm05Zj4G4PEg%3D" alt="" loading="lazy"/></li>
<li>背景条回弹。这时候起始页签应该等于curIndex，而目标页签targetIndex则可以根据滑动比例正负判断index+1(index-1)。当tab回弹时，index页签滑动比例不断减少，背景条也不断向左(右)滑动，直至回弹到原位置。 <img src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtybbs/753/188/655/0030086000753188655.20241112155556.18668753938282901278375408321859:50001231000000:2800:7048F42A46AF7BA65E56C5ABE532B5457FE4FCB49ED8DF1ED2A078A30E01F14C.jpg" alt="" loading="lazy"/></li>
<li>背景条未回弹且滑动比例大于等于0.5。这时候目标页签应该等于curIndex，起始页签index应该则可以根据滑动比例正负判断targetIndex+1(targetIndex-1)。但是，仔细观察我们可以发现，其实这种情况与背景条回弹情况基本一致。可以将其看作是黄色页签开始向左滑动，也可以将其看作是绿色页签开始进行回弹。因此，我们可以将其转化为绿色页签回弹，如后续第二张图所示。这时候起始页签应该等于curIndex，而目标页签targetIndex则可以根据滑动比例正负判断index+1(index-1)。当index页签内容回弹时，tab滑动比例不断减少，背景条也不断向右(左)滑动，直至回弹到原位置。 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74b6b5751fb34eed9b495448648ee49c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=fXRxHGZUbA2DDY2lUJOEZiAYKoU%3D" alt="" loading="lazy"/> <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fc86ebc4f774132b3f365384c596d6b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=F54KlZY3mB%2BnS%2B5tp7ThVDe9sL4%3D" alt="" loading="lazy"/></li>
</ul>
<h3 data-id="heading-9">总结</h3>
<p>本示例使用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fts-rendering-control-lazyforeach-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-rendering-control-lazyforeach-V5" ref="nofollow noopener noreferrer">LazyForEach</a>进行数据懒加载，LazyForEach懒加载可以通过设置cachedCount属性来指定缓存数量，同时搭配<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fbest-practices-V5%2Fbpta-component-reuse-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-component-reuse-V5" ref="nofollow noopener noreferrer">组件复用</a>能力以达到性能最优效果。</p>
<h4 data-id="heading-10">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-11">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a7ba13e43043c8b42062f8c1f2df5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623716&amp;x-signature=Rjwce9Q%2FlqrthiP0BhulqN1mazE%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOS应用开发：状态栏动画实现]]></title>    <link>https://juejin.cn/post/7589172193150386212</link>    <guid>https://juejin.cn/post/7589172193150386212</guid>    <pubDate>2025-12-29T14:38:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589172193150386212" data-draft-id="7589172193150369828" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOS应用开发：状态栏动画实现"/> <meta itemprop="keywords" content="HarmonyOS,程序员,Android"/> <meta itemprop="datePublished" content="2025-12-29T14:38:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹿人戛"/> <meta itemprop="url" content="https://juejin.cn/user/4309685005226376"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOS应用开发：状态栏动画实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4309685005226376/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹿人戛
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:38:18.000Z" title="Mon Dec 29 2025 14:38:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">前言</h3>
<p>本案例展示了状态栏的动态交互效果。通过监听页面滚动事件 <code>onDidScroll</code>，随着页面的上下滚动，实现状态栏颜色的变化。搜索框会在滚动时流畅地展开或收起，并伴有自然的透明度过渡效果。</p>
<h3 data-id="heading-1">效果图预览</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3064042edec1412ea719171e33071a4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623898&amp;x-signature=KyMi6HGBLfyLqFqwm1pqVlnuTjQ%3D" alt="" loading="lazy"/></p>
<p><strong>使用说明</strong></p>
<ol>
<li>进入页面开始加载，加载完成后显示整个界面,上下滚动页面即可。</li>
</ol>
<h3 data-id="heading-2">实现思路</h3>
<ul>
<li>
<p><strong>初始化和状态设置</strong><br/>
在 <code>aboutToAppear()</code> 方法中，初始化了窗口模型 <code>windowModel</code>。启用沉浸式（设置全屏显示和状态栏为白色），获取状态栏高度存储在 <code>statusBarHeight</code> 变量中，从预定义的数据源 <code>LIST_DATA</code> 加载数据到 <code>dataSource</code>中。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">aboutToAppear(): void {
  <span class="hljs-comment">// 初始化窗口管理model</span>
  <span class="hljs-keyword">const</span> windowStage: window.WindowStage | undefined = AppStorage.<span class="hljs-keyword">get</span>(<span class="hljs-string">'windowStage'</span>);
  <span class="hljs-comment">// 没有windowStage将无法执行下列逻辑</span>
  <span class="hljs-keyword">if</span> (!windowStage) {
    logger.error(TAG, <span class="hljs-string">'windowStage init error!'</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">this</span>.windowModel.setWindowStage(windowStage);
  <span class="hljs-comment">// 设置沉浸模式及状态栏白色</span>
  <span class="hljs-keyword">this</span>.windowModel.setImmersive();
  <span class="hljs-comment">// 获取顶部状态栏高度</span>
  <span class="hljs-keyword">this</span>.windowModel.getStatusBarHeight((statusBarHeight) =&gt; {
    logger.info(TAG, <span class="hljs-string">'statusBarHeight is '</span> + statusBarHeight);
    <span class="hljs-keyword">this</span>.statusBarHeight = px2vp(statusBarHeight);
  })
  <span class="hljs-comment">// 组装数据源</span>
  <span class="hljs-keyword">this</span>.dataSource.pushArrayData(LIST_DATA)
}
</code></pre>
</li>
<li>
<p><strong>界面布局构造</strong><br/>
使用Stack控件使状态栏与列表重叠，并为列表添加滚动监听器，以根据滚动位置调整状态栏和导航栏的透明度及展开收起动效。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">Stack</span>({ alignContent: Alignment.Top }) {
  <span class="hljs-built_in">Row</span>() {
    <span class="hljs-comment">// 动态显示回顶部或位置天气控件</span>
    if (this.isFlow) {
      this<span class="hljs-selector-class">.topUpBuilder</span>()
    } else {
      this<span class="hljs-selector-class">.locationAndWeatherBuilder</span>()
    }
    this<span class="hljs-selector-class">.searchViewBuilder</span>()
    this<span class="hljs-selector-class">.toolViewBuilder</span>()
  }
  <span class="hljs-selector-class">.height</span>(Constants.NAVIGATION_BAR_HEIGHT + this.statusBarHeight)
    <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
    <span class="hljs-selector-class">.padding</span>({
      top: this.statusBarHeight
    })
    <span class="hljs-selector-class">.zIndex</span>(Constants.Z_INDEX_THREE)

  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点：父组件的透明度Opacity影响子组件（如父类Opacity为0.5，若子组件为0.5时，子组件实际Opacity = 0.5*0.5）,此处Row来改变状态栏的透明度不受影响其它组件透明度</span>
  <span class="hljs-built_in">Row</span>() {
  }
  <span class="hljs-selector-class">.backgroundColor</span>($r("app.color.status_bar_animation_white"))
    <span class="hljs-selector-class">.opacity</span>(this.navigateBarOpacity)
    <span class="hljs-selector-class">.height</span>(Constants.STATUS_BAR_HEIGHT + this.statusBarHeight)
    <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
    <span class="hljs-selector-class">.zIndex</span>(Constants.Z_INDEX_TWO)

  <span class="hljs-built_in">List</span>({ scroller: this.scroller }) {
    <span class="hljs-comment">// ...</span>
  }
  <span class="hljs-comment">// 隐藏滚动条</span>
  <span class="hljs-selector-class">.scrollBar</span>(BarState.Off)
    <span class="hljs-comment">// 渐变蓝色背景色</span>
    <span class="hljs-selector-class">.linearGradient</span>({
      colors: [[Constants.LIST_LINEAR_GRADIENT_START_COLOR, Constants.LIST_LINEAR_GRADIENT_START],
        [Constants.LIST_LINEAR_GRADIENT_END_COLOR, Constants.LIST_LINEAR_GRADIENT_END]]
    })
    <span class="hljs-selector-class">.height</span>(Constants.FULL_PERCENT)
    <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
}
<span class="hljs-selector-class">.zIndex</span>(Constants.Z_INDEX_ONE)
  <span class="hljs-selector-class">.height</span>(Constants.FULL_PERCENT)
  <span class="hljs-selector-class">.width</span>(Constants.FULL_PERCENT)
    <span class="hljs-comment">// 扩展至所有非安全区域</span>
  <span class="hljs-selector-class">.expandSafeArea</span>([SafeAreaType.SYSTEM], [SafeAreaEdge.BOTTOM])
</code></pre>
</li>
<li>
<p><strong>滚动事件处理</strong><br/>
通过监听页面滚动事件 <code>onDidScroll</code>，根据当前的滚动偏移量 yOffset 调整状态栏和导航栏的透明度。如果滚动超过了设定的阈值，则改变状态栏的颜色和展开收起动画。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.onDidScroll(() =&gt; {
  <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> 知识点：通过currentOffset来获取偏移量比较准确。</span>
  <span class="hljs-keyword">const</span> yOffset: number = <span class="hljs-keyword">this</span>.scroller.currentOffset().yOffset;
  yOffset &lt;= Constants.MAIN_SCROLLER_OFFSET_Y_ZERO ? <span class="hljs-keyword">this</span>.negativeOffsetY = yOffset :
  Constants.MAIN_SCROLLER_OFFSET_Y_ZERO;
  <span class="hljs-comment">// 判断导航栏和状态栏背景透明度变化</span>
  yOffset &gt;= Constants.MAIN_SCROLLER_OFFSET_Y_MAX + <span class="hljs-keyword">this</span>.statusBarHeight ?
    <span class="hljs-keyword">this</span>.navigateBarOpacity = Constants.NAVIGATION_BAR_OPACITY_MAX :
    <span class="hljs-keyword">this</span>.navigateBarOpacity = Constants.NAVIGATION_BAR_OPACITY_MIN;
  <span class="hljs-keyword">this</span>.navigateBarOpacity = yOffset / Constants.MAIN_SCROLLER_OFFSET_Y_MAX;
  <span class="hljs-comment">// 判断当前的导航栏和图标颜色变化</span>
  yOffset &gt; <span class="hljs-keyword">this</span>.statusBarHeight ?
    <span class="hljs-keyword">this</span>.isWhiteColor = <span class="hljs-literal">false</span> : <span class="hljs-keyword">this</span>.isWhiteColor = <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// 判断状态栏字体颜色变化</span>
  yOffset &gt; <span class="hljs-keyword">this</span>.statusBarHeight ?
  <span class="hljs-keyword">this</span>.windowModel.setSystemBarContentColor(Constants.StatusBarContentBlackColor) :
  <span class="hljs-keyword">this</span>.windowModel.setSystemBarContentColor(Constants.StatusBarContentWhiteColor);
  <span class="hljs-comment">// 判断导航栏动效变化</span>
  yOffset &gt;= <span class="hljs-keyword">this</span>.statusBarHeight + Constants.MAIN_SCROLLER_OFFSET_STATUS_CHANGE ?
    <span class="hljs-keyword">this</span>.isFlow = <span class="hljs-literal">true</span> : <span class="hljs-keyword">this</span>.isFlow = <span class="hljs-literal">false</span>;
})
</code></pre>
</li>
</ul>
<h3 data-id="heading-3">总结</h3>
<p>本示例使用了<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fharmonyos-references-V5%2Fts-rendering-control-lazyforeach-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/ts-rendering-control-lazyforeach-V5" ref="nofollow noopener noreferrer">LazyForEach</a>进行数据懒加载，LazyForEach懒加载可以通过设置cachedCount属性来指定缓存数量，同时搭配<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Fdoc%2Fbest-practices-V5%2Fbpta-component-reuse-V5" target="_blank" title="https://developer.huawei.com/consumer/cn/doc/best-practices-V5/bpta-component-reuse-V5" ref="nofollow noopener noreferrer">组件复用</a>能力以达到性能最优效果。</p>
<h4 data-id="heading-4">如果您想系统深入地学习 HarmonyOS 开发或想考取HarmonyOS认证证书，欢迎加入华为开发者学堂：</h4>
<h3 data-id="heading-5">请点击→： <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.huawei.com%2Fconsumer%2Fcn%2Ftraining%2FclassDetail%2Fd0d15d9039414a8fad9f99ac4a3f5096%3Ftype%3D1%253Fha_source%253Dhmosclass%26ha_sourceId%3D89000248" target="_blank" title="https://developer.huawei.com/consumer/cn/training/classDetail/d0d15d9039414a8fad9f99ac4a3f5096?type=1%3Fha_source%3Dhmosclass&amp;ha_sourceId=89000248" ref="nofollow noopener noreferrer">HarmonyOS官方认证培训</a></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d55a567a43d2464eba118ff249eb75db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6bm_5Lq65oib:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767623898&amp;x-signature=mUGp%2FgSDfDrDFk2Gj8P10%2B6AnFQ%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🦾 可为与不可为：CDP 视角下的 Browser 控制边界]]></title>    <link>https://juejin.cn/post/7589104492883361844</link>    <guid>https://juejin.cn/post/7589104492883361844</guid>    <pubDate>2025-12-29T14:54:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589104492883361844" data-draft-id="7589074117645008931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🦾 可为与不可为：CDP 视角下的 Browser 控制边界"/> <meta itemprop="keywords" content="前端,浏览器,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T14:54:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="卤代烃"/> <meta itemprop="url" content="https://juejin.cn/user/43636193770071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🦾 可为与不可为：CDP 视角下的 Browser 控制边界
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/43636193770071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    卤代烃
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T14:54:01.000Z" title="Mon Dec 29 2025 14:54:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果我们把人类对电脑的所有操作记为全集，那么 Browser, CDP 和 puppeteer 可操作的集合范畴如下：</p>
<ul>
<li><strong>Computer</strong>：所有操作的全集</li>
<li><strong>Browser</strong>：App 层权限，Browser 为了安全，还限制了许多能力，比如说直接操作本地的文件</li>
<li><strong>CDP</strong>：专注于 Debug 能力，浏览器的非调试信息（比如说收藏网页）是没有权限访问的</li>
<li><strong>puppeteer</strong>：基于 CDP 构建，但是有一部分 CDP API 并没有用到，所以能力属于 CDP 的子集</li>
</ul>
<p>在 Browser-Use 场景，不同于 VNC 这种更为通用的投屏方案，CDP 是有能力边界的，所以说知道它擅长什么不擅长什么，对于架构的整体设计和未来演化方向有很大的意义。</p>
<p>下面主要是从浏览器角度出发，列出 CDP(puppeteer) 可以做到的事情，支持难度分类如下：</p>
<ul>
<li><strong>直接支持</strong>：pptr 有封装好的现成的 API</li>
<li><strong>间接支持</strong>：需要组合多个 pptr API/CDP API 实现相关功能</li>
<li><strong>不能支持</strong>：CDP 完全做不到的事情</li>
</ul>
<br/>
<h2 data-id="heading-0">一、浏览器功能</h2>
<p>这部分主要指浏览器级别的全局功能。包括 tabs 管理，页面导航等功能。</p>
<h3 data-id="heading-1">Tabs</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.browser.newpage" target="_blank" title="https://pptr.dev/api/puppeteer.browser.newpage" ref="nofollow noopener noreferrer">Browser.newPage()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.browser.pages" target="_blank" title="https://pptr.dev/api/puppeteer.browser.pages" ref="nofollow noopener noreferrer">Browser.pages()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.bringtofront" target="_blank" title="https://pptr.dev/api/puppeteer.page.bringtofront" ref="nofollow noopener noreferrer">Page.bringToFront()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.close" target="_blank" title="https://pptr.dev/api/puppeteer.page.close" ref="nofollow noopener noreferrer">Page.close()</a></li>
</ul>
<p>Tabs（标签页）是非常重要的一个功能，CDP 的 tabs 相关 API 能力比较弱，puppeteer 也没有做相关的抽象和封装。这就导致想实现 tab 的「新建/更新/切换/关闭」这 4 个基础的功能需要组合多个 CDP API 间接实现。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/988655731ff646f0918fdd525c9b682c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=5d6vUVN6XnKn6kKJyidHA8G5boM%3D" alt="tabs" loading="lazy"/> <br/></p>
<p>还有个问题如果 Tabs 被人拖拽改变了显示顺序，这部分改变 CDP 是无法感知的。比如说上面图的 tabs 是拖拽过的，但是 CDP 直接拿到的顺序是：<code>历史记录，百度一下，你就知道，今日头条</code>，不过这种问题可以忽略。</p>
<h3 data-id="heading-2">Navigate</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goback" target="_blank" title="https://pptr.dev/api/puppeteer.page.goback" ref="nofollow noopener noreferrer">Page.goBack()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goforward" target="_blank" title="https://pptr.dev/api/puppeteer.page.goforward" ref="nofollow noopener noreferrer">Page.goForward()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.reload" target="_blank" title="https://pptr.dev/api/puppeteer.page.reload" ref="nofollow noopener noreferrer">Page.reload()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goto" target="_blank" title="https://pptr.dev/api/puppeteer.page.goto" ref="nofollow noopener noreferrer">Page.goto()</a></li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/deee411a2b424a2e9feea9b76f71462e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=0gtaBWhY05NnUfnLn7kbURQkpGI%3D" alt="navigate" loading="lazy"/>
Navigate 主要是 Tab 内部导航，包括 back/forward/refresh/goto 4 个最基础的功能。</p>
<p>这部分功能 puppeteer 基于 CDP 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23method-getNavigationHistory" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-getNavigationHistory" ref="nofollow noopener noreferrer">Page.getNavigationHistory</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23method-navigateToHistoryEntry" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-navigateToHistoryEntry" ref="nofollow noopener noreferrer">Page.navigateToHistoryEntry</a> API 做了良好的封装，基本上可以直接拿来使用。</p>
<p>但值得注意的是输入框的联想记录是无法通过 CDP 获取：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc74c7bb13b8419a87eb5f108547986c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=xd3azh2%2Bln%2FnTaiJ%2BGSzXl5M6I4%3D" alt="search" loading="lazy"/></p>
<h3 data-id="heading-3">扩展程序（浏览器插件）</h3>
<ul>
<li><strong>必要性</strong>：中</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fguides%2Fchrome-extensions" target="_blank" title="https://pptr.dev/guides/chrome-extensions" ref="nofollow noopener noreferrer">Chrome Extensions</a></li>
</ul>
<p>可以初始化 browser 的时候就通过 pptr API 直接注入插件。插件能力还是比较重要的，比如说 ad-block，可以屏蔽一些广告的 DOM，让网页更干净，方便模型去定位。</p>
<h3 data-id="heading-4">内部设置页</h3>
<ul>
<li><strong>必要性</strong>：中</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.goto" target="_blank" title="https://pptr.dev/api/puppeteer.page.goto" ref="nofollow noopener noreferrer">Page.goto()</a></li>
</ul>
<p>内部设置页我这里定义为 <code>chrome://</code> 协议开头的页面，比如说 <code>chrome://history/</code> 就是浏览器的历史记录页。这些设置页其实都是以网页为载体的，所以都能被 CDP 捕获到，这些页面有很多，比如还有 <code>chrome://downloads/</code> <code>chrome://extensions/</code> 等。</p>
<p>换句话说，我们只要知道设置页面的 URI 就可以直接 navigate 过去，这个看整体的诉求，可按需支持。</p>













<table><thead><tr><th align="center">History Page</th><th align="center">History Page Screenshot</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a8f9d8fb994415584db3acc0f4cecf9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=ox05ZiNt4YU07opPTFlIrb3e0a4%3D" alt="history-page" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60a5b438f153456b8cd5dd0d89f11589~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=GR%2BKt2zincUxRZIX3hrIWuUc3qM%3D" alt="history-page-screenshot" loading="lazy"/></td></tr></tbody></table>
<h3 data-id="heading-5">设置菜单</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：不支持</li>
</ul>
<p>CDP 无法感知，但这种二级菜单三级菜单入口也比较深，主动改动的情况比较少见，而且其导航到的都是 <code>chrome://</code> 协议开头的内置网页，拿到对应的 URI 后都可以直接 navigate 过去。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bba98d4c2e8040df8c870fb90b7a4c16~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=gKb%2Fn48G1ImxqExTPyt2QJuevf4%3D" alt="list" loading="lazy"/></p>
<h3 data-id="heading-6">其它 App 级功能</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：不支持</li>
</ul>
<p>除了上面常见的功能，还有一些较为冷门，或者说不会影响浏览网页主流程的 App 级功能。比如说：</p>
<ul>
<li>登录 Google 账号的弹窗</li>
<li>标签页分组</li>
<li>阅读模式/阅读清单</li>
<li>......</li>
</ul>
<p>这些都是有可以增强浏览体验，没有也没啥问题的功能。在 AI 场景上，永远是越简单的越健壮，所以这些甜品功能也没必要支持。</p>

























<table><thead><tr><th align="center">登录弹窗</th><th align="center">标签页分组</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b32d9ceef7948689581f8e7b2c7a2e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=UMBf2NAGcFnbmVwNHGMpN3USDTw%3D" alt="login" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd1785be866546b59f3bd5686a3bef0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=aCdksbhyTp714pc71dlIB0Qq3MY%3D" alt="group" loading="lazy"/></td></tr><tr><td align="center"/><td align="center"/></tr><tr><td align="center"><strong>阅读模式</strong></td><td align="center"><strong>阅读清单</strong></td></tr><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e94d41dd8be45eeb3ff4c2b435aaf5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=k87x2fo1vhRSy7%2F0hQFPl1Nc18I%3D" alt="read-mode" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f80ffea549c94717b0d93b8e84ab16cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=ik5pvLKhN5%2BLYPpXWHh4Ant1bTk%3D" alt="read-list" loading="lazy"/></td></tr></tbody></table>
<br/>
<h2 data-id="heading-7">二、快捷键</h2>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.keyboard" target="_blank" title="https://pptr.dev/api/puppeteer.keyboard" ref="nofollow noopener noreferrer">Keyboard class</a></li>
</ul>
<p>快捷键是一个较为复杂的问题。</p>
<p>几大操作系统发展了几十年，虽然用的都是同一款键盘，但在快捷键上加入了一堆自己的小心思，所以各操作系统的快捷键本身就有很高的复杂度；CDP 场景下的快捷键，在 macOS 下也需要单独的适配。下面我就这两个方向展开说说。</p>
<h3 data-id="heading-8">跨平台角度</h3>
<p>跨平台角度看，Windows 和 Linux 的常用快捷键还是比较统一的，但是 macOS 就比较特殊。</p>
<p>首先是对于大部份常用快捷键（全选/复制/黏贴 等），在 Mac 上使用的装饰键是 Command（即 <code>Meta</code> 键），但在 Windows/Linux 上为 Ctrl（即 <code>Control</code> 键）。</p>
<p>所以当 LLM 发出一个快捷键的 action 指令时，比如说「全选」快捷键，在工程这端需要做一下兜底，先判断当前运行环境的具体 OS，然后需要把 action 指令做修改以让指令正确的执行：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-title function_">hotkey</span>(<span class="hljs-string">"ctrl+A"</span>) --&gt; isMacOS? --- <span class="hljs-literal">true</span> ---&gt; <span class="hljs-title function_">keyboard</span>(<span class="hljs-string">'Meta+KeyA'</span>)
                         └------- <span class="hljs-literal">false</span> --&gt; <span class="hljs-title function_">keyboard</span>(<span class="hljs-string">'Control+KeyA'</span>)
</code></pre>
<p>除了这类常见的快捷键，其实还有很多的情况需要去适配。比如说：</p>
<ul>
<li>查看浏览器历史记录：macOS 是 <code>Command+Y</code>，Linux 和 Windows 是 <code>Ctrl+H</code></li>
<li>退出浏览器：macOS 是 <code>Command+Q</code>，Linux 和 Windows 是 <code>Alt+F</code>，然后按 <code>X</code> 键</li>
<li>导航到上个页面：macOS 是 <code>Command+[</code>，Linux 和 Windows 是 <code>Alt+LeftArrow</code></li>
<li>......</li>
</ul>
<br/>
<p>相关的快捷键可以参考官方给的规范：</p>

























<table><thead><tr><th align="left">平台</th><th align="left">支持的快捷键</th></tr></thead><tbody><tr><td align="left">macOS</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.apple.com%2Fzh-cn%2F102650" target="_blank" title="https://support.apple.com/zh-cn/102650" ref="nofollow noopener noreferrer">support.apple.com/zh-cn/10265…</a></td></tr><tr><td align="left">Windows</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.microsoft.com%2Fen-us%2Fwindows%2Fkeyboard-shortcuts-in-windows-dcc61a57-8ff0-cffe-9796-cb9706c75eec" target="_blank" title="https://support.microsoft.com/en-us/windows/keyboard-shortcuts-in-windows-dcc61a57-8ff0-cffe-9796-cb9706c75eec" ref="nofollow noopener noreferrer">support.microsoft.com/en-us/windo…</a></td></tr><tr><td align="left">Linux GNOME</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.gnome.org%2Fusers%2Fgnome-help%2Fstable%2Fshell-keyboard-shortcuts.html.en" target="_blank" title="https://help.gnome.org/users/gnome-help/stable/shell-keyboard-shortcuts.html.en" ref="nofollow noopener noreferrer">help.gnome.org/users/gnome…</a></td></tr><tr><td align="left">Chrome</td><td align="left"><a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.google.com%2Fchrome%2Fanswer%2F157179%3Fhl%3Dzh-Hans%26co%3DGENIE.Platform%253DDesktop" target="_blank" title="https://support.google.com/chrome/answer/157179?hl=zh-Hans&amp;co=GENIE.Platform%3DDesktop" ref="nofollow noopener noreferrer">support.google.com/chrome/answ…</a></td></tr></tbody></table>
<p>这些都很繁琐，除了交给 AI 来写，最好的方式还是只提供基础的适配，然后遇到啥修啥，要不然就是个无底洞。</p>
<h3 data-id="heading-9">CDP 角度</h3>
<p>CDP 因为权限问题，通过它发送的键盘指令，并不是真正的系统键盘指令，可以简单理解为作用域限制在 Chrome 和 Page 内部。而且，我们的 macOS <strong>又出幺蛾子了</strong>。</p>
<p>首先说最基础的「全选」快捷键。在 macOS 上如果你直接发送 <code>Meta+KeyA</code>，你会发现根本不会执行全选操作。</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">down</span>(<span class="hljs-string">"Meta"</span>);
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">down</span>(<span class="hljs-string">"KeyA"</span>);
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">up</span>(<span class="hljs-string">"KeyA"</span>);
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">up</span>(<span class="hljs-string">"Meta"</span>); <span class="hljs-comment">// not working in macOS</span>
</code></pre>
<p>具体原因比较复杂，可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpuppeteer%2Fpuppeteer%2Fissues%2F776" target="_blank" title="https://github.com/puppeteer/puppeteer/issues/776" ref="nofollow noopener noreferrer">#776</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpuppeteer%2Fpuppeteer%2Fissues%2F1313" target="_blank" title="https://github.com/puppeteer/puppeteer/issues/1313" ref="nofollow noopener noreferrer">#1313</a>，核心原因如下：</p>
<blockquote>
<p>The first bug here is that we <strong>don't</strong> send nativeKeyCodes, so no real OSX events get made. When sending the nativeKeyCodes, "a" is keyCode 0 and protocol decides not to send a falsey keyCode. After these are fixed, OSX <strong>doesn't</strong> like to perform keyboard shortcuts unless the application has the foreground. And lastly, if Chromium has the foreground, we send the nativeKeyCode, and protocol processes it, the shortcut gets captured by the address bar <strong>instead of</strong> the page.</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpuppeteer%2Fpuppeteer%2Fissues%2F776%23issuecomment-329589760" target="_blank" title="https://github.com/puppeteer/puppeteer/issues/776#issuecomment-329589760" ref="nofollow noopener noreferrer">github.com/puppeteer/p…</a></p>
</blockquote>
<p>可以看到回复在 2017 年，快 10 年了这个问题其实还存在。</p>
<br/>
<p>不过好在对于「全选/复制/粘贴」这些常见的快捷键，CDP 有些别的曲线救国方案。CDP 发送键盘指令的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FInput%2F%23method-dispatchKeyEvent" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Input/#method-dispatchKeyEvent" ref="nofollow noopener noreferrer">Input.dispatchKeyEvent</a>，有个额外的 commands 指令，上面有一些<a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.chromium.org%2Fchromium%2Fchromium%2Fsrc%2F%2B%2Fmain%3Athird_party%2Fblink%2Frenderer%2Fcore%2Fediting%2Fcommands%2Feditor_command_names.h" target="_blank" title="https://source.chromium.org/chromium/chromium/src/+/main:third_party/blink/renderer/core/editing/commands/editor_command_names.h" ref="nofollow noopener noreferrer">编辑指令</a>可以触发相关的操作，比如说我想执行「全选」操作，我就可以这样写：</p>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">down</span>(<span class="hljs-string">"KeyA"</span>, { <span class="hljs-attr">commands</span>: [<span class="hljs-string">"SelectAll"</span>] });
<span class="hljs-keyword">await</span> page.<span class="hljs-property">keyboard</span>.<span class="hljs-title function_">up</span>(<span class="hljs-string">"KeyA"</span>); <span class="hljs-comment">// working in macOS</span>
</code></pre>
<p>这样下面这些常见的编辑类快捷键就可以支持了：</p>















































<table><thead><tr><th align="left">操作</th><th align="left">macOS</th><th align="left">Windows/Linux</th><th align="left">CDP commands</th></tr></thead><tbody><tr><td align="left">复制</td><td align="left">Command + C</td><td align="left">Ctrl + C</td><td align="left">Copy</td></tr><tr><td align="left">粘贴</td><td align="left">Command + V</td><td align="left">Ctrl + V</td><td align="left">Paste</td></tr><tr><td align="left">剪切</td><td align="left">Command + X</td><td align="left">Ctrl + X</td><td align="left">Cut</td></tr><tr><td align="left">撤销</td><td align="left">Command + Z</td><td align="left">Ctrl + Z</td><td align="left">Undo</td></tr><tr><td align="left">恢复</td><td align="left">Shift + Command + Z</td><td align="left">Ctrl + Y</td><td align="left">Redo</td></tr><tr><td align="left">全选</td><td align="left">Command + A</td><td align="left">Ctrl + A</td><td align="left">SelectAll</td></tr></tbody></table>
<p>对于一些其他的权限较高的快捷键，我们可以可以做好<strong>功能映射</strong>：</p>
<ul>
<li>查看浏览器历史记录：<code>Page.goto('chrome://history/')</code></li>
<li>退出浏览器：<code>Browser.close()</code></li>
<li>导航到上个页面：<code>Page.goBack()</code></li>
<li>......</li>
</ul>
<p>当然这些也最好按需添加，全适配意义不大。</p>
<h2 data-id="heading-10">三、网页功能</h2>
<p>主要指对网页本身的做的操作，影响范围主要为当前网页，有截图，文件上传下载等功能。</p>
<h3 data-id="heading-11">截图</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：直接支持</li>
</ul>
<p>CDP 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23method-captureScreenshot" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#method-captureScreenshot" ref="nofollow noopener noreferrer">Page.captureScreenshot</a> API 可以直接对网页内容本身做截图。但需要注意的是，CDP 截图只能截到网页本身（也就是<strong>绿框</strong>内的内容），外部的 Chrome UI 是截图不到的。</p>
<p>所以这里需要格外注意，部分 VLM 模型在训练阶段是用的完整的 Chrome 截图（<strong>红框</strong>内的内容），如果泛化能力一般，直接把 CDP 截图传给 VLM，可能会有 action 坐标错位的问题。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88fd4ee521ac40e4863398ecb2480ae4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=hurB%2F4xWcGnZJPy0ELZDesplZes%3D" alt="screenshot" loading="lazy"/></p>
<h3 data-id="heading-12">基础交互</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.keyboard" target="_blank" title="https://pptr.dev/api/puppeteer.keyboard" ref="nofollow noopener noreferrer">Keyboard class</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.mouse" target="_blank" title="https://pptr.dev/api/puppeteer.mouse" ref="nofollow noopener noreferrer">Mouse class</a></li>
</ul>
<p>这里的基础操作主要是指 click，drag，keyboard 等行为，这些 puppeteer 做好了原子方法，可以直接组合使用。而且 pptr 也提供了各种 DOM 回调去执行相关的 action 操作，还是非常灵活的。这里推荐直接看 pptr 的文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fguides%2Fpage-interactions" target="_blank" title="https://pptr.dev/guides/page-interactions" ref="nofollow noopener noreferrer">pptr: Page Interactions</a>，还是描述的比较清晰的。</p>
<h3 data-id="heading-13">Dialog 弹窗</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.dialog" target="_blank" title="https://pptr.dev/api/puppeteer.dialog" ref="nofollow noopener noreferrer">Dialog class</a></li>
</ul>
<p>CDP 可以直接感知到弹窗的相关事件（例如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fchromedevtools.github.io%2Fdevtools-protocol%2Ftot%2FPage%2F%23event-javascriptDialogOpening" target="_blank" title="https://chromedevtools.github.io/devtools-protocol/tot/Page/#event-javascriptDialogOpening" ref="nofollow noopener noreferrer">Page.javascriptDialogOpening</a>），所以下方的 4 类弹窗的触发都是可以感知到的：</p>

























<table><thead><tr><th align="center">Alert</th><th align="center">Confirm</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/788f0c6f8b08442b95aaf9fa285d6286~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=8ZVIfpe8gltj%2BNY5LHMSRn01bIk%3D" alt="alert" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7756ccddb98a4aaaa1f93dd4ad4129b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=AO%2Bc35UogxxKMwCK%2B2xYLDUaK78%3D" alt="confirm" loading="lazy"/></td></tr><tr><td align="center"/><td align="center"/></tr><tr><td align="center"><strong>Prompt</strong></td><td align="center"><strong>Beforeunload</strong></td></tr><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99683d862e5041b0ac10e3a8c90275fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=4mL74OUXD0rYmPKLbQvvRdCirOg%3D" alt="dialog" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e80538eb60e45bc8c49ed97bcc1ada1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=wYxbcVaBCI5KHPF216B91sP4Gm8%3D" alt="beforeunload" loading="lazy"/></td></tr></tbody></table>
<p>因为弹窗是一个优先级很高的浏览器行为，它一旦唤起基本会中断网页的所有行为，JS 引擎也会挂起停止响应，所以必须得响应关闭弹窗才能执行后续流程，综合来看是一个非常高优的功能。</p>
<h3 data-id="heading-14">右键菜单</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：间接支持</li>
</ul>
<p>CDP 无法感知到在页面内点击「鼠标右键」后触发的 <strong>系统菜单</strong> 本身：</p>

















<table><thead><tr><th align="center">Page</th><th align="center">Image</th><th align="center">Link</th><th align="center">Tab</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e419a8672174c0a94d2b4577120f5c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=xAlFVAFERBJbhP6W0WRKn1k8xY8%3D" alt="page-right-button" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/836f1cd5f8c14d10989058b8b9c41e96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=LAMzm6eVrSH%2FxRQzmcPTzilSGaE%3D" alt="link-right-button" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9fb1b77f91884b558f3c7f40d6c5f866~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=yQHePd9sQmAdgIxxnDWxCoj4Kvw%3D" alt="17-cdp-do-image-right-button" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3268737522fa4657b6976a71fbf35ded~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=fPBL4wAjHhMGMJ5P9q%2FiAjmhviY%3D" alt="tab-right-button" loading="lazy"/></td></tr></tbody></table>
<p>但系统弹窗内的功能基本可以通过其他方式实现，比如说「返回/前进/重新加载」等功能都可以用一些 Navigate 的方法做平替。但就目前的用户诉求看，这部分功能的必要性并不高。</p>
<p>对于网页内<strong>自定义的右键菜单</strong>，因为基本都是 DOM 绘制的，其实可以通过网页内截图感知到的，例如下图中 bilibili 播放器的右键 DOM 菜单就可以被 CDP 截图捕获：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f732a14834f435b96e550cf16e2aa3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=aXZ86hvjDKyjFWXRJANyhSOrufo%3D" alt="custom-right-button" loading="lazy"/></p>
<h3 data-id="heading-15">Input 选择器</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：间接支持</li>
</ul>
<p>HTML 的大部分表单功能都是支持的，但是部分 Input 选择器使用了系统控件（例如 HTML 默认的 Select 选择器，日期选选择器），导致 CDP 截图无法感知到。</p>
<p>目前测试下来有这些选择器都是无法被 CDP Screenshot 所捕获的：</p>

















<table><thead><tr><th align="center">Select</th><th align="center">Date</th><th align="center">Time</th><th align="center">Color</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e71f11eb98e4813972ee7661cc648e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=FE%2FA1Zj2QR4eHYgtFUsI3gGFbGE%3D" alt="select" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b56f0762115c42d2b800bc0d37c178a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=%2BGFrHh8ho%2B4r%2Bp92FCNXbtu5mJk%3D" alt="date" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/547b911968d44dab860192e80a30753f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=g5zDue%2B71Yn1LvNDhZKAjcbTGeI%3D" alt="time" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7724fd3787ee41d1be2321589ecd500f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=qt75nDhNBHa6y8Zi5hKYo3TZrSU%3D" alt="23-cdp-do-link-color" loading="lazy"/></td></tr></tbody></table>
<p>但是也不是没有迂回的办法，我们可以尝试使用 JS 代码注入替换掉现有的系统控件为 DOM 控件，间接的实现被截图的诉求。例如 Select Option Picker，替换后的效果如下：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98b5f93c457b4688bf8be8d7b995705a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=%2BadDQ%2BVUgijpfLjPIC5E69K%2BVk4%3D" alt="select-dom" loading="lazy"/></p>
<h3 data-id="heading-16">文件上传/下载</h3>
<ul>
<li><strong>必要性</strong>：高</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.elementhandle.uploadfile" target="_blank" title="https://pptr.dev/api/puppeteer.elementhandle.uploadfile" ref="nofollow noopener noreferrer">ElementHandle.uploadFile()</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.filechooser" target="_blank" title="https://pptr.dev/api/puppeteer.filechooser" ref="nofollow noopener noreferrer">FileChooser class</a>, <a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.downloadbehavior" target="_blank" title="https://pptr.dev/api/puppeteer.downloadbehavior" ref="nofollow noopener noreferrer">DownloadBehavior</a></li>
</ul>
<p>pptr 上执行文件的逻辑较为完善，结合 uploadFile API 和 FileChooser 都可以做较好的文件上传支持。但是在文件下载上并没有提供非常好的 API，用户可以操作的就是通过 DownloadBehavior 去指定下载策略和下载路径。</p>
<h3 data-id="heading-17">打印</h3>
<ul>
<li><strong>必要性</strong>：中</li>
<li><strong>支持度</strong>：直接支持</li>
<li><strong>pptr API</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fpptr.dev%2Fapi%2Fpuppeteer.page.pdf" target="_blank" title="https://pptr.dev/api/puppeteer.page.pdf" ref="nofollow noopener noreferrer">Page.pdf()</a></li>
</ul>
<p>这个也是现成的 API，直接调用即可。</p>
<h3 data-id="heading-18">其它 Page 级功能</h3>
<ul>
<li><strong>必要性</strong>：低</li>
<li><strong>支持度</strong>：不支持</li>
</ul>
<p>除了上述的各种高频功能，浏览器还有一些甜品级小功能，但从个人角度和用户诉求上看，这些功能在 Browser-Use 场景基本上用不到，而且这些功能 CDP 也基本不支持，但为了本文的内容完整性还是列出来：</p>
<ul>
<li>书签</li>
<li>翻译</li>
<li>搜索</li>
<li>二维码</li>
<li>......</li>
</ul>

























<table><thead><tr><th align="center">书签</th><th align="center">翻译</th></tr></thead><tbody><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/50f80a8fd5f64a3d817ef70d99004a09~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=w71235wGOObHtbYn9OYwwRsQV0Y%3D" alt="mark" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/411e5b50d7ef426eb7d35d5ee0c11136~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=fGzhjrimq9C831aiOFhdFBvMe3Y%3D" alt="trans" loading="lazy"/></td></tr><tr><td align="center"/><td align="center"/></tr><tr><td align="center"><strong>搜索</strong></td><td align="center"><strong>二维码</strong></td></tr><tr><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/48ce16af9d574227a32491591141db67~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=t14wTfYWxSB22OFvAgPHvIq%2BuRw%3D" alt="search" loading="lazy"/></td><td align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d793b1d1016149a7b4c43cbfacd3ed8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2k5Luj54OD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767624841&amp;x-signature=XtR%2B1nL9oMrW012qxLEDeYH%2Frow%3D" alt="qrcode" loading="lazy"/></td></tr></tbody></table>
<h2 data-id="heading-19">总结</h2>
<p>综上所述，我们可以看到 CDP 还是有明显的能力边界，但是已经足够支持 95% 的业务功能了。最重要的是把相关的功能打磨好，才能最大程度的放大 AI 的能力。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙主题切换：一个开关搞定白天/黑夜模式]]></title>    <link>https://juejin.cn/post/7589074117644812323</link>    <guid>https://juejin.cn/post/7589074117644812323</guid>    <pubDate>2025-12-29T13:05:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644812323" data-draft-id="7589063105732460559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙主题切换：一个开关搞定白天/黑夜模式"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-29T13:05:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="90后晨仔"/> <meta itemprop="url" content="https://juejin.cn/user/2717648476705773"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙主题切换：一个开关搞定白天/黑夜模式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2717648476705773/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    90后晨仔
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:05:15.000Z" title="Mon Dec 29 2025 13:05:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我强烈推荐使用<strong>鸿蒙原生资源限定词方案</strong>，配合一个简单的开关控制。这是最优雅、最高效的实现方式。让我用一个完整可运行的示例告诉你为什么。</p>
<h2 data-id="heading-0">一、完整实现：一个开关控制白天/黑夜模式</h2>
<h3 data-id="heading-1">1.1 项目结构</h3>
<pre><code class="hljs language-bash" lang="bash">project/
├── AppScope/resources/
│   ├── base/element/color.json      <span class="hljs-comment"># 白天模式颜色</span>
│   └── dark/element/color.json      <span class="hljs-comment"># 夜间模式颜色</span>
├── entry/src/main/ets/
│   ├── pages/
│   │   └── Index.ets               <span class="hljs-comment"># 主页面</span>
│   └── utils/
│       └── ThemeUtils.ets          <span class="hljs-comment"># 主题管理工具</span>
└── entry/src/main/resources/
    ├── base/media/                 <span class="hljs-comment"># 白天模式图标</span>
    └── dark/media/                 <span class="hljs-comment"># 夜间模式图标</span>
</code></pre>
<h3 data-id="heading-2">1.2 颜色资源定义</h3>
<p><strong>白天主题颜色</strong> (<code>base/element/color.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_bg_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#F8F9FA"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_text_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#212529"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_card_bg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#FFFFFF"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_accent_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#0D6EFD"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_on"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#34C759"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_off"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#E9ECEF"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>夜间主题颜色</strong> (<code>dark/element/color.json</code>):</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_bg_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#121212"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_text_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#E9ECEF"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_card_bg"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#1E1E1E"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_accent_primary"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#6EA8FE"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_on"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#30D158"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"app_switch_track_off"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"#3A3A3C"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-3">1.3 主题管理工具</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// utils/ThemeUtils.ets</span>
<span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Configuration</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.Configuration'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Preferences</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.preferences'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ThemeMode</span> {
  <span class="hljs-variable constant_">LIGHT</span> = <span class="hljs-string">'light'</span>,
  <span class="hljs-variable constant_">DARK</span> = <span class="hljs-string">'dark'</span>,
  <span class="hljs-variable constant_">SYSTEM</span> = <span class="hljs-string">'system'</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeUtils</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-attr">instance</span>: <span class="hljs-title class_">ThemeUtils</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">appContext</span>: common.<span class="hljs-property">ApplicationContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-attr">preferences</span>: <span class="hljs-title class_">Preferences</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">PREF_NAME</span> = <span class="hljs-string">'app_theme_prefs'</span>;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-variable constant_">THEME_KEY</span> = <span class="hljs-string">'current_theme'</span>;
  
  <span class="hljs-comment">// 主题变化监听器</span>
  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> <span class="hljs-built_in">void</span>&gt; = [];
  
  <span class="hljs-comment">// 单例模式</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getInstance</span>(): <span class="hljs-title class_">ThemeUtils</span> {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-property">instance</span>) {
      <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-property">instance</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThemeUtils</span>();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-property">instance</span>;
  }
  
  <span class="hljs-comment">// 初始化</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initialize</span>(<span class="hljs-attr">context</span>: common.<span class="hljs-property">Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 获取应用上下文</span>
      <span class="hljs-keyword">const</span> abilityContext = context <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span> = abilityContext.<span class="hljs-property">configuration</span>.<span class="hljs-property">appContext</span>;
      
      <span class="hljs-comment">// 初始化Preferences存储</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span> = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Preferences</span>.<span class="hljs-title function_">getPreferences</span>(context, <span class="hljs-variable language_">this</span>.<span class="hljs-property">PREF_NAME</span>);
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ThemeUtils 初始化完成'</span>);
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ThemeUtils 初始化失败:'</span>, error);
    }
  }
  
  <span class="hljs-comment">// 获取当前主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCurrentTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ThemeMode</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>;
    }
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> theme = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">get</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">THEME_KEY</span>, <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;
      <span class="hljs-keyword">return</span> theme <span class="hljs-keyword">as</span> <span class="hljs-title class_">ThemeMode</span>;
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取主题失败:'</span>, error);
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>;
    }
  }
  
  <span class="hljs-comment">// 切换主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">toggleTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> current = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCurrentTheme</span>();
    <span class="hljs-keyword">let</span> <span class="hljs-attr">newTheme</span>: <span class="hljs-title class_">ThemeMode</span>;
    
    <span class="hljs-comment">// 简单切换逻辑：白天 ↔ 夜间</span>
    <span class="hljs-keyword">if</span> (current === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>) {
      newTheme = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>) {
      newTheme = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 如果是跟随系统，默认切换到夜间</span>
      newTheme = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    }
    
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setTheme</span>(newTheme);
  }
  
  <span class="hljs-comment">// 设置主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setTheme</span>(<span class="hljs-attr">mode</span>: <span class="hljs-title class_">ThemeMode</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ThemeUtils 未初始化'</span>);
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 保存到Preferences</span>
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">put</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">THEME_KEY</span>, mode);
      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">preferences</span>.<span class="hljs-title function_">flush</span>();
      
      <span class="hljs-comment">// 应用到系统</span>
      <span class="hljs-keyword">let</span> <span class="hljs-attr">colorMode</span>: <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>;
      
      <span class="hljs-keyword">switch</span> (mode) {
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_SYSTEM</span>;
          <span class="hljs-keyword">break</span>;
        <span class="hljs-attr">default</span>:
          colorMode = <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>;
      }
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span>.<span class="hljs-title function_">setColorMode</span>(colorMode);
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`主题已切换为: <span class="hljs-subst">${mode}</span>`</span>);
      
      <span class="hljs-comment">// 通知所有监听器</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyListeners</span>(mode);
      
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'设置主题失败:'</span>, error);
    }
  }
  
  <span class="hljs-comment">// 监听主题变化</span>
  <span class="hljs-title function_">addListener</span>(<span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(callback);
  }
  
  <span class="hljs-comment">// 移除监听器</span>
  <span class="hljs-title function_">removeListener</span>(<span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> <span class="hljs-built_in">void</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">const</span> index = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(callback);
    <span class="hljs-keyword">if</span> (index &gt; -<span class="hljs-number">1</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
    }
  }
  
  <span class="hljs-comment">// 通知所有监听器</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">notifyListeners</span>(<span class="hljs-attr">mode</span>: <span class="hljs-title class_">ThemeMode</span>): <span class="hljs-built_in">void</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> listener <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-title function_">listener</span>(mode);
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'监听器执行失败:'</span>, error);
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-4">1.4 主页面实现（包含切换开关）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// pages/Index.ets</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeUtils</span>, <span class="hljs-title class_">ThemeMode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/ThemeUtils'</span>;

<span class="hljs-meta">@Entry</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">Index</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">currentTheme</span>: <span class="hljs-title class_">ThemeMode</span> = <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
  <span class="hljs-meta">@State</span> <span class="hljs-attr">isDarkMode</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;
  
  <span class="hljs-comment">// 在页面显示时初始化主题</span>
  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initTheme</span>();
  }
  
  <span class="hljs-comment">// 初始化主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">initTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> themeUtils = <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-title function_">getInstance</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTheme</span> = <span class="hljs-keyword">await</span> themeUtils.<span class="hljs-title function_">getCurrentTheme</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTheme</span> === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    
    <span class="hljs-comment">// 监听主题变化</span>
    themeUtils.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">(<span class="hljs-params">mode: ThemeMode</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTheme</span> = mode;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> = mode === <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    });
  }
  
  <span class="hljs-comment">// 切换主题</span>
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">toggleTheme</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
    <span class="hljs-keyword">const</span> themeUtils = <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-title function_">getInstance</span>();
    <span class="hljs-keyword">await</span> themeUtils.<span class="hljs-title function_">toggleTheme</span>();
  }
  
  <span class="hljs-comment">// 获取开关状态文字</span>
  <span class="hljs-title function_">getSwitchText</span>(): <span class="hljs-built_in">string</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-string">'夜间模式'</span> : <span class="hljs-string">'白天模式'</span>;
  }
  
  <span class="hljs-comment">// 获取模式图标</span>
  <span class="hljs-title function_">getModeIcon</span>(): <span class="hljs-title class_">Resource</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> 
      ? $r(<span class="hljs-string">'app.media.icon_moon'</span>)   <span class="hljs-comment">// 月亮图标（夜间）</span>
      : $r(<span class="hljs-string">'app.media.icon_sun'</span>);   <span class="hljs-comment">// 太阳图标（白天）</span>
  }
  
  <span class="hljs-comment">// 构建界面</span>
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Column</span>() {
      <span class="hljs-comment">// 顶部标题栏</span>
      <span class="hljs-title class_">Row</span>() {
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'主题设置'</span>)
          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)
        
        <span class="hljs-title class_">Blank</span>()
        
        <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getModeIcon</span>())
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)
      }
      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })
      .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
      
      <span class="hljs-comment">// 主要内容区域</span>
      <span class="hljs-title class_">Scroll</span>() {
        <span class="hljs-title class_">Column</span>() {
          <span class="hljs-comment">// 主题切换卡片</span>
          <span class="hljs-title class_">Column</span>() {
            <span class="hljs-title class_">Row</span>() {
              <span class="hljs-title class_">Column</span>() {
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">'外观模式'</span>)
                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)
                  .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
                  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Medium</span>)
                
                <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> ? <span class="hljs-string">'深色主题，保护眼睛'</span> : <span class="hljs-string">'浅色主题，清晰明亮'</span>)
                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)
                  .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
                  .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.6</span>)
                  .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">4</span> })
              }
              .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)
              
              <span class="hljs-comment">// 主题切换开关</span>
              <span class="hljs-title class_">Toggle</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ToggleType</span>.<span class="hljs-property">Switch</span>, <span class="hljs-attr">isOn</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDarkMode</span> })
                .<span class="hljs-title function_">selectedColor</span>($r(<span class="hljs-string">'app.color.app_switch_track_on'</span>))
                .<span class="hljs-title function_">switchPointColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
                .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">isOn: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {
                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleTheme</span>();
                })
            }
            .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)
          }
          .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })
          
          <span class="hljs-comment">// 示例内容区域</span>
          <span class="hljs-title class_">Column</span>() {
            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'示例内容'</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)
              .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
              .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)
              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">16</span> })
            
            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'这是一个文本示例，用于展示不同主题下的显示效果。在白天模式下，文字为深色；在夜间模式下，文字为浅色。'</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
              .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
              .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.8</span>)
              .<span class="hljs-title function_">lineHeight</span>(<span class="hljs-number">24</span>)
            
            <span class="hljs-title class_">Divider</span>()
              .<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">1</span>)
              .<span class="hljs-title function_">color</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
              .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.1</span>)
              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })
            
            <span class="hljs-title class_">Row</span>() {
              <span class="hljs-title class_">Button</span>(<span class="hljs-string">'主要按钮'</span>)
                .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_accent_primary'</span>))
                .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)
                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
                .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })
              
              <span class="hljs-title class_">Button</span>(<span class="hljs-string">'次要按钮'</span>)
                .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
                .<span class="hljs-title function_">fontColor</span>($r(<span class="hljs-string">'app.color.app_text_primary'</span>))
                .<span class="hljs-title function_">border</span>({
                  <span class="hljs-attr">color</span>: $r(<span class="hljs-string">'app.color.app_text_primary'</span>),
                  <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>,
                  <span class="hljs-attr">style</span>: <span class="hljs-title class_">BorderStyle</span>.<span class="hljs-property">Solid</span>
                })
                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">8</span>)
                .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">12</span> })
                .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span> })
            }
            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">16</span> })
          }
          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">24</span>)
          .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_card_bg'</span>))
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">40</span> })
        }
        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
      }
      .<span class="hljs-title function_">flexGrow</span>(<span class="hljs-number">1</span>)
    }
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'app.color.app_bg_primary'</span>))
  }
}
</code></pre>
<h3 data-id="heading-5">1.5 在EntryAbility中初始化</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// entry/src/main/ets/entryability/EntryAbility.ets</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ThemeUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/ThemeUtils'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">UIAbility</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.UIAbility'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {
  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want, launchParam</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'EntryAbility onCreate'</span>);
    
    <span class="hljs-comment">// 初始化主题工具</span>
    <span class="hljs-title class_">ThemeUtils</span>.<span class="hljs-title function_">getInstance</span>().<span class="hljs-title function_">initialize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);
  }
}
</code></pre>
<h2 data-id="heading-6">二、为什么这是最佳方案？</h2>
<h3 data-id="heading-7">2.1 简单直观，一行代码切换</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 核心切换逻辑，只需一行代码！</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span>.<span class="hljs-title function_">setColorMode</span>(colorMode);
</code></pre>
<h3 data-id="heading-8">2.2 自动适配所有组件</h3>
<p>一旦切换系统颜色模式，<strong>所有</strong>使用资源引用的组件都会自动更新：</p>
<ul>
<li>文本颜色</li>
<li>背景颜色</li>
<li>边框颜色</li>
<li>图标资源</li>
<li>甚至图片资源（如果有dark目录版本）</li>
</ul>
<h3 data-id="heading-9">2.3 零耦合，高内聚</h3>
<ul>
<li><strong>业务组件</strong>：只关心<code>$r('app.color.xxx')</code>，不关心当前主题</li>
<li><strong>主题管理</strong>：集中在<code>ThemeUtils</code>，统一管理状态</li>
<li><strong>资源定义</strong>：设计师可以直接修改JSON文件</li>
</ul>
<h3 data-id="heading-10">2.4 持久化存储</h3>
<p>使用Preferences自动保存用户选择，下次启动自动恢复：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 保存主题选择</span>
<span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">put</span>(<span class="hljs-string">'current_theme'</span>, mode);
<span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">flush</span>();

<span class="hljs-comment">// 读取主题选择</span>
<span class="hljs-keyword">const</span> theme = <span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">get</span>(<span class="hljs-string">'current_theme'</span>, <span class="hljs-string">'light'</span>);
</code></pre>
<h2 data-id="heading-11">三、对比工具类方案的劣势</h2>
<p>如果用工具类方案，你需要：</p>
<h3 data-id="heading-12">3.1 繁琐的状态管理</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 每个组件都需要监听主题变化</span>
<span class="hljs-meta">@Component</span>
struct <span class="hljs-title class_">MyComponent</span> {
  <span class="hljs-meta">@State</span> <span class="hljs-attr">textColor</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'#000000'</span>;
  
  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 监听主题变化</span>
    <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-title function_">addListener</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span> = <span class="hljs-title class_">ThemeManager</span>.<span class="hljs-title function_">getTextColor</span>();
    });
  }
  
  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'示例'</span>)
      .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span>)  <span class="hljs-comment">// 需要状态变量</span>
  }
}
</code></pre>
<h3 data-id="heading-13">3.2 手动更新所有组件</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 切换主题时需要手动更新所有组件</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThemeManager</span> {
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">toggleTheme</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isDark</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isDark</span>;
    
    <span class="hljs-comment">// 需要手动触发所有组件更新</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> component <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">registeredComponents</span>) {
      component.<span class="hljs-title function_">updateTheme</span>();
    }
  }
}
</code></pre>
<h3 data-id="heading-14">3.3 性能问题</h3>
<ul>
<li>每次切换都要重新计算所有颜色</li>
<li>组件需要频繁重绘</li>
<li>无法利用系统的优化机制</li>
</ul>
<h2 data-id="heading-15">四、高级功能扩展</h2>
<h3 data-id="heading-16">4.1 添加跟随系统选项</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在ThemeUtils中添加</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">setFollowSystem</span>(<span class="hljs-attr">enable</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-keyword">if</span> (enable) {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setTheme</span>(<span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">SYSTEM</span>);
    
    <span class="hljs-comment">// 监听系统主题变化</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">appContext</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'colorModeChange'</span>, <span class="hljs-function">(<span class="hljs-params">newMode: Configuration.ColorMode</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'系统主题已改变:'</span>, newMode);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyListeners</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">mapSystemMode</span>(newMode));
    });
  }
}

<span class="hljs-keyword">private</span> <span class="hljs-title function_">mapSystemMode</span>(<span class="hljs-attr">mode</span>: <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>): <span class="hljs-title class_">ThemeMode</span> {
  <span class="hljs-keyword">switch</span> (mode) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">DARK</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Configuration</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">ThemeMode</span>.<span class="hljs-property">LIGHT</span>;
  }
}
</code></pre>
<h3 data-id="heading-17">4.2 添加动画效果</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在切换主题时添加过渡动画</span>
<span class="hljs-keyword">async</span> <span class="hljs-title function_">toggleThemeWithAnimation</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {
  <span class="hljs-comment">// 先设置半透明</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">applyOpacityAnimation</span>();
  
  <span class="hljs-comment">// 延迟切换主题</span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">toggleTheme</span>();
    
    <span class="hljs-comment">// 恢复不透明</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeOpacityAnimation</span>();
  }, <span class="hljs-number">300</span>);
}
</code></pre>
<h3 data-id="heading-18">4.3 多主题支持（节日主题等）</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 扩展支持更多主题</span>
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">ExtendedThemeMode</span> {
  <span class="hljs-variable constant_">LIGHT</span> = <span class="hljs-string">'light'</span>,
  <span class="hljs-variable constant_">DARK</span> = <span class="hljs-string">'dark'</span>,
  <span class="hljs-variable constant_">SYSTEM</span> = <span class="hljs-string">'system'</span>,
  <span class="hljs-variable constant_">FESTIVAL</span> = <span class="hljs-string">'festival'</span>,  <span class="hljs-comment">// 节日主题</span>
  <span class="hljs-variable constant_">HIGH_CONTRAST</span> = <span class="hljs-string">'high_contrast'</span>  <span class="hljs-comment">// 高对比度</span>
}

<span class="hljs-comment">// 创建对应的资源目录</span>
<span class="hljs-comment">// resources/festival/element/color.json</span>
<span class="hljs-comment">// resources/high_contrast/element/color.json</span>
</code></pre>
<h2 data-id="heading-19">五、实践建议</h2>
<h3 data-id="heading-20">5.1 新项目：直接使用资源限定词方案</h3>
<ul>
<li>从第一天就建立<code>base/</code>和<code>dark/</code>目录</li>
<li>所有颜色使用<code>$r('app.color.xxx')</code></li>
<li>一个开关控制全部</li>
</ul>
<h3 data-id="heading-21">5.2 老项目迁移：三步走</h3>
<ol>
<li><strong>第一步</strong>：创建<code>dark/color.json</code>，复制所有颜色</li>
<li><strong>第二步</strong>：逐步替换硬编码为资源引用</li>
<li><strong>第三步</strong>：添加主题切换开关</li>
</ol>
<h3 data-id="heading-22">5.3 设计规范</h3>
<ol>
<li>使用语义化颜色名称：<code>primary_text</code>、<code>secondary_bg</code></li>
<li>建立颜色设计系统文档</li>
<li>定期同步设计和开发的颜色值</li>
</ol>
<h2 data-id="heading-23">总结</h2>
<p><strong>对于"一个开关控制白天/黑夜模式"的需求，鸿蒙的资源限定词方案是最佳选择。</strong></p>
<p>它提供了：</p>
<ul>
<li>✅ <strong>一键切换</strong>：一个开关控制全局</li>
<li>✅ <strong>自动适配</strong>：所有组件自动更新</li>
<li>✅ <strong>零代码侵入</strong>：业务组件无需修改</li>
<li>✅ <strong>高性能</strong>：系统级优化</li>
<li>✅ <strong>易维护</strong>：颜色集中管理</li>
<li>✅ <strong>可扩展</strong>：支持多主题</li>
</ul>
<p>而工具类方案需要：</p>
<ul>
<li>❌ 每个组件监听主题变化</li>
<li>❌ 手动更新所有颜色</li>
<li>❌ 性能损耗</li>
<li>❌ 维护困难</li>
</ul>
<p><strong>选择资源限定词方案，让你的主题切换像呼吸一样自然！</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[GIS 数据转换：使用 GDAL 将 GeoJSON 转换为 Shp 数据]]></title>    <link>https://juejin.cn/post/7589074117644894243</link>    <guid>https://juejin.cn/post/7589074117644894243</guid>    <pubDate>2025-12-29T13:21:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644894243" data-draft-id="7589104492882952244" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="GIS 数据转换：使用 GDAL 将 GeoJSON 转换为 Shp 数据"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T13:21:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="GIS之路"/> <meta itemprop="url" content="https://juejin.cn/user/4346787284915481"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            GIS 数据转换：使用 GDAL 将 GeoJSON 转换为 Shp 数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4346787284915481/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    GIS之路
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:21:27.000Z" title="Mon Dec 29 2025 13:21:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<blockquote>
<p>❝</p>
<p>GeoJSON 作为一种通用的地理数据格式，可以很方便地用于共享交换。在 GIS 开发中，经常需要进行数据的转换处理，其中常见的便是将 GeoJSON 转换为 Shp 数据进行展示。</p>
</blockquote>
<p>在之前的文章中讲了如何使用<code>GDAL</code>或者<code>ogr2ogr</code>工具将<code>txt</code>以及<code>csv</code>文本数据转换为<code>Shp</code>格式，本篇教程在之前一系列文章的基础上讲解如何使用<code>GDAL</code>将<code>GeoJSON</code>转换为<code>Shp</code>数据。</p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">GDAL 简介</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">GDAL 下载安装</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">GDAL 开发起步</a></li>
</ul>
<p>如果你还没有看过，建议从以上内容开始。</p>
<h2 data-id="heading-1">1. 开发环境</h2>
<p>本文使用如下开发环境，以供参考。</p>
<p>时间：<code>2025年</code></p>
<p>系统：<code>Windows 11</code></p>
<p>Python：<code>3.11.7</code></p>
<p>GDAL：<code>3.11.1</code></p>
<h2 data-id="heading-2">2. 数据准备</h2>
<p><code>GeoJSON</code>是一种用于编码各种地理数据结构的格式，采用<code>JSON</code>方式表示。在<code>WebGIS</code>开发中，被广泛应用于数据传输和共享交换。</p>
<p>有关<code>GeoJSON</code>数据的详细介绍，请参考往期文章：<strong>GeoJSON 数据简介</strong></p>
<p><strong>如下是本文选取的部分国家边界范围的GeoJSON数据结构：</strong></p>
<pre><code class="hljs language-less" lang="less">{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">FeatureCollection</span>","<span class="hljs-selector-tag">features</span>":<span class="hljs-selector-attr">[{<span class="hljs-string">"type"</span>:<span class="hljs-string">"Feature"</span>,<span class="hljs-string">"id"</span>:<span class="hljs-string">"AFG"</span>,<span class="hljs-string">"properties"</span>:{<span class="hljs-string">"name"</span>:<span class="hljs-string">"Afghanistan"</span>},<span class="hljs-string">"geometry"</span>:{<span class="hljs-string">"type"</span>:<span class="hljs-string">"Polygon"</span>,<span class="hljs-string">"coordinates"</span>:[[[61.210817,35.650072]</span>,<span class="hljs-selector-attr">[62.230651,35.270664]</span>,<span class="hljs-selector-attr">[62.984662,35.404041]</span>,<span class="hljs-selector-attr">[63.193538,35.857166]</span>,<span class="hljs-selector-attr">[63.982896,36.007957]</span>,<span class="hljs-selector-attr">[64.546479,36.312073]</span>,<span class="hljs-selector-attr">[64.746105,37.111818]</span>,<span class="hljs-selector-attr">[65.588948,37.305217]</span>,<span class="hljs-selector-attr">[65.745631,37.661164]</span>,<span class="hljs-selector-attr">[66.217385,37.39379]</span>,<span class="hljs-selector-attr">[66.518607,37.362784]</span>,<span class="hljs-selector-attr">[67.075782,37.356144]</span>,<span class="hljs-selector-attr">[67.83,37.144994]</span>,<span class="hljs-selector-attr">[68.135562,37.023115]</span>,<span class="hljs-selector-attr">[68.859446,37.344336]</span>,<span class="hljs-selector-attr">[69.196273,37.151144]</span>,<span class="hljs-selector-attr">[69.518785,37.608997]</span>,<span class="hljs-selector-attr">[70.116578,37.588223]</span>,<span class="hljs-selector-attr">[70.270574,37.735165]</span>,<span class="hljs-selector-attr">[70.376304,38.138396]</span>,<span class="hljs-selector-attr">[70.806821,38.486282]</span>,<span class="hljs-selector-attr">[71.348131,38.258905]</span>,<span class="hljs-selector-attr">[71.239404,37.953265]</span>,<span class="hljs-selector-attr">[71.541918,37.905774]</span>,<span class="hljs-selector-attr">[71.448693,37.065645]</span>,<span class="hljs-selector-attr">[71.844638,36.738171]</span>,<span class="hljs-selector-attr">[72.193041,36.948288]</span>,<span class="hljs-selector-attr">[72.63689,37.047558]</span>,<span class="hljs-selector-attr">[73.260056,37.495257]</span>,<span class="hljs-selector-attr">[73.948696,37.421566]</span>,<span class="hljs-selector-attr">[74.980002,37.41999]</span>,<span class="hljs-selector-attr">[75.158028,37.133031]</span>,<span class="hljs-selector-attr">[74.575893,37.020841]</span>,<span class="hljs-selector-attr">[74.067552,36.836176]</span>,<span class="hljs-selector-attr">[72.920025,36.720007]</span>,<span class="hljs-selector-attr">[71.846292,36.509942]</span>,<span class="hljs-selector-attr">[71.262348,36.074388]</span>,<span class="hljs-selector-attr">[71.498768,35.650563]</span>,<span class="hljs-selector-attr">[71.613076,35.153203]</span>,<span class="hljs-selector-attr">[71.115019,34.733126]</span>,<span class="hljs-selector-attr">[71.156773,34.348911]</span>,<span class="hljs-selector-attr">[70.881803,33.988856]</span>,<span class="hljs-selector-attr">[69.930543,34.02012]</span>,<span class="hljs-selector-attr">[70.323594,33.358533]</span>,<span class="hljs-selector-attr">[69.687147,33.105499]</span>,<span class="hljs-selector-attr">[69.262522,32.501944]</span>,<span class="hljs-selector-attr">[69.317764,31.901412]</span>,<span class="hljs-selector-attr">[68.926677,31.620189]</span>,<span class="hljs-selector-attr">[68.556932,31.71331]</span>,<span class="hljs-selector-attr">[67.792689,31.58293]</span>,<span class="hljs-selector-attr">[67.683394,31.303154]</span>,<span class="hljs-selector-attr">[66.938891,31.304911]</span>,<span class="hljs-selector-attr">[66.381458,30.738899]</span>,<span class="hljs-selector-attr">[66.346473,29.887943]</span>,<span class="hljs-selector-attr">[65.046862,29.472181]</span>,<span class="hljs-selector-attr">[64.350419,29.560031]</span>,<span class="hljs-selector-attr">[64.148002,29.340819]</span>,<span class="hljs-selector-attr">[63.550261,29.468331]</span>,<span class="hljs-selector-attr">[62.549857,29.318572]</span>,<span class="hljs-selector-attr">[60.874248,29.829239]</span>,<span class="hljs-selector-attr">[61.781222,30.73585]</span>,<span class="hljs-selector-attr">[61.699314,31.379506]</span>,<span class="hljs-selector-attr">[60.941945,31.548075]</span>,<span class="hljs-selector-attr">[60.863655,32.18292]</span>,<span class="hljs-selector-attr">[60.536078,32.981269]</span>,<span class="hljs-selector-attr">[60.9637,33.528832]</span>,<span class="hljs-selector-attr">[60.52843,33.676446]</span>,<span class="hljs-selector-attr">[60.803193,34.404102]</span>,<span class="hljs-selector-attr">[61.210817,35.650072]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AGO</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Angola</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[16.326528,-5.87747]</span>,<span class="hljs-selector-attr">[16.57318,-6.622645]</span>,<span class="hljs-selector-attr">[16.860191,-7.222298]</span>,<span class="hljs-selector-attr">[17.089996,-7.545689]</span>,<span class="hljs-selector-attr">[17.47297,-8.068551]</span>,<span class="hljs-selector-attr">[18.134222,-7.987678]</span>,<span class="hljs-selector-attr">[18.464176,-7.847014]</span>,<span class="hljs-selector-attr">[19.016752,-7.988246]</span>,<span class="hljs-selector-attr">[19.166613,-7.738184]</span>,<span class="hljs-selector-attr">[19.417502,-7.155429]</span>,<span class="hljs-selector-attr">[20.037723,-7.116361]</span>,<span class="hljs-selector-attr">[20.091622,-6.94309]</span>,<span class="hljs-selector-attr">[20.601823,-6.939318]</span>,<span class="hljs-selector-attr">[20.514748,-7.299606]</span>,<span class="hljs-selector-attr">[21.728111,-7.290872]</span>,<span class="hljs-selector-attr">[21.746456,-7.920085]</span>,<span class="hljs-selector-attr">[21.949131,-8.305901]</span>,<span class="hljs-selector-attr">[21.801801,-8.908707]</span>,<span class="hljs-selector-attr">[21.875182,-9.523708]</span>,<span class="hljs-selector-attr">[22.208753,-9.894796]</span>,<span class="hljs-selector-attr">[22.155268,-11.084801]</span>,<span class="hljs-selector-attr">[22.402798,-10.993075]</span>,<span class="hljs-selector-attr">[22.837345,-11.017622]</span>,<span class="hljs-selector-attr">[23.456791,-10.867863]</span>,<span class="hljs-selector-attr">[23.912215,-10.926826]</span>,<span class="hljs-selector-attr">[24.017894,-11.237298]</span>,<span class="hljs-selector-attr">[23.904154,-11.722282]</span>,<span class="hljs-selector-attr">[24.079905,-12.191297]</span>,<span class="hljs-selector-attr">[23.930922,-12.565848]</span>,<span class="hljs-selector-attr">[24.016137,-12.911046]</span>,<span class="hljs-selector-attr">[21.933886,-12.898437]</span>,<span class="hljs-selector-attr">[21.887843,-16.08031]</span>,<span class="hljs-selector-attr">[22.562478,-16.898451]</span>,<span class="hljs-selector-attr">[23.215048,-17.523116]</span>,<span class="hljs-selector-attr">[21.377176,-17.930636]</span>,<span class="hljs-selector-attr">[18.956187,-17.789095]</span>,<span class="hljs-selector-attr">[18.263309,-17.309951]</span>,<span class="hljs-selector-attr">[14.209707,-17.353101]</span>,<span class="hljs-selector-attr">[14.058501,-17.423381]</span>,<span class="hljs-selector-attr">[13.462362,-16.971212]</span>,<span class="hljs-selector-attr">[12.814081,-16.941343]</span>,<span class="hljs-selector-attr">[12.215461,-17.111668]</span>,<span class="hljs-selector-attr">[11.734199,-17.301889]</span>,<span class="hljs-selector-attr">[11.640096,-16.673142]</span>,<span class="hljs-selector-attr">[11.778537,-15.793816]</span>,<span class="hljs-selector-attr">[12.123581,-14.878316]</span>,<span class="hljs-selector-attr">[12.175619,-14.449144]</span>,<span class="hljs-selector-attr">[12.500095,-13.5477]</span>,<span class="hljs-selector-attr">[12.738479,-13.137906]</span>,<span class="hljs-selector-attr">[13.312914,-12.48363]</span>,<span class="hljs-selector-attr">[13.633721,-12.038645]</span>,<span class="hljs-selector-attr">[13.738728,-11.297863]</span>,<span class="hljs-selector-attr">[13.686379,-10.731076]</span>,<span class="hljs-selector-attr">[13.387328,-10.373578]</span>,<span class="hljs-selector-attr">[13.120988,-9.766897]</span>,<span class="hljs-selector-attr">[12.87537,-9.166934]</span>,<span class="hljs-selector-attr">[12.929061,-8.959091]</span>,<span class="hljs-selector-attr">[13.236433,-8.562629]</span>,<span class="hljs-selector-attr">[12.93304,-7.596539]</span>,<span class="hljs-selector-attr">[12.728298,-6.927122]</span>,<span class="hljs-selector-attr">[12.227347,-6.294448]</span>,<span class="hljs-selector-attr">[12.322432,-6.100092]</span>,<span class="hljs-selector-attr">[12.735171,-5.965682]</span>,<span class="hljs-selector-attr">[13.024869,-5.984389]</span>,<span class="hljs-selector-attr">[13.375597,-5.864241]</span>,<span class="hljs-selector-attr">[16.326528,-5.87747]</span>]],<span class="hljs-selector-attr">[[[12.436688,-5.684304]</span>,<span class="hljs-selector-attr">[12.182337,-5.789931]</span>,<span class="hljs-selector-attr">[11.914963,-5.037987]</span>,<span class="hljs-selector-attr">[12.318608,-4.60623]</span>,<span class="hljs-selector-attr">[12.62076,-4.438023]</span>,<span class="hljs-selector-attr">[12.995517,-4.781103]</span>,<span class="hljs-selector-attr">[12.631612,-4.991271]</span>,<span class="hljs-selector-attr">[12.468004,-5.248362]</span>,<span class="hljs-selector-attr">[12.436688,-5.684304]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ALB</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Albania</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[20.590247,41.855404]</span>,<span class="hljs-selector-attr">[20.463175,41.515089]</span>,<span class="hljs-selector-attr">[20.605182,41.086226]</span>,<span class="hljs-selector-attr">[21.02004,40.842727]</span>,<span class="hljs-selector-attr">[20.99999,40.580004]</span>,<span class="hljs-selector-attr">[20.674997,40.435]</span>,<span class="hljs-selector-attr">[20.615,40.110007]</span>,<span class="hljs-selector-attr">[20.150016,39.624998]</span>,<span class="hljs-selector-attr">[19.98,39.694993]</span>,<span class="hljs-selector-attr">[19.960002,39.915006]</span>,<span class="hljs-selector-attr">[19.406082,40.250773]</span>,<span class="hljs-selector-attr">[19.319059,40.72723]</span>,<span class="hljs-selector-attr">[19.40355,41.409566]</span>,<span class="hljs-selector-attr">[19.540027,41.719986]</span>,<span class="hljs-selector-attr">[19.371769,41.877548]</span>,<span class="hljs-selector-attr">[19.304486,42.195745]</span>,<span class="hljs-selector-attr">[19.738051,42.688247]</span>,<span class="hljs-selector-attr">[19.801613,42.500093]</span>,<span class="hljs-selector-attr">[20.0707,42.58863]</span>,<span class="hljs-selector-attr">[20.283755,42.32026]</span>,<span class="hljs-selector-attr">[20.52295,42.21787]</span>,<span class="hljs-selector-attr">[20.590247,41.855404]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ARE</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">United</span> <span class="hljs-selector-tag">Arab</span> <span class="hljs-selector-tag">Emirates</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[51.579519,24.245497]</span>,<span class="hljs-selector-attr">[51.757441,24.294073]</span>,<span class="hljs-selector-attr">[51.794389,24.019826]</span>,<span class="hljs-selector-attr">[52.577081,24.177439]</span>,<span class="hljs-selector-attr">[53.404007,24.151317]</span>,<span class="hljs-selector-attr">[54.008001,24.121758]</span>,<span class="hljs-selector-attr">[54.693024,24.797892]</span>,<span class="hljs-selector-attr">[55.439025,25.439145]</span>,<span class="hljs-selector-attr">[56.070821,26.055464]</span>,<span class="hljs-selector-attr">[56.261042,25.714606]</span>,<span class="hljs-selector-attr">[56.396847,24.924732]</span>,<span class="hljs-selector-attr">[55.886233,24.920831]</span>,<span class="hljs-selector-attr">[55.804119,24.269604]</span>,<span class="hljs-selector-attr">[55.981214,24.130543]</span>,<span class="hljs-selector-attr">[55.528632,23.933604]</span>,<span class="hljs-selector-attr">[55.525841,23.524869]</span>,<span class="hljs-selector-attr">[55.234489,23.110993]</span>,<span class="hljs-selector-attr">[55.208341,22.70833]</span>,<span class="hljs-selector-attr">[55.006803,22.496948]</span>,<span class="hljs-selector-attr">[52.000733,23.001154]</span>,<span class="hljs-selector-attr">[51.617708,24.014219]</span>,<span class="hljs-selector-attr">[51.579519,24.245497]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ARG</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Argentina</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-65.5,-55.2]</span>,<span class="hljs-selector-attr">[-66.45,-55.25]</span>,<span class="hljs-selector-attr">[-66.95992,-54.89681]</span>,<span class="hljs-selector-attr">[-67.56244,-54.87001]</span>,<span class="hljs-selector-attr">[-68.63335,-54.8695]</span>,<span class="hljs-selector-attr">[-68.63401,-52.63637]</span>,<span class="hljs-selector-attr">[-68.25,-53.1]</span>,<span class="hljs-selector-attr">[-67.75,-53.85]</span>,<span class="hljs-selector-attr">[-66.45,-54.45]</span>,<span class="hljs-selector-attr">[-65.05,-54.7]</span>,<span class="hljs-selector-attr">[-65.5,-55.2]</span>]],<span class="hljs-selector-attr">[[[-64.964892,-22.075862]</span>,<span class="hljs-selector-attr">[-64.377021,-22.798091]</span>,<span class="hljs-selector-attr">[-63.986838,-21.993644]</span>,<span class="hljs-selector-attr">[-62.846468,-22.034985]</span>,<span class="hljs-selector-attr">[-62.685057,-22.249029]</span>,<span class="hljs-selector-attr">[-60.846565,-23.880713]</span>,<span class="hljs-selector-attr">[-60.028966,-24.032796]</span>,<span class="hljs-selector-attr">[-58.807128,-24.771459]</span>,<span class="hljs-selector-attr">[-57.777217,-25.16234]</span>,<span class="hljs-selector-attr">[-57.63366,-25.603657]</span>,<span class="hljs-selector-attr">[-58.618174,-27.123719]</span>,<span class="hljs-selector-attr">[-57.60976,-27.395899]</span>,<span class="hljs-selector-attr">[-56.486702,-27.548499]</span>,<span class="hljs-selector-attr">[-55.695846,-27.387837]</span>,<span class="hljs-selector-attr">[-54.788795,-26.621786]</span>,<span class="hljs-selector-attr">[-54.625291,-25.739255]</span>,<span class="hljs-selector-attr">[-54.13005,-25.547639]</span>,<span class="hljs-selector-attr">[-53.628349,-26.124865]</span>,<span class="hljs-selector-attr">[-53.648735,-26.923473]</span>,<span class="hljs-selector-attr">[-54.490725,-27.474757]</span>,<span class="hljs-selector-attr">[-55.162286,-27.881915]</span>,<span class="hljs-selector-attr">[-56.2909,-28.852761]</span>,<span class="hljs-selector-attr">[-57.625133,-30.216295]</span>,<span class="hljs-selector-attr">[-57.874937,-31.016556]</span>,<span class="hljs-selector-attr">[-58.14244,-32.044504]</span>,<span class="hljs-selector-attr">[-58.132648,-33.040567]</span>,<span class="hljs-selector-attr">[-58.349611,-33.263189]</span>,<span class="hljs-selector-attr">[-58.427074,-33.909454]</span>,<span class="hljs-selector-attr">[-58.495442,-34.43149]</span>,<span class="hljs-selector-attr">[-57.22583,-35.288027]</span>,<span class="hljs-selector-attr">[-57.362359,-35.97739]</span>,<span class="hljs-selector-attr">[-56.737487,-36.413126]</span>,<span class="hljs-selector-attr">[-56.788285,-36.901572]</span>,<span class="hljs-selector-attr">[-57.749157,-38.183871]</span>,<span class="hljs-selector-attr">[-59.231857,-38.72022]</span>,<span class="hljs-selector-attr">[-61.237445,-38.928425]</span>,<span class="hljs-selector-attr">[-62.335957,-38.827707]</span>,<span class="hljs-selector-attr">[-62.125763,-39.424105]</span>,<span class="hljs-selector-attr">[-62.330531,-40.172586]</span>,<span class="hljs-selector-attr">[-62.145994,-40.676897]</span>,<span class="hljs-selector-attr">[-62.745803,-41.028761]</span>,<span class="hljs-selector-attr">[-63.770495,-41.166789]</span>,<span class="hljs-selector-attr">[-64.73209,-40.802677]</span>,<span class="hljs-selector-attr">[-65.118035,-41.064315]</span>,<span class="hljs-selector-attr">[-64.978561,-42.058001]</span>,<span class="hljs-selector-attr">[-64.303408,-42.359016]</span>,<span class="hljs-selector-attr">[-63.755948,-42.043687]</span>,<span class="hljs-selector-attr">[-63.458059,-42.563138]</span>,<span class="hljs-selector-attr">[-64.378804,-42.873558]</span>,<span class="hljs-selector-attr">[-65.181804,-43.495381]</span>,<span class="hljs-selector-attr">[-65.328823,-44.501366]</span>,<span class="hljs-selector-attr">[-65.565269,-45.036786]</span>,<span class="hljs-selector-attr">[-66.509966,-45.039628]</span>,<span class="hljs-selector-attr">[-67.293794,-45.551896]</span>,<span class="hljs-selector-attr">[-67.580546,-46.301773]</span>,<span class="hljs-selector-attr">[-66.597066,-47.033925]</span>,<span class="hljs-selector-attr">[-65.641027,-47.236135]</span>,<span class="hljs-selector-attr">[-65.985088,-48.133289]</span>,<span class="hljs-selector-attr">[-67.166179,-48.697337]</span>,<span class="hljs-selector-attr">[-67.816088,-49.869669]</span>,<span class="hljs-selector-attr">[-68.728745,-50.264218]</span>,<span class="hljs-selector-attr">[-69.138539,-50.73251]</span>,<span class="hljs-selector-attr">[-68.815561,-51.771104]</span>,<span class="hljs-selector-attr">[-68.149995,-52.349983]</span>,<span class="hljs-selector-attr">[-68.571545,-52.299444]</span>,<span class="hljs-selector-attr">[-69.498362,-52.142761]</span>,<span class="hljs-selector-attr">[-71.914804,-52.009022]</span>,<span class="hljs-selector-attr">[-72.329404,-51.425956]</span>,<span class="hljs-selector-attr">[-72.309974,-50.67701]</span>,<span class="hljs-selector-attr">[-72.975747,-50.74145]</span>,<span class="hljs-selector-attr">[-73.328051,-50.378785]</span>,<span class="hljs-selector-attr">[-73.415436,-49.318436]</span>,<span class="hljs-selector-attr">[-72.648247,-48.878618]</span>,<span class="hljs-selector-attr">[-72.331161,-48.244238]</span>,<span class="hljs-selector-attr">[-72.447355,-47.738533]</span>,<span class="hljs-selector-attr">[-71.917258,-46.884838]</span>,<span class="hljs-selector-attr">[-71.552009,-45.560733]</span>,<span class="hljs-selector-attr">[-71.659316,-44.973689]</span>,<span class="hljs-selector-attr">[-71.222779,-44.784243]</span>,<span class="hljs-selector-attr">[-71.329801,-44.407522]</span>,<span class="hljs-selector-attr">[-71.793623,-44.207172]</span>,<span class="hljs-selector-attr">[-71.464056,-43.787611]</span>,<span class="hljs-selector-attr">[-71.915424,-43.408565]</span>,<span class="hljs-selector-attr">[-72.148898,-42.254888]</span>,<span class="hljs-selector-attr">[-71.746804,-42.051386]</span>,<span class="hljs-selector-attr">[-71.915734,-40.832339]</span>,<span class="hljs-selector-attr">[-71.680761,-39.808164]</span>,<span class="hljs-selector-attr">[-71.413517,-38.916022]</span>,<span class="hljs-selector-attr">[-70.814664,-38.552995]</span>,<span class="hljs-selector-attr">[-71.118625,-37.576827]</span>,<span class="hljs-selector-attr">[-71.121881,-36.658124]</span>,<span class="hljs-selector-attr">[-70.364769,-36.005089]</span>,<span class="hljs-selector-attr">[-70.388049,-35.169688]</span>,<span class="hljs-selector-attr">[-69.817309,-34.193571]</span>,<span class="hljs-selector-attr">[-69.814777,-33.273886]</span>,<span class="hljs-selector-attr">[-70.074399,-33.09121]</span>,<span class="hljs-selector-attr">[-70.535069,-31.36501]</span>,<span class="hljs-selector-attr">[-69.919008,-30.336339]</span>,<span class="hljs-selector-attr">[-70.01355,-29.367923]</span>,<span class="hljs-selector-attr">[-69.65613,-28.459141]</span>,<span class="hljs-selector-attr">[-69.001235,-27.521214]</span>,<span class="hljs-selector-attr">[-68.295542,-26.89934]</span>,<span class="hljs-selector-attr">[-68.5948,-26.506909]</span>,<span class="hljs-selector-attr">[-68.386001,-26.185016]</span>,<span class="hljs-selector-attr">[-68.417653,-24.518555]</span>,<span class="hljs-selector-attr">[-67.328443,-24.025303]</span>,<span class="hljs-selector-attr">[-66.985234,-22.986349]</span>,<span class="hljs-selector-attr">[-67.106674,-22.735925]</span>,<span class="hljs-selector-attr">[-66.273339,-21.83231]</span>,<span class="hljs-selector-attr">[-64.964892,-22.075862]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ARM</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Armenia</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[43.582746,41.092143]</span>,<span class="hljs-selector-attr">[44.97248,41.248129]</span>,<span class="hljs-selector-attr">[45.179496,40.985354]</span>,<span class="hljs-selector-attr">[45.560351,40.81229]</span>,<span class="hljs-selector-attr">[45.359175,40.561504]</span>,<span class="hljs-selector-attr">[45.891907,40.218476]</span>,<span class="hljs-selector-attr">[45.610012,39.899994]</span>,<span class="hljs-selector-attr">[46.034534,39.628021]</span>,<span class="hljs-selector-attr">[46.483499,39.464155]</span>,<span class="hljs-selector-attr">[46.50572,38.770605]</span>,<span class="hljs-selector-attr">[46.143623,38.741201]</span>,<span class="hljs-selector-attr">[45.735379,39.319719]</span>,<span class="hljs-selector-attr">[45.739978,39.473999]</span>,<span class="hljs-selector-attr">[45.298145,39.471751]</span>,<span class="hljs-selector-attr">[45.001987,39.740004]</span>,<span class="hljs-selector-attr">[44.79399,39.713003]</span>,<span class="hljs-selector-attr">[44.400009,40.005]</span>,<span class="hljs-selector-attr">[43.656436,40.253564]</span>,<span class="hljs-selector-attr">[43.752658,40.740201]</span>,<span class="hljs-selector-attr">[43.582746,41.092143]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ATA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Antarctica</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-59.572095,-80.040179]</span>,<span class="hljs-selector-attr">[-59.865849,-80.549657]</span>,<span class="hljs-selector-attr">[-60.159656,-81.000327]</span>,<span class="hljs-selector-attr">[-62.255393,-80.863178]</span>,<span class="hljs-selector-attr">[-64.488125,-80.921934]</span>,<span class="hljs-selector-attr">[-65.741666,-80.588827]</span>,<span class="hljs-selector-attr">[-65.741666,-80.549657]</span>,<span class="hljs-selector-attr">[-66.290031,-80.255773]</span>,<span class="hljs-selector-attr">[-64.037688,-80.294944]</span>,<span class="hljs-selector-attr">[-61.883246,-80.39287]</span>,<span class="hljs-selector-attr">[-61.138976,-79.981371]</span>,<span class="hljs-selector-attr">[-60.610119,-79.628679]</span>,<span class="hljs-selector-attr">[-59.572095,-80.040179]</span>]],<span class="hljs-selector-attr">[[[-159.208184,-79.497059]</span>,<span class="hljs-selector-attr">[-161.127601,-79.634209]</span>,<span class="hljs-selector-attr">[-162.439847,-79.281465]</span>,<span class="hljs-selector-attr">[-163.027408,-78.928774]</span>,<span class="hljs-selector-attr">[-163.066604,-78.869966]</span>,<span class="hljs-selector-attr">[-163.712896,-78.595667]</span>,<span class="hljs-selector-attr">[-163.712896,-78.595667]</span>,<span class="hljs-selector-attr">[-163.105801,-78.223338]</span>,<span class="hljs-selector-attr">[-161.245113,-78.380176]</span>,<span class="hljs-selector-attr">[-160.246208,-78.693645]</span>,<span class="hljs-selector-attr">[-159.482405,-79.046338]</span>,<span class="hljs-selector-attr">[-159.208184,-79.497059]</span>]],<span class="hljs-selector-attr">[[[-45.154758,-78.04707]</span>,<span class="hljs-selector-attr">[-43.920828,-78.478103]</span>,<span class="hljs-selector-attr">[-43.48995,-79.08556]</span>,<span class="hljs-selector-attr">[-43.372438,-79.516645]</span>,<span class="hljs-selector-attr">[-43.333267,-80.026123]</span>,<span class="hljs-selector-attr">[-44.880537,-80.339644]</span>,<span class="hljs-selector-attr">[-46.506174,-80.594357]</span>,<span class="hljs-selector-attr">[-48.386421,-80.829485]</span>,<span class="hljs-selector-attr">[-50.482107,-81.025442]</span>,<span class="hljs-selector-attr">[-52.851988,-80.966685]</span>,<span class="hljs-selector-attr">[-54.164259,-80.633528]</span>,<span class="hljs-selector-attr">[-53.987991,-80.222028]</span>,<span class="hljs-selector-attr">[-51.853134,-79.94773]</span>,<span class="hljs-selector-attr">[-50.991326,-79.614623]</span>,<span class="hljs-selector-attr">[-50.364595,-79.183487]</span>,<span class="hljs-selector-attr">[-49.914131,-78.811209]</span>,<span class="hljs-selector-attr">[-49.306959,-78.458569]</span>,<span class="hljs-selector-attr">[-48.660616,-78.047018]</span>,<span class="hljs-selector-attr">[-48.660616,-78.047019]</span>,<span class="hljs-selector-attr">[-48.151396,-78.04707]</span>,<span class="hljs-selector-attr">[-46.662857,-77.831476]</span>,<span class="hljs-selector-attr">[-45.154758,-78.04707]</span>]],<span class="hljs-selector-attr">[[[-121.211511,-73.50099]</span>,<span class="hljs-selector-attr">[-119.918851,-73.657725]</span>,<span class="hljs-selector-attr">[-118.724143,-73.481353]</span>,<span class="hljs-selector-attr">[-119.292119,-73.834097]</span>,<span class="hljs-selector-attr">[-120.232217,-74.08881]</span>,<span class="hljs-selector-attr">[-121.62283,-74.010468]</span>,<span class="hljs-selector-attr">[-122.621735,-73.657778]</span>,<span class="hljs-selector-attr">[-122.621735,-73.657777]</span>,<span class="hljs-selector-attr">[-122.406245,-73.324619]</span>,<span class="hljs-selector-attr">[-121.211511,-73.50099]</span>]],<span class="hljs-selector-attr">[[[-125.559566,-73.481353]</span>,<span class="hljs-selector-attr">[-124.031882,-73.873268]</span>,<span class="hljs-selector-attr">[-124.619469,-73.834097]</span>,<span class="hljs-selector-attr">[-125.912181,-73.736118]</span>,<span class="hljs-selector-attr">[-127.28313,-73.461769]</span>,<span class="hljs-selector-attr">[-127.28313,-73.461768]</span>,<span class="hljs-selector-attr">[-126.558472,-73.246226]</span>,<span class="hljs-selector-attr">[-125.559566,-73.481353]</span>]],<span class="hljs-selector-attr">[[[-98.98155,-71.933334]</span>,<span class="hljs-selector-attr">[-97.884743,-72.070535]</span>,<span class="hljs-selector-attr">[-96.787937,-71.952971]</span>,<span class="hljs-selector-attr">[-96.20035,-72.521205]</span>,<span class="hljs-selector-attr">[-96.983765,-72.442864]</span>,<span class="hljs-selector-attr">[-98.198083,-72.482035]</span>,<span class="hljs-selector-attr">[-99.432013,-72.442864]</span>,<span class="hljs-selector-attr">[-100.783455,-72.50162]</span>,<span class="hljs-selector-attr">[-101.801868,-72.305663]</span>,<span class="hljs-selector-attr">[-102.330725,-71.894164]</span>,<span class="hljs-selector-attr">[-102.330725,-71.894164]</span>,<span class="hljs-selector-attr">[-101.703967,-71.717792]</span>,<span class="hljs-selector-attr">[-100.430919,-71.854993]</span>,<span class="hljs-selector-attr">[-98.98155,-71.933334]</span>]],<span class="hljs-selector-attr">[[[-68.451346,-70.955823]</span>,<span class="hljs-selector-attr">[-68.333834,-71.406493]</span>,<span class="hljs-selector-attr">[-68.510128,-71.798407]</span>,<span class="hljs-selector-attr">[-68.784297,-72.170736]</span>,<span class="hljs-selector-attr">[-69.959471,-72.307885]</span>,<span class="hljs-selector-attr">[-71.075889,-72.503842]</span>,<span class="hljs-selector-attr">[-72.388134,-72.484257]</span>,<span class="hljs-selector-attr">[-71.8985,-72.092343]</span>,<span class="hljs-selector-attr">[-73.073622,-72.229492]</span>,<span class="hljs-selector-attr">[-74.19004,-72.366693]</span>,<span class="hljs-selector-attr">[-74.953895,-72.072757]</span>,<span class="hljs-selector-attr">[-75.012625,-71.661258]</span>,<span class="hljs-selector-attr">[-73.915819,-71.269345]</span>,<span class="hljs-selector-attr">[-73.915819,-71.269344]</span>,<span class="hljs-selector-attr">[-73.230331,-71.15178]</span>,<span class="hljs-selector-attr">[-72.074717,-71.190951]</span>,<span class="hljs-selector-attr">[-71.780962,-70.681473]</span>,<span class="hljs-selector-attr">[-71.72218,-70.309196]</span>,<span class="hljs-selector-attr">[-71.741791,-69.505782]</span>,<span class="hljs-selector-attr">[-71.173815,-69.035475]</span>,<span class="hljs-selector-attr">[-70.253252,-68.87874]</span>,<span class="hljs-selector-attr">[-69.724447,-69.251017]</span>,<span class="hljs-selector-attr">[-69.489422,-69.623346]</span>,<span class="hljs-selector-attr">[-69.058518,-70.074016]</span>,<span class="hljs-selector-attr">[-68.725541,-70.505153]</span>,<span class="hljs-selector-attr">[-68.451346,-70.955823]</span>]],<span class="hljs-selector-attr">[[[-58.614143,-64.152467]</span>,<span class="hljs-selector-attr">[-59.045073,-64.36801]</span>,<span class="hljs-selector-attr">[-59.789342,-64.211223]</span>,<span class="hljs-selector-attr">[-60.611928,-64.309202]</span>,<span class="hljs-selector-attr">[-61.297416,-64.54433]</span>,<span class="hljs-selector-attr">[-62.0221,-64.799094]</span>,<span class="hljs-selector-attr">[-62.51176,-65.09303]</span>,<span class="hljs-selector-attr">[-62.648858,-65.484942]</span>,<span class="hljs-selector-attr">[-62.590128,-65.857219]</span>,<span class="hljs-selector-attr">[-62.120079,-66.190326]</span>,<span class="hljs-selector-attr">[-62.805567,-66.425505]</span>,<span class="hljs-selector-attr">[-63.74569,-66.503847]</span>,<span class="hljs-selector-attr">[-64.294106,-66.837004]</span>,<span class="hljs-selector-attr">[-64.881693,-67.150474]</span>,<span class="hljs-selector-attr">[-65.508425,-67.58161]</span>,<span class="hljs-selector-attr">[-65.665082,-67.953887]</span>,<span class="hljs-selector-attr">[-65.312545,-68.365335]</span>,<span class="hljs-selector-attr">[-64.783715,-68.678908]</span>,<span class="hljs-selector-attr">[-63.961103,-68.913984]</span>,<span class="hljs-selector-attr">[-63.1973,-69.227556]</span>,<span class="hljs-selector-attr">[-62.785955,-69.619419]</span>,<span class="hljs-selector-attr">[-62.570516,-69.991747]</span>,<span class="hljs-selector-attr">[-62.276736,-70.383661]</span>,<span class="hljs-selector-attr">[-61.806661,-70.716768]</span>,<span class="hljs-selector-attr">[-61.512906,-71.089045]</span>,<span class="hljs-selector-attr">[-61.375809,-72.010074]</span>,<span class="hljs-selector-attr">[-61.081977,-72.382351]</span>,<span class="hljs-selector-attr">[-61.003661,-72.774265]</span>,<span class="hljs-selector-attr">[-60.690269,-73.166179]</span>,<span class="hljs-selector-attr">[-60.827367,-73.695242]</span>,<span class="hljs-selector-attr">[-61.375809,-74.106742]</span>,<span class="hljs-selector-attr">[-61.96337,-74.439848]</span>,<span class="hljs-selector-attr">[-63.295201,-74.576997]</span>,<span class="hljs-selector-attr">[-63.74569,-74.92974]</span>,<span class="hljs-selector-attr">[-64.352836,-75.262847]</span>,<span class="hljs-selector-attr">[-65.860987,-75.635124]</span>,<span class="hljs-selector-attr">[-67.192818,-75.79191]</span>,<span class="hljs-selector-attr">[-68.446282,-76.007452]</span>,<span class="hljs-selector-attr">[-69.797724,-76.222995]</span>,<span class="hljs-selector-attr">[-70.600724,-76.634494]</span>,<span class="hljs-selector-attr">[-72.206776,-76.673665]</span>,<span class="hljs-selector-attr">[-73.969536,-76.634494]</span>,<span class="hljs-selector-attr">[-75.555977,-76.712887]</span>,<span class="hljs-selector-attr">[-77.24037,-76.712887]</span>,<span class="hljs-selector-attr">[-76.926979,-77.104802]</span>,<span class="hljs-selector-attr">[-75.399294,-77.28107]</span>,<span class="hljs-selector-attr">[-74.282876,-77.55542]</span>,<span class="hljs-selector-attr">[-73.656119,-77.908112]</span>,<span class="hljs-selector-attr">[-74.772536,-78.221633]</span>,<span class="hljs-selector-attr">[-76.4961,-78.123654]</span>,<span class="hljs-selector-attr">[-77.925858,-78.378419]</span>,<span class="hljs-selector-attr">[-77.984666,-78.789918]</span>,<span class="hljs-selector-attr">[-78.023785,-79.181833]</span>,<span class="hljs-selector-attr">[-76.848637,-79.514939]</span>,<span class="hljs-selector-attr">[-76.633224,-79.887216]</span>,<span class="hljs-selector-attr">[-75.360097,-80.259545]</span>,<span class="hljs-selector-attr">[-73.244852,-80.416331]</span>,<span class="hljs-selector-attr">[-71.442946,-80.69063]</span>,<span class="hljs-selector-attr">[-70.013163,-81.004151]</span>,<span class="hljs-selector-attr">[-68.191646,-81.317672]</span>,<span class="hljs-selector-attr">[-65.704279,-81.474458]</span>,<span class="hljs-selector-attr">[-63.25603,-81.748757]</span>,<span class="hljs-selector-attr">[-61.552026,-82.042692]</span>,<span class="hljs-selector-attr">[-59.691416,-82.37585]</span>,<span class="hljs-selector-attr">[-58.712121,-82.846106]</span>,<span class="hljs-selector-attr">[-58.222487,-83.218434]</span>,<span class="hljs-selector-attr">[-57.008117,-82.865691]</span>,<span class="hljs-selector-attr">[-55.362894,-82.571755]</span>,<span class="hljs-selector-attr">[-53.619771,-82.258235]</span>,<span class="hljs-selector-attr">[-51.543644,-82.003521]</span>,<span class="hljs-selector-attr">[-49.76135,-81.729171]</span>,<span class="hljs-selector-attr">[-47.273931,-81.709586]</span>,<span class="hljs-selector-attr">[-44.825708,-81.846735]</span>,<span class="hljs-selector-attr">[-42.808363,-82.081915]</span>,<span class="hljs-selector-attr">[-42.16202,-81.65083]</span>,<span class="hljs-selector-attr">[-40.771433,-81.356894]</span>,<span class="hljs-selector-attr">[-38.244818,-81.337309]</span>,<span class="hljs-selector-attr">[-36.26667,-81.121715]</span>,<span class="hljs-selector-attr">[-34.386397,-80.906172]</span>,<span class="hljs-selector-attr">[-32.310296,-80.769023]</span>,<span class="hljs-selector-attr">[-30.097098,-80.592651]</span>,<span class="hljs-selector-attr">[-28.549802,-80.337938]</span>,<span class="hljs-selector-attr">[-29.254901,-79.985195]</span>,<span class="hljs-selector-attr">[-29.685805,-79.632503]</span>,<span class="hljs-selector-attr">[-29.685805,-79.260226]</span>,<span class="hljs-selector-attr">[-31.624808,-79.299397]</span>,<span class="hljs-selector-attr">[-33.681324,-79.456132]</span>,<span class="hljs-selector-attr">[-35.639912,-79.456132]</span>,<span class="hljs-selector-attr">[-35.914107,-79.083855]</span>,<span class="hljs-selector-attr">[-35.77701,-78.339248]</span>,<span class="hljs-selector-attr">[-35.326546,-78.123654]</span>,<span class="hljs-selector-attr">[-33.896763,-77.888526]</span>,<span class="hljs-selector-attr">[-32.212369,-77.65345]</span>,<span class="hljs-selector-attr">[-30.998051,-77.359515]</span>,<span class="hljs-selector-attr">[-29.783732,-77.065579]</span>,<span class="hljs-selector-attr">[-28.882779,-76.673665]</span>,<span class="hljs-selector-attr">[-27.511752,-76.497345]</span>,<span class="hljs-selector-attr">[-26.160336,-76.360144]</span>,<span class="hljs-selector-attr">[-25.474822,-76.281803]</span>,<span class="hljs-selector-attr">[-23.927552,-76.24258]</span>,<span class="hljs-selector-attr">[-22.458598,-76.105431]</span>,<span class="hljs-selector-attr">[-21.224694,-75.909474]</span>,<span class="hljs-selector-attr">[-20.010375,-75.674346]</span>,<span class="hljs-selector-attr">[-18.913543,-75.439218]</span>,<span class="hljs-selector-attr">[-17.522982,-75.125698]</span>,<span class="hljs-selector-attr">[-16.641589,-74.79254]</span>,<span class="hljs-selector-attr">[-15.701491,-74.498604]</span>,<span class="hljs-selector-attr">[-15.40771,-74.106742]</span>,<span class="hljs-selector-attr">[-16.46532,-73.871614]</span>,<span class="hljs-selector-attr">[-16.112784,-73.460114]</span>,<span class="hljs-selector-attr">[-15.446855,-73.146542]</span>,<span class="hljs-selector-attr">[-14.408805,-72.950585]</span>,<span class="hljs-selector-attr">[-13.311973,-72.715457]</span>,<span class="hljs-selector-attr">[-12.293508,-72.401936]</span>,<span class="hljs-selector-attr">[-11.510067,-72.010074]</span>,<span class="hljs-selector-attr">[-11.020433,-71.539767]</span>,<span class="hljs-selector-attr">[-10.295774,-71.265416]</span>,<span class="hljs-selector-attr">[-9.101015,-71.324224]</span>,<span class="hljs-selector-attr">[-8.611381,-71.65733]</span>,<span class="hljs-selector-attr">[-7.416622,-71.696501]</span>,<span class="hljs-selector-attr">[-7.377451,-71.324224]</span>,<span class="hljs-selector-attr">[-6.868232,-70.93231]</span>,<span class="hljs-selector-attr">[-5.790985,-71.030289]</span>,<span class="hljs-selector-attr">[-5.536375,-71.402617]</span>,<span class="hljs-selector-attr">[-4.341667,-71.461373]</span>,<span class="hljs-selector-attr">[-3.048981,-71.285053]</span>,<span class="hljs-selector-attr">[-1.795492,-71.167438]</span>,<span class="hljs-selector-attr">[-0.659489,-71.226246]</span>,<span class="hljs-selector-attr">[-0.228637,-71.637745]</span>,<span class="hljs-selector-attr">[0.868195,-71.304639]</span>,<span class="hljs-selector-attr">[1.886686,-71.128267]</span>,<span class="hljs-selector-attr">[3.022638,-70.991118]</span>,<span class="hljs-selector-attr">[4.139055,-70.853917]</span>,<span class="hljs-selector-attr">[5.157546,-70.618789]</span>,<span class="hljs-selector-attr">[6.273912,-70.462055]</span>,<span class="hljs-selector-attr">[7.13572,-70.246512]</span>,<span class="hljs-selector-attr">[7.742866,-69.893769]</span>,<span class="hljs-selector-attr">[8.48711,-70.148534]</span>,<span class="hljs-selector-attr">[9.525135,-70.011333]</span>,<span class="hljs-selector-attr">[10.249845,-70.48164]</span>,<span class="hljs-selector-attr">[10.817821,-70.834332]</span>,<span class="hljs-selector-attr">[11.953824,-70.638375]</span>,<span class="hljs-selector-attr">[12.404287,-70.246512]</span>,<span class="hljs-selector-attr">[13.422778,-69.972162]</span>,<span class="hljs-selector-attr">[14.734998,-70.030918]</span>,<span class="hljs-selector-attr">[15.126757,-70.403247]</span>,<span class="hljs-selector-attr">[15.949342,-70.030918]</span>,<span class="hljs-selector-attr">[17.026589,-69.913354]</span>,<span class="hljs-selector-attr">[18.201711,-69.874183]</span>,<span class="hljs-selector-attr">[19.259373,-69.893769]</span>,<span class="hljs-selector-attr">[20.375739,-70.011333]</span>,<span class="hljs-selector-attr">[21.452985,-70.07014]</span>,<span class="hljs-selector-attr">[21.923034,-70.403247]</span>,<span class="hljs-selector-attr">[22.569403,-70.697182]</span>,<span class="hljs-selector-attr">[23.666184,-70.520811]</span>,<span class="hljs-selector-attr">[24.841357,-70.48164]</span>,<span class="hljs-selector-attr">[25.977309,-70.48164]</span>,<span class="hljs-selector-attr">[27.093726,-70.462055]</span>,<span class="hljs-selector-attr">[28.09258,-70.324854]</span>,<span class="hljs-selector-attr">[29.150242,-70.20729]</span>,<span class="hljs-selector-attr">[30.031583,-69.93294]</span>,<span class="hljs-selector-attr">[30.971733,-69.75662]</span>,<span class="hljs-selector-attr">[31.990172,-69.658641]</span>,<span class="hljs-selector-attr">[32.754053,-69.384291]</span>,<span class="hljs-selector-attr">[33.302443,-68.835642]</span>,<span class="hljs-selector-attr">[33.870419,-68.502588]</span>,<span class="hljs-selector-attr">[34.908495,-68.659271]</span>,<span class="hljs-selector-attr">[35.300202,-69.012014]</span>,<span class="hljs-selector-attr">[36.16201,-69.247142]</span>,<span class="hljs-selector-attr">[37.200035,-69.168748]</span>,<span class="hljs-selector-attr">[37.905108,-69.52144]</span>,<span class="hljs-selector-attr">[38.649404,-69.776205]</span>,<span class="hljs-selector-attr">[39.667894,-69.541077]</span>,<span class="hljs-selector-attr">[40.020431,-69.109941]</span>,<span class="hljs-selector-attr">[40.921358,-68.933621]</span>,<span class="hljs-selector-attr">[41.959434,-68.600514]</span>,<span class="hljs-selector-attr">[42.938702,-68.463313]</span>,<span class="hljs-selector-attr">[44.113876,-68.267408]</span>,<span class="hljs-selector-attr">[44.897291,-68.051866]</span>,<span class="hljs-selector-attr">[45.719928,-67.816738]</span>,<span class="hljs-selector-attr">[46.503343,-67.601196]</span>,<span class="hljs-selector-attr">[47.44344,-67.718759]</span>,<span class="hljs-selector-attr">[48.344419,-67.366068]</span>,<span class="hljs-selector-attr">[48.990736,-67.091718]</span>,<span class="hljs-selector-attr">[49.930885,-67.111303]</span>,<span class="hljs-selector-attr">[50.753471,-66.876175]</span>,<span class="hljs-selector-attr">[50.949325,-66.523484]</span>,<span class="hljs-selector-attr">[51.791547,-66.249133]</span>,<span class="hljs-selector-attr">[52.614133,-66.053176]</span>,<span class="hljs-selector-attr">[53.613038,-65.89639]</span>,<span class="hljs-selector-attr">[54.53355,-65.818049]</span>,<span class="hljs-selector-attr">[55.414943,-65.876805]</span>,<span class="hljs-selector-attr">[56.355041,-65.974783]</span>,<span class="hljs-selector-attr">[57.158093,-66.249133]</span>,<span class="hljs-selector-attr">[57.255968,-66.680218]</span>,<span class="hljs-selector-attr">[58.137361,-67.013324]</span>,<span class="hljs-selector-attr">[58.744508,-67.287675]</span>,<span class="hljs-selector-attr">[59.939318,-67.405239]</span>,<span class="hljs-selector-attr">[60.605221,-67.679589]</span>,<span class="hljs-selector-attr">[61.427806,-67.953887]</span>,<span class="hljs-selector-attr">[62.387489,-68.012695]</span>,<span class="hljs-selector-attr">[63.19049,-67.816738]</span>,<span class="hljs-selector-attr">[64.052349,-67.405239]</span>,<span class="hljs-selector-attr">[64.992447,-67.620729]</span>,<span class="hljs-selector-attr">[65.971715,-67.738345]</span>,<span class="hljs-selector-attr">[66.911864,-67.855909]</span>,<span class="hljs-selector-attr">[67.891133,-67.934302]</span>,<span class="hljs-selector-attr">[68.890038,-67.934302]</span>,<span class="hljs-selector-attr">[69.712624,-68.972791]</span>,<span class="hljs-selector-attr">[69.673453,-69.227556]</span>,<span class="hljs-selector-attr">[69.555941,-69.678226]</span>,<span class="hljs-selector-attr">[68.596258,-69.93294]</span>,<span class="hljs-selector-attr">[67.81274,-70.305268]</span>,<span class="hljs-selector-attr">[67.949889,-70.697182]</span>,<span class="hljs-selector-attr">[69.066307,-70.677545]</span>,<span class="hljs-selector-attr">[68.929157,-71.069459]</span>,<span class="hljs-selector-attr">[68.419989,-71.441788]</span>,<span class="hljs-selector-attr">[67.949889,-71.853287]</span>,<span class="hljs-selector-attr">[68.71377,-72.166808]</span>,<span class="hljs-selector-attr">[69.869307,-72.264787]</span>,<span class="hljs-selector-attr">[71.024895,-72.088415]</span>,<span class="hljs-selector-attr">[71.573285,-71.696501]</span>,<span class="hljs-selector-attr">[71.906288,-71.324224]</span>,<span class="hljs-selector-attr">[72.454627,-71.010703]</span>,<span class="hljs-selector-attr">[73.08141,-70.716768]</span>,<span class="hljs-selector-attr">[73.33602,-70.364024]</span>,<span class="hljs-selector-attr">[73.864877,-69.874183]</span>,<span class="hljs-selector-attr">[74.491557,-69.776205]</span>,<span class="hljs-selector-attr">[75.62756,-69.737034]</span>,<span class="hljs-selector-attr">[76.626465,-69.619419]</span>,<span class="hljs-selector-attr">[77.644904,-69.462684]</span>,<span class="hljs-selector-attr">[78.134539,-69.07077]</span>,<span class="hljs-selector-attr">[78.428371,-68.698441]</span>,<span class="hljs-selector-attr">[79.113859,-68.326216]</span>,<span class="hljs-selector-attr">[80.093127,-68.071503]</span>,<span class="hljs-selector-attr">[80.93535,-67.875546]</span>,<span class="hljs-selector-attr">[81.483792,-67.542388]</span>,<span class="hljs-selector-attr">[82.051767,-67.366068]</span>,<span class="hljs-selector-attr">[82.776426,-67.209282]</span>,<span class="hljs-selector-attr">[83.775331,-67.30726]</span>,<span class="hljs-selector-attr">[84.676206,-67.209282]</span>,<span class="hljs-selector-attr">[85.655527,-67.091718]</span>,<span class="hljs-selector-attr">[86.752359,-67.150474]</span>,<span class="hljs-selector-attr">[87.477017,-66.876175]</span>,<span class="hljs-selector-attr">[87.986289,-66.209911]</span>,<span class="hljs-selector-attr">[88.358411,-66.484261]</span>,<span class="hljs-selector-attr">[88.828408,-66.954568]</span>,<span class="hljs-selector-attr">[89.67063,-67.150474]</span>,<span class="hljs-selector-attr">[90.630365,-67.228867]</span>,<span class="hljs-selector-attr">[91.5901,-67.111303]</span>,<span class="hljs-selector-attr">[92.608539,-67.189696]</span>,<span class="hljs-selector-attr">[93.548637,-67.209282]</span>,<span class="hljs-selector-attr">[94.17542,-67.111303]</span>,<span class="hljs-selector-attr">[95.017591,-67.170111]</span>,<span class="hljs-selector-attr">[95.781472,-67.385653]</span>,<span class="hljs-selector-attr">[96.682399,-67.248504]</span>,<span class="hljs-selector-attr">[97.759646,-67.248504]</span>,<span class="hljs-selector-attr">[98.68021,-67.111303]</span>,<span class="hljs-selector-attr">[99.718182,-67.248504]</span>,<span class="hljs-selector-attr">[100.384188,-66.915346]</span>,<span class="hljs-selector-attr">[100.893356,-66.58224]</span>,<span class="hljs-selector-attr">[101.578896,-66.30789]</span>,<span class="hljs-selector-attr">[102.832411,-65.563284]</span>,<span class="hljs-selector-attr">[103.478676,-65.700485]</span>,<span class="hljs-selector-attr">[104.242557,-65.974783]</span>,<span class="hljs-selector-attr">[104.90846,-66.327527]</span>,<span class="hljs-selector-attr">[106.181561,-66.934931]</span>,<span class="hljs-selector-attr">[107.160881,-66.954568]</span>,<span class="hljs-selector-attr">[108.081393,-66.954568]</span>,<span class="hljs-selector-attr">[109.15864,-66.837004]</span>,<span class="hljs-selector-attr">[110.235835,-66.699804]</span>,<span class="hljs-selector-attr">[111.058472,-66.425505]</span>,<span class="hljs-selector-attr">[111.74396,-66.13157]</span>,<span class="hljs-selector-attr">[112.860378,-66.092347]</span>,<span class="hljs-selector-attr">[113.604673,-65.876805]</span>,<span class="hljs-selector-attr">[114.388088,-66.072762]</span>,<span class="hljs-selector-attr">[114.897308,-66.386283]</span>,<span class="hljs-selector-attr">[115.602381,-66.699804]</span>,<span class="hljs-selector-attr">[116.699161,-66.660633]</span>,<span class="hljs-selector-attr">[117.384701,-66.915346]</span>,<span class="hljs-selector-attr">[118.57946,-67.170111]</span>,<span class="hljs-selector-attr">[119.832924,-67.268089]</span>,<span class="hljs-selector-attr">[120.871,-67.189696]</span>,<span class="hljs-selector-attr">[121.654415,-66.876175]</span>,<span class="hljs-selector-attr">[122.320369,-66.562654]</span>,<span class="hljs-selector-attr">[123.221296,-66.484261]</span>,<span class="hljs-selector-attr">[124.122274,-66.621462]</span>,<span class="hljs-selector-attr">[125.160247,-66.719389]</span>,<span class="hljs-selector-attr">[126.100396,-66.562654]</span>,<span class="hljs-selector-attr">[127.001427,-66.562654]</span>,<span class="hljs-selector-attr">[127.882768,-66.660633]</span>,<span class="hljs-selector-attr">[128.80328,-66.758611]</span>,<span class="hljs-selector-attr">[129.704259,-66.58224]</span>,<span class="hljs-selector-attr">[130.781454,-66.425505]</span>,<span class="hljs-selector-attr">[131.799945,-66.386283]</span>,<span class="hljs-selector-attr">[132.935896,-66.386283]</span>,<span class="hljs-selector-attr">[133.85646,-66.288304]</span>,<span class="hljs-selector-attr">[134.757387,-66.209963]</span>,<span class="hljs-selector-attr">[135.031582,-65.72007]</span>,<span class="hljs-selector-attr">[135.070753,-65.308571]</span>,<span class="hljs-selector-attr">[135.697485,-65.582869]</span>,<span class="hljs-selector-attr">[135.873805,-66.033591]</span>,<span class="hljs-selector-attr">[136.206705,-66.44509]</span>,<span class="hljs-selector-attr">[136.618049,-66.778197]</span>,<span class="hljs-selector-attr">[137.460271,-66.954568]</span>,<span class="hljs-selector-attr">[138.596223,-66.895761]</span>,<span class="hljs-selector-attr">[139.908442,-66.876175]</span>,<span class="hljs-selector-attr">[140.809421,-66.817367]</span>,<span class="hljs-selector-attr">[142.121692,-66.817367]</span>,<span class="hljs-selector-attr">[143.061842,-66.797782]</span>,<span class="hljs-selector-attr">[144.374061,-66.837004]</span>,<span class="hljs-selector-attr">[145.490427,-66.915346]</span>,<span class="hljs-selector-attr">[146.195552,-67.228867]</span>,<span class="hljs-selector-attr">[145.999699,-67.601196]</span>,<span class="hljs-selector-attr">[146.646067,-67.895131]</span>,<span class="hljs-selector-attr">[147.723263,-68.130259]</span>,<span class="hljs-selector-attr">[148.839629,-68.385024]</span>,<span class="hljs-selector-attr">[150.132314,-68.561292]</span>,<span class="hljs-selector-attr">[151.483705,-68.71813]</span>,<span class="hljs-selector-attr">[152.502247,-68.874813]</span>,<span class="hljs-selector-attr">[153.638199,-68.894502]</span>,<span class="hljs-selector-attr">[154.284567,-68.561292]</span>,<span class="hljs-selector-attr">[155.165857,-68.835642]</span>,<span class="hljs-selector-attr">[155.92979,-69.149215]</span>,<span class="hljs-selector-attr">[156.811132,-69.384291]</span>,<span class="hljs-selector-attr">[158.025528,-69.482269]</span>,<span class="hljs-selector-attr">[159.181013,-69.599833]</span>,<span class="hljs-selector-attr">[159.670699,-69.991747]</span>,<span class="hljs-selector-attr">[160.80665,-70.226875]</span>,<span class="hljs-selector-attr">[161.570479,-70.579618]</span>,<span class="hljs-selector-attr">[162.686897,-70.736353]</span>,<span class="hljs-selector-attr">[163.842434,-70.716768]</span>,<span class="hljs-selector-attr">[164.919681,-70.775524]</span>,<span class="hljs-selector-attr">[166.11444,-70.755938]</span>,<span class="hljs-selector-attr">[167.309095,-70.834332]</span>,<span class="hljs-selector-attr">[168.425616,-70.971481]</span>,<span class="hljs-selector-attr">[169.463589,-71.20666]</span>,<span class="hljs-selector-attr">[170.501665,-71.402617]</span>,<span class="hljs-selector-attr">[171.20679,-71.696501]</span>,<span class="hljs-selector-attr">[171.089227,-72.088415]</span>,<span class="hljs-selector-attr">[170.560422,-72.441159]</span>,<span class="hljs-selector-attr">[170.109958,-72.891829]</span>,<span class="hljs-selector-attr">[169.75737,-73.24452]</span>,<span class="hljs-selector-attr">[169.287321,-73.65602]</span>,<span class="hljs-selector-attr">[167.975101,-73.812806]</span>,<span class="hljs-selector-attr">[167.387489,-74.165498]</span>,<span class="hljs-selector-attr">[166.094803,-74.38104]</span>,<span class="hljs-selector-attr">[165.644391,-74.772954]</span>,<span class="hljs-selector-attr">[164.958851,-75.145283]</span>,<span class="hljs-selector-attr">[164.234193,-75.458804]</span>,<span class="hljs-selector-attr">[163.822797,-75.870303]</span>,<span class="hljs-selector-attr">[163.568239,-76.24258]</span>,<span class="hljs-selector-attr">[163.47026,-76.693302]</span>,<span class="hljs-selector-attr">[163.489897,-77.065579]</span>,<span class="hljs-selector-attr">[164.057873,-77.457442]</span>,<span class="hljs-selector-attr">[164.273363,-77.82977]</span>,<span class="hljs-selector-attr">[164.743464,-78.182514]</span>,<span class="hljs-selector-attr">[166.604126,-78.319611]</span>,<span class="hljs-selector-attr">[166.995781,-78.750748]</span>,<span class="hljs-selector-attr">[165.193876,-78.907483]</span>,<span class="hljs-selector-attr">[163.666217,-79.123025]</span>,<span class="hljs-selector-attr">[161.766385,-79.162248]</span>,<span class="hljs-selector-attr">[160.924162,-79.730482]</span>,<span class="hljs-selector-attr">[160.747894,-80.200737]</span>,<span class="hljs-selector-attr">[160.316964,-80.573066]</span>,<span class="hljs-selector-attr">[159.788211,-80.945395]</span>,<span class="hljs-selector-attr">[161.120016,-81.278501]</span>,<span class="hljs-selector-attr">[161.629287,-81.690001]</span>,<span class="hljs-selector-attr">[162.490992,-82.062278]</span>,<span class="hljs-selector-attr">[163.705336,-82.395435]</span>,<span class="hljs-selector-attr">[165.095949,-82.708956]</span>,<span class="hljs-selector-attr">[166.604126,-83.022477]</span>,<span class="hljs-selector-attr">[168.895665,-83.335998]</span>,<span class="hljs-selector-attr">[169.404782,-83.825891]</span>,<span class="hljs-selector-attr">[172.283934,-84.041433]</span>,<span class="hljs-selector-attr">[172.477049,-84.117914]</span>,<span class="hljs-selector-attr">[173.224083,-84.41371]</span>,<span class="hljs-selector-attr">[175.985672,-84.158997]</span>,<span class="hljs-selector-attr">[178.277212,-84.472518]</span>,<span class="hljs-selector-attr">[180,-84.71338]</span>,<span class="hljs-selector-attr">[-179.942499,-84.721443]</span>,<span class="hljs-selector-attr">[-179.058677,-84.139412]</span>,<span class="hljs-selector-attr">[-177.256772,-84.452933]</span>,<span class="hljs-selector-attr">[-177.140807,-84.417941]</span>,<span class="hljs-selector-attr">[-176.084673,-84.099259]</span>,<span class="hljs-selector-attr">[-175.947235,-84.110449]</span>,<span class="hljs-selector-attr">[-175.829882,-84.117914]</span>,<span class="hljs-selector-attr">[-174.382503,-84.534323]</span>,<span class="hljs-selector-attr">[-173.116559,-84.117914]</span>,<span class="hljs-selector-attr">[-172.889106,-84.061019]</span>,<span class="hljs-selector-attr">[-169.951223,-83.884647]</span>,<span class="hljs-selector-attr">[-168.999989,-84.117914]</span>,<span class="hljs-selector-attr">[-168.530199,-84.23739]</span>,<span class="hljs-selector-attr">[-167.022099,-84.570497]</span>,<span class="hljs-selector-attr">[-164.182144,-84.82521]</span>,<span class="hljs-selector-attr">[-161.929775,-85.138731]</span>,<span class="hljs-selector-attr">[-158.07138,-85.37391]</span>,<span class="hljs-selector-attr">[-155.192253,-85.09956]</span>,<span class="hljs-selector-attr">[-150.942099,-85.295517]</span>,<span class="hljs-selector-attr">[-148.533073,-85.609038]</span>,<span class="hljs-selector-attr">[-145.888918,-85.315102]</span>,<span class="hljs-selector-attr">[-143.107718,-85.040752]</span>,<span class="hljs-selector-attr">[-142.892279,-84.570497]</span>,<span class="hljs-selector-attr">[-146.829068,-84.531274]</span>,<span class="hljs-selector-attr">[-150.060732,-84.296146]</span>,<span class="hljs-selector-attr">[-150.902928,-83.904232]</span>,<span class="hljs-selector-attr">[-153.586201,-83.68869]</span>,<span class="hljs-selector-attr">[-153.409907,-83.23802]</span>,<span class="hljs-selector-attr">[-153.037759,-82.82652]</span>,<span class="hljs-selector-attr">[-152.665637,-82.454192]</span>,<span class="hljs-selector-attr">[-152.861517,-82.042692]</span>,<span class="hljs-selector-attr">[-154.526299,-81.768394]</span>,<span class="hljs-selector-attr">[-155.29018,-81.41565]</span>,<span class="hljs-selector-attr">[-156.83745,-81.102129]</span>,<span class="hljs-selector-attr">[-154.408787,-81.160937]</span>,<span class="hljs-selector-attr">[-152.097662,-81.004151]</span>,<span class="hljs-selector-attr">[-150.648293,-81.337309]</span>,<span class="hljs-selector-attr">[-148.865998,-81.043373]</span>,<span class="hljs-selector-attr">[-147.22075,-80.671045]</span>,<span class="hljs-selector-attr">[-146.417749,-80.337938]</span>,<span class="hljs-selector-attr">[-146.770286,-79.926439]</span>,<span class="hljs-selector-attr">[-148.062947,-79.652089]</span>,<span class="hljs-selector-attr">[-149.531901,-79.358205]</span>,<span class="hljs-selector-attr">[-151.588416,-79.299397]</span>,<span class="hljs-selector-attr">[-153.390322,-79.162248]</span>,<span class="hljs-selector-attr">[-155.329376,-79.064269]</span>,<span class="hljs-selector-attr">[-155.975668,-78.69194]</span>,<span class="hljs-selector-attr">[-157.268302,-78.378419]</span>,<span class="hljs-selector-attr">[-158.051768,-78.025676]</span>,<span class="hljs-selector-attr">[-158.365134,-76.889207]</span>,<span class="hljs-selector-attr">[-157.875474,-76.987238]</span>,<span class="hljs-selector-attr">[-156.974573,-77.300759]</span>,<span class="hljs-selector-attr">[-155.329376,-77.202728]</span>,<span class="hljs-selector-attr">[-153.742832,-77.065579]</span>,<span class="hljs-selector-attr">[-152.920247,-77.496664]</span>,<span class="hljs-selector-attr">[-151.33378,-77.398737]</span>,<span class="hljs-selector-attr">[-150.00195,-77.183143]</span>,<span class="hljs-selector-attr">[-148.748486,-76.908845]</span>,<span class="hljs-selector-attr">[-147.612483,-76.575738]</span>,<span class="hljs-selector-attr">[-146.104409,-76.47776]</span>,<span class="hljs-selector-attr">[-146.143528,-76.105431]</span>,<span class="hljs-selector-attr">[-146.496091,-75.733154]</span>,<span class="hljs-selector-attr">[-146.20231,-75.380411]</span>,<span class="hljs-selector-attr">[-144.909624,-75.204039]</span>,<span class="hljs-selector-attr">[-144.322037,-75.537197]</span>,<span class="hljs-selector-attr">[-142.794353,-75.34124]</span>,<span class="hljs-selector-attr">[-141.638764,-75.086475]</span>,<span class="hljs-selector-attr">[-140.209007,-75.06689]</span>,<span class="hljs-selector-attr">[-138.85759,-74.968911]</span>,<span class="hljs-selector-attr">[-137.5062,-74.733783]</span>,<span class="hljs-selector-attr">[-136.428901,-74.518241]</span>,<span class="hljs-selector-attr">[-135.214583,-74.302699]</span>,<span class="hljs-selector-attr">[-134.431194,-74.361455]</span>,<span class="hljs-selector-attr">[-133.745654,-74.439848]</span>,<span class="hljs-selector-attr">[-132.257168,-74.302699]</span>,<span class="hljs-selector-attr">[-130.925311,-74.479019]</span>,<span class="hljs-selector-attr">[-129.554284,-74.459433]</span>,<span class="hljs-selector-attr">[-128.242038,-74.322284]</span>,<span class="hljs-selector-attr">[-126.890622,-74.420263]</span>,<span class="hljs-selector-attr">[-125.402082,-74.518241]</span>,<span class="hljs-selector-attr">[-124.011496,-74.479019]</span>,<span class="hljs-selector-attr">[-122.562152,-74.498604]</span>,<span class="hljs-selector-attr">[-121.073613,-74.518241]</span>,<span class="hljs-selector-attr">[-119.70256,-74.479019]</span>,<span class="hljs-selector-attr">[-118.684145,-74.185083]</span>,<span class="hljs-selector-attr">[-117.469801,-74.028348]</span>,<span class="hljs-selector-attr">[-116.216312,-74.243891]</span>,<span class="hljs-selector-attr">[-115.021552,-74.067519]</span>,<span class="hljs-selector-attr">[-113.944331,-73.714828]</span>,<span class="hljs-selector-attr">[-113.297988,-74.028348]</span>,<span class="hljs-selector-attr">[-112.945452,-74.38104]</span>,<span class="hljs-selector-attr">[-112.299083,-74.714198]</span>,<span class="hljs-selector-attr">[-111.261059,-74.420263]</span>,<span class="hljs-selector-attr">[-110.066325,-74.79254]</span>,<span class="hljs-selector-attr">[-108.714909,-74.910103]</span>,<span class="hljs-selector-attr">[-107.559346,-75.184454]</span>,<span class="hljs-selector-attr">[-106.149148,-75.125698]</span>,<span class="hljs-selector-attr">[-104.876074,-74.949326]</span>,<span class="hljs-selector-attr">[-103.367949,-74.988497]</span>,<span class="hljs-selector-attr">[-102.016507,-75.125698]</span>,<span class="hljs-selector-attr">[-100.645531,-75.302018]</span>,<span class="hljs-selector-attr">[-100.1167,-74.870933]</span>,<span class="hljs-selector-attr">[-100.763043,-74.537826]</span>,<span class="hljs-selector-attr">[-101.252703,-74.185083]</span>,<span class="hljs-selector-attr">[-102.545337,-74.106742]</span>,<span class="hljs-selector-attr">[-103.113313,-73.734413]</span>,<span class="hljs-selector-attr">[-103.328752,-73.362084]</span>,<span class="hljs-selector-attr">[-103.681289,-72.61753]</span>,<span class="hljs-selector-attr">[-102.917485,-72.754679]</span>,<span class="hljs-selector-attr">[-101.60524,-72.813436]</span>,<span class="hljs-selector-attr">[-100.312528,-72.754679]</span>,<span class="hljs-selector-attr">[-99.13738,-72.911414]</span>,<span class="hljs-selector-attr">[-98.118889,-73.20535]</span>,<span class="hljs-selector-attr">[-97.688037,-73.558041]</span>,<span class="hljs-selector-attr">[-96.336595,-73.616849]</span>,<span class="hljs-selector-attr">[-95.043961,-73.4797]</span>,<span class="hljs-selector-attr">[-93.672907,-73.283743]</span>,<span class="hljs-selector-attr">[-92.439003,-73.166179]</span>,<span class="hljs-selector-attr">[-91.420564,-73.401307]</span>,<span class="hljs-selector-attr">[-90.088733,-73.322914]</span>,<span class="hljs-selector-attr">[-89.226951,-72.558722]</span>,<span class="hljs-selector-attr">[-88.423951,-73.009393]</span>,<span class="hljs-selector-attr">[-87.268337,-73.185764]</span>,<span class="hljs-selector-attr">[-86.014822,-73.087786]</span>,<span class="hljs-selector-attr">[-85.192236,-73.4797]</span>,<span class="hljs-selector-attr">[-83.879991,-73.518871]</span>,<span class="hljs-selector-attr">[-82.665646,-73.636434]</span>,<span class="hljs-selector-attr">[-81.470913,-73.851977]</span>,<span class="hljs-selector-attr">[-80.687447,-73.4797]</span>,<span class="hljs-selector-attr">[-80.295791,-73.126956]</span>,<span class="hljs-selector-attr">[-79.296886,-73.518871]</span>,<span class="hljs-selector-attr">[-77.925858,-73.420892]</span>,<span class="hljs-selector-attr">[-76.907367,-73.636434]</span>,<span class="hljs-selector-attr">[-76.221879,-73.969541]</span>,<span class="hljs-selector-attr">[-74.890049,-73.871614]</span>,<span class="hljs-selector-attr">[-73.852024,-73.65602]</span>,<span class="hljs-selector-attr">[-72.833533,-73.401307]</span>,<span class="hljs-selector-attr">[-71.619215,-73.264157]</span>,<span class="hljs-selector-attr">[-70.209042,-73.146542]</span>,<span class="hljs-selector-attr">[-68.935916,-73.009393]</span>,<span class="hljs-selector-attr">[-67.956622,-72.79385]</span>,<span class="hljs-selector-attr">[-67.369061,-72.480329]</span>,<span class="hljs-selector-attr">[-67.134036,-72.049244]</span>,<span class="hljs-selector-attr">[-67.251548,-71.637745]</span>,<span class="hljs-selector-attr">[-67.56494,-71.245831]</span>,<span class="hljs-selector-attr">[-67.917477,-70.853917]</span>,<span class="hljs-selector-attr">[-68.230843,-70.462055]</span>,<span class="hljs-selector-attr">[-68.485452,-70.109311]</span>,<span class="hljs-selector-attr">[-68.544209,-69.717397]</span>,<span class="hljs-selector-attr">[-68.446282,-69.325535]</span>,<span class="hljs-selector-attr">[-67.976233,-68.953206]</span>,<span class="hljs-selector-attr">[-67.5845,-68.541707]</span>,<span class="hljs-selector-attr">[-67.427843,-68.149844]</span>,<span class="hljs-selector-attr">[-67.62367,-67.718759]</span>,<span class="hljs-selector-attr">[-67.741183,-67.326845]</span>,<span class="hljs-selector-attr">[-67.251548,-66.876175]</span>,<span class="hljs-selector-attr">[-66.703184,-66.58224]</span>,<span class="hljs-selector-attr">[-66.056815,-66.209963]</span>,<span class="hljs-selector-attr">[-65.371327,-65.89639]</span>,<span class="hljs-selector-attr">[-64.568276,-65.602506]</span>,<span class="hljs-selector-attr">[-64.176542,-65.171423]</span>,<span class="hljs-selector-attr">[-63.628152,-64.897073]</span>,<span class="hljs-selector-attr">[-63.001394,-64.642308]</span>,<span class="hljs-selector-attr">[-62.041686,-64.583552]</span>,<span class="hljs-selector-attr">[-61.414928,-64.270031]</span>,<span class="hljs-selector-attr">[-60.709855,-64.074074]</span>,<span class="hljs-selector-attr">[-59.887269,-63.95651]</span>,<span class="hljs-selector-attr">[-59.162585,-63.701745]</span>,<span class="hljs-selector-attr">[-58.594557,-63.388224]</span>,<span class="hljs-selector-attr">[-57.811143,-63.27066]</span>,<span class="hljs-selector-attr">[-57.223582,-63.525425]</span>,<span class="hljs-selector-attr">[-57.59573,-63.858532]</span>,<span class="hljs-selector-attr">[-58.614143,-64.152467]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">ATF</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">French</span> <span class="hljs-selector-tag">Southern</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">Antarctic</span> <span class="hljs-selector-tag">Lands</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[68.935,-48.625]</span>,<span class="hljs-selector-attr">[69.58,-48.94]</span>,<span class="hljs-selector-attr">[70.525,-49.065]</span>,<span class="hljs-selector-attr">[70.56,-49.255]</span>,<span class="hljs-selector-attr">[70.28,-49.71]</span>,<span class="hljs-selector-attr">[68.745,-49.775]</span>,<span class="hljs-selector-attr">[68.72,-49.2425]</span>,<span class="hljs-selector-attr">[68.8675,-48.83]</span>,<span class="hljs-selector-attr">[68.935,-48.625]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AUS</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Australia</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[145.397978,-40.792549]</span>,<span class="hljs-selector-attr">[146.364121,-41.137695]</span>,<span class="hljs-selector-attr">[146.908584,-41.000546]</span>,<span class="hljs-selector-attr">[147.689259,-40.808258]</span>,<span class="hljs-selector-attr">[148.289068,-40.875438]</span>,<span class="hljs-selector-attr">[148.359865,-42.062445]</span>,<span class="hljs-selector-attr">[148.017301,-42.407024]</span>,<span class="hljs-selector-attr">[147.914052,-43.211522]</span>,<span class="hljs-selector-attr">[147.564564,-42.937689]</span>,<span class="hljs-selector-attr">[146.870343,-43.634597]</span>,<span class="hljs-selector-attr">[146.663327,-43.580854]</span>,<span class="hljs-selector-attr">[146.048378,-43.549745]</span>,<span class="hljs-selector-attr">[145.43193,-42.693776]</span>,<span class="hljs-selector-attr">[145.29509,-42.03361]</span>,<span class="hljs-selector-attr">[144.718071,-41.162552]</span>,<span class="hljs-selector-attr">[144.743755,-40.703975]</span>,<span class="hljs-selector-attr">[145.397978,-40.792549]</span>]],<span class="hljs-selector-attr">[[[143.561811,-13.763656]</span>,<span class="hljs-selector-attr">[143.922099,-14.548311]</span>,<span class="hljs-selector-attr">[144.563714,-14.171176]</span>,<span class="hljs-selector-attr">[144.894908,-14.594458]</span>,<span class="hljs-selector-attr">[145.374724,-14.984976]</span>,<span class="hljs-selector-attr">[145.271991,-15.428205]</span>,<span class="hljs-selector-attr">[145.48526,-16.285672]</span>,<span class="hljs-selector-attr">[145.637033,-16.784918]</span>,<span class="hljs-selector-attr">[145.888904,-16.906926]</span>,<span class="hljs-selector-attr">[146.160309,-17.761655]</span>,<span class="hljs-selector-attr">[146.063674,-18.280073]</span>,<span class="hljs-selector-attr">[146.387478,-18.958274]</span>,<span class="hljs-selector-attr">[147.471082,-19.480723]</span>,<span class="hljs-selector-attr">[148.177602,-19.955939]</span>,<span class="hljs-selector-attr">[148.848414,-20.39121]</span>,<span class="hljs-selector-attr">[148.717465,-20.633469]</span>,<span class="hljs-selector-attr">[149.28942,-21.260511]</span>,<span class="hljs-selector-attr">[149.678337,-22.342512]</span>,<span class="hljs-selector-attr">[150.077382,-22.122784]</span>,<span class="hljs-selector-attr">[150.482939,-22.556142]</span>,<span class="hljs-selector-attr">[150.727265,-22.402405]</span>,<span class="hljs-selector-attr">[150.899554,-23.462237]</span>,<span class="hljs-selector-attr">[151.609175,-24.076256]</span>,<span class="hljs-selector-attr">[152.07354,-24.457887]</span>,<span class="hljs-selector-attr">[152.855197,-25.267501]</span>,<span class="hljs-selector-attr">[153.136162,-26.071173]</span>,<span class="hljs-selector-attr">[153.161949,-26.641319]</span>,<span class="hljs-selector-attr">[153.092909,-27.2603]</span>,<span class="hljs-selector-attr">[153.569469,-28.110067]</span>,<span class="hljs-selector-attr">[153.512108,-28.995077]</span>,<span class="hljs-selector-attr">[153.339095,-29.458202]</span>,<span class="hljs-selector-attr">[153.069241,-30.35024]</span>,<span class="hljs-selector-attr">[153.089602,-30.923642]</span>,<span class="hljs-selector-attr">[152.891578,-31.640446]</span>,<span class="hljs-selector-attr">[152.450002,-32.550003]</span>,<span class="hljs-selector-attr">[151.709117,-33.041342]</span>,<span class="hljs-selector-attr">[151.343972,-33.816023]</span>,<span class="hljs-selector-attr">[151.010555,-34.31036]</span>,<span class="hljs-selector-attr">[150.714139,-35.17346]</span>,<span class="hljs-selector-attr">[150.32822,-35.671879]</span>,<span class="hljs-selector-attr">[150.075212,-36.420206]</span>,<span class="hljs-selector-attr">[149.946124,-37.109052]</span>,<span class="hljs-selector-attr">[149.997284,-37.425261]</span>,<span class="hljs-selector-attr">[149.423882,-37.772681]</span>,<span class="hljs-selector-attr">[148.304622,-37.809061]</span>,<span class="hljs-selector-attr">[147.381733,-38.219217]</span>,<span class="hljs-selector-attr">[146.922123,-38.606532]</span>,<span class="hljs-selector-attr">[146.317922,-39.035757]</span>,<span class="hljs-selector-attr">[145.489652,-38.593768]</span>,<span class="hljs-selector-attr">[144.876976,-38.417448]</span>,<span class="hljs-selector-attr">[145.032212,-37.896188]</span>,<span class="hljs-selector-attr">[144.485682,-38.085324]</span>,<span class="hljs-selector-attr">[143.609974,-38.809465]</span>,<span class="hljs-selector-attr">[142.745427,-38.538268]</span>,<span class="hljs-selector-attr">[142.17833,-38.380034]</span>,<span class="hljs-selector-attr">[141.606582,-38.308514]</span>,<span class="hljs-selector-attr">[140.638579,-38.019333]</span>,<span class="hljs-selector-attr">[139.992158,-37.402936]</span>,<span class="hljs-selector-attr">[139.806588,-36.643603]</span>,<span class="hljs-selector-attr">[139.574148,-36.138362]</span>,<span class="hljs-selector-attr">[139.082808,-35.732754]</span>,<span class="hljs-selector-attr">[138.120748,-35.612296]</span>,<span class="hljs-selector-attr">[138.449462,-35.127261]</span>,<span class="hljs-selector-attr">[138.207564,-34.384723]</span>,<span class="hljs-selector-attr">[137.71917,-35.076825]</span>,<span class="hljs-selector-attr">[136.829406,-35.260535]</span>,<span class="hljs-selector-attr">[137.352371,-34.707339]</span>,<span class="hljs-selector-attr">[137.503886,-34.130268]</span>,<span class="hljs-selector-attr">[137.890116,-33.640479]</span>,<span class="hljs-selector-attr">[137.810328,-32.900007]</span>,<span class="hljs-selector-attr">[136.996837,-33.752771]</span>,<span class="hljs-selector-attr">[136.372069,-34.094766]</span>,<span class="hljs-selector-attr">[135.989043,-34.890118]</span>,<span class="hljs-selector-attr">[135.208213,-34.47867]</span>,<span class="hljs-selector-attr">[135.239218,-33.947953]</span>,<span class="hljs-selector-attr">[134.613417,-33.222778]</span>,<span class="hljs-selector-attr">[134.085904,-32.848072]</span>,<span class="hljs-selector-attr">[134.273903,-32.617234]</span>,<span class="hljs-selector-attr">[132.990777,-32.011224]</span>,<span class="hljs-selector-attr">[132.288081,-31.982647]</span>,<span class="hljs-selector-attr">[131.326331,-31.495803]</span>,<span class="hljs-selector-attr">[129.535794,-31.590423]</span>,<span class="hljs-selector-attr">[128.240938,-31.948489]</span>,<span class="hljs-selector-attr">[127.102867,-32.282267]</span>,<span class="hljs-selector-attr">[126.148714,-32.215966]</span>,<span class="hljs-selector-attr">[125.088623,-32.728751]</span>,<span class="hljs-selector-attr">[124.221648,-32.959487]</span>,<span class="hljs-selector-attr">[124.028947,-33.483847]</span>,<span class="hljs-selector-attr">[123.659667,-33.890179]</span>,<span class="hljs-selector-attr">[122.811036,-33.914467]</span>,<span class="hljs-selector-attr">[122.183064,-34.003402]</span>,<span class="hljs-selector-attr">[121.299191,-33.821036]</span>,<span class="hljs-selector-attr">[120.580268,-33.930177]</span>,<span class="hljs-selector-attr">[119.893695,-33.976065]</span>,<span class="hljs-selector-attr">[119.298899,-34.509366]</span>,<span class="hljs-selector-attr">[119.007341,-34.464149]</span>,<span class="hljs-selector-attr">[118.505718,-34.746819]</span>,<span class="hljs-selector-attr">[118.024972,-35.064733]</span>,<span class="hljs-selector-attr">[117.295507,-35.025459]</span>,<span class="hljs-selector-attr">[116.625109,-35.025097]</span>,<span class="hljs-selector-attr">[115.564347,-34.386428]</span>,<span class="hljs-selector-attr">[115.026809,-34.196517]</span>,<span class="hljs-selector-attr">[115.048616,-33.623425]</span>,<span class="hljs-selector-attr">[115.545123,-33.487258]</span>,<span class="hljs-selector-attr">[115.714674,-33.259572]</span>,<span class="hljs-selector-attr">[115.679379,-32.900369]</span>,<span class="hljs-selector-attr">[115.801645,-32.205062]</span>,<span class="hljs-selector-attr">[115.689611,-31.612437]</span>,<span class="hljs-selector-attr">[115.160909,-30.601594]</span>,<span class="hljs-selector-attr">[114.997043,-30.030725]</span>,<span class="hljs-selector-attr">[115.040038,-29.461095]</span>,<span class="hljs-selector-attr">[114.641974,-28.810231]</span>,<span class="hljs-selector-attr">[114.616498,-28.516399]</span>,<span class="hljs-selector-attr">[114.173579,-28.118077]</span>,<span class="hljs-selector-attr">[114.048884,-27.334765]</span>,<span class="hljs-selector-attr">[113.477498,-26.543134]</span>,<span class="hljs-selector-attr">[113.338953,-26.116545]</span>,<span class="hljs-selector-attr">[113.778358,-26.549025]</span>,<span class="hljs-selector-attr">[113.440962,-25.621278]</span>,<span class="hljs-selector-attr">[113.936901,-25.911235]</span>,<span class="hljs-selector-attr">[114.232852,-26.298446]</span>,<span class="hljs-selector-attr">[114.216161,-25.786281]</span>,<span class="hljs-selector-attr">[113.721255,-24.998939]</span>,<span class="hljs-selector-attr">[113.625344,-24.683971]</span>,<span class="hljs-selector-attr">[113.393523,-24.384764]</span>,<span class="hljs-selector-attr">[113.502044,-23.80635]</span>,<span class="hljs-selector-attr">[113.706993,-23.560215]</span>,<span class="hljs-selector-attr">[113.843418,-23.059987]</span>,<span class="hljs-selector-attr">[113.736552,-22.475475]</span>,<span class="hljs-selector-attr">[114.149756,-21.755881]</span>,<span class="hljs-selector-attr">[114.225307,-22.517488]</span>,<span class="hljs-selector-attr">[114.647762,-21.82952]</span>,<span class="hljs-selector-attr">[115.460167,-21.495173]</span>,<span class="hljs-selector-attr">[115.947373,-21.068688]</span>,<span class="hljs-selector-attr">[116.711615,-20.701682]</span>,<span class="hljs-selector-attr">[117.166316,-20.623599]</span>,<span class="hljs-selector-attr">[117.441545,-20.746899]</span>,<span class="hljs-selector-attr">[118.229559,-20.374208]</span>,<span class="hljs-selector-attr">[118.836085,-20.263311]</span>,<span class="hljs-selector-attr">[118.987807,-20.044203]</span>,<span class="hljs-selector-attr">[119.252494,-19.952942]</span>,<span class="hljs-selector-attr">[119.805225,-19.976506]</span>,<span class="hljs-selector-attr">[120.85622,-19.683708]</span>,<span class="hljs-selector-attr">[121.399856,-19.239756]</span>,<span class="hljs-selector-attr">[121.655138,-18.705318]</span>,<span class="hljs-selector-attr">[122.241665,-18.197649]</span>,<span class="hljs-selector-attr">[122.286624,-17.798603]</span>,<span class="hljs-selector-attr">[122.312772,-17.254967]</span>,<span class="hljs-selector-attr">[123.012574,-16.4052]</span>,<span class="hljs-selector-attr">[123.433789,-17.268558]</span>,<span class="hljs-selector-attr">[123.859345,-17.069035]</span>,<span class="hljs-selector-attr">[123.503242,-16.596506]</span>,<span class="hljs-selector-attr">[123.817073,-16.111316]</span>,<span class="hljs-selector-attr">[124.258287,-16.327944]</span>,<span class="hljs-selector-attr">[124.379726,-15.56706]</span>,<span class="hljs-selector-attr">[124.926153,-15.0751]</span>,<span class="hljs-selector-attr">[125.167275,-14.680396]</span>,<span class="hljs-selector-attr">[125.670087,-14.51007]</span>,<span class="hljs-selector-attr">[125.685796,-14.230656]</span>,<span class="hljs-selector-attr">[126.125149,-14.347341]</span>,<span class="hljs-selector-attr">[126.142823,-14.095987]</span>,<span class="hljs-selector-attr">[126.582589,-13.952791]</span>,<span class="hljs-selector-attr">[127.065867,-13.817968]</span>,<span class="hljs-selector-attr">[127.804633,-14.276906]</span>,<span class="hljs-selector-attr">[128.35969,-14.86917]</span>,<span class="hljs-selector-attr">[128.985543,-14.875991]</span>,<span class="hljs-selector-attr">[129.621473,-14.969784]</span>,<span class="hljs-selector-attr">[129.4096,-14.42067]</span>,<span class="hljs-selector-attr">[129.888641,-13.618703]</span>,<span class="hljs-selector-attr">[130.339466,-13.357376]</span>,<span class="hljs-selector-attr">[130.183506,-13.10752]</span>,<span class="hljs-selector-attr">[130.617795,-12.536392]</span>,<span class="hljs-selector-attr">[131.223495,-12.183649]</span>,<span class="hljs-selector-attr">[131.735091,-12.302453]</span>,<span class="hljs-selector-attr">[132.575298,-12.114041]</span>,<span class="hljs-selector-attr">[132.557212,-11.603012]</span>,<span class="hljs-selector-attr">[131.824698,-11.273782]</span>,<span class="hljs-selector-attr">[132.357224,-11.128519]</span>,<span class="hljs-selector-attr">[133.019561,-11.376411]</span>,<span class="hljs-selector-attr">[133.550846,-11.786515]</span>,<span class="hljs-selector-attr">[134.393068,-12.042365]</span>,<span class="hljs-selector-attr">[134.678632,-11.941183]</span>,<span class="hljs-selector-attr">[135.298491,-12.248606]</span>,<span class="hljs-selector-attr">[135.882693,-11.962267]</span>,<span class="hljs-selector-attr">[136.258381,-12.049342]</span>,<span class="hljs-selector-attr">[136.492475,-11.857209]</span>,<span class="hljs-selector-attr">[136.95162,-12.351959]</span>,<span class="hljs-selector-attr">[136.685125,-12.887223]</span>,<span class="hljs-selector-attr">[136.305407,-13.29123]</span>,<span class="hljs-selector-attr">[135.961758,-13.324509]</span>,<span class="hljs-selector-attr">[136.077617,-13.724278]</span>,<span class="hljs-selector-attr">[135.783836,-14.223989]</span>,<span class="hljs-selector-attr">[135.428664,-14.715432]</span>,<span class="hljs-selector-attr">[135.500184,-14.997741]</span>,<span class="hljs-selector-attr">[136.295175,-15.550265]</span>,<span class="hljs-selector-attr">[137.06536,-15.870762]</span>,<span class="hljs-selector-attr">[137.580471,-16.215082]</span>,<span class="hljs-selector-attr">[138.303217,-16.807604]</span>,<span class="hljs-selector-attr">[138.585164,-16.806622]</span>,<span class="hljs-selector-attr">[139.108543,-17.062679]</span>,<span class="hljs-selector-attr">[139.260575,-17.371601]</span>,<span class="hljs-selector-attr">[140.215245,-17.710805]</span>,<span class="hljs-selector-attr">[140.875463,-17.369069]</span>,<span class="hljs-selector-attr">[141.07111,-16.832047]</span>,<span class="hljs-selector-attr">[141.274095,-16.38887]</span>,<span class="hljs-selector-attr">[141.398222,-15.840532]</span>,<span class="hljs-selector-attr">[141.702183,-15.044921]</span>,<span class="hljs-selector-attr">[141.56338,-14.561333]</span>,<span class="hljs-selector-attr">[141.63552,-14.270395]</span>,<span class="hljs-selector-attr">[141.519869,-13.698078]</span>,<span class="hljs-selector-attr">[141.65092,-12.944688]</span>,<span class="hljs-selector-attr">[141.842691,-12.741548]</span>,<span class="hljs-selector-attr">[141.68699,-12.407614]</span>,<span class="hljs-selector-attr">[141.928629,-11.877466]</span>,<span class="hljs-selector-attr">[142.118488,-11.328042]</span>,<span class="hljs-selector-attr">[142.143706,-11.042737]</span>,<span class="hljs-selector-attr">[142.51526,-10.668186]</span>,<span class="hljs-selector-attr">[142.79731,-11.157355]</span>,<span class="hljs-selector-attr">[142.866763,-11.784707]</span>,<span class="hljs-selector-attr">[143.115947,-11.90563]</span>,<span class="hljs-selector-attr">[143.158632,-12.325656]</span>,<span class="hljs-selector-attr">[143.522124,-12.834358]</span>,<span class="hljs-selector-attr">[143.597158,-13.400422]</span>,<span class="hljs-selector-attr">[143.561811,-13.763656]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AUT</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Austria</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[16.979667,48.123497]</span>,<span class="hljs-selector-attr">[16.903754,47.714866]</span>,<span class="hljs-selector-attr">[16.340584,47.712902]</span>,<span class="hljs-selector-attr">[16.534268,47.496171]</span>,<span class="hljs-selector-attr">[16.202298,46.852386]</span>,<span class="hljs-selector-attr">[16.011664,46.683611]</span>,<span class="hljs-selector-attr">[15.137092,46.658703]</span>,<span class="hljs-selector-attr">[14.632472,46.431817]</span>,<span class="hljs-selector-attr">[13.806475,46.509306]</span>,<span class="hljs-selector-attr">[12.376485,46.767559]</span>,<span class="hljs-selector-attr">[12.153088,47.115393]</span>,<span class="hljs-selector-attr">[11.164828,46.941579]</span>,<span class="hljs-selector-attr">[11.048556,46.751359]</span>,<span class="hljs-selector-attr">[10.442701,46.893546]</span>,<span class="hljs-selector-attr">[9.932448,46.920728]</span>,<span class="hljs-selector-attr">[9.47997,47.10281]</span>,<span class="hljs-selector-attr">[9.632932,47.347601]</span>,<span class="hljs-selector-attr">[9.594226,47.525058]</span>,<span class="hljs-selector-attr">[9.896068,47.580197]</span>,<span class="hljs-selector-attr">[10.402084,47.302488]</span>,<span class="hljs-selector-attr">[10.544504,47.566399]</span>,<span class="hljs-selector-attr">[11.426414,47.523766]</span>,<span class="hljs-selector-attr">[12.141357,47.703083]</span>,<span class="hljs-selector-attr">[12.62076,47.672388]</span>,<span class="hljs-selector-attr">[12.932627,47.467646]</span>,<span class="hljs-selector-attr">[13.025851,47.637584]</span>,<span class="hljs-selector-attr">[12.884103,48.289146]</span>,<span class="hljs-selector-attr">[13.243357,48.416115]</span>,<span class="hljs-selector-attr">[13.595946,48.877172]</span>,<span class="hljs-selector-attr">[14.338898,48.555305]</span>,<span class="hljs-selector-attr">[14.901447,48.964402]</span>,<span class="hljs-selector-attr">[15.253416,49.039074]</span>,<span class="hljs-selector-attr">[16.029647,48.733899]</span>,<span class="hljs-selector-attr">[16.499283,48.785808]</span>,<span class="hljs-selector-attr">[16.960288,48.596982]</span>,<span class="hljs-selector-attr">[16.879983,48.470013]</span>,<span class="hljs-selector-attr">[16.979667,48.123497]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">AZE</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Azerbaijan</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[45.001987,39.740004]</span>,<span class="hljs-selector-attr">[45.298145,39.471751]</span>,<span class="hljs-selector-attr">[45.739978,39.473999]</span>,<span class="hljs-selector-attr">[45.735379,39.319719]</span>,<span class="hljs-selector-attr">[46.143623,38.741201]</span>,<span class="hljs-selector-attr">[45.457722,38.874139]</span>,<span class="hljs-selector-attr">[44.952688,39.335765]</span>,<span class="hljs-selector-attr">[44.79399,39.713003]</span>,<span class="hljs-selector-attr">[45.001987,39.740004]</span>]],<span class="hljs-selector-attr">[[[47.373315,41.219732]</span>,<span class="hljs-selector-attr">[47.815666,41.151416]</span>,<span class="hljs-selector-attr">[47.987283,41.405819]</span>,<span class="hljs-selector-attr">[48.584353,41.80887]</span>,<span class="hljs-selector-attr">[49.110264,41.282287]</span>,<span class="hljs-selector-attr">[49.618915,40.572924]</span>,<span class="hljs-selector-attr">[50.08483,40.526157]</span>,<span class="hljs-selector-attr">[50.392821,40.256561]</span>,<span class="hljs-selector-attr">[49.569202,40.176101]</span>,<span class="hljs-selector-attr">[49.395259,39.399482]</span>,<span class="hljs-selector-attr">[49.223228,39.049219]</span>,<span class="hljs-selector-attr">[48.856532,38.815486]</span>,<span class="hljs-selector-attr">[48.883249,38.320245]</span>,<span class="hljs-selector-attr">[48.634375,38.270378]</span>,<span class="hljs-selector-attr">[48.010744,38.794015]</span>,<span class="hljs-selector-attr">[48.355529,39.288765]</span>,<span class="hljs-selector-attr">[48.060095,39.582235]</span>,<span class="hljs-selector-attr">[47.685079,39.508364]</span>,<span class="hljs-selector-attr">[46.50572,38.770605]</span>,<span class="hljs-selector-attr">[46.483499,39.464155]</span>,<span class="hljs-selector-attr">[46.034534,39.628021]</span>,<span class="hljs-selector-attr">[45.610012,39.899994]</span>,<span class="hljs-selector-attr">[45.891907,40.218476]</span>,<span class="hljs-selector-attr">[45.359175,40.561504]</span>,<span class="hljs-selector-attr">[45.560351,40.81229]</span>,<span class="hljs-selector-attr">[45.179496,40.985354]</span>,<span class="hljs-selector-attr">[44.97248,41.248129]</span>,<span class="hljs-selector-attr">[45.217426,41.411452]</span>,<span class="hljs-selector-attr">[45.962601,41.123873]</span>,<span class="hljs-selector-attr">[46.501637,41.064445]</span>,<span class="hljs-selector-attr">[46.637908,41.181673]</span>,<span class="hljs-selector-attr">[46.145432,41.722802]</span>,<span class="hljs-selector-attr">[46.404951,41.860675]</span>,<span class="hljs-selector-attr">[46.686071,41.827137]</span>,<span class="hljs-selector-attr">[47.373315,41.219732]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BDI</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Burundi</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[29.339998,-4.499983]</span>,<span class="hljs-selector-attr">[29.276384,-3.293907]</span>,<span class="hljs-selector-attr">[29.024926,-2.839258]</span>,<span class="hljs-selector-attr">[29.632176,-2.917858]</span>,<span class="hljs-selector-attr">[29.938359,-2.348487]</span>,<span class="hljs-selector-attr">[30.469696,-2.413858]</span>,<span class="hljs-selector-attr">[30.527677,-2.807632]</span>,<span class="hljs-selector-attr">[30.743013,-3.034285]</span>,<span class="hljs-selector-attr">[30.752263,-3.35933]</span>,<span class="hljs-selector-attr">[30.50556,-3.568567]</span>,<span class="hljs-selector-attr">[30.116333,-4.090138]</span>,<span class="hljs-selector-attr">[29.753512,-4.452389]</span>,<span class="hljs-selector-attr">[29.339998,-4.499983]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BEL</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Belgium</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[3.314971,51.345781]</span>,<span class="hljs-selector-attr">[4.047071,51.267259]</span>,<span class="hljs-selector-attr">[4.973991,51.475024]</span>,<span class="hljs-selector-attr">[5.606976,51.037298]</span>,<span class="hljs-selector-attr">[6.156658,50.803721]</span>,<span class="hljs-selector-attr">[6.043073,50.128052]</span>,<span class="hljs-selector-attr">[5.782417,50.090328]</span>,<span class="hljs-selector-attr">[5.674052,49.529484]</span>,<span class="hljs-selector-attr">[4.799222,49.985373]</span>,<span class="hljs-selector-attr">[4.286023,49.907497]</span>,<span class="hljs-selector-attr">[3.588184,50.378992]</span>,<span class="hljs-selector-attr">[3.123252,50.780363]</span>,<span class="hljs-selector-attr">[2.658422,50.796848]</span>,<span class="hljs-selector-attr">[2.513573,51.148506]</span>,<span class="hljs-selector-attr">[3.314971,51.345781]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BEN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Benin</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[2.691702,6.258817]</span>,<span class="hljs-selector-attr">[1.865241,6.142158]</span>,<span class="hljs-selector-attr">[1.618951,6.832038]</span>,<span class="hljs-selector-attr">[1.664478,9.12859]</span>,<span class="hljs-selector-attr">[1.463043,9.334624]</span>,<span class="hljs-selector-attr">[1.425061,9.825395]</span>,<span class="hljs-selector-attr">[1.077795,10.175607]</span>,<span class="hljs-selector-attr">[0.772336,10.470808]</span>,<span class="hljs-selector-attr">[0.899563,10.997339]</span>,<span class="hljs-selector-attr">[1.24347,11.110511]</span>,<span class="hljs-selector-attr">[1.447178,11.547719]</span>,<span class="hljs-selector-attr">[1.935986,11.64115]</span>,<span class="hljs-selector-attr">[2.154474,11.94015]</span>,<span class="hljs-selector-attr">[2.490164,12.233052]</span>,<span class="hljs-selector-attr">[2.848643,12.235636]</span>,<span class="hljs-selector-attr">[3.61118,11.660167]</span>,<span class="hljs-selector-attr">[3.572216,11.327939]</span>,<span class="hljs-selector-attr">[3.797112,10.734746]</span>,<span class="hljs-selector-attr">[3.60007,10.332186]</span>,<span class="hljs-selector-attr">[3.705438,10.06321]</span>,<span class="hljs-selector-attr">[3.220352,9.444153]</span>,<span class="hljs-selector-attr">[2.912308,9.137608]</span>,<span class="hljs-selector-attr">[2.723793,8.506845]</span>,<span class="hljs-selector-attr">[2.749063,7.870734]</span>,<span class="hljs-selector-attr">[2.691702,6.258817]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BFA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Burkina</span> <span class="hljs-selector-tag">Faso</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-2.827496,9.642461]</span>,<span class="hljs-selector-attr">[-3.511899,9.900326]</span>,<span class="hljs-selector-attr">[-3.980449,9.862344]</span>,<span class="hljs-selector-attr">[-4.330247,9.610835]</span>,<span class="hljs-selector-attr">[-4.779884,9.821985]</span>,<span class="hljs-selector-attr">[-4.954653,10.152714]</span>,<span class="hljs-selector-attr">[-5.404342,10.370737]</span>,<span class="hljs-selector-attr">[-5.470565,10.95127]</span>,<span class="hljs-selector-attr">[-5.197843,11.375146]</span>,<span class="hljs-selector-attr">[-5.220942,11.713859]</span>,<span class="hljs-selector-attr">[-4.427166,12.542646]</span>,<span class="hljs-selector-attr">[-4.280405,13.228444]</span>,<span class="hljs-selector-attr">[-4.006391,13.472485]</span>,<span class="hljs-selector-attr">[-3.522803,13.337662]</span>,<span class="hljs-selector-attr">[-3.103707,13.541267]</span>,<span class="hljs-selector-attr">[-2.967694,13.79815]</span>,<span class="hljs-selector-attr">[-2.191825,14.246418]</span>,<span class="hljs-selector-attr">[-2.001035,14.559008]</span>,<span class="hljs-selector-attr">[-1.066363,14.973815]</span>,<span class="hljs-selector-attr">[-0.515854,15.116158]</span>,<span class="hljs-selector-attr">[-0.266257,14.924309]</span>,<span class="hljs-selector-attr">[0.374892,14.928908]</span>,<span class="hljs-selector-attr">[0.295646,14.444235]</span>,<span class="hljs-selector-attr">[0.429928,13.988733]</span>,<span class="hljs-selector-attr">[0.993046,13.33575]</span>,<span class="hljs-selector-attr">[1.024103,12.851826]</span>,<span class="hljs-selector-attr">[2.177108,12.625018]</span>,<span class="hljs-selector-attr">[2.154474,11.94015]</span>,<span class="hljs-selector-attr">[1.935986,11.64115]</span>,<span class="hljs-selector-attr">[1.447178,11.547719]</span>,<span class="hljs-selector-attr">[1.24347,11.110511]</span>,<span class="hljs-selector-attr">[0.899563,10.997339]</span>,<span class="hljs-selector-attr">[0.023803,11.018682]</span>,<span class="hljs-selector-attr">[-0.438702,11.098341]</span>,<span class="hljs-selector-attr">[-0.761576,10.93693]</span>,<span class="hljs-selector-attr">[-1.203358,11.009819]</span>,<span class="hljs-selector-attr">[-2.940409,10.96269]</span>,<span class="hljs-selector-attr">[-2.963896,10.395335]</span>,<span class="hljs-selector-attr">[-2.827496,9.642461]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BGD</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bangladesh</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[92.672721,22.041239]</span>,<span class="hljs-selector-attr">[92.652257,21.324048]</span>,<span class="hljs-selector-attr">[92.303234,21.475485]</span>,<span class="hljs-selector-attr">[92.368554,20.670883]</span>,<span class="hljs-selector-attr">[92.082886,21.192195]</span>,<span class="hljs-selector-attr">[92.025215,21.70157]</span>,<span class="hljs-selector-attr">[91.834891,22.182936]</span>,<span class="hljs-selector-attr">[91.417087,22.765019]</span>,<span class="hljs-selector-attr">[90.496006,22.805017]</span>,<span class="hljs-selector-attr">[90.586957,22.392794]</span>,<span class="hljs-selector-attr">[90.272971,21.836368]</span>,<span class="hljs-selector-attr">[89.847467,22.039146]</span>,<span class="hljs-selector-attr">[89.70205,21.857116]</span>,<span class="hljs-selector-attr">[89.418863,21.966179]</span>,<span class="hljs-selector-attr">[89.031961,22.055708]</span>,<span class="hljs-selector-attr">[88.876312,22.879146]</span>,<span class="hljs-selector-attr">[88.52977,23.631142]</span>,<span class="hljs-selector-attr">[88.69994,24.233715]</span>,<span class="hljs-selector-attr">[88.084422,24.501657]</span>,<span class="hljs-selector-attr">[88.306373,24.866079]</span>,<span class="hljs-selector-attr">[88.931554,25.238692]</span>,<span class="hljs-selector-attr">[88.209789,25.768066]</span>,<span class="hljs-selector-attr">[88.563049,26.446526]</span>,<span class="hljs-selector-attr">[89.355094,26.014407]</span>,<span class="hljs-selector-attr">[89.832481,25.965082]</span>,<span class="hljs-selector-attr">[89.920693,25.26975]</span>,<span class="hljs-selector-attr">[90.872211,25.132601]</span>,<span class="hljs-selector-attr">[91.799596,25.147432]</span>,<span class="hljs-selector-attr">[92.376202,24.976693]</span>,<span class="hljs-selector-attr">[91.915093,24.130414]</span>,<span class="hljs-selector-attr">[91.46773,24.072639]</span>,<span class="hljs-selector-attr">[91.158963,23.503527]</span>,<span class="hljs-selector-attr">[91.706475,22.985264]</span>,<span class="hljs-selector-attr">[91.869928,23.624346]</span>,<span class="hljs-selector-attr">[92.146035,23.627499]</span>,<span class="hljs-selector-attr">[92.672721,22.041239]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BGR</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bulgaria</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[22.65715,44.234923]</span>,<span class="hljs-selector-attr">[22.944832,43.823785]</span>,<span class="hljs-selector-attr">[23.332302,43.897011]</span>,<span class="hljs-selector-attr">[24.100679,43.741051]</span>,<span class="hljs-selector-attr">[25.569272,43.688445]</span>,<span class="hljs-selector-attr">[26.065159,43.943494]</span>,<span class="hljs-selector-attr">[27.2424,44.175986]</span>,<span class="hljs-selector-attr">[27.970107,43.812468]</span>,<span class="hljs-selector-attr">[28.558081,43.707462]</span>,<span class="hljs-selector-attr">[28.039095,43.293172]</span>,<span class="hljs-selector-attr">[27.673898,42.577892]</span>,<span class="hljs-selector-attr">[27.99672,42.007359]</span>,<span class="hljs-selector-attr">[27.135739,42.141485]</span>,<span class="hljs-selector-attr">[26.117042,41.826905]</span>,<span class="hljs-selector-attr">[26.106138,41.328899]</span>,<span class="hljs-selector-attr">[25.197201,41.234486]</span>,<span class="hljs-selector-attr">[24.492645,41.583896]</span>,<span class="hljs-selector-attr">[23.692074,41.309081]</span>,<span class="hljs-selector-attr">[22.952377,41.337994]</span>,<span class="hljs-selector-attr">[22.881374,41.999297]</span>,<span class="hljs-selector-attr">[22.380526,42.32026]</span>,<span class="hljs-selector-attr">[22.545012,42.461362]</span>,<span class="hljs-selector-attr">[22.436595,42.580321]</span>,<span class="hljs-selector-attr">[22.604801,42.898519]</span>,<span class="hljs-selector-attr">[22.986019,43.211161]</span>,<span class="hljs-selector-attr">[22.500157,43.642814]</span>,<span class="hljs-selector-attr">[22.410446,44.008063]</span>,<span class="hljs-selector-attr">[22.65715,44.234923]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BHS</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">The</span> <span class="hljs-selector-tag">Bahamas</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-77.53466,23.75975]</span>,<span class="hljs-selector-attr">[-77.78,23.71]</span>,<span class="hljs-selector-attr">[-78.03405,24.28615]</span>,<span class="hljs-selector-attr">[-78.40848,24.57564]</span>,<span class="hljs-selector-attr">[-78.19087,25.2103]</span>,<span class="hljs-selector-attr">[-77.89,25.17]</span>,<span class="hljs-selector-attr">[-77.54,24.34]</span>,<span class="hljs-selector-attr">[-77.53466,23.75975]</span>]],<span class="hljs-selector-attr">[[[-77.82,26.58]</span>,<span class="hljs-selector-attr">[-78.91,26.42]</span>,<span class="hljs-selector-attr">[-78.98,26.79]</span>,<span class="hljs-selector-attr">[-78.51,26.87]</span>,<span class="hljs-selector-attr">[-77.85,26.84]</span>,<span class="hljs-selector-attr">[-77.82,26.58]</span>]],<span class="hljs-selector-attr">[[[-77,26.59]</span>,<span class="hljs-selector-attr">[-77.17255,25.87918]</span>,<span class="hljs-selector-attr">[-77.35641,26.00735]</span>,<span class="hljs-selector-attr">[-77.34,26.53]</span>,<span class="hljs-selector-attr">[-77.78802,26.92516]</span>,<span class="hljs-selector-attr">[-77.79,27.04]</span>,<span class="hljs-selector-attr">[-77,26.59]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BIH</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bosnia</span> <span class="hljs-selector-tag">and</span> <span class="hljs-selector-tag">Herzegovina</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[19.005486,44.860234]</span>,<span class="hljs-selector-attr">[19.36803,44.863]</span>,<span class="hljs-selector-attr">[19.11761,44.42307]</span>,<span class="hljs-selector-attr">[19.59976,44.03847]</span>,<span class="hljs-selector-attr">[19.454,43.5681]</span>,<span class="hljs-selector-attr">[19.21852,43.52384]</span>,<span class="hljs-selector-attr">[19.03165,43.43253]</span>,<span class="hljs-selector-attr">[18.70648,43.20011]</span>,<span class="hljs-selector-attr">[18.56,42.65]</span>,<span class="hljs-selector-attr">[17.674922,43.028563]</span>,<span class="hljs-selector-attr">[17.297373,43.446341]</span>,<span class="hljs-selector-attr">[16.916156,43.667722]</span>,<span class="hljs-selector-attr">[16.456443,44.04124]</span>,<span class="hljs-selector-attr">[16.23966,44.351143]</span>,<span class="hljs-selector-attr">[15.750026,44.818712]</span>,<span class="hljs-selector-attr">[15.959367,45.233777]</span>,<span class="hljs-selector-attr">[16.318157,45.004127]</span>,<span class="hljs-selector-attr">[16.534939,45.211608]</span>,<span class="hljs-selector-attr">[17.002146,45.233777]</span>,<span class="hljs-selector-attr">[17.861783,45.06774]</span>,<span class="hljs-selector-attr">[18.553214,45.08159]</span>,<span class="hljs-selector-attr">[19.005486,44.860234]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BLR</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Belarus</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[23.484128,53.912498]</span>,<span class="hljs-selector-attr">[24.450684,53.905702]</span>,<span class="hljs-selector-attr">[25.536354,54.282423]</span>,<span class="hljs-selector-attr">[25.768433,54.846963]</span>,<span class="hljs-selector-attr">[26.588279,55.167176]</span>,<span class="hljs-selector-attr">[26.494331,55.615107]</span>,<span class="hljs-selector-attr">[27.10246,55.783314]</span>,<span class="hljs-selector-attr">[28.176709,56.16913]</span>,<span class="hljs-selector-attr">[29.229513,55.918344]</span>,<span class="hljs-selector-attr">[29.371572,55.670091]</span>,<span class="hljs-selector-attr">[29.896294,55.789463]</span>,<span class="hljs-selector-attr">[30.873909,55.550976]</span>,<span class="hljs-selector-attr">[30.971836,55.081548]</span>,<span class="hljs-selector-attr">[30.757534,54.811771]</span>,<span class="hljs-selector-attr">[31.384472,54.157056]</span>,<span class="hljs-selector-attr">[31.791424,53.974639]</span>,<span class="hljs-selector-attr">[31.731273,53.794029]</span>,<span class="hljs-selector-attr">[32.405599,53.618045]</span>,<span class="hljs-selector-attr">[32.693643,53.351421]</span>,<span class="hljs-selector-attr">[32.304519,53.132726]</span>,<span class="hljs-selector-attr">[31.497644,53.167427]</span>,<span class="hljs-selector-attr">[31.305201,53.073996]</span>,<span class="hljs-selector-attr">[31.540018,52.742052]</span>,<span class="hljs-selector-attr">[31.785998,52.101678]</span>,<span class="hljs-selector-attr">[30.927549,52.042353]</span>,<span class="hljs-selector-attr">[30.619454,51.822806]</span>,<span class="hljs-selector-attr">[30.555117,51.319503]</span>,<span class="hljs-selector-attr">[30.157364,51.416138]</span>,<span class="hljs-selector-attr">[29.254938,51.368234]</span>,<span class="hljs-selector-attr">[28.992835,51.602044]</span>,<span class="hljs-selector-attr">[28.617613,51.427714]</span>,<span class="hljs-selector-attr">[28.241615,51.572227]</span>,<span class="hljs-selector-attr">[27.454066,51.592303]</span>,<span class="hljs-selector-attr">[26.337959,51.832289]</span>,<span class="hljs-selector-attr">[25.327788,51.910656]</span>,<span class="hljs-selector-attr">[24.553106,51.888461]</span>,<span class="hljs-selector-attr">[24.005078,51.617444]</span>,<span class="hljs-selector-attr">[23.527071,51.578454]</span>,<span class="hljs-selector-attr">[23.508002,52.023647]</span>,<span class="hljs-selector-attr">[23.199494,52.486977]</span>,<span class="hljs-selector-attr">[23.799199,52.691099]</span>,<span class="hljs-selector-attr">[23.804935,53.089731]</span>,<span class="hljs-selector-attr">[23.527536,53.470122]</span>,<span class="hljs-selector-attr">[23.484128,53.912498]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BLZ</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Belize</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-89.14308,17.808319]</span>,<span class="hljs-selector-attr">[-89.150909,17.955468]</span>,<span class="hljs-selector-attr">[-89.029857,18.001511]</span>,<span class="hljs-selector-attr">[-88.848344,17.883198]</span>,<span class="hljs-selector-attr">[-88.490123,18.486831]</span>,<span class="hljs-selector-attr">[-88.300031,18.499982]</span>,<span class="hljs-selector-attr">[-88.296336,18.353273]</span>,<span class="hljs-selector-attr">[-88.106813,18.348674]</span>,<span class="hljs-selector-attr">[-88.123479,18.076675]</span>,<span class="hljs-selector-attr">[-88.285355,17.644143]</span>,<span class="hljs-selector-attr">[-88.197867,17.489475]</span>,<span class="hljs-selector-attr">[-88.302641,17.131694]</span>,<span class="hljs-selector-attr">[-88.239518,17.036066]</span>,<span class="hljs-selector-attr">[-88.355428,16.530774]</span>,<span class="hljs-selector-attr">[-88.551825,16.265467]</span>,<span class="hljs-selector-attr">[-88.732434,16.233635]</span>,<span class="hljs-selector-attr">[-88.930613,15.887273]</span>,<span class="hljs-selector-attr">[-89.229122,15.886938]</span>,<span class="hljs-selector-attr">[-89.150806,17.015577]</span>,<span class="hljs-selector-attr">[-89.14308,17.808319]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BMU</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bermuda</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-64.7799734332998,32.3072000581802]</span>,<span class="hljs-selector-attr">[-64.7873319183061,32.3039237143428]</span>,<span class="hljs-selector-attr">[-64.7946942710173,32.3032682700388]</span>,<span class="hljs-selector-attr">[-64.8094297981283,32.3098175728414]</span>,<span class="hljs-selector-attr">[-64.8167896352437,32.3058845718466]</span>,<span class="hljs-selector-attr">[-64.8101968029642,32.3022833180511]</span>,<span class="hljs-selector-attr">[-64.7962291465484,32.2934409732427]</span>,<span class="hljs-selector-attr">[-64.7815086336978,32.2868973114514]</span>,<span class="hljs-selector-attr">[-64.7997025513437,32.2796896417328]</span>,<span class="hljs-selector-attr">[-64.8066707691087,32.2747767569465]</span>,<span class="hljs-selector-attr">[-64.8225587873683,32.2669111289395]</span>,<span class="hljs-selector-attr">[-64.8287548840306,32.2669075473817]</span>,<span class="hljs-selector-attr">[-64.8306732143498,32.2583944840235]</span>,<span class="hljs-selector-attr">[-64.8399924854972,32.254782282336]</span>,<span class="hljs-selector-attr">[-64.8566090462354,32.2547740387514]</span>,<span class="hljs-selector-attr">[-64.8682296789446,32.2616393614322]</span>,<span class="hljs-selector-attr">[-64.8628241459563,32.2724481933959]</span>,<span class="hljs-selector-attr">[-64.8748651338951,32.2757120264753]</span>,<span class="hljs-selector-attr">[-64.8717752856644,32.2819371582026]</span>,<span class="hljs-selector-attr">[-64.8671422127295,32.2930760547989]</span>,<span class="hljs-selector-attr">[-64.8559068764437,32.2960321186471]</span>,<span class="hljs-selector-attr">[-64.8597429072279,32.3015842021933]</span>,<span class="hljs-selector-attr">[-64.8439233486717,32.3140553852543]</span>,<span class="hljs-selector-attr">[-64.8350242329311,32.3242161760006]</span>,<span class="hljs-selector-attr">[-64.8338690593672,32.3294587561557]</span>,<span class="hljs-selector-attr">[-64.8520298651164,32.3110911879954]</span>,<span class="hljs-selector-attr">[-64.8635922932573,32.3048469433363]</span>,<span class="hljs-selector-attr">[-64.8686668994079,32.30910745083]</span>,<span class="hljs-selector-attr">[-64.8721354593415,32.3041908606301]</span>,<span class="hljs-selector-attr">[-64.8779667328485,32.3038632800462]</span>,<span class="hljs-selector-attr">[-64.8780046844321,32.2907757831692]</span>,<span class="hljs-selector-attr">[-64.8849776658292,32.2819261366004]</span>,<span class="hljs-selector-attr">[-64.8783230004629,32.2613001418681]</span>,<span class="hljs-selector-attr">[-64.863194968877,32.2465799485801]</span>,<span class="hljs-selector-attr">[-64.8519819555722,32.2485519134663]</span>,<span class="hljs-selector-attr">[-64.842311980074,32.2492123317296]</span>,<span class="hljs-selector-attr">[-64.8388242605209,32.2475773472534]</span>,<span class="hljs-selector-attr">[-64.8334002575532,32.2462714714698]</span>,<span class="hljs-selector-attr">[-64.8256389530584,32.2472637398594]</span>,<span class="hljs-selector-attr">[-64.8205697556026,32.2531698880328]</span>,<span class="hljs-selector-attr">[-64.8105087275579,32.2561208974156]</span>,<span class="hljs-selector-attr">[-64.7900177727338,32.2659446936992]</span>,<span class="hljs-selector-attr">[-64.7745415970416,32.2718413023427]</span>,<span class="hljs-selector-attr">[-64.7644742436426,32.2855931353214]</span>,<span class="hljs-selector-attr">[-64.7551803442276,32.2908326702531]</span>,<span class="hljs-selector-attr">[-64.7423982971436,32.2996734994024]</span>,<span class="hljs-selector-attr">[-64.7206991797682,32.3137542201258]</span>,<span class="hljs-selector-attr">[-64.7117851247134,32.3176823360806]</span>,<span class="hljs-selector-attr">[-64.6962778813133,32.3275029115532]</span>,<span class="hljs-selector-attr">[-64.6768921127452,32.3324095397555]</span>,<span class="hljs-selector-attr">[-64.6567136927777,32.3451776458469]</span>,<span class="hljs-selector-attr">[-64.6532168823499,32.3494356627941]</span>,<span class="hljs-selector-attr">[-64.6605720384429,32.3589423487763]</span>,<span class="hljs-selector-attr">[-64.65125819471,32.3615600906466]</span>,<span class="hljs-selector-attr">[-64.6462011670816,32.36975169749]</span>,<span class="hljs-selector-attr">[-64.6613227512832,32.3763135008721]</span>,<span class="hljs-selector-attr">[-64.6690666074397,32.388444543924]</span>,<span class="hljs-selector-attr">[-64.6834270548595,32.3854968316788]</span>,<span class="hljs-selector-attr">[-64.6954617672714,32.3763221285869]</span>,<span class="hljs-selector-attr">[-64.70438689565,32.3704254760469]</span>,<span class="hljs-selector-attr">[-64.7117569982798,32.368132600249]</span>,<span class="hljs-selector-attr">[-64.7061764744404,32.3600110593559]</span>,<span class="hljs-selector-attr">[-64.700531552697,32.3590601356818]</span>,<span class="hljs-selector-attr">[-64.6940348033967,32.3640708659835]</span>,<span class="hljs-selector-attr">[-64.6895164826082,32.3633598579866]</span>,<span class="hljs-selector-attr">[-64.6864150099255,32.3547797587266]</span>,<span class="hljs-selector-attr">[-64.6824635995504,32.3540628176846]</span>,<span class="hljs-selector-attr">[-64.6835876652835,32.3626447677968]</span>,<span class="hljs-selector-attr">[-64.6801998697415,32.3631199096979]</span>,<span class="hljs-selector-attr">[-64.6672170444687,32.3597751617473]</span>,<span class="hljs-selector-attr">[-64.6598811264978,32.3497625771755]</span>,<span class="hljs-selector-attr">[-64.6737331235384,32.3390281851635]</span>,<span class="hljs-selector-attr">[-64.6887090648183,32.3342439408053]</span>,<span class="hljs-selector-attr">[-64.706732854446,32.3429010723036]</span>,<span class="hljs-selector-attr">[-64.7149301576112,32.3552188753513]</span>,<span class="hljs-selector-attr">[-64.7185967666669,32.3552239212394]</span>,<span class="hljs-selector-attr">[-64.7214189847314,32.3518830231342]</span>,<span class="hljs-selector-attr">[-64.7270616067222,32.3466461715475]</span>,<span class="hljs-selector-attr">[-64.734962460882,32.3442819830499]</span>,<span class="hljs-selector-attr">[-64.7383521549094,32.3407216514918]</span>,<span class="hljs-selector-attr">[-64.7411729976333,32.3311790864627]</span>,<span class="hljs-selector-attr">[-64.7423019216485,32.323311561213]</span>,<span class="hljs-selector-attr">[-64.7462482354281,32.318538611581]</span>,<span class="hljs-selector-attr">[-64.7566773739613,32.3130509130175]</span>,<span class="hljs-selector-attr">[-64.768738200563,32.3088369816572]</span>,<span class="hljs-selector-attr">[-64.7799734332998,32.3072000581802]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BOL</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bolivia</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-62.846468,-22.034985]</span>,<span class="hljs-selector-attr">[-63.986838,-21.993644]</span>,<span class="hljs-selector-attr">[-64.377021,-22.798091]</span>,<span class="hljs-selector-attr">[-64.964892,-22.075862]</span>,<span class="hljs-selector-attr">[-66.273339,-21.83231]</span>,<span class="hljs-selector-attr">[-67.106674,-22.735925]</span>,<span class="hljs-selector-attr">[-67.82818,-22.872919]</span>,<span class="hljs-selector-attr">[-68.219913,-21.494347]</span>,<span class="hljs-selector-attr">[-68.757167,-20.372658]</span>,<span class="hljs-selector-attr">[-68.442225,-19.405068]</span>,<span class="hljs-selector-attr">[-68.966818,-18.981683]</span>,<span class="hljs-selector-attr">[-69.100247,-18.260125]</span>,<span class="hljs-selector-attr">[-69.590424,-17.580012]</span>,<span class="hljs-selector-attr">[-68.959635,-16.500698]</span>,<span class="hljs-selector-attr">[-69.389764,-15.660129]</span>,<span class="hljs-selector-attr">[-69.160347,-15.323974]</span>,<span class="hljs-selector-attr">[-69.339535,-14.953195]</span>,<span class="hljs-selector-attr">[-68.948887,-14.453639]</span>,<span class="hljs-selector-attr">[-68.929224,-13.602684]</span>,<span class="hljs-selector-attr">[-68.88008,-12.899729]</span>,<span class="hljs-selector-attr">[-68.66508,-12.5613]</span>,<span class="hljs-selector-attr">[-69.529678,-10.951734]</span>,<span class="hljs-selector-attr">[-68.786158,-11.03638]</span>,<span class="hljs-selector-attr">[-68.271254,-11.014521]</span>,<span class="hljs-selector-attr">[-68.048192,-10.712059]</span>,<span class="hljs-selector-attr">[-67.173801,-10.306812]</span>,<span class="hljs-selector-attr">[-66.646908,-9.931331]</span>,<span class="hljs-selector-attr">[-65.338435,-9.761988]</span>,<span class="hljs-selector-attr">[-65.444837,-10.511451]</span>,<span class="hljs-selector-attr">[-65.321899,-10.895872]</span>,<span class="hljs-selector-attr">[-65.402281,-11.56627]</span>,<span class="hljs-selector-attr">[-64.316353,-12.461978]</span>,<span class="hljs-selector-attr">[-63.196499,-12.627033]</span>,<span class="hljs-selector-attr">[-62.80306,-13.000653]</span>,<span class="hljs-selector-attr">[-62.127081,-13.198781]</span>,<span class="hljs-selector-attr">[-61.713204,-13.489202]</span>,<span class="hljs-selector-attr">[-61.084121,-13.479384]</span>,<span class="hljs-selector-attr">[-60.503304,-13.775955]</span>,<span class="hljs-selector-attr">[-60.459198,-14.354007]</span>,<span class="hljs-selector-attr">[-60.264326,-14.645979]</span>,<span class="hljs-selector-attr">[-60.251149,-15.077219]</span>,<span class="hljs-selector-attr">[-60.542966,-15.09391]</span>,<span class="hljs-selector-attr">[-60.15839,-16.258284]</span>,<span class="hljs-selector-attr">[-58.24122,-16.299573]</span>,<span class="hljs-selector-attr">[-58.388058,-16.877109]</span>,<span class="hljs-selector-attr">[-58.280804,-17.27171]</span>,<span class="hljs-selector-attr">[-57.734558,-17.552468]</span>,<span class="hljs-selector-attr">[-57.498371,-18.174188]</span>,<span class="hljs-selector-attr">[-57.676009,-18.96184]</span>,<span class="hljs-selector-attr">[-57.949997,-19.400004]</span>,<span class="hljs-selector-attr">[-57.853802,-19.969995]</span>,<span class="hljs-selector-attr">[-58.166392,-20.176701]</span>,<span class="hljs-selector-attr">[-58.183471,-19.868399]</span>,<span class="hljs-selector-attr">[-59.115042,-19.356906]</span>,<span class="hljs-selector-attr">[-60.043565,-19.342747]</span>,<span class="hljs-selector-attr">[-61.786326,-19.633737]</span>,<span class="hljs-selector-attr">[-62.265961,-20.513735]</span>,<span class="hljs-selector-attr">[-62.291179,-21.051635]</span>,<span class="hljs-selector-attr">[-62.685057,-22.249029]</span>,<span class="hljs-selector-attr">[-62.846468,-22.034985]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BRA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Brazil</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[-57.625133,-30.216295]</span>,<span class="hljs-selector-attr">[-56.2909,-28.852761]</span>,<span class="hljs-selector-attr">[-55.162286,-27.881915]</span>,<span class="hljs-selector-attr">[-54.490725,-27.474757]</span>,<span class="hljs-selector-attr">[-53.648735,-26.923473]</span>,<span class="hljs-selector-attr">[-53.628349,-26.124865]</span>,<span class="hljs-selector-attr">[-54.13005,-25.547639]</span>,<span class="hljs-selector-attr">[-54.625291,-25.739255]</span>,<span class="hljs-selector-attr">[-54.428946,-25.162185]</span>,<span class="hljs-selector-attr">[-54.293476,-24.5708]</span>,<span class="hljs-selector-attr">[-54.29296,-24.021014]</span>,<span class="hljs-selector-attr">[-54.652834,-23.839578]</span>,<span class="hljs-selector-attr">[-55.027902,-24.001274]</span>,<span class="hljs-selector-attr">[-55.400747,-23.956935]</span>,<span class="hljs-selector-attr">[-55.517639,-23.571998]</span>,<span class="hljs-selector-attr">[-55.610683,-22.655619]</span>,<span class="hljs-selector-attr">[-55.797958,-22.35693]</span>,<span class="hljs-selector-attr">[-56.473317,-22.0863]</span>,<span class="hljs-selector-attr">[-56.88151,-22.282154]</span>,<span class="hljs-selector-attr">[-57.937156,-22.090176]</span>,<span class="hljs-selector-attr">[-57.870674,-20.732688]</span>,<span class="hljs-selector-attr">[-58.166392,-20.176701]</span>,<span class="hljs-selector-attr">[-57.853802,-19.969995]</span>,<span class="hljs-selector-attr">[-57.949997,-19.400004]</span>,<span class="hljs-selector-attr">[-57.676009,-18.96184]</span>,<span class="hljs-selector-attr">[-57.498371,-18.174188]</span>,<span class="hljs-selector-attr">[-57.734558,-17.552468]</span>,<span class="hljs-selector-attr">[-58.280804,-17.27171]</span>,<span class="hljs-selector-attr">[-58.388058,-16.877109]</span>,<span class="hljs-selector-attr">[-58.24122,-16.299573]</span>,<span class="hljs-selector-attr">[-60.15839,-16.258284]</span>,<span class="hljs-selector-attr">[-60.542966,-15.09391]</span>,<span class="hljs-selector-attr">[-60.251149,-15.077219]</span>,<span class="hljs-selector-attr">[-60.264326,-14.645979]</span>,<span class="hljs-selector-attr">[-60.459198,-14.354007]</span>,<span class="hljs-selector-attr">[-60.503304,-13.775955]</span>,<span class="hljs-selector-attr">[-61.084121,-13.479384]</span>,<span class="hljs-selector-attr">[-61.713204,-13.489202]</span>,<span class="hljs-selector-attr">[-62.127081,-13.198781]</span>,<span class="hljs-selector-attr">[-62.80306,-13.000653]</span>,<span class="hljs-selector-attr">[-63.196499,-12.627033]</span>,<span class="hljs-selector-attr">[-64.316353,-12.461978]</span>,<span class="hljs-selector-attr">[-65.402281,-11.56627]</span>,<span class="hljs-selector-attr">[-65.321899,-10.895872]</span>,<span class="hljs-selector-attr">[-65.444837,-10.511451]</span>,<span class="hljs-selector-attr">[-65.338435,-9.761988]</span>,<span class="hljs-selector-attr">[-66.646908,-9.931331]</span>,<span class="hljs-selector-attr">[-67.173801,-10.306812]</span>,<span class="hljs-selector-attr">[-68.048192,-10.712059]</span>,<span class="hljs-selector-attr">[-68.271254,-11.014521]</span>,<span class="hljs-selector-attr">[-68.786158,-11.03638]</span>,<span class="hljs-selector-attr">[-69.529678,-10.951734]</span>,<span class="hljs-selector-attr">[-70.093752,-11.123972]</span>,<span class="hljs-selector-attr">[-70.548686,-11.009147]</span>,<span class="hljs-selector-attr">[-70.481894,-9.490118]</span>,<span class="hljs-selector-attr">[-71.302412,-10.079436]</span>,<span class="hljs-selector-attr">[-72.184891,-10.053598]</span>,<span class="hljs-selector-attr">[-72.563033,-9.520194]</span>,<span class="hljs-selector-attr">[-73.226713,-9.462213]</span>,<span class="hljs-selector-attr">[-73.015383,-9.032833]</span>,<span class="hljs-selector-attr">[-73.571059,-8.424447]</span>,<span class="hljs-selector-attr">[-73.987235,-7.52383]</span>,<span class="hljs-selector-attr">[-73.723401,-7.340999]</span>,<span class="hljs-selector-attr">[-73.724487,-6.918595]</span>,<span class="hljs-selector-attr">[-73.120027,-6.629931]</span>,<span class="hljs-selector-attr">[-73.219711,-6.089189]</span>,<span class="hljs-selector-attr">[-72.964507,-5.741251]</span>,<span class="hljs-selector-attr">[-72.891928,-5.274561]</span>,<span class="hljs-selector-attr">[-71.748406,-4.593983]</span>,<span class="hljs-selector-attr">[-70.928843,-4.401591]</span>,<span class="hljs-selector-attr">[-70.794769,-4.251265]</span>,<span class="hljs-selector-attr">[-69.893635,-4.298187]</span>,<span class="hljs-selector-attr">[-69.444102,-1.556287]</span>,<span class="hljs-selector-attr">[-69.420486,-1.122619]</span>,<span class="hljs-selector-attr">[-69.577065,-0.549992]</span>,<span class="hljs-selector-attr">[-70.020656,-0.185156]</span>,<span class="hljs-selector-attr">[-70.015566,0.541414]</span>,<span class="hljs-selector-attr">[-69.452396,0.706159]</span>,<span class="hljs-selector-attr">[-69.252434,0.602651]</span>,<span class="hljs-selector-attr">[-69.218638,0.985677]</span>,<span class="hljs-selector-attr">[-69.804597,1.089081]</span>,<span class="hljs-selector-attr">[-69.816973,1.714805]</span>,<span class="hljs-selector-attr">[-67.868565,1.692455]</span>,<span class="hljs-selector-attr">[-67.53781,2.037163]</span>,<span class="hljs-selector-attr">[-67.259998,1.719999]</span>,<span class="hljs-selector-attr">[-67.065048,1.130112]</span>,<span class="hljs-selector-attr">[-66.876326,1.253361]</span>,<span class="hljs-selector-attr">[-66.325765,0.724452]</span>,<span class="hljs-selector-attr">[-65.548267,0.789254]</span>,<span class="hljs-selector-attr">[-65.354713,1.095282]</span>,<span class="hljs-selector-attr">[-64.611012,1.328731]</span>,<span class="hljs-selector-attr">[-64.199306,1.492855]</span>,<span class="hljs-selector-attr">[-64.083085,1.916369]</span>,<span class="hljs-selector-attr">[-63.368788,2.2009]</span>,<span class="hljs-selector-attr">[-63.422867,2.411068]</span>,<span class="hljs-selector-attr">[-64.269999,2.497006]</span>,<span class="hljs-selector-attr">[-64.408828,3.126786]</span>,<span class="hljs-selector-attr">[-64.368494,3.79721]</span>,<span class="hljs-selector-attr">[-64.816064,4.056445]</span>,<span class="hljs-selector-attr">[-64.628659,4.148481]</span>,<span class="hljs-selector-attr">[-63.888343,4.02053]</span>,<span class="hljs-selector-attr">[-63.093198,3.770571]</span>,<span class="hljs-selector-attr">[-62.804533,4.006965]</span>,<span class="hljs-selector-attr">[-62.08543,4.162124]</span>,<span class="hljs-selector-attr">[-60.966893,4.536468]</span>,<span class="hljs-selector-attr">[-60.601179,4.918098]</span>,<span class="hljs-selector-attr">[-60.733574,5.200277]</span>,<span class="hljs-selector-attr">[-60.213683,5.244486]</span>,<span class="hljs-selector-attr">[-59.980959,5.014061]</span>,<span class="hljs-selector-attr">[-60.111002,4.574967]</span>,<span class="hljs-selector-attr">[-59.767406,4.423503]</span>,<span class="hljs-selector-attr">[-59.53804,3.958803]</span>,<span class="hljs-selector-attr">[-59.815413,3.606499]</span>,<span class="hljs-selector-attr">[-59.974525,2.755233]</span>,<span class="hljs-selector-attr">[-59.718546,2.24963]</span>,<span class="hljs-selector-attr">[-59.646044,1.786894]</span>,<span class="hljs-selector-attr">[-59.030862,1.317698]</span>,<span class="hljs-selector-attr">[-58.540013,1.268088]</span>,<span class="hljs-selector-attr">[-58.429477,1.463942]</span>,<span class="hljs-selector-attr">[-58.11345,1.507195]</span>,<span class="hljs-selector-attr">[-57.660971,1.682585]</span>,<span class="hljs-selector-attr">[-57.335823,1.948538]</span>,<span class="hljs-selector-attr">[-56.782704,1.863711]</span>,<span class="hljs-selector-attr">[-56.539386,1.899523]</span>,<span class="hljs-selector-attr">[-55.995698,1.817667]</span>,<span class="hljs-selector-attr">[-55.9056,2.021996]</span>,<span class="hljs-selector-attr">[-56.073342,2.220795]</span>,<span class="hljs-selector-attr">[-55.973322,2.510364]</span>,<span class="hljs-selector-attr">[-55.569755,2.421506]</span>,<span class="hljs-selector-attr">[-55.097587,2.523748]</span>,<span class="hljs-selector-attr">[-54.524754,2.311849]</span>,<span class="hljs-selector-attr">[-54.088063,2.105557]</span>,<span class="hljs-selector-attr">[-53.778521,2.376703]</span>,<span class="hljs-selector-attr">[-53.554839,2.334897]</span>,<span class="hljs-selector-attr">[-53.418465,2.053389]</span>,<span class="hljs-selector-attr">[-52.939657,2.124858]</span>,<span class="hljs-selector-attr">[-52.556425,2.504705]</span>,<span class="hljs-selector-attr">[-52.249338,3.241094]</span>,<span class="hljs-selector-attr">[-51.657797,4.156232]</span>,<span class="hljs-selector-attr">[-51.317146,4.203491]</span>,<span class="hljs-selector-attr">[-51.069771,3.650398]</span>,<span class="hljs-selector-attr">[-50.508875,1.901564]</span>,<span class="hljs-selector-attr">[-49.974076,1.736483]</span>,<span class="hljs-selector-attr">[-49.947101,1.04619]</span>,<span class="hljs-selector-attr">[-50.699251,0.222984]</span>,<span class="hljs-selector-attr">[-50.388211,-0.078445]</span>,<span class="hljs-selector-attr">[-48.620567,-0.235489]</span>,<span class="hljs-selector-attr">[-48.584497,-1.237805]</span>,<span class="hljs-selector-attr">[-47.824956,-0.581618]</span>,<span class="hljs-selector-attr">[-46.566584,-0.941028]</span>,<span class="hljs-selector-attr">[-44.905703,-1.55174]</span>,<span class="hljs-selector-attr">[-44.417619,-2.13775]</span>,<span class="hljs-selector-attr">[-44.581589,-2.691308]</span>,<span class="hljs-selector-attr">[-43.418791,-2.38311]</span>,<span class="hljs-selector-attr">[-41.472657,-2.912018]</span>,<span class="hljs-selector-attr">[-39.978665,-2.873054]</span>,<span class="hljs-selector-attr">[-38.500383,-3.700652]</span>,<span class="hljs-selector-attr">[-37.223252,-4.820946]</span>,<span class="hljs-selector-attr">[-36.452937,-5.109404]</span>,<span class="hljs-selector-attr">[-35.597796,-5.149504]</span>,<span class="hljs-selector-attr">[-35.235389,-5.464937]</span>,<span class="hljs-selector-attr">[-34.89603,-6.738193]</span>,<span class="hljs-selector-attr">[-34.729993,-7.343221]</span>,<span class="hljs-selector-attr">[-35.128212,-8.996401]</span>,<span class="hljs-selector-attr">[-35.636967,-9.649282]</span>,<span class="hljs-selector-attr">[-37.046519,-11.040721]</span>,<span class="hljs-selector-attr">[-37.683612,-12.171195]</span>,<span class="hljs-selector-attr">[-38.423877,-13.038119]</span>,<span class="hljs-selector-attr">[-38.673887,-13.057652]</span>,<span class="hljs-selector-attr">[-38.953276,-13.79337]</span>,<span class="hljs-selector-attr">[-38.882298,-15.667054]</span>,<span class="hljs-selector-attr">[-39.161092,-17.208407]</span>,<span class="hljs-selector-attr">[-39.267339,-17.867746]</span>,<span class="hljs-selector-attr">[-39.583521,-18.262296]</span>,<span class="hljs-selector-attr">[-39.760823,-19.599113]</span>,<span class="hljs-selector-attr">[-40.774741,-20.904512]</span>,<span class="hljs-selector-attr">[-40.944756,-21.937317]</span>,<span class="hljs-selector-attr">[-41.754164,-22.370676]</span>,<span class="hljs-selector-attr">[-41.988284,-22.97007]</span>,<span class="hljs-selector-attr">[-43.074704,-22.967693]</span>,<span class="hljs-selector-attr">[-44.647812,-23.351959]</span>,<span class="hljs-selector-attr">[-45.352136,-23.796842]</span>,<span class="hljs-selector-attr">[-46.472093,-24.088969]</span>,<span class="hljs-selector-attr">[-47.648972,-24.885199]</span>,<span class="hljs-selector-attr">[-48.495458,-25.877025]</span>,<span class="hljs-selector-attr">[-48.641005,-26.623698]</span>,<span class="hljs-selector-attr">[-48.474736,-27.175912]</span>,<span class="hljs-selector-attr">[-48.66152,-28.186135]</span>,<span class="hljs-selector-attr">[-48.888457,-28.674115]</span>,<span class="hljs-selector-attr">[-49.587329,-29.224469]</span>,<span class="hljs-selector-attr">[-50.696874,-30.984465]</span>,<span class="hljs-selector-attr">[-51.576226,-31.777698]</span>,<span class="hljs-selector-attr">[-52.256081,-32.24537]</span>,<span class="hljs-selector-attr">[-52.7121,-33.196578]</span>,<span class="hljs-selector-attr">[-53.373662,-33.768378]</span>,<span class="hljs-selector-attr">[-53.650544,-33.202004]</span>,<span class="hljs-selector-attr">[-53.209589,-32.727666]</span>,<span class="hljs-selector-attr">[-53.787952,-32.047243]</span>,<span class="hljs-selector-attr">[-54.572452,-31.494511]</span>,<span class="hljs-selector-attr">[-55.60151,-30.853879]</span>,<span class="hljs-selector-attr">[-55.973245,-30.883076]</span>,<span class="hljs-selector-attr">[-56.976026,-30.109686]</span>,<span class="hljs-selector-attr">[-57.625133,-30.216295]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BRN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Brunei</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[114.204017,4.525874]</span>,<span class="hljs-selector-attr">[114.599961,4.900011]</span>,<span class="hljs-selector-attr">[115.45071,5.44773]</span>,<span class="hljs-selector-attr">[115.4057,4.955228]</span>,<span class="hljs-selector-attr">[115.347461,4.316636]</span>,<span class="hljs-selector-attr">[114.869557,4.348314]</span>,<span class="hljs-selector-attr">[114.659596,4.007637]</span>,<span class="hljs-selector-attr">[114.204017,4.525874]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BTN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Bhutan</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[91.696657,27.771742]</span>,<span class="hljs-selector-attr">[92.103712,27.452614]</span>,<span class="hljs-selector-attr">[92.033484,26.83831]</span>,<span class="hljs-selector-attr">[91.217513,26.808648]</span>,<span class="hljs-selector-attr">[90.373275,26.875724]</span>,<span class="hljs-selector-attr">[89.744528,26.719403]</span>,<span class="hljs-selector-attr">[88.835643,27.098966]</span>,<span class="hljs-selector-attr">[88.814248,27.299316]</span>,<span class="hljs-selector-attr">[89.47581,28.042759]</span>,<span class="hljs-selector-attr">[90.015829,28.296439]</span>,<span class="hljs-selector-attr">[90.730514,28.064954]</span>,<span class="hljs-selector-attr">[91.258854,28.040614]</span>,<span class="hljs-selector-attr">[91.696657,27.771742]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">BWA</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Botswana</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[25.649163,-18.536026]</span>,<span class="hljs-selector-attr">[25.850391,-18.714413]</span>,<span class="hljs-selector-attr">[26.164791,-19.293086]</span>,<span class="hljs-selector-attr">[27.296505,-20.39152]</span>,<span class="hljs-selector-attr">[27.724747,-20.499059]</span>,<span class="hljs-selector-attr">[27.727228,-20.851802]</span>,<span class="hljs-selector-attr">[28.02137,-21.485975]</span>,<span class="hljs-selector-attr">[28.794656,-21.639454]</span>,<span class="hljs-selector-attr">[29.432188,-22.091313]</span>,<span class="hljs-selector-attr">[28.017236,-22.827754]</span>,<span class="hljs-selector-attr">[27.11941,-23.574323]</span>,<span class="hljs-selector-attr">[26.786407,-24.240691]</span>,<span class="hljs-selector-attr">[26.485753,-24.616327]</span>,<span class="hljs-selector-attr">[25.941652,-24.696373]</span>,<span class="hljs-selector-attr">[25.765849,-25.174845]</span>,<span class="hljs-selector-attr">[25.664666,-25.486816]</span>,<span class="hljs-selector-attr">[25.025171,-25.71967]</span>,<span class="hljs-selector-attr">[24.211267,-25.670216]</span>,<span class="hljs-selector-attr">[23.73357,-25.390129]</span>,<span class="hljs-selector-attr">[23.312097,-25.26869]</span>,<span class="hljs-selector-attr">[22.824271,-25.500459]</span>,<span class="hljs-selector-attr">[22.579532,-25.979448]</span>,<span class="hljs-selector-attr">[22.105969,-26.280256]</span>,<span class="hljs-selector-attr">[21.605896,-26.726534]</span>,<span class="hljs-selector-attr">[20.889609,-26.828543]</span>,<span class="hljs-selector-attr">[20.66647,-26.477453]</span>,<span class="hljs-selector-attr">[20.758609,-25.868136]</span>,<span class="hljs-selector-attr">[20.165726,-24.917962]</span>,<span class="hljs-selector-attr">[19.895768,-24.76779]</span>,<span class="hljs-selector-attr">[19.895458,-21.849157]</span>,<span class="hljs-selector-attr">[20.881134,-21.814327]</span>,<span class="hljs-selector-attr">[20.910641,-18.252219]</span>,<span class="hljs-selector-attr">[21.65504,-18.219146]</span>,<span class="hljs-selector-attr">[23.196858,-17.869038]</span>,<span class="hljs-selector-attr">[23.579006,-18.281261]</span>,<span class="hljs-selector-attr">[24.217365,-17.889347]</span>,<span class="hljs-selector-attr">[24.520705,-17.887125]</span>,<span class="hljs-selector-attr">[25.084443,-17.661816]</span>,<span class="hljs-selector-attr">[25.264226,-17.73654]</span>,<span class="hljs-selector-attr">[25.649163,-18.536026]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CAF</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Central</span> <span class="hljs-selector-tag">African</span> <span class="hljs-selector-tag">Republic</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[15.27946,7.421925]</span>,<span class="hljs-selector-attr">[16.106232,7.497088]</span>,<span class="hljs-selector-attr">[16.290562,7.754307]</span>,<span class="hljs-selector-attr">[16.456185,7.734774]</span>,<span class="hljs-selector-attr">[16.705988,7.508328]</span>,<span class="hljs-selector-attr">[17.96493,7.890914]</span>,<span class="hljs-selector-attr">[18.389555,8.281304]</span>,<span class="hljs-selector-attr">[18.911022,8.630895]</span>,<span class="hljs-selector-attr">[18.81201,8.982915]</span>,<span class="hljs-selector-attr">[19.094008,9.074847]</span>,<span class="hljs-selector-attr">[20.059685,9.012706]</span>,<span class="hljs-selector-attr">[21.000868,9.475985]</span>,<span class="hljs-selector-attr">[21.723822,10.567056]</span>,<span class="hljs-selector-attr">[22.231129,10.971889]</span>,<span class="hljs-selector-attr">[22.864165,11.142395]</span>,<span class="hljs-selector-attr">[22.977544,10.714463]</span>,<span class="hljs-selector-attr">[23.554304,10.089255]</span>,<span class="hljs-selector-attr">[23.55725,9.681218]</span>,<span class="hljs-selector-attr">[23.394779,9.265068]</span>,<span class="hljs-selector-attr">[23.459013,8.954286]</span>,<span class="hljs-selector-attr">[23.805813,8.666319]</span>,<span class="hljs-selector-attr">[24.567369,8.229188]</span>,<span class="hljs-selector-attr">[25.114932,7.825104]</span>,<span class="hljs-selector-attr">[25.124131,7.500085]</span>,<span class="hljs-selector-attr">[25.796648,6.979316]</span>,<span class="hljs-selector-attr">[26.213418,6.546603]</span>,<span class="hljs-selector-attr">[26.465909,5.946717]</span>,<span class="hljs-selector-attr">[27.213409,5.550953]</span>,<span class="hljs-selector-attr">[27.374226,5.233944]</span>,<span class="hljs-selector-attr">[27.044065,5.127853]</span>,<span class="hljs-selector-attr">[26.402761,5.150875]</span>,<span class="hljs-selector-attr">[25.650455,5.256088]</span>,<span class="hljs-selector-attr">[25.278798,5.170408]</span>,<span class="hljs-selector-attr">[25.128833,4.927245]</span>,<span class="hljs-selector-attr">[24.805029,4.897247]</span>,<span class="hljs-selector-attr">[24.410531,5.108784]</span>,<span class="hljs-selector-attr">[23.297214,4.609693]</span>,<span class="hljs-selector-attr">[22.84148,4.710126]</span>,<span class="hljs-selector-attr">[22.704124,4.633051]</span>,<span class="hljs-selector-attr">[22.405124,4.02916]</span>,<span class="hljs-selector-attr">[21.659123,4.224342]</span>,<span class="hljs-selector-attr">[20.927591,4.322786]</span>,<span class="hljs-selector-attr">[20.290679,4.691678]</span>,<span class="hljs-selector-attr">[19.467784,5.031528]</span>,<span class="hljs-selector-attr">[18.932312,4.709506]</span>,<span class="hljs-selector-attr">[18.542982,4.201785]</span>,<span class="hljs-selector-attr">[18.453065,3.504386]</span>,<span class="hljs-selector-attr">[17.8099,3.560196]</span>,<span class="hljs-selector-attr">[17.133042,3.728197]</span>,<span class="hljs-selector-attr">[16.537058,3.198255]</span>,<span class="hljs-selector-attr">[16.012852,2.26764]</span>,<span class="hljs-selector-attr">[15.907381,2.557389]</span>,<span class="hljs-selector-attr">[15.862732,3.013537]</span>,<span class="hljs-selector-attr">[15.405396,3.335301]</span>,<span class="hljs-selector-attr">[15.03622,3.851367]</span>,<span class="hljs-selector-attr">[14.950953,4.210389]</span>,<span class="hljs-selector-attr">[14.478372,4.732605]</span>,<span class="hljs-selector-attr">[14.558936,5.030598]</span>,<span class="hljs-selector-attr">[14.459407,5.451761]</span>,<span class="hljs-selector-attr">[14.53656,6.226959]</span>,<span class="hljs-selector-attr">[14.776545,6.408498]</span>,<span class="hljs-selector-attr">[15.27946,7.421925]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CAN</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Canada</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-63.6645,46.55001]</span>,<span class="hljs-selector-attr">[-62.9393,46.41587]</span>,<span class="hljs-selector-attr">[-62.01208,46.44314]</span>,<span class="hljs-selector-attr">[-62.50391,46.03339]</span>,<span class="hljs-selector-attr">[-62.87433,45.96818]</span>,<span class="hljs-selector-attr">[-64.1428,46.39265]</span>,<span class="hljs-selector-attr">[-64.39261,46.72747]</span>,<span class="hljs-selector-attr">[-64.01486,47.03601]</span>,<span class="hljs-selector-attr">[-63.6645,46.55001]</span>]],<span class="hljs-selector-attr">[[[-61.806305,49.10506]</span>,<span class="hljs-selector-attr">[-62.29318,49.08717]</span>,<span class="hljs-selector-attr">[-63.58926,49.40069]</span>,<span class="hljs-selector-attr">[-64.51912,49.87304]</span>,<span class="hljs-selector-attr">[-64.17322,49.95718]</span>,<span class="hljs-selector-attr">[-62.85829,49.70641]</span>,<span class="hljs-selector-attr">[-61.835585,49.28855]</span>,<span class="hljs-selector-attr">[-61.806305,49.10506]</span>]],<span class="hljs-selector-attr">[[[-123.510002,48.510011]</span>,<span class="hljs-selector-attr">[-124.012891,48.370846]</span>,<span class="hljs-selector-attr">[-125.655013,48.825005]</span>,<span class="hljs-selector-attr">[-125.954994,49.179996]</span>,<span class="hljs-selector-attr">[-126.850004,49.53]</span>,<span class="hljs-selector-attr">[-127.029993,49.814996]</span>,<span class="hljs-selector-attr">[-128.059336,49.994959]</span>,<span class="hljs-selector-attr">[-128.444584,50.539138]</span>,<span class="hljs-selector-attr">[-128.358414,50.770648]</span>,<span class="hljs-selector-attr">[-127.308581,50.552574]</span>,<span class="hljs-selector-attr">[-126.695001,50.400903]</span>,<span class="hljs-selector-attr">[-125.755007,50.295018]</span>,<span class="hljs-selector-attr">[-125.415002,49.950001]</span>,<span class="hljs-selector-attr">[-124.920768,49.475275]</span>,<span class="hljs-selector-attr">[-123.922509,49.062484]</span>,<span class="hljs-selector-attr">[-123.510002,48.510011]</span>]],<span class="hljs-selector-attr">[[[-56.134036,50.68701]</span>,<span class="hljs-selector-attr">[-56.795882,49.812309]</span>,<span class="hljs-selector-attr">[-56.143105,50.150117]</span>,<span class="hljs-selector-attr">[-55.471492,49.935815]</span>,<span class="hljs-selector-attr">[-55.822401,49.587129]</span>,<span class="hljs-selector-attr">[-54.935143,49.313011]</span>,<span class="hljs-selector-attr">[-54.473775,49.556691]</span>,<span class="hljs-selector-attr">[-53.476549,49.249139]</span>,<span class="hljs-selector-attr">[-53.786014,48.516781]</span>,<span class="hljs-selector-attr">[-53.086134,48.687804]</span>,<span class="hljs-selector-attr">[-52.958648,48.157164]</span>,<span class="hljs-selector-attr">[-52.648099,47.535548]</span>,<span class="hljs-selector-attr">[-53.069158,46.655499]</span>,<span class="hljs-selector-attr">[-53.521456,46.618292]</span>,<span class="hljs-selector-attr">[-54.178936,46.807066]</span>,<span class="hljs-selector-attr">[-53.961869,47.625207]</span>,<span class="hljs-selector-attr">[-54.240482,47.752279]</span>,<span class="hljs-selector-attr">[-55.400773,46.884994]</span>,<span class="hljs-selector-attr">[-55.997481,46.91972]</span>,<span class="hljs-selector-attr">[-55.291219,47.389562]</span>,<span class="hljs-selector-attr">[-56.250799,47.632545]</span>,<span class="hljs-selector-attr">[-57.325229,47.572807]</span>,<span class="hljs-selector-attr">[-59.266015,47.603348]</span>,<span class="hljs-selector-attr">[-59.419494,47.899454]</span>,<span class="hljs-selector-attr">[-58.796586,48.251525]</span>,<span class="hljs-selector-attr">[-59.231625,48.523188]</span>,<span class="hljs-selector-attr">[-58.391805,49.125581]</span>,<span class="hljs-selector-attr">[-57.35869,50.718274]</span>,<span class="hljs-selector-attr">[-56.73865,51.287438]</span>,<span class="hljs-selector-attr">[-55.870977,51.632094]</span>,<span class="hljs-selector-attr">[-55.406974,51.588273]</span>,<span class="hljs-selector-attr">[-55.600218,51.317075]</span>,<span class="hljs-selector-attr">[-56.134036,50.68701]</span>]],<span class="hljs-selector-attr">[[[-132.710008,54.040009]</span>,<span class="hljs-selector-attr">[-132.710009,54.040009]</span>,<span class="hljs-selector-attr">[-132.710008,54.040009]</span>,<span class="hljs-selector-attr">[-132.710008,54.040009]</span>,<span class="hljs-selector-attr">[-131.74999,54.120004]</span>,<span class="hljs-selector-attr">[-132.04948,52.984621]</span>,<span class="hljs-selector-attr">[-131.179043,52.180433]</span>,<span class="hljs-selector-attr">[-131.57783,52.182371]</span>,<span class="hljs-selector-attr">[-132.180428,52.639707]</span>,<span class="hljs-selector-attr">[-132.549992,53.100015]</span>,<span class="hljs-selector-attr">[-133.054611,53.411469]</span>,<span class="hljs-selector-attr">[-133.239664,53.85108]</span>,<span class="hljs-selector-attr">[-133.180004,54.169975]</span>,<span class="hljs-selector-attr">[-132.710008,54.040009]</span>]],<span class="hljs-selector-attr">[[[-79.26582,62.158675]</span>,<span class="hljs-selector-attr">[-79.65752,61.63308]</span>,<span class="hljs-selector-attr">[-80.09956,61.7181]</span>,<span class="hljs-selector-attr">[-80.36215,62.01649]</span>,<span class="hljs-selector-attr">[-80.315395,62.085565]</span>,<span class="hljs-selector-attr">[-79.92939,62.3856]</span>,<span class="hljs-selector-attr">[-79.52002,62.36371]</span>,<span class="hljs-selector-attr">[-79.26582,62.158675]</span>]],<span class="hljs-selector-attr">[[[-81.89825,62.7108]</span>,<span class="hljs-selector-attr">[-83.06857,62.15922]</span>,<span class="hljs-selector-attr">[-83.77462,62.18231]</span>,<span class="hljs-selector-attr">[-83.99367,62.4528]</span>,<span class="hljs-selector-attr">[-83.25048,62.91409]</span>,<span class="hljs-selector-attr">[-81.87699,62.90458]</span>,<span class="hljs-selector-attr">[-81.89825,62.7108]</span>]],<span class="hljs-selector-attr">[[[-85.161308,65.657285]</span>,<span class="hljs-selector-attr">[-84.975764,65.217518]</span>,<span class="hljs-selector-attr">[-84.464012,65.371772]</span>,<span class="hljs-selector-attr">[-83.882626,65.109618]</span>,<span class="hljs-selector-attr">[-82.787577,64.766693]</span>,<span class="hljs-selector-attr">[-81.642014,64.455136]</span>,<span class="hljs-selector-attr">[-81.55344,63.979609]</span>,<span class="hljs-selector-attr">[-80.817361,64.057486]</span>,<span class="hljs-selector-attr">[-80.103451,63.725981]</span>,<span class="hljs-selector-attr">[-80.99102,63.411246]</span>,<span class="hljs-selector-attr">[-82.547178,63.651722]</span>,<span class="hljs-selector-attr">[-83.108798,64.101876]</span>,<span class="hljs-selector-attr">[-84.100417,63.569712]</span>,<span class="hljs-selector-attr">[-85.523405,63.052379]</span>,<span class="hljs-selector-attr">[-85.866769,63.637253]</span>,<span class="hljs-selector-attr">[-87.221983,63.541238]</span>,<span class="hljs-selector-attr">[-86.35276,64.035833]</span>,<span class="hljs-selector-attr">[-86.224886,64.822917]</span>,<span class="hljs-selector-attr">[-85.883848,65.738778]</span>,<span class="hljs-selector-attr">[-85.161308,65.657285]</span>]],<span class="hljs-selector-attr">[[[-75.86588,67.14886]</span>,<span class="hljs-selector-attr">[-76.98687,67.09873]</span>,<span class="hljs-selector-attr">[-77.2364,67.58809]</span>,<span class="hljs-selector-attr">[-76.81166,68.14856]</span>,<span class="hljs-selector-attr">[-75.89521,68.28721]</span>,<span class="hljs-selector-attr">[-75.1145,68.01036]</span>,<span class="hljs-selector-attr">[-75.10333,67.58202]</span>,<span class="hljs-selector-attr">[-75.21597,67.44425]</span>,<span class="hljs-selector-attr">[-75.86588,67.14886]</span>]],<span class="hljs-selector-attr">[[[-95.647681,69.10769]</span>,<span class="hljs-selector-attr">[-96.269521,68.75704]</span>,<span class="hljs-selector-attr">[-97.617401,69.06003]</span>,<span class="hljs-selector-attr">[-98.431801,68.9507]</span>,<span class="hljs-selector-attr">[-99.797401,69.40003]</span>,<span class="hljs-selector-attr">[-98.917401,69.71003]</span>,<span class="hljs-selector-attr">[-98.218261,70.14354]</span>,<span class="hljs-selector-attr">[-97.157401,69.86003]</span>,<span class="hljs-selector-attr">[-96.557401,69.68003]</span>,<span class="hljs-selector-attr">[-96.257401,69.49003]</span>,<span class="hljs-selector-attr">[-95.647681,69.10769]</span>]],<span class="hljs-selector-attr">[[[-90.5471,69.49766]</span>,<span class="hljs-selector-attr">[-90.55151,68.47499]</span>,<span class="hljs-selector-attr">[-89.21515,69.25873]</span>,<span class="hljs-selector-attr">[-88.01966,68.61508]</span>,<span class="hljs-selector-attr">[-88.31749,67.87338]</span>,<span class="hljs-selector-attr">[-87.35017,67.19872]</span>,<span class="hljs-selector-attr">[-86.30607,67.92146]</span>,<span class="hljs-selector-attr">[-85.57664,68.78456]</span>,<span class="hljs-selector-attr">[-85.52197,69.88211]</span>,<span class="hljs-selector-attr">[-84.10081,69.80539]</span>,<span class="hljs-selector-attr">[-82.62258,69.65826]</span>,<span class="hljs-selector-attr">[-81.28043,69.16202]</span>,<span class="hljs-selector-attr">[-81.2202,68.66567]</span>,<span class="hljs-selector-attr">[-81.96436,68.13253]</span>,<span class="hljs-selector-attr">[-81.25928,67.59716]</span>,<span class="hljs-selector-attr">[-81.38653,67.11078]</span>,<span class="hljs-selector-attr">[-83.34456,66.41154]</span>,<span class="hljs-selector-attr">[-84.73542,66.2573]</span>,<span class="hljs-selector-attr">[-85.76943,66.55833]</span>,<span class="hljs-selector-attr">[-86.0676,66.05625]</span>,<span class="hljs-selector-attr">[-87.03143,65.21297]</span>,<span class="hljs-selector-attr">[-87.32324,64.77563]</span>,<span class="hljs-selector-attr">[-88.48296,64.09897]</span>,<span class="hljs-selector-attr">[-89.91444,64.03273]</span>,<span class="hljs-selector-attr">[-90.70398,63.61017]</span>,<span class="hljs-selector-attr">[-90.77004,62.96021]</span>,<span class="hljs-selector-attr">[-91.93342,62.83508]</span>,<span class="hljs-selector-attr">[-93.15698,62.02469]</span>,<span class="hljs-selector-attr">[-94.24153,60.89865]</span>,<span class="hljs-selector-attr">[-94.62931,60.11021]</span>,<span class="hljs-selector-attr">[-94.6846,58.94882]</span>,<span class="hljs-selector-attr">[-93.21502,58.78212]</span>,<span class="hljs-selector-attr">[-92.76462,57.84571]</span>,<span class="hljs-selector-attr">[-92.29703,57.08709]</span>,<span class="hljs-selector-attr">[-90.89769,57.28468]</span>,<span class="hljs-selector-attr">[-89.03953,56.85172]</span>,<span class="hljs-selector-attr">[-88.03978,56.47162]</span>,<span class="hljs-selector-attr">[-87.32421,55.99914]</span>,<span class="hljs-selector-attr">[-86.07121,55.72383]</span>,<span class="hljs-selector-attr">[-85.01181,55.3026]</span>,<span class="hljs-selector-attr">[-83.36055,55.24489]</span>,<span class="hljs-selector-attr">[-82.27285,55.14832]</span>,<span class="hljs-selector-attr">[-82.4362,54.28227]</span>,<span class="hljs-selector-attr">[-82.12502,53.27703]</span>,<span class="hljs-selector-attr">[-81.40075,52.15788]</span>,<span class="hljs-selector-attr">[-79.91289,51.20842]</span>,<span class="hljs-selector-attr">[-79.14301,51.53393]</span>,<span class="hljs-selector-attr">[-78.60191,52.56208]</span>,<span class="hljs-selector-attr">[-79.12421,54.14145]</span>,<span class="hljs-selector-attr">[-79.82958,54.66772]</span>,<span class="hljs-selector-attr">[-78.22874,55.13645]</span>,<span class="hljs-selector-attr">[-77.0956,55.83741]</span>,<span class="hljs-selector-attr">[-76.54137,56.53423]</span>,<span class="hljs-selector-attr">[-76.62319,57.20263]</span>,<span class="hljs-selector-attr">[-77.30226,58.05209]</span>,<span class="hljs-selector-attr">[-78.51688,58.80458]</span>,<span class="hljs-selector-attr">[-77.33676,59.85261]</span>,<span class="hljs-selector-attr">[-77.77272,60.75788]</span>,<span class="hljs-selector-attr">[-78.10687,62.31964]</span>,<span class="hljs-selector-attr">[-77.41067,62.55053]</span>,<span class="hljs-selector-attr">[-75.69621,62.2784]</span>,<span class="hljs-selector-attr">[-74.6682,62.18111]</span>,<span class="hljs-selector-attr">[-73.83988,62.4438]</span>,<span class="hljs-selector-attr">[-72.90853,62.10507]</span>,<span class="hljs-selector-attr">[-71.67708,61.52535]</span>,<span class="hljs-selector-attr">[-71.37369,61.13717]</span>,<span class="hljs-selector-attr">[-69.59042,61.06141]</span>,<span class="hljs-selector-attr">[-69.62033,60.22125]</span>,<span class="hljs-selector-attr">[-69.2879,58.95736]</span>,<span class="hljs-selector-attr">[-68.37455,58.80106]</span>,<span class="hljs-selector-attr">[-67.64976,58.21206]</span>,<span class="hljs-selector-attr">[-66.20178,58.76731]</span>,<span class="hljs-selector-attr">[-65.24517,59.87071]</span>,<span class="hljs-selector-attr">[-64.58352,60.33558]</span>,<span class="hljs-selector-attr">[-63.80475,59.4426]</span>,<span class="hljs-selector-attr">[-62.50236,58.16708]</span>,<span class="hljs-selector-attr">[-61.39655,56.96745]</span>,<span class="hljs-selector-attr">[-61.79866,56.33945]</span>,<span class="hljs-selector-attr">[-60.46853,55.77548]</span>,<span class="hljs-selector-attr">[-59.56962,55.20407]</span>,<span class="hljs-selector-attr">[-57.97508,54.94549]</span>,<span class="hljs-selector-attr">[-57.3332,54.6265]</span>,<span class="hljs-selector-attr">[-56.93689,53.78032]</span>,<span class="hljs-selector-attr">[-56.15811,53.64749]</span>,<span class="hljs-selector-attr">[-55.75632,53.27036]</span>,<span class="hljs-selector-attr">[-55.68338,52.14664]</span>,<span class="hljs-selector-attr">[-56.40916,51.7707]</span>,<span class="hljs-selector-attr">[-57.12691,51.41972]</span>,<span class="hljs-selector-attr">[-58.77482,51.0643]</span>,<span class="hljs-selector-attr">[-60.03309,50.24277]</span>,<span class="hljs-selector-attr">[-61.72366,50.08046]</span>,<span class="hljs-selector-attr">[-63.86251,50.29099]</span>,<span class="hljs-selector-attr">[-65.36331,50.2982]</span>,<span class="hljs-selector-attr">[-66.39905,50.22897]</span>,<span class="hljs-selector-attr">[-67.23631,49.51156]</span>,<span class="hljs-selector-attr">[-68.51114,49.06836]</span>,<span class="hljs-selector-attr">[-69.95362,47.74488]</span>,<span class="hljs-selector-attr">[-71.10458,46.82171]</span>,<span class="hljs-selector-attr">[-70.25522,46.98606]</span>,<span class="hljs-selector-attr">[-68.65,48.3]</span>,<span class="hljs-selector-attr">[-66.55243,49.1331]</span>,<span class="hljs-selector-attr">[-65.05626,49.23278]</span>,<span class="hljs-selector-attr">[-64.17099,48.74248]</span>,<span class="hljs-selector-attr">[-65.11545,48.07085]</span>,<span class="hljs-selector-attr">[-64.79854,46.99297]</span>,<span class="hljs-selector-attr">[-64.47219,46.23849]</span>,<span class="hljs-selector-attr">[-63.17329,45.73902]</span>,<span class="hljs-selector-attr">[-61.52072,45.88377]</span>,<span class="hljs-selector-attr">[-60.51815,47.00793]</span>,<span class="hljs-selector-attr">[-60.4486,46.28264]</span>,<span class="hljs-selector-attr">[-59.80287,45.9204]</span>,<span class="hljs-selector-attr">[-61.03988,45.26525]</span>,<span class="hljs-selector-attr">[-63.25471,44.67014]</span>,<span class="hljs-selector-attr">[-64.24656,44.26553]</span>,<span class="hljs-selector-attr">[-65.36406,43.54523]</span>,<span class="hljs-selector-attr">[-66.1234,43.61867]</span>,<span class="hljs-selector-attr">[-66.16173,44.46512]</span>,<span class="hljs-selector-attr">[-64.42549,45.29204]</span>,<span class="hljs-selector-attr">[-66.02605,45.25931]</span>,<span class="hljs-selector-attr">[-67.13741,45.13753]</span>,<span class="hljs-selector-attr">[-67.79134,45.70281]</span>,<span class="hljs-selector-attr">[-67.79046,47.06636]</span>,<span class="hljs-selector-attr">[-68.23444,47.35486]</span>,<span class="hljs-selector-attr">[-68.905,47.185]</span>,<span class="hljs-selector-attr">[-69.237216,47.447781]</span>,<span class="hljs-selector-attr">[-69.99997,46.69307]</span>,<span class="hljs-selector-attr">[-70.305,45.915]</span>,<span class="hljs-selector-attr">[-70.66,45.46]</span>,<span class="hljs-selector-attr">[-71.08482,45.30524]</span>,<span class="hljs-selector-attr">[-71.405,45.255]</span>,<span class="hljs-selector-attr">[-71.50506,45.0082]</span>,<span class="hljs-selector-attr">[-73.34783,45.00738]</span>,<span class="hljs-selector-attr">[-74.867,45.00048]</span>,<span class="hljs-selector-attr">[-75.31821,44.81645]</span>,<span class="hljs-selector-attr">[-76.375,44.09631]</span>,<span class="hljs-selector-attr">[-76.5,44.018459]</span>,<span class="hljs-selector-attr">[-76.820034,43.628784]</span>,<span class="hljs-selector-attr">[-77.737885,43.629056]</span>,<span class="hljs-selector-attr">[-78.72028,43.625089]</span>,<span class="hljs-selector-attr">[-79.171674,43.466339]</span>,<span class="hljs-selector-attr">[-79.01,43.27]</span>,<span class="hljs-selector-attr">[-78.92,42.965]</span>,<span class="hljs-selector-attr">[-78.939362,42.863611]</span>,<span class="hljs-selector-attr">[-80.247448,42.3662]</span>,<span class="hljs-selector-attr">[-81.277747,42.209026]</span>,<span class="hljs-selector-attr">[-82.439278,41.675105]</span>,<span class="hljs-selector-attr">[-82.690089,41.675105]</span>,<span class="hljs-selector-attr">[-83.02981,41.832796]</span>,<span class="hljs-selector-attr">[-83.142,41.975681]</span>,<span class="hljs-selector-attr">[-83.12,42.08]</span>,<span class="hljs-selector-attr">[-82.9,42.43]</span>,<span class="hljs-selector-attr">[-82.43,42.98]</span>,<span class="hljs-selector-attr">[-82.137642,43.571088]</span>,<span class="hljs-selector-attr">[-82.337763,44.44]</span>,<span class="hljs-selector-attr">[-82.550925,45.347517]</span>,<span class="hljs-selector-attr">[-83.592851,45.816894]</span>,<span class="hljs-selector-attr">[-83.469551,45.994686]</span>,<span class="hljs-selector-attr">[-83.616131,46.116927]</span>,<span class="hljs-selector-attr">[-83.890765,46.116927]</span>,<span class="hljs-selector-attr">[-84.091851,46.275419]</span>,<span class="hljs-selector-attr">[-84.14212,46.512226]</span>,<span class="hljs-selector-attr">[-84.3367,46.40877]</span>,<span class="hljs-selector-attr">[-84.6049,46.4396]</span>,<span class="hljs-selector-attr">[-84.543749,46.538684]</span>,<span class="hljs-selector-attr">[-84.779238,46.637102]</span>,<span class="hljs-selector-attr">[-84.87608,46.900083]</span>,<span class="hljs-selector-attr">[-85.652363,47.220219]</span>,<span class="hljs-selector-attr">[-86.461991,47.553338]</span>,<span class="hljs-selector-attr">[-87.439793,47.94]</span>,<span class="hljs-selector-attr">[-88.378114,48.302918]</span>,<span class="hljs-selector-attr">[-89.272917,48.019808]</span>,<span class="hljs-selector-attr">[-89.6,48.01]</span>,<span class="hljs-selector-attr">[-90.83,48.27]</span>,<span class="hljs-selector-attr">[-91.64,48.14]</span>,<span class="hljs-selector-attr">[-92.61,48.45]</span>,<span class="hljs-selector-attr">[-93.63087,48.60926]</span>,<span class="hljs-selector-attr">[-94.32914,48.67074]</span>,<span class="hljs-selector-attr">[-94.64,48.84]</span>,<span class="hljs-selector-attr">[-94.81758,49.38905]</span>,<span class="hljs-selector-attr">[-95.15609,49.38425]</span>,<span class="hljs-selector-attr">[-95.15907,49]</span>,<span class="hljs-selector-attr">[-97.22872,49.0007]</span>,<span class="hljs-selector-attr">[-100.65,49]</span>,<span class="hljs-selector-attr">[-104.04826,48.99986]</span>,<span class="hljs-selector-attr">[-107.05,49]</span>,<span class="hljs-selector-attr">[-110.05,49]</span>,<span class="hljs-selector-attr">[-113,49]</span>,<span class="hljs-selector-attr">[-116.04818,49]</span>,<span class="hljs-selector-attr">[-117.03121,49]</span>,<span class="hljs-selector-attr">[-120,49]</span>,<span class="hljs-selector-attr">[-122.84,49]</span>,<span class="hljs-selector-attr">[-122.97421,49.002538]</span>,<span class="hljs-selector-attr">[-124.91024,49.98456]</span>,<span class="hljs-selector-attr">[-125.62461,50.41656]</span>,<span class="hljs-selector-attr">[-127.43561,50.83061]</span>,<span class="hljs-selector-attr">[-127.99276,51.71583]</span>,<span class="hljs-selector-attr">[-127.85032,52.32961]</span>,<span class="hljs-selector-attr">[-129.12979,52.75538]</span>,<span class="hljs-selector-attr">[-129.30523,53.56159]</span>,<span class="hljs-selector-attr">[-130.51497,54.28757]</span>,<span class="hljs-selector-attr">[-130.53611,54.80278]</span>,<span class="hljs-selector-attr">[-129.98,55.285]</span>,<span class="hljs-selector-attr">[-130.00778,55.91583]</span>,<span class="hljs-selector-attr">[-131.70781,56.55212]</span>,<span class="hljs-selector-attr">[-132.73042,57.69289]</span>,<span class="hljs-selector-attr">[-133.35556,58.41028]</span>,<span class="hljs-selector-attr">[-134.27111,58.86111]</span>,<span class="hljs-selector-attr">[-134.945,59.27056]</span>,<span class="hljs-selector-attr">[-135.47583,59.78778]</span>,<span class="hljs-selector-attr">[-136.47972,59.46389]</span>,<span class="hljs-selector-attr">[-137.4525,58.905]</span>,<span class="hljs-selector-attr">[-138.34089,59.56211]</span>,<span class="hljs-selector-attr">[-139.039,60]</span>,<span class="hljs-selector-attr">[-140.013,60.27682]</span>,<span class="hljs-selector-attr">[-140.99778,60.30639]</span>,<span class="hljs-selector-attr">[-140.9925,66.00003]</span>,<span class="hljs-selector-attr">[-140.986,69.712]</span>,<span class="hljs-selector-attr">[-139.12052,69.47102]</span>,<span class="hljs-selector-attr">[-137.54636,68.99002]</span>,<span class="hljs-selector-attr">[-136.50358,68.89804]</span>,<span class="hljs-selector-attr">[-135.62576,69.31512]</span>,<span class="hljs-selector-attr">[-134.41464,69.62743]</span>,<span class="hljs-selector-attr">[-132.92925,69.50534]</span>,<span class="hljs-selector-attr">[-131.43136,69.94451]</span>,<span class="hljs-selector-attr">[-129.79471,70.19369]</span>,<span class="hljs-selector-attr">[-129.10773,69.77927]</span>,<span class="hljs-selector-attr">[-128.36156,70.01286]</span>,<span class="hljs-selector-attr">[-128.13817,70.48384]</span>,<span class="hljs-selector-attr">[-127.44712,70.37721]</span>,<span class="hljs-selector-attr">[-125.75632,69.48058]</span>,<span class="hljs-selector-attr">[-124.42483,70.1584]</span>,<span class="hljs-selector-attr">[-124.28968,69.39969]</span>,<span class="hljs-selector-attr">[-123.06108,69.56372]</span>,<span class="hljs-selector-attr">[-122.6835,69.85553]</span>,<span class="hljs-selector-attr">[-121.47226,69.79778]</span>,<span class="hljs-selector-attr">[-119.94288,69.37786]</span>,<span class="hljs-selector-attr">[-117.60268,69.01128]</span>,<span class="hljs-selector-attr">[-116.22643,68.84151]</span>,<span class="hljs-selector-attr">[-115.2469,68.90591]</span>,<span class="hljs-selector-attr">[-113.89794,68.3989]</span>,<span class="hljs-selector-attr">[-115.30489,67.90261]</span>,<span class="hljs-selector-attr">[-113.49727,67.68815]</span>,<span class="hljs-selector-attr">[-110.798,67.80612]</span>,<span class="hljs-selector-attr">[-109.94619,67.98104]</span>,<span class="hljs-selector-attr">[-108.8802,67.38144]</span>,<span class="hljs-selector-attr">[-107.79239,67.88736]</span>,<span class="hljs-selector-attr">[-108.81299,68.31164]</span>,<span class="hljs-selector-attr">[-108.16721,68.65392]</span>,<span class="hljs-selector-attr">[-106.95,68.7]</span>,<span class="hljs-selector-attr">[-106.15,68.8]</span>,<span class="hljs-selector-attr">[-105.34282,68.56122]</span>,<span class="hljs-selector-attr">[-104.33791,68.018]</span>,<span class="hljs-selector-attr">[-103.22115,68.09775]</span>,<span class="hljs-selector-attr">[-101.45433,67.64689]</span>,<span class="hljs-selector-attr">[-99.90195,67.80566]</span>,<span class="hljs-selector-attr">[-98.4432,67.78165]</span>,<span class="hljs-selector-attr">[-98.5586,68.40394]</span>,<span class="hljs-selector-attr">[-97.66948,68.57864]</span>,<span class="hljs-selector-attr">[-96.11991,68.23939]</span>,<span class="hljs-selector-attr">[-96.12588,67.29338]</span>,<span class="hljs-selector-attr">[-95.48943,68.0907]</span>,<span class="hljs-selector-attr">[-94.685,68.06383]</span>,<span class="hljs-selector-attr">[-94.23282,69.06903]</span>,<span class="hljs-selector-attr">[-95.30408,69.68571]</span>,<span class="hljs-selector-attr">[-96.47131,70.08976]</span>,<span class="hljs-selector-attr">[-96.39115,71.19482]</span>,<span class="hljs-selector-attr">[-95.2088,71.92053]</span>,<span class="hljs-selector-attr">[-93.88997,71.76015]</span>,<span class="hljs-selector-attr">[-92.87818,71.31869]</span>,<span class="hljs-selector-attr">[-91.51964,70.19129]</span>,<span class="hljs-selector-attr">[-92.40692,69.69997]</span>,<span class="hljs-selector-attr">[-90.5471,69.49766]</span>]],<span class="hljs-selector-attr">[[[-114.16717,73.12145]</span>,<span class="hljs-selector-attr">[-114.66634,72.65277]</span>,<span class="hljs-selector-attr">[-112.44102,72.9554]</span>,<span class="hljs-selector-attr">[-111.05039,72.4504]</span>,<span class="hljs-selector-attr">[-109.92035,72.96113]</span>,<span class="hljs-selector-attr">[-109.00654,72.63335]</span>,<span class="hljs-selector-attr">[-108.18835,71.65089]</span>,<span class="hljs-selector-attr">[-107.68599,72.06548]</span>,<span class="hljs-selector-attr">[-108.39639,73.08953]</span>,<span class="hljs-selector-attr">[-107.51645,73.23598]</span>,<span class="hljs-selector-attr">[-106.52259,73.07601]</span>,<span class="hljs-selector-attr">[-105.40246,72.67259]</span>,<span class="hljs-selector-attr">[-104.77484,71.6984]</span>,<span class="hljs-selector-attr">[-104.46476,70.99297]</span>,<span class="hljs-selector-attr">[-102.78537,70.49776]</span>,<span class="hljs-selector-attr">[-100.98078,70.02432]</span>,<span class="hljs-selector-attr">[-101.08929,69.58447]</span>,<span class="hljs-selector-attr">[-102.73116,69.50402]</span>,<span class="hljs-selector-attr">[-102.09329,69.11962]</span>,<span class="hljs-selector-attr">[-102.43024,68.75282]</span>,<span class="hljs-selector-attr">[-104.24,68.91]</span>,<span class="hljs-selector-attr">[-105.96,69.18]</span>,<span class="hljs-selector-attr">[-107.12254,69.11922]</span>,<span class="hljs-selector-attr">[-109,68.78]</span>,<span class="hljs-selector-attr">[-111.534149,68.630059]</span>,<span class="hljs-selector-attr">[-113.3132,68.53554]</span>,<span class="hljs-selector-attr">[-113.85496,69.00744]</span>,<span class="hljs-selector-attr">[-115.22,69.28]</span>,<span class="hljs-selector-attr">[-116.10794,69.16821]</span>,<span class="hljs-selector-attr">[-117.34,69.96]</span>,<span class="hljs-selector-attr">[-116.67473,70.06655]</span>,<span class="hljs-selector-attr">[-115.13112,70.2373]</span>,<span class="hljs-selector-attr">[-113.72141,70.19237]</span>,<span class="hljs-selector-attr">[-112.4161,70.36638]</span>,<span class="hljs-selector-attr">[-114.35,70.6]</span>,<span class="hljs-selector-attr">[-116.48684,70.52045]</span>,<span class="hljs-selector-attr">[-117.9048,70.54056]</span>,<span class="hljs-selector-attr">[-118.43238,70.9092]</span>,<span class="hljs-selector-attr">[-116.11311,71.30918]</span>,<span class="hljs-selector-attr">[-117.65568,71.2952]</span>,<span class="hljs-selector-attr">[-119.40199,71.55859]</span>,<span class="hljs-selector-attr">[-118.56267,72.30785]</span>,<span class="hljs-selector-attr">[-117.86642,72.70594]</span>,<span class="hljs-selector-attr">[-115.18909,73.31459]</span>,<span class="hljs-selector-attr">[-114.16717,73.12145]</span>]],<span class="hljs-selector-attr">[[[-104.5,73.42]</span>,<span class="hljs-selector-attr">[-105.38,72.76]</span>,<span class="hljs-selector-attr">[-106.94,73.46]</span>,<span class="hljs-selector-attr">[-106.6,73.6]</span>,<span class="hljs-selector-attr">[-105.26,73.64]</span>,<span class="hljs-selector-attr">[-104.5,73.42]</span>]],<span class="hljs-selector-attr">[[[-76.34,73.102685]</span>,<span class="hljs-selector-attr">[-76.251404,72.826385]</span>,<span class="hljs-selector-attr">[-77.314438,72.855545]</span>,<span class="hljs-selector-attr">[-78.39167,72.876656]</span>,<span class="hljs-selector-attr">[-79.486252,72.742203]</span>,<span class="hljs-selector-attr">[-79.775833,72.802902]</span>,<span class="hljs-selector-attr">[-80.876099,73.333183]</span>,<span class="hljs-selector-attr">[-80.833885,73.693184]</span>,<span class="hljs-selector-attr">[-80.353058,73.75972]</span>,<span class="hljs-selector-attr">[-78.064438,73.651932]</span>,<span class="hljs-selector-attr">[-76.34,73.102685]</span>]],<span class="hljs-selector-attr">[[[-86.562179,73.157447]</span>,<span class="hljs-selector-attr">[-85.774371,72.534126]</span>,<span class="hljs-selector-attr">[-84.850112,73.340278]</span>,<span class="hljs-selector-attr">[-82.31559,73.750951]</span>,<span class="hljs-selector-attr">[-80.600088,72.716544]</span>,<span class="hljs-selector-attr">[-80.748942,72.061907]</span>,<span class="hljs-selector-attr">[-78.770639,72.352173]</span>,<span class="hljs-selector-attr">[-77.824624,72.749617]</span>,<span class="hljs-selector-attr">[-75.605845,72.243678]</span>,<span class="hljs-selector-attr">[-74.228616,71.767144]</span>,<span class="hljs-selector-attr">[-74.099141,71.33084]</span>,<span class="hljs-selector-attr">[-72.242226,71.556925]</span>,<span class="hljs-selector-attr">[-71.200015,70.920013]</span>,<span class="hljs-selector-attr">[-68.786054,70.525024]</span>,<span class="hljs-selector-attr">[-67.91497,70.121948]</span>,<span class="hljs-selector-attr">[-66.969033,69.186087]</span>,<span class="hljs-selector-attr">[-68.805123,68.720198]</span>,<span class="hljs-selector-attr">[-66.449866,68.067163]</span>,<span class="hljs-selector-attr">[-64.862314,67.847539]</span>,<span class="hljs-selector-attr">[-63.424934,66.928473]</span>,<span class="hljs-selector-attr">[-61.851981,66.862121]</span>,<span class="hljs-selector-attr">[-62.163177,66.160251]</span>,<span class="hljs-selector-attr">[-63.918444,64.998669]</span>,<span class="hljs-selector-attr">[-65.14886,65.426033]</span>,<span class="hljs-selector-attr">[-66.721219,66.388041]</span>,<span class="hljs-selector-attr">[-68.015016,66.262726]</span>,<span class="hljs-selector-attr">[-68.141287,65.689789]</span>,<span class="hljs-selector-attr">[-67.089646,65.108455]</span>,<span class="hljs-selector-attr">[-65.73208,64.648406]</span>,<span class="hljs-selector-attr">[-65.320168,64.382737]</span>,<span class="hljs-selector-attr">[-64.669406,63.392927]</span>,<span class="hljs-selector-attr">[-65.013804,62.674185]</span>,<span class="hljs-selector-attr">[-66.275045,62.945099]</span>,<span class="hljs-selector-attr">[-68.783186,63.74567]</span>,<span class="hljs-selector-attr">[-67.369681,62.883966]</span>,<span class="hljs-selector-attr">[-66.328297,62.280075]</span>,<span class="hljs-selector-attr">[-66.165568,61.930897]</span>,<span class="hljs-selector-attr">[-68.877367,62.330149]</span>,<span class="hljs-selector-attr">[-71.023437,62.910708]</span>,<span class="hljs-selector-attr">[-72.235379,63.397836]</span>,<span class="hljs-selector-attr">[-71.886278,63.679989]</span>,<span class="hljs-selector-attr">[-73.378306,64.193963]</span>,<span class="hljs-selector-attr">[-74.834419,64.679076]</span>,<span class="hljs-selector-attr">[-74.818503,64.389093]</span>,<span class="hljs-selector-attr">[-77.70998,64.229542]</span>,<span class="hljs-selector-attr">[-78.555949,64.572906]</span>,<span class="hljs-selector-attr">[-77.897281,65.309192]</span>,<span class="hljs-selector-attr">[-76.018274,65.326969]</span>,<span class="hljs-selector-attr">[-73.959795,65.454765]</span>,<span class="hljs-selector-attr">[-74.293883,65.811771]</span>,<span class="hljs-selector-attr">[-73.944912,66.310578]</span>,<span class="hljs-selector-attr">[-72.651167,67.284576]</span>,<span class="hljs-selector-attr">[-72.92606,67.726926]</span>,<span class="hljs-selector-attr">[-73.311618,68.069437]</span>,<span class="hljs-selector-attr">[-74.843307,68.554627]</span>,<span class="hljs-selector-attr">[-76.869101,68.894736]</span>,<span class="hljs-selector-attr">[-76.228649,69.147769]</span>,<span class="hljs-selector-attr">[-77.28737,69.76954]</span>,<span class="hljs-selector-attr">[-78.168634,69.826488]</span>,<span class="hljs-selector-attr">[-78.957242,70.16688]</span>,<span class="hljs-selector-attr">[-79.492455,69.871808]</span>,<span class="hljs-selector-attr">[-81.305471,69.743185]</span>,<span class="hljs-selector-attr">[-84.944706,69.966634]</span>,<span class="hljs-selector-attr">[-87.060003,70.260001]</span>,<span class="hljs-selector-attr">[-88.681713,70.410741]</span>,<span class="hljs-selector-attr">[-89.51342,70.762038]</span>,<span class="hljs-selector-attr">[-88.467721,71.218186]</span>,<span class="hljs-selector-attr">[-89.888151,71.222552]</span>,<span class="hljs-selector-attr">[-90.20516,72.235074]</span>,<span class="hljs-selector-attr">[-89.436577,73.129464]</span>,<span class="hljs-selector-attr">[-88.408242,73.537889]</span>,<span class="hljs-selector-attr">[-85.826151,73.803816]</span>,<span class="hljs-selector-attr">[-86.562179,73.157447]</span>]],<span class="hljs-selector-attr">[[[-100.35642,73.84389]</span>,<span class="hljs-selector-attr">[-99.16387,73.63339]</span>,<span class="hljs-selector-attr">[-97.38,73.76]</span>,<span class="hljs-selector-attr">[-97.12,73.47]</span>,<span class="hljs-selector-attr">[-98.05359,72.99052]</span>,<span class="hljs-selector-attr">[-96.54,72.56]</span>,<span class="hljs-selector-attr">[-96.72,71.66]</span>,<span class="hljs-selector-attr">[-98.35966,71.27285]</span>,<span class="hljs-selector-attr">[-99.32286,71.35639]</span>,<span class="hljs-selector-attr">[-100.01482,71.73827]</span>,<span class="hljs-selector-attr">[-102.5,72.51]</span>,<span class="hljs-selector-attr">[-102.48,72.83]</span>,<span class="hljs-selector-attr">[-100.43836,72.70588]</span>,<span class="hljs-selector-attr">[-101.54,73.36]</span>,<span class="hljs-selector-attr">[-100.35642,73.84389]</span>]],<span class="hljs-selector-attr">[[[-93.196296,72.771992]</span>,<span class="hljs-selector-attr">[-94.269047,72.024596]</span>,<span class="hljs-selector-attr">[-95.409856,72.061881]</span>,<span class="hljs-selector-attr">[-96.033745,72.940277]</span>,<span class="hljs-selector-attr">[-96.018268,73.43743]</span>,<span class="hljs-selector-attr">[-95.495793,73.862417]</span>,<span class="hljs-selector-attr">[-94.503658,74.134907]</span>,<span class="hljs-selector-attr">[-92.420012,74.100025]</span>,<span class="hljs-selector-attr">[-90.509793,73.856732]</span>,<span class="hljs-selector-attr">[-92.003965,72.966244]</span>,<span class="hljs-selector-attr">[-93.196296,72.771992]</span>]],<span class="hljs-selector-attr">[[[-120.46,71.383602]</span>,<span class="hljs-selector-attr">[-123.09219,70.90164]</span>,<span class="hljs-selector-attr">[-123.62,71.34]</span>,<span class="hljs-selector-attr">[-125.928949,71.868688]</span>,<span class="hljs-selector-attr">[-125.5,72.292261]</span>,<span class="hljs-selector-attr">[-124.80729,73.02256]</span>,<span class="hljs-selector-attr">[-123.94,73.68]</span>,<span class="hljs-selector-attr">[-124.91775,74.29275]</span>,<span class="hljs-selector-attr">[-121.53788,74.44893]</span>,<span class="hljs-selector-attr">[-120.10978,74.24135]</span>,<span class="hljs-selector-attr">[-117.55564,74.18577]</span>,<span class="hljs-selector-attr">[-116.58442,73.89607]</span>,<span class="hljs-selector-attr">[-115.51081,73.47519]</span>,<span class="hljs-selector-attr">[-116.76794,73.22292]</span>,<span class="hljs-selector-attr">[-119.22,72.52]</span>,<span class="hljs-selector-attr">[-120.46,71.82]</span>,<span class="hljs-selector-attr">[-120.46,71.383602]</span>]],<span class="hljs-selector-attr">[[[-93.612756,74.979997]</span>,<span class="hljs-selector-attr">[-94.156909,74.592347]</span>,<span class="hljs-selector-attr">[-95.608681,74.666864]</span>,<span class="hljs-selector-attr">[-96.820932,74.927623]</span>,<span class="hljs-selector-attr">[-96.288587,75.377828]</span>,<span class="hljs-selector-attr">[-94.85082,75.647218]</span>,<span class="hljs-selector-attr">[-93.977747,75.29649]</span>,<span class="hljs-selector-attr">[-93.612756,74.979997]</span>]],<span class="hljs-selector-attr">[[[-98.5,76.72]</span>,<span class="hljs-selector-attr">[-97.735585,76.25656]</span>,<span class="hljs-selector-attr">[-97.704415,75.74344]</span>,<span class="hljs-selector-attr">[-98.16,75]</span>,<span class="hljs-selector-attr">[-99.80874,74.89744]</span>,<span class="hljs-selector-attr">[-100.88366,75.05736]</span>,<span class="hljs-selector-attr">[-100.86292,75.64075]</span>,<span class="hljs-selector-attr">[-102.50209,75.5638]</span>,<span class="hljs-selector-attr">[-102.56552,76.3366]</span>,<span class="hljs-selector-attr">[-101.48973,76.30537]</span>,<span class="hljs-selector-attr">[-99.98349,76.64634]</span>,<span class="hljs-selector-attr">[-98.57699,76.58859]</span>,<span class="hljs-selector-attr">[-98.5,76.72]</span>]],<span class="hljs-selector-attr">[[[-108.21141,76.20168]</span>,<span class="hljs-selector-attr">[-107.81943,75.84552]</span>,<span class="hljs-selector-attr">[-106.92893,76.01282]</span>,<span class="hljs-selector-attr">[-105.881,75.9694]</span>,<span class="hljs-selector-attr">[-105.70498,75.47951]</span>,<span class="hljs-selector-attr">[-106.31347,75.00527]</span>,<span class="hljs-selector-attr">[-109.7,74.85]</span>,<span class="hljs-selector-attr">[-112.22307,74.41696]</span>,<span class="hljs-selector-attr">[-113.74381,74.39427]</span>,<span class="hljs-selector-attr">[-113.87135,74.72029]</span>,<span class="hljs-selector-attr">[-111.79421,75.1625]</span>,<span class="hljs-selector-attr">[-116.31221,75.04343]</span>,<span class="hljs-selector-attr">[-117.7104,75.2222]</span>,<span class="hljs-selector-attr">[-116.34602,76.19903]</span>,<span class="hljs-selector-attr">[-115.40487,76.47887]</span>,<span class="hljs-selector-attr">[-112.59056,76.14134]</span>,<span class="hljs-selector-attr">[-110.81422,75.54919]</span>,<span class="hljs-selector-attr">[-109.0671,75.47321]</span>,<span class="hljs-selector-attr">[-110.49726,76.42982]</span>,<span class="hljs-selector-attr">[-109.5811,76.79417]</span>,<span class="hljs-selector-attr">[-108.54859,76.67832]</span>,<span class="hljs-selector-attr">[-108.21141,76.20168]</span>]],<span class="hljs-selector-attr">[[[-94.684086,77.097878]</span>,<span class="hljs-selector-attr">[-93.573921,76.776296]</span>,<span class="hljs-selector-attr">[-91.605023,76.778518]</span>,<span class="hljs-selector-attr">[-90.741846,76.449597]</span>,<span class="hljs-selector-attr">[-90.969661,76.074013]</span>,<span class="hljs-selector-attr">[-89.822238,75.847774]</span>,<span class="hljs-selector-attr">[-89.187083,75.610166]</span>,<span class="hljs-selector-attr">[-87.838276,75.566189]</span>,<span class="hljs-selector-attr">[-86.379192,75.482421]</span>,<span class="hljs-selector-attr">[-84.789625,75.699204]</span>,<span class="hljs-selector-attr">[-82.753445,75.784315]</span>,<span class="hljs-selector-attr">[-81.128531,75.713983]</span>,<span class="hljs-selector-attr">[-80.057511,75.336849]</span>,<span class="hljs-selector-attr">[-79.833933,74.923127]</span>,<span class="hljs-selector-attr">[-80.457771,74.657304]</span>,<span class="hljs-selector-attr">[-81.948843,74.442459]</span>,<span class="hljs-selector-attr">[-83.228894,74.564028]</span>,<span class="hljs-selector-attr">[-86.097452,74.410032]</span>,<span class="hljs-selector-attr">[-88.15035,74.392307]</span>,<span class="hljs-selector-attr">[-89.764722,74.515555]</span>,<span class="hljs-selector-attr">[-92.422441,74.837758]</span>,<span class="hljs-selector-attr">[-92.768285,75.38682]</span>,<span class="hljs-selector-attr">[-92.889906,75.882655]</span>,<span class="hljs-selector-attr">[-93.893824,76.319244]</span>,<span class="hljs-selector-attr">[-95.962457,76.441381]</span>,<span class="hljs-selector-attr">[-97.121379,76.751078]</span>,<span class="hljs-selector-attr">[-96.745123,77.161389]</span>,<span class="hljs-selector-attr">[-94.684086,77.097878]</span>]],<span class="hljs-selector-attr">[[[-116.198587,77.645287]</span>,<span class="hljs-selector-attr">[-116.335813,76.876962]</span>,<span class="hljs-selector-attr">[-117.106051,76.530032]</span>,<span class="hljs-selector-attr">[-118.040412,76.481172]</span>,<span class="hljs-selector-attr">[-119.899318,76.053213]</span>,<span class="hljs-selector-attr">[-121.499995,75.900019]</span>,<span class="hljs-selector-attr">[-122.854924,76.116543]</span>,<span class="hljs-selector-attr">[-122.854925,76.116543]</span>,<span class="hljs-selector-attr">[-121.157535,76.864508]</span>,<span class="hljs-selector-attr">[-119.103939,77.51222]</span>,<span class="hljs-selector-attr">[-117.570131,77.498319]</span>,<span class="hljs-selector-attr">[-116.198587,77.645287]</span>]],<span class="hljs-selector-attr">[[[-93.840003,77.519997]</span>,<span class="hljs-selector-attr">[-94.295608,77.491343]</span>,<span class="hljs-selector-attr">[-96.169654,77.555111]</span>,<span class="hljs-selector-attr">[-96.436304,77.834629]</span>,<span class="hljs-selector-attr">[-94.422577,77.820005]</span>,<span class="hljs-selector-attr">[-93.720656,77.634331]</span>,<span class="hljs-selector-attr">[-93.840003,77.519997]</span>]],<span class="hljs-selector-attr">[[[-110.186938,77.697015]</span>,<span class="hljs-selector-attr">[-112.051191,77.409229]</span>,<span class="hljs-selector-attr">[-113.534279,77.732207]</span>,<span class="hljs-selector-attr">[-112.724587,78.05105]</span>,<span class="hljs-selector-attr">[-111.264443,78.152956]</span>,<span class="hljs-selector-attr">[-109.854452,77.996325]</span>,<span class="hljs-selector-attr">[-110.186938,77.697015]</span>]],<span class="hljs-selector-attr">[[[-109.663146,78.601973]</span>,<span class="hljs-selector-attr">[-110.881314,78.40692]</span>,<span class="hljs-selector-attr">[-112.542091,78.407902]</span>,<span class="hljs-selector-attr">[-112.525891,78.550555]</span>,<span class="hljs-selector-attr">[-111.50001,78.849994]</span>,<span class="hljs-selector-attr">[-110.963661,78.804441]</span>,<span class="hljs-selector-attr">[-109.663146,78.601973]</span>]],<span class="hljs-selector-attr">[[[-95.830295,78.056941]</span>,<span class="hljs-selector-attr">[-97.309843,77.850597]</span>,<span class="hljs-selector-attr">[-98.124289,78.082857]</span>,<span class="hljs-selector-attr">[-98.552868,78.458105]</span>,<span class="hljs-selector-attr">[-98.631984,78.87193]</span>,<span class="hljs-selector-attr">[-97.337231,78.831984]</span>,<span class="hljs-selector-attr">[-96.754399,78.765813]</span>,<span class="hljs-selector-attr">[-95.559278,78.418315]</span>,<span class="hljs-selector-attr">[-95.830295,78.056941]</span>]],<span class="hljs-selector-attr">[[[-100.060192,78.324754]</span>,<span class="hljs-selector-attr">[-99.670939,77.907545]</span>,<span class="hljs-selector-attr">[-101.30394,78.018985]</span>,<span class="hljs-selector-attr">[-102.949809,78.343229]</span>,<span class="hljs-selector-attr">[-105.176133,78.380332]</span>,<span class="hljs-selector-attr">[-104.210429,78.67742]</span>,<span class="hljs-selector-attr">[-105.41958,78.918336]</span>,<span class="hljs-selector-attr">[-105.492289,79.301594]</span>,<span class="hljs-selector-attr">[-103.529282,79.165349]</span>,<span class="hljs-selector-attr">[-100.825158,78.800462]</span>,<span class="hljs-selector-attr">[-100.060192,78.324754]</span>]],<span class="hljs-selector-attr">[[[-87.02,79.66]</span>,<span class="hljs-selector-attr">[-85.81435,79.3369]</span>,<span class="hljs-selector-attr">[-87.18756,79.0393]</span>,<span class="hljs-selector-attr">[-89.03535,78.28723]</span>,<span class="hljs-selector-attr">[-90.80436,78.21533]</span>,<span class="hljs-selector-attr">[-92.87669,78.34333]</span>,<span class="hljs-selector-attr">[-93.95116,78.75099]</span>,<span class="hljs-selector-attr">[-93.93574,79.11373]</span>,<span class="hljs-selector-attr">[-93.14524,79.3801]</span>,<span class="hljs-selector-attr">[-94.974,79.37248]</span>,<span class="hljs-selector-attr">[-96.07614,79.70502]</span>,<span class="hljs-selector-attr">[-96.70972,80.15777]</span>,<span class="hljs-selector-attr">[-96.01644,80.60233]</span>,<span class="hljs-selector-attr">[-95.32345,80.90729]</span>,<span class="hljs-selector-attr">[-94.29843,80.97727]</span>,<span class="hljs-selector-attr">[-94.73542,81.20646]</span>,<span class="hljs-selector-attr">[-92.40984,81.25739]</span>,<span class="hljs-selector-attr">[-91.13289,80.72345]</span>,<span class="hljs-selector-attr">[-89.45,80.509322]</span>,<span class="hljs-selector-attr">[-87.81,80.32]</span>,<span class="hljs-selector-attr">[-87.02,79.66]</span>]],<span class="hljs-selector-attr">[[[-68.5,83.106322]</span>,<span class="hljs-selector-attr">[-65.82735,83.02801]</span>,<span class="hljs-selector-attr">[-63.68,82.9]</span>,<span class="hljs-selector-attr">[-61.85,82.6286]</span>,<span class="hljs-selector-attr">[-61.89388,82.36165]</span>,<span class="hljs-selector-attr">[-64.334,81.92775]</span>,<span class="hljs-selector-attr">[-66.75342,81.72527]</span>,<span class="hljs-selector-attr">[-67.65755,81.50141]</span>,<span class="hljs-selector-attr">[-65.48031,81.50657]</span>,<span class="hljs-selector-attr">[-67.84,80.9]</span>,<span class="hljs-selector-attr">[-69.4697,80.61683]</span>,<span class="hljs-selector-attr">[-71.18,79.8]</span>,<span class="hljs-selector-attr">[-73.2428,79.63415]</span>,<span class="hljs-selector-attr">[-73.88,79.430162]</span>,<span class="hljs-selector-attr">[-76.90773,79.32309]</span>,<span class="hljs-selector-attr">[-75.52924,79.19766]</span>,<span class="hljs-selector-attr">[-76.22046,79.01907]</span>,<span class="hljs-selector-attr">[-75.39345,78.52581]</span>,<span class="hljs-selector-attr">[-76.34354,78.18296]</span>,<span class="hljs-selector-attr">[-77.88851,77.89991]</span>,<span class="hljs-selector-attr">[-78.36269,77.50859]</span>,<span class="hljs-selector-attr">[-79.75951,77.20968]</span>,<span class="hljs-selector-attr">[-79.61965,76.98336]</span>,<span class="hljs-selector-attr">[-77.91089,77.022045]</span>,<span class="hljs-selector-attr">[-77.88911,76.777955]</span>,<span class="hljs-selector-attr">[-80.56125,76.17812]</span>,<span class="hljs-selector-attr">[-83.17439,76.45403]</span>,<span class="hljs-selector-attr">[-86.11184,76.29901]</span>,<span class="hljs-selector-attr">[-87.6,76.42]</span>,<span class="hljs-selector-attr">[-89.49068,76.47239]</span>,<span class="hljs-selector-attr">[-89.6161,76.95213]</span>,<span class="hljs-selector-attr">[-87.76739,77.17833]</span>,<span class="hljs-selector-attr">[-88.26,77.9]</span>,<span class="hljs-selector-attr">[-87.65,77.970222]</span>,<span class="hljs-selector-attr">[-84.97634,77.53873]</span>,<span class="hljs-selector-attr">[-86.34,78.18]</span>,<span class="hljs-selector-attr">[-87.96192,78.37181]</span>,<span class="hljs-selector-attr">[-87.15198,78.75867]</span>,<span class="hljs-selector-attr">[-85.37868,78.9969]</span>,<span class="hljs-selector-attr">[-85.09495,79.34543]</span>,<span class="hljs-selector-attr">[-86.50734,79.73624]</span>,<span class="hljs-selector-attr">[-86.93179,80.25145]</span>,<span class="hljs-selector-attr">[-84.19844,80.20836]</span>,<span class="hljs-selector-attr">[-83.408696,80.1]</span>,<span class="hljs-selector-attr">[-81.84823,80.46442]</span>,<span class="hljs-selector-attr">[-84.1,80.58]</span>,<span class="hljs-selector-attr">[-87.59895,80.51627]</span>,<span class="hljs-selector-attr">[-89.36663,80.85569]</span>,<span class="hljs-selector-attr">[-90.2,81.26]</span>,<span class="hljs-selector-attr">[-91.36786,81.5531]</span>,<span class="hljs-selector-attr">[-91.58702,81.89429]</span>,<span class="hljs-selector-attr">[-90.1,82.085]</span>,<span class="hljs-selector-attr">[-88.93227,82.11751]</span>,<span class="hljs-selector-attr">[-86.97024,82.27961]</span>,<span class="hljs-selector-attr">[-85.5,82.652273]</span>,<span class="hljs-selector-attr">[-84.260005,82.6]</span>,<span class="hljs-selector-attr">[-83.18,82.32]</span>,<span class="hljs-selector-attr">[-82.42,82.86]</span>,<span class="hljs-selector-attr">[-81.1,83.02]</span>,<span class="hljs-selector-attr">[-79.30664,83.13056]</span>,<span class="hljs-selector-attr">[-76.25,83.172059]</span>,<span class="hljs-selector-attr">[-75.71878,83.06404]</span>,<span class="hljs-selector-attr">[-72.83153,83.23324]</span>,<span class="hljs-selector-attr">[-70.665765,83.169781]</span>,<span class="hljs-selector-attr">[-68.5,83.106322]</span>]]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CHE</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Switzerland</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Polygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[9.594226,47.525058]</span>,<span class="hljs-selector-attr">[9.632932,47.347601]</span>,<span class="hljs-selector-attr">[9.47997,47.10281]</span>,<span class="hljs-selector-attr">[9.932448,46.920728]</span>,<span class="hljs-selector-attr">[10.442701,46.893546]</span>,<span class="hljs-selector-attr">[10.363378,46.483571]</span>,<span class="hljs-selector-attr">[9.922837,46.314899]</span>,<span class="hljs-selector-attr">[9.182882,46.440215]</span>,<span class="hljs-selector-attr">[8.966306,46.036932]</span>,<span class="hljs-selector-attr">[8.489952,46.005151]</span>,<span class="hljs-selector-attr">[8.31663,46.163642]</span>,<span class="hljs-selector-attr">[7.755992,45.82449]</span>,<span class="hljs-selector-attr">[7.273851,45.776948]</span>,<span class="hljs-selector-attr">[6.843593,45.991147]</span>,<span class="hljs-selector-attr">[6.5001,46.429673]</span>,<span class="hljs-selector-attr">[6.022609,46.27299]</span>,<span class="hljs-selector-attr">[6.037389,46.725779]</span>,<span class="hljs-selector-attr">[6.768714,47.287708]</span>,<span class="hljs-selector-attr">[6.736571,47.541801]</span>,<span class="hljs-selector-attr">[7.192202,47.449766]</span>,<span class="hljs-selector-attr">[7.466759,47.620582]</span>,<span class="hljs-selector-attr">[8.317301,47.61358]</span>,<span class="hljs-selector-attr">[8.522612,47.830828]</span>,<span class="hljs-selector-attr">[9.594226,47.525058]</span>]]}},
{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">Feature</span>","<span class="hljs-selector-tag">id</span>":"<span class="hljs-selector-tag">CHL</span>","<span class="hljs-selector-tag">properties</span>":{"<span class="hljs-selector-tag">name</span>":"<span class="hljs-selector-tag">Chile</span>"},"<span class="hljs-selector-tag">geometry</span>":{"<span class="hljs-selector-tag">type</span>":"<span class="hljs-selector-tag">MultiPolygon</span>","<span class="hljs-selector-tag">coordinates</span>":<span class="hljs-selector-attr">[[[[-68.63401,-52.63637]</span>,<span class="hljs-selector-attr">[-68.63335,-54.8695]</span>,<span class="hljs-selector-attr">[-67.56244,-54.87001]</span>,<span class="hljs-selector-attr">[-66.95992,-54.89681]</span>,<span class="hljs-selector-attr">[-67.29103,-55.30124]</span>,<span class="hljs-selector-attr">[-68.14863,-55.61183]</span>,<span class="hljs-selector-attr">[-68.639991,-55.580018]</span>,<span class="hljs-selector-attr">[-69.2321,-55.49906]</span>,<span class="hljs-selector-attr">[-69.95809,-55.19843]</span>,<span class="hljs-selector-attr">[-71.00568,-55.05383]</span>,<span class="hljs-selector-attr">[-72.2639,-54.49514]</span>,<span class="hljs-selector-attr">[-73.2852,-53.95752]</span>,<span class="hljs-selector-attr">[-74.66253,-52.83749]</span>,<span class="hljs-selector-attr">[-73.8381,-53.04743]</span>,<span class="hljs-selector-attr">[-72.43418,-53.7154]</span>,<span class="hljs-selector-attr">[-71.10773,-54.07433]</span>,<span class="hljs-selector-attr">[-70.59178,-53.61583]</span>,<span class="hljs-selector-attr">[-70.26748,-52.93123]</span>,<span class="hljs-selector-attr">[-69.34565,-52.5183]</span>,<span class="hljs-selector-attr">[-68.63401,-52.63637]</span>]],<span class="hljs-selector-attr">[[[-68.219913,-21.494347]</span>,<span class="hljs-selector-attr">[-67.82818,-22.872919]</span>,<span class="hljs-selector-attr">[-67.106674,-22.735925]</span>,<span class="hljs-selector-attr">[-66.985234,-22.986349]</span>,<span class="hljs-selector-attr">[-67.328443,-24.025303]</span>,<span class="hljs-selector-attr">[-68.417653,-24.518555]</span>,<span class="hljs-selector-attr">[-68.386001,-26.185016]</span>,<span class="hljs-selector-attr">[-68.5948,-26.506909]</span>,<span class="hljs-selector-attr">[-68.295542,-26.89934]</span>,<span class="hljs-selector-attr">[-69.001235,-27.521214]</span>,<span class="hljs-selector-attr">[-69.65613,-28.459141]</span>,<span class="hljs-selector-attr">[-70.01355,-29.367923]</span>,<span class="hljs-selector-attr">[-69.919008,-30.336339]</span>,<span class="hljs-selector-attr">[-70.535069,-31.36501]</span>,<span class="hljs-selector-attr">[-70.074399,-33.09121]</span>,<span class="hljs-selector-attr">[-69.814777,-33.273886]</span>,<span class="hljs-selector-attr">[-69.817309,-34.193571]</span>,<span class="hljs-selector-attr">[-70.388049,-35.169688]</span>,<span class="hljs-selector-attr">[-70.364769,-36.005089]</span>,<span class="hljs-selector-attr">[-71.121881,-36.658124]</span>,<span class="hljs-selector-attr">[-71.118625,-37.576827]</span>,<span class="hljs-selector-attr">[-70.814664,-38.552995]</span>,<span class="hljs-selector-attr">[-71.413517,-38.916022]</span>,<span class="hljs-selector-attr">[-71.680761,-39.808164]</span>,<span class="hljs-selector-attr">[-71.915734,-40.832339]</span>,<span class="hljs-selector-attr">[-71.746804,-42.051386]</span>,<span class="hljs-selector-attr">[-72.148898,-42.254888]</span>,<span class="hljs-selector-attr">[-71.915424,-43.408565]</span>,<span class="hljs-selector-attr">[-71.464056,-43.787611]</span>,<span class="hljs-selector-attr">[-71.793623,-44.207172]</span>,<span class="hljs-selector-attr">[-71.329801,-44.407522]</span>,<span class="hljs-selector-attr">[-71.222779,-44.784243]</span>,<span class="hljs-selector-attr">[-71.659316,-44.973689]</span>,<span class="hljs-selector-attr">[-71.552009,-45.560733]</span>,<span class="hljs-selector-attr">[-71.917258,-46.884838]</span>,<span class="hljs-selector-attr">[-72.447355,-47.738533]</span>,<span class="hljs-selector-attr">[-72.331161,-48.244238]</span>,<span class="hljs-selector-attr">[-72.648247,-48.878618]</span>,<span class="hljs-selector-attr">[-73.415436,-49.318436]</span>,<span class="hljs-selector-attr">[-73.328051,-50.378785]</span>,<span class="hljs-selector-attr">[-72.975747,-50.74145]</span>,<span class="hljs-selector-attr">[-72.309974,-50.67701]</span>,<span class="hljs-selector-attr">[-72.329404,-51.425956]</span>,<span class="hljs-selector-attr">[-71.914804,-52.009022]</span>,<span class="hljs-selector-attr">[-69.498362,-52.142761]</span>,<span class="hljs-selector-attr">[-68.571545,-52.299444]</span>,<span class="hljs-selector-attr">[-69.461284,-52.291951]</span>,<span class="hljs-selector-attr">[-69.94278,-52.537931]</span>,<span class="hljs-selector-attr">[-70.845102,-52.899201]</span>,<span class="hljs-selector-attr">[-71.006332,-53.833252]</span>,<span class="hljs-selector-attr">[-71.429795,-53.856455]</span>,<span class="hljs-selector-attr">[-72.557943,-53.53141]</span>,<span class="hljs-selector-attr">[-73.702757,-52.835069]</span>,<span class="hljs-selector-attr">[-73.702757,-52.83507]</span>,<span class="hljs-selector-attr">[-74.946763,-52.262754]</span>,<span class="hljs-selector-attr">[-75.260026,-51.629355]</span>,<span class="hljs-selector-attr">[-74.976632,-51.043396]</span>,<span class="hljs-selector-attr">[-75.479754,-50.378372]</span>,<span class="hljs-selector-attr">[-75.608015,-48.673773]</span>,<span class="hljs-selector-attr">[-75.18277,-47.711919]</span>,<span class="hljs-selector-attr">[-74.126581,-46.939253]</span>,<span class="hljs-selector-attr">[-75.644395,-46.647643]</span>,<span class="hljs-selector-attr">[-74.692154,-45.763976]</span>,<span class="hljs-selector-attr">[-74.351709,-44.103044]</span>,<span class="hljs-selector-attr">[-73.240356,-44.454961]</span>,<span class="hljs-selector-attr">[-72.717804,-42.383356]</span>,<span class="hljs-selector-attr">[-73.3889,-42.117532]</span>,<span class="hljs-selector-attr">[-73.701336,-43.365776]</span>,<span class="hljs-selector-attr">[-74.331943,-43.224958]</span>,<span class="hljs-selector-attr">[-74.017957,-41.794813]</span>,<span class="hljs-selector-attr">[-73.677099,-39.942213]</span>,<span class="hljs-selector-attr">[-73.217593,-39.258689]</span>,<span class="hljs-selector-attr">[-73.505559,-38.282883]</span>,<span class="hljs-selector-attr">[-73.588061,-37.156285]</span>,<span class="hljs-selector-attr">[-73.166717,-37.12378]</span>,<span class="hljs-selector-attr">[-72.553137,-35.50884]</span>,<span class="hljs-selector-attr">[-71.861732,-33.909093]</span>,<span class="hljs-selector-attr">[-71.43845,-32.418899]</span>,<span class="hljs-selector-attr">[-71.668721,-30.920645]</span>,<span class="hljs-selector-attr">[-71.370083,-30.095682]</span>,<span class="hljs-selector-attr">[-71.489894,-28.861442]</span>,<span class="hljs-selector-attr">[-70.905124,-27.64038]</span>,<span class="hljs-selector-attr">[-70.724954,-25.705924]</span>,<span class="hljs-selector-attr">[-70.403966,-23.628997]</span>,<span class="hljs-selector-attr">[-70.091246,-21.393319]</span>,<span class="hljs-selector-attr">[-70.16442,-19.756468]</span>,<span class="hljs-selector-attr">[-70.372572,-18.347975]</span>,<span class="hljs-selector-attr">[-69.858444,-18.092694]</span>,<span class="hljs-selector-attr">[-69.590424,-17.580012]</span>,<span class="hljs-selector-attr">[-69.100247,-18.260125]</span>,<span class="hljs-selector-attr">[-68.966818,-18.981683]</span>,<span class="hljs-selector-attr">[-68.442225,-19.405068]</span>,<span class="hljs-selector-attr">[-68.757167,-20.372658]</span>,<span class="hljs-selector-attr">[-68.219913,-21.494347]</span>]]]}},
]}
</code></pre>
<h2 data-id="heading-3">3. 导入依赖</h2>
<p><code>GeoJSON</code>作为一种矢量数据格式，可以使用矢量库<code>OGR</code>进行处理，以实现<code>GeoJSON</code>数据从文本格式转换为<code>Shp</code>格式。其中还涉及坐标定义，所以还需要引入<code>osr</code>模块。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">from</span> osgeo <span class="hljs-keyword">import</span> ogr,osr
<span class="hljs-keyword">import</span> os
</code></pre>
<h2 data-id="heading-4">4. 数据读取与转换</h2>
<p>定义一个方法<code>GeoJSON2Shp(geoPath,shpPath)</code>用于将<code>GeoJSON</code>数据转换为<code>Shp</code>数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-string">"""
说明：将 GeoJSON 文件转换为 Shapfile 文件
参数：
    -geoPath：GeoJSON 文件路径
    -shpPath：Shp 文件路径
"""</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">GeoJSON2Shp</span>(<span class="hljs-params">geoPath,shpPath</span>):
</code></pre>
<p>在进行<code>GeoJSON</code>数据格式转换之前，需要检查数据路径是否存在。</p>
<pre><code class="hljs language-lua" lang="lua"># 检查文件是否存在
<span class="hljs-keyword">if</span> <span class="hljs-built_in">os</span>.<span class="hljs-built_in">path</span>.exists(geoPath):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"GeoJSON 文件存在。"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"GeoJSON 文件不存在，请重新选择文件！"</span>)
    <span class="hljs-keyword">return</span>
</code></pre>
<p>打开<code>GeoJSON</code>数据。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 打开JSON文件</span>
<span class="hljs-attr">jsonDataSource</span> = ogr.Open(geoPath)
<span class="hljs-attr">jsonLayer</span> = jsonDataSource.GetLayer()
</code></pre>
<p>使用<code>os.path.exists</code>方法检查<code>Shp</code>文件是否已经创建，如果存在则将其删除。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> os.path.exists(shpPath):
    <span class="hljs-keyword">try</span>:
        shpDriver.DeleteDataSource(shpPath)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"文件已删除！"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"文件删除出错：<span class="hljs-subst">{e}</span>"</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span>
</code></pre>
<p>通过<code>GetDriverByName</code>获取<code>Shp</code>数据驱动，并创建<code>Shp</code>数据源。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 创建Shp数据源</span>
<span class="hljs-attr">shpDriver</span> = ogr.GetDriverByName(<span class="hljs-string">"ESRI Shapefile"</span>)
<span class="hljs-attr">shpDataSource</span> = shpDriver.CreateDataSource(shpPath)
</code></pre>
<p>添加<code>Shp</code>图层属性。获取源数据坐标系、属性字段以及几何对象，并将其复制到目标图层中。属性结构显示如下：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f123ef5434cc4d1dad710c1ffb48788f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767619384&amp;x-signature=%2B4xZj01G5CrncOwDgdM8ncg%2FpL8%3D" alt="" loading="lazy"/></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 获取坐标系</span>
<span class="hljs-attr">srs</span> = jsonLayer.GetSpatialRef()

<span class="hljs-comment"># 创建Shp数据图层</span>
<span class="hljs-attr">shpLayer</span> = shpDataSource.CreateLayer(
    "layer",
    <span class="hljs-attr">srs</span>=srs,
    <span class="hljs-attr">geom_type</span>=jsonLayer.GetGeomType()
)

<span class="hljs-comment"># 获取字段属性</span>
<span class="hljs-attr">layerDefn</span> = jsonLayer.GetLayerDefn()
for i in range(layerDefn.GetFieldCount()):
    <span class="hljs-attr">fieldDefn</span> = layerDefn.GetFieldDefn(i)
    shpLayer.CreateField(fieldDefn)

<span class="hljs-comment"># 获取几何属性</span>
for feature in jsonLayer:
    shpLayer.CreateFeature(feature)
</code></pre>
<p>在数据读取完成之后关闭数据源。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 关闭数据源</span>
<span class="hljs-attr">jsonDataSource</span> = shpDataSource = None
</code></pre>
<p>数据转换完成之后在<code>ArcMap</code>中打开的显示效果：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93226aef513840bfac6fe98834b79590~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767619384&amp;x-signature=cxR97BsjasfnHzlEai79YIOivBk%3D" alt="" loading="lazy"/>数据属性：<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14d7e064233b4a89a32f900ce2c95382~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgR0lT5LmL6Lev:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767619384&amp;x-signature=4243R2q9un3kSrjMH0wRAUqHUak%3D" alt="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[拒绝臃肿！不装第三方软件，给 Mac 右键菜单加上这些神仙功能]]></title>    <link>https://juejin.cn/post/7589110783146442786</link>    <guid>https://juejin.cn/post/7589110783146442786</guid>    <pubDate>2025-12-29T13:41:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589110783146442786" data-draft-id="7589093939656736820" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="拒绝臃肿！不装第三方软件，给 Mac   右键菜单加上这些神仙功能"/> <meta itemprop="keywords" content="Mac"/> <meta itemprop="datePublished" content="2025-12-29T13:41:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            拒绝臃肿！不装第三方软件，给 Mac   右键菜单加上这些神仙功能
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:41:48.000Z" title="Mon Dec 29 2025 13:41:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Mac 右键菜单添加自定义操作：复制路径、用指定应用打开</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f13231973e73434c8870918a74427aee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lmf5peg6aOO6Zuo5Lmf6Zu-5pm0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767620508&amp;x-signature=kOBRFv31YUWGGdQvIHp5Jxy%2B70M%3D" alt="image.png" loading="lazy"/></p>
<p>在 Finder 里右键一个文件，想复制它的完整路径，发现没有这个选项。</p>
<p>想用 Typora 打开一个 Markdown 文件，得先打开 Typora，再把文件拖进去，或者右键 → 打开方式 → 选应用，步骤有点多。</p>
<p>这两个需求用 macOS 自带的 Automator 就能实现，不用装第三方软件。</p>
<h3 data-id="heading-1">创建"复制路径"操作</h3>
<ol>
<li>打开 <strong>Automator</strong>（Spotlight 搜索 <code>Automator</code>）</li>
<li>新建文稿，选择 <strong>快速操作</strong></li>
<li>右上角配置：
<ul>
<li>"工作流程收到当前" → <strong>文件或文件夹</strong></li>
<li>"位于" → <strong>访达.app</strong></li>
</ul>
</li>
<li>左侧搜索"运行 Shell 脚本"，拖到右边工作区</li>
<li>配置脚本：
<ul>
<li>"传递输入" → <strong>作为自变量</strong></li>
<li>Shell → <code>/bin/zsh</code></li>
<li>脚本内容：</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>; <span class="hljs-keyword">do</span>
  <span class="hljs-built_in">echo</span> -n <span class="hljs-string">"<span class="hljs-variable">$f</span>"</span> | pbcopy
<span class="hljs-keyword">done</span>
</code></pre>
<ol start="6">
<li><code>Cmd + S</code> 保存，命名为 <code>复制路径</code></li>
</ol>
<h3 data-id="heading-2">创建"用 Typora 打开"操作</h3>
<p>步骤一样，只是脚本不同：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span>; <span class="hljs-keyword">do</span>
  open -a <span class="hljs-string">"Typora"</span> <span class="hljs-string">"<span class="hljs-variable">$f</span>"</span>
<span class="hljs-keyword">done</span>
</code></pre>
<p>保存时命名为 <code>用 Typora 打开</code>。</p>
<p>想用其他应用打开，把 <code>Typora</code> 换成对应的应用名就行，比如 <code>Visual Studio Code</code>、<code>Sublime Text</code>。</p>
<h3 data-id="heading-3">使用方式</h3>
<p>保存后，右键任意文件 → <strong>服务</strong> 或 <strong>快速操作</strong>，就能看到刚才创建的操作了。</p>
<p>第一次使用可能会弹出权限请求，允许就行。</p>
<h3 data-id="heading-4">设置键盘快捷键（可选）</h3>
<p>嫌每次要点两层菜单麻烦，可以给操作绑定快捷键：</p>
<p><strong>系统设置 → 键盘 → 键盘快捷键 → 服务 → 文件和文件夹</strong></p>
<p>找到你创建的操作，点右边的"添加快捷键"，比如给"复制路径"设置 <code>Cmd + Shift + C</code>。</p>
<p>以后选中文件直接按快捷键，路径就复制到剪贴板了。</p>
<h3 data-id="heading-5">管理和删除</h3>
<p>创建的快速操作保存在 <code>~/Library/Services/</code> 目录下，每个是一个 <code>.workflow</code> 文件夹。</p>
<p>想删除某个操作，直接删对应的 <code>.workflow</code> 文件夹就行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">rm</span> -rf ~/Library/Services/复制路径.workflow
</code></pre>
<p>或者在 Finder 里按 <code>Cmd + Shift + G</code>，输入 <code>~/Library/Services/</code>，手动删除。</p>
<h3 data-id="heading-6">补充：复制多个文件路径</h3>
<p>如果想同时选中多个文件，复制所有路径（每行一个），脚本改成：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">printf</span> <span class="hljs-string">'%s\n'</span> <span class="hljs-string">"<span class="hljs-variable">$@</span>"</span> | pbcopy
</code></pre>
<h3 data-id="heading-7">原生方法的局限</h3>
<p>用 Automator 创建的操作只能出现在"服务"或"快速操作"子菜单里，没法直接加到右键菜单顶层。</p>
<p>想加到顶层，得用第三方工具：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fiboysoft.com%2Fmagic-menu%2F" target="_blank" title="https://iboysoft.com/magic-menu/" ref="nofollow noopener noreferrer">iBoysoft MagicMenu</a> - 免费版够用</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flangui.net%2Fcontext-menu%2F" target="_blank" title="https://langui.net/context-menu/" ref="nofollow noopener noreferrer">Context Menu</a> - 付费，功能更强</li>
</ul>
<p>不过对我来说，设个快捷键就够了，不需要额外装软件。</p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>vibe coding 原理学习</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcoding-cli-guide" target="_blank" title="https://github.com/tt-a1i/coding-cli-guide" ref="nofollow noopener noreferrer">coding-cli-guide</a>（<a href="https://link.juejin.cn?target=https%3A%2F%2Ftt-a1i.github.io%2Fcoding-cli-guide%2F%3Ftab%3Dstart-here" target="_blank" title="https://tt-a1i.github.io/coding-cli-guide/?tab=start-here" ref="nofollow noopener noreferrer">学习网站</a>）- 学习 qwen-cli 时整理的笔记，40+ 交互式动画演示 AI CLI 内部机制</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[绿联云 NAS 安装 AudioDock 详细教程]]></title>    <link>https://juejin.cn/post/7589052659436486702</link>    <guid>https://juejin.cn/post/7589052659436486702</guid>    <pubDate>2025-12-29T13:54:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589052659436486702" data-draft-id="7589092567544971273" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="绿联云 NAS 安装 AudioDock 详细教程"/> <meta itemprop="keywords" content="前端,Docker,容器"/> <meta itemprop="datePublished" content="2025-12-29T13:54:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="萌萌哒草头将军"/> <meta itemprop="url" content="https://juejin.cn/user/1116759543260727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            绿联云 NAS 安装 AudioDock 详细教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759543260727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    萌萌哒草头将军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:54:38.000Z" title="Mon Dec 29 2025 13:54:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h3 data-id="heading-0">前言</h3>
<p>AudioDock（声仓）发布之后，好多感兴趣的小伙伴给了我反馈，感谢支持！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmdctjj%2FAudioDock" target="_blank" title="https://github.com/mmdctjj/AudioDock" ref="nofollow noopener noreferrer">github.com/mmdctjj/Aud…</a></p>
<p>今天先来介绍下绿联云 NAS 的安装指南。我的NAS型号是：DH2600，新系统。</p>
<h4 data-id="heading-1">往期精彩推荐</h4>
<ul>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">pnpm + monorepo 才是 AI 协同开发的最佳方案！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7587965908288749578" target="_blank" title="https://juejin.cn/post/7587965908288749578"># AudioDock：服务器和 NAS 音频播放最棒的软件！🚀🚀🚀</a></li>
<li>更多精彩内容欢迎关注我的公众号：萌萌哒草头将军</li>
</ul>
<h3 data-id="heading-2">正文</h3>
<h4 data-id="heading-3">准备工作</h4>
<p>首先确保自己的 NAS 可以下载 Docker 镜像。无法下载可以在后台私信我。</p>
<p>然后在 共享文件夹/docker 目录下新增一个文件目录：audiodock。</p>
<p>我新建过了，所以新建了 audiodock2 项目。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46f59411b837408a97461455ce103ac0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=809%2Fb46PBRVxF8%2FP2xLbhixsPqg%3D" alt="新建目录" loading="lazy"/></p>
<p>打开这个文件目录，新建三个文件夹：music、audio、covers</p>
<blockquote>
<p>music 是映射音乐的目录、audio 是映射声书的目录，covers 存放解析后封面的目录。</p>
</blockquote>
<p>从 GitHub 下载的 nginx.conf 文件拖动到当前目录下。下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmdctjj%2FAudioDock" target="_blank" title="https://github.com/mmdctjj/AudioDock" ref="nofollow noopener noreferrer">github.com/mmdctjj/Aud…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26b80af1de674d3cbae4c083d3d02b39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=cKLKm92ApariXP4RAn4YI01evuA%3D" alt="" loading="lazy"/></p>
<p>然后打开 Docker 应用的项目栏目，新建一个项目：audiodock</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e19e3a1653204e05806f07f970455bc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=k3O%2FcqXVhjqQkoYvF4i4qpEn600%3D" alt="新建项目" loading="lazy"/></p>
<p>这时候系统会自动识别新建的 audiodock 目录。</p>
<p>将下面的内容复制到 compose 配置中。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">"3.8"</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-comment"># 1. API 后端服务 (Node.js)</span>
  <span class="hljs-attr">api:</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mmdctjj/audiodock-api</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">audiodock-api</span>

    <span class="hljs-comment"># 容器内部端口 (3000) 默认对内部网络开放，无需 ports 字段映射到宿主机</span>
    <span class="hljs-comment"># 如果要直接测试 API，可以加上 ports: - "3000:3000"</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8858:3000"</span>

    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">AUDIO_BOOK_DIR=/audio</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">MUSIC_BASE_DIR=/music</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">CACHE_DIR=/covers</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">DATABASE_URL=file:/data/dev.db</span>

    <span class="hljs-comment"># 挂载数据文件和缓存，使用 Docker 命名卷更安全</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/有声书:/audio</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/音乐:/music</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./covers:/covers</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api-db:/data</span>

    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">audiodock-network</span>

  <span class="hljs-comment"># 2. Web 前端服务 (Nginx) - 用于托管静态文件和反向代理</span>
  <span class="hljs-attr">web:</span>
    <span class="hljs-attr">platform:</span> <span class="hljs-string">linux/amd64</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mmdctjj/audiodock-web</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">audiodock-web</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"9959:9958"</span> <span class="hljs-comment"># &lt;--- 将 Web 服务的 80 端口映射到宿主机的 8080 端口</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./nginx.conf:/etc/nginx/nginx.conf:ro</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api</span> <span class="hljs-comment"># 确保 API 容器先启动</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">audiodock-network</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">api-cache:</span> <span class="hljs-comment"># 命名卷用于缓存</span>
  <span class="hljs-attr">api-db:</span> <span class="hljs-comment"># 命名卷用于 SQLite 或其他数据文件</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">audiodock-network:</span>
</code></pre>
<p>重点替换替换下映射路径：</p>
<pre><code class="hljs language-yaml" lang="yaml"> <span class="hljs-comment"># 挂载数据文件和缓存，使用 Docker 命名卷更安全</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/有声书:/audio</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">/volume1/迅雷下载/音乐:/music</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./covers:/covers</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">api-db:/data</span>
</code></pre>
<p>映射路径的查看是选中文件夹右键属性，可以看到具体的地址，复制即可。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d750ad3040584829951c1527d5151115~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=2JayM7dxIzx8sVty5NFmiZMUUTY%3D" alt="查看文件地址" loading="lazy"/></p>
<p>最后保证服务端口映射没有重复，点击重新部署即可启动服务。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f68366bb33af418aa9307e4e0a2dc3c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=jKL%2FFMLiYj8aWVClcsLxIdNB0y0%3D" alt="启动部署" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82a0d22da5e74898ace234947296b868~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=eKJLcE5SkTVJmaxbr9%2B8d99fjBU%3D" alt="部署成功" loading="lazy"/></p>
<p>接下来稍等一会，等数据入库完成，后端服务占用资源减少</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3573e1795e84c2fa3e06247d6bc9918~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=89baMSfvlHUfan%2BElQ%2B7SxZPiqc%3D" alt="入库完成" loading="lazy"/></p>
<p>打开页面地址，会看到页面是这样的</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c839a25b9c54a2fa3d844aa68e9f63a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=dQuYVN7On%2F4ER9maNW6zyoson7M%3D" alt="页面" loading="lazy"/></p>
<p>输入后端服务器地址，鼠标点击页面空白区域，或者按 tab 键，会触发后端服务状态检查，绿代表链接成功，红色代表链接错误。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e3001ea000b4499b0350d9c26c3aec6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=feuuuCCIjZEVEfJb4SIEdyZyq48%3D" alt="后端服务链接成功" loading="lazy"/></p>
<p>输入用户名、密码登陆，或者点注册之后输入确认密码登陆并注册！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ccc4fb5366e477faf9d5cad04aab415~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=GcX%2B0aw8Ik7%2FaMtd9u5QULJ71wE%3D" alt="注册并登陆" loading="lazy"/></p>
<p>页面会刷新首页，看到是这样的首页说明完全成功了（马赛克是防止版权问题平台不过审）！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94fdeb0dc659489f9fa56c6afde0f332~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JCM6JCM5ZOS6I2J5aS05bCG5Yab:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767621278&amp;x-signature=WTEVe8%2BmWxmr348ImTWoJf6D8Ec%3D" alt="登陆成功" loading="lazy"/></p>
<p>以上就是部署服务端、web端的教程！桌面端的部署请看上篇文章。移动端预计本周末发版，敬请期待！</p>
<h3 data-id="heading-4">最后</h3>
<p>本篇文章主要介绍了绿联云 nas 如何安装 AudioDock ！</p>
<p>为了方便大家交流，我建了一个沟通群，欢迎大家入群交流。</p>
<p>如果无法下载镜像或者 nginx.conf 等文件，可以在后台回复 audiodock，我看到会发最新版的下载链接。</p>
<p>欢迎 Star：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmmdctjj%2FAudioDock" target="_blank" title="https://github.com/mmdctjj/AudioDock" ref="nofollow noopener noreferrer">github.com/mmdctjj/Aud…</a></p>
<h4 data-id="heading-5">往期精彩推荐</h4>
<ul>
<li><a href="https://juejin.cn/post/7586518130761007144" target="_blank" title="https://juejin.cn/post/7586518130761007144">pnpm + monorepo 才是 AI 协同开发的最佳方案！🚀🚀🚀</a></li>
<li><a href="https://juejin.cn/post/7587965908288749578" target="_blank" title="https://juejin.cn/post/7587965908288749578"># AudioDock：服务器和 NAS 音频播放最棒的软件！🚀🚀🚀</a></li>
<li>更多精彩内容欢迎关注我的公众号：萌萌哒草头将军</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[软考架构师：考试心得分享]]></title>    <link>https://juejin.cn/post/7589126920286208010</link>    <guid>https://juejin.cn/post/7589126920286208010</guid>    <pubDate>2025-12-29T12:26:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286208010" data-draft-id="7589092567544692745" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="软考架构师：考试心得分享"/> <meta itemprop="keywords" content="架构,程序员"/> <meta itemprop="datePublished" content="2025-12-29T12:26:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="怒放吧德德"/> <meta itemprop="url" content="https://juejin.cn/user/2502950820787672"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            软考架构师：考试心得分享
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2502950820787672/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    怒放吧德德
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:26:51.000Z" title="Mon Dec 29 2025 12:26:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">软考架构师：考试心得分享</h2>
<blockquote>
<p>😄生命不息，写作不止</p>
<p>🔥 继续踏上学习之路，学之分享笔记</p>
<p>👊 总有一天我也能像各位大佬一样</p>
<p>🏆 <a href="https://juejin.cn/user/2502950820787672" target="_blank" title="https://juejin.cn/user/2502950820787672">博客首页</a>   <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Flyd-code%2F" target="_blank" title="https://www.cnblogs.com/lyd-code/" ref="nofollow noopener noreferrer">@怒放吧德德</a>  <a href="https://link.juejin.cn?target=https%3A%2F%2Flydandtry.github.io%2F" target="_blank" title="https://lydandtry.github.io/" ref="nofollow noopener noreferrer">To记录领地</a> <a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43843951%3Ftype%3Dblog" target="_blank" title="https://blog.csdn.net/qq_43843951?type=blog" ref="nofollow noopener noreferrer">@一个有梦有戏的人</a></p>
<p>🌝分享学习心得，欢迎指正，大家一起学习成长！</p>
<p>🏆AI : Grok</p>
</blockquote>
<p><em>转发请携带作者信息</em>  <strong>@怒放吧德德(掘金) @一个有梦有戏的人(CSDN)</strong></p>
<h3 data-id="heading-1">前言</h3>
<p>2025 年下半年，我通过二十多个夜晚，在下班之后准备复习考试，最后通过了考试；说实话有些知识点是啃老本（大学的时候考过中级的软件设计师），打算写一下自己的考试心得，分享给正在准备以及即将备考的同志们。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5744c5ebd99d4832858de290bd80a4a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=NI%2FrQwBlNemwZWPHpDC20UiCUR4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-2">科目选择</h3>
<p>很多会疑惑自己想要选择什么考试科目？然而这需要根据自身来选择，因为我是一名技术爱好者，所以自身会选择系统架构设计师，那么如果你是为了要有一本高级证书或者说是为了 E 类人才，那么可以选择信息系统项目管理师。</p>
<h3 data-id="heading-3">备考经验</h3>
<p>很多人都会在网上查找，要如何备考，需要哪些资料，不知不觉你会看到好多人的建议，收集了许多资料网盘。然而需要自己思考一下，收集这么多资料，真的看的完嘛？纠结这么多真的好吗？别人的备考方式真的适合我吗？显然，我也是遇到这样的困境，只是因为毕业太久了，没有那种学习氛围，没有节奏会搞得一团糟。</p>
<p>在初期备考的时候，我也是收集了许多资料，看了许多人的备考方案，但到最后我却没有按照那些方式去复习。为什么呢？因为当时我自己思考，学习不只是找到那种所谓的熟悉感，是更应该顺应当前。像以前大学时期，我可以一天花很多时间去专研每个知识点，但是现在是工作时期，时间并不充足。于是我给自己想了一个大致的方法流程。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4a4765a5ca64d3dab8f286c1b628e7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=WmalQFNTMZr2Wubus6PoZ04%2Fseo%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-4">找资料</h4>
<p>找资料不要盲目查找，去咸鱼上找一下，或者报个班，报班是最方便的。找一套完整的资料，按着顺序快速学习（平时可以看看课件）。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f76d886dde745b29d57b73d30cd13ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=cxBlQ26YXszFYTffCmZTBLTgZgE%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-5">整体学习</h4>
<p>可以不需要买教材，有教材的话也不要全看，教材可以作为字典用来查询。主要还是跟着资料的顺序进行学习，一般是先学选择题内容再去学案例题部分，前期这些基础需要 get 到。架构师的考题主要是理解为主，部分需要记忆，考试的时候会有一些是超纲的，但是只要把这些基础的拿下了，基本是稳过的。案例题的话，考试方式近几年都是趋于稳定，第一题是架构风格、质量属性，其他选作题基本就是数据库、嵌入式、web 题。这些如果不是嵌入式工作的，可以考虑直接跳过，复习都可以不复习（选择还是需要复习的，书上部分要记一下，主要是为了选择题）。遇到不会的知识点就百度、或者问 AI。建议学习不用全部学习，像我是个 Java 开发，我就把嵌入式给丢弃了。😁</p>
<p>例如，我是通过 grok 来学习的</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49cbc45aafeb43aebb5b06174dc51f8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=HMhOxhuC6qO9dPOfWdTHTis9yNY%3D" alt="" loading="lazy"/></p>
<p>指令参考（我也是参考了其他大佬的做法，大佬文章忘记了，不然我就引用出来让大家看看）</p>
<pre><code class="hljs language-xml" lang="xml">## 角色
请你扮演中国软件水平考试高级辅导专家，负责用户发送的概念讲解和发送的题目解答，可以结合附件的内容来回答。

## 技能
### 技能1：概念讲解
当我发送一些概念或者软考概念讲解的截图时（如果是截图请使用 OCR 将图片中的文字提取出来）。
Step1：根据概括或截图帮我讲解一下相关内容，讲解时尽量通俗易懂，并给出恰当的例子，优先使用 markdown 表格的形式来呈现
Step2：出 1 0道符合当前知识点的选择题并在所有题目后给出答案和对应的详细解释。

### 技能2：试题辅导
当用户发送软考的题目的内容或者截图（如果是截图请使用 OCR 将图片中的文字提取出来）
Step1：请你给出答案并详细解释原因。
Step2：出 1 道相似的选择题并给出答案和对应的详细解释。
输出格式为（先是所有的题目，接着再把答案放后面）：
题目
答案为：<span class="hljs-tag">&lt;<span class="hljs-name">答案</span>&gt;</span>。
详细讲解: <span class="hljs-tag">&lt;<span class="hljs-name">详细讲解</span>&gt;</span>

### 相似题目
<span class="hljs-tag">&lt;<span class="hljs-name">出</span> <span class="hljs-attr">1</span> <span class="hljs-attr">道考察相同知识点的相似的题目</span>&gt;</span>
答案和解析：
<span class="hljs-tag">&lt;<span class="hljs-name">答案和对应的相解</span>&gt;</span>


### 技能3：出题
当用户发送的内容包含“出题”时，表示希望你根据提供的概念出 4 道相关的选择题。

### 技能4：问题解答
当用户发送一个问题时，你只需要回答问题即可。

## 要求
1 必须使用中文回答我
2 解答时，尽量使用通俗易懂的语言
3 讲解时，如果有可能尽量给出相关例子
4 讲解时，优先考虑使用markdown表格的方式呈现，如果出现不同层级的概念，可以将不同层级的概念用不同的表格表示
5 给出答案和解析时，每道题的答案和解释要在一起给出，答案的解释需要详尽
</code></pre>
<h4 data-id="heading-6">刷题</h4>
<p>刷题推荐在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwangxiao.xisaiwang.com%2Ftiku2%2Flist-zt131.html" target="_blank" title="https://wangxiao.xisaiwang.com/tiku2/list-zt131.html" ref="nofollow noopener noreferrer">希赛网</a>进行刷题，希赛有每日一题，建议刚学完的时候可以先刷一下。案例题内容学完之后可以考虑刷整张试卷。希赛网是有考试形式的方式，建议先刷 20-23 的卷子，其中 23-25 可能有的题目存在缺陷，但是需要着重学习，比如非超纲题型需要掌握，因为下次考试很可能会相似，尤其是选择题，相似度可能会比较大，案例题我觉得是变形占最大。</p>
<blockquote>
<p>主要还是刷题，遇到哪里不会就去查资料，我习惯看看课件或者看教材，偶尔会查一下 ai，但是不要纠结，不会就是查。就比如，我当时对于范式的定义，函数依赖，什么是保持函数依赖、有损分解无损分解，怎么判断？首先需要考虑，这算个基础题，需要掌握的，所以我就去查教材、课件，问 AI，理解他，每次做争取做对。对于嵌入式，我是保持该记忆就记忆，不做深度追究。</p>
</blockquote>
<p>刷完题切记需要复盘！！！</p>
<h4 data-id="heading-7">论文</h4>
<p>准备论文不要太早，也不要太晚，最好是考前两周，我当时是考前 3 天准备的，那时候我还在项目现场，当时我是挺慌的，要考试了还在出差，但是还好那时候不忙，晚上下班我在酒店独自学习。</p>
<p>准备论文我的建议是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fbilibili.com%2Fvideo%2FBV13KG1zFEnd%2F%3Fspm_id_from%3D333.337.search-card.all.click" target="_blank" title="https://bilibili.com/video/BV13KG1zFEnd/?spm_id_from=333.337.search-card.all.click" ref="nofollow noopener noreferrer">bilibili</a> 去看看有没有押题的视频。当然了，如果你有报班，肯定有押题，而且老师也会给你安排好。如果没有报班的同志们，也可以自学。我按照我的复习节奏来说，我是去 bilibili 看看有没有大佬发如何写、怎么写。那时候我自己准备了一份模板，根据自己的项目来搭建，至少有 1200 字，并且需要把他背下来。然后就是去找优秀文章，模仿他们写。那么？要准备什么文章呢？emmm，我当时也是自己蒙的，我尽量把会考的都准备了。只要有模板，其他的内容都好记的。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/066e45d6da76491badf30bda4e3e5506~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=mr5Rve499f2OG3%2B6s1eZ3lD8jVo%3D" alt="" loading="lazy"/></p>
<p>这是我准备的论文（天呐，谁敢信 3 个晚上准备这么多，有个搞笑的事情，原本我是准备了测试这方面的，但是我看到25年上半年考过了，于是把他划掉了，结果考到了。哎。。。），其实这些就前面几篇我有跟着写，其他都只是默写自己的模板，然后思考怎么抓重点。</p>

<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e57644c5053a44f196d4f35359a0089d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oCS5pS-5ZCn5b635b63:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767616126&amp;x-signature=JdELAGXnHBj8IZ0uNepHpMfwLaU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">总结</h3>
<p>我用如此的直白的语言阐述了自己的备考经验，总的来说，软考只是考核，并不是人才选拔。只要肯努力复习，还是能够通过的，希望我提供的经验能够帮到各位，可能我说的不是很对，但是这些是我的经验，如果各位有什么困难，欢迎各位与我进行讨论。</p>
<p>祝各位备考的同志能够顺利通过考试。</p>
<h3 data-id="heading-9">参考文献</h3>
<p>各位可以看看这位大佬的文章，我也是受这篇文章的启发
<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fw605283073%2Farticle%2Fdetails%2F144461549" target="_blank" title="https://blog.csdn.net/w605283073/article/details/144461549" ref="nofollow noopener noreferrer">一年搞定两个软考高级证书，关键技巧大揭秘</a></p>
<hr/>
一起学习一起进步，能学一点是一点，冲，软考高级！！！</div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（9）什么是Hibernate的Transaction？]]></title>    <link>https://juejin.cn/post/7589099845186699300</link>    <guid>https://juejin.cn/post/7589099845186699300</guid>    <pubDate>2025-12-29T12:33:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589099845186699300" data-draft-id="7589082912588742699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（9）什么是Hibernate的Transaction？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T12:33:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（9）什么是Hibernate的Transaction？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:33:10.000Z" title="Mon Dec 29 2025 12:33:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate的<code>Transaction</code>接口用于管理数据库事务。事务是数据库操作的一个逻辑单元，它确保要么所有操作都成功，要么所有操作都回滚，从而保证数据的一致性和完整性。在Hibernate中，事务管理主要是通过<code>Transaction</code>接口实现的，通常与<code>Session</code>对象一起使用。</p>
<h3 data-id="heading-0">主要功能</h3>
<ol>
<li><strong>开始事务</strong>：通过<code>beginTransaction</code>方法开始一个新的事务。</li>
<li><strong>提交事务</strong>：通过<code>commit</code>方法提交当前事务，将所有更改持久化到数据库中。</li>
<li><strong>回滚事务</strong>：通过<code>rollback</code>方法回滚当前事务，撤销所有未提交的更改。</li>
<li><strong>事务状态查询</strong>：提供查询事务状态的方法，如<code>isActive</code>。</li>
</ol>
<h3 data-id="heading-1">使用示例</h3>
<p>以下是一个详细的代码示例，展示如何在Hibernate中使用<code>Transaction</code>接口进行CRUD操作。</p>
<h4 data-id="heading-2"><code>hibernate.cfg.xml</code> 配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5">使用事务进行CRUD操作</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.Transaction;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-comment">// 打开一个新的Session</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();

        <span class="hljs-type">Transaction</span> <span class="hljs-variable">transaction</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 启动事务</span>
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 创建并保存Student对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">student</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
            session.save(student); <span class="hljs-comment">// 保存对象</span>

            <span class="hljs-comment">// 提交事务</span>
            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback(); <span class="hljs-comment">// 回滚事务</span>
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close(); <span class="hljs-comment">// 关闭Session</span>
        }

        <span class="hljs-comment">// 读取、更新和删除操作</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 打开一个新的Session</span>
            session = sessionFactory.openSession();
            <span class="hljs-comment">// 启动事务</span>
            transaction = session.beginTransaction();

            <span class="hljs-comment">// 读取Student对象</span>
            <span class="hljs-type">Student</span> <span class="hljs-variable">retrievedStudent</span> <span class="hljs-operator">=</span> session.get(Student.class, student.getId());
            System.out.println(<span class="hljs-string">"Retrieved Student: "</span> + retrievedStudent.getName() + <span class="hljs-string">", Age: "</span> + retrievedStudent.getAge());

            <span class="hljs-comment">// 更新Student对象</span>
            retrievedStudent.setAge(<span class="hljs-number">21</span>);
            session.update(retrievedStudent); <span class="hljs-comment">// 更新对象</span>

            <span class="hljs-comment">// 删除Student对象</span>
            session.delete(retrievedStudent); <span class="hljs-comment">// 删除对象</span>

            <span class="hljs-comment">// 提交事务</span>
            transaction.commit();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">if</span> (transaction != <span class="hljs-literal">null</span>) {
                transaction.rollback(); <span class="hljs-comment">// 回滚事务</span>
            }
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            session.close(); <span class="hljs-comment">// 关闭Session</span>
        }

        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li><strong>获取SessionFactory</strong>：从<code>HibernateUtil</code>类中获取单例的<code>SessionFactory</code>实例。</li>
<li><strong>打开Session</strong>：通过<code>sessionFactory.openSession()</code>方法打开一个新的<code>Session</code>对象。</li>
<li><strong>启动事务</strong>：通过<code>session.beginTransaction()</code>方法开始一个新的事务。</li>
<li><strong>CRUD操作</strong>：
<ul>
<li><strong>创建并保存对象</strong>：创建一个<code>Student</code>对象，并使用<code>session.save(student)</code>方法将其保存到数据库中。</li>
<li><strong>提交事务</strong>：使用<code>transaction.commit()</code>方法提交事务，将所有更改持久化到数据库中。</li>
<li><strong>读取对象</strong>：通过<code>session.get(Student.class, student.getId())</code>方法从数据库中读取对象。</li>
<li><strong>更新对象</strong>：修改对象属性后，使用<code>session.update(retrievedStudent)</code>方法更新数据库中的记录。</li>
<li><strong>删除对象</strong>：使用<code>session.delete(retrievedStudent)</code>方法从数据库中删除对象。</li>
</ul>
</li>
<li><strong>回滚事务</strong>：在捕获异常的情况下，如果事务未提交，使用<code>transaction.rollback()</code>方法回滚事务，撤销所有未提交的更改。</li>
<li><strong>关闭Session</strong>：在<code>finally</code>块中通过<code>session.close()</code>方法关闭<code>Session</code>。</li>
<li><strong>关闭SessionFactory</strong>：在应用程序结束时，通过<code>sessionFactory.close()</code>方法关闭<code>SessionFactory</code>。</li>
</ol>
<h3 data-id="heading-7">事务管理的注意事项</h3>
<ol>
<li><strong>嵌套事务</strong>：Hibernate不直接支持嵌套事务，维护嵌套事务的状态需要额外的管理。</li>
<li><strong>自动提交</strong>：确保在使用事务时，设置数据库连接的自动提交模式为false，以便手动管理事务。</li>
<li><strong>异常处理</strong>：在事务操作中，应当妥善处理异常，在捕获异常后回滚事务以保证数据的一致性。</li>
</ol>
<h3 data-id="heading-8">总结</h3>
<p>Hibernate的<code>Transaction</code>接口提供了对数据库事务的管理功能，使得应用程序能够保证数据操作的一致性和完整性。通过详细的配置和正确的使用<code>Transaction</code>接口，可以高效地进行数据库操作，确保应用程序的稳定性和可靠性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【大数据 & AI】Flink Agents 源码解读 --- (2) --- 核心架构]]></title>    <link>https://juejin.cn/post/7589107312112926729</link>    <guid>https://juejin.cn/post/7589107312112926729</guid>    <pubDate>2025-12-29T12:33:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589107312112926729" data-draft-id="7589052659436208174" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【大数据 &amp; AI】Flink Agents 源码解读 --- (2) --- 核心架构"/> <meta itemprop="keywords" content="后端,算法,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T12:33:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【大数据 &amp; AI】Flink Agents 源码解读 --- (2) --- 核心架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:33:23.000Z" title="Mon Dec 29 2025 12:33:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【大数据 &amp; AI】Flink Agents 源码解读 --- (2) --- 核心架构</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x00 摘要</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x01 Flink Agents主要组件</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.1 主要组件</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.2 内部成员变量映射关系</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">1.3 执行流程</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x02 与原生Flink比对</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.1 核心</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">2.2 具体比对</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x03 实例拆解</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.1 第一层级：Agent – 餐厅菜单和规则手册（Blueprint）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.2 第二层级：AgentPlan – 餐厅的详细操作流程图（Compiled Plan,计划编译层）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.3 第三层级：ActionExecutionOperator – 餐厅的执行管理层（Runtime Executor，执行引擎层）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.4 第四层级：ActionTask – 具体的服务步骤（Execution Unit）</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">3.5 工作流程举例</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0x04 并发性和并行性</a></p>
<ul>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.1 Flink原生并发模型</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.2 每个Key的状态管理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.3 邮箱线程模型</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.4 异步任务处理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.5 内存一致性</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.6 水印和事件时间处理</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.7 检查点和恢复</a></li>
<li><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">4.8 总结</a></li>
</ul>
</li>
<li>
<p><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">0xFF 参考</a></p>
</li>
</ul>
<h3 data-id="heading-1">0x00 摘要</h3>
<p>Flink Agents 框架的核心是 <strong>“事件驱动 + 状态隔离 + 多语言协作”</strong> ：通过 Agent/AgentPlan 实现业务逻辑的声明式定义，借助 Flink 原生的分布式、高并发能力实现可靠执行，同时支持 Python 生态的工具 / 模型集成，兼顾了开发灵活性与运行时效率，适用于复杂 AI 代理任务的分布式部署与执行。</p>
<p>具体而言，Flink Agents 的组件是对原生 Flink 组件在 “Agent 业务场景” 下的语义化封装，而非全新发明。因此，本文将先介绍Flink Agents的基本组件，然后将其组件与Flink 原生组件做对比，最后给出一个详细的例子，这样读者可以更好的理解其设计精要。</p>
<h3 data-id="heading-2">0x01 Flink Agents主要组件</h3>
<p>可以把 Flink Agents 的整个执行流程比作 “做一道菜”，我们借此进行分析。</p>
<h4 data-id="heading-3">1.1 主要组件</h4>
<p>Flink Agents 是基于原生 Flink 分布式流处理能力封装的上层框架。其中四个主要组件代表了 Flink Agents 框架中的四个层次：</p>
<ul>
<li><strong>Agent（顶层设计，定义了“做什么”）</strong> ：用户定义的智能实体，类似 “餐厅菜单 + 规则手册”，包含业务逻辑、动作（Action）和资源（工具、模型等）定义，明确 “做什么”。</li>
<li><strong>AgentPlan（中间编译层，确定了“怎么做”）</strong> ：将 Agent 编译后的可执行计划，类似 “详细操作流程图”，明确动作触发规则、资源映射关系，确定 “怎么做”。</li>
<li><strong>ActionExecutionOperator（运行时执行层，是执行环境，负责“协调调度”）</strong> ：Flink 集群中的执行核心，在 Flink 流处理环境中实际执行操作，类似 “餐厅首席大厨”，负责接收数据、调度任务、管理状态，协调整体执行流程。</li>
<li><strong>ActionTask（最小执行单元，负责“具体实施”）</strong> ：具体的执行任务，类似 “员工的单个服务步骤”，分为 JavaActionTask 和 PythonActionTask，处理单个事件并返回结果。</li>
</ul>
<p>具体可以参见下图。</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">Agent</span>] 菜单手册
    ↓（编译）
[<span class="hljs-meta">AgentPlan</span>] 详细流程图
    ↓（运行时实例化）
[<span class="hljs-meta">ActionExecutionOperator</span>] 餐厅首席大厨
    ↓（分配任务）
[<span class="hljs-meta">ActionTask</span>] 员工具体任务
</code></pre>
<p>这样的设计使得系统既灵活又高效，能够处理复杂的AI代理任务，同时保证了良好的扩展性和维护性。</p>
<h4 data-id="heading-4">1.2 内部成员变量映射关系</h4>
<p>Agent、AgentPlan 和 ActionExecutionOperator 之间的关系以及它们内部成员变量的映射关系如下。</p>
<h5 data-id="heading-5">1.2.1 Agent 到 AgentPlan</h5>
<p>Agent 到 AgentPlan 的映射如下：</p>

























<table><thead><tr><th>Agent 成员</th><th>AgentPlan 对应成员</th><th>说明</th></tr></thead><tbody><tr><td>_actions（装饰器定义）</td><td>actions, actions_by_event</td><td>Agent 中通过 @action 装饰器定义的动作被编译到 AgentPlan 的动作映射中</td></tr><tr><td>_actions（add_action 添加）</td><td>actions, actions_by_event</td><td>通过 add_action 方法添加的动作同样编译到动作映射中</td></tr><tr><td>_resources</td><td>resource_providers</td><td>Agent 中注册的资源被转换为资源提供者</td></tr></tbody></table>
<h5 data-id="heading-6">1.2.2 AgentPlan 到 ActionExecutionOperator</h5>
<p>AgentPlan 到 ActionExecutionOperator 的映射如下：</p>

























<table><thead><tr><th>AgentPlan 成员</th><th>ActionExecutionOperator 对应成员</th><th>说明</th></tr></thead><tbody><tr><td>actions</td><td>通过 getActionsTriggeredBy() 方法调用</td><td>Operator 根据事件类型查找对应的动作</td></tr><tr><td>resource_providers</td><td>在 RunnerContextImpl 中使用</td><td>提供运行时所需的资源</td></tr><tr><td>config</td><td>metricGroup, builtInMetrics 等</td><td>用于配置指标和其他运行时行为</td></tr></tbody></table>
<h6 data-id="heading-7">详细映射分析</h6>
<h6 data-id="heading-8">动作执行映射</h6>
<p>在 <code>ActionExecutionOperator</code> 中：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 根据事件类型获取触发的动作</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> List&lt;Action&gt; <span class="hljs-title">getActionsTriggeredBy</span>(<span class="hljs-params">Event <span class="hljs-keyword">event</span></span>)</span> {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span> instanceof PythonEvent) {
        <span class="hljs-keyword">return</span> agentPlan.getActionsTriggeredBy(((PythonEvent) <span class="hljs-keyword">event</span>).getEventType());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> agentPlan.getActionsTriggeredBy(<span class="hljs-keyword">event</span>.getClass().getName());
    }
}

<span class="hljs-comment">// 创建 ActionTask 来执行动作</span>
<span class="hljs-function"><span class="hljs-keyword">private</span> ActionTask <span class="hljs-title">createActionTask</span>(<span class="hljs-params">Object key, Action action, Event <span class="hljs-keyword">event</span></span>)</span> {
    <span class="hljs-keyword">if</span> (action.getExec() instanceof JavaFunction) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> JavaActionTask(
            key, <span class="hljs-keyword">event</span>, action, getRuntimeContext().getUserCodeClassLoader());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (action.getExec() instanceof PythonFunction) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PythonActionTask(key, <span class="hljs-keyword">event</span>, action);
    }
    <span class="hljs-comment">// ..</span>
}
</code></pre>
<h6 data-id="heading-9">资源管理映射</h6>
<p><code>AgentPlan</code> 中的资源提供者在 <code>ActionExecutionOperator</code> 中通过 <code>RunnerContextImpl</code> 访问：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 RunnerContextImpl 中</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">Resource</span> <span class="hljs-title function_">getResource</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name, ResourceType <span class="hljs-keyword">type</span></span>) {
    <span class="hljs-keyword">return</span> agentPlan.<span class="hljs-title function_">getResource</span>(name, <span class="hljs-keyword">type</span>);
}
</code></pre>
<h6 data-id="heading-10">配置映射</h6>
<p>AgentPlan 中的配置信息被用于初始化ActionExecutionOperator的各种运行时组件：</p>
<pre><code class="hljs language-ini" lang="ini">// 在 ActionExecutionOperator.open() 中
<span class="hljs-attr">metricGroup</span> = new FlinkAgentsMetricGroupImpl(getMetricGroup())<span class="hljs-comment">;</span>
<span class="hljs-attr">builtInMetrics</span> = new BuiltInMetrics(metricGroup, agentPlan)<span class="hljs-comment">;</span>

// ActionStateStore 初始化也依赖于配置
if (<span class="hljs-attr">actionStateStore</span> == null &amp;&amp; KAFKA.getType().equalsIgnoreCase(agentPlan.getConfig().get(ACTION_STATE_STORE_BACKEND))) {
    <span class="hljs-attr">actionStateStore</span> = new KafkaActionStateStore(agentPlan.getConfig())<span class="hljs-comment">;</span>
}
</code></pre>
<h6 data-id="heading-11">状态管理映射</h6>
<p>ActionExecutionOperator 中的各种状态与 AgentPlan 的执行需求相对应：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 短期内存状态用于动作间的数据共享</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> MapState&lt;String, MemoryObjectImpl.MemoryItem&gt; shortTermMemState;

<span class="hljs-comment">// 动作任务状态用于异步执行管理</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;ActionTask&gt; actionTasksState;

<span class="hljs-comment">// 待处理事件状态用于流控</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;Event&gt; pendingInputEventsState;
</code></pre>
<h4 data-id="heading-12">1.3 执行流程</h4>
<p>具体流程如下：</p>
<pre><code class="hljs language-css" lang="css">Action <span class="hljs-selector-tag">Code</span> → Agent → AgentPlan → ActionExecutionOperator → ActionTask → Flink Runtime
</code></pre>
<p>以 ReActAgent 为例，其流程如下：</p>
<ul>
<li>
<p>用户定义 ReActAgent，包含 <code>start_action</code> 和 <code>stop_action</code></p>
</li>
<li>
<p>通过 <code>AgentPlan.from_agent()</code> 编译成计划：</p>
<ul>
<li><code>actions</code>：包含 <code>start_action</code> 和 <code>stop_action</code></li>
<li><code>actions_by_event</code>：映射 <code>InputEvent</code> → <code>start_action</code>，<code>ChatResponseEvent</code> → <code>stop_action</code></li>
</ul>
</li>
<li>
<p>在运行环境中，AgentPlan 被传递给 ActionExecutionOperatorFactory。ActionExecutionOperatorFactory 创建 ActionExecutionOperator 实例。</p>
</li>
<li>
<p>ActionExecutionOperator 在运行时根据 AgentPlan 执行具体操作。在 ActionExecutionOperator 中：</p>
<ul>
<li>接收到 InputEvent 后，查找并执行 start_action</li>
<li>start_action 发送 ChatRequestEvent</li>
<li>查找并执行处理 ChatRequestEvent 的内置动作（如 CHAT_MODEL_ACTION）</li>
<li>PythonActionTask 执行工具函数，若为生成器则创建 PythonGeneratorActionTask 持续执行；</li>
<li>工具执行完成生成 ChatResponseEvent</li>
<li>查找并执行 stop_action</li>
<li>stop_action 产生 OutputEvent 并发送到下游</li>
</ul>
</li>
</ul>
<p>这种设计实现了关注点分离：用户只需关注业务逻辑定义，框架负责将其编译为高效的运行时执行计划。</p>
<h3 data-id="heading-13">0x02 与原生Flink比对</h3>
<p>Flink Agents 是原生 Flink 的 “领域封装”：所有组件都能映射到原生 Flink 核心组件，未脱离 Flink 流处理的核心架构。我们接下来看看 Flink Agents 里的 Agent、AgentPlan、ActionExecutionOperator、ActionTask 这些核心组件，分别对应原生 Flink 中的哪些核心组件，以及它们的相似性逻辑。</p>
<h4 data-id="heading-14">2.1 核心</h4>
<p>我们先用一张表来概括比对关系。</p>






























<table><thead><tr><th>Flink Agents 组件</th><th>原生 Flink 对应组件</th><th>核心角色</th></tr></thead><tbody><tr><td>Agent</td><td>StreamGraph / 用户 DataStream 代码</td><td>高层业务逻辑声明（做什么）</td></tr><tr><td>AgentPlan</td><td>JobGraph</td><td>编译后的可执行计划（怎么拆）</td></tr><tr><td>ActionExecutionOperator</td><td>KeyedProcessOperator/StreamOperator</td><td>运行时核心执行算子（核心载体）</td></tr><tr><td>ActionTask</td><td>算子内处理单元 / AsyncFunction 任务</td><td>原子执行任务（最小执行单元）</td></tr></tbody></table>
<p>核心映射逻辑如下：「声明层（Agent）→ 编译层（AgentPlan）→ 执行算子（ActionExecutionOperator）→ 原子任务（ActionTask）」对应原生 Flink 的「StreamGraph → JobGraph → StreamOperator → 算子内处理单元」；</p>
<p>回到 “做一道菜” ，我们进行分拆对比。</p>
<ul>
<li>Agent = 你写的 “菜谱逻辑”（比如 “做番茄炒蛋，先炒蛋再炒番茄”）→ 对应 Flink StreamGraph（纯逻辑）；</li>
<li>AgentPlan = 餐厅后厨把菜谱转换成的 “可执行工单”（明确 “谁来炒、用哪个锅、放多少盐”）→ 对应 Flink JobGraph（可执行计划）；</li>
<li>ActionExecutionOperator = 掌勺厨师（执行工单）→ 对应 Flink StreamOperator；</li>
<li>ActionTask = 厨师的 “单个翻炒动作”→ 对应 Flink 算子内的原子处理任务；</li>
<li>Flink ExecutionGraph = 厨师实际站在哪个灶台、用哪套厨具 → 物理执行层，和 AgentPlan 无关。</li>
</ul>
<h4 data-id="heading-15">2.2 具体比对</h4>
<h5 data-id="heading-16">2.2.1 Agent</h5>
<ul>
<li><strong>相似组件</strong>：Flink Job 的业务逻辑定义（如 DataStream 算子链）、StreamGraph（流式作业的逻辑拓扑）</li>
<li><strong>相似性核心</strong>：Agent 是用户定义的 “智能实体”（包含业务逻辑、动作、资源），本质是业务层面的 “作业逻辑声明”；这和原生 Flink 中用户编写的 DataStream 代码（定义 “数据怎么处理”）、StreamGraph（描述逻辑拓扑）的角色完全一致 —— 都是 “告诉系统要做什么” 的顶层逻辑定义，不涉及具体执行。</li>
<li><strong>差异</strong>：Agent 更聚焦 “Agent 行为 / 工具调用” 的语义，而原生 StreamGraph 是通用的数据流拓扑。</li>
</ul>
<h5 data-id="heading-17">2.2.2 AgentPlan</h5>
<ul>
<li><strong>相似组件</strong>：Flink 的 JobGraph（StreamGraph 编译后的可执行拓扑）</li>
<li><strong>相似性核心</strong>：AgentPlan 是 Agent 编译后的 “可执行计划”（明确动作触发规则、资源映射），本质是将高层业务逻辑转换为系统可识别的执行计划；这和原生 Flink 中 StreamGraph 编译为 JobGraph 的过程一致 ——JobGraph 把用户的逻辑拓扑转换为包含并行度、算子链、中间结果传递的可执行拓扑，AgentPlan 则把 Agent 的 “行为规则” 转换为系统可调度的 “动作执行规则”。</li>
<li><strong>关键共性</strong>：都是 “编译层” 产物，连接高层定义与底层执行。</li>
</ul>
<h5 data-id="heading-18">2.2.3 ActionExecutionOperator</h5>
<ul>
<li>
<p><strong>相似组件</strong>：Flink 核心的 StreamOperator（如 ProcessOperator、FlatMapOperator）、KeyedProcessOperator</p>
</li>
<li>
<p><strong>相似性核心</strong>：ActionExecutionOperator 是 Flink 集群中执行 Agent 逻辑的核心算子，本质是运行时的核心执行单元；这和原生 Flink 的 StreamOperator 完全对应 ——StreamOperator 是处理数据流的核心载体（如 ProcessOperator 处理 KeyedStream、实现状态管理），ActionExecutionOperator 就是针对 “Agent 动作执行” 场景定制的 StreamOperator：</p>
<ul>
<li>都运行在 TaskManager 中，处理流数据（Event）；</li>
<li>都支持键控状态（Keyed State），按 key 隔离执行上下文；</li>
<li>都依赖 Mailbox 机制调度任务，避免阻塞；</li>
<li>都负责状态管理、事件处理、结果输出。</li>
</ul>
</li>
<li>
<p><strong>典型对应</strong>：ActionExecutionOperator 最接近原生的 <code>KeyedProcessOperator</code>（键控处理、状态管理、异步任务调度）。</p>
</li>
</ul>
<h5 data-id="heading-19">2.2.3 ActionTask</h5>
<ul>
<li>
<p><strong>相似组件</strong>：Flink 的「算子内的处理任务」（如 ProcessFunction 中的单个元素处理逻辑）、Async I/O 中的 <code>AsyncFunction</code> 任务</p>
</li>
<li>
<p><strong>相似性核心</strong>：ActionTask 是 “最小执行单元”（如单个 Python/Java 动作执行），本质是算子内的原子处理任务；这和原生 Flink 中：</p>
<ul>
<li>ProcessOperator 处理单个 StreamElement（如一条数据）的逻辑单元；</li>
<li>Async I/O 中 AsyncFunction 封装的异步任务（如异步查询数据库）；</li>
</ul>
<p>角色完全一致 —— 都是 “算子内的最小可执行任务”，执行完成后返回结果，支持异步 / 分阶段执行。</p>
</li>
<li>
<p><strong>关键共性</strong>：</p>
<ul>
<li>都是 “原子执行单元”，不可再拆分；</li>
<li>支持异步执行（如 PythonActionTask 对应 Async I/O）；</li>
<li>执行结果可触发后续任务（如 ActionTaskResult 生成新任务，对应 Async I/O 回调触发后续处理）。</li>
</ul>
</li>
<li>
<p><strong>细分对应</strong>：</p>
<ul>
<li>JavaActionTask → 原生同步处理任务（如 ProcessFunction 中的同步逻辑）；</li>
<li>PythonActionTask → 原生 Async I/O 任务（异步调用外部服务 / 脚本）。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-20">0x03 实例拆解</h3>
<p>我们来进一步解释 Flink Agents 这几个核心概念的关系和配合。为了更好的说明，我们可以把整个Flink Agents系统从”做一道菜“拓展到”一个智能餐厅自动化服务系统“。同时，结合实例也深入下技术细节。</p>
<h4 data-id="heading-21">3.1 第一层级：Agent – 餐厅菜单和规则手册（Blueprint）</h4>
<p>Flink Agents 中的 Agent 是用户定义的智能实体，负责协调各种资源和行为来完成特定的任务。我们把 Agent 想象成餐厅的菜单和运营手册：</p>
<ul>
<li>
<p>定义了餐厅能提供哪些菜品和服务（动作）</p>
</li>
<li>
<p>规定了需要用到哪些设备和食材（资源），如同为新员工配备工具箱，对应程序员实际用到的，可以是：</p>
<ul>
<li>各种 API 接口（相当于工具）</li>
<li>数据库访问权限（相当于参考资料）</li>
<li>决策逻辑代码（相当于培训材料）</li>
</ul>
</li>
<li>
<p>遇到什么情况应该做什么（对应事件监听）</p>
</li>
<li>
<p>描述了顾客点餐到上菜的完整流程</p>
<ul>
<li>有一个 start_action（接待员）负责接收顾客问题</li>
<li>有一个 stop_action（收银员）负责最终结账输出结果</li>
</ul>
</li>
</ul>
<p>这些都被封装在 Agent 对象中。</p>
<h4 data-id="heading-22">3.2 第二层级：AgentPlan – 餐厅的详细操作流程图（Compiled Plan,计划编译层）</h4>
<p>Flink Agent框架会把用户的 Agent 转换为一个更通用、更适合系统处理的形式 —— AgentPlan。在本例中，AgentPlan 相当于将餐厅运营手册编译成的详细工作流程图（抽象化的工作蓝图）：</p>
<ul>
<li>把菜单上的每道菜分解成具体的步骤</li>
<li>明确每个岗位（动作）在什么情况下被触发，即遇到啥事件（Event）该干啥活（Action）</li>
<li>准备好所有需要的工具和材料清单（Resource）</li>
</ul>
<p>就像餐厅经理会制定详细的操作手册，告诉服务员什么时候该做什么事。</p>
<h5 data-id="heading-23">结构化解析</h5>
<p>AgentPlan 包含几个关键部分：</p>
<p><strong>Actions 映射表</strong></p>
<ul>
<li>明确列出所有可以执行的动作及其触发条件</li>
<li>例如：“收到订单查询请求” → “执行订单查询动作”</li>
</ul>
<p><strong>资源提供者目录</strong></p>
<ul>
<li>记录所有可用资源的位置和获取方式</li>
<li>类似于工厂里各个供应部门的联系方式清单</li>
</ul>
<p><strong>配置参数集</strong></p>
<ul>
<li>存储运行所需的各项设置选项</li>
<li>像是设备操作规程和技术规范</li>
</ul>
<h5 data-id="heading-24">平台适配性</h5>
<p>通过这种抽象化，无论底层是 Java 还是 Python 实现，都可以统一用同一份 AgentPlan 来进行调度管理。</p>
<h4 data-id="heading-25">3.3 第三层级：ActionExecutionOperator – 餐厅的执行管理层（Runtime Executor，执行引擎层）</h4>
<p>在大规模生产环境中，不能只靠一个管家干活，而是需要一条自动化流水线。ActionExecutionOperator 就像是一条智能化的工厂装配线，它按照操作手册（AgentPlan）组织多个工作站来协同完成任务。或者说，ActionExecutionOperator 是餐厅的现场执行管理层，是整个系统的“大脑 + 中枢控制室”：</p>
<ul>
<li>负责接待进店的顾客（接收数据）</li>
<li>根据流程图分配任务给不同的员工（执行动作）</li>
<li>协调各个岗位之间的工作（监控进度状态 / 管理状态和内存）</li>
<li>确保服务流程顺畅（处理并发和容错）</li>
<li>餐厅经理拿着详细流程图，指挥各个员工协同工作。</li>
</ul>
<h4 data-id="heading-26">3.4 第四层级：ActionTask – 具体的服务步骤（Execution Unit）</h4>
<p>ActionTask 就像是员工执行的具体服务步骤，是生产线上的最小工位：一次只干一件具体活（调用 Python 函数、查数据库、发 HTTP、写 Kafka …）：</p>
<ul>
<li>每个服务员接到的任务就是一个 ActionTask</li>
<li>可能是简单一步完成（普通服务员）</li>
<li>可能是需要多步完成（需要回访的技术员），即如果活太多（异步、长耗时），服务员会把自己「切分」成新任务，等下次轮询再接着干，实现非阻塞的协作式调度。</li>
<li>完成后报告结果，并可能触发下一步工作，即干完就能立即把结果（Event）扔回传送带，继续下一轮</li>
</ul>
<h4 data-id="heading-27">3.5 工作流程举例</h4>
<p>假设顾客来到餐厅点了一份复杂的套餐：</p>
<ul>
<li>
<p>顾客进店（InputEvent）</p>
<ul>
<li>餐厅经理（ActionExecutionOperator）接待顾客</li>
<li>根据流程图知道应该让接待员（start_action）处理</li>
</ul>
</li>
<li>
<p>接待员处理（ActionTask）</p>
<ul>
<li>接待员（PythonActionTask）接到任务</li>
<li>理解顾客需求，生成厨房订单（ChatRequestEvent）</li>
</ul>
</li>
<li>
<p>厨房制作（内置动作）</p>
<ul>
<li>厨师（CHAT_MODEL_ACTION）收到订单开始制作</li>
<li>制作完成后通知服务员（ChatResponseEvent）</li>
</ul>
</li>
<li>
<p>收银结账（ActionTask）</p>
<ul>
<li>收银员（stop_action）处理最终结果</li>
<li>顾客打包带走（OutputEvent）</li>
</ul>
</li>
</ul>
<p>「用户只管把管家训好，框架负责把管家变成手册，再把手册变成并行生产线，最后让无数worker按 key 隔离、事件驱动、可检查点的方式跑在 Flink 上。」。</p>
<h3 data-id="heading-28">0x04 并发性和并行性</h3>
<p>Flink Agents 系统在设计时已经充分考虑了并发性和并行性，比如：</p>
<ul>
<li><strong>事件驱动模型</strong>：基于事件流转触发动作，初始为 InputEvent，经多轮事件（如 ChatRequestEvent、ChatResponseEvent）触发，最终输出 OutputEvent。</li>
<li><strong>并发与隔离设计</strong>：利用 Flink 键控流（KeyedStream）实现按 key 分区，每个 key 拥有独立状态；通过邮箱线程模型（MailboxExecutor）实现协作式多任务，避免阻塞。</li>
<li><strong>任务切分机制</strong>：长时间运行的任务（如 Python 生成器）会被切分为多个 ActionTask，执行后通过 ActionTaskResult 传递下一个任务，确保并发效率。</li>
<li><strong>本地与远程执行</strong>：本地用 LocalRunner 模拟执行，远程基于 Flink 集群的 ActionExecutionOperator 分布式执行，保持 API 一致性。</li>
</ul>
<p>以下是具体实现方式：</p>
<h4 data-id="heading-29">4.1 Flink原生并发模型</h4>
<p>系统充分利用了Apache Flink的原生并发机制：</p>
<ul>
<li>键控流（Keyed Streams）：使用Flink的KeyedStream按key对数据进行分区，确保相同key的事件由同一个并行实例处理</li>
<li>并行操作符：ActionExecutionOperator可以在Flink集群中的多个实例上并行运行</li>
</ul>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 在CompileUtils.java中 - 将代理连接到键控流</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-operator">&lt;</span><span class="hljs-type">IN</span>, <span class="hljs-type">K</span><span class="hljs-operator">&gt;</span> <span class="hljs-type">DataStream</span>&lt;<span class="hljs-type">Object</span>&gt; connectToAgent(
    <span class="hljs-type">DataStream</span>&lt;<span class="hljs-type">IN</span>&gt; inputStream, <span class="hljs-type">KeySelector</span>&lt;<span class="hljs-type">IN</span>, <span class="hljs-type">K</span>&gt; keySelector, <span class="hljs-type">AgentPlan</span> agentPlan) {
    <span class="hljs-keyword">return</span> connectToAgent(inputStream.keyBy(keySelector), agentPlan);
}
</code></pre>
<p>在 RemoteExecutionEnvironment 中有：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">DataStream</span>&lt;<span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">toDataStream</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (agentPlan == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(<span class="hljs-string">"Must apply agent before calling toDataStream"</span>);
    }

    <span class="hljs-keyword">if</span> (outputDataStream == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (keySelector != <span class="hljs-literal">null</span>) {
            outputDataStream =
                    <span class="hljs-title class_">CompileUtils</span>.<span class="hljs-title function_">connectToAgent</span>(inputDataStream, keySelector, agentPlan);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// If no key selector provided, use a simple pass-through key selector</span>
            outputDataStream =
                    <span class="hljs-title class_">CompileUtils</span>.<span class="hljs-title function_">connectToAgent</span>(inputDataStream, x -&gt; x, agentPlan);
        }
    }

    <span class="hljs-keyword">return</span> outputDataStream;
}
</code></pre>
<h4 data-id="heading-30">4.2 每个Key的状态管理</h4>
<p>每个key都维护独立的状态隔离：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在ActionExecutionOperator.java中 - 维护每个key的状态</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;ActionTask&gt; actionTasksKState;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ListState&lt;Event&gt; pendingInputEventsKState;
<span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> ValueState&lt;Long&gt; sequenceNumberKState;
</code></pre>
<p>这些都是键控状态（keyed state），意味着每个key都有自己的独立状态实例，防止不同key之间的竞争条件。</p>
<h4 data-id="heading-31">4.3 邮箱线程模型</h4>
<p>系统使用Flink的邮箱线程模型实现协作式多任务处理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 在ActionExecutionOperator.java中</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">transient</span> MailboxExecutor mailboxExecutor;

<span class="hljs-comment">// 提交任务进行处理</span>
mailboxExecutor.submit(() -&gt; tryProcessActionTaskForKey(key), <span class="hljs-string">"process action task"</span>);
</code></pre>
<p>这允许长时间运行的操作让出控制权，防止阻塞整个操作符。</p>
<h4 data-id="heading-32">4.4 异步任务处理</h4>
<p>支持异步执行并具备适当的状态管理：</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">// 在 ActionTask.java 中 - 支持基于延续的执行</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ActionTaskResult</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> boolean finished;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">Event</span>&gt; outputEvents;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Optional</span>&lt;<span class="hljs-type">ActionTask</span>&gt; generatedActionTaskOpt;

    <span class="hljs-comment">// 允许一个动作生成延续任务</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">Optional</span>&lt;<span class="hljs-type">ActionTask</span>&gt; getGeneratedActionTask() {
        <span class="hljs-keyword">return</span> generatedActionTaskOpt;
    }
}
</code></pre>
<h4 data-id="heading-33">4.5 内存一致性</h4>
<p>具有缓存状态访问的线程安全内存管理：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 在 ActionExecutionOperator.java 中</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">createAndSetRunnerContext</span>(<span class="hljs-params">ActionTask actionTask</span>) {
    <span class="hljs-comment">// 正确管理 RunnerContext 的创建和重用</span>
    <span class="hljs-keyword">if</span> (actionTask.<span class="hljs-title function_">getRunnerContext</span>() != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-comment">// ... 创建适当的 context</span>
}
</code></pre>
<h4 data-id="heading-34">4.6 水印和事件时间处理</h4>
<p>具备并发意识的水印处理：</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">transient</span> SegmentedQueue keySegmentQueue;
    
    keySegmentQueue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SegmentedQueue</span>();

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processWatermark</span><span class="hljs-params">(Watermark mark)</span> <span class="hljs-keyword">throws</span> Exception {
        keySegmentQueue.addWatermark(mark);
        processEligibleWatermarks();
    }
</code></pre>
<h4 data-id="heading-35">4.7 检查点和恢复</h4>
<p>用于容错的线程安全状态快照</p>
<pre><code class="hljs language-scss" lang="scss">    <span class="hljs-keyword">@Override</span>
    public void snapshotState(StateSnapshotContext context) throws Exception {
        if (actionStateStore != null) {
            <span class="hljs-selector-tag">Object</span> recoveryMarker = actionStateStore<span class="hljs-selector-class">.getRecoveryMarker</span>();
            if (recoveryMarker != null) {
                recoveryMarkerOpState<span class="hljs-selector-class">.update</span>(List.of(recoveryMarker));
            }
        }

        HashMap&lt;<span class="hljs-selector-tag">Object</span>, Long&gt; keyToSeqNum = new HashMap&lt;&gt;();
        <span class="hljs-built_in">getKeyedStateBackend</span>()
                <span class="hljs-selector-class">.applyToAllKeys</span>(
                        VoidNamespace.INSTANCE,
                        VoidNamespaceSerializer.INSTANCE,
                        new ValueStateDescriptor&lt;&gt;(MESSAGE_SEQUENCE_NUMBER_STATE_NAME, Long.class),
                        (key, state) -&gt; keyToSeqNum<span class="hljs-selector-class">.put</span>(key, state.value()));
        checkpointIdToSeqNums<span class="hljs-selector-class">.put</span>(context.getCheckpointId(), keyToSeqNum);

        super<span class="hljs-selector-class">.snapshotState</span>(context);
    }
</code></pre>
<h4 data-id="heading-36">4.8 总结</h4>
<p>设计采用了多种并发机制：</p>
<ul>
<li>Flink并行处理：利用Flink原生的并行性和键控流</li>
<li>每个Key的隔离：每个key维护独立状态，消除key之间的竞争</li>
<li>协作式线程：使用邮箱执行器实现非阻塞执行</li>
<li>异步延续：通过任务链支持长时间运行的操作</li>
<li>线程安全状态管理：对共享资源进行适当的同步</li>
<li>容错机制：检查点机制确保故障情况下的数据一致性</li>
</ul>
<p>这种方法使系统能够在保持一致性和支持水平扩展的同时处理高吞吐量，可在 Flink 集群的多个节点间扩展。</p>
<h3 data-id="heading-37">0xFF 参考</h3>
<p>本文使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarkdown.com.cn" target="_blank" title="https://markdown.com.cn" ref="nofollow noopener noreferrer">markdown.com.cn</a> 排版</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hibernate（10）Hibernate的查询语言（HQL）是什么？]]></title>    <link>https://juejin.cn/post/7589126217250701353</link>    <guid>https://juejin.cn/post/7589126217250701353</guid>    <pubDate>2025-12-29T12:34:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126217250701353" data-draft-id="7589099845186715684" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hibernate（10）Hibernate的查询语言（HQL）是什么？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T12:34:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hibernate（10）Hibernate的查询语言（HQL）是什么？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:34:20.000Z" title="Mon Dec 29 2025 12:34:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Hibernate查询语言（HQL，Hibernate Query Language）是一种面向对象的查询语言，它类似于SQL，但操作的是Hibernate映射的持久化对象及其属性而不是数据库表。HQL的强大之处在于它能够利用Hibernate的映射和关联，简化复杂的查询操作。</p>
<h3 data-id="heading-0">主要特点</h3>
<ol>
<li><strong>面向对象</strong>：HQL操作的是对象及其属性，而不是数据库表和列。</li>
<li><strong>自动转换</strong>：HQL查询会自动转换成相应的SQL查询。</li>
<li><strong>支持投影和聚合</strong>：HQL支持投影、聚合、排序、分组等操作。</li>
<li><strong>支持关联和连接</strong>：可以通过对象关系导航进行关联和连接操作。</li>
</ol>
<h3 data-id="heading-1">HQL查询示例</h3>
<p>下面是一个完整的示例，展示如何使用HQL进行各种查询操作。</p>
<h4 data-id="heading-2">配置文件 <code>hibernate.cfg.xml</code></h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">hibernate-configuration</span> <span class="hljs-keyword">PUBLIC</span>
        <span class="hljs-string">"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span>
        <span class="hljs-string">"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">hibernate-configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">session-factory</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 数据库连接配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.cj.jdbc.Driver<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql://localhost:3306/your_database<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.username"</span>&gt;</span>your_username<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.connection.password"</span>&gt;</span>your_password<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Hibernate 属性配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.show_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.format_sql"</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- 映射类配置 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"com.example.domain.Student"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">session-factory</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">hibernate-configuration</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">HibernateUtil 类</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.cfg.Configuration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateUtil</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SessionFactory sessionFactory;

    <span class="hljs-keyword">static</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 从配置文件创建SessionFactory</span>
            sessionFactory = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>().configure(<span class="hljs-string">"hibernate.cfg.xml"</span>).buildSessionFactory();
        } <span class="hljs-keyword">catch</span> (Throwable ex) {
            <span class="hljs-comment">// 记录启动失败的错误</span>
            System.err.println(<span class="hljs-string">"Initial SessionFactory creation failed."</span> + ex);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionInInitializerError</span>(ex);
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SessionFactory <span class="hljs-title function_">getSessionFactory</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> sessionFactory;
    }
}
</code></pre>
<h4 data-id="heading-4">实体类 Student</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.domain;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">private</span> Long id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">()</span> {}

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Student</span><span class="hljs-params">(String name, <span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.name = name;
        <span class="hljs-built_in">this</span>.age = age;
    }

    <span class="hljs-comment">// getters 和 setters</span>
    <span class="hljs-keyword">public</span> Long <span class="hljs-title function_">getId</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setId</span><span class="hljs-params">(Long id)</span> {
        <span class="hljs-built_in">this</span>.id = id;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setName</span><span class="hljs-params">(String name)</span> {
        <span class="hljs-built_in">this</span>.name = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getAge</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> age;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setAge</span><span class="hljs-params">(<span class="hljs-type">int</span> age)</span> {
        <span class="hljs-built_in">this</span>.age = age;
    }
}
</code></pre>
<h4 data-id="heading-5">使用HQL的查询示例</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.hibernate.Session;
<span class="hljs-keyword">import</span> org.hibernate.SessionFactory;
<span class="hljs-keyword">import</span> org.hibernate.query.Query;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HibernateHQLExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 获取SessionFactory</span>
        <span class="hljs-type">SessionFactory</span> <span class="hljs-variable">sessionFactory</span> <span class="hljs-operator">=</span> HibernateUtil.getSessionFactory();
        <span class="hljs-comment">// 打开一个新的Session</span>
        <span class="hljs-type">Session</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> sessionFactory.openSession();

        <span class="hljs-comment">// 启动事务</span>
        session.beginTransaction();

        <span class="hljs-comment">// 创建并保存Student对象</span>
        <span class="hljs-type">Student</span> <span class="hljs-variable">student1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"John Doe"</span>, <span class="hljs-number">20</span>);
        <span class="hljs-type">Student</span> <span class="hljs-variable">student2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">"Jane Doe"</span>, <span class="hljs-number">22</span>);
        session.save(student1);
        session.save(student2);

        <span class="hljs-comment">// 提交事务</span>
        session.getTransaction().commit();

        <span class="hljs-comment">// 查询所有学生</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">hql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"FROM Student"</span>;
        Query&lt;Student&gt; query = session.createQuery(hql, Student.class);
        List&lt;Student&gt; students = query.list();
        <span class="hljs-keyword">for</span> (Student student : students) {
            System.out.println(<span class="hljs-string">"Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        }

        <span class="hljs-comment">// 带条件的查询</span>
        hql = <span class="hljs-string">"FROM Student S WHERE S.age &gt; :student_age"</span>;
        query = session.createQuery(hql, Student.class);
        query.setParameter(<span class="hljs-string">"student_age"</span>, <span class="hljs-number">21</span>);
        students = query.list();
        <span class="hljs-keyword">for</span> (Student student : students) {
            System.out.println(<span class="hljs-string">"Filtered Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        }

        <span class="hljs-comment">// 投影查询</span>
        hql = <span class="hljs-string">"SELECT S.name FROM Student S"</span>;
        Query&lt;String&gt; nameQuery = session.createQuery(hql, String.class);
        List&lt;String&gt; names = nameQuery.list();
        <span class="hljs-keyword">for</span> (String name : names) {
            System.out.println(<span class="hljs-string">"Student Name: "</span> + name);
        }

        <span class="hljs-comment">// 聚合查询</span>
        hql = <span class="hljs-string">"SELECT COUNT(S.id) FROM Student S"</span>;
        Query&lt;Long&gt; countQuery = session.createQuery(hql, Long.class);
        <span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> countQuery.getSingleResult();
        System.out.println(<span class="hljs-string">"Total Students: "</span> + count);

        <span class="hljs-comment">// 排序查询</span>
        hql = <span class="hljs-string">"FROM Student S ORDER BY S.age DESC"</span>;
        query = session.createQuery(hql, Student.class);
        students = query.list();
        <span class="hljs-keyword">for</span> (Student student : students) {
            System.out.println(<span class="hljs-string">"Sorted Student: "</span> + student.getName() + <span class="hljs-string">", Age: "</span> + student.getAge());
        }

        <span class="hljs-comment">// 分组查询</span>
        hql = <span class="hljs-string">"SELECT S.age, COUNT(S.id) FROM Student S GROUP BY S.age"</span>;
        Query&lt;Object[]&gt; groupQuery = session.createQuery(hql, Object[].class);
        List&lt;Object[]&gt; groupResults = groupQuery.list();
        <span class="hljs-keyword">for</span> (Object[] result : groupResults) {
            System.out.println(<span class="hljs-string">"Age: "</span> + result[<span class="hljs-number">0</span>] + <span class="hljs-string">", Count: "</span> + result[<span class="hljs-number">1</span>]);
        }

        <span class="hljs-comment">// 关闭Session</span>
        session.close();
        <span class="hljs-comment">// 关闭SessionFactory</span>
        sessionFactory.close();
    }
}
</code></pre>
<h3 data-id="heading-6">详细解释</h3>
<ol>
<li>
<p><strong>查询所有学生</strong>：使用<code>FROM Student</code>语句查询所有学生对象。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span> <span class="hljs-variable">hql</span> <span class="hljs-operator">=</span> <span class="hljs-string">"FROM Student"</span>;
Query&lt;Student&gt; query = session.createQuery(hql, Student.class);
List&lt;Student&gt; students = query.list();
</code></pre>
</li>
<li>
<p><strong>带条件的查询</strong>：使用<code>WHERE</code>子句添加条件查询，例如查找年龄大于21岁的学生。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"FROM Student S WHERE S.age &gt; :student_age"</span>;
query = session.createQuery(hql, Student.class);
query.setParameter(<span class="hljs-string">"student_age"</span>, <span class="hljs-number">21</span>);
List&lt;Student&gt; students = query.list();
</code></pre>
</li>
<li>
<p><strong>投影查询</strong>：使用<code>SELECT</code>子句选择特定字段，例如只选择学生的名字。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"SELECT S.name FROM Student S"</span>;
Query&lt;String&gt; nameQuery = session.createQuery(hql, String.class);
List&lt;String&gt; names = nameQuery.list();
</code></pre>
</li>
<li>
<p><strong>聚合查询</strong>：使用聚合函数，例如<code>COUNT</code>函数统计学生人数。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"SELECT COUNT(S.id) FROM Student S"</span>;
Query&lt;Long&gt; countQuery = session.createQuery(hql, Long.class);
<span class="hljs-type">Long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> countQuery.getSingleResult();
</code></pre>
</li>
<li>
<p><strong>排序查询</strong>：使用<code>ORDER BY</code>子句进行排序，例如按年龄降序排序。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"FROM Student S ORDER BY S.age DESC"</span>;
query = session.createQuery(hql, Student.class);
List&lt;Student&gt; students = query.list();
</code></pre>
</li>
<li>
<p><strong>分组查询</strong>：使用<code>GROUP BY</code>子句进行分组查询，例如按年龄分组统计每个年龄段的学生人数。</p>
<pre><code class="hljs language-java" lang="java">hql = <span class="hljs-string">"SELECT S.age, COUNT(S.id) FROM Student S GROUP BY S.age"</span>;
Query&lt;Object[]&gt; groupQuery = session.createQuery(hql, Object[].class);
List&lt;Object[]&gt; groupResults = groupQuery.list();
</code></pre>
</li>
</ol>
<h3 data-id="heading-7">总结</h3>
<p>HQL是一种功能强大的查询语言，它简化了Hibernate持久化对象的查询操作。通过HQL可以方便地进行各种复杂的查询操作，如条件查询、投影查询、聚合查询、排序查询和分组查询。此外，HQL与数据库无关，这使得应用程序在不同数据库之间具有良好的可移植性。通过熟练掌握HQL，可以高效地进行数据库操作，提高应用程序的性能和可维护性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Luckysheet 远程搜索下拉 控件开发 : 揭秘二开全流程]]></title>    <link>https://juejin.cn/post/7589126920286289930</link>    <guid>https://juejin.cn/post/7589126920286289930</guid>    <pubDate>2025-12-29T12:47:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589126920286289930" data-draft-id="7589093895327023113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Luckysheet  远程搜索下拉 控件开发 : 揭秘二开全流程"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T12:47:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="朴shu"/> <meta itemprop="url" content="https://juejin.cn/user/3866303125264135"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Luckysheet  远程搜索下拉 控件开发 : 揭秘二开全流程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3866303125264135/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    朴shu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T12:47:46.000Z" title="Mon Dec 29 2025 12:47:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>远程搜索下拉控件是非常常见的控件，应用在表单填写场景下，也是非常合适的，本例将带领大家实现以下效果，并真实了解并熟悉 luckysheet 的二开流程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fa9e707052b4260aa2b992a2395a52d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767617266&amp;x-signature=Cjkf12XL8qDoAEnlzDnp11Lkez8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-1">拓展单元格属性</h2>
<p>在官网上，有一个常见问题，既然已知批注是直接加到单元格属性上，那么，我们拓展属性，是不是可以参考批注的实现方案？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22fd9b12c2c6470fb53fbfb6a0b8ffcd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767617266&amp;x-signature=1YQxfHygfcHNaEUdhyY4ILqUvJE%3D" alt="在这里插入图片描述" loading="lazy"/>
我们设定以下是远程搜索下拉的单元格拓展属性：</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 扩展后的单元格对象</span>
<span class="hljs-keyword">const</span> cell = {
    <span class="hljs-attr">v</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 原始值</span>
    <span class="hljs-attr">m</span>: <span class="hljs-literal">null</span>, <span class="hljs-comment">// 显示值</span>
    <span class="hljs-attr">ct</span>: { <span class="hljs-attr">fa</span>: <span class="hljs-string">"General"</span>, <span class="hljs-attr">t</span>: <span class="hljs-string">"s"</span> },
    <span class="hljs-comment">// ... other properties</span>

    <span class="hljs-comment">// 新增远程搜索下拉配置</span>
    <span class="hljs-attr">remoteSelect</span>: {
        <span class="hljs-comment">// 是否启用远程搜索，[必传]</span>
        <span class="hljs-attr">enable</span>: <span class="hljs-built_in">boolean</span>,

        <span class="hljs-comment">// 用户输入时的回调函数，用于获取远程数据</span>
        <span class="hljs-title function_">onInput</span>(value): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt; {
            <span class="hljs-comment">// 这个函数需要返回一个Promise对象，resolve一个数组，数组的元素为下拉选项对象</span>
        }

        <span class="hljs-comment">// 用户选定某个选项后的回调函数</span>
        <span class="hljs-title function_">onSelect</span>(item): <span class="hljs-built_in">void</span> {
            <span class="hljs-comment">// item 为用户选定的选项对象，值是onInput函数返回的数组中的某个元素</span>
        }

        <span class="hljs-comment">// 是否需要设定当前输入单元格的值 [可选]</span>
        <span class="hljs-title function_">setValue</span>(item): <span class="hljs-built_in">string</span>{
           <span class="hljs-comment">// item 为用户选定的选项对象，需要返回一个字符串，用于设定单元格的值</span>
        },

        <span class="hljs-comment">// 自定义类名  [可选]</span>
        <span class="hljs-attr">popperClass</span>: <span class="hljs-built_in">string</span>,
    },
};
</code></pre>
<h2 data-id="heading-2">何时触发？</h2>
<p>在这个场景中，我们需要<code>在用户输入值时，进行远程数据获取，渲染列表</code>，因此，需要在用户进行编辑时，进行处理：</p>
<ol>
<li>一个方案，是在初始化 inputHTML 时，将相关事件处理：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/755689351f904e30a11d579d9ff5a471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py0c2h1:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767617266&amp;x-signature=%2FKJ62ts%2BnUnkohBygCBG2drzPuQ%3D" alt="在这里插入图片描述" loading="lazy"/></li>
</ol>
<pre><code class="hljs language-js" lang="js"> $(<span class="hljs-string">"body"</span>).<span class="hljs-title function_">append</span>(inputHTML)
 <span class="hljs-comment">// 进行相关事件绑定: [伪代码]</span>
 $input.<span class="hljs-title function_">on</span>(<span class="hljs-string">'input'</span>,<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
 	<span class="hljs-comment">// 这里是未知具体单元格信息的，需要通过外部传递</span>
 	<span class="hljs-keyword">const</span> remoteSelectOptions = <span class="hljs-title class_">Store</span>.<span class="hljs-property">flowdata</span>[r][c]
 	<span class="hljs-comment">// 执行后续操作</span>
 })
</code></pre>
<ol start="2">
<li>另一个方案，是用户双击时，唤起输入框后，进行判断：</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// handler.js</span>
$(<span class="hljs-string">"#luckysheet-cell-main, #luckysheetTableContent"</span>).<span class="hljs-title function_">dblclick</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
	<span class="hljs-comment">// 这个函数是内置的哈，因此，可以直接获取到 r c</span>
	<span class="hljs-comment">// 判断当前单元格是否需要初始化远程搜索控件</span>
	<span class="hljs-title class_">RemoteSelect</span>.<span class="hljs-title function_">checkCellNeedRemoteSelect</span>(row_index, col_index)
})
</code></pre>
<p>两种方案我都试过了，<code>实现略有不同</code>，但都可以实现，还是借助原生的 dblclick 好处理些。</p>
<h2 data-id="heading-3">校验远程搜索下拉</h2>
<p>既然每一个单元格双击，都会触发这个校验，那么何时才需要初始化这个下拉框呢？</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 判断当前单元格是否需要显示下拉框</span>
<span class="hljs-attr">checkCellNeedRemoteSelect</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">r, c</span>) {
    <span class="hljs-comment">// 通过 r c 获取单元格信息</span>
    <span class="hljs-keyword">let</span> cell = <span class="hljs-title class_">Store</span>.<span class="hljs-property">flowdata</span>[r][c];

    <span class="hljs-comment">// 如果 cell 没有配置 remoteSelect 或者 remoteSelect.enable 为 false 则返回</span>
    <span class="hljs-keyword">if</span> (!cell || !cell.<span class="hljs-property">remoteSelect</span> || !cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">enable</span>) {
        <span class="hljs-keyword">return</span>;
    }
}
</code></pre>
<p>检验完成后，如果需要初始化校验，别忘了， 我们底层还要监听输入框事件哈：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 不然，开始监听 input 输入事件</span>
$(<span class="hljs-string">"#luckysheet-input-box .luckysheet-cell-input"</span>).<span class="hljs-title function_">off</span>(<span class="hljs-string">"input"</span>).<span class="hljs-title function_">on</span>(<span class="hljs-string">"input"</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">let</span> value = $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">text</span>().<span class="hljs-title function_">trim</span>(); <span class="hljs-comment">// 获取用户输入的值</span>
      
        <span class="hljs-keyword">if</span> (cell.<span class="hljs-property">remoteSelect</span> &amp;&amp; cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onInput</span> &amp;&amp; <span class="hljs-keyword">typeof</span> cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onInput</span> == <span class="hljs-string">"function"</span>) {
            <span class="hljs-comment">// 调用外部接口</span>
            cell.<span class="hljs-property">remoteSelect</span>
                .<span class="hljs-title function_">onInput</span>(value)
                .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">dataList</span>) {
                    $this.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
                    $this.<span class="hljs-title function_">showRemoteSelect</span>(dataList);
                })
                .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {
                    $this.<span class="hljs-property">loading</span> = <span class="hljs-literal">false</span>;
                    $this.<span class="hljs-title function_">hideRemoteSelect</span>();
                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"请求接口错误"</span>, error);
                    tooltip.<span class="hljs-title function_">info</span>(<span class="hljs-string">'&lt;i class="fa fa-exclamation-triangle"&gt;&lt;/i&gt;'</span>, <span class="hljs-string">"接口请求失败"</span>);
                });
        }
    });
</code></pre>
<h2 data-id="heading-4">初始化下拉框</h2>
<p>远程搜索的核心，就是下拉选项，当远程接口初始化完成后，执行如下：</p>
<pre><code class="hljs language-js" lang="js">dataList.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
	<span class="hljs-keyword">const</span> $item = $(<span class="hljs-string">`&lt;div class="<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.selectItemClass}</span>"&gt;`</span>)
		.<span class="hljs-title function_">text</span>(item)
		.<span class="hljs-title function_">click</span>(<span class="hljs-function">() =&gt;</span> {
			<span class="hljs-comment">// 触发选择回调</span>
			<span class="hljs-keyword">if</span> (cell.<span class="hljs-property">remoteSelect</span> &amp;&amp; cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onSelect</span> &amp;&amp; <span class="hljs-keyword">typeof</span> cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-property">onSelect</span> === <span class="hljs-string">"function"</span>) {
    		cell.<span class="hljs-property">remoteSelect</span>.<span class="hljs-title function_">onSelect</span>(item);
			}
		})
</code></pre>
<p>这里就一个难点要处理，如何将下拉框定位到输入框的位置：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 这里采用巧方案，直接取输入框的位置</span>
<span class="hljs-keyword">const</span> $input = $(<span class="hljs-string">"#luckysheet-input-box"</span>);
<span class="hljs-keyword">const</span> left = <span class="hljs-built_in">parseInt</span>($input.<span class="hljs-title function_">css</span>(<span class="hljs-string">"left"</span>)) || <span class="hljs-number">0</span>;
<span class="hljs-keyword">const</span> top = <span class="hljs-built_in">parseInt</span>($input.<span class="hljs-title function_">css</span>(<span class="hljs-string">"top"</span>)) || <span class="hljs-number">0</span>;

<span class="hljs-comment">// 获取当前单元格的高度 行高</span>
<span class="hljs-keyword">const</span> [_row_pre, rowHeight] = <span class="hljs-title function_">rowLocation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">r</span>);

<span class="hljs-comment">// 设置下拉框位置和宽度</span>
$selectBox.<span class="hljs-title function_">css</span>({
    <span class="hljs-attr">top</span>: <span class="hljs-string">`<span class="hljs-subst">${top + rowHeight + <span class="hljs-number">4</span>}</span>px`</span>, <span class="hljs-comment">// 在单元格下方显示</span>
    <span class="hljs-attr">left</span>: <span class="hljs-string">`<span class="hljs-subst">${left}</span>px`</span>,
});
</code></pre>
<h2 data-id="heading-5">总结</h2>
<p>虽然代码看起来不复杂，但是了解luckysheet 的源码、实现思路，以及单元格拓展实现方案是非常重要的。</p>
<p>通过本次实现，我们初步了解了luckysheet的二次开发流程，在不破坏原有功能的基础上添加新特性。远程搜索下拉控件的实现展示了如何在现有表格组件基础上，通过合理的架构设计和代码组织，添加复杂交互功能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[出海需求怎么挖？我用 Google “新词”找到 0-1 的机会（附 122 个词根）]]></title>    <link>https://juejin.cn/post/7589107312112975881</link>    <guid>https://juejin.cn/post/7589107312112975881</guid>    <pubDate>2025-12-29T13:02:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589107312112975881" data-draft-id="7589093895327105033" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="出海需求怎么挖？我用 Google “新词”找到 0-1 的机会（附 122 个词根）"/> <meta itemprop="keywords" content="创业,产品,AI编程"/> <meta itemprop="datePublished" content="2025-12-29T13:02:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="孟健AI编程"/> <meta itemprop="url" content="https://juejin.cn/user/4212984287073895"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            出海需求怎么挖？我用 Google “新词”找到 0-1 的机会（附 122 个词根）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984287073895/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    孟健AI编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T13:02:16.000Z" title="Mon Dec 29 2025 13:02:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是孟健。</p>
<p>刚刚参加完破局线下的 AI 大会。</p>
<p>在我的夜话会上，大家问得最多的一个问题是：</p>
<p><strong>怎样挖掘需求？</strong></p>
<p>看起来这件事，确实难住了很多人。</p>
<p>今天我就把我们团队现阶段最常用、也最“科学”的找需求方法，整理成一篇可复用的 SOP。</p>
<p>先讲一个底层认知：<strong>海外搜索市场，基本就是 Google 的主场。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83d4ea6f4eab43efaabd3b72fd81df34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=aLnkPm5zoY9s%2FhPXMvOQ3dahLuQ%3D" alt="" loading="lazy"/></p>
<p>所以，对“出海做产品/做站”的人来说，找需求最稳的一条路，其实是：</p>
<p><strong>去挖关键词。</strong></p>
<p>这里的关键词，指的是用户每天真实输入到 Google 搜索框里的那些词、短语、句子。</p>
<p>因为：<strong>搜索的背后，就是需求。</strong></p>
<h3 data-id="heading-0">一、先把关键词分清楚：新词 vs 老词</h3>
<p>关键词挖掘听起来简单，但如果你不做分类，很容易陷入“什么都能做，但不知道先做什么”的状态。</p>
<p>我们通常把关键词分成两类：</p>
<ul>
<li>
<p><strong>新词</strong>：最近 3 个月出现的词（这是主观划分，你也可以用 6 个月 / 12 个月）</p>
</li>
<li>
<p><strong>老词</strong>：更早就存在、已经被大量站点覆盖过的词</p>
</li>
</ul>
<p>因为 Google 曾披露：<strong>每天大约有 15% 的搜索，是全新的查询。</strong></p>
<p>换句话说：每天都有一批“刚出现”的需求，还没被足够多的页面满足。</p>
<p>这对我们意味着什么？</p>
<ul>
<li>
<p>如果你做老词，常见情况是：竞争大、索引慢、起量慢</p>
</li>
<li>
<p>但如果你抓到新词窗口期，并快速做出能满足需求的页面/工具，往往更容易更快被收录，甚至更快拿到更靠前的排名</p>
</li>
</ul>
<p>这就是红利。</p>
<p>逻辑跟“AI 热点事件写文章”很像：<strong>越早满足，越容易吃到第一波流量</strong>——甚至有时候红利还更大。</p>
<p>所以，我们现阶段的重点是：<strong>以新词挖掘为主</strong>。</p>
<h3 data-id="heading-1">二、新词怎么挖？两件工具就够了</h3>
<p>很多人以为挖词要用一堆付费工具。</p>
<p>但对 0-1 的新手来说，真的没必要。</p>
<p>我们最常用的就两个：</p>
<ul>
<li>
<p>Google 搜索（下拉联想）</p>
</li>
<li>
<p>Google Trends（趋势）</p>
</li>
</ul>
<h4 data-id="heading-2">1）用 Google 下拉联想挖词（Autocomplete）</h4>
<p>你在 Google 搜索框里输入一个词时，它会自动给出一堆“大家常搜的相关词”。</p>
<p>这就是最直接的需求线索。</p>
<p>实操时，你可以用“空格”组合出更多变体：</p>
<ul>
<li>
<p><strong>词后空格</strong>：<code>ai␣</code> → 看它往后接什么（<code>␣</code> 表示空格）</p>
</li>
<li>
<p><strong>词前空格</strong>：<code>␣ai</code> → 看它前面常出现什么</p>
</li>
<li>
<p><strong>词中空格</strong>：把词拆开 → 看中间会被补成什么</p>
</li>
</ul>
<p>搭配使用，你能很快扩出一堆候选词。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97e05bfc676745da9eae2bd078ef6d52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=JtmzjjtLJPR0xNZ84QgNJT9smTk%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-3">2）用 Google Trends 找“飙升”的新词</h4>
<p>Google Trends 是找新词的神器。</p>
<p>方法也很简单：</p>
<ol>
<li>
<p>打开 <code>https://trends.google.com/trends/</code></p>
</li>
<li>
<p>把时间范围缩短到 <strong>7 天</strong></p>
</li>
<li>
<p>重点看 <strong>飙升（Rising）</strong> 的关键词</p>
</li>
</ol>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftrends.google.com%2Ftrends%2F" target="_blank" title="https://trends.google.com/trends/" ref="nofollow noopener noreferrer">trends.google.com/trends/</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6764bcfe0d4ca5a6b0b445c7cd3ce9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=xAN69sffDUWs9%2FdCIP67AcnvT00%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad9f859cbb5746678625cc553410875c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5a2f5YGlQUnnvJbnqIs=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767618135&amp;x-signature=cGK%2BxScQG%2Fo85dusNFGkn6PBTMs%3D" alt="" loading="lazy"/></p>
<p>举个例子：上面这个 <code>kling ai motion poster</code>，就是我从 <code>ai</code> 这个词一路顺藤摸瓜挖出来的新词。</p>
<p>它大概率对应“可灵（Kling）模型”的某类具体需求。</p>
<p>至于值不值得做，是下一步的事——<strong>今天我们只讲：怎么找到这些词。</strong></p>
<p>基本上，靠 Google 下拉 + Trends 7 天飙升，你已经能抓到绝大部分新词了。</p>
<p>我们一直在用的也是这套方法。</p>
<h3 data-id="heading-4">三、关键难点：你得先有“词根”</h3>
<p>你可能已经发现了一个问题：</p>
<p>无论是下拉联想，还是 Trends，你都得先输入一个词，才会给你更多相关词。</p>
<p>那问题来了：<strong>我应该先输入什么？</strong></p>
<p>答案是：你需要一套“词根库”（seed list）。</p>
<p>这里要感谢哥飞大佬提供的 51 个词根。</p>
<p>我们在这个基础上扩展到了 <strong>122 个词根</strong>，今天直接分享给大家（可直接复制）：</p>
<pre><code class="hljs language-css" lang="css">action,advisor,agent,ai,analyzer
anime,answer,art,assistant,<span class="hljs-selector-tag">audio</span>
avatar,best,builder,calculator,cartoon
cataloger,character,chart,chat,cheat
checker,clue,<span class="hljs-selector-tag">code</span>,coloring page,comparator
compiler,composer,connector,constructor,convert
converter,crawler,creator,dashboard,designer
detector,diagram,directory,downloader,editor
emoji,enhancer,evaluator,example,explorer
extractor,face,faq,<span class="hljs-selector-tag">figure</span>,<span class="hljs-attribute">filter</span>
finder,<span class="hljs-attribute">font</span>,format,generator,graph
guide,helper,hint,how <span class="hljs-selector-tag">to</span>,humanizer
<span class="hljs-attribute">icon</span>,ideas,illustration,image,interior design
interpreter,layout,list,logo,maker
manager,meme,model,modifier,monitor
music,navigator,notifier,online,optimizer
paraphraser,pattern,photo,picture,planner
portal,portrait,processor,product photo,receiver
recommend,recorder,resources,responder,restorer
review,sample,scheduler,scraper,sender
simulator,solver,song,sound,speech
starter,studio,style,summarizer,<span class="hljs-selector-tag">summary</span>
syncer,tattoo,template
tester,text
</code></pre>
<p>一个很简单但非常有效的建议：</p>
<p><strong>每天把这份词根过一遍，随便挑 5 个丢进 Google / Trends，去看联想词和飙升词。</strong></p>
<p>只要你坚持一段时间，你一定会开始“看到”需求。</p>
<h3 data-id="heading-5">四、再进阶一点：监控大站 sitemap（游戏方向很好用）</h3>
<p>除了上面这套“通用挖词”方法，我们还会做一件事：</p>
<p><strong>监控一些游戏大站的 sitemap 更新</strong>（比如 CrazyGames 等），从它们新增的页面里反推新词和新需求。</p>
<p>这一步需要一点技术手段。</p>
<p>如果你是程序员，可以尝试自己写脚本去监控 sitemap 的更新频率、新增 URL、页面标题变化等。</p>
<p>你会发现：很多“刚冒头”的小游戏关键词，就是这样被挖出来的。</p>
<h3 data-id="heading-6">五、写在最后：别小看“简单的方法”</h3>
<p>以上就是我们现阶段挖掘需求（尤其是新词需求）的一整套方法。</p>
<p>它不花哨，但足够实用。</p>
<p>新手用这套方法跑通 0-1 完全没问题。</p>
<p>至于老词挖掘，玩法确实更多，但对 0-1 的新手不友好。</p>
<p>等我们把老词打法跑出更稳定的结果，我再把那一套也完整拆开分享给大家。</p>
<p>如果这篇文章对你有帮助，欢迎点个赞、在看、转发三连。</p>
<p>我们下期再见！</p>
<hr/>
<p>🚀 想要与更多AI爱好者交流，共同成长吗？</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZ4k_5_waWJbRRo5lZBZmog" target="_blank" title="https://mp.weixin.qq.com/s/Z4k_5_waWJbRRo5lZBZmog" ref="nofollow noopener noreferrer">和一群志同道合的人，持续精进 AI 的每一天</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Midscene v1.0 发布 - 视觉驱动，UI 自动化体验跃迁]]></title>    <link>https://juejin.cn/post/7589093895326777353</link>    <guid>https://juejin.cn/post/7589093895326777353</guid>    <pubDate>2025-12-29T11:15:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093895326777353" data-draft-id="7589082912588677163" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Midscene v1.0 发布 - 视觉驱动，UI 自动化体验跃迁"/> <meta itemprop="keywords" content="前端,客户端,人工智能"/> <meta itemprop="datePublished" content="2025-12-29T11:15:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="字节跳动开源"/> <meta itemprop="url" content="https://juejin.cn/user/1227510999971086"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Midscene v1.0 发布 - 视觉驱动，UI 自动化体验跃迁
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1227510999971086/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    字节跳动开源
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T11:15:53.000Z" title="Mon Dec 29 2025 11:15:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>文章来源｜ByteDance Web Infra 团队</p>
</blockquote>
<p>Midscene 自 2024 年开源发布以来，已经在 Github 斩获 11k star 、Trending 榜第二名等成绩，并在互联网、金融、政企、汽车等大量应用场景下完成落地。</p>
<p>本月，我们正式宣布 Midscene v1.0 发布！本文将为你介绍：</p>
<ul>
<li>案例回顾：Midscene 在 PC、Android、iOS 等场景的任务能力；</li>
<li>社区案例：社区开发者基于 Midscene 与任意界面集成的特性，扩展了机械臂 + 视觉模型 + 语音模型等模块，完成车机测试；</li>
<li>1.0 版本的模型路线：拥抱纯视觉；</li>
<li>1.0 版本的特性优化：报告优化、MCP 架构、跨端增强、API 变更等。</li>
</ul>
<h2 data-id="heading-0">案例回顾</h2>
<h4 data-id="heading-1">社区案例：视觉模型 + 机械臂</h4>
<p>演示视频请在公众号查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F24rFtAfihEos6f1u83jeLg" target="_blank" title="https://mp.weixin.qq.com/s/24rFtAfihEos6f1u83jeLg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/24rFtAfih…</a></p>
<p>有社区开发者成功基于 Midscene 与任意界面集成的特性，扩展了机械臂 + 视觉模型 + 语音模型等模块，运用于车机大屏测试场景中。</p>
<h4 data-id="heading-2">移动端案例：外卖下单</h4>
<p>打开美团，帮我下单一杯 manner 超大杯冰美式咖啡，要加浓少冰喔，到结算页面让我确认。</p>
<p>演示视频请在公众号查看：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F24rFtAfihEos6f1u83jeLg" target="_blank" title="https://mp.weixin.qq.com/s/24rFtAfihEos6f1u83jeLg" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/24rFtAfih…</a></p>
<p>在我们的 Midscene 官网上，还有更多实战案例：</p>
<ol>
<li>iOS 自动化 - Twitter 自动点赞 @midscene_ai 首条推文；</li>
<li>Android 自动化 - 懂车帝查看小米 SU7 参数；</li>
<li>Android 自动化 - Booking 预订圣诞酒店；</li>
<li>MCP 集成 - Midscene MCP 操作界面发布 prepatch 版本。</li>
</ol>
<h2 data-id="heading-3">1.0 版本的模型路线</h2>
<p>从 V1.0 开始，Midscene 全面转向视觉理解方案，提供更稳定可靠的 UI 自动化能力。</p>
<p>视觉模型有以下特点：</p>
<ul>
<li>
<p><strong>效果稳定</strong> ：业界领先的视觉模型（如 Doubao Seed 1.6、Qwen3-VL 等）表现足够稳定，已经可以满足大多数业务需求；</p>
</li>
<li>
<p><strong>UI 操作规划</strong> ：视觉模型通常具备较强的 UI 操作规划能力，能够完成不少复杂的任务流程；</p>
</li>
<li>
<p><strong>适用于任意系统</strong> ：自动化框架不再依赖 UI 渲染的技术栈，无论是 Android、iOS、桌面应用，还是浏览器中的 <code>&lt;canvas&gt;</code>，只要能获取截图，Midscene 即可完成交互操作；</p>
</li>
<li>
<p><strong>易于编写</strong> ：抛弃各类 selector 和 DOM 之后，开发者与模型的“磨合”会变得更简单，不熟悉渲染技术的新人也能很快上手；</p>
</li>
<li>
<p><strong>token 量显著下降</strong> ：在去除 DOM 提取之后，视觉方案的 token 使用量可以减少 80%，成本更低，且本地运行速度也变得更快</p>
</li>
<li>
<p><strong>有开源模型解决方案</strong> ：开源模型表现渐佳，开发者开始有机会进行私有化部署模型，如 Qwen3-VL 提供的 8B、30B 等版本在不少项目中都有着不错的效果。</p>
</li>
</ul>
<p>详情请阅读我们更新版的<strong>模型策略[1]。</strong></p>
<h2 data-id="heading-4">🚀 多模型组合，为复杂任务带来更好效果</h2>
<p>除了默认的交互场景，Midscene 还定义了 Planning（规划）和 Insight（洞察）两种意图，开发者可以按需为它们启用独立的模型。例如，用 GPT 模型做规划，同时使用默认的 Doubao 模型做元素定位。</p>
<p>多模型组合让开发者可以按需提升复杂需求的处理能力。</p>
<h2 data-id="heading-5">🚀 运行时架构优化</h2>
<p>针对 Midscene 的运行时表现，我们进行了以下优化：</p>
<ul>
<li>减少对设备信息接口的调用，在确保安全的情况下复用部分上下文信息，提升运行时性能，让大多数的时间消耗集中在模型端；</li>
<li>优化 Web 及移动端环境下的 Action Space 组合，向模型开放更合理、更清晰的工具集。</li>
</ul>
<h2 data-id="heading-6">🚀 回放报告优化</h2>
<p>回放报告是 Midscene 开发者非常依赖的一个特性，它能有效提升脚本的调试效率。</p>
<p>在 v1.0 中，我们更新了回放报告：</p>
<ul>
<li>参数视图：标记出交互参数的位置信息，合并截图信息，快速识别模型的规划结果；</li>
<li>样式调整：支持以深色模式展示报告，更美观；</li>
<li>Token 消耗的展示：支持按模型汇总 Token 消耗量，分析不同场景的成本情况。</li>
</ul>
<h2 data-id="heading-7">🚀 MCP 架构重构</h2>
<p>我们重新定义了 Midscene MCP 服务的定位。Midscene MCP 的职责是围绕着视觉驱动的 UI 操作展开，将 iOS / Android / Web 设备 Action Space 中的每个 Action 操作暴露为 MCP 工具，也就是提供各类“原子操作”。</p>
<p>通过这种形式，开发者可以更专注于构建自己的高阶 Agent，而无需关心底层 UI 操作的实现细节，并且时刻获得满意的成功率。</p>
<p>详情请阅读 <strong>MCP 文档[2]。</strong></p>
<h2 data-id="heading-8">🚀 移动端能力增强</h2>
<p><strong>iOS 改进</strong></p>
<ul>
<li>
<p>新增 WebDriverAgent 5.x-7.x 全版本兼容；</p>
</li>
<li>
<p>新增 WebDriver Clear API 支持，解决动态输入框问题；</p>
</li>
<li>
<p>提升设备兼容性。</p>
</li>
</ul>
<p><strong>Android 改进</strong></p>
<ul>
<li>
<p>新增截图轮询回退机制，提升远程设备稳定性；</p>
</li>
<li>
<p>新增屏幕方向自动适配（displayId 截图）；</p>
</li>
<li>
<p>新增 YAML 脚本 <code>runAdbShell</code> 支持。</p>
</li>
</ul>
<p><strong>跨平台</strong></p>
<ul>
<li>在 Agent 实例上暴露系统操作接口，包括 Home、Back、RecentApp 等。</li>
</ul>
<h2 data-id="heading-9">🚧 API 变更</h2>
<p>方法重命名（向后兼容）：</p>
<ul>
<li>
<p>改名 <code>aiAction()</code> → <code>aiAct()</code>（旧方法保留，有弃用警告）；</p>
</li>
<li>
<p>改名 <code>logScreenshot()</code> → <code>recordToReport()</code>（旧方法保留，有弃用警告）。</p>
</li>
</ul>
<p>环境变量重命名（向后兼容）：</p>
<ul>
<li>改名 <code>OPENAI_API_KEY</code> → <code>MODEL_API_KEY</code>（新变量优先，旧变量作为备选）；</li>
<li>改名 <code>OPENAI_BASE_URL</code> → <code>MODEL_BASE_URL</code>（新变量优先，旧变量作为备选）。</li>
</ul>
<h2 data-id="heading-10">⬆️ 升级到最新版</h2>
<p>升级项目中的依赖，例如：</p>
<ul>
<li>
<p><code>npm install @midscene/web@latest --save-dev</code>；</p>
</li>
<li>
<p><code>npm install @midscene/android@latest --save-dev</code>；</p>
</li>
<li>
<p><code>npm install @midscene/ios@latest --save-dev</code>。</p>
</li>
</ul>
<p>如果使用全局安装的命令行版本：<code>npm i -g @midscene/cli</code>。</p>
<p><strong>了解更多</strong></p>
<ul>
<li>
<p>Midscene.js <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2F" title="https://midscenejs.com/" target="_blank" ref="nofollow noopener noreferrer">midscenejs.com</a></p>
</li>
<li>
<p>Github <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fweb-infra-dev%2Fmidscene" title="https://github.com/web-infra-dev/midscene" target="_blank" ref="nofollow noopener noreferrer">github.com/web-infra-d…</a></p>
</li>
<li>
<p>1.0 版本 Changelog <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2Fzh%2Fchangelog.html" title="https://midscenejs.com/zh/changelog.html" target="_blank" ref="nofollow noopener noreferrer">midscenejs.com/zh/changelo…</a></p>
</li>
</ul>
<p><strong>参考资料</strong></p>
<p>[1] 模型策略: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2Fzh%2Fmodel-strategy" target="_blank" title="https://midscenejs.com/zh/model-strategy" ref="nofollow noopener noreferrer"><em>https://midscenejs.com/zh/model-strategy</em></a></p>
<p>[2] MCP 文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fmidscenejs.com%2Fzh%2Fmcp" target="_blank" title="https://midscenejs.com/zh/mcp" ref="nofollow noopener noreferrer"><em>https://midscenejs.com/zh/mcp</em></a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringSecurity、shiro 和 sa-token，到底选哪个？]]></title>    <link>https://juejin.cn/post/7589052659436077102</link>    <guid>https://juejin.cn/post/7589052659436077102</guid>    <pubDate>2025-12-29T11:40:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589052659436077102" data-draft-id="7589107312112795657" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringSecurity、shiro 和 sa-token，到底选哪个？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T11:40:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringSecurity、shiro 和 sa-token，到底选哪个？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T11:40:00.000Z" title="Mon Dec 29 2025 11:40:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>今天我们来聊聊一个让很多Java开发者纠结的技术选型问题：<strong>Spring Security、Apache Shiro和Sa-Token，这3个主流安全框架到底该选哪个？</strong></p>
<p>有些小伙伴在工作中可能遇到过这样的场景：新项目启动会上，架构师坚持要用Spring Security，团队里的老将却说Shiro更简单实用，而年轻的同事则力荐Sa-Token这个后起之秀。</p>
<p>大家各执一词，都有道理，到底该听谁的？</p>
<p>今天这篇文章就跟大家一起聊聊这个话题，希望对你会有所帮助。</p>
<p><a href="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" title="https://link.juejin.cn/?target=http%3A%2F%2Fsusan.net.cn%2Fproject" target="_blank">更多项目实战在我的技术网站：www.susan.net.cn/project</a></p>
<h2 data-id="heading-1">1 我们为什么需要安全框架？</h2>
<p>在深入对比之前，我们先要理解：<strong>为什么不能自己手写安全逻辑，而非要用框架？</strong></p>
<p>想象一下，如果你要为一个电商系统实现权限控制，你需要处理：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 手写权限控制的典型痛点</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ManualSecurityExample</span> {
    
    <span class="hljs-comment">// 1. 每个方法都要写重复的权限校验</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProduct</span><span class="hljs-params">(Long productId, ProductDTO dto)</span> {
        <span class="hljs-comment">// 检查用户是否登录</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getCurrentUser();
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"请先登录"</span>);
        }
        
        <span class="hljs-comment">// 检查用户是否有编辑权限</span>
        <span class="hljs-keyword">if</span> (!user.hasPermission(<span class="hljs-string">"product:update"</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"没有操作权限"</span>);
        }
        
        <span class="hljs-comment">// 检查是否是自己的商品（数据级权限）</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.getById(productId);
        <span class="hljs-keyword">if</span> (!product.getOwnerId().equals(user.getId())) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"只能修改自己的商品"</span>);
        }
        
        <span class="hljs-comment">// 实际业务逻辑...</span>
        productService.update(productId, dto);
    }
    
    <span class="hljs-comment">// 2. 每个Controller都要写登录检查</span>
    <span class="hljs-comment">// 3. 需要自己管理Session/Token</span>
    <span class="hljs-comment">// 4. 密码加密、CSRF防护都要自己实现</span>
    <span class="hljs-comment">// 5. 审计日志、安全事件处理...</span>
}
</code></pre>
<p>看到问题了吗？</p>
<p><strong>安全逻辑会像“幽灵代码”一样渗透到业务的每个角落</strong>，导致：</p>
<ul>
<li>代码重复率高</li>
<li>业务逻辑和安全逻辑耦合</li>
<li>难以统一维护和升级</li>
<li>容易遗漏安全防护点</li>
</ul>
<p><strong>安全框架的价值，就是把这些问题抽象化、标准化、自动化</strong>。</p>
<p>下面这个示意图展示了安全框架如何将安全关注点从业务代码中解耦出来：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0366f78d9f5e4a27a5e1e245e7ee8828~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=JaKTSsFw7MeIDMpHlJXYEmKV8vI%3D" alt="" loading="lazy"/></p>
<p>理解了安全框架的价值，接下来我们深入分析这三个主流选项。</p>
<h2 data-id="heading-2">2 Spring Security：企业级的安全“瑞士军刀”</h2>
<h3 data-id="heading-3">2.1 Spring Security是什么？</h3>
<p>Spring Security是Spring官方提供的安全框架，可以说是Spring生态中的“御林军”。</p>
<p>它不仅仅是一个权限控制框架，更是一个<strong>全面的安全解决方案</strong>。</p>
<h3 data-id="heading-4">2.2 核心架构：过滤器链的极致运用</h3>
<p>Spring Security的核心是<strong>过滤器链（Filter Chain）</strong>。</p>
<p>当一个请求到达时，它会经过一系列安全过滤器，每个过滤器负责特定的安全功能：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58db504b58584a86acd2d280558295e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=1oC89Wpf2wMHU%2BLx41FEoKV1l%2BU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-5">2.3 快速搭建一个安全的REST API</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 基础配置类</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@EnableWebSecurity</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringSecurityConfig</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WebSecurityConfigurerAdapter</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configure</span><span class="hljs-params">(HttpSecurity http)</span> <span class="hljs-keyword">throws</span> Exception {
        http
            <span class="hljs-comment">// 禁用CSRF（REST API通常不需要）</span>
            .csrf().disable()
            
            <span class="hljs-comment">// 授权配置</span>
            .authorizeRequests()
                .antMatchers(<span class="hljs-string">"/api/public/**"</span>).permitAll()  <span class="hljs-comment">// 公开接口</span>
                .antMatchers(<span class="hljs-string">"/api/admin/**"</span>).hasRole(<span class="hljs-string">"ADMIN"</span>)  <span class="hljs-comment">// 需要管理员角色</span>
                .antMatchers(<span class="hljs-string">"/api/user/**"</span>).hasAnyRole(<span class="hljs-string">"USER"</span>, <span class="hljs-string">"ADMIN"</span>)  <span class="hljs-comment">// 需要用户角色</span>
                .anyRequest().authenticated()  <span class="hljs-comment">// 其他所有请求需要认证</span>
            
            <span class="hljs-comment">// 表单登录配置（前后端分离时通常用不上）</span>
            .and()
            .formLogin().disable()
            
            <span class="hljs-comment">// 基础认证配置</span>
            .httpBasic()
            
            <span class="hljs-comment">// 异常处理</span>
            .and()
            .exceptionHandling()
                .authenticationEntryPoint(restAuthenticationEntryPoint())  <span class="hljs-comment">// 未认证处理</span>
                .accessDeniedHandler(restAccessDeniedHandler());  <span class="hljs-comment">// 权限不足处理</span>
    }
    
    <span class="hljs-comment">// 2. 用户详情服务（从数据库加载用户）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> UserDetailsService <span class="hljs-title function_">userDetailsService</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> username -&gt; {
            <span class="hljs-comment">// 这里实际应该查询数据库</span>
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"admin"</span>.equals(username)) {
                <span class="hljs-keyword">return</span> User.withUsername(<span class="hljs-string">"admin"</span>)
                    .password(passwordEncoder().encode(<span class="hljs-string">"admin123"</span>))
                    .roles(<span class="hljs-string">"ADMIN"</span>)
                    .build();
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"user"</span>.equals(username)) {
                <span class="hljs-keyword">return</span> User.withUsername(<span class="hljs-string">"user"</span>)
                    .password(passwordEncoder().encode(<span class="hljs-string">"user123"</span>))
                    .roles(<span class="hljs-string">"USER"</span>)
                    .build();
            }
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UsernameNotFoundException</span>(<span class="hljs-string">"用户不存在: "</span> + username);
        };
    }
    
    <span class="hljs-comment">// 3. 密码编码器</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> PasswordEncoder <span class="hljs-title function_">passwordEncoder</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BCryptPasswordEncoder</span>();
    }
    
    <span class="hljs-comment">// 4. REST API认证入口点</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> AuthenticationEntryPoint <span class="hljs-title function_">restAuthenticationEntryPoint</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> (request, response, authException) -&gt; {
            response.setContentType(MediaType.APPLICATION_JSON_VALUE);
            response.setStatus(HttpStatus.UNAUTHORIZED.value());
            response.getWriter().write(
                <span class="hljs-string">"{\"code\": 401, \"message\": \"未认证，请先登录\"}"</span>
            );
        };
    }
}

<span class="hljs-comment">// 5. 在Controller中使用安全注解</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductController</span> {
    
    <span class="hljs-meta">@GetMapping("/public/products")</span>
    <span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title function_">getPublicProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 公开接口，无需认证</span>
        <span class="hljs-keyword">return</span> productService.getAllProducts();
    }
    
    <span class="hljs-meta">@GetMapping("/user/products")</span>
    <span class="hljs-meta">@PreAuthorize("hasRole('USER')")</span>  <span class="hljs-comment">// 需要USER角色</span>
    <span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title function_">getUserProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前认证用户</span>
        <span class="hljs-type">Authentication</span> <span class="hljs-variable">auth</span> <span class="hljs-operator">=</span> SecurityContextHolder.getContext().getAuthentication();
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> auth.getName();
        
        <span class="hljs-keyword">return</span> productService.getProductsByOwner(username);
    }
    
    <span class="hljs-meta">@PostMapping("/admin/products")</span>
    <span class="hljs-meta">@PreAuthorize("hasRole('ADMIN')")</span>  <span class="hljs-comment">// 需要ADMIN角色</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">createProduct</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProductDTO dto)</span> {
        <span class="hljs-keyword">return</span> productService.createProduct(dto);
    }
    
    <span class="hljs-meta">@DeleteMapping("/admin/products/{id}")</span>
    <span class="hljs-meta">@PreAuthorize("hasPermission(#id, 'product', 'delete')")</span>  <span class="hljs-comment">// 方法级权限控制</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteProduct</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        productService.deleteProduct(id);
    }
}
</code></pre>
<h3 data-id="heading-6">Spring Security的优势与痛点</h3>
<p><strong>优势：</strong></p>
<ol>
<li><strong>Spring生态原生支持</strong>：与Spring Boot、Spring Cloud无缝集成</li>
<li><strong>功能全面</strong>：认证、授权、防护（CSRF、CORS、点击劫持等）一应俱全</li>
<li><strong>高度可定制</strong>：几乎每个组件都可以自定义或替换</li>
<li><strong>社区强大</strong>：Spring官方维护，文档完善，社区活跃</li>
<li><strong>企业级特性</strong>：OAuth2、SAML、LDAP等企业级集成支持</li>
</ol>
<p><strong>痛点：</strong></p>
<ol>
<li><strong>学习曲线陡峭</strong>：概念复杂，配置繁琐</li>
<li><strong>过度设计感</strong>：简单需求也需要复杂配置</li>
<li><strong>调试困难</strong>：过滤器链复杂，问题定位困难</li>
<li><strong>性能开销</strong>：完整的过滤器链带来一定性能损失</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>大型企业级应用</li>
<li>需要与Spring生态深度集成的项目</li>
<li>需要OAuth2、LDAP等企业级认证协议的项目</li>
<li>团队有Spring Security经验的场景</li>
</ul>
<p>有些小伙伴刚开始学Spring Security时，可能会被它复杂的概念搞晕，比如：<code>SecurityContext</code>、<code>Authentication</code>、<code>UserDetails</code>、<code>GrantedAuthority</code>等等。</p>
<p>但一旦掌握了它的设计哲学，你会发现它真的很强大。</p>
<h2 data-id="heading-7">3 Apache Shiro：简单直观的“轻骑兵”</h2>
<h3 data-id="heading-8">3.1 Shiro是什么？</h3>
<p>Apache Shiro是一个功能强大且易于使用的Java安全框架，它的设计哲学是：<strong>简化应用安全，让安全变得更简单</strong>。</p>
<p>如果说Spring Security是重型坦克，那么Shiro就是灵活机动的轻骑兵。</p>
<h3 data-id="heading-9">3.2 核心架构：四大核心概念</h3>
<p>Shiro的架构围绕四个核心概念构建：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c09f44fd817149d59381c390cbde4d5b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=s8iIMYEWyFWNIkM7mUBx4U4h%2Fto%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">3.3 快速实现基于URL的权限控制</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. Shiro配置类</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShiroConfig</span> {
    
    <span class="hljs-comment">// 创建ShiroFilterFactoryBean</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> ShiroFilterFactoryBean <span class="hljs-title function_">shiroFilterFactoryBean</span><span class="hljs-params">(
            SecurityManager securityManager)</span> {
        <span class="hljs-type">ShiroFilterFactoryBean</span> <span class="hljs-variable">factoryBean</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ShiroFilterFactoryBean</span>();
        factoryBean.setSecurityManager(securityManager);
        
        <span class="hljs-comment">// 设置登录页面</span>
        factoryBean.setLoginUrl(<span class="hljs-string">"/login"</span>);
        <span class="hljs-comment">// 设置未授权页面</span>
        factoryBean.setUnauthorizedUrl(<span class="hljs-string">"/unauthorized"</span>);
        
        <span class="hljs-comment">// 配置拦截规则</span>
        Map&lt;String, String&gt; filterChainDefinitionMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
        
        <span class="hljs-comment">// 静态资源放行</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/static/**"</span>, <span class="hljs-string">"anon"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/css/**"</span>, <span class="hljs-string">"anon"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/js/**"</span>, <span class="hljs-string">"anon"</span>);
        
        <span class="hljs-comment">// 公开接口</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/public/**"</span>, <span class="hljs-string">"anon"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/login"</span>, <span class="hljs-string">"anon"</span>);
        
        <span class="hljs-comment">// 需要认证的接口</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/user/**"</span>, <span class="hljs-string">"authc"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/admin/**"</span>, <span class="hljs-string">"authc, roles[admin]"</span>);
        
        <span class="hljs-comment">// 需要特定权限的接口</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/products/create"</span>, <span class="hljs-string">"authc, perms[product:create]"</span>);
        filterChainDefinitionMap.put(<span class="hljs-string">"/api/products/delete/*"</span>, <span class="hljs-string">"authc, perms[product:delete]"</span>);
        
        <span class="hljs-comment">// 其他所有请求需要认证</span>
        filterChainDefinitionMap.put(<span class="hljs-string">"/**"</span>, <span class="hljs-string">"authc"</span>);
        
        factoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);
        <span class="hljs-keyword">return</span> factoryBean;
    }
    
    <span class="hljs-comment">// 创建SecurityManager</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SecurityManager <span class="hljs-title function_">securityManager</span><span class="hljs-params">()</span> {
        <span class="hljs-type">DefaultWebSecurityManager</span> <span class="hljs-variable">securityManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultWebSecurityManager</span>();
        
        <span class="hljs-comment">// 设置Realm</span>
        securityManager.setRealm(customRealm());
        
        <span class="hljs-comment">// 设置Session管理器</span>
        securityManager.setSessionManager(sessionManager());
        
        <span class="hljs-comment">// 设置缓存管理器</span>
        securityManager.setCacheManager(cacheManager());
        
        <span class="hljs-keyword">return</span> securityManager;
    }
    
    <span class="hljs-comment">// 自定义Realm（连接安全数据源）</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> Realm <span class="hljs-title function_">customRealm</span><span class="hljs-params">()</span> {
        <span class="hljs-type">CustomRealm</span> <span class="hljs-variable">realm</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomRealm</span>();
        
        <span class="hljs-comment">// 设置密码匹配器</span>
        <span class="hljs-type">HashedCredentialsMatcher</span> <span class="hljs-variable">credentialsMatcher</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashedCredentialsMatcher</span>();
        credentialsMatcher.setHashAlgorithmName(<span class="hljs-string">"SHA-256"</span>);
        credentialsMatcher.setHashIterations(<span class="hljs-number">1024</span>);
        credentialsMatcher.setStoredCredentialsHexEncoded(<span class="hljs-literal">false</span>);
        realm.setCredentialsMatcher(credentialsMatcher);
        
        <span class="hljs-comment">// 开启缓存</span>
        realm.setCachingEnabled(<span class="hljs-literal">true</span>);
        realm.setAuthenticationCachingEnabled(<span class="hljs-literal">true</span>);
        realm.setAuthenticationCacheName(<span class="hljs-string">"authenticationCache"</span>);
        realm.setAuthorizationCachingEnabled(<span class="hljs-literal">true</span>);
        realm.setAuthorizationCacheName(<span class="hljs-string">"authorizationCache"</span>);
        
        <span class="hljs-keyword">return</span> realm;
    }
}

<span class="hljs-comment">// 2. 自定义Realm实现</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomRealm</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AuthorizingRealm</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> UserService userService;
    
    <span class="hljs-comment">// 认证逻辑：验证用户身份</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> AuthenticationInfo <span class="hljs-title function_">doGetAuthenticationInfo</span><span class="hljs-params">(
            AuthenticationToken token)</span> <span class="hljs-keyword">throws</span> AuthenticationException {
        
        <span class="hljs-type">UsernamePasswordToken</span> <span class="hljs-variable">upToken</span> <span class="hljs-operator">=</span> (UsernamePasswordToken) token;
        <span class="hljs-type">String</span> <span class="hljs-variable">username</span> <span class="hljs-operator">=</span> upToken.getUsername();
        
        <span class="hljs-comment">// 从数据库查询用户</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findByUsername(username);
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnknownAccountException</span>(<span class="hljs-string">"用户不存在"</span>);
        }
        
        <span class="hljs-keyword">if</span> (!user.isEnabled()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DisabledAccountException</span>(<span class="hljs-string">"用户已被禁用"</span>);
        }
        
        <span class="hljs-comment">// 返回认证信息</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthenticationInfo</span>(
            user, <span class="hljs-comment">// 身份 principal</span>
            user.getPassword(), <span class="hljs-comment">// 凭证 credentials</span>
            getName() <span class="hljs-comment">// realm name</span>
        );
    }
    
    <span class="hljs-comment">// 授权逻辑：获取用户的角色和权限</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> AuthorizationInfo <span class="hljs-title function_">doGetAuthorizationInfo</span><span class="hljs-params">(
            PrincipalCollection principals)</span> {
        
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> (User) principals.getPrimaryPrincipal();
        <span class="hljs-type">SimpleAuthorizationInfo</span> <span class="hljs-variable">authorizationInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleAuthorizationInfo</span>();
        
        <span class="hljs-comment">// 添加角色</span>
        Set&lt;String&gt; roles = userService.findRolesByUserId(user.getId());
        authorizationInfo.setRoles(roles);
        
        <span class="hljs-comment">// 添加权限</span>
        Set&lt;String&gt; permissions = userService.findPermissionsByUserId(user.getId());
        authorizationInfo.setStringPermissions(permissions);
        
        <span class="hljs-keyword">return</span> authorizationInfo;
    }
}

<span class="hljs-comment">// 3. 在Controller中使用Shiro</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductController</span> {
    
    <span class="hljs-meta">@GetMapping("/products")</span>
    <span class="hljs-keyword">public</span> List&lt;Product&gt; <span class="hljs-title function_">getProducts</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前用户</span>
        <span class="hljs-type">Subject</span> <span class="hljs-variable">currentUser</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();
        
        <span class="hljs-comment">// 检查是否已认证</span>
        <span class="hljs-keyword">if</span> (!currentUser.isAuthenticated()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnauthorizedException</span>(<span class="hljs-string">"请先登录"</span>);
        }
        
        <span class="hljs-comment">// 检查是否有权限</span>
        <span class="hljs-keyword">if</span> (!currentUser.isPermitted(<span class="hljs-string">"product:view"</span>)) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ForbiddenException</span>(<span class="hljs-string">"没有查看权限"</span>);
        }
        
        <span class="hljs-comment">// 执行业务逻辑</span>
        <span class="hljs-keyword">return</span> productService.getAllProducts();
    }
    
    <span class="hljs-meta">@PostMapping("/products")</span>
    <span class="hljs-keyword">public</span> Product <span class="hljs-title function_">createProduct</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProductDTO dto)</span> {
        <span class="hljs-type">Subject</span> <span class="hljs-variable">currentUser</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();
        
        <span class="hljs-comment">// 使用Shiro的权限注解（需要AOP支持）</span>
        currentUser.checkPermission(<span class="hljs-string">"product:create"</span>);
        
        <span class="hljs-comment">// 或者使用编程式检查</span>
        <span class="hljs-comment">// if (!currentUser.isPermitted("product:create")) {</span>
        <span class="hljs-comment">//     throw new ForbiddenException("没有创建权限");</span>
        <span class="hljs-comment">// }</span>
        
        <span class="hljs-keyword">return</span> productService.createProduct(dto);
    }
    
    <span class="hljs-meta">@GetMapping("/admin/dashboard")</span>
    <span class="hljs-keyword">public</span> DashboardVO <span class="hljs-title function_">getAdminDashboard</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Subject</span> <span class="hljs-variable">currentUser</span> <span class="hljs-operator">=</span> SecurityUtils.getSubject();
        
        <span class="hljs-comment">// 检查是否具有admin角色</span>
        currentUser.checkRole(<span class="hljs-string">"admin"</span>);
        
        <span class="hljs-keyword">return</span> dashboardService.getAdminDashboard();
    }
}
</code></pre>
<h3 data-id="heading-11">Shiro的优势与痛点</h3>
<p><strong>优势：</strong></p>
<ol>
<li><strong>简单直观</strong>：API设计简洁，学习成本低</li>
<li><strong>配置灵活</strong>：支持INI、XML、注解等多种配置方式</li>
<li><strong>功能完整</strong>：认证、授权、会话管理、加密、缓存等一应俱全</li>
<li><strong>不依赖容器</strong>：可以在任何Java环境中运行</li>
<li><strong>易于集成</strong>：与Spring、Spring Boot等框架集成简单</li>
</ol>
<p><strong>痛点：</strong></p>
<ol>
<li><strong>Spring生态整合不够原生</strong>：需要额外配置</li>
<li><strong>社区活跃度下降</strong>：相比Spring Security，社区维护力度减弱</li>
<li><strong>功能扩展性有限</strong>：某些高级功能需要自己实现</li>
<li><strong>文档相对陈旧</strong>：部分文档更新不及时</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>中小型项目，追求快速开发</li>
<li>非Spring项目或Spring生态不重的项目</li>
<li>团队对Spring Security不熟悉</li>
<li>需要简单权限控制的内部系统</li>
</ul>
<p>有些小伙伴喜欢Shiro的简洁，特别是它的INI配置文件，几行配置就能搞定基本的权限控制。</p>
<p>但当你需要更复杂的功能时，可能会发现需要自己写不少代码。</p>
<p>最近为了帮助大家找工作，专门建了一些工作内推群，各大城市都有，欢迎各位HR和找工作的小伙伴进群交流，群里目前已经收集了20多家大厂的工作内推岗位。加苏三的微信：li_su223，备注：掘金+所在城市，即可进群。</p>
<h2 data-id="heading-12">4 Sa-Token：国产新星的“后起之秀”</h2>
<h3 data-id="heading-13">4.1 Sa-Token是什么？</h3>
<p>Sa-Token是一个轻量级Java权限认证框架，由国内开发者开发。</p>
<p>它的设计理念是：<strong>以最少的配置，完成最全面的权限认证功能</strong>。</p>
<p>在Spring Security和Shiro之外，Sa-Token提供了一种新的选择。</p>
<h3 data-id="heading-14">4.2 核心特性：简单而强大</h3>
<p>Sa-Token的核心设计哲学可以概括为：“简单、强大、灵活”。</p>
<p>它通过几个核心组件实现了完整的安全控制：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d275a3bba404e29864406786b42dc4c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=7jBSQjBEqNiykOm7%2FrXRTTYONaI%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">4.3 5分钟搭建完整权限系统</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 添加依赖（pom.xml）</span>
<span class="hljs-comment">// &lt;dependency&gt;</span>
<span class="hljs-comment">//     &lt;groupId&gt;cn.dev33&lt;/groupId&gt;</span>
<span class="hljs-comment">//     &lt;artifactId&gt;sa-token-spring-boot-starter&lt;/artifactId&gt;</span>
<span class="hljs-comment">//     &lt;version&gt;1.34.0&lt;/version&gt;</span>
<span class="hljs-comment">// &lt;/dependency&gt;</span>

<span class="hljs-comment">// 2. 配置文件（application.yml）</span>
<span class="hljs-comment">// sa-token:</span>
<span class="hljs-comment">//   token-name: satoken           # token名称</span>
<span class="hljs-comment">//   timeout: 2592000             # token有效期，单位秒，默认30天</span>
<span class="hljs-comment">//   active-timeout: -1           # token活跃有效期，-1代表不限制</span>
<span class="hljs-comment">//   is-concurrent: true          # 是否允许并发登录</span>
<span class="hljs-comment">//   is-share: true               # 在多人登录同一账号时，是否共享token</span>
<span class="hljs-comment">//   max-login-count: 12          # 同一账号最大登录数量</span>
<span class="hljs-comment">//   is-write-header: true        # 是否将token写入响应头</span>
<span class="hljs-comment">//   token-style: uuid            # token风格</span>
<span class="hljs-comment">//   is-log: false                # 是否打印操作日志</span>

<span class="hljs-comment">// 3. 配置类（可选）</span>
<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaTokenConfig</span> {
    
    <span class="hljs-comment">// 注册拦截器</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> SaInterceptor <span class="hljs-title function_">saInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SaInterceptor</span>()
            <span class="hljs-comment">// 校验登录状态，不包含登录接口</span>
            .addPathPatterns(<span class="hljs-string">"/**"</span>)
            .excludePathPatterns(<span class="hljs-string">"/api/user/login"</span>)
            .excludePathPatterns(<span class="hljs-string">"/api/public/**"</span>)
            
            <span class="hljs-comment">// 权限校验规则</span>
            .check(r -&gt; {
                <span class="hljs-comment">// 1. 检查登录状态</span>
                SaRouter.match(<span class="hljs-string">"/api/**"</span>, () -&gt; {
                    StpUtil.checkLogin();
                });
                
                <span class="hljs-comment">// 2. 角色校验</span>
                SaRouter.match(<span class="hljs-string">"/api/admin/**"</span>, () -&gt; {
                    StpUtil.checkRole(<span class="hljs-string">"admin"</span>);
                });
                
                <span class="hljs-comment">// 3. 权限校验</span>
                SaRouter.match(<span class="hljs-string">"/api/products/create"</span>, () -&gt; {
                    StpUtil.checkPermission(<span class="hljs-string">"product.create"</span>);
                });
                
                SaRouter.match(<span class="hljs-string">"/api/products/delete/**"</span>, () -&gt; {
                    StpUtil.checkPermission(<span class="hljs-string">"product.delete"</span>);
                });
            });
    }
}

<span class="hljs-comment">// 4. 登录认证Controller</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/user")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
    
    <span class="hljs-meta">@PostMapping("/login")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">login</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> LoginDTO dto)</span> {
        <span class="hljs-comment">// 1. 验证用户名密码</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findByUsername(dto.getUsername());
        <span class="hljs-keyword">if</span> (user == <span class="hljs-literal">null</span> || !passwordEncoder.matches(dto.getPassword(), user.getPassword())) {
            <span class="hljs-keyword">return</span> ApiResult.error(<span class="hljs-string">"用户名或密码错误"</span>);
        }
        
        <span class="hljs-comment">// 2. 登录（Sa-Token会自动创建token）</span>
        StpUtil.login(user.getId());
        
        <span class="hljs-comment">// 3. 获取token信息</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">tokenValue</span> <span class="hljs-operator">=</span> StpUtil.getTokenValue();
        <span class="hljs-type">long</span> <span class="hljs-variable">tokenTimeout</span> <span class="hljs-operator">=</span> StpUtil.getTokenTimeout();
        
        <span class="hljs-comment">// 4. 返回用户信息和token</span>
        <span class="hljs-type">LoginVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoginVO</span>();
        vo.setUserId(user.getId());
        vo.setUsername(user.getUsername());
        vo.setToken(tokenValue);
        vo.setExpireTime(tokenTimeout);
        
        <span class="hljs-comment">// 5. 可以设置一些session信息</span>
        StpUtil.getSession().set(<span class="hljs-string">"userInfo"</span>, user);
        
        <span class="hljs-keyword">return</span> ApiResult.success(<span class="hljs-string">"登录成功"</span>, vo);
    }
    
    <span class="hljs-meta">@PostMapping("/logout")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">logout</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 注销当前会话</span>
        StpUtil.logout();
        <span class="hljs-keyword">return</span> ApiResult.success(<span class="hljs-string">"注销成功"</span>);
    }
    
    <span class="hljs-meta">@GetMapping("/info")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 获取当前登录用户ID</span>
        <span class="hljs-type">Object</span> <span class="hljs-variable">loginId</span> <span class="hljs-operator">=</span> StpUtil.getLoginId();
        
        <span class="hljs-comment">// 获取用户信息</span>
        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userService.findById(Long.parseLong(loginId.toString()));
        
        <span class="hljs-comment">// 获取用户权限列表</span>
        List&lt;String&gt; permissionList = StpUtil.getPermissionList();
        
        <span class="hljs-comment">// 获取用户角色列表</span>
        List&lt;String&gt; roleList = StpUtil.getRoleList();
        
        <span class="hljs-type">UserInfoVO</span> <span class="hljs-variable">vo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfoVO</span>();
        vo.setUser(user);
        vo.setPermissions(permissionList);
        vo.setRoles(roleList);
        
        <span class="hljs-keyword">return</span> ApiResult.success(vo);
    }
}

<span class="hljs-comment">// 5. 业务Controller中使用</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api/products")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProductController</span> {
    
    <span class="hljs-meta">@GetMapping("/list")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">getProductList</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 无需手动检查登录状态，拦截器已处理</span>
        
        <span class="hljs-comment">// 获取当前登录用户ID</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> StpUtil.getLoginIdAsLong();
        
        List&lt;Product&gt; products = productService.getProductsByOwner(userId);
        <span class="hljs-keyword">return</span> ApiResult.success(products);
    }
    
    <span class="hljs-meta">@PostMapping("/create")</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">createProduct</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> ProductDTO dto)</span> {
        <span class="hljs-comment">// 使用注解方式检查权限</span>
        <span class="hljs-comment">// @SaCheckPermission("product.create") 也可以这样用</span>
        
        <span class="hljs-comment">// 编程式检查权限</span>
        StpUtil.checkPermission(<span class="hljs-string">"product.create"</span>);
        
        <span class="hljs-type">long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> StpUtil.getLoginIdAsLong();
        dto.setOwnerId(userId);
        
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.createProduct(dto);
        <span class="hljs-keyword">return</span> ApiResult.success(product);
    }
    
    <span class="hljs-meta">@DeleteMapping("/{id}")</span>
    <span class="hljs-meta">@SaCheckPermission("product.delete")</span>  <span class="hljs-comment">// 注解方式权限检查</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">deleteProduct</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long id)</span> {
        <span class="hljs-comment">// 除了权限检查，还可以检查数据权限</span>
        <span class="hljs-type">Product</span> <span class="hljs-variable">product</span> <span class="hljs-operator">=</span> productService.getById(id);
        <span class="hljs-type">long</span> <span class="hljs-variable">currentUserId</span> <span class="hljs-operator">=</span> StpUtil.getLoginIdAsLong();
        
        <span class="hljs-keyword">if</span> (product.getOwnerId() != currentUserId) {
            <span class="hljs-comment">// 不是自己的商品，检查是否有管理员权限</span>
            StpUtil.checkRole(<span class="hljs-string">"admin"</span>);
        }
        
        productService.deleteProduct(id);
        <span class="hljs-keyword">return</span> ApiResult.success(<span class="hljs-string">"删除成功"</span>);
    }
    
    <span class="hljs-meta">@GetMapping("/admin/dashboard")</span>
    <span class="hljs-meta">@SaCheckRole("admin")</span>  <span class="hljs-comment">// 注解方式角色检查</span>
    <span class="hljs-keyword">public</span> ApiResult <span class="hljs-title function_">getAdminDashboard</span><span class="hljs-params">()</span> {
        <span class="hljs-type">DashboardVO</span> <span class="hljs-variable">dashboard</span> <span class="hljs-operator">=</span> dashboardService.getAdminDashboard();
        <span class="hljs-keyword">return</span> ApiResult.success(dashboard);
    }
}

<span class="hljs-comment">// 6. 进阶功能：踢人下线、账号封禁</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdvancedSecurityService</span> {
    
    <span class="hljs-comment">// 强制注销（踢人下线）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">forceLogout</span><span class="hljs-params">(Object loginId)</span> {
        StpUtil.logout(loginId);
    }
    
    <span class="hljs-comment">// 封禁账号</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">disableAccount</span><span class="hljs-params">(Object loginId, <span class="hljs-type">long</span> disableTime)</span> {
        <span class="hljs-comment">// 封禁指定时间（单位：秒）</span>
        StpUtil.disable(loginId, disableTime);
    }
    
    <span class="hljs-comment">// 检查是否被封禁</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isDisabled</span><span class="hljs-params">(Object loginId)</span> {
        <span class="hljs-keyword">return</span> StpUtil.isDisable(loginId);
    }
    
    <span class="hljs-comment">// 二级认证（敏感操作需要再次验证）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">startSecondAuth</span><span class="hljs-params">(<span class="hljs-type">long</span> ttl)</span> {
        <span class="hljs-comment">// 开启二级认证，有效期为ttl秒</span>
        <span class="hljs-keyword">return</span> StpUtil.openSafe(ttl);
    }
    
    <span class="hljs-comment">// 检查二级认证</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">checkSecondAuth</span><span class="hljs-params">()</span> {
        StpUtil.checkSafe();
    }
}
</code></pre>
<h3 data-id="heading-16">Sa-Token的优势与痛点</h3>
<p><strong>优势：</strong></p>
<ol>
<li><strong>API设计极其简洁</strong>：<code>StpUtil.xxx()</code> 几乎涵盖了所有操作</li>
<li><strong>开箱即用</strong>：几乎零配置就能使用</li>
<li><strong>功能丰富</strong>：除了基础认证授权，还提供踢人下线、账号封禁、二级认证等高级功能</li>
<li><strong>国产框架</strong>：中文文档完善，符合国人使用习惯</li>
<li><strong>轻量级</strong>：依赖少，启动快</li>
</ol>
<p><strong>痛点：</strong></p>
<ol>
<li><strong>相对较新</strong>：生态不如Spring Security和Shiro成熟</li>
<li><strong>社区规模小</strong>：遇到复杂问题可能难以找到解决方案</li>
<li><strong>企业级特性有限</strong>：对OAuth2、LDAP等支持较弱</li>
<li><strong>过度封装</strong>：某些场景下灵活性不足</li>
</ol>
<p><strong>适用场景：</strong></p>
<ul>
<li>中小型项目，追求开发效率</li>
<li>团队对Spring Security/Shiro不熟悉</li>
<li>需要快速搭建权限系统的原型或内部工具</li>
<li>偏好国产框架和中文文档的团队</li>
</ul>
<p>有些小伙伴第一次用Sa-Token时，会被它的简洁惊艳到。几行代码就实现了其他框架需要大量配置的功能。</p>
<p>但对于大型复杂系统，可能需要仔细评估它的扩展性和长期维护性。</p>
<h2 data-id="heading-17">5 三大框架全方位对比</h2>
<p>了解了每个框架的单独特点后，我们来一个全方位的对比：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c659ee10212142dca4427b30d9d06a55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=sSb%2BHG2SL%2BGExFCQE2vL7X2g%2BAc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-18">5.1 详细对比表</h3>

































































<table><thead><tr><th>维度</th><th><strong>Spring Security</strong></th><th><strong>Apache Shiro</strong></th><th><strong>Sa-Token</strong></th></tr></thead><tbody><tr><td><strong>学习曲线</strong></td><td>陡峭 ⭐⭐⭐⭐⭐</td><td>中等 ⭐⭐⭐☆☆</td><td>平缓 ⭐⭐☆☆☆</td></tr><tr><td><strong>配置复杂度</strong></td><td>复杂 ⭐⭐⭐⭐⭐</td><td>中等 ⭐⭐⭐☆☆</td><td>简单 ⭐☆☆☆☆</td></tr><tr><td><strong>功能完整性</strong></td><td>全面 ⭐⭐⭐⭐⭐</td><td>完整 ⭐⭐⭐⭐☆</td><td>丰富 ⭐⭐⭐☆☆</td></tr><tr><td><strong>Spring生态集成</strong></td><td>原生 ⭐⭐⭐⭐⭐</td><td>良好 ⭐⭐⭐☆☆</td><td>良好 ⭐⭐⭐☆☆</td></tr><tr><td><strong>性能开销</strong></td><td>较高 ⭐⭐⭐☆☆</td><td>中等 ⭐⭐⭐☆☆</td><td>较低 ⭐⭐☆☆☆</td></tr><tr><td><strong>社区活跃度</strong></td><td>活跃 ⭐⭐⭐⭐⭐</td><td>一般 ⭐⭐⭐☆☆</td><td>增长 ⭐⭐⭐☆☆</td></tr><tr><td><strong>文档质量</strong></td><td>优秀（英文）⭐⭐⭐⭐⭐</td><td>良好 ⭐⭐⭐☆☆</td><td>优秀（中文）⭐⭐⭐⭐⭐</td></tr><tr><td><strong>扩展性</strong></td><td>强大 ⭐⭐⭐⭐⭐</td><td>良好 ⭐⭐⭐☆☆</td><td>一般 ⭐⭐⭐☆☆</td></tr><tr><td><strong>企业级特性</strong></td><td>丰富 ⭐⭐⭐⭐⭐</td><td>有限 ⭐⭐☆☆☆</td><td>有限 ⭐⭐☆☆☆</td></tr></tbody></table>
<h3 data-id="heading-19">5.2 技术特性详细对比</h3>



























































<table><thead><tr><th>特性</th><th>Spring Security</th><th>Apache Shiro</th><th>Sa-Token</th></tr></thead><tbody><tr><td><strong>认证方式</strong></td><td>表单、Basic、OAuth2、LDAP、SAML等</td><td>表单、Basic、CAS等</td><td>表单、自定义</td></tr><tr><td><strong>授权模型</strong></td><td>RBAC、ABAC、方法级、URL级</td><td>RBAC、URL级、方法级</td><td>RBAC、方法级</td></tr><tr><td><strong>会话管理</strong></td><td>支持，与Spring Session集成</td><td>强大，自带会话管理</td><td>支持，简单易用</td></tr><tr><td><strong>密码加密</strong></td><td>多种加密方式支持</td><td>多种加密方式支持</td><td>支持</td></tr><tr><td><strong>缓存支持</strong></td><td>需要自行集成Spring Cache</td><td>内置缓存支持</td><td>支持Redis等</td></tr><tr><td><strong>单点登录</strong></td><td>通过Spring Security OAuth2</td><td>需要额外模块</td><td>需要额外模块</td></tr><tr><td><strong>微服务支持</strong></td><td>优秀，与Spring Cloud GateWay集成</td><td>一般</td><td>支持</td></tr><tr><td><strong>监控管理</strong></td><td>与Spring Boot Actuator集成</td><td>需要自行实现</td><td>简单监控</td></tr></tbody></table>
<h2 data-id="heading-20">6 如何做出最佳选择？</h2>
<p>面对三个各有优劣的框架，如何做出最适合自己项目的选择？</p>
<p>我总结了一个决策流程图，帮助你在不同场景下做出明智决策：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ee998750388478c84fbd1b221a5ccd9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767613200&amp;x-signature=Bu0r3mNtagDvb1jQH%2BFTw0mhQrY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-21">6.1 具体场景建议</h3>
<h4 data-id="heading-22">场景一：大型电商平台（选择Spring Security）</h4>
<ul>
<li><strong>理由</strong>：需要完善的OAuth2社交登录、支付安全、风控系统</li>
<li><strong>实施要点</strong>：
<ol>
<li>使用Spring Security OAuth2 Client集成第三方登录</li>
<li>自定义安全过滤器实现风控逻辑</li>
<li>与Spring Cloud Gateway整合实现统一认证</li>
<li>使用Method Security注解实现细粒度权限控制</li>
</ol>
</li>
</ul>
<h4 data-id="heading-23">场景二：企业内部管理系统（选择Apache Shiro）</h4>
<ul>
<li><strong>理由</strong>：权限模型相对固定，需要快速开发，团队熟悉Shiro</li>
<li><strong>实施要点</strong>：
<ol>
<li>使用INI配置文件快速定义URL权限规则</li>
<li>集成Ehcache缓存权限数据提升性能</li>
<li>自定义Realm连接企业LDAP/AD域</li>
<li>利用Shiro标签在页面上控制元素显示</li>
</ol>
</li>
</ul>
<h4 data-id="heading-24">场景三：创业公司MVP产品（选择Sa-Token）</h4>
<ul>
<li><strong>理由</strong>：需要快速上线验证想法，团队规模小，追求开发效率</li>
<li><strong>实施要点</strong>：
<ol>
<li>利用Sa-Token的零配置特性快速搭建</li>
<li>使用注解方式实现基本权限控制</li>
<li>集成Redis实现分布式会话</li>
<li>利用Sa-Token的踢人功能实现基础管理</li>
</ol>
</li>
</ul>
<h4 data-id="heading-25">场景四：微服务架构系统（混合方案）</h4>
<ul>
<li><strong>理由</strong>：不同服务有不同的安全需求</li>
<li><strong>实施要点</strong>：
<ol>
<li><strong>网关层</strong>：Spring Security + OAuth2（统一认证）</li>
<li><strong>核心业务服务</strong>：Spring Security（细粒度控制）</li>
<li><strong>内部管理服务</strong>：Apache Shiro（简单权限）</li>
<li><strong>工具类微服务</strong>：Sa-Token（快速开发）</li>
</ol>
</li>
</ul>
<h3 data-id="heading-26">6.2 如果选错了怎么办？</h3>
<p>有些小伙伴可能会遇到这样的情况：项目初期选型不合适，随着业务发展需要迁移到其他框架。</p>
<p>这里提供一些迁移建议：</p>
<ol>
<li><strong>渐进式迁移</strong>：新旧框架并行，逐步替换</li>
<li><strong>抽象隔离层</strong>：创建统一的安全接口，底层实现可替换</li>
<li><strong>分模块迁移</strong>：按业务模块逐个迁移，降低风险</li>
<li><strong>充分测试</strong>：特别是边缘案例和权限组合场景</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 抽象安全接口示例</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SecurityService</span> {
    <span class="hljs-comment">// 认证相关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">login</span><span class="hljs-params">(String username, String password)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">logout</span><span class="hljs-params">()</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isAuthenticated</span><span class="hljs-params">()</span>;
    
    <span class="hljs-comment">// 授权相关</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasPermission</span><span class="hljs-params">(String permission)</span>;
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasRole</span><span class="hljs-params">(String role)</span>;
    
    <span class="hljs-comment">// 用户信息</span>
    Object <span class="hljs-title function_">getCurrentUser</span><span class="hljs-params">()</span>;
    Long <span class="hljs-title function_">getCurrentUserId</span><span class="hljs-params">()</span>;
}

<span class="hljs-comment">// Spring Security实现</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringSecurityServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SecurityService</span> {
    <span class="hljs-comment">// 实现基于Spring Security的接口</span>
}

<span class="hljs-comment">// 需要迁移时，只需实现新的实现类</span>
<span class="hljs-meta">@Service</span>  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SaTokenServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">SecurityService</span> {
    <span class="hljs-comment">// 实现基于Sa-Token的接口</span>
    <span class="hljs-comment">// 业务代码无需修改，只需切换实现</span>
}
</code></pre>
<h2 data-id="heading-27">总结</h2>
<p>经过深入分析，我们可以得出以下结论：</p>
<ol>
<li><strong>Spring Security</strong>是<strong>企业级重型武器</strong>，功能全面但复杂，适合大型项目和有经验的团队。</li>
<li><strong>Apache Shiro</strong>是<strong>灵活实用的轻骑兵</strong>，平衡了功能与复杂度，适合大多数中小型项目。</li>
<li><strong>Sa-Token</strong>是<strong>快速开发的利器</strong>，API简洁但生态相对年轻，适合追求开发效率的场景。</li>
</ol>
<p>实际上，<strong>没有完美的框架，只有合适的框架</strong>。</p>
<h2 data-id="heading-28">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p>
<p>更多项目实战在我的技术网站：<a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" title="https://link.juejin.cn?target=http%3A%2F%2Fwww.susan.net.cn%2Fproject" target="_blank">www.susan.net.cn/project</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Tomcat Connectors 1.2.32 源码编译安装教程（含 mod_jk 配置步骤）]]></title>    <link>https://juejin.cn/post/7589093939656507444</link>    <guid>https://juejin.cn/post/7589093939656507444</guid>    <pubDate>2025-12-29T11:43:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589093939656507444" data-draft-id="7589104492882673716" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Tomcat Connectors 1.2.32 源码编译安装教程（含 mod_jk 配置步骤）"/> <meta itemprop="keywords" content="Tomcat"/> <meta itemprop="datePublished" content="2025-12-29T11:43:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户613541146016"/> <meta itemprop="url" content="https://juejin.cn/user/1602431422584832"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Tomcat Connectors 1.2.32 源码编译安装教程（含 mod_jk 配置步骤）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1602431422584832/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户613541146016
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T11:43:36.000Z" title="Mon Dec 29 2025 11:43:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p><strong>1. 准备环境</strong></p>
<p>先装好这些东西：</p>
<ul>
<li><strong>Apache HTTP Server</strong>（就是 Apache）</li>
<li><strong>Tomcat</strong></li>
<li>编译器：<strong>gcc</strong>、<strong>make</strong></li>
<li>Java 开发环境（JDK）</li>
</ul>
<p>在 Ubuntu/Debian 上你可以这么装：</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install build<span class="hljs-operator">-</span>essential apache2 tomcat9 openjdk<span class="hljs-number">-11</span><span class="hljs-operator">-</span>jdk
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-0">2. 下载并解压源码</h3>
<p><strong>安装包下载：</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.quark.cn%2Fs%2F220ddde3d4ce" title="https://pan.quark.cn/s/220ddde3d4ce" target="_blank" ref="nofollow noopener noreferrer">pan.quark.cn/s/220ddde3d…</a>****，假设你已经下载了 <code>tomcat-connectors-1.2.32-src.tar.gz</code>：</p>
<pre><code class="hljs language-bash" lang="bash">tar -xzf tomcat-connectors-1.2.32-src.tar.gz
<span class="hljs-built_in">cd</span> tomcat-connectors-1.2.32-src/native
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">3. 设置环境变量</h3>
<p>要让编译知道 Apache 和 Tomcat 在哪，得设置几个变量：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-variable constant_">APACHE_HOME</span>=<span class="hljs-regexp">/usr/</span>local/apache2   # 或者你 <span class="hljs-title class_">Apache</span> 实际安装路径
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">TOMCAT_HOME</span>=<span class="hljs-regexp">/usr/</span>share/tomcat9   # 或者你 <span class="hljs-title class_">Tomcat</span> 的路径
<span class="hljs-keyword">export</span> <span class="hljs-variable constant_">JAVA_HOME</span>=<span class="hljs-regexp">/usr/</span>lib/jvm/java-<span class="hljs-number">11</span>-openjdk-amd64
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<blockquote>
<p>注意：路径要根据你自己系统实际情况改。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">4. 配置和编译</h3>
<p>进入 native 目录后执行：</p>
<pre><code class="hljs language-javascript" lang="javascript">./configure --<span class="hljs-keyword">with</span>-apxs=<span class="hljs-regexp">/usr/</span>bin/apxs2
make
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<ul>
<li><code>--with-apxs</code>是指定 apxs 工具的路径，一般在 <code>/usr/bin/apxs2</code>或 <code>/usr/bin/apxs</code></li>
<li>如果提示找不到 apxs，可以装：<code>sudo apt install apache2-dev</code></li>
</ul>
<hr/>
<h3 data-id="heading-3">5. 安装模块</h3>
<p>编译完会生成一个 <code>.so</code>文件（比如 <code>mod_jk.so</code>），把它复制到 Apache 的模块目录：</p>
<pre><code class="hljs language-bash" lang="bash">sudo <span class="hljs-built_in">cp</span> apache-2.0/mod_jk.so /usr/lib/apache2/modules/
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-4">6. 配置 Apache 加载 mod_jk</h3>
<p>编辑 Apache 配置文件（比如 <code>/etc/apache2/apache2.conf</code>或新建一个 <code>/etc/apache2/mods-available/jk.load</code>）：</p>
<pre><code class="hljs language-bash" lang="bash">LoadModule jk_module modules/mod_jk.so
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>然后启用模块：</p>
<pre><code class="hljs">sudo a2enmod jk
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-5">7. 配置 workers（告诉 Apache 怎么连 Tomcat）</h3>
<p>创建文件 <code>/etc/apache2/workers.properties</code>，内容类似：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">worker.list</span>=worker1
<span class="hljs-attr">worker.worker1.type</span>=ajp13
<span class="hljs-attr">worker.worker1.host</span>=localhost
<span class="hljs-attr">worker.worker1.port</span>=<span class="hljs-number">8009</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>再创建一个配置文件 <code>/etc/apache2/jk.conf</code>（或加到 apache2.conf 里）：</p>
<pre><code class="hljs language-bash" lang="bash">JkWorkersFile /etc/apache2/workers.properties
JkMount /* worker1
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-6">8. 重启 Apache 和 Tomcat</h3>
<pre><code class="hljs">sudo systemctl restart apache2
sudo systemctl restart tomcat9
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-7">9. 测试</h3>
<p>放个 JSP 页面到 Tomcat 的 webapps 目录下，比如 <code>test.jsp</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript">&lt;%= <span class="hljs-keyword">new</span> java.<span class="hljs-property">util</span>.<span class="hljs-title class_">Date</span>() %&gt;
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p>然后通过 Apache 访问：<code>http://你的服务器/test.jsp</code>，如果能显示时间，说明成功了。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据分析师的“水晶球”：时间序列分析]]></title>    <link>https://juejin.cn/post/7588680081326293034</link>    <guid>https://juejin.cn/post/7588680081326293034</guid>    <pubDate>2025-12-28T09:30:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588680081326293034" data-draft-id="7588152122187530294" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="数据分析师的“水晶球”：时间序列分析"/> <meta itemprop="keywords" content="Python,数据分析,数据挖掘"/> <meta itemprop="datePublished" content="2025-12-28T09:30:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            数据分析师的“水晶球”：时间序列分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T09:30:08.000Z" title="Sun Dec 28 2025 09:30:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多刚入行的小伙伴问我：“<em>我想预测下个月公司的销售额，或者预测一下明天的股价，该学什么？</em>”</p>
<p>我的回答通常只有六个字：<strong>时间序列分析</strong>。</p>
<p>如果在数据分析的世界里有一种魔法能让你“预知未来”，那一定就是它。</p>
<h2 data-id="heading-0">1. 什么是时间序列？</h2>
<p>别被名词吓到了。简单来说，<strong>时间序列（Time Series）就是按时间顺序排列的一组数据</strong>。</p>
<p>比如：</p>
<ul>
<li>你手机里每天的步数记录；</li>
<li>某只股票每天的收盘价；</li>
<li>或者是你家楼下便利店每个月的营业额。</li>
</ul>
<p>这些数据都有一个共同点：<strong>有一个时间轴，且数据随着时间变化。</strong></p>
<p>我们做<strong>时间序列分析</strong>的<strong>核心目的</strong>，就是要从过去的**“历史数据”<strong>中找出规律，然后把这个规律延长到</strong>“未来”<strong>，这就是</strong>预测**。</p>
<h2 data-id="heading-1">2. 像剥洋葱一样拆解数据：时间序列的四大成分</h2>
<p>初学者最容易犯的错误是直接把数据丢进模型里跑。</p>
<p>作为一名老手，我要告诉你：<strong>看到数据，先拆解。</strong></p>
<p>通常，任何一个随时间变化的数据（比如一家奶茶店的日销量），都可以被拆分为<strong>四个部分</strong>。</p>
<h3 data-id="heading-2">2.1. 长期趋势--“大势所趋”</h3>
<p>这是数据在长时间内的主要运动方向。</p>
<ul>
<li><strong>例子</strong>：这家奶茶店开了三年，随着品牌知名度提升，整体销量每年都在涨。这就是<strong>趋势</strong>。</li>
<li><strong>地位</strong>：它是总变动的老大，决定了长期的方向。</li>
</ul>
<h3 data-id="heading-3">2.2. 季节变动--“春夏秋冬的轮回”</h3>
<p>数据受季节、节假日等固定周期影响而出现的波动。</p>
<ul>
<li><strong>例子</strong>：夏天天气热，冰饮卖得疯快；冬天冷，销量自然下滑；每到周末销量就比周一高。这种随着时间固定重复的波动，就是<strong>季节性</strong>。</li>
<li><strong>地位</strong>：它是总变动的老二，非常规律，预测起来最准。</li>
</ul>
<h3 data-id="heading-4">2.3. 循环变动--“难以捉摸的周期”</h3>
<p>这是一些周期较长、不固定的波动，通常和宏观经济有关。</p>
<ul>
<li><strong>例子</strong>：由于经济危机，大家钱包紧了，奶茶喝得少了。等经济复苏，又喝多了。</li>
<li><strong>注意</strong>：这部分原因复杂，周期不固定，我们在基础预测中通常<strong>不做重点考虑</strong>。</li>
</ul>
<h3 data-id="heading-5">2.4. 不规则变动--“老天爷的心情”</h3>
<p>这是随机的、不可控的波动。</p>
<ul>
<li><strong>例子</strong>：某天突然下暴雨，没人出门，销量暴跌；或者某天网红来打卡，销量暴涨。</li>
<li><strong>注意</strong>：这是“噪音”，在预测中我们很难捕捉它，通常假设它为0或忽略。</li>
</ul>
<blockquote>
<p><strong>（重点）：</strong><br/>
在实际的时间序列预测中，我们主要抓 <strong>“长期趋势” 和 “季节变动”</strong>。</p>
<p>抓住了这两条大鱼，预测的准确度通常能达到80%以上。</p>
<p>至于循环变动和不规则变动，因为占比小且太复杂，我们往往选择战略性忽略。</p>
</blockquote>
<h2 data-id="heading-6">3. 手把手教你：用Python拆解时间序列</h2>
<p>光说不练假把式。下面我们用<code>Python</code>代码模拟一组奶茶店的销售数据，并演示如何把这四个成分“拆”出来。</p>
<p>首先，构造“虚假”的奶茶店数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># === 第一步：构造数据 ===</span>
<span class="hljs-comment"># 假设我们有过去3年（36个月）的月度销售数据</span>
dates = pd.date_range(start=<span class="hljs-string">'2021-01-01'</span>, periods=<span class="hljs-number">36</span>, freq=<span class="hljs-string">'ME'</span>)

<span class="hljs-comment"># 1. 制造【长期趋势】：每个月销量基础增加 10 杯</span>
trend = np.linspace(<span class="hljs-number">100</span>, <span class="hljs-number">460</span>, <span class="hljs-number">36</span>)

<span class="hljs-comment"># 2. 制造【季节变动】：模拟每年夏天高、冬天低 (用正弦波模拟)</span>
<span class="hljs-comment"># 这里的逻辑是制造一个周期性的波浪</span>
seasonality = <span class="hljs-number">50</span> * np.sin(np.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">3</span> * <span class="hljs-number">2</span> * np.pi, <span class="hljs-number">36</span>))

<span class="hljs-comment"># 3. 制造【不规则变动/噪音】：随机波动</span>
noise = np.random.normal(<span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">36</span>)

<span class="hljs-comment"># 4. 合成总销量</span>
total_sales = trend + seasonality + noise

<span class="hljs-comment"># 创建 DataFrame</span>
df = pd.DataFrame({<span class="hljs-string">'Date'</span>: dates, <span class="hljs-string">'Sales'</span>: total_sales})
df.set_index(<span class="hljs-string">'Date'</span>, inplace=<span class="hljs-literal">True</span>)
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2d39a71777e48d5b1d6870e5ec5b8df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767519008&amp;x-signature=0Up1CFtrG2BldYY9pTVRIf3J8aA%3D" alt="" loading="lazy"/></p>
<p>然后，使用 <code>statsmodels</code> 库进行分解，它能帮我们一键拆解数据。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> statsmodels.tsa.seasonal <span class="hljs-keyword">import</span> seasonal_decompose

<span class="hljs-comment"># === 第二步：数据分解 ===</span>
<span class="hljs-comment"># model='additive' 表示加法模型（销量 = 趋势 + 季节 + 噪音）</span>
<span class="hljs-comment"># 如果波动幅度随着趋势变大而变大，通常用乘法模型 (multiplicative)</span>
decomposition = seasonal_decompose(df[<span class="hljs-string">'Sales'</span>], model=<span class="hljs-string">'additive'</span>)

<span class="hljs-comment"># === 第三步：绘图展示 ===</span>
fig = decomposition.plot()
fig.set_size_inches(<span class="hljs-number">12</span>, <span class="hljs-number">10</span>) <span class="hljs-comment"># 设置画布大小</span>
plt.show()
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0962196639c04f0dbc6f2cd3e9f14dbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767519008&amp;x-signature=9ks1nQe8cXYAYPvmXLnAxHY8%2F78%3D" alt="" loading="lazy"/></p>
<p>从上面四个子图可以看出：</p>
<ol>
<li><strong>Observed (原始数据)</strong>：你看到的真实销量曲线，上蹿下跳。</li>
<li><strong>Trend (趋势)</strong>：一条稳步向上的直线。这告诉老板：<em>放心，虽然每个月有波动，但咱们店整体是越做越好的！</em></li>
<li><strong>Seasonal (季节性)</strong>：非常有规律的波浪线。这告诉店长：<em>每年6-8月要多备货，12-1月可以安排员工轮休。</em></li>
<li><strong>Resid (残差/不规则项)</strong>：围绕0上下跳动的杂乱点。这是我们无法预测的随机事件。</li>
</ol>
<h2 data-id="heading-7">4. 分析师的内功：不仅仅是代码</h2>
<p>学会了上面的代码，你已经入门了。但作为过来人，我想告诉你，工具和算法虽然层出不穷，但<strong>分析思路</strong>才是万变不离其宗的。</p>
<p>首先，关注<strong>数据的平稳性</strong>，这是时间序列分析的门槛。</p>
<p>简单说，大部分复杂的统计模型（如ARIMA）都假设数据的性质（均值、方差）不随时间变化。</p>
<p>然而现实数据（如股价、销量）往往是不平稳的（有上涨趋势），因此如果你发现数据一直在涨，可以试着做<strong>差分</strong>（用今天的数减去昨天的数）。</p>
<p><strong>差分</strong>后的数据往往就平稳了，更容易放入模型去训练。</p>
<p>其次，结合<strong>业务场景</strong>，不要死记硬背模型，还要看场景。</p>
<p>比如：</p>
<ol>
<li><strong>场景A：电商大促预测（双11）</strong>
<ul>
<li><strong>特点</strong>：有极强的季节性（每年11月暴涨）。</li>
<li><strong>策略</strong>：重点分析<strong>季节变动</strong>。如果只看趋势，你会被双11的数据吓死，或者在双11备货不足。</li>
<li><strong>热点关联</strong>：就像分析“淄博烧烤”或“哈尔滨旅游”，必须考虑节假日这个强季节因子。</li>
</ul>
</li>
<li><strong>场景B：股票价格预测</strong>
<ul>
<li><strong>特点</strong>：不规则变动（噪音）极大，甚至噪音掩盖了趋势。</li>
<li><strong>策略</strong>：这种时候，简单的分解模型往往失效。需要引入更多外部变量（新闻、政策），或者使用更高级的深度学习模型。</li>
</ul>
</li>
<li><strong>场景C：服务器流量监控</strong>
<ul>
<li><strong>特点</strong>：白天高、深夜低，周末低、工作日高。</li>
<li><strong>策略</strong>：这是最标准的周期性数据，非常适合用来做异常检测（比如某天深夜流量突然暴涨，肯定是有黑客攻击或系统Bug，因为这违背了季节性规律）。</li>
</ul>
</li>
</ol>
<h2 data-id="heading-8">5. 总结与建议</h2>
<p><strong>时间序列分析</strong>并没有想象中那么神秘。它的本质就是：<strong>承认历史会重演，但也接纳未来的不确定性。</strong></p>
<p>对于刚入行的朋友，我的建议是：</p>
<ol>
<li><strong>理解四大成分</strong>（趋势、季节、循环、噪音）是基础中的基础。</li>
<li><strong>抓住主要矛盾</strong>：在做预测时，优先搞定趋势和季节性。</li>
<li><strong>多动手尝试</strong>：比如把上面的<code>Python</code>代码跑一遍，尝试修改一下数据，看看结果有什么变化。</li>
</ol>
<p>未来的分析方法虽然会越来越多，AI也会越来越强，但这种 <strong>“透过现象（原始数据）看本质（趋势与规律）”</strong> 的分析思维，将是我们职业生涯中永恒不变的宝贵财富。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Self-Attention 为什么要做 QKV 的线性变换？又为什么要做 Softmax？]]></title>    <link>https://juejin.cn/post/7588080521446260782</link>    <guid>https://juejin.cn/post/7588080521446260782</guid>    <pubDate>2025-12-28T06:32:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588080521446260782" data-draft-id="7588139768275779635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Self-Attention 为什么要做 QKV 的线性变换？又为什么要做 Softmax？"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-12-28T06:32:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="coting"/> <meta itemprop="url" content="https://juejin.cn/user/933911964427818"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Self-Attention 为什么要做 QKV 的线性变换？又为什么要做 Softmax？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/933911964427818/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    coting
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T06:32:19.000Z" title="Sun Dec 28 2025 06:32:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在看 Transformer 的 self-attention 结构时，很多人第一次见到 ( Q, K, V ) 三个矩阵都会有点疑惑：<br/>
明明输入就是一个向量序列，为什么还要多此一举做三次<strong>线性变换</strong>？<br/>
而且最后还要套上一个 <strong>Softmax</strong>，这又是在干什么？</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e586155be140446dbea559fa5b7aa6f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=7UNfPUXhzs%2F%2BRe9l4Ate0blNnM4%3D" alt="" loading="lazy"/></p>
<p>这两个问题，其实是理解注意力机制的核心关键。<br/>
我们从最直观的角度来拆开看。</p>
<p>所有相关源码示例、流程图、面试八股、模型配置与知识库构建技巧，我也将持续更新在Github：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faicoting%2FAIHub" target="_blank" title="https://github.com/aicoting/AIHub" ref="nofollow noopener noreferrer"><strong>AIHub</strong></a>，欢迎关注收藏！</p>
<h2 data-id="heading-0">一、为什么要 Q、K、V？</h2>
<p>假设我们有一个输入序列：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b86f8dbaf7c545d3b5cd5eb8ed0b7907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=%2ByRuytzdHzQFm5eabxPm3H9M1NQ%3D" alt="image" loading="lazy"/></p>
<p>每个<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a9057db7085417d9782855af87577fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=LFY5Q5zOXUhl635nh5TMGulim7w%3D" alt="image" loading="lazy"/> 就是一个 token 的 embedding，比如一个词、一个字、或者一个图像 patch。<br/>
如果我们直接用这些<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/240fd555cf83454d9323b47e6204b997~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=sMJBCqPE%2FNHGzNtO1nmLteYkV%2Fs%3D" alt="image" loading="lazy"/> 之间做点积：<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e438e1b00f0d43f9be1904d8b1cb7bea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=4Yhuda1E%2FQ9%2FMSaCCcEtv9N6dgs%3D" alt="image" loading="lazy"/></p>
<p>它确实能反映出两个 token 的相关性（越大越相关），但存在两个致命问题：</p>
<ol>
<li><strong>每个 token 的表示是静态的</strong>：输入 embedding 没有区分<strong>谁在关注别人</strong>还是<strong>被别人关注</strong>。</li>
<li><strong>无法表达不同的关注模式</strong>：所有 token 的关系都被一个固定空间描述，模型无法灵活学习不同角度的相似性。</li>
</ol>
<p>于是就引出了 Q、K、V 的设计。</p>
<h2 data-id="heading-1">二、Q、K、V 的线性变换在干什么？</h2>
<h3 data-id="heading-2">1.投影到不同子空间</h3>
<p>输入的特征维度是 <img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e4d62ecac89f4b06b530a0dd448443ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=lxT54XhrMcuSK%2BDRYZDdZbUdBfE%3D" alt="image" loading="lazy"/>，每个 token 的 embedding 包含<strong>所有语义信息</strong>。</p>
<p>直接用原始 embedding 做 Q/K/V，相当于在同一个空间计算相似度，模型<strong>无法学习不同语义关系的权重</strong>。</p>
<p>我们把输入 ( X ) 分别线性变换成三种表示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c47ecaa73f844c98ba4c31eee678419~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=qadyxYmu1a9uA7SPWKiQNColD5k%3D" alt="image" loading="lazy"/></p>
<ul>
<li><strong>Query（查询）</strong>：表示我想关注什么信息</li>
<li><strong>Key（键）</strong>：表示我是什么样的信息</li>
<li><strong>Value（值）</strong>：表示我携带的信息内容</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e55b612b5f4a4d47ac965b091eb91af3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=S3yhVBcSteo0CMBjW9qE2a8YsQg%3D" alt="" loading="lazy"/></p>
<p>这三个矩阵其实是从同一个输入 (X) 投影出来的三种<strong>视角</strong>。<br/>
这一步的作用，就是<strong>让模型在不同子空间中理解 token 之间的关系</strong>。</p>
<p>举个简单的例子：<br/>
在一句话中，“他吃了一个苹果”，<br/>
“他”这个词（Query）可能更关注“吃”这个动词，而“吃”这个词（Key）可能更多地被名词吸引。</p>
<p>通过三组独立的线性变换，模型可以学习到这种不同角色的匹配关系。</p>
<p>所以你可以这样理解，Q 是注意力的<strong>提问方式</strong>，K 是信息的<strong>身份描述</strong>，V 是最终被提取的<strong>信息内容</strong>。</p>
<h3 data-id="heading-3">2.支持多头注意力</h3>
<p>多头注意力把 Q/K/V 切分成多个头，每个头关注不同子空间的特征。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97f0b5e3f83f47e1b160f3d457e16b93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=u7J5vXihvAUQ%2FnZ5fR5Tu%2FO0BHo%3D" alt="" loading="lazy"/></p>
<p>如果没有线性变换，每个头得到的还是原始 embedding，无法学习多角度关系。</p>
<p>线性投影允许每个 head <strong>独立学习一套查询/键/值表示</strong>，提升模型表达能力。</p>
<p>公式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9d2ec503f7945f685068c30b47e5ac9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=PjOPACEi3PV8cdwwBQtOL1vkD5g%3D" alt="image" loading="lazy"/><br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba5b9be9914b4f08bd0773439f1c2aee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=S8y%2Bs0y2xnZnUtApQz8a62uZvAc%3D" alt="image" loading="lazy"/></p>
<h3 data-id="heading-4">3.增加可学习参数</h3>
<p>每个线性变换 W_Q, W_K, W_V都是 <strong>可训练权重</strong>，模型可以自动学习如何对不同 token 的 embedding 做不同的查询、匹配和加权。</p>
<p>这使得 self-attention 不只是一个固定的相似度计算，而是一个 <strong>可调节、可优化的语义匹配函数</strong>。</p>
<h3 data-id="heading-5">4.便于下游操作</h3>
<p>QK^T 计算的是注意力权重，如果不做线性变换，模型只能依赖原始 embedding 的内积，这种相似度空间不一定适合 softmax 加权。</p>
<p>线性变换可以把 embedding 投影到更适合做<strong>注意力匹配</strong>的空间，提高学习能力。</p>
<h2 data-id="heading-6">三、Q 与 K 的点积</h2>
<p>拿到 Q 和 K 后，self-attention 计算的是每个 Query 与所有 Key 的相似度：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23e4c56e257f4c49a789bcad38f23b4f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=O4eHDAusy8OpmKQ1fkwwQwqrWMY%3D" alt="image" loading="lazy"/></p>
<p>这里的点积代表<strong>匹配程度</strong>，即：</p>
<ul>
<li>Q_i 表示第 i 个 token 想关注的信息；</li>
<li>K_j 表示第 j 个 token 所包含的信息；</li>
<li>它们的点积越大，说明第 i 个 token 越应该关注第 j 个 token。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/20bc14ecd2c34b7d97063f169c5a2645~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=pf%2FU9Y1ZZ9G1zhC3357vTnCupKU%3D" alt="" loading="lazy"/></p>
<p>从计算上看，点积是将所有的对齐分量相乘并累加；从几何上看，当向量指向相似方向时，点积为正，如果向量垂直，点积为0，当向量方向相反时则为负数。</p>
<p>这样，我们就得到了一个注意力分数矩阵，表示每个 token 对其他 token 的<strong>注意力权重</strong>。</p>
<h2 data-id="heading-7">四、为什么要用 Softmax？</h2>
<p>问题来了：我们已经有了相似度分数，为什么还要再过一遍 Softmax？</p>
<p>其实原因很简单：</p>
<ol>
<li><strong>把“相似度”变成“权重分布”</strong><br/>
点积结果可以是任意实数，而 Softmax 会把它们压缩到 ( [0, 1] ) 区间，并且所有权重之和为 1。<br/>
这让注意力分数能被解释为概率分布，即模型在关注谁、关注多少。</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8069bf7529a64711b9cf9c52fb2991af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=8CVFjNuXSnO%2Fqs7xJnil4Lbqs0U%3D" alt="" loading="lazy"/></p>
<ol start="2">
<li><strong>放大强关注、削弱弱关注</strong><br/>
Softmax 有指数特性，会让大的分数更大、小的分数更小，从而突出主导注意力。<br/>
这在语义建模中非常关键——模型不会平均地看所有 token，而是能<strong>聚焦重点</strong>。</li>
<li><strong>梯度稳定性</strong><br/>
如果直接用点积做加权，分数可能过大或过小，导致梯度不稳定。<br/>
Softmax 保证了数值范围可控，梯度传播更平滑。</li>
</ol>
<p>最后一步，把注意力权重乘上 Value：<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8372c1f342a478dbc2d308d1f2c1205~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgY290aW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767508338&amp;x-signature=Tk4c3Qr%2FXEmr9C5Xlgc7IYTxp3s%3D" alt="image" loading="lazy"/><br/>
就得到了每个 token 根据上下文动态加权后的新表示。</p>
<p>总结一下，Q、K、V 的线性变换是为了让模型从同一输入中生成<strong>不同功能的向量表示</strong>，分别负责提问、匹配和传递信息，增强模型的表达灵活性。</p>
<p>Softmax 的作用则是把相似度分数转成稳定的注意力分布，突出重点并保证梯度可训练。</p>
<p><strong>📚</strong> <strong>推荐阅读</strong></p>
<p>● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918047303597552480" target="_blank" title="https://zhuanlan.zhihu.com/p/1918047303597552480" ref="nofollow noopener noreferrer">一览Transformer整体架构</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918049072331362469" target="_blank" title="https://zhuanlan.zhihu.com/p/1918049072331362469" ref="nofollow noopener noreferrer">Transformer——Attention怎么实现集中注意力</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918050616376301224" target="_blank" title="https://zhuanlan.zhihu.com/p/1918050616376301224" ref="nofollow noopener noreferrer">Transformer——FeedForward模块在干什么？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1918357249883105145" target="_blank" title="https://zhuanlan.zhihu.com/p/1918357249883105145" ref="nofollow noopener noreferrer">从0开始实现Transformer</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1919338888536756837" target="_blank" title="https://zhuanlan.zhihu.com/p/1919338888536756837" ref="nofollow noopener noreferrer">什么是KV-Cache</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1919500956946655189" target="_blank" title="https://zhuanlan.zhihu.com/p/1919500956946655189" ref="nofollow noopener noreferrer">Transformer注意力机制——MHA&amp;MQA&amp;GQA</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1923328314241704991" target="_blank" title="https://zhuanlan.zhihu.com/p/1923328314241704991" ref="nofollow noopener noreferrer">FlashAttention怎么提升速度的？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1963547933044631464" target="_blank" title="https://zhuanlan.zhihu.com/p/1963547933044631464" ref="nofollow noopener noreferrer">面试官：BatchNorm、LayerNorm、GroupNorm、InstanceNorm 有什么本质区别？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1962254381677257759" target="_blank" title="https://zhuanlan.zhihu.com/p/1962254381677257759" ref="nofollow noopener noreferrer">面试官：Transformer如何优化到线性级？</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1923714840653993730" target="_blank" title="https://zhuanlan.zhihu.com/p/1923714840653993730" ref="nofollow noopener noreferrer">FlashAttention2：更快的注意力机制，更好的并行效率</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1924154277082961318" target="_blank" title="https://zhuanlan.zhihu.com/p/1924154277082961318" ref="nofollow noopener noreferrer">FlashAttention3 全解析：速度、精度、显存的再平衡</a><br/>
● <a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1971661595559059790" target="_blank" title="https://zhuanlan.zhihu.com/p/1971661595559059790" ref="nofollow noopener noreferrer">Transformer 中为什么用LayerNorm而不用BatchNorm？</a></p>
<p>关于深度学习和AI大模型相关的知识和前沿技术更新，请关注公众号 <strong>aicoting</strong>！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBoot 接入飞书多维表格，快速跑通MVP应用]]></title>    <link>https://juejin.cn/post/7589092567544119305</link>    <guid>https://juejin.cn/post/7589092567544119305</guid>    <pubDate>2025-12-29T09:36:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589092567544119305" data-draft-id="7589093895326367753" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBoot 接入飞书多维表格，快速跑通MVP应用"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-29T09:36:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Corbing"/> <meta itemprop="url" content="https://juejin.cn/user/1284695418219886"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBoot 接入飞书多维表格，快速跑通MVP应用
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1284695418219886/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Corbing
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:36:43.000Z" title="Mon Dec 29 2025 09:36:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">项目地址：</h2>
<ul>
<li>Gitee: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fbdmcom%2Ffs-dw-table-springboot-starter" target="_blank" title="https://gitee.com/bdmcom/fs-dw-table-springboot-starter" ref="nofollow noopener noreferrer">gitee.com/bdmcom/fs-d…</a></li>
<li>GitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbendangmi%2Ffs-dw-table-springboot-starter" target="_blank" title="https://github.com/bendangmi/fs-dw-table-springboot-starter" ref="nofollow noopener noreferrer">github.com/bendangmi/f…</a></li>
</ul>
<h2 data-id="heading-1">项目说明</h2>
<ul>
<li>将飞书多维表格作为数据源，像操作 MySQL 等数据库一样完成数据 CRUD</li>
<li>查询能力对标 MyBatis-Plus，使用 <code>DwLambdaQueryWrapper</code> 完成条件构造</li>
<li>屏蔽底层 Open API 调用，开发者只需引入依赖并填写飞书配置</li>
</ul>
<h2 data-id="heading-2">架构设计</h2>
<h3 data-id="heading-3">分层架构</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────┐
│                        应用层 (Application)                   │
│  FsDwRecordHelper / FsDwTableHelper / FsDwFieldHelper       │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                        服务层 (Service)                      │
│     FsDwRecordService / FsDwTableService / FsDwFieldService │
│                      FsDwTokenService                        │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                         API层 (HTTP Client)                  │
│      FsDwRecordApi / FsDwTableApi / FsDwFieldApi             │
│                    (Forest 声明式 HTTP 客户端)                │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│                      飞书多维表格 Open API                    │
└─────────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-4">核心组件</h3>













































<table><thead><tr><th>组件</th><th>职责</th><th>说明</th></tr></thead><tbody><tr><td><code>@EnableFsDwTable</code></td><td>启用自动配置</td><td>显式启用，避免与其他实现冲突</td></tr><tr><td><code>FsDwAutoConfiguration</code></td><td>自动配置类</td><td>注册所有核心 Bean 并扫描 Forest 接口</td></tr><tr><td><code>FsDwProperties</code></td><td>配置属性</td><td>绑定 <code>duoweitable.*</code> 配置项</td></tr><tr><td><code>FsDwTokenService</code></td><td>Token 管理</td><td>使用 Caffeine 高性能缓存，支持并发和统计</td></tr><tr><td><code>DwLambdaQueryWrapper</code></td><td>查询构造器</td><td>MyBatis-Plus 风格的 Lambda 类型安全查询</td></tr><tr><td><code>FsDwRecordHelper</code></td><td>记录操作助手</td><td>静态工具方法，便捷 CRUD 操作</td></tr><tr><td><code>BitableException</code></td><td>统一异常</td><td>携带错误码的异常体系</td></tr></tbody></table>
<h3 data-id="heading-5">注解体系</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwAppBase(appToken = "app_token")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoAppBase</span> {
}

<span class="hljs-meta">@FsDwTable(name = "表名", tableId = "tblxxx", viewId = "vewxxx")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DemoAppBase</span> {
    <span class="hljs-meta">@FsDwTableId</span>                    <span class="hljs-comment">// 标记记录 ID 字段</span>
    <span class="hljs-keyword">private</span> String recordId;

    <span class="hljs-meta">@FsDwTableProperty(value = "字段名", order = 1, type = TypeEnum.TEXT)</span>
    <span class="hljs-keyword">private</span> String fieldName;
}
</code></pre>
<h3 data-id="heading-6">HTTP 客户端</h3>
<p>本项目使用 <strong>Forest</strong> 作为 HTTP 客户端，相比 RestTemplate/WebClient：</p>
<ul>
<li>声明式接口定义，无需手写请求代码</li>
<li>自动 JSON 序列化/反序列化</li>
<li>支持拦截器、过滤器等扩展机制</li>
<li>底层使用 OkHttp，性能优异</li>
</ul>
<h3 data-id="heading-7">缓存策略</h3>
<p><strong>Token 缓存</strong> 使用 Caffeine：</p>
<ul>
<li>自动过期（2小时）</li>
<li>并发安全（基于 ConcurrentHashMap）</li>
<li>LRU 淘汰策略（最多 100 个 token）</li>
<li>支持统计信息（命中率等）</li>
<li>提前 60 秒刷新缓冲</li>
</ul>
<h2 data-id="heading-8">解决的问题</h2>
<ul>
<li>免去 Token 鉴权、请求构造、响应解析等“胶水工作”，业务层只保留 CRUD 语义</li>
<li>统一字段映射与类型转换，减少手写 JSON/Map 与字段名不一致的风险</li>
<li>提供类数据库的条件查询与分页能力，让数据访问更易维护、可读</li>
</ul>
<h2 data-id="heading-9">项目亮点</h2>
<ul>
<li>通过 @EnableFsDwTable 显式启用自动配置 + Forest 扫描，避免与其他实现冲突</li>
<li>注解驱动实体映射（<code>@FsDwAppBase</code> / <code>@FsDwTable</code> / <code>@FsDwTableProperty</code> / <code>@FsDwTableId</code>），支持元字段读取</li>
<li><code>DwLambdaQueryWrapper</code> 提供 MyBatis-Plus 风格的条件、排序、分页与字段选择</li>
<li>记录/表/字段多层级 Helper 与 Service 组合，兼顾简单调用与可扩展集成</li>
<li>Token 内存缓存 + 提前刷新缓冲，降低频繁鉴权请求</li>
<li>统一错误码与断言体系（<code>BitableException</code> / <code>BitableErrorCode</code>）</li>
</ul>
<h2 data-id="heading-10">功能特性</h2>
<ul>
<li>启用注解后自动配置并扫描 Forest HTTP 客户端</li>
<li>注解驱动实体映射（<code>@FsDwAppBase</code> / <code>@FsDwTable</code> / <code>@FsDwTableProperty</code> / <code>@FsDwTableId</code>），支持元字段映射</li>
<li>类数据库的 CRUD 体验，屏蔽飞书多维表格底层调用</li>
<li>MyBatis-Plus 风格查询，<code>DwLambdaQueryWrapper</code> 条件构造</li>
<li>记录、数据表、字段操作的 Helper API</li>
<li>统一异常与错误码（<code>BitableException</code> / <code>BitableErrorCode</code>）</li>
</ul>
<h2 data-id="heading-11">运行环境</h2>
<ul>
<li>Java 17+</li>
<li>Spring Boot 3.x</li>
<li>飞书应用凭证（appId、appSecret），appToken 由 @FsDwAppBase 提供</li>
</ul>
<h2 data-id="heading-12">安装</h2>
<p>Maven:</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.bdmcom<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fs-dw-table-springboot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>Gradle:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">dependencies {
  implementation(<span class="hljs-string">"cn.bdmcom:fs-dw-table-springboot-starter:1.0.0"</span>)
}
</code></pre>
<h2 data-id="heading-13">配置</h2>
<p>最小配置（Helper API 必需）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">duoweitable:</span>
  <span class="hljs-attr">app-id:</span> <span class="hljs-string">your-app-id</span>
  <span class="hljs-attr">app-secret:</span> <span class="hljs-string">your-app-secret</span>
</code></pre>
<p><code>application.properties</code> 等价写法：</p>
<pre><code class="hljs language-properties" lang="properties">duoweitable.app-id=your-app-id
duoweitable.app-secret=your-app-secret
</code></pre>
<p>appToken 建议放在实体父类的 <code>@FsDwAppBase</code> 中（appToken 相当于一个 Excel，tableId 相当于一个 Sheet）：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwAppBase(appToken = "app_token")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoAppBase</span> {
}
</code></pre>
<p>Forest 客户端可选配置（仅在需要覆盖时配置）：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">forest:</span>
  <span class="hljs-attr">backend:</span> <span class="hljs-string">okhttp3</span>
  <span class="hljs-attr">connect-timeout:</span> <span class="hljs-number">5000</span>
  <span class="hljs-attr">read-timeout:</span> <span class="hljs-number">5000</span>
  <span class="hljs-attr">max-retry-count:</span> <span class="hljs-number">0</span>
</code></pre>
<h2 data-id="heading-14">启用方式（3 步）</h2>
<ol>
<li>引入依赖</li>
<li>配置参数</li>
<li>启动类加注解（不加注解不会加载 Starter，已禁用 AutoConfiguration.imports 自动装配）</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> cn.bdmcom.annotation.EnableFsDwTable;
<span class="hljs-keyword">import</span> org.springframework.boot.SpringApplication;
<span class="hljs-keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;

<span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@EnableFsDwTable</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoApplication</span> {
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    SpringApplication.run(DemoApplication.class, args);
  }
}
</code></pre>
<h2 data-id="heading-15">注意事项（已使用 Forest 的项目）</h2>
<p>如果你的项目已经使用了 Forest，并且自己加了 <code>@ForestScan</code>，请把 <code>cn.bdmcom.core.api</code> 加到
<code>basePackages</code>，否则 Starter 的接口不会被扫描到：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.dtflys.forest.springboot.annotation.ForestScan;
<span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@ForestScan(basePackages = {
  "your.project.forest.clients",
  "cn.bdmcom.core.api"
})</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ForestClientConfig</span> {
}
</code></pre>
<h2 data-id="heading-16">快速开始</h2>
<h3 data-id="heading-17">1) 定义 App 基类</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwAppBase(appToken = "app_token")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">abstract</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoAppBase</span> {
}
</code></pre>
<h3 data-id="heading-18">2) 定义实体</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@FsDwTable(name = "Test Table", tableId = "tblxxxxx", viewId = "vewxxxxx")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestTable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">DemoAppBase</span> {
  <span class="hljs-meta">@FsDwTableId</span>
  <span class="hljs-keyword">private</span> String recordId;

  <span class="hljs-meta">@FsDwTableProperty(value = "Name", order = 1, type = TypeEnum.TEXT)</span>
  <span class="hljs-keyword">private</span> String name;

  <span class="hljs-meta">@FsDwTableProperty(value = "Age", order = 2, type = TypeEnum.NUMBER)</span>
  <span class="hljs-keyword">private</span> Integer age;
}
</code></pre>
<h3 data-id="heading-19">3) 查询记录</h3>
<pre><code class="hljs language-java" lang="java">List&lt;TestTable&gt; records = FsDwRecordHelper.queryRecords(TestTable.class);
</code></pre>
<h3 data-id="heading-20">4) 新增记录</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">TestTable</span> <span class="hljs-variable">add</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
add.setName(<span class="hljs-string">"Alice"</span>);
add.setAge(<span class="hljs-number">18</span>);
<span class="hljs-type">AddRecordRes</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> FsDwRecordHelper.addRecord(add);
</code></pre>
<h3 data-id="heading-21">5) 批量新增记录</h3>
<pre><code class="hljs language-java" lang="java">List&lt;TestTable&gt; batch = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
  <span class="hljs-type">TestTable</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
  item.setName(<span class="hljs-string">"User-"</span> + i);
  item.setAge(<span class="hljs-number">18</span>);
  batch.add(item);
}
<span class="hljs-type">BatchCreateRecordRes</span> <span class="hljs-variable">batchRes</span> <span class="hljs-operator">=</span> FsDwRecordHelper.batchCreateRecords(TestTable.class, batch);
</code></pre>
<h3 data-id="heading-22">6) 更新记录</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">TestTable</span> <span class="hljs-variable">update</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
update.setRecordId(<span class="hljs-string">"recxxxxxx"</span>);
update.setName(<span class="hljs-string">"Alice"</span>);
<span class="hljs-type">UpdateRecordRes</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> FsDwRecordHelper.updateRecord(update);
</code></pre>
<h3 data-id="heading-23">7) 删除记录</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">TestTable</span> <span class="hljs-variable">del</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestTable</span>();
del.setRecordId(<span class="hljs-string">"recxxxxxx"</span>);
<span class="hljs-type">DeleteRecordRes</span> <span class="hljs-variable">res</span> <span class="hljs-operator">=</span> FsDwRecordHelper.deleteRecord(del);
</code></pre>
<h2 data-id="heading-24">条件查询</h2>
<pre><code class="hljs language-java" lang="java">DwLambdaQueryWrapper&lt;TestTable&gt; wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DwLambdaQueryWrapper</span>&lt;&gt;();
wrapper.eq(TestTable::getName, <span class="hljs-string">"Alice"</span>);
List&lt;TestTable&gt; list = FsDwRecordHelper.queryRecords(TestTable.class, wrapper);

wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DwLambdaQueryWrapper</span>&lt;&gt;();
wrapper.between(TestTable::getAge, <span class="hljs-number">18</span>, <span class="hljs-number">30</span>);
list = FsDwRecordHelper.queryRecords(TestTable.class, wrapper);

wrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DwLambdaQueryWrapper</span>&lt;&gt;();
wrapper.pageSize(<span class="hljs-number">20</span>);
wrapper.pageNo(<span class="hljs-number">2</span>);
list = FsDwRecordHelper.queryRecords(TestTable.class, wrapper);
</code></pre>
<h2 data-id="heading-25">数据表操作</h2>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">CreateTableRes</span> <span class="hljs-variable">created</span> <span class="hljs-operator">=</span> FsDwTableHelper.createTable(TestTable.class);
List&lt;ListTableRes.TableItem&gt; all = FsDwTableHelper.listAllTables(TestTable.class);
<span class="hljs-type">UpdateTableRes</span> <span class="hljs-variable">updated</span> <span class="hljs-operator">=</span> FsDwTableHelper.updateTable(TestTable.class);
<span class="hljs-type">DeleteTableRes</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> FsDwTableHelper.deleteTable(TestTable.class);
</code></pre>
<h2 data-id="heading-26">字段操作</h2>
<pre><code class="hljs language-java" lang="java">List&lt;TableFieldListRes.TableField&gt; fields = FsDwFieldHelper.listFields(<span class="hljs-string">"tblxxxxx"</span>, <span class="hljs-string">"vewxxxxx"</span>);
<span class="hljs-type">AddFieldRes</span> <span class="hljs-variable">created</span> <span class="hljs-operator">=</span> FsDwFieldHelper.createField(TestTable.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddFieldReq</span>(<span class="hljs-string">"New Field"</span>, TypeEnum.TEXT));
<span class="hljs-type">UpdateFieldRes</span> <span class="hljs-variable">updated</span> <span class="hljs-operator">=</span> FsDwFieldHelper.updateFieldByName(TestTable.class, <span class="hljs-string">"New Field"</span>,
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateFieldReq</span>(<span class="hljs-string">"New Field Name"</span>, TypeEnum.TEXT));
<span class="hljs-type">DeleteFieldRes</span> <span class="hljs-variable">deleted</span> <span class="hljs-operator">=</span> FsDwFieldHelper.deleteFieldByName(TestTable.class, <span class="hljs-string">"New Field Name"</span>);
</code></pre>
<h2 data-id="heading-27">直接使用 Service Bean</h2>
<p>如果希望使用 Spring 管理的 Service：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoService</span> {
  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-keyword">private</span> FsDwRecordService recordService;

  <span class="hljs-keyword">public</span> QueryRecordRes <span class="hljs-title function_">query</span><span class="hljs-params">(String appId, String appSecret, String appToken, String tableId, QueryRecordReq req)</span> {
    <span class="hljs-keyword">return</span> recordService.queryRecord(appId, appSecret, appToken, tableId, req);
  }
}
</code></pre>
<h2 data-id="heading-28">异常与错误码</h2>
<p>所有 Helper/Service 方法在失败时会抛出 <code>BitableException</code>。
错误码与信息请参考 <code>BitableErrorCode</code>。</p>
<h2 data-id="heading-29">注意事项</h2>
<h3 data-id="heading-30">1. 分页查询的性能限制</h3>
<p>飞书多维表格的分页机制与传统的数据库分页（如 MySQL 的 OFFSET）不同：</p>
<ul>
<li><strong>顺序分页</strong>：飞书使用 <code>page_token</code> 机制，必须从第一页开始顺序获取</li>
<li><strong>性能影响</strong>：查询第 N 页需要发起 N 次请求，对于大结果集会有性能问题</li>
<li><strong>建议</strong>：
<ul>
<li>尽量使用查询条件缩小结果集范围</li>
<li>避免跳转到很深的页码（如直接查第 1000 页）</li>
<li>如果需要大数据量处理，考虑使用全量导出或其他方式</li>
</ul>
</li>
</ul>
<h3 data-id="heading-31">2. 双 API 设计说明</h3>
<p>本项目提供了两种使用方式：</p>
<p><strong>静态 Helper API</strong>：</p>
<pre><code class="hljs language-java" lang="java">FsDwRecordHelper.queryRecords(TestTable.class);
</code></pre>
<ul>
<li>优点：简洁便捷，无需注入</li>
<li>缺点：静态方法难以 mock，不利于单元测试</li>
</ul>
<p><strong>Service Bean API</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> FsDwRecordService recordService;
</code></pre>
<ul>
<li>优点：可测试、可 AOP 拦截、支持多租户</li>
<li>缺点：需要显式注入</li>
</ul>
<p><strong>建议</strong>：简单项目用 Helper，复杂项目或多租户场景用 Service。</p>
<h3 data-id="heading-32">3. 与现有 Forest 项目的集成</h3>
<p>如果你的项目已经使用了 Forest 并自定义了 <code>@ForestScan</code>，需要确保将本项目的 API 包加入扫描路径：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@ForestScan(basePackages = {
    "your.project.forest.clients",
    "cn.bdmcom.core.api"  // 必须包含
})</span>
</code></pre>
<h3 data-id="heading-33">4. Lambda 查询的性能考虑</h3>
<p><code>DwLambdaQueryWrapper</code> 使用反射解析 Lambda 表达式获取字段名：</p>
<ul>
<li>首次解析会有性能开销，字段名映射会被缓存</li>
<li>频繁创建新的 Wrapper 实例会有一定开销</li>
<li>建议复用 Wrapper 实例或使用字符串字段名</li>
</ul>
<h3 data-id="heading-34">5. Token 缓存管理</h3>
<p>Token 默认缓存 2 小时（提前 60 秒刷新），如需手动清除：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> FsDwTokenService tokenService;

<span class="hljs-comment">// 清除指定 token</span>
tokenService.evictToken(appId, appSecret);

<span class="hljs-comment">// 清除所有 token</span>
tokenService.evictAll();

<span class="hljs-comment">// 获取缓存统计</span>
<span class="hljs-type">CacheStats</span> <span class="hljs-variable">stats</span> <span class="hljs-operator">=</span> tokenService.getCacheStats();
</code></pre>
<h3 data-id="heading-35">6. 类型转换限制</h3>
<p>飞书多维表格的字段类型与 Java 类型映射有限制：</p>
<ul>
<li>日期时间：自动转换为 <code>LocalDateTime</code>/<code>LocalDate</code></li>
<li>多选/单选：返回文本内容或数组</li>
<li>复杂嵌套结构可能需要手动处理</li>
</ul>
<h2 data-id="heading-36">发布到 Maven Central</h2>
<p>发布前请更新 <code>pom.xml</code> 元信息：</p>
<ul>
<li><code>url</code>、<code>scm</code>、<code>developers</code></li>
<li><code>groupId</code> 所有权与发布版本号</li>
</ul>
<p>签名构建：</p>
<pre><code class="hljs language-sh" lang="sh">mvn -P release -DskipTests clean verify
</code></pre>
<p>发布需要配置 Sonatype 账号与 GPG 密钥，请根据官方流程完成发布。</p>
<h2 data-id="heading-37">许可证</h2>
<p>Apache License, Version 2.0</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 是否真的能完全替代程序员？从我试用 AI 开发到前后端架构与页面开发的真实分析]]></title>    <link>https://juejin.cn/post/7589099845186338852</link>    <guid>https://juejin.cn/post/7589099845186338852</guid>    <pubDate>2025-12-29T09:49:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589099845186338852" data-draft-id="7589201772117606406" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 是否真的能完全替代程序员？从我试用 AI 开发到前后端架构与页面开发的真实分析"/> <meta itemprop="keywords" content="后端,AI编程"/> <meta itemprop="datePublished" content="2025-12-29T09:49:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="挖土机_008"/> <meta itemprop="url" content="https://juejin.cn/user/4373178080835884"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 是否真的能完全替代程序员？从我试用 AI 开发到前后端架构与页面开发的真实分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4373178080835884/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    挖土机_008
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:49:23.000Z" title="Mon Dec 29 2025 09:49:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为一名正在试用 AI 进行开发的程序员，我最近尝试让 AI 辅助我完成<strong>前端页面、后端服务和系统逻辑的开发</strong>。在这个过程中，我深刻体会到 AI 的强大，也感受到了它的局限。本文从我的实践出发，结合信息安全、系统架构、后期维护性以及前后端开发场景，对 AI 替代程序员的可能性进行全面分析。</p>
<hr/>
<p>文章地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top%2Farchives%2F1766999092078" target="_blank" title="https://zhiliaole.top/archives/1766999092078" ref="nofollow noopener noreferrer">zhiliaole.top/archives/17…</a></p>
<p>更多文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top" target="_blank" title="https://zhiliaole.top" ref="nofollow noopener noreferrer">zhiliaole.top</a></p>
<h2 data-id="heading-0">一、AI 带来的效率提升</h2>
<p>在日常开发中，我发现 AI 对一些重复性和机械性任务非常高效：</p>
<ul>
<li><strong>前端页面模板</strong>：React/Vue 组件快速生成</li>
<li><strong>表单校验逻辑</strong>：常规验证规则可以直接生成</li>
<li><strong>简单 CRUD 接口</strong>：后端 Controller/Service 代码快速落地</li>
<li><strong>单元测试和文档</strong>：AI 可以生成基础测试和文档模板</li>
</ul>
<p><strong>示例：前端表单组件</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginForm</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [username, setUsername] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);
  <span class="hljs-keyword">const</span> [password, setPassword] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">''</span>);

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">e</span>) =&gt; {
    e.<span class="hljs-title function_">preventDefault</span>();
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/login'</span>, {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
      <span class="hljs-attr">body</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ username, password })
    });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{username}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setUsername(e.target.value)} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{password}</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{e</span> =&gt;</span> setPassword(e.target.value)} /&gt;
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span></span>
  );
}
</code></pre>
<p>AI 可以在几秒钟内生成可运行的组件，大幅节省开发时间。</p>
<hr/>
<h2 data-id="heading-1">二、信息安全性：前后端不同场景的隐忧</h2>
<p>在实践中，我发现 AI 带来的效率背后，也隐藏着信息安全风险：</p>
<h3 data-id="heading-2">1. 前端页面开发风险</h3>
<ul>
<li><strong>敏感数据泄露</strong>：用户表单信息（身份证、支付信息）被直接输入 AI 提示，可能上传云端</li>
<li><strong>API Key/Token 泄露</strong>：AI 生成的示例代码可能直接包含凭证</li>
</ul>
<p><strong>示例风险代码：</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">fetch</span>(<span class="hljs-string">'https://api.payment.com/charge?token=AI_GENERATED_KEY'</span>, {...});
</code></pre>
<ul>
<li>如果直接使用 AI 提示生成代码，可能导致敏感信息泄露。</li>
</ul>
<h3 data-id="heading-3">2. 后端服务风险</h3>
<ul>
<li><strong>核心业务逻辑外泄</strong>：风控规则、支付策略被 AI 处理或存储</li>
<li><strong>依赖漏洞引入</strong>：AI 可能直接使用示例库或过时依赖</li>
</ul>
<p><strong>示意流程图：</strong></p>
<pre><code class="hljs language-css" lang="css">flowchart LR
FE<span class="hljs-selector-attr">[前端页面]</span> --&gt; BE<span class="hljs-selector-attr">[后端服务]</span>
BE --&gt; DB<span class="hljs-selector-attr">[(数据库)]</span>
FE --&gt; AI<span class="hljs-selector-attr">[AI生成前后端代码]</span>
AI --&gt; Cloud<span class="hljs-selector-attr">[云端日志存储]</span>
Cloud --&gt; Leak<span class="hljs-selector-attr">[潜在信息泄露风险]</span>
</code></pre>
<hr/>
<h2 data-id="heading-4">三、系统架构风险</h2>
<p>在试用 AI 开发过程中，我注意到 AI 生成的代码多关注局部功能，缺乏系统级思考：</p>
<h3 data-id="heading-5">1. 前端页面风险</h3>
<ul>
<li><strong>组件耦合严重</strong>：多个逻辑混在一个组件</li>
<li><strong>状态管理混乱</strong>：跨组件共享状态处理不合理</li>
<li><strong>样式风格不统一</strong>：影响用户体验</li>
</ul>
<p><strong>示例：Dashboard 页面</strong></p>
<pre><code class="hljs language-scss" lang="scss">function <span class="hljs-built_in">Dashboard</span>() {
  const <span class="hljs-selector-attr">[user, setUser]</span> = <span class="hljs-built_in">useState</span>(null);
  <span class="hljs-built_in">fetch</span>('/api/user')<span class="hljs-selector-class">.then</span>(res =&gt; res.json())<span class="hljs-selector-class">.then</span>(data =&gt; setUser(data));

  <span class="hljs-built_in">renderChart</span>(user.stats); <span class="hljs-comment">// AI直接嵌入图表逻辑</span>

  return &lt;<span class="hljs-selector-tag">div</span>&gt;{user<span class="hljs-selector-class">.name</span>}&lt;/<span class="hljs-selector-tag">div</span>&gt;;
}
</code></pre>
<ul>
<li>数据请求和图表渲染混在同一组件，违背单一职责原则。</li>
</ul>
<h3 data-id="heading-6">2. 后端服务风险</h3>
<ul>
<li><strong>Controller 层直接包含业务逻辑</strong></li>
<li><strong>跨模块调用</strong>：AI 可能破坏微服务边界</li>
<li><strong>缺少事务和异常控制</strong></li>
</ul>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/create"</span>)
public OrderResponse <span class="hljs-built_in">create</span>(<span class="hljs-variable">@RequestBody</span> OrderReq req) {
    <span class="hljs-selector-tag">orderService</span><span class="hljs-selector-class">.createAndNotify</span>(req); <span class="hljs-comment">// AI生成</span>
    <span class="hljs-selector-tag">paymentService</span><span class="hljs-selector-class">.processPayment</span>(req); <span class="hljs-comment">// AI生成</span>
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">OrderResponse</span>();
}
</code></pre>
<ul>
<li>Controller 同时处理订单和支付，架构腐化风险明显。</li>
</ul>
<hr/>
<h2 data-id="heading-7">四、后期维护性</h2>
<p>AI 生成代码虽然可运行，但<strong>长期维护问题突出</strong>：</p>
<h3 data-id="heading-8">前端页面</h3>
<ul>
<li>状态管理膨胀，跨组件状态难维护</li>
<li>样式与组件风格不统一</li>
<li>依赖库升级可能引发兼容问题</li>
</ul>
<h3 data-id="heading-9">后端服务</h3>
<ul>
<li>分支逻辑膨胀，新增业务类型修改成本高</li>
<li>缺少设计意图和上下文</li>
<li>技术债累积，长期重构成本高</li>
</ul>
<p><strong>维护流程示意图</strong>：</p>
<pre><code class="hljs language-css" lang="css">flowchart <span class="hljs-selector-tag">TD</span>
AI<span class="hljs-selector-attr">[生成代码]</span> --&gt; Review<span class="hljs-selector-attr">[人工审查]</span>
Review --&gt; Repo<span class="hljs-selector-attr">[提交仓库]</span>
Repo --&gt; CI<span class="hljs-selector-attr">[自动化测试]</span>
CI --&gt; Deploy<span class="hljs-selector-attr">[上线]</span>
Deploy --&gt; Maintenance<span class="hljs-selector-attr">[后期维护]</span>
Maintenance --&gt; Complexity<span class="hljs-selector-attr">[理解成本增加]</span>
</code></pre>
<hr/>
<h2 data-id="heading-10">五、前端页面开发可替代性分析</h2>
<p>在我的实践中，AI 对前端页面开发的替代性表现如下：</p>



































<table><thead><tr><th>前端任务</th><th>AI 可替代性</th><th>风险/限制</th></tr></thead><tbody><tr><td>页面模板生成</td><td>高</td><td>需人工审查布局是否符合设计规范</td></tr><tr><td>组件基础逻辑</td><td>中</td><td>复杂交互和状态管理可能出错</td></tr><tr><td>状态管理</td><td>低</td><td>跨组件状态难以维护</td></tr><tr><td>样式与 UX</td><td>低</td><td>风格不一致，用户体验不保证</td></tr><tr><td>API 调用与安全</td><td>中</td><td>需人工检查敏感信息</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-11">六、后端服务开发可替代性分析</h2>






























<table><thead><tr><th>后端任务</th><th>AI 可替代性</th><th>风险/限制</th></tr></thead><tbody><tr><td>简单 CRUD</td><td>高</td><td>需人工审查 SQL 安全性</td></tr><tr><td>核心业务逻辑</td><td>低</td><td>AI 无法理解业务策略</td></tr><tr><td>微服务架构</td><td>低</td><td>可能破坏模块边界</td></tr><tr><td>异常/事务处理</td><td>低</td><td>维护成本高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-12">七、真实案例</h2>
<h3 data-id="heading-13">前端案例</h3>
<ul>
<li>我使用 AI 生成一个电商 Dashboard 页面</li>
<li>初期运行正常</li>
<li>随着业务复杂度增加，组件耦合严重，状态管理混乱</li>
<li>维护成本快速上升</li>
</ul>
<h3 data-id="heading-14">后端案例</h3>
<ul>
<li>我用 AI 生成支付模块和订单处理逻辑</li>
<li>初期功能完整，但缺乏事务控制和异常处理</li>
<li>系统架构受损，线上问题难以追责</li>
</ul>
<hr/>
<h2 data-id="heading-15">八、团队与职业能力影响</h2>
<p>在试用 AI 开发过程中，我发现：</p>
<ul>
<li>我的角色从“代码实现者”转向“AI 协作者、设计者、业务理解者”</li>
<li>技能需求从编码能力转向系统架构能力、业务理解和技术决策</li>
<li>AI 无法替代团队沟通、需求理解和跨部门协作</li>
</ul>
<p><strong>人机协作示意图</strong>：</p>
<pre><code class="hljs language-css" lang="css">flowchart LR
Dev<span class="hljs-selector-attr">[我/程序员]</span> --&gt; Prompt<span class="hljs-selector-attr">[AI提示输入]</span>
Prompt --&gt; AI<span class="hljs-selector-attr">[生成前后端代码/页面]</span>
AI --&gt; Review<span class="hljs-selector-attr">[人工审查]</span>
Review --&gt; Repo<span class="hljs-selector-attr">[提交仓库]</span>
Repo --&gt; CI<span class="hljs-selector-attr">[自动化测试]</span>
CI --&gt; Deploy<span class="hljs-selector-attr">[上线]</span>
</code></pre>
<hr/>
<h2 data-id="heading-16">九、综合分析</h2>















































<table><thead><tr><th>维度</th><th>前端页面</th><th>后端服务</th><th>替代可能性</th><th>风险与限制</th></tr></thead><tbody><tr><td>信息安全性</td><td>用户隐私、API Key</td><td>数据库、业务规则</td><td>低</td><td>敏感信息泄露</td></tr><tr><td>系统架构</td><td>组件耦合、状态管理</td><td>微服务边界、事务</td><td>极低</td><td>架构腐化、难扩展</td></tr><tr><td>后期维护性</td><td>样式、状态、依赖</td><td>分支逻辑、上下文</td><td>低</td><td>技术债累积</td></tr><tr><td>业务理解</td><td>用户体验、交互</td><td>核心业务、支付、风控</td><td>极低</td><td>无法替代人类决策</td></tr><tr><td>团队协作</td><td>需求沟通、UI/UX评审</td><td>技术决策、跨部门</td><td>极低</td><td>AI无法替代</td></tr></tbody></table>
<blockquote>
<p>我的实践结论：AI 可以替代部分重复性任务，但<strong>无法完全替代程序员</strong>，尤其在复杂前端页面和后端服务中。</p>
</blockquote>
<hr/>
<h2 data-id="heading-17">十、最佳实践（从我试用经验出发）</h2>
<ol>
<li><strong>明确 AI 边界</strong>：重复任务由 AI 完成，核心逻辑由人负责</li>
<li><strong>安全优先</strong>：敏感信息和业务规则使用企业私有模型</li>
<li><strong>严格审查</strong>：AI 输出代码必须人工审查</li>
<li><strong>文档与设计记录</strong>：保留决策记录，降低维护成本</li>
<li><strong>技能提升</strong>：程序员应专注架构设计、业务理解、技术决策和团队协作</li>
</ol>
<hr/>
<h2 data-id="heading-18">十一、结语</h2>
<p>通过试用 AI 开发，我切身体会到：</p>
<ul>
<li>AI 提高了开发效率，但无法替代核心能力</li>
<li>AI 可以生成前端页面和后端服务，但长期架构和维护仍需程序员</li>
<li>未来，程序员的核心角色将转向“系统设计者、业务理解者、AI 协作专家”</li>
</ul>
<blockquote>
<p>AI 是助力，而不是替代，它重塑了我的开发方式，也让我对程序员的核心价值有了更清晰的认识。</p>
</blockquote>
<p>文章地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top%2Farchives%2F1766999092078" target="_blank" title="https://zhiliaole.top/archives/1766999092078" ref="nofollow noopener noreferrer">zhiliaole.top/archives/17…</a></p>
<p>更多文章：<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhiliaole.top" target="_blank" title="https://zhiliaole.top" ref="nofollow noopener noreferrer">zhiliaole.top</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Springboot整合kafka(MQ)]]></title>    <link>https://juejin.cn/post/7588411503120793636</link>    <guid>https://juejin.cn/post/7588411503120793636</guid>    <pubDate>2025-12-28T13:46:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7588411503120793636" data-draft-id="7588411503120777252" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Springboot整合kafka(MQ)"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-28T13:46:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ihgry"/> <meta itemprop="url" content="https://juejin.cn/user/3210229685954718"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Springboot整合kafka(MQ)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3210229685954718/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ihgry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-28T13:46:39.000Z" title="Sun Dec 28 2025 13:46:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-28
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">概念</h4>
<ul>
<li>
<p>一个topic主题下面有多个分区（比如partition1、partition2、partition3），每个分区有多个副本；从所有的副本中选取一个作为Leader，其他作为Follower，Leader副本 负责消息的接收和消息的消费，Follower只负责数据的同步；当Leader分区故障后，从Follower中选取一个作为新的Leader</p>
</li>
<li>
<p>一个分区partition只能被消费者组中的一个消费者实例消费，当topic中分区数量发生变化 或者 消费者组中的消费者发生变化 会触发rebalance，重新分配分区partition和消费者实例 之间的关系</p>
</li>
<li>
<p>生产者发送的消息只在一个partition分区内有序，如果topic下面有多个分区，那所有消息整体是无序的</p>
</li>
<li>
<p>一个topic可以有多个消费者组，kafka会记录每个“消费者组” 消费到 “哪个分区的哪个偏移量offset”了</p>
</li>
</ul>
<p align="center"><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0682279ae6354bfc885ba4cef6a62202~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaWhncnk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1767538899&amp;x-signature=yGQsogQMwY6Des3SmbIqi8LI%2Bh4%3D" alt="kafka.jpg" width="90%" loading="lazy"/></p>
<h4 data-id="heading-1">下载</h4>
<ul>
<li>
<p>下载地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fkafka.apache.org%2Fcommunity%2Fdownloads%2F%25EF%25BC%258C%25E8%25A7%25A3%25E5%258E%258B%25E5%258E%258B%25E7%25BC%25A9%25E5%258C%2585" target="_blank" title="https://kafka.apache.org/community/downloads/%EF%BC%8C%E8%A7%A3%E5%8E%8B%E5%8E%8B%E7%BC%A9%E5%8C%85" ref="nofollow noopener noreferrer">kafka.apache.org/community/d…</a></p>
</li>
<li>
<p>在<code>/root/kafka/kafka_2.12-3.6.2</code>目录下创建文件夹<code>mq_logs</code>，并在<code>mq_logs</code>文件夹下分别创建文件夹<code>kafka_data_logs</code>和<code>zookeeper_data</code>分别保存kafka的日志数据和zookeeper的数据</p>
</li>
<li>
<p>在<code>mq_logs</code>目录下创建<code>kafka_console.out</code>和<code>zookeeper_console.out</code>保存启动程序时的日志输出</p>
</li>
<li>
<p>进入config目录修改<code>zookeeper.properties</code>，将dataDir改为：<code>dataDir=/root/kafka/kafka_2.12-3.6.2/mq_logs/zookeeper_data</code></p>
</li>
<li>
<p>进入config目录修改<code>server.properties</code></p>
<ul>
<li>
<p>将log.dir改为<code>log.dirs=/root/kafka/kafka_2.12-3.6.2/mq_logs/kafka_data_logs</code></p>
</li>
<li>
<p>添加配置：<code>listeners=PLAINTEXT://0.0.0.0:9092</code>和<code> advertised.listeners=PLAINTEXT://localhost:9092</code></p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-2">启动</h4>
<ul>
<li>
<p>先启动zookeeper：<code>nohup bin/zookeeper-server-start.sh config/zookeeper.properties &gt; /root/kafka/kafka_2.12-3.6.2/mq_logs/zookeeper_console.out 2&gt;&amp;1 &amp;</code></p>
</li>
<li>
<p>再启动kafka：<code>nohup bin/kafka-server-start.sh config/server.properties &gt; /root/kafka/kafka_2.12-3.6.2/mq_logs/kafka_console.out  2&gt;&amp;1 &amp;</code></p>
</li>
</ul>
<h4 data-id="heading-3">命令</h4>
<ul>
<li>
<p>创建主题：<code>./kafka-topics.sh --create --topic 主题名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看所有主题：<code>./kafka-topics.sh --list --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看某个主题：<code>./kafka-topics.sh --describe --topic 主题名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>删除某个主题：<code>./kafka-topics.sh --delete --topic 主题名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看某个组的消费情况：<code>./kafka-consumer-groups.sh --describe --group 消费者组名称 --bootstrap-server localhost:9092</code></p>
</li>
<li>
<p>查看某个组下面的消费者：<code>./kafka-consumer-groups.sh --describe --group 消费组名称 --bootstrap-server localhost:9092 --members</code></p>
</li>
</ul>
<h4 data-id="heading-4">springboot整合kafka</h4>
<ul>
<li>
<p>引入依赖</p>
<pre><code class="hljs language-java" lang="java">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.kafka&lt;/groupId&gt;
    &lt;artifactId&gt;spring-kafka&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
</li>
<li>
<p>引入配置</p>
<pre><code class="hljs language-properties" lang="properties">spring.kafka.bootstrap-servers=115.190.156.159:9092
spring.kafka.producer.retries=3
spring.kafka.producer.batch-size=1000
spring.kafka.producer.buffer-memory=33554432

spring.kafka.consumer.group-id=crm-microservice-newperformance
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.max-poll-records=200
spring.kafka.listener.ack-mode=MANUAL_IMMEDIATE
</code></pre>
</li>
<li>
<p>配置类：如果程序异常，spring默认将这条消息重复处理9次；这里配置的是同一消息 多次消费失败 的处理策略，即转发到另一个死信topic中；注意，这里是springboot2.7及以上版本的配置方式，和2.7以下版本配置方法不同</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> CommonErrorHandler <span class="hljs-title function_">errorHandler</span><span class="hljs-params">(KafkaTemplate&lt;Object, Object&gt; template)</span> {
        <span class="hljs-comment">// 1. 定义死信恢复器,当重试耗尽后，将消息转发到 "原Topic.DLT"</span>
        <span class="hljs-type">DeadLetterPublishingRecoverer</span> <span class="hljs-variable">recover</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeadLetterPublishingRecoverer</span>(template);
        
        <span class="hljs-comment">// 2. 定义错误处理器</span>
        <span class="hljs-type">DefaultErrorHandler</span> <span class="hljs-variable">errorHandler</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultErrorHandler</span>(recover, <span class="hljs-keyword">new</span> <span class="hljs-title class_">FixedBackOff</span>(<span class="hljs-number">1000L</span>, <span class="hljs-number">3</span>));

        <span class="hljs-keyword">return</span> errorHandler;
    }
}
</code></pre>
</li>
<li>
<p>生产者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@CrossOrigin</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/kafka")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> KafkaTemplate&lt;String, String&gt; kafkaTemplate;

    <span class="hljs-meta">@RequestMapping("/send")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">send</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedHashMap</span>&lt;&gt;();
        map.put(<span class="hljs-string">"userid"</span>, <span class="hljs-number">1001</span>);
        map.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"ccb"</span>+ UUID.randomUUID());

        ListenableFuture&lt;SendResult&lt;String, String&gt;&gt; result = kafkaTemplate.send(<span class="hljs-string">"test_ccb"</span>, JSONObject.toJSONString(map));
        System.out.println(<span class="hljs-string">"发送结果："</span>+result.get());
        <span class="hljs-keyword">return</span> <span class="hljs-string">"ok"</span>;
    }
}
</code></pre>
</li>
<li>
<p>消费者</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KafkaConsumer</span> {

    <span class="hljs-comment">// 这里的concurrency=5代表会创建5个消费者实例</span>
    <span class="hljs-meta">@KafkaListener(topics = {"test_ccb"},concurrency = "5")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumer</span><span class="hljs-params">(ConsumerRecord&lt;?, ?&gt; consumerRecord, Acknowledgment ack)</span> {
        System.out.println(<span class="hljs-string">"收到消息："</span> + consumerRecord);
        ack.acknowledge();
    }
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-5">Spring-Kafka原理</h4>
<ul>
<li><code>spring-kafka</code>的自动配置类中，通过<code>KafkaListenerAnnotationBeanPostProcessor </code>扫描每个Bean对象是否带有<code>@KafkaListener</code>注解，如果有则提取注解上的<code>topics</code>、<code>groupId</code>、<code>concurrency</code>等信息封装成一个Endpoint对象，根据Endpoint指定的容器工厂containerFactory创建容器，在容器内运行<code>KafkaConsumer</code></li>
<li>容器工厂是<code>ConcurrentKafkaListenerContainerFactory</code>，它生产容器<code>KafkaMessageListenerContainer</code>，在容器内运行<code>KafkaConsumer</code>，如果<code>concurrency</code>设置为3，将创建3个容器，也就是会有3个消费者实例</li>
<li>如果程序处理过程中出现了错误，会调用配置好的 <code>CommonErrorHandler</code>进行处理，默认会重试9次，如果还是失败，则提交该偏移量避免阻塞后续消息</li>
<li>gemini3剖析过程：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fshare%2F4de8006d21e2" target="_blank" title="https://gemini.google.com/share/4de8006d21e2" ref="nofollow noopener noreferrer">gemini.google.com/share/4de80…</a></li>
</ul>
<h4 data-id="heading-6">相关文章</h4>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2185118" target="_blank" title="https://cloud.tencent.com/developer/article/2185118" ref="nofollow noopener noreferrer">3分钟带你彻底搞懂 Kafka-腾讯云开发者社区-腾讯云</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.tencent.com%2Fdeveloper%2Farticle%2F2185123" target="_blank" title="https://cloud.tencent.com/developer/article/2185123" ref="nofollow noopener noreferrer">【真实生产案例】SpringBoot 整合 Kafka 实现数据高吞吐-腾讯云开发者社区-腾讯云</a></p>
</li>
<li>
<p>spring-kafka分析：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgemini.google.com%2Fshare%2F4de8006d21e2" target="_blank" title="https://gemini.google.com/share/4de8006d21e2" ref="nofollow noopener noreferrer">gemini.google.com/share/4de80…</a></p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Uni-app 性能天坑：为什么 v-if 删不掉 DOM 节点]]></title>    <link>https://juejin.cn/post/7589074117644288035</link>    <guid>https://juejin.cn/post/7589074117644288035</guid>    <pubDate>2025-12-29T09:22:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7589074117644288035" data-draft-id="7589063105731723279" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Uni-app 性能天坑：为什么 v-if 删不掉 DOM 节点"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-29T09:22:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="heyCHEEMS"/> <meta itemprop="url" content="https://juejin.cn/user/4308367489378780"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Uni-app 性能天坑：为什么 v-if 删不掉 DOM 节点
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4308367489378780/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    heyCHEEMS
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-29T09:22:27.000Z" title="Mon Dec 29 2025 09:22:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-29
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开发自定义 Swiper 或长列表组件时，为了优化性能，我们通常会给每一项加上懒加载逻辑：</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"shouldRender"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">:name</span>=<span class="hljs-string">"'slot-' + index"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<p><strong>神奇的事情发生了：</strong> 哪怕 <code>shouldRender</code> 是 <code>false</code>，打开小程序调试器一看，WXML 树里依然排满了 <code>view slot="slot-0"</code>、<code>view slot="slot-1"</code>... 里面甚至还塞满了图片节点。</p>
<p><strong>结论：你的 v-if 只是“隐藏”了视觉，内存和 DOM 压力一点没减。</strong></p>
<hr/>
<h3 data-id="heading-0">二、 具名插槽是“物理坑位”</h3>
<p>为什么 <code>v-if</code> 失效了？因为在微信小程序底层，<strong>具名插槽（Named Slots）</strong> 的实现逻辑是<strong>静态枚举</strong>。</p>
<ol>
<li><strong>预编译挖坑</strong>：小程序原生不支持动态插槽名。Uni-app 编译器为了兼容 Vue，会根据你的循环逻辑，在 WXML 里预先写死所有的占位符（如 <code>slot="d-0"</code>, <code>slot="d-1"</code>）。</li>
<li><strong>渲染权倒置</strong>：在具名插槽模式下，<strong>父组件拥有内容的实例化权</strong>。父组件会先把所有内容节点生成好，然后再“分发”给子组件。</li>
<li><strong>隔离失败</strong>：子组件里的 <code>v-if</code> 只能决定子组件自己是否显示，但挡不住父组件已经产生的物理节点。这就好比<strong>虽然你把家门关了（v-if=false），但邻居已经把货卸在了你门口（DOM 占位）</strong> 。</li>
</ol>
<hr/>
<h3 data-id="heading-1">三、 作用域插槽是“动态模版”</h3>
<p>要实现真正的懒加载（随 <code>v-if</code> 销毁 DOM），必须重构为<strong>作用域插槽（Scoped Slots）</strong> 。</p>
<h4 data-id="heading-2">1. 子组件改造：变“多坑”为“单模板”</h4>
<p>不要再给插槽起动态名字，统一使用带作用域的默认插槽或具名插槽。</p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">view</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"shouldRender(index)"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"content"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">view</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">2. 父组件调用 禁止 v-for 填充</h4>
<p>这是最关键的——<strong>父组件不再负责循环产生节点，只提供渲染模板。</strong></p>
<pre><code class="hljs language-HTML" lang="HTML"><span class="hljs-tag">&lt;<span class="hljs-name">Swiper</span> <span class="hljs-attr">:list</span>=<span class="hljs-string">"dataList"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-slot:content</span>=<span class="hljs-string">"{ item }"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">"item.url"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">Swiper</span>&gt;</span>
</code></pre>
<hr/>
<h3 data-id="heading-4">四、 为什么换成作用域插槽就生效了？</h3>
<p>这是底层架构的质变：</p>
<ul>
<li><strong>实例化时机改变</strong>：作用域插槽在小程序里被编译为 <code>template</code> 逻辑。<strong>实例化内容的控制权移交给了子组件</strong>。</li>
<li><strong>按需生成</strong>：只有子组件运行到 <code>v-if="true"</code> 且执行到 <code>&lt;slot /&gt;</code> 那一行代码时，父组件定义的“模板”才会动态转变为真正的 DOM。</li>
<li><strong>地基都没了</strong>：如果 <code>v-if="false"</code>，这段代码压根不会跑，父组件的内容在内存里连影子都不会出现。</li>
</ul>
<hr/>
<h3 data-id="heading-5">五、 避坑小结</h3>
<p>如果你在 Uni-app 开发者工具里发现 DOM 节点数不对劲，请检查以下两点：</p>
<ol>
<li><strong>是否在循环里用了动态具名插槽？</strong> （<code>:name="'xxx' + index"</code>）</li>
<li><strong>父组件是否也写了 <code>v-for</code> 去填坑？</strong></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>