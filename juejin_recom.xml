<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[如何让AI设计出Apple风格的顶级UI？]]></title>    <link>https://juejin.cn/post/7581423932612329512</link>    <guid>https://juejin.cn/post/7581423932612329512</guid>    <pubDate>2025-12-09T01:46:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581423932612329512" data-draft-id="7579892222608736291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何让AI设计出Apple风格的顶级UI？"/> <meta itemprop="keywords" content="前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-09T01:46:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端九哥"/> <meta itemprop="url" content="https://juejin.cn/user/3659622444970574"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何让AI设计出Apple风格的顶级UI？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3659622444970574/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端九哥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:46:02.000Z" title="Tue Dec 09 2025 01:46:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c5bb5877de2402c87c0c6e9c6330b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5Lmd5ZOl:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849562&amp;x-signature=A7nGowBuz1QVnUw8fMwUWg0Wkhc%3D" alt="export_1764901938560.gif" loading="lazy"/></p>
<p>如何让AI设计出Apple风格的顶级UI？给ai投喂以下提示词即可让你的页面变得和apple官网一样好看</p>
<h2 data-id="heading-0">提示词</h2>
<pre><code class="hljs language-md" lang="md"><span class="hljs-section"># Role (角色设定)</span>

你是一位世界顶级的 UI 工程师和创意开发专家，深谙 Apple 的设计哲学（Human Interface Guidelines）以及 Apple 官网的网页设计美学。你擅长将普通的 UI 代码重构为具有“Apple 质感”的顶级界面。

<span class="hljs-section"># Goal (任务目标)</span>

我将提供一个现有的代码项目。请你参考 Block Studio 对 Apple 风格的深度解析，对我提供的代码进行<span class="hljs-strong">**全方位重构**</span>。

<span class="hljs-section"># Design Principles (核心设计法则)</span>

请在重构时严格执行以下 6 大维度的设计规范：

<span class="hljs-section">### 1. 布局与结构：Bento Grid (便当盒美学)</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**模块化容器：**</span> 将内容重组为圆角矩形的“卡片”，形成 Bento Grid 网格布局。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**间距 (Gap)：**</span> 保持宽敞统一的间距（24px - 32px），拒绝拥挤。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**全宽与居中：**</span> 大屏限制最大宽度（如 1120px）并居中，小屏自动堆叠。

<span class="hljs-section">### 2. 氛围与材质：Aurora &amp; Glass (极光与毛玻璃) ✨</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Ambient Background (动态弥散背景):**</span> 
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Base:**</span> 使用 <span class="hljs-code">`#F5F5F7`</span> 作为画布底色。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Orbs (光球):**</span> 在背景层放置 2-3 个巨大的圆形元素 (50vw-60vw)，使用 <span class="hljs-code">`fixed`</span> 定位。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Gradient:**</span> 光球填充径向渐变，推荐配色：淡蓝 <span class="hljs-code">`rgba(162, 210, 255, 0.4)`</span> 和 淡紫 <span class="hljs-code">`rgba(200, 180, 255, 0.3)`</span>。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Blur:**</span> 强制应用极大的高斯模糊 (<span class="hljs-code">`filter: blur(80px)`</span> 或更高)，使颜色柔和融合。
<span class="hljs-bullet">    *</span>   <span class="hljs-strong">**Animation:**</span> 添加缓慢的 infinite 浮动动画，让光斑有轻微的呼吸感。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Glassmorphism (毛玻璃):**</span> 卡片背景使用半透明白色 (<span class="hljs-code">`rgba(255, 255, 255, 0.8)`</span>) 配合 <span class="hljs-code">`backdrop-filter: blur(20px)`</span>，让背景的极光色能隐约透出。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Squircle:**</span> 所有卡片使用连续曲率大圆角 (24px)。

<span class="hljs-section">### 3. 组件层级：Button &amp; Input Hierarchy</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Primary Buttons (主按钮):**</span> 核心行动。使用<span class="hljs-strong">**品牌蓝实心填充**</span> (#0071e3) + 白色文字 + 胶囊圆角。Hover 时亮度提升或带光晕。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Secondary Buttons (次级按钮):**</span> 辅助行动（如“选择文件”）。<span class="hljs-strong">**禁止使用透明背景**</span>。必须使用<span class="hljs-strong">**浅灰色实心填充**</span> (#E5E5EA 或 rgba(0,0,0,0.05)) + 深色文字，确保在白色卡片上清晰可见。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Inputs (输入框):**</span> 移除默认边框。使用浅灰背景 (#F2F2F7) + 深色文字。Focus 时背景变白 + 品牌色光晕。

<span class="hljs-section">### 4. 排版与信息：Big Type</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**字体：**</span> 强制使用系统字体栈 (<span class="hljs-code">`-apple-system`</span>, <span class="hljs-code">`SF Pro`</span>, <span class="hljs-code">`PingFang SC`</span>)。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**层级：**</span> 标题粗黑 (700)，正文清晰 (400)，注释灰色 (#86868b)。标题字间距微缩 (-0.02em)。

<span class="hljs-section">### 5. 动效：Physics (物理感)</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**非线性：**</span> 所有 Hover/Transition 必须使用弹簧曲线 (e.g., <span class="hljs-code">`cubic-bezier(0.25, 1, 0.5, 1)`</span>).
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**反馈：**</span> 按钮 Hover 时必须有 <span class="hljs-strong">**Scale (1.02)**</span> 或 <span class="hljs-strong">**Brightness**</span> 变化。
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**入场：**</span> 页面加载时，卡片应带有 <span class="hljs-code">`fade-in-up`</span> (淡入上浮) 的序列动画。

<span class="hljs-section">### 6. 细节修饰</span>
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Hairlines:**</span> 边框和分割线使用 1px 半透明线 (<span class="hljs-code">`rgba(255,255,255,0.6)`</span> 或 <span class="hljs-code">`rgba(0,0,0,0.1)`</span>).
<span class="hljs-bullet">*</span>   <span class="hljs-strong">**Icons:**</span> 使用 Emoji 或 SF Symbols 风格图标，可搭配微渐变背景容器。

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[3分钟Solidity: 3.3 Enum枚举]]></title>    <link>https://juejin.cn/post/7581299982671839266</link>    <guid>https://juejin.cn/post/7581299982671839266</guid>    <pubDate>2025-12-08T15:50:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581299982671839266" data-draft-id="7581314241410842659" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="3分钟Solidity: 3.3 Enum枚举"/> <meta itemprop="keywords" content="Solidity,web3,区块链"/> <meta itemprop="datePublished" content="2025-12-08T15:50:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Rockbean"/> <meta itemprop="url" content="https://juejin.cn/user/4054654615823560"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            3分钟Solidity: 3.3 Enum枚举
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4054654615823560/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Rockbean
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:50:45.000Z" title="Mon Dec 08 2025 15:50:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如需获取本内容的最新版本，请参见 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cyfrin.io%2Fglossary%2Fenum-solidity-code-example" target="_blank" title="https://www.cyfrin.io/glossary/enum-solidity-code-example" ref="nofollow noopener noreferrer">Cyfrin.io 上的 Enum（代码示例）</a></p>
<p>Solidity支持枚举类型，它们非常适合用于建模选择项和跟踪状态。
枚举可以在合约外部声明。</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

contract Enum {
    // 表示运输状态的枚举
    enum Status {
        Pending,
        Shipped,
        Accepted,
        Rejected,
        Canceled
    }

    // 默认值是类型定义中列出的第一个元素，本例中为“Pending”
    Status public status;

    // 返回无符号整数
    // Pending  - 0
    // Shipped  - 1
    // Accepted - 2
    // Rejected - 3
    // Canceled - 4
    function get() public view returns (Status) {
        return status;
    }

    // 通过将无符号整数传递到输入来更新状态
    function set(Status _status) public {
        status = _status;
    }

    // 你可以像这样更新到特定的枚举
    function cancel() public {
        status = Status.Canceled;
    }

    // 删除会将枚举重置为其第一个值，0
    function reset() public {
        delete status;
    }
}
</code></pre>
<p>Remix Lite <a href="https://link.juejin.cn?target=https%3A%2F%2Fremix.byteatatime.dev%2F%3F%23code%3DLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmNvbnRyYWN0IEVudW0gewogICAgLy8gRW51bSByZXByZXNlbnRpbmcgc2hpcHBpbmcgc3RhdHVzCiAgICBlbnVtIFN0YXR1cyB7CiAgICAgICAgUGVuZGluZywKICAgICAgICBTaGlwcGVkLAogICAgICAgIEFjY2VwdGVkLAogICAgICAgIFJlamVjdGVkLAogICAgICAgIENhbmNlbGVkCiAgICB9CgogICAgLy8gRGVmYXVsdCB2YWx1ZSBpcyB0aGUgZmlyc3QgZWxlbWVudCBsaXN0ZWQgaW4KICAgIC8vIGRlZmluaXRpb24gb2YgdGhlIHR5cGUsIGluIHRoaXMgY2FzZSAiUGVuZGluZyIKICAgIFN0YXR1cyBwdWJsaWMgc3RhdHVzOwoKICAgIC8vIFJldHVybnMgdWludAogICAgLy8gUGVuZGluZyAgLSAwCiAgICAvLyBTaGlwcGVkICAtIDEKICAgIC8vIEFjY2VwdGVkIC0gMgogICAgLy8gUmVqZWN0ZWQgLSAzCiAgICAvLyBDYW5jZWxlZCAtIDQKICAgIGZ1bmN0aW9uIGdldCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXR1cykgewogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CgogICAgLy8gVXBkYXRlIHN0YXR1cyBieSBwYXNzaW5nIHVpbnQgaW50byBpbnB1dAogICAgZnVuY3Rpb24gc2V0KFN0YXR1cyBfc3RhdHVzKSBwdWJsaWMgewogICAgICAgIHN0YXR1cyA9IF9zdGF0dXM7CiAgICB9CgogICAgLy8gWW91IGNhbiB1cGRhdGUgdG8gYSBzcGVjaWZpYyBlbnVtIGxpa2UgdGhpcwogICAgZnVuY3Rpb24gY2FuY2VsKCkgcHVibGljIHsKICAgICAgICBzdGF0dXMgPSBTdGF0dXMuQ2FuY2VsZWQ7CiAgICB9CgogICAgLy8gZGVsZXRlIHJlc2V0cyB0aGUgZW51bSB0byBpdHMgZmlyc3QgdmFsdWUsIDAKICAgIGZ1bmN0aW9uIHJlc2V0KCkgcHVibGljIHsKICAgICAgICBkZWxldGUgc3RhdHVzOwogICAgfQp9Cg%3D%3D" target="_blank" title="https://remix.byteatatime.dev/?#code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmNvbnRyYWN0IEVudW0gewogICAgLy8gRW51bSByZXByZXNlbnRpbmcgc2hpcHBpbmcgc3RhdHVzCiAgICBlbnVtIFN0YXR1cyB7CiAgICAgICAgUGVuZGluZywKICAgICAgICBTaGlwcGVkLAogICAgICAgIEFjY2VwdGVkLAogICAgICAgIFJlamVjdGVkLAogICAgICAgIENhbmNlbGVkCiAgICB9CgogICAgLy8gRGVmYXVsdCB2YWx1ZSBpcyB0aGUgZmlyc3QgZWxlbWVudCBsaXN0ZWQgaW4KICAgIC8vIGRlZmluaXRpb24gb2YgdGhlIHR5cGUsIGluIHRoaXMgY2FzZSAiUGVuZGluZyIKICAgIFN0YXR1cyBwdWJsaWMgc3RhdHVzOwoKICAgIC8vIFJldHVybnMgdWludAogICAgLy8gUGVuZGluZyAgLSAwCiAgICAvLyBTaGlwcGVkICAtIDEKICAgIC8vIEFjY2VwdGVkIC0gMgogICAgLy8gUmVqZWN0ZWQgLSAzCiAgICAvLyBDYW5jZWxlZCAtIDQKICAgIGZ1bmN0aW9uIGdldCgpIHB1YmxpYyB2aWV3IHJldHVybnMgKFN0YXR1cykgewogICAgICAgIHJldHVybiBzdGF0dXM7CiAgICB9CgogICAgLy8gVXBkYXRlIHN0YXR1cyBieSBwYXNzaW5nIHVpbnQgaW50byBpbnB1dAogICAgZnVuY3Rpb24gc2V0KFN0YXR1cyBfc3RhdHVzKSBwdWJsaWMgewogICAgICAgIHN0YXR1cyA9IF9zdGF0dXM7CiAgICB9CgogICAgLy8gWW91IGNhbiB1cGRhdGUgdG8gYSBzcGVjaWZpYyBlbnVtIGxpa2UgdGhpcwogICAgZnVuY3Rpb24gY2FuY2VsKCkgcHVibGljIHsKICAgICAgICBzdGF0dXMgPSBTdGF0dXMuQ2FuY2VsZWQ7CiAgICB9CgogICAgLy8gZGVsZXRlIHJlc2V0cyB0aGUgZW51bSB0byBpdHMgZmlyc3QgdmFsdWUsIDAKICAgIGZ1bmN0aW9uIHJlc2V0KCkgcHVibGljIHsKICAgICAgICBkZWxldGUgc3RhdHVzOwogICAgfQp9Cg==" ref="nofollow noopener noreferrer">尝试一下</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2db9d26e22e44bedac1f02f2c724e22d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja2JlYW4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813845&amp;x-signature=P0TPWfRs%2FqH8OhzjoecVDDpiaXQ%3D" alt="solidity-Enum枚举" loading="lazy"/></p>
<h2 data-id="heading-0">声明和导入枚举</h2>
<p>声明枚举的文件</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;
// 这是保存的'EnumDeclaration.sol'

enum Status {
    Pending,
    Shipped,
    Accepted,
    Rejected,
    Canceled
}
</code></pre>
<p>Remix <a href="https://link.juejin.cn?target=https%3A%2F%2Fremix.ethereum.org%2F%3F%23code%3DLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKLy8gVGhpcyBpcyBzYXZlZCAnRW51bURlY2xhcmF0aW9uLnNvbCcKCmVudW0gU3RhdHVzIHsKICAgIFBlbmRpbmcsCiAgICBTaGlwcGVkLAogICAgQWNjZXB0ZWQsCiAgICBSZWplY3RlZCwKICAgIENhbmNlbGVkCn0K" target="_blank" title="https://remix.ethereum.org/?#code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKLy8gVGhpcyBpcyBzYXZlZCAnRW51bURlY2xhcmF0aW9uLnNvbCcKCmVudW0gU3RhdHVzIHsKICAgIFBlbmRpbmcsCiAgICBTaGlwcGVkLAogICAgQWNjZXB0ZWQsCiAgICBSZWplY3RlZCwKICAgIENhbmNlbGVkCn0K" ref="nofollow noopener noreferrer">尝试一下</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/532f672f7d5942c78bc430dfe52f71b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja2JlYW4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813845&amp;x-signature=cpUBvPJkn4tfI6De4oG%2BHiaVE8Y%3D" alt="solidity-enum枚举声明" loading="lazy"/></p>
<p>导入上述枚举的文件</p>
<pre><code class="hljs language-solidity" lang="solidity">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.26;

import "./EnumDeclaration.sol";

contract Enum {
    Status public status;
}
</code></pre>
<p>Remix Lite <a href="https://link.juejin.cn?target=https%3A%2F%2Fremix.byteatatime.dev%2F%3F%23code%3DLy8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmltcG9ydCAiLi9FbnVtRGVjbGFyYXRpb24uc29sIjsKCmNvbnRyYWN0IEVudW0gewogICAgU3RhdHVzIHB1YmxpYyBzdGF0dXM7Cn0K" target="_blank" title="https://remix.byteatatime.dev/?#code=Ly8gU1BEWC1MaWNlbnNlLUlkZW50aWZpZXI6IE1JVApwcmFnbWEgc29saWRpdHkgXjAuOC4yNjsKCmltcG9ydCAiLi9FbnVtRGVjbGFyYXRpb24uc29sIjsKCmNvbnRyYWN0IEVudW0gewogICAgU3RhdHVzIHB1YmxpYyBzdGF0dXM7Cn0K" ref="nofollow noopener noreferrer">尝试一下</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bf5c434f50a4c129362146087ddd5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja2JlYW4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813845&amp;x-signature=Bfq3cmPpL3%2BG9VWiY%2FRMHQL48%2Fk%3D" alt="solidity-enum枚举导入" loading="lazy"/></p>
<hr/>
<p>END</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文吃透Vue Diff原理：从核心逻辑到实战避坑]]></title>    <link>https://juejin.cn/post/7581210455827660836</link>    <guid>https://juejin.cn/post/7581210455827660836</guid>    <pubDate>2025-12-08T12:19:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581210455827660836" data-draft-id="7581097111896539190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文吃透Vue Diff原理：从核心逻辑到实战避坑"/> <meta itemprop="keywords" content="Vue.js,前端"/> <meta itemprop="datePublished" content="2025-12-08T12:19:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dgua"/> <meta itemprop="url" content="https://juejin.cn/user/1135111924890654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文吃透Vue Diff原理：从核心逻辑到实战避坑
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1135111924890654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dgua
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:19:06.000Z" title="Mon Dec 08 2025 12:19:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一文吃透Vue Diff原理：从核心逻辑到实战避坑</h2>
<p>在Vue的性能优化里，Diff算法绝对是“幕后功臣”——它解决的是虚拟DOM更新时，“怎么精准找到变了的节点，还不费性能”这个核心问题。不少同学用Vue开发时只管写业务，对Diff算法总有点“雾里看花”的感觉：为啥v-for非加key不可？Vue2和Vue3的Diff到底差在哪儿？今天咱们就从原理讲到实操，把这些疑问彻底掰明白。</p>
<h3 data-id="heading-1">Diff是虚拟DOM的“最佳拍档”</h3>
<p>聊Diff之前，先掰扯清楚一个核心关系：Diff算法是跟着虚拟DOM一起出现的“最佳拍档”。咱们都知道操作真实DOM特别费性能，改一下就可能触发重排重绘；而虚拟DOM说白了就是个描述真实DOM的JS对象，咱们看个简单例子就懂了：</p>
<pre><code class="hljs language-css" lang="css">// 虚拟DOM节点示例
const vnode = {
  tag: <span class="hljs-string">'div'</span>,
  props: { class: <span class="hljs-string">'container'</span> },
  children: [
    { tag: <span class="hljs-string">'p'</span>, props: {}, children: [<span class="hljs-string">'Vue Diff'</span>] }
  ]
}
</code></pre>
<p>组件状态一变，Vue就会生成新的虚拟DOM树。这时候要是直接把整个真实DOM全换掉，页面肯定卡得不行——Diff算法的作用就是“找茬”：对比新旧两棵虚拟DOM树，只把“不一样的地方”转换成真实DOM操作，做到“改得少、改得准”。</p>
<p>核心目标就一个：<strong>用最少的DOM操作搞定更新，别做无用功</strong>。</p>
<h3 data-id="heading-2">Diff的三大“偷懒”技巧，决定了它的高效</h3>
<p>Vue的Diff不是凭空造的，而是Vue团队摸透了前端开发的套路——总结出三大核心策略，既保证了性能，又没把算法搞得多复杂。</p>
<h4 data-id="heading-3">1. 只比同层，不钻深层</h4>
<p>日常开发里，谁会没事把div里的p标签直接挪到body下面？Vue就抓住了这点，Diff的时候只逐层对比节点。要是某一层某个节点没了，直接删了它和它的子节点，根本不往下钻——省了大笔遍历的功夫。</p>
<p>就靠这招，Diff的时间复杂度从吓人的O(n³)（全量对比）降到了O(n)（顺着扫一遍），性能直接上了个台阶。</p>
<p>举个例子：旧树是div，新树也是div，就接着比它们的子节点；要是新树这儿变成了span，那没二话——把旧div连锅端，直接插新span进去。</p>
<h4 data-id="heading-4">2. 先看类型，不对就换</h4>
<p>同层对比时，Vue先看节点“身份”——是p标签还是button，是普通组件还是路由组件。</p>
<ul>
<li>要是类型不一样（比如旧的是p，新的是button）：直接判定这俩是“完全不同的节点”，删旧的插新的就行。毕竟类型都变了，内部结构大概率也不一样，再比下去纯属浪费时间。</li>
<li>要是类型相同：再去细抠属性（class、style这些）和子节点，精准更新变化的地方。</li>
</ul>
<h4 data-id="heading-5">3. 靠key认人，避免张冠李戴</h4>
<p>这招最容易被新手忽略，但恰恰是Diff的“精准度关键”。比如渲染列表，全是li标签，光看类型根本分不清谁是谁——哪个该留？哪个是新加的？哪个被删了？</p>
<p>key就是给每个节点发的“身份证”，让Vue一眼就能认出它的“前世今生”。咱们看两组代码对比：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 坏例子：用index当key --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"(item, index) in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"index"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 好例子：用唯一ID当key --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in list"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span>&gt;</span>{{ item.name }}<span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
</code></pre>
<p>日常开发里，列表增删改查是常事。用item.id这种唯一key，Vue能精准匹配到可复用的节点，只改内容不用重建DOM；但要是用index当key，列表一排序，index和节点就“对不上号”了——Vue会误判节点变化，要么瞎删瞎建浪费性能，要么数据和节点对应错了，出各种诡异BUG。</p>
<p>血的教训：key必须是“不变且唯一”的！index和随机数不行！</p>
<h3 data-id="heading-6">Diff是怎么跑起来的？从根到子的完整流程</h3>
<p>把这三个策略落地，Vue Diff的执行逻辑就清晰了。咱们以Vue2为例子拆解（Vue3是升级款，后面单独说），整个过程分“根节点对比”和“子节点对比”两步走。</p>
<h4 data-id="heading-7">第一步：根节点“初筛”</h4>
<p>先拿新旧虚拟DOM的根节点开刀，分三种情况处理，特别直接：</p>
<ol>
<li><strong>新根节点没了</strong>：旧根节点对应的真实DOM直接删。</li>
<li><strong>旧根节点没了</strong>：新根节点直接渲染成真实DOM插页面上。</li>
<li><strong>新旧都在</strong>：先看类型——类型不对就换，类型对了就接着更属性、比子节点。</li>
</ol>
<p>属性更新很简单：比如旧节点class是red，新的是blue，就只改class这一个属性，其他不动——绝不做多余操作。</p>
<h4 data-id="heading-8">第二步：子节点“细比”（列表Diff的重头戏）</h4>
<p>子节点对比是Diff最绕的地方，但Vue2的“双指针法”把它捋得很明白。简单说就是在新旧子节点列表的首尾各放一个指针，通过移动指针快速找匹配的节点，分四步走：</p>
<ol>
<li><strong>首尾配对</strong>：旧头对新头、旧尾对新尾，能对上就直接复用，指针往中间挪。</li>
<li><strong>旧尾对新头</strong>：要是旧尾和新头配上了，说明这节点被移到最前面了——复用它，再把它挪到对应位置。</li>
<li><strong>旧头对新尾</strong>：旧头和新尾配上，就是节点被移到最后了，复用后调指针就行。</li>
<li><strong>key兜底</strong>：前面都没配上，就用新节点的key去旧列表里搜。搜到了就复用移动，搜不到就新增；最后把旧列表里没配上的节点全删掉。</li>
</ol>
<p>这套逻辑对付列表增删、首尾移动特别高效，但有个小短板——在列表中间插节点时，可能要多挪几次。这也是Vue3 Diff重点优化的地方。</p>
<h3 data-id="heading-9">Vue2 vs Vue3：Diff算法的“进化史”</h3>
<p>Vue3的Diff没丢核心思路，但在性能上做了大升级——目标很明确：大型列表更新时更快、更省资源。核心差异就三点，咱们用表格看得更清楚：</p>






























<table><thead><tr><th>对比维度</th><th>Vue2 Diff</th><th>Vue3 Diff</th></tr></thead><tbody><tr><td>核心算法</td><td>双指针法（首尾对比）</td><td>快速Diff（基于最长递增子序列）</td></tr><tr><td>处理效率</td><td>中间插入节点时需多次移动</td><td>通过最长递增子序列确定最少移动次数</td></tr><tr><td>编译优化</td><td>无编译干预，纯运行时Diff</td><td>编译时标记静态节点，Diff时直接跳过</td></tr><tr><td>适用场景</td><td>中小型列表，简单DOM结构</td><td>大型列表，复杂DOM结构</td></tr></tbody></table>
<p>举个实在的例子：1000个节点的列表，在中间插一个新节点。Vue2可能要挪动后面500个节点才能搞定，而Vue3靠“最长递增子序列”算法，能精准算出“哪些节点不用动”，只挪必要的几个——性能提升不是一点半点。</p>
<h3 data-id="heading-10">实战避坑：懂Diff才能少踩坑</h3>
<p>搞懂Diff不是为了面试背题，而是真能帮你写出更丝滑的代码。这三个实战场景，一定要记牢。</p>
<h4 data-id="heading-11">1. v-for的key，就用后端给的唯一ID</h4>
<p>再强调一次：key就用后端返回的userId、goodsId这种“天生唯一”的值。别图省事用index——列表一排序就出问题；更别用Math.random()——每次渲染都生成新key，节点根本没法复用，页面直接变卡。</p>
<h4 data-id="heading-12">2. 条件渲染别瞎换标签</h4>
<p>做条件显示时，别一会儿用p一会儿用div。尽量用同一个标签配合v-show——标签类型不变，Vue只改display属性，比删旧节点插新节点快多了：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 坏例子：标签类型变化，触发节点替换 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"show"</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-else</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- 好例子：标签类型不变，只更新内容 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-show</span>=<span class="hljs-string">"show"</span>&gt;</span>内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h4 data-id="heading-13">3. 静态节点别让Diff白费劲</h4>
<p>那些纯文本、没绑定数据的节点（比如页面标题、固定说明），就是“静态节点”。Vue3会自动识别它们，Diff时直接跳过；Vue2里可以加个v-pre指令，告诉Vue“这货不用比”，省点性能：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 静态节点，Diff时不对比 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-pre</span>&gt;</span>这是固定内容<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<h3 data-id="heading-14">最后总结：Diff的核心到底是什么？</h3>
<p>说到底，Vue Diff算法就是一套“贴合前端实际的性能优化方案”。它没追求理论上最完美的算法，而是用“只比同层、先看类型、key认节点”这三招，在“性能”和“复杂度”之间找到了平衡点——这才是最聪明的设计。</p>
<p>最后记牢这三句话，就算把Diff吃透了：</p>
<ul>
<li>Diff是虚拟DOM的“辅助工具”，核心目的是减少DOM操作；</li>
<li>key是节点的“身份证”，稳定、唯一是底线；</li>
<li>Vue3的Diff靠编译优化和算法升级，复杂列表更新更给力。</li>
</ul>
<p>想挖得更深的同学，直接去翻源码就行：
Vue2的Diff在src/core/vdom/patch.js，
Vue3的在packages/runtime-core/src/renderer.ts。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[事件冒泡和事件捕获详解]]></title>    <link>https://juejin.cn/post/7581406561685225518</link>    <guid>https://juejin.cn/post/7581406561685225518</guid>    <pubDate>2025-12-08T13:12:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581406561685225518" data-draft-id="7581406561685094446" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="事件冒泡和事件捕获详解"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-08T13:12:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="之恒君"/> <meta itemprop="url" content="https://juejin.cn/user/2261046026312318"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            事件冒泡和事件捕获详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2261046026312318/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    之恒君
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:12:57.000Z" title="Mon Dec 08 2025 13:12:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-estuary-light">.hljs-comment,.hljs-quote{color:#6c6b5a}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ba6236}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#ae7313}.hljs-bullet,.hljs-string,.hljs-symbol{color:#7d9726}.hljs-section,.hljs-title{color:#36a166}.hljs-keyword,.hljs-selector-tag{color:#5f9182}.hljs-addition,.hljs-deletion{color:#22221b;display:inline-block;width:100%}.hljs-deletion{background-color:#ba6236}.hljs-addition{background-color:#7d9726}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f4f3ec;color:#5f5e4e}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>事件流描述了事件在 DOM 树中传播的顺序。理解事件流是掌握事件处理的关键。</p>
<h2 data-id="heading-0">1. 基本概念</h2>
<h3 data-id="heading-1">事件流三阶段</h3>
<pre><code class="hljs language-markdown" lang="markdown">// 事件传播的完整流程
<span class="hljs-bullet">1.</span> 捕获阶段 (Capturing Phase): 从上往下
<span class="hljs-bullet">2.</span> 目标阶段 (Target Phase): 到达目标元素
<span class="hljs-bullet">3.</span> 冒泡阶段 (Bubbling Phase): 从下往上
</code></pre>
<h3 data-id="heading-2">示例 DOM 结构</h3>
<pre><code class="hljs language-js" lang="js">&lt;div id=<span class="hljs-string">"grandparent"</span> style=<span class="hljs-string">"padding: 50px; background-color: #f0f0f0;"</span>&gt;
  <span class="hljs-title class_">Grandparent</span>
  &lt;div id=<span class="hljs-string">"parent"</span> style=<span class="hljs-string">"padding: 30px; background-color: #e0e0e0;"</span>&gt;
    <span class="hljs-title class_">Parent</span>
    &lt;button id=<span class="hljs-string">"child"</span> style=<span class="hljs-string">"padding: 20px; background-color: #d0d0d0;"</span>&gt;
      <span class="hljs-title class_">Click</span> me!
    &lt;/button&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// JavaScript</span>
<span class="hljs-keyword">const</span> grandparent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'grandparent'</span>);
<span class="hljs-keyword">const</span> parent = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'parent'</span>);
<span class="hljs-keyword">const</span> child = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'child'</span>);
</code></pre>
<h2 data-id="heading-3">2. 捕获阶段 (Capturing Phase)</h2>
<h3 data-id="heading-4">特点</h3>
<ul>
<li>从 window → document → ... → 目标元素</li>
<li>自上而下传播</li>
<li>默认不监听此阶段</li>
</ul>
<h3 data-id="heading-5">使用方法</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 在 addEventListener 的第三个参数设置为 true</span>
grandparent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Grandparent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);  <span class="hljs-comment">// true 表示在捕获阶段处理</span>

parent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);
</code></pre>
<h2 data-id="heading-6">3. 冒泡阶段 (Bubbling Phase)</h2>
<h3 data-id="heading-7">特点</h3>
<ul>
<li>从目标元素 → ... → document → window</li>
<li>自下而上传播</li>
<li>默认行为（第三个参数为 false 或省略）</li>
</ul>
<h3 data-id="heading-8">使用方法</h3>
<pre><code class="hljs language-js" lang="js">grandparent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Grandparent: 冒泡阶段'</span>);
}, <span class="hljs-literal">false</span>);  <span class="hljs-comment">// false 或不指定表示冒泡阶段</span>

parent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parent: 冒泡阶段'</span>);
});

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child: 冒泡阶段'</span>);
});
</code></pre>
<h2 data-id="heading-9">4. 完整事件流演示</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 清理之前的监听器</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">clearAllListeners</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> listeners = [];
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addListener</span>(<span class="hljs-params">element, handler, useCapture</span>) {
    element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler, useCapture);
    listeners.<span class="hljs-title function_">push</span>({ element, handler, useCapture });
  };
}

<span class="hljs-comment">// 添加完整事件监听</span>
<span class="hljs-keyword">const</span> listener = <span class="hljs-title function_">clearAllListeners</span>();

<span class="hljs-comment">// 捕获阶段</span>
<span class="hljs-title function_">listener</span>(grandparent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'1. Grandparent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-title function_">listener</span>(parent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'2. Parent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-title function_">listener</span>(child, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'3. Child: 目标阶段'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 冒泡阶段</span>
<span class="hljs-title function_">listener</span>(child, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'4. Child: 目标阶段'</span>);
}, <span class="hljs-literal">false</span>);

<span class="hljs-title function_">listener</span>(parent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'5. Parent: 冒泡阶段'</span>);
}, <span class="hljs-literal">false</span>);

<span class="hljs-title function_">listener</span>(grandparent, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'6. Grandparent: 冒泡阶段'</span>);
}, <span class="hljs-literal">false</span>);

<span class="hljs-comment">// 点击按钮输出：</span>
<span class="hljs-comment">// 1. Grandparent: 捕获阶段</span>
<span class="hljs-comment">// 2. Parent: 捕获阶段</span>
<span class="hljs-comment">// 3. Child: 目标阶段</span>
<span class="hljs-comment">// 4. Child: 目标阶段</span>
<span class="hljs-comment">// 5. Parent: 冒泡阶段</span>
<span class="hljs-comment">// 6. Grandparent: 冒泡阶段</span>
</code></pre>
<h2 data-id="heading-10">5. 事件对象</h2>
<h3 data-id="heading-11">event 对象</h3>
<pre><code class="hljs language-js" lang="js">child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'事件对象属性:'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'event.target:'</span>, event.<span class="hljs-property">target</span>);         <span class="hljs-comment">// 实际触发的元素</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'event.currentTarget:'</span>, event.<span class="hljs-property">currentTarget</span>); <span class="hljs-comment">// 当前处理元素</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'event.eventPhase:'</span>, event.<span class="hljs-property">eventPhase</span>);     <span class="hljs-comment">// 当前阶段</span>
  <span class="hljs-comment">// 1: 捕获, 2: 目标, 3: 冒泡</span>
}, <span class="hljs-literal">false</span>);
</code></pre>
<h2 data-id="heading-12">6. 控制事件传播</h2>
<h3 data-id="heading-13">6.1 event.stopPropagation()</h3>
<p>阻止事件继续传播</p>
<pre><code class="hljs language-js" lang="js">grandparent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Grandparent: 捕获阶段'</span>);
}, <span class="hljs-literal">true</span>);

parent.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Parent: 捕获阶段'</span>);
  e.<span class="hljs-title function_">stopPropagation</span>();  <span class="hljs-comment">// 停止传播</span>
}, <span class="hljs-literal">true</span>);

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Child: 永远执行不到这里'</span>);
}, <span class="hljs-literal">true</span>);

<span class="hljs-comment">// 点击 child 输出：</span>
<span class="hljs-comment">// Grandparent: 捕获阶段</span>
<span class="hljs-comment">// Parent: 捕获阶段</span>
<span class="hljs-comment">// 停止传播，后续事件不会执行</span>
</code></pre>
<h3 data-id="heading-14">6.2 event.stopImmediatePropagation()</h3>
<p>阻止事件传播，并阻止同一元素的其他监听器</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handler1</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler1'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handler2</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler2'</span>);
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handler3</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler3 执行前停止'</span>);
  event.<span class="hljs-title function_">stopImmediatePropagation</span>();
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">handler4</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'handler4 不会执行'</span>);
}

child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler1);
child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler2);
child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler3);
child.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handler4);

<span class="hljs-comment">// 点击 child 输出：</span>
<span class="hljs-comment">// handler1</span>
<span class="hljs-comment">// handler2</span>
<span class="hljs-comment">// handler3 执行前停止</span>
<span class="hljs-comment">// handler4 不会执行</span>
</code></pre>
<h3 data-id="heading-15">6.3 event.preventDefault()</h3>
<p>阻止默认行为</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myLink'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止链接跳转</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'链接被点击，但不会跳转'</span>);
});

form.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
  e.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止表单提交</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'表单提交被阻止'</span>);
});
</code></pre>
<h2 data-id="heading-16">7. 事件委托 (Event Delegation)</h2>
<h3 data-id="heading-17">7.1 使用冒泡机制</h3>
<pre><code class="hljs language-js" lang="js">&lt;ul id=<span class="hljs-string">"todoList"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务1 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务2 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务3 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>任务4 <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"delete"</span>&gt;</span>删除<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span></span>
&lt;/ul&gt;
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ 低效的方法：为每个按钮添加监听器</span>
<span class="hljs-keyword">const</span> buttons = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.delete'</span>);
buttons.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">button</span> =&gt;</span> {
  button.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">remove</span>();
  });
});

<span class="hljs-comment">// ✅ 高效的事件委托</span>
<span class="hljs-keyword">const</span> todoList = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'todoList'</span>);
todoList.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'delete'</span>)) {
    event.<span class="hljs-property">target</span>.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">remove</span>();
  }
});
</code></pre>
<h3 data-id="heading-18">7.2 动态添加元素</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 添加新任务</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">addNewTask</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> newLi = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'li'</span>);
  newLi.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`新任务 &lt;button class="delete"&gt;删除&lt;/button&gt;`</span>;
  todoList.<span class="hljs-title function_">appendChild</span>(newLi);
  <span class="hljs-comment">// 无需为新按钮添加事件监听</span>
}
</code></pre>
<h2 data-id="heading-19">8. 实际应用示例</h2>
<h3 data-id="heading-20">示例1：嵌套菜单</h3>
<pre><code class="hljs language-js" lang="js">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"menu"</span>&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-toggle"</span>&gt;</span>菜单1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submenu"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项2<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项3<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/div&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"menu-toggle"</span>&gt;</span>菜单2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"submenu"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项A<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"#"</span>&gt;</span>选项B<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 事件委托处理所有菜单</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> target = event.<span class="hljs-property">target</span>;
  
  <span class="hljs-keyword">if</span> (target.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'menu-toggle'</span>)) {
    <span class="hljs-comment">// 切换菜单</span>
    <span class="hljs-keyword">const</span> submenu = target.<span class="hljs-property">nextElementSibling</span>;
    submenu.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = submenu.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> === <span class="hljs-string">'block'</span> ? <span class="hljs-string">'none'</span> : <span class="hljs-string">'block'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (target.<span class="hljs-property">tagName</span> === <span class="hljs-string">'A'</span>) {
    <span class="hljs-comment">// 处理菜单项点击</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'选择了:'</span>, target.<span class="hljs-property">textContent</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 点击外部，关闭所有菜单</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.submenu'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">menu</span> =&gt;</span> {
      menu.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
    });
  }
});
</code></pre>
<h3 data-id="heading-21">示例2：模态框</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 事件委托实现点击外部关闭</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> modal = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modal'</span>);
  <span class="hljs-keyword">const</span> closeBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'closeModal'</span>);
  <span class="hljs-keyword">const</span> openBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openModal'</span>);
  
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span> === openBtn) {
    modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'block'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span> === closeBtn || event.<span class="hljs-property">target</span> === modal) {
    modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (modal.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> === <span class="hljs-string">'block'</span>) {
    <span class="hljs-comment">// 防止冒泡</span>
    event.<span class="hljs-title function_">stopPropagation</span>();
  }
});

<span class="hljs-comment">// 阻止模态框内容点击关闭</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'modalContent'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  event.<span class="hljs-title function_">stopPropagation</span>();
});
</code></pre>
<h2 data-id="heading-22">9. 性能优化</h2>
<h3 data-id="heading-23">9.1 减少事件监听器数量</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ❌ 性能差：每个元素都添加监听器</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.item'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
  item.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);
});

<span class="hljs-comment">// ✅ 性能好：一个父元素监听</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'container'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">target</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'item'</span>)) {
    <span class="hljs-title function_">handleClick</span>(event);
  }
});

<span class="hljs-comment">// 或者使用 closest</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> item = event.<span class="hljs-property">target</span>.<span class="hljs-title function_">closest</span>(<span class="hljs-string">'.item'</span>);
  <span class="hljs-keyword">if</span> (item) {
    <span class="hljs-title function_">handleClick</span>(event, item);
  }
});
</code></pre>
<h3 data-id="heading-24">9.2 防抖和节流</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 节流处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttle</span>(<span class="hljs-params">func, delay</span>) {
  <span class="hljs-keyword">let</span> lastCall = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
    <span class="hljs-keyword">if</span> (now - lastCall &gt;= delay) {
      lastCall = now;
      func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
    }
  };
}

<span class="hljs-comment">// 防抖处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">func, delay</span>) {
  <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">...args</span>) {
    <span class="hljs-built_in">clearTimeout</span>(timer);
    timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      func.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
    }, delay);
  };
}

<span class="hljs-comment">// 使用</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'scroll'</span>, <span class="hljs-title function_">throttle</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动事件（节流）'</span>);
}, <span class="hljs-number">100</span>));

<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-title function_">debounce</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'调整大小事件（防抖）'</span>);
}, <span class="hljs-number">250</span>));
</code></pre>
<h2 data-id="heading-25">10. 事件阶段常量</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 事件阶段常量</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Event</span> = {
  <span class="hljs-attr">NONE</span>: <span class="hljs-number">0</span>,            <span class="hljs-comment">// 无</span>
  <span class="hljs-attr">CAPTURING_PHASE</span>: <span class="hljs-number">1</span>,  <span class="hljs-comment">// 捕获</span>
  <span class="hljs-attr">AT_TARGET</span>: <span class="hljs-number">2</span>,        <span class="hljs-comment">// 目标</span>
  <span class="hljs-attr">BUBBLING_PHASE</span>: <span class="hljs-number">3</span>    <span class="hljs-comment">// 冒泡</span>
};

<span class="hljs-comment">// 使用</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">switch</span>(event.<span class="hljs-property">eventPhase</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Event</span>.<span class="hljs-property">CAPTURING_PHASE</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'捕获阶段'</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Event</span>.<span class="hljs-property">AT_TARGET</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'目标阶段'</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-title class_">Event</span>.<span class="hljs-property">BUBBLING_PHASE</span>:
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'冒泡阶段'</span>);
      <span class="hljs-keyword">break</span>;
  }
}, <span class="hljs-literal">true</span>);
</code></pre>
<h2 data-id="heading-26">11. 高级技巧</h2>
<h3 data-id="heading-27">11.1 自定义事件</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 创建自定义事件</span>
<span class="hljs-keyword">const</span> customEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">'myEvent'</span>, {
  <span class="hljs-attr">bubbles</span>: <span class="hljs-literal">true</span>,     <span class="hljs-comment">// 是否冒泡</span>
  <span class="hljs-attr">cancelable</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 是否可取消</span>
  <span class="hljs-attr">detail</span>: {          <span class="hljs-comment">// 自定义数据</span>
    <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello World'</span>,
    <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>()
  }
});

<span class="hljs-comment">// 监听自定义事件</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'myEvent'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'自定义事件触发:'</span>, event.<span class="hljs-property">detail</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'是否冒泡:'</span>, event.<span class="hljs-property">bubbles</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'目标元素:'</span>, event.<span class="hljs-property">target</span>);
});

<span class="hljs-comment">// 触发事件</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">dispatchEvent</span>(customEvent);
}, <span class="hljs-number">1000</span>);
</code></pre>
<h3 data-id="heading-28">11.2 一次性事件监听</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 传统方法</span>
<span class="hljs-keyword">let</span> handled = <span class="hljs-literal">false</span>;
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> <span class="hljs-title function_">handler</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (handled) <span class="hljs-keyword">return</span>;
  handled = <span class="hljs-literal">true</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'只执行一次'</span>);
  element.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handler);
});

<span class="hljs-comment">// 使用 { once: true }</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'只执行一次'</span>);
}, { <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// 捕获阶段也适用</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'捕获阶段只执行一次'</span>);
}, { <span class="hljs-attr">capture</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">once</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h3 data-id="heading-29">11.3 被动事件监听</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 提高滚动性能</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'wheel'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 这里不会调用 preventDefault</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'滚动事件'</span>);
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });

<span class="hljs-comment">// 尝试调用会出错</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'wheel'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 在 passive 为 true 时，调用 preventDefault 会报错</span>
  <span class="hljs-comment">// event.preventDefault(); // TypeError</span>
}, { <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span> });
</code></pre>
<h2 data-id="heading-30">12. 常见问题</h2>
<h3 data-id="heading-31">12.1 阻止默认行为和冒泡</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'link'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  event.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止默认行为</span>
  event.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// 阻止冒泡</span>
  
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'链接被点击，但不会跳转，也不会冒泡'</span>);
});

<span class="hljs-comment">// 在表单中使用</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'form'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'submit'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isValid</span>()) {
    event.<span class="hljs-title function_">preventDefault</span>();
    event.<span class="hljs-title function_">stopPropagation</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
});
</code></pre>
<h3 data-id="heading-32">12.2 移除事件监听器</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'点击事件'</span>);
}

<span class="hljs-comment">// 添加</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);

<span class="hljs-comment">// 移除（必须使用相同的函数引用）</span>
element.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, handleClick);

<span class="hljs-comment">// ❌ 错误：匿名函数无法移除</span>
element.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'匿名函数'</span>);
});
element.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'无法移除'</span>);
}); <span class="hljs-comment">// 不生效</span>
</code></pre>
<h2 data-id="heading-33">13. 现代框架中的事件处理</h2>
<h3 data-id="heading-34">React</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyComponent</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params">event</span>) =&gt; {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'React 事件是合成事件'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'事件目标:'</span>, event.<span class="hljs-property">target</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'冒泡行为:'</span>, event.<span class="hljs-property">nativeEvent</span>.<span class="hljs-property">bubbles</span>);
  };

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleSubmit</span> = (<span class="hljs-params">event</span>) =&gt; {
    event.<span class="hljs-title function_">preventDefault</span>();  <span class="hljs-comment">// 阻止表单提交</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'表单提交被阻止'</span>);
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleClick}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">onSubmit</span>=<span class="hljs-string">{handleSubmit}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-35">Vue</h3>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">form</span> @<span class="hljs-attr">submit.prevent</span>=<span class="hljs-string">"handleSubmit"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"submit"</span>&gt;</span>提交<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleClick</span>(<span class="hljs-params">event</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Vue 事件处理'</span>);
      event.<span class="hljs-title function_">stopPropagation</span>(); <span class="hljs-comment">// 原生方法</span>
    },
    <span class="hljs-title function_">handleSubmit</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'.prevent 修饰符自动阻止默认行为'</span>);
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<h2 data-id="heading-36">14. 总结</h2>
<h3 data-id="heading-37">关键点总结</h3>






























<table><thead><tr><th>特性</th><th>事件捕获</th><th>事件冒泡</th></tr></thead><tbody><tr><td>传播方向</td><td>上 → 下</td><td>下 → 上</td></tr><tr><td>默认启用</td><td>❌ 需显式设置</td><td>✅ 默认</td></tr><tr><td>使用场景</td><td>少，特殊需求</td><td>多，事件委托</td></tr><tr><td>添加方法</td><td><code>addEventListener(..., true)</code></td><td><code>addEventListener(..., false)</code></td></tr></tbody></table>
<h3 data-id="heading-38">最佳实践</h3>
<ol>
<li><strong>使用事件委托</strong>：减少监听器数量，提高性能</li>
<li><strong>理解事件流</strong>：知道事件如何传播</li>
<li><strong>合理使用停止传播</strong>：但不要滥用</li>
<li><strong>使用被动监听器</strong>：提高滚动性能</li>
<li><strong>注意内存泄漏</strong>：及时移除不需要的监听器</li>
<li><strong>利用框架特性</strong>：React/Vue 等框架有优化</li>
</ol>
<h3 data-id="heading-39">记忆口诀</h3>
<pre><code class="hljs language-html" lang="html">事件三阶段，捕获、目标 和 冒泡

从上往下 叫捕获，从下往上 叫冒泡

目标在中间，两阶段都要到

委托用冒泡，性能高可靠
</code></pre>
<p>通过理解事件冒泡和捕获，你可以更有效地处理 DOM 事件，优化性能，并写出更优雅的事件处理代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vercel + Render 全栈博客部署实战指南]]></title>    <link>https://juejin.cn/post/7581251003330445338</link>    <guid>https://juejin.cn/post/7581251003330445338</guid>    <pubDate>2025-12-08T12:34:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581251003330445338" data-draft-id="7581297888808681522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vercel + Render 全栈博客部署实战指南"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-08T12:34:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一抹残云"/> <meta itemprop="url" content="https://juejin.cn/user/1574156384092951"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vercel + Render 全栈博客部署实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1574156384092951/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一抹残云
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:34:59.000Z" title="Mon Dec 08 2025 12:34:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>从零到部署：使用 Vercel 部署前端、Render 部署后端的完整实操手册 ，其中用到的实例皆是本人个人项目<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxiaozhen123321%2Fblog" target="_blank" title="https://github.com/xiaozhen123321/blog" ref="nofollow noopener noreferrer">实战demo</a>，部署后<a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fxiaozhen123321s-projects%2Fblog-fronted" target="_blank" title="https://vercel.com/xiaozhen123321s-projects/blog-fronted" ref="nofollow noopener noreferrer">前端地址</a></p>
</blockquote>
<hr/>
<h2 data-id="heading-0">📋 目录</h2>
<ol>
<li><a href="#1-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88" title="#1-%E9%83%A8%E7%BD%B2%E6%9E%B6%E6%9E%84%E6%A6%82%E8%A7%88">部署架构概览</a></li>
<li><a href="#2-%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87" title="#2-%E5%89%8D%E7%BD%AE%E5%87%86%E5%A4%87">前置准备</a></li>
<li><a href="#3-%E7%AC%AC%E4%B8%80%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E5%88%B0-render" title="#3-%E7%AC%AC%E4%B8%80%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E7%AB%AF%E5%88%B0-render">第一步：部署后端到 Render</a></li>
<li><a href="#4-%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93" title="#4-%E7%AC%AC%E4%BA%8C%E6%AD%A5%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93">第二步：初始化数据库</a></li>
<li><a href="#5-%E7%AC%AC%E4%B8%89%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E5%88%B0-vercel" title="#5-%E7%AC%AC%E4%B8%89%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%89%8D%E7%AB%AF%E5%88%B0-vercel">第三步：部署前端到 Vercel</a></li>
<li><a href="#6-%E7%AC%AC%E5%9B%9B%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%88%B0-vercel" title="#6-%E7%AC%AC%E5%9B%9B%E6%AD%A5%E9%83%A8%E7%BD%B2%E5%90%8E%E5%8F%B0%E7%AE%A1%E7%90%86%E5%88%B0-vercel">第四步：部署后台管理到 Vercel</a></li>
<li><a href="#7-%E7%AC%AC%E4%BA%94%E6%AD%A5%E8%BF%9E%E6%8E%A5%E5%89%8D%E5%90%8E%E7%AB%AF" title="#7-%E7%AC%AC%E4%BA%94%E6%AD%A5%E8%BF%9E%E6%8E%A5%E5%89%8D%E5%90%8E%E7%AB%AF">第五步：连接前后端</a></li>
<li><a href="#8-%E7%AC%AC%E5%85%AD%E6%AD%A5%E9%AA%8C%E8%AF%81%E9%83%A8%E7%BD%B2" title="#8-%E7%AC%AC%E5%85%AD%E6%AD%A5%E9%AA%8C%E8%AF%81%E9%83%A8%E7%BD%B2">第六步：验证部署</a></li>
<li><a href="#9-monorepo-%E7%89%B9%E6%AE%8A%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E" title="#9-monorepo-%E7%89%B9%E6%AE%8A%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E">Monorepo 特殊配置说明</a></li>
<li><a href="#10-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%AE%8C%E6%95%B4%E6%B8%85%E5%8D%95" title="#10-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E5%AE%8C%E6%95%B4%E6%B8%85%E5%8D%95">环境变量完整清单</a></li>
<li><a href="#11-%E5%85%8D%E8%B4%B9%E9%A2%9D%E5%BA%A6%E8%AF%B4%E6%98%8E" title="#11-%E5%85%8D%E8%B4%B9%E9%A2%9D%E5%BA%A6%E8%AF%B4%E6%98%8E">免费额度说明</a></li>
<li><a href="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5" title="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">常见问题排查</a></li>
<li><a href="#13-%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE" title="#13-%E4%BC%98%E5%8C%96%E5%BB%BA%E8%AE%AE">优化建议</a></li>
<li><a href="#14-%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2cicd" title="#14-%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2cicd">持续部署（CI/CD）</a></li>
</ol>
<hr/>
<h2 data-id="heading-1">1. 部署架构概览</h2>
<h3 data-id="heading-2">部署架构图</h3>
<pre><code class="hljs language-scss" lang="scss">┌─────────────────────────────────────────────────────────────┐
│                         用户访问                              │
└──────────────────┬──────────────────┬───────────────────────┘
                   │                  │
         ┌─────────▼──────────┐  ┌───▼──────────────┐
         │   Vercel (前端)     │  │  Vercel (后台)    │
         │  blog-frontend     │  │   blog-admin     │
         │  静态资源 + SPA     │  │   管理界面        │
         └─────────┬──────────┘  └───┬──────────────┘
                   │                  │
                   │  API 请求 (/api) │
                   │                  │
         ┌─────────▼──────────────────▼──────────────┐
         │          Render (后端)                     │
         │         blog-server                       │
         │     Node<span class="hljs-selector-class">.js</span> + Express                     │
         │    (https://blog-<span class="hljs-number">2</span>eqo.onrender.com)      │
         └─────────┬─────────────────────────────────┘
                   │
                   │ PostgreSQL
                   │
         ┌─────────▼─────────────────────────────────┐
         │      Render PostgreSQL                    │
         │         blog-postgres                     │
         │      Database: blog_system                │
         └───────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-3">技术栈</h3>



































<table><thead><tr><th>组件</th><th>平台</th><th>技术栈</th><th>费用</th></tr></thead><tbody><tr><td><strong>前端</strong></td><td>Vercel</td><td>React + Rsbuild + Ant Design</td><td>免费</td></tr><tr><td><strong>后台管理</strong></td><td>Vercel</td><td>React + Rsbuild + Ant Design + Draft.js</td><td>免费</td></tr><tr><td><strong>后端 API</strong></td><td>Render</td><td>Node.js + Express + TypeScript</td><td>免费</td></tr><tr><td><strong>数据库</strong></td><td>Render</td><td>PostgreSQL 16</td><td>免费</td></tr></tbody></table>
<h3 data-id="heading-4">部署顺序</h3>
<p>⚠️ <strong>重要</strong>：必须按以下顺序部署，因为前端需要后端 API 的 URL：</p>
<ol>
<li><strong>后端</strong> → Render (获取 API URL)</li>
<li><strong>数据库初始化</strong> → Render Shell</li>
<li><strong>前端</strong> → Vercel (配置 API 代理)</li>
<li><strong>后台</strong> → Vercel (配置 API 代理)</li>
<li><strong>连接测试</strong> → 更新 CORS 配置</li>
</ol>
<hr/>
<h2 data-id="heading-5">2. 前置准备</h2>
<h3 data-id="heading-6">2.1 GitHub 仓库准备</h3>
<p>确保你的项目代码已推送到 GitHub：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /path/to/blog
git status
git add .
git commit -m <span class="hljs-string">"feat: prepare for deployment"</span>
git push origin main
</code></pre>
<h3 data-id="heading-7">2.2 账号注册</h3>
<p><strong>Render 注册</strong>：</p>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Frender.com" target="_blank" title="https://render.com" ref="nofollow noopener noreferrer">render.com</a></li>
<li>点击 "Get Started" → "Sign Up with GitHub"</li>
<li>授权 Render 访问你的 GitHub 仓库</li>
<li>✅ 无需信用卡，完全免费</li>
</ol>
<p><strong>Vercel 注册</strong>：</p>
<ol>
<li>访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com" target="_blank" title="https://vercel.com" ref="nofollow noopener noreferrer">vercel.com</a></li>
<li>点击 "Sign Up" → "Continue with GitHub"</li>
<li>授权 Vercel 访问你的 GitHub 仓库</li>
<li>✅ 无需信用卡，完全免费</li>
</ol>
<h3 data-id="heading-8">2.3 环境检查</h3>
<p>确认项目包含以下文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Render 配置</span>
packages/blog-server/render.yaml              ✅
packages/blog-server/.env.render.example      ✅

<span class="hljs-comment"># Vercel 配置</span>
packages/blog-frontend/vercel.json            ✅
packages/blog-admin/vercel.json               ✅

<span class="hljs-comment"># 数据库初始化</span>
packages/blog-server/database/init.sql        ✅
packages/blog-server/scripts/init-database.ts ✅
</code></pre>
<hr/>
<h2 data-id="heading-9">3. 第一步：部署后端到 Render</h2>
<h3 data-id="heading-10">3.1 创建 PostgreSQL 数据库</h3>
<ol>
<li>
<p>登录 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdashboard.render.com%2F" target="_blank" title="https://dashboard.render.com/" ref="nofollow noopener noreferrer">Render Dashboard</a></p>
</li>
<li>
<p>点击右上角 <strong>"New +"</strong> → 选择 <strong>"PostgreSQL"</strong></p>
</li>
<li>
<p>填写数据库配置：</p>

































<table><thead><tr><th>字段</th><th>值</th></tr></thead><tbody><tr><td><strong>Name</strong></td><td><code>blog-postgres</code></td></tr><tr><td><strong>Database</strong></td><td><code>blog_system</code></td></tr><tr><td><strong>User</strong></td><td><code>blog_user</code>（自动生成，可修改）</td></tr><tr><td><strong>Region</strong></td><td>选择 <strong>Singapore</strong>（离中国最近）</td></tr><tr><td><strong>PostgreSQL Version</strong></td><td>16（默认）</td></tr><tr><td><strong>Plan</strong></td><td><strong>Free</strong></td></tr></tbody></table>
</li>
<li>
<p>点击 <strong>"Create Database"</strong></p>
</li>
<li>
<p>等待约 1-2 分钟，状态变为 <strong>"Available"</strong></p>
</li>
<li>
<p><strong>保存连接信息</strong>（稍后需要）：</p>
<ul>
<li>进入数据库 → "Info" 标签</li>
<li>记录：
<ul>
<li><strong>Hostname</strong>（例如：<code>dpg-xxxx-a.singapore-postgres.render.com</code>）</li>
<li><strong>Port</strong>（通常是 <code>5432</code>）</li>
<li><strong>Database</strong>（<code>blog_system</code>）</li>
<li><strong>Username</strong>（<code>blog_user</code>）</li>
<li><strong>Password</strong>（自动生成的长密码）</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 data-id="heading-11">3.2 创建 Web Service（后端 API）</h3>
<ol>
<li>
<p>在 Render Dashboard，点击 <strong>"New +"</strong> → <strong>"Web Service"</strong></p>
</li>
<li>
<p>点击 <strong>"Build and deploy from a Git repository"</strong> → <strong>"Next"</strong></p>
</li>
<li>
<p>选择你的 GitHub 仓库 <code>blog</code>（如果没有显示，点击 "Configure account" 授权）</p>
</li>
<li>
<p>填写服务配置：</p>


















































<table><thead><tr><th>字段</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><strong>Name</strong></td><td><code>blog-server</code></td><td>服务名称</td></tr><tr><td><strong>Region</strong></td><td><strong>Singapore</strong></td><td>与数据库同区域</td></tr><tr><td><strong>Branch</strong></td><td><code>main</code></td><td>Git 分支</td></tr><tr><td><strong>Root Directory</strong></td><td><code>packages/blog-server</code></td><td>⚠️ <strong>重要</strong>：Monorepo 子目录</td></tr><tr><td><strong>Runtime</strong></td><td><strong>Node</strong></td><td>自动检测</td></tr><tr><td><strong>Build Command</strong></td><td><code>npm install &amp;&amp; npm run build</code></td><td>安装依赖并编译 TypeScript</td></tr><tr><td><strong>Start Command</strong></td><td><code>npm start</code></td><td>启动服务</td></tr><tr><td><strong>Plan</strong></td><td><strong>Free</strong></td><td>免费计划</td></tr></tbody></table>
</li>
<li>
<p>点击 <strong>"Advanced"</strong> 展开高级选项（暂不配置，稍后添加环境变量）</p>
</li>
<li>
<p>点击 <strong>"Create Web Service"</strong></p>
</li>
</ol>
<p>⏳ <strong>构建过程</strong>：约 3-5 分钟，在 "Logs" 标签查看进度</p>
<h3 data-id="heading-12">3.3 配置环境变量</h3>
<p>构建完成后（状态显示 "Live" 或 "Deploy failed"，先别管），配置环境变量：</p>
<ol>
<li>
<p>在 Web Service 页面，点击 <strong>"Environment"</strong> 标签</p>
</li>
<li>
<p>点击 <strong>"Add Environment Variable"</strong>，逐个添加以下变量：</p>
</li>
</ol>
<h4 data-id="heading-13">基础配置</h4>
<pre><code class="hljs language-bash" lang="bash">NODE_ENV=production
</code></pre>
<h4 data-id="heading-14">JWT 配置</h4>
<pre><code class="hljs language-bash" lang="bash">JWT_SECRET=51de2d30c5629597bf6f41dbcf9f41beb714bb31e91adb5899d25fce64202fd9
</code></pre>
<blockquote>
<p>💡 <strong>生产环境必须修改</strong>：使用以下命令生成新密钥：</p>
<pre><code class="hljs language-bash" lang="bash">node -e <span class="hljs-string">"console.log(require('crypto').randomBytes(32).toString('hex'))"</span>
</code></pre>
</blockquote>
<pre><code class="hljs language-bash" lang="bash">JWT_EXPIRES_IN=7d
</code></pre>
<h4 data-id="heading-15">CORS 配置（稍后更新）</h4>
<pre><code class="hljs language-bash" lang="bash">FRONTEND_URL=https://your-frontend.vercel.app
</code></pre>
<pre><code class="hljs language-bash" lang="bash">ADMIN_URL=https://your-admin.vercel.app
</code></pre>
<blockquote>
<p>⚠️ <strong>注意</strong>：这两个 URL 在部署 Vercel 后需要更新为实际 URL</p>
</blockquote>
<h4 data-id="heading-16">文件上传配置</h4>
<pre><code class="hljs language-bash" lang="bash">MAX_FILE_SIZE=5242880
</code></pre>
<pre><code class="hljs language-bash" lang="bash">ALLOWED_IMAGE_TYPES=image/jpeg,image/png,image/gif,image/webp
</code></pre>
<h4 data-id="heading-17">数据库配置（从步骤 3.1 复制）</h4>
<pre><code class="hljs language-bash" lang="bash">DB_HOST=&lt;从数据库 Info 复制 Hostname&gt;
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_PORT=5432
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_USER=&lt;从数据库 Info 复制 Username&gt;
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_PASSWORD=&lt;从数据库 Info 复制 Password&gt;
</code></pre>
<pre><code class="hljs language-bash" lang="bash">DB_NAME=blog_system
</code></pre>
<ol start="3">
<li>
<p>点击 <strong>"Save Changes"</strong></p>
</li>
<li>
<p>Render 会自动触发重新部署（约 2 分钟）</p>
</li>
</ol>
<h3 data-id="heading-18">3.4 查看部署日志</h3>
<ol>
<li>在 "Logs" 标签，确认看到以下内容：</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">🚀 Server <span class="hljs-keyword">is</span> running <span class="hljs-keyword">on</span> http:<span class="hljs-comment">//0.0.0.0:10000</span>
📝 Environment: production
🗄️  Database: blog_system<span class="hljs-meta">@dpg</span>-xxxx.singapore-postgres.render.com:<span class="hljs-number">5432</span>
</code></pre>
<ol start="2">
<li>如果看到错误，检查环境变量是否正确</li>
</ol>
<h3 data-id="heading-19">3.5 获取 API URL</h3>
<ol>
<li>
<p>在 Web Service 顶部，复制服务 URL：</p>
<pre><code class="hljs language-arduino" lang="arduino">https:<span class="hljs-comment">//blog-server-xxxx.onrender.com</span>
</code></pre>
</li>
<li>
<p><strong>保存这个 URL</strong>，稍后部署前端时需要</p>
</li>
<li>
<p>测试 API（可选）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 健康检查</span>
curl https://blog-server-xxxx.onrender.com/api/health

<span class="hljs-comment"># 获取分类（应该返回空数组，因为数据库未初始化）</span>
curl https://blog-server-xxxx.onrender.com/api/categories
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-20">4. 第二步：初始化数据库</h2>
<h3 data-id="heading-21">4.1 使用 Render Shell</h3>
<ol>
<li>
<p>在 Web Service 页面，点击 <strong>"Shell"</strong> 标签</p>
</li>
<li>
<p>点击 <strong>"Launch Shell"</strong> 按钮</p>
</li>
<li>
<p>等待 Shell 启动（约 10 秒）</p>
</li>
<li>
<p>在 Shell 中运行初始化脚本：</p>
<pre><code class="hljs language-bash" lang="bash">npm run db:init
</code></pre>
</li>
<li>
<p>成功后会看到：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">🚀</span> <span class="hljs-string">Starting</span> <span class="hljs-string">database</span> <span class="hljs-string">initialization...</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Connected</span> <span class="hljs-string">to</span> <span class="hljs-string">database</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Tables</span> <span class="hljs-string">created</span> <span class="hljs-string">successfully</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Seed</span> <span class="hljs-string">data</span> <span class="hljs-string">inserted</span> <span class="hljs-string">successfully</span>
<span class="hljs-string">✅</span> <span class="hljs-string">Admin</span> <span class="hljs-string">user</span> <span class="hljs-string">created</span> <span class="hljs-string">successfully</span>
<span class="hljs-string">🎉</span> <span class="hljs-string">Database</span> <span class="hljs-string">initialization</span> <span class="hljs-string">complete!</span>

<span class="hljs-string">📝</span> <span class="hljs-attr">Admin credentials:</span>
   <span class="hljs-attr">Username:</span> <span class="hljs-string">admin</span>
   <span class="hljs-attr">Password:</span> <span class="hljs-string">admin123</span>
   <span class="hljs-attr">Email:</span> <span class="hljs-string">admin@blog.com</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-22">4.2 验证数据</h3>
<p>在 Shell 中运行：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 进入 PostgreSQL（如果需要）</span>
psql <span class="hljs-variable">$DATABASE_URL</span>

<span class="hljs-comment"># 查看所有表</span>
\dt

<span class="hljs-comment"># 查看分类</span>
SELECT * FROM categories;

<span class="hljs-comment"># 查看管理员</span>
SELECT username, email FROM admin_users;

<span class="hljs-comment"># 退出</span>
\q
</code></pre>
<p>应该看到：</p>
<ul>
<li>4 张表：<code>admin_users</code>, <code>categories</code>, <code>articles</code>, <code>images</code></li>
<li>8 个分类（前端开发、后端开发等）</li>
<li>1 个管理员账号</li>
</ul>
<hr/>
<h2 data-id="heading-23">5. 第三步：部署前端到 Vercel</h2>
<h3 data-id="heading-24">5.1 导入项目</h3>
<ol>
<li>
<p>登录 <a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdashboard" target="_blank" title="https://vercel.com/dashboard" ref="nofollow noopener noreferrer">Vercel Dashboard</a></p>
</li>
<li>
<p>点击 <strong>"Add New..." → "Project"</strong></p>
</li>
<li>
<p>选择你的 GitHub 仓库 <code>blog</code></p>
</li>
<li>
<p>点击 <strong>"Import"</strong></p>
</li>
</ol>
<h3 data-id="heading-25">5.2 配置项目（blog-frontend）</h3>
<p>Vercel 会自动检测到 Monorepo 结构，现在配置前端：</p>








































<table><thead><tr><th>字段</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><strong>Project Name</strong></td><td><code>blog-frontend</code>（可自定义）</td><td>项目名称</td></tr><tr><td><strong>Framework Preset</strong></td><td><strong>Other</strong></td><td>不使用预设</td></tr><tr><td><strong>Root Directory</strong></td><td><code>packages/blog-frontend</code></td><td>⚠️ <strong>重要</strong>：点击 "Edit" 修改</td></tr><tr><td><strong>Build Command</strong></td><td><code>npm install &amp;&amp; cd packages/blog-frontend &amp;&amp; npm run build</code></td><td>⚠️ Monorepo 构建命令</td></tr><tr><td><strong>Output Directory</strong></td><td><code>../../dist/packages/blog-frontend</code></td><td>构建输出目录</td></tr><tr><td><strong>Install Command</strong></td><td><code>npm install --prefix ../.. &amp;&amp; npm install</code></td><td>安装依赖</td></tr></tbody></table>
<h4 data-id="heading-26">配置截图说明位置</h4>
<p><strong>Root Directory 配置</strong>：</p>
<ol>
<li>在 "Build and Output Settings" 下找到 "Root Directory"</li>
<li>点击 "Edit" 按钮</li>
<li>选择 <code>packages/blog-frontend</code></li>
</ol>
<p><strong>Build Command 配置</strong>：</p>
<ol>
<li>勾选 "Override" 复选框</li>
<li>输入完整的 Monorepo 构建命令</li>
</ol>
<h3 data-id="heading-27">5.3 配置 API 重写（重要）</h3>
<p>⚠️ <strong>Vercel 项目配置会读取 <code>vercel.json</code></strong>，但我们手动确认一下：</p>
<ol>
<li>在部署前，确认项目根目录的 <code>packages/blog-frontend/vercel.json</code> 包含：</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/api/:path*"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://blog-server-xxxx.onrender.com/api/:path*"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/(.*)"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/index.html"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="2">
<li>
<p><strong>⚠️ 重要</strong>：将 <code>https://blog-server-xxxx.onrender.com</code> 替换为你在步骤 3.5 获取的实际 Render URL</p>
</li>
<li>
<p>如果已修改，提交代码：</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">git add packages/blog-frontend/vercel.json
git commit -m <span class="hljs-string">"fix: update API URL in vercel.json"</span>
git push origin main
</code></pre>
<h3 data-id="heading-28">5.4 部署</h3>
<ol>
<li>
<p>配置完成后，点击 <strong>"Deploy"</strong></p>
</li>
<li>
<p>⏳ 构建时间：约 2-3 分钟</p>
</li>
<li>
<p>成功后会显示：</p>
<pre><code class="hljs">✅ Deployment Ready
</code></pre>
</li>
<li>
<p>点击 <strong>"Visit"</strong> 或复制部署 URL（例如：<code>https://blog-frontend-xxxx.vercel.app</code>）</p>
</li>
<li>
<p><strong>保存前端 URL</strong>，稍后需要更新 Render 的 CORS 配置</p>
</li>
</ol>
<h3 data-id="heading-29">5.5 验证前端部署</h3>
<p>访问前端 URL，应该看到：</p>
<ul>
<li>✅ 博客首页加载正常</li>
<li>✅ 分类列表显示（从 Render API 获取）</li>
<li>⚠️ 可能显示 "暂无文章"（正常，因为还没创建文章）</li>
</ul>
<hr/>
<h2 data-id="heading-30">6. 第四步：部署后台管理到 Vercel</h2>
<h3 data-id="heading-31">6.1 部署流程</h3>
<p>与前端类似，重复步骤 5，但使用不同的配置：</p>
<ol>
<li>
<p>在 Vercel Dashboard，点击 <strong>"Add New..." → "Project"</strong></p>
</li>
<li>
<p>再次选择 <code>blog</code> 仓库</p>
</li>
<li>
<p>Vercel 会提示 "This repository is already connected"，选择 <strong>"Import Anyway"</strong></p>
</li>
<li>
<p>配置项目：</p>
</li>
</ol>

































<table><thead><tr><th>字段</th><th>值</th></tr></thead><tbody><tr><td><strong>Project Name</strong></td><td><code>blog-admin</code></td></tr><tr><td><strong>Framework Preset</strong></td><td><strong>Other</strong></td></tr><tr><td><strong>Root Directory</strong></td><td><code>packages/blog-admin</code></td></tr><tr><td><strong>Build Command</strong></td><td><code>npm install &amp;&amp; cd packages/blog-admin &amp;&amp; npm run build</code></td></tr><tr><td><strong>Output Directory</strong></td><td><code>../../dist/packages/blog-admin</code></td></tr><tr><td><strong>Install Command</strong></td><td><code>npm install --prefix ../.. &amp;&amp; npm install</code></td></tr></tbody></table>
<ol start="5">
<li>
<p>确认 <code>packages/blog-admin/vercel.json</code> 中的 API URL 与前端一致</p>
</li>
<li>
<p>点击 <strong>"Deploy"</strong></p>
</li>
<li>
<p>获取后台 URL（例如：<code>https://blog-admin-xxxx.vercel.app</code>）</p>
</li>
</ol>
<h3 data-id="heading-32">6.2 验证后台部署</h3>
<p>访问后台 URL，应该看到：</p>
<ul>
<li>✅ 登录页面加载正常</li>
<li>⚠️ 先不要登录（CORS 还未配置）</li>
</ul>
<hr/>
<h2 data-id="heading-33">7. 第五步：连接前后端</h2>
<h3 data-id="heading-34">7.1 更新 Render 的 CORS 配置</h3>
<p>现在我们有了前端和后台的 URL，需要更新 Render 环境变量：</p>
<ol>
<li>
<p>回到 Render Dashboard → <code>blog-server</code> 服务</p>
</li>
<li>
<p>进入 <strong>"Environment"</strong> 标签</p>
</li>
<li>
<p>更新以下变量：</p>
<pre><code class="hljs language-bash" lang="bash">FRONTEND_URL=https://blog-frontend-xxxx.vercel.app
</code></pre>
<pre><code class="hljs language-bash" lang="bash">ADMIN_URL=https://blog-admin-xxxx.vercel.app
</code></pre>
<p><strong>替换为你实际的 Vercel URL</strong></p>
</li>
<li>
<p>点击 <strong>"Save Changes"</strong></p>
</li>
<li>
<p>Render 会自动重启服务（约 1 分钟）</p>
</li>
</ol>
<h3 data-id="heading-35">7.2 测试 API 连接</h3>
<ol>
<li>
<p>打开浏览器控制台（F12）</p>
</li>
<li>
<p>访问前端 URL：<code>https://blog-frontend-xxxx.vercel.app</code></p>
</li>
<li>
<p>在 Network 标签查看 API 请求：</p>
<ul>
<li>✅ 应该看到 <code>/api/categories</code> 请求成功</li>
<li>✅ 响应头包含 <code>Access-Control-Allow-Origin</code></li>
</ul>
</li>
<li>
<p>如果看到 CORS 错误，检查：</p>
<ul>
<li>Render 环境变量是否正确</li>
<li>服务是否已重启</li>
<li>URL 是否包含 <code>https://</code></li>
</ul>
</li>
</ol>
<h3 data-id="heading-36">7.3 验证登录功能</h3>
<ol>
<li>
<p>访问后台 URL：<code>https://blog-admin-xxxx.vercel.app</code></p>
</li>
<li>
<p>使用默认账号登录：</p>
<ul>
<li><strong>用户名</strong>：<code>admin</code></li>
<li><strong>密码</strong>：<code>admin123</code></li>
</ul>
</li>
<li>
<p>登录成功后，应该进入 Dashboard</p>
</li>
<li>
<p>查看：</p>
<ul>
<li>✅ 分类列表显示</li>
<li>✅ 文章列表为空（正常）</li>
<li>✅ 可以创建新文章</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-37">8. 第六步：验证部署</h2>
<h3 data-id="heading-38">8.1 测试前端访问</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 替换为你的前端 URL</span>
FRONTEND_URL=<span class="hljs-string">"https://blog-frontend-xxxx.vercel.app"</span>

<span class="hljs-comment"># 测试首页</span>
curl -I <span class="hljs-variable">$FRONTEND_URL</span>
<span class="hljs-comment"># 应该返回 200 OK</span>

<span class="hljs-comment"># 测试 API 代理</span>
curl <span class="hljs-variable">$FRONTEND_URL</span>/api/categories
<span class="hljs-comment"># 应该返回 JSON 分类列表</span>
</code></pre>
<h3 data-id="heading-39">8.2 测试后台登录</h3>
<ol>
<li>
<p>打开浏览器控制台</p>
</li>
<li>
<p>访问 <code>https://blog-admin-xxxx.vercel.app</code></p>
</li>
<li>
<p>输入账号密码，点击登录</p>
</li>
<li>
<p>在 Network 标签查看：</p>
<ul>
<li>✅ <code>/api/auth/login</code> 请求成功（200）</li>
<li>✅ 返回 <code>token</code> 和用户信息</li>
<li>✅ 自动跳转到 Dashboard</li>
</ul>
</li>
</ol>
<h3 data-id="heading-40">8.3 测试 API 调用</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 替换为你的后端 URL</span>
API_URL=<span class="hljs-string">"https://blog-server-xxxx.onrender.com"</span>

<span class="hljs-comment"># 测试健康检查</span>
curl <span class="hljs-variable">$API_URL</span>/api/health
<span class="hljs-comment"># 返回: {"status":"ok","timestamp":"..."}</span>

<span class="hljs-comment"># 测试获取分类</span>
curl <span class="hljs-variable">$API_URL</span>/api/categories
<span class="hljs-comment"># 返回: {"code":0,"message":"success","data":[...]}</span>

<span class="hljs-comment"># 测试登录</span>
curl -X POST <span class="hljs-variable">$API_URL</span>/api/auth/login \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"username":"admin","password":"admin123"}'</span>
<span class="hljs-comment"># 返回: {"code":0,"message":"Login successful","data":{"token":"...","user":{...}}}</span>
</code></pre>
<h3 data-id="heading-41">8.4 测试图片上传</h3>
<ol>
<li>
<p>登录后台管理</p>
</li>
<li>
<p>进入 "文章管理" → "创建文章"</p>
</li>
<li>
<p>点击上传封面图片</p>
</li>
<li>
<p>选择一张图片（&lt;5MB）</p>
</li>
<li>
<p>确认：</p>
<ul>
<li>✅ 上传成功</li>
<li>✅ 图片预览显示</li>
<li>✅ 发布文章后，前端可以看到图片</li>
</ul>
</li>
</ol>
<hr/>
<h2 data-id="heading-42">9. Monorepo 特殊配置说明</h2>
<h3 data-id="heading-43">9.1 为什么需要特殊的构建命令？</h3>
<p>项目使用 Nx Monorepo，所有 packages 共享根目录的 <code>node_modules</code>：</p>
<pre><code class="hljs language-bash" lang="bash">blog/
├── node_modules/           <span class="hljs-comment"># 根依赖</span>
├── packages/
│   ├── blog-frontend/
│   │   ├── node_modules/   <span class="hljs-comment"># 子项目依赖</span>
│   │   └── package.json
│   └── blog-server/
│       └── ...
└── package.json            <span class="hljs-comment"># 根 package.json</span>
</code></pre>
<h3 data-id="heading-44">9.2 Vercel 构建命令解析</h3>
<p><strong>标准命令</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">npm install &amp;&amp; <span class="hljs-built_in">cd</span> packages/blog-frontend &amp;&amp; npm run build
</code></pre>
<p><strong>分解</strong>：</p>
<ol>
<li><code>npm install</code> - 安装根依赖（Nx, TypeScript 等）</li>
<li><code>cd packages/blog-frontend</code> - 进入前端目录</li>
<li><code>npm run build</code> - 构建前端（Rsbuild）</li>
</ol>
<h3 data-id="heading-45">9.3 输出目录配置</h3>
<p><strong>为什么是 <code>../../dist/packages/blog-frontend</code>？</strong></p>
<ul>
<li>Vercel 从 <code>packages/blog-frontend</code> 目录开始</li>
<li>输出到 <code>../../dist/packages/blog-frontend</code>（相对于当前目录）</li>
<li>实际路径：<code>blog/dist/packages/blog-frontend</code></li>
</ul>
<p><strong>rsbuild.config.ts 配置</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">output</span>: {
  <span class="hljs-attr">distPath</span>: {
    <span class="hljs-attr">root</span>: <span class="hljs-string">'../../dist/packages/blog-frontend'</span>
  }
}
</code></pre>
<h3 data-id="heading-46">9.4 API 代理重写机制</h3>
<p><strong>vercel.json 配置</strong>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"rewrites"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"source"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/api/:path*"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"destination"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://blog-2eqo.onrender.com/api/:path*"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>工作原理</strong>：</p>
<ol>
<li>前端发起请求：<code>/api/articles</code></li>
<li>Vercel 拦截请求，重写为：<code>https://blog-2eqo.onrender.com/api/articles</code></li>
<li>转发到 Render 后端</li>
<li>返回响应给前端</li>
</ol>
<p><strong>优点</strong>：</p>
<ul>
<li>✅ 前端无需关心 API 域名</li>
<li>✅ 避免 CORS 问题（同域请求）</li>
<li>✅ 简化环境变量管理</li>
</ul>
<hr/>
<h2 data-id="heading-47">10. 环境变量完整清单</h2>
<h3 data-id="heading-48">10.1 Render 环境变量（blog-server）</h3>






































































<table><thead><tr><th>变量名</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>NODE_ENV</code></td><td><code>production</code></td><td>生产环境标识</td></tr><tr><td><code>JWT_SECRET</code></td><td><code>&lt;随机 64 位字符串&gt;</code></td><td>JWT 签名密钥（必须修改）</td></tr><tr><td><code>JWT_EXPIRES_IN</code></td><td><code>7d</code></td><td>Token 过期时间</td></tr><tr><td><code>FRONTEND_URL</code></td><td><code>https://blog-frontend-xxxx.vercel.app</code></td><td>前端 URL（CORS）</td></tr><tr><td><code>ADMIN_URL</code></td><td><code>https://blog-admin-xxxx.vercel.app</code></td><td>后台 URL（CORS）</td></tr><tr><td><code>DB_HOST</code></td><td><code>&lt;Render 数据库 Hostname&gt;</code></td><td>数据库主机</td></tr><tr><td><code>DB_PORT</code></td><td><code>5432</code></td><td>数据库端口</td></tr><tr><td><code>DB_USER</code></td><td><code>&lt;Render 数据库 Username&gt;</code></td><td>数据库用户</td></tr><tr><td><code>DB_PASSWORD</code></td><td><code>&lt;Render 数据库 Password&gt;</code></td><td>数据库密码</td></tr><tr><td><code>DB_NAME</code></td><td><code>blog_system</code></td><td>数据库名称</td></tr><tr><td><code>MAX_FILE_SIZE</code></td><td><code>5242880</code></td><td>最大文件大小（5MB）</td></tr><tr><td><code>ALLOWED_IMAGE_TYPES</code></td><td><code>image/jpeg,image/png,image/gif,image/webp</code></td><td>允许的图片类型</td></tr></tbody></table>
<h3 data-id="heading-49">10.2 Vercel 环境变量（可选）</h3>
<p><strong>blog-frontend 和 blog-admin</strong>：</p>















<table><thead><tr><th>变量名</th><th>值</th><th>说明</th></tr></thead><tbody><tr><td><code>VITE_API_BASE_URL</code></td><td><code>&lt;Render API URL&gt;/api</code></td><td>API 基础 URL（可选）</td></tr></tbody></table>
<blockquote>
<p><strong>注意</strong>：由于使用了 <code>vercel.json</code> 的 <code>rewrites</code>，前端可以直接用 <code>/api</code> 请求，无需配置环境变量。</p>
</blockquote>
<h3 data-id="heading-50">10.3 安全性建议</h3>
<h4 data-id="heading-51">生成安全的 JWT_SECRET</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 方法 1：Node.js</span>
node -e <span class="hljs-string">"console.log(require('crypto').randomBytes(32).toString('hex'))"</span>

<span class="hljs-comment"># 方法 2：OpenSSL</span>
openssl rand -hex 32

<span class="hljs-comment"># 方法 3：在线工具</span>
<span class="hljs-comment"># https://www.uuidgenerator.net/</span>
</code></pre>
<h4 data-id="heading-52">环境变量管理</h4>
<ul>
<li>⚠️ <strong>永远不要</strong>把 <code>.env</code> 提交到 Git</li>
<li>✅ 使用 <code>.env.example</code> 作为模板</li>
<li>✅ 生产环境的密钥与开发环境不同</li>
<li>✅ 定期轮换 JWT_SECRET（需要用户重新登录）</li>
</ul>
<hr/>
<h2 data-id="heading-53">11. 免费额度说明</h2>
<h3 data-id="heading-54">11.1 Vercel 免费计划</h3>








































<table><thead><tr><th>项目</th><th>额度</th><th>说明</th></tr></thead><tbody><tr><td><strong>带宽</strong></td><td>100 GB/月</td><td>足够个人博客使用</td></tr><tr><td><strong>构建执行时间</strong></td><td>100 GB-小时/月</td><td>约 100 次构建</td></tr><tr><td><strong>部署数量</strong></td><td>无限</td><td>每次 push 都会部署</td></tr><tr><td><strong>项目数量</strong></td><td>无限</td><td>可以部署多个项目</td></tr><tr><td><strong>团队成员</strong></td><td>1 人</td><td>免费计划仅支持个人</td></tr><tr><td><strong>域名</strong></td><td>自定义域名</td><td>支持绑定自己的域名</td></tr></tbody></table>
<p><strong>限制</strong>：</p>
<ul>
<li>每次构建最多 45 分钟</li>
<li>无服务器函数最多运行 10 秒</li>
<li>环境变量最多 4KB</li>
</ul>
<p><strong>足够用于</strong>：</p>
<ul>
<li>✅ 个人博客</li>
<li>✅ 小型项目展示</li>
<li>✅ 前端应用</li>
<li>⚠️ 不适合高流量商业网站</li>
</ul>
<h3 data-id="heading-55">11.2 Render 免费计划</h3>








































<table><thead><tr><th>项目</th><th>额度</th><th>说明</th></tr></thead><tbody><tr><td><strong>运行时间</strong></td><td>750 小时/月</td><td>约 31 天，够用一整月</td></tr><tr><td><strong>内存</strong></td><td>512 MB</td><td>足够 Node.js 应用</td></tr><tr><td><strong>CPU</strong></td><td>共享</td><td>性能受限，但可接受</td></tr><tr><td><strong>带宽</strong></td><td>100 GB/月</td><td>出站流量限制</td></tr><tr><td><strong>构建时间</strong></td><td>每次 500 秒</td><td>足够 npm install + build</td></tr><tr><td><strong>PostgreSQL</strong></td><td>256 MB 存储</td><td>约可存储 10000+ 篇文章</td></tr></tbody></table>
<p><strong>重要限制</strong>：</p>
<ul>
<li>⚠️ <strong>服务会在 15 分钟无活动后休眠</strong></li>
<li>⚠️ <strong>从休眠唤醒需要 30-50 秒</strong>（首次访问慢）</li>
<li>⚠️ PostgreSQL 数据库 90 天未访问会被删除</li>
<li>✅ 数据库不会休眠（始终在线）</li>
</ul>
<p><strong>足够用于</strong>：</p>
<ul>
<li>✅ 个人博客后端</li>
<li>✅ API 服务</li>
<li>✅ 小型全栈应用</li>
<li>⚠️ 不适合需要即时响应的应用</li>
</ul>
<h3 data-id="heading-56">11.3 如何应对 Render 休眠？</h3>
<p><strong>方法 1：使用 UptimeRobot（推荐）</strong></p>
<ol>
<li>注册 <a href="https://link.juejin.cn?target=https%3A%2F%2Fuptimerobot.com" target="_blank" title="https://uptimerobot.com" ref="nofollow noopener noreferrer">uptimerobot.com</a>（免费）</li>
<li>添加 Monitor：
<ul>
<li><strong>Monitor Type</strong>: HTTP(s)</li>
<li><strong>URL</strong>: <code>https://blog-server-xxxx.onrender.com/api/health</code></li>
<li><strong>Monitoring Interval</strong>: 5 分钟</li>
</ul>
</li>
<li>UptimeRobot 会每 5 分钟 ping 一次，保持服务唤醒</li>
</ol>
<p><strong>方法 2：使用 Cron-job.org</strong></p>
<ol>
<li>注册 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcron-job.org" target="_blank" title="https://cron-job.org" ref="nofollow noopener noreferrer">cron-job.org</a></li>
<li>创建定时任务：
<ul>
<li><strong>URL</strong>: <code>https://blog-server-xxxx.onrender.com/api/health</code></li>
<li><strong>Execution</strong>: 每 10 分钟</li>
</ul>
</li>
</ol>
<p><strong>方法 3：前端定时请求（不推荐）</strong></p>
<p>在前端添加定时器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐：消耗用户带宽</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/health'</span>)
}, <span class="hljs-number">5</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>) <span class="hljs-comment">// 每 5 分钟</span>
</code></pre>
<hr/>
<h2 data-id="heading-57">12. 常见问题排查</h2>
<h3 data-id="heading-58">12.1 API 502/504 错误</h3>
<p><strong>症状</strong>：前端显示 "网络错误" 或 "502 Bad Gateway"</p>
<p><strong>原因</strong>：Render 服务休眠，正在唤醒</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>等待 30-50 秒，刷新页面</p>
</li>
<li>
<p>如果仍然失败，检查 Render 服务状态：</p>
<ul>
<li>进入 Render Dashboard → <code>blog-server</code></li>
<li>查看 "Logs" 是否有错误</li>
<li>确认服务状态为 "Live"</li>
</ul>
</li>
<li>
<p>如果服务启动失败，检查：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Render Shell 中</span>
node dist/server.js
<span class="hljs-comment"># 查看错误信息</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-59">12.2 CORS 错误</h3>
<p><strong>症状</strong>：浏览器控制台显示：</p>
<pre><code class="hljs language-rust" lang="rust">Access to fetch at <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//blog-xxxx.onrender.com/api/...'</span>
from origin <span class="hljs-symbol">'https</span>:<span class="hljs-comment">//blog-frontend-xxxx.vercel.app' has been blocked by CORS policy</span>
</code></pre>
<p><strong>原因</strong>：Render 环境变量中的 <code>FRONTEND_URL</code> 或 <code>ADMIN_URL</code> 不正确</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>检查 Render 环境变量：</p>
<ul>
<li><code>FRONTEND_URL</code> 必须与 Vercel 前端 URL 完全一致</li>
<li>包含 <code>https://</code></li>
<li>不包含尾部斜杠 <code>/</code></li>
</ul>
</li>
<li>
<p>确认 CORS 配置（<code>packages/blog-server/src/middleware/cors.ts</code>）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-attr">origin</span>: [
  env.<span class="hljs-property">FRONTEND_URL</span>,  <span class="hljs-comment">// 前端 URL</span>
  env.<span class="hljs-property">ADMIN_URL</span>      <span class="hljs-comment">// 后台 URL</span>
]
</code></pre>
</li>
<li>
<p>重启 Render 服务（修改环境变量后自动重启）</p>
</li>
</ol>
<h3 data-id="heading-60">12.3 Vercel 构建失败</h3>
<p><strong>症状</strong>：Vercel 部署失败，显示 "Build failed"</p>
<p><strong>常见错误 1：找不到模块</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">Error: Cannot find <span class="hljs-keyword">module</span> <span class="hljs-string">'react'</span>
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查 Build Command 是否包含 <code>npm install</code></li>
<li>确认 Root Directory 配置正确</li>
</ul>
<p><strong>常见错误 2：输出目录为空</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Error</span>: <span class="hljs-title class_">No</span> <span class="hljs-title class_">Output</span> <span class="hljs-title class_">Directory</span> named <span class="hljs-string">"dist"</span> found after the build
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查 Output Directory 配置：<code>../../dist/packages/blog-frontend</code></li>
<li>本地运行 <code>npm run build</code> 确认输出目录正确</li>
</ul>
<p><strong>常见错误 3：构建超时</strong></p>
<pre><code class="hljs language-csharp" lang="csharp">Error: Command timed <span class="hljs-keyword">out</span> after <span class="hljs-number">45</span> minutes
</code></pre>
<p><strong>解决方案</strong>：</p>
<ul>
<li>检查 <code>package.json</code> 是否有重复依赖</li>
<li>使用 <code>npm ci</code> 代替 <code>npm install</code>（更快）</li>
</ul>
<h3 data-id="heading-61">12.4 数据库连接失败</h3>
<p><strong>症状</strong>：Render 日志显示：</p>
<pre><code class="hljs language-arduino" lang="arduino">Error: connect ETIMEDOUT
</code></pre>
<p><strong>原因</strong>：数据库环境变量配置错误</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>检查 Render 环境变量：</p>
<ul>
<li><code>DB_HOST</code>、<code>DB_PORT</code>、<code>DB_USER</code>、<code>DB_PASSWORD</code>、<code>DB_NAME</code></li>
<li>与数据库 "Info" 标签的信息一致</li>
</ul>
</li>
<li>
<p>确认数据库状态为 "Available"</p>
</li>
<li>
<p>测试连接（在 Render Shell）：</p>
<pre><code class="hljs language-bash" lang="bash">psql <span class="hljs-variable">$DATABASE_URL</span> -c <span class="hljs-string">"SELECT 1"</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-62">12.5 图片显示 404</h3>
<p><strong>症状</strong>：前端文章列表或详情页，封面图片显示 404</p>
<p><strong>原因</strong>：数据库未初始化，或图片未上传</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>确认数据库已初始化：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Render Shell</span>
psql <span class="hljs-variable">$DATABASE_URL</span> -c <span class="hljs-string">"SELECT COUNT(*) FROM images"</span>
</code></pre>
</li>
<li>
<p>如果表不存在，运行：</p>
<pre><code class="hljs language-bash" lang="bash">npm run db:init
</code></pre>
</li>
<li>
<p>上传测试图片：</p>
<ul>
<li>登录后台管理</li>
<li>创建文章并上传封面</li>
</ul>
</li>
</ol>
<h3 data-id="heading-63">12.6 登录失败</h3>
<p><strong>症状</strong>：输入账号密码后，提示 "用户名或密码错误"</p>
<p><strong>原因</strong>：管理员账号未创建</p>
<p><strong>解决方案</strong>：</p>
<ol>
<li>
<p>检查数据库中的管理员：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在 Render Shell</span>
psql <span class="hljs-variable">$DATABASE_URL</span> -c <span class="hljs-string">"SELECT username, email FROM admin_users"</span>
</code></pre>
</li>
<li>
<p>如果为空，重新初始化：</p>
<pre><code class="hljs language-bash" lang="bash">npm run db:init
</code></pre>
</li>
<li>
<p>或手动创建管理员：</p>
<pre><code class="hljs language-bash" lang="bash">npm run create-admin
</code></pre>
</li>
</ol>
<hr/>
<h2 data-id="heading-64">13. 优化建议</h2>
<h3 data-id="heading-65">13.1 防止 Render 休眠</h3>
<p>使用 <strong>UptimeRobot</strong> 定期 ping API（推荐）：</p>
<ol>
<li>注册 <a href="https://link.juejin.cn?target=https%3A%2F%2Fuptimerobot.com" target="_blank" title="https://uptimerobot.com" ref="nofollow noopener noreferrer">uptimerobot.com</a></li>
<li>添加 HTTP Monitor</li>
<li>URL: <code>https://blog-server-xxxx.onrender.com/api/health</code></li>
<li>间隔: 5 分钟</li>
</ol>
<p><strong>效果</strong>：</p>
<ul>
<li>✅ 服务始终保持活跃</li>
<li>✅ 用户访问无需等待唤醒</li>
<li>✅ 免费，无需额外成本</li>
</ul>
<h3 data-id="heading-66">13.2 图片优化</h3>
<p><strong>问题</strong>：图片存储在数据库中，占用空间且加载慢</p>
<p><strong>优化方案</strong>：</p>
<ol>
<li>
<p><strong>压缩图片</strong>（前端上传前）</p>
<ul>
<li>使用 <code>browser-image-compression</code> 库</li>
<li>限制宽度 1200px，质量 80%</li>
</ul>
</li>
<li>
<p><strong>迁移到对象存储</strong>（推荐）</p>
<ul>
<li>使用 Cloudflare R2（免费 10GB）</li>
<li>或 AWS S3 + CloudFront</li>
<li>数据库只存储 URL</li>
</ul>
</li>
<li>
<p><strong>添加图片缓存</strong></p>
<ul>
<li>Vercel 自动缓存静态资源</li>
<li>后端添加 <code>Cache-Control</code> 头</li>
</ul>
</li>
</ol>
<h3 data-id="heading-67">13.3 性能监控</h3>
<p><strong>Vercel Analytics（免费）</strong>：</p>
<ol>
<li>进入 Vercel 项目 → <strong>"Analytics"</strong></li>
<li>启用 Web Analytics</li>
<li>查看：
<ul>
<li>页面加载时间</li>
<li>用户访问量</li>
<li>地理分布</li>
</ul>
</li>
</ol>
<p><strong>Render Metrics（免费）</strong>：</p>
<ol>
<li>进入 Render 服务 → <strong>"Metrics"</strong></li>
<li>查看：
<ul>
<li>CPU 使用率</li>
<li>内存使用率</li>
<li>HTTP 请求量</li>
</ul>
</li>
</ol>
<h3 data-id="heading-68">13.4 数据库备份</h3>
<p><strong>Render 免费计划不提供自动备份</strong>，建议手动备份：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 本地备份</span>
pg_dump <span class="hljs-string">"&lt;External Database URL&gt;"</span> &gt; backup.sql

<span class="hljs-comment"># 恢复</span>
psql <span class="hljs-string">"&lt;External Database URL&gt;"</span> &lt; backup.sql
</code></pre>
<p><strong>定期备份</strong>：</p>
<ul>
<li>每周备份一次</li>
<li>存储在 GitHub（加密）或 Google Drive</li>
</ul>
<h3 data-id="heading-69">13.5 日志管理</h3>
<p><strong>Winston 日志配置</strong>（已集成）：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// packages/blog-server/src/config/logger.ts</span>
<span class="hljs-keyword">const</span> logger = winston.<span class="hljs-title function_">createLogger</span>({
  <span class="hljs-attr">level</span>: <span class="hljs-string">'info'</span>,
  <span class="hljs-attr">format</span>: winston.<span class="hljs-property">format</span>.<span class="hljs-title function_">json</span>(),
  <span class="hljs-attr">transports</span>: [
    <span class="hljs-keyword">new</span> winston.<span class="hljs-property">transports</span>.<span class="hljs-title class_">Console</span>()
  ]
})
</code></pre>
<p><strong>查看日志</strong>：</p>
<ul>
<li>Render Dashboard → "Logs"</li>
<li>可以搜索、过滤、导出</li>
</ul>
<hr/>
<h2 data-id="heading-70">14. 持续部署（CI/CD）</h2>
<h3 data-id="heading-71">14.1 GitHub 集成</h3>
<p><strong>Vercel 自动部署</strong>：</p>
<ul>
<li>✅ Push 到 <code>main</code> 分支 → 自动部署到生产环境</li>
<li>✅ Pull Request → 自动部署预览环境</li>
<li>✅ 每次部署生成唯一 URL</li>
</ul>
<p><strong>Render 自动部署</strong>：</p>
<ul>
<li>✅ Push 到 <code>main</code> 分支 → 自动部署</li>
<li>✅ 构建日志实时查看</li>
<li>✅ 失败自动回滚到上一版本</li>
</ul>
<h3 data-id="heading-72">14.2 分支策略</h3>
<p><strong>推荐工作流</strong>：</p>
<pre><code class="hljs language-erlang" lang="erlang"><span class="hljs-function"><span class="hljs-title">main</span> <span class="hljs-params">(生产环境)</span>
  ↑
  └── <span class="hljs-title">develop</span> <span class="hljs-params">(开发环境)</span>
        ↑
        └── <span class="hljs-title">feature</span>/* <span class="hljs-params">(功能分支)</span>
</span></code></pre>
<p><strong>Vercel 多环境配置</strong>：</p>
<ol>
<li>
<p><strong>生产环境</strong>（main 分支）</p>
<ul>
<li>自动部署到 <code>blog-frontend.vercel.app</code></li>
</ul>
</li>
<li>
<p><strong>预览环境</strong>（Pull Request）</p>
<ul>
<li>每个 PR 生成预览 URL</li>
<li>例如：<code>blog-frontend-git-feature-xxxx.vercel.app</code></li>
</ul>
</li>
</ol>
<h3 data-id="heading-73">14.3 版本回滚</h3>
<p><strong>Vercel 回滚</strong>：</p>
<ol>
<li>进入项目 → <strong>"Deployments"</strong></li>
<li>找到之前的成功部署</li>
<li>点击 "..." → <strong>"Promote to Production"</strong></li>
</ol>
<p><strong>Render 回滚</strong>：</p>
<ol>
<li>进入服务 → <strong>"Deploys"</strong></li>
<li>找到之前的成功部署</li>
<li>点击 "..." → <strong>"Redeploy"</strong></li>
</ol>
<h3 data-id="heading-74">14.4 部署通知</h3>
<p><strong>Vercel 集成</strong>：</p>
<ol>
<li>项目 Settings → <strong>"Git"</strong> → <strong>"Deploy Hooks"</strong></li>
<li>添加 Webhook URL（例如：Slack、Discord）</li>
<li>每次部署自动通知</li>
</ol>
<p><strong>Render 集成</strong>：</p>
<ol>
<li>服务 Settings → <strong>"Notifications"</strong></li>
<li>添加邮箱或 Webhook</li>
<li>部署成功/失败自动通知</li>
</ol>
<hr/>
<h2 data-id="heading-75">15. 总结</h2>
<h3 data-id="heading-76">15.1 部署清单</h3>
<p>完成以下所有步骤，你的全栈博客就成功部署了：</p>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 创建 Render PostgreSQL 数据库</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 部署后端到 Render</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 配置环境变量</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 初始化数据库</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 部署前端到 Vercel</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 部署后台到 Vercel</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 更新 CORS 配置</li>
<li class="task-list-item"><input type="checkbox" checked="checked" disabled="disabled"/> 验证所有功能</li>
</ul>
<h3 data-id="heading-77">15.2 最终架构</h3>
<pre><code class="hljs language-scss" lang="scss">用户 → Vercel (前端/后台) → Render (API) → Render (PostgreSQL)
         ↓ 静态资源              ↓ 业务逻辑      ↓ 数据存储
       免费 <span class="hljs-number">100</span>GB              免费 <span class="hljs-number">750</span>h       免费 <span class="hljs-number">256</span>MB
</code></pre>
<h3 data-id="heading-78">15.3 访问地址</h3>





















<table><thead><tr><th>服务</th><th>URL</th></tr></thead><tbody><tr><td><strong>前端</strong></td><td><code>https://blog-frontend-xxxx.vercel.app</code></td></tr><tr><td><strong>后台</strong></td><td><code>https://blog-admin-xxxx.vercel.app</code></td></tr><tr><td><strong>API</strong></td><td><code>https://blog-server-xxxx.onrender.com</code></td></tr></tbody></table>
<h3 data-id="heading-79">15.4 下一步</h3>
<ul>
<li>🎨 自定义域名（Vercel 和 Render 都支持）</li>
<li>📊 配置 Analytics 和监控</li>
<li>🔄 设置 UptimeRobot 防止休眠</li>
<li>💾 定期备份数据库</li>
<li>🚀 优化图片加载和缓存</li>
<li>📝 创建第一篇文章</li>
</ul>
<hr/>
<h2 data-id="heading-80">16. 参考链接</h2>
<ul>
<li><strong>Vercel 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvercel.com%2Fdocs" target="_blank" title="https://vercel.com/docs" ref="nofollow noopener noreferrer">vercel.com/docs</a></li>
<li><strong>Render 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Frender.com%2Fdocs" target="_blank" title="https://render.com/docs" ref="nofollow noopener noreferrer">render.com/docs</a></li>
<li><strong>Nx Monorepo</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnx.dev" target="_blank" title="https://nx.dev" ref="nofollow noopener noreferrer">nx.dev</a></li>
<li><strong>PostgreSQL 文档</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.postgresql.org%2Fdocs%2F" target="_blank" title="https://www.postgresql.org/docs/" ref="nofollow noopener noreferrer">www.postgresql.org/docs/</a></li>
<li><strong>UptimeRobot</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fuptimerobot.com" target="_blank" title="https://uptimerobot.com" ref="nofollow noopener noreferrer">uptimerobot.com</a></li>
</ul>
<hr/>
<p><strong>🎉 恭喜！你的全栈博客已成功部署！</strong></p>
<p>如果遇到问题，请参考 <a href="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5" title="#12-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5">常见问题排查</a> 章节，或查看项目根目录的其他文档：</p>
<ul>
<li><a href="https://link.juejin.cn?target=..%2FREADME.md" target="_blank" title="../README.md" ref="nofollow noopener noreferrer">README.md</a> - 本地开发指南</li>
<li><a href="https://link.juejin.cn?target=..%2FRENDER_DEPLOYMENT.md" target="_blank" title="../RENDER_DEPLOYMENT.md" ref="nofollow noopener noreferrer">RENDER_DEPLOYMENT.md</a> - Render 详细部署指南</li>
<li><a href="https://link.juejin.cn?target=..%2FCLAUDE.md" target="_blank" title="../CLAUDE.md" ref="nofollow noopener noreferrer">CLAUDE.md</a> - 完整项目文档</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vue3+ts 中使用pinia状态管理]]></title>    <link>https://juejin.cn/post/7581314241410646051</link>    <guid>https://juejin.cn/post/7581314241410646051</guid>    <pubDate>2025-12-08T14:06:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581314241410646051" data-draft-id="7581348660823343104" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vue3+ts 中使用pinia状态管理"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-08T14:06:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="红色乌鸦"/> <meta itemprop="url" content="https://juejin.cn/user/1610106143510702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vue3+ts 中使用pinia状态管理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1610106143510702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    红色乌鸦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:06:49.000Z" title="Mon Dec 08 2025 14:06:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>下面详细介绍在 Vue3 + TypeScript 项目中使用 Pinia ^3.0.4 的完整步骤和最佳实践，包含核心概念、代码示例和常见场景。</p>
<h3 data-id="heading-0">一、环境准备</h3>
<p>确保项目已安装 Vue3 + TypeScript，然后安装 Pinia：</p>
<p>bash</p>
<p>运行</p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># npm</span>
npm install pinia@^3.<span class="hljs-number">0</span>.<span class="hljs-number">4</span>

<span class="hljs-comment"># yarn</span>
yarn add pinia@^3.<span class="hljs-number">0</span>.<span class="hljs-number">4</span>

<span class="hljs-comment"># pnpm</span>
pnpm add pinia@^3.<span class="hljs-number">0</span>.<span class="hljs-number">4</span>
</code></pre>
<h3 data-id="heading-1">二、初始化 Pinia</h3>
<p>在项目入口文件（如 <code>main.ts</code>）中创建并挂载 Pinia 实例：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
<span class="hljs-comment">// 创建 Pinia 实例</span>
<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()
<span class="hljs-comment">// 挂载到 Vue 应用</span>
app.<span class="hljs-title function_">use</span>(pinia)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<h3 data-id="heading-2">三、核心概念：定义 Store</h3>
<p>Pinia 中只有 <code>store</code> 概念（替代 Vuex 的 State/Mutation/Action/Getter），通过 <code>defineStore</code> 定义，推荐按<strong>功能模块</strong>划分 store。</p>
<h4 data-id="heading-3">3.1 基础示例（用户 Store）</h4>
<p>创建 <code>src/stores/user.ts</code>：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 第一个参数：store 唯一 ID（必须唯一）</span>
<span class="hljs-comment">// 第二个参数：store 配置对象</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ========== 1. 状态（State）：用 ref/reactive 定义 ==========</span>
  <span class="hljs-keyword">const</span> name = ref&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'张三'</span>)
  <span class="hljs-keyword">const</span> age = ref&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">20</span>)
  <span class="hljs-keyword">const</span> permissions = ref&lt;<span class="hljs-built_in">string</span>[]&gt;([<span class="hljs-string">'read'</span>, <span class="hljs-string">'write'</span>])

  <span class="hljs-comment">// ========== 2. 计算属性（Getters）：用 computed 定义 ==========</span>
  <span class="hljs-comment">// 注意：getter 依赖状态自动缓存，类似 Vue 组件的 computed</span>
  <span class="hljs-keyword">const</span> fullInfo = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`姓名：<span class="hljs-subst">${name.value}</span>，年龄：<span class="hljs-subst">${age.value}</span>`</span>
  })

  <span class="hljs-keyword">const</span> hasAdminPermission = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">return</span> permissions.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'admin'</span>)
  })

  <span class="hljs-comment">// ========== 3. 方法（Actions）：普通函数（支持同步/异步） ==========</span>
  <span class="hljs-comment">// 同步 Action</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateName</span>(<span class="hljs-params">newName: <span class="hljs-built_in">string</span></span>) {
    name.<span class="hljs-property">value</span> = newName
  }

  <span class="hljs-comment">// 异步 Action（示例：模拟接口请求）</span>
  <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchUserInfo</span>(<span class="hljs-params">userId: <span class="hljs-built_in">number</span></span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// 模拟 API 请求</span>
      <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;{ <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>; <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> }&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> })
        }, <span class="hljs-number">1000</span>)
      })
      name.<span class="hljs-property">value</span> = res.<span class="hljs-property">name</span>
      age.<span class="hljs-property">value</span> = res.<span class="hljs-property">age</span>
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'获取用户信息失败：'</span>, error)
    }
  }

  <span class="hljs-comment">// ========== 4. 暴露状态/计算属性/方法 ==========</span>
  <span class="hljs-keyword">return</span> {
    name,
    age,
    permissions,
    fullInfo,
    hasAdminPermission,
    updateName,
    fetchUserInfo
  }
})
</code></pre>
<h4 data-id="heading-4">3.2 类型提示说明</h4>
<ul>
<li>Pinia 结合 TypeScript 会自动推导类型，无需手动声明（如 <code>name</code> 自动推导为 <code>Ref&lt;string&gt;</code>）。</li>
<li>如果需要显式指定类型，可在 <code>ref</code>/<code>computed</code> 中明确标注（如上例）。</li>
</ul>
<h3 data-id="heading-5">四、在组件中使用 Store</h3>
<h4 data-id="heading-6">4.1 基础使用（组合式 API）</h4>
<p>vue</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- src/components/UserInfo.vue --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{{ userStore.fullInfo }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>是否有管理员权限：{{ userStore.hasAdminPermission ? '是' : '否' }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleUpdateName"</span>&gt;</span>修改姓名<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleFetchUser"</span>&gt;</span>异步获取用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// 导入定义的 store</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/user'</span>

<span class="hljs-comment">// 获取 store 实例（Pinia 会自动管理单例，多次调用返回同一个实例）</span>
<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()

<span class="hljs-comment">// 方法示例</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleUpdateName</span> = (<span class="hljs-params"/>) =&gt; {
  userStore.<span class="hljs-title function_">updateName</span>(<span class="hljs-string">'王五'</span>)
}

<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleFetchUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">await</span> userStore.<span class="hljs-title function_">fetchUserInfo</span>(<span class="hljs-number">1</span>)
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h4 data-id="heading-7">4.2 解构 Store（保持响应式）</h4>
<p>直接解构 store 会丢失响应式，需使用 <code>storeToRefs</code>：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { storeToRefs } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/user'</span>

<span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-comment">// 解构状态/计算属性（保持响应式）</span>
<span class="hljs-keyword">const</span> { name, age, fullInfo } = <span class="hljs-title function_">storeToRefs</span>(userStore)
<span class="hljs-comment">// 方法可直接解构（无需 ref）</span>
<span class="hljs-keyword">const</span> { updateName } = userStore

<span class="hljs-comment">// 使用</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(name.<span class="hljs-property">value</span>) <span class="hljs-comment">// 响应式</span>
<span class="hljs-title function_">updateName</span>(<span class="hljs-string">'赵六'</span>) <span class="hljs-comment">// 正常调用</span>
</code></pre>
<h3 data-id="heading-8">五、高级用法</h3>
<h4 data-id="heading-9">5.1 重置 Store 状态</h4>
<p>调用 <code>$reset()</code> 方法重置状态到初始值：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-scss" lang="scss">const userStore = <span class="hljs-built_in">useUserStore</span>()
userStore.<span class="hljs-variable">$reset</span>() <span class="hljs-comment">// 重置所有状态</span>
</code></pre>
<h4 data-id="heading-10">5.2 批量修改状态</h4>
<p>使用 <code>$patch</code> 方法批量更新（性能更优）：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方式1：对象形式（适合简单更新）</span>
userStore.$patch({
  <span class="hljs-attr">name</span>: <span class="hljs-string">'钱七'</span>,
  <span class="hljs-attr">age</span>: <span class="hljs-number">30</span>
})

<span class="hljs-comment">// 方式2：函数形式（适合复杂更新）</span>
userStore.$patch(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
  state.<span class="hljs-property">permissions</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'admin'</span>)
  state.<span class="hljs-property">age</span> += <span class="hljs-number">1</span>
})
</code></pre>
<h4 data-id="heading-11">5.3 监听 Store 变化</h4>
<p>使用 <code>$subscribe</code> 监听状态变化（类似 Vue 的 watch）：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
<span class="hljs-comment">// 监听所有状态变化</span>
<span class="hljs-keyword">const</span> unsubscribe = userStore.$subscribe(<span class="hljs-function">(<span class="hljs-params">mutation, state</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'状态变化：'</span>, mutation, state)
  <span class="hljs-comment">// mutation.type：'direct'（直接修改）| 'patch object' | 'patch function'</span>
  <span class="hljs-comment">// mutation.storeId：store 唯一 ID</span>
})

<span class="hljs-comment">// 取消监听（组件卸载时调用）</span>
<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">unsubscribe</span>()
})

<span class="hljs-comment">// 单独监听某个属性（用 Vue 的 watch）</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> userStore.<span class="hljs-property">age</span>, <span class="hljs-function">(<span class="hljs-params">newAge, oldAge</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'年龄变化：'</span>, newAge, oldAge)
})
</code></pre>
<h4 data-id="heading-12">5.4 Store 之间相互调用</h4>
<p>一个 store 可以导入并使用另一个 store：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// src/stores/cart.ts</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'./user'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCartStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'cart'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">const</span> cartList = ref&lt;<span class="hljs-title class_">Array</span>&lt;{ <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>; <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> }&gt;&gt;([])

  <span class="hljs-comment">// 根据用户权限过滤购物车</span>
  <span class="hljs-keyword">const</span> filteredCart = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (userStore.<span class="hljs-property">hasAdminPermission</span>) {
      <span class="hljs-keyword">return</span> cartList.<span class="hljs-property">value</span>
    }
    <span class="hljs-keyword">return</span> cartList.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">id</span> &lt; <span class="hljs-number">10</span>)
  })

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">addToCart</span>(<span class="hljs-params">item: { id: <span class="hljs-built_in">number</span>; name: <span class="hljs-built_in">string</span> }</span>) {
    <span class="hljs-comment">// 使用 userStore 的状态</span>
    <span class="hljs-keyword">if</span> (userStore.<span class="hljs-property">age</span> &gt;= <span class="hljs-number">18</span>) {
      cartList.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(item)
    }
  }

  <span class="hljs-keyword">return</span> { cartList, filteredCart, addToCart }
})
</code></pre>
<h4 data-id="heading-13">5.5 持久化存储（可选）</h4>
<p>结合 <code>pinia-plugin-persistedstate</code> 实现状态持久化（如 localStorage）：</p>
<p>bash</p>
<p>运行</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装插件</span>
npm install pinia-plugin-persistedstate
</code></pre>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// main.ts</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> piniaPluginPersistedstate <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia-plugin-persistedstate'</span>

<span class="hljs-keyword">const</span> pinia = <span class="hljs-title function_">createPinia</span>()
<span class="hljs-comment">// 注册持久化插件</span>
pinia.<span class="hljs-title function_">use</span>(piniaPluginPersistedstate)
</code></pre>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 修改 user store，添加持久化配置</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// ... 原有代码</span>
}, {
  <span class="hljs-comment">// 持久化配置</span>
  <span class="hljs-attr">persist</span>: {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'user-store'</span>, <span class="hljs-comment">// 自定义存储的 key</span>
    <span class="hljs-attr">storage</span>: <span class="hljs-variable language_">localStorage</span>, <span class="hljs-comment">// 存储方式（localStorage/sessionStorage）</span>
    <span class="hljs-attr">paths</span>: [<span class="hljs-string">'name'</span>, <span class="hljs-string">'age'</span>] <span class="hljs-comment">// 只持久化 name 和 age，默认所有状态</span>
  }
})
</code></pre>
<h3 data-id="heading-14">六、类型扩展（可选）</h3>
<p>如果需要扩展 Pinia 的类型（如自定义插件），可创建 <code>src/types/pinia.d.ts</code>：</p>
<p>typescript</p>
<p>运行</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'pinia'</span> {
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">PiniaCustomProperties</span> {
    <span class="hljs-comment">// 扩展 store 实例的属性/方法</span>
    <span class="hljs-attr">$log</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  }
}

<span class="hljs-comment">// 在 main.ts 中注册</span>
pinia.<span class="hljs-title function_">use</span>(<span class="hljs-function">(<span class="hljs-params">{ store }</span>) =&gt;</span> {
  store.<span class="hljs-property">$log</span> = <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`[<span class="hljs-subst">${store.$id}</span>]`</span>, store.<span class="hljs-property">$state</span>)
  }
})

<span class="hljs-comment">// 使用</span>
userStore.$log() <span class="hljs-comment">// 打印 store 状态</span>
</code></pre>
<h3 data-id="heading-15">七、注意事项</h3>
<ol>
<li><strong>Store ID 唯一性</strong>：<code>defineStore</code> 的第一个参数必须唯一，否则会导致状态冲突。</li>
<li><strong>避免在非组件中滥用 Store</strong>：如果在工具函数中使用 Store，确保 Pinia 已初始化。</li>
<li><strong>异步 Action 错误处理</strong>：异步 Action 需手动捕获异常，避免页面崩溃。</li>
<li><strong>响应式保持</strong>：解构 Store 状态时必须使用 <code>storeToRefs</code>，方法可直接解构。</li>
</ol>
<p>以上就是 Vue3 + TypeScript 中使用 Pinia ^3.0.4 的完整指南，涵盖了基础用法、高级特性和最佳实践，可根据项目需求灵活调整。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Native 工作原理深度解析：Bridge 机制与核心架构]]></title>    <link>https://juejin.cn/post/7581359420391768091</link>    <guid>https://juejin.cn/post/7581359420391768091</guid>    <pubDate>2025-12-08T14:19:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581359420391768091" data-draft-id="7581359420391751707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Native 工作原理深度解析：Bridge 机制与核心架构"/> <meta itemprop="keywords" content="React Native"/> <meta itemprop="datePublished" content="2025-12-08T14:19:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Native 工作原理深度解析：Bridge 机制与核心架构
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:19:00.000Z" title="Mon Dec 08 2025 14:19:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、引言：为什么需要了解工作原理？</h2>
<p>React Native 作为目前最流行的跨平台移动开发框架之一，其独特的"用JavaScript开发原生应用"的理念吸引了无数开发者。但真正掌握 React Native，不仅需要会使用它，更需要深入理解其底层工作原理。本文将深度剖析 React Native 的<strong>核心架构</strong>、<strong>Bridge 机制</strong>，并通过大量代码示例和流程图，让你彻底理解 React Native 是如何工作的。</p>
<h2 data-id="heading-1">二、React Native 整体架构概览</h2>
<h3 data-id="heading-2">1. 三层架构模型</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "JavaScript 层"
        A[JSX/React组件] --&gt; B[Virtual DOM&lt;br&gt;虚拟DOM]
        B --&gt; C[React Reconciler&lt;br&gt;协调器]
    end
    
    subgraph "Bridge 桥接层"
        C --&gt; D[MessageQueue&lt;br&gt;消息队列]
        D --&gt; E[Serialization&lt;br&gt;序列化/反序列化]
        E --&gt; F[Batched Bridge&lt;br&gt;批量桥接]
    end
    
    subgraph "Native 原生层"
        F --&gt; G[iOS/Android&lt;br&gt;原生模块]
        G --&gt; H[UIKit/View&lt;br&gt;原生UI组件]
        H --&gt; I[GPU渲染&lt;br&gt;屏幕显示]
    end
    
    J[开发者] --&gt; A
    I --&gt; K[用户界面]
    
    style D fill:#e1f5fe
    style E fill:#e1f5fe
    style F fill:#e1f5fe
</code></pre>
<h3 data-id="heading-3">2. 核心组件交互流程</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简单的React Native组件示例</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">View</span>, <span class="hljs-title class_">Text</span>, <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">SimpleApp</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">flex:</span> <span class="hljs-attr">1</span>, <span class="hljs-attr">justifyContent:</span> '<span class="hljs-attr">center</span>', <span class="hljs-attr">alignItems:</span> '<span class="hljs-attr">center</span>' }}&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>计数器: {count}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> 
        <span class="hljs-attr">title</span>=<span class="hljs-string">"增加"</span> 
        <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)} 
      /&gt;
    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
  );
};
</code></pre>
<p>这个简单的组件背后，隐藏着复杂的跨平台交互机制。让我们一步步拆解。</p>
<h2 data-id="heading-4">三、JavaScript 层深度解析</h2>
<h3 data-id="heading-5">1. JSX 到虚拟DOM的转换</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 开发者编写的JSX代码</span>
&lt;<span class="hljs-title class_">View</span> style={styles.<span class="hljs-property">container</span>}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span></span>
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"Press Me"</span> /&gt;</span></span>
&lt;/<span class="hljs-title class_">View</span>&gt;

<span class="hljs-comment">// 经过Babel转换后的JavaScript代码</span>
<span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(
  <span class="hljs-title class_">View</span>, 
  { <span class="hljs-attr">style</span>: styles.<span class="hljs-property">container</span> },
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">Text</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'Hello World'</span>),
  <span class="hljs-title class_">React</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-title class_">Button</span>, { <span class="hljs-attr">title</span>: <span class="hljs-string">'Press Me'</span> })
);

<span class="hljs-comment">// 对应的虚拟DOM对象</span>
<span class="hljs-keyword">const</span> virtualDOM = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'View'</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">style</span>: { <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span> },
    <span class="hljs-attr">children</span>: [
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'Text'</span>,
        <span class="hljs-attr">props</span>: {
          <span class="hljs-attr">children</span>: <span class="hljs-string">'Hello World'</span>
        }
      },
      {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'Button'</span>,
        <span class="hljs-attr">props</span>: {
          <span class="hljs-attr">title</span>: <span class="hljs-string">'Press Me'</span>
        }
      }
    ]
  }
};
</code></pre>
<h3 data-id="heading-6">2. React Reconciler（协调器）工作原理</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 简化的Reconciler实现概念</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Reconciler</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">previousTree</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentTree</span> = <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-comment">// 差异对比算法</span>
  <span class="hljs-title function_">diff</span>(<span class="hljs-params">newTree, oldTree</span>) {
    <span class="hljs-keyword">const</span> changes = [];
    
    <span class="hljs-comment">// 1. 节点类型不同，完全替换</span>
    <span class="hljs-keyword">if</span> (newTree.<span class="hljs-property">type</span> !== oldTree.<span class="hljs-property">type</span>) {
      changes.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'REPLACE'</span>,
        <span class="hljs-attr">node</span>: newTree
      });
    }
    <span class="hljs-comment">// 2. 属性不同，更新属性</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">propsChanged</span>(newTree.<span class="hljs-property">props</span>, oldTree.<span class="hljs-property">props</span>)) {
      changes.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'UPDATE_PROPS'</span>,
        <span class="hljs-attr">props</span>: newTree.<span class="hljs-property">props</span>
      });
    }
    
    <span class="hljs-comment">// 3. 递归处理子节点</span>
    <span class="hljs-keyword">const</span> childChanges = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">diffChildren</span>(newTree.<span class="hljs-property">children</span>, oldTree.<span class="hljs-property">children</span>);
    changes.<span class="hljs-title function_">push</span>(...childChanges);
    
    <span class="hljs-keyword">return</span> changes;
  }
  
  <span class="hljs-title function_">diffChildren</span>(<span class="hljs-params">newChildren, oldChildren</span>) {
    <span class="hljs-comment">// 使用key优化列表更新</span>
    <span class="hljs-keyword">const</span> changes = [];
    
    <span class="hljs-comment">// 简化的列表diff算法</span>
    <span class="hljs-keyword">const</span> maxLength = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(newChildren.<span class="hljs-property">length</span>, oldChildren.<span class="hljs-property">length</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; maxLength; i++) {
      <span class="hljs-keyword">if</span> (i &gt;= newChildren.<span class="hljs-property">length</span>) {
        <span class="hljs-comment">// 删除节点</span>
        changes.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'REMOVE'</span>, <span class="hljs-attr">index</span>: i });
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i &gt;= oldChildren.<span class="hljs-property">length</span>) {
        <span class="hljs-comment">// 新增节点</span>
        changes.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'INSERT'</span>, <span class="hljs-attr">node</span>: newChildren[i], <span class="hljs-attr">index</span>: i });
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// 递归比较</span>
        <span class="hljs-keyword">const</span> childChanges = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">diff</span>(newChildren[i], oldChildren[i]);
        <span class="hljs-keyword">if</span> (childChanges.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
          changes.<span class="hljs-title function_">push</span>({
            <span class="hljs-attr">type</span>: <span class="hljs-string">'UPDATE_CHILD'</span>,
            <span class="hljs-attr">index</span>: i,
            <span class="hljs-attr">changes</span>: childChanges
          });
        }
      }
    }
    
    <span class="hljs-keyword">return</span> changes;
  }
}
</code></pre>
<h2 data-id="heading-7">四、Bridge 机制：React Native 的核心</h2>
<h3 data-id="heading-8">1. Bridge 是什么？</h3>
<p><strong>Bridge</strong> 是 React Native 架构中最核心的概念，它是连接 JavaScript 运行时和 Native 原生环境的桥梁。Bridge 的主要职责包括：</p>
<ol>
<li><strong>通信中介</strong>：在 JS 线程和 Native 线程之间传递消息</li>
<li><strong>异步通信</strong>：确保线程安全，避免阻塞</li>
<li><strong>序列化/反序列化</strong>：转换不同环境间的数据格式</li>
<li><strong>消息队列</strong>：管理消息的发送和接收顺序</li>
</ol>
<h3 data-id="heading-9">2. Bridge 架构详解</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant JS as JavaScript线程
    participant MQ as MessageQueue
    participant S as Serializer
    participant B as BatchedBridge
    participant NM as NativeModules
    participant UI as Native UI线程
    
    Note over JS,UI: 初始化阶段
    JS-&gt;&gt;MQ: 注册JS模块和方法
    MQ-&gt;&gt;S: 序列化模块信息
    S-&gt;&gt;B: 传输到Native
    B-&gt;&gt;NM: 注册Native模块
    NM-&gt;&gt;UI: 初始化UI组件
    
    Note over JS,UI: 运行时通信
    JS-&gt;&gt;MQ: 调用Native方法(showAlert)
    MQ-&gt;&gt;S: 序列化调用信息
    S-&gt;&gt;B: 批量发送消息
    B-&gt;&gt;NM: 分发到对应模块
    NM-&gt;&gt;UI: 执行原生代码(显示弹窗)
    UI-&gt;&gt;NM: 执行完成
    NM-&gt;&gt;B: 返回结果
    B-&gt;&gt;S: 序列化结果
    S-&gt;&gt;MQ: 放入消息队列
    MQ-&gt;&gt;JS: 回调JavaScript
</code></pre>
<h3 data-id="heading-10">3. Bridge 实现代码解析</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Bridge核心实现概念代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ReactNativeBridge</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageQueue</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackQueue</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackId</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> = <span class="hljs-literal">false</span>;
    
    <span class="hljs-comment">// 初始化Native通信</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupNativeCommunication</span>();
  }
  
  <span class="hljs-comment">// 设置Native通信</span>
  <span class="hljs-title function_">setupNativeCommunication</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 创建通信通道</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">ReactNativeWebView</span>) {
      <span class="hljs-comment">// WebView环境</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">postMessage</span> = <span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">ReactNativeWebView</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message));
      };
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 原生环境（简化表示）</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">postMessage</span> = <span class="hljs-function">(<span class="hljs-params">message</span>) =&gt;</span> {
        <span class="hljs-comment">// 实际是通过JSI或原生桥接调用</span>
        <span class="hljs-variable language_">global</span>.<span class="hljs-title function_">__nativeCall</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(message));
      };
    }
    
    <span class="hljs-comment">// 设置消息接收器</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setupMessageReceiver</span>();
  }
  
  <span class="hljs-comment">// 调用Native方法</span>
  <span class="hljs-title function_">callNative</span>(<span class="hljs-params">moduleName, methodName, args, callback</span>) {
    <span class="hljs-keyword">const</span> messageId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateMessageId</span>();
    
    <span class="hljs-keyword">const</span> message = {
      <span class="hljs-attr">id</span>: messageId,
      <span class="hljs-attr">module</span>: moduleName,
      <span class="hljs-attr">method</span>: methodName,
      <span class="hljs-attr">args</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">serializeArgs</span>(args),
    };
    
    <span class="hljs-comment">// 如果有回调函数，保存起来</span>
    <span class="hljs-keyword">if</span> (callback) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackQueue</span>.<span class="hljs-title function_">set</span>(messageId, callback);
    }
    
    <span class="hljs-comment">// 将消息加入队列</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageQueue</span>.<span class="hljs-title function_">push</span>(message);
    
    <span class="hljs-comment">// 触发批量处理</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processQueue</span>();
    
    <span class="hljs-keyword">return</span> messageId;
  }
  
  <span class="hljs-comment">// 处理消息队列</span>
  <span class="hljs-title function_">processQueue</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageQueue</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span>;
    }
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> = <span class="hljs-literal">true</span>;
    
    <span class="hljs-comment">// 批量处理消息（React Native默认每16ms批量一次）</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> batch = <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageQueue</span>.<span class="hljs-title function_">slice</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageQueue</span> = [];
      
      <span class="hljs-comment">// 发送到Native</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">postMessage</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-string">'BATCH'</span>,
        <span class="hljs-attr">messages</span>: batch,
      });
      
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isProcessing</span> = <span class="hljs-literal">false</span>;
      
      <span class="hljs-comment">// 检查是否有新消息</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">messageQueue</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">processQueue</span>();
      }
    }, <span class="hljs-number">16</span>); <span class="hljs-comment">// 约等于一帧的时间</span>
  }
  
  <span class="hljs-comment">// 序列化参数</span>
  <span class="hljs-title function_">serializeArgs</span>(<span class="hljs-params">args</span>) {
    <span class="hljs-comment">// React Native使用特殊的序列化格式</span>
    <span class="hljs-comment">// 支持基本类型、数组、对象</span>
    <span class="hljs-keyword">return</span> args.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">arg</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">'function'</span>) {
        <span class="hljs-comment">// 函数会被转换为callbackId</span>
        <span class="hljs-keyword">const</span> callbackId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateCallbackId</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackQueue</span>.<span class="hljs-title function_">set</span>(callbackId, arg);
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">__type</span>: <span class="hljs-string">'function'</span>,
          <span class="hljs-attr">__id</span>: callbackId,
        };
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(arg)) {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">__type</span>: <span class="hljs-string">'array'</span>,
          <span class="hljs-attr">__value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">serializeArgs</span>(arg),
        };
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> arg === <span class="hljs-string">'object'</span> &amp;&amp; arg !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">__type</span>: <span class="hljs-string">'object'</span>,
          <span class="hljs-attr">__value</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(arg).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">obj, key</span>) =&gt;</span> {
            obj[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">serializeArgs</span>([arg[key]])[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">return</span> obj;
          }, {}),
        };
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">__type</span>: <span class="hljs-string">'primitive'</span>,
          <span class="hljs-attr">__value</span>: arg,
        };
      }
    });
  }
  
  <span class="hljs-comment">// 反序列化结果</span>
  <span class="hljs-title function_">deserializeResult</span>(<span class="hljs-params">result</span>) {
    <span class="hljs-keyword">if</span> (result.<span class="hljs-property">__type</span> === <span class="hljs-string">'array'</span>) {
      <span class="hljs-keyword">return</span> result.<span class="hljs-property">__value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">deserializeResult</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>));
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.<span class="hljs-property">__type</span> === <span class="hljs-string">'object'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(result.<span class="hljs-property">__value</span>).<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">obj, key</span>) =&gt;</span> {
        obj[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deserializeResult</span>(result.<span class="hljs-property">__value</span>[key]);
        <span class="hljs-keyword">return</span> obj;
      }, {});
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.<span class="hljs-property">__type</span> === <span class="hljs-string">'function'</span>) {
      <span class="hljs-comment">// 返回一个包装函数，调用Native</span>
      <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">callNative</span>(<span class="hljs-string">'CallbackModule'</span>, <span class="hljs-string">'invoke'</span>, 
          [result.<span class="hljs-property">__id</span>, args]);
      };
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> result.<span class="hljs-property">__value</span>;
    }
  }
  
  <span class="hljs-comment">// 接收Native消息</span>
  <span class="hljs-title function_">receiveNativeMessage</span>(<span class="hljs-params">messageStr</span>) {
    <span class="hljs-keyword">const</span> message = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(messageStr);
    
    <span class="hljs-keyword">if</span> (message.<span class="hljs-property">type</span> === <span class="hljs-string">'RESPONSE'</span>) {
      <span class="hljs-comment">// 处理Native返回结果</span>
      <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackQueue</span>.<span class="hljs-title function_">get</span>(message.<span class="hljs-property">id</span>);
      <span class="hljs-keyword">if</span> (callback) {
        <span class="hljs-keyword">const</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deserializeResult</span>(message.<span class="hljs-property">result</span>);
        <span class="hljs-title function_">callback</span>(result);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackQueue</span>.<span class="hljs-title function_">delete</span>(message.<span class="hljs-property">id</span>);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (message.<span class="hljs-property">type</span> === <span class="hljs-string">'CALLBACK'</span>) {
      <span class="hljs-comment">// Native调用JS回调</span>
      <span class="hljs-keyword">const</span> callback = <span class="hljs-variable language_">this</span>.<span class="hljs-property">callbackQueue</span>.<span class="hljs-title function_">get</span>(message.<span class="hljs-property">callbackId</span>);
      <span class="hljs-keyword">if</span> (callback) {
        <span class="hljs-keyword">const</span> args = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">deserializeResult</span>(message.<span class="hljs-property">args</span>);
        <span class="hljs-title function_">callback</span>(...args);
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (message.<span class="hljs-property">type</span> === <span class="hljs-string">'EVENT'</span>) {
      <span class="hljs-comment">// Native发送的事件</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">emitEvent</span>(message.<span class="hljs-property">eventName</span>, message.<span class="hljs-property">data</span>);
    }
  }
  
  <span class="hljs-title function_">generateMessageId</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`msg_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>_<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.callbackId++}</span>`</span>;
  }
  
  <span class="hljs-title function_">generateCallbackId</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`cb_<span class="hljs-subst">${<span class="hljs-built_in">Date</span>.now()}</span>_<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.callbackId++}</span>`</span>;
  }
}

<span class="hljs-comment">// 全局Bridge实例</span>
<span class="hljs-variable language_">global</span>.<span class="hljs-property">__ReactNativeBridge</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReactNativeBridge</span>();
</code></pre>
<h2 data-id="heading-11">五、Native 原生层实现</h2>
<h3 data-id="heading-12">1. iOS Native 模块实现</h3>
<pre><code class="hljs language-objective-c" lang="objective-c">// RCTBridgeModule.h (简化)
@protocol RCTBridgeModule &lt;NSObject&gt;
+ (NSString *)moduleName;
@optional
- (NSDictionary *)constantsToExport;
- (void)setBridge:(RCTBridge *)bridge;
@end

// AlertManager.m - iOS原生模块
#import &lt;React/RCTBridgeModule.h&gt;
#import &lt;React/RCTLog.h&gt;
#import &lt;UIKit/UIKit.h&gt;

@interface AlertManager : NSObject &lt;RCTBridgeModule&gt;
@end

@implementation AlertManager

// 导出模块名称
RCT_EXPORT_MODULE();

// 导出常量（同步）
- (NSDictionary *)constantsToExport {
  return @{
    @"Version": @"1.0.0",
    @"Platform": @"iOS"
  };
}

// 导出方法（异步）
RCT_EXPORT_METHOD(showAlert:(NSString *)title
                  message:(NSString *)message
                  options:(NSDictionary *)options
                  resolver:(RCTPromiseResolveBlock)resolve
                  rejecter:(RCTPromiseRejectBlock)reject) {
  
  // 必须在主线程执行UI操作
  dispatch_async(dispatch_get_main_queue(), ^{
    UIAlertController *alert = [UIAlertController
      alertControllerWithTitle:title
      message:message
      preferredStyle:UIAlertControllerStyleAlert];
    
    // 添加按钮
    UIAlertAction *okAction = [UIAlertAction
      actionWithTitle:@"OK"
      style:UIAlertActionStyleDefault
      handler:^(UIAlertAction *action) {
        resolve(@{@"buttonClicked": @"OK"});
      }];
    
    UIAlertAction *cancelAction = [UIAlertAction
      actionWithTitle:@"Cancel"
      style:UIAlertActionStyleCancel
      handler:^(UIAlertAction *action) {
        resolve(@{@"buttonClicked": @"Cancel"});
      }];
    
    [alert addAction:okAction];
    [alert addAction:cancelAction];
    
    // 获取当前显示的ViewController
    UIViewController *rootController = [UIApplication sharedApplication]
      .keyWindow.rootViewController;
    
    [rootController presentViewController:alert animated:YES completion:nil];
  });
}

// 导出线程配置（可选）
- (dispatch_queue_t)methodQueue {
  return dispatch_get_main_queue(); // UI操作必须在主线程
}

@end
</code></pre>
<h3 data-id="heading-13">2. Android Native 模块实现</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// AlertModule.java - Android原生模块</span>
<span class="hljs-keyword">package</span> com.example.app;

<span class="hljs-keyword">import</span> android.app.AlertDialog;
<span class="hljs-keyword">import</span> android.content.DialogInterface;

<span class="hljs-keyword">import</span> com.facebook.react.bridge.ReactApplicationContext;
<span class="hljs-keyword">import</span> com.facebook.react.bridge.ReactContextBaseJavaModule;
<span class="hljs-keyword">import</span> com.facebook.react.bridge.ReactMethod;
<span class="hljs-keyword">import</span> com.facebook.react.bridge.Promise;
<span class="hljs-keyword">import</span> com.facebook.react.bridge.WritableMap;
<span class="hljs-keyword">import</span> com.facebook.react.bridge.Arguments;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlertModule</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ReactContextBaseJavaModule</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ReactApplicationContext reactContext;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AlertModule</span><span class="hljs-params">(ReactApplicationContext reactContext)</span> {
        <span class="hljs-built_in">super</span>(reactContext);
        <span class="hljs-built_in">this</span>.reactContext = reactContext;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getName</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"AlertManager"</span>;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">getConstants</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">final</span> Map&lt;String, Object&gt; constants = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        constants.put(<span class="hljs-string">"Version"</span>, <span class="hljs-string">"1.0.0"</span>);
        constants.put(<span class="hljs-string">"Platform"</span>, <span class="hljs-string">"Android"</span>);
        <span class="hljs-keyword">return</span> constants;
    }

    <span class="hljs-meta">@ReactMethod</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">showAlert</span><span class="hljs-params">(String title, String message, 
                         ReadableMap options, Promise promise)</span> {
        <span class="hljs-comment">// 在主线程执行UI操作</span>
        getCurrentActivity().runOnUiThread(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                AlertDialog.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AlertDialog</span>.Builder(
                    getCurrentActivity());
                
                builder.setTitle(title)
                    .setMessage(message)
                    .setPositiveButton(<span class="hljs-string">"OK"</span>, 
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnClickListener() {
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-type">int</span> which)</span> {
                                <span class="hljs-type">WritableMap</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Arguments.createMap();
                                result.putString(<span class="hljs-string">"buttonClicked"</span>, <span class="hljs-string">"OK"</span>);
                                promise.resolve(result);
                            }
                        })
                    .setNegativeButton(<span class="hljs-string">"Cancel"</span>, 
                        <span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnClickListener() {
                            <span class="hljs-meta">@Override</span>
                            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(DialogInterface dialog, <span class="hljs-type">int</span> which)</span> {
                                <span class="hljs-type">WritableMap</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Arguments.createMap();
                                result.putString(<span class="hljs-string">"buttonClicked"</span>, <span class="hljs-string">"Cancel"</span>);
                                promise.resolve(result);
                            }
                        })
                    .setOnCancelListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DialogInterface</span>.OnCancelListener() {
                        <span class="hljs-meta">@Override</span>
                        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCancel</span><span class="hljs-params">(DialogInterface dialog)</span> {
                            promise.reject(<span class="hljs-string">"CANCELLED"</span>, <span class="hljs-string">"Dialog was cancelled"</span>);
                        }
                    });
                
                <span class="hljs-type">AlertDialog</span> <span class="hljs-variable">dialog</span> <span class="hljs-operator">=</span> builder.create();
                dialog.show();
            }
        });
    }
}

<span class="hljs-comment">// AlertPackage.java - 注册模块</span>
<span class="hljs-keyword">package</span> com.example.app;

<span class="hljs-keyword">import</span> com.facebook.react.ReactPackage;
<span class="hljs-keyword">import</span> com.facebook.react.bridge.NativeModule;
<span class="hljs-keyword">import</span> com.facebook.react.bridge.ReactApplicationContext;
<span class="hljs-keyword">import</span> com.facebook.react.uimanager.ViewManager;

<span class="hljs-keyword">import</span> java.util.ArrayList;
<span class="hljs-keyword">import</span> java.util.Collections;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AlertPackage</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ReactPackage</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;ViewManager&gt; <span class="hljs-title function_">createViewManagers</span><span class="hljs-params">(
        ReactApplicationContext reactContext)</span> {
        <span class="hljs-keyword">return</span> Collections.emptyList();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> List&lt;NativeModule&gt; <span class="hljs-title function_">createNativeModules</span><span class="hljs-params">(
        ReactApplicationContext reactContext)</span> {
        List&lt;NativeModule&gt; modules = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
        modules.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">AlertModule</span>(reactContext));
        <span class="hljs-keyword">return</span> modules;
    }
}
</code></pre>
<h2 data-id="heading-14">六、UI组件渲染流程</h2>
<h3 data-id="heading-15">1. 从JSX到原生UI的完整流程</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[开发者编写JSX] --&gt; B[Babel转译]
    B --&gt; C[React.createElement]
    C --&gt; D[Virtual DOM树]
    D --&gt; E[Reconciliation Diff]
    E --&gt; F[生成UI更新指令]
    
    subgraph "Bridge传输"
        F --&gt; G[序列化UI指令]
        G --&gt; H[通过Bridge传输]
        H --&gt; I[反序列化]
    end
    
    subgraph "Native渲染"
        I --&gt; J{iOS平台?}
        J --&gt; K[是]
        J --&gt; L[否]
        
        K --&gt; M[创建UIView]
        M --&gt; N[设置AutoLayout约束]
        N --&gt; O[添加到视图层级]
        
        L --&gt; P[创建View]
        P --&gt; Q[设置LayoutParams]
        Q --&gt; R[添加到ViewGroup]
    end
    
    O --&gt; S[Core Animation渲染]
    R --&gt; T[SurfaceFlinger渲染]
    
    S --&gt; U[GPU绘制]
    T --&gt; U
    
    U --&gt; V[屏幕显示]
</code></pre>
<h3 data-id="heading-16">2. 具体渲染示例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// React Native UI组件示例</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">ComplexUI</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [visible, setVisible] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.container}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Text</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.title}</span>&gt;</span>React Native渲染演示<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">ScrollView</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.scrollView}</span>&gt;</span>
        {Array.from({ length: 50 }).map((_, i) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{i}</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.item}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>项目 {i + 1}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Switch</span> 
              <span class="hljs-attr">value</span>=<span class="hljs-string">{visible}</span>
              <span class="hljs-attr">onValueChange</span>=<span class="hljs-string">{setVisible}</span>
            /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ScrollView</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Modal</span> <span class="hljs-attr">visible</span>=<span class="hljs-string">{visible}</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">View</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{styles.modal}</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>这是一个模态框<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> 
            <span class="hljs-attr">title</span>=<span class="hljs-string">"关闭"</span> 
            <span class="hljs-attr">onPress</span>=<span class="hljs-string">{()</span> =&gt;</span> setVisible(false)} 
          /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
  );
};

<span class="hljs-comment">// 对应的Native渲染指令（简化表示）</span>
<span class="hljs-keyword">const</span> renderCommands = [
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'CREATE_VIEW'</span>,
    <span class="hljs-attr">reactTag</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">viewName</span>: <span class="hljs-string">'RCTView'</span>,
    <span class="hljs-attr">props</span>: { <span class="hljs-attr">style</span>: { <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span> } }
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'CREATE_VIEW'</span>,
    <span class="hljs-attr">reactTag</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">viewName</span>: <span class="hljs-string">'RCTTextView'</span>,
    <span class="hljs-attr">props</span>: { <span class="hljs-attr">text</span>: <span class="hljs-string">'React Native渲染演示'</span> }
  },
  {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'ADD_CHILD'</span>,
    <span class="hljs-attr">parentTag</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">childTag</span>: <span class="hljs-number">2</span>
  },
  <span class="hljs-comment">// ... 更多命令</span>
];
</code></pre>
<h2 data-id="heading-17">七、新架构：JSI 和 Fabric</h2>
<h3 data-id="heading-18">1. 传统Bridge的问题</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统Bridge的局限性示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TraditionalBridgeProblem</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. 序列化/反序列化开销大</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">bigData</span> = { <span class="hljs-comment">/* 大量数据 */</span> };
    
    <span class="hljs-comment">// 2. 异步通信延迟</span>
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 调用Native方法</span>
      <span class="hljs-title class_">NativeModules</span>.<span class="hljs-property">DataProcessor</span>.<span class="hljs-title function_">process</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">bigData</span>, <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
        <span class="hljs-comment">// 回调有延迟</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'处理完成:'</span>, result);
      });
    }, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 3. 内存占用高</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cachedData</span> = [];
  }
  
  <span class="hljs-comment">// 频繁调用性能差</span>
  <span class="hljs-title function_">frequentCalls</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
      <span class="hljs-comment">// 每次调用都需要经过Bridge</span>
      <span class="hljs-title class_">NativeModules</span>.<span class="hljs-property">Utility</span>.<span class="hljs-title function_">doSomething</span>(i);
    }
  }
}
</code></pre>
<h3 data-id="heading-19">2. JSI（JavaScript Interface）架构</h3>
<pre><code class="hljs language-c++" lang="c++"><span class="hljs-comment">// JSI C++ 接口概念</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">JSIInterface</span> {
<span class="hljs-keyword">public</span>:
  <span class="hljs-comment">// JavaScript可以直接调用C++函数</span>
  <span class="hljs-function"><span class="hljs-type">static</span> Value <span class="hljs-title">callNativeFunction</span><span class="hljs-params">(
    Runtime &amp;runtime,
    <span class="hljs-type">const</span> Value &amp;thisValue,
    <span class="hljs-type">const</span> Value *arguments,
    <span class="hljs-type">size_t</span> count
  )</span> </span>{
    <span class="hljs-comment">// 直接执行，无需序列化</span>
    <span class="hljs-type">int</span> result = NativeCalculator::<span class="hljs-built_in">add</span>(
      arguments[<span class="hljs-number">0</span>].<span class="hljs-built_in">asNumber</span>(),
      arguments[<span class="hljs-number">1</span>].<span class="hljs-built_in">asNumber</span>()
    );
    
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Value</span>(result);
  }
  
  <span class="hljs-comment">// C++可以直接操作JavaScript对象</span>
  <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">modifyJSObject</span><span class="hljs-params">(Runtime &amp;runtime, Object &amp;jsObject)</span> </span>{
    <span class="hljs-comment">// 直接设置属性</span>
    jsObject.<span class="hljs-built_in">setProperty</span>(runtime, <span class="hljs-string">"modified"</span>, <span class="hljs-literal">true</span>);
    
    <span class="hljs-comment">// 直接调用JavaScript函数</span>
    Function jsFunc = jsObject.<span class="hljs-built_in">getPropertyAsFunction</span>(runtime, <span class="hljs-string">"callback"</span>);
    jsFunc.<span class="hljs-built_in">call</span>(runtime, <span class="hljs-built_in">Value</span>(<span class="hljs-string">"Hello from C++"</span>));
  }
};

<span class="hljs-comment">// JavaScript端使用</span>
global.nativeCalculator.add = (a, b) =&gt; {
  <span class="hljs-comment">// 实际上是直接调用C++函数</span>
  <span class="hljs-keyword">return</span> a + b; <span class="hljs-comment">// 通过JSI直接执行</span>
};
</code></pre>
<h3 data-id="heading-20">3. Fabric 渲染器</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Fabric渲染流程（对比传统）</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">FabricRenderer</span> = {
  <span class="hljs-comment">// 同步渲染</span>
  <span class="hljs-title function_">renderSync</span>(<span class="hljs-params">element, container</span>) {
    <span class="hljs-comment">// 1. 同步更新Shadow Tree</span>
    <span class="hljs-keyword">const</span> shadowNode = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createShadowNode</span>(element);
    
    <span class="hljs-comment">// 2. 直接调用Native组件</span>
    <span class="hljs-comment">// 无需经过Bridge异步通信</span>
    <span class="hljs-title class_">NativeFabricUIManager</span>.<span class="hljs-title function_">createNode</span>(
      shadowNode,
      container
    );
    
    <span class="hljs-comment">// 3. 立即提交更新</span>
    <span class="hljs-title class_">NativeFabricUIManager</span>.<span class="hljs-title function_">commitUpdate</span>();
  },
  
  <span class="hljs-comment">// 并发渲染支持</span>
  <span class="hljs-title function_">concurrentRender</span>(<span class="hljs-params">element</span>) {
    <span class="hljs-comment">// 可中断的渲染过程</span>
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startTransition</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// 高优先级更新</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">renderSync</span>(element);
    });
  }
};

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">import</span> { unstable_createElement <span class="hljs-keyword">as</span> createElement } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-native'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">FabricComponent</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// 使用Fabric渲染器</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'View'</span>, {
    <span class="hljs-attr">style</span>: { <span class="hljs-attr">flex</span>: <span class="hljs-number">1</span> },
    <span class="hljs-attr">onLayout</span>: <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
      <span class="hljs-comment">// 事件处理更高效</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'布局完成:'</span>, event.<span class="hljs-property">nativeEvent</span>.<span class="hljs-property">layout</span>);
    }
  });
};
</code></pre>
<h2 data-id="heading-21">八、性能优化与最佳实践</h2>
<h3 data-id="heading-22">1. Bridge 通信优化</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 优化Bridge通信的示例</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BridgeOptimization</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchUpdates</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchTimer</span> = <span class="hljs-literal">null</span>;
  }
  
  <span class="hljs-comment">// 1. 批量更新</span>
  <span class="hljs-title function_">scheduleUpdate</span>(<span class="hljs-params">updateFn</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchUpdates</span>.<span class="hljs-title function_">push</span>(updateFn);
    
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">batchTimer</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchTimer</span> = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">flushUpdates</span>();
      }, <span class="hljs-number">16</span>); <span class="hljs-comment">// 一帧的时间</span>
    }
  }
  
  <span class="hljs-title function_">flushUpdates</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> updates = <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchUpdates</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchUpdates</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">batchTimer</span> = <span class="hljs-literal">null</span>;
    
    <span class="hljs-comment">// 批量发送到Native</span>
    <span class="hljs-title class_">NativeModules</span>.<span class="hljs-property">BatchProcessor</span>.<span class="hljs-title function_">processBatch</span>(updates);
  }
  
  <span class="hljs-comment">// 2. 减少序列化数据</span>
  <span class="hljs-title function_">optimizeData</span>(<span class="hljs-params">data</span>) {
    <span class="hljs-comment">// 只传输必要数据</span>
    <span class="hljs-keyword">const</span> optimized = {
      <span class="hljs-attr">id</span>: data.<span class="hljs-property">id</span>,
      <span class="hljs-comment">// 避免传输函数</span>
      <span class="hljs-comment">// callback: data.callback, // 不要这样</span>
      <span class="hljs-attr">type</span>: data.<span class="hljs-property">type</span>
    };
    
    <span class="hljs-comment">// 使用共享内存（如果支持）</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">global</span>.<span class="hljs-property">SharedArrayBuffer</span>) {
      <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SharedArrayBuffer</span>(<span class="hljs-number">1024</span>);
      <span class="hljs-comment">// ... 填充数据</span>
      <span class="hljs-keyword">return</span> { buffer };
    }
    
    <span class="hljs-keyword">return</span> optimized;
  }
  
  <span class="hljs-comment">// 3. 使用TurboModules（新架构）</span>
  <span class="hljs-title function_">setupTurboModules</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">global</span>.<span class="hljs-property">__turboModuleProxy</span>) {
      <span class="hljs-comment">// 按需加载原生模块</span>
      <span class="hljs-keyword">const</span> <span class="hljs-title class_">MyTurboModule</span> = <span class="hljs-variable language_">global</span>.<span class="hljs-property">__turboModuleProxy</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'MyModule'</span>);
      
      <span class="hljs-comment">// 同步调用</span>
      <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">MyTurboModule</span>.<span class="hljs-title function_">doSomethingSync</span>();
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'同步结果:'</span>, result);
    }
  }
}

<span class="hljs-comment">// 4. 内存管理优化</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryOptimization</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupCallbacks</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">nativeReferences</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WeakMap</span>();
  }
  
  <span class="hljs-title function_">registerCleanup</span>(<span class="hljs-params">instance, cleanupFn</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupCallbacks</span>.<span class="hljs-title function_">add</span>(cleanupFn);
    
    <span class="hljs-comment">// 组件卸载时清理</span>
    <span class="hljs-keyword">const</span> originalWillUnmount = instance.<span class="hljs-property">componentWillUnmount</span>;
    instance.<span class="hljs-property">componentWillUnmount</span> = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">if</span> (originalWillUnmount) {
        originalWillUnmount.<span class="hljs-title function_">call</span>(instance);
      }
      <span class="hljs-title function_">cleanupFn</span>();
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupCallbacks</span>.<span class="hljs-title function_">delete</span>(cleanupFn);
    };
  }
  
  <span class="hljs-comment">// 释放Native资源</span>
  <span class="hljs-title function_">releaseNativeResources</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupCallbacks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">fn</span> =&gt;</span> <span class="hljs-title function_">fn</span>());
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cleanupCallbacks</span>.<span class="hljs-title function_">clear</span>();
  }
}
</code></pre>
<h3 data-id="heading-23">2. 实际优化案例</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 优化前的代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UnoptimizedComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 频繁调用Bridge</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">interval</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title class_">NativeModules</span>.<span class="hljs-property">Sensor</span>.<span class="hljs-title function_">getData</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">sensorData</span>: data });
        <span class="hljs-comment">// 每次都会序列化/反序列化</span>
      });
    }, <span class="hljs-number">16</span>); <span class="hljs-comment">// 每帧都调用！</span>
  }
  
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 大数据量列表</span>
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FlatList</span>
        <span class="hljs-attr">data</span>=<span class="hljs-string">{this.state.hugeArray}</span>
        <span class="hljs-attr">renderItem</span>=<span class="hljs-string">{({</span> <span class="hljs-attr">item</span> }) =&gt;</span> (
          <span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{JSON.stringify(item)}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
            {/* 每次渲染都创建新对象 */}
          <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span>
        )}
      /&gt;</span>
    );
  }
}

<span class="hljs-comment">// 优化后的代码</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedComponent</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">props</span>) {
    <span class="hljs-variable language_">super</span>(props);
    <span class="hljs-comment">// 1. 使用ref避免重复创建函数</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleData</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleData</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderItem</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderItem</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>);
    
    <span class="hljs-comment">// 2. 使用requestAnimationFrame优化频繁更新</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationFrame</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span> = <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-title function_">componentDidMount</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 使用requestAnimationFrame替代setInterval</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">update</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">animationFrame</span> = <span class="hljs-title function_">requestAnimationFrame</span>(update);
      
      <span class="hljs-keyword">const</span> now = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">if</span> (now - <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span> &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// 限制为10fps</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">lastUpdate</span> = now;
        
        <span class="hljs-comment">// 批量获取数据</span>
        <span class="hljs-title class_">NativeModules</span>.<span class="hljs-property">Sensor</span>.<span class="hljs-title function_">getBatchData</span>(
          [<span class="hljs-string">'temperature'</span>, <span class="hljs-string">'humidity'</span>],
          <span class="hljs-variable language_">this</span>.<span class="hljs-property">handleData</span>
        );
      }
    };
    
    <span class="hljs-title function_">update</span>();
  }
  
  <span class="hljs-title function_">componentWillUnmount</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">animationFrame</span>) {
      <span class="hljs-title function_">cancelAnimationFrame</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">animationFrame</span>);
    }
    
    <span class="hljs-comment">// 清理Native资源</span>
    <span class="hljs-title class_">NativeModules</span>.<span class="hljs-property">Sensor</span>.<span class="hljs-title function_">unregister</span>();
  }
  
  handleData = <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {
    <span class="hljs-comment">// 使用函数式更新避免多次setState</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(<span class="hljs-function"><span class="hljs-params">prevState</span> =&gt;</span> ({
      <span class="hljs-attr">sensorData</span>: {
        ...prevState.<span class="hljs-property">sensorData</span>,
        ...data
      }
    }));
  };
  
  <span class="hljs-comment">// 使用React.memo和useMemo优化渲染</span>
  renderItem = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">memo</span>(<span class="hljs-function">(<span class="hljs-params">{ item }</span>) =&gt;</span> {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">View</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Text</span>&gt;</span>{item.id}<span class="hljs-tag">&lt;/<span class="hljs-name">Text</span>&gt;</span>
        {/* 只渲染必要数据 */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">View</span>&gt;</span></span>
    );
  });
  
  <span class="hljs-title function_">render</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 使用getItemLayout优化FlatList</span>
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">FlatList</span>
        <span class="hljs-attr">data</span>=<span class="hljs-string">{this.state.filteredArray}</span> // <span class="hljs-attr">使用过滤后的数据</span>
        <span class="hljs-attr">renderItem</span>=<span class="hljs-string">{this.renderItem}</span>
        <span class="hljs-attr">keyExtractor</span>=<span class="hljs-string">{item</span> =&gt;</span> item.id}
        getItemLayout={(data, index) =&gt; ({
          length: 50,
          offset: 50 * index,
          index,
        })}
        initialNumToRender={10}
        maxToRenderPerBatch={5}
        windowSize={5}
        removeClippedSubviews={true}
      /&gt;</span>
    );
  }
}
</code></pre>
<h2 data-id="heading-24">九、调试与问题排查</h2>
<h3 data-id="heading-25">1. Bridge 通信调试工具</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Bridge调试工具</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">BridgeDebugger</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">messageLog</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span> = [];
    
    <span class="hljs-comment">// 拦截Bridge通信</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">interceptBridge</span>();
  }
  
  <span class="hljs-title function_">interceptBridge</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> originalCall = <span class="hljs-variable language_">global</span>.<span class="hljs-property">__ReactNativeBridge</span>.<span class="hljs-property">callNative</span>;
    
    <span class="hljs-variable language_">global</span>.<span class="hljs-property">__ReactNativeBridge</span>.<span class="hljs-property">callNative</span> = <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>();
      <span class="hljs-keyword">const</span> messageId = originalCall.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
      <span class="hljs-keyword">const</span> endTime = performance.<span class="hljs-title function_">now</span>();
      
      <span class="hljs-comment">// 记录性能数据</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">id</span>: messageId,
        <span class="hljs-attr">duration</span>: endTime - startTime,
        <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>(),
        <span class="hljs-attr">args</span>: args.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, -<span class="hljs-number">1</span>) <span class="hljs-comment">// 排除callback</span>
      });
      
      <span class="hljs-comment">// 限制日志大小</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1000</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-title function_">shift</span>();
      }
      
      <span class="hljs-keyword">return</span> messageId;
    };
  }
  
  <span class="hljs-comment">// 分析性能瓶颈</span>
  <span class="hljs-title function_">analyzePerformance</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> stats = {
      <span class="hljs-attr">totalCalls</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-property">length</span>,
      <span class="hljs-attr">avgDuration</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">slowCalls</span>: [],
      <span class="hljs-attr">frequentModules</span>: {}
    };
    
    <span class="hljs-keyword">let</span> totalDuration = <span class="hljs-number">0</span>;
    
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">performanceLog</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">log</span> =&gt;</span> {
      totalDuration += log.<span class="hljs-property">duration</span>;
      
      <span class="hljs-comment">// 识别慢调用</span>
      <span class="hljs-keyword">if</span> (log.<span class="hljs-property">duration</span> &gt; <span class="hljs-number">100</span>) { <span class="hljs-comment">// 超过100ms</span>
        stats.<span class="hljs-property">slowCalls</span>.<span class="hljs-title function_">push</span>(log);
      }
      
      <span class="hljs-comment">// 统计模块调用频率</span>
      <span class="hljs-keyword">const</span> moduleName = log.<span class="hljs-property">args</span>[<span class="hljs-number">0</span>];
      stats.<span class="hljs-property">frequentModules</span>[moduleName] = 
        (stats.<span class="hljs-property">frequentModules</span>[moduleName] || <span class="hljs-number">0</span>) + <span class="hljs-number">1</span>;
    });
    
    stats.<span class="hljs-property">avgDuration</span> = totalDuration / stats.<span class="hljs-property">totalCalls</span>;
    
    <span class="hljs-keyword">return</span> stats;
  }
  
  <span class="hljs-comment">// 生成性能报告</span>
  <span class="hljs-title function_">generateReport</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> stats = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">analyzePerformance</span>();
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">group</span>(<span class="hljs-string">'React Native Bridge 性能报告'</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`总调用次数: <span class="hljs-subst">${stats.totalCalls}</span>`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`平均耗时: <span class="hljs-subst">${stats.avgDuration.toFixed(<span class="hljs-number">2</span>)}</span>ms`</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`慢调用(<span class="hljs-subst">${stats.slowCalls.length}</span>次):`</span>, stats.<span class="hljs-property">slowCalls</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'模块调用频率:'</span>, stats.<span class="hljs-property">frequentModules</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">groupEnd</span>();
    
    <span class="hljs-comment">// 给出优化建议</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">giveRecommendations</span>(stats);
  }
  
  <span class="hljs-title function_">giveRecommendations</span>(<span class="hljs-params">stats</span>) {
    <span class="hljs-keyword">const</span> recommendations = [];
    
    <span class="hljs-keyword">if</span> (stats.<span class="hljs-property">avgDuration</span> &gt; <span class="hljs-number">50</span>) {
      recommendations.<span class="hljs-title function_">push</span>(<span class="hljs-string">'平均调用时间过长，考虑使用批量更新'</span>);
    }
    
    <span class="hljs-keyword">if</span> (stats.<span class="hljs-property">slowCalls</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">10</span>) {
      recommendations.<span class="hljs-title function_">push</span>(<span class="hljs-string">'存在多个慢调用，建议优化相应Native模块'</span>);
    }
    
    <span class="hljs-comment">// 找出调用最频繁的模块</span>
    <span class="hljs-keyword">const</span> mostFrequent = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(stats.<span class="hljs-property">frequentModules</span>)
      .<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> b[<span class="hljs-number">1</span>] - a[<span class="hljs-number">1</span>])[<span class="hljs-number">0</span>];
    
    <span class="hljs-keyword">if</span> (mostFrequent &amp;&amp; mostFrequent[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">100</span>) {
      recommendations.<span class="hljs-title function_">push</span>(
        <span class="hljs-string">`模块"<span class="hljs-subst">${mostFrequent[<span class="hljs-number">0</span>]}</span>"调用频繁(<span class="hljs-subst">${mostFrequent[<span class="hljs-number">1</span>]}</span>次)，考虑优化`</span>
      );
    }
    
    <span class="hljs-keyword">if</span> (recommendations.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">group</span>(<span class="hljs-string">'优化建议'</span>);
      recommendations.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">rec, i</span>) =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>. <span class="hljs-subst">${rec}</span>`</span>);
      });
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">groupEnd</span>();
    }
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">if</span> (__DEV__) {
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">debugger</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BridgeDebugger</span>();
  
  <span class="hljs-comment">// 定期生成报告</span>
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">debugger</span>.<span class="hljs-title function_">generateReport</span>();
  }, <span class="hljs-number">30000</span>); <span class="hljs-comment">// 每30秒</span>
}
</code></pre>
<h2 data-id="heading-26">十、总结与未来展望</h2>
<h3 data-id="heading-27">1. 核心要点总结</h3>
<p>React Native 的工作原理可以概括为以下几个关键点：</p>
<ol>
<li><strong>三层架构</strong>：JavaScript层 + Bridge桥接层 + Native原生层</li>
<li><strong>异步通信</strong>：通过Bridge进行序列化/反序列化的消息传递</li>
<li><strong>虚拟DOM</strong>：React协调器负责计算UI更新差异</li>
<li><strong>原生渲染</strong>：最终由iOS/Android原生组件渲染到屏幕</li>
</ol>
<h3 data-id="heading-28">2. Bridge 机制的核心价值与局限</h3>
<p><strong>优势：</strong></p>
<ul>
<li>实现真正的跨平台开发</li>
<li>保持原生应用性能和体验</li>
<li>支持热重载，提升开发效率</li>
<li>庞大的JavaScript生态可利用</li>
</ul>
<p><strong>局限：</strong></p>
<ul>
<li>异步通信带来的性能开销</li>
<li>序列化/反序列化的成本</li>
<li>内存占用相对较高</li>
<li>调试相对复杂</li>
</ul>
<h3 data-id="heading-29">3. 新架构的革命性改进</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    A[传统Bridge架构] --&gt; B[新架构 JSI+Fabric]
    
    subgraph "传统架构问题"
        C[异步通信延迟]
        D[序列化开销大]
        E[内存占用高]
        F[渲染不同步]
    end
    
    subgraph "新架构改进"
        G[同步直接调用]
        H[共享内存]
        I[并发渲染]
        J[统一渲染器]
    end
    
    C -.-&gt; G
    D -.-&gt; H
    E -.-&gt; I
    F -.-&gt; J
</code></pre>
<h3 data-id="heading-30">4. 学习与实践建议</h3>
<ol>
<li><strong>初学者</strong>：先掌握基本使用，理解组件生命周期和状态管理</li>
<li><strong>中级开发者</strong>：深入研究Bridge机制，学习性能优化技巧</li>
<li><strong>高级开发者</strong>：探索新架构，参与开源社区贡献</li>
<li><strong>架构师</strong>：根据项目需求选择合适的架构方案</li>
</ol>
<h3 data-id="heading-31">5. 未来发展趋势</h3>
<ol>
<li><strong>JSI全面普及</strong>：消除Bridge性能瓶颈</li>
<li><strong>Fabric渲染器成熟</strong>：提供更流畅的UI体验</li>
<li><strong>TypeScript深度集成</strong>：更好的类型安全</li>
<li><strong>Web平台支持</strong>：真正的"一次编写，处处运行"</li>
<li><strong>AI辅助开发</strong>：智能化代码生成和优化</li>
</ol>
<h2 data-id="heading-32">结语</h2>
<p>React Native 的成功不仅在于其技术实现，更在于它巧妙地平衡了开发效率和应用性能。Bridge 机制作为其核心，虽然存在一些性能开销，但也为跨平台开发提供了可行的解决方案。</p>
<p>随着新架构的不断成熟，React Native 正在向更高效、更强大的方向发展。作为开发者，理解其底层原理不仅能帮助我们写出更好的代码，也能让我们在面对复杂问题时，能够从根源上找到解决方案。</p>
<p>无论你是刚开始接触 React Native，还是已经在生产环境中使用它，希望本文能为你提供有价值的参考。技术的道路永无止境，保持好奇，持续学习，我们才能在快速变化的技术世界中立于不败之地。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da3816f1dbef471c8b1aec36af91c227~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765808340&amp;x-signature=0Tx0WHo5F7c6yxpw2H735S1CYXQ%3D" alt="在这里插入图片描述" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Hora Dart：我为什么从 jiffy 用户变成了新日期库的作者]]></title>    <link>https://juejin.cn/post/7581306080434798643</link>    <guid>https://juejin.cn/post/7581306080434798643</guid>    <pubDate>2025-12-08T12:42:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080434798643" data-draft-id="7581406561685012526" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Hora Dart：我为什么从 jiffy 用户变成了新日期库的作者"/> <meta itemprop="keywords" content="Flutter,Dart,前端"/> <meta itemprop="datePublished" content="2025-12-08T12:42:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="我心里危险的东西"/> <meta itemprop="url" content="https://juejin.cn/user/1591748568562829"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Hora Dart：我为什么从 jiffy 用户变成了新日期库的作者
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748568562829/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    我心里危险的东西
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:42:52.000Z" title="Mon Dec 08 2025 12:42:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;position:relative;background-image:linear-gradient(90deg,rgba(217,234,251,.25) 3%,transparent 0),linear-gradient(1turn,rgba(217,234,251,.25) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;padding-left:8px;padding-bottom:0;margin-top:35px;margin-bottom:10px;font-weight:900;font-family:serif;letter-spacing:1px;color:#000}.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover{background-color:#fff}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;position:relative}.markdown-body h2:after{content:"";left:0;bottom:0;width:100%;height:1px;position:absolute}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{height:1px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#37b2ff 0,#37b2ff 25%,transparent 50%)}.markdown-body code{margin:0 4px;word-break:break-word;overflow-x:auto;background-color:#fff7f7;color:#f06;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:-apple-system,system-ui,Menlo,Monaco,Consolas,Courier New;position:relative}.markdown-body pre{margin:15px 8px;border:1px solid #f5f5f7;line-height:1.75}.markdown-body pre:before{top:-4px;left:-4px;border-top:8px solid #feea1e;border-left:8px solid #feea1e}.markdown-body pre:after,.markdown-body pre:before{width:20px;height:20px;content:"";z-index:10;position:absolute}.markdown-body pre:after{right:-4px;bottom:-4px;border-right:8px solid #37b2ff;border-bottom:8px solid #37b2ff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;overflow-x:auto;margin:0;word-break:normal;display:block;color:#333;background-color:#fff;position:unset!important}.markdown-body pre:nth-child(odd):before{border-top-color:#a7ecad;border-left-color:#a7ecad}.markdown-body pre:nth-child(odd):after{border-right-color:#e699e6;border-bottom-color:#e699e6}.markdown-body a{margin:0 4px;text-decoration:none;color:#37b2ff;transition:.3s;display:inline-block;vertical-align:bottom;position:relative}.markdown-body a:before{content:"READ MORE +";bottom:90%;width:120px;max-width:0;color:#fff;background-color:#1fb3ff;position:absolute;white-space:nowrap;transition:.3s;box-sizing:border-box;pointer-events:none;overflow:hidden}.markdown-body a:after{content:"";bottom:0;left:0;width:100%;height:1px;border-bottom:1px dashed #37b2ff;position:absolute}.markdown-body a:active:before,.markdown-body a:hover:before{max-width:120px;padding-left:14px}.markdown-body table{width:100%;max-width:100%;font-size:12px;background-color:#fff;overflow:auto;border-collapse:collapse}.markdown-body table tr:hover td,.markdown-body table tr:hover th{border-bottom:1px solid #feea1e}.markdown-body thead{text-align:left}.markdown-body th{font-size:1.2em;border-bottom:1px dashed #eee}.markdown-body tr:nth-child(2n){background-color:hsla(0,0%,87.8%,.1);border-bottom:1px solid #fff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px;border-bottom:1px dashed #fff}.markdown-body blockquote{color:#666;padding:12px 23px 2px;border:1px solid #37b2ff;background-color:#fff;margin:22px 0;position:relative}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body blockquote:after{content:"FROM";left:0;width:40px;color:#fff;background-color:#37b2ff;text-align:center}.markdown-body blockquote:after,.markdown-body blockquote:before{top:0;line-height:1;padding:2px 0;font-size:12px;font-weight:lighter;position:absolute;pointer-events:none}.markdown-body blockquote:before{content:"CITATION";left:44px;color:#37b2ff}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{line-height:2em;margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#37b2ff}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol ol li,.markdown-body ol ul li,.markdown-body ul ol li,.markdown-body ul ul li{border-bottom:none}.markdown-body ol li{padding-left:6px;list-style:decimal-leading-zero}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}.markdown-body input[type=checkbox]{position:relative}.markdown-body input[type=checkbox]:before{top:0;left:0;right:0;bottom:0;content:"";width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1;position:absolute}.markdown-body input[type=checkbox]:checked:after{content:"";top:10%;left:18%;width:90%;height:40%;border-left:2px solid #37b2ff;border-bottom:2px solid #37b2ff;color:#37b2ff;z-index:2;transform:rotate(-45deg);position:absolute}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d93479b72a64e9d8b51d5c5079dc0e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5b-D6YeM5Y2x6Zmp55qE5Lic6KW_:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765802571&amp;x-signature=9W3beU%2BMvFl8eVcPvuOUcuEAjCU%3D" alt="hora.png" loading="lazy"/></p>
<p align="center"/>
作为一个 Flutter 开发者，你是否也曾为日期处理而烦恼？在 jiffy、intl、date_format 之间徘徊，却总觉得少点什么？
<p>实际上，在开发 Hora 时，我最初的灵感来源于 JavaScript 生态中备受好评的 <strong>day.js</strong>。day.js 以其简洁的 API 和强大的插件系统征服了前端开发者。我心想：为什么 Dart 生态不能有一个类似但更优秀的日期库呢？</p>
<p>于是我开始将 day.js 的核心功能，<strong>使用 Dart 的语言特性重新实现</strong>：</p>
<ul>
<li><strong>Sealed Classes</strong> - 替代 JavaScript 的字符串枚举</li>
<li><strong>Extension Methods</strong> - 实现 day.js 的插件机制</li>
<li><strong>Pattern Matching</strong> - 处理复杂的日期逻辑</li>
<li><strong>Null Safety</strong> - 避免 day.js 中的空值问题</li>
<li><strong>Tree-shakable</strong> - 让性能超越 day.js</li>
</ul>
<p>这不仅仅是一次简单的移植，而是对现代日期处理理念在 Dart 生态中的完整实践。</p>
<h2 data-id="heading-0">为什么需要另一个日期库？</h2>
<p>说实话，开发 Hora 的初衷源于我自己的痛点。作为一名曾经的 <strong>jiffy 用户</strong>，在实际项目中使用时遇到了很多让人困扰的问题：</p>
<h3 data-id="heading-1">我的 jiffy 使用经历</h3>
<p>最初选择 jiffy 是因为它模仿了著名的 moment.js API，看起来很熟悉：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// jiffy 的 API 看起来不错</span>
Jiffy().add(days: <span class="hljs-number">7</span>).format(<span class="hljs-string">'yyyy-MM-dd'</span>)
</code></pre>
<p>但真正用起来却发现<strong>差强人意</strong>：</p>
<ol>
<li>
<p><strong>高级功能支持有限</strong>：</p>
<ul>
<li>没有内置的业务日计算（需要自己实现周末和节假日逻辑）</li>
<li>月份边界处理有时不够直观（1月31日加1个月会得到2月28日）</li>
<li>插件系统不如 Hora 完善，扩展性有限</li>
</ul>
</li>
<li>
<p><strong>不可变性保证不足</strong>：虽然大部分操作是新的，但某些边缘情况下可能修改原对象</p>
</li>
<li>
<p><strong>国际化复杂度</strong>：配置相对复杂，需要手动加载语言包，不如 Hora 的 tree-shakable 设计优雅</p>
</li>
</ol>
<h3 data-id="heading-2">从 day.js 到 Hora：理念与实践</h3>
<p>day.js 的成功在于它优雅解决了以下问题：</p>
<ol>
<li><strong>API 简洁</strong> - dayjs().format() 而不是复杂的配置</li>
<li><strong>插件机制</strong> - 可按需扩展，保持核心精简</li>
<li><strong>不可变性</strong> - 每次操作返回新实例</li>
<li><strong>链式调用</strong> - 直观的方法链</li>
</ol>
<p>而 Hora 在此基础上，利用 Dart 的优势更进一步：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// day.js 风格的 API，但更安全</span>
<span class="hljs-keyword">final</span> now = Hora.now();
<span class="hljs-keyword">final</span> result = now
    .add(<span class="hljs-number">1</span>, TemporalUnit.month)
    .startOf(TemporalUnit.day)
    .format(<span class="hljs-string">'YYYY-MM-DD'</span>);

<span class="hljs-comment">// 使用 Dart 的 sealed class 确保类型安全</span>
TemporalUnit unit = TemporalUnit.parse(<span class="hljs-string">'month'</span>); <span class="hljs-comment">// 编译时检查</span>

<span class="hljs-comment">// 通过 Extension 实现插件，比 day.js 更优雅</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/business_day.dart'</span>;
<span class="hljs-keyword">final</span> businessDay = now.addBusinessDays(<span class="hljs-number">5</span>);
</code></pre>
<h3 data-id="heading-3">痛定思痛，决定自己动手</h3>
<p>在分析了现有库的痛点后，我意识到 Dart 生态需要一个功能更全面的日期库：</p>
<ul>
<li><strong>intl</strong>：功能强大，但 API 相对复杂，体积较大，初始化重</li>
<li><strong>date_format</strong>：轻量，但功能单一，仅支持格式化，缺乏操作能力</li>
<li><strong>jiffy</strong>：API 友好但高级功能支持不足，缺少企业级特性</li>
</ul>
<p>我想创造一个<strong>功能完整</strong>的日期库，满足从简单格式化到复杂业务计算的各种需求。这就是 Hora 的诞生故事。</p>
<h2 data-id="heading-4">Hora 的核心优势</h2>
<h3 data-id="heading-5">1. 🎯 丰富的功能特性</h3>
<p>Hora 提供了比其他库更全面的日期时间处理能力：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Hora - 功能强大且易用</span>
<span class="hljs-keyword">final</span> now = Hora.now();
<span class="hljs-keyword">final</span> nextWeek = now.add(<span class="hljs-number">1</span>, TemporalUnit.week);

<span class="hljs-comment">// 支持复杂的业务日计算</span>
<span class="hljs-keyword">final</span> businessDays = now.addBusinessDays(<span class="hljs-number">10</span>);

<span class="hljs-comment">// 财年和季度计算</span>
<span class="hljs-keyword">final</span> fiscalYear = now.fiscalYear(startMonth: <span class="hljs-number">4</span>);
<span class="hljs-keyword">final</span> fiscalQuarter = now.fiscalQuarter(startMonth: <span class="hljs-number">4</span>);

<span class="hljs-comment">// 重复事件模式</span>
<span class="hljs-keyword">final</span> meetings = Recurrence.weekly(
  start: now,
  daysOfWeek: {<span class="hljs-built_in">DateTime</span>.monday, <span class="hljs-built_in">DateTime</span>.friday},
);

<span class="hljs-comment">// jiffy - 基础功能有限</span>
<span class="hljs-keyword">final</span> jiffyNextWeek = Jiffy().add(weeks: <span class="hljs-number">1</span>);

<span class="hljs-comment">// date_format - 只支持格式化，不支持操作</span>
</code></pre>
<h3 data-id="heading-6">2. 🔒 不可变性设计</h3>
<p>Hora 采用不可变设计，所有操作都返回新实例：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> date = Hora.of(year: <span class="hljs-number">2024</span>, month: <span class="hljs-number">12</span>, day: <span class="hljs-number">8</span>);
<span class="hljs-keyword">final</span> modified = date.copyWith(hour: <span class="hljs-number">10</span>);

<span class="hljs-built_in">print</span>(date.hour);      <span class="hljs-comment">// 0 - 原始实例不变</span>
<span class="hljs-built_in">print</span>(modified.hour);  <span class="hljs-comment">// 10 - 新实例</span>
</code></pre>
<p>这避免了在复杂应用中因意外修改导致的状态问题。</p>
<h3 data-id="heading-7">3. 🌍 完善的国际化支持</h3>
<p>Hora 内置 <strong>143 种语言</strong>支持，并且设计为 tree-shakable：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/hora.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/locales/ja.dart'</span>; <span class="hljs-comment">// 按需导入</span>

<span class="hljs-comment">// 默认英文</span>
<span class="hljs-keyword">final</span> us = Hora.now();
<span class="hljs-built_in">print</span>(us.format(<span class="hljs-string">'MMMM D, YYYY'</span>)); <span class="hljs-comment">// December 8, 2024</span>

<span class="hljs-comment">// 切换到中文</span>
<span class="hljs-keyword">final</span> cn = Hora.now(locale: <span class="hljs-keyword">const</span> HoraLocaleZhCn());
<span class="hljs-built_in">print</span>(cn.format(<span class="hljs-string">'YYYY年M月D日'</span>)); <span class="hljs-comment">// 2024年12月8日</span>

<span class="hljs-comment">// 切换到日文</span>
<span class="hljs-keyword">final</span> jp = Hora.now(locale: <span class="hljs-keyword">const</span> HoraLocaleJa());
<span class="hljs-built_in">print</span>(jp.format(<span class="hljs-string">'YYYY年M月D日'</span>)); <span class="hljs-comment">// 2024年12月8日</span>
</code></pre>
<p>相比之下：</p>
<ul>
<li><code>intl</code> 需要额外配置，初始化较重</li>
<li><code>jiffy</code> 支持的语言较少</li>
<li><code>date_format</code> 几乎没有国际化支持</li>
</ul>
<h3 data-id="heading-8">4. 📅 智能的时间单位处理</h3>
<p>Hora 区分<strong>固定时长单位</strong>和<strong>日历相关单位</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 固定时长单位（使用 Duration）</span>
<span class="hljs-keyword">final</span> exactWeek = now.add(<span class="hljs-number">7</span>, TemporalUnit.day); <span class="hljs-comment">// 精确的 7 天</span>

<span class="hljs-comment">// 日历相关单位（考虑月份长度、闰年等）</span>
<span class="hljs-keyword">final</span> nextMonth = now.add(<span class="hljs-number">1</span>, TemporalUnit.month); <span class="hljs-comment">// 智能处理月份变化</span>

<span class="hljs-comment">// HoraDuration 更是支持混合单位</span>
<span class="hljs-keyword">final</span> duration = HoraDuration(
  years: <span class="hljs-number">1</span>,
  months: <span class="hljs-number">6</span>,
  days: <span class="hljs-number">15</span>
);
<span class="hljs-built_in">print</span>(duration.humanize()); <span class="hljs-comment">// "a year and 6 months"</span>
</code></pre>
<h3 data-id="heading-9">5. 🔌 灵活的插件系统</h3>
<p>Hora 采用 Dart Extension 实现插件机制，无需显式注册：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/week_year.dart'</span>;

<span class="hljs-keyword">final</span> h = Hora.now();
<span class="hljs-built_in">print</span>(h.weekYear());       <span class="hljs-comment">// 通过扩展方法调用</span>
<span class="hljs-built_in">print</span>(h.weekOfWeekYear()); <span class="hljs-comment">// 无需额外配置</span>
</code></pre>
<h3 data-id="heading-10">6. ⚡ 轻量且高性能</h3>
<ul>
<li><strong>零外部依赖</strong>：只依赖 Dart 内置的 <code>meta</code> 包</li>
<li><strong>Tree-shakable</strong>：未使用的代码会被编译器优化掉</li>
<li><strong>纯 Dart 实现</strong>：无平台限制，支持 Flutter Web、Server、Desktop</li>
</ul>
<h3 data-id="heading-11">7. 📊 完整的插件生态</h3>
<p>Hora 通过 20+ 个插件覆盖了企业级应用的各种需求：</p>
<ul>
<li>business_day：业务日计算</li>
<li>recurrence：重复事件</li>
<li>calendar：日历生成</li>
<li>relative_time：相对时间</li>
<li>custom_parse_format：自定义解析</li>
<li>timezone：时区处理</li>
<li>fiscal_year：财年计算</li>
<li>week_year：ISO 周年</li>
<li>等等...</li>
</ul>
<h2 data-id="heading-12">功能对比表</h2>


















































































<table><thead><tr><th>特性</th><th>Hora</th><th>intl</th><th>date_format</th><th>jiffy</th></tr></thead><tbody><tr><td>不可变性</td><td>✅ 完全不可变</td><td>⚠️ DateTime 可变</td><td>⚠️ DateTime 可变</td><td>⚠️ 部分可变</td></tr><tr><td>国际化</td><td>✅ 143+ 语言，Tree-shakable</td><td>✅ 完整但较重</td><td>❌ 不支持</td><td>✅ 有限支持</td></tr><tr><td>插件系统</td><td>✅ 20+ 插件，无侵入</td><td>❌ 无</td><td>❌ 无</td><td>⚠️ 基础扩展</td></tr><tr><td>高级功能</td><td>✅ 业务日、重复事件、日历</td><td>❌ 无</td><td>❌ 无</td><td>⚠️ 基础功能</td></tr><tr><td>链式操作</td><td>✅ 流畅 API</td><td>❌ 不支持</td><td>❌ 不支持</td><td>✅ 支持</td></tr><tr><td>时间单位</td><td>✅ 区分固定时长和日历单位</td><td>⚠️ 需手动计算</td><td>❌ 不支持</td><td>⚠️ 概念模糊</td></tr><tr><td>格式解析</td><td>✅ 自定义格式解析</td><td>⚠️ 有限支持</td><td>❌ 不支持</td><td>⚠️ 基础支持</td></tr><tr><td>时区支持</td><td>✅ 内置支持</td><td>❌ 需要额外包</td><td>❌ 不支持</td><td>❌ 无</td></tr><tr><td>财年计算</td><td>✅ 多国财年支持</td><td>❌ 无</td><td>❌ 不支持</td><td>❌ 无</td></tr><tr><td>依赖</td><td>✅ 仅 meta 包</td><td>❌ 较多依赖</td><td>✅ 0</td><td>⚠️ 轻量</td></tr></tbody></table>
<h2 data-id="heading-13">实际应用示例</h2>
<h3 data-id="heading-14">场景1：业务时间计算</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Hora - 内置业务日计算，一行搞定</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/business_day.dart'</span>;

<span class="hljs-keyword">final</span> start = Hora.of(year: <span class="hljs-number">2024</span>, month: <span class="hljs-number">12</span>, day: <span class="hljs-number">20</span>); <span class="hljs-comment">// 周五</span>
<span class="hljs-keyword">final</span> end = start.addBusinessDays(<span class="hljs-number">5</span>); <span class="hljs-comment">// 自动跳过周末和节假日</span>
<span class="hljs-built_in">print</span>(end.format(<span class="hljs-string">'YYYY-MM-DD'</span>)); <span class="hljs-comment">// 2024-12-27</span>

<span class="hljs-comment">// jiffy - 需要手动实现</span>
<span class="hljs-keyword">var</span> current = start;
<span class="hljs-built_in">int</span> businessDays = <span class="hljs-number">0</span>;
<span class="hljs-keyword">while</span> (businessDays &lt; <span class="hljs-number">5</span>) {
  current = current.add(<span class="hljs-number">1</span>, TemporalUnit.day);
  <span class="hljs-keyword">if</span> (current.weekday &lt;= <span class="hljs-number">5</span>) businessDays++; <span class="hljs-comment">// 需要手动判断周末</span>
}

<span class="hljs-comment">// intl - 完全没有业务日功能</span>
</code></pre>
<h3 data-id="heading-15">场景2：智能的时间单位处理</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Hora - 区分固定时长和日历单位</span>
<span class="hljs-keyword">final</span> jan31 = Hora.of(year: <span class="hljs-number">2024</span>, month: <span class="hljs-number">1</span>, day: <span class="hljs-number">31</span>);

<span class="hljs-comment">// 固定时长 - 精确的 7 天</span>
<span class="hljs-keyword">final</span> exact7Days = jan31.add(<span class="hljs-number">7</span>, TemporalUnit.day);
<span class="hljs-built_in">print</span>(exact7Days.format(<span class="hljs-string">'YYYY-MM-DD'</span>)); <span class="hljs-comment">// 2024-02-07</span>

<span class="hljs-comment">// 日历单位 - 智能处理月份</span>
<span class="hljs-keyword">final</span> nextMonth = jan31.add(<span class="hljs-number">1</span>, TemporalUnit.month);
<span class="hljs-built_in">print</span>(nextMonth.format(<span class="hljs-string">'YYYY-MM-DD'</span>)); <span class="hljs-comment">// 2024-02-29 (闰年2月末)</span>

<span class="hljs-comment">// jiffy - 容易混淆，需要自己计算</span>
<span class="hljs-keyword">final</span> jiffy1 = Jiffy.parse(<span class="hljs-string">'2024-01-31'</span>).add(days: <span class="hljs-number">7</span>); <span class="hljs-comment">// 类似固定时长</span>
<span class="hljs-keyword">final</span> jiffy2 = Jiffy.parse(<span class="hljs-string">'2024-01-31'</span>).add(months: <span class="hljs-number">1</span>); <span class="hljs-comment">// 但逻辑不透明</span>
</code></pre>
<h3 data-id="heading-16">场景4：强大的插件系统</h3>
<p>Hora 的插件系统通过 Dart Extension 实现，无需显式注册：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Calendar 插件 - 生成日历</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/calendar.dart'</span>;

<span class="hljs-keyword">final</span> monthCal = Hora.now().monthCalendar();
<span class="hljs-built_in">print</span>(<span class="hljs-string">'该月有 <span class="hljs-subst">${monthCal.weekCount}</span> 周'</span>);

<span class="hljs-comment">// Recurrence 插件 - 复杂的重复事件</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/recurrence.dart'</span>;

<span class="hljs-comment">// 每个周一和周五的会议</span>
<span class="hljs-keyword">final</span> meeting = Recurrence.weekly(
  start: Hora.now(),
  daysOfWeek: {<span class="hljs-built_in">DateTime</span>.monday, <span class="hljs-built_in">DateTime</span>.friday},
);
<span class="hljs-built_in">print</span>(<span class="hljs-string">'接下来5次会议时间:'</span>);
meeting.take(<span class="hljs-number">5</span>).forEach(<span class="hljs-built_in">print</span>);

<span class="hljs-comment">// 自定义重复模式 - 如每3天一次</span>
<span class="hljs-keyword">final</span> custom = Recurrence.custom(
  start: Hora.now(),
  generator: (current) =&gt; current.add(<span class="hljs-number">3</span>, TemporalUnit.day),
);
</code></pre>
<h3 data-id="heading-17">场景5：高级相对时间功能</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Relative Time 插件 - 比基础 fromNow 更强大</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/relative_time.dart'</span>;

<span class="hljs-keyword">final</span> past = Hora.now().subtract(<span class="hljs-number">5</span>, TemporalUnit.day);

<span class="hljs-comment">// 自定义阈值配置</span>
<span class="hljs-keyword">final</span> config = RelativeTimeConfig(
  thresholds: RelativeTimeThresholds.strict,
  withoutSuffix: <span class="hljs-keyword">false</span>,
);

<span class="hljs-comment">// 详细的时间差分解</span>
<span class="hljs-keyword">final</span> diff = past.diffFromNowDetailed();
<span class="hljs-built_in">print</span>(diff.format()); <span class="hljs-comment">// "5 days, 0 hours, 0 minutes, 0 seconds ago"</span>
<span class="hljs-built_in">print</span>(diff.formatCompact()); <span class="hljs-comment">// "5d"</span>

<span class="hljs-comment">// 短格式，适合 UI 显示</span>
<span class="hljs-built_in">print</span>(past.relativeFromNowShort()); <span class="hljs-comment">// "-5d"</span>
</code></pre>
<h3 data-id="heading-18">场景6：自定义格式解析</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Custom Parse Format 插件</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/custom_parse_format.dart'</span>;

<span class="hljs-comment">// 解析各种格式的日期</span>
<span class="hljs-keyword">final</span> date1 = HoraParser.parse(<span class="hljs-string">'25/12/2024'</span>, <span class="hljs-string">'DD/MM/YYYY'</span>);
<span class="hljs-keyword">final</span> date2 = HoraParser.parseMultiple(
  <span class="hljs-string">'2024-12-25'</span>,
  [<span class="hljs-string">'YYYY-MM-DD'</span>, <span class="hljs-string">'DD/MM/YYYY'</span>, <span class="hljs-string">'MM-DD-YYYY'</span>],
);

<span class="hljs-comment">// 支持复杂格式</span>
<span class="hljs-keyword">final</span> complex = HoraParser.parse(
  <span class="hljs-string">'Thursday, December 25, 2024 2:30 PM'</span>,
  <span class="hljs-string">'dddd, MMMM D, YYYY h:mm A'</span>,
);

<span class="hljs-comment">// 其他库需要自己实现这些复杂的解析逻辑</span>
</code></pre>
<h3 data-id="heading-19">场景7：流畅的链式 API</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// Hora - 真正的流畅操作</span>
<span class="hljs-keyword">final</span> result = Hora.now()
    .startOf(TemporalUnit.month)      <span class="hljs-comment">// 月初</span>
    .addBusinessDays(<span class="hljs-number">10</span>)              <span class="hljs-comment">// 加10个工作日</span>
    .withLocale(<span class="hljs-keyword">const</span> HoraLocaleJa()) <span class="hljs-comment">// 切换到日语</span>
    .format(<span class="hljs-string">'YYYY年M月D日'</span>);          <span class="hljs-comment">// 格式化</span>

<span class="hljs-comment">// jiffy - 链式支持但功能有限</span>
<span class="hljs-keyword">final</span> jiffyResult = Jiffy()
    .startOf(<span class="hljs-string">'month'</span>)
    .add(days: <span class="hljs-number">10</span>)  <span class="hljs-comment">// 不能区分工作日</span>
    .format(<span class="hljs-string">'yyyy-MM-dd'</span>);  <span class="hljs-comment">// 格式化选项有限</span>
</code></pre>
<h3 data-id="heading-20">真实项目案例：项目管理应用</h3>
<p>在开发一个项目管理工具时，我遇到了这样的需求：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 需求：计算任务截止日期，排除周末和节假日</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/business_day.dart'</span>;

<span class="hljs-comment">// 设置节假日</span>
<span class="hljs-keyword">final</span> usHolidays = HolidayCalendar.usCommon.merge(
  HolidayCalendar(fixedHolidays: [
    <span class="hljs-built_in">DateTime</span>(<span class="hljs-number">2024</span>, <span class="hljs-number">12</span>, <span class="hljs-number">24</span>), <span class="hljs-comment">// 公司额外假期</span>
  ]),
);

<span class="hljs-comment">// 任务分配</span>
<span class="hljs-keyword">final</span> taskStart = Hora.of(year: <span class="hljs-number">2024</span>, month: <span class="hljs-number">12</span>, day: <span class="hljs-number">20</span>);
<span class="hljs-keyword">final</span> deadline = taskStart.addBusinessDays(
  <span class="hljs-number">10</span>,
  BusinessDayConfig(holidays: usHolidays),
);

<span class="hljs-comment">// 生成里程碑报告</span>
<span class="hljs-keyword">final</span> milestones = Recurrence.weekly(
  start: taskStart,
  daysOfWeek: {<span class="hljs-built_in">DateTime</span>.friday},
  count: <span class="hljs-number">5</span>,
).map((date) =&gt; {
  <span class="hljs-string">'week'</span>: date.isoWeek,
  <span class="hljs-string">'date'</span>: date.format(<span class="hljs-string">'YYYY-MM-DD'</span>),
  <span class="hljs-string">'deliverables'</span>: <span class="hljs-built_in">List</span>.generate(<span class="hljs-number">5</span>, (i) =&gt;
    date.addBusinessDays(i)
  ),
});

<span class="hljs-comment">// 这在 jiffy 中需要数百行代码来实现！</span>
</code></pre>
<h3 data-id="heading-21">生产环境用例1：全球电商系统</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 处理不同时区的订单截止时间</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/timezone.dart'</span>;

<span class="hljs-comment">// 订单在纽约下午6点截止</span>
<span class="hljs-keyword">final</span> nycTz = HoraTimezone.common[<span class="hljs-string">'EST'</span>]!;
<span class="hljs-keyword">final</span> orderDeadline = Hora.now()
    .withTimezone(nycTz)
    .copyWith(hour: <span class="hljs-number">18</span>, minute: <span class="hljs-number">0</span>, second: <span class="hljs-number">0</span>);

<span class="hljs-comment">// 转换为各地时区显示</span>
<span class="hljs-keyword">final</span> tokyoTime = orderDeadline.inTimezone(HoraTimezone.common[<span class="hljs-string">'JST'</span>]!);
<span class="hljs-keyword">final</span> londonTime = orderDeadline.inTimezone(HoraTimezone.common[<span class="hljs-string">'GMT'</span>]!);
<span class="hljs-keyword">final</span> sydneyTime = orderDeadline.inTimezone(HoraTimezone.common[<span class="hljs-string">'AEST'</span>]!);

<span class="hljs-comment">// 批量处理不同时区的促销活动</span>
<span class="hljs-keyword">final</span> promotions = [
  {<span class="hljs-string">'city'</span>: <span class="hljs-string">'New York'</span>, <span class="hljs-string">'tz'</span>: HoraTimezone.common[<span class="hljs-string">'EST'</span>]!},
  {<span class="hljs-string">'city'</span>: <span class="hljs-string">'London'</span>, <span class="hljs-string">'tz'</span>: HoraTimezone.common[<span class="hljs-string">'GMT'</span>]!},
  {<span class="hljs-string">'city'</span>: <span class="hljs-string">'Tokyo'</span>, <span class="hljs-string">'tz'</span>: HoraTimezone.common[<span class="hljs-string">'JST'</span>]!},
  {<span class="hljs-string">'city'</span>: <span class="hljs-string">'Sydney'</span>, <span class="hljs-string">'tz'</span>: HoraTimezone.common[<span class="hljs-string">'AEST'</span>]!},
].map((loc) {
  <span class="hljs-keyword">final</span> midnight = Hora.nowIn(loc[<span class="hljs-string">'tz'</span>])
      .endOf(TemporalUnit.day)
      .add(<span class="hljs-number">1</span>, TemporalUnit.second);
  <span class="hljs-keyword">return</span> {
    <span class="hljs-string">'city'</span>: loc[<span class="hljs-string">'city'</span>],
    <span class="hljs-string">'promoEnd'</span>: midnight.format(<span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span>),
    <span class="hljs-string">'localTime'</span>: midnight.wallClockIn(loc[<span class="hljs-string">'tz'</span>] <span class="hljs-keyword">as</span> HoraTimezone),
  };
});

<span class="hljs-comment">// jiffy 根本没有内置的时区支持！</span>
</code></pre>
<h3 data-id="heading-22">生产环境用例2：企业财务系统</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 财务报表和季度结算</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/fiscal_year.dart'</span>;

<span class="hljs-comment">// 不同国家的财年设置</span>
<span class="hljs-keyword">final</span> usGovConfig = FiscalYearConfig.usGovernment;  <span class="hljs-comment">// 10月1日开始</span>
<span class="hljs-keyword">final</span> ukConfig = FiscalYearConfig.ukTax;           <span class="hljs-comment">// 4月6日开始</span>
<span class="hljs-keyword">final</span> jpConfig = FiscalYearConfig.japan;           <span class="hljs-comment">// 4月1日开始</span>

<span class="hljs-comment">// 生成财年报表</span>
<span class="hljs-keyword">final</span> now = Hora.now();
<span class="hljs-keyword">final</span> reports = {
  <span class="hljs-string">'US Gov'</span>: {
    <span class="hljs-string">'fiscalYear'</span>: now.fiscalYearWithConfig(usGovConfig),
    <span class="hljs-string">'fiscalQuarter'</span>: now.fiscalQuarterWithConfig(usGovConfig),
    <span class="hljs-string">'period'</span>: now.fiscalPeriod(config: usGovConfig),
    <span class="hljs-string">'progress'</span>: <span class="hljs-string">'<span class="hljs-subst">${(now.fiscalYearProgress(config: usGovConfig) * <span class="hljs-number">100</span>).toInt()}</span>%'</span>,
    <span class="hljs-string">'daysRemaining'</span>: now.daysRemainingInFiscalYear(config: usGovConfig),
  },
  <span class="hljs-string">'UK'</span>: {
    <span class="hljs-string">'fiscalYear'</span>: now.fiscalYearWithConfig(ukConfig),
    <span class="hljs-string">'fiscalQuarter'</span>: now.fiscalQuarterWithConfig(ukConfig),
    <span class="hljs-string">'period'</span>: now.fiscalPeriod(config: ukConfig),
    <span class="hljs-string">'progress'</span>: <span class="hljs-string">'<span class="hljs-subst">${(now.fiscalYearProgress(config: ukConfig) * <span class="hljs-number">100</span>).toInt()}</span>%'</span>,
  },
  <span class="hljs-string">'Japan'</span>: {
    <span class="hljs-string">'fiscalYear'</span>: now.fiscalYearWithConfig(jpConfig),
    <span class="hljs-string">'fiscalQuarter'</span>: now.fiscalQuarterWithConfig(jpConfig),
    <span class="hljs-string">'period'</span>: now.fiscalPeriod(config: jpConfig),
  },
};

<span class="hljs-comment">// 生成财年日历</span>
<span class="hljs-keyword">final</span> fyCalendar = now
    .startOfFiscalYearWithConfig(usGovConfig)
    .yearCalendar();

<span class="hljs-comment">// jiffy：抱歉，不支持财年计算</span>
</code></pre>
<h3 data-id="heading-23">生产环境用例3：SaaS 订阅管理</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 处理订阅周期和计费</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/src/plugins/recurrence.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SubscriptionPlan</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> id;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> name;
  <span class="hljs-keyword">final</span> Recurrence billingCycle;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; features;

  <span class="hljs-keyword">const</span> SubscriptionPlan({
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.id,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.name,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.billingCycle,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.features,
  });
}

<span class="hljs-comment">// 定义订阅计划</span>
<span class="hljs-keyword">final</span> plans = [
  SubscriptionPlan(
    id: <span class="hljs-string">'basic'</span>,
    name: <span class="hljs-string">'Basic Plan'</span>,
    billingCycle: Recurrence.monthly(
      start: Hora.now(),
      interval: <span class="hljs-number">1</span>,
    ),
    features: {<span class="hljs-string">'seats'</span>: <span class="hljs-number">5</span>, <span class="hljs-string">'storage'</span>: <span class="hljs-string">'100GB'</span>},
  ),
  SubscriptionPlan(
    id: <span class="hljs-string">'pro'</span>,
    name: <span class="hljs-string">'Pro Plan'</span>,
    billingCycle: Recurrence.monthly(
      start: Hora.now(),
      interval: <span class="hljs-number">1</span>,
    ),
    features: {<span class="hljs-string">'seats'</span>: <span class="hljs-number">20</span>, <span class="hljs-string">'storage'</span>: <span class="hljs-string">'1TB'</span>},
  ),
  SubscriptionPlan(
    id: <span class="hljs-string">'enterprise'</span>,
    name: <span class="hljs-string">'Enterprise'</span>,
    billingCycle: Recurrence.yearly(
      start: Hora.now(),
      interval: <span class="hljs-number">1</span>,
    ),
    features: {<span class="hljs-string">'seats'</span>: <span class="hljs-number">-1</span>, <span class="hljs-string">'storage'</span>: <span class="hljs-string">'unlimited'</span>},
  ),
];

<span class="hljs-comment">// 生成未来12个账期</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BillingService</span> </span>{
  <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt;&gt; generateBillingSchedule(SubscriptionPlan plan) {
    <span class="hljs-keyword">return</span> plan.billingCycle
        .take(<span class="hljs-number">12</span>)
        .map((billingDate) =&gt; {
              <span class="hljs-string">'date'</span>: billingDate.format(<span class="hljs-string">'YYYY-MM-DD'</span>),
              <span class="hljs-string">'period_start'</span>: billingDate.format(<span class="hljs-string">'YYYY-MM-DD'</span>),
              <span class="hljs-string">'period_end'</span>: billingDate
                  .add(<span class="hljs-number">1</span>, TemporalUnit.month)
                  .subtract(<span class="hljs-number">1</span>, TemporalUnit.day)
                  .format(<span class="hljs-string">'YYYY-MM-DD'</span>),
              <span class="hljs-string">'days_in_period'</span>: billingDate.daysInMonth,
              <span class="hljs-string">'is_business_day'</span>: billingDate.isBusinessDay(),
            })
        .toList();
  }
}

<span class="hljs-comment">// 处理试用期和付费转换</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TrialService</span> </span>{
  Hora calculateTrialEnd(Hora signupDate, <span class="hljs-built_in">Duration</span> trialDuration) {
    <span class="hljs-keyword">return</span> signupDate.add(
        <span class="hljs-built_in">Duration</span>.inMilliseconds(trialDuration.inMilliseconds),
        TemporalUnit.day);
  }

  Hora calculateFirstBillingDate(Hora trialEnd) {
    <span class="hljs-comment">// 确保第一个账期不是周末</span>
    <span class="hljs-keyword">return</span> trialEnd.addBusinessDays(<span class="hljs-number">1</span>);
  }
}

<span class="hljs-comment">// jiffy：需要手动处理所有重复逻辑和边界情况</span>
</code></pre>
<h2 data-id="heading-24">为什么选择 Hora？</h2>
<ol>
<li><strong>功能完整</strong>：覆盖企业级应用的各种日期时间需求</li>
<li><strong>插件生态</strong>：20+ 插件，业务日、财年、时区、重复事件等</li>
<li><strong>开发友好</strong>：清晰的 API 设计，丰富的示例代码</li>
<li><strong>轻量高效</strong>：零外部依赖，tree-shakable，纯 Dart 实现</li>
</ol>
<h2 data-id="heading-25">快速开始</h2>
<pre><code class="hljs language-bash" lang="bash">dart pub add hora
</code></pre>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:hora/hora.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  <span class="hljs-comment">// 创建时间实例</span>
  <span class="hljs-keyword">final</span> now = Hora.now();

  <span class="hljs-comment">// 时间操作</span>
  <span class="hljs-keyword">final</span> nextMonth = now.add(<span class="hljs-number">1</span>, TemporalUnit.month);

  <span class="hljs-comment">// 格式化输出</span>
  <span class="hljs-built_in">print</span>(now.format(<span class="hljs-string">'YYYY-MM-DD HH:mm:ss'</span>));

  <span class="hljs-comment">// 相对时间</span>
  <span class="hljs-keyword">final</span> birthday = Hora.of(year: <span class="hljs-number">1990</span>, month: <span class="hljs-number">6</span>, day: <span class="hljs-number">15</span>);
  <span class="hljs-built_in">print</span>(birthday.fromNow()); <span class="hljs-comment">// "34 years ago"</span>
}
</code></pre>
<h2 data-id="heading-26">迁移指南</h2>
<p>从其他库迁移到 Hora 非常简单：</p>
<h3 data-id="heading-27">从 jiffy 迁移</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// jiffy</span>
Jiffy().add(days: <span class="hljs-number">7</span>).format(<span class="hljs-string">'yyyy-MM-dd'</span>)

<span class="hljs-comment">// Hora</span>
Hora.now().add(<span class="hljs-number">7</span>, TemporalUnit.day).format(<span class="hljs-string">'YYYY-MM-DD'</span>)
</code></pre>
<h3 data-id="heading-28">从 intl 迁移</h3>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// intl</span>
DateFormat(<span class="hljs-string">'yyyy-MM-dd'</span>).format(<span class="hljs-built_in">DateTime</span>.now())

<span class="hljs-comment">// Hora</span>
Hora.now().format(<span class="hljs-string">'YYYY-MM-DD'</span>)
</code></pre>
<h2 data-id="heading-29">Hora vs jiffy：功能对比总览</h2>
<p>为了让你更清楚地了解 Hora 的独特优势，这里是一个详细的对比：</p>
<h3 data-id="heading-30">🔥 jiffy 根本没有的功能：</h3>



























































<table><thead><tr><th>功能类别</th><th>Hora</th><th>jiffy</th><th>生产价值</th></tr></thead><tbody><tr><td><strong>业务日计算</strong></td><td>✅ 完整支持</td><td>❌ 无</td><td>金融、企业应用必备</td></tr><tr><td><strong>时区转换</strong></td><td>✅ 内置支持</td><td>❌ 需要额外包</td><td>全球化应用必备</td></tr><tr><td><strong>财年管理</strong></td><td>✅ 多国财年</td><td>❌ 无</td><td>财务系统必备</td></tr><tr><td><strong>重复事件</strong></td><td>✅ 复杂模式</td><td>❌ 基础模式</td><td>订阅系统必备</td></tr><tr><td><strong>自定义解析</strong></td><td>✅ 灵活配置</td><td>❌ 有限支持</td><td>数据导入必备</td></tr><tr><td><strong>日历生成</strong></td><td>✅ 月历/年历</td><td>❌ 无</td><td>调度系统必备</td></tr><tr><td><strong>详细时间差</strong></td><td>✅ 多种格式</td><td>❌ 基础格式</td><td>分析报表必备</td></tr><tr><td><strong>节假日管理</strong></td><td>✅ 多国日历</td><td>❌ 无</td><td>本地化应用必备</td></tr></tbody></table>
<h3 data-id="heading-31">💡 为什么这些功能很重要？</h3>
<p>在实际的企业级应用中，你迟早会遇到这些需求：</p>
<ol>
<li><strong>业务日计算</strong> - 订单处理、物流配送的时效承诺</li>
<li><strong>时区处理</strong> - 全球用户的同步操作</li>
<li><strong>财年管理</strong> - 财务报表、预算规划</li>
<li><strong>重复事件</strong> - 订续计费、定期提醒</li>
<li><strong>自定义解析</strong> - 处理各种来源的数据</li>
</ol>
<p><strong>jiffy 只能帮你做基础的日期操作，而 Hora 让你能够构建完整的企业级应用。</strong></p>
<h2 data-id="heading-32">写在最后</h2>
<p>从 jiffy 用户到 Hora 作者，这段开发经历让我学到了很多。我开始只是想解决自己在项目中的痛点，没想到最终创造了一个功能完整的日期库。</p>
<p>Hora 的核心设计理念其实很简单：</p>
<ol>
<li><strong>实用至上</strong> - 解决真实的业务问题，而不是为了功能而功能</li>
<li><strong>渐进增强</strong> - 从简单的格式化开始，按需引入高级功能</li>
<li><strong>保持简单</strong> - 复杂的内部实现，简单的外部接口</li>
<li><strong>性能优先</strong> - 树枝摇动、零依赖，不影响应用性能</li>
</ol>
<p>如果你也遇到了和我类似的困扰，希望 Hora 能帮你节省时间，让你专注于业务逻辑而不是日期处理的细节。</p>
<p>这个项目还在持续改进中，欢迎任何反馈和建议。</p>
<hr/>
<h3 data-id="heading-33">🎯 适用场景</h3>
<ul>
<li>✅ <strong>企业级应用</strong>：需要复杂的业务日期计算</li>
<li>✅ <strong>跨平台项目</strong>：Flutter Web、Mobile、Desktop 统一 API</li>
<li>✅ <strong>国际化产品</strong>：143+ 语言开箱即用</li>
<li>✅ <strong>性能敏感应用</strong>：轻量级实现，tree-shakable</li>
</ul>
<h3 data-id="heading-34">🚀 立即开始</h3>
<pre><code class="hljs language-bash" lang="bash">dart pub add hora
</code></pre>
<p><strong>GitHub</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffluttercandies%2Fhora" target="_blank" title="https://github.com/fluttercandies/hora" ref="nofollow noopener noreferrer">github.com/fluttercand…</a><br/>
<strong>Pub.dev</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fhora" target="_blank" title="https://pub.dev/packages/hora" ref="nofollow noopener noreferrer">pub.dev/packages/ho…</a><br/>
<strong>文档</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fdocumentation%2Fhora%2Flatest%2F" target="_blank" title="https://pub.dev/documentation/hora/latest/" ref="nofollow noopener noreferrer">完整 API 文档</a></p>
<p>如果 Hora 对你的项目有帮助，欢迎给项目点个 ⭐️ Star，你的支持是我持续开发的动力！同时也别忘了在 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fhora" target="_blank" title="https://pub.dev/packages/hora" ref="nofollow noopener noreferrer">Pub.dev</a> 上点个 👍 Like，让更多开发者发现这个库！</p>
<p>让我们一起，用 Hora 让日期时间处理变得简单而优雅。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个空函数，如何成就 JS 继承的“完美方案”？]]></title>    <link>https://juejin.cn/post/7581306080435486771</link>    <guid>https://juejin.cn/post/7581306080435486771</guid>    <pubDate>2025-12-08T14:50:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080435486771" data-draft-id="7581406561685422126" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个空函数，如何成就 JS 继承的“完美方案”？"/> <meta itemprop="keywords" content="JavaScript,面试,ECMAScript 6"/> <meta itemprop="datePublished" content="2025-12-08T14:50:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xhxxx"/> <meta itemprop="url" content="https://juejin.cn/user/3235201610941578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个空函数，如何成就 JS 继承的“完美方案”？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3235201610941578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xhxxx
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:50:35.000Z" title="Mon Dec 08 2025 14:50:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    16
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 继承的终极方案：寄生组合式继承详解</h2>
<p>在 JavaScript 的世界里，继承一直是开发者绕不开的话题。由于其基于原型（prototype）的独特机制，实现高效、安全、可维护的继承并非易事。从早期的原型链继承、构造函数继承，到组合继承，再到如今被广泛推崇的 <strong>寄生组合式继承（Parasitic Combination Inheritance）</strong> ，我们终于找到了一个近乎完美的解决方案。</p>
<p>本文将结合实践与原理，带你深入理解为什么寄生组合式继承被称为“JavaScript 继承的终极方案”。</p>
<hr/>
<h3 data-id="heading-1">一、继承的痛点：为什么需要“终极方案”？</h3>
<p>在 ES6 <code>class</code> 语法出现之前，JavaScript 的继承主要依赖函数和原型。但每种方式都有明显缺陷：</p>
<h4 data-id="heading-2">1. 原型链继承</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'eating'</span>); };

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); <span class="hljs-comment">// ❌ 问题：调用了 Animal 构造函数！</span>
</code></pre>
<ul>
<li><strong>缺点</strong>：必须执行父类构造函数，可能带来副作用（如初始化 DOM、发送请求），且无法传参。</li>
</ul>
<h4 data-id="heading-3">2. 构造函数继承</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name); <span class="hljs-comment">// ✅ 实例属性继承</span>
}
</code></pre>
<ul>
<li><strong>缺点</strong>：无法继承原型上的方法，方法无法复用，内存浪费。</li>
</ul>
<h4 data-id="heading-4">3. 组合继承（常用但有冗余）</h4>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name); <span class="hljs-comment">// 第一次调用 Animal</span>
}
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(); <span class="hljs-comment">// 第二次调用 Animal ❌</span>
</code></pre>
<ul>
<li><strong>缺点</strong>：父类构造函数被调用了 <strong>两次</strong>，效率低下。</li>
</ul>
<hr/>
<h3 data-id="heading-5">二、寄生组合式继承：优雅的解决方案</h3>
<blockquote>
<p><strong>核心思想</strong>：</p>
<ul>
<li>用 <code>Parent.call/apply(this)</code> 继承<strong>实例属性</strong>（支持传参、无副作用）</li>
<li>用一个<strong>空的中介函数</strong>继承<strong>原型方法</strong>（不调用父类构造函数）</li>
</ul>
</blockquote>
<h4 data-id="heading-6">完整实现</h4>
<pre><code class="hljs language-js" lang="js"> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span> (name,age){
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
        };
        <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">'动物'</span>;
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span> (name,age,color){
            <span class="hljs-comment">//{} 空对象 &lt;- this</span>
            <span class="hljs-comment">// </span>
            <span class="hljs-comment">// 构造函数式继承</span>
            <span class="hljs-comment">// 手动指定</span>
            <span class="hljs-comment">//Animal.call(this,name,age);</span>
            <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>,[name,age]);<span class="hljs-comment">// 数组传递</span>
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>);
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
            
        }
        <span class="hljs-comment">// </span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">extend</span> (<span class="hljs-title class_">Child</span>,<span class="hljs-title class_">Parent</span>){
            <span class="hljs-keyword">var</span> F = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){};<span class="hljs-comment">//函数表达式 有开销但不大</span>
             F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
             <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>();<span class="hljs-comment">// 实例的修改，不会影响到原型对象</span>
             <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;
        }
        <span class="hljs-title function_">extend</span>(<span class="hljs-title class_">Cat</span>,<span class="hljs-title class_">Animal</span>);
        <span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">eat</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'吃'</span>);
        }
        <span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-string">'小白'</span>,<span class="hljs-number">2</span>,<span class="hljs-string">'黑色'</span>);
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">species</span>);
</code></pre>
<p><em><strong>关键点解析：</strong></em></p>
<ol>
<li>
<p><strong>为什么使用空函数 <code>F</code>？</strong><br/>
空函数 <code>F</code> 的唯一作用是作为一个“中介桥梁”。它本身不执行任何逻辑（无副作用），但通过 <code>new F()</code> 创建的对象会自动将其内部原型（<code>[[Prototype]]</code>）指向 <code>F.prototype</code>。当我们把 <code>F.prototype</code> 设置为 <code>Parent.prototype</code> 时，这个新对象就成为了一个<strong>自身为空、但能访问父类所有原型方法的代理对象</strong>。</p>
</li>
<li>
<p><strong><code>Child.prototype = new F()</code> 的本质是什么？</strong><br/>
这行代码创建了一个“干净”的原型对象：</p>
<ul>
<li>它<strong>不是</strong> <code>Parent</code> 的实例（不会调用 <code>Parent</code> 构造函数）</li>
<li>它<strong>自身没有属性</strong>（避免污染子类原型）</li>
<li>它的 <code>__proto__</code> 指向 <code>Parent.prototype</code>，因此能通过原型链访问所有父类方法</li>
<li>这相当于现代写法：<code>Object.create(Parent.prototype)</code></li>
</ul>
</li>
<li>
<p><strong>实例属性 vs 原型方法的分离继承</strong></p>
<ul>
<li><strong>实例属性</strong>（如 <code>name</code>, <code>age</code>, <code>color</code>）通过 <code>Animal.apply(this, [name, age])</code> 在子类构造函数中初始化，每个实例独立，支持传参。</li>
<li><strong>原型方法/共享属性</strong>（如 <code>species</code>, <code>eat</code>）通过原型链继承，所有实例共享，节省内存。</li>
<li>两者解耦，各司其职，互不干扰。</li>
</ul>
</li>
<li>
<p><strong>为什么说“实例的修改不会影响到原型对象”？</strong><br/>
因为 <code>Cat.prototype</code> 是一个<strong>独立的新对象</strong>（由 <code>new F()</code> 创建），它只是<strong>链接到</strong> <code>Animal.prototype</code>，而非与之相等。<br/>
所以：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">meow</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">meow</span>); <span class="hljs-comment">// undefined ✅ 安全隔离</span>
</code></pre>
<p>而如果直接写 <code>Cat.prototype = Animal.prototype</code>，就会造成原型污染。</p>
</li>
<li>
<p><strong>性能与安全性双赢</strong></p>
<ul>
<li>父类构造函数<strong>仅在子类实例化时调用一次</strong>（通过 <code>apply/call</code>）</li>
<li>原型方法<strong>零复制、零冗余</strong>，完全复用</li>
<li>无副作用、无内存浪费、类型系统完整</li>
</ul>
</li>
</ol>
<blockquote>
<p>虽然<code>Child.prototype.constructor = Child;</code>这行代码依然会将f的constructor修改为Child，但是我们并不关心它，因为我们创建它的初衷就是利用它将Child连接到Animal的原型链上，至于f最后怎么样我们并不关心</p>
</blockquote>
<hr/>
<h3 data-id="heading-7">三、为什么它是“终极方案”？</h3>



































<table><thead><tr><th>特性</th><th>寄生组合式继承</th><th>其他方式</th></tr></thead><tbody><tr><td>✅ 不重复调用父构造函数</td><td>✔️ 只在 <code>call</code> 时调用一次</td><td>组合继承调用两次</td></tr><tr><td>✅ 支持传参</td><td>✔️</td><td>原型链继承不支持</td></tr><tr><td>✅ 方法复用</td><td>✔️ 所有实例共享原型方法</td><td>构造函数继承无法复用</td></tr><tr><td>✅ 原型链完整</td><td>✔️ <code>instanceof</code> 正确</td><td>多数方式可做到</td></tr><tr><td>✅ 无副作用</td><td>✔️ 不执行 <code>new Parent()</code></td><td>原型链/组合继承会执行</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>关键优势</strong>：通过空函数 <code>F</code> 作为中介，<strong>只继承原型，不执行父类构造逻辑</strong>，既安全又高效。</p>
</blockquote>
<hr/>
<h3 data-id="heading-8">四、原理图解</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> (<span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>())
    │
    └─ [[<span class="hljs-title class_">Prototype</span>]] → F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
                            │
                            ├
                            └─ <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Animal</span>

<span class="hljs-comment">// 修复后：</span>
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Cat</span>
</code></pre>
<ul>
<li><code>Cat.prototype</code> 是一个<strong>空壳对象</strong>，自身无属性</li>
<li>但它通过原型链<strong>无缝访问</strong> <code>Animal.prototype</code> 的所有方法</li>
<li>每个 <code>new Cat()</code> 实例通过 <code>Animal.apply(this)</code> 初始化自己的属性，互不干扰</li>
</ul>
<hr/>
<h3 data-id="heading-9">五、现代替代：ES6 <code>class</code> 也是这么干的！</h3>
<p>虽然我们现在常用：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name; }
  <span class="hljs-title function_">sayName</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`I am <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>); }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, color</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = color;
  }
  <span class="hljs-title function_">meow</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Meow!'</span>); }
}
</code></pre>
<p>但你知道吗？<strong><code>extends</code> 在底层正是采用了寄生组合式继承的思想</strong>！<br/>
Babel 编译后的代码几乎就是我们上面手写的 <code>extend</code> 模式。</p>
<p>所以，理解寄生组合继承，就是理解现代 JavaScript 继承的本质。</p>
<hr/>
<h3 data-id="heading-10">六、总结</h3>
<ul>
<li><strong>寄生组合式继承 = 构造函数继承（实例属性） + 寄生式原型继承（原型方法）</strong></li>
<li>它解决了所有传统继承方式的痛点，是 <strong>ES5 时代最推荐的继承模式</strong></li>
<li>即使在 ES6+ 时代，理解它依然至关重要——因为 <code>class</code> 只是语法糖，底层逻辑不变</li>
<li>如果你在阅读老项目或面试中遇到继承问题，这套方案就是你的“终极武器”</li>
</ul>
<blockquote>
<p>🌟 <strong>记住这个模板</strong>：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">extend</span>(<span class="hljs-params">Child, Parent</span>) {
  <span class="hljs-keyword">const</span> F = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
  F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>();
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>;
}
</code></pre>
</blockquote>
<p>掌握它，你就掌握了 JavaScript 继承的精髓。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3 源码学习笔记（一）：环境搭建与初识Monorepo]]></title>    <link>https://juejin.cn/post/7581324171398512686</link>    <guid>https://juejin.cn/post/7581324171398512686</guid>    <pubDate>2025-12-08T14:36:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324171398512686" data-draft-id="7580280096059588635" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vue3 源码学习笔记（一）：环境搭建与初识Monorepo"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-08T14:36:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="像素水藻码"/> <meta itemprop="url" content="https://juejin.cn/user/121402470704827"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vue3 源码学习笔记（一）：环境搭建与初识Monorepo
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/121402470704827/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    像素水藻码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:36:12.000Z" title="Mon Dec 08 2025 14:36:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言 为啥想学习源码？</h2>
<p>在这个AI触手可及的时代，解决问题变得前所未有的简单——提问、复制、粘贴、完成。作为CRUD开发者，我们熟练地搬运代码，却很少追问它们为何这样工作。久而久之，技术变成了黑盒，好奇心也在重复业务中逐渐褪去。</p>
<p>一次偶然的机会，接触到<strong>远方 os</strong>的源码课程，开始学习Vue3的源码实现。希望把这段时间的疑问和收获整理成笔记，作为自己这段学习旅程的一份纪念。</p>
<h3 data-id="heading-1">环境搭建</h3>
<p>Vue3 源码本身就是采用 Monorepo 架构管理，所有核心模块（如 reactivity、runtime-core、compiler-core 等）都放在 <code>packages</code> 目录下。</p>
<h4 data-id="heading-2">核心配置</h4>
<ul>
<li><strong>Monorepo</strong>：单仓库管理多个子包，能更方便地管理模块间的依赖、统一版本</li>
<li><strong>pnpm workspace</strong>：pnpm 内置的 Monorepo 工具，特点是<strong>子包本地软链、命令轻量高效</strong>。</li>
</ul>
<h4 data-id="heading-3">初始化项目</h4>
<ol>
<li>本地创建一个Vue3文件夹,执行<code>pnpm init</code></li>
<li>新建<code>pnpm workspace.yaml</code></li>
</ol>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">packages:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-string">"packages/*"</span> 
</code></pre>
<ol start="3">
<li>创建<code>packages</code>目录统一管理子项</li>
<li>执行<code>pnpm install typescript -D -w</code>, 安装到根目录</li>
<li>初始化<code>ts配置</code>,执行<code>npx tsc --init </code></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// 配置</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-comment">// 编译目标：使用最新的 ECMAScript 版本</span>
    <span class="hljs-comment">// 生成的 JavaScript 代码会包含最新的 ES 特性</span>
    <span class="hljs-attr">"target"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// 模块系统：使用 ES 模块格式（import/export）</span>
    <span class="hljs-comment">// 适用于现代浏览器和打包工具</span>
    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// 模块解析策略：使用 Node.js 风格的模块解析</span>
    <span class="hljs-comment">// 会在 node_modules 中查找依赖</span>
    <span class="hljs-attr">"moduleResolution"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// 输出目录：编译后的 JavaScript 文件将放在 dist 文件夹中</span>
    <span class="hljs-attr">"outDir"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist"</span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// 允许导入 JSON 文件作为模块</span>
    <span class="hljs-attr">"resolveJsonModule"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// 严格模式：设置为 false，关闭所有严格类型检查</span>
    <span class="hljs-comment">// 提供更宽松的类型检查，适合快速开发</span>
    <span class="hljs-attr">"strict"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>

    <span class="hljs-comment">// 包含的库文件：ESNext（最新 ES 特性）和 DOM（浏览器 API）</span>
    <span class="hljs-attr">"lib"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"ESNext"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"DOM"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="6">
<li>根目录下新建一个 <code>scripts/dev.js</code></li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 打包开发环境
 *
 * node script/dev.js --format or cjs
 */</span>
<span class="hljs-keyword">import</span> { parseArgs } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:util'</span>
<span class="hljs-keyword">import</span> { resolve, dirname } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:path'</span>
<span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:url'</span>
<span class="hljs-keyword">import</span>  esbuild <span class="hljs-keyword">from</span> <span class="hljs-string">'esbuild'</span>
<span class="hljs-keyword">import</span> { createRequire } <span class="hljs-keyword">from</span> <span class="hljs-string">'node:module'</span>

<span class="hljs-comment">/**
 * 解析命令行参数
 */</span>
<span class="hljs-keyword">const</span> { <span class="hljs-attr">values</span>: { format }, positionals } = <span class="hljs-title function_">parseArgs</span>({
    <span class="hljs-attr">allowPositionals</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">options</span>: {
        <span class="hljs-attr">format</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
            <span class="hljs-attr">short</span>: <span class="hljs-string">'f'</span>,
            <span class="hljs-attr">default</span>: <span class="hljs-string">'esm'</span>,
        },
    },
})

<span class="hljs-comment">//  创建 esm 的 __filename</span>
<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)
<span class="hljs-comment">//  创建 esm 的 __dirname</span>
<span class="hljs-keyword">const</span>  __dirname = <span class="hljs-title function_">dirname</span>(__filename)

<span class="hljs-keyword">const</span>  <span class="hljs-built_in">require</span>  = <span class="hljs-title function_">createRequire</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)

<span class="hljs-keyword">const</span>  target = positionals.<span class="hljs-property">length</span> ? positionals[<span class="hljs-number">0</span>] : <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 构建入口文件路径：../packages/包名/src/index.ts</span>
<span class="hljs-keyword">const</span>  entry = <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">`../packages/<span class="hljs-subst">${target}</span>/src/index.ts`</span>)

<span class="hljs-comment">/**
 * --format cjs or esm
 * 构建输出文件路径：../packages/包名/dist/包名.格式index.js
 * 例如：packages/vue/dist/vue.cjsindex.js 或 packages/vue/dist/vue.esmindex.js
 */</span>
<span class="hljs-keyword">const</span>  outfile = <span class="hljs-title function_">resolve</span>(
    __dirname,
    <span class="hljs-string">`../packages/<span class="hljs-subst">${target}</span>/dist/<span class="hljs-subst">${target}</span>.<span class="hljs-subst">${format}</span>index.js`</span>
)
<span class="hljs-comment">// 读取目标包的package.json文件</span>
<span class="hljs-keyword">const</span> pkg = <span class="hljs-built_in">require</span>(<span class="hljs-string">`../packages/<span class="hljs-subst">${target}</span>/package.json`</span>)

<span class="hljs-comment">// 使用esbuild创建构建上下文并启动监听模式</span>
esbuild.<span class="hljs-title function_">context</span>({
    <span class="hljs-attr">entryPoints</span>: [entry],  <span class="hljs-comment">// 指定入口文件</span>
    outfile,               <span class="hljs-comment">// 指定输出文件</span>
    format,                <span class="hljs-comment">// 打包格式：'cjs' 或 'esm'</span>
    <span class="hljs-attr">platform</span>: format === <span class="hljs-string">'cjs'</span> ? <span class="hljs-string">'node'</span> : <span class="hljs-string">'browser'</span>, <span class="hljs-comment">// 根据格式选择平台：cjs用node，esm用browser</span>
    <span class="hljs-attr">sourcemap</span>: <span class="hljs-literal">true</span>,       <span class="hljs-comment">// 生成sourcemap文件，便于调试</span>
    <span class="hljs-attr">bundle</span>: <span class="hljs-literal">true</span>,          <span class="hljs-comment">// 将依赖打包到一个文件中</span>
    <span class="hljs-attr">globalName</span>: pkg.<span class="hljs-property">buildOptions</span>?.<span class="hljs-property">name</span> <span class="hljs-comment">// 从package.json中读取全局变量名（用于UMD格式）</span>
}).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">ctx</span> =&gt;</span> ctx.<span class="hljs-title function_">watch</span>())  <span class="hljs-comment">// 启动监听模式，文件变化时自动重新构建</span>
</code></pre>
<ol start="7">
<li><code>packages</code>目录新建<code>reactivity、shared、vue</code>文件夹
<ul>
<li><code>reactivity</code>：响应式模块</li>
<li><code>shared</code>：工具函数模块</li>
<li><code>vue</code>：vue核心包</li>
</ul>
</li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/reactivity"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"响应式模块"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"iist/reactivity.cjs.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/reactivity.esm.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"buildOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"VueReactivity"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"formats"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"esm-bundler"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"esm-browser"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"cjs"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"global"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/shared"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"工具函数"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/shared.cjs.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/shared.esm.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"buildOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"VueShared"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"formats"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"esm-bundler"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"esm-browser"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"cjs"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"global"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue核心包"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/vue.cjs.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dist/vue.esm.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"files"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"dist"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"buildOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vue"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"formats"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
      <span class="hljs-string">"esm-bundler"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"esm-browser"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"cjs"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-string">"global"</span>
    <span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="8">
<li>根目录<code>package.json</code>添加<code>node scripts/dev.js reactivity --format cjs</code></li>
</ol>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue3源码"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"main"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node scripts/dev.js reactivity --format cjs"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"keywords"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"author"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"license"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ISC"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@types/node"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^24.3.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"esbuild"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^0.25.9"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"prettier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.6.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.9.2"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.5.21"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-4">验证输出</h4>
<ul>
<li>新建<code>reactivity/src/index.ts</code></li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 测试函数</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fn</span>(<span class="hljs-params">a,b</span>) {
  <span class="hljs-keyword">return</span> a + b
}
</code></pre>
<ul>
<li>执行<code>pnpm dev</code>，在<code>reactivity/dist</code>目录输出如下</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a5988b5a2da477eace8bc588500b5cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YOP57Sg5rC06Je756CB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765809744&amp;x-signature=AY2cw2xvVHqej%2B5B9AXXeVDkrlU%3D" alt="微信图片_20251208211758_6_6.png" loading="lazy"/></p>
<p>到这一步，项目搭建完成！</p>
<ul>
<li>项目结构</li>
</ul>
<pre><code class="hljs language-md" lang="md">Vue3/
├── node<span class="hljs-emphasis">_modules/              # Node.js 依赖模块
├── packages/                  # 多包工作区
│   ├── reactivity/           # 响应式系统包
│   │   ├── dist/            # 构建输出目录
│   │   ├── src/             # 源代码目录
│   │   │   └── index.ts     # 响应式系统入口文件
│   │   └── package.json     # reactivity 包配置
│   ├── shared/              # 共享工具包
│   │   ├── src/             # 共享代码源代码
│   │   └── package.json     # shared 包配置
│   └── vue/                 # Vue 主包
│       ├── src/             # Vue 源代码
│       └── package.json     # vue 包配置
├── scripts/                  # 构建脚本目录
│   ├── dev.js               # 开发构建脚本
│   └── .prettierrc          # Prettier 代码格式化配置
├── package.json             # 项目根配置
├── pnpm-lock.yaml           # pnpm 依赖锁文件
├── pnpm-workspace.yaml      # pnpm 工作区配置
├── tsconfig.json            # TypeScript 配置
├── External Libraries/      # 外部库（IDE 生成）
└── Scratches and Consoles/ # 临时文件和终端（IDE 功能）
</span></code></pre>
<p><strong>相关链接</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fcore" target="_blank" title="https://github.com/vuejs/core" ref="nofollow noopener noreferrer">Vue3 官方仓库</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpnpm.io%2Fworkspaces" target="_blank" title="https://pnpm.io/workspaces" ref="nofollow noopener noreferrer">pnpm 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fesbuild.github.io%2F" target="_blank" title="https://esbuild.github.io/" ref="nofollow noopener noreferrer">esbuild 官网</a></li>
</ul>
<p><em>（注：本文为学习笔记，如有理解不当之处，欢迎指正交流。）</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React中的'插槽']]></title>    <link>https://juejin.cn/post/7581350888788852772</link>    <guid>https://juejin.cn/post/7581350888788852772</guid>    <pubDate>2025-12-08T15:10:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581350888788852772" data-draft-id="7581350888788836388" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React中的'插槽'"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-08T15:10:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="写代码的皮筏艇"/> <meta itemprop="url" content="https://juejin.cn/user/4196178024218520"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React中的'插槽'
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4196178024218520/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    写代码的皮筏艇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:10:19.000Z" title="Mon Dec 08 2025 15:10:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>一、最基础的：<code>children</code> prop（默认插槽）</strong></h2>
<h3 data-id="heading-1"><strong>基本用法</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 父组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>这是标题<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是内容...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>点击<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 子组件 Card（类似 Vue 的默认插槽）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;</span>
      {children}  {/* 这里就是插槽位置 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-2"><strong>处理没有 children 的情况</strong></h3>
<p>jsx</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;</span>
      {children || <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>默认内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-3"><strong>二、命名插槽（类似 Vue 的具名插槽）</strong></h2>
<h3 data-id="heading-4"><strong>方法1：使用多个 props</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件：定义多个插槽位置</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Layout</span>(<span class="hljs-params">{ header, sidebar, content, footer }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"layout"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"header"</span>&gt;</span>{header}<span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">aside</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"sidebar"</span>&gt;</span>{sidebar}<span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"content"</span>&gt;</span>{content}<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">footer</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"footer"</span>&gt;</span>{footer}<span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>
      <span class="hljs-attr">header</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>网站标题<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>}
      sidebar={
        <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/about"</span>&gt;</span>关于<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      }
      content={<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>主要内容区域...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      footer={<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>版权信息 © 2024<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
    /&gt;</span>
  );
}
</code></pre>
<h3 data-id="heading-5"><strong>方法2：使用 children 对象（更接近 Vue 语法）</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-comment">// children 可以是对象</span>
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-header"</span>&gt;</span>
        {children.header || <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>默认标题<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-body"</span>&gt;</span>
        {children.body || <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>默认内容<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-footer"</span>&gt;</span>
        {children.footer}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span>
      {{
        header: <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>自定义标题<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>,
        body: <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>自定义内容...<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>,
        footer: <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>确认<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-6"><strong>三、作用域插槽（带数据的插槽）</strong></h2>
<h3 data-id="heading-7"><strong>方法1：使用 render props</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件：提供数据给插槽</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">DataList</span>(<span class="hljs-params">{ data, children }</span>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"list"</span>&gt;</span>
      {data.map((item, index) =&gt; (
        // 调用 children 函数，传递数据
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>
          {children(item, index)}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> users = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">30</span> }
  ];
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">DataList</span> <span class="hljs-attr">data</span>=<span class="hljs-string">{users}</span>&gt;</span>
      {(user, index) =&gt; (  // 这里接收子组件传递的数据
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"user-item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{index + 1}. <span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span> ({user.age}岁)<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">DataList</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-8"><strong>方法2：使用函数作为 children</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 子组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Toggle</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> [isOn, setIsOn] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">toggle</span> = (<span class="hljs-params"/>) =&gt; <span class="hljs-title function_">setIsOn</span>(!isOn);
  
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">children</span>({ 
    isOn, 
    toggle,
    <span class="hljs-attr">onText</span>: <span class="hljs-string">'开启'</span>,
    <span class="hljs-attr">offText</span>: <span class="hljs-string">'关闭'</span>
  });
}

<span class="hljs-comment">// 父组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Toggle</span>&gt;</span>
      {({ isOn, toggle, onText, offText }) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{toggle}</span>&gt;</span>
          {isOn ? onText : offText}
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      )}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Toggle</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-9"><strong>四、组合组件模式（类似 Web Components 的 <code>&lt;slot&gt;</code>）</strong></h2>
<h3 data-id="heading-10"><strong>方法1：使用特殊的子组件</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 定义插槽组件</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CardHeader</span> = (<span class="hljs-params">{ children }</span>) =&gt; children;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CardBody</span> = (<span class="hljs-params">{ children }</span>) =&gt; children;
<span class="hljs-keyword">const</span> <span class="hljs-title function_">CardFooter</span> = (<span class="hljs-params">{ children }</span>) =&gt; children;

<span class="hljs-comment">// 容器组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Card</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-comment">// 从 children 中提取不同插槽的内容</span>
  <span class="hljs-keyword">let</span> header, body, footer;
  
  <span class="hljs-title class_">React</span>.<span class="hljs-property">Children</span>.<span class="hljs-title function_">forEach</span>(children, <span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (child.<span class="hljs-property">type</span> === <span class="hljs-title class_">CardHeader</span>) {
      header = child.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (child.<span class="hljs-property">type</span> === <span class="hljs-title class_">CardBody</span>) {
      body = child.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (child.<span class="hljs-property">type</span> === <span class="hljs-title class_">CardFooter</span>) {
      footer = child.<span class="hljs-property">props</span>.<span class="hljs-property">children</span>;
    }
  });
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;</span>
      {header &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-header"</span>&gt;</span>{header}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      {body &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-body"</span>&gt;</span>{body}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
      {footer &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"card-footer"</span>&gt;</span>{footer}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 父组件使用（类似 Vue 的语法）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CardHeader</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>用户信息<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CardHeader</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CardBody</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>姓名：张三<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>年龄：25<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CardBody</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">CardFooter</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>&gt;</span>编辑<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">CardFooter</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-11"><strong>方法2：使用 context + 特殊组件</strong></h3>
<p>jsx</p>
<pre><code class="hljs language-ini" lang="ini">// 更高级的实现
const <span class="hljs-attr">CardContext</span> = React.createContext({})<span class="hljs-comment">;</span>

const <span class="hljs-attr">Card</span> = ({ children }) =&gt; {
  const <span class="hljs-section">[slots, setSlots]</span> = useState({})<span class="hljs-comment">;</span>
  
  return (
    &lt;CardContext.Provider <span class="hljs-attr">value</span>={{ registerSlot: setSlots }}&gt;
      {children}
      &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"card"</span>&gt;
        &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"card-header"</span>&gt;{slots.header}&lt;/div&gt;
        &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"card-body"</span>&gt;{slots.body}&lt;/div&gt;
        &lt;div <span class="hljs-attr">className</span>=<span class="hljs-string">"card-footer"</span>&gt;{slots.footer}&lt;/div&gt;
      &lt;/div&gt;
    &lt;/CardContext.Provider&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>

const <span class="hljs-attr">CardHeader</span> = ({ children }) =&gt; {
  const { registerSlot } = useContext(CardContext)<span class="hljs-comment">;</span>
  
  useEffect(() =&gt; {
    registerSlot(<span class="hljs-attr">prev</span> =&gt; ({ ...prev, header: children }))<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[children, registerSlot]</span>)<span class="hljs-comment">;</span>
  
  return null<span class="hljs-comment">; // 不渲染自身</span>
}<span class="hljs-comment">;</span>
</code></pre>
<h2 data-id="heading-12"><strong>五、使用第三方库实现插槽</strong></h2>
<h3 data-id="heading-13"><strong>1. React Slot（专门库）</strong></h3>
<pre><code class="hljs">npm install react-slot
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Slot</span>, <span class="hljs-title class_">Fill</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-slot'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Layout</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">header</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"header"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">header</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"content"</span> /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Layout</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Fill</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>我的网站<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Fill</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Fill</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>欢迎光临<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Fill</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">Layout</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-14"><strong>六、实战案例：实现一个完整的弹窗组件</strong></h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 弹窗组件（支持插槽）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Modal</span>(<span class="hljs-params">{ 
  isOpen, 
  onClose, 
  title,
  children,
  footer 
}</span>) {
  <span class="hljs-keyword">if</span> (!isOpen) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"modal-overlay"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"modal"</span>&gt;</span>
        {/* 标题插槽 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"modal-header"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{title}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClose}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"close-btn"</span>&gt;</span>×<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        {/* 默认插槽（主要内容） */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"modal-body"</span>&gt;</span>
          {children}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        {/* 底部插槽 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"modal-footer"</span>&gt;</span>
          {footer || (  // 默认底部
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClose}</span>&gt;</span>关闭<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          )}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [showModal, setShowModal] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setShowModal(true)}&gt;打开弹窗<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Modal</span>
        <span class="hljs-attr">isOpen</span>=<span class="hljs-string">{showModal}</span>
        <span class="hljs-attr">onClose</span>=<span class="hljs-string">{()</span> =&gt;</span> setShowModal(false)}
        title="用户设置"
        footer={  // 具名插槽
          <span class="hljs-tag">&lt;&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setShowModal(false)}&gt;取消<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> alert('保存成功')}&gt;保存<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;/&gt;</span>
        }
      &gt;
        {/* 默认插槽内容 */}
        <span class="hljs-tag">&lt;<span class="hljs-name">form</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
            用户名：
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>
            邮箱：
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"email"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Modal</span>&gt;</span></span>
    &lt;/div&gt;
  );
}
</code></pre>
<h2 data-id="heading-15"><strong>七、高级模式：动态插槽</strong></h2>
<h3 data-id="heading-16"><strong>动态决定插槽位置</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">DynamicLayout</span>(<span class="hljs-params">{ children, layout = <span class="hljs-string">'default'</span> }</span>) {
  <span class="hljs-comment">// 根据布局类型动态渲染插槽</span>
  <span class="hljs-keyword">const</span> layouts = {
    <span class="hljs-attr">default</span>: (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"default-layout"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"top"</span>&gt;</span>{children.top}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"main"</span>&gt;</span>{children.main}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    ),
    <span class="hljs-attr">sidebar</span>: (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"sidebar-layout"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">aside</span>&gt;</span>{children.sidebar}<span class="hljs-tag">&lt;/<span class="hljs-name">aside</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">main</span>&gt;</span>{children.main}<span class="hljs-tag">&lt;/<span class="hljs-name">main</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    ),
    <span class="hljs-attr">grid</span>: (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid-layout"</span>&gt;</span>
        {children.grid?.map((item, index) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{index}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"grid-item"</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
  };
  
  <span class="hljs-keyword">return</span> layouts[layout];
}

<span class="hljs-comment">// 使用</span>
&lt;<span class="hljs-title class_">DynamicLayout</span> layout=<span class="hljs-string">"sidebar"</span>&gt;
  {{
    <span class="hljs-attr">sidebar</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>导航菜单<span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span></span>,
    <span class="hljs-attr">main</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">article</span>&gt;</span>主要内容<span class="hljs-tag">&lt;/<span class="hljs-name">article</span>&gt;</span></span>
  }}
&lt;/<span class="hljs-title class_">DynamicLayout</span>&gt;
</code></pre>
<h2 data-id="heading-17"><strong>八、与 Vue 插槽的对比</strong></h2>






























<table><thead><tr><th>Vue 插槽</th><th>React 对应实现</th><th>代码示例</th></tr></thead><tbody><tr><td><code>&lt;slot /&gt;</code></td><td><code>{children}</code></td><td><code>&lt;div&gt;{children}&lt;/div&gt;</code></td></tr><tr><td><code>&lt;slot name="header"&gt;</code></td><td>多个 props</td><td><code>header={content}</code></td></tr><tr><td>作用域插槽</td><td>render props</td><td><code>{(data) =&gt; &lt;div&gt;{data}&lt;/div&gt;}</code></td></tr><tr><td><code>&lt;template #header&gt;</code></td><td>组件组合</td><td><code>&lt;Card&gt;&lt;CardHeader&gt;...&lt;/CardHeader&gt;&lt;/Card&gt;</code></td></tr></tbody></table>
<h2 data-id="heading-18"><strong>九、最佳实践建议</strong></h2>
<h3 data-id="heading-19"><strong>何时使用哪种方式？</strong></h3>
<ol>
<li><strong>简单内容传递</strong> → <code>children</code> prop</li>
<li><strong>多个固定区域</strong> → 多个 props（命名插槽）</li>
<li><strong>需要向父组件传递数据</strong> → render props</li>
<li><strong>类似 Vue 的具名插槽语法</strong> → 组件组合模式</li>
<li><strong>复杂插槽逻辑</strong> → Context + 特殊组件</li>
</ol>
<h3 data-id="heading-20"><strong>性能考虑</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ❌ 避免每次渲染都创建新的插槽内容</span>
&lt;<span class="hljs-title class_">Card</span>&gt;
  {{
    <span class="hljs-attr">header</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span>,  <span class="hljs-comment">// 每次都是新组件</span>
    <span class="hljs-attr">body</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Body</span> /&gt;</span></span>
  }}
&lt;/<span class="hljs-title class_">Card</span>&gt;

<span class="hljs-comment">// ✅ 使用 useMemo 或提取到组件外部</span>
<span class="hljs-keyword">const</span> cardContent = <span class="hljs-title function_">useMemo</span>(<span class="hljs-function">() =&gt;</span> ({
  <span class="hljs-attr">header</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span> /&gt;</span></span>,
  <span class="hljs-attr">body</span>: <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Body</span> /&gt;</span></span>
}), [dependencies]);

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Card</span>&gt;</span>{cardContent}<span class="hljs-tag">&lt;/<span class="hljs-name">Card</span>&gt;</span></span>
</code></pre>
<p><strong>reaact 中的性能优化有很多需要注意的地方，欢迎大家说说平时遇到的情况</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React Router 路由模式详解：HashRouter vs BrowserRouter]]></title>    <link>https://juejin.cn/post/7581359420391931931</link>    <guid>https://juejin.cn/post/7581359420391931931</guid>    <pubDate>2025-12-08T15:05:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581359420391931931" data-draft-id="7581406561685536814" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React Router 路由模式详解：HashRouter vs BrowserRouter"/> <meta itemprop="keywords" content="React.js"/> <meta itemprop="datePublished" content="2025-12-08T15:05:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="北辰alk"/> <meta itemprop="url" content="https://juejin.cn/user/1772855673241352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React Router 路由模式详解：HashRouter vs BrowserRouter
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1772855673241352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    北辰alk
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:05:38.000Z" title="Mon Dec 08 2025 15:05:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>在现代前端单页面应用（SPA）开发中，路由管理是至关重要的一环。React Router 作为 React 生态中最流行的路由库，提供了两种主要的路由模式：HashRouter 和 BrowserRouter。本文将深入探讨这两种模式的实现原理、使用场景和差异。</p>
</blockquote>
<h2 data-id="heading-0">1. React Router 简介</h2>
<p>React Router 是 React 官方推荐的路由库，它通过管理 URL 与组件之间的映射关系，实现了单页面应用的多视图切换功能。目前 React Router 已发展到 v6 版本，提供了更加简洁和强大的 API。</p>
<h3 data-id="heading-1">1.1 安装 React Router</h3>
<pre><code class="hljs language-bash" lang="bash">npm install react-router-dom
</code></pre>
<h3 data-id="heading-2">1.2 基本使用</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Link</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Home'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/About'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Contact</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./components/Contact'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>关于<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/contact"</span>&gt;</span>联系<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/contact"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Contact</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h2 data-id="heading-3">2. HashRouter 模式</h2>
<h3 data-id="heading-4">2.1 什么是 HashRouter</h3>
<p>HashRouter 使用 URL 的 hash 部分（即 <code>#</code> 号后面的内容）来管理路由。这种模式兼容性最好，可以在所有浏览器中运行，并且不需要服务器端配置。</p>
<p><strong>示例 URL：</strong></p>
<pre><code class="hljs language-bash" lang="bash">http://example.com/<span class="hljs-comment">#/home</span>
http://example.com/<span class="hljs-comment">#/about</span>
http://example.com/<span class="hljs-comment">#/users/123</span>
</code></pre>
<h3 data-id="heading-5">2.2 HashRouter 实现原理</h3>
<h4 data-id="heading-6">2.2.1 核心机制</h4>
<p>HashRouter 的核心原理是利用 <code>window.location.hash</code> 属性和 <code>hashchange</code> 事件：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleHashRouter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span> = <span class="hljs-string">''</span>;
    
    <span class="hljs-comment">// 监听 hashchange 事件</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'hashchange'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">refresh</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-literal">false</span>);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">refresh</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-literal">false</span>);
  }
  
  <span class="hljs-comment">// 注册路由</span>
  <span class="hljs-title function_">route</span>(<span class="hljs-params">path, callback</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>[path] = callback || <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
  }
  
  <span class="hljs-comment">// 路由刷新</span>
  <span class="hljs-title function_">refresh</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>) || <span class="hljs-string">'/'</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span>]) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span>]();
    }
  }
  
  <span class="hljs-comment">// 导航到新路由</span>
  <span class="hljs-title function_">navigate</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span> = <span class="hljs-string">'#'</span> + path;
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleHashRouter</span>();

router.<span class="hljs-title function_">route</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;h1&gt;首页&lt;/h1&gt;'</span>;
});

router.<span class="hljs-title function_">route</span>(<span class="hljs-string">'/about'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;h1&gt;关于我们&lt;/h1&gt;'</span>;
});
</code></pre>
<h4 data-id="heading-7">2.2.2 React Router 中的 HashRouter 实现</h4>
<p>React Router 的 HashRouter 组件内部实现更加复杂，但基本原理相同：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Router</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">HashRouter</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> [location, setLocation] = <span class="hljs-title function_">useState</span>({
    <span class="hljs-attr">pathname</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>) || <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">search</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">hash</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">state</span>: <span class="hljs-literal">null</span>
  });

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleHashChange</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">setLocation</span>(<span class="hljs-function"><span class="hljs-params">prev</span> =&gt;</span> ({
        ...prev,
        <span class="hljs-attr">pathname</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>) || <span class="hljs-string">'/'</span>
      }));
    };

    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'hashchange'</span>, handleHashChange);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'hashchange'</span>, handleHashChange);
    };
  }, []);

  <span class="hljs-keyword">const</span> history = {
    <span class="hljs-attr">push</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span> = <span class="hljs-string">'#'</span> + path;
    },
    <span class="hljs-attr">replace</span>: <span class="hljs-function">(<span class="hljs-params">path</span>) =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'#'</span> + path);
    },
    <span class="hljs-attr">go</span>: <span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">go</span>(n);
    },
    <span class="hljs-attr">goBack</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">back</span>();
    },
    <span class="hljs-attr">goForward</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">forward</span>();
    },
    location
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">history</span>=<span class="hljs-string">{history}</span> <span class="hljs-attr">location</span>=<span class="hljs-string">{location}</span>&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-8">2.3 HashRouter 使用示例</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HashRouter</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Link</span>, useNavigate } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> navigate = <span class="hljs-title function_">useNavigate</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> navigate('/about')}&gt;跳转到关于页面<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">About</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>关于我们<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params">{ id }</span>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户详情 - ID: {id}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">HashRouter</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>关于<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/user/123"</span>&gt;</span>用户123<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/user/:id"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">User</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">HashRouter</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h3 data-id="heading-9">2.4 HashRouter 流程图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户点击链接或调用 navigate] --&gt; B[更新 window.location.hash]
    B --&gt; C[触发 hashchange 事件]
    C --&gt; D[React Router 监听器捕获事件]
    D --&gt; E[更新 Router 内部状态]
    E --&gt; F[重新渲染匹配的组件]
    F --&gt; G[页面内容更新]
</code></pre>
<h2 data-id="heading-10">3. BrowserRouter 模式</h2>
<h3 data-id="heading-11">3.1 什么是 BrowserRouter</h3>
<p>BrowserRouter 使用 HTML5 History API 来管理路由，创建的是真实的 URL 路径，不包含 <code>#</code> 符号。这种模式创建的 URL 更加美观，更符合用户习惯。</p>
<p><strong>示例 URL：</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">http:<span class="hljs-comment">//example.com/home</span>
http:<span class="hljs-comment">//example.com/about</span>
http:<span class="hljs-comment">//example.com/users/123</span>
</code></pre>
<h3 data-id="heading-12">3.2 BrowserRouter 实现原理</h3>
<h4 data-id="heading-13">3.2.1 History API 核心方法</h4>
<p>BrowserRouter 依赖于 HTML5 History API，主要方法包括：</p>
<ul>
<li><code>history.pushState()</code>: 添加新的历史记录</li>
<li><code>history.replaceState()</code>: 替换当前历史记录</li>
<li><code>popstate</code> 事件: 当用户导航历史记录时触发</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleBrowserRouter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span> = {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span> = <span class="hljs-string">''</span>;
    
    <span class="hljs-comment">// 监听 popstate 事件</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">refresh</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-literal">false</span>);
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'load'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">refresh</span>.<span class="hljs-title function_">bind</span>(<span class="hljs-variable language_">this</span>), <span class="hljs-literal">false</span>);
  }
  
  <span class="hljs-comment">// 注册路由</span>
  <span class="hljs-title function_">route</span>(<span class="hljs-params">path, callback</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>[path] = callback || <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
  }
  
  <span class="hljs-comment">// 路由刷新</span>
  <span class="hljs-title function_">refresh</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span> || <span class="hljs-string">'/'</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span>]) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">routes</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUrl</span>]();
    }
  }
  
  <span class="hljs-comment">// 导航到新路由</span>
  <span class="hljs-title function_">push</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">pushState</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, path);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refresh</span>();
  }
  
  <span class="hljs-title function_">replace</span>(<span class="hljs-params">path</span>) {
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">replaceState</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, path);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">refresh</span>();
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SimpleBrowserRouter</span>();

router.<span class="hljs-title function_">route</span>(<span class="hljs-string">'/'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;h1&gt;首页&lt;/h1&gt;'</span>;
});

router.<span class="hljs-title function_">route</span>(<span class="hljs-string">'/about'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'content'</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">'&lt;h1&gt;关于我们&lt;/h1&gt;'</span>;
});
</code></pre>
<h4 data-id="heading-14">3.2.2 React Router 中的 BrowserRouter 实现</h4>
<p>React Router 的 BrowserRouter 组件实现：</p>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Router</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">BrowserRouter</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> [location, setLocation] = <span class="hljs-title function_">useState</span>({
    <span class="hljs-attr">pathname</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>,
    <span class="hljs-attr">search</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>,
    <span class="hljs-attr">hash</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>,
    <span class="hljs-attr">state</span>: <span class="hljs-literal">null</span>
  });

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handlePopState</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">setLocation</span>({
        <span class="hljs-attr">pathname</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>,
        <span class="hljs-attr">search</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>,
        <span class="hljs-attr">hash</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>,
        <span class="hljs-attr">state</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-property">state</span>
      });
    };

    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, handlePopState);
    
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'popstate'</span>, handlePopState);
    };
  }, []);

  <span class="hljs-keyword">const</span> history = {
    <span class="hljs-attr">push</span>: <span class="hljs-function">(<span class="hljs-params">path, state</span>) =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">pushState</span>(state, <span class="hljs-string">''</span>, path);
      <span class="hljs-title function_">setLocation</span>({
        <span class="hljs-attr">pathname</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>,
        <span class="hljs-attr">search</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>,
        <span class="hljs-attr">hash</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>,
        state
      });
    },
    <span class="hljs-attr">replace</span>: <span class="hljs-function">(<span class="hljs-params">path, state</span>) =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">replaceState</span>(state, <span class="hljs-string">''</span>, path);
      <span class="hljs-title function_">setLocation</span>({
        <span class="hljs-attr">pathname</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">pathname</span>,
        <span class="hljs-attr">search</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">search</span>,
        <span class="hljs-attr">hash</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span>,
        state
      });
    },
    <span class="hljs-attr">go</span>: <span class="hljs-function">(<span class="hljs-params">n</span>) =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">go</span>(n);
    },
    <span class="hljs-attr">goBack</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">back</span>();
    },
    <span class="hljs-attr">goForward</span>: <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-variable language_">window</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">forward</span>();
    },
    location
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Router</span> <span class="hljs-attr">history</span>=<span class="hljs-string">{history}</span> <span class="hljs-attr">location</span>=<span class="hljs-string">{location}</span>&gt;</span>
      {children}
    <span class="hljs-tag">&lt;/<span class="hljs-name">Router</span>&gt;</span></span>
  );
}
</code></pre>
<h3 data-id="heading-15">3.3 BrowserRouter 使用示例</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Link</span>, useParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Home</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">About</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>关于我们<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">User</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { id } = <span class="hljs-title function_">useParams</span>();
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户详情 - ID: {id}<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">NotFound</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>404 - 页面未找到<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/about"</span>&gt;</span>关于<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/user/123"</span>&gt;</span>用户123<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">Home</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/about"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">About</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/user/:id"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">User</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"*"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">NotFound</span> /&gt;</span>} /&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h3 data-id="heading-16">3.4 BrowserRouter 流程图</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[用户点击链接或调用 navigate] --&gt; B[调用 history.pushState]
    B --&gt; C[更新 URL 但不刷新页面]
    C --&gt; D[React Router 更新内部状态]
    D --&gt; E[重新渲染匹配的组件]
    E --&gt; F[页面内容更新]
    
    G[用户点击浏览器前进/后退] --&gt; H[触发 popstate 事件]
    H --&gt; I[React Router 监听器捕获事件]
    I --&gt; J[更新 Router 内部状态]
    J --&gt; K[重新渲染匹配的组件]
    K --&gt; L[页面内容更新]
</code></pre>
<h2 data-id="heading-17">4. 两种模式的对比</h2>
<h3 data-id="heading-18">4.1 功能特性对比</h3>



































<table><thead><tr><th>特性</th><th>HashRouter</th><th>BrowserRouter</th></tr></thead><tbody><tr><td>URL 美观度</td><td>较差（包含 #）</td><td>较好（纯路径）</td></tr><tr><td>兼容性</td><td>所有浏览器</td><td>IE10+</td></tr><tr><td>服务器配置</td><td>不需要</td><td>需要配置支持</td></tr><tr><td>SEO 友好性</td><td>较差</td><td>较好</td></tr><tr><td>实现原理</td><td>hashchange 事件</td><td>History API</td></tr></tbody></table>
<h3 data-id="heading-19">4.2 服务器配置要求</h3>
<h4 data-id="heading-20">HashRouter 服务器配置</h4>
<p>HashRouter 不需要特殊服务器配置，因为 <code>#</code> 后面的内容不会发送到服务器。</p>
<h4 data-id="heading-21">BrowserRouter 服务器配置</h4>
<p>BrowserRouter 需要服务器配置，确保所有路由都返回 index.html：</p>
<p><strong>Express 服务器配置：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

<span class="hljs-comment">// 静态文件服务</span>
app.<span class="hljs-title function_">use</span>(express.<span class="hljs-title function_">static</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'build'</span>)));

<span class="hljs-comment">// 所有路由都返回 index.html</span>
app.<span class="hljs-title function_">get</span>(<span class="hljs-string">'*'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">req, res</span>) {
  res.<span class="hljs-title function_">sendFile</span>(path.<span class="hljs-title function_">join</span>(__dirname, <span class="hljs-string">'build'</span>, <span class="hljs-string">'index.html'</span>));
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">9000</span>);
</code></pre>
<p><strong>Nginx 服务器配置：</strong></p>
<pre><code class="hljs language-nginx" lang="nginx">server {
  listen 80;
  server_name example.com;
  root /usr/share/nginx/html;
  index index.html;
  
  location / {
    try_files $uri $uri/ /index.html;
  }
}
</code></pre>
<h3 data-id="heading-22">4.3 选择建议</h3>
<ul>
<li>
<p><strong>使用 HashRouter 的情况</strong>：</p>
<ul>
<li>静态网站托管（如 GitHub Pages）</li>
<li>不支持 History API 的旧浏览器</li>
<li>没有服务器配置权限</li>
<li>快速原型开发</li>
</ul>
</li>
<li>
<p><strong>使用 BrowserRouter 的情况</strong>：</p>
<ul>
<li>有自己的服务器并可以配置</li>
<li>需要 SEO 友好的 URL</li>
<li>现代浏览器环境</li>
<li>生产环境应用</li>
</ul>
</li>
</ul>
<h2 data-id="heading-23">5. 实际应用示例</h2>
<h3 data-id="heading-24">5.1 动态路由应用</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Link</span>, useParams } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-comment">// 模拟数据获取</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">fetchUser</span> = (<span class="hljs-params">id</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>({
        id,
        <span class="hljs-attr">name</span>: <span class="hljs-string">`用户 <span class="hljs-subst">${id}</span>`</span>,
        <span class="hljs-attr">email</span>: <span class="hljs-string">`user<span class="hljs-subst">${id}</span>@example.com`</span>
      });
    }, <span class="hljs-number">500</span>);
  });
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserList</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> users = [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span> }
  ];
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户列表<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        {users.map(user =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">li</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{user.id}</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">{</span>`/<span class="hljs-attr">user</span>/${<span class="hljs-attr">user.id</span>}`}&gt;</span>{user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">UserDetail</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { id } = <span class="hljs-title function_">useParams</span>();
  <span class="hljs-keyword">const</span> [user, setUser] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">null</span>);
  <span class="hljs-keyword">const</span> [loading, setLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">true</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">loadUser</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">true</span>);
      <span class="hljs-keyword">const</span> userData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetchUser</span>(id);
      <span class="hljs-title function_">setUser</span>(userData);
      <span class="hljs-title function_">setLoading</span>(<span class="hljs-literal">false</span>);
    };
    
    <span class="hljs-title function_">loadUser</span>();
  }, [id]);
  
  <span class="hljs-keyword">if</span> (loading) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>加载中...<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  <span class="hljs-keyword">if</span> (!user) <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>用户不存在<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>用户详情<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>ID:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {user.id}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>姓名:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {user.name}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>邮箱:<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span> {user.email}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">nav</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">10px</span>', <span class="hljs-attr">borderBottom:</span> '<span class="hljs-attr">1px</span> <span class="hljs-attr">solid</span> #<span class="hljs-attr">ccc</span>' }}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">marginRight:</span> '<span class="hljs-attr">10px</span>' }}&gt;</span>首页<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/users"</span>&gt;</span>用户列表<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">nav</span>&gt;</span>
      
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">padding:</span> '<span class="hljs-attr">20px</span>' }}&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">h1</span>&gt;</span>欢迎来到用户管理系统<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>} /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/users"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">UserList</span> /&gt;</span>} /&gt;
          <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/user/:id"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">UserDetail</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h3 data-id="heading-25">5.2 路由守卫示例</h3>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, { useState, useEffect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">BrowserRouter</span>, <span class="hljs-title class_">Routes</span>, <span class="hljs-title class_">Route</span>, <span class="hljs-title class_">Navigate</span>, useLocation } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-router-dom'</span>;

<span class="hljs-comment">// 模拟认证状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">useAuth</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> [isAuthenticated, setIsAuthenticated] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">login</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setIsAuthenticated</span>(<span class="hljs-literal">true</span>);
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'isAuthenticated'</span>, <span class="hljs-string">'true'</span>);
  };
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">logout</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setIsAuthenticated</span>(<span class="hljs-literal">false</span>);
    <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'isAuthenticated'</span>);
  };
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> authStatus = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'isAuthenticated'</span>);
    <span class="hljs-keyword">if</span> (authStatus === <span class="hljs-string">'true'</span>) {
      <span class="hljs-title function_">setIsAuthenticated</span>(<span class="hljs-literal">true</span>);
    }
  }, []);
  
  <span class="hljs-keyword">return</span> { isAuthenticated, login, logout };
};

<span class="hljs-comment">// 路由守卫组件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">ProtectedRoute</span>(<span class="hljs-params">{ children }</span>) {
  <span class="hljs-keyword">const</span> { isAuthenticated } = <span class="hljs-title function_">useAuth</span>();
  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();
  
  <span class="hljs-keyword">if</span> (!isAuthenticated) {
    <span class="hljs-comment">// 重定向到登录页，并保存当前路径以便登录后返回</span>
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Navigate</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">state</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">from:</span> <span class="hljs-attr">location</span> }} <span class="hljs-attr">replace</span> /&gt;</span></span>;
  }
  
  <span class="hljs-keyword">return</span> children;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">LoginPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { login } = <span class="hljs-title function_">useAuth</span>();
  <span class="hljs-keyword">const</span> location = <span class="hljs-title function_">useLocation</span>();
  <span class="hljs-keyword">const</span> <span class="hljs-keyword">from</span> = location.<span class="hljs-property">state</span>?.<span class="hljs-property">from</span>?.<span class="hljs-property">pathname</span> || <span class="hljs-string">'/'</span>;
  
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">login</span>();
    <span class="hljs-comment">// 登录后跳转到之前尝试访问的页面或首页</span>
    <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-keyword">from</span>;
  };
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>登录页面<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{handleLogin}</span>&gt;</span>登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dashboard</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { logout } = <span class="hljs-title function_">useAuth</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>仪表板<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>这是受保护的页面<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{logout}</span>&gt;</span>退出登录<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">PublicPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>公开页面<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">BrowserRouter</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Routes</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">PublicPage</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> <span class="hljs-attr">path</span>=<span class="hljs-string">"/login"</span> <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>&lt;<span class="hljs-attr">LoginPage</span> /&gt;</span>} /&gt;
        <span class="hljs-tag">&lt;<span class="hljs-name">Route</span> 
          <span class="hljs-attr">path</span>=<span class="hljs-string">"/dashboard"</span> 
          <span class="hljs-attr">element</span>=<span class="hljs-string">{</span>
            &lt;<span class="hljs-attr">ProtectedRoute</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">Dashboard</span> /&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">ProtectedRoute</span>&gt;</span>
          } 
        /&gt;
      <span class="hljs-tag">&lt;/<span class="hljs-name">Routes</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">BrowserRouter</span>&gt;</span></span>
  );
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">App</span>;
</code></pre>
<h2 data-id="heading-26">6. 总结</h2>
<p>React Router 提供了两种主要的路由模式：HashRouter 和 BrowserRouter，它们各有优缺点和适用场景。</p>
<ul>
<li><strong>HashRouter</strong> 基于 URL hash 和 hashchange 事件，兼容性好，无需服务器配置，适合静态托管和简单应用。</li>
<li><strong>BrowserRouter</strong> 基于 HTML5 History API，URL 美观，SEO 友好，但需要服务器配置，适合现代浏览器和生产环境应用。</li>
</ul>
<p>在实际开发中，应根据项目需求、目标用户浏览器环境和服务器配置能力来选择合适的路由模式。对于大多数现代 Web 应用，BrowserRouter 是更好的选择，因为它提供了更好的用户体验和开发体验。</p>
<p>无论选择哪种模式，React Router 都提供了强大而灵活的路由管理能力，可以帮助开发者构建复杂的单页面应用程序。<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92180fe9ea964a4ca223ba1bd35e1dc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YyX6L6wYWxr:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811138&amp;x-signature=AdyH5TYh7y2ip00bMD%2FsxYOf7Ww%3D" alt="在这里插入图片描述" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript 原型继承与函数调用机制详解]]></title>    <link>https://juejin.cn/post/7581348660823572480</link>    <guid>https://juejin.cn/post/7581348660823572480</guid>    <pubDate>2025-12-08T14:45:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581348660823572480" data-draft-id="7581354812860661812" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript 原型继承与函数调用机制详解"/> <meta itemprop="keywords" content="JavaScript,前端,面试"/> <meta itemprop="datePublished" content="2025-12-08T14:45:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwwW"/> <meta itemprop="url" content="https://juejin.cn/user/631558156323657"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript 原型继承与函数调用机制详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/631558156323657/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwwW
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:45:57.000Z" title="Mon Dec 08 2025 14:45:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 原型继承与函数调用机制详解</h2>
<p>在 JavaScript 的面向对象编程体系中，<strong>原型继承</strong>（Prototype Inheritance）是其核心机制之一。不同于传统语言如 Java 或 C++ 使用的类继承模型，JavaScript 通过原型链实现对象之间的属性和方法共享。本文将围绕原型继承、<code>call</code> 与 <code>apply</code> 方法的作用、构造函数继承、中介空对象模式等关键概念展开深入解析，并结合实际代码示例帮助读者理解这一灵活而强大的继承机制。</p>
<hr/>
<h3 data-id="heading-1">一、函数调用中的 this 指向：call 与 apply</h3>
<p>在 JavaScript 中，函数是第一类对象，这意味着函数可以作为参数传递、赋值给变量，也可以拥有自己的属性和方法。其中，<code>call</code> 和 <code>apply</code> 是所有函数都具备的两个内置方法，用于<strong>显式指定函数执行时的 <code>this</code> 上下文</strong>。</p>
<h4 data-id="heading-2">1.1 call 与 apply 的基本用法</h4>
<ul>
<li><strong><code>fn.call(thisArg, arg1, arg2, ...)</code></strong> ：第一个参数为 <code>this</code> 的绑定对象，其余参数逐个传入。</li>
<li><strong><code>fn.apply(thisArg, [arg1, arg2, ...])</code></strong> ：第一个参数同样为 <code>this</code> 的绑定对象，但后续参数以数组形式传入。</li>
</ul>
<p>两者的核心区别仅在于<strong>参数传递方式</strong>，功能完全一致：<strong>立即执行函数并绑定指定的 <code>this</code></strong>。</p>
<pre><code class="hljs language-javascript" lang="javascript">javascript
编辑
<span class="hljs-keyword">function</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">greeting</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${greeting}</span>, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
}

<span class="hljs-keyword">const</span> person = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Alice'</span> };
greet.<span class="hljs-title function_">call</span>(person, <span class="hljs-string">'Hello'</span>);   <span class="hljs-comment">// Hello, I'm Alice</span>
greet.<span class="hljs-title function_">apply</span>(person, [<span class="hljs-string">'Hi'</span>]);   <span class="hljs-comment">// Hi, I'm Alice</span>
</code></pre>
<h4 data-id="heading-3">1.2 在构造函数继承中的应用</h4>
<p>在模拟“类继承”时，子类构造函数常需调用父类构造函数以初始化实例属性。此时，<code>call</code> 或 <code>apply</code> 被用来将父类构造函数的 <code>this</code> 绑定到子类实例上：</p>
<pre><code class="hljs language-ini" lang="ini">javascript
编辑
function Animal(name, age) {
  <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
  <span class="hljs-attr">this.age</span> = age<span class="hljs-comment">;</span>
}

function Cat(color, name, age) {
  // 将 Animal 的 this 指向当前 Cat 实例
  Animal.apply(this, <span class="hljs-section">[name, age]</span>)<span class="hljs-comment">; // 或 Animal.call(this, name, age);</span>
  <span class="hljs-attr">this.color</span> = color<span class="hljs-comment">;</span>
}
</code></pre>
<p>这样，<code>Cat</code> 实例不仅拥有自己的 <code>color</code> 属性，还通过父类构造函数获得了 <code>name</code> 和 <code>age</code>。</p>
<hr/>
<h3 data-id="heading-4">二、原型继承：共享方法的关键</h3>
<p>仅仅通过构造函数继承属性是不够的——方法若定义在构造函数内部，会导致每个实例都拥有独立副本，浪费内存。因此，<strong>方法应定义在原型（prototype）上</strong>，通过原型链实现共享。</p>
<h4 data-id="heading-5">2.1 直接赋值原型的问题</h4>
<p>一种看似简单的继承方式是：</p>
<pre><code class="hljs language-ini" lang="ini">javascript
编辑
<span class="hljs-attr">Cat.prototype</span> = Animal.prototype<span class="hljs-comment">;</span>
</code></pre>
<p>但这会导致<strong>父子类共享同一个原型对象</strong>。一旦修改 <code>Cat.prototype</code>（如添加新方法），<code>Animal.prototype</code> 也会被污染：</p>
<pre><code class="hljs language-javascript" lang="javascript">javascript
编辑
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">meow</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Meow!'</span>); };
<span class="hljs-comment">// 此时 Animal.prototype 也拥有了 meow 方法！</span>
</code></pre>
<p>这显然违背了封装原则。</p>
<h4 data-id="heading-6">2.2 使用空对象作为中介（寄生组合式继承）</h4>
<p>为解决上述问题，业界普遍采用“<strong>中介空对象</strong>”模式（也称寄生组合式继承）：</p>
<pre><code class="hljs language-javascript" lang="javascript">javascript
编辑
<span class="hljs-keyword">function</span> <span class="hljs-title function_">extend</span>(<span class="hljs-params">Parent, Child</span>) {
  <span class="hljs-keyword">var</span> F = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};          <span class="hljs-comment">// 创建空构造函数</span>
  F.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Parent</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>; <span class="hljs-comment">// 将其原型指向父类原型</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>();      <span class="hljs-comment">// 子类原型 = 空函数实例</span>
  <span class="hljs-title class_">Child</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Child</span>; <span class="hljs-comment">// 修正 constructor 指向</span>
}
</code></pre>
<h5 data-id="heading-7">为什么有效？</h5>
<ul>
<li><code>F</code> 是一个空函数，其实例 <code>new F()</code> 几乎不携带额外属性。</li>
<li><code>new F()</code> 的 <code>__proto__</code> 指向 <code>Parent.prototype</code>，形成原型链。</li>
<li>修改 <code>Child.prototype</code> 不会影响 <code>Parent.prototype</code>，因为它们是<strong>不同的对象</strong>。</li>
</ul>
<p>最终原型链结构如下：</p>
<pre><code class="hljs language-javascript" lang="javascript">text
编辑
cat.<span class="hljs-property">__proto__</span> → <span class="hljs-keyword">new</span> <span class="hljs-title function_">F</span>() → <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> → <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>
</code></pre>
<hr/>
<h3 data-id="heading-8">三、完整继承示例分析</h3>
<p>结合上述技术，我们可以构建一个健壮的继承体系：</p>
<pre><code class="hljs language-ini" lang="ini">javascript
编辑
function Animal(name, age) {
  <span class="hljs-attr">this.name</span> = name<span class="hljs-comment">;</span>
  <span class="hljs-attr">this.age</span> = age<span class="hljs-comment">;</span>
}
<span class="hljs-attr">Animal.prototype.species</span> = <span class="hljs-string">'动物'</span><span class="hljs-comment">;</span>
<span class="hljs-attr">Animal.prototype.breathe</span> = function() { console.log(<span class="hljs-string">'呼吸'</span>)<span class="hljs-comment">; };</span>

function Cat(name, age, color) {
  Animal.apply(this, <span class="hljs-section">[name, age]</span>)<span class="hljs-comment">; // 构造函数继承属性</span>
  <span class="hljs-attr">this.color</span> = color<span class="hljs-comment">;</span>
}

// 原型继承方法
function extend(Parent, Child) {
  var <span class="hljs-attr">F</span> = function() {}<span class="hljs-comment">;</span>
  <span class="hljs-attr">F.prototype</span> = Parent.prototype<span class="hljs-comment">;</span>
  <span class="hljs-attr">Child.prototype</span> = new F()<span class="hljs-comment">;</span>
  <span class="hljs-attr">Child.prototype.constructor</span> = Child<span class="hljs-comment">;</span>
}
extend(Animal, Cat)<span class="hljs-comment">;</span>

// 扩展子类特有方法
<span class="hljs-attr">Cat.prototype.eat</span> = function() { console.log(<span class="hljs-string">"eat jerry"</span>)<span class="hljs-comment">; };</span>

const <span class="hljs-attr">cat</span> = new Cat(<span class="hljs-string">'加菲猫'</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'黄色'</span>)<span class="hljs-comment">;</span>
console.log(cat.species)<span class="hljs-comment">; // 动物（来自 Animal.prototype）</span>
cat.eat()<span class="hljs-comment">;                // eat jerry</span>
cat.breathe()<span class="hljs-comment">;            // 呼吸</span>
</code></pre>
<p>此模式实现了：</p>
<ul>
<li><strong>属性继承</strong>：通过 <code>apply/call</code> 复用父类构造逻辑；</li>
<li><strong>方法继承</strong>：通过中介原型链共享父类方法；</li>
<li><strong>隔离性</strong>：子类扩展不影响父类。</li>
</ul>
<hr/>
<h3 data-id="heading-9">四、动态语言特性：属性遮蔽（Shadowing）</h3>
<p>JavaScript 是动态语言，对象属性可在运行时修改。当实例属性与原型属性同名时，<strong>实例属性会“遮蔽”原型属性</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">javascript
编辑
<span class="hljs-keyword">function</span> <span class="hljs-title function_">Cat</span>(<span class="hljs-params"/>) {}
<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span> = <span class="hljs-string">'猫科动物'</span>;

<span class="hljs-keyword">const</span> cat = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cat</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">species</span>); <span class="hljs-comment">// 猫科动物</span>

cat.<span class="hljs-property">species</span> = <span class="hljs-string">'hello'</span>;    <span class="hljs-comment">// 在实例上创建新属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(cat.<span class="hljs-property">species</span>); <span class="hljs-comment">// hello</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Cat</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">species</span>); <span class="hljs-comment">// 仍是 猫科动物</span>
</code></pre>
<p>这体现了 JavaScript 的<strong>属性查找机制</strong>：先查自身，再沿原型链向上查找。</p>
<hr/>
<h3 data-id="heading-10">五、总结：JavaScript 继承的最佳实践</h3>
<p>尽管 ES6 引入了 <code>class</code> 语法糖，但其底层仍基于原型链。理解传统继承机制对掌握 JavaScript 本质至关重要。推荐使用以下组合模式：</p>
<ol>
<li><strong>构造函数继承属性</strong>：使用 <code>Parent.apply(this, arguments)</code>；</li>
<li><strong>原型继承方法</strong>：通过空函数中介实现 <code>Child.prototype = new F()</code>；</li>
<li><strong>修正 constructor</strong>：确保 <code>Child.prototype.constructor === Child</code>。</li>
</ol>
<p>这种“<strong>寄生组合式继承</strong>”兼顾效率与安全性，是 ES5 时代最成熟的继承方案。</p>
<p>随着现代开发转向 ES6+，我们虽可直接使用 <code>class extends</code>，但其背后仍是上述原理的封装。唯有深入理解原型、<code>this</code>、<code>call/apply</code> 及原型链，才能真正驾驭 JavaScript 的面向对象编程。</p>
<blockquote>
<p><strong>提示</strong>：在实际项目中，除非需要兼容老旧环境，否则建议优先使用 <code>class</code> 语法，它更简洁且不易出错。但面试或底层框架开发中，原型继承知识仍不可或缺。</p>
</blockquote>
<hr/>
<p>通过本文的系统梳理，相信你已对 JavaScript 原型继承机制有了更清晰的认识。掌握这些基础，将为你在前端工程化、框架原理理解乃至算法设计中打下坚实根基。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android协程底层原理]]></title>    <link>https://juejin.cn/post/7581292270961786890</link>    <guid>https://juejin.cn/post/7581292270961786890</guid>    <pubDate>2025-12-08T14:14:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581292270961786890" data-draft-id="7581359420391735323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android协程底层原理"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-08T14:14:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Poorguy9527"/> <meta itemprop="url" content="https://juejin.cn/user/1746465251931063"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android协程底层原理
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1746465251931063/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Poorguy9527
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:14:12.000Z" title="Mon Dec 08 2025 14:14:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>因为AI，所以deepseek</p>
</blockquote>
<p>来深入探讨一下 <strong>Kotlin 协程在 Android（或者说 JVM）上的底层实现原理</strong>。理解这个原理的关键在于明白：<strong>协程并不是一个 JVM 或操作系统级别的原生概念，而是完全通过 Kotlin 编译器和标准库在用户态实现的一套高级框架。</strong></p>
<p>它的核心可以概括为：<strong>编译时 CPS（续体传递风格）转换 + 运行时状态机 + 调度器</strong>。</p>
<h3 data-id="heading-0">1. 核心思想：从“挂起”和“恢复”说起</h3>
<p>协程的核心能力是  <strong>“挂起而不阻塞线程”</strong> 。</p>
<ul>
<li><strong>挂起</strong>：暂停当前协程的执行，释放它占用的线程资源，去做别的事情。</li>
<li><strong>恢复</strong>：在合适的时机，在相同或不同的线程上，从暂停的地方继续执行。</li>
</ul>
<p>为了实现这个，Kotlin 协程依赖三个基石：</p>
<ol>
<li><strong><code>suspend</code> 关键字</strong>：标记可挂起函数。</li>
<li><strong><code>Continuation</code>（续体）</strong> ：一个核心接口，代表“在某个挂起点之后需要继续执行的代码和状态”。它本质上是一个回调。</li>
<li><strong>编译器魔法</strong>：编译器将 <code>suspend</code> 函数转换为一个状态机。</li>
</ol>
<h3 data-id="heading-1">2. 编译器的工作：CPS 转换与状态机</h3>
<p>这是协程实现中最精妙的部分。编译器会重写你的 <code>suspend</code> 函数。</p>
<p><strong>a) 基础转换：添加 Continuation 参数</strong><br/>
一个普通的挂起函数：</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchUserData</span><span class="hljs-params">(userId: <span class="hljs-type">String</span>)</span></span>: UserData
</code></pre>
<p>在编译后，它的签名会变成类似这样（Java表示）：</p>
<p>java</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span> <span class="hljs-title function_">fetchUserData</span>(<span class="hljs-title class_">String</span> userId, <span class="hljs-title class_">Continuation</span>&lt;<span class="hljs-title class_">UserData</span>&gt; continuation)
</code></pre>
<ul>
<li>返回类型变成了 <code>Object</code>，用于返回一个特殊标记（如 <code>COROUTINE_SUSPENDED</code>）或直接的结果。</li>
<li>多了一个 <code>Continuation</code> 参数，用于传递回调。</li>
</ul>
<p><strong>b) 状态机生成</strong><br/>
对于一个包含多个挂起点（例如多个 <code>suspend</code> 函数调用）的 <code>suspend</code> 函数，编译器会将其转换成一个<strong>状态机</strong>。</p>
<p><strong>看一个例子：</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 源代码</span>
<span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAndCombineData</span><span class="hljs-params">()</span></span>: Result {
    <span class="hljs-keyword">val</span> data1 = fetchDataFromNetwork() <span class="hljs-comment">// 挂起点1</span>
    <span class="hljs-keyword">val</span> data2 = fetchDataFromDatabase() <span class="hljs-comment">// 挂起点2</span>
    <span class="hljs-keyword">return</span> combine(data1, data2)
}
</code></pre>
<p><strong>编译器会将其重写为类似以下伪代码的状态机：</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 伪代码，展示思想</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadAndCombineData</span><span class="hljs-params">(continuation: <span class="hljs-type">Continuation</span>&lt;<span class="hljs-type">Result</span>&gt;)</span></span>: Any? {
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoadAndCombineStateMachine</span>(
        completion: Continuation&lt;Result&gt;
    ) : CoroutineImpl(completion) {
        
        <span class="hljs-comment">// 状态机的局部变量</span>
        <span class="hljs-keyword">var</span> data1: Data? = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">var</span> data2: Data? = <span class="hljs-literal">null</span>
        
        <span class="hljs-comment">// 当前状态</span>
        <span class="hljs-keyword">var</span> label = <span class="hljs-number">0</span>
        
        <span class="hljs-comment">// 状态机的入口，会被多次调用以恢复执行</span>
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">invokeSuspend</span><span class="hljs-params">(result: <span class="hljs-type">Result</span>&lt;<span class="hljs-type">Any</span>?&gt;)</span></span>: Any? {
            <span class="hljs-keyword">when</span> (label) {
                <span class="hljs-number">0</span> -&gt; {
                    <span class="hljs-comment">// 第一次调用，状态0</span>
                    label = <span class="hljs-number">1</span>
                    <span class="hljs-comment">// 调用第一个挂起函数，传入 this（作为 Continuation）</span>
                    <span class="hljs-keyword">val</span> result = fetchDataFromNetwork(<span class="hljs-keyword">this</span>)
                    <span class="hljs-comment">// 如果返回了挂起标记，则“挂起”，将控制流返回给调用者</span>
                    <span class="hljs-keyword">if</span> (result == COROUTINE_SUSPENDED) <span class="hljs-keyword">return</span> COROUTINE_SUSPENDED
                    <span class="hljs-comment">// 如果直接返回结果，则“恢复”，继续执行状态1（模拟挂起恢复）</span>
                }
                <span class="hljs-number">1</span> -&gt; {
                    <span class="hljs-comment">// 恢复点1，拿到 fetchDataFromNetwork 的结果</span>
                    data1 = result <span class="hljs-keyword">as</span> Data
                    label = <span class="hljs-number">2</span>
                    <span class="hljs-comment">// 调用第二个挂起函数</span>
                    <span class="hljs-keyword">val</span> result = fetchDataFromDatabase(<span class="hljs-keyword">this</span>)
                    <span class="hljs-keyword">if</span> (result == COROUTINE_SUSPENDED) <span class="hljs-keyword">return</span> COROUTINE_SUSPENDED
                }
                <span class="hljs-number">2</span> -&gt; {
                    <span class="hljs-comment">// 恢复点2，拿到 fetchDataFromDatabase 的结果</span>
                    data2 = result <span class="hljs-keyword">as</span> Data
                    label = -<span class="hljs-number">1</span> <span class="hljs-comment">// 结束状态</span>
                    <span class="hljs-comment">// 执行最后逻辑并返回最终结果</span>
                    <span class="hljs-keyword">return</span> combine(data1!!, data2!!)
                }
                <span class="hljs-keyword">else</span> -&gt; <span class="hljs-keyword">throw</span> IllegalStateException()
            }
            <span class="hljs-comment">// 循环或递归调用以推进状态机（实际实现更高效，但逻辑如此）</span>
        }
    }
    <span class="hljs-comment">// ... 创建和启动状态机的逻辑</span>
}
</code></pre>
<p><strong>关键点：</strong></p>
<ul>
<li>编译器将函数体拆分到 <strong><code>label</code> 标记的不同分支</strong>，每个挂起点对应一个 <code>label</code>。</li>
<li>局部变量（<code>data1</code>, <code>data2</code>）被提升为<strong>状态机类的成员变量</strong>，以便在挂起后能够保持。</li>
<li>每次调用（或恢复）时，检查 <code>label</code>，跳转到对应代码块执行。</li>
<li>当调用另一个 <code>suspend</code> 函数时，会传入当前的 <code>Continuation</code>（即这个状态机实例）。</li>
<li>如果被调用的 <code>suspend</code> 函数需要挂起，它会返回 <code>COROUTINE_SUSPENDED</code>，然后这个函数也返回 <code>COROUTINE_SUSPENDED</code>，协程框架就知道此协程已被挂起。</li>
<li>当异步操作完成时，会调用 <code>Continuation.resumeWith(result)</code>，这本质上就是<strong>回调</strong>，它会重新触发 <code>invokeSuspend</code>，并根据之前保存的 <code>label</code> 跳到正确的位置，并携带结果 (<code>result</code>)，继续执行。</li>
</ul>
<h3 data-id="heading-2">3. 运行时：协程的构建、调度与执行</h3>
<p>编译器创建了状态机和 <code>Continuation</code>，而 <code>kotlinx.coroutines</code> 库提供了运行时的骨架。</p>
<p><strong>a) 协程构建器（<code>launch</code>, <code>async</code> 等）</strong><br/>
当你调用 <code>launch { ... }</code> 时，它会做几件事：</p>
<ol>
<li>创建一个新的协程实例，它是一个 <code>Continuation</code>。</li>
<li>为新协程提供<strong>上下文</strong>（<code>CoroutineContext</code>），最重要的部分是 <strong><code>CoroutineDispatcher</code>（调度器）</strong>  和 <strong><code>Job</code></strong>。</li>
<li>最终，会调用 <code>CoroutineStart.invoke</code> 来启动协程，最终会调用到你的挂起lambda的 <code>Continuation.resumeWith</code>。</li>
</ol>
<p><strong>b) 调度器（<code>Dispatchers</code>）</strong></p>
<ul>
<li><code>Dispatchers.Main</code>：在 Android 主线程（UI线程）上执行。Android 上是通过 <code>Handler.post</code> 实现的。</li>
<li><code>Dispatchers.Default</code>：用于 CPU 密集型任务，是一个共享的线程池。</li>
<li><code>Dispatchers.IO</code>：用于 IO 密集型任务，有更大的线程池。</li>
<li><code>Dispatchers.Unconfined</code>：立即在当前线程执行，直到第一个挂起点。</li>
</ul>
<p>调度器的核心作用：决定在哪个或哪些线程上执行协程的代码块和恢复协程。当协程从挂起中恢复时，<strong>恢复点（即 <code>Continuation.resumeWith</code>）的代码会在调度器指定的线程上执行</strong>。</p>
<p><strong>c) 挂起函数（如 <code>delay</code>, <code>withContext</code>, <code>suspendCoroutine</code>）</strong><br/>
这些库函数是真正触发挂起和恢复的地方。以 <code>suspendCoroutine</code> 为例：</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">suspend</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">suspendCoroutine</span><span class="hljs-params">(block: (<span class="hljs-type">Continuation</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span>: T
</code></pre>
<p>它在内部挂起当前协程，并给你一个 <code>Continuation</code> 对象。你可以在你的异步回调中，手动调用 <code>continuation.resume(value)</code> 或 <code>continuation.resumeWithException(e)</code> 来<strong>恢复</strong>协程。这是连接传统回调API和协程世界的桥梁。</p>
<h3 data-id="heading-3">4. Android 上的特殊考量</h3>
<ol>
<li><strong>主线程安全</strong>：<code>Dispatchers.Main</code> 是 Android 应用开发的核心。协程通过它确保了 <code>launch(Dispatchers.Main) { ... }</code> 内部的代码始终在主线程执行，即使恢复点来自后台线程的回调。这极大地简化了 UI 更新。</li>
<li><strong>生命周期集成</strong>：<code>lifecycleScope</code> 和 <code>viewModelScope</code> 是 Android 独有的扩展。它们本质上是绑定了 <code>Lifecycle</code> 或 <code>ViewModel</code> 生命周期的 <code>CoroutineScope</code>。当 <code>Activity</code> 销毁或 <code>ViewModel</code> 清理时，它们会自动取消其作用域内启动的所有协程，避免了内存泄漏。这通过在作用域的 <code>CoroutineContext</code> 中绑定一个特殊的 <code>Job</code> 来实现，该 <code>Job</code> 在生命周期结束时被取消。</li>
<li><strong>性能与轻量</strong>：协程的挂起是用户态的切换，不涉及线程的阻塞和操作系统内核调度。在 Android 上，创建成千上万个协程是可行的，而创建同样数量的线程则会耗尽资源。这对于处理大量并发 IO 操作（如网络请求、数据库查询）特别有利。</li>
</ol>
<h3 data-id="heading-4">总结流程图</h3>
<p>text</p>
<pre><code class="hljs language-rust" lang="rust">[你的 suspend 函数代码]
          |
          <span class="hljs-title function_ invoke__">v</span> (编译时)
[状态机类 + Continuation] (每个 suspend 函数被编译成一个状态机)
          |
          <span class="hljs-title function_ invoke__">v</span> (运行时，通过 launch 启动)
[CoroutineScope.launch] <span class="hljs-punctuation">-&gt;</span> 创建协程实例（也是一个Continuation） <span class="hljs-punctuation">-&gt;</span> 交给调度器(Dispatcher)
          |
          v
调度器决定在哪个线程执行 <span class="hljs-punctuation">-&gt;</span> 调用 `continuation.resumeWith` <span class="hljs-punctuation">-&gt;</span> 进入状态机执行
          |
          v
遇到另一个 suspend 调用（如 `delay`）<span class="hljs-punctuation">-&gt;</span> 返回 `COROUTINE_SUSPENDED` <span class="hljs-punctuation">-&gt;</span> 协程挂起，线程被释放
          |
          <span class="hljs-title function_ invoke__">v</span> (一段时间后，可能是其他线程)
`delay` 的内部机制完成 <span class="hljs-punctuation">-&gt;</span> 调用之前保存的 `Continuation.resumeWith` <span class="hljs-punctuation">-&gt;</span> 通知调度器
          |
          v
调度器安排线程（如主线程） <span class="hljs-punctuation">-&gt;</span> 再次调用状态机的 `invokeSuspend` <span class="hljs-punctuation">-&gt;</span> 根据 label 跳转，恢复执行
          |
          v
直到状态机运行到结束 label <span class="hljs-punctuation">-&gt;</span> 返回最终结果 <span class="hljs-punctuation">-&gt;</span> 可能恢复其父 Continuation（如果存在）
</code></pre>
<p>简单来说，<strong>Kotlin 协程是编译器通过 CPS 转换生成状态机，结合运行时库提供的调度器和构建器，模拟出的、更轻量、更易用的异步编程模型。它在 Android 上通过与主线程 <code>Handler</code> 和生命周期组件的深度集成，成为了解决异步处理和线程切换问题的最佳实践。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[自研2025版flutter3.38实战抖音app短视频+聊天+直播商城系统]]></title>    <link>https://juejin.cn/post/7581348660823703552</link>    <guid>https://juejin.cn/post/7581348660823703552</guid>    <pubDate>2025-12-08T15:22:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581348660823703552" data-draft-id="7581354812860678196" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="自研2025版flutter3.38实战抖音app短视频+聊天+直播商城系统"/> <meta itemprop="keywords" content="Flutter,Dart,Android"/> <meta itemprop="datePublished" content="2025-12-08T15:22:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="xiaoyan2015"/> <meta itemprop="url" content="https://juejin.cn/user/4230576475215165"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            自研2025版flutter3.38实战抖音app短视频+聊天+直播商城系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4230576475215165/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    xiaoyan2015
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:22:46.000Z" title="Mon Dec 08 2025 15:22:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>经过半个月高强度研发，最新款<code>Flutter3.38+Dart3.10</code>打造<strong>短视频+直播+聊天</strong>应用，正式完结了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33a2df41474549249f86a0a307541cbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=kK%2Bi0kAetQF0IHhLRnbSE%2FoXekw%3D" alt="未标题-aa.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1a59b15b7ca4bf0b4d02242b5dc35ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=Hz0YvdWZuhOEdHS23MiPyUcNOL4%3D" alt="未标题-3.png" loading="lazy"/></p>
<h2 data-id="heading-0">运用技术</h2>
<ul>
<li>编码工具：VScode</li>
<li>跨平台框架：Flutter3.38.2+Dart3.10.0</li>
<li>状态管理：get: ^4.7.3</li>
<li>缓存服务：get_storage: ^2.1.1</li>
<li>瀑布流组件：flutter_staggered_grid_view^0.7.0</li>
<li>轮播图组件：card_swiper^3.0.1</li>
<li>toast弹窗组件：shirne_dialog^4.8.6</li>
<li>视频套件：media_kit: ^1.2.3</li>
<li>svg图片：flutter_svg: ^2.2.3</li>
<li>缓存图片：cached_network_image: ^3.4.1</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fead756efef646e28f8f67a12f3c05d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=BbqPDxNoR4Cf4SkifcgmN%2FJLjQA%3D" alt="z1.gif" loading="lazy"/></p>
<p>flutter3实现一个类似抖音app首页<strong>上下左右联动</strong>效果。上下滚动切换短视频、左右滚动切换页面模块。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3e631e75b6c64620bd002446beb7861e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=T9GxpyN0GP2bQ0ewcRSHeMK4%2BEw%3D" alt="z2.gif" loading="lazy"/></p>
<p>直播页面实现<strong>右侧滑入直播进场/左侧滑入礼物提示动效、商品列表、礼物、商品讲解、弹幕消息</strong>等功能。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53622ab0200e4babb10be23918458ed4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=iPuPeyBko5z3sSYZT7o%2BPQNG4T8%3D" alt="z3.gif" loading="lazy"/></p>
<h2 data-id="heading-1">项目结构目录</h2>
<p>flutter3-douyin使用最新跨平台框架<code>flutter3.38.2</code>构建项目模板。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac69dc54c86d4984bb9104a626bd3cf8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=XFr7hrVuwdS6DaO4rj%2FdSgq6X9E%3D" alt="360截图20251202112944055.png" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1RG2eBNEwM%2F" target="_blank" title="https://www.bilibili.com/video/BV1RG2eBNEwM/" ref="nofollow noopener noreferrer">『flutter3.38抖音app』短视频+聊天+直播入场-礼物侧边滑进动效 - bilibili</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/542b147f1f674441afc0e55822594d04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=0n%2B7JRZNqtK5NkEmlrhS67qInyE%3D" alt="未标题-3_1.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66835c5d09814529a34d9c39d5a35e72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=FnxE2GQzRD%2BM0%2Bu6PKBrtbwC3o4%3D" alt="未标题-4.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93bf310bde2d4754ba18b4db1501289b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=D30EJRAftW64Q8MfGj2OS1o%2F1XE%3D" alt="未标题-7.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fefc84ffad804effa773a4a13a87dfc8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=9HDG3D423BuilDswwudxccqegK4%3D" alt="未标题-8.png" loading="lazy"/></p>
<h2 data-id="heading-2">项目入口配置</h2>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/foundation.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:get/get.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:get_storage/get_storage.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:media_kit/media_kit.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:shirne_dialog/shirne_dialog.dart'</span>;

<span class="hljs-keyword">import</span> <span class="hljs-string">'utils/common.dart'</span>;

<span class="hljs-comment">// 引入布局页面</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'layouts/index.dart'</span>;

<span class="hljs-comment">// 引入路由配置</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'router/index.dart'</span>;

<span class="hljs-keyword">void</span> main() <span class="hljs-keyword">async</span> {
  <span class="hljs-comment">// 初始化get_storage存储</span>
  <span class="hljs-keyword">await</span> GetStorage.init();

  <span class="hljs-comment">// 初始化media_kit视频套件</span>
  WidgetsFlutterBinding.ensureInitialized();
  MediaKit.ensureInitialized();

  runApp(<span class="hljs-keyword">const</span> MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> MyApp({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-comment">// 是否windows平台</span>
    <span class="hljs-built_in">bool</span> isWindows() {
      <span class="hljs-keyword">if</span> (kIsWeb) <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
      
      <span class="hljs-keyword">final</span> platform = Theme.of(context).platform;
      <span class="hljs-keyword">return</span> platform == TargetPlatform.windows;
    }

    <span class="hljs-keyword">return</span> GetMaterialApp(
      title: <span class="hljs-string">'Flutter3 DYMALL'</span>,
      debugShowCheckedModeBanner: <span class="hljs-keyword">false</span>,
      theme: ThemeData(
        colorScheme: ColorScheme.fromSeed(seedColor: <span class="hljs-keyword">const</span> Color(<span class="hljs-number">0xFFFF2C55</span>)),
        useMaterial3: <span class="hljs-keyword">true</span>,
        <span class="hljs-comment">// 修复windows下字体不一致情况 - Web 平台特殊处理</span>
        <span class="hljs-comment">// fontFamily: Platform.isWindows ? 'Microsoft YaHei' : null</span>
        fontFamily: isWindows() ? <span class="hljs-string">'Microsoft YaHei'</span> : <span class="hljs-keyword">null</span>
      ),
      home: <span class="hljs-keyword">const</span> Layout(),
      <span class="hljs-comment">// 初始化路由</span>
      initialRoute: Common.isLogin() ? <span class="hljs-string">'/'</span> : <span class="hljs-string">'/login'</span>,
      <span class="hljs-comment">// 路由页面</span>
      getPages: routePages,
      <span class="hljs-comment">// 初始化弹窗key</span>
      navigatorKey: MyDialog.navigatorKey,
    );
  }
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf9081c4de60472aaf4c26e4994944e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=l4xql32hDSPx9%2Fq5O8gURbiSrus%3D" alt="未标题-9.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b707291803844acb6df733d71e757bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=KsjWMh2u%2F3NTsD%2B6EII4heiCAIA%3D" alt="未标题-12.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9f3780db97740438fbbc455fce592d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=6uAj5fQBPLBl%2FFA3MLhHFaSlzbI%3D" alt="未标题-13.png" loading="lazy"/></p>
<h2 data-id="heading-3">flutter3自定义抖音app首页模块联动</h2>
<p>如下图：实现一个类似抖音app首页左右切换页面，上下切换短视频效果。且<strong>顶部状态栏+Tab菜单+底部导航栏</strong>一起联动效果。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/557a3c1e2e1c424693a5bb5b69219317~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=lWgH0sZWL21lCy4aJgyH7D6VNys%3D" alt="p4-3.gif" loading="lazy"/></p>
<p>各个tab页面模板</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77a27d7f09bc4fd1a572d83f232b9393~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=M9l7PC6AwLmZ6qHw4WdDjUe6FrQ%3D" alt="f6d5d9016b765c8e3927602608ae7693_1289798-20251205232946737-697311119.png" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Scaffold(
    key: scaffoldKey,
    extendBodyBehindAppBar: <span class="hljs-keyword">true</span>,
    appBar: AppBar(
      forceMaterialTransparency: <span class="hljs-keyword">true</span>,
      backgroundColor: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>].contains(videoModuleController.videoTabIndex.value) ? <span class="hljs-keyword">null</span> : Colors.transparent,
      foregroundColor: [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>].contains(videoModuleController.videoTabIndex.value) ? Colors.black : Colors.white,
      titleSpacing: <span class="hljs-number">1.0</span>,
      leading: Obx(() =&gt; IconButton(
        icon: Badge.count(
          backgroundColor: Colors.red,
          count: <span class="hljs-number">6</span>,
          child: Icon(Icons.sort_rounded, color: tabColor(),),
        ),
        onPressed: () {
          <span class="hljs-comment">// 自定义打开右侧drawer</span>
          scaffoldKey.currentState?.openDrawer();
        },
      )),
      title: Obx(() {
        <span class="hljs-keyword">return</span> ScrollConfiguration(
          behavior: CustomScrollBehavior().copyWith(scrollbars: <span class="hljs-keyword">false</span>),
          child: TabBar(
            ...
          ),
        );
      }),
      actions: [
        Obx(() =&gt; IconButton(icon: Icon(Icons.search_rounded, color: tabColor(),), onPressed: () {},),),
      ],
    ),
    body: ScrollConfiguration(
      behavior: CustomScrollBehavior().copyWith(scrollbars: <span class="hljs-keyword">false</span>),
      child: PageView(
        controller: pageController,
        onPageChanged: (index) {
          videoModuleController.updateVideoTabIndex(index);
          setState(() {
            tabController.animateTo(index, duration: <span class="hljs-built_in">Duration</span>(milliseconds: <span class="hljs-number">200</span>), curve: Curves.easeInOut);
          });
        },
        children: [
          ...tabModules
        ],
      ),
    ),
    <span class="hljs-comment">// 侧边栏</span>
    drawer: Drawer(
      shape: RoundedRectangleBorder(borderRadius: BorderRadius.horizontal(right: Radius.circular(<span class="hljs-number">15.0</span>))),
      clipBehavior: Clip.antiAlias,
      width: <span class="hljs-number">300</span>,
      child: Container(
        ...
      ),
    ),
  );
}
</code></pre>
<p>左右切换长列表页面，保持切换Tab使得页面<strong>滚动状态保持不变</strong>，页面<strong>开启缓存</strong>功能。</p>
<pre><code class="hljs language-dart" lang="dart">GlobalKey&lt;ScaffoldState&gt; scaffoldKey = GlobalKey();

VideoModuleController videoModuleController = Get.put(VideoModuleController());

<span class="hljs-keyword">late</span> TabController tabController = TabController(initialIndex: videoModuleController.videoTabIndex.value, length: tabList.length, vsync: <span class="hljs-keyword">this</span>);
<span class="hljs-keyword">late</span> PageController pageController = PageController(initialPage: videoModuleController.videoTabIndex.value, viewportFraction: <span class="hljs-number">1.0</span>);

<span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">String</span>&gt; tabList = [<span class="hljs-string">'订阅'</span>, <span class="hljs-string">'逛逛'</span>, <span class="hljs-string">'直播'</span>, <span class="hljs-string">'团购'</span>, <span class="hljs-string">'短剧'</span>, <span class="hljs-string">'关注'</span>, <span class="hljs-string">'同城'</span>, <span class="hljs-string">'精选'</span>];
<span class="hljs-keyword">final</span> tabModules = [
  KeepAliveWrapper(child: SubscribeModule()),
  KeepAliveWrapper(child: BrowseModule()),
  KeepAliveWrapper(child: LiveModule()),
  KeepAliveWrapper(child: BuyingModule()),
  KeepAliveWrapper(child: DramaModule()),
  AttentionModule(),
  LocalModule(),
  RecommendModule()
];
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7011efdf148f49f9b64d4ca6192cd685~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=xbtsc96tWe8VlRzyEgLLTTHik0o%3D" alt="cdef5921126a2ab06d2782024b2f43b1_1289798-20251205232839995-542313656.png" loading="lazy"/></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">KeepAliveWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">final</span> Widget child;
  <span class="hljs-keyword">const</span> KeepAliveWrapper({<span class="hljs-keyword">super</span>.key, <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.child});

  <span class="hljs-meta">@override</span>
  State&lt;KeepAliveWrapper&gt; createState() =&gt; _KeepAliveWrapperState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_KeepAliveWrapperState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">KeepAliveWrapper</span>&gt; <span class="hljs-title">with</span> <span class="hljs-title">AutomaticKeepAliveClientMixin</span> </span>{
  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">super</span>.build(context);
    <span class="hljs-keyword">return</span> widget.child;
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-built_in">bool</span> <span class="hljs-keyword">get</span> wantKeepAlive =&gt; <span class="hljs-keyword">true</span>;
}
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c860b19435c94a7688b3715746717cef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=Qup%2FoFObq3ruVkYTv7SBtmlOITU%3D" alt="001360截图20251130234546042.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d128c90551d14882bf2c2a694343e7b6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=TnAjNK55K8J9NPuwNZgGi9jHjjw%3D" alt="002360截图20251201001241922.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe54bdc86e2743b7a1664649396abd2e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=gbV60fUCET%2F8YbOeuz37%2B1N0ZD0%3D" alt="003360截图20251201001409147.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e9cb0309749d491c985326ff4b70d1d0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=tW4lyUruj0GwUlQBLZd8gFEfcJI%3D" alt="003360截图20251201001640713.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1891afa2714b4fddb29174b2e7b2bb99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=jhCGUkMUrjVmu7iFvtQaS6i9a5Y%3D" alt="004360截图20251201001951040.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df2244749d984e8da343d46aee1def9f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=uoGck%2Bzb4JDC5ejMT6E6MxvxzGw%3D" alt="004360截图20251201002509643.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7da83399e414d6b97b3ce10fdabe771~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=MFKREkvVorIi9%2FT5GENV%2BdK1afQ%3D" alt="004360截图20251201003006451.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b5709cbb7b24c1d955c1e75cb2853c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=nM9N9I706v2JvRBsFK99OoQ5EpI%3D" alt="004360截图20251201005209179.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/78fe644b79da414fb0c337c29e07062b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=ATYtNpibmWwNbiBTWqZhW31tTTc%3D" alt="004360截图20251201005321817.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/556c2f7a85cc4445ae2cd723a85d4a61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=cfZtH3dWsOspEZnstJFdB0AZ1%2FY%3D" alt="005360截图20251201074639885.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e65ba80eb484bf68572083b65ace463~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=%2FtCPUSRci%2B7QpKq3wTurKgO2d0Y%3D" alt="005360截图20251201074737013.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/29aff8fa4c4d4c08a0becc8d3c242dea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=AyB5dEs2kSL12duYEDUYNF0eAfU%3D" alt="005360截图20251201075250762.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea3726075c294750a246cbac24330eb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=ViGgytNoJLCcFPUn6h3w3evH1Ew%3D" alt="005360截图20251202095434004.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19d41f8857f64e8e87d215f628365693~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=kbkQUao%2B8BKBwpMJ8KaOKfsUnqc%3D" alt="005360截图20251202095434007.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2617be2c32f42d0874493aebbe4ef5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=FMup4x3uf%2FYWp5iIl3GCKdFtIC4%3D" alt="005360截图20251202102655543.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/618bdb5e422c4421a12b17fae38a4fcb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=vlx0o%2FzYSxgit9ots4PsDisL%2BhM%3D" alt="005360截图20251202102949864.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fc5cb74e6aa421587578e9ab9e7a0a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=H12Gs67erEI2cjAakEjfFtnXF2Y%3D" alt="006360截图20251202103841262.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21668cd41ea9430590d14525884c576d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=ipiHN5mz%2Faicv334pFxogC4rzgs%3D" alt="006360截图20251202104321022.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f41b89046e343ccb4d3037aa5253b0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=cfSZ3UMRv%2BHg8%2FpI5jvXVaoQyes%3D" alt="006360截图20251202104919246.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/569bc0b9b9724084af488f7577f2e310~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=Ivx7SmC6C1XNXCsUyT%2FEfy9RplA%3D" alt="006360截图20251202105314112.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d882bf8d47b44ddba9598c0bab43fb19~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=WoKu1tlYgeX5ppNJgKuPwcI1cjw%3D" alt="006360截图20251202105524264.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/16e9b80e55c749d6b1e9bf97aa1aa150~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=OoS2SoDX%2BPVoFCmO4D%2FLYlBd3b4%3D" alt="006360截图20251202105541335.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2674825944154c64a20d8046e15a7a75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=RDKH0EYxglqjouxpqszIphyGmcs%3D" alt="007360截图20251202105955398.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4f96c042afc4af495d9299ec01f169d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=8icumA8chV3qD53hA7xVO8pYIVU%3D" alt="008360截图20251202110048233.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a697556fb94438dbe1be46cf6a1c2f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=i5LUS0FM5GqEJp%2Bc%2FYnFMQ%2ByFA0%3D" alt="008360截图20251202110222359.png" loading="lazy"/></p>
<h2 data-id="heading-4">flutter3实现短视频功能</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97c2cc0038694b35a0f94f7d7ee0d836~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeGlhb3lhbjIwMTU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765812166&amp;x-signature=WOMELYRqxMZ4Qykv5G4HE9NfH9o%3D" alt="004360截图20251201002757876.png" loading="lazy"/></p>
<p>如上图：tab菜单悬浮在短视频页面上，短视频页面采用全屏沉浸式并延伸到状态栏。</p>
<p>底部播放进度条支持<strong>拖拽、点击、显示视频时长</strong>。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-meta">@override</span>
Widget build(BuildContext context) {
  <span class="hljs-keyword">return</span> Container(
    color: Colors.black,
    child: Column(
      children: [
        Expanded(
          child: Stack(
            children: [
              PageView.builder(
                scrollDirection: Axis.vertical,
                controller: pageController,
                onPageChanged: (index) <span class="hljs-keyword">async</span> {
                  <span class="hljs-comment">// ...</span>
                },
                itemCount: videoList.length,
                itemBuilder: (context, index) {
                  <span class="hljs-keyword">return</span> Stack(
                    children: [
                      <span class="hljs-comment">// 视频区域</span>
                      Positioned(
                        top: <span class="hljs-number">0</span>,
                        left: <span class="hljs-number">0</span>,
                        right: <span class="hljs-number">0</span>,
                        bottom: <span class="hljs-number">0</span>,
                        child: GestureDetector(
                          child: Stack(
                            children: [
                              <span class="hljs-comment">// 短视频插件</span>
                              Visibility(
                                visible: videoModuleController.videoPlayIndex.value == index &amp;&amp; position &gt; <span class="hljs-built_in">Duration</span>.zero,
                                child: Video(
                                  controller: videoController,
                                  fit: BoxFit.cover,
                                ),
                              ),
                              <span class="hljs-comment">// 播放/暂停按钮</span>
                              StreamBuilder(
                                stream: player.stream.playing,
                                builder: (context, playing) {
                                  <span class="hljs-keyword">return</span> Visibility(
                                    visible: playing.data == <span class="hljs-keyword">false</span>,
                                    child: Center(
                                      child: IconButton(
                                        padding: EdgeInsets.zero,
                                        onPressed: () {
                                          player.playOrPause();
                                        },
                                        icon: Icon(
                                          playing.data == <span class="hljs-keyword">true</span> ? Icons.pause : Icons.play_arrow_rounded,
                                          color: Colors.white60,
                                          size: <span class="hljs-number">80</span>,
                                        ),
                                        style: ButtonStyle(
                                          backgroundColor: WidgetStateProperty.all(Colors.black.withAlpha(<span class="hljs-number">15</span>))
                                        ),
                                      ),
                                    ),
                                  );
                                },
                              ),
                            ],
                          ),
                          onTap: () {
                            player.playOrPause();
                          },
                        ),
                      ),
                      <span class="hljs-comment">// 右侧操作栏</span>
                      Positioned(
                        bottom: <span class="hljs-number">15.0</span>,
                        right: <span class="hljs-number">6.0</span>,
                        child: Column(
                          spacing: <span class="hljs-number">15.0</span>,
                          children: [
                            ...
                          ],
                        ),
                      ),
                      <span class="hljs-comment">// 底部信息区域</span>
                      Positioned(
                        bottom: <span class="hljs-number">15.0</span>,
                        left: <span class="hljs-number">10.0</span>,
                        right: <span class="hljs-number">80.0</span>,
                        child: Column(
                          ...
                        ),
                      ),
                      <span class="hljs-comment">// mini播放进度条</span>
                      Positioned(
                        bottom: <span class="hljs-number">0.0</span>,
                        left: <span class="hljs-number">6.0</span>,
                        right: <span class="hljs-number">6.0</span>,
                        child: Visibility(
                          visible: videoModuleController.videoPlayIndex.value == index &amp;&amp; position &gt; <span class="hljs-built_in">Duration</span>.zero,
                          child: Listener(
                            child: SliderTheme(
                              data: SliderThemeData(
                                trackHeight: sliderDraging ? <span class="hljs-number">6.0</span> : <span class="hljs-number">2.0</span>,
                                thumbShape: RoundSliderThumbShape(enabledThumbRadius: <span class="hljs-number">4.0</span>), <span class="hljs-comment">// 调整滑块的大小</span>
                                overlayShape: RoundSliderOverlayShape(overlayRadius: <span class="hljs-number">0</span>), <span class="hljs-comment">// 去掉Slider默认上下边距间隙</span>
                                inactiveTrackColor: Colors.white24, <span class="hljs-comment">// 设置非活动进度条的颜色</span>
                                activeTrackColor: Colors.white, <span class="hljs-comment">// 设置活动进度条的颜色</span>
                                thumbColor: Colors.white, <span class="hljs-comment">// 设置滑块的颜色</span>
                                overlayColor: Colors.transparent, <span class="hljs-comment">// 设置滑块覆盖层的颜色</span>
                              ),
                              child: Slider(
                                value: sliderValue,
                                onChanged: (value) <span class="hljs-keyword">async</span> {
                                  <span class="hljs-comment">// debugPrint('当前视频播放时间$value');</span>
                                  setState(() {
                                    sliderValue = value;
                                  });
                                  <span class="hljs-comment">// 跳转播放时间</span>
                                  <span class="hljs-keyword">await</span> player.seek(duration * value.clamp(<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>));
                                },
                                onChangeEnd: (value) <span class="hljs-keyword">async</span> {
                                  setState(() {
                                    sliderDraging = <span class="hljs-keyword">false</span>;
                                  });
                                  <span class="hljs-comment">// 继续播放</span>
                                  <span class="hljs-keyword">if</span>(!player.state.playing) {
                                    <span class="hljs-keyword">await</span> player.play();
                                  }
                                },
                              ),
                            ),
                            onPointerMove: (e) {
                              setState(() {
                                sliderDraging = <span class="hljs-keyword">true</span>;
                              });
                            },
                          ),
                        ),
                      ),
                      <span class="hljs-comment">// 播放位置指示器</span>
                      Positioned(
                        bottom: <span class="hljs-number">100.0</span>,
                        left: <span class="hljs-number">10.0</span>,
                        right: <span class="hljs-number">10.0</span>,
                        child: Visibility(
                          visible: sliderDraging,
                          child: DefaultTextStyle(
                            style: TextStyle(color: Colors.white54, fontSize: <span class="hljs-number">18.0</span>, fontFamily: <span class="hljs-string">'Arial'</span>),
                            child: Row(
                              mainAxisAlignment: MainAxisAlignment.center,
                              spacing: <span class="hljs-number">8.0</span>,
                              children: [
                                Text(position.label(reference: duration), style: TextStyle(color: Colors.white)),
                                Text(<span class="hljs-string">'/'</span>, style: TextStyle(fontSize: <span class="hljs-number">14.0</span>)),
                                Text(duration.label(reference: duration)),
                              ],
                            ),
                          )
                        ),
                      ),
                    ],
                  );
                },
              ),
              <span class="hljs-comment">/// <span class="markdown">固定层</span></span>
              <span class="hljs-comment">// 红包广告</span>
              Ads(),
            ],
          ),
        ),
      ],
    ),
  );
}
</code></pre>
<p>综上就是flutter3.38仿写抖音app的一些知识分享，整个项目包含了短视频+直播+聊天功能模块，运用到的知识点还是非常多的，希望对大家有所帮助哈！</p>
<p><a href="https://juejin.cn/post/7560576454849757220" target="_blank" title="https://juejin.cn/post/7560576454849757220">electron38.2-vue3os系统|Vite7+Electron38+Pinia3+ArcoDesign桌面版OS管理系统</a></p>
<p><a href="https://juejin.cn/post/7550160737244708898" target="_blank" title="https://juejin.cn/post/7550160737244708898">基于electron38+vite7+vue3 setup+elementPlus电脑端仿微信/QQ聊天软件</a></p>
<p><a href="https://juejin.cn/post/7555690975866044431" target="_blank" title="https://juejin.cn/post/7555690975866044431">2025最新款Electron38+Vite7+Vue3+ElementPlus电脑端后台admin系统</a></p>
<p><a href="https://juejin.cn/post/7574357603406217266" target="_blank" title="https://juejin.cn/post/7574357603406217266">2025原创研发Tauri2.9+Vite7.2+Vue3+ArcoDesign客户端OS管理系统Exe</a></p>
<p><a href="https://juejin.cn/post/7565043957638938675" target="_blank" title="https://juejin.cn/post/7565043957638938675">2025最新版Tauri2.8+Vite7.1+Vue3+ElementPlus客户端聊天软件Exe</a></p>
<p><a href="https://juejin.cn/post/7567181492067696655" target="_blank" title="https://juejin.cn/post/7567181492067696655">最新自创Tauri2.9+Vite7.1+Vue3+ElementPlus桌面端通用后台系统管理Exe模板</a></p>
<p><a href="https://juejin.cn/post/7534184729319440419" target="_blank" title="https://juejin.cn/post/7534184729319440419">基于flutter3.32+window_manager仿macOS/Wins风格桌面os系统</a></p>
<p><a href="https://juejin.cn/post/7529357546844504100" target="_blank" title="https://juejin.cn/post/7529357546844504100">flutter3.27+bitsdojo_window电脑端仿微信Exe应用</a></p>
<p><a href="https://juejin.cn/post/7552733801081749513" target="_blank" title="https://juejin.cn/post/7552733801081749513">最新版Vite7+Vue3+Pinia3+ArcoDesign网页版webos后台管理系统</a></p>
<p><a href="https://juejin.cn/post/7522315126492512283" target="_blank" title="https://juejin.cn/post/7522315126492512283">基于uniapp+vue3+uvue仿抖音app短视频+聊天+直播app系统</a></p>
<p><a href="https://juejin.cn/post/7501149179563376680" target="_blank" title="https://juejin.cn/post/7501149179563376680">基于uniapp+vue3+deepseek+markdown搭建app版流式输出AI模板</a></p>
<p><a href="https://juejin.cn/post/7486369696738017321" target="_blank" title="https://juejin.cn/post/7486369696738017321">vue3.5+deepseek+arco+markdown搭建web版流式输出AI模板</a></p>
<p><a href="https://juejin.cn/post/7542505547669995555" target="_blank" title="https://juejin.cn/post/7542505547669995555">unios-admin手机版后台|uniapp+vue3全端admin管理系统</a></p>
<p><a href="https://juejin.cn/post/7537106747279065134" target="_blank" title="https://juejin.cn/post/7537106747279065134">基于uni-app+vue3+uvui跨三端仿微信app聊天模板</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[人工智能之数据分析 Pandas：第八章 数据可视化]]></title>    <link>https://juejin.cn/post/7581406561684930606</link>    <guid>https://juejin.cn/post/7581406561684930606</guid>    <pubDate>2025-12-08T12:02:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581406561684930606" data-draft-id="7581251003330265114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="人工智能之数据分析 Pandas：第八章 数据可视化"/> <meta itemprop="keywords" content="pandas,人工智能,数据分析"/> <meta itemprop="datePublished" content="2025-12-08T12:02:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="咚咚王"/> <meta itemprop="url" content="https://juejin.cn/user/957022447869753"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            人工智能之数据分析 Pandas：第八章 数据可视化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/957022447869753/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    咚咚王
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:02:09.000Z" title="Mon Dec 08 2025 12:02:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">人工智能之数据分析 Pandas</h2>
<p>第八章  数据可视化</p>
<hr/>
<h2 data-id="heading-1">前言</h2>
<p>本文将从 <strong>基础绘图方法、常用图表类型、高级定制、与专业库对比</strong> 四个维度，<strong>系统、详细、实战化</strong>地介绍 Pandas 数据可视化的完整能力。</p>
<hr/>
<h2 data-id="heading-2">📈 一、Pandas 可视化基础</h2>
<h3 data-id="heading-3">1. 核心原理</h3>
<ul>
<li>Pandas 的 <code>.plot()</code> 是 <strong>Matplotlib 的封装</strong>，返回 <code>matplotlib.axes.Axes</code> 对象</li>
<li>所有 DataFrame/Series 都可直接调用 <code>.plot()</code></li>
<li>语法简洁，适合快速查看数据分布、趋势、关系</li>
</ul>
<h3 data-id="heading-4">2. 启用绘图支持（通常自动加载）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 在 Jupyter 中显示图形（非必须，但推荐）</span>
%matplotlib inline
</code></pre>
<hr/>
<h2 data-id="heading-5">📊 二、Series 与 DataFrame 基础绘图</h2>
<h3 data-id="heading-6">1. Series 绘图（一维数据）</h3>
<pre><code class="hljs language-python" lang="python">s = pd.Series(np.random.randn(<span class="hljs-number">10</span>).cumsum(), index=pd.date_range(<span class="hljs-string">'2025-01-01'</span>, periods=<span class="hljs-number">10</span>))

<span class="hljs-comment"># 默认折线图</span>
s.plot()
plt.title(<span class="hljs-string">'Series 折线图'</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/68303118-e8e5-4bce-aa0c-acb9fcfe7e36.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-7">2. DataFrame 绘图（多列数据）</h3>
<pre><code class="hljs language-python" lang="python">df = pd.DataFrame(
    np.random.randn(<span class="hljs-number">10</span>, <span class="hljs-number">4</span>),
    columns=[<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>, <span class="hljs-string">'C'</span>, <span class="hljs-string">'D'</span>],
    index=pd.date_range(<span class="hljs-string">'2025-01-01'</span>, periods=<span class="hljs-number">10</span>)
)

<span class="hljs-comment"># 默认：每列一条线（折线图）</span>
df.plot()
plt.title(<span class="hljs-string">'DataFrame 多列折线图'</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/5e81f8bf-2c42-4728-a1aa-69e7a7fdaacc.png" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-8">🎨 三、常用图表类型（通过 <code>kind</code> 参数指定）</h2>























































<table><thead><tr><th>图表类型</th><th><code>kind</code> 值</th><th>适用场景</th></tr></thead><tbody><tr><td>折线图</td><td><code>'line'</code></td><td>时间序列、趋势</td></tr><tr><td>柱状图</td><td><code>'bar'</code></td><td>分类比较（垂直）</td></tr><tr><td>水平柱状图</td><td><code>'barh'</code></td><td>类别名较长时</td></tr><tr><td>直方图</td><td><code>'hist'</code></td><td>数值分布</td></tr><tr><td>箱线图</td><td><code>'box'</code></td><td>分布与异常值</td></tr><tr><td>密度图</td><td><code>'kde'</code> / <code>'density'</code></td><td>平滑分布估计</td></tr><tr><td>面积图</td><td><code>'area'</code></td><td>累计贡献</td></tr><tr><td>散点图</td><td><code>'scatter'</code></td><td>两变量关系</td></tr><tr><td>六边形图</td><td><code>'hexbin'</code></td><td>大量散点密度</td></tr></tbody></table>
<blockquote>
<p>✅ 所有图表都可通过 <code>df.plot(kind='xxx')</code> 或 <code>df.plot.xxx()</code> 调用</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🔍 四、详细图表示例与参数说明</h2>
<h3 data-id="heading-10">1. 折线图（Line Plot）— 默认图表</h3>
<pre><code class="hljs language-python" lang="python">df.plot(
    kind=<span class="hljs-string">'line'</span>,
    title=<span class="hljs-string">'销售额趋势'</span>,
    xlabel=<span class="hljs-string">'日期'</span>,
    ylabel=<span class="hljs-string">'金额（万元）'</span>,
    figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>),
    grid=<span class="hljs-literal">True</span>,
    style=[<span class="hljs-string">'-'</span>, <span class="hljs-string">'--'</span>, <span class="hljs-string">'-.'</span>, <span class="hljs-string">':'</span>]  <span class="hljs-comment"># 线型</span>
)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/38af2d43-9848-47a7-8afa-41cf7b22ea63.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">2. 柱状图（Bar Plot）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 分类数据示例</span>
sales = pd.DataFrame({
    <span class="hljs-string">'产品'</span>: [<span class="hljs-string">'手机'</span>, <span class="hljs-string">'电脑'</span>, <span class="hljs-string">'平板'</span>, <span class="hljs-string">'耳机'</span>],
    <span class="hljs-string">'Q1'</span>: [<span class="hljs-number">120</span>, <span class="hljs-number">80</span>, <span class="hljs-number">50</span>, <span class="hljs-number">30</span>],
    <span class="hljs-string">'Q2'</span>: [<span class="hljs-number">130</span>, <span class="hljs-number">85</span>, <span class="hljs-number">55</span>, <span class="hljs-number">35</span>]
}).set_index(<span class="hljs-string">'产品'</span>)

<span class="hljs-comment"># 垂直柱状图（默认）</span>
sales.plot(kind=<span class="hljs-string">'bar'</span>, figsize=(<span class="hljs-number">8</span>, <span class="hljs-number">5</span>), title=<span class="hljs-string">'各产品季度销量'</span>)
plt.xticks(rotation=<span class="hljs-number">0</span>)  <span class="hljs-comment"># 横轴标签不旋转</span>
plt.show()

<span class="hljs-comment"># 水平柱状图</span>
sales.plot(kind=<span class="hljs-string">'barh'</span>, stacked=<span class="hljs-literal">True</span>)  <span class="hljs-comment"># 堆叠</span>
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/1acf90dc-ec81-49fa-a646-589d12c549df.png" alt="" loading="lazy"/></p>
<p><img src="http://openwrite.cn/uploads/19777/57186/dab13573-ce72-43d0-927d-ef26f725e292.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">3. 直方图（Histogram）— 查看分布</h3>
<pre><code class="hljs language-python" lang="python">df[<span class="hljs-string">'A'</span>].plot(kind=<span class="hljs-string">'hist'</span>, bins=<span class="hljs-number">20</span>, alpha=<span class="hljs-number">0.7</span>, title=<span class="hljs-string">'A 列数据分布'</span>)
plt.show()

<span class="hljs-comment"># 多列直方图（重叠）</span>
df[[<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]].plot.hist(alpha=<span class="hljs-number">0.5</span>, bins=<span class="hljs-number">20</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/0947df97-0e14-432b-be52-9e9b97184cb7.png" alt="" loading="lazy"/></p>
<p><img src="http://openwrite.cn/uploads/19777/57186/16ca8ff4-4ba8-4aa6-a178-5f1938832dc6.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">4. 箱线图（Box Plot）— 查看分布与异常值</h3>
<pre><code class="hljs language-python" lang="python">df.plot(kind=<span class="hljs-string">'box'</span>, title=<span class="hljs-string">'各列数据分布箱线图'</span>)
plt.ylabel(<span class="hljs-string">'数值'</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/559a96b1-d5ce-46a9-aa38-b7becb5cf493.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">5. 散点图（Scatter Plot）— 两变量关系</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 需指定 x 和 y 列</span>
df.plot(
    kind=<span class="hljs-string">'scatter'</span>,
    x=<span class="hljs-string">'A'</span>,
    y=<span class="hljs-string">'B'</span>,
    c=<span class="hljs-string">'C'</span>,          <span class="hljs-comment"># 颜色映射第三列</span>
    colormap=<span class="hljs-string">'viridis'</span>,
    title=<span class="hljs-string">'A vs B (颜色=C)'</span>
)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/b6e96fc6-7513-4382-a8ef-d3758259e042.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-15">6. 面积图（Area Plot）— 累计贡献</h3>
<pre><code class="hljs language-python" lang="python">df = df.<span class="hljs-built_in">abs</span>()
df.plot(kind=<span class="hljs-string">'area'</span>, stacked=<span class="hljs-literal">True</span>, alpha=<span class="hljs-number">0.7</span>, title=<span class="hljs-string">'累计贡献'</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/b6ff5eba-0874-4dce-94ce-6f8252a72a2a.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">7. 密度图（KDE）— 平滑分布</h3>
<pre><code class="hljs language-python" lang="python">df[<span class="hljs-string">'A'</span>].plot(kind=<span class="hljs-string">'kde'</span>, title=<span class="hljs-string">'A 列核密度估计'</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/7b2c7d85-fd40-4730-80db-c0408d1c56bb.png" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-17">⚙️ 五、通用绘图参数（适用于所有图表）</h2>


















































<table><thead><tr><th>参数</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>figsize</code></td><td>图形大小（宽, 高）</td><td><code>figsize=(10, 6)</code></td></tr><tr><td><code>title</code></td><td>图表标题</td><td><code>title='销售分析'</code></td></tr><tr><td><code>xlabel</code> / <code>ylabel</code></td><td>坐标轴标签</td><td><code>xlabel='月份'</code></td></tr><tr><td><code>grid</code></td><td>显示网格</td><td><code>grid=True</code></td></tr><tr><td><code>legend</code></td><td>显示图例</td><td><code>legend=True</code>（默认）</td></tr><tr><td><code>color</code></td><td>颜色</td><td><code>color=['red', 'blue']</code></td></tr><tr><td><code>alpha</code></td><td>透明度（0~1）</td><td><code>alpha=0.5</code></td></tr><tr><td><code>rot</code></td><td>x 轴标签旋转角度</td><td><code>rot=45</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-18">🧩 六、高级技巧与组合图</h2>
<h3 data-id="heading-19">1. 子图（Subplots）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 每列一个子图</span>
df.plot(subplots=<span class="hljs-literal">True</span>, layout=(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>), figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">8</span>))
plt.tight_layout()
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/a4fec0f4-2164-44d7-9578-b470ead9967d.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-20">2. 双 Y 轴（用于不同量纲）</h3>
<pre><code class="hljs language-python" lang="python">ax = df[<span class="hljs-string">'A'</span>].plot(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>), color=<span class="hljs-string">'blue'</span>, label=<span class="hljs-string">'A'</span>)
ax2 = ax.twinx()  <span class="hljs-comment"># 共享 x 轴</span>
df[<span class="hljs-string">'B'</span>].plot(ax=ax2, color=<span class="hljs-string">'red'</span>, label=<span class="hljs-string">'B'</span>)

ax.set_ylabel(<span class="hljs-string">'A 值'</span>, color=<span class="hljs-string">'blue'</span>)
ax2.set_ylabel(<span class="hljs-string">'B 值'</span>, color=<span class="hljs-string">'red'</span>)
plt.title(<span class="hljs-string">'双 Y 轴图'</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/5f741b8c-19e2-47cc-bb98-2baabef4b1af.png" alt="" loading="lazy"/></p>
<blockquote>
<p>⚠️ 注意：Pandas 原生不支持 <code>secondary_y</code> 在 <code>.plot()</code> 中直接使用（旧版本支持），建议用上述 Matplotlib 方式。</p>
</blockquote>
<h3 data-id="heading-21">3. 分组柱状图（需数据重塑）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 将宽表转为长表（便于分组）</span>
sales_long = sales.reset_index().melt(id_vars=<span class="hljs-string">'产品'</span>, var_name=<span class="hljs-string">'季度'</span>, value_name=<span class="hljs-string">'销量'</span>)
<span class="hljs-built_in">print</span>(sales_long)

<span class="hljs-comment"># 使用 Seaborn 更方便（见下文对比）</span>
plt.figure(figsize=(<span class="hljs-number">10</span>, <span class="hljs-number">6</span>))
sns.barplot(x=<span class="hljs-string">'产品'</span>, y=<span class="hljs-string">'销量'</span>, hue=<span class="hljs-string">'季度'</span>, data=sales_long)
plt.title(<span class="hljs-string">'各产品季度销量'</span>)
plt.show()
</code></pre>
<p><img src="http://openwrite.cn/uploads/19777/57186/b29bd2f9-ddeb-4952-8e69-bee39ebf5351.png" alt="" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-22">🔁 七、Pandas vs 专业可视化库</h2>















































<table><thead><tr><th>功能</th><th>Pandas</th><th>Seaborn</th><th>Plotly</th></tr></thead><tbody><tr><td><strong>易用性</strong></td><td>⭐⭐⭐⭐⭐（极简）</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐</td></tr><tr><td><strong>统计图表</strong></td><td>基础</td><td>⭐⭐⭐⭐⭐（箱线、小提琴等）</td><td>⭐⭐⭐</td></tr><tr><td><strong>美观度</strong></td><td>一般（可定制）</td><td>⭐⭐⭐⭐⭐（默认美观）</td><td>⭐⭐⭐⭐⭐（交互式）</td></tr><tr><td><strong>交互性</strong></td><td>❌</td><td>❌</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong>大数据性能</strong></td><td>一般</td><td>一般</td><td>较好（WebGL）</td></tr><tr><td><strong>适用场景</strong></td><td>快速 EDA</td><td>发表级静态图</td><td>仪表盘、Web 应用</td></tr></tbody></table>
<h3 data-id="heading-23">✅ 推荐使用策略：</h3>
<ul>
<li><strong>探索阶段</strong>：用 Pandas 快速画图</li>
<li><strong>报告/论文</strong>：用 Seaborn 美化</li>
<li><strong>交互展示</strong>：用 Plotly/Dash</li>
</ul>
<h4 data-id="heading-24">示例：相同图表用 Seaborn 更简洁美观</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns

<span class="hljs-comment"># 散点图 + 回归线</span>
sns.scatterplot(data=df, x=<span class="hljs-string">'A'</span>, y=<span class="hljs-string">'B'</span>, hue=<span class="hljs-string">'C'</span>)
sns.regplot(data=df, x=<span class="hljs-string">'A'</span>, y=<span class="hljs-string">'B'</span>, scatter=<span class="hljs-literal">False</span>)
plt.show()

<span class="hljs-comment"># 箱线图（按类别）</span>
sns.boxplot(data=sales_long, x=<span class="hljs-string">'产品'</span>, y=<span class="hljs-string">'销量'</span>, hue=<span class="hljs-string">'季度'</span>)
plt.show()
</code></pre>
<hr/>
<h2 data-id="heading-25">🛠️ 八、常见问题与解决方案</h2>
<h3 data-id="heading-26">1. 中文乱码</h3>
<pre><code class="hljs language-python" lang="python">plt.rcParams[<span class="hljs-string">'font.sans-serif'</span>] = [<span class="hljs-string">'SimHei'</span>]  <span class="hljs-comment"># Windows</span>
plt.rcParams[<span class="hljs-string">'axes.unicode_minus'</span>] = <span class="hljs-literal">False</span>    <span class="hljs-comment"># 正常显示负号</span>
</code></pre>
<h3 data-id="heading-27">2. 图形不显示（Jupyter 外）</h3>
<pre><code class="hljs language-python" lang="python">plt.show()  <span class="hljs-comment"># 必须调用</span>
</code></pre>
<h3 data-id="heading-28">3. 时间序列 X 轴格式混乱</h3>
<pre><code class="hljs language-python" lang="python">df.plot()
plt.gca().xaxis.set_major_formatter(plt.matplotlib.dates.DateFormatter(<span class="hljs-string">'%Y-%m'</span>))
plt.xticks(rotation=<span class="hljs-number">45</span>)
plt.tight_layout()
plt.show()
</code></pre>
<h3 data-id="heading-29">4. 颜色自定义</h3>
<pre><code class="hljs language-python" lang="python">df.plot(color=[<span class="hljs-string">'#FF5733'</span>, <span class="hljs-string">'#33FF57'</span>, <span class="hljs-string">'#3357FF'</span>])
</code></pre>
<hr/>
<h2 data-id="heading-30">✅ 九、总结：Pandas 可视化最佳实践</h2>





































<table><thead><tr><th>场景</th><th>推荐做法</th></tr></thead><tbody><tr><td><strong>快速查看趋势</strong></td><td><code>df.plot()</code>（折线图）</td></tr><tr><td><strong>比较分类数据</strong></td><td><code>df.plot.bar()</code></td></tr><tr><td><strong>检查数据分布</strong></td><td><code>df.plot.hist()</code> 或 <code>df.plot.kde()</code></td></tr><tr><td><strong>发现变量关系</strong></td><td><code>df.plot.scatter(x, y)</code></td></tr><tr><td><strong>检测异常值</strong></td><td><code>df.plot.box()</code></td></tr><tr><td><strong>需要美观/发表</strong></td><td>转用 Seaborn</td></tr><tr><td><strong>需要交互</strong></td><td>转用 Plotly</td></tr></tbody></table>
<blockquote>
<p>💡 <strong>记住</strong>：
<strong>Pandas 可视化 = 快速探索的“瑞士军刀”</strong>，
不是最终交付工具，但能极大提升分析效率！</p>
</blockquote>
<hr/>
<h2 data-id="heading-31">后续</h2>
<p>python过渡项目部分代码已经上传至gitee，后续会逐步更新。</p>
<h2 data-id="heading-32">资料关注</h2>
<p>公众号：咚咚王
gitee：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fwy18585051844%2Fai_learning" target="_blank" title="https://gitee.com/wy18585051844/ai_learning" ref="nofollow noopener noreferrer">gitee.com/wy185850518…</a></p>
<p><img src="http://openwrite.cn/uploads/19777/55978/c4e904dc-c18f-445e-bf2a-40d8bb548e61.png" alt="" loading="lazy"/></p>
<p>《Python编程：从入门到实践》
《利用Python进行数据分析》
《算法导论中文第三版》
《概率论与数理统计（第四版） (盛骤) 》
《程序员的数学》
《线性代数应该这样学第3版》
《微积分和数学分析引论》
《（西瓜书）周志华-机器学习》
《TensorFlow机器学习实战指南》
《Sklearn与TensorFlow机器学习实用指南》
《模式识别（第四版）》
《深度学习 deep learning》伊恩·古德费洛著 花书
《Python深度学习第二版(中文版)【纯文本】 (登封大数据 (Francois Choliet)) (Z-Library)》
《深入浅出神经网络与深度学习+(迈克尔·尼尔森（Michael+Nielsen）》
《自然语言处理综论  第2版》
《Natural-Language-Processing-with-PyTorch》
《计算机视觉-算法与应用(中文版)》
《Learning OpenCV 4》
《AIGC：智能创作时代》杜雨+&amp;+张孜铭
《AIGC原理与实践：零基础学大语言模型、扩散模型和多模态模型》
《从零构建大语言模型（中文版）》
《实战AI大模型》
《AI 3.0》</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[uniapp开发app使用海康威视播放监控视频流如何使用以及遇到了什么问题]]></title>    <link>https://juejin.cn/post/7581312433530503211</link>    <guid>https://juejin.cn/post/7581312433530503211</guid>    <pubDate>2025-12-09T01:53:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433530503211" data-draft-id="7581324707480453161" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="uniapp开发app使用海康威视播放监控视频流如何使用以及遇到了什么问题"/> <meta itemprop="keywords" content="uni-app,Vue.js,视频编码"/> <meta itemprop="datePublished" content="2025-12-09T01:53:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="随笔记"/> <meta itemprop="url" content="https://juejin.cn/user/3491704660563581"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            uniapp开发app使用海康威视播放监控视频流如何使用以及遇到了什么问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3491704660563581/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    随笔记
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T01:53:12.000Z" title="Tue Dec 09 2025 01:53:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">uniapp开发的app中需要使用海康威视播放视频流</h2>
<h4 data-id="heading-1">第一步：</h4>
<p>去官网<code>https://open.hikvision.com/download/5c67f1e2f05948198c909700?type=20</code>下载相关的<code>SD</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d2b95c391ab44a291fac12acfb40884~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZqP56yU6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849992&amp;x-signature=wpig25t1%2Fmuh50NtzhCHZgVyZWs%3D" alt="image.png" loading="lazy"/>
因为我是使用uniapp开发的app，选择下载了H5视频播放器开发包V2.5.1，同时它会有相关的demo下载，功能还是比较全的</p>
<h4 data-id="heading-2">第二步：</h4>
<p>运行demo</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26d9cfaf07794adcaf25ae523f4fbbda~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZqP56yU6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849992&amp;x-signature=fVcY%2Fuq%2FD6zOYlJNMGKADzcAdWs%3D" alt="image.png" loading="lazy"/></p>
<p>第三步：将相关的js文件SDK放在项目中</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55471173918f40ada84da9489ccd5088~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZqP56yU6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849992&amp;x-signature=2s3u4gg0Knzx%2FAk07m20OqwED1Y%3D" alt="image.png" loading="lazy"/></p>
<p>在项目中引入：</p>
<pre><code class="hljs language-javascript" lang="javascript">
&lt;script <span class="hljs-variable language_">module</span>=<span class="hljs-string">"vedio"</span> lang=<span class="hljs-string">"renderjs"</span>&gt;
	<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
		<span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
			<span class="hljs-keyword">return</span> {
				<span class="hljs-attr">playData</span>: [],
				<span class="hljs-attr">player</span>: <span class="hljs-literal">null</span>,
				<span class="hljs-attr">accessToken</span>: <span class="hljs-literal">null</span>,
				<span class="hljs-attr">playerSdkLoaded</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// SDK是否加载完成</span>
				<span class="hljs-attr">isPlayerReady</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 标记播放器是否初始化完成（新增）</span>
				<span class="hljs-title class_">JSPlugin</span>: <span class="hljs-literal">null</span> <span class="hljs-comment">// 缓存SDK实例，避免重复加载（新增）</span>
			}
		},
		<span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
			<span class="hljs-keyword">const</span> that = <span class="hljs-variable language_">this</span>;
			<span class="hljs-comment">// 先修复removeEventListener空指针问题（关键）</span>
			<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fixRemoveEventListener</span>();
			<span class="hljs-comment">// 只加载一次SDK，缓存到JSPlugin</span>
			<span class="hljs-keyword">import</span>(<span class="hljs-string">'@/static/js/h5player.min.js'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
				<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res, <span class="hljs-string">'SDK加载完成'</span>);
				that.<span class="hljs-property">JSPlugin</span> = res.<span class="hljs-property">JSPlugin</span>;
				that.<span class="hljs-property">playerSdkLoaded</span> = <span class="hljs-literal">true</span>;
				<span class="hljs-comment">// 初始化播放器（首次加载）</span>
				that.<span class="hljs-title function_">initPlayer</span>();
			}).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
				<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'SDK加载失败：'</span>, err);
			})
		},
		<span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
			<span class="hljs-comment">// 页面销毁时彻底销毁播放器</span>
			<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">destroyPlayer</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
				<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> = <span class="hljs-literal">null</span>;
				<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span> = <span class="hljs-literal">false</span>;
				<span class="hljs-variable language_">this</span>.<span class="hljs-property">JSPlugin</span> = <span class="hljs-literal">null</span>;
			});
		},
		<span class="hljs-attr">methods</span>: {
			<span class="hljs-comment">// 修复removeEventListener空指针（核心）</span>
			<span class="hljs-title function_">fixRemoveEventListener</span>(<span class="hljs-params"/>) {
				<span class="hljs-keyword">const</span> originalRemove = <span class="hljs-title class_">EventTarget</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">removeEventListener</span>;
				<span class="hljs-title class_">EventTarget</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">removeEventListener</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">type, listener, options</span>) {
					<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>) { <span class="hljs-comment">// 仅当当前对象存在时执行</span>
						<span class="hljs-keyword">try</span> {
							originalRemove.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, type, listener, options);
						} <span class="hljs-keyword">catch</span> (err) {
							<span class="hljs-keyword">if</span> (err.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'removeEventListener'</span>)) {
								<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'解绑事件忽略：'</span>, type);
							} <span class="hljs-keyword">else</span> {
								<span class="hljs-keyword">throw</span> err;
							}
						}
					}
				};
			},
			<span class="hljs-comment">// 切换播放地址（核心改造）</span>
			<span class="hljs-keyword">async</span> <span class="hljs-title function_">changePlayUrl</span>(<span class="hljs-params">newUrl, oldUrl, instance</span>) {
				<span class="hljs-keyword">if</span> (!newUrl || newUrl === oldUrl) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 空地址/相同地址不处理</span>
				<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'切换流地址：'</span>, newUrl);
				<span class="hljs-comment">// 1. 先彻底销毁旧播放器</span>
				<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">destroyPlayer</span>();
				<span class="hljs-comment">// 2. 确保SDK已加载，重新初始化播放器</span>
				<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">JSPlugin</span>) {
					<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'SDK未加载完成'</span>);
					<span class="hljs-keyword">return</span>;
				}
				<span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initPlayer</span>();
				<span class="hljs-comment">// 3. 播放器初始化完成后立即播放（取消setTimeout，改用实例就绪判断）</span>
				<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span>) {
					<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>.<span class="hljs-title function_">JS_Play</span>(newUrl, {
						<span class="hljs-attr">playURL</span>: newUrl,
						<span class="hljs-attr">mode</span>: <span class="hljs-number">0</span>,
						<span class="hljs-title class_">PlayBackMode</span>: <span class="hljs-number">1</span>,
						<span class="hljs-attr">keepDecoder</span>: <span class="hljs-number">0</span>
					}, <span class="hljs-number">0</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
						<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'播放成功：'</span>, res);
					}).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
						<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'播放失败：'</span>, err);
						<span class="hljs-comment">// H.265解码失败时降级处理（可选）</span>
						<span class="hljs-keyword">if</span> (err.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'h265'</span>)) {
							uni.<span class="hljs-title function_">showToast</span>({
								<span class="hljs-attr">title</span>: <span class="hljs-string">'H.265解码失败，请切换H.264流'</span>,
								<span class="hljs-attr">icon</span>: <span class="hljs-string">'none'</span>
							});
						}
					});
				}
			},
			<span class="hljs-comment">// 销毁播放器（Promise封装，确保彻底）</span>
			<span class="hljs-title function_">destroyPlayer</span>(<span class="hljs-params"/>) {
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> {
					<span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span>) {
						<span class="hljs-keyword">try</span> {
							<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>.<span class="hljs-title function_">JS_Stop</span>(); <span class="hljs-comment">// 先停止播放（海康标准方法）</span>
							<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>.<span class="hljs-title function_">off</span>(); <span class="hljs-comment">// 解绑事件</span>
							<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>.<span class="hljs-title function_">destroy</span>(); <span class="hljs-comment">// 销毁实例</span>
							<span class="hljs-comment">// 清空容器DOM，避免残留</span>
							<span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'video-container'</span>);
							<span class="hljs-keyword">if</span> (container) container.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">''</span>;
						} <span class="hljs-keyword">catch</span> (err) {
							<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'销毁播放器错误：'</span>, err);
						} <span class="hljs-keyword">finally</span> {
							<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> = <span class="hljs-literal">null</span>;
							<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span> = <span class="hljs-literal">false</span>;
							<span class="hljs-title function_">resolve</span>();
						}
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-title function_">resolve</span>();
					}
				});
			},
			<span class="hljs-comment">// 全屏播放</span>
			<span class="hljs-title function_">wholeFullScreen</span>(<span class="hljs-params"/>) {
				<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>) <span class="hljs-keyword">return</span>;
				<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span>.<span class="hljs-title function_">JS_FullScreenDisplay</span>(<span class="hljs-literal">true</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {
					<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'全屏成功'</span>);
				}).<span class="hljs-keyword">catch</span>(<span class="hljs-function"><span class="hljs-params">e</span> =&gt;</span> {
					<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'全屏失败：'</span>, e);
				})
			},
			<span class="hljs-comment">// 初始化播放器（锁定软解，稳化解码）</span>
			<span class="hljs-title function_">initPlayer</span>(<span class="hljs-params"/>) {
				<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
					<span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">JSPlugin</span>) {
						<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>);
						<span class="hljs-keyword">return</span>;
					}
					<span class="hljs-keyword">try</span> {
						<span class="hljs-keyword">const</span> my_player = <span class="hljs-keyword">new</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">JSPlugin</span>({
							<span class="hljs-attr">szId</span>: <span class="hljs-string">'video-container'</span>, <span class="hljs-comment">// 容器ID</span>
							<span class="hljs-attr">szBasePath</span>: <span class="hljs-string">"/static/js/"</span>, <span class="hljs-comment">// SDK路径</span>
							<span class="hljs-attr">iMaxSplit</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 移动端只需要1路播放，减少性能消耗</span>
							<span class="hljs-attr">openDebug</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 关闭debug，减少日志干扰</span>
							<span class="hljs-attr">mseWorkerEnable</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 开启多线程解码，提升软解性能</span>
							<span class="hljs-attr">bSupporDoubleClickFull</span>: <span class="hljs-literal">true</span>,
							<span class="hljs-comment">// ========== 核心：锁定软解，避免H.265硬解不稳定 ==========</span>
							<span class="hljs-attr">decodeType</span>: <span class="hljs-string">'soft'</span>, <span class="hljs-comment">// 强制软解（关键！放弃auto硬解）</span>
							<span class="hljs-attr">enableSoftDecode</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 显式开启软解</span>
							<span class="hljs-attr">supportH265</span>: <span class="hljs-literal">true</span>,
							<span class="hljs-attr">isFlushURI</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 切换流清空URI缓存</span>
							<span class="hljs-attr">reconnectTimes</span>: <span class="hljs-number">3</span>, <span class="hljs-comment">// 解码失败重连</span>
							<span class="hljs-attr">reconnectInterval</span>: <span class="hljs-number">2000</span>,
							<span class="hljs-comment">// ========== 移动端适配 ==========</span>
							<span class="hljs-attr">renderType</span>: <span class="hljs-string">'canvas'</span>, <span class="hljs-comment">// canvas渲染更兼容</span>
							<span class="hljs-attr">lowLatency</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 关闭低延迟，换稳定性</span>
							<span class="hljs-attr">maxBufferLength</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// 降低缓冲，减少内存占用</span>
						});
						<span class="hljs-comment">// 绑定错误回调，捕获解码异常</span>
						my_player.<span class="hljs-title function_">JS_SetWindowControlCallback</span>({
							<span class="hljs-attr">pluginErrorHandler</span>: <span class="hljs-function">(<span class="hljs-params">iWndIndex, iErrorCode, oError</span>) =&gt;</span> {
								<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'播放器错误：'</span>, iWndIndex, iErrorCode, oError);
								<span class="hljs-keyword">if</span> (oError &amp;&amp; oError.<span class="hljs-property">message</span>.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'h265'</span>)) {
									<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span> = <span class="hljs-literal">false</span>;
								}
							},
							<span class="hljs-attr">firstFrameDisplay</span>: <span class="hljs-function">(<span class="hljs-params">iWndIndex, iWidth, iHeight</span>) =&gt;</span> {
								<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'首帧显示：'</span>, iWndIndex, iWidth, iHeight);
								<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 首帧显示标记就绪</span>
							},
							<span class="hljs-attr">performanceLack</span>: <span class="hljs-function">(<span class="hljs-params">iWndIndex</span>) =&gt;</span> {
								<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'性能不足：'</span>, iWndIndex);
							}
						});
						<span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> = my_player;
						<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 标记初始化完成</span>
						<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);
					} <span class="hljs-keyword">catch</span> (err) {
						<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'初始化播放器失败：'</span>, err);
						<span class="hljs-variable language_">this</span>.<span class="hljs-property">isPlayerReady</span> = <span class="hljs-literal">false</span>;
						<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">false</span>);
					}
				});
			},
			<span class="hljs-comment">// 截取设备序号和通道号（保留）</span>
			<span class="hljs-title function_">getHashParts</span>(<span class="hljs-params">str</span>) {
				<span class="hljs-keyword">const</span> parts = str.<span class="hljs-title function_">split</span>(<span class="hljs-string">"#"</span>);
				<span class="hljs-keyword">return</span> {
					<span class="hljs-attr">before</span>: parts[<span class="hljs-number">0</span>],
					<span class="hljs-attr">after</span>: parts.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span> ? parts[<span class="hljs-number">1</span>] : <span class="hljs-string">""</span>,
				};
			}
		},
	}
&lt;/script&gt;

</code></pre>
<h3 data-id="heading-3">在项目中也遇到了很多问题，也都一一解决了：</h3>
<p>1：因为开发的<code>app</code>，在浏览器的手机模拟器能够播放，但是在真机运行的时候提示<code>JSPlugin</code>没有定义</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67ad4cd187c14b0a80f027e20ecc8814~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZqP56yU6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849992&amp;x-signature=TlihjfitUE1vp7EwGNZJUmQiqhM%3D" alt="企业微信截图_17649838975105.png" loading="lazy"/>
后来经过调整，查资料是因为<code>js文件</code>引入没有加载成功，后来就改变了引入方式，变成这样</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49eb6044bc484be0b4eb43edf1b18499~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZqP56yU6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849992&amp;x-signature=EI%2BJKnWXCIVmpxNIYAouOM8dP%2FM%3D" alt="image.png" loading="lazy"/></p>
<p>2：因为是多个视频流进行切换，在切换的时候会出现这样的问题，原因是<code>实例未销毁</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44ae407cef51448c8ae87c21ee2d8b61~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZqP56yU6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849992&amp;x-signature=ol5T4UDwD1BYcRhhVPOGXOIIRds%3D" alt="image.png" loading="lazy"/></p>
<p>3：在切换的时候会出现<code>[H5player]-%c2025-12-08 10:57:44.823%c-Error: color: blue color: black VideoDecoder not support h265: at app-view.js:45399</code>,导致播放不出来，以下是解决办法</p>
<p>在 <code>UniApp</code> 中使用<code>海康威视 H5 播放器</code>切换视频流时出现 <code>[H5player] VideoDecoder not support h265</code> 错误，核心原因是<strong>移动端浏览器 / 设备不支持 H.265（HEVC）解码</strong>，且<code>海康威视 H5 播放器</code>默认未启用兼容降级策略。以下是分维度的解决方案，从「解码兼容」「流格式转换」「播放器配置」三个层面彻底解决：</p>
<h4 data-id="heading-4">一、核心问题定位</h4>
<p>H.265（HEVC）是高效视频编码格式，但移动端存在两大兼容问题：</p>
<ol>
<li><strong>硬件层面</strong>：中低端安卓 /iOS 设备的视频解码芯片不支持 H.265 硬解；</li>
<li><strong>浏览器层面</strong>：移动端 Chrome/Safari 等浏览器的<code>VideoDecoder</code> API（WebCodecs）对 H.265 支持极差，仅部分高版本安卓设备兼容；</li>
<li><strong>播放器层面</strong>：海康 H5 播放器默认优先使用硬解，未检测到 H.265 支持时直接报错，未自动降级为软解 / 转码。</li>
<li/>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bacf1ce95e74455e8244e97361e93c3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ZqP56yU6K6w:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765849992&amp;x-signature=2f7ux7nakuaIZh3hbLnBFkXwe9U%3D" alt="image.png" loading="lazy"/></p>
<p>以上就是我使用海康威视的经验分享，大家如果有相同的问题或者其它好的经验，可以评论区讨论哦</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[LLM应用剖析: 小红书AI图文生成器-红墨]]></title>    <link>https://juejin.cn/post/7581306080434733107</link>    <guid>https://juejin.cn/post/7581306080434733107</guid>    <pubDate>2025-12-08T12:30:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080434733107" data-draft-id="7581406561684996142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="LLM应用剖析: 小红书AI图文生成器-红墨"/> <meta itemprop="keywords" content="算法,GitHub"/> <meta itemprop="datePublished" content="2025-12-08T12:30:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mengrennwpu"/> <meta itemprop="url" content="https://juejin.cn/user/2795379959560121"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            LLM应用剖析: 小红书AI图文生成器-红墨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2795379959560121/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mengrennwpu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:30:08.000Z" title="Mon Dec 08 2025 12:30:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>欢迎关注公众号：爱学习的妮妮qiang</strong></p>
<ul>
<li>花了半天时间翻阅了谷歌的提示工程规范，</li>
</ul>
<h2 data-id="heading-0">1. 背景</h2>
<ul>
<li>花了近一周时间，深入研究了Github近几天比较有意思的一个项目，小红书AI图文生成器RedInk。仅需输入一个主题以及可选的参考图片，系统则会自动生成大纲，然后针对每个章节生成对应的图片。</li>
<li>项目前端采用Vue+TypeScript，后端采用Flask。</li>
<li>支持docker部署及编译部署，文本模型及图像模型支持系统编辑。</li>
<li>Ps: 国内有哪些平台可以访问nano banana 2 pro? 本人使用的是七牛，免费试用额度还不少哦。</li>
</ul>
<h2 data-id="heading-1">2. 系统效果</h2>
<ul>
<li>模型选择: Qwen3-14B大语言模型，Nano Banana2生图模型。</li>
<li>输入: 3岁宝宝冬季保暖攻略</li>
<li>输出效果:
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98b8d8fc49c8429a85ef7d23dbebb0fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWVuZ3Jlbm53cHU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801808&amp;x-signature=bq9gOCpCRk6ohad1Hen6fv4A%2Fgo%3D" alt="生成效果图.png" loading="lazy"/></li>
</ul>
<h2 data-id="heading-2">3. 整体流程</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1466135ac0c4f6d9b447966acf7a971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbWVuZ3Jlbm53cHU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801808&amp;x-signature=SsOlZF6VbWa%2FYG71nIqmM17wxCc%3D" alt="流程.png" loading="lazy"/></p>
<ul>
<li>(1) 用户通过系统输入关注的主题，也可同时上传参考的多个图片</li>
<li>(2) 系统会调用LLM生成大纲，包含封面、多个内容片段以及总结，如果针对生成效果不满意，可以直接在线编辑。</li>
<li>(3) 编辑好每个段落后，即可开始一键生图，可根据服务商模型特性，采用串行及并行两种方式。</li>
<li>(4) 生成好的图片后，如果针对其中某些不满意，可以执行重新生成，最终可以一键生成。</li>
</ul>
<h2 data-id="heading-3">4. 代码浅析</h2>
<ul>
<li>(1) 前后端代码的可读性很强，建议可以本地进行调试。如果想要在vscode中同时联调前端和后端，可以采用如下vscode的调试配置文件launch.json</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.2.0"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"configurations"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"chrome"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"调试 Vue 应用"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://localhost:5173"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// 你的开发服务器地址</span>
            <span class="hljs-attr">"webRoot"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}/frontend/src"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"breakOnLoad"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"sourceMapPathOverrides"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"/src/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${webRoot}/*"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"/@fs/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${webRoot}/*"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-attr">"vite://@fs/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${webRoot}/*"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"runtimeArgs"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-string">"--remote-allow-origins=*"</span>
            <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"skipFiles"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
                <span class="hljs-string">"&lt;node_internals&gt;/**"</span><span class="hljs-punctuation">,</span>
                <span class="hljs-string">"${workspaceFolder}/frontend/node_modules/**"</span>
            <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"node"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"调试构建脚本"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"program"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}/frontend/node_modules/vite/bin/vite.js"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"dev"</span><span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
        <span class="hljs-punctuation">{</span>
            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Python 调试程序: 当前文件"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"debugpy"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"request"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"launch"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"program"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${file}"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"console"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"integratedTerminal"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"justMyCode"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"purpose"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"debug-in-terminal"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"cwd"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}"</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"env"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
                <span class="hljs-attr">"PYTHONPATH"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"${workspaceFolder}"</span>
            <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
            <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
            <span class="hljs-punctuation">]</span>
        <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">]</span>

<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>(2) 模型配置信息如下：</li>
</ul>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># 大语言模型</span>
<span class="hljs-attr">active_provider:</span> <span class="hljs-string">qwen</span>

<span class="hljs-attr">providers:</span>
  <span class="hljs-attr">qwen:</span>
    <span class="hljs-attr">api_key:</span> <span class="hljs-string">test</span>
    <span class="hljs-attr">base_url:</span> <span class="hljs-string">http://172.16.0.32:20080</span>
    <span class="hljs-attr">endpoint_type:</span> <span class="hljs-string">/v1/chat/completions</span>
    <span class="hljs-attr">model:</span> <span class="hljs-string">Qwen3-14B</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">openai_compatible</span>

<span class="hljs-comment"># 生图模型</span>
<span class="hljs-attr">active_provider:</span> <span class="hljs-string">七牛</span>
<span class="hljs-attr">providers:</span>
  <span class="hljs-string">七牛:</span>
    <span class="hljs-attr">api_key:</span> <span class="hljs-string">sk-34xxxxx0</span>
    <span class="hljs-attr">base_url:</span> <span class="hljs-string">https://api.qnaigc.com</span>
    <span class="hljs-attr">endpoint_type:</span> <span class="hljs-string">/v1/images/edits</span>
    <span class="hljs-attr">high_concurrency:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">model:</span> <span class="hljs-string">gemini-3.0-pro-image-preview</span>
    <span class="hljs-attr">short_prompt:</span> <span class="hljs-literal">false</span>
    <span class="hljs-attr">type:</span> <span class="hljs-string">image_api</span>
</code></pre>
<h2 data-id="heading-4">5. 总结与思考</h2>
<ul>
<li>本文介绍了小红书的一键图文生成平台，并提供了系统的基本执行流程及原理。同时分享了本人基于本地部署后，生成的图文效果，眼过千遍不如手过一遍，实践方能出真知。</li>
</ul>
<h2 data-id="heading-5">6. 参考</h2>
<ul>
<li>(1) 项目地址: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHisMax%2FRedInk" target="_blank" title="https://github.com/HisMax/RedInk" ref="nofollow noopener noreferrer">github.com/HisMax/RedI…</a></li>
<li>(2) 七牛云平台生图模型文档:<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.qiniu.com%2Faitokenapi%2F13166%2Ftext-to-image-api" target="_blank" title="https://developer.qiniu.com/aitokenapi/13166/text-to-image-api" ref="nofollow noopener noreferrer">developer.qiniu.com/aitokenapi/…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI Agent 十二要素方法论：构建生产级智能体的完整指南]]></title>    <link>https://juejin.cn/post/7581297888808648754</link>    <guid>https://juejin.cn/post/7581297888808648754</guid>    <pubDate>2025-12-08T12:24:30.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581297888808648754" data-draft-id="7581297888808615986" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI Agent 十二要素方法论：构建生产级智能体的完整指南"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-12-08T12:24:30.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="twl"/> <meta itemprop="url" content="https://juejin.cn/user/3016715635534029"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI Agent 十二要素方法论：构建生产级智能体的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3016715635534029/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    twl
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:24:30.000Z" title="Mon Dec 08 2025 12:24:30 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读28分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文是对 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhumanlayer%2F12-factor-agents" target="_blank" title="https://github.com/humanlayer/12-factor-agents" ref="nofollow noopener noreferrer">12 Factor Agents</a> 项目的深度解读与翻译总结，旨在帮助开发者理解并构建可靠、可维护的 AI Agent 系统。</p>
</blockquote>
<h2 data-id="heading-0">目录</h2>
<ul>
<li><a href="#%E5%BC%95%E8%A8%80%E6%88%91%E4%BB%AC%E6%98%AF%E5%A6%82%E4%BD%95%E8%B5%B0%E5%88%B0%E8%BF%99%E4%B8%80%E6%AD%A5%E7%9A%84" title="#%E5%BC%95%E8%A8%80%E6%88%91%E4%BB%AC%E6%98%AF%E5%A6%82%E4%BD%95%E8%B5%B0%E5%88%B0%E8%BF%99%E4%B8%80%E6%AD%A5%E7%9A%84">引言：我们是如何走到这一步的</a></li>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%9C%9F%E6%AD%A3%E7%9A%84-agent" title="#%E4%BB%80%E4%B9%88%E6%98%AF%E7%9C%9F%E6%AD%A3%E7%9A%84-agent">什么是真正的 Agent</a></li>
<li><a href="#%E5%8D%81%E4%BA%8C%E8%A6%81%E7%B4%A0%E8%AF%A6%E8%A7%A3" title="#%E5%8D%81%E4%BA%8C%E8%A6%81%E7%B4%A0%E8%AF%A6%E8%A7%A3">十二要素详解</a>
<ul>
<li><a href="#%E8%A6%81%E7%B4%A0-1%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%88%B0%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8" title="#%E8%A6%81%E7%B4%A0-1%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%88%B0%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8">要素 1：自然语言到工具调用</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-2%E6%8E%8C%E6%8E%A7%E6%8F%90%E7%A4%BA%E8%AF%8D" title="#%E8%A6%81%E7%B4%A0-2%E6%8E%8C%E6%8E%A7%E6%8F%90%E7%A4%BA%E8%AF%8D">要素 2：掌控提示词</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-3%E6%8E%8C%E6%8E%A7%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AA%97%E5%8F%A3" title="#%E8%A6%81%E7%B4%A0-3%E6%8E%8C%E6%8E%A7%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AA%97%E5%8F%A3">要素 3：掌控上下文窗口</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-4%E5%B7%A5%E5%85%B7%E5%8F%AA%E6%98%AF%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA" title="#%E8%A6%81%E7%B4%A0-4%E5%B7%A5%E5%85%B7%E5%8F%AA%E6%98%AF%E7%BB%93%E6%9E%84%E5%8C%96%E8%BE%93%E5%87%BA">要素 4：工具只是结构化输出</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-5%E7%BB%9F%E4%B8%80%E6%89%A7%E8%A1%8C%E7%8A%B6%E6%80%81%E4%B8%8E%E4%B8%9A%E5%8A%A1%E7%8A%B6%E6%80%81" title="#%E8%A6%81%E7%B4%A0-5%E7%BB%9F%E4%B8%80%E6%89%A7%E8%A1%8C%E7%8A%B6%E6%80%81%E4%B8%8E%E4%B8%9A%E5%8A%A1%E7%8A%B6%E6%80%81">要素 5：统一执行状态与业务状态</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-6%E5%90%AF%E5%8A%A8%E6%9A%82%E5%81%9C%E6%81%A2%E5%A4%8D%E7%9A%84%E7%AE%80%E5%8D%95-api" title="#%E8%A6%81%E7%B4%A0-6%E5%90%AF%E5%8A%A8%E6%9A%82%E5%81%9C%E6%81%A2%E5%A4%8D%E7%9A%84%E7%AE%80%E5%8D%95-api">要素 6：启动/暂停/恢复的简单 API</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-7%E7%94%A8%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E8%81%94%E7%B3%BB%E4%BA%BA%E7%B1%BB" title="#%E8%A6%81%E7%B4%A0-7%E7%94%A8%E5%B7%A5%E5%85%B7%E8%B0%83%E7%94%A8%E8%81%94%E7%B3%BB%E4%BA%BA%E7%B1%BB">要素 7：用工具调用联系人类</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-8%E6%8E%8C%E6%8E%A7%E6%8E%A7%E5%88%B6%E6%B5%81" title="#%E8%A6%81%E7%B4%A0-8%E6%8E%8C%E6%8E%A7%E6%8E%A7%E5%88%B6%E6%B5%81">要素 8：掌控控制流</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-9%E5%B0%86%E9%94%99%E8%AF%AF%E5%8E%8B%E7%BC%A9%E8%BF%9B%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AA%97%E5%8F%A3" title="#%E8%A6%81%E7%B4%A0-9%E5%B0%86%E9%94%99%E8%AF%AF%E5%8E%8B%E7%BC%A9%E8%BF%9B%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AA%97%E5%8F%A3">要素 9：将错误压缩进上下文窗口</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-10%E5%B0%8F%E8%80%8C%E4%B8%93%E6%B3%A8%E7%9A%84-agent" title="#%E8%A6%81%E7%B4%A0-10%E5%B0%8F%E8%80%8C%E4%B8%93%E6%B3%A8%E7%9A%84-agent">要素 10：小而专注的 Agent</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-11%E4%BB%8E%E4%BB%BB%E4%BD%95%E5%9C%B0%E6%96%B9%E8%A7%A6%E5%8F%91%E5%9C%A8%E7%94%A8%E6%88%B7%E6%89%80%E5%9C%A8%E7%9A%84%E5%9C%B0%E6%96%B9%E6%9C%8D%E5%8A%A1" title="#%E8%A6%81%E7%B4%A0-11%E4%BB%8E%E4%BB%BB%E4%BD%95%E5%9C%B0%E6%96%B9%E8%A7%A6%E5%8F%91%E5%9C%A8%E7%94%A8%E6%88%B7%E6%89%80%E5%9C%A8%E7%9A%84%E5%9C%B0%E6%96%B9%E6%9C%8D%E5%8A%A1">要素 11：从任何地方触发，在用户所在的地方服务</a></li>
<li><a href="#%E8%A6%81%E7%B4%A0-12%E8%AE%A9-agent-%E6%88%90%E4%B8%BA%E6%97%A0%E7%8A%B6%E6%80%81-reducer" title="#%E8%A6%81%E7%B4%A0-12%E8%AE%A9-agent-%E6%88%90%E4%B8%BA%E6%97%A0%E7%8A%B6%E6%80%81-reducer">要素 12：让 Agent 成为无状态 Reducer</a></li>
</ul>
</li>
<li><a href="#%E9%99%84%E5%BD%95%E9%A2%84%E5%8F%96%E4%B8%8A%E4%B8%8B%E6%96%87" title="#%E9%99%84%E5%BD%95%E9%A2%84%E5%8F%96%E4%B8%8A%E4%B8%8B%E6%96%87">附录：预取上下文</a></li>
<li><a href="#%E6%80%BB%E7%BB%93" title="#%E6%80%BB%E7%BB%93">总结</a></li>
</ul>
<hr/>
<h2 data-id="heading-1">引言：我们是如何走到这一步的</h2>
<p>无论你是 Agent 领域的新手还是资深老手，本文都将试图说服你抛开对 AI Agent 的固有认知，从第一性原理重新思考它们。</p>
<h3 data-id="heading-2">软件发展简史与 Agent 的演进</h3>
<h4 data-id="heading-3">60 年前：软件即有向图</h4>
<p>我们经常会谈到有向图（DG）和它们的无环版本——有向无环图（DAG）。值得一提的是，软件本身就是一个有向图。这就是为什么我们过去常用流程图来表示程序。</p>
<pre><code class="hljs language-markdown" lang="markdown">开始 → 输入 → 处理 → 判断 → 输出 → 结束
<span class="hljs-code">              ↑          ↓
              ← 循环处理 ←
</span></code></pre>
<h4 data-id="heading-4">20 年前：DAG 编排器兴起</h4>
<p>大约 20 年前，DAG 编排器开始流行起来。经典的如 <a href="https://link.juejin.cn?target=https%3A%2F%2Fairflow.apache.org%2F" target="_blank" title="https://airflow.apache.org/" ref="nofollow noopener noreferrer">Airflow</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.prefect.io%2F" target="_blank" title="https://www.prefect.io/" ref="nofollow noopener noreferrer">Prefect</a>，以及更新的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdagster.io%2F" target="_blank" title="https://dagster.io/" ref="nofollow noopener noreferrer">Dagster</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.inngest.com%2F" target="_blank" title="https://www.inngest.com/" ref="nofollow noopener noreferrer">Inngest</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.windmill.dev%2F" target="_blank" title="https://www.windmill.dev/" ref="nofollow noopener noreferrer">Windmill</a> 等。它们遵循相同的图模式，额外提供了可观测性、模块化、重试、管理等功能。</p>
<h4 data-id="heading-5">10-15 年前：ML 模型融入 DAG</h4>
<p>当机器学习模型开始变得足够强大可用时，我们开始看到带有 ML 模型的 DAG。你可以想象这样的步骤："将此列中的文本摘要到新列"或"按严重程度或情感对支持问题进行分类"。</p>
<p>但归根结底，它仍然主要是相同的确定性软件。</p>
<h3 data-id="heading-6">Agent 的承诺</h3>
<p>学习 Agent 时最大的收获是：<strong>你可以抛弃 DAG</strong>。不再需要软件工程师编写每个步骤和边缘情况，你只需给 Agent 一个目标和一组转换，让 LLM 实时决策找出路径。</p>
<p>这里的承诺是：</p>
<ul>
<li>写更少的代码</li>
<li>只需给 LLM 图的"边"，让它自己找出节点</li>
<li>可以从错误中恢复</li>
<li>LLM 可能会找到解决问题的新颖方案</li>
</ul>
<h3 data-id="heading-7">Agent 即循环</h3>
<p>换句话说，你有一个由以下步骤组成的循环：</p>
<ol>
<li>LLM 确定工作流的下一步，输出结构化 JSON（"工具调用"）</li>
<li>确定性代码执行工具调用</li>
<li>结果附加到上下文窗口</li>
<li>重复直到下一步被确定为"完成"</li>
</ol>
<pre><code class="hljs language-python" lang="python">initial_event = {<span class="hljs-string">"message"</span>: <span class="hljs-string">"..."</span>}
context = [initial_event]

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    next_step = <span class="hljs-keyword">await</span> llm.determine_next_step(context)
    context.append(next_step)

    <span class="hljs-keyword">if</span> next_step.intent == <span class="hljs-string">"done"</span>:
        <span class="hljs-keyword">return</span> next_step.final_answer

    result = <span class="hljs-keyword">await</span> execute_step(next_step)
    context.append(result)
</code></pre>
<h3 data-id="heading-8">"循环直到解决"模式的问题</h3>
<p>这种模式最大的问题是：</p>
<blockquote>
<p><strong>当上下文窗口过长时，Agent 会迷失方向——它们会不断尝试相同的失败方法</strong></p>
</blockquote>
<p>即使你没有手工构建过 Agent，你可能也在使用 Agentic 编码工具时遇到过这个长上下文问题。它们在一段时间后就会迷失，你需要开始新的对话。</p>
<p>我甚至会提出一个你可能已经发展出自己直觉的观点：</p>
<blockquote>
<h3 data-id="heading-9"><strong>即使模型支持越来越长的上下文窗口，小而专注的提示和上下文总是能得到更好的结果</strong></h3>
</blockquote>
<p>大多数构建者在意识到超过 10-20 轮的任何事情都会变成 LLM 无法恢复的大混乱后，就把"工具调用循环"的想法放到一边了。即使 Agent 90% 的时间都能做对，那离"足够好到可以交给客户"还差得很远。你能想象一个 10% 页面加载都会崩溃的 Web 应用吗？</p>
<h3 data-id="heading-10">真正有效的：微型 Agent</h3>
<p>我在实际中看到很多的一件事是将 Agent 模式散布到更广泛的确定性 DAG 中。</p>
<p>通过让语言模型管理范围良好的任务集，可以轻松地整合实时的人类反馈，将其转化为工作流步骤，而不会陷入上下文错误循环。</p>
<h3 data-id="heading-11">真实的微型 Agent 示例</h3>
<p>以下是一个确定性代码如何运行一个负责处理部署的人机交互步骤的微型 Agent 示例：</p>
<ol>
<li><strong>人类</strong> 将 PR 合并到 GitHub main 分支</li>
<li><strong>确定性代码</strong> 部署到 staging 环境</li>
<li><strong>确定性代码</strong> 对 staging 运行端到端测试</li>
<li><strong>确定性代码</strong> 将任务交给 Agent 进行生产部署，初始上下文："将 SHA 4af9ec0 部署到生产环境"</li>
<li><strong>Agent</strong> 调用 <code>deploy_frontend_to_prod(4af9ec0)</code></li>
<li><strong>确定性代码</strong> 请求人类批准此操作</li>
<li><strong>人类</strong> 拒绝操作并反馈"你能先部署后端吗？"</li>
<li><strong>Agent</strong> 调用 <code>deploy_backend_to_prod(4af9ec0)</code></li>
<li><strong>确定性代码</strong> 请求人类批准此操作</li>
<li><strong>人类</strong> 批准操作</li>
<li><strong>确定性代码</strong> 执行后端部署</li>
<li><strong>Agent</strong> 调用 <code>deploy_frontend_to_prod(4af9ec0)</code></li>
<li><strong>确定性代码</strong> 请求人类批准此操作</li>
<li><strong>人类</strong> 批准操作</li>
<li><strong>确定性代码</strong> 执行前端部署</li>
<li><strong>Agent</strong> 确定任务成功完成，完成！</li>
<li><strong>确定性代码</strong> 对生产环境运行端到端测试</li>
<li><strong>确定性代码</strong> 任务完成，或传递给回滚 Agent 审查失败并可能回滚</li>
</ol>
<hr/>
<h2 data-id="heading-12">什么是真正的 Agent</h2>
<p>一个 Agent 本质上由以下四个组件构成：</p>
<ol>
<li><strong>提示词（Prompt）</strong> - 告诉 LLM 如何行为，以及它有哪些可用的"工具"。提示的输出是描述工作流下一步的 JSON 对象（"工具调用"或"函数调用"）</li>
<li><strong>Switch 语句</strong> - 根据 LLM 返回的 JSON，决定如何处理它</li>
<li><strong>累积的上下文</strong> - 存储已发生步骤及其结果的列表</li>
<li><strong>For 循环</strong> - 直到 LLM 发出某种"终止"工具调用（或纯文本响应），将 switch 语句的结果添加到上下文窗口并要求 LLM 选择下一步</li>
</ol>
<p>在"部署机器人"示例中，拥有控制流和上下文累积带来几个好处：</p>
<ul>
<li>在我们的 <strong>switch 语句</strong> 和 <strong>for 循环</strong> 中，我们可以劫持控制流来暂停等待人类输入或等待长时间运行任务的完成</li>
<li>我们可以轻松地序列化 <strong>上下文</strong> 窗口以实现暂停+恢复</li>
<li>在我们的 <strong>提示</strong> 中，我们可以优化如何向 LLM 传递指令和"到目前为止发生了什么"</li>
</ul>
<hr/>
<h2 data-id="heading-13">十二要素详解</h2>
<h3 data-id="heading-14">要素 1：自然语言到工具调用</h3>
<p>Agent 构建中最常见的模式之一是将自然语言转换为结构化工具调用。这是一个强大的模式，允许你构建能够推理任务并执行它们的 Agent。</p>
<p>这个模式的原子应用是将这样的短语：</p>
<blockquote>
<p>"你能为 Terri 创建一个 750 美元的付款链接，用于赞助二月份的 AI Tinkerers 聚会吗？"</p>
</blockquote>
<p>转换为描述 Stripe API 调用的结构化对象：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"function"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"create_payment_link"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"amount"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">750</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"customer"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"cust_128934ddasf9"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"product"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prod_8675309"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"prc_09874329fds"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"quantity"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"memo"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"二月份 AI tinkerers 聚会的付款链接"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>从那里，确定性代码可以接收有效负载并处理它：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># LLM 接收自然语言并返回结构化对象</span>
next_step = <span class="hljs-keyword">await</span> llm.determine_next_step(
    <span class="hljs-string">"""
    为 Jeff 创建一个 750 美元的付款链接
    用于赞助二月份的 AI tinkerers 聚会
    """</span>
)

<span class="hljs-comment"># 根据其函数处理结构化输出</span>
<span class="hljs-keyword">if</span> next_step.function == <span class="hljs-string">'create_payment_link'</span>:
    stripe.paymentlinks.create(next_step.parameters)
    <span class="hljs-keyword">return</span>  <span class="hljs-comment"># 或者你想要的任何东西</span>
<span class="hljs-keyword">elif</span> next_step.function == <span class="hljs-string">'something_else'</span>:
    <span class="hljs-comment"># ... 更多情况</span>
    <span class="hljs-keyword">pass</span>
<span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 模型没有调用我们知道的工具</span>
    <span class="hljs-comment"># 做其他事情</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<p><strong>核心价值</strong>：LLM 负责理解意图和提取参数，确定性代码负责安全可靠地执行操作。这种分离创建了清晰的职责边界。</p>
<hr/>
<h3 data-id="heading-15">要素 2：掌控提示词</h3>
<p><strong>不要将提示工程外包给框架。</strong></p>
<p>这绝非新鲜建议。很多专家都强调过这一点：</p>
<blockquote>
<p>"如果你正在使用 LangChain 且无法解释你正在做什么，你不知道自己在做什么。如果你正在抽象出提示，你做错了。"</p>
</blockquote>
<p>一些框架提供了这样的"黑盒"方法：</p>
<pre><code class="hljs language-python" lang="python">agent = Agent(
    role=<span class="hljs-string">"..."</span>,
    goal=<span class="hljs-string">"..."</span>,
    personality=<span class="hljs-string">"..."</span>,
    tools=[tool1, tool2, tool3]
)

task = Task(
    instructions=<span class="hljs-string">"..."</span>,
    expected_output=OutputModel
)

result = agent.run(task)
</code></pre>
<p>这对于开始使用一流的提示工程来说很棒，但通常很难调整和/或逆向工程以获得正确的 token 进入模型。</p>
<p><strong>取而代之</strong>，拥有提示并将它们视为一等代码：</p>
<pre><code class="hljs language-rust" lang="rust">function <span class="hljs-title function_ invoke__">DetermineNextStep</span>(thread: string) <span class="hljs-punctuation">-&gt;</span> DoneForNow | ListGitTags | DeployBackend | DeployFrontend | RequestMoreInformation {
  prompt #<span class="hljs-string">"
    {{ _.role("</span>system<span class="hljs-string">") }}

    你是一个有帮助的助手，管理前端和后端系统的部署。
    你努力工作以确保通过遵循最佳实践和正确的部署程序来实现安全和成功的部署。

    在部署任何系统之前，你应该检查：
    - 部署环境（staging vs production）
    - 要部署的正确标签/版本
    - 当前系统状态

    你可以使用 deploy_backend、deploy_frontend 和 check_deployment_status 等工具来管理部署。
    对于敏感部署，使用 request_approval 获取人工验证。

    总是先思考要做什么，比如：
    - 检查当前部署状态
    - 验证部署标签存在
    - 如果需要请求批准
    - 在生产之前部署到 staging
    - 监控部署进度

    {{ _.role("</span>user<span class="hljs-string">") }}

    {{ thread }}

    下一步应该是什么？
  "</span>#
}
</code></pre>
<p><strong>掌控提示的关键好处</strong>：</p>
<ol>
<li><strong>完全控制</strong>：编写 Agent 需要的确切指令，没有黑盒抽象</li>
<li><strong>测试和评估</strong>：为提示构建测试和评估，就像对任何其他代码一样</li>
<li><strong>迭代</strong>：根据真实世界的性能快速修改提示</li>
<li><strong>透明度</strong>：确切知道 Agent 正在使用什么指令</li>
<li><strong>角色黑客</strong>：利用支持非标准用户/助手角色用法的 API——例如，现已弃用的非聊天风格的 OpenAI "completions" API。这包括一些所谓的"模型洗脑"技术</li>
</ol>
<blockquote>
<p><strong>记住</strong>：提示是应用逻辑和 LLM 之间的主要接口。我不知道什么是最好的提示，但我知道你希望有灵活性来尝试一切。</p>
</blockquote>
<hr/>
<h3 data-id="heading-16">要素 3：掌控上下文窗口</h3>
<p>你不一定需要使用标准的基于消息的格式来向 LLM 传达上下文。</p>
<blockquote>
<h4 data-id="heading-17">在任何给定时刻，你在 Agent 中对 LLM 的输入是"这是到目前为止发生的事情，下一步是什么"</h4>
</blockquote>
<p><strong>一切都是上下文工程。</strong> LLM 是将输入转换为输出的无状态函数。要获得最好的输出，你需要给它们最好的输入。</p>
<p>创建出色的上下文意味着：</p>
<ul>
<li>你给模型的提示和指令</li>
<li>你检索的任何文档或外部数据（例如 RAG）</li>
<li>任何过去的状态、工具调用、结果或其他历史记录</li>
<li>来自相关但独立的历史/对话的任何过去消息或事件（记忆）</li>
<li>关于输出什么类型结构化数据的指令</li>
</ul>
<h4 data-id="heading-18">标准 vs 自定义上下文格式</h4>
<p>大多数 LLM 客户端使用这样的标准基于消息的格式：</p>
<pre><code class="hljs language-yaml" lang="yaml">[
  { <span class="hljs-attr">'role':</span> <span class="hljs-string">'system'</span>, <span class="hljs-attr">'content':</span> <span class="hljs-string">'你是一个有帮助的助手...'</span> },
  { <span class="hljs-attr">'role':</span> <span class="hljs-string">'user'</span>, <span class="hljs-attr">'content':</span> <span class="hljs-string">'你能部署后端吗？'</span> },
  { <span class="hljs-attr">'role':</span> <span class="hljs-string">'assistant'</span>, <span class="hljs-attr">'content':</span> <span class="hljs-literal">null</span>, <span class="hljs-attr">'tool_calls':</span> [{ <span class="hljs-attr">'id':</span> <span class="hljs-string">'1'</span>, <span class="hljs-attr">'name':</span> <span class="hljs-string">'list_git_tags'</span>, <span class="hljs-attr">'arguments':</span> <span class="hljs-string">'{}'</span> }] },
  { <span class="hljs-attr">'role':</span> <span class="hljs-string">'tool'</span>, <span class="hljs-attr">'name':</span> <span class="hljs-string">'list_git_tags'</span>, <span class="hljs-attr">'content':</span> <span class="hljs-string">'{"tags": [{"name": "v1.2.3", "commit": "abc123"}]}'</span>, <span class="hljs-attr">'tool_call_id':</span> <span class="hljs-string">'1'</span> }
]
</code></pre>
<p>虽然这对大多数用例很有效，但如果你想真正从今天的 LLM 中获得<strong>最大收益</strong>，你需要以最 token 高效和注意力高效的方式将上下文放入 LLM。</p>
<p>作为标准基于消息格式的替代方案，你可以构建自己针对用例优化的上下文格式。例如，你可以使用自定义对象并根据需要将它们打包/展开到一个或多个用户、系统、助手或工具消息中。</p>
<p>这是将整个上下文窗口放入单个用户消息的示例：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">slack_message</span>&gt;</span>
    From: @alex
    Channel: #deployments
    Text: 你能部署后端吗？
<span class="hljs-tag">&lt;/<span class="hljs-name">slack_message</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">list_git_tags</span>&gt;</span>
    intent: "list_git_tags"
<span class="hljs-tag">&lt;/<span class="hljs-name">list_git_tags</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">list_git_tags_result</span>&gt;</span>
    tags:
      - name: "v1.2.3"
        commit: "abc123"
        date: "2024-03-15T10:00:00Z"
      - name: "v1.2.2"
        commit: "def456"
        date: "2024-03-14T15:30:00Z"
<span class="hljs-tag">&lt;/<span class="hljs-name">list_git_tags_result</span>&gt;</span>
</code></pre>
<p>我们可以用这样的代码构建：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Thread</span>:
    events: <span class="hljs-type">List</span>[Event]

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Event</span>:
    <span class="hljs-built_in">type</span>: <span class="hljs-type">Literal</span>[<span class="hljs-string">"list_git_tags"</span>, <span class="hljs-string">"deploy_backend"</span>, <span class="hljs-string">"deploy_frontend"</span>,
                  <span class="hljs-string">"request_more_information"</span>, <span class="hljs-string">"done_for_now"</span>, <span class="hljs-string">"error"</span>, ...]
    data: <span class="hljs-type">Any</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">event_to_prompt</span>(<span class="hljs-params">event: Event</span>) -&gt; <span class="hljs-built_in">str</span>:
    data = event.data <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(event.data, <span class="hljs-built_in">str</span>) \
           <span class="hljs-keyword">else</span> stringify_to_yaml(event.data)
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"&lt;<span class="hljs-subst">{event.<span class="hljs-built_in">type</span>}</span>&gt;\n<span class="hljs-subst">{data}</span>\n&lt;/<span class="hljs-subst">{event.<span class="hljs-built_in">type</span>}</span>&gt;"</span>

<span class="hljs-keyword">def</span> <span class="hljs-title function_">thread_to_prompt</span>(<span class="hljs-params">thread: Thread</span>) -&gt; <span class="hljs-built_in">str</span>:
    <span class="hljs-keyword">return</span> <span class="hljs-string">'\n\n'</span>.join(event_to_prompt(event) <span class="hljs-keyword">for</span> event <span class="hljs-keyword">in</span> thread.events)
</code></pre>
<p><strong>掌控上下文窗口的关键好处</strong>：</p>
<ol>
<li><strong>信息密度</strong>：以最大化 LLM 理解的方式组织信息</li>
<li><strong>错误处理</strong>：以帮助 LLM 恢复的格式包含错误信息。考虑在错误解决后从上下文窗口隐藏错误和失败的调用</li>
<li><strong>安全性</strong>：控制什么信息传递给 LLM，过滤掉敏感数据</li>
<li><strong>灵活性</strong>：随着你了解什么对用例最有效而调整格式</li>
<li><strong>Token 效率</strong>：为 token 效率和 LLM 理解优化上下文格式</li>
</ol>
<blockquote>
<p><strong>反复出现的主题</strong>：我不知道什么是最好的方法，但我知道你希望有灵活性来尝试一切。</p>
</blockquote>
<h4 data-id="heading-19">关于上下文工程</h4>
<p>在 12 因素 Agent 发布大约 2 个月后，"上下文工程"开始成为一个相当流行的术语。Andrej Karpathy 和 Shopify CEO Tobi Lütke 都在推广这个概念：</p>
<blockquote>
<p>"我可能会将（提示工程）称为上下文工程的一部分。提示工程当然只是提示，但上下文工程是更广泛的过程。"</p>
</blockquote>
<hr/>
<h3 data-id="heading-20">要素 4：工具只是结构化输出</h3>
<p>工具不需要复杂。在其核心，它们只是来自 LLM 的结构化输出，触发确定性代码。</p>
<p>例如，假设你有两个工具 <code>CreateIssue</code> 和 <code>SearchIssues</code>。要求 LLM "使用几个工具之一"只是要求它输出我们可以解析为表示这些工具的对象的 JSON。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Issue</span>:
    title: <span class="hljs-built_in">str</span>
    description: <span class="hljs-built_in">str</span>
    team_id: <span class="hljs-built_in">str</span>
    assignee_id: <span class="hljs-built_in">str</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">CreateIssue</span>:
    intent: <span class="hljs-type">Literal</span>[<span class="hljs-string">"create_issue"</span>]
    issue: Issue

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SearchIssues</span>:
    intent: <span class="hljs-type">Literal</span>[<span class="hljs-string">"search_issues"</span>]
    query: <span class="hljs-built_in">str</span>
    what_youre_looking_for: <span class="hljs-built_in">str</span>
</code></pre>
<p><strong>模式很简单</strong>：</p>
<ol>
<li>LLM 输出结构化 JSON</li>
<li>确定性代码执行适当的操作（如调用外部 API）</li>
<li>结果被捕获并反馈到上下文中</li>
</ol>
<p>这在 LLM 的决策和应用操作之间创建了清晰的分离。<strong>LLM 决定做什么，但代码控制如何完成</strong>。仅仅因为 LLM "调用了工具"并不意味着你每次都必须以相同的方式执行特定的相应函数。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> next_step.intent == <span class="hljs-string">'create_payment_link'</span>:
    stripe.paymentlinks.create(next_step.parameters)
    <span class="hljs-keyword">return</span>  <span class="hljs-comment"># 或者你想要的任何东西</span>
<span class="hljs-keyword">elif</span> next_step.intent == <span class="hljs-string">'wait_for_a_while'</span>:
    <span class="hljs-comment"># 做一些单子操作</span>
    <span class="hljs-keyword">pass</span>
<span class="hljs-keyword">else</span>:  <span class="hljs-comment"># 模型没有调用我们知道的工具</span>
    <span class="hljs-comment"># 做其他事情</span>
    <span class="hljs-keyword">pass</span>
</code></pre>
<blockquote>
<p><strong>"下一步"可能不像"运行纯函数并返回结果"那样原子化。当你把"工具调用"想象成模型输出描述确定性代码应该做什么的 JSON 时，你就解锁了很多灵活性。</strong></p>
</blockquote>
<hr/>
<h3 data-id="heading-21">要素 5：统一执行状态与业务状态</h3>
<p>即使在 AI 世界之外，许多基础设施系统也试图将"执行状态"与"业务状态"分开。对于 AI 应用，这可能涉及复杂的抽象来跟踪当前步骤、下一步、等待状态、重试计数等。这种分离创建了可能值得但对用例可能过于复杂的复杂性。</p>
<p>更清楚地说：</p>
<ul>
<li><strong>执行状态</strong>：当前步骤、下一步、等待状态、重试计数等</li>
<li><strong>业务状态</strong>：Agent 工作流中到目前为止发生的事情（例如 OpenAI 消息列表、工具调用和结果列表等）</li>
</ul>
<p><strong>如果可能，简化——尽可能统一这些。</strong></p>
<p>实际上，你可以设计应用，使你可以从上下文窗口推断所有执行状态。在许多情况下，执行状态（当前步骤、等待状态等）只是关于到目前为止发生了什么的元数据。</p>
<p>你可能有一些不能放入上下文窗口的东西，如会话 ID、密码上下文等，但目标应该是最小化这些东西。</p>
<p><strong>这种方法有几个好处</strong>：</p>
<ol>
<li><strong>简单性</strong>：所有状态的单一事实来源</li>
<li><strong>序列化</strong>：线程是简单可序列化/反序列化的</li>
<li><strong>调试</strong>：整个历史记录在一个地方可见</li>
<li><strong>灵活性</strong>：通过添加新事件类型轻松添加新状态</li>
<li><strong>恢复</strong>：可以通过加载线程从任何点恢复</li>
<li><strong>分叉</strong>：可以通过将线程的某个子集复制到新上下文/状态 ID 来在任何点分叉线程</li>
<li><strong>人类界面和可观测性</strong>：将线程转换为人类可读的 markdown 或丰富的 Web 应用 UI 是简单的</li>
</ol>
<hr/>
<h3 data-id="heading-22">要素 6：启动/暂停/恢复的简单 API</h3>
<p>Agent 只是程序，我们对如何启动、查询、恢复和停止它们有一定的期望。</p>
<ul>
<li>用户、应用、管道和其他 Agent 应该能够通过简单的 API 启动 Agent</li>
<li>Agent 及其编排的确定性代码应该能够在需要长时间运行操作时暂停 Agent</li>
<li>像 webhook 这样的外部触发器应该使 Agent 能够从它们停止的地方恢复，而不需要与 Agent 编排器深度集成</li>
</ul>
<p>与要素 5（统一执行状态和业务状态）和要素 8（掌控控制流）密切相关，但可以独立实现。</p>
<blockquote>
<p><strong>注意</strong>：AI 编排器通常允许暂停和恢复，但不是在工具选择和工具执行之间的时刻。</p>
</blockquote>
<hr/>
<h3 data-id="heading-23">要素 7：用工具调用联系人类</h3>
<p>默认情况下，LLM API 依赖于一个基本的<strong>高风险</strong> token 选择：我们是返回纯文本内容，还是返回结构化数据？</p>
<p>你在第一个 token 的选择上放了很多权重，在 <code>the weather in tokyo</code> 的情况下，它是：</p>
<blockquote>
<p>"the"</p>
</blockquote>
<p>但在 <code>fetch_weather</code> 的情况下，它是某个表示 JSON 对象开始的特殊 token：</p>
<blockquote>
<p>|JSON&gt;</p>
</blockquote>
<p>你可能会通过让 LLM <strong>始终</strong>输出 JSON 来获得更好的结果，然后用一些自然语言 token 如 <code>request_human_input</code> 或 <code>done_for_now</code> 声明其意图（而不是像 <code>check_weather_in_city</code> 这样的"正式"工具）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Options</span>:
    urgency: <span class="hljs-type">Literal</span>[<span class="hljs-string">"low"</span>, <span class="hljs-string">"medium"</span>, <span class="hljs-string">"high"</span>]
    <span class="hljs-built_in">format</span>: <span class="hljs-type">Literal</span>[<span class="hljs-string">"free_text"</span>, <span class="hljs-string">"yes_no"</span>, <span class="hljs-string">"multiple_choice"</span>]
    choices: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]

<span class="hljs-comment"># 人类交互的工具定义</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RequestHumanInput</span>:
    intent: <span class="hljs-type">Literal</span>[<span class="hljs-string">"request_human_input"</span>]
    question: <span class="hljs-built_in">str</span>
    context: <span class="hljs-built_in">str</span>
    options: Options

<span class="hljs-comment"># Agent 循环中的示例用法</span>
<span class="hljs-keyword">if</span> next_step.intent == <span class="hljs-string">'request_human_input'</span>:
    thread.events.append({
        <span class="hljs-string">'type'</span>: <span class="hljs-string">'human_input_requested'</span>,
        <span class="hljs-string">'data'</span>: next_step
    })
    thread_id = <span class="hljs-keyword">await</span> save_state(thread)
    <span class="hljs-keyword">await</span> notify_human(next_step, thread_id)
    <span class="hljs-keyword">return</span>  <span class="hljs-comment"># 中断循环并等待响应带着线程 ID 返回</span>
<span class="hljs-keyword">else</span>:
    <span class="hljs-comment"># ... 其他情况</span>
</code></pre>
<p>稍后，你可能会从处理 Slack、电子邮件、短信或其他事件的系统收到 webhook：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">'/webhook'</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">webhook</span>(<span class="hljs-params">req: Request</span>):
    thread_id = req.body.thread_id
    thread = <span class="hljs-keyword">await</span> load_state(thread_id)
    thread.events.append({
        <span class="hljs-string">'type'</span>: <span class="hljs-string">'response_from_human'</span>,
        <span class="hljs-string">'data'</span>: req.body
    })
    <span class="hljs-comment"># ... 简化为简洁起见，你可能不想在这里阻塞 web worker</span>
    next_step = <span class="hljs-keyword">await</span> determine_next_step(thread_to_prompt(thread))
    thread.events.append(next_step)
    result = <span class="hljs-keyword">await</span> handle_next_step(thread, next_step)
    <span class="hljs-comment"># 循环或中断或你想要的任何东西</span>

    <span class="hljs-keyword">return</span> {<span class="hljs-string">"status"</span>: <span class="hljs-string">"ok"</span>}
</code></pre>
<p><strong>好处</strong>：</p>
<ol>
<li><strong>清晰的指令</strong>：用于不同类型人类联系的工具允许 LLM 更具体</li>
<li><strong>内循环 vs 外循环</strong>：启用<strong>在</strong>传统 chatGPT 风格界面<strong>之外</strong>的 Agent 工作流，其中控制流和上下文初始化可能是 <code>Agent-&gt;Human</code> 而不是 <code>Human-&gt;Agent</code>（想想由 cron 或事件启动的 Agent）</li>
<li><strong>多人访问</strong>：可以通过结构化事件轻松跟踪和协调来自不同人类的输入</li>
<li><strong>多 Agent</strong>：简单的抽象可以轻松扩展以支持 <code>Agent-&gt;Agent</code> 请求和响应</li>
<li><strong>持久性</strong>：与要素 6（启动/暂停/恢复）结合，这使得持久、可靠和可内省的多人工作流成为可能</li>
</ol>
<hr/>
<h3 data-id="heading-24">要素 8：掌控控制流</h3>
<p>如果你拥有控制流，你可以做很多有趣的事情。</p>
<p>为特定用例构建有意义的控制结构。具体来说，某些类型的工具调用可能是中断循环并等待人类或另一个长时间运行任务（如训练管道）响应的理由。你可能还想整合以下自定义实现：</p>
<ul>
<li>工具调用结果的摘要或缓存</li>
<li>对结构化输出的 LLM 作为评判者</li>
<li>上下文窗口压缩或其他记忆管理</li>
<li>日志记录、跟踪和指标</li>
<li>客户端速率限制</li>
<li>持久睡眠/暂停/"等待事件"</li>
</ul>
<p>以下示例显示了三种可能的控制流模式：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">handle_next_step</span>(<span class="hljs-params">thread: Thread</span>):
    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
        next_step = <span class="hljs-keyword">await</span> determine_next_step(thread_to_prompt(thread))

        <span class="hljs-keyword">if</span> next_step.intent == <span class="hljs-string">'request_clarification'</span>:
            <span class="hljs-comment"># 模型请求更多信息，中断循环等待人类响应</span>
            thread.events.append({
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'request_clarification'</span>,
                <span class="hljs-string">'data'</span>: next_step,
            })
            <span class="hljs-keyword">await</span> send_message_to_human(next_step)
            <span class="hljs-keyword">await</span> db.save_thread(thread)
            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 异步步骤 - 中断循环，稍后我们会收到 webhook</span>

        <span class="hljs-keyword">elif</span> next_step.intent == <span class="hljs-string">'fetch_open_issues'</span>:
            <span class="hljs-comment"># 同步步骤 - 获取数据并传回 LLM</span>
            thread.events.append({
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'fetch_open_issues'</span>,
                <span class="hljs-string">'data'</span>: next_step,
            })
            issues = <span class="hljs-keyword">await</span> linear_client.issues()
            thread.events.append({
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'fetch_open_issues_result'</span>,
                <span class="hljs-string">'data'</span>: issues,
            })
            <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># 将新上下文传递给 LLM 以确定下下一步</span>

        <span class="hljs-keyword">elif</span> next_step.intent == <span class="hljs-string">'create_issue'</span>:
            <span class="hljs-comment"># 高风险操作 - 中断循环等待人类批准</span>
            thread.events.append({
                <span class="hljs-string">'type'</span>: <span class="hljs-string">'create_issue'</span>,
                <span class="hljs-string">'data'</span>: next_step,
            })
            <span class="hljs-keyword">await</span> request_human_approval(next_step)
            <span class="hljs-keyword">await</span> db.save_thread(thread)
            <span class="hljs-keyword">break</span>  <span class="hljs-comment"># 异步步骤 - 中断循环，稍后我们会收到 webhook</span>
</code></pre>
<p>这种模式允许你根据需要中断和恢复 Agent 的流程，创建更自然的对话和工作流。</p>
<p><strong>示例</strong>：我对每个 AI 框架的第一个功能请求是我们需要能够中断正在工作的 Agent 并稍后恢复，<strong>特别是</strong>在工具<strong>选择</strong>和工具<strong>调用</strong>之间的时刻。</p>
<p>没有这种可恢复性/粒度级别，就没有办法在工具调用运行之前审查/批准它，这意味着你被迫要么：</p>
<ol>
<li>在等待长时间运行的事情完成时将任务保持在内存中（想想 <code>while...sleep</code>），如果进程被中断就从头开始重新启动</li>
<li>将 Agent 限制为只能进行低风险、低风险的调用，如研究和摘要</li>
<li>给 Agent 访问做更大、更有用事情的权限，然后就 yolo 希望它不会搞砸</li>
</ol>
<hr/>
<h3 data-id="heading-25">要素 9：将错误压缩进上下文窗口</h3>
<p>这一点比较简短但值得一提。Agent 的好处之一是"自我修复"——对于短任务，LLM 可能会调用一个失败的工具。好的 LLM 有相当好的机会阅读错误消息或堆栈跟踪并找出在后续工具调用中要更改的内容。</p>
<p>大多数框架实现了这一点，但你可以<strong>只做这一点</strong>而不做其他 11 个因素。这是一个例子：</p>
<pre><code class="hljs language-python" lang="python">thread = {<span class="hljs-string">"events"</span>: [initial_message]}

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    next_step = <span class="hljs-keyword">await</span> determine_next_step(thread_to_prompt(thread))
    thread[<span class="hljs-string">"events"</span>].append({
        <span class="hljs-string">"type"</span>: next_step.intent,
        <span class="hljs-string">"data"</span>: next_step,
    })
    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-keyword">await</span> handle_next_step(thread, next_step)  <span class="hljs-comment"># 我们的 switch 语句</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-comment"># 如果我们得到一个错误，我们可以将它添加到上下文窗口并重试</span>
        thread[<span class="hljs-string">"events"</span>].append({
            <span class="hljs-string">"type"</span>: <span class="hljs-string">'error'</span>,
            <span class="hljs-string">"data"</span>: format_error(e),
        })
        <span class="hljs-comment"># 循环，或在这里做任何其他事情来尝试恢复</span>
</code></pre>
<p>你可能想为特定工具调用实现错误计数器，限制单个工具的约 3 次尝试，或任何其他对用例有意义的逻辑：</p>
<pre><code class="hljs language-python" lang="python">consecutive_errors = <span class="hljs-number">0</span>

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-comment"># ... 现有代码 ...</span>

    <span class="hljs-keyword">try</span>:
        result = <span class="hljs-keyword">await</span> handle_next_step(thread, next_step)
        thread[<span class="hljs-string">"events"</span>].append({
            <span class="hljs-string">"type"</span>: next_step.intent + <span class="hljs-string">'_result'</span>,
            <span class="hljs-string">"data"</span>: result,
        })
        <span class="hljs-comment"># 成功！重置错误计数器</span>
        consecutive_errors = <span class="hljs-number">0</span>
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        consecutive_errors += <span class="hljs-number">1</span>
        <span class="hljs-keyword">if</span> consecutive_errors &lt; <span class="hljs-number">3</span>:
            <span class="hljs-comment"># 执行循环并重试</span>
            thread[<span class="hljs-string">"events"</span>].append({
                <span class="hljs-string">"type"</span>: <span class="hljs-string">'error'</span>,
                <span class="hljs-string">"data"</span>: format_error(e),
            })
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># 中断循环，重置上下文窗口的部分，升级到人类，或你想做的任何其他事情</span>
            <span class="hljs-keyword">break</span>
</code></pre>
<p>达到某个连续错误阈值可能是升级到人类的好地方，无论是通过模型决策还是通过控制流的确定性接管。</p>
<p><strong>好处</strong>：</p>
<ol>
<li><strong>自我修复</strong>：LLM 可以阅读错误消息并找出在后续工具调用中要更改的内容</li>
<li><strong>持久性</strong>：即使一个工具调用失败，Agent 也可以继续运行</li>
</ol>
<blockquote>
<p>我确信你会发现如果你这样做太多， Agent 会开始失控，可能会一遍又一遍地重复相同的错误。这就是要素 8（掌控控制流）和要素 3（掌控上下文构建）发挥作用的地方——你不需要只是将原始错误放回去，你可以完全重构它的表示方式，从上下文窗口中删除之前的事件，或任何你发现有效的确定性事情来让 Agent 回到正轨。</p>
</blockquote>
<p>但防止错误失控的第一方法是拥抱<strong>要素 10——小而专注的 Agent</strong>。</p>
<hr/>
<h3 data-id="heading-26">要素 10：小而专注的 Agent</h3>
<p>与其构建试图做所有事情的单体 Agent，不如构建做好一件事的小而专注的 Agent。Agent 只是更大、主要是确定性系统中的一个构建块。</p>
<p>这里的关键洞察是关于 LLM 的限制：任务越大越复杂，需要的步骤就越多，这意味着更长的上下文窗口。<strong>随着上下文的增长，LLM 更可能迷失或失去焦点</strong>。通过让 Agent 专注于 3-10 步，最多 20 步的特定领域，我们保持上下文窗口可管理，LLM 性能高。</p>
<blockquote>
<h4 data-id="heading-27">随着上下文增长，LLM 更可能迷失或失去焦点</h4>
</blockquote>
<p><strong>小而专注的 Agent 的好处</strong>：</p>
<ol>
<li><strong>可管理的上下文</strong>：更小的上下文窗口意味着更好的 LLM 性能</li>
<li><strong>清晰的职责</strong>：每个 Agent 都有明确的范围和目的</li>
<li><strong>更好的可靠性</strong>：在复杂工作流中迷失的机会更少</li>
<li><strong>更容易测试</strong>：更容易测试和验证特定功能</li>
<li><strong>改进的调试</strong>：当问题发生时更容易识别和修复</li>
</ol>
<h3 data-id="heading-28">如果 LLM 变得更聪明怎么办？</h3>
<p>如果 LLM 变得足够聪明可以处理 100 步以上的工作流，我们还需要这个吗？</p>
<p>简短的回答是<strong>是的</strong>。随着 Agent 和 LLM 的改进，它们<strong>可能</strong>自然扩展到能够处理更长的上下文窗口。这意味着处理更大 DAG 的更多部分。这种小而专注的方法确保你<strong>今天</strong>就能获得结果，同时让你准备好随着 LLM 上下文窗口变得更可靠而慢慢扩展 Agent 范围。（如果你以前重构过大型确定性代码库，你现在可能正在点头。）</p>
<p>有意识地控制 Agent 的大小/范围，并且只以允许你保持质量的方式增长，是这里的关键。正如构建 NotebookLM 的团队所说：</p>
<blockquote>
<p>"我觉得一致地，AI 构建中最神奇的时刻对我来说是当我真的、真的、真的接近模型能力边缘的时候"</p>
</blockquote>
<p>无论那个边界在哪里，如果你能找到那个边界并始终做对，你就会构建神奇的体验。这里有很多护城河可以建立，但像往常一样，它们需要一些工程严谨性。</p>
<hr/>
<h3 data-id="heading-29">要素 11：从任何地方触发，在用户所在的地方服务</h3>
<p>如果你正在做要素 6（启动/暂停/恢复的简单 API）和要素 7（用工具调用联系人类），你就准备好整合这个因素了。</p>
<p>使用户能够从 Slack、电子邮件、短信或他们想要的任何其他渠道触发 Agent。使 Agent 能够通过相同的渠道响应。</p>
<p><strong>好处</strong>：</p>
<ol>
<li><strong>在用户所在的地方服务</strong>：这帮助你构建感觉像真人或至少像数字同事的 AI 应用</li>
<li><strong>外循环 Agent</strong>：使 Agent 能够被非人类触发，例如事件、cron、故障等。它们可能工作 5、20、90 分钟，但当它们到达关键点时，可以联系人类寻求帮助、反馈或批准</li>
<li><strong>高风险工具</strong>：如果你能快速循环各种人类，你可以给 Agent 访问更高风险的操作，如发送外部电子邮件、更新生产数据等。保持清晰的标准让你获得可审计性和对执行更大更好事情的 Agent 的信心</li>
</ol>
<hr/>
<h3 data-id="heading-30">要素 12：让 Agent 成为无状态 Reducer</h3>
<p>好吧，我们已经超过 1000 行 markdown 了。这个主要只是为了好玩。</p>
<p>从函数式编程的角度来看，Agent 本质上是一个 <strong>reducer</strong>——一个接收当前状态和事件，返回新状态的纯函数：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">newState</span> = reducer(currentState, event)
</code></pre>
<p>或者用 Haskell 风格表示：</p>
<pre><code class="hljs language-haskell" lang="haskell">foldl agentStep initialState events
</code></pre>
<p>这种无状态 reducer 的思维方式有助于我们：</p>
<ul>
<li>更清晰地思考 Agent 的行为</li>
<li>更容易测试和调试</li>
<li>更好地实现持久化和恢复</li>
</ul>
<hr/>
<h2 data-id="heading-31">附录：预取上下文</h2>
<p>如果模型很可能会调用工具 X，不要浪费 token 往返告诉模型去获取它。</p>
<p><strong>不要这样</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 提示中包含：</span>
<span class="hljs-comment"># "当查看部署时，你可能想获取已发布的 git 标签列表..."</span>
<span class="hljs-comment"># 工具选项包括：list_git_tags, deploy_backend_to_prod, done_for_now</span>

thread = {<span class="hljs-string">"events"</span>: [initial_message]}
next_step = <span class="hljs-keyword">await</span> determine_next_step(thread)

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-keyword">if</span> next_step.intent == <span class="hljs-string">'list_git_tags'</span>:
        tags = <span class="hljs-keyword">await</span> fetch_git_tags()
        thread[<span class="hljs-string">"events"</span>].append({
            <span class="hljs-string">"type"</span>: <span class="hljs-string">'list_git_tags'</span>,
            <span class="hljs-string">"data"</span>: tags,
        })
    <span class="hljs-keyword">elif</span> next_step.intent == <span class="hljs-string">'deploy_backend_to_prod'</span>:
        <span class="hljs-comment"># ...</span>
</code></pre>
<p><strong>而是这样</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 提示中直接包含：</span>
<span class="hljs-comment"># "当前的 git 标签是：{{ git_tags }}"</span>
<span class="hljs-comment"># 工具选项只有：deploy_backend_to_prod, done_for_now</span>

thread = {<span class="hljs-string">"events"</span>: [initial_message]}
git_tags = <span class="hljs-keyword">await</span> fetch_git_tags()  <span class="hljs-comment"># 预取！</span>

next_step = <span class="hljs-keyword">await</span> determine_next_step(thread, git_tags)

<span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
    <span class="hljs-keyword">if</span> next_step.intent == <span class="hljs-string">'deploy_backend_to_prod'</span>:
        <span class="hljs-comment"># ...</span>
</code></pre>
<p>或者更好的是，将标签包含在线程中，从提示模板中删除特定参数：</p>
<pre><code class="hljs language-python" lang="python">thread = {<span class="hljs-string">"events"</span>: [initial_message]}

<span class="hljs-comment"># 添加请求</span>
thread[<span class="hljs-string">"events"</span>].append({
    <span class="hljs-string">"type"</span>: <span class="hljs-string">'list_git_tags'</span>,
})

git_tags = <span class="hljs-keyword">await</span> fetch_git_tags()

<span class="hljs-comment"># 添加结果</span>
thread[<span class="hljs-string">"events"</span>].append({
    <span class="hljs-string">"type"</span>: <span class="hljs-string">'list_git_tags_result'</span>,
    <span class="hljs-string">"data"</span>: git_tags,
})

next_step = <span class="hljs-keyword">await</span> determine_next_step(thread)
</code></pre>
<blockquote>
<h4 data-id="heading-32">如果你已经知道你想让模型调用什么工具，就<strong>确定性地</strong>调用它们，让模型做弄清楚如何使用它们输出的困难部分</h4>
</blockquote>
<p>再次强调，AI 工程全都是关于<strong>上下文工程</strong>。</p>
<hr/>
<h2 data-id="heading-33">总结</h2>
<p>12 因素 Agent 方法论为我们提供了一套系统化的方法来构建可靠、可维护的 AI Agent 系统。让我们回顾核心要点：</p>
<h3 data-id="heading-34">核心理念</h3>
<ol>
<li><strong>Agent 只是软件</strong>——不要被"AI Agent"的概念神秘化，它们本质上是有输入、有输出、有状态的程序</li>
<li><strong>简单优于复杂</strong>——从小而专注的 Agent 开始，只在证明可靠后才扩展范围</li>
<li><strong>掌控一切</strong>——掌控提示、上下文、控制流，不要把这些关键能力外包给框架</li>
</ol>
<h3 data-id="heading-35">十二要素速查</h3>






































































<table><thead><tr><th>要素</th><th>核心思想</th><th>一句话总结</th></tr></thead><tbody><tr><td>1</td><td>自然语言到工具调用</td><td>LLM 负责意图理解，代码负责执行</td></tr><tr><td>2</td><td>掌控提示词</td><td>提示是一等代码，不是黑盒配置</td></tr><tr><td>3</td><td>掌控上下文窗口</td><td>一切都是上下文工程</td></tr><tr><td>4</td><td>工具只是结构化输出</td><td>工具调用只是 JSON，执行由你决定</td></tr><tr><td>5</td><td>统一执行状态与业务状态</td><td>简化状态管理，单一事实来源</td></tr><tr><td>6</td><td>启动/暂停/恢复</td><td>像普通程序一样管理 Agent 生命周期</td></tr><tr><td>7</td><td>用工具调用联系人类</td><td>人机交互也是一种工具调用</td></tr><tr><td>8</td><td>掌控控制流</td><td>自定义循环逻辑，按需中断和恢复</td></tr><tr><td>9</td><td>错误压缩进上下文</td><td>让 LLM 自我修复，但设置限制</td></tr><tr><td>10</td><td>小而专注的 Agent</td><td>限制范围，保持上下文可管理</td></tr><tr><td>11</td><td>从任何地方触发</td><td>在用户所在的地方服务</td></tr><tr><td>12</td><td>无状态 Reducer</td><td>函数式思维让 Agent 更可预测</td></tr></tbody></table>
<h3 data-id="heading-36">最后的思考</h3>
<p>构建生产级 AI Agent 不是要追求最复杂的架构或最先进的框架。相反，它是关于：</p>
<ul>
<li><strong>理解 LLM 的限制</strong>——上下文窗口越长，性能越差</li>
<li><strong>保持简单</strong>——从小处着手，证明有效后再扩展</li>
<li><strong>拥抱确定性</strong>——让 LLM 做它擅长的（理解和推理），让代码做代码擅长的（可靠执行）</li>
<li><strong>为人类设计</strong>——Agent 应该增强人类能力，而不是取代人类判断</li>
</ul>
<blockquote>
<p>"我觉得一致地，AI 构建中最神奇的时刻是当我真的接近模型能力边缘的时候"</p>
</blockquote>
<p>找到那个边界，并始终在那里交付，这就是构建神奇 AI 体验的秘诀。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解构 TTS：从文本符号到声波信号的演进]]></title>    <link>https://juejin.cn/post/7581363652780539914</link>    <guid>https://juejin.cn/post/7581363652780539914</guid>    <pubDate>2025-12-08T15:34:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581363652780539914" data-draft-id="7581359420392063003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解构 TTS：从文本符号到声波信号的演进"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-08T15:34:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="这儿有一堆花"/> <meta itemprop="url" content="https://juejin.cn/user/3076912575965819"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解构 TTS：从文本符号到声波信号的演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3076912575965819/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    这儿有一堆花
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:34:32.000Z" title="Mon Dec 08 2025 15:34:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前端处理：文本的标准化与音素化</h2>
<p>系统接收到输入文本后的首要任务是清洗与转换。人类书写的文本充满了非标准化的符号，计算机无法直接处理这些包含歧义的信息。前端模块必须解决文本归一化的问题，将“$20”转化为“twenty dollars”，或者将日期格式展开为标准读音序列。这一步骤决定了后续发音的准确性基础，任何在此阶段遗漏的信息都会导致最终合成的错误。</p>
<p><strong>Hugging Face Transformers 文档：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmediumdirt.com%2Fb.3EVo0APo3Cp%2FvcbfmkVvJHZRDM0l2-MoD-QKwjN%2FDUAd3aLeT%2FYBwuNXDuAG0oMjDlgE" target="_blank" title="https://mediumdirt.com/b.3EVo0APo3Cp/vcbfmkVvJHZRDM0l2-MoD-QKwjN/DUAd3aLeT/YBwuNXDuAG0oMjDlgE" ref="nofollow noopener noreferrer">huggingface.co/docs/transf…</a></p>
<p>文本被规范化后，字素转音素（G2P）模块介入。它将正字法层面的单词转换为代表实际发音的音素序列。英语中的多音字或中文里的变调都需要通过查阅发音词典或运行预训练模型来消除歧义。只有将文本彻底拆解为音素、重音和韵律标记，声学模型才能接收到清晰的指令。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> torch
<span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextEncoder</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, vocab_size, embed_dim, hidden_dim</span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.embedding = nn.Embedding(vocab_size, embed_dim)
        self.lstm = nn.LSTM(embed_dim, hidden_dim, batch_first=<span class="hljs-literal">True</span>, bidirectional=<span class="hljs-literal">True</span>)
        self.linear = nn.Linear(hidden_dim * <span class="hljs-number">2</span>, embed_dim)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        x = self.embedding(x)
        x, _ = self.lstm(x)
        <span class="hljs-keyword">return</span> self.linear(x)
</code></pre>
<h2 data-id="heading-1">声学模型：预测声音的特征图谱</h2>
<p>音素序列本身没有声音，它们只是代表发音位置的抽象符号。声学模型的任务是将这些符号序列转化为声学特征，通常是梅尔频谱图。这个过程涉及对时长、基频（F0）和能量的预测。</p>
<p>早期的 Tacotron 系列模型采用循环神经网络架构，虽然生成效果尚可，但自回归的生成方式导致推理速度缓慢，且容易出现漏词或重复读词的现象。工业界随后转向了以 FastSpeech 为代表的非自回归架构。这种架构利用 Transformer 的自注意力机制并行生成所有帧的频谱，并通过显式的时长预测器来控制每个音素的发音长度。这种转变极大地提升了合成速度，同时也增强了对韵律的控制能力。</p>
<p><strong>PyTorch 官方网站：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmediumdirt.com%2Fb.3EVo0APo3Cp%2FvcbfmkVvJHZRDM0l2-MoD-QKwjN%2FDUAd3aLeT%2FYBwuNXDuAG0oMjDlgE" target="_blank" title="https://mediumdirt.com/b.3EVo0APo3Cp/vcbfmkVvJHZRDM0l2-MoD-QKwjN/DUAd3aLeT/YBwuNXDuAG0oMjDlgE" ref="nofollow noopener noreferrer">pytorch.org/</a></p>
<p>声学模型输出的梅尔频谱图实际上是一种频域特征，它丢失了相位信息，因此人类无法直接听到声音。它更像是一张乐谱，详细记录了在不同时间点应该出现的频率强度，等待着被还原为波形。</p>
<h2 data-id="heading-2">声码器：从特征到波形的重构</h2>
<p>声码器负责将声学特征还原为原始波形。这是一个极具挑战性的逆问题，因为从频谱图恢复相位信息存在无数种可能性。传统的 Griffin-Lim 算法依靠数学迭代估算相位，但合成出来的声音往往带有明显的金属感和底噪，缺乏真实度。</p>
<p>深度学习时代的声码器彻底改变了这一局面。WaveNet 展示了逐样本点生成的惊人音质，但极低的效率限制了其应用。随后出现的 HiFi-GAN 利用生成对抗网络解决了效率与质量的矛盾。生成器试图伪造逼真的波形，判别器则在多尺度上鉴别真伪，两者的博弈使得最终生成的音频在听感上几乎难以与真人录音区分。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Generator</span>(torch.nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, initial_channel, resblock_kernel_sizes, resblock_dilation_sizes, upsample_rates, upsample_initial_channel, upsample_kernel_sizes, gin_channels=<span class="hljs-number">0</span></span>):
        <span class="hljs-built_in">super</span>(Generator, self).__init__()
        self.num_kernels = <span class="hljs-built_in">len</span>(resblock_kernel_sizes)
        self.num_upsamples = <span class="hljs-built_in">len</span>(upsample_rates)
        self.conv_pre = torch.nn.Conv1d(<span class="hljs-number">80</span>, initial_channel, <span class="hljs-number">7</span>, <span class="hljs-number">1</span>, padding=<span class="hljs-number">3</span>)
        resblock = ResBlock1 <span class="hljs-keyword">if</span> resblock_type == <span class="hljs-string">'1'</span> <span class="hljs-keyword">else</span> ResBlock2
        self.ups = torch.nn.ModuleList()
        <span class="hljs-keyword">for</span> i, (u, k) <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(<span class="hljs-built_in">zip</span>(upsample_rates, upsample_kernel_sizes)):
            self.ups.append(weight_norm(
                torch.nn.ConvTranspose1d(initial_channel//(<span class="hljs-number">2</span>**i), initial_channel//(<span class="hljs-number">2</span>**(i+<span class="hljs-number">1</span>)), k, u, padding=(k-u)//<span class="hljs-number">2</span>)))
</code></pre>
<h2 data-id="heading-3">端到端与语言模型的融合</h2>
<p>最新的技术趋势正在打破上述模块化的界限。VITS 等模型尝试将声学模型与声码器合并，利用变分推断直接从文本生成波形，消除了中间特征转换带来的误差累积。</p>
<p>与此同时，基于大语言模型（LLM）的音频生成方案正在兴起。这类系统不处理频谱图，而是将音频量化为离散的编码（Token）。模型像处理文本接龙一样预测下一个音频 Token，从而展现出强大的零样本克隆能力。只需数秒的参考音频，模型即可在不进行微调的情况下，复制说话人的音色与环境背景。这标志着语音合成正从单纯的信号处理迈向通用的生成式人工智能阶段。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vite 5重磅更新：揭秘10个提升开发体验的隐藏功能，让你的构建速度再快50%]]></title>    <link>https://juejin.cn/post/7581386627675832360</link>    <guid>https://juejin.cn/post/7581386627675832360</guid>    <pubDate>2025-12-09T00:16:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581386627675832360" data-draft-id="7581354812861284404" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vite 5重磅更新：揭秘10个提升开发体验的隐藏功能，让你的构建速度再快50%"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2025-12-09T00:16:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vite 5重磅更新：揭秘10个提升开发体验的隐藏功能，让你的构建速度再快50%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T00:16:40.000Z" title="Tue Dec 09 2025 00:16:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>Vite 5重磅更新：揭秘10个提升开发体验的隐藏功能，让你的构建速度再快50%</strong></h2>
<h2 data-id="heading-1">引言</h2>
<p>在前端工具链的激烈竞争中，Vite 凭借其极速的开发服务器和创新的构建理念迅速崛起。2023年末，Vite 5 正式发布，不仅带来了显著的性能提升，还隐藏了许多可能被忽视的强大功能。本文将深入剖析这些“秘密武器”，揭示它们如何将你的开发体验推向新高度——从热更新到生产构建，甚至能让整体效率再提升50%。</p>
<h2 data-id="heading-2">一、Vite 5的核心架构升级</h2>
<h3 data-id="heading-3">1. Rust驱动的底层优化</h3>
<p>Vite 5 首次将部分核心模块迁移至Rust实现（如<code>esbuild-rs</code>），这使得依赖解析速度相比JavaScript版本提升了30%。实际测试中，一个包含500个模块的项目冷启动时间从2.1秒降至1.4秒。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 新旧版本对比（使用--force选项强制清除缓存）</span>
vite4: [vite] server ready <span class="hljs-keyword">in</span> 2100ms
vite5: [vite] server ready <span class="hljs-keyword">in</span> 1400ms
</code></pre>
<h3 data-id="heading-4">2. Rollup 4深度集成</h3>
<p>内置Rollup版本升级至v4.x，带来：</p>
<ul>
<li>Tree-shaking精度提高15%（尤其对CSS-in-JS库）</li>
<li>chunk分割策略优化（支持<code>experimentalManualChunks</code>配置项）</li>
<li>WASM导入语法原生支持</li>
</ul>
<h2 data-id="heading-5">二、开发者工具的颠覆性改进</h2>
<h3 data-id="heading-6">3. Lightning HMR：亚毫秒级热更新</h3>
<p>通过新的HMR协议设计：</p>
<ul>
<li>Vue单文件组件更新延迟从23ms降至8ms</li>
<li>React Fast Refresh链路缩短40%</li>
<li>CSS模块热替换不再触发页面重排</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
   <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">hmr</span>: {
         <span class="hljs-attr">protocol</span>: <span class="hljs-string">'ws'</span>, <span class="hljs-comment">// 新增'wss'选项用于HTTPS环境</span>
         <span class="hljs-attr">timeout</span>: <span class="hljs-number">3000</span>, <span class="hljs-comment">// ← HMR超时时间可配置化 </span>
      }
   }
}
</code></pre>
<h3 data-id="heading-7">4. DevTools性能分析面板</h3>
<p>内置的<code>@vitejs/plugin-inspect</code>现在支持：</p>
<ul>
<li><strong>依赖预构建可视化</strong>：展示哪些npm包被自动optimized</li>
<li><strong>HMR边界追踪</strong>：图形化显示组件更新影响范围</li>
<li><strong>内存占用监控</strong>：实时显示模块缓存大小</li>
</ul>
<p><img src="https://example.com/vite5-devtools.png" alt="DevTools截图" loading="lazy"/></p>
<h2 data-id="heading-8">三、构建效率的黑科技</h2>
<h3 data-id="heading-9">5. SWC转译器实验性支持</h3>
<p>在<code>vite.config.js</code>中启用SWC替代Babel：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
   <span class="hljs-attr">esbuild</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 禁用esbuild</span>
   <span class="hljs-attr">swc</span>: {
      <span class="hljs-attr">jsc</span>: {
         <span class="hljs-attr">parser</span>: { <span class="hljs-attr">syntax</span>: <span class="hljs-string">'typescript'</span> },
         <span class="hljs-attr">transform</span>: { <span class="hljs-attr">react</span>: { <span class="hljs-attr">runtime</span>: <span class="hljs-string">'automatic'</span> } }
      }
   }
}
</code></pre>
<p>实测结果：</p>
<ul>
<li>React项目构建速度提升42%</li>
<li>TS类型擦除阶段耗时减少65%</li>
</ul>
<h3 data-id="heading-10">6. Smart Persistent Cache机制</h3>
<p>全新的缓存策略特点：</p>
<ul>
<li><strong>版本感知</strong>：当package.json变更时自动失效缓存</li>
<li><strong>差分存储</strong>：仅保存变更部分的编译结果</li>
<li><strong>SSR同构缓存</strong>：服务端/客户端构建共享缓存池</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Cache命中率日志示例 </span>
[vite] cache hit ratio: client(92%), server(85%)
</code></pre>
<p>##四、进阶配置技巧</p>
<p>###7. Fine-grained Chunk Splitting<br/>
基于路由的智能代码分割：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> { splitVendorChunkPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
   <span class="hljs-attr">build</span>: {
      <span class="hljs-attr">rollupOptions</span>: {
         <span class="hljs-attr">output</span>: {
            <span class="hljs-title function_">manualChunks</span>(<span class="hljs-params">id</span>) {
               <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'node_modules'</span>)) {
                  <span class="hljs-keyword">return</span> <span class="hljs-string">'vendor'</span>
               }
               <span class="hljs-keyword">if</span> (id.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'/src/views/'</span>)) {
                  <span class="hljs-keyword">return</span> id.<span class="hljs-title function_">split</span>(<span class="hljs-string">'/views/'</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">split</span>(<span class="hljs-string">'/'</span>)[<span class="hljs-number">0</span>]
               }
            }
         }
      },
      <span class="hljs-attr">chunkSizeWarningLimit</span>: <span class="hljs-number">1024</span> <span class="hljs-comment">// ←增大chunk告警阈值 </span>
   },
   <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">splitVendorChunkPlugin</span>()]
})
</code></pre>
<p>###8. Worker线程的零成本调用<br/>
Web Worker开发体验革新：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// worker.ts →会被自动转换为myWorker.js?worker  </span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComlinkWorker</span>&lt;<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./worker'</span>)&gt;(
   <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(<span class="hljs-string">'./worker'</span>, <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)  
)

<span class="hljs-comment">// Main thread调用示例  </span>
<span class="hljs-keyword">await</span> worker.<span class="hljs-title function_">heavyTask</span>(params)
</code></pre>
<p>关键改进：</p>
<ul>
<li>TypeScript类型自动推导</li>
<li>HMR支持（开发模式下）</li>
<li>CSP合规的Blob URL生成</li>
</ul>
<p>##五、生态整合的新维度</p>
<p>###9. Unified SSR Hydration模式<br/>
服务端渲染的重大改进：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js  </span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {   
   <span class="hljs-attr">ssr</span>: {   
      <span class="hljs-attr">noExternal</span>: [<span class="hljs-string">'react-router-dom'</span>], <span class="hljs-comment">// ←强制SSR打包   </span>
      <span class="hljs-attr">optimizeDeps</span>: { <span class="hljs-attr">include</span>: [<span class="hljs-string">'react-dom/server'</span>] },   
      <span class="hljs-attr">target</span>:<span class="hljs-string">'node16'</span> <span class="hljs-comment">// ←新增执行环境指定   </span>
   }   
} 
</code></pre>
<p>优势体现：</p>
<ul>
<li>Hydration不匹配错误减少70%<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fnextjs.org%2F" target="_blank" title="https://nextjs.org/" ref="nofollow noopener noreferrer">Next.js</a>兼容层提速40%</li>
</ul>
<p>###10.CSS新范式支持<br/>
前沿特性开箱即用：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-comment">/* vite.config.css */</span>   
<span class="hljs-keyword">@custom-media</span> --mobile (<span class="hljs-attribute">max-width</span>:<span class="hljs-number">640px</span>);   

<span class="hljs-comment">/* component.module.css */</span>    
<span class="hljs-selector-class">.button</span> {   
   <span class="hljs-attribute">color</span>:<span class="hljs-built_in">hsl</span>(from <span class="hljs-number">#f00</span> h s <span class="hljs-built_in">calc</span>(l * .<span class="hljs-number">8</span>)); <span class="hljs-comment">/* CSS Color Level5 */</span>   
} 
</code></pre>
<p>配套工具链：</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Context 知多少，组件通联有门道]]></title>    <link>https://juejin.cn/post/7581348660824506368</link>    <guid>https://juejin.cn/post/7581348660824506368</guid>    <pubDate>2025-12-09T00:29:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581348660824506368" data-draft-id="7577345758036066304" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Context 知多少，组件通联有门道"/> <meta itemprop="keywords" content="Android,Kotlin"/> <meta itemprop="datePublished" content="2025-12-09T00:29:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="RockByte"/> <meta itemprop="url" content="https://juejin.cn/user/1046390797768519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Context 知多少，组件通联有门道
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1046390797768519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    RockByte
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T00:29:48.000Z" title="Tue Dec 09 2025 00:29:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="xcode">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#000}.xml .hljs-meta{color:silver}.hljs-comment,.hljs-quote{color:#007400}.hljs-attribute,.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-tag{color:#aa0d91}.hljs-template-variable,.hljs-variable{color:#3f6e74}.hljs-code,.hljs-meta-string,.hljs-string{color:#c41a16}.hljs-link,.hljs-regexp{color:#0e0eff}.hljs-bullet,.hljs-number,.hljs-symbol,.hljs-title{color:#1c00cf}.hljs-meta,.hljs-section{color:#643820}.hljs-built_in,.hljs-builtin-name,.hljs-class .hljs-title,.hljs-params,.hljs-type{color:#5c2699}.hljs-attr{color:#836c28}.hljs-subst{color:#000}.hljs-formula{background-color:#eee;font-style:italic}.hljs-addition{background-color:#baeeba}.hljs-deletion{background-color:#ffc8bd}.hljs-selector-class,.hljs-selector-id{color:#9b703f}.hljs-doctag,.hljs-strong{font-weight:700}.hljs-emphasis{font-style:italic}</style><p><em>本系列为 Android 技术职场题材虚构小说，所有登场人物、公司名称、组织架构及相关情节均为创作所需虚构而来，若有雷同，纯属偶然。书中涉及的技术知识经专业梳理，仅供参考。</em></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/844bf0f4350a4e488ceae20d66f4dfce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUm9ja0J5dGU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765844987&amp;x-signature=hqjJxjm%2B1%2FnQsG0jEQxcQOYQDww%3D" alt="0.png" loading="lazy"/></p>
<h2 data-id="heading-0">四）Context 知多少，组件通联有门道</h2>
<p>上次面试的失败像盆冷水，彻底浇醒了浑浑噩噩的林卓。面试官随意抛出的Android相关问题，他答得支支吾吾，那一刻他才明白，只靠改UI、调接口的表面功夫，根本撑不起职业道路。</p>
<p>回到组里，他收起了摸鱼的心思，开始沉下心钻研核心技术。恰逢组里启动“用户中心模块重构”，老杨见他态度转变，便把“全局通知工具类开发”这个基础子任务交给他练手。林卓磕磕绊绊干了快一周，刚把基础功能跑通，麻烦就找上门了。</p>
<p>“林卓，你负责的通知模块测出问题了！”小安抱着测试机急匆匆跑过来，高马尾随着脚步晃得厉害，“常规操作都没问题，但我做后台保活测试时发现，退到后台等待一会儿再触发推送，APP直接内存泄漏，时间长了还会崩溃，日志里全是 <strong>LeakCanary</strong> 检测到内存泄漏的警告。”</p>
<p>林卓赶紧接过测试机，屏幕上“应用已停止运行”的提示格外刺眼。他打开日志，<code>Activity Context leaked</code> 的红色字样像根刺扎在眼前。这个通知工具类他用了单例模式，为了方便调用 <code>Toast</code>，直接把 <code>Activity</code> 的 <code>this</code> 传了进去。</p>
<p>“我明明在工具类里加了判空啊。”林卓皱着眉翻代码，“<code>if (context != null) { Toast.makeText(context, msg, Toast.LENGTH_SHORT).show() }</code>，怎么还会泄漏？”</p>
<p>“你这是把 <code>Activity</code> 的命门攥手里了。”老杨端着搪瓷杯路过，杯沿还沾着点茶叶。</p>
<p>他直指问题核心：“单例是全局生命周期，<code>Activity</code> 一销毁，它还抱着 <code>Activity</code> 的 <code>Context</code> 不放，垃圾回收器收不了，可不就泄漏了？”</p>
<p>林卓顺着老杨的话往下想，眉头拧得更紧：“那要是有些场景确实绕不开，非得在单例这种长生命周期对象里用到 <code>Activity Context</code>，就没别的办法了吗？”</p>
<p>“也不是完全不能用，核心是别让长生命周期对象‘死抓着’<code>Activity Context</code> 不放。”老杨拉过椅子坐下，顺势接过林卓的代码本。</p>
<p>他给出解决方案：“真碰到这种需求，就得用 <code>WeakReference</code> 把 <code>Context</code> 包起来。它就像个‘临时抓手’，只在需要的时候关联 <code>Activity</code>，垃圾回收器要清理 <code>Activity</code> 时，它不会拦着，这样就能从根上减少泄漏风险。”</p>
<p>听着老杨的讲解，林卓突然想起之前看过老杨给的《Android核心知识点》，赶紧追问：“您这么一说我就明白了！那结合你的文档里讲的 <code>Context</code> 类型，我这个单例工具类，是不是直接用 <code>Application Context</code> 最稳妥？”</p>
<p>“先别急着下结论。”老杨拉过椅子坐下，点开工具类代码，“你这工具类又弹 <code>Toast</code> 又显示 <code>Dialog</code>，得先搞清楚不同场景该用啥 <code>Context</code>。”</p>
<p>他指着屏幕，给出关键区分：“像 <code>Toast</code> 这种轻量级提示，用 <code>Application Context</code> 完全没问题，系统会自动处理窗口关联。”</p>
<p>“但像 <code>AlertDialog</code>、自定义主题的 <code>TextView</code> 这类和界面主题强相关的组件，就必须用 <code>Activity Context</code>。”</p>
<p>老杨强调核心原因：“<code>Application Context</code> 没有承载界面主题的能力，这才是新手常踩的坑。”</p>
<p>小安在旁边连连点头：“对对，我上次测个弹窗功能，按钮字体和颜色全不对，跟设计图差老远。开发改了改调用方式，换成跟页面绑定的那种，立马就正常了。”她撇撇嘴吐槽，“这Android也太奇怪了，同样是弹个东西，换个地方触发就出幺蛾子。”</p>
<p>“嗯，这也是很多新手踩坑的地方。”</p>
<p>老杨接过话头，抛出一个隐藏知识点：“就说 <code>Dialog</code> 这个类，构造函数明晃晃写着要 <code>Context</code>，但你去翻源码就知道，它要求的是 <code>@UIContext</code>。”</p>
<p>他进一步解释：“这种上下文一般只有 <code>Activity</code> 才有，<code>Application</code> 和 <code>Service</code> 根本不具备。”</p>
<p>他接着打开林卓的单例代码，用鼠标圈出 <code>private var mContext: Context? = null</code>：“你把 <code>Activity</code> 传进来，单例就成了 <code>Activity</code> 的‘寄生虫’。”</p>
<p>“就算 <code>Activity</code> <code>finish</code> 了，单例还拿着它的引用，内存能不泄漏吗？”</p>
<p>老杨顿了顿，给出明确解决方案：“改成就用 <code>getApplicationContext()</code>。”</p>
<p>他特意强调注意事项：“但要记死，这个 <code>Context</code> 不能做UI相关的操作，比如弹对话框、加载布局，刚好避开它的短板。”</p>
<p>林卓恍然大悟，赶紧翻回工具类代码，手指在屏幕上划着逻辑：“我明白您的意思了！<code>Toast</code> 用 <code>Application Context</code> 就行，但工具类里还留着弹 <code>AlertDialog</code> 的功能，这总不能跟 <code>Toast</code> 共用一套上下文吧？是不是得让调用方每次传 <code>Activity Context</code> 过来？”</p>
<p>“分场景处理。”老杨拿起笔在林卓的笔记本上画起来，给出清晰的使用准则。</p>
<p>适用 <code>Application Context</code> 的场景：“工具类里存 <code>Application Context</code>，用于初始化通知管理器、访问全局资源，还有 <code>Toast</code> 这种通用提示。”</p>
<p>必须用 <code>Activity Context</code> 的场景：“<code>AlertDialog</code>、带自定义主题的UI组件这些和界面强绑定的操作，必须让调用方传 <code>Activity</code> 里的 <code>Context</code>，并且每次用的时候实时传，别存起来。”</p>
<p>他顿了顿，补充一个 <code>Service</code> 专属知识点：“还有个 <code>Service</code> 里常踩的硬坑——<code>Service</code> 本身没有独立的任务栈，它跑在后台，不属于任何界面的任务栈。”</p>
<p>核心要求：“所以在 <code>Service</code> 里启动 <code>Activity</code> 时，必须给 <code>Intent</code> 加<code>Intent.FLAG_ACTIVITY_NEW_TASK</code>这个标记。”</p>
<p>标记作用与异常后果：“这个标记的作用是帮新启动的 <code>Activity</code> 创建一个独立的任务栈来承载它，要是不加，系统找不到放 <code>Activity</code> 的地方，就会抛出<code>AndroidRuntimeException</code>。”</p>
<p>他看向小安：“这个小安测试的时候肯定碰到过。”</p>
<p>小安立刻点头摆手，有点不好意思地笑：“反正就是这么个理儿！我之前测过类似的后台功能，开发没加东西就崩了，我把崩的情况报上去，他们改了个标记就好了。具体啥原理我也记不太清，你们说的这些 <code>Context</code> 相关的，我听着都头大。”</p>
<p>林卓立刻按这个思路重构代码：单例初始化时通过 <code>context.applicationContext</code> 存全局上下文，弹 <code>AlertDialog</code> 的方法则新增 <code>Activity Context</code> 参数，要求调用方实时传入。改完后小安当场测试——前台弹通知、弹窗都正常，后台触发推送也没再出现内存泄漏，<strong>LeakCanary</strong> 的警告彻底消失了。</p>
<p>林卓把老杨的话记在笔记本上，特意用红笔标注：“单例存 <code>Application Context</code>，UI操作传 <code>Activity Context</code>，实时调用不缓存”。接下来的几天，他不仅重构了通知工具类，还主动把组里几个老模块的<code>Context</code>使用逻辑都排查了一遍——之前总被忽略的“内存泄漏隐患”“主题错乱”等小问题，如今都成了他重点关注的对象。</p>
<p>林卓排查完最后一个老模块，揉着脖子跟老杨反馈：“杨工，我发现好多旧代码里，<code>Activity</code> 里既用 <code>this</code> 又用 <code>baseContext</code>，看得我有点乱，这俩到底啥关系啊？”</p>
<p>老杨正收拾着文档，闻言停下动作，干脆把林卓的代码本拉到自己面前：“正好你问到点子上了，光会用还不够，得知道底层逻辑才不容易踩坑。”</p>
<p>他打开 <code>ContextWrapper</code> 的源码，用指尖点着屏幕：“你看，<code>ContextWrapper</code> 里有个 <code>mBase</code> 字段，这就是真正的上下文实现，不管是 <code>Activity</code> 还是 <code>Service</code>，最终都要委托给它。<code>Activity</code> 的 <code>mBase</code> 是 <code>ContextImpl</code>，还附加了主题信息；但 <code>Service</code> 的 <code>mBase</code> 也是 <code>ContextImpl</code>，却没有主题扩展——这就是为啥 <code>Service</code> 不能弹弹窗。”</p>
<p>林卓盯着源码若有所思，突然指着 <code>baseContext</code> 相关的注释问：“那 <code>Activity</code> 里的 <code>this</code> 和 <code>baseContext</code> 具体有啥区别？”</p>
<p>“这问题问得好，正好结合代码给你讲明白。”老杨干脆拉过林卓的工位椅，打开他的IDE，调出两段代码——正是组里前辈写过的主题包装类代码。</p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomThemeContextWrapper</span>(base: Context) : ContextWrapper(base) {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getTheme</span><span class="hljs-params">()</span></span>: Resources.Theme {
        <span class="hljs-keyword">val</span> theme = <span class="hljs-keyword">super</span>.getTheme()
        theme.applyStyle(R.style.CustomTheme, <span class="hljs-literal">true</span>) <span class="hljs-comment">// Apply a custom theme</span>
        <span class="hljs-keyword">return</span> theme
    }
}
</code></pre>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attachBaseContext</span><span class="hljs-params">(newBase: <span class="hljs-type">Context</span>)</span></span> {
        <span class="hljs-keyword">super</span>.attachBaseContext(CustomThemeContextWrapper(newBase))
    }
}
</code></pre>
<p>老杨逐行解析代码：“你先看这段 <code>CustomThemeContextWrapper</code>，它继承了 <code>ContextWrapper</code>，核心是重写 <code>getTheme()</code> 方法，给上下文附加了自定义主题样式。”</p>
<p>“再看 <code>MyActivity</code>，通过 <code>attachBaseContext</code> 方法，把 <code>newBase</code> 包装成了这个自定义上下文。”</p>
<p>林卓盯着代码里的 <code>newBase</code> 关键词，眉头拧了起来：“这个 <code>newBase</code> 就是 <code>baseContext</code> 吧？那 <code>Activity</code> 的 <code>this</code> 拿到的上下文，是不是在它基础上包装出来的？”</p>
<p>“可以这么理解，但 <code>this</code> 是比 <code>baseContext</code> 更完整的存在。”老杨指着代码解释。</p>
<p>“<code>baseContext</code> 是 <code>Activity</code> 的‘底层上下文’，负责和系统底层交互，比如获取资源、启动服务这些基础操作，你看到的 <code>newBase</code> 就是系统给 <code>Activity</code> 分配的初始 <code>baseContext</code>。”</p>
<p>他顿了顿，敲了敲 <code>attachBaseContext</code> 方法，讲解 <code>this</code> 的作用：“而 <code>Activity</code> 的 <code>this</code>，是在 <code>baseContext</code> 的基础上做了‘增强’——它封装了生命周期管理、界面主题、窗口绘制这些核心能力。”</p>
<p>结合代码举例：“就像这段代码，我们给 <code>baseContext</code> 包了一层自定义主题，最终 <code>this</code> 拿到的上下文，就带着这个主题样式了。”</p>
<p>为了让林卓更直观，老杨举了个对比例子。</p>
<p><code>this</code> 的优势：“你用 <code>this</code> 去创建 <code>AlertDialog</code>，它能自动适配 <code>Activity</code> 的主题，因为 <code>this</code> 里包含了主题信息。”</p>
<p><code>baseContext</code> 的局限：“但你要是用 <code>baseContext</code> 去创建，它只会用系统默认主题——甚至在某些版本里会崩溃，因为 <code>baseContext</code> 没有 <code>Activity</code> 那种窗口关联能力。”</p>
<p>“那什么时候该用 <code>baseContext</code> 啊？”林卓追问，顺手把老杨的话记在笔记本上，特意留出补充案例的空白。</p>
<p>“用在不需要界面主题和生命周期的场景。”老杨补充道。</p>
<p>他给出一句总结，还举了个具体例子：“简单说，<code>this</code> 是‘全能选手’，带界面属性；<code>baseContext</code> 是‘基础工具人’，只干底层活。比如你在 <code>Activity</code> 里注册静态广播，用 <code>baseContext</code> 就够了”</p>
<p>小安凑过来看热闹，听完恍然大悟：“怪不得我上次测一个自定义按钮，开发的样式总出问题，换个调用方式就好了，原来问题在这！”</p>
<p>老杨笑着看向小安，又转头对林卓说：“其实测试和开发排查问题的思路是相通的，都能从场景反推。”</p>
<p>核心排查场景：“你就盯着那些关键场景测：比如启动新页面、弹弹窗的样式，后台操作等等，如果出问题，大概率是 <code>Context</code> 用错了。”</p>
<p>他补充测试要点：“还有那些全局都能用的工具，要是在后台用就出问题，也可能是这个原因。你多换几种机型、多测几个前后台切换的场景，问题自然就露出来了。”</p>
<p>带着这些收获，林卓在接下来的一周里，把项目里所有涉及 <code>Context</code> 的地方都系统梳理了一遍。</p>
<p>他甚至总结出三条规范记在团队共享文档里：“1. 全局工具类存 <code>Application Context</code>；2. 界面相关操作必须传 <code>Activity Context</code> 且实时调用；3. 后台程序禁用界面类 <code>Context</code>。”</p>
<p>小安则发挥测试优势，设计了一套“全场景覆盖用例”，从前台操作、后台驻留、进程重启到低电量模式，反复测试，确保 <code>Context</code> 相关的崩溃和泄漏问题彻底绝迹。</p>
<p>周五傍晚的研发区渐渐安静，工位灯一盏盏熄灭，只剩林卓、老杨和小安的座位还亮着。小安一边收拾测试机一边随口说道：“林卓，张组长今天Review你提交的代码，跟我说‘这小子现在写的东西越来越稳了’，还追问是谁带的你呢。”</p>
<p>林卓刚改完最后一行注释，闻言抬头看向正在整理文档的老杨，脸上带着点不好意思的笑，从抽屉里摸出一瓶可乐递过去：“全靠杨工指点，不然我现在还在 <code>Context</code> 的迷雾里打转呢。”</p>
<p>老杨没直接喝，顺手把可乐塞进了口袋：“我不爱喝甜的。”</p>
<p>他端起搪瓷杯继续喝，褐色液体在杯壁上留下淡淡的渍痕。</p>
<p>“不是我指点得好，是你肯钻。”老杨放下杯子，杯底与桌面碰撞发出轻响，一股混杂着焦香和茶香的味道飘了过来，“技术这东西，光看理论没用，得自己试错才知道啥适合自己。”</p>
<p>小安正收拾到一半，抽着鼻子凑过来：“杨工，你这杯子里泡的啥呀？闻着不像纯茶。”</p>
<p>林卓也好奇地瞥了眼杯子里深褐色的液体，质地比茶水浓稠些。</p>
<p>老杨有点不好意思地挠挠头：“前几天赶版本熬大夜，困得慌就瞎兑的——绿茶加咖啡，提神劲儿翻倍。”</p>
<p>“啊？茶和咖啡混着喝？”小安眼睛瞪圆了，“那是什么奇怪味道？又苦又涩吗？”</p>
<p>“还行，喝惯了就好，比纯咖啡少点酸味儿，比浓茶多股劲儿。”老杨笑着摆手，把话题拉回技术。</p>
<p>他用这个例子打比方：“就像 <code>Context</code> 这知识点，背一万遍理论不如踩一次坑，踩一次坑不如解决一次问题。”</p>
<p>“就像 <code>Context</code> 这知识点，背一万遍理论不如踩一次坑，踩一次坑不如解决一次问题。”</p>
<p>他话锋一转说起正事，眼神里带着点期许：“对了，下周组里会来几个实习生，基础有点薄弱，我跟张组长合计过，让你带带它们。你趁这两天把Android四大组件的知识点过一遍，尤其是 <code>Activity</code> 和 <code>Service</code> 的生命周期——正好把你这段时间踩的坑，都转化成经验教给他们。”</p>
<p>林卓眼睛一亮，用力点头，手指无意识地摩挲着手机里的 <code>Context</code> 笔记——从前连 <code>Context</code> 类型都分不清的自己，如今居然能指导新人了，这种成长的踏实感格外真切。</p>
<p>他低头看向手机里刚整理的 <code>Context</code> 笔记，上面老杨的批注格外醒目：“<code>Context</code> 是应用的根，用对了是桥梁，用错了是陷阱。”</p>
<p>西二旗的研发区灯光透过玻璃窗洒下来，照亮了笔记上的字迹，也照亮了他从“踩坑者”到“引路人”的逆袭方向。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[8 个你可能忽略了的 Flutter 小部件（四）]]></title>    <link>https://juejin.cn/post/7581350888789114916</link>    <guid>https://juejin.cn/post/7581350888789114916</guid>    <pubDate>2025-12-09T00:47:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581350888789114916" data-draft-id="7578314349515128883" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="8 个你可能忽略了的 Flutter 小部件（四）"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-09T00:47:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="JarvanMo"/> <meta itemprop="url" content="https://juejin.cn/user/2348212565845704"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            8 个你可能忽略了的 Flutter 小部件（四）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2348212565845704/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    JarvanMo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-09T00:47:48.000Z" title="Tue Dec 09 2025 00:47:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">📚 BlockSemantics</h2>
<p><strong>BlockSemantics</strong> 控件是一个<strong>可访问性控制工具</strong>，它的作用是<strong>阻止屏幕阅读器访问其子控件树中的单个控件</strong>。</p>
<p>你可以将其想象成：给一组控件贴上一个<strong>请勿打扰</strong>的标志。屏幕阅读器看到这个标志后，就会<strong>忽略标志后面的所有内容</strong>，不会去读取那些被它包裹住的单个控件。</p>
<p>//video</p>
<p>这个控件<strong>特别有用</strong>，尤其是在处理以下情况时：</p>
<p>您有一些控件在视觉上位于<strong>其他控件的后方</strong>（例如，一个<strong>模态对话框叠加层</strong> <code>modal dialog overlay</code>），但它们仍然是控件树的一部分。</p>
<p>如果没有 <strong>BlockSemantics</strong>，屏幕阅读器可能会读取那些对用户<strong>当前不相关</strong>的控件信息，从而提供<strong>令人困惑或多余</strong>的信息。</p>
<pre><code class="hljs language-dart" lang="dart">BlockSemantics(
  child: Container(
    child: Column(
      children: [
        Text(<span class="hljs-string">'This text will be ignored by screen readers'</span>),
        ElevatedButton(
          onPressed: () {},
          child: Text(<span class="hljs-string">'This button will also be ignored'</span>),
        ),
      ],
    ),
  ),
)
</code></pre>
<h2 data-id="heading-1">BlockSemantics 的底层工作原理</h2>
<p><strong>BlockSemantics</strong> 控件的工作原理是<strong>创建一个语义边界</strong>，<strong>阻止</strong>语义信息从其子控件<strong>传播</strong>出去。它有效地创建了一个语义上的“黑洞”，可访问性服务<strong>无法穿透</strong>这个黑洞来读取单个子控件。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlockSemantics</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">SingleChildRenderObjectWidget</span> </span>{
  <span class="hljs-keyword">const</span> BlockSemantics({<span class="hljs-keyword">super</span>.key, <span class="hljs-keyword">this</span>.blocking = <span class="hljs-keyword">true</span>, <span class="hljs-keyword">super</span>.child});

  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> blocking;

  <span class="hljs-meta">@override</span>
  RenderBlockSemantics createRenderObject(BuildContext context) =&gt;
      RenderBlockSemantics(blocking: blocking);

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> updateRenderObject(BuildContext context, RenderBlockSemantics renderObject) {
    renderObject.blocking = blocking;
  }

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> debugFillProperties(DiagnosticPropertiesBuilder properties) {
    <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>渲染对象 <strong><code>RenderBlockSemantics</code></strong> <strong>重写</strong>了语义注解方法，以<strong>阻止子控件的语义</strong>被包含在<strong>可访问性树</strong>中。</p>
<hr/>
<h2 data-id="heading-2">BlockSemantics 实用完整示例</h2>
<p>以下是一个<strong>完整示例</strong>，展示了 <strong>BlockSemantics</strong> 在<strong>模态对话框</strong>场景中的应用：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  runApp(<span class="hljs-keyword">const</span> MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> MyApp({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> MaterialApp(
      debugShowCheckedModeBanner: <span class="hljs-keyword">false</span>,
      home: BlockSemanticsDemo(),
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BlockSemanticsDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> BlockSemanticsDemo({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;BlockSemanticsDemo&gt; createState() =&gt; _BlockSemanticsDemoState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_BlockSemanticsDemoState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">BlockSemanticsDemo</span>&gt; </span>{
  <span class="hljs-built_in">bool</span> _showDialog = <span class="hljs-keyword">false</span>;
  <span class="hljs-built_in">bool</span> _useBlockSemantics = <span class="hljs-keyword">true</span>;

  <span class="hljs-keyword">void</span> _toggleDialog() {
    setState(() {
      _showDialog = !_showDialog;
    });
  }

  <span class="hljs-keyword">void</span> _toggleBlockSemantics() {
    setState(() {
      _useBlockSemantics = !_useBlockSemantics;
    });
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'BlockSemantics Demo'</span>),
      ),
      body: Stack(
        children: [
          <span class="hljs-comment">// Background content</span>
          _buildBackgroundContent(),

          <span class="hljs-comment">// Modal dialog overlay</span>
          <span class="hljs-keyword">if</span> (_showDialog) _buildModalOverlay(),
        ],
      ),
    );
  }

  Widget _buildBackgroundContent() {
    Widget backgroundContent = Padding(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16.0</span>),
      child: Column(
        crossAxisAlignment: CrossAxisAlignment.stretch,
        children: [
          <span class="hljs-keyword">const</span> Card(
            child: Padding(
              padding: EdgeInsets.all(<span class="hljs-number">16.0</span>),
              child: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text(
                    <span class="hljs-string">'Background Content'</span>,
                    style: TextStyle(fontSize: <span class="hljs-number">18</span>, fontWeight: FontWeight.bold),
                  ),
                  SizedBox(height: <span class="hljs-number">8</span>),
                  Text(
                    <span class="hljs-string">'This content should be ignored by screen readers when the dialog is open.'</span>,
                  ),
                ],
              ),
            ),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
          SwitchListTile(
            title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Use BlockSemantics'</span>),
            subtitle: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Toggle to see accessibility difference'</span>),
            value: _useBlockSemantics,
            onChanged: (value) =&gt; _toggleBlockSemantics(),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
          ElevatedButton(
            onPressed: _toggleDialog,
            child: Text(_showDialog ? <span class="hljs-string">'Hide Dialog'</span> : <span class="hljs-string">'Show Dialog'</span>),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">20</span>),
          <span class="hljs-keyword">const</span> Text(
            <span class="hljs-string">'Additional Background Elements'</span>,
            style: TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.bold),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
          ElevatedButton(
            onPressed: () {},
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Background Action 1'</span>),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
          ElevatedButton(
            onPressed: () {},
            child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Background Action 2'</span>),
          ),
          <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
          <span class="hljs-keyword">const</span> TextField(
            decoration: InputDecoration(
              labelText: <span class="hljs-string">'Background Input'</span>,
              hintText: <span class="hljs-string">'This should be blocked when dialog is open'</span>,
            ),
          ),
        ],
      ),
    );

    <span class="hljs-comment">// Apply BlockSemantics when dialog is shown and option is enabled</span>
    <span class="hljs-keyword">if</span> (_showDialog &amp;&amp; _useBlockSemantics) {
      <span class="hljs-keyword">return</span> BlockSemantics(child: backgroundContent);
    }
    <span class="hljs-keyword">return</span> backgroundContent;
  }

  Widget _buildModalOverlay() {
    <span class="hljs-keyword">return</span> Container(
      color: Colors.black54,
      child: Center(
        child: Card(
          margin: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">32.0</span>),
          child: Padding(
            padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">24.0</span>),
            child: Column(
              mainAxisSize: MainAxisSize.min,
              children: [
                <span class="hljs-keyword">const</span> Text(
                  <span class="hljs-string">'Modal Dialog'</span>,
                  style: TextStyle(fontSize: <span class="hljs-number">20</span>, fontWeight: FontWeight.bold),
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">16</span>),
                <span class="hljs-keyword">const</span> Text(
                  <span class="hljs-string">'This dialog should be the focus of screen readers. '</span>
                  <span class="hljs-string">'Background content should be blocked from accessibility.'</span>,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">20</span>),
                Row(
                  mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                  children: [
                    ElevatedButton(
                      onPressed: _toggleDialog,
                      child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Cancel'</span>),
                    ),
                    ElevatedButton(
                      onPressed: _toggleDialog,
                      child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Confirm'</span>),
                    ),
                  ],
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}
</code></pre>
<p><strong>BlockSemantics</strong> 对于创建<strong>可访问的模态体验</strong>至关重要，它能确保屏幕阅读器用户<strong>只关注</strong>相关内容，而<strong>不会被背景元素分散注意力</strong>。</p>
<hr/>
<h2 data-id="heading-3">BeveledRectangleBorder</h2>
<p><strong>BeveledRectangleBorder</strong> 是一个<strong>形状类</strong>，它创建的矩形形状的角是<strong>斜切的、“被切掉的”</strong> ，而不是通常的圆角或直角。</p>
<p>这赋予了控件一种<strong>独特的、棱角分明的外观</strong>，非常适合创建具有<strong>几何、切口风格</strong>的独特设计元素。</p>
<p>//video</p>
<p>你通常会通过按钮、卡片和容器等控件的 <code>shape</code> 属性来使用 <strong>BeveledRectangleBorder</strong>，从而实现那种<strong>独特的斜切（beveled）外观</strong>。</p>
<pre><code class="hljs language-dart" lang="dart">Container(
  decoration: ShapeDecoration(
    color: Colors.blue,
    shape: BeveledRectangleBorder(
      borderRadius: BorderRadius.circular(<span class="hljs-number">16</span>),
      side: BorderSide(color: Colors.purple, width: <span class="hljs-number">2</span>),
    ),
  ),
  child: Text(<span class="hljs-string">'Beveled Container'</span>),
)
</code></pre>
<h2 data-id="heading-4">BeveledRectangleBorder 的两个关键属性</h2>
<p>有两个<strong>关键属性</strong>：</p>
<ul>
<li><strong><code>borderRadius</code></strong>: 接受一个 <strong><code>BorderRadius</code> 值</strong>，用于决定<strong>斜切（bevel）从角落开始的距离</strong>。<strong>半径值越大</strong>，创建的切角就<strong>越引人注目</strong>（更戏剧化）。</li>
<li><strong><code>side</code></strong>: 允许您定义形状周围的<strong>描边（border stroke）</strong> ，包括颜色、宽度和样式。</li>
</ul>
<hr/>
<h2 data-id="heading-5">BeveledRectangleBorder 的底层工作原理</h2>
<p><strong>BeveledRectangleBorder</strong> 继承自 <strong><code>OutlinedBorder</code></strong>，并<strong>实现</strong>了 <strong><code>ShapeBorder</code> 接口</strong>。</p>
<p>以下是来自 GitHub 上的 Flutter 仓库的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fflutter%2Fflutter%2Fblob%2Fmaster%2Fpackages%2Fflutter%2Flib%2Fsrc%2Fpainting%2Fbeveled_rectangle_border.dart" target="_blank" title="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/painting/beveled_rectangle_border.dart" ref="nofollow noopener noreferrer">完整源代码</a>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ...</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeveledRectangleBorder</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">OutlinedBorder</span> </span>{
  <span class="hljs-keyword">final</span> BorderRadiusGeometry borderRadius;

  ShapeBorder scale(t) =&gt; BeveledRectangleBorder(
    side: side.scale(t), borderRadius: borderRadius * t);

  ShapeBorder? lerpFrom/To(other, t) =&gt; sameType
    ? BeveledRectangleBorder(
        side: BorderSide.lerp(...),
        borderRadius: BorderRadiusGeometry.lerp(...))
    : <span class="hljs-keyword">super</span>.lerpFrom/To(...);

  BeveledRectangleBorder copyWith({side?, borderRadius?}) =&gt; ...;

  Path _getPath(RRect r) {
    <span class="hljs-comment">// Clamp radii to &gt;= 0</span>
    <span class="hljs-comment">// Build 8 vertices by “cutting” each corner toward the side center</span>
    <span class="hljs-keyword">final</span> verts = &lt;Offset&gt;[
      <span class="hljs-comment">// TL edge points toward left &amp; top centers</span>
      <span class="hljs-comment">// TR, BR, BL similarly…</span>
    ];
    <span class="hljs-keyword">return</span> Path()..addPolygon(verts, <span class="hljs-keyword">true</span>);
  }

  Path getOuterPath(Rect rect, {TextDirection? td}) =&gt;
    _getPath(borderRadius.resolve(td).toRRect(rect));

  Path getInnerPath(Rect rect, {TextDirection? td}) =&gt;
    _getPath(borderRadius.resolve(td).toRRect(rect).deflate(side.strokeInset));

  <span class="hljs-keyword">void</span> paint(Canvas c, Rect rect, {TextDirection? td}) {
    <span class="hljs-keyword">if</span> (side.style == BorderStyle.solid &amp;&amp; !rect.isEmpty) {
      <span class="hljs-keyword">final</span> RRect r = borderRadius.resolve(td).toRRect(rect);
      <span class="hljs-keyword">final</span> RRect inflated = r.inflate(side.strokeOutset);
      <span class="hljs-keyword">final</span> Path stroke = _getPath(inflated)
        ..addPath(getInnerPath(rect, textDirection: td), Offset.zero);
      c.drawPath(stroke, side.toPaint());
    }
  }
}
<span class="hljs-comment">// ...</span>
</code></pre>
<p>这个边框（<code>BeveledRectangleBorder</code>）类似于 <strong><code>RoundedRectangleBorder</code></strong>，但不同之处在于，它的<strong>角是直切（straight cuts）</strong> ，而不是圆弧。</p>
<ul>
<li>
<p><strong><code>_getPath</code> 方法：</strong> 它计算出一个<strong>八边形（octagon）</strong> ：即<strong>8个顶点</strong>。</p>
<ul>
<li>这些顶点是通过<strong>沿着每条边向其侧边中心滑动</strong>创建的。</li>
<li>滑动的距离<strong>受限于</strong>所提供的<strong>每个角的半径（<code>radii</code>）</strong> （并被限制为 <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">\ge 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"/><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">0</span></span></span></span></span>）。</li>
<li>如果<strong>半径（<code>radii</code>）非常大</strong>，斜切的对角线会在中心相交，形状最终会变成一个<strong>菱形（diamond）</strong> 。</li>
</ul>
</li>
<li>
<p><strong><code>getOuterPath</code>/<code>getInnerPath</code> 方法：</strong></p>
<ul>
<li>首先，它们利用 <strong><code>TextDirection</code></strong>（文本方向）来解析 <strong><code>BorderRadiusGeometry</code></strong>，并将其转换为 <strong><code>RRect</code></strong> 对象。</li>
<li>接着，它们构建<strong>外部/内部斜切的多边形</strong>（内部路径使用 <code>deflate</code> 来考虑描边的厚度）。</li>
</ul>
</li>
<li>
<p><strong><code>paint</code> 方法：</strong></p>
<ul>
<li>首先，它为描边的外展（stroke outset）进行<strong>膨胀</strong>（inflates）。</li>
<li>然后，它构建一个**“外部路径减去内部路径”**的路径（即轮廓区域）。</li>
<li>最后，使用 <strong><code>side.toPaint()</code></strong> 方法将该路径绘制出来。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-6">💻 BeveledRectangleBorder 实用完整示例</h2>
<p>以下是一个<strong>综合示例</strong>，展示了 <strong><code>BeveledRectangleBorder</code></strong> 的<strong>不同变体</strong>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;

<span class="hljs-keyword">void</span> main() {
  runApp(<span class="hljs-keyword">const</span> MyApp());
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyApp</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> MyApp({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> MaterialApp(
      debugShowCheckedModeBanner: <span class="hljs-keyword">false</span>,
      home: Scaffold(
        appBar: AppBar(
          title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'BeveledRectangleBorder Demo'</span>),
        ),
        body: <span class="hljs-keyword">const</span> SingleChildScrollView(
          padding: EdgeInsets.all(<span class="hljs-number">16.0</span>),
          child: Column(
            crossAxisAlignment: CrossAxisAlignment.stretch,
            children: [
              Text(
                <span class="hljs-string">'BeveledRectangleBorder Examples'</span>,
                style: TextStyle(fontSize: <span class="hljs-number">24</span>, fontWeight: FontWeight.bold),
                textAlign: TextAlign.center,
              ),
              SizedBox(height: <span class="hljs-number">20</span>),
              BeveledExample(
                title: <span class="hljs-string">'Small Bevel (8px)'</span>,
                borderRadius: <span class="hljs-number">8</span>,
                color: Colors.red,
              ),
              SizedBox(height: <span class="hljs-number">16</span>),
              BeveledExample(
                title: <span class="hljs-string">'Medium Bevel (16px)'</span>,
                borderRadius: <span class="hljs-number">16</span>,
                color: Colors.green,
              ),
              SizedBox(height: <span class="hljs-number">16</span>),
              BeveledExample(
                title: <span class="hljs-string">'Large Bevel (24px)'</span>,
                borderRadius: <span class="hljs-number">24</span>,
                color: Colors.blue,
              ),
              SizedBox(height: <span class="hljs-number">16</span>),
              BeveledExample(
                title: <span class="hljs-string">'With Border'</span>,
                borderRadius: <span class="hljs-number">20</span>,
                color: Colors.amber,
                hasBorder: <span class="hljs-keyword">true</span>,
              ),
              SizedBox(height: <span class="hljs-number">16</span>),
              BeveledButtonExample(),
              SizedBox(height: <span class="hljs-number">16</span>),
              BeveledCardExample(),
            ],
          ),
        ),
      ),
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeveledExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> title;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">double</span> borderRadius;
  <span class="hljs-keyword">final</span> Color color;
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">bool</span> hasBorder;

  <span class="hljs-keyword">const</span> BeveledExample({
    <span class="hljs-keyword">super</span>.key,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.title,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.borderRadius,
    <span class="hljs-keyword">required</span> <span class="hljs-keyword">this</span>.color,
    <span class="hljs-keyword">this</span>.hasBorder = <span class="hljs-keyword">false</span>,
  });

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        Text(
          title,
          style: <span class="hljs-keyword">const</span> TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.w600),
        ),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
        Container(
          height: <span class="hljs-number">80</span>,
          decoration: ShapeDecoration(
            color: color.withOpacity(<span class="hljs-number">0.3</span>),
            shape: BeveledRectangleBorder(
              borderRadius: BorderRadius.circular(borderRadius),
              side: hasBorder
                  ? BorderSide(color: color, width: <span class="hljs-number">3</span>)
                  : BorderSide.none,
            ),
          ),
          child: Center(
            child: Text(
              <span class="hljs-string">'Radius: <span class="hljs-subst">${borderRadius}</span>px'</span>,
              style: TextStyle(
                color: color.withOpacity(<span class="hljs-number">0.8</span>),
                fontWeight: FontWeight.bold,
              ),
            ),
          ),
        ),
      ],
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeveledButtonExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> BeveledButtonExample({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        <span class="hljs-keyword">const</span> Text(
          <span class="hljs-string">'Beveled Button'</span>,
          style: TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.w600),
        ),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
        ElevatedButton(
          onPressed: () {},
          style: ElevatedButton.styleFrom(
            backgroundColor: Colors.purple,
            foregroundColor: Colors.white,
            shape: <span class="hljs-keyword">const</span> BeveledRectangleBorder(
              borderRadius: BorderRadius.all(Radius.circular(<span class="hljs-number">12</span>)),
            ),
            padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(horizontal: <span class="hljs-number">24</span>, vertical: <span class="hljs-number">12</span>),
          ),
          child: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'Beveled Button'</span>),
        ),
      ],
    );
  }
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BeveledCardExample</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatelessWidget</span> </span>{
  <span class="hljs-keyword">const</span> BeveledCardExample({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        <span class="hljs-keyword">const</span> Text(
          <span class="hljs-string">'Beveled Card'</span>,
          style: TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.w600),
        ),
        <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
        Card(
          shape: <span class="hljs-keyword">const</span> BeveledRectangleBorder(
            borderRadius: BorderRadius.all(Radius.circular(<span class="hljs-number">16</span>)),
            side: BorderSide(color: Colors.grey, width: <span class="hljs-number">1</span>),
          ),
          child: <span class="hljs-keyword">const</span> Padding(
            padding: EdgeInsets.all(<span class="hljs-number">16.0</span>),
            child: Column(
              crossAxisAlignment: CrossAxisAlignment.start,
              children: [
                Text(
                  <span class="hljs-string">'Card with Beveled Corners'</span>,
                  style: TextStyle(fontSize: <span class="hljs-number">16</span>, fontWeight: FontWeight.bold),
                ),
                SizedBox(height: <span class="hljs-number">8</span>),
                Text(
                  <span class="hljs-string">'This card uses BeveledRectangleBorder to create unique, '</span>
                  <span class="hljs-string">'angular corners instead of the typical rounded corners.'</span>,
                ),
              ],
            ),
          ),
        ),
      ],
    );
  }
}
</code></pre>
<h2 data-id="heading-7">🌟 总结 (Conclusion)</h2>
<p>在这篇博客中，我们探讨了 <strong>8 个强大但经常被忽视的 Flutter 控件或类</strong>，它们能够解决特定的开发难题。</p>
<p>这些控件的精妙之处不仅在于它们的功能，更在于它们如何展示了 Flutter <strong>一致的设计模式</strong>。无论是<strong>性能优化</strong>、<strong>可访问性</strong>、<strong>安全性</strong>，还是<strong>独特的视觉效果</strong>，Flutter 都提供了<strong>优雅的、基于控件的解决方案</strong>，它们能无缝地融入您的应用程序架构中。</p>
<hr/>
<h2 data-id="heading-8">🚀 继续您的 Flutter 之旅</h2>
<p>在您的 Flutter 之旅中，请记住这个框架充满了这些“隐藏的珍宝”。</p>
<p>官方文档、源代码探索和社区讨论都是等待您去发现的<strong>解决方案的宝库</strong>。请保持探索精神，持续构建，并且在您想要理解这些强大工具如何在<strong>幕后工作</strong>时，请毫不犹豫地深入研究<strong>源代码</strong>。</p>
<hr/>
<h2 data-id="heading-9">🔗 获取完整代码</h2>
<p>本系列中所有示例的<strong>完整源代码</strong>都可以在<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmhadaily%2Fflutter_test_cases" target="_blank" title="https://github.com/mhadaily/flutter_test_cases" ref="nofollow noopener noreferrer">flutter test cases repository</a>中找到。您可以在那里探索、实验，并在您自己的项目中以这些概念为基础进行构建。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redis（172）如何使用Redis实现分布式队？]]></title>    <link>https://juejin.cn/post/7581348660824358912</link>    <guid>https://juejin.cn/post/7581348660824358912</guid>    <pubDate>2025-12-08T23:09:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581348660824358912" data-draft-id="7581386627675701288" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redis（172）如何使用Redis实现分布式队？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-08T23:09:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redis（172）如何使用Redis实现分布式队？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T23:09:50.000Z" title="Mon Dec 08 2025 23:09:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在分布式系统中，使用Redis实现分布式队列是一种常见的解决方案。Redis提供了丰富的数据结构和高性能，使其成为实现分布式队列的理想选择。我们可以使用Redis的列表（List）数据结构来实现分布式队列，并通过LPOP、RPOP、LPUSH、RPUSH等命令进行队列操作。</p>
<p>以下是一个详细的示例代码，展示了如何使用Redis实现一个简单的分布式队列。</p>
<h3 data-id="heading-0">1. 初始化Redis连接</h3>
<p>首先，我们需要初始化Redis连接。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisQueue</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> String queueName;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisQueue</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String queueName)</span> {
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(host, port);
        <span class="hljs-built_in">this</span>.queueName = queueName;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }
}
</code></pre>
<h3 data-id="heading-1">2. 实现生产者和消费者</h3>
<p>接下来，我们实现队列的生产者和消费者。</p>
<h4 data-id="heading-2">2.1. 生产者</h4>
<p>生产者将消息推送到队列的右端。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(String message)</span> {
    jedis.rpush(queueName, message);
}
</code></pre>
<h4 data-id="heading-3">2.2. 消费者</h4>
<p>消费者从队列的左端弹出消息。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> String <span class="hljs-title function_">dequeue</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">return</span> jedis.lpop(queueName);
}
</code></pre>
<h3 data-id="heading-4">3. 示例代码</h3>
<p>以下是完整的示例代码，展示了如何使用Redis实现分布式队列，并包含一个简单的生产者和消费者示例。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisQueue</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> String queueName;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisQueue</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String queueName)</span> {
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(host, port);
        <span class="hljs-built_in">this</span>.queueName = queueName;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(String message)</span> {
        jedis.rpush(queueName, message);
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">dequeue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> jedis.lpop(queueName);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 初始化Redis队列</span>
        <span class="hljs-type">RedisQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisQueue</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>, <span class="hljs-string">"myQueue"</span>);

        <span class="hljs-comment">// 生产者线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Message "</span> + (i + <span class="hljs-number">1</span>);
                queue.enqueue(message);
                System.out.println(<span class="hljs-string">"Produced: "</span> + message);
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">500</span>); <span class="hljs-comment">// 模拟生产间隔</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });

        <span class="hljs-comment">// 消费者线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> queue.dequeue();
                System.out.println(<span class="hljs-string">"Consumed: "</span> + message);
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 模拟消费间隔</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });

        <span class="hljs-comment">// 启动生产者和消费者线程</span>
        producer.start();
        consumer.start();

        <span class="hljs-comment">// 等待线程完成</span>
        <span class="hljs-keyword">try</span> {
            producer.join();
            consumer.join();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }

        <span class="hljs-comment">// 关闭Redis连接</span>
        queue.close();
    }
}
</code></pre>
<h3 data-id="heading-5">4. 基于Redis的可靠队列</h3>
<p>以上代码实现了一个简单的分布式队列，但在实际应用中，可能需要更加可靠的队列。例如，为了防止消费者在处理消息时出现故障，需要将消息标记为“正在处理”，并在处理完成后将其从队列中删除。</p>
<p>为此，我们可以使用Redis的RPOPLPUSH命令和一个辅助队列来实现可靠队列。</p>
<h4 data-id="heading-6">4.1. 可靠队列示例代码</h4>
<p>以下是基于RPOPLPUSH命令的可靠队列实现示例代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReliableRedisQueue</span> {
    <span class="hljs-keyword">private</span> Jedis jedis;
    <span class="hljs-keyword">private</span> String queueName;
    <span class="hljs-keyword">private</span> String processingQueueName;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ReliableRedisQueue</span><span class="hljs-params">(String host, <span class="hljs-type">int</span> port, String queueName)</span> {
        <span class="hljs-built_in">this</span>.jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(host, port);
        <span class="hljs-built_in">this</span>.queueName = queueName;
        <span class="hljs-built_in">this</span>.processingQueueName = queueName + <span class="hljs-string">":processing"</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">enqueue</span><span class="hljs-params">(String message)</span> {
        jedis.rpush(queueName, message);
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">dequeue</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> jedis.rpoplpush(queueName, processingQueueName);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">ack</span><span class="hljs-params">(String message)</span> {
        jedis.lrem(processingQueueName, <span class="hljs-number">1</span>, message);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        jedis.close();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// 初始化Redis可靠队列</span>
        <span class="hljs-type">ReliableRedisQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReliableRedisQueue</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>, <span class="hljs-string">"myReliableQueue"</span>);

        <span class="hljs-comment">// 生产者线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">producer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Message "</span> + (i + <span class="hljs-number">1</span>);
                queue.enqueue(message);
                System.out.println(<span class="hljs-string">"Produced: "</span> + message);
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">500</span>); <span class="hljs-comment">// 模拟生产间隔</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    e.printStackTrace();
                }
            }
        });

        <span class="hljs-comment">// 消费者线程</span>
        <span class="hljs-type">Thread</span> <span class="hljs-variable">consumer</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {
                <span class="hljs-type">String</span> <span class="hljs-variable">message</span> <span class="hljs-operator">=</span> queue.dequeue();
                <span class="hljs-keyword">if</span> (message != <span class="hljs-literal">null</span>) {
                    System.out.println(<span class="hljs-string">"Consumed: "</span> + message);
                    <span class="hljs-comment">// 模拟消息处理</span>
                    <span class="hljs-keyword">try</span> {
                        Thread.sleep(<span class="hljs-number">1000</span>);
                    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                        e.printStackTrace();
                    }
                    queue.ack(message);
                    System.out.println(<span class="hljs-string">"Acknowledged: "</span> + message);
                }
            }
        });

        <span class="hljs-comment">// 启动生产者和消费者线程</span>
        producer.start();
        consumer.start();

        <span class="hljs-comment">// 等待线程完成</span>
        <span class="hljs-keyword">try</span> {
            producer.join();
            consumer.join();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }

        <span class="hljs-comment">// 关闭Redis连接</span>
        queue.close();
    }
}
</code></pre>
<h3 data-id="heading-7">总结</h3>
<p>以上示例展示了如何使用Redis实现分布式队列，包括简单的队列和可靠队列的实现。通过Redis的列表结构和原子命令，可以轻松实现生产者和消费者模式，并通过RPOPLPUSH命令和辅助队列来提高可靠性。可以根据具体的业务需求，选择合适的队列实现方案，以确保系统的高效和稳定运行。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Springboot请求和响应相关注解及使用场景]]></title>    <link>https://juejin.cn/post/7581386627675717672</link>    <guid>https://juejin.cn/post/7581386627675717672</guid>    <pubDate>2025-12-08T23:10:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581386627675717672" data-draft-id="7581354812861218868" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Springboot请求和响应相关注解及使用场景"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-08T23:10:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Springboot请求和响应相关注解及使用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T23:10:52.000Z" title="Mon Dec 08 2025 23:10:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在Spring Boot中，请求和响应相关的注解主要用于处理HTTP请求和构建HTTP响应。以下是常用的请求和响应相关注解的详细介绍，包括使用场景和示例。</p>
<h3 data-id="heading-0">1. 请求处理注解</h3>
<h4 data-id="heading-1">@RequestMapping</h4>
<ul>
<li><strong>描述</strong>: 用于映射HTTP请求到处理方法上。</li>
<li><strong>使用场景</strong>: 可以用于类级别和方法级别，适用于所有HTTP方法（GET, POST, PUT, DELETE等）。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> {

    <span class="hljs-meta">@RequestMapping(value = "/hello", method = RequestMethod.GET)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, World!"</span>;
    }
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-2">@GetMapping, @PostMapping, @PutMapping, @DeleteMapping, @PatchMapping</h4>
<ul>
<li><strong>描述</strong>: 这些是 <code>@RequestMapping</code> 的快捷形式，用于特定的HTTP方法。</li>
<li><strong>使用场景</strong>: 用于简化请求映射。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> {

    <span class="hljs-meta">@GetMapping("/hello")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">sayHello</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, World!"</span>;
    }

    <span class="hljs-meta">@PostMapping("/create")</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createItem</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Item item)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Item created"</span>;
    }
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-3">@RequestParam</h4>
<ul>
<li><strong>描述</strong>: 用于将HTTP请求参数绑定到方法参数上。</li>
<li><strong>使用场景</strong>: 处理查询参数。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/greet")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">greet</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(name = "name", defaultValue = "World")</span> String name)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Hello, "</span> + name;
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-4">@PathVariable</h4>
<ul>
<li><strong>描述</strong>: 用于将URI模板变量绑定到方法参数上。</li>
<li><strong>使用场景</strong>: 处理路径参数。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/items/{id}")</span>
<span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getItem</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Long id)</span> {
    <span class="hljs-comment">// Logic to fetch item by id</span>
    <span class="hljs-keyword">return</span> item;
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-5">@RequestBody</h4>
<ul>
<li><strong>描述</strong>: 用于将HTTP请求体绑定到方法参数上，并使用HttpMessageConverter进行反序列化。</li>
<li><strong>使用场景</strong>: 处理请求体中的JSON或XML数据。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/items")</span>
<span class="hljs-keyword">public</span> Item <span class="hljs-title function_">createItem</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Item item)</span> {
    <span class="hljs-comment">// Logic to create item</span>
    <span class="hljs-keyword">return</span> item;
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-6">@RequestHeader</h4>
<ul>
<li><strong>描述</strong>: 将HTTP请求头中的某个值绑定到方法参数上。</li>
<li><strong>使用场景</strong>: 读取特定请求头信息。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/user-agent")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getUserAgent</span><span class="hljs-params">(<span class="hljs-meta">@RequestHeader("User-Agent")</span> String userAgent)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"User-Agent: "</span> + userAgent;
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-7">2. 响应处理注解</h3>
<h4 data-id="heading-8">@ResponseBody</h4>
<ul>
<li><strong>描述</strong>: 将方法返回值绑定到HTTP响应体上，并使用HttpMessageConverter进行序列化。</li>
<li><strong>使用场景</strong>: 直接返回JSON或XML格式的数据。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/items/{id}")</span>
<span class="hljs-meta">@ResponseBody</span>
<span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getItem</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Long id)</span> {
    <span class="hljs-comment">// Logic to fetch item by id</span>
    <span class="hljs-keyword">return</span> item;
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-9">@RestController</h4>
<ul>
<li><strong>描述</strong>: 组合注解，相当于@Controller和@ResponseBody的结合，所有方法默认返回JSON或XML格式的数据。</li>
<li><strong>使用场景</strong>: 用于标记RESTful控制器。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> {

    <span class="hljs-meta">@GetMapping("/items/{id}")</span>
    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getItem</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Long id)</span> {
        <span class="hljs-keyword">return</span> item;
    }
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-10">@ResponseStatus</h4>
<ul>
<li><strong>描述</strong>: 用于设置HTTP响应状态码。</li>
<li><strong>使用场景</strong>: 将特定的状态码返回到客户端。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/items")</span>
<span class="hljs-meta">@ResponseStatus(HttpStatus.CREATED)</span>
<span class="hljs-keyword">public</span> Item <span class="hljs-title function_">createItem</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Item item)</span> {
    <span class="hljs-keyword">return</span> item;
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-11">3. 异常处理注解</h3>
<h4 data-id="heading-12">@ExceptionHandler</h4>
<ul>
<li><strong>描述</strong>: 用于处理特定的异常，并返回自定义的响应。</li>
<li><strong>使用场景</strong>: 处理控制器中的异常。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> {

    <span class="hljs-meta">@GetMapping("/items/{id}")</span>
    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getItem</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Long id)</span> {
        <span class="hljs-keyword">if</span> (id == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ItemNotFoundException</span>(<span class="hljs-string">"Item not found"</span>);
        }
        <span class="hljs-keyword">return</span> item;
    }

    <span class="hljs-meta">@ExceptionHandler(ItemNotFoundException.class)</span>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.NOT_FOUND)</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">handleItemNotFoundException</span><span class="hljs-params">(ItemNotFoundException ex)</span> {
        <span class="hljs-keyword">return</span> ex.getMessage();
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-13">4. CORS支持</h3>
<h4 data-id="heading-14">@CrossOrigin</h4>
<ul>
<li><strong>描述</strong>: 用于启用跨域资源共享（CORS）。</li>
<li><strong>使用场景</strong>: 允许跨域请求。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/api")</span>
<span class="hljs-meta">@CrossOrigin(origins = "http://example.com")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyController</span> {

    <span class="hljs-meta">@GetMapping("/items/{id}")</span>
    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getItem</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable("id")</span> Long id)</span> {
        <span class="hljs-keyword">return</span> item;
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-15">5. 其他相关注解</h3>
<h4 data-id="heading-16">@RequestAttribute</h4>
<ul>
<li><strong>描述</strong>: 将请求范围内的属性绑定到方法参数上。</li>
<li><strong>使用场景</strong>: 处理在请求处理过程中设置的属性。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@GetMapping("/attributes")</span>
<span class="hljs-keyword">public</span> String <span class="hljs-title function_">getAttribute</span><span class="hljs-params">(<span class="hljs-meta">@RequestAttribute("myAttribute")</span> String myAttribute)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"Attribute: "</span> + myAttribute;
}
</code></pre>
</li>
</ul>
<h4 data-id="heading-17">@Valid</h4>
<ul>
<li><strong>描述</strong>: 用于验证请求体中的对象。</li>
<li><strong>使用场景</strong>: 对输入数据进行验证。</li>
<li><strong>示例</strong>:
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@PostMapping("/items")</span>
<span class="hljs-keyword">public</span> Item <span class="hljs-title function_">createItem</span><span class="hljs-params">(<span class="hljs-meta">@Valid</span> <span class="hljs-meta">@RequestBody</span> Item item)</span> {
    <span class="hljs-keyword">return</span> item;
}
</code></pre>
</li>
</ul>
<p>这些注解为Spring Boot提供了强大的请求和响应处理能力，帮助开发者轻松创建RESTful风格的API。通过合理使用这些注解，可以使代码更加清晰和易于维护。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[前端性能加速器：Vue Router懒加载与组件分包的极致优化]]></title>    <link>https://juejin.cn/post/7581117416812036139</link>    <guid>https://juejin.cn/post/7581117416812036139</guid>    <pubDate>2025-12-08T23:24:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581117416812036139" data-draft-id="7581312433530126379" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="前端性能加速器：Vue Router懒加载与组件分包的极致优化"/> <meta itemprop="keywords" content="JavaScript,前端,Vue.js"/> <meta itemprop="datePublished" content="2025-12-08T23:24:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小马写码"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            前端性能加速器：Vue Router懒加载与组件分包的极致优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小马写码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T23:24:18.000Z" title="Mon Dec 08 2025 23:24:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：当应用变"重"时，我们需要更聪明的加载策略</h2>
<p>在现代前端开发中，随着Vue应用功能日益丰富，组件数量不断增加，一个常见的问题逐渐浮现：<strong>初始加载时间越来越长</strong>。用户打开应用时，浏览器需要下载整个应用的JavaScript代码，包括那些用户可能永远不会访问的页面和功能。这不仅浪费了带宽，更直接影响了用户体验。有没有一种方法，可以"按需分配"资源，只在用户需要时才加载相应代码？这就是我们今天要探讨的Vue Router懒加载与组件分包优化的核心价值。</p>
<h2 data-id="heading-1">第一部分：传统路由加载的问题剖析</h2>
<p>在深入了解优化方案前，让我们先看看传统路由配置的局限性：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 传统的静态导入方式</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Home</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/views/Home.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">About</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/views/About.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Contact</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/views/Contact.vue'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Dashboard</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@/views/Dashboard.vue'</span>
<span class="hljs-comment">// ...可能还有几十个组件</span>

<span class="hljs-keyword">const</span> routes = [
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Home</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">About</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/contact'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Contact</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>, <span class="hljs-attr">component</span>: <span class="hljs-title class_">Dashboard</span> },
  <span class="hljs-comment">// ...所有路由在应用初始化时就已经被加载</span>
]
</code></pre>
<p>这种模式下，无论用户访问哪个页面，所有路由组件都会被打包进同一个JavaScript文件中。这意味着：</p>
<ol>
<li><strong>首屏加载时间长</strong>：用户需要等待所有代码下载完成</li>
<li><strong>资源浪费严重</strong>：用户可能永远不会访问某些页面，但这些页面的代码已经被加载</li>
<li><strong>缓存效率低</strong>：任何微小改动都会导致整个包需要重新下载</li>
</ol>
<h2 data-id="heading-2">第二部分：懒加载路由——按需加载的艺术</h2>
<p>Vue Router的懒加载功能通过动态导入（Dynamic Import）实现了路由组件的按需加载：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 使用懒加载的动态导入语法</span>
<span class="hljs-keyword">const</span> routes = [
  { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Home.vue'</span>) 
  },
  { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/About.vue'</span>) 
  },
  { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/contact'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Contact.vue'</span>) 
  },
  { 
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>, 
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/views/Dashboard.vue'</span>) 
  }
]
</code></pre>
<h3 data-id="heading-3">懒加载的工作原理</h3>
<p>当用户访问应用时，只有首页（Home）组件会被加载。当用户点击导航到"/about"时，Vue Router才会动态请求About组件的代码块。这种机制带来了显著的优化效果：</p>
<ol>
<li><strong>减少初始包体积</strong>：首屏只需要加载必要的代码</li>
<li><strong>并行加载能力</strong>：不同路由的代码可以并行下载</li>
<li><strong>智能缓存策略</strong>：每个路由组件可以独立缓存</li>
</ol>
<h2 data-id="heading-4">第三部分：高级分包策略——让优化更进一步</h2>
<p>基本的懒加载已经带来了显著提升，但我们可以通过更精细的分包策略进一步优化：</p>
<h3 data-id="heading-5">1. Webpack魔法注释：命名与分组</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/profile'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "user-pages" */</span> <span class="hljs-string">'@/views/user/Profile.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/user/settings'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "user-pages" */</span> <span class="hljs-string">'@/views/user/Settings.vue'</span>)
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/admin/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-comment">/* webpackChunkName: "admin-module" */</span> <span class="hljs-string">'@/views/admin/Dashboard.vue'</span>)
  }
]
</code></pre>
<p>通过<code>webpackChunkName</code>注释，我们可以：</p>
<ul>
<li><strong>相关组件打包到一起</strong>：减少HTTP请求数量</li>
<li><strong>创建有意义的文件名</strong>：便于调试和维护</li>
<li><strong>实现更精细的缓存控制</strong></li>
</ul>
<h3 data-id="heading-6">2. 预加载与预获取策略</h3>
<p>Vue Router 4.x 提供了更智能的预加载机制：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 配置预加载策略</span>
<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  routes,
  <span class="hljs-comment">// 预加载视口内链接对应的路由</span>
  <span class="hljs-title function_">scrollBehavior</span>(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, savedPosition</span>) {
    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">matched</span>.<span class="hljs-property">length</span>) {
      <span class="hljs-comment">// 预加载路由组件</span>
      to.<span class="hljs-property">matched</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">record</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> record.<span class="hljs-property">components</span>.<span class="hljs-property">default</span> === <span class="hljs-string">'function'</span>) {
          record.<span class="hljs-property">components</span>.<span class="hljs-title function_">default</span>()
        }
      })
    }
    <span class="hljs-keyword">return</span> savedPosition || { <span class="hljs-attr">top</span>: <span class="hljs-number">0</span> }
  }
})
</code></pre>
<h3 data-id="heading-7">3. 按用户角色分包</h3>
<p>针对不同用户角色进行代码分割：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 根据用户角色动态加载不同的模块</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">getUserRoleModule</span> = (<span class="hljs-params">role</span>) =&gt; {
  <span class="hljs-keyword">switch</span>(role) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'admin'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/modules/admin'</span>)
    <span class="hljs-keyword">case</span> <span class="hljs-string">'editor'</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/modules/editor'</span>)
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'@/modules/user'</span>)
  }
}

<span class="hljs-comment">// 在路由守卫中应用</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (to.<span class="hljs-property">meta</span>.<span class="hljs-property">requiresAdmin</span>) {
    <span class="hljs-keyword">const</span> adminModule = <span class="hljs-title function_">getUserRoleModule</span>(<span class="hljs-string">'admin'</span>)
    <span class="hljs-title function_">adminModule</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">next</span>())
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-title function_">next</span>()
  }
})
</code></pre>
<h2 data-id="heading-8">第四部分：最佳实践与性能监控</h2>
<h3 data-id="heading-9">分包优化检查清单</h3>
<ol>
<li><strong>路由层级分包</strong>：按功能模块划分代码块</li>
<li><strong>第三方库分离</strong>：将Vue、Vuex、Vue Router等库单独打包</li>
<li><strong>公共组件提取</strong>：提取跨路由使用的组件到公共块</li>
<li><strong>动态导入Vue组件</strong>：在组件内部也使用动态导入</li>
</ol>
<h3 data-id="heading-10">性能监控与度量</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 添加路由加载性能监控</span>
<span class="hljs-keyword">const</span> loadStartTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()

router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> startTime = performance.<span class="hljs-title function_">now</span>()
  
  <span class="hljs-title function_">next</span>()
  
  <span class="hljs-comment">// 监控路由切换性能</span>
  <span class="hljs-keyword">const</span> loadTime = performance.<span class="hljs-title function_">now</span>() - startTime
  <span class="hljs-keyword">if</span> (loadTime &gt; <span class="hljs-number">1000</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">`路由 <span class="hljs-subst">${to.path}</span> 加载时间过长: <span class="hljs-subst">${loadTime}</span>ms`</span>)
  }
})
</code></pre>
<h2 data-id="heading-11">第五部分：Vite环境下的优化差异</h2>
<p>如果你使用Vite而非Webpack，懒加载的实现更加简洁：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vite中的动态导入（无需特殊配置）</span>
<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/dashboard'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/Dashboard.vue'</span>)
  }
]
</code></pre>
<p>Vite利用原生ES模块特性，在开发环境中提供极快的热更新，在生产构建时自动进行代码分割。</p>
<h2 data-id="heading-12">结语：打造轻盈而强大的Vue应用</h2>
<p>Vue Router懒加载与组件分包优化不仅是一种技术实现，更是一种<strong>用户体验至上的开发哲学</strong>。通过将"一次性加载"转变为"按需加载"，我们不仅减少了初始加载时间，还创造了更加流畅、响应更快的应用体验。</p>
<p>记住，优化的核心在于<strong>平衡</strong>：代码分割的粒度越细，HTTP请求越多；分割的粒度越粗，加载冗余越多。优秀的开发者需要根据具体应用场景找到最佳平衡点。</p>
<p>在当今追求极致用户体验的时代，掌握懒加载与分包优化技术，意味着你能够打造出既功能丰富又响应迅速的前端应用。这不仅是技术能力的体现，更是对用户时间与体验的尊重。开始优化你的Vue应用吧，让每一个字节的加载都有其价值，让每一次用户交互都流畅自然。</p>
<p><strong>优化之路，永无止境；用户体验，始终至上。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[面对新电脑，前端开发者需要进行哪些初始化配置]]></title>    <link>https://juejin.cn/post/7581396828123103266</link>    <guid>https://juejin.cn/post/7581396828123103266</guid>    <pubDate>2025-12-08T23:40:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581396828123103266" data-draft-id="7581314241411317795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="面对新电脑，前端开发者需要进行哪些初始化配置"/> <meta itemprop="keywords" content="前端,GitHub"/> <meta itemprop="datePublished" content="2025-12-08T23:40:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="抹茶冰淇淋"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289956471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            面对新电脑，前端开发者需要进行哪些初始化配置
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289956471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    抹茶冰淇淋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T23:40:36.000Z" title="Mon Dec 08 2025 23:40:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>大家好，我是抹茶。
最近将Mac电脑降级成V12后,需要重新安装软件，配置环境，便记录这一过程，分享给需要的人和未来某个时刻的自己。</p>
<h2 data-id="heading-1">软件</h2>
<p>还原到初始状态的电脑，就只有safari浏览器了，平时用惯了谷歌，所以第一步就是下载谷歌浏览器。
依此安装的软件清单如下：</p>
<ol>
<li>谷歌浏览器</li>
<li>vscode (编码工具)</li>
<li>notion （笔记）</li>
<li>snipate （截图软件）</li>
<li>万兴脑图 （思维导图）</li>
<li>微信</li>
<li>欧路词典 （英语）</li>
<li>腾讯会议</li>
</ol>
<h2 data-id="heading-2">环境依赖</h2>
<h3 data-id="heading-3">1. 安装xcode</h3>
<p>指令<code>xcode-select --install</code>
如果没有安装xcode，在试图用指令安装<code>nvm</code>时，就会看到下面的提示</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c6b3b6c26cd14b3b9e7bbe5239d30d94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842405&amp;x-signature=x0TiF2diCXIidX%2Bvnl8PEUzbu34%3D" alt="image.png" width="70%" loading="lazy"/>
<h3 data-id="heading-4">2. git生态</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fbook%2Fzh%2Fv2%2F%25E8%25B5%25B7%25E6%25AD%25A5-%25E5%25AE%2589%25E8%25A3%2585-Git" target="_blank" title="https://git-scm.com/book/zh/v2/%E8%B5%B7%E6%AD%A5-%E5%AE%89%E8%A3%85-Git" ref="nofollow noopener noreferrer">git-scm.com/book/zh/v2/…</a></p>
<p>官网提示最方便的是通过<code>xcode</code>安装</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f9161b9fba14399bf6729f07f55abc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842405&amp;x-signature=YdYJCeKKgOXhXNFsXb4N%2ByJ198Y%3D" alt="image.png" width="70%" loading="lazy"/>
<p>直接运行<code>git --version</code>后，触发xcode的安装提示，如果没有，可以直接运行<code>xcode-select --install</code></p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37c76849031446caa472b1dcfeecfa7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842405&amp;x-signature=dCRpkzOa2YqDcFMDVcZ6r7hokho%3D" alt="image.png" width="70%" loading="lazy"/>
<h4 data-id="heading-5">git 邮箱和昵称配置</h4>
<pre><code class="hljs language-git" lang="git"># 配置全局用户名（请将 Your Name 替换成你的名字）
git config --global user.name "Your Name"

# 配置全局邮箱（请将 your.email@example.com 替换成你的邮箱）
git config --global user.email "your.email@example.com"
</code></pre>
<p>查看配置是否生效</p>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">config</span> <span class="hljs-comment">--list</span>
</code></pre>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bb1112bfc07c444d80855ff4003f59d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842405&amp;x-signature=D1iizponpVW9oG%2BRNK7ozv1NmHM%3D" alt="image.png" width="70%" loading="lazy"/>
<h4 data-id="heading-6">git SSH生成与配置</h4>
<h5 data-id="heading-7">1. 生成SSH key</h5>
<pre><code class="hljs language-perl" lang="perl">ssh-keygen -t ed25519 -C <span class="hljs-string">"your_email@example.com"</span>
</code></pre>
<ol>
<li><strong>“Enter file in which to save the key (...)”</strong> ：询问密钥保存路径。<strong>直接按回车</strong>，使用默认路径 <code>~/.ssh/id_ed25519</code>。</li>
<li><strong>“Enter passphrase (empty for no passphrase):”</strong> ：设置一个<strong>密钥密码</strong>。输完按回车，并按要求再确认输入一次。亲测输入密码后每次运行git指令都要敲密码。</li>
</ol>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b681e1d94b04f25a9f99d6a20b8cb1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842405&amp;x-signature=VUuqG5a38ol%2Fi7AFi7Z8XExdBik%3D" alt="image.png" width="70%" loading="lazy"/>
<h5 data-id="heading-8">2. 复制公钥到粘贴板</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 通用命令（自动复制到剪贴板）</span>
pbcopy &lt; ~/.ssh/id_ed25519.pub
</code></pre>
<h5 data-id="heading-9">3. 配置公钥到github</h5>
<p>头像=&gt; setting= &gt;SSH and GPG keys</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/395c53f8158848e592e634cac42b290d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842405&amp;x-signature=UXN9DMHjtu7zCBFH%2Bti990BIlQM%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-10">4. 测试连接</h5>
<p>添加后，在终端测试连接是否成功：</p>
<pre><code class="hljs language-css" lang="css">ssh -T git<span class="hljs-keyword">@github</span>.com
</code></pre>
<h3 data-id="heading-11">3. node生态</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fzh-cn%2Fdownload" target="_blank" title="https://nodejs.org/zh-cn/download" ref="nofollow noopener noreferrer">nodejs.org/zh-cn/downl…</a></p>
<p>现在node官网进化了，整个node生态都可以指令化安装了。这里的使用前提是已经安装xcode</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/def97d37413d411c8ac205c0caf29ce0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842405&amp;x-signature=Ewf7rXisKU0Hm7NZG%2B1hWaPOWtg%3D" alt="image.png" loading="lazy"/></p>
<p>官网指令搬运工如下：</p>
<pre><code class="hljs language-javascript" lang="javascript"># 下载并安装 nvm：
curl -o- <span class="hljs-attr">https</span>:<span class="hljs-comment">//raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash</span>

# 代替重启 shell
\. <span class="hljs-string">"$HOME/.nvm/nvm.sh"</span>

# 下载并安装 <span class="hljs-title class_">Node</span>.<span class="hljs-property">js</span>：
nvm install <span class="hljs-number">24</span>

# 验证 <span class="hljs-title class_">Node</span>.<span class="hljs-property">js</span> 版本：
node -v 

# <span class="hljs-title class_">Should</span> print <span class="hljs-string">"v24.11.1"</span>.
# 下载并安装 pnpm：
corepack enable pnpm

# 验证 pnpm 版本：

pnpm -v
</code></pre>
<p>亲测安装官网指令直接一步成功。</p>
<p>接下来，从github下载项目，就可以开始美美得写代码了。</p>
<h2 data-id="heading-12">总结</h2>
<p>本文梳理了重装系统后，需要安装的软件和环境依赖。从入门到电脑可以开始处理工作，需要安装这些软件，供大家参考。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Tiptap 编写一个富文本编辑器为什么对很多人来说很难 🤔🤔🤔]]></title>    <link>https://juejin.cn/post/7581385235964510242</link>    <guid>https://juejin.cn/post/7581385235964510242</guid>    <pubDate>2025-12-08T23:47:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581385235964510242" data-draft-id="7581385235964395554" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Tiptap 编写一个富文本编辑器为什么对很多人来说很难 🤔🤔🤔"/> <meta itemprop="keywords" content="前端,JavaScript,GitHub"/> <meta itemprop="datePublished" content="2025-12-08T23:47:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Tiptap 编写一个富文本编辑器为什么对很多人来说很难 🤔🤔🤔
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T23:47:48.000Z" title="Mon Dec 08 2025 23:47:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><blockquote>
<p>我正在开发 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow</a>，一个完整的 AI 全栈协同文档项目。这个项目涵盖了前端富文本编辑器（基于 Tiptap）、后端服务、AI 集成、实时协作等多个技术栈。在开发过程中，我积累了丰富的实战经验，包括 Tiptap 的深度定制、性能优化、协作功能实现等核心难点。如果你对 AI 全栈开发、Tiptap 富文本编辑器定制、或者 DocFlow 项目的完整技术方案感兴趣，想系统学习相关技术栈和最佳实践，欢迎加我微信 <code>yunmz777</code> 私聊咨询。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/edf437a5ed804b62b407246cbbfd9574~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9tZW50:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765842468&amp;x-signature=H6pEszCPtXo3pprOvi6u4Ur2YwQ%3D" alt="20251209053826" loading="lazy"/></p>
<p>用 Tiptap 做富文本编辑器，听起来挺美好，实际上却让不少人头疼。虽然它比从零开始写编辑器要友好得多，但真正上手后你会发现，想要做出一个能用的编辑器，难度远超预期。</p>
<p>这篇文章想聊聊，为什么 Tiptap 对很多人来说这么难，以及在实际项目中会遇到哪些坑。</p>
<h2 data-id="heading-0">为什么很多人选择 Tiptap</h2>
<p>先说说 Tiptap 吸引人的地方。</p>
<p><code>基于 ProseMirror 的稳健基础</code> 是它最大的卖点。ProseMirror 这个底层框架被 Notion、Linear 这些产品验证过，稳定性没问题。Tiptap 在它上面做了封装，提供了 starter-kit、基础扩展、getHTML、getJSON 这些常用 API，让你不用直接面对 ProseMirror 的复杂性。</p>
<p><code>模块化设计</code> 也很讨喜。按需加载，基础功能可以保持 bundle 很小，需要的时候再扩展。这种设计符合现代前端开发习惯，你可以根据项目需求灵活选择功能。</p>
<p><code>框架集成</code> 做得不错。React、Vue、Svelte 都有官方包，可以在熟悉的框架生态里工作，不用重新学习一套东西。</p>
<p><code>社区活跃度</code> 也还行。GitHub 上 star 不少，issue 讨论也很多，遇到问题至少能找到一些线索。</p>
<p>所以 Tiptap 确实降低了门槛，但降低门槛不等于消除复杂性。这是理解它为什么仍然困难的关键。</p>
<h2 data-id="heading-1">然而，"难"的原因很多</h2>
<p>"降低门槛" ≠ "变成容易"。下面这些挑战，往往在项目推进过程中才会逐渐暴露。</p>
<h3 data-id="heading-2">1. 底层复杂：ProseMirror 的抽象与复杂性</h3>
<p>Tiptap 虽然封装了 ProseMirror，但本质上还是基于它。有文章提到：</p>
<blockquote>
<p>"Tiptap is built on top of ProseMirror, a robust yet difficult to master editor."</p>
</blockquote>
<p>这话不假。一旦你需要做高级定制，比如自定义节点、插件、命令、协作同步，你就得深入 ProseMirror。那些抽象概念对很多前端工程师来说并不直观。</p>
<h4 data-id="heading-3">抽象概念的学习曲线</h4>
<p><code>Document Model</code> 是第一个坎。ProseMirror 用自己的一套文档模型，不是直接操作 DOM。这是个树状结构，每个节点有类型、属性、内容。理解这个模型需要思维转换，习惯了 DOM 操作的人一开始会不适应。</p>
<p><code>Schema</code> 设计也不简单。它定义了文档里能有哪些节点和标记，以及它们之间的关系。设计一个合理的 schema 需要深入理解文档结构，遇到表格嵌套、列表嵌套这些复杂情况时尤其头疼。</p>
<p><code>Transaction</code> 系统是另一个难点。ProseMirror 用 transaction 处理所有文档变更，每个编辑操作都会创建一个 transaction，描述从旧状态到新状态的变化。要实现撤销、重做、协作这些功能，必须理解 transaction 的工作原理。</p>
<p><code>Selection</code> 管理比想象中复杂。不同浏览器对 selection 的处理不一致，文档结构复杂时（比如表格、列表），selection 的行为经常不符合预期。你以为选中了，实际上可能选中的是别的东西。</p>
<p><code>Node View</code> 更麻烦。当你需要自定义节点渲染和交互时（比如代码块、表格、嵌入内容），你得同时理解 React、Vue 组件系统和 ProseMirror 的节点系统，两者之间的桥接并不总是直观。</p>
<h4 data-id="heading-4">实际开发中的具体困难</h4>
<p>很多人一开始觉得"写个富文本编辑器不就是个 textarea + toolbar 吗"，等真正要兼容多个格式、插入图片表格、撤销重做、协作、粘贴处理、HTML 和 JSON 转换时，才发现坑深如海。</p>
<p>举个例子，实现一个简单的图片上传功能，你需要：</p>
<ol>
<li>创建自定义 Image 节点类型</li>
<li>实现 Node View 来渲染图片</li>
<li>处理图片上传逻辑（拖拽、粘贴、URL 输入等多种方式）</li>
<li>处理图片加载失败的情况</li>
<li>实现图片大小调整、对齐等功能</li>
<li>处理响应式布局</li>
<li>处理图片的序列化和反序列化</li>
</ol>
<p>这还只是图片功能。如果再加上表格、代码块、嵌入内容，复杂度会成倍增加。</p>
<h3 data-id="heading-5">2. 功能多样，需求场景差异极大</h3>
<p>富文本编辑器不是"一个按钮能解决所有问题"。不同应用对文档编辑的需求千差万别，这种多样性让"万能"解决方案变得不现实。</p>
<h4 data-id="heading-6">从 Word、Google Docs 复制粘贴的噩梦</h4>
<p>从 Word 复制内容到编辑器，听起来简单，实际上是个噩梦。</p>
<p>浏览器接收到的是一堆内联样式、嵌套的 div 和 span、字体信息、颜色信息。这些内容需要被"清洗"和转换为你编辑器中的节点结构。你得识别和转换段落、标题、列表，处理表格（包括合并单元格、嵌套表格），处理图片和嵌入内容，清理不必要的样式和标签，处理特殊字符和编码问题。</p>
<p>很多编辑器（包括 Tiptap）对此处理并不理想。你往往需要自己实现或扩展粘贴处理逻辑，这需要深入理解 ProseMirror 的 paste rules 和 clipboard 处理机制。</p>
<h4 data-id="heading-7">媒体与复杂内容支持的工作量被低估</h4>
<p>你可能需要支持图片、视频、embed、附件、表格、表单，还要支持拖拽、上传、调整、重排、自定义样式、响应式、兼容多端。这意味着不仅是文本，还要管理复杂结构。</p>
<p>以表格为例，实现一个功能完整的表格编辑器需要：</p>
<ul>
<li>表格的创建、删除、行列的增删</li>
<li>单元格的合并和拆分</li>
<li>表格样式的自定义（边框、背景色、对齐方式等）</li>
<li>表格内容的编辑（包括嵌套其他节点类型）</li>
<li>表格的响应式处理（在小屏幕上如何显示）</li>
<li>表格的序列化和反序列化</li>
<li>表格的复制粘贴处理</li>
</ul>
<p>这还只是表格。如果再加上图片的拖拽调整大小、视频的播放控制、嵌入内容的交互，工作量会急剧增加。很多人低估了这部分工作量，以为"用个扩展就行"，实际上往往需要大量的定制开发。</p>
<h4 data-id="heading-8">协作功能的指数级复杂度</h4>
<p>如果还要加协作（多人实时编辑）、版本历史、评论、建议编辑、合并、冲突解决，那就更复杂了。有文章指出："无论你选择哪种富文本编辑器，把协作功能加进去都是一件非常具有挑战性的事情。"</p>
<p>协作编辑涉及：</p>
<ul>
<li><code>实时同步</code>：需要 WebSocket 或类似技术来实时同步编辑操作</li>
<li><code>冲突解决</code>：当多个用户同时编辑同一部分时，如何解决冲突</li>
<li><code>操作转换（OT）或 CRDT</code>：需要算法来保证最终一致性</li>
<li><code>版本历史</code>：需要记录每次变更，支持回滚和查看历史</li>
<li><code>权限管理</code>：不同用户可能有不同的编辑权限</li>
<li><code>评论系统</code>：需要在文档中插入评论，并管理评论的生命周期</li>
<li><code>建议编辑</code>：允许用户提出编辑建议，而不是直接修改</li>
</ul>
<p>即使使用 Y.js 这样的协作框架，你仍然需要处理很多细节，比如如何将 ProseMirror 的 transaction 转换为 Y.js 的操作，如何处理网络延迟和断线重连，如何处理冲突等。</p>
<p><code>通用 + 万能 + 高可定制 + 多功能</code>，是个"理想"与"魔鬼"并存的组合。很多团队和个人在最初没评估清楚就上了车，最后才发现问题。</p>
<h3 data-id="heading-9">3. 性能、UX、浏览器兼容的复杂度</h3>
<h4 data-id="heading-10">性能问题的真实存在</h4>
<p>有人反映，当文档很长（上百、几百条目、复杂结构）且含多种格式、嵌入、样式、块时，Tiptap 的响应会变慢。有使用者说：</p>
<blockquote>
<p>"One of the big gotchas I've had with TipTap is that it's extremely sluggish once you get to more than 300 words or so and you're using different formatting options."</p>
</blockquote>
<p>这个问题的根源在于：</p>
<ul>
<li><code>DOM 操作的开销</code>：每次编辑操作都可能触发 DOM 的更新，当文档很大时，这些更新会变得很慢</li>
<li><code>重渲染的成本</code>：React、Vue 组件的重渲染可能不够优化，导致不必要的更新</li>
<li><code>内存占用</code>：大文档会占用大量内存，特别是在移动设备上</li>
</ul>
<p>解决性能问题需要按需渲染、虚拟滚动、优化更新策略、垃圾回收优化、防抖和节流。这些优化都需要深入理解 ProseMirror 和框架的工作原理，不是简单的配置就能解决的。</p>
<h4 data-id="heading-11">跨浏览器兼容性的挑战</h4>
<p>不同浏览器对 content-editable、selection、复制粘贴行为的处理并不一致。兼容性问题、剪贴板行为差异、样式冲突、默认样式覆盖、CSS reset、响应式布局等等，都容易让人头疼。</p>
<p>具体问题包括：</p>
<ul>
<li><code>Selection API 的差异</code>：不同浏览器对 selection 的处理方式不同，特别是在处理复杂节点（如表格、列表）时</li>
<li><code>Clipboard API 的差异</code>：复制粘贴的行为在不同浏览器中可能不同</li>
<li><code>ContentEditable 的行为差异</code>：不同浏览器对 content-editable 元素的处理方式不同</li>
<li><code>移动端的特殊问题</code>：移动端的键盘、触摸事件、输入法等都会影响编辑体验</li>
<li><code>样式兼容性</code>：不同浏览器的默认样式不同，需要大量的 CSS reset 和兼容性处理</li>
</ul>
<p>这正是很多人不想"从头搞一个富文本编辑器"的原因。</p>
<h4 data-id="heading-12">生产环境的额外复杂度</h4>
<p>如果你的编辑器用于生产系统，还可能涉及数据持久化、存储格式选择、解析和回显、版本控制、迁移、与后端兼容、安全（XSS）、国际化、多语言、字体、排版、方向（RTL）等。</p>
<p>当这些积累起来，远超"几行代码 + 一个 toolbar + 一个富文本输入框"的复杂度。</p>
<h3 data-id="heading-13">4. 社区与文档 ≠ "覆盖所有场景"</h3>
<p>虽然 Tiptap 本身文档、示例、社区不错，但对于特定复杂场景（比如"带表格 + 嵌入 + 自定义 node + 协作 + Undo、Redo + 导出 + 插件系统 + 自定义样式、主题、布局、响应式、多端"），几乎不存在一个"现成解决方案"。</p>
<h4 data-id="heading-14">文档的局限性</h4>
<p>Tiptap 的官方文档主要覆盖了基础用法和常见场景，但对于复杂场景，文档往往只能提供方向性的指导，具体的实现细节需要你自己去探索。</p>
<p>比如如何实现一个自定义的表格编辑器，支持合并单元格、调整列宽等功能？如何实现一个代码块编辑器，支持语法高亮、行号、代码折叠？如何实现一个协作编辑系统，处理冲突和同步？如何实现一个导出系统，将编辑器内容导出为 PDF、Word 等格式？</p>
<p>这些场景的文档往往不够详细，或者根本没有文档。你需要阅读源码来理解工作原理，在 GitHub 上搜索相关的 issue 和讨论，在社区中提问（但可能得不到及时回复），自己实验和调试。</p>
<h4 data-id="heading-15">需要自己设计的部分</h4>
<p>多数时候你得自己设计 Schema、Node View、Commands、插件体系、交互逻辑、前端-后端同步、数据库存储方案等。</p>
<p><code>复杂度被隐藏在"源码 + 配置 + 扩展 + 兼容性 + 性能调优 + 测试 + 边界 case 处理"</code> 后面。</p>
<h4 data-id="heading-16">从"用个库就好"到"坑太多"的转变</h4>
<p>很多人在刚开始抱着"用个库就好"的想法，但不到真正要满足复杂需求的时候，就发现坑太多。</p>
<p>你以为插入图片很简单，结果发现需要处理上传、加载失败、响应式、拖拽调整大小等多个问题。你以为实现表格很简单，结果发现需要处理合并单元格、嵌套表格、复制粘贴等复杂情况。你以为实现协作很简单，结果发现需要处理冲突、同步、权限等多个问题。</p>
<p>有人甚至建议，如果你的需求很基础（只是简单文字 + 粗体斜体 + 列表 + 少量图片），用 Markdown 编辑器 + 轻量富文本或简易配置反而更稳。</p>
<h3 data-id="heading-17">5. 心理预期 vs 现实落地</h3>
<p>很多产品经理或不熟悉富文本底层的人，会把富文本编辑器当成"轻量版 Word、Google Docs、所见即所得编辑器"。但事实是，浏览器里的 contenteditable + 富文本编辑器，受限于 DOM、Selection、样式、多端差异、复制粘贴行为、HTML → Model → HTML 的 round-trip、标准兼容性、性能、插件生态等等。</p>
<h4 data-id="heading-18">Word 级别的功能需要 Word 级别的投入</h4>
<p>要做到"像 Word 那么强大又稳定"，就算用了 Tiptap，也至少要投入非常多开发 + 测试 + 兼容 + 优化 + 维护成本。</p>
<p>Word 的表格编辑器是几十年的积累，而 Web 编辑器要实现类似功能需要从零开始。Word 的协作功能是 Microsoft 团队多年研发的结果，而 Web 编辑器要实现类似功能需要自己实现或集成第三方服务。Word 的导出功能支持多种格式，而 Web 编辑器要实现类似功能需要集成多个库或自己实现。</p>
<h4 data-id="heading-19">"跳进兔子洞"的风险</h4>
<p>这是为什么很多从头搞的人（尤其业务方、非编辑器专注团队）最终放弃的原因。甚至有开发者在讨论里直言：构建富文本编辑器"像跳进 rabbit hole"（兔子洞），风险太大，不靠谱。</p>
<p>这个比喻很形象：你以为只是挖一个小洞，结果发现下面是一个深不见底的兔子洞，越挖越深，越挖越复杂，最终发现自己投入的时间和精力远超预期。</p>
<h2 data-id="heading-20">对开发者、项目经理、内容生产者来说：为什么依旧容易被难住</h2>
<p>对于不同类型的角色，Tiptap 的困难点可能有所不同，但都会面临一些共同的挑战。</p>
<h3 data-id="heading-21">内容存储格式的复杂性</h3>
<p>你需要考虑 HTML、JSON、markdown、自定义格式。Tiptap 支持 JSON、HTML 输出、回显，但如果你要自定义节点（例如 embed、图文混排、特殊 block、meta 数据、AI-辅助内容），那就需要你设计 schema，处理序列化、反序列化逻辑，以及前后端如何统一处理这些内容结构。</p>
<h4 data-id="heading-22">格式选择的权衡</h4>
<p>每种格式都有其优缺点：</p>
<ul>
<li><code>HTML</code>：最直观，但可能包含大量冗余信息，不利于存储和传输</li>
<li><code>JSON</code>：结构化好，易于处理，但需要自定义解析逻辑</li>
<li><code>Markdown</code>：简洁，但表达能力有限，不适合复杂内容</li>
<li><code>自定义格式</code>：最灵活，但需要自己实现所有逻辑</li>
</ul>
<p>选择哪种格式需要根据你的具体需求来决定，这个决定会影响整个系统的架构。</p>
<h4 data-id="heading-23">Schema 设计的挑战</h4>
<p>设计一个好的 schema 需要考虑哪些节点类型是必需的、节点之间的包含关系、节点的属性、节点的默认样式和行为、如何扩展 schema 以支持未来需求。这需要深入理解你的内容模型和业务需求。</p>
<p>Tiptap 文档中虽有基础 API，但自定义越深，你要写的东西就越多。</p>
<h3 data-id="heading-24">可视化与发布的多个层面</h3>
<p>如果你希望支持可视化、可发布（类似公众号、社交媒体、Markdown 转 HTML、文章导出、静态页面），你还可能涉及样式渲染、响应式、兼容性、多端适配、HTML sanitation、安全（XSS）、图片、资源管理、SEO、导出与预览等。</p>
<p>每个层面都需要深入的工作，不是简单的配置就能解决的。</p>
<h3 data-id="heading-25">协作功能的指数级复杂度</h3>
<p>若你还想加协作（多人编辑、实时、历史、评论、AI 辅助、版本、导出、回滚），那复杂度呈指数级增长。</p>
<h4 data-id="heading-26">基础框架只是开始</h4>
<p>即便 Tiptap + Y.js + WebSocket、后端，也只是基础框架。你可能还需要额外处理冲突解决、数据同步、权限管理、undo、redo、版本存储、合并逻辑、并发控制、UI、UX 体验、多端协作（桌面、移动）等。</p>
<h4 data-id="heading-27">"要么你自己写，要么妥协"</h4>
<p>很多细节是"要么你自己写，要么妥协"。如果你需要显示其他用户的光标位置，你需要自己实现这个功能。如果你需要支持评论和建议编辑，你需要自己实现这些功能。如果你需要支持版本历史，你需要自己实现版本管理系统。</p>
<p>事实证明，哪怕是经验丰富的团队也要花费相当多时间。</p>
<h3 data-id="heading-28">性能与用户体验的持续挑战</h3>
<p>当文档较大、格式复杂、包含多种节点、嵌入、图片、表格、样式时，要保证编辑体验流畅、不卡顿、不闪烁、不延迟，是个挑战。</p>
<p>性能问题可能出现在输入延迟、滚动卡顿、渲染延迟、内存占用、CPU 占用等多个维度。</p>
<p>尤其对移动端、低性能设备，或者需要即时渲染、同步、预览时，卡顿体验对用户友好度伤害很大。移动端的挑战包括性能更有限、触摸交互与鼠标交互不同、键盘输入体验不同、网络可能不稳定、电池续航需要考虑等。</p>
<h3 data-id="heading-29">这些挑战是核心需求，不是边缘用例</h3>
<p>如果你未来可能会做"复杂内容 + 社交、公众号、文章、AI 辅助、可能多人协作、排版导出"的系统，这些挑战并不是边缘用例，而可能是核心需求。这意味着你不能简单地"先做一个简单版本，以后再优化"，而是需要在设计阶段就考虑这些挑战。</p>
<h2 data-id="heading-30">总结：为什么"对很多人来说，Tiptap 很难"</h2>
<h3 data-id="heading-31">富文本编辑本身是高度复杂的问题</h3>
<p>格式多样（文本、段落、列表、样式、嵌入、媒体、表格...）+ 用户期望高（像 Word、Google Docs、CMS 编辑那样自然）+ 浏览器、DOM、标准、兼容性、性能各类限制，这些因素叠加在一起，使得富文本编辑成为一个高度复杂的问题。</p>
<h3 data-id="heading-32">底层复杂度依然存在</h3>
<p>虽然 Tiptap 封装了一些基础，但底层仍是复杂，高度定制、复杂功能、实用级需求基本都需要"深入 ProseMirror + 自己实现"。Tiptap 降低了入门门槛，但没有消除复杂性。</p>
<h3 data-id="heading-33">成本压力大</h3>
<p>对大多数中小团队、个人开发者、希望快速上线的人来说，真正把富文本编辑器"做好、做稳、做可维护"，工时、测试、兼容性、性能、维护、边缘 case 全都压得人喘不过气。这个成本往往被低估。</p>
<h3 data-id="heading-34">维护成本持续累积</h3>
<p>当需求不断变化（新功能、新格式、新媒体、新协作、新导出、新兼容）的时候，维护成本会不断累积，很多人最终发现"再也不想碰富文本编辑器"。这是一个持续的过程，不是一次性的投入。</p>
<h3 data-id="heading-35">心理预期与现实的差距</h3>
<p>很多人对富文本编辑器的期望是"像 Word 那样强大"，但现实是 Web 编辑器的能力有限，要实现类似功能需要大量投入。这个差距导致了很多项目的失败。</p>
<h2 data-id="heading-36">建议：基于实际需求的实践路径</h2>
<p>虽然 Tiptap 很难，但这并不意味着你不应该使用它。关键是要有正确的预期和合理的规划。</p>
<h3 data-id="heading-37">1. 先做 Minimal Viable Editor (MVE)</h3>
<p>用 Tiptap + StarterKit 做基础（段落、标题、粗体、斜体、列表、链接、图片）。如果你主要是发文、写文章、有一定样式要求，这足够。不要一开始就试图实现所有功能。</p>
<h3 data-id="heading-38">2. 根据需要逐步扩展</h3>
<p>只当确实需要"嵌入、表格、特殊布局、导出、协作、AI 插件、自定义 node"时，再考虑扩展，而不是一开始就设计"万能 + 所有可能功能"。每个功能的添加都需要评估其成本和收益。</p>
<h3 data-id="heading-39">3. 把 Schema、数据结构设计做好</h3>
<p>选好内容存储格式（JSON、HTML、自定义 + metadata），并确保前后端、导入导出、兼容、未来扩展都考虑进去。一个好的数据结构设计可以避免很多后续问题。</p>
<h3 data-id="heading-40">4. 权衡收益 vs 成本</h3>
<p>对于一些不常用或复杂功能（比如复杂表格、拖拽布局、多人协作、版本控制、复杂导出...）要评估清楚，是不是值得投入，或者可以通过 Markdown + 插件 + 后处理导出来替代。不是所有功能都需要在编辑器中实现。</p>
<h3 data-id="heading-41">5. 做好测试与回退、兼容策略</h3>
<p>包括浏览器兼容、移动端、自定义样式、theme、内容导出、清洗（sanitize）、未来迁移、升级。这些工作虽然繁琐，但对于生产环境是必需的。</p>
<h3 data-id="heading-42">6. 考虑替代方案</h3>
<p>如果你的需求相对简单，考虑使用 Markdown 编辑器 + 后处理的方式，可能比直接使用富文本编辑器更简单、更稳定。Markdown 虽然表达能力有限，但对于很多场景已经足够，而且实现和维护成本要低得多。</p>
<h3 data-id="heading-43">7. 寻求专业帮助</h3>
<p>如果项目预算允许，考虑寻求专业的编辑器开发团队或咨询服务的帮助。富文本编辑器是一个专业领域，有经验的人可以帮你避免很多坑。</p>
<h2 data-id="heading-44">总结</h2>
<p>Tiptap 是一个优秀的富文本编辑器框架，它确实降低了开发门槛，但这并不意味着它简单。理解其复杂性，有正确的预期，做好规划，是成功使用 Tiptap 的关键。</p>
<p>如果你正在考虑使用 Tiptap，希望这篇文章能帮助你更好地评估项目的复杂度和成本，做出明智的决策。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[挖掘“沉默的专家” -- 肘子的 Swift 周报 #114]]></title>    <link>https://juejin.cn/post/7581359420392210459</link>    <guid>https://juejin.cn/post/7581359420392210459</guid>    <pubDate>2025-12-08T23:59:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581359420392210459" data-draft-id="7580394927978856467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="挖掘“沉默的专家”  -- 肘子的 Swift 周报 #114"/> <meta itemprop="keywords" content="Swift,SwiftUI,人工智能"/> <meta itemprop="datePublished" content="2025-12-08T23:59:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="东坡肘子"/> <meta itemprop="url" content="https://juejin.cn/user/1548526032528727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            挖掘“沉默的专家”  -- 肘子的 Swift 周报 #114
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1548526032528727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    东坡肘子
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T23:59:33.000Z" title="Mon Dec 08 2025 23:59:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f949add546844fe896660a71a4514be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Z2h6IKY5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765843173&amp;x-signature=OkHRgsQFSyhwag2oYl4QqY4fN60%3D" alt="issue114.webp" loading="lazy"/></p>
<h2 data-id="heading-0">挖掘“沉默的专家”</h2>
<p>关注我博客的读者可能留意到，最近一段时间我较少发表个人的作品，取而代之的是，我陆续发布了多篇来自不同开发者的客座文章。没错，这是我近期发起的一项特别企划——邀请那些在各自领域深耕且卓有建树的开发者，分享他们的实战经历、独家秘籍、独特视角以及心路历程。</p>
<p>作为一名博主，不知不觉间我已经写了几百篇文章。虽然我相信这些内容仍具价值，但不得不承认，和许多定期输出的作者一样，我逐渐陷入了一种“程式化”的写作惯性中。我的文章往往侧重于探讨 API 的用法、剖析内部细节，但更多是基于“Demo”思维来构建的。即便涉及 Bug 修复或避坑指南，往往也只是处理一个个孤立的“点”，而非连贯的“线”或“面”。</p>
<p>作为周报编辑，我也观察到：尽管互联网上每周都有大量优秀技术文章涌现，但针对特定领域、能展开深度讨论且贴近一线实战的内容却显得稀缺。逐渐我意识到，主要原因是那些奋战在一线的开发者往往缺乏时间或精力来撰写这类长文。为此，几个月前我开始策划这项活动，主动向这类开发者约稿，试图挖掘这些“沉默的专家”，将他们脑海中的“隐性知识”显性化。</p>
<p>在与作者们的沟通中，我常遇到这样的场景：对方不知道该写什么。尽管他们每天都在解决棘手的难题，但因长期浸淫其中，往往“身在庐山不知真面目”，逐渐忽略了这些经验的普适价值。许多人认为自己的工作稀松平常——“难道这些不是常识吗？真的会有人想了解这些？”每当此时，我便会切换回开发者和读者的视角，向他们表达我对该领域的好奇，以及我渴望探究的那些“行业秘密”。</p>
<p>在 AI 时代，大模型或许已经掌握了海量的 API 用法和代码范式。但对于人类而言，那些真挚的情感、与物理世界的真实碰撞、以及从无数次失败实践中提炼出的教训，仍是我们最宝贵且独特的财富。</p>
<p>非常感谢这些作者，能在繁忙的工作中抽调时间与精力，无私地分享他们的知识宝藏。文中的许多内容，若非经过长期的工程实践和被困难反复地“折磨”，是绝不可能产生如此深刻的体悟的。</p>
<p>这项挖掘“沉默专家”的计划仍在继续。这不仅是为了丰富博客的内容，更是为了我们自己，为了社区。在这个信息逐渐被 AI 同质化的今天，我希望能为大家保留并呈现更多由鲜活经验铸就的、不一样的声音。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-114%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-114/" ref="nofollow noopener noreferrer">本期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-113%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-113/" ref="nofollow noopener noreferrer">前一期内容</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2F" target="_blank" title="https://fatbobman.com/zh/weekly/" ref="nofollow noopener noreferrer">全部周报列表</a></p>
<blockquote>
<p>🚀 <strong>《肘子的 Swift 周报》</strong></p>
<p>每周为你精选最值得关注的 Swift、SwiftUI 技术动态</p>
<ul>
<li><strong>📮 立即订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Ffatbobman" target="_blank" title="https://weekly.fatbobman.com/fatbobman" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取完整内容</li>
<li><strong>👥 加入社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 与 2000+ 开发者交流</li>
<li><strong>📚 深度教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 探索 200+ 原创文章</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-1">近期推荐</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Fa-deep-dive-into-swiftui-rich-text-layout%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520114%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/a-deep-dive-into-swiftui-rich-text-layout/?utm_source=fatbobman%20weekly%20issue%20114&amp;utm_medium=web" ref="nofollow noopener noreferrer">SwiftUI 图文混排深度剖析：超越 AttributedString —— MarkdownView 与 RichText 的实现</a></h3>
<p>虽然 AttributedString 已经推出多年，但 SwiftUI 仍然缺乏「完整 Markdown 渲染 + 图文混排 + 可选中文本 + 精细交互」的官方支持。作为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLiYanan2004%2FMarkdownView%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520114%26utm_medium%3Dweb" target="_blank" title="https://github.com/LiYanan2004/MarkdownView?utm_source=fatbobman%20weekly%20issue%20114&amp;utm_medium=web" ref="nofollow noopener noreferrer">MarkdownView</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLiYanan2004%2FRichText%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520114%26utm_medium%3Dweb" target="_blank" title="https://github.com/LiYanan2004/RichText?utm_source=fatbobman%20weekly%20issue%20114&amp;utm_medium=web" ref="nofollow noopener noreferrer">RichText</a> 的作者，<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FLiYanan2004" target="_blank" title="https://x.com/LiYanan2004" ref="nofollow noopener noreferrer">LiYanan</a> 在本文中系统回顾了他为解决这些问题所进行的技术探索——从最初尝试 Layout 协议，到踩过 TextRenderer 的种种限制，再到最终基于 TextKit 打造可交互、高性能的 Markdown 渲染组件。这既是一份关于坚持与成长的技术复盘，也是目前 SwiftUI 文本渲染领域难得的资料。</p>
<hr/>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-01" target="_blank" title="https://l.fatbobman.com/w0114-01" ref="nofollow noopener noreferrer">我该开启哪些 Swift 编译器设置？ (What Setting Should I Use?)</a></h3>
<p>十岁的 Swift 从未像今天这样强大，但随之而来的复杂度也显而易见。除了更多的语言特性，你还要面对不断扩张的编译器设置——它们彼此组合，足以构建出“不同年代、不同哲学、不同语义”的 Swift。</p>
<p>在这篇文章中，<a href="https://link.juejin.cn?target=https%3A%2F%2Fmastodon.social%2F%40mattiem" target="_blank" title="https://mastodon.social/@mattiem" ref="nofollow noopener noreferrer">Matt Massicotte</a> 用非常接地气的方式回答了一个现实问题：**在 Swift 6.2 / Xcode 26 时代，我究竟应该打开哪些编译器设置？如果你正犹豫是否切换到 6 语言模式，或迟迟拿不定主意 <code>StrictConcurrency</code> 应设为 minimal、targeted 或 complete，这篇文章可以视作一份决策辅助清单，帮助你按更可控、渐进的方式完成迁移。</p>
<hr/>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-02" target="_blank" title="https://l.fatbobman.com/w0114-02" ref="nofollow noopener noreferrer">枚举背后的力量 (Swift Enum Hidden Magic Tricks)</a></h3>
<p>枚举是 Swift 中极具辨识度的语言特性，其能力远超“带点关联值的分支语句”。在许多资深 Swift/iOS 开发者眼中，枚举更像是一种<strong>用于塑造架构边界的建模工具</strong>，尤其在管理复杂状态时格外突出。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fvalentebruno%2F" target="_blank" title="https://www.linkedin.com/in/valentebruno/" ref="nofollow noopener noreferrer">Bruno Valente Pimentel</a>在本文中系统阐述了枚举如何帮助我们<strong>让无效状态不可表示（Make Invalid States Unrepresentable）</strong> ，并通过多个真实项目的演化过程展示这一思想如何从“语法技巧”升级为“设计方法论”。</p>
<blockquote>
<p>“让无效状态不可表示”是类型驱动设计推崇的关键思想之一。如果你想进一步理解这一理念的底层思想，非常建议一并阅读 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FAlexOzun" target="_blank" title="https://x.com/AlexOzun" ref="nofollow noopener noreferrer">Alex Ozun</a> 的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fswiftology.io%2Fcollections%2Ftype-driven-design%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520114%26utm_medium%3Dweb" target="_blank" title="https://swiftology.io/collections/type-driven-design/?utm_source=fatbobman%20weekly%20issue%20114&amp;utm_medium=web" ref="nofollow noopener noreferrer">Type-Driven Design with Swift</a> 系列文章。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-03" target="_blank" title="https://l.fatbobman.com/w0114-03" ref="nofollow noopener noreferrer">为应用设置替代名 (Make Your App Visible with Alternative App Names)</a></h3>
<p>在日常使用中，你可能注意到某些 iOS 应用可以通过多个名称在 Spotlight 中被搜索到，这在实际使用场景中非常便利。其背后正是 SiriKit 提供的能力：开发者可以在应用的 Info.plist 中配置最多 3 个替代名称，使用户能够通过不同的关键词更轻松地找到你的应用。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2F0xWDG" target="_blank" title="https://x.com/0xWDG" ref="nofollow noopener noreferrer">Wesley de Groot</a> 在本文中介绍了这一功能的具体实现方式。</p>
<blockquote>
<p>随着 macOS 26 移除了“启动台”（Launchpad），越来越多的用户开始依赖 Spotlight 启动应用。或许未来，类似的替代名称机制也会被引入到 macOS 平台。</p>
</blockquote>
<hr/>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-04" target="_blank" title="https://l.fatbobman.com/w0114-04" ref="nofollow noopener noreferrer">用 @TabContentBuilder 组织你的 Tab 声明 (Organizing SwiftUI Views with TabContent and @TabContentBuilder)</a></h3>
<p>在最近的两个版本中，SwiftUI 对 Tab 支持进行了大幅扩展：从传统的底部分页导航，延伸到更灵活的结构化场景，例如在大屏设备上表现类似侧边栏的导航模式。因此，许多项目的 Tab 声明开始变得越来越庞大：角色控制、条件分支、导航栈、标签配置与团队约定往往混杂在同一个 <code>TabView</code> 中。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fartem-mirzabekian%2F" target="_blank" title="https://www.linkedin.com/in/artem-mirzabekian/" ref="nofollow noopener noreferrer">Artem Mirzabekian</a> 在文中建议将与 Tab 相关的配置从主布局中抽离，借助自定义的 <code>@TabContentBuilder</code> 搭建一个专属的、可组合的 tab 定义区域。这种组织方式能够显著提升可读性与可扩展性，让 Tab 导航的维护不再成为 SwiftUI 项目的难点。</p>
<blockquote>
<p>除了 <code>@ViewBuilder</code> 外，SwiftUI 还提供了大量领域专用的 result builder，如 <code>TableColumnBuilder</code>、<code>CommandsBuilder</code>、<code>SceneBuilder</code>、<code>ToolbarContentBuilder</code>、<code>ChartContentBuilder</code> 等。更精确地选用这些 builder，不仅能让视图结构更清晰，也能在复杂场景（例如并用 Charts 与 Table）减少类型推断负担，避免触发 SwiftUI 常见的 “type-checking explosion”。</p>
</blockquote>
<hr/>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-05" target="_blank" title="https://l.fatbobman.com/w0114-05" ref="nofollow noopener noreferrer">用 LLDB 调试 SwiftUI 应用 (LLDB Power User Guide: Essential Commands &amp; SwiftUI Debugging)</a></h3>
<p>调试 SwiftUI 向来不轻松。相比在代码里不断插入 <code>print</code>，尽管 LLDB 的能力更强大，但却往往被忽略。在这篇文章中，<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fjai-krishna-chandrasekar%2F" target="_blank" title="https://www.linkedin.com/in/jai-krishna-chandrasekar/" ref="nofollow noopener noreferrer">Jai Krishna</a> 通过大量 SwiftUI 示例演示了如何在 LLDB 中实时查看和修改 <code>@State</code>、<code>@Binding</code>、<code>@Published</code> 的内部状态，使用 <code>Self._printChanges()</code> 追踪视图的重绘来源，并借助精细化的断点策略定位布局与交互问题。</p>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-06" target="_blank" title="https://l.fatbobman.com/w0114-06" ref="nofollow noopener noreferrer">如何查找应用的挂起原因 (Identifying Hangs in iOS Apps)</a></h3>
<p>许多开发者都会遇到主线程阻塞导致的 UI 挂起，但具体卡在什么位置、由何引起，并不是每个人都能准确调试。<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Ftiagodhenriques" target="_blank" title="https://x.com/tiagodhenriques" ref="nofollow noopener noreferrer">Tiago Henriques</a> 通过一个刻意制造卡顿的示例 App，演示了如何利用 Instruments 的 Time Profiler 来初步判断问题的性质和范围。复现与识别只是解决问题的第一步，作者也表示如果读者感兴趣，未来还会继续推出这一主题的深入内容。</p>
<h2 data-id="heading-9">工具</h2>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-07" target="_blank" title="https://l.fatbobman.com/w0114-07" ref="nofollow noopener noreferrer">SwiftUI Ratings</a></h3>
<p>如果你正在为 App 构建评分/评论界面，或希望在应用内更自然地引导用户前往 App Store 留下评价，由 <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fjsedlacekjr" target="_blank" title="https://x.com/jsedlacekjr" ref="nofollow noopener noreferrer">James Sedlacek</a> 开发的 SwiftUI-Ratings 提供了一套即插即用的解决方案。它实现了一个高度可定制的评分界面，风格上与 App Store 的评分与评论页相近，允许开发者通过 <code>AppRatingProviding</code> 协议灵活接入任意数据源（项目中提供了 mock 实现与 Supabase / App Store Connect API 示例）。对于需要快速搭建“应用内评分请求”功能的开发者来说，这是一个轻量、现代、且易于扩展的选择。</p>
<hr/>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-08" target="_blank" title="https://l.fatbobman.com/w0114-08" ref="nofollow noopener noreferrer">Swift Hugging Face</a></h3>
<p>Hugging Face 是全球领先的开源 AI 社区与模型平台，提供海量模型、数据集、工具链及协作空间，作为关键的 AI 基础设施，赋能研究者、工程师与企业高效构建并部署 AI 应用。</p>
<p>作为 Hugging Face 官方出品的 Swift 客户端，<strong>Swift Hugging Face</strong> 提供了两大核心能力：一方面，它完整封装了 Hugging Face Hub API，使开发者能够以原生 Swift 方式管理模型、数据集、Spaces 等资源；另一方面，它无缝集成 Inference API，让文本生成（Chat Completion）、文本向量化、文生图/视频（Text-to-Image/Video）、语音转写等任务能够直接在 iOS、macOS、visionOS 乃至 Linux 与 Windows 上运行。</p>
<p>在文章 <a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0114-09" target="_blank" title="https://l.fatbobman.com/w0114-09" ref="nofollow noopener noreferrer">Introducing swift-huggingface: The Complete Swift Client for Hugging Face</a> 中，<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmattt" target="_blank" title="https://x.com/mattt" ref="nofollow noopener noreferrer">Mattt</a> 详细阐述了该库的设计理念与核心使用方式，为 Swift 开发者打开了接入 Hugging Face AI 生态的完整路径。</p>
<h2 data-id="heading-12">往期内容</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhttps%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-113%2F" target="_blank" title="https://https://fatbobman.com/zh/weekly/issue-113/" ref="nofollow noopener noreferrer">当 Android 手机『强行兼容』AirDrop - #113</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-112%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-112/" ref="nofollow noopener noreferrer">毕业 30 年同学群：一场 AI 引发的“真假难辨”危机 - #112</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-111%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-111/" ref="nofollow noopener noreferrer">Homebrew 5.0：并行加速、MCP 加持，与 Intel 的最后倒计时 - #111</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-110%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-110/" ref="nofollow noopener noreferrer">Skip Fuse现在对独立开发者免费！- #110</a></li>
</ul>
<h2 data-id="heading-13">💝 支持与反馈</h2>
<p>如果本期周报对你有帮助，请：</p>
<ul>
<li>👍 <strong>点赞</strong> - 让更多开发者看到</li>
<li>💬 <strong>评论</strong> - 分享你的看法或问题</li>
<li>🔄 <strong>转发</strong> - 帮助同行共同成长</li>
</ul>
<hr/>
<blockquote>
<p>🚀 <strong>拓展 Swift 视野</strong></p>
<ul>
<li><strong>📮 邮件订阅</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com%2Fwelcome" target="_blank" title="https://weekly.fatbobman.com/welcome" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> 获取独家技术洞察</li>
<li><strong>👥 开发者社区</strong> | <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> 实时交流开发经验</li>
<li><strong>📚 原创教程</strong> | <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> 学习 Swift/SwiftUI 最佳实践</li>
</ul>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次看懂 C# TimeSpan：时间差操作的完整指南]]></title>    <link>https://juejin.cn/post/7581406561702084634</link>    <guid>https://juejin.cn/post/7581406561702084634</guid>    <pubDate>2025-12-08T22:22:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581406561702084634" data-draft-id="7581374664326201395" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次看懂 C# TimeSpan：时间差操作的完整指南"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-12-08T22:22:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="唐青枫"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次看懂 C# TimeSpan：时间差操作的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    唐青枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T22:22:02.000Z" title="Mon Dec 08 2025 22:22:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">简介</h3>
<p><code>TimeSpan</code> 是 <code>.NET</code> 中用于表示时间间隔或持续时间的重要结构体。它提供了丰富的方法和属性来处理时间跨度，从几毫秒到几百万天都可以精确表示。</p>
<h3 data-id="heading-1">概念与特性</h3>
<p><code>TimeSpan</code> 表示一个时间间隔（时间段），而不是具体的时间点。</p>





























<table><thead><tr><th>特性</th><th>说明</th></tr></thead><tbody><tr><td>命名空间</td><td><code>System</code></td></tr><tr><td>结构类型</td><td><code>struct</code>（值类型）</td></tr><tr><td>表示范围</td><td>约 ±10,675,199 天（≈29,000 年）</td></tr><tr><td>精度</td><td>1 Tick = 100 纳秒</td></tr><tr><td>单位表示</td><td>可用天、小时、分钟、秒、毫秒、Ticks</td></tr></tbody></table>
<p>与 <code>DateTime</code> 区别：</p>
<ul>
<li>
<p><code>DateTime</code> 表示一个具体的时间点（例如：<code>2025-09-18 08:00</code>）。</p>
</li>
<li>
<p><code>TimeSpan</code> 表示一个时间间隔（例如：2 小时 30 分钟）。</p>
</li>
</ul>
<h3 data-id="heading-2">创建 TimeSpan</h3>
<h4 data-id="heading-3">构造函数</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 构造函数：TimeSpan(days, hours, minutes, seconds)</span>
<span class="hljs-keyword">var</span> span1 = <span class="hljs-keyword">new</span> TimeSpan(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// 1天2小时30分0秒</span>

<span class="hljs-comment">// 构造函数：TimeSpan(hours, minutes, seconds)</span>
<span class="hljs-keyword">var</span> span2 = <span class="hljs-keyword">new</span> TimeSpan(<span class="hljs-number">2</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);    <span class="hljs-comment">// 2小时30分</span>
</code></pre>
<h4 data-id="heading-4">静态工厂方法</h4>
<p>推荐使用静态方法，可读性更高：</p>
<pre><code class="hljs language-csharp" lang="csharp">TimeSpan ts1 = TimeSpan.FromDays(<span class="hljs-number">1.5</span>);       <span class="hljs-comment">// 1.5天</span>
TimeSpan ts2 = TimeSpan.FromHours(<span class="hljs-number">2.5</span>);      <span class="hljs-comment">// 2.5小时</span>
TimeSpan ts3 = TimeSpan.FromMinutes(<span class="hljs-number">90</span>);     <span class="hljs-comment">// 90分钟</span>
TimeSpan ts4 = TimeSpan.FromSeconds(<span class="hljs-number">45</span>);     <span class="hljs-comment">// 45秒</span>
TimeSpan ts5 = TimeSpan.FromMilliseconds(<span class="hljs-number">500</span>); <span class="hljs-comment">// 500毫秒</span>
TimeSpan ts6 = TimeSpan.FromTicks(<span class="hljs-number">5000</span>);     <span class="hljs-comment">// 5000 Ticks</span>
</code></pre>
<h4 data-id="heading-5">解析字符串</h4>
<pre><code class="hljs language-csharp" lang="csharp">TimeSpan ts = TimeSpan.Parse(<span class="hljs-string">"1.02:30:00"</span>);  
<span class="hljs-comment">// 格式：d.hh:mm:ss -&gt; 1天2小时30分</span>
</code></pre>
<p>或安全解析：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">if</span> (TimeSpan.TryParse(<span class="hljs-string">"02:15"</span>, <span class="hljs-keyword">out</span> <span class="hljs-keyword">var</span> result))
    Console.WriteLine(result); <span class="hljs-comment">// 02:15:00</span>
</code></pre>
<h3 data-id="heading-6">常用属性</h3>

































































<table><thead><tr><th>属性</th><th>说明</th><th>示例</th></tr></thead><tbody><tr><td><code>Days</code></td><td>总天数(整数部分)</td><td><code>ts.Days</code></td></tr><tr><td><code>Hours</code></td><td>小时(0–23)</td><td><code>ts.Hours</code></td></tr><tr><td><code>Minutes</code></td><td>分钟(0–59)</td><td><code>ts.Minutes</code></td></tr><tr><td><code>Seconds</code></td><td>秒(0–59)</td><td><code>ts.Seconds</code></td></tr><tr><td><code>Milliseconds</code></td><td>毫秒(0–999)</td><td><code>ts.Milliseconds</code></td></tr><tr><td><code>Ticks</code></td><td>以 Tick（100ns）为单位</td><td><code>ts.Ticks</code></td></tr><tr><td><code>TotalDays</code></td><td>总天数(含小数)</td><td><code>ts.TotalDays</code></td></tr><tr><td><code>TotalHours</code></td><td>总小时数(含小数)</td><td><code>ts.TotalHours</code></td></tr><tr><td><code>TotalMinutes</code></td><td>总分钟数(含小数)</td><td><code>ts.TotalMinutes</code></td></tr><tr><td><code>TotalSeconds</code></td><td>总秒数(含小数)</td><td><code>ts.TotalSeconds</code></td></tr><tr><td><code>TotalMilliseconds</code></td><td>总毫秒数</td><td><code>ts.TotalMilliseconds</code></td></tr></tbody></table>
<p>区别</p>
<ul>
<li>
<p><code>Days</code>、<code>Hours</code> 等返回整数部分（对应分量）。</p>
</li>
<li>
<p><code>TotalDays</code>、<code>TotalHours</code> 等返回完整总量。</p>
</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> ts = <span class="hljs-keyword">new</span> TimeSpan(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">30</span>, <span class="hljs-number">0</span>);
Console.WriteLine(ts.Days);        <span class="hljs-comment">// 1</span>
Console.WriteLine(ts.TotalHours);  <span class="hljs-comment">// 26.5</span>
</code></pre>
<h3 data-id="heading-7">运算操作</h3>
<h4 data-id="heading-8">加减</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> t1 = TimeSpan.FromHours(<span class="hljs-number">3</span>);
<span class="hljs-keyword">var</span> t2 = TimeSpan.FromMinutes(<span class="hljs-number">30</span>);

TimeSpan sum = t1 + t2;  <span class="hljs-comment">// 3:30:00</span>
TimeSpan diff = t1 - t2; <span class="hljs-comment">// 2:30:00</span>
</code></pre>
<h4 data-id="heading-9">乘除</h4>
<pre><code class="hljs language-csharp" lang="csharp">TimeSpan doubleTime = TimeSpan.FromMinutes(<span class="hljs-number">45</span>) * <span class="hljs-number">2</span>; <span class="hljs-comment">// 1:30:00</span>
TimeSpan halfTime   = TimeSpan.FromHours(<span class="hljs-number">4</span>) / <span class="hljs-number">2</span>;    <span class="hljs-comment">// 2:00:00</span>
</code></pre>
<blockquote>
<p>C# 11 之前不支持直接乘除，需要用 TimeSpan.FromTicks() 手动计算。
（.NET 7 / C# 11 起支持 * / 运算符）</p>
</blockquote>
<h4 data-id="heading-10">比较</h4>
<pre><code class="hljs language-csharp" lang="csharp">TimeSpan ts1 = TimeSpan.FromHours(<span class="hljs-number">2</span>);
TimeSpan ts2 = TimeSpan.FromMinutes(<span class="hljs-number">120</span>); <span class="hljs-comment">// 也是2小时</span>

<span class="hljs-comment">// 比较</span>
<span class="hljs-built_in">bool</span> isEqual = ts1 == ts2;                <span class="hljs-comment">// true</span>
<span class="hljs-built_in">bool</span> isNotEqual = ts1 != ts2;             <span class="hljs-comment">// false</span>
<span class="hljs-built_in">bool</span> isGreater = ts1 &gt; TimeSpan.FromHours(<span class="hljs-number">1</span>); <span class="hljs-comment">// true</span>
<span class="hljs-built_in">bool</span> isLess = ts1 &lt; TimeSpan.FromHours(<span class="hljs-number">3</span>);    <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 比较方法</span>
<span class="hljs-built_in">int</span> compareResult = ts1.CompareTo(ts2);   <span class="hljs-comment">// 0 (相等)</span>
<span class="hljs-built_in">bool</span> <span class="hljs-keyword">equals</span> = ts1.Equals(ts2);            <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-11">取绝对值</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> negative = TimeSpan.FromHours(<span class="hljs-number">-5</span>);
<span class="hljs-keyword">var</span> positive = negative.Duration(); <span class="hljs-comment">// 05:00:00</span>
</code></pre>
<h4 data-id="heading-12">取负值</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> neg = -TimeSpan.FromMinutes(<span class="hljs-number">30</span>); <span class="hljs-comment">// -00:30:00</span>
</code></pre>
<h3 data-id="heading-13">与 DateTime 配合</h3>
<p><code>TimeSpan</code> 常用于计算两个时间点的差值：</p>
<pre><code class="hljs language-csharp" lang="csharp">DateTime start = DateTime.Now;
<span class="hljs-comment">// 模拟一些操作</span>
System.Threading.Thread.Sleep(<span class="hljs-number">1500</span>);
DateTime end = DateTime.Now;

TimeSpan elapsed = end - start;
Console.WriteLine(<span class="hljs-string">$"执行耗时: <span class="hljs-subst">{elapsed.TotalMilliseconds}</span> ms"</span>);
</code></pre>
<p>也可以用来加减时间：</p>
<pre><code class="hljs language-csharp" lang="csharp">DateTime tomorrow = DateTime.Now + TimeSpan.FromDays(<span class="hljs-number">1</span>);
</code></pre>
<h3 data-id="heading-14">格式化输出</h3>
<h4 data-id="heading-15">默认格式</h4>
<pre><code class="hljs language-csharp" lang="csharp">Console.WriteLine(ts.ToString()); <span class="hljs-comment">// "1.02:30:00" (d.hh:mm:ss)</span>
</code></pre>
<h4 data-id="heading-16">标准格式</h4>
<pre><code class="hljs language-csharp" lang="csharp">Console.WriteLine(ts.ToString(<span class="hljs-string">"c"</span>));     <span class="hljs-comment">// 同上 (常数格式)</span>
Console.WriteLine(ts.ToString(<span class="hljs-string">"g"</span>));     <span class="hljs-comment">// 1:2:30:45.5 (常规短格式)</span>
Console.WriteLine(ts.ToString(<span class="hljs-string">"G"</span>));     <span class="hljs-comment">// 1:02:30:45.5000000 (常规长格式)</span>
</code></pre>
<h4 data-id="heading-17">自定义格式</h4>
<p><code>ToString</code> 支持标准和自定义格式：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> ts = <span class="hljs-keyword">new</span> TimeSpan(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">30</span>, <span class="hljs-number">45</span>, <span class="hljs-number">500</span>);
Console.WriteLine(ts.ToString(<span class="hljs-string">@"hh\:mm\:ss"</span>));        <span class="hljs-comment">// 02:30:45</span>
Console.WriteLine(ts.ToString(<span class="hljs-string">@"d\.hh\:mm\:ss\.fff"</span>)); <span class="hljs-comment">// 1.02:30:45.500</span>
</code></pre>
<blockquote>
<p>需要转义 : 和 .</p>
</blockquote>
<h3 data-id="heading-18">常用静态字段</h3>





















<table><thead><tr><th>字段</th><th>说明</th></tr></thead><tbody><tr><td><code>TimeSpan.Zero</code></td><td>表示 0</td></tr><tr><td><code>TimeSpan.MaxValue</code></td><td>最大可表示值</td></tr><tr><td><code>TimeSpan.MinValue</code></td><td>最小可表示值</td></tr></tbody></table>
<h3 data-id="heading-19">典型使用场景</h3>
<h4 data-id="heading-20">定时任务/超时控制</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> timeout = TimeSpan.FromSeconds(<span class="hljs-number">30</span>);
<span class="hljs-keyword">var</span> cts = <span class="hljs-keyword">new</span> CancellationTokenSource(timeout);
</code></pre>
<h4 data-id="heading-21">统计程序耗时</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">var</span> watch = System.Diagnostics.Stopwatch.StartNew();
<span class="hljs-comment">// do work</span>
watch.Stop();
Console.WriteLine(watch.Elapsed); <span class="hljs-comment">// TimeSpan</span>
</code></pre>
<h3 data-id="heading-22">实际应用示例</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> System;

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>()</span>
    {
        DateTime start = DateTime.Now;

        <span class="hljs-comment">// 模拟任务</span>
        System.Threading.Thread.Sleep(<span class="hljs-number">1200</span>);

        DateTime end = DateTime.Now;
        TimeSpan span = end - start;

        Console.WriteLine(<span class="hljs-string">$"耗时: <span class="hljs-subst">{span.TotalMilliseconds}</span> 毫秒"</span>);
        Console.WriteLine(<span class="hljs-string">$"格式化: <span class="hljs-subst">{span.ToString(<span class="hljs-string">@"hh\:mm\:ss\.fff"</span>)}</span>"</span>);
        Console.WriteLine(<span class="hljs-string">$"天: <span class="hljs-subst">{span.Days}</span>, 小时: <span class="hljs-subst">{span.Hours}</span>, 总小时: <span class="hljs-subst">{span.TotalHours:F2}</span>"</span>);
    }
}
</code></pre>
<p>输出示例：</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">耗时: 1203.45 毫秒</span>
<span class="hljs-section">格式化: 00:00:01.203</span>
<span class="hljs-section">天: 0, 小时: 0, 总小时: 0.00</span>
</code></pre>
<h3 data-id="heading-23">高级用法</h3>
<h4 data-id="heading-24">自定义 TimeSpan 扩展方</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">TimeSpanExtensions</span>
{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">ToHumanReadableString</span>(<span class="hljs-params"><span class="hljs-keyword">this</span> TimeSpan timeSpan</span>)</span>
    {
        <span class="hljs-keyword">if</span> (timeSpan.TotalDays &gt;= <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{(<span class="hljs-built_in">int</span>)timeSpan.TotalDays}</span> 天 <span class="hljs-subst">{timeSpan.Hours}</span> 小时"</span>;
        
        <span class="hljs-keyword">if</span> (timeSpan.TotalHours &gt;= <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{(<span class="hljs-built_in">int</span>)timeSpan.TotalHours}</span> 小时 <span class="hljs-subst">{timeSpan.Minutes}</span> 分钟"</span>;
        
        <span class="hljs-keyword">if</span> (timeSpan.TotalMinutes &gt;= <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{(<span class="hljs-built_in">int</span>)timeSpan.TotalMinutes}</span> 分钟 <span class="hljs-subst">{timeSpan.Seconds}</span> 秒"</span>;
        
        <span class="hljs-keyword">if</span> (timeSpan.TotalSeconds &gt;= <span class="hljs-number">1</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{(<span class="hljs-built_in">int</span>)timeSpan.TotalSeconds}</span> 秒"</span>;
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">$"<span class="hljs-subst">{timeSpan.Milliseconds}</span> 毫秒"</span>;
    }
}

<span class="hljs-comment">// 使用扩展方法</span>
TimeSpan ts = TimeSpan.FromHours(<span class="hljs-number">2.5</span>);
Console.WriteLine(ts.ToHumanReadableString()); <span class="hljs-comment">// 输出: 2 小时 30 分钟</span>
</code></pre>
<h3 data-id="heading-25">注意事项和最佳实践</h3>
<ul>
<li>
<p>不可变性：<code>TimeSpan</code> 是值类型且不可变，所有操作都返回新的 <code>TimeSpan</code> 实例</p>
</li>
<li>
<p>精度考虑：<code>TimeSpan</code> 使用 <code>ticks</code>（100 纳秒）作为内部存储，提供高精度但需要注意浮点运算的精度问题</p>
</li>
<li>
<p>文化敏感性：解析和格式化 <code>TimeSpan</code> 时，注意当前线程的文化设置</p>
</li>
<li>
<p>性能考虑：对于高性能场景，考虑使用 <code>Stopwatch</code> 而不是 <code>DateTime</code> 减法来计算时间间隔</p>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[降级系统后，2019年的Mac电脑重获新生]]></title>    <link>https://juejin.cn/post/7581314241411301411</link>    <guid>https://juejin.cn/post/7581314241411301411</guid>    <pubDate>2025-12-08T22:37:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581314241411301411" data-draft-id="7581348660824211456" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="降级系统后，2019年的Mac电脑重获新生"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-08T22:37:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="抹茶冰淇淋"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289956471"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            降级系统后，2019年的Mac电脑重获新生
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289956471/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    抹茶冰淇淋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T22:37:59.000Z" title="Mon Dec 08 2025 22:37:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>大家好，我是抹茶。最近因为2019年购买的mac电脑卡顿，因为一直保养很好，且日常没有太多的个人电脑需求，觉得购买新的电脑不是很高性价比的选择，所以我选择将系统版本进行降级，降级后运行流畅。</p>
<p>本文将介绍背后的原理以及操作过程</p>
<h2 data-id="heading-1">为什么老电脑运行新系统会卡顿呢？</h2>
<p>这里涉及到一个计算机届有名的<code>安迪-比尔定律</code></p>
<h3 data-id="heading-2">安迪-比尔定律</h3>
<p>比尔要带走安迪所给的（What Andy gives,Bill takes away）</p>
<p>安迪.格鲁夫（Andy Grove）: 英特尔已故的带有传奇色彩的CEO，这里指硬件。</p>
<p>比尔.盖茨：微软的CEO , 这里指软件。</p>
<p>在过去40年里，英特尔公司处理器的处理速度每18个月翻一番，计算机内存和硬盘的容量则以更快的速度增长，但是微软的操作系统和应用软件却越来越慢，也越做越大。所以，现在的计算机虽然比10年前快了100倍，软件的运行速度感觉上还是和以前差不多。</p>
<p>简而言之，日益增长的软件体积会吃掉硬件的性能。</p>
<h3 data-id="heading-3">软件为什么会吃点硬件的性能呢？</h3>
<h4 data-id="heading-4">想想我们日常如何运维项目的</h4>
<p>老的项目代码不要轻易修改，然后不断追加新的需求逻辑，所以项目代码越来越多，软件体积可不就越来越大么...</p>
<h2 data-id="heading-5">如何进行系统降级？</h2>
<h3 data-id="heading-6">1. 备份数据</h3>
<p>笔者用U盘拷贝了必要的材料，过程中查到资料，可以用MAC自带的<code>时间机器</code>做数据备份，有兴趣的可以试试。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74dde911d9bb483c99159205c3ea9c8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765838278&amp;x-signature=4eblgCxUq4mmSE%2FGnPEpU9y0rXM%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">2. 格式化硬盘</h3>
<p>这一步必须的，不然走到恢复出厂设置时，会没有可以安装的存储位置。
选择磁盘工具=&gt;选择磁盘=&gt;抹掉</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d26b86dea1504a90bdfabcbc6ff187c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765838278&amp;x-signature=%2B8pPGlCXKgA1R4BwGp%2FRyaqR9nM%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/723bb134806f4771919dee0d5fce19e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765838278&amp;x-signature=7BIi2ESZuMuau2i%2BJoGBQxZoJ7Y%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">3. 关闭MAC电脑</h3>
<p>直接关机，到电源完全关闭后，运行指令。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9eef323c19f0427ca51d2f871ef42637~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765838278&amp;x-signature=vkiM0iL26gNcSwmCQC6ePo%2FX6%2F0%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">4. 运行指令恢复出厂版本</h3>
<p><code>Shift + Option + Command + R</code>，然后电脑就会启动，连接wifi后，根据界面提示，一步步操作，就会将电脑版本还原成出厂版本。（v10）</p>
<h3 data-id="heading-10">4. 升级系统版本到日常软件需要的最低版本</h3>
<p>还原到出厂版本后，系统运行起来已经很流畅了。但是，从App store安装微信时，提示必须是V12以上版本，所以还需要升级到v12。</p>
<p>mac自带的软件更新，会直接将电脑升级到最新系统，不用考虑。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26fff7c420f44b6fbe458ac1be5c971d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765838278&amp;x-signature=6OSKmxY2uoty8I9fhUaTHRpd76I%3D" alt="image.png" loading="lazy"/></p>
<p>通过deepseek找到了mac v12版本的下载链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fapps.apple.com%2Fcn%2Fapp%2Fmacos-monterey%2Fid1576738294%3Fmt%3D12" target="_blank" title="https://apps.apple.com/cn/app/macos-monterey/id1576738294?mt=12" ref="nofollow noopener noreferrer">apps.apple.com/cn/app/maco…</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5a44f6dcf2b942e08ede7add0c5c1267~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765838278&amp;x-signature=QHfLaSfkT4iRyN%2BhXBOWzhrkZPo%3D" alt="image.png" loading="lazy"/></p>
<p>于此同时，还发现了在App store搜索<code>macOS</code>还能下载安装其他版本的系统。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/052d242bbb884b7885791696a4cc878c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oq56Iy25Yaw5reH5reL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765838278&amp;x-signature=jTOE40s6pj10ELCUHwbqLfHUBsE%3D" alt="image.png" loading="lazy"/></p>
<p>接下来，下载后安装即可。</p>
<h2 data-id="heading-11">总结</h2>
<ul>
<li>不断增长的软件体积会吃掉硬件的性能。如果想让老的设备运行流畅，选择合适的软件版本可以实现。</li>
<li>苹果本身有指令可以还原到出厂设置，无须借助第三方。</li>
<li>整个过程除了备份数据需要U盘，其他的在有wifi的情况下，靠指令和苹果自带软件即可完成。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智谱GLM-4.6V开源：不仅仅是“看懂”，它终于长出了“双手”]]></title>    <link>https://juejin.cn/post/7581363652780441610</link>    <guid>https://juejin.cn/post/7581363652780441610</guid>    <pubDate>2025-12-08T15:07:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581363652780441610" data-draft-id="7581359420391964699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智谱GLM-4.6V开源：不仅仅是“看懂”，它终于长出了“双手”"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-08T15:07:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智谱GLM-4.6V开源：不仅仅是“看懂”，它终于长出了“双手”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:07:20.000Z" title="Mon Dec 08 2025 15:07:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年12月8日，智谱AI没有预告，直接甩出了一张王炸：GLM-4.6V系列多模态大模型正式上线并全量开源。</p>
<p>如果你还在关注那些只会“看图说话”的模型，那这次你可能要刷新一下认知了。智谱这次的更新，不是简单的参数堆叠，而是试图解决多模态领域一个最尴尬的痛点——大模型不仅要有眼睛，还得有手。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-08_22.58.46-1024x740.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-08_22.58.46-1024x740.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23d48ec132e845e1841214f172134df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811240&amp;x-signature=ZHxvajg8Poxghqn7ufzK%2BCYORhk%3D" alt="iShot_2025-12-08_22.58.46" loading="lazy"/></a></p>
<p><strong>从“解说员”进化为“操作员”</strong></p>
<p>过去我们用视觉模型（VLM），流程通常是这样的：扔一张图给模型，问它“这是什么”，模型回答“这是一个网页报错”。然后呢？然后就没有然后了。你得自己去写代码修复。</p>
<p>GLM-4.6V的核心突破在于“原生多模态工具调用”。这是什么概念？意味着图像、视频不再仅仅是需要被“翻译”成文字的累赘，它们直接成为了函数调用的参数。</p>
<p>模型可以直接读取你的屏幕截图，理解UI布局，然后调用工具去点击、输入、甚至直接生成前端代码并进行视觉修正。它不再是一个站在旁边指指点点的解说员，而是一个能真正下场干活的操作员。对于想做多模态Agent（智能体）的开发者来说，这简直是梦寐以求的基础设施。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-08_22.58.38-1024x838.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-08_22.58.38-1024x838.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da36ea79f99845cc9c07571ab2cf6278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811240&amp;x-signature=pi9FB7pRnT%2FTQgpiCepMEw9xbnw%3D" alt="iShot_2025-12-08_22.58.38" loading="lazy"/></a></p>
<p><strong>两款模型，丰俭由人</strong></p>
<p>这次智谱的刀法依旧精准，推出了两款定位截然不同的模型：</p>
<p><strong>GLM-4.6V (106B)</strong>：这是给追求极致性能的玩家准备的。虽然参数量高达106B，但激活参数控制在12B（MoE架构），在云端高性能集群上，它能处理复杂的长文档和深度推理任务。根据官方数据，它的表现直接对标行业顶尖闭源模型。</p>
<p><strong>GLM-4.6V-Flash (9B)</strong>：这是给务实派准备的惊喜。9B的体量意味着它可以轻松部署在本地，甚至是一些端侧设备上。虽然是轻量版，但它在OCR、视频理解等高频场景下的表现并不含糊，甚至在这个尺寸下击败了Qwen3-VL-8B等竞品。</p>
<p>更重要的是，全系模型支持<strong>128k的超长上下文</strong>。什么概念？你可以一次性扔给它一本150页的技术文档，或者一段1小时的视频，它不仅能读完，还能在里面精准地找到你需要的细节。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-08_22.58.11-1024x355.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-08_22.58.11-1024x355.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc858a6d5835417ca295a6638a9c978d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811240&amp;x-signature=bGDI16uQhIcaYfUutWcZI4eBiuU%3D" alt="iShot_2025-12-08_22.58.11" loading="lazy"/></a></p>
<p><strong>价格屠夫与开源诚意</strong></p>
<p>技术再好，用不起也是白搭。智谱这次显然是想快速抢占市场。</p>
<p>相比上一代GLM-4.5V，新版API的价格直接腰斩了50%。输入1元/百万tokens，输出3元/百万tokens。而那个可以在本地跑得飞起的Flash版本，智谱直接宣布：<strong>免费</strong>。</p>
<p>在开源策略上，智谱也没有藏着掖着。权重、推理代码、示例工程全部推上了GitHub和Hugging Face。MIT协议，允许商业使用。这意味着，明天你可能就会看到一大波基于GLM-4.6V的垂直应用如雨后春笋般冒出来。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F12%2FiShot_2025-12-08_22.57.16-1024x601.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/12/iShot_2025-12-08_22.57.16-1024x601.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0e75bd61b2247b9b944575f5c379ff8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811240&amp;x-signature=Hh6Tm%2BxiQQxhpoJiVH4OnxxZPjo%3D" alt="iShot_2025-12-08_22.57.16" loading="lazy"/></a></p>
<p><strong>写在最后</strong></p>
<p>在2025年这个节点，单纯比拼OCR准确率或者识图能力的时代已经过去了。GLM-4.6V的出现，标志着多模态模型开始向“行动派”转型。</p>
<p>对于开发者而言，现在最大的问题不再是“模型能不能看懂这张图”，而是“既然它能看懂也能操作，我们能用它创造出什么样的新物种？”</p>
<p>大模型的下半场，拼的是落地，而GLM-4.6V，显然已经把梯子架好了。</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[越来越对 AI 做的 PPT 敬佩了！（附7大用法）]]></title>    <link>https://juejin.cn/post/7581314241410793507</link>    <guid>https://juejin.cn/post/7581314241410793507</guid>    <pubDate>2025-12-08T15:06:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581314241410793507" data-draft-id="7581299982671740962" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="越来越对 AI 做的 PPT 敬佩了！（附7大用法）"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-08T15:06:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            越来越对 AI 做的 PPT 敬佩了！（附7大用法）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:06:08.000Z" title="Mon Dec 08 2025 15:06:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 455 篇原创！</p>
<p>大家好，我是忙着做 PPT 的苍何。</p>
<p>年底了，又到了 PPT 整活的时候了。</p>
<p>我印象很深刻，当年我的师兄为了教育我这个新兵蛋子，让我改了 2 个星期的 PPT。</p>
<p>说真的，当时是非常想恶狠狠的朝着他放个毒屁，然后拍拍屁股走人。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e48677c90824a889e4ed0d71d386a1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=7g%2FdxlXTzy538Y%2BRogPBranupBE%3D" alt="图片" loading="lazy"/></p>
<p>但最后我却非常感激他，让我这个老登用一份优秀的 PPT 又在大厂苟活了好一阵子。</p>
<p>现在好了，有了 AI 做 PPT，再也不用瞎折腾了。而且现在效果是越来越好，好到我都不得不敬佩的程度。</p>
<p>我先放几个例子，大家先浅浅感受一下。</p>
<p>先来个年终汇报吧：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03a0bca2db644f3c9b4547d71ca118d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=2hU5cE0iFqjK4RWOs3aDYAlOSek%3D" alt="图片" loading="lazy"/></p>
<p>再来个有深度的，足足有 53 页，全是 AI 做的😄</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd9cee32189a411093031a121c899f35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=1ojaUixqoABncnzBGA6OGS6brJg%3D" alt="wxv_4279470519826776071" loading="lazy"/></p>
<p>觉得太枯燥，还有好玩的版本：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83560926e27d45b794cde6922df4493e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=niQHrrErfmuQb8FWxiNvi%2B1ARb4%3D" alt="wxv_4279471289430966274" loading="lazy"/></p>
<p>来吧，继续整活：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ce780abfab784f0fa31cc38d217feed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=6qzJkXcv0NTT5uevROIbDmkqcBY%3D" alt="wxv_4279472035279323141" loading="lazy"/><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8bc7b9f15ba64cfc81c8403a45de433b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=2wg9xHovjfoND%2BtM6%2FkuGRKQ5%2BI%3D" alt="wxv_4279473040351559682" loading="lazy"/></p>
<p>想用 PPT 结合热点？那就来个疯狂动物城版本的 PPT，一次来个过瘾。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad0b29533fc1493e8c7d1a9772a35d27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=Fwj13i2tR4kFKwo20UpOJNb1DIo%3D" alt="图片" loading="lazy"/></p>
<p>现在能做 PPT 的 AI 工具数不胜数了，效果也大不相同，这一篇就给大家分享一波我认为还不错的 AI PPT 工具。</p>
<blockquote>
<p>原创不易，跪求三连，并分享给有需要做 PPT 的朋友叭。</p>
</blockquote>
<p>我就先按照时间倒序吧，先以最近使用最多的开始吧。</p>
<h2 data-id="heading-0">NotebookLM</h2>
<p>NotebookLM 是谷歌推出的知识库工具，能够上传任意文档甚至是视频 URL，基于知识库可以 AI 问答，可以做思维导图，信息图、闪卡、播客。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da47209d9c92480bb41e8682a3448101~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=WSv5SvTgeqPwFF0HwHopMJf%2B%2F84%3D" alt="图片" loading="lazy"/></p>
<p>NotebookLM 的底座用的就是谷歌自己的 Gemini，现在集成了 Nano Banana Pro，可以说是直接原地起飞，基于知识库直接做 PPT。</p>
<p>什么意思呢？一份优质的 PPT 一定是基于多种数据源的，可能是我们的工作成果，可能是我们的业务，也可能是网上优质的资料。</p>
<p>所以，NotebookLM 做出来的 PPT 是基于知识库的，配合 Nano Banana Pro，可以自定义各种风格。</p>
<p>我录了个操作视频，大家可以看下，其实非常简单。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c7d98c7bc784d059c5960cb558fe8c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=eDWysBELGe9DNfrgn%2FNCPK%2Fun1o%3D" alt="wxv_4279474055037943813" loading="lazy"/></p>
<p>在演示文稿这里点击编辑：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91d0bb51810146359a5b7e0cfc7cfdaa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=mwcdwpqbpxGEHvnBq44OjJS8ABc%3D" alt="图片" loading="lazy"/></p>
<p>自定义演示文稿：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fece482530db4c6587c63ee586bd7f64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=oTjiqRUX6ljHbzHgaI%2BEDIQNlv4%3D" alt="图片" loading="lazy"/></p>
<p>多语言也是不在话下，这里可以选择简体中文，出来的就是中文版本的 PPT 了。</p>
<p>格式的话一共分 2 种，分别是详细演示文档和演示者幻灯片。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9e9fc3d08586473f9eb15a9c9d6479df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=qxu1JS4dcb6iKllzy%2BLOa9liNGA%3D" alt="图片" loading="lazy"/></p>
<p>我一般选择详细演示文档，出来的会更全一些。</p>
<pre><code class="hljs language-arduino" lang="arduino">地址：https:<span class="hljs-comment">//notebooklm.google.com/</span>
</code></pre>
<h2 data-id="heading-1">Kimi 国际版</h2>
<p>不瞒你说，最近刷 X，看到 Kimi 在国际版偷偷上线了基于 Nano Banana Pro 的 PPT 模式，还能直接在线编辑。</p>
<p>于是我体验一波后，非常兴奋的在 X 做了分享，取得了 3.2 万的阅读和 464 的喜欢。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/570b94d4eab544c8a2a18c7793a40380~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=YsTG3%2FEKthzkTrdRTnAcfrZP%2FRY%3D" alt="图片" loading="lazy"/></p>
<p>我把原视频也同步给我亲爱的公众号读者朋友们。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84c81201f97a47ea8e6c99d1e0e52615~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=C6RY3JhEgXYFiF4Yunrg6bU%2BTXs%3D" alt="wxv_4279474953054846987" loading="lazy"/></p>
<p>这里想吐槽下，这个国际版的体验，往往卡在了第一步，因为，如果不进行以下操作，你大概率永远进的是国内版，而国内版还没上线这个模式。</p>
<p>一定要开启全局代理，然后通过谷歌搜索 kimi，进入官网，就可以看到 PPT 模式。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c501ead8bca449a9ffa812536e37e1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=Ky%2BgEXMHd%2FaExTIlBVOVvy9mfOQ%3D" alt="图片" loading="lazy"/></p>
<p>同样支持通过附件来转 PPT，比如我上传了我分享的《公众号流量玄学》这个 pdf 资料，然后淡定的输入以下提示词：</p>
<pre><code class="hljs">使用拉布布风格的主题来生成该附件中的PPT内容，解析附件内容，设计满足以下要求： 
1、专业度高
2、排版精致 
3、配图和信息图要合理搭配 
4、审美在线 
5、PPT内容用中文，文字不宜太多，适合为主、
</code></pre>
<p>先是生成大纲，然后选择香蕉模式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4a695c637d54a618c7ce55d14b6a447~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=9moMhz9ABCI%2Bf%2FxiplzWk%2FJVsjI%3D" alt="图片" loading="lazy"/></p>
<p>最后出来就是你看到的这个效果了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0273bca6ba494b6f8eba3f09dd7cd3f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=P4jB90I7SHLDmj3k5bUK1VINwww%3D" alt="wxv_4279472035279323141" loading="lazy"/></p>
<p>然后可以直接在线编辑这个样式和文字：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79ae3d0f419b4f1e8102a91f3d689010~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=Qhml3lH7FZDl6m9LHfPyQHMb2rg%3D" alt="图片" loading="lazy"/></p>
<p>不过这里整体字体和排版会有轻微变化。</p>
<p>然后也可以导出 PPT 格式，可惜没法本地打开编辑文字，这要是 ok，那 PPT 的天真的完全被捅了。</p>
<pre><code class="hljs language-arduino" lang="arduino">地址：https:<span class="hljs-comment">//www.kimi.com/slides</span>
</code></pre>
<h2 data-id="heading-2">Skywork</h2>
<p>Skywork 是专门为 office 而生的办公类 Agent，之前我也写过评测文章，效果还是很给力的。</p>
<p>在这个地方打开 PPT 模式，然后输入自己的需求，等待着生成。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a9bb2604110440b4ab7fad6b7ba5f07f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=n53CIKm0NQiJkJsKj8L62ELMeq0%3D" alt="图片" loading="lazy"/></p>
<p>不过 Skywork 要生成多张 PPT 会显得有些慢，但整个深度非常不错，还可以用各种 MCP 工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dc61599a07a47948bf1e37a1dd8dddb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=mCMgUUv%2BleGlkUKAGED0C5fdzus%3D" alt="图片" loading="lazy"/></p>
<p>Skywork 是天工 AI 旗下的，在这方面确实做了非常多的细节，现在甚至已经能支持 YouTube 视频链接直接转文档、PPT、播客了。</p>
<p>之前也写过教程，大家可以去看看。</p>
<pre><code class="hljs language-ini" lang="ini">地址：https://skywork.ai/?<span class="hljs-attr">skill_id</span>=<span class="hljs-number">106</span>
</code></pre>
<h2 data-id="heading-3">Genspark</h2>
<p>和 Skywork 类似，Genspark 也是办公类的 Agent，但其以优质的 PPT 产出能力而出名。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0a719d0875f476384fb08f03870519c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=L7nvvYsRVcTMo3C2Oj4cvUlYeTs%3D" alt="图片" loading="lazy"/></p>
<p>抛去别的不说，其出来的效果是真的好啊，你在文首看到的几个惊艳的 PPT 就是 Genspark 生成的，是足足 53 页啊，一次生成，我的天。</p>
<p>但页数多了，免费积分就不够用了，就得花钱。</p>
<p>也是，为成果买单嘛，只是感觉自己光花在每个月的订阅上就不少了，哈哈哈。</p>
<pre><code class="hljs language-arduino" lang="arduino">地址：https:<span class="hljs-comment">//www.genspark.ai/</span>
</code></pre>
<h2 data-id="heading-4">GenFlow</h2>
<p>来自百度文库的 GenFlow 产品，我的感受是：快。</p>
<p>是真的超级快，在手机上就可以动动手，一下子就出来了 PPT。然后可以选择自定义风格。</p>
<p>比较适合出门在外，急需 PPT 应付的场景。</p>
<p>导出的话也不会乱码，这是比较重要的。</p>
<p>之前做的在 1.0 版本 PPT，大家可以看看。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84d4c827f4514cfd8406d7784a7e7d9c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=TPjJc2VdHI95HDhoZnLqM0KsVIw%3D" alt="图片" loading="lazy"/></p>
<p>地址的话直接手机用最新版的百度文库就可以打开了。</p>
<h2 data-id="heading-5">Agnes</h2>
<p>Agnes 之前我也推荐过，PPT 出来的效果很好，最厉害的是可以做到跨端任务同步。</p>
<p>就是我在 web 端发布一个 PPT 任务，甚至可以在手机 APP 端随时修改和取消。</p>
<p>简直是为我这种顶级牛马量身定制，这下好了，拉屎也可以做 PPT 了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a562a62ca2d5465cab626ec6ac92e439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=EKsM%2BoltPMzxIDTgeck571dSYrs%3D" alt="图片" loading="lazy"/></p>
<p>效果很好，颜值也在线。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0357acad485346778bb5e5d1f29a439f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=PFwXaZsKD8IKn0CkiwL720zMsJ4%3D" alt="图片" loading="lazy"/></p>
<p>可以直接生成 PPT 需要的图片素材，然后在 Agnes 里面基于图片素材合成想要的 PPT。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9cd22d00ebd64d82b9fe8d875082840b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=PH5stNMVPAeUxY%2FmAQixp%2Fwz%2BAs%3D" alt="图片" loading="lazy"/></p>
<p>感兴趣可以看看苍何之前的文章，有一些使用，还是觉得很不错的，然后有不少小伙伴反馈也是，Agnes 能达到做 PPT 的要求。</p>
<pre><code class="hljs language-arduino" lang="arduino">地址：https:<span class="hljs-comment">//app.agnes-ai.com/</span>
</code></pre>
<h2 data-id="heading-6">扣子空间</h2>
<p>字节旗下的通用 Agent 产品，在 PPT 创作上也有两把刷子。直接打开 PPT 模式：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e199f17c99c4cd28f9a8d9a4edfe484~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=b5u0QTcmNYvH1K%2FL%2FPfFiZpheLQ%3D" alt="图片" loading="lazy"/></p>
<p>同样支持上传文档，生成模式可以自行选择。</p>
<p>有一个亮点的功能就是可以基于 PPT 风格做参考，这个就很强。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b54b815055aa4f21ba7c800e1b598cf8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811168&amp;x-signature=wjhj3bdOwMWn2KC5c3hpfC7llg4%3D" alt="图片" loading="lazy"/></p>
<p>因为很多时候，我们明明脑袋里面想要的效果和实际产出不同，大概率是风格不对了。</p>
<p>这样，我们完全可以上传喜欢的风格模板，然后上传自己的文件，输入主题，选择生成的模式。</p>
<p>扣子空间就能给你一个不错的效果。</p>
<p>当然了，现在 AI PPT 工具远不止这些，有可能依旧有不少是很亮眼但没被放进来的，也欢迎大家评论区补充。</p>
<p>工具这么多，每一个都去使用，是不现实的。</p>
<p>挑一个自己喜欢的、效果 nice 的，去使用，我觉得是更好的。</p>
<p>毕竟工具只能解决你产出的问题，但无法解决想要什么的问题。</p>
<p>定义那个问题的人，比 AI 工具本身更重要。</p>
<p>你好，我是苍何，感谢关注，我们下一期见啦！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Gemini 3 刚刷屏，蚂蚁灵光又整活：一句话生成「闪游戏」]]></title>    <link>https://juejin.cn/post/7581348660823670784</link>    <guid>https://juejin.cn/post/7581348660823670784</guid>    <pubDate>2025-12-08T15:13:32.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581348660823670784" data-draft-id="7581348660823654400" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Gemini 3 刚刷屏，蚂蚁灵光又整活：一句话生成「闪游戏」"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-08T15:13:32.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Gemini 3 刚刷屏，蚂蚁灵光又整活：一句话生成「闪游戏」
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:13:32.000Z" title="Mon Dec 08 2025 15:13:32 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 456 篇原创！</p>
<p>大家好，我是又再次玩疯了的苍何。</p>
<p>其实，上周灵光刷屏朋友圈的事，我挺愧疚的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e904544b8caa4187b1652a0ff1389879~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=xgIqhl3ocEuKW%2FN%2FvbnDACVnCDE%3D" alt="图片" loading="lazy"/></p>
<p>作为老东家在 AI 自媒体最优秀的同学（呸，不要脸），我居然不凑热闹，甚至，我的不少蚂蚁同学拿着皮鞭子来问我：为啥不写灵光。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4faa921f6ff4d8b87722009e0f82cfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=6bTpqss078RiJvj94gEC%2FF%2BBILU%3D" alt="图片" loading="lazy"/></p>
<p>讲真，还挺过意不去的，所以，我必须来好好写一篇蚂蚁的灵光。</p>
<p>刚好看到又上线了个好玩的功能，一句话生成可修改的小游戏，体验下来，很上头。你一定要看到最后。</p>
<p>先来看看灵光究竟是个啥吧。</p>
<p>灵光是蚂蚁集团推出的<strong>全模态通用 AI 助手</strong>，支持全模态交互，支持文字、图片、音频、视频、3D模型等多种信息输出形式。还可以最快 30 秒生成小应用和小游戏。</p>
<p>11月18日同时上线安卓和苹果应用商店，据官方消息，上线即火爆，6 天下载量超 200 万，速度超过 ChatGPT 和 Sora2。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/499cec94ce5a41c0a6bdd8b688372b89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=i8TkaEkSN6Cg8leD5sbjSxf0GhI%3D" alt="图片" loading="lazy"/></p>
<p>我骄傲了，虽然不关我鸟事。</p>
<p>其中据说灵光的闪应用功能备受用户喜爱，本次推出的闪游戏也是其核心功能（灵光闪应用）里的场景功能升级。</p>
<p>而且我看到 AI 群里的早报消息说灵光上线两周，用户创建了 330 万个闪应用，不是，合着，这么猛啊。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d220152b9ed9460990e9dc89da34e7e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=XToU%2FzItWg8uphQnVHqvLTU0nyU%3D" alt="图片" loading="lazy"/></p>
<p>这恐怕是继 Gemini3 和香蕉之后又一炸场的 AI 应用。所以我不能天天不务正业玩香蕉了，我也要好好来玩下灵光。</p>
<p>手机 APP Store 下载灵光后，支付宝登录，打开右上角的「闪应用」，点击默认的放个烟火给我看。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bcfc22c12b94393a47568444e4725e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=%2BHMxYgfVRMwDBiBkD3dYzic1Ohc%3D" alt="图片" loading="lazy"/></p>
<p>出来的这个应用真的很好，还带了音效，过年的氛围就有了，你感受一下。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a87a414ef9f4471b9610f7687ac357cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=TpPNmjfJNYmv%2BfVH%2FPiQWqS%2Foqg%3D" alt="wxv_4281228201873227779" loading="lazy"/></p>
<p>而这个小应用的提示词是这样的：</p>
<pre><code class="hljs">做一个放烟花的应用，要求：  
请以浪漫沉浸式夜空奇观风格生成可互动的烟花效果，色彩绽放需灵动多层、有随机惊喜；加入轻盈炸裂音效与回响。
整体画面需梦幻、美观、富有节奏感，每次放烟花都有一句象征祝福或好运的短句（不超过15字） 
</code></pre>
<p>为了防止是后台作弊，我决定依次上难度，来整点活。</p>
<p>先整个经典开心消消乐小游戏吧。</p>
<blockquote>
<p>提示词：做一个开心消消乐游戏</p>
</blockquote>
<p>可以看到，灵光接受到请求后，开始设计、构建游戏界面框架、开发，甚至最后直接应用部署，30 秒就出来了一个可以直接玩的开心消消乐。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfb6d925dc3049a582ad052c367fd82c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=lBXKH%2B3swwiqVeNxo1KNs29%2BWHE%3D" alt="图片" loading="lazy"/></p>
<p>甚至还可以复制链接分享给好友来玩。好家伙，但依旧有一些小问题，比如相邻的滑块之间理论上是互相滑动，而不是交换。</p>
<p>于是我又继续修改：</p>
<pre><code class="hljs">修改两个问题： 
1、心形滑块改为小动物头像滑块； 
2、相邻的滑块的之间可以互相滑动，而不是交换 
</code></pre>
<p>效果立马出来了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/103aee16329749bcaac69e983e2f9bae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=13Ygv8TQ6EBlTIhDbRaO1kGH6IQ%3D" alt="图片" loading="lazy"/></p>
<p>然后继续用文字追加功能，来点关卡吧，提示词：</p>
<pre><code class="hljs">以关卡的形式设置，每达到一个关卡的要求，弹出“哥哥真棒”或者“姐姐真棒”来鼓励玩家，如果没有达到关卡要求，
弹出“哥哥继续加油哦，再试一次吧”或者“姐姐继续加油哦，再试一次吧” 
</code></pre>
<p>玩点活儿，哈哈哈，甚至失败，还能弹窗。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a8e5c7d2cf34f38a13a0984421a8b44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=K%2Fzsy1I1zDNbvi1%2FZ1vaxDoDlBA%3D" alt="图片" loading="lazy"/></p>
<p>好，开心消消乐这波整的很过瘾，灵光生成速度很快，而且指哪改哪，让小游戏创作变得如此简单。</p>
<p>那这就有意思了，我家有个 2 岁多的宝宝，每次教他数字，可痛苦了，特别想做个小游戏来辅导他学数字。</p>
<p>于是输入需求：</p>
<blockquote>
<p>帮我做一个认识数字 1-10 的游戏</p>
</blockquote>
<p>出来效果还不错，同样自带音效和三种不同玩法。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac17d17a6eb744578226082e3378412b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=cIV6WBdvvgHrnTvIZkMP2CCExes%3D" alt="wxv_4281229022916624390" loading="lazy"/></p>
<p>但依旧有一些小细节需要调整，于是继续输入：</p>
<pre><code class="hljs">数字卡片的界面设计的不太合理，比如数字10没有完全显示出来；在数字顺序有一种，点击1会同时出现1和10都被选中的情况，修复一下
</code></pre>
<p>很快，就调整好了，这回效果更好了，你感受下。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87a27a87c0564f37b0b948e216a7c841~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=OVea%2Bj1oUaKIjdqtgjwFoNLpOX0%3D" alt="wxv_4281229505697857545" loading="lazy"/></p>
<p>然后对于两岁多的宝宝，可能连题目都不认识好吧，所以，我们直接让游戏进阶一些难度，让他读出来，效果会更好一些。来吧：</p>
<pre><code class="hljs">小朋友不认识字，在每一个关卡，请读出来题目， 而且对于小朋友正确的点击，请予以肯定“答对了，你真棒”， 
对于错误的点击请予以鼓励“答错了，再试一次”，用上可爱萌趣的声音 
</code></pre>
<p>效果真是绝了，很棒，真的。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46468dd3e0c941d7bc64d916b62c9903~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=b9JN8g00KIkJVDXPofRyPeYFRq8%3D" alt="wxv_4281230125565575177" loading="lazy"/></p>
<p>然后我又继续玩，让灵光来做个跳一跳小游戏吧，然后把跳一跳的角色换为卡皮巴拉。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a902439572304448a2431f3f2b0e41e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=L25D91gBOsozC7Bx4HwRUCmBnC0%3D" alt="图片" loading="lazy"/></p>
<p>哈哈哈，有那个感觉了，这种小游戏，基本就是分分钟手搓一个了。</p>
<p>再来一个小时候最爱玩的空战 1942 小游戏吧。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dba4a524258344dfa9072b746d993f83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=zIKYX6y%2BxlzEaENeVzfWD0Hmuh0%3D" alt="wxv_4281230722918252548" loading="lazy"/></p>
<p>既然这么强，那就再来个常玩的黄金矿工游戏吧。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff68fa597bb64553b28959a560b51141~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=QV8ELoo0fUlRjJkSxmEzFrhT76Y%3D" alt="wxv_4281231272841838595" loading="lazy"/></p>
<p>太好玩了，我还做了个 24 点游戏和连连看小游戏，都非常益智好玩。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7fb46ee1313849c39cb1413b7ff9e386~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811612&amp;x-signature=o154UOJRhOncly3mMdgSP4kWaVE%3D" alt="图片" loading="lazy"/></p>
<p>一口气搓了七八个游戏，说实话，我即使作为写了这么久代码的前程序员，这种震撼感依然很强。</p>
<p>必须要说清楚的是，<strong>大家千万别拿灵光生成的这些游戏去跟《黑神话》这种 3A 大作比，那没有可比性，也不是一个维度的东西。</strong></p>
<p>灵光这次更新，真正让我觉得「炸裂」的地方在于，它展示了 AI 的一种新能力——<strong>对逻辑和规则的深度理解与生成</strong>。</p>
<p>以前我们用 AI，是让它生成一段文案、一张图，那是静态的。但今天，我在灵光里说「把滑块换成小动物」、「相邻滑块不能交换」，AI 是听懂了游戏规则，并实时重写了背后的逻辑代码。</p>
<p>还记得 OpenAI 的 Ilya 曾经说过的 Scaling Law 吗？当模型大到一定程度，它不仅是预测下一个字，它是在构建世界模型。</p>
<p>灵光生成的每一个小游戏，其实都是一次微型的「世界模拟」**。它知道重力怎么算（跳一跳），知道碰撞怎么算（消消乐），也知道怎么哄小朋友（给我儿子做的那个识字游戏）。</p>
<p><strong>这就是我们一直期待的「生成涌现」。</strong></p>
<p>对于普通人来说，这更是一次彻底的平权。</p>
<p>以前你想做个游戏哄孩子开心，你得学 Python，得找素材，得调试半天。现在在灵光这里，<strong>你的想象力，就是唯一的编程语言。</strong></p>
<p>不管你是想做一个专属的纪念日小游戏，还是像我一样为了哄「小橘子」学数学，甚至只是为了整活恶搞一下朋友，门槛都已经降到了 0。</p>
<p>只能说，蚂蚁这波，确实把玩 AI 的上限又推高了一截。</p>
<p><strong>最后，别光看我玩。</strong></p>
<p>强烈建议大家去下载灵光 APP，点开「闪应用」，在对话框里输一句「做一个 xxx 游戏」。</p>
<p>哪怕是最简单的「做一个石头剪刀布」，试着去改改它的规则，感受一下那种「言出法随」的快乐。</p>
<p>做出来了记得在评论区交个作业，或者把链接甩出来，让我看看谁的脑洞最大！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一人手搓！AI 漫剧从0到1详细教程]]></title>    <link>https://juejin.cn/post/7581297335315349556</link>    <guid>https://juejin.cn/post/7581297335315349556</guid>    <pubDate>2025-12-08T15:18:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581297335315349556" data-draft-id="7581297335315333172" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一人手搓！AI 漫剧从0到1详细教程"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-08T15:18:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一人手搓！AI 漫剧从0到1详细教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:18:28.000Z" title="Mon Dec 08 2025 15:18:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 457 篇原创！</p>
<p>大家好，我是喜欢看动漫的苍何。</p>
<p>相信不用说你也知道，我这万年没变的头像，能看出我是个二次元吧？</p>
<p>最近看到 AI 漫剧超级火，加上前些天朋友来公司，我们一起探讨了 AI 漫剧。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5755f03e665943bba1df9e49199dd01d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=z%2BgPTF2UXNIB84KvohMZ0aTUIhY%3D" alt="图片" loading="lazy"/></p>
<p>不懂没关系，可以学习啊，所以这一篇文章其实理论上是我学习的一些成果和一些经验，算是从 0 入门如何制作 AI 漫剧了。</p>
<p>现在的 AI 漫剧市场，说白了就是野蛮生长的爆发期。但这个阶段很快就会过去，作品积累到一定量级后，拼的就不是谁做得快了。</p>
<p>未来的逻辑很简单：只有精品才能跑出来。谁能沉下心做品质，谁才能真正搞定客户。</p>
<p>奔着这个目标，下面这个视频是我这个学习阶段的产物，哈哈哈，我觉得还是挺不错的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ae740dacec14992b05634cbdf928262~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=CtbBbHJX2QYXjnziZVzQY%2B0a3zw%3D" alt="wxv_4286323050523836421" loading="lazy"/></p>
<p>然后还做了一个带穿越的视频：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc028b2085b841418aa8ec9e4778010b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=Q2L9BKBnRz9TzfqlzJNbmE7fs0U%3D" alt="wxv_4283644191911182358" loading="lazy"/></p>
<p>第一个作为AI漫剧的学习作品，我还是非常满意的。</p>
<p>但其实，要想完成这样一个AI漫剧作品，需要用到AI生图、AI视频能力，需要有一个好的工具丝滑完成。</p>
<p>于是开始翻各家AI工具官网，发现有家AI厂商接入了🍌Pro模型。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6ee34827bb64f28ad581d00d1d652f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=66EorPVVO4PoKfM9ZRfBr9grqzg%3D" alt="图片" loading="lazy"/></p>
<p>看了下是国内AI六小龙之一MiniMax旗下的海螺AI，</p>
<p>以前我的印象里，海螺只有自家的模型，现在还引入了其他模型了？</p>
<p>除了🍌Pro，还有 Sora 2.0、Veo 3.1都加进来了？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2973d7efa2d4f5eab5d040aa0cda9a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=VRi3%2FlPNF%2FTyDreGeNmY3kv2Mrs%3D" alt="图片" loading="lazy"/></p>
<p>可以看到，除了海螺自家的模型全家桶之外，还能用上其他能力互补的顶级模型，非常方便一站式做精品AI漫剧。（还有主要是看到马克张老师等大佬也在推荐）</p>
<p>于是就尝试着用海螺AI来创作我的第一个AI漫剧。</p>
<p>本篇我会从学习方法到制作教程，再到最后的成果展示，对 AI 漫剧算是浅浅入一个门分享。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab50a4c5788d47edbd9c4c96179b0b32~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=Sb5owapCWh9svy%2FOZRKwnkWgJaE%3D" alt="图片" loading="lazy"/></p>
<blockquote>
<p>内容会有些长，建议先点赞收藏哈哈哈。不过推荐你一定要看到最后。</p>
</blockquote>
<h2 data-id="heading-0">学习方法</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/12adb4e790994a28a91535cd78149573~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=SoJVHaMkfdfFV5OEb9ln4QHFMFE%3D" alt="图片" loading="lazy"/></p>
<p>根据马克张老师的AI漫剧方法论以及NotebookLM学习知识库，可以提炼相关步骤。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b32cd77bfe774be284b2b3adcceb2a9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=jORCKVcDHn38TfdzGzQGejrNmRI%3D" alt="图片" loading="lazy"/></p>
<p>甚至还可以生成信息图来辅助学习：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5e6712b24f343d7aad715944a23eb72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=BOMRpkWb5B8M1BaQxkVfrWbMFqo%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-1">制作过程</h2>
<p>整体思路其实包含两种不同的思路，一种是这样子的：</p>
<pre><code class="hljs">思路一：
1、利用香蕉pro生成人物  IP 图片
2、生成分镜脚本
3、在海螺agent根据人物参考图和分镜脚本里面生成分镜图片
4、根据海螺AI首尾帧生视频以及文生视频功能将分镜图片生成视频
5、转场根据收尾帧来做丝滑转场
6、剪映或者PR里面去合成
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/587e8f75373f41529f1b8c7430b2defd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=9Y1Wzys31yodsjqWvIYQsUzfD1Y%3D" alt="图片" loading="lazy"/></p>
<p>还有一种更暴力的就是这样子的：</p>
<pre><code class="hljs">1、利用香蕉pro生成人物  IP 图片
2、生成人物场景图和需要的其他场景图
4、根据图片利用海螺AI首尾帧生视频
5、截取后一个视频的尾帧和上一个视频的首帧，生成过度转场视频
6、剪映或者PR里面去合成
</code></pre>
<p>两种方法我都试了，但因为目前对分镜脚本的使用还需要再学习，导致会有一些小小瑕疵，这里就以方法二来展开。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc56f8e7694b4266b4e90567392ada82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=0xXS68%2FEmhzMgklU3J5GRyzZcPc%3D" alt="图片" loading="lazy"/></p>
<p>我们先打开海螺 AI，地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fhailuoai.video" target="_blank" title="https://hailuoai.video" ref="nofollow noopener noreferrer">hailuoai.video</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aeafc3dcc8654952aabc20ee3c0f64d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=bzr6CpnB7i0TOl9cxsGbRi4pvg8%3D" alt="图片" loading="lazy"/></p>
<p>先生成 IP 人物图片，这里可以直接用香蕉 Pro，反正现在对会员来说是免费的。</p>
<p><strong>第一步：人物 IP 图片</strong></p>
<p>可以在 NotebookLM 中，得到生成人物的提示词：</p>
<pre><code class="hljs language-scss" lang="scss">一位英挺的男性侠客，身着中式古装，玄黑色，飘逸长袍，服饰细节上带有中国传统纹饰和金属护甲。
腾空于山巅之上，背景是云雾缭绕的险峻山峰和古老的瀑布。
面部特征：年轻俊朗，眼神坚定且深邃，背后背着一柄古朴宝剑。
视觉风格：**武侠国漫风格 (Wuxia Guoman style)**，**类似《凡人修仙传》动画版的高级渲染和光影效果**，数字绘画 (Digital Painting)，高细节度 (High Detail)，概念艺术 (Concept Art)，电影级光照 (Cinematic Lighting)。
构图与视角：全身像，风吹拂着衣袂，营造出强烈的动态感和仙侠意境。
</code></pre>
<p>把这个提示词放到海螺AI的生图这里，选择🍌Pro模型，可以一次生成最多 4 张图，4K 分辨率的，而且现在还不需要花费积分。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2a8a3603f064222a28fc022b8bbff64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=ey%2Bk7e0LsxlqWJBpEU8aFRfnNls%3D" alt="图片" loading="lazy"/></p>
<p>选择一张自己喜欢的，这里我感觉这个还蛮帅的，就这吧。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db8c36dbbc9c4aa7bdc47705c16b6eb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=eqB2qv3x2BVQS2aJXqz8uav9vuc%3D" alt="图片" loading="lazy"/></p>
<p>海螺AI中可以无水印下载后的图片效果，不得不说，真帅啊。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e8edce8afee41ee97edcc3a0a8610d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=e69mv7AtwdsVU90nG%2Bf%2Bu%2Ftix%2Fc%3D" alt="图片" loading="lazy"/></p>
<p><strong>第二步，生成人物场景图</strong></p>
<p>我和 NotebookLM 一起构思的场景是人物和龙打斗的场景，为了达到很 nice 的效果，这里也参考了 7 先生的提示词进行了修改，同样在海螺中输入以下提示词，并上传第一步生成的参考图：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db3cb67051d7491a96bae2b2208f278a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=DXje404e3QbbCVWK5mO3EvBjFBc%3D" alt="图片" loading="lazy"/></p>
<p>提示词如下：</p>
<pre><code class="hljs language-makefile" lang="makefile">一位英挺的男性侠客，身着中式古装，玄黑色，飘逸长袍，服饰细节上带有中国传统纹饰和金属护甲。
<span class="hljs-section">背景:黄昏，落日，宏伟的中式宫殿，飞檐翘角。</span>
<span class="hljs-section">光影:电影感侧逆光，轮廓光，暖色调，橙红色天空，长长的影子。</span>
<span class="hljs-section">细节:腰间有金色光芒，沧桑感。</span>
<span class="hljs-section">构图与风格:中景，平视视角，写实CG，高细节，氛围感，8K。</span>
</code></pre>
<p>生成了好几张，选择一张效果最好的。（如果不满意重新多生成几次就好了）这里的人物一致性保持的非常好。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/be2f236882d944679fea25bef26c597b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=OQMqbKBksvW2xwLPi07Q2l55gPQ%3D" alt="图片" loading="lazy"/></p>
<p>然后是人物冲锋图，同样参考 7 先生视频中的部分提示词：</p>
<pre><code class="hljs language-swift" lang="swift">一群中国古代武士在空中，前景一人持火焰剑向前冲锋，背景其他人持火焰武器飞舞，身处烈焰云与黑暗
stormy 天空中，超写实<span class="hljs-type">CG，史诗奇幻战斗，强烈动感，戏剧化光影，鲜明的橙黑配色</span><span class="hljs-operator">。</span>
</code></pre>
<p>同样在海螺里面输入提示词和参考图，这里注意我选择的依旧是最新的香蕉Pro。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f27aaba42cd643bcbad1623c726878ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=IIOB2hRC%2BvmuS1oD86BFhVdbE0A%3D" alt="图片" loading="lazy"/></p>
<p>可以一次最多生成 4 张，这里我选择了这张：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04c1a8d811cb42d88d597f81c6f484e6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=NS0K%2FVwJi9NtjGmNXlj7KxKgWGo%3D" alt="图片" loading="lazy"/></p>
<p>最后需要一张巨龙图，这里我输入简单的提示词是没法达到效果的，有 2 种办法，一种是利用参考图的方式来生成，一种就是利用超级专业且复杂的提示词，这里 NotebookLM 帮我提炼了 7 先生的生成巨龙提示词如下：</p>
<pre><code class="hljs">墨色乌云像浓墨泼进深渊，雷电在云缝里疯窜，炸开刺目白光和震耳雷鸣。镜头"嗖”地往前猛冲，穿层层

湿冷云层时，水汽被热浪烤得泛绯红，云层像在”燃烧”!红流光在云海里左扭右拐，藏着龙头龙尾勾人视线。

突然神龙从云中冲出来，龙头朝着镜头飞，从画面上方掠走，周身火焰”轰”地炸开!最后神龙从云层下钻出来。定格神龙特写盘在云涛里，火焰和雷云一块狂舞的威霸气态，视觉冲击直接把心炸开!
</code></pre>
<p>海螺中生成不满意的还可以直接重新生成，我选择了一张炫酷的，哈哈：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32ef57d301c141e79aa40dae9e3f05e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=A%2B3eVWpBuQZsNEEsvSch6KDWOh8%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p><strong>第三步，生成巨龙喷火的视频</strong></p>
<p>在海螺中选择 Video 视频生成，输入第二步生成的巨龙，配合上这样一段提示词（在 7 先生的视频提示词基础上做了改动）</p>
<pre><code class="hljs">诗奇幻风格，以图中东方龙为核心，周身烈焰燃烧，鳞片具有金属光泽，龙须飘动，红眼凌厉。它在乌云翻涌、闪电肆掠的天空下缓缓游动，头部转动，
口中持续喷吐火柱倾泻而下。闪电时镜头轻微抖动。保持东方龙的主体特征不变，没有龙爪 ，没有翅膀。
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a42505a32980413eba74b2b9e43b7047~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=3BBHCYP5yvk5t0KLVUjxli13ndw%3D" alt="图片" loading="lazy"/></p>
<p>生成视频这里，可以用不同的模型都试一下，然后选择一个效果最好的就好了。我跑了几个后，选择了这个视频片段。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1ededc3189f45a782f82b7bd4c9c403~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=j9dPWmlwEWtFlcRqjRMdpIvKUjc%3D" alt="wxv_4283642744943591431" loading="lazy"/></p>
<p>你可以看到整个画面都是非常有震撼感的，而且使用Veo3.1是能直接生成音效的，效果很赞。</p>
<p>这里再补充一些场景，龙喷火完后，火球会落到地面，所以再根据参考图输入以下提示词：</p>
<pre><code class="hljs">史诗奇幻风格，以图中东方龙为核心，
周身烈焰燃烧，鳞片具有金属光泽，龙须飘动，红眼凌厉。它在乌云翻涌、闪电肆掠的天空下缓缓游动，它口中持续喷吐火柱倾泻而下。
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9d90a81d2ef2443ba76673d17d831da6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=KCdo5It%2F8lmIPXHZIDTy53xjn60%3D" alt="wxv_4283643742365777930" loading="lazy"/><br/>
这里龙保持了完美的一致性，而且整个视频很自然，场景也比较震撼。同样自带了音效。</p>
<p>在海螺使用Veo3.1 / Sora2 能直出带有原生音效的视频片段，</p>
<p>完美地跟海螺AI产品进行结合，补齐“音画”这一部分的拼图~</p>
<p>这，或许就是引入多模型的意义。</p>
<p><strong>第四步，生成其他场景需要的视频。</strong></p>
<p>主要包含火球落到地面，人物开始去和龙打斗的场景等，同样的方法这里就不多放了，提示词需要的话三连评论区留言就好。</p>
<p>然后根据前段视频的首帧和后端视频的尾帧，做转场视频，方法也类似。</p>
<p><strong>第五步，去剪映里面做合成。</strong></p>
<p>把所有的素材去剪映做下简单的剪辑合成就完成啦。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcaab48f614944228543c94512790d72~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=lyvIfkPnVbmV4%2BB%2BRFCjFWGVUq8%3D" alt="图片" loading="lazy"/></p>
<p>最终得到如下成品视频：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c00187680b15483cb949c6ed3d4a1103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=8qIHNpvrnJIHrDLHrhy0e5Stg3w%3D" alt="wxv_4283644794347192339" loading="lazy"/></p>
<p>除了这个我还做了一个有剧情穿越感的视频，哈哈哈，大家可以感受一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63aab5dc341348d58184b5e547416fd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=k%2FXJ18jEsdMUAgznSQH4%2Fv1Zkmk%3D" alt="wxv_4283644191911182358" loading="lazy"/></p>
<p>现在海螺AI，不再只有自家模型，而是汇集了不同领域的SOTA模型，</p>
<p>而且调用谷歌Veo3.1的价格，大概是官方价格的3.7折，现在年卡有4折优惠活动。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f945052359e4164b288308d7fd23147~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765811908&amp;x-signature=Oz7zetGZomXLXYoohAMiSsSMyDY%3D" alt="图片" loading="lazy"/></p>
<p>最关键的是只要是海螺的任意档会员，今年都能无限使用Nano Banana Pro 来生图，直到2025年12月31日。</p>
<p>可以放心食用了，哈哈哈。</p>
<p>好了，教程和方法论已经分享完了。</p>
<p>看着屏幕里呼啸而过的巨龙和仗剑天涯的侠客，说实话，那一刻我心里挺感慨的。作为一个从小看动漫长大的老二次元，能亲手把脑海里那些天马行空的画面「具象化」，这种感觉真的很奇妙。以前觉得遥不可及的动画制作，动辄需要专业团队耗时数月，现在居然在一个网页里就能跑通全流程。这不仅仅是我个人的尝试，更是技术带来的平权。这也正是海螺 AI 让我惊喜的地方。它不只是简单地接入了🍌Pro 或者 Veo 3.1 这么多顶尖模型。更重要的是，它打破了模型之间的「高墙」，消除了不同工具间的割裂感。它把当今最顶级的画质、最丝滑的视频生成能力整合在一起，不仅把价格打了下来，更把门槛降了下来。海螺 AI 正在用技术填补普通人与专业创作者之间的鸿沟，把创作的门槛无限拉低，直到与你的想象力平齐。只要你有故事，海螺 AI 就能还给你一个世界。别让你的想象力，只停留在脑海里。去试试吧，用 AI 讲出属于你的故事。我是苍何，我们下期见。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[理解iOS中Protobuf：一个比JSON更好，但不是替代]]></title>    <link>https://juejin.cn/post/7581306080435634227</link>    <guid>https://juejin.cn/post/7581306080435634227</guid>    <pubDate>2025-12-08T15:35:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080435634227" data-draft-id="7580564126402871346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="理解iOS中Protobuf：一个比JSON更好，但不是替代"/> <meta itemprop="keywords" content="iOS,架构,性能优化"/> <meta itemprop="datePublished" content="2025-12-08T15:35:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sweet丶"/> <meta itemprop="url" content="https://juejin.cn/user/3227821869921646"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            理解iOS中Protobuf：一个比JSON更好，但不是替代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821869921646/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sweet丶
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:35:58.000Z" title="Mon Dec 08 2025 15:35:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在iOS开发中，JSON凭借其卓越的可读性和跨平台兼容性，长期以来都是网络交互和本地存储的首选。但你是否遇到过因网络请求过慢导致用户体验不佳，或是在处理大量数据时应用响应迟缓的情况？问题的根源有时就出在数据交换的格式上。</p>
<p>今天，我们将深入探讨 <strong>Protocol Buffers（简称Protobuf）</strong> ——一种由Google设计的结构化数据序列化机制。这篇博客将澄清一个常见的误解：引入Protobuf<strong>并非为了全盘取代JSON</strong>，而是为了在你工具箱中增加一个强有力的选项。我们将重点剖析它相比JSON的核心优势、独特的工作原理、最适用的场景，并看看它是如何在现实中被大厂们广泛应用的。</p>
<h3 data-id="heading-0">一、不是替代，而是补充：Protobuf与JSON的核心差异</h3>
<p>要做出明智的技术选型，首先要理解它们的本质区别。我们可以用一个简单的比喻：JSON好比一封信件，所有人都能轻松阅读；而Protobuf更像一封密码电报，体积小、传输快，但需要密码本（即<code>.proto</code>定义文件）才能解读。</p>
<p>为了更直观，请看下表对两者关键特性的对比：</p>



































<table><thead><tr><th align="left">特性维度</th><th align="left">JSON (文本格式)</th><th align="left">Protobuf (二进制格式)</th></tr></thead><tbody><tr><td align="left"><strong>可读性</strong></td><td align="left"><strong>极高</strong>，数据本身就是文本，方便调试。</td><td align="left"><strong>极低</strong>，二进制格式难以肉眼识别。</td></tr><tr><td align="left"><strong>数据体积</strong></td><td align="left"><strong>较大</strong>。包含重复的字段名、引号、括号等冗余信息。</td><td align="left"><strong>极小</strong>。用字段编号替代字段名，编码紧凑。</td></tr><tr><td align="left"><strong>序列化/反序列化速度</strong></td><td align="left">较慢。需解析文本字符串，进行类型转换。</td><td align="left"><strong>极快</strong>。直接处理二进制流，编码/解码几乎等同于内存拷贝。</td></tr><tr><td align="left"><strong>强类型与Schema</strong></td><td align="left">无。依赖约定，容易出错，需额外校验工具（如JSON Schema）。</td><td align="left"><strong>有</strong>。通过<code>.proto</code>文件明确定义，生成类型安全的代码。</td></tr><tr><td align="left"><strong>跨版本兼容性</strong></td><td align="left">弱。增删字段易导致客户端崩溃，需要严格协调。</td><td align="left"><strong>强</strong>。设计上就支持向前/向后兼容，新增可选字段旧代码自动忽略。</td></tr></tbody></table>
<p>一个典型例子是，同样一条包含<code>id</code>, <code>name</code>, <code>email</code>三个字段的用户信息，JSON格式的文本可能长达上百字节，而Protobuf编码后可能只有十几个字节，在弱网环境下，这种差异会直接影响App的响应速度。</p>
<p>因此，<strong>选型的关键在于场景</strong>：</p>
<ul>
<li><strong>对外API、配置文件、需要浏览器直接解析的数据</strong>：<strong>JSON是不二之选</strong>。</li>
<li><strong>对内的微服务通信、高频率RPC调用、移动端弱网优化</strong>：<strong>Protobuf的优势将非常突出</strong>。</li>
</ul>
<h3 data-id="heading-1">二、性能之谜：Protobuf为何如此高效？</h3>
<p>Protobuf的高性能并非魔法，而是源于其精巧的编码设计。下面这张图清晰地展示了它的工作原理：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[.proto 消息定义文件] --&gt; B[protoc 编译器]
    
    B --&gt; C[目标语言代码&lt;br&gt;如 Swift Class]
    C --&gt; D[包含序列化与&lt;br&gt;反序列化方法]
    
    A --&gt; E[Protobuf 编码规则]
    
    subgraph E[编码规则]
        F[字段: Tag-Length-Value&lt;br&gt;编码&lt;br&gt;用数字编号代替字段名]
        G[整数: Varint 变长编码&lt;br&gt;小数字节数更少]
        H[有符号整数: ZigZag 编码&lt;br&gt;优化负数存储]
    end
    
    D -- 序列化 --&gt; I[紧凑的二进制数据]
    I -- 网络传输或存储 --&gt; J
    J -- 反序列化 --&gt; D
</code></pre>
<ul>
<li>
<p><strong>核心1：T-L-V编码与字段编号</strong>
Protobuf抛弃了字段名，转而为每个字段分配一个唯一的<strong>数字编号（Tag）</strong>。序列化时，一个字段被编码为 <code>(Tag, Type, Value)</code> 的组合。接收方通过同样的 <code>.proto</code> 文件，就能将编号映射回正确的字段名。这从根本上消除了JSON中重复的字段名开销。</p>
</li>
<li>
<p><strong>核心2：Varint与ZigZag编码</strong></p>
<ul>
<li><strong>Varint变长编码</strong>：对于整数，小数值占用更少的字节。每个字节的最高位是标志位，表示是否还有后续字节，真正有效的只有低7位。这意味着数值<code>1</code>只需1个字节，而非固定的4个字节。</li>
<li><strong>ZigZag编码</strong>：专为有符号整数优化。它将负数“曲折”映射为一系列正数（如-1映射为1，1映射为2），使负数也能利用Varint编码紧凑存储。</li>
</ul>
</li>
</ul>
<p>正是这些底层设计，使得Protobuf能在数据大小和解析速度上实现数量级的提升。根据Google的数据，Protobuf相比XML，解析速度可以提高20到100倍，数据体积可减小到原来的1/10到1/3。</p>
<h3 data-id="heading-2">三、iOS开发中，何时应该考虑Protobuf？</h3>
<p>基于以上特性，在iOS开发中，以下几种场景特别适合引入Protobuf：</p>
<ol>
<li><strong>微服务/后端高频率通信</strong>：当你的App需要与后端进行大量、密集的RPC式数据交换时（例如即时通讯的消息推送、实时游戏状态同步），Protobuf减少的每一点延迟和流量都将汇聚成显著的体验优势。</li>
<li><strong>弱网环境优化</strong>：对于需要关注移动网络下用户体验和用户流量的应用，更小的数据包意味着更快的加载速度和更低的请求失败率。</li>
<li><strong>客户端本地数据存储</strong>：对于需要缓存大量结构化数据（如新闻资讯、产品目录）的场景，使用Protobuf序列化后存储，可以节省可观的磁盘空间，并加快读取速度。</li>
<li><strong>强类型与团队协作</strong>：在大型项目中，<code>.proto</code>文件作为一份明确的、跨平台（iOS, Android, 后端）的数据合同，能有效减少前后端联调时的类型错误和沟通成本。</li>
</ol>
<h3 data-id="heading-3">四、不只是理论：大厂们的实践</h3>
<p>Protobuf并非实验室技术，它已经在业界被广泛采用，并构成了现代云原生和微服务架构的基石。</p>
<ul>
<li><strong>Google的“亲儿子”</strong>：Protobuf自2001年起在Google内部用于几乎所有RPC通信和数据存储，后于2008年开源。它也是gRPC框架默认的序列化协议。可以说，Google的整个分布式系统都构建在Protobuf之上。</li>
<li><strong>字节跳动的选择</strong>：在其开源的<strong>Kitex</strong>高性能Go微服务RPC框架中，除了支持Thrift，也深度支持<strong>Kitex Protobuf</strong>和<strong>gRPC</strong>协议，以应对其海量、高并发的内部服务通信需求。</li>
<li><strong>云原生生态的标准</strong>：在CNCF（云原生计算基金会）生态中，Protobuf是许多核心项目的默认或重要选择。例如，在服务网格<strong>Istio</strong>、分布式追踪等系统中，都广泛使用Protobuf进行高效的数据交换。</li>
<li>开源框架MMKV，基于Protobuf进行序列化存储提升了性能。</li>
</ul>
<h3 data-id="heading-4">五、在iOS项目中如何开始？</h3>
<p>在iOS项目中使用Protobuf的流程非常标准化：</p>
<ol>
<li><strong>定义契约</strong>：编写 <code>.proto</code> 文件，定义你的请求和响应数据结构。
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";
message UserRequest {
  int32 user_id = 1;
}
message UserProfile {
  string name = 1;
  string email = 2;
  int32 age = 3;
}
</code></pre>
</li>
<li><strong>生成代码</strong>：使用 <code>protoc</code> 编译器配合 Swift 插件，将 <code>.proto</code> 文件编译为 Swift 类。
<pre><code class="hljs language-bash" lang="bash">protoc --swift_out=. your_proto_file.proto
</code></pre>
</li>
<li><strong>集成与使用</strong>：将生成的Swift文件加入项目。然后，你就可以像使用普通对象一样进行序列化（<code>serializeToData()</code>）和反序列化（<code>init(serializedData:)</code>）。</li>
<li><strong>网络层整合</strong>：通常需要将网络层从基于JSON的<code>URLSession</code>适配为支持Protobuf二进制流的格式，或直接使用基于Protobuf的gRPC框架。</li>
</ol>
<h3 data-id="heading-5">总结与最佳实践</h3>
<p>回到最初的观点：<strong>Protobuf不是JSON的替代品，而是在特定问题域更优的解决方案</strong>。</p>
<p>一个现代、健壮的架构往往是混合式的：</p>
<ul>
<li>对<strong>外</strong>面向浏览器、移动端或第三方开发者的API，继续使用<strong>JSON</strong>，保证最大的兼容性和可调试性。</li>
<li>在<strong>内</strong>部服务间、对性能有极致要求的移动端数据通道，采用<strong>Protobuf</strong>，追求极致的效率和类型安全。</li>
</ul>
<p>作为iOS开发者，理解Protobuf的原理和优势，能让你在面临性能瓶颈、思考架构优化时，多一个强大而成熟的选择。技术决策没有银弹，只有对场景最合适的权衡。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[这5个AI文本可视化工具太强了！一键把文本转信息图、流程图等多种可视化形式！PPT秒变高级！（建议收藏）]]></title>    <link>https://juejin.cn/post/7581297335315464244</link>    <guid>https://juejin.cn/post/7581297335315464244</guid>    <pubDate>2025-12-08T15:47:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581297335315464244" data-draft-id="7581354812860825652" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="这5个AI文本可视化工具太强了！一键把文本转信息图、流程图等多种可视化形式！PPT秒变高级！（建议收藏）"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-12-08T15:47:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员X小鹿"/> <meta itemprop="url" content="https://juejin.cn/user/2928754709505608"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            这5个AI文本可视化工具太强了！一键把文本转信息图、流程图等多种可视化形式！PPT秒变高级！（建议收藏）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2928754709505608/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员X小鹿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:47:58.000Z" title="Mon Dec 08 2025 15:47:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大家好，我是X小鹿。</p>
<p>前几天被读者问到了「文本可视化」工具，趁着周末，整理了下之前体验过的几款还不错的 AI 工具。</p>
<p>这些 AI 工具都可以<strong>一键将枯燥的文本，转化为精美信息图、数据图、卡片等形式</strong>。</p>
<p>不管是在项目汇报中插入，还是用于 PPT 配图、文章配图、生成科普图文、读书笔记卡片、自媒体图文创作等场景，都是可以的。</p>
<p><strong>下面分享 5 个目前国内外用得较多「文本可视化」工具。</strong></p>
<p>有需要的可以保存下，早晚用得上～</p>
<h2 data-id="heading-0">一、Seede AI</h2>
<p>第一个，Seede AI，一款适合普通人上手的 AI 设计工具，国内可用。</p>
<p>只需要把文案输进去，它就能自动完成需求分析、布局、设计、图像处理等，输出视觉风格不错的图片。</p>
<p>Seede AI 也是X小鹿最近一直在用的一款 AI 工具，尤其是它在接入了谷歌的 <strong>Gemini 3 Pro</strong> 后，出图效果更强了。</p>
<p>不管是在布局排版上，还是配色和整体质感上。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cfbbcae1b2b94e8a8478914c2ced579b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=pjUJYu8nyc3oc%2BmkFWGzzL%2FkUyo%3D" alt="图片" loading="lazy"/></p>
<p>很喜欢 Seede AI 里面的「长图」生成功能，很适合来生成科普图文。</p>
<p>比如输入：<code>生成一个关于xx的科普图文，图文并茂：[输入文案]</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/393d667c0c2548599492999a10a1a665~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=Shmfgpnh7JkiN1N1c6yBa1IfQ5g%3D" alt="图片" loading="lazy"/></p>
<p>Seede AI 就会根据我们输入的文案内容，将文本转化为一张精美长图，下面是生成的效果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96e01e62db614a7b8f6c729a4e16ed43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=xXLNyGKOYcp8spoZb27MuPm%2Bzcw%3D" alt="图片" loading="lazy"/></p>
<p>而且 Seede AI 还会将生成的图片拆分为各个图层和元素，画面上的所有元素都是可以修改的，就很方便。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0be13b8b47d94a05bfb625864fff02af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=sJMcVf7uYf3o%2BFpFD%2FU9EGS8B5g%3D" alt="图片" loading="lazy"/></p>
<p>除了做科普图文，还可以用 Seede AI 来生成<code>知识卡片</code>、<code>社群早报</code>、<code>读书笔记摘要</code>、<code>海报</code>、<code>流程图</code>、<code>社媒图文或封面</code>等。</p>
<p>更详细的介绍及教程，可以看之前的文章：</p>
<p><a href="https://juejin.cn/post/7577958825342795795" target="_blank" title="https://juejin.cn/post/7577958825342795795">这款AI工具太惊喜了！1分钟生成精美长图，自由编辑像PPT！还免费可用！（附保姆级教程）</a></p>
<p><strong>Seede</strong> <strong>AI</strong> <strong>网址：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fseede.ai%2Fsign-up%3FinviteCode%3DA34LNT" target="_blank" title="https://seede.ai/sign-up?inviteCode=A34LNT" ref="nofollow noopener noreferrer">seede.ai/sign-up?inv…</a></p>
<p>ps：Seede AI 目前每天都有免费使用次数。（注册时邀请码填 <strong>A34LNT</strong>，还可以获得额外的使用额度）</p>
<h2 data-id="heading-1">二、Napkin</h2>
<p>第二个，Napkin，一款 AI 驱动的文本视觉化工具。</p>
<p>Napkin 能智能理解文本内容、自动总结重点和划分层级。</p>
<p>比如，在 Napkin 里选中我们想生成可视化视图的文本，点左侧的按钮：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f85136db03154d62aa327d40efb2c2e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=dJvgd45XXNv9wnFmeynwJBa%2FQAQ%3D" alt="图片" loading="lazy"/></p>
<p>Napkin 就会根据文本内容，生成包括思维导图、流程图、对比图、数据图、时间线图等几十种视觉效果供我们选择：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5a29e53e8844374b907323c0e37aeb4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=m%2Bd5l8Lq4sskO9Es4Xg6p0xZKsY%3D" alt="图片" loading="lazy"/></p>
<p>还可以对生成好的视图进行再次编辑。</p>
<p>包括文本内容、字体、颜色、形状、添加小图标、添加文本、添加连线、添加外部图片等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/96f3dc234a604a7a96f6594212f6d418~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=ki5Z98w8yc5VqafAo2BR92YOjoo%3D" alt="图片" loading="lazy"/></p>
<p>更详细的介绍及教程，可以看之前的文章：</p>
<p><a href="https://juejin.cn/post/7478280656586424361" target="_blank" title="https://juejin.cn/post/7478280656586424361">DeepSeek+Napkin绝了！1分钟搞定高颜值图表，PPT救星！只需2步，90%的人都不知道！（附保姆级教程）</a></p>
<p><strong>Napkin 网址：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.napkin.ai%2F" target="_blank" title="https://www.napkin.ai/" ref="nofollow noopener noreferrer">www.napkin.ai/</a></p>
<p>ps：目前 Napkin 每周有 500 积分可免费使用。</p>
<h2 data-id="heading-2">三、PicDoc</h2>
<p>第三个，PicDoc，也是一款 AI 驱动的文本转视觉工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f84f4b86c60545fdac4c355941f9a62e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=mrOFt9qThsQAwzjxXjWrM1uuZNc%3D" alt="图片" loading="lazy"/></p>
<p>和 Napkin 的用法很像，也是选中想可视化的文本，它就能生成包括结构图、循环图、鱼骨图等近百种信息图和数据图。</p>
<p>但和 Napkin 相比，PicDoc 是全中文的界面，对国内用户更友好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/265cfb989c374f199e4fe6ac46faa2ff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=jidrIRC6opBD2rMoMRDNg9tAr9k%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4f232b14d9041d884b3f1f715ab8605~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=6znIAa9PzBU2Y4bImcCyKTPauLw%3D" alt="图片" loading="lazy"/></p>
<p>PicDoc 生成后的图片，也是支持再次编辑的。</p>
<p>更详细的介绍及教程，可以看之前的文章：</p>
<p><a href="https://juejin.cn/post/7518696088652906523" target="_blank" title="https://juejin.cn/post/7518696088652906523">完全免费！别卷Napkin了，这款国产的文本转视图神器杀疯了！2步搞定高颜值图表，效率飙升80%（建议收藏）</a></p>
<p><strong>PicDoc 网址：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.picdoc.cn%2F" target="_blank" title="https://www.picdoc.cn/" ref="nofollow noopener noreferrer">www.picdoc.cn/</a></p>
<p>ps：PicDoc 目前每周有 1000 积分。</p>
<h2 data-id="heading-3">四、可赞Ai</h2>
<p>第四个，可赞Ai，一款 AI 办公可视化工具。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac2aaa072f7049978d45c6c93eb7e5da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=lP3bAu1vyTnw5bNMMQZ9aTVYg3Q%3D" alt="图片" loading="lazy"/></p>
<p>和 Napkin、PicDoc 相比，「可赞Ai」支持更多的可视化形式，包括：</p>
<ul>
<li><strong>图例</strong></li>
<li><strong>图表</strong>（表格、柱状图、折线图、散点图、雷达图、饼图）</li>
<li><strong>卡片</strong></li>
<li><strong>思维导图</strong>（脑图）</li>
<li><strong>多图排版</strong>（适合发布小红书、小绿书、抖音等多种场景）</li>
<li><strong>长图排版</strong>（适合发布公众号、营销展示、宣传等多种场景）</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26effcebc2d742ba852772df9387c119~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=qNAvXOUofOWuMay6FakNwcKXetk%3D" alt="图片" loading="lazy"/></p>
<p><strong>图例形式：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55240263ff9a4c16beecfe38c27c80fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=ogKpsrsAlCiDVGOXbZ0WmwN%2Bz%2Bc%3D" alt="图片" loading="lazy"/></p>
<p><strong>图表形式：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36bc7150bc5a4051a180d76cd26c11f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=JOH7aX%2BHHQV9dzzIEhIHT7tnwGg%3D" alt="图片" loading="lazy"/></p>
<p><strong>卡片形式：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c555ce7c903d44fcbfdc01879c000a26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=6ed2WoM0VRw2XEvRrrv%2FCUT4Qro%3D" alt="图片" loading="lazy"/></p>
<p><strong>思维导图形式：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2dddebc1898d4e72878e94a04c0eb139~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=G9Lc0lG2xQmSgVIuSNxcHJEaalM%3D" alt="图片" loading="lazy"/></p>
<p><strong>小红书形式：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30596c88fc4846fe9af20eaa3f7c940d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=W2Ihy29Mpfosd4z2wsxvcQCZNWU%3D" alt="图片" loading="lazy"/></p>
<p>更详细的介绍及教程，可以看之前的文章：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FVQa3ePlILdRLVgmXM99MVQ" target="_blank" title="https://mp.weixin.qq.com/s/VQa3ePlILdRLVgmXM99MVQ" ref="nofollow noopener noreferrer">这款AI办公可视化工具绝了！只需2步，文本轻松转思维导图、图表、长图、小红书图文、卡片等，打工人速存！（建议收藏）</a></p>
<p><strong>「可赞<strong><strong>Ai</strong></strong>」 网址：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fkezign.cn" target="_blank" title="https://kezign.cn" ref="nofollow noopener noreferrer">kezign.cn</a></p>
<p>ps：「可赞Ai」目前也是每天都有免费使用次数。</p>
<h2 data-id="heading-4">五、Infograghy</h2>
<p>第五个，Infograghy，可以把任意文本转化为信息图表的形式。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc9057e646d649dabe4f0da421f3efe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=hCNkvO5%2FQHNSNs5yi4RAktDkZQk%3D" alt="图片" loading="lazy"/></p>
<p>只需要把文本粘贴过去，设置好「比例」，它就可以生成多张精美的信息图表。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11c725f3a2454bc0bf1110ff7919365f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=GQ4pCNICRboDRdiGrUYE2MUrGaU%3D" alt="图片" loading="lazy"/></p>
<p>也可以直接丢一个链接、一个 PDF、或输入一个问题。</p>
<p>生成好的图表，也可以再次编辑。</p>
<p>比如修改文字内容、字体、字号大小、颜色，甚至替换、添加图片。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f377c896d2f14b18b23af30ee3d404b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=BcKbLobdLtQRdx5RMyRwjBci%2Bf4%3D" alt="图片" loading="lazy"/></p>
<p>你还可以直接从它提供的模板中选择喜欢的风格，然后手动替换成你的文本或图片。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3be8f1cb03742678ed8873488727292~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGYWOWwj-m5vw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765813677&amp;x-signature=ZNGHO0FodPcCu42qCdL5S%2FRQv%2BI%3D" alt="图片" loading="lazy"/></p>
<p><strong>Infograghy 网址：</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Finfography.in%2F" target="_blank" title="https://infography.in/" ref="nofollow noopener noreferrer">infography.in/</a></p>
<p>ps：免费体验额度较少（目前是 5 次）</p>
<h2 data-id="heading-5">六、写在最后</h2>
<p>这 5 款都是很好用的文本可视化工具。</p>
<p>除了第 5 个工具 Infography 的免费额度比较少外，其他 4 个目前每周、每天都能领免费使用次数。</p>
<p>可以用于项目汇报中（插入 PPT / Word 等文档），或者给文章配图、生成自媒体图文等多种场景。</p>
<p>有需要的可以收藏一下。</p>
<p>以上就是今天的分享，感兴趣的快速试试吧~</p>
<hr/>
<blockquote>
<p>我是<a href="https://juejin.cn/user/2928754709505608/posts" title="https://juejin.cn/user/2928754709505608/posts" target="_blank">程序员X小鹿</a>，前互联网大厂程序员，也是一名 AIGC 爱好者，持续分享更多好用的 AI 工具，欢迎一起交流~</p>
</blockquote>
<p><strong>推荐阅读</strong></p>
<p><a href="https://juejin.cn/post/7454501732203610131" title="https://juejin.cn/post/7454501732203610131" target="_blank">2024年终AI工具汇总：9大AI领域，70+精选AI工具，全都在这了！(建议收藏)</a></p>
<p>更多 AI 工具见<a href="https://juejin.cn/column/7284164153576947724" title="https://juejin.cn/column/7284164153576947724" target="_blank">【AI工具】</a>专栏，持续更新中。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[计算机十万个为什么--数据库索引]]></title>    <link>https://juejin.cn/post/7581292270962114570</link>    <guid>https://juejin.cn/post/7581292270962114570</guid>    <pubDate>2025-12-08T15:57:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581292270962114570" data-draft-id="7581292270962081802" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="计算机十万个为什么--数据库索引"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-08T15:57:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="无限大6"/> <meta itemprop="url" content="https://juejin.cn/user/2865758605422890"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            计算机十万个为什么--数据库索引
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2865758605422890/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    无限大6
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T15:57:08.000Z" title="Mon Dec 08 2025 15:57:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">计算机十万个为什么--数据库索引</h2>
<blockquote>
<p>大家好，欢迎来到最新一期的无限大博客。</p>
<p>突然发现自己对数据库相关的内容掌握不够扎实，于是就去学习了一下，顺便也将自己的理解写成了一篇博客。</p>
<p>希望这篇文章能对大家有所帮助</p>
</blockquote>
<h3 data-id="heading-1">数据库索引：给数据仓库装个"智能导航系统" 🧭</h3>
<p>想象一下，你走进一个占地 1000 平方米的超级图书馆 📚，里面塞满了几十万本书，却连个分类牌都没有。老板忽然喊你找一本《数据库从入门到放弃》，你是不是当场想表演一个原地消失术？😱</p>
<p>这就是<strong>没有索引的数据库</strong>的日常！每次查询都像蒙眼找书，全表扫描就是那个被蒙住眼睛的倒霉蛋，只能一本本摸过去。而今天我们要聊的 <strong>数据库索引</strong> ，就是给这个混乱图书馆装上的智能导航系统 🧭，让你秒变图书馆馆长，想找哪本书就找哪本书！</p>
<h3 data-id="heading-2">为什么"like '%关键词%'"会让索引当场罢工？</h3>
<p>先看个灵魂拷问：下面两条 SQL，性能可能差 1000 倍！你猜哪个快？</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 语句 A</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> books <span class="hljs-keyword">WHERE</span> title <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'数据库%'</span>;

<span class="hljs-comment">-- 语句 B</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> books <span class="hljs-keyword">WHERE</span> title <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%数据库%'</span>;
</code></pre>
<p>答案是<strong>语句 A 可能快到飞起，语句 B 可能慢到想砸键盘</strong> ！</p>
<p>原因就藏在那个小小的百分号里。</p>
<h4 data-id="heading-3">🌰 蒙眼找书现场还原</h4>
<p>假设我们给 title 字段建了索引，就像图书馆按书名首字母排序的分类架。当你执行 LIKE '数据库%' 时，索引会开心地带你直奔 "数" 字区，从 "数据库入门" 找到 "数据库原理"，一气呵成 🚀。</p>
<p>但如果写成 LIKE '%数据库%'，相当于你告诉图书管理员："我要找所有书名里包含'数据库'的书，但我不告诉你它在开头还是结尾"。这时候索引直接懵了 😵，因为它的排序规则是按首字母来的，现在关键词可能出现在任何位置，就像让你在所有书里找 "包含'的'字的书" 一样——索引完全帮不上忙！</p>
<p><strong>全表扫描警告</strong> ⚠️：数据库只能开启"蒙眼摸书"模式，逐行检查每条记录。如果表中有 100 万条数据，就像让你在 100 万本书里一本本翻开找，画面太美我不敢看 🥶。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af55f14a116a4b07925841af1a6aff5d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765814227&amp;x-signature=vbbg0wk6GxgqkD2gRB1WNG7uPFE%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">避坑指南：3 个让索引失效的经典操作</h4>

























<table><thead><tr><th>错误写法 🔴</th><th>正确姿势 🟢</th><th>性能差距</th></tr></thead><tbody><tr><td>LIKE '%关键词%'</td><td>LIKE '关键词%' 或使用全文索引</td><td>可能差 100~1000 倍</td></tr><tr><td>WHERE age + 1 = 25</td><td>WHERE age = 24</td><td>索引直接失效</td></tr><tr><td>WHERE SUBSTR(title, 3) = '数据库'</td><td>WHERE title LIKE '__数据库%'</td><td>函数操作导致索引失效</td></tr></tbody></table>
<h3 data-id="heading-5">B+树索引 vs 哈希索引：新华字典 vs 快递柜</h3>
<p>现在你决定给图书馆装导航系统了，但市场上有两种方案：</p>
<ul>
<li><strong>方案 A</strong> ：像《新华字典》那样的目录 📖（B+树索引）</li>
<li><strong>方案 B</strong> ：像快递柜那样的编号系统 📦（哈希索引）</li>
</ul>
<p>到底选哪个？这得看你平时怎么找书！</p>
<h4 data-id="heading-6">📖 B+树索引：新华字典的智慧</h4>
<p>翻开你的新华字典，会发现它有两种目录：拼音索引和部首索引。B+树索引就像拼音索引，它把数据按顺序排好，并且只在叶子节点存储完整数据，中间节点都是"指路牌"。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    A[根节点] --&gt;|1-100| B[中间节点]
    A --&gt;|101-200| C[中间节点]
    
    B --&gt;|1-50| D[叶子节点: 1,3,5...50]
    B --&gt;|51-100| E[叶子节点: 51,53...100]
    
    C --&gt;|101-150| F[叶子节点: 101...150]
    C --&gt;|151-200| G[叶子节点: 151...200]
    
    D --&gt;|链表指针| E
    E --&gt;|链表指针| F
    F --&gt;|链表指针| G
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c4470d9e5c644a58ad6358b273413f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765814227&amp;x-signature=6fOfWkEI4yZeG6CLAhZfpaK0H9A%3D" alt="image.png" loading="lazy"/>
<strong>适用场景</strong> ：</p>
<ul>
<li>范围查询（比如找 "价格在 10-50 元的书"）📊</li>
<li>排序操作（比如 "按出版日期倒序排列"）🔄</li>
<li>前缀匹配（比如 LIKE '数据库%'）🎯</li>
</ul>
<h4 data-id="heading-7">📦 哈希索引：快递柜的暴力美学</h4>
<p>哈希索引就像快递柜，每个 key 都通过哈希函数计算出一个唯一编号，直接定位到存储位置。比如查询 id=100 的数据，哈希函数算出来是 8 号柜，直接拉开 8 号柜就能找到！</p>
<p><strong>适用场景</strong> ：</p>
<ul>
<li>等值查询（比如 WHERE id=100）⚡</li>
<li>键值对数据库（如 Redis）🚀</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28c5e3b67a8741c4b9d580703ab13f31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765814227&amp;x-signature=Pk%2BnRltKlaxkySqYMv40zm4px7s%3D" alt="image.png" loading="lazy"/></p>
<p><strong>灵魂对比表格</strong> 👇</p>



































<table><thead><tr><th>特性</th><th>B+树索引</th><th>哈希索引</th></tr></thead><tbody><tr><td>查找速度</td><td>O(log n) 稳定</td><td>O(1) 但有哈希冲突风险</td></tr><tr><td>范围查询</td><td>✅ 天生支持</td><td>❌ 完全不支持</td></tr><tr><td>排序</td><td>✅ 叶子节点链表天然有序</td><td>❌ 无序存储</td></tr><tr><td>内存占用</td><td>中等（可存磁盘）</td><td>较高（通常内存存储）</td></tr><tr><td>经典应用</td><td>MySQL InnoDB 主键索引</td><td>Redis、Memcached 键值存储</td></tr></tbody></table>
<p>MySQL InnoDB 聚簇索引：叶子节点里藏着大秘密！</p>
<blockquote>
<p>如果你用 MySQL 的 InnoDB 引擎，那你必须知道这个<strong>惊天大秘密</strong> 💣：</p>
<p>它的主键索引叶子节点直接存着整行数据！就像你查新华字典时，翻到 "数" 字不仅能看到拼音，还能直接把整页字典撕下来带走 📄。</p>
</blockquote>
<h4 data-id="heading-8">聚簇索引 vs 非聚簇索引：冰箱 vs 储物柜</h4>
<ul>
<li><strong>聚簇索引</strong> （主键索引）：就像家里的冰箱 🧊，门（索引）打开直接看到食物（数据），不用再跑一趟。</li>
<li><strong>非聚簇索引</strong> （二级索引）：就像储物柜的标签 🏷️，上面写着"零食在冰箱第三层"，你还得再去冰箱拿。</li>
</ul>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD
    subgraph 聚簇索引 B+树
        A[根节点: 主键范围 1-1000]
        B[中间节点: 1-500]
        C[中间节点: 501-1000]
        D[叶子节点: 1-100, 包含整行数据]
        E[叶子节点: 101-200, 包含整行数据]
    end
    A --&gt; B
    A --&gt; C
    B --&gt; D
    B --&gt; E
    D --&gt; E --&gt; F[...更多叶子节点]
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/160a9dcbc0064816ba3dbe2cb8b65cb7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5peg6ZmQ5aSnNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765814227&amp;x-signature=8G4oOm2f5U2TqZ8aavypp%2FnmZqc%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-9">实战：如何检测索引失效？</h4>
<p>给大家分享一个我压箱底的<strong>索引失效检测 SQL</strong> 🕵️‍♂️，执行它就能知道查询有没有用到索引：</p>
<pre><code class="hljs language-sql" lang="sql">EXPLAIN
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> books
<span class="hljs-keyword">WHERE</span> title <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%数据库%'</span>  <span class="hljs-comment">-- 这个会失效</span>
  <span class="hljs-keyword">AND</span> price <span class="hljs-operator">&gt;</span> <span class="hljs-number">50</span>;           <span class="hljs-comment">-- 这个可能有效</span>
</code></pre>
<p><strong>结果解读</strong> 👇：
-- 重点看 type 列：
-- ✅ ref/range/index：索引有用
-- ❌ ALL：全表扫描，索引失效！</p>
<p><strong>避坑神技</strong> ✨：如果必须用 %关键词% 模糊查询，可以考虑用  <strong>全文索引</strong> ：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 创建全文索引</span>
<span class="hljs-keyword">CREATE</span> FULLTEXT INDEX idx_title_ft <span class="hljs-keyword">ON</span> books(title);

<span class="hljs-comment">-- 高效查询包含关键词的记录</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> books
<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">MATCH</span>(title) AGAINST(<span class="hljs-string">'数据库'</span> <span class="hljs-keyword">IN</span> <span class="hljs-keyword">NATURAL</span> <span class="hljs-keyword">LANGUAGE</span> MODE);
</code></pre>
<hr/>
<blockquote>
<h3 data-id="heading-10">索引设计的三大灵魂拷问</h3>
<ol>
<li><strong>是不是索引越多越好？</strong></li>
</ol>
<p>答：NO！索引像图书馆的分类架，太多了反而难找，而且每次增删改数据都要维护索引，就像每次新书入库都要重新贴标签 贴到崩溃。</p>
<ol start="2">
<li><strong>主键为什么最好是自增 ID？</strong></li>
</ol>
<p>答：InnoDB 聚簇索引如果用随机 ID，会导致叶子节点频繁分裂，就像你整理好的书架忽然插进新书，整个架子都要重排 🗄️。</p>
<ol start="3">
<li><strong>为什么不建议用 UUID 做主键？</strong></li>
</ol>
<p>答：UUID 是随机字符串，索引树会变成"歪脖子树" 🌳，查询效率暴跌！不信你试试给图书馆的书按 UUID 排序？</p>
</blockquote>
<hr/>
<h3 data-id="heading-11">结语：索引不是银弹，但没有索引是真的完蛋</h3>
<p>最后送大家一句我奶奶都能听懂的话：<strong>索引就像给自行车装变速器</strong> 🚲，平时通勤（简单查询）可能感觉不到，但遇到爬坡（复杂查询）时，有没有变速器直接是两个物种！</p>
<p>但记住，没有万能的索引设计，最好的实践是：<strong>用 EXPLAIN 分析 SQL，用监控工具观察慢查询，让数据告诉你答案</strong> 📊。</p>
<p>祝大家都能写出飞一般的 SQL，再也不用对着全表扫描掉头发！💇‍♂️💨</p>
<p>（如果觉得有用，记得点赞收藏哦~ 👇）</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA["讲讲原型链" —— 面试官最爱问的 JavaScript 基础]]></title>    <link>https://juejin.cn/post/7581324171398479918</link>    <guid>https://juejin.cn/post/7581324171398479918</guid>    <pubDate>2025-12-08T14:25:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581324171398479918" data-draft-id="7581292270961754122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="&quot;讲讲原型链&quot; —— 面试官最爱问的 JavaScript 基础"/> <meta itemprop="keywords" content="JavaScript,前端,面试"/> <meta itemprop="datePublished" content="2025-12-08T14:25:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            "讲讲原型链" —— 面试官最爱问的 JavaScript 基础
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:25:25.000Z" title="Mon Dec 08 2025 14:25:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">JavaScript 原型与原型链：从困惑到完全理解</h2>
<p>以前在看 JavaScript 代码的时候，经常会遇到一个问题：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
arr.<span class="hljs-title function_">push</span>(<span class="hljs-number">4</span>);      <span class="hljs-comment">// 4</span>
arr.<span class="hljs-title function_">join</span>(<span class="hljs-string">','</span>);    <span class="hljs-comment">// "1,2,3,4"</span>
arr.<span class="hljs-title function_">toString</span>();   <span class="hljs-comment">// "1,2,3,4"</span>
</code></pre>
<p>我明明只创建了一个数组，为什么它能调用 <code>push</code>、<code>join</code>、<code>toString</code> 这些方法？这些方法是从哪来的？</p>
<p>再看这段代码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">sayHello</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'张三'</span>);
person.<span class="hljs-title function_">sayHello</span>(); <span class="hljs-comment">// "Hello, I'm 张三"</span>
</code></pre>
<p><code>person</code> 对象本身没有 <code>sayHello</code> 方法，但却能调用它。这背后的机制就是原型链。</p>
<hr/>
<h3 data-id="heading-1">先搞清楚几个概念</h3>
<p>在深入之前，先把几个容易混淆的概念理清楚：</p>
<h4 data-id="heading-2"><code>[[Prototype]]</code>、<code>__proto__</code>、<code>prototype</code> 的区别</h4>





























<table><thead><tr><th>概念</th><th>是什么</th><th>属于谁</th><th>作用</th></tr></thead><tbody><tr><td><code>[[Prototype]]</code></td><td>内部属性</td><td>所有对象</td><td>指向对象的原型，隐藏属性</td></tr><tr><td><code>__proto__</code></td><td>访问器属性</td><td>所有对象</td><td>暴露 <code>[[Prototype]]</code>，非标准但广泛支持</td></tr><tr><td><code>prototype</code></td><td>普通属性</td><td>函数</td><td>存放给实例共享的属性和方法</td></tr></tbody></table>
<p>简单说：</p>
<ul>
<li><strong><code>prototype</code></strong> 是<strong>函数</strong>才有的属性，用来存放共享方法</li>
<li><strong><code>__proto__</code></strong> 是<strong>所有对象</strong>都有的属性，指向它的原型对象</li>
<li><strong><code>[[Prototype]]</code></strong> 是 <code>__proto__</code> 的内部实现</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"/>) {}
<span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();

<span class="hljs-comment">// prototype 只有函数才有</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);      <span class="hljs-comment">// {constructor: ƒ}</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);      <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// __proto__ 所有对象都有</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-3">现代写法：Object.getPrototypeOf()</h4>
<p><code>__proto__</code> 虽然好用，但它不是 ECMAScript 标准的一部分，只是各浏览器都实现了。推荐用标准方法：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 获取原型</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">getPrototypeOf</span>(foo) === <span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>  <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 设置原型</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(obj, prototype)

<span class="hljs-comment">// 创建时指定原型</span>
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(prototype)
</code></pre>
<hr/>
<h3 data-id="heading-4">原型是什么</h3>
<p>JavaScript 里每个函数都有一个 <code>prototype</code> 属性，指向一个对象。这个对象叫做<strong>原型对象</strong>，它的作用是让该函数创建的所有实例共享属性和方法。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
}

<span class="hljs-comment">// 方法定义在原型上，所有实例共享</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">start</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> 启动了`</span>);
};

<span class="hljs-keyword">const</span> car1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'丰田'</span>);
<span class="hljs-keyword">const</span> car2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'本田'</span>);

car1.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// 丰田 启动了</span>
car2.<span class="hljs-title function_">start</span>(); <span class="hljs-comment">// 本田 启动了</span>

<span class="hljs-comment">// 两个实例用的是同一个方法</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(car1.<span class="hljs-property">start</span> === car2.<span class="hljs-property">start</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p>这就是原型的核心价值：<strong>方法只需要定义一次，所有实例都能用</strong>。</p>
<p>如果把方法定义在构造函数里，每创建一个实例就会新建一个函数，浪费内存：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 不推荐的写法</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">BadCar</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {  <span class="hljs-comment">// 每个实例都有一份</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> 启动了`</span>);
  };
}

<span class="hljs-keyword">const</span> bad1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadCar</span>(<span class="hljs-string">'丰田'</span>);
<span class="hljs-keyword">const</span> bad2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BadCar</span>(<span class="hljs-string">'本田'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(bad1.<span class="hljs-property">start</span> === bad2.<span class="hljs-property">start</span>); <span class="hljs-comment">// false，两个不同的函数</span>
</code></pre>
<hr/>
<h3 data-id="heading-5">new 关键字到底做了什么</h3>
<p>理解原型链之前，得先搞清楚 <code>new</code> 的工作原理。当你写 <code>new Foo()</code> 时，JavaScript 引擎会执行以下四个步骤：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A['1. 创建空对象']:::step --&gt; B['2. 设置原型链']:::step
    B --&gt; C['3. 执行构造函数']:::step
    C --&gt; D['4. 返回对象']:::success

    classDef step fill:#cce5ff,stroke:#0d6efd,color:#004085
    classDef success fill:#d4edda,stroke:#28a745,color:#155724
</code></pre>
<h4 data-id="heading-6">详细步骤</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hi, I'm <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'John'</span>);
</code></pre>
<p><strong>Step 1：创建一个空对象</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 内部创建：{}</span>
</code></pre>
<p><strong>Step 2：将空对象的 <code>[[Prototype]]</code> 指向构造函数的 <code>prototype</code></strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 内部操作：newObj.__proto__ = Person.prototype</span>
</code></pre>
<p><strong>Step 3：用这个空对象作为 <code>this</code> 执行构造函数</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 内部操作：Person.call(newObj, 'John')</span>
<span class="hljs-comment">// 执行后 newObj 变成 { name: 'John' }</span>
</code></pre>
<p><strong>Step 4：返回对象</strong></p>
<ul>
<li>如果构造函数返回一个对象，就用那个对象</li>
<li>否则返回 Step 1 创建的对象</li>
</ul>
<h4 data-id="heading-7">手写一个 new</h4>
<p>理解了原理，可以自己实现一个：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myNew</span>(<span class="hljs-params">Constructor, ...args</span>) {
  <span class="hljs-comment">// 1. 创建空对象，原型指向构造函数的 prototype</span>
  <span class="hljs-keyword">const</span> obj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Constructor</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);

  <span class="hljs-comment">// 2. 执行构造函数，this 绑定到新对象</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-title class_">Constructor</span>.<span class="hljs-title function_">apply</span>(obj, args);

  <span class="hljs-comment">// 3. 如果构造函数返回对象，就用它；否则用新创建的对象</span>
  <span class="hljs-keyword">return</span> result <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span> ? result : obj;
}

<span class="hljs-comment">// 测试</span>
<span class="hljs-keyword">const</span> p = <span class="hljs-title function_">myNew</span>(<span class="hljs-title class_">Person</span>, <span class="hljs-string">'Alice'</span>);
p.<span class="hljs-title function_">greet</span>(); <span class="hljs-comment">// Hi, I'm Alice</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(p <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Person</span>); <span class="hljs-comment">// true</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">原型链的查找机制</h3>
<p>当访问对象的属性或方法时，JavaScript 会按照这个顺序查找：</p>
<ol>
<li>先在对象自身找</li>
<li>找不到，去对象的原型 (<code>__proto__</code>) 上找</li>
<li>还找不到，继续往上一级原型找</li>
<li>直到 <code>Object.prototype</code>，再往上就是 <code>null</code> 了</li>
</ol>
<p>这条查找链路就是<strong>原型链</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    A["dog 实例&lt;br/&gt;{ name: 'Buddy' }"]:::instance --&gt;|__proto__| B["Dog.prototype&lt;br/&gt;{ bark: ƒ }"]:::proto
    B --&gt;|__proto__| C["Animal.prototype&lt;br/&gt;{ speak: ƒ }"]:::proto
    C --&gt;|__proto__| D["Object.prototype&lt;br/&gt;{ toString: ƒ, ... }"]:::rootProto
    D --&gt;|__proto__| E["null"]:::endNode

    classDef instance fill:#cce5ff,stroke:#0d6efd,color:#004085
    classDef proto fill:#d4edda,stroke:#28a745,color:#155724
    classDef rootProto fill:#fff3cd,stroke:#ffc107,color:#856404
    classDef endNode fill:#f8d7da,stroke:#dc3545,color:#721c24
</code></pre>
<h4 data-id="heading-9">代码示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Animal</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">speak</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a sound`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Dog</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, name);
}

<span class="hljs-comment">// 建立原型链：Dog.prototype -&gt; Animal.prototype</span>
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Dog</span>;

<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">bark</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Woof!'</span>);
};

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>);

<span class="hljs-comment">// 查找过程：</span>
dog.<span class="hljs-property">name</span>;    <span class="hljs-comment">// 在 dog 自身找到</span>
dog.<span class="hljs-title function_">bark</span>();  <span class="hljs-comment">// 在 Dog.prototype 找到</span>
dog.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// 在 Animal.prototype 找到</span>
dog.<span class="hljs-title function_">toString</span>(); <span class="hljs-comment">// 在 Object.prototype 找到</span>
</code></pre>
<p>用代码验证这条链：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);                 <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);    <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-literal">null</span>);             <span class="hljs-comment">// true</span>
</code></pre>
<p>这就解释了开头的问题。数组能调用 <code>push</code>、<code>join</code>，是因为这些方法定义在 <code>Array.prototype</code> 上。能调用 <code>toString</code>，是因为顺着原型链能找到 <code>Object.prototype.toString</code>（虽然 Array 重写了这个方法）。</p>
<hr/>
<h3 data-id="heading-10">完整的原型链图谱</h3>
<p>JavaScript 的原型链比想象中更复杂，函数本身也是对象，也有自己的原型链：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph IL[实例层]
        foo["foo 实例"]:::instance
    end

    subgraph PL[原型层]
        FooP["Foo.prototype"]:::proto
        ObjP["Object.prototype"]:::rootProto
    end

    subgraph FL[函数层]
        Foo["Foo 函数"]:::func
        Obj["Object 函数"]:::func
        Func["Function 函数"]:::func
    end

    subgraph FPL[函数原型层]
        FuncP["Function.prototype"]:::funcProto
    end

    foo --&gt;|__proto__| FooP
    FooP --&gt;|__proto__| ObjP
    ObjP --&gt;|__proto__| NULL["null"]:::endNode

    Foo --&gt;|prototype| FooP
    Foo --&gt;|__proto__| FuncP

    Obj --&gt;|prototype| ObjP
    Obj --&gt;|__proto__| FuncP

    Func --&gt;|prototype| FuncP
    Func --&gt;|__proto__| FuncP

    FuncP --&gt;|__proto__| ObjP

    classDef instance fill:#cce5ff,stroke:#0d6efd,color:#004085
    classDef proto fill:#d4edda,stroke:#28a745,color:#155724
    classDef rootProto fill:#fff3cd,stroke:#ffc107,color:#856404
    classDef func fill:#e2d9f3,stroke:#6f42c1,color:#432874
    classDef funcProto fill:#fce4ec,stroke:#e91e63,color:#880e4f
    classDef endNode fill:#f8d7da,stroke:#dc3545,color:#721c24

    style IL fill:#e8f4fc,stroke:#0d6efd
    style PL fill:#e8f5e9,stroke:#28a745
    style FL fill:#f3e5f5,stroke:#6f42c1
    style FPL fill:#fce4ec,stroke:#e91e63
</code></pre>
<h4 data-id="heading-11">几个关键点</h4>
<p><strong>1. 所有函数都是 Function 的实例</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Foo</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);    <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true（自己创建自己）</span>
</code></pre>
<p><strong>2. Function.prototype 也是对象，它的原型是 Object.prototype</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
<p><strong>3. Object.prototype 是原型链的终点</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-literal">null</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p><strong>4. 一个有趣的循环</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Object 是函数，所以它的 __proto__ 是 Function.prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// Function.prototype 是对象，所以它的 __proto__ 是 Object.prototype</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 这形成了一个有趣的"鸡生蛋蛋生鸡"的关系</span>
</code></pre>
<hr/>
<h3 data-id="heading-12">属性遮蔽（Property Shadowing）</h3>
<p>如果对象自身和原型上有同名属性，会发生什么？</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Person</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Default'</span>;
<span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">greet</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`Hello, <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>);
};

<span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'John'</span>);

<span class="hljs-comment">// 自身属性遮蔽原型属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'John'，不是 'Default'</span>

<span class="hljs-comment">// 删除自身属性后，原型属性就露出来了</span>
<span class="hljs-keyword">delete</span> john.<span class="hljs-property">name</span>;
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-property">name</span>); <span class="hljs-comment">// 'Default'</span>
</code></pre>
<p>这就是<strong>属性遮蔽</strong>：自身属性会"遮住"原型链上的同名属性。</p>
<h4 data-id="heading-13">检查属性来源</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> john = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'John'</span>);

<span class="hljs-comment">// hasOwnProperty 只检查自身属性</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'name'</span>));  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(john.<span class="hljs-title function_">hasOwnProperty</span>(<span class="hljs-string">'greet'</span>)); <span class="hljs-comment">// false</span>

<span class="hljs-comment">// in 操作符检查整个原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'name'</span> <span class="hljs-keyword">in</span> john);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'greet'</span> <span class="hljs-keyword">in</span> john); <span class="hljs-comment">// true</span>
</code></pre>
<hr/>
<h3 data-id="heading-14">实现继承</h3>
<p>理解了原型链，继承就好办了。核心就两步：</p>
<ol>
<li>调用父构造函数，继承实例属性</li>
<li>设置原型链，继承原型方法</li>
</ol>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Vehicle</span>(<span class="hljs-params">type</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = type;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">speed</span> = <span class="hljs-number">0</span>;
}

<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">accelerate</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">amount</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">speed</span> += amount;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.type}</span> 加速到 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.speed}</span> km/h`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">Car</span>(<span class="hljs-params">brand</span>) {
  <span class="hljs-title class_">Vehicle</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'汽车'</span>);  <span class="hljs-comment">// 继承实例属性</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">brand</span> = brand;
}

<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);  <span class="hljs-comment">// 继承原型方法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">constructor</span> = <span class="hljs-title class_">Car</span>;

<span class="hljs-comment">// 添加子类特有的方法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">honk</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.brand}</span> 鸣笛`</span>);
};

<span class="hljs-comment">// 重写父类方法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">accelerate</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">amount</span>) {
  <span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">accelerate</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">this</span>, amount);
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">speed</span> &gt; <span class="hljs-number">120</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'超速警告'</span>);
  }
};

<span class="hljs-keyword">const</span> myCar = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Car</span>(<span class="hljs-string">'丰田'</span>);
myCar.<span class="hljs-title function_">accelerate</span>(<span class="hljs-number">50</span>);   <span class="hljs-comment">// 汽车 加速到 50 km/h</span>
myCar.<span class="hljs-title function_">accelerate</span>(<span class="hljs-number">80</span>);   <span class="hljs-comment">// 汽车 加速到 130 km/h</span>
                        <span class="hljs-comment">// 超速警告</span>
myCar.<span class="hljs-title function_">honk</span>();           <span class="hljs-comment">// 丰田 鸣笛</span>
</code></pre>
<h4 data-id="heading-15">为什么用 Object.create() 而不是直接赋值</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 错误写法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>;
<span class="hljs-comment">// 问题：修改 Car.prototype 会影响 Vehicle.prototype</span>

<span class="hljs-comment">// 错误写法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vehicle</span>();
<span class="hljs-comment">// 问题：会执行 Vehicle 构造函数，可能有副作用</span>

<span class="hljs-comment">// 正确写法</span>
<span class="hljs-title class_">Car</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-title class_">Vehicle</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>);
<span class="hljs-comment">// 创建一个新对象，原型指向 Vehicle.prototype</span>
</code></pre>
<hr/>
<h3 data-id="heading-16">ES6 的 class 语法</h3>
<p>ES6 引入了 <code>class</code> 关键字，写起来更清爽：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  }

  <span class="hljs-title function_">speak</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span> makes a sound`</span>);
  }
}

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Animal</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name, breed</span>) {
    <span class="hljs-variable language_">super</span>(name);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">breed</span> = breed;
  }

  <span class="hljs-title function_">bark</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Woof!'</span>);
  }
}

<span class="hljs-keyword">const</span> dog = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-string">'Buddy'</span>, <span class="hljs-string">'Labrador'</span>);
dog.<span class="hljs-title function_">speak</span>(); <span class="hljs-comment">// Buddy makes a sound</span>
dog.<span class="hljs-title function_">bark</span>();  <span class="hljs-comment">// Woof!</span>
</code></pre>
<p>但要清楚，<code>class</code> 只是语法糖，底层还是原型链那套：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">Dog</span>); <span class="hljs-comment">// "function"</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(dog.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Dog</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">__proto__</span> === <span class="hljs-title class_">Animal</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>); <span class="hljs-comment">// true</span>
</code></pre>
<h4 data-id="heading-17">class 的一些特性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Example</span> {
  <span class="hljs-comment">// 实例属性（ES2022+）</span>
  instanceProp = <span class="hljs-string">'instance'</span>;

  <span class="hljs-comment">// 私有属性（ES2022+）</span>
  #privateProp = <span class="hljs-string">'private'</span>;

  <span class="hljs-comment">// 静态属性</span>
  <span class="hljs-keyword">static</span> staticProp = <span class="hljs-string">'static'</span>;

  <span class="hljs-comment">// 静态方法</span>
  <span class="hljs-keyword">static</span> <span class="hljs-title function_">staticMethod</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'static method'</span>;
  }

  <span class="hljs-comment">// getter/setter</span>
  <span class="hljs-keyword">get</span> <span class="hljs-title function_">value</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.#privateProp;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-18">几个容易踩的坑</h3>
<h4 data-id="heading-19">1. 引用类型放原型上会共享</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
}

<span class="hljs-title class_">Student</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">hobbies</span> = [];  <span class="hljs-comment">// 所有实例共享这个数组</span>

<span class="hljs-keyword">const</span> s1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">'张三'</span>);
<span class="hljs-keyword">const</span> s2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">'李四'</span>);

s1.<span class="hljs-property">hobbies</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'reading'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(s2.<span class="hljs-property">hobbies</span>); <span class="hljs-comment">// ['reading']  // s2 也有了，出问题了</span>
</code></pre>
<p>引用类型（数组、对象）应该放在构造函数里：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Student</span>(<span class="hljs-params">name</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">hobbies</span> = [];  <span class="hljs-comment">// 每个实例独立</span>
}
</code></pre>
<h4 data-id="heading-20">2. 别直接替换 prototype 对象</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Foo</span>(<span class="hljs-params"/>) {}

<span class="hljs-comment">// 直接替换 prototype 会丢失 constructor</span>
<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
  <span class="hljs-attr">method</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
};

<span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>();
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(foo.<span class="hljs-property">constructor</span> === <span class="hljs-title class_">Foo</span>); <span class="hljs-comment">// false，变成 Object 了</span>
</code></pre>
<p>要么记得补上 constructor，要么用属性添加的方式：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 方式一：补上 constructor</span>
<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span> = {
  <span class="hljs-attr">constructor</span>: <span class="hljs-title class_">Foo</span>,
  <span class="hljs-attr">method</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {}
};

<span class="hljs-comment">// 方式二：直接添加属性（推荐）</span>
<span class="hljs-title class_">Foo</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">method</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {};
</code></pre>
<h4 data-id="heading-21">3. 箭头函数不能用作构造函数</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title function_">Foo</span> = (<span class="hljs-params"/>) =&gt; {};
<span class="hljs-keyword">const</span> foo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Foo</span>(); <span class="hljs-comment">// TypeError: Foo is not a constructor</span>
</code></pre>
<p>箭头函数没有 <code>prototype</code> 属性，也没有自己的 <code>this</code>，所以不能用 <code>new</code>。</p>
<h4 data-id="heading-22">4. instanceof 的局限性</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// instanceof 检查的是原型链</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Array</span>);  <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>([] <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Object</span>); <span class="hljs-comment">// true</span>

<span class="hljs-comment">// 跨 iframe/realm 时会失效</span>
<span class="hljs-comment">// iframe 里的 Array 和主页面的 Array 不是同一个</span>
</code></pre>
<p>更可靠的类型检查：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>([]);  <span class="hljs-comment">// "[object Array]"</span>
<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>([]);  <span class="hljs-comment">// true</span>
</code></pre>
<hr/>
<h3 data-id="heading-23">性能考虑</h3>
<h4 data-id="heading-24">原型链查找有开销</h4>
<p>属性查找会沿着原型链向上，链越长开销越大。虽然现代引擎有优化，但还是要注意：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 如果频繁访问原型链上的属性，可以缓存</span>
<span class="hljs-keyword">const</span> method = obj.<span class="hljs-property">someMethod</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000000</span>; i++) {
  method.<span class="hljs-title function_">call</span>(obj);  <span class="hljs-comment">// 比 obj.someMethod() 快</span>
}
</code></pre>
<h4 data-id="heading-25">Object.create(null) 创建纯净对象</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 普通对象会继承 Object.prototype</span>
<span class="hljs-keyword">const</span> obj = {};
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(obj.<span class="hljs-property">toString</span>); <span class="hljs-comment">// ƒ toString() { [native code] }</span>

<span class="hljs-comment">// 纯净对象没有原型链</span>
<span class="hljs-keyword">const</span> pureObj = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(pureObj.<span class="hljs-property">toString</span>); <span class="hljs-comment">// undefined</span>

<span class="hljs-comment">// 适合用作字典/哈希表，不用担心键名冲突</span>
<span class="hljs-keyword">const</span> dict = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
dict[<span class="hljs-string">'hasOwnProperty'</span>] = <span class="hljs-string">'safe'</span>;  <span class="hljs-comment">// 不会覆盖原型方法</span>
</code></pre>
<hr/>
<h3 data-id="heading-26">小结</h3>
<p>原型链说穿了就是一条查找链：找属性时从对象自身开始，顺着 <code>__proto__</code> 一路往上找，直到 <code>null</code>。</p>
<p>几个要点：</p>
<ul>
<li><code>prototype</code> 是函数的属性，用于存放共享的方法</li>
<li><code>__proto__</code>（或 <code>[[Prototype]]</code>）是对象的属性，指向它的原型</li>
<li>推荐用 <code>Object.getPrototypeOf()</code> 代替 <code>__proto__</code></li>
<li><code>new</code> 关键字做了四件事：创建对象、设置原型、执行构造函数、返回对象</li>
<li>方法定义在原型上，省内存</li>
<li><code>class</code> 是语法糖，底层还是原型链</li>
<li><code>Object.prototype</code> 是原型链的终点，它的 <code>__proto__</code> 是 <code>null</code></li>
</ul>
<p>理解了这个机制，再看 JavaScript 的面向对象就清晰多了。框架源码里大量使用原型链，比如 Vue 2 的响应式系统、各种插件的 mixin 实现，都是基于这套机制。</p>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul>
<hr/>
<h3 data-id="heading-27">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FGuide%2FInheritance_and_the_prototype_chain" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain" ref="nofollow noopener noreferrer">MDN - Inheritance and the prototype chain</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FLearn_web_development%2FExtensions%2FAdvanced_JavaScript_objects%2FObject_prototypes" target="_blank" title="https://developer.mozilla.org/en-US/docs/Learn_web_development/Extensions/Advanced_JavaScript_objects/Object_prototypes" ref="nofollow noopener noreferrer">MDN - Object prototypes</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FOperators%2Fnew" target="_blank" title="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/new" ref="nofollow noopener noreferrer">MDN - new operator</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fjavascript.info%2Fprototype-inheritance" target="_blank" title="https://javascript.info/prototype-inheritance" ref="nofollow noopener noreferrer">JavaScript.info - Prototypal inheritance</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 年 TC39 都在忙什么？Import Bytes、Iterator Chunking 来了]]></title>    <link>https://juejin.cn/post/7581306080435322931</link>    <guid>https://juejin.cn/post/7581306080435322931</guid>    <pubDate>2025-12-08T14:27:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080435322931" data-draft-id="7581359420391800859" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 年 TC39 都在忙什么？Import Bytes、Iterator Chunking 来了"/> <meta itemprop="keywords" content="JavaScript,前端,面试"/> <meta itemprop="datePublished" content="2025-12-08T14:27:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 年 TC39 都在忙什么？Import Bytes、Iterator Chunking 来了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:27:59.000Z" title="Mon Dec 08 2025 14:27:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TC39 2025：Import Bytes、Iterator Chunking 和那些即将落地的新特性</h2>
<p>写跨平台的 JS 代码时，读个二进制文件都得写三套逻辑：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 浏览器</span>
<span class="hljs-keyword">const</span> bytes = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'./photo.png'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">r</span> =&gt;</span> r.<span class="hljs-title function_">arrayBuffer</span>());

<span class="hljs-comment">// Node.js</span>
<span class="hljs-keyword">const</span> bytes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>).<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'./photo.png'</span>);

<span class="hljs-comment">// Deno</span>
<span class="hljs-keyword">const</span> bytes = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Deno</span>.<span class="hljs-title function_">readFile</span>(<span class="hljs-string">'./photo.png'</span>);
</code></pre>
<p>同样的需求，三种写法。想写个同构的图片处理库？先把这三套 API 适配一遍再说。</p>
<p>好消息是，TC39 在 2025 年推进了好几个提案来解决这类问题。这篇文章聊聊其中最值得关注的几个：Import Bytes、Iterator Chunking，以及今年已经进入 Stage 4 的新特性。</p>
<h3 data-id="heading-1">Import Bytes：一行代码搞定二进制导入</h3>
<h4 data-id="heading-2">现在是什么状态</h4>
<p><strong>Stage 2.7</strong>（截至 2025 年 9 月），离正式标准就差临门一脚了。提案负责人是 Steven Salat，Guy Bedford 是共同作者。</p>
<h4 data-id="heading-3">核心语法</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> bytes <span class="hljs-keyword">from</span> <span class="hljs-string">"./photo.png"</span> <span class="hljs-keyword">with</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">"bytes"</span> };
<span class="hljs-comment">// bytes 是 Uint8Array，底层是不可变的 ArrayBuffer</span>
</code></pre>
<p>动态导入也支持：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> bytes = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"./photo.png"</span>, { <span class="hljs-attr">with</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">"bytes"</span> } });
</code></pre>
<p>就这么简单。不管你在浏览器、Node.js 还是 Deno，同一行代码，同样的结果。</p>
<h4 data-id="heading-4">为什么返回 Uint8Array 而不是 ArrayBuffer</h4>
<p>提案选择返回 <code>Uint8Array</code> 而不是裸的 <code>ArrayBuffer</code>，理由挺实在的：</p>
<ol>
<li><strong>少一步操作</strong> - 拿到 ArrayBuffer 你还得自己创建 TypedView，Uint8Array 直接就能用</li>
<li><strong>跟现有 API 保持一致</strong> - <code>Response.bytes()</code> 和 <code>Blob.bytes()</code> 都返回 Uint8Array</li>
<li><strong>Node.js Buffer 兼容</strong> - Buffer 本身就是 Uint8Array 的子类</li>
</ol>
<h4 data-id="heading-5">为什么底层是不可变的 ArrayBuffer</h4>
<p>这个设计决定挺有意思的。底层 ArrayBuffer 被设计成不可变的，原因有三：</p>
<ol>
<li><strong>避免共享可变状态</strong> - 多个模块导入同一个文件，拿到的是同一个对象。如果可变，一个模块改了数据，其他模块全受影响</li>
<li><strong>嵌入式场景</strong> - 不可变数据可以直接放 ROM 里</li>
<li><strong>安全性考虑</strong> - 防止模块间通过共享 buffer 建立隐蔽通信通道</li>
</ol>
<h4 data-id="heading-6">实际能干什么</h4>
<p><strong>图片处理</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> imageBytes <span class="hljs-keyword">from</span> <span class="hljs-string">"./logo.png"</span> <span class="hljs-keyword">with</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">"bytes"</span> };
<span class="hljs-comment">// 用 satori 之类的同构库处理</span>
<span class="hljs-title function_">processImage</span>(imageBytes);
</code></pre>
<p><strong>加载字体</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> fontBytes <span class="hljs-keyword">from</span> <span class="hljs-string">"./custom.woff"</span> <span class="hljs-keyword">with</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">"bytes"</span> };
<span class="hljs-comment">// Canvas 或 PDF 生成时用</span>
<span class="hljs-title function_">registerFont</span>(fontBytes);
</code></pre>
<p><strong>机器学习模型</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> modelBytes <span class="hljs-keyword">from</span> <span class="hljs-string">"./model.bin"</span> <span class="hljs-keyword">with</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">"bytes"</span> };
<span class="hljs-title function_">loadModel</span>(modelBytes);
</code></pre>
<h4 data-id="heading-7">工具链支持</h4>
<p>好消息是，主流工具已经在跟进了。Deno 2.4、Bun 1.1.7 都有类似实现，Webpack、esbuild、Parcel 也支持类似的二进制导入机制。等提案正式落地，统一语法只是时间问题。</p>
<h3 data-id="heading-8">Iterator Chunking：迭代器分块终于有原生方案了</h3>
<h4 data-id="heading-9">现在是什么状态</h4>
<p><strong>Stage 2.7</strong>（截至 2025 年 9 月），由 Michael Ficarra 主导。</p>
<h4 data-id="heading-10">两个核心方法</h4>
<p><strong>chunks(size) - 非重叠分块</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>].<span class="hljs-title function_">values</span>();
<span class="hljs-keyword">const</span> chunked = numbers.<span class="hljs-title function_">chunks</span>(<span class="hljs-number">3</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> chunked) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(chunk);
}
<span class="hljs-comment">// [1, 2, 3]</span>
<span class="hljs-comment">// [4, 5, 6]</span>
<span class="hljs-comment">// [7]</span>
</code></pre>
<p><strong>windows(size) - 滑动窗口</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_">values</span>();
<span class="hljs-keyword">const</span> windowed = numbers.<span class="hljs-title function_">windows</span>(<span class="hljs-number">2</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-variable language_">window</span> <span class="hljs-keyword">of</span> windowed) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>);
}
<span class="hljs-comment">// [1, 2]</span>
<span class="hljs-comment">// [2, 3]</span>
<span class="hljs-comment">// [3, 4]</span>
</code></pre>
<p>区别很直观：chunks 是切成一块一块互不重叠，windows 是滑动窗口每次移动一格。</p>
<h4 data-id="heading-11">解决什么问题</h4>
<p>以前想做分块操作，要么自己写，要么引入 lodash：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// lodash 方案</span>
<span class="hljs-keyword">import</span> chunk <span class="hljs-keyword">from</span> <span class="hljs-string">'lodash/chunk'</span>;
<span class="hljs-keyword">const</span> chunks = <span class="hljs-title function_">chunk</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>], <span class="hljs-number">2</span>);

<span class="hljs-comment">// 原生方案</span>
<span class="hljs-keyword">const</span> chunks = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>].<span class="hljs-title function_">values</span>().<span class="hljs-title function_">chunks</span>(<span class="hljs-number">2</span>);
</code></pre>
<p>原生方案的优势：</p>
<ul>
<li>不用装依赖</li>
<li>惰性求值，内存友好</li>
<li>跟整个迭代器生态无缝衔接</li>
<li>支持异步迭代器</li>
</ul>
<h4 data-id="heading-12">实际场景</h4>
<p><strong>批量 API 请求</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">batchProcess</span>(<span class="hljs-params">items</span>) {
  <span class="hljs-keyword">const</span> batches = items.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">chunks</span>(<span class="hljs-number">50</span>);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> batch <span class="hljs-keyword">of</span> batches) {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(batch.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> api.<span class="hljs-title function_">process</span>(item)));
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">sleep</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 避免触发限流</span>
  }
}
</code></pre>
<p><strong>移动平均计算</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">movingAverage</span>(<span class="hljs-params">numbers, windowSize</span>) {
  <span class="hljs-keyword">return</span> numbers
    .<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">windows</span>(windowSize)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">w</span> =&gt;</span> w.<span class="hljs-title function_">reduce</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a + b) / windowSize)
    .<span class="hljs-title function_">toArray</span>();
}

<span class="hljs-keyword">const</span> prices = [<span class="hljs-number">100</span>, <span class="hljs-number">102</span>, <span class="hljs-number">98</span>, <span class="hljs-number">105</span>, <span class="hljs-number">103</span>, <span class="hljs-number">107</span>];
<span class="hljs-keyword">const</span> ma3 = <span class="hljs-title function_">movingAverage</span>(prices, <span class="hljs-number">3</span>);
<span class="hljs-comment">// 3日移动平均</span>
</code></pre>
<p><strong>N-gram 生成</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">generateNGrams</span>(<span class="hljs-params">text, n</span>) {
  <span class="hljs-keyword">const</span> words = text.<span class="hljs-title function_">split</span>(<span class="hljs-string">' '</span>);
  <span class="hljs-keyword">return</span> words.<span class="hljs-title function_">values</span>()
    .<span class="hljs-title function_">windows</span>(n)
    .<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">w</span> =&gt;</span> w.<span class="hljs-title function_">join</span>(<span class="hljs-string">' '</span>))
    .<span class="hljs-title function_">toArray</span>();
}

<span class="hljs-keyword">const</span> bigrams = <span class="hljs-title function_">generateNGrams</span>(<span class="hljs-string">"The quick brown fox"</span>, <span class="hljs-number">2</span>);
<span class="hljs-comment">// ["The quick", "quick brown", "brown fox"]</span>
</code></pre>
<h4 data-id="heading-13">边界情况的讨论</h4>
<p>这个提案在推进过程中遇到了一个有意思的问题：<strong>如果迭代器元素少于窗口大小，windows() 应该返回什么？</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> small = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>].<span class="hljs-title function_">values</span>();
<span class="hljs-keyword">const</span> result = small.<span class="hljs-title function_">windows</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 只有2个元素，请求3个的窗口</span>

<span class="hljs-comment">// 选项1：不返回任何窗口</span>
<span class="hljs-comment">// 选项2：返回 [1, 2] 作为不完整窗口</span>
</code></pre>
<p>委员会讨论后认为两种场景都有合理的使用需求，所以决定把 <code>windows()</code> 拆分成多个方法来分别处理这两种情况。这也是提案从 Stage 2 到 Stage 2.7 花了点时间的原因。</p>
<h3 data-id="heading-14">2025 年进入 Stage 4 的特性</h3>
<p>除了上面两个还在推进的提案，2025 年还有好几个特性已经正式"毕业"了：</p>
<h4 data-id="heading-15">RegExp.escape（2 月）</h4>
<p>安全转义正则表达式字符串，防止注入：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> userInput = <span class="hljs-string">"user@example.com (admin)"</span>;
<span class="hljs-keyword">const</span> safePattern = <span class="hljs-title class_">RegExp</span>.<span class="hljs-built_in">escape</span>(userInput);
<span class="hljs-keyword">const</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(safePattern);
<span class="hljs-comment">// 不用担心括号被解析成分组了</span>
</code></pre>
<p>这个需求太常见了，以前都得自己写转义函数或者用第三方库。</p>
<h4 data-id="heading-16">Float16Array（2 月）</h4>
<p>半精度浮点数的 TypedArray：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> f16Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float16Array</span>([<span class="hljs-number">1.5</span>, <span class="hljs-number">2.7</span>, <span class="hljs-number">3.1</span>]);
</code></pre>
<p>主要面向机器学习和图形处理场景。模型权重经常用 fp16 存储，有了原生支持就不用自己做转换了。</p>
<h4 data-id="heading-17">Error.isError（5 月）</h4>
<p>可靠地判断一个值是不是 Error：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (<span class="hljs-title class_">Error</span>.<span class="hljs-title function_">isError</span>(value)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(value.<span class="hljs-property">message</span>);
}
</code></pre>
<p>为什么不用 <code>instanceof Error</code>？因为跨 realm（比如 iframe 或 Node.js 的 vm 模块）的 Error 实例会被判成 false。这个方法解决了这个历史问题。</p>
<h4 data-id="heading-18">Math.sumPrecise（7 月）</h4>
<p>高精度求和：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> sum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sumPrecise</span>([<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>]);
<span class="hljs-comment">// 比普通累加更精确，减少浮点误差累积</span>
</code></pre>
<p>做金融计算或科学计算的应该会喜欢这个。</p>
<h4 data-id="heading-19">Uint8Array Base64 编解码（7 月）</h4>
<p>原生的 Base64 编解码：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> bytes = <span class="hljs-title class_">Uint8Array</span>.<span class="hljs-title function_">fromBase64</span>(<span class="hljs-string">'SGVsbG8='</span>);
<span class="hljs-keyword">const</span> base64 = bytes.<span class="hljs-title function_">toBase64</span>();
<span class="hljs-comment">// 还有 fromHex() 和 toHex()</span>
</code></pre>
<p>终于不用为了 Base64 转换去找第三方库了。</p>
<h4 data-id="heading-20">Explicit Resource Management（已 Stage 4）</h4>
<p><code>using</code> 关键字，自动资源清理：</p>
<pre><code class="hljs language-javascript" lang="javascript">using file = <span class="hljs-keyword">await</span> <span class="hljs-title function_">openFile</span>(<span class="hljs-string">'data.txt'</span>);
<span class="hljs-comment">// 离开作用域自动关闭，不用手动 finally</span>
</code></pre>
<p>借鉴了 Python 的 with 和 C# 的 using，解决了 JS 里资源管理一直很混乱的问题。</p>
<h3 data-id="heading-21">还有几个值得关注的 Stage 2 提案</h3>
<h4 data-id="heading-22">Seeded PRNG（5 月进入 Stage 2）</h4>
<p>可种子化的随机数生成器：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> random = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>(<span class="hljs-number">12345</span>); <span class="hljs-comment">// 种子</span>
<span class="hljs-keyword">const</span> value = random.<span class="hljs-title function_">next</span>();
<span class="hljs-comment">// 同样的种子，同样的序列</span>
</code></pre>
<p>游戏开发、测试、仿真这些场景经常需要可重现的随机序列。</p>
<h4 data-id="heading-23">Error Stack Accessor（5 月进入 Stage 2）</h4>
<p>标准化错误堆栈的访问方式。现在各个引擎的 <code>error.stack</code> 格式都不一样，这个提案要统一它。</p>
<h3 data-id="heading-24">提案流程简单回顾</h3>
<p>TC39 的提案分 5 个阶段：</p>
<ul>
<li><strong>Stage 0</strong>：想法</li>
<li><strong>Stage 1</strong>：正式提案，开始讨论</li>
<li><strong>Stage 2</strong>：规范草案，API 基本稳定</li>
<li><strong>Stage 2.7</strong>：规范文本接近完成，准备写测试</li>
<li><strong>Stage 3</strong>：等待实现反馈</li>
<li><strong>Stage 4</strong>：正式纳入标准</li>
</ul>
<p>Import Bytes 和 Iterator Chunking 都到了 Stage 2.7，离 Stage 3 就差 test262 测试和浏览器实现承诺了。</p>
<h3 data-id="heading-25">总结</h3>
<p>2025 年 TC39 的进展还是挺给力的：</p>
<ul>
<li><strong>Import Bytes</strong> 解决了跨平台二进制导入的老大难问题，同构库开发终于能省心了</li>
<li><strong>Iterator Chunking</strong> 补上了迭代器工具链的空白，chunks 和 windows 覆盖了大部分分块场景</li>
<li><strong>一堆特性进入 Stage 4</strong>：RegExp.escape、Float16Array、Math.sumPrecise、Base64 编解码、资源管理...</li>
</ul>
<p>这些特性有的已经可以通过 Babel 或 TypeScript 提前尝鲜了。如果你在用 Deno 或 Bun，Import Bytes 类似的功能现在就能用。</p>
<hr/>
<p><strong>顺手安利几个我的开源项目：</strong></p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul>
<hr/>
<h3 data-id="heading-26">参考链接</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftc39%2Fproposals" target="_blank" title="https://github.com/tc39/proposals" ref="nofollow noopener noreferrer">TC39 Proposals Repository</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftc39%2Fproposal-import-bytes" target="_blank" title="https://github.com/tc39/proposal-import-bytes" ref="nofollow noopener noreferrer">Import Bytes Proposal</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftc39.es%2Fproposal-iterator-chunking%2F" target="_blank" title="https://tc39.es/proposal-iterator-chunking/" ref="nofollow noopener noreferrer">Iterator Chunking Specification</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblogs.igalia.com%2Fcompilers%2F2025%2F03%2F27%2Fsummary-of-the-february-2025-tc39-plenary%2F" target="_blank" title="https://blogs.igalia.com/compilers/2025/03/27/summary-of-the-february-2025-tc39-plenary/" ref="nofollow noopener noreferrer">February 2025 TC39 Meeting Summary</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblogs.igalia.com%2Fcompilers%2F2025%2F07%2F03%2Fsummary-of-the-may-2025-tc39-plenary%2F" target="_blank" title="https://blogs.igalia.com/compilers/2025/07/03/summary-of-the-may-2025-tc39-plenary/" ref="nofollow noopener noreferrer">May 2025 TC39 Meeting Summary</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infoq.com%2Fnews%2F2025%2F06%2Ftc39-stage-4-2025%2F" target="_blank" title="https://www.infoq.com/news/2025/06/tc39-stage-4-2025/" ref="nofollow noopener noreferrer">TC39 Stage 4 Proposals 2025</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[超全Nano Banana Pro 提示词案例库来啦，小白也能轻松上手]]></title>    <link>https://juejin.cn/post/7581348660823638016</link>    <guid>https://juejin.cn/post/7581348660823638016</guid>    <pubDate>2025-12-08T14:53:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581348660823638016" data-draft-id="7581299982671675426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="超全Nano Banana Pro 提示词案例库来啦，小白也能轻松上手"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-08T14:53:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苍何"/> <meta itemprop="url" content="https://juejin.cn/user/588993963763405"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            超全Nano Banana Pro 提示词案例库来啦，小白也能轻松上手
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/588993963763405/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苍何
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T14:53:39.000Z" title="Mon Dec 08 2025 14:53:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是苍何的第 454 篇原创！</p>
<p>大家好，我是在珠海玩 Nano Banana Pro 的苍何。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df1d3429c12b43a1a37f7b8f68d1470d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=swjgWtC%2FlXEOlAs6G1SMskMf%2FPI%3D" alt="图片" loading="lazy"/></p>
<p>笑死，我真是疯了。</p>
<p>花了些时间，整理了 Nano Banana Pro 的超多玩法及提示词。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/028acaa9c5a94954915dd8d5d2e52c20~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=vA6NxxQRZVYJp%2FU4d8%2BYFrEZBfk%3D" alt="图片" loading="lazy"/></p>
<p>我也录了个视频，大家可以浅浅感受一下。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e86cbc62f54185822e10cd276bc181~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=7aIhop0cKjSd3gk4UV%2F278v6sHs%3D" alt="wxv_4271684942264188930" loading="lazy"/></p>
<blockquote>
<p>❝</p>
<p>ps:我把这个开源文档放在评论区了，提示词可以直接复制，也欢迎给🐶b苍何点个发财的赞，跪了。</p>
<p>❞</p>
</blockquote>
<p>玩着玩着又发现了不少有意思的，我认为比较骚的玩法，所以今天这篇文章来做个分享。</p>
<p>先说下，我依旧是在我们老朋友 Lovart 上玩的（别浪费了我尊贵的年会员身份🐶），配合无限画布，以及新出的 Touch-edit 模式，可控改图，指哪打哪，不要太爽。</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.lovart.ai" target="_blank" title="https://www.lovart.ai" ref="nofollow noopener noreferrer">www.lovart.ai</a></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/192bc7e0faa64a3b96fcafc56e0fd365~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=1SGYfR8QrTQuxzlS4y4OpTtTd0Y%3D" alt="图片" loading="lazy"/></p>
<p>废话不多说，我们来看俺 Nano Banana Pro 一些有意思的玩法。</p>
<h2 data-id="heading-0">人物细节拆解</h2>
<p>要说这2天最火的，还得是我神佬的这个细节拆解图，在 X 上一度疯传。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a5701dc806ea440d92d957eb3243b18f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=7yjRrY8MsVhXNmVTBOwGZKj%2BBog%3D" alt="图片" loading="lazy"/></p>
<p>我不知道为啥火，单纯觉得挺有意思，在神佬的基础上稍加改动，看我出的图。</p>
<p>这个是原图，也是 Nano Banana Pro 画的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a763c32bb7af458aab19ddf97de88a8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=jatJ4cDCoUbyFQnaYVE2L%2FkJ7fg%3D" alt="图片" loading="lazy"/></p>
<p>提示词是这样的：</p>
<pre><code class="hljs language-makefile" lang="makefile">一张高质量的女性角色立绘，精致的韩漫厚涂风格。画面中是一位干练自信的职场御姐，她有着深棕色的大波浪长卷发，留着空气刘海，
戴着一副精致的金属细框眼镜，眼神知性且迷人，嘴角带着自信的微笑。她身穿剪裁合体的黑色修身西装外套，内搭鲜红色的翻领衬衫，下身是黑色包臀短裙搭配黑色透肉丝袜，脚踩黑色尖头红底高跟鞋。她单手插在西装口袋里，
肩上挎着一个复古棕色的皮革邮差包，站姿优雅挺拔。背景为米黄色的纸质纹理，
<span class="hljs-section">光影柔和，高分辨率，细节丰富，尺寸：9:16，画质4k</span>
</code></pre>
<p>但我发现和神佬的比，缺少了一些性感元素。</p>
<p>于是我在 Lovart 用 Touch edit 标记我要修改的裙子，直接让它生成更短些的。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b2b3d7f569584af69fdfc030ce19a69d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=x6ptfGPjCG0enzdGSfQyGIqg68I%3D" alt="图片" loading="lazy"/></p>
<p>多说一嘴，这个功能使用直接在这里选择一下就好了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d734260b2a3e41d2a898468e65b0d8b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=gecpEnP17p%2BlMxXyEeGGrvmsU2k%3D" alt="图片" loading="lazy"/></p>
<p>然后点我们需要修改的局部元素，就可以局部修改细节，做到精准局部改动。</p>
<p>俗称指哪打哪。</p>
<p>然后改完后，图是这样子的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17865217ac0b47bfac1101c076ae53f3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=wC%2BFUBNiVtiidydm%2F4xU1nHiQC4%3D" alt="图片" loading="lazy"/></p>
<p>你别说，效果感觉就上来了。</p>
<p>好，然后输入这样一串提示词：</p>
<pre><code class="hljs language-scss" lang="scss">Role (角色设定)
你是一位顶尖的游戏与动漫概念美术设计大师 (Concept Artist)，擅长制作详尽的角色设定图（Character Sheet）。你具备“像素级拆解”的能力，能够透视角色的穿着层级、捕捉微表情变化，并将与其相关的物品进行具象化还原。你特别擅长通过女性角色的私密物品、随身物件和生活细节来侧面丰满人物性格与背景故事。
Task (任务目标)
根据用户上传或描述的主体形象，生成一张纵向（<span class="hljs-number">9</span>:<span class="hljs-number">16</span>比例）的“全景式角色深度概念分解图”。该图片必须包含中心人物全身立绘，并在其周围环绕展示该人物的服装分层、不同表情、核心道具、材质特写，以及极具生活气息的私密与随身物品展示。
Visual Guidelines (视觉规范)
 * 构图布局 (Layout):
   • 整体画布 (Canvas): 必须采用 <span class="hljs-number">9</span>:<span class="hljs-number">16</span> 的纵向构图。
   • 中心位 (Center): 放置角色的全身立绘或主要动态姿势，作为视觉锚点。
   • 环绕位 (Surroundings): 在中心人物四周空白处，充分利用纵向空间有序排列拆解后的元素。
   • 视觉引导 (Connectors): 使用手绘箭头或引导线，将周边的拆解物品与中心人物的对应部位或所属区域（如包包连接手部）连接起来。
 * 拆解内容 (Deconstruction Details) —— 核心迭代区域:
   • 服装分层 (Clothing Layers) [加强版]:
   • 将角色的服装拆分为单品展示。如果是多层穿搭，需展示脱下外套后的内层状态。
   • 新增：私密内着拆解 (Intimate Apparel): 独立展示角色的内层衣物，重点突出设计感与材质。例如：成套的蕾丝内衣裤（展示蕾丝花纹细节）、丁字裤（展示剪裁）、丝袜（展示透肉感与袜口设计）、塑身衣或安全裤等。
   • 表情集 (Expression Sheet):
   • 在角落绘制 <span class="hljs-number">3</span>-<span class="hljs-number">4</span> 个不同的头部特写，展示不同的情绪（如：冷漠、害羞、惊讶、失神、或涂口红时的专注神态）。
   • 材质特写 (Texture &amp; Zoom) [加强版]:
   • 选取 <span class="hljs-number">1</span>-<span class="hljs-number">2</span> 个关键部位进行放大特写。例如：布料的褶皱、皮肤的纹理、手部细节。
   • 新增：物品质感特写: 增加对小物件材质的描绘，例如：口红膏体的润泽感、皮革包包的颗粒纹理、化妆品粉质的细腻感。
   • 关联物品 (Related Items) [深度迭代版]:
   • 此处不再局限于大型道具，需增加展示角色的“生活切片”。
   • 随身包袋与内容物 (Bag &amp; Contents): 绘制角色的日常通勤包或手拿包，并将其“打开”，展示散落在旁的物品。
   • 美妆与护理 (Beauty &amp; Grooming): 展示其常用的化妆品组合（如：特定色号的口红/唇釉特写、带镜子的粉饼盒、香水瓶设计、护手霜）。
   • 私密生活物件 (Lifestyle &amp; Intimate Items): 具象化角色隐藏面的物品。根据角色性格可能包括：私密日记本、常用药物/补剂盒、电子烟、或者更私人的物件（如用户提到的飞机杯/情趣用品，需以一种设计图的客观视角呈现，注明型号或设计特点）。
 * 风格与注释 (Style &amp; Annotations):
   • 画风: 保持高质量的 <span class="hljs-number">2</span>D 插画风格或概念设计草图风格，线条干净利落。
   • 背景: 使用米黄色、羊皮纸或浅灰色纹理背景，营造设计手稿的氛围。
   • 文字说明: 在每个拆解元素旁模拟手写注释，简要说明材质（如“柔软蕾丝”、“磨砂皮革”）或品牌/型号暗示（如“常用色号<span class="hljs-number">#520</span>”、“定制款”）。
<span class="hljs-built_in">Workflow</span>(执行逻辑)
当用户提供一张图片或描述时：
 * 分析主体的核心特征、穿着风格及潜在性格。
 * 提取可拆解的一级元素（外套、鞋子、大表情）。
 * 脑补并设计二级深度元素（她内衣穿什么风格？她包里会装什么口红？她独处时会用什么物品？）。
 * 生成一张包含所有这些元素的组合图，确保透视准确，光影统一，注释清晰。
 * 使用中文：英文标记，高清<span class="hljs-number">4</span>K HD 输出，确保图片严格符合 <span class="hljs-number">9</span>:<span class="hljs-number">16</span> 纵向比例。(或者<span class="hljs-number">16</span>：<span class="hljs-number">9</span>可根据页面自行选择)
</code></pre>
<p>就出来了我们想要的效果了：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e37a72b404ab470db40f8d13babe7234~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=sUxxfEawZoBB6I%2FAfi8i%2FTgIibg%3D" alt="图片" loading="lazy"/></p>
<p>嗯，不错。</p>
<p>还可以给娜美也来个，美不美。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/646d40aa9769409aa78ad87a7ac6cb58~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=2u%2BXxaoTb5b53i7sKdCv2CUcLyw%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-1">同一个人物在不同年代风格</h2>
<p>来一个我设计的提示词吧，用来展现同一个人物在不同年代风格。</p>
<p>效果是这样子的：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c50c6631e23a455e83e5c2f1b1172aa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=mulIBL2Uw6QTxeGEUU2BsGayq5M%3D" alt="图片" loading="lazy"/></p>
<p>这个图的提示词是这样子的：</p>
<pre><code class="hljs">制作一个4×4的网格，从19世纪80年代开始。在每个区域中，我的形象都应该符合该年代的风格（服装、发型、胡须、配饰）。

颜色、背景和电影风格也要相应运用。

我是特朗普
</code></pre>
<p>你别说，2020年的懂王还自动给带了个口罩，有点意思。</p>
<p>然后我觉得1950s的领带有些不符，要不换个？</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f9fd0509b9b4f74879343c3206f91de~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=WmXDXLbReuUvzFmprL6RQUOxm1A%3D" alt="图片" loading="lazy"/></p>
<p>同样 Lovart 里面 Touch 一下，领带立马换了。我放大一下你看看：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/90911485cbe24adfb8f2ab913e901b5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=Lri1z%2F36cF63BQlB65iWMsO7h4A%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">电商产品促销图</h2>
<p>来点实际在电商场景下更有用的，比如我现在先让 Nano Banana Pro 生成一个台灯产品。</p>
<blockquote>
<p>❝</p>
<p>提示词：台灯，4k</p>
<p>❞</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/137fddea0447407bb09b576beb63ba28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=gli80ZDCc%2Fh44MRJg%2Fx5AQNZntI%3D" alt="图片" loading="lazy"/></p>
<p>然后截图电商的一张参考图，直接让它参考出个类似的。</p>
<p>提示词：把【图1】按照【图2】的介绍，生成产品促销图，文字需要符合台灯这个产品描述，中文描述。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/69ec6c5980204d56bf89711efb75735c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=x06NuX7dG6T5cZjstJUZvnq1MlA%3D" alt="图片" loading="lazy"/></p>
<p>就直接出来了，中文也很准确。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aee5a7c8bb3745d486131c562afa4fc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=9%2FiVaYVwR5dwcC0dVnFovXh9FbE%3D" alt="图片" loading="lazy"/></p>
<p>然后用朋友阿真的电商拓展图提示词，生成一套可复用的电商图。</p>
<pre><code class="hljs">基于我上传的主图，为该商品生成一套完整电商延展图：桌面平铺图、多件组合图、细节放大图、尺寸线稿图、使用场景图、功能亮点图、

使用前后对比图、多角度展示图、拆解图、动态科技构图图、搭配组合图、材质展示图、模特展示图、

2×2网格布局多角度展示图，全部单张输出、风格统一、画面干净专业。智能比例。中文标注。
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1694372527d47e180592d5bf7f69785~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=Y%2FMeV8MROanmZLhVnrZ5l%2FHocCg%3D" alt="图片" loading="lazy"/></p>
<p>除此还有这个图也很给力：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/401dcb1d9361425ebe4ea44b69671c36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=IDx8DjBEHFYw1E0iUs%2BMVvVZvZM%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-3">各种身份角色的EDC图</h2>
<p>同样是伟大的神佬的设计，我们来自己喜欢的风格的EDC图。</p>
<p>比如二次元爱好者的行李：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10c4a9808668485a8f7d2deb9725f11d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=GAJZRoXpDbJ4qA4qYm2dyP5tjMM%3D" alt="图片" loading="lazy"/></p>
<p>御姐的日常行李：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a27a09b261db477f9f9fce425b6c90a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=slvQx6qlC0lo%2FI1FCmPQy%2FIPJac%3D" alt="图片" loading="lazy"/></p>
<p>程序员的日程行李：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8864e9af086541788df4282e2df0631a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=poZ%2B0oVPTp3ovCx8DQfVvMSr0kU%3D" alt="图片" loading="lazy"/></p>
<p>想生成什么样子的就用神佬（Berryxia.AI）这个提示词就好：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">[Art Style &amp; Viewpoint]:
Hyper-realistic <span class="hljs-number">8</span>k product photography, macro lens perspective, <span class="hljs-keyword">strict</span> <span class="hljs-number">90</span>-degree overhead flat-lay (knolling).
[Aesthetic Philosophy]: <span class="hljs-string">"Sublime Micro-Engineering Narratives"</span>. A blend <span class="hljs-keyword">of</span> surgical precision <span class="hljs-built_in">and</span> artistic interpretation <span class="hljs-keyword">of</span> technical components.
[Subject Input]:
Target <span class="hljs-type">Object</span>: [生成hacker的背包，二次元爱好者的行李
[INTELLIGENT SCENE GENERATION WORKFLOW]:
&gt;&gt;&gt; <span class="hljs-keyword">OPTION</span> A: <span class="hljs-keyword">IF</span> Subject <span class="hljs-built_in">is</span> Mechanical / Tech / Masculine (Industrial Precision Mode)
[Action]: Forensic Technical Exploded View. Disassemble <span class="hljs-keyword">into</span> <span class="hljs-number">8</span>-<span class="hljs-number">12</span> primary components, but <span class="hljs-keyword">with</span> an emphasis <span class="hljs-keyword">on</span> secondary <span class="hljs-built_in">and</span> tertiary <span class="hljs-keyword">sub</span>-components (e.g., individual gears within a gearbox, micro-switches <span class="hljs-keyword">on</span> a circuit board, specific spring types, internal wiring harnesses).
[Detail Emphasis]: <span class="hljs-keyword">Each</span> component <span class="hljs-built_in">is</span> meticulously rendered.
<span class="hljs-symbol">Metals:</span> Highlight brushed grains, polished edges, anodic oxidation sheen, laser-etched serial numbers <span class="hljs-built_in">or</span> specific alloy markings. Show microscopic tolerances between parts.
<span class="hljs-symbol">Plastics:</span> Reveal injection molding marks, precise seam lines, <span class="hljs-built_in">and</span> subtle textural variations.
<span class="hljs-symbol">Circuitry:</span> Emphasize the solder joints, traces, tiny capacitors, <span class="hljs-built_in">and</span> integrated chip details.
Glass/Optics: Render reflections, anti-reflective coatings, <span class="hljs-built_in">and</span> subtle refractions.
[Background]: Premium matte cool-grey workbench surface.
[Interactive Schematics]: Ultra-fine Cyan/Tech-Blue vector lines. Include cross-sectional views, exploded <span class="hljs-keyword">assembly</span> sequence lines (dashed arrows), <span class="hljs-built_in">and</span> material <span class="hljs-keyword">call</span>-outs(e.g., <span class="hljs-string">"Alloy 7075"</span>, <span class="hljs-string">"Carbon Fiber Weave"</span>).
[Artistic Title Style]: <span class="hljs-string">"Industrial Stencil"</span> Aesthetic. Large, bold, semi-transparent <span class="hljs-keyword">text</span>(e.g., <span class="hljs-string">"PROJECT: ALPHA"</span> <span class="hljs-built_in">or</span> <span class="hljs-string">"ENGINE MODEL: X9"</span>) laser-etched onto the background surface.
&gt;&gt;&gt; <span class="hljs-keyword">OPTION</span> B: <span class="hljs-keyword">IF</span> Subject <span class="hljs-built_in">is</span> Feminine / Fashion / Lifestyle(Luxury Narrative Mode)
[Action]: Curated <span class="hljs-string">"Magic Blind Box"</span> Knolling. Spilled contents are arranged <span class="hljs-keyword">with</span> obsessive attention <span class="hljs-keyword">to</span> detail <span class="hljs-keyword">for</span> <span class="hljs-keyword">each</span> item.
[Detail Emphasis]: <span class="hljs-keyword">Each</span> item, whether essential <span class="hljs-built_in">or</span> <span class="hljs-string">"secret,"</span> <span class="hljs-built_in">is</span> presented <span class="hljs-keyword">with</span> luxurious verisimilitude.
<span class="hljs-symbol">Fabrics:</span> Reveal intricate stitching <span class="hljs-keyword">on</span> leather, delicate lace patterns, silk<span class="hljs-comment">'s natural sheen, and fine thread counts.</span>
<span class="hljs-symbol">Cosmetics:</span> Show the micro-pearls <span class="hljs-keyword">in</span> a compact, the smooth texture <span class="hljs-keyword">of</span> a lipstick bullet, the subtle viscosity <span class="hljs-keyword">of</span> a serum.
<span class="hljs-symbol">Jewelry:</span> Highlight facets <span class="hljs-keyword">of</span> gemstones, polished metal reflections, <span class="hljs-built_in">and</span> delicate clasps.
<span class="hljs-string">"Secrets"</span>: Render silicone textures, subtle glow <span class="hljs-keyword">of</span> LED indicators <span class="hljs-keyword">on</span> personal wellness devices, <span class="hljs-built_in">or</span> the elegant folds <span class="hljs-keyword">of</span> intimate garments <span class="hljs-keyword">with</span> tasteful artistry.
[Background]: Iconic Tiffany Blue(Robin-egg blue) matte surface.
[Interactive Schematics]: Delicate White <span class="hljs-built_in">or</span> Silver fine lines. Include fashion pattern diagrams, stylistic flow lines(emphasizing elegance), <span class="hljs-built_in">and</span> <span class="hljs-string">"signature"</span> curves(e.g., golden ratio spirals) across the composition.
[Artistic Title Style]: <span class="hljs-string">"Vogue Editorial"</span> Aesthetic. Elegant, oversized Serif Typography(e.g., <span class="hljs-string">"THE ENSEMBLE"</span> <span class="hljs-built_in">or</span> <span class="hljs-string">"FEMME FATALE"</span>) <span class="hljs-keyword">in</span> shimmering silver foil <span class="hljs-built_in">or</span> embossed white ink <span class="hljs-keyword">on</span> the blue surface.
[Universal Composition]:
Mathematical grid alignment <span class="hljs-keyword">with</span> micro-gaps <span class="hljs-keyword">for</span> hyper-precision. All parts are displayed <span class="hljs-keyword">with</span> zero tolerance spacing, creating an illusion <span class="hljs-keyword">of</span> effortless engineering.
[Universal Lighting]:
Micro-detailed, multi-point studio lighting. Emphasize specular highlights <span class="hljs-keyword">on</span> metal, subtle subsurface scattering <span class="hljs-keyword">on</span> plastics, <span class="hljs-built_in">and</span> volumetric <span class="hljs-keyword">shadows</span> that define component depth. Neutral color balance.
[Graphic Elements - The <span class="hljs-string">"Call-out"</span> System] (Enhanced):
<span class="hljs-symbol">Style:</span> Ultra-fine Hairline Pointers(Leader Lines).
<span class="hljs-keyword">Text</span> Detail: [Bold Main Label - e.g., <span class="hljs-string">"Cylinder Block"</span>] / [Tiny <span class="hljs-keyword">Sub</span>-Label - e.g., <span class="hljs-string">"Aluminium Alloy 7075, Forged"</span>] / [Micro-Spec - e.g., <span class="hljs-string">"Tolerance +/-0.005mm"</span>]. This creates tiered information.
<span class="hljs-symbol">Font:</span> Swiss-style minimalist sans-serif <span class="hljs-keyword">for</span> clarity. <span class="hljs-keyword">Text</span> appears digitally superimposed, razor-sharp.
[Artisan Signature Plaque] (Universal):
<span class="hljs-keyword">In</span> the bottom-left corner: A small, highly realistic, rectangular golden metallic plaque.
<span class="hljs-symbol">Text:</span> <span class="hljs-string">"canghe"</span> <span class="hljs-keyword">in</span> natural, elegant handwritten cursive script.
<span class="hljs-symbol">Effect:</span> Deeply engraved/debossed look <span class="hljs-keyword">with</span> complex metallic sheen <span class="hljs-built_in">and</span> subtle light traps, contrasting <span class="hljs-keyword">with</span> the technical precision.
--ar <span class="hljs-number">16</span>:<span class="hljs-number">9</span> --q <span class="hljs-number">2</span> --stylize <span class="hljs-number">450</span> --v <span class="hljs-number">6.1</span>  
</code></pre>
<h2 data-id="heading-4">高端商业海报</h2>
<p>这个最近也超级火，先来看看效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b9ece37eaae4aa1b861f75e48fa2a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=mBXyUc5PqDZ79fSBX1hjoKlrsj4%3D" alt="图片" loading="lazy"/></p>
<p>这个的提示词是这样子的：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">At</span> the very top center <span class="hljs-keyword">of</span> the composition, floating prominently above the ingredient layers, <span class="hljs-keyword">is</span> a luxurious title label. The text <span class="hljs-keyword">reads</span> "热干面 HOT DRY NOODLES" rendered <span class="hljs-keyword">in</span> expressive, handwritten Chinese brush calligraphy (毛笔字) style. The lettering possesses a heavy, three<span class="hljs-operator">-</span>dimensional sculpted gold metal texture <span class="hljs-keyword">with</span> a brushed finish, warm golden sheen, <span class="hljs-keyword">and</span> realistic metallic reflections catching the dramatic studio lighting.
Premium Wuhan street food poster featuring deconstructed layers <span class="hljs-keyword">of</span> Hot Dry Noodles floating <span class="hljs-keyword">in</span> vertical stack <span class="hljs-keyword">on</span> pure black background (#<span class="hljs-number">000000</span>). <span class="hljs-keyword">Distinct</span> layers <span class="hljs-keyword">from</span> top <span class="hljs-keyword">to</span> bottom (below the main gold title):
<span class="hljs-number">1.</span> Top layer: A vibrant mix <span class="hljs-keyword">of</span> orange crunchy pickled radish cubes (spicy diced radish) <span class="hljs-keyword">and</span> bright green chopped scallions, scattered dynamically. <span class="hljs-number">2.</span> <span class="hljs-keyword">Second</span> layer: Rich, thick brown sesame paste (Sesame <span class="hljs-operator">&amp;</span> Peanut Sauce) floating <span class="hljs-keyword">in</span> mid<span class="hljs-operator">-</span>air, looking creamy, dense, <span class="hljs-keyword">and</span> glossy, <span class="hljs-keyword">with</span> a few drops <span class="hljs-keyword">of</span> dark soy sauce swirling <span class="hljs-keyword">within</span> it. <span class="hljs-number">3.</span> Third layer: Deep red spicy chili oil splashing, <span class="hljs-keyword">with</span> visible chili flakes <span class="hljs-keyword">and</span> floating sesame seeds, creating a sharp color contrast. <span class="hljs-number">4.</span> Fourth layer: Thick yellow alkaline noodles (oil<span class="hljs-operator">-</span>coated noodles), coiled <span class="hljs-keyword">and</span> suspended, showing a firm, chewy texture <span class="hljs-keyword">and</span> oily sheen. <span class="hljs-number">5.</span> Fifth layer (Transition): <span class="hljs-keyword">EMPTY</span> SPACE <span class="hljs-operator">-</span> a larger gap <span class="hljs-keyword">with</span> <span class="hljs-keyword">only</span> subtle rising steam, floating sesame seeds, <span class="hljs-keyword">and</span> tiny oil droplets creating breathing room. <span class="hljs-number">6.</span> Bottom<span class="hljs-operator">/</span><span class="hljs-keyword">Final</span> layer: A complete finished Hot Dry Noodles dish <span class="hljs-keyword">in</span> a classic paper bowl <span class="hljs-keyword">or</span> retro ceramic bowl, viewed <span class="hljs-keyword">from</span> the same <span class="hljs-number">45</span><span class="hljs-operator">-</span>degree angle. The noodles <span class="hljs-keyword">are</span> thoroughly coated <span class="hljs-keyword">in</span> the thick brown sesame sauce, topped generously <span class="hljs-keyword">with</span> the pickled radish <span class="hljs-keyword">and</span> scallions. The texture looks sticky, rich, <span class="hljs-keyword">and</span> dry (<span class="hljs-keyword">not</span> soupy), <span class="hljs-keyword">with</span> steam rising.
<span class="hljs-keyword">Each</span> layer separated <span class="hljs-keyword">with</span> gaps revealing textures. Chinese <span class="hljs-keyword">and</span> English bilingual labels <span class="hljs-keyword">with</span> elegant arrows pointing <span class="hljs-keyword">to</span> <span class="hljs-keyword">each</span> component: "酸豆角/萝卜丁 Pickled Radish &amp; Beans", "秘制芝麻酱 Secret Sesame Paste", "红油辣椒 Spicy Chili Oil", "劲道碱面 Alkaline Noodles", "经典风味 Classic Taste", "成品 Finished Dish".
<span class="hljs-keyword">NO</span> white pedestal. <span class="hljs-keyword">All</span> layers <span class="hljs-type">float</span> freely <span class="hljs-keyword">in</span> space. Dramatic studio lighting <span class="hljs-keyword">from</span> <span class="hljs-number">45</span><span class="hljs-operator">-</span>degree angle, rim lighting highlighting the gloss <span class="hljs-keyword">of</span> the sesame paste <span class="hljs-keyword">and</span> the texture <span class="hljs-keyword">of</span> noodles. Ultra<span class="hljs-operator">-</span>realistic, <span class="hljs-number">8</span>k resolution, commercial food photography, appetizing, <span class="hljs-number">9</span>:<span class="hljs-number">16</span> vertical format.
</code></pre>
<p>真有想吃的感觉了，深夜放毒，哈哈哈。</p>
<p>除了生成热干面，还可以生成任意食物，把他丢给Lovart，然后直接跟他说就好了。</p>
<h2 data-id="heading-5">信息图</h2>
<p>可以生成任意信息图，架构图、结构图等，也不需要太过复杂提示词，在Lovart直接说就行，Agent会自行帮生成好。</p>
<p>比如这个信息图的提示词就很简单：</p>
<p>帮我把一下内容生成信息图，我要分享到X的，尽量炫酷好看些。“你的内容”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d73d2420c62546bbade4c2f7cef8782f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=RTvzr0EwQqWKzrzn80SFfj5IWAo%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-6">条漫</h2>
<p>之前也给大家介绍过条漫的玩法，对于一些小细节还是需要局部修改，现在有 Lovart 的 Touch edit 可以局部修改就方便多了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed9efd3309ae46368a509c7aec34b394~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuN5L2V:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765810418&amp;x-signature=3WgLQW1IwJow2hgGPmfJh7yj2Jg%3D" alt="图片" loading="lazy"/></p>
<p>其他的大家也可以多去尝试一下。</p>
<p>然后其他更多的提示词和例子，大家也可以直接去提示词案例库里面看，我开了编辑权限，可直接复制以及新增你好玩的case。</p>
<p>Nano Banana Pro 的生图一致性和审美设计能力都非常在线，而且几乎不用抽卡。</p>
<p>配合 Lovart ，利用 Agent 和 Touch edit 局部修改细节，精准控制，可玩的太多了，</p>
<p>顺带多说一嘴，最近 Lovart 正在做活动，11月21号到11月30号订阅 Basic+ 可享 365 天 Nano Banana Pro 无限量使用，老会员也会自动获得。订阅Basic+ 除了 Nano Banana Pro ，Nano Banana 1、Seedream 4、Midjourney V7 也是一起的一年 0 积分。</p>
<p>感兴趣可以去看看，链接在这里 👇 <a href="https://link.juejin.cn?target=https%3A%2F%2Flovart.ai" target="_blank" title="https://lovart.ai" ref="nofollow noopener noreferrer">lovart.ai</a></p>
<p>好啦，今天的分享就到这，还没获得Nano Banana Pro 提示词案例库的可以评论区留言，我也可以私发你。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TypeWords:让英语学习更高效的打字练习神器]]></title>    <link>https://juejin.cn/post/7581406561685176366</link>    <guid>https://juejin.cn/post/7581406561685176366</guid>    <pubDate>2025-12-08T13:11:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581406561685176366" data-draft-id="7581324171398332462" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TypeWords:让英语学习更高效的打字练习神器"/> <meta itemprop="keywords" content="开源"/> <meta itemprop="datePublished" content="2025-12-08T13:11:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="修己xj"/> <meta itemprop="url" content="https://juejin.cn/user/2641475936724142"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TypeWords:让英语学习更高效的打字练习神器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2641475936724142/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    修己xj
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:11:48.000Z" title="Mon Dec 08 2025 13:11:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在日常工作和生活中，我们常常需要用到英文，尤其是在查阅技术文档等场合。尽管目前翻译工具相当便捷，但如果能够自己流畅阅读，效率会大大提高。然而，想要学好、说好英语通常并不容易，往往需要投入大量的时间和金钱去报班学习。那么，有没有一种更加轻松有效的方法来提升英语阅读能力呢？</p>
<p>在英语学习过程中，背单词常常成为令人望而却步的一关。传统的记忆方式容易显得枯燥，效果也未必理想。今天，我想向大家推荐一款打破常规的开源学习工具——TypeWords。它巧妙地将打字练习与英语学习融为一体，让你在敲击键盘的过程中，不知不觉地提升英语水平。</p>
<p><a href="https://link.juejin.cn?target=http%3A%2F%2Fchevereto.xiuji.mynatapp.cc%2Fimage%2FHHVX" target="_blank" title="http://chevereto.xiuji.mynatapp.cc/image/HHVX" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d08036a6fe84815a65a23445f62d72b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=ZolqEqK0LOlE%2B3CKqUoLjQsKhPQ%3D" alt="favicon.md.png" loading="lazy"/></a></p>
<p>favicon.md.png</p>
<h2 data-id="heading-0">项目简介</h2>
<p>TypeWords 是一个基于 Vue 开发的现代化英语学习工具，它通过<strong>打字输入</strong>的方式帮助你记忆单词和背诵文章。项目的核心理念是：“学习英语，一次敲击，一点进步；记忆不再盲目，学习更高效”。</p>
<p>该项目再github 上已有 5.9k star</p>
<p>github地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzyronon%2FTypeWords" target="_blank" title="https://github.com/zyronon/TypeWords" ref="nofollow noopener noreferrer">github.com/zyronon/Typ…</a></p>
<p>在线使用地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Ftypewords.cc%2F" target="_blank" title="https://typewords.cc/" ref="nofollow noopener noreferrer">typewords.cc/</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f81506f50cf44d7aeafc6835a783c1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=xJNVU5%2BCvpXdH2efYIKBu92IiHk%3D" alt="_20251208_070501.png" loading="lazy"/></p>
<p>_20251208_070501.png</p>
<h2 data-id="heading-1">主要特色功能</h2>
<h3 data-id="heading-2">🎯 智能单词练习</h3>
<ul>
<li>
<p><strong>四种学习模式</strong>：</p>
<ul>
<li>跟打模式：看着单词和释义打字</li>
<li>辨认模式：根据释义打出正确单词</li>
<li>复习模式：巩固记忆</li>
<li>默写模式：挑战自我记忆</li>
</ul>
</li>
<li>
<p><strong>智能记忆曲线</strong>：系统自动计算最佳复习时间</p>
</li>
<li>
<p><strong>丰富资源</strong>：每个单词都配有音标、美英发音、例句、短语、近义词、词源等</p>
</li>
</ul>
<h3 data-id="heading-3">📚 高效文章背诵</h3>
<ul>
<li><strong>内置经典教材</strong>：包含多种英语学习材料</li>
<li><strong>自定义导入</strong>：支持添加个人文章</li>
<li><strong>智能辅助</strong>：一键翻译、译文对照、逐句输入、自动发音</li>
<li><strong>听力强化</strong>：支持边听边默写</li>
</ul>
<h3 data-id="heading-4">📊 学习管理</h3>
<ul>
<li><strong>错词本</strong>：自动记录输入错误的单词</li>
<li><strong>收藏夹</strong>：主动收藏重点单词</li>
<li><strong>已掌握</strong>：标记已学会的单词</li>
</ul>
<h2 data-id="heading-5">📦 安装与部署</h2>
<p>TypeWords 作为一款 Web 应用，部署和使用都非常简单。</p>
<h3 data-id="heading-6">方法一：直接访问在线版本</h3>
<p>最简单的方式是直接访问项目的在线使用地址：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftypewords.cc%2F" target="_blank" title="https://typewords.cc/" ref="nofollow noopener noreferrer">typewords.cc/</a></p>
<h3 data-id="heading-7">方法二：本地启动</h3>
<p>此项目可单独运行，数据保存在本地，换设备需手动备份数据，不影响正常使用； 此项目是基于Vue开发的，需要 node 环境来运行。 我使用node版本是<code>v22.12.0</code></p>
<p>从github下载此项目源码，在项目根目录下，打开命令行，运行<code>npm install</code>来下载依赖。 执行<code>npm run dev</code>来启动项目，项目默认地址为<code>http://localhost:3000</code> 在浏览器中打开<code>http://localhost:3000</code> 来访问项目。 执行<code>npm run build</code>打包项目文件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a8280a15d6884acebb3f8ada0e37b0df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=75jCRkTj%2FsqKiRa84wOwO%2FzraRE%3D" alt="_20251208_162522.png" loading="lazy"/></p>
<p>_20251208_162522.png</p>
<h3 data-id="heading-8">方法三：Docker部署</h3>
<ul>
<li>打包服务</li>
</ul>
<p>下载项目之后使用<code>npm run build</code> 打包项目</p>
<ul>
<li>构建镜像</li>
</ul>
<p>创建<code>Dockerfile</code>文件,内容如下：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用官方 nginx 1.21.5 镜像作为基础镜像</span>
FROM nginx:1.21.5
<span class="hljs-comment"># 设置维护者信息（可选）</span>
LABEL maintainer=<span class="hljs-string">"xj"</span>
<span class="hljs-comment"># 设置工作目录</span>
WORKDIR /usr/share/nginx/html

<span class="hljs-comment"># 复制前端构建文件到nginx目录</span>
COPY ./dist/ ./

<span class="hljs-comment"># 设置正确的文件权限</span>
RUN  <span class="hljs-built_in">chmod</span> -R 755 /usr/share/nginx/html


<span class="hljs-comment"># 暴露端口</span>
EXPOSE 80

<span class="hljs-comment"># nginx容器默认启动nginx，保持前台运行</span>
CMD [<span class="hljs-string">"nginx"</span>, <span class="hljs-string">"-g"</span>, <span class="hljs-string">"daemon off;"</span>]
</code></pre>
<p>将构建之后的<code>dist</code>文件夹复制到同级目录下,使用以下命令构建镜像</p>
<pre><code class="hljs language-bash" lang="bash">docker build -t xj/typewords:v2.0 .
</code></pre>
<ul>
<li>docker-compose部署</li>
</ul>
<p>创建部署目录<code>typewords</code>,在此目录下构建docker-compose.yml文件</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">services:</span>
  <span class="hljs-attr">typewords:</span>
    <span class="hljs-comment"># 也可以使用博主构建的镜像 registry.cn-hangzhou.aliyuncs.com/xj_lew/typewords:v2.0</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">xj/typewords:v2.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">typewords</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">always</span>
    <span class="hljs-attr">logging:</span>
      <span class="hljs-attr">driver:</span> <span class="hljs-string">'json-file'</span>
      <span class="hljs-attr">options:</span>
        <span class="hljs-attr">max-size:</span> <span class="hljs-string">'5g'</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">NGINX_PORT=80</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-number">8090</span><span class="hljs-string">:80</span>
</code></pre>
<p>在此目录下使用以下命令启动服务</p>
<pre><code class="hljs">docker-compose up -d 
</code></pre>
<p>到此，我们服务就部署完了</p>
<h2 data-id="heading-9">使用</h2>
<p>部署完之后在浏览器中打开服务，选择我们需要学习的单词或者文章就可以开始学习了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/634004d769ad4b4985596d9480bb5aea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L-u5bexeGo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804308&amp;x-signature=Uit4ODR2gTluI4zyzfAANdlT7KE%3D" alt="_20251208_162423.png" loading="lazy"/></p>
<p>_20251208_162423.png</p>
<h3 data-id="heading-10">缺点</h3>
<ul>
<li>数据在浏览器本地存储，多端数据不同步</li>
<li>内置词典选择有限</li>
</ul>
<h2 data-id="heading-11">结语</h2>
<p>TypeWords 不仅仅是一个背单词工具，它是一个全新的英语学习体验。它将枯燥的记忆过程转化为有趣的互动练习，让学习英语变得更加轻松高效。</p>
<p>无论你是英语学习者，还是对开源项目感兴趣的开发者，TypeWords 都值得你尝试和关注。现在就访问 typewords.cc 开始你的高效英语学习之旅吧！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Virtual World 04】我们的目标，无限宇宙！！]]></title>    <link>https://juejin.cn/post/7581210455827759140</link>    <guid>https://juejin.cn/post/7581210455827759140</guid>    <pubDate>2025-12-08T13:22:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581210455827759140" data-draft-id="7577914902431268910" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Virtual World  04】我们的目标，无限宇宙！！"/> <meta itemprop="keywords" content="前端,JavaScript,代码规范"/> <meta itemprop="datePublished" content="2025-12-08T13:22:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大怪v"/> <meta itemprop="url" content="https://juejin.cn/user/4391901700043284"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Virtual World  04】我们的目标，无限宇宙！！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4391901700043284/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大怪v
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:22:09.000Z" title="Mon Dec 08 2025 13:22:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这是<strong>纯前端手搓虚拟世界</strong>第四篇。</p>
<p>前端佬们，前三篇的基础打好，基本创建一个单体的应用没啥问题了。但前端佬肯定发现一个很尴尬的问题!</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbf44cf051754ed997114b41a5817644~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=%2Bqr4wyetPaIm%2BhteO659ayWLL2k%3D" alt="93B1A00879A9B67271080936B8A2D89CE1D69417_size242_w423_h220.gif" loading="lazy"/></p>
<p>那就是我们的 Canvas 只有 600x600。</p>
<p>如果你想直接搞一幅《清明上河图》，那画着画着，就会发现——<strong>没地儿了</strong>。</p>
<h2 data-id="heading-0">立Flag</h2>
<p>按照最简单的方法，把canvas加大，把屏幕加大，这样就不只600x600了。</p>
<p>But!!!!</p>
<p>装X装到头,抠抠搜搜加那点资源，还是不够用。既然是虚拟世界，我们的目前，就应该无限宇宙！</p>
<p>这篇，就是要把想法变成现实，一个通向无限世界的“窗口”，实现一个<strong>虚拟摄像机（Virtual Camera）</strong> 。你看到的只是摄像机拍到的画面，而世界本身，你的梦想有多大，那么就有多大。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a49cca0e7b564cb281faaa3c0fdcf0c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=xdE884%2BrsSsB9OkRz0dFYPl1%2BvY%3D" alt="timg (1).gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1">战略思考</h2>
<p>上了<code>class</code>的贼船，首先想法就是抽象一个类，来管理这个。<strong><code>Viewport</code>（视口）</strong> ，专门处理这些事情。</p>
<p>它的核心功能只有两个：</p>
<ol>
<li><strong>坐标转换</strong>：搞清楚“鼠标点在屏幕上的 (100,100)”到底对应“虚拟世界里的哪一个坐标”。</li>
<li><strong>平移交互（Pan）</strong> ：按住 <strong>空格键</strong> + <strong>鼠标左键拖拽</strong>，移动摄像机，浏览世界的其他角落。</li>
</ol>
<p>嗯，够逼格了！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/005f50687bbc4db19e6a4a00a958d4be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=S4L5c3mCtL%2BweXT%2FRqH88NjDdXk%3D" alt="timg (25).gif" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2">基础原理</h2>
<p>要个无限空间其实是一个视觉小把戏，首先我们得确认浏览器是不会允许你创建一个 width: 99999999px 的 Canvas 的，这样浏览器的内存会直接嗝屁。</p>
<p>然后我们移动鼠标位置是固定不变的，大致示意图如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf384cb275334ac98641600718908118~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=zcEdd2%2BV1fkqrjVSh4SndGNbpmk%3D" alt="image.png" loading="lazy"/></p>
<p>虚拟层就是在数学层面上的模拟层，所有的移动，添加都是放到虚拟层上。</p>
<p>我们脑子里始终要记得两套坐标系：</p>
<ul>
<li>
<p><strong>屏幕坐标系 (Screen Space)</strong> ：</p>
<ul>
<li>这是<strong>物理现实</strong>。</li>
<li>原点 <code>(0,0)</code> 永远在 Canvas 的左上角。</li>
<li>范围有限，比如 <code>600x600</code>。</li>
<li><strong>用途</strong>：接收鼠标事件 (<code>evt.offsetX</code>, <code>evt.offsetY</code>)，最终渲染图像。</li>
</ul>
</li>
<li>
<p><strong>世界坐标系 (World Space)</strong> ：</p>
<ul>
<li>这是<strong>虚拟数据</strong>。</li>
<li>原点 <code>(0,0)</code> 是世界的中心。</li>
<li>范围无限，你的点可以是 <code>(-5000, 99999)</code>。</li>
<li><strong>用途</strong>：存储 <code>Point</code> 和 <code>Segment</code> 的真实位置。</li>
</ul>
</li>
</ul>
<p>视口变换的原理，并不是真的把 Canvas 的 DOM 元素拖走了，而是我们在<strong>绘制之前</strong>，对所有的坐标做了一次数学偏移。</p>
<p>想象一下你拿着一个相机（视口）在拍风景，如果你想看<strong>右边</strong>的树，你需要把相机向<strong>右</strong>移，但在相机取景框里，那棵树看起来是向<strong>左</strong>移了。</p>
<p>嗯，大概就是这样了。</p>
<hr/>
<h2 data-id="heading-3">上代码</h2>
<p>听不懂？？直接上代码！！！！</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1b4cf224f65f4e91abf45116ea5d3b2a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=QzTsg5Sd33LopXV6wOrPN5LeTDY%3D" alt="0.gif" loading="lazy"/></p>
<h3 data-id="heading-4">视口控制器：<code>Viewport</code></h3>
<p>在 <code>src</code> 下新建文件夹 <code>view</code>，然后创建 <code>viewport.js</code>。</p>
<p>这玩意的数学原理其实就是一个简单的减法：</p>
<blockquote>
<p><strong>世界坐标 = 屏幕坐标 - 视口中心偏移量</strong></p>
</blockquote>
<p>如果我把视口往右移 100px，那原本的世界原点 (0,0) 现在就在屏幕的 (100,0) 位置。</p>
<p>JavaScript</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// src/view/viewport.js</span>
<span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"../primitives/point2D.js"</span>;

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">Viewport</span> {
  <span class="hljs-keyword">constructor</span>(canvas) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);

    <span class="hljs-comment">// 视口的初始缩放级别（为下一篇做铺垫）</span>
    <span class="hljs-keyword">this</span>.zoom = <span class="hljs-number">1</span>;
    <span class="hljs-comment">// 视口的中心偏移量（相当于摄像机的位置）</span>
    <span class="hljs-comment">// 默认让 (0,0) 在画布中心，这样更符合数学直觉</span>
    <span class="hljs-keyword">this</span>.center = new Point2D(canvas.width / <span class="hljs-number">2</span>, canvas.height / <span class="hljs-number">2</span>);
    <span class="hljs-comment">// 另一种更通用的做法是记录 offset，也就是 panning 的距离</span>
    <span class="hljs-keyword">this</span>.offset = new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);

    <span class="hljs-comment">// 拖拽状态管理</span>
    <span class="hljs-keyword">this</span>.drag = {
      start: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>), <span class="hljs-comment">// 鼠标按下的起始点</span>
      end: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),   <span class="hljs-comment">// 鼠标当前的结束点</span>
      offset: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),<span class="hljs-comment">// 这一瞬间拖了多远</span>
      active: <span class="hljs-literal">false</span>             <span class="hljs-comment">// 是否正在拖拽</span>
    };

    <span class="hljs-keyword">this</span>.#addEventListeners();
  }

  <span class="hljs-comment">// 核心数学题：屏幕坐标 -&gt; 世界坐标</span>
  getMouse(evt) {
    <span class="hljs-comment">// 现在的计算逻辑：(鼠标位置 - 中心点) * 缩放系数 - 偏移量</span>
    <span class="hljs-comment">// 暂时先不加缩放，只处理平移</span>
    <span class="hljs-keyword">return</span> new Point2D(
      (evt.offsetX - <span class="hljs-keyword">this</span>.center.x) - <span class="hljs-keyword">this</span>.offset.x,
      (evt.offsetY - <span class="hljs-keyword">this</span>.center.y) - <span class="hljs-keyword">this</span>.offset.y
    );
  }

  <span class="hljs-comment">// 获取当前的偏移量，给 Canvas 用</span>
  getOffset() {
     <span class="hljs-keyword">return</span> new Point2D(
         <span class="hljs-keyword">this</span>.center.x + <span class="hljs-keyword">this</span>.offset.x, 
         <span class="hljs-keyword">this</span>.center.y + <span class="hljs-keyword">this</span>.offset.y
     );
  }

  #addEventListeners() {
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousedown"</span>, (evt) =&gt; {
      <span class="hljs-comment">// 只有按住空格(Space)且点击左键(0)时，才触发平移</span>
      <span class="hljs-comment">// 这里的 evt.button == 0 是左键</span>
      <span class="hljs-comment">// 这里的 evt.ctrlKey / shiftKey 等也可以判断，但我们要判断空格键状态</span>
      <span class="hljs-comment">// 由于 mousedown 里拿不到键盘持续状态，我们需要一个外部变量或者在 window 上监听键盘</span>
      <span class="hljs-comment">// 简单的做法：检查 evt 里是否包含按键信息？不包含。</span>
      <span class="hljs-comment">// 所以我们通常单独存一个键盘状态，或者直接利用 "wheel" 做缩放，用 "middle" 做平移</span>
      <span class="hljs-comment">// 但既然需求是 "空格+左键"，我们需要配合 keydown/keyup</span>
    });
  }
}
</code></pre>
<p>这里歇一歇，理理代码思路。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3baa123b358e41f5ab5aac330d9d7478~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=7ayzXH6NCNU2GDyA%2Fafa%2BR7HgZk%3D" alt="9.gif" loading="lazy"/></p>
<p>**“按住空格”**这个逻辑在 DOM 事件里稍微有点麻烦。因为 <code>mousedown</code> 事件对象里不直接告诉你“空格键是不是正被按着”。</p>
<p>我们需要给 <code>Viewport</code> 增加键盘监听。</p>
<p><strong>修正后的完整 <code>src/view/viewport.js</code>：</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"../primitives/point2D.js"</span>;

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">Viewport</span> {
  <span class="hljs-keyword">constructor</span>(canvas) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);

    <span class="hljs-keyword">this</span>.zoom = <span class="hljs-number">1</span>;
    <span class="hljs-comment">// 这里的 offset 就是我们一共平移了多少距离</span>
    <span class="hljs-keyword">this</span>.offset = new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>); 
    
    <span class="hljs-comment">// 拖拽计算用的临时变量</span>
    <span class="hljs-keyword">this</span>.drag = {
      start: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
      end: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
      offset: new Point2D(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
      active: <span class="hljs-literal">false</span>
    };

    <span class="hljs-keyword">this</span>.#addEventListeners();
  }

  <span class="hljs-comment">// 计算：鼠标在屏幕上的点，对应的真实世界坐标在哪里</span>
  getMouse(evt, subtractDragOffset = <span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">const</span> p = new Point2D(
      (evt.offsetX - <span class="hljs-keyword">this</span>.canvas.width / <span class="hljs-number">2</span>) * <span class="hljs-keyword">this</span>.zoom - <span class="hljs-keyword">this</span>.offset.x,
      (evt.offsetY - <span class="hljs-keyword">this</span>.canvas.height / <span class="hljs-number">2</span>) * <span class="hljs-keyword">this</span>.zoom - <span class="hljs-keyword">this</span>.offset.y
    );
    <span class="hljs-keyword">return</span> p;
  }
  
  <span class="hljs-comment">// 给 Canvas 渲染用的，告诉它该平移多少</span>
  getOffset() {
      <span class="hljs-keyword">return</span> new Point2D(
          <span class="hljs-keyword">this</span>.offset.x + <span class="hljs-keyword">this</span>.canvas.width / <span class="hljs-number">2</span>,
          <span class="hljs-keyword">this</span>.offset.y + <span class="hljs-keyword">this</span>.canvas.height / <span class="hljs-number">2</span>
      );
  }

  #addEventListeners() {
    <span class="hljs-comment">// 记录空格键状态</span>
    <span class="hljs-keyword">this</span>.isSpacePressed = <span class="hljs-literal">false</span>;

    window.addEventListener(<span class="hljs-string">"keydown"</span>, (evt) =&gt; {
       <span class="hljs-keyword">if</span> (evt.code === <span class="hljs-string">"Space"</span>) {
           <span class="hljs-keyword">this</span>.isSpacePressed = <span class="hljs-literal">true</span>;
       }
    });

    window.addEventListener(<span class="hljs-string">"keyup"</span>, (evt) =&gt; {
       <span class="hljs-keyword">if</span> (evt.code === <span class="hljs-string">"Space"</span>) {
           <span class="hljs-keyword">this</span>.isSpacePressed = <span class="hljs-literal">false</span>;
       }
    });

    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousedown"</span>, (evt) =&gt; {
      <span class="hljs-comment">// 只有按住空格 + 左键，才开始拖拽视口</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isSpacePressed &amp;&amp; evt.button === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>.drag.start = <span class="hljs-keyword">this</span>.getMouse(evt);
        <span class="hljs-keyword">this</span>.drag.active = <span class="hljs-literal">true</span>;
      }
    });

    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousemove"</span>, (evt) =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.drag.active) {
        <span class="hljs-keyword">this</span>.drag.end = <span class="hljs-keyword">this</span>.getMouse(evt);
        <span class="hljs-comment">// 计算这一瞬间移动了多少</span>
        <span class="hljs-keyword">this</span>.drag.offset = new Point2D(
            <span class="hljs-keyword">this</span>.drag.end.x - <span class="hljs-keyword">this</span>.drag.start.x,
            <span class="hljs-keyword">this</span>.drag.end.y - <span class="hljs-keyword">this</span>.drag.start.y
        );
        <span class="hljs-comment">// 累加到总偏移量里</span>
        <span class="hljs-keyword">this</span>.offset.x += <span class="hljs-keyword">this</span>.drag.offset.x;
        <span class="hljs-keyword">this</span>.offset.y += <span class="hljs-keyword">this</span>.drag.offset.y;
        
        <span class="hljs-comment">// 重要：重置 start，因为我们已经处理了这段位移</span>
        <span class="hljs-comment">// 如果不重置，你会发现画面飞得越来越快</span>
        <span class="hljs-keyword">this</span>.drag.start = <span class="hljs-keyword">this</span>.getMouse(evt); 
      }
    });

    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mouseup"</span>, () =&gt; {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.drag.active) {
        <span class="hljs-keyword">this</span>.drag.active = <span class="hljs-literal">false</span>;
      }
    });
  }
}
</code></pre>
<h3 data-id="heading-5">修改 <code>GraphEditor</code></h3>
<p>这就是上篇埋的坑。之前我们在 <code>GraphEditor</code> 里直接用了 <code>evt.offsetX</code>。现在不行了，必须通过 <code>viewport.getMouse(evt)</code> 来获取坐标。</p>
<p>修改 <code>src/editors/graphEditor.js</code>：</p>
<ol>
<li><strong>构造函数</strong>接收 <code>viewport</code>。</li>
<li><strong>事件监听</strong>改用 <code>viewport.getMouse(evt)</code>。</li>
<li><strong>冲突解决</strong>：如果按住了空格（正在拖拽视图），就不要触发“画点”的逻辑。</li>
</ol>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// src/editors/graphEditor.js</span>
<span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"../primitives/point2D.js"</span>;
<span class="hljs-keyword">import</span> Segment from <span class="hljs-string">"../primitives/segment.js"</span>;

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">GraphEditor</span> {
  <span class="hljs-keyword">constructor</span>(canvas, graph, viewport) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.graph = graph;
    <span class="hljs-keyword">this</span>.viewport = viewport;

    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);

    <span class="hljs-comment">// 状态机</span>
    <span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 当前选中的点（用于连线起点）</span>
    <span class="hljs-keyword">this</span>.hovered = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 鼠标悬停的点</span>
    <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">false</span>; <span class="hljs-comment">// 预留给未来拖拽用</span>
    <span class="hljs-keyword">this</span>.mouse = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 当前鼠标位置</span>

    <span class="hljs-comment">// 启动监听</span>
    <span class="hljs-keyword">this</span>.#addEventListeners();
  }

  #addEventListeners() {
    <span class="hljs-comment">// 1. 鼠标按下事件</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousedown"</span>, (evt) =&gt; {
      <span class="hljs-comment">// 只有左键(0)和右键(2)才处理</span>
      <span class="hljs-keyword">if</span> (evt.button == <span class="hljs-number">2</span>) {
        <span class="hljs-comment">// 右键逻辑</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected) {
          <span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>; <span class="hljs-comment">// 取消当前选中，停止连线</span>
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hovered) {
          <span class="hljs-keyword">this</span>.#removePoint(<span class="hljs-keyword">this</span>.hovered); <span class="hljs-comment">// 删除点</span>
        }
      }

      <span class="hljs-keyword">if</span> (evt.button == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// [新增] 如果视口正在被拖拽，或者是空格按下状态，不要画点</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.viewport.drag.active || <span class="hljs-keyword">this</span>.viewport.isSpacePressed) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 左键逻辑</span>
        <span class="hljs-comment">// 如果鼠标在某个点上，就选中它；如果不在，就新建一个点并选中它</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hovered) {
          <span class="hljs-keyword">this</span>.#select(<span class="hljs-keyword">this</span>.hovered);
          <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">true</span>;
          <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">this</span>.graph.tryAddPoint(<span class="hljs-keyword">this</span>.mouse);
        <span class="hljs-keyword">this</span>.#select(<span class="hljs-keyword">this</span>.mouse); <span class="hljs-comment">// 自动选中新点，方便连续画线</span>
        <span class="hljs-keyword">this</span>.hovered = <span class="hljs-keyword">this</span>.mouse;
        <span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">true</span>;
      }
    });

    <span class="hljs-comment">// 2. 鼠标移动事件</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mousemove"</span>, (evt) =&gt; {
      <span class="hljs-comment">// 获取鼠标在 Canvas 里的坐标（即使 Canvas 缩放或偏移也能用）</span>
      <span class="hljs-comment">// 这里先简化处理，假设 Canvas 铺满或者无偏移</span>
      <span class="hljs-comment">// 实际上我们应该写个 getViewportPoint，但暂时先直接读取 offsetX/Y</span>
      <span class="hljs-keyword">this</span>.mouse = <span class="hljs-keyword">this</span>.viewport.getMouse(evt);

      <span class="hljs-comment">// 检查鼠标有没有悬停在某个点上</span>
      <span class="hljs-keyword">this</span>.hovered = <span class="hljs-keyword">this</span>.#getNearestPoint(<span class="hljs-keyword">this</span>.mouse);

      <span class="hljs-comment">// 移动的时候不需要重绘吗？需要的，但我们会在 World 里统一驱动动画循环</span>
    });

    <span class="hljs-comment">// 3. 禁止右键菜单弹出</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"contextmenu"</span>, (evt) =&gt; evt.preventDefault());

    <span class="hljs-comment">// 4. 鼠标抬起（结束拖拽状态）</span>
    <span class="hljs-keyword">this</span>.canvas.addEventListener(<span class="hljs-string">"mouseup"</span>, () =&gt; (<span class="hljs-keyword">this</span>.dragging = <span class="hljs-literal">false</span>));
  }

  #select(point) {
    <span class="hljs-comment">// 如果之前已经选中了一个点，现在又选了一个点，说明要连线</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected) {
      <span class="hljs-comment">// 尝试添加线段</span>
      <span class="hljs-keyword">this</span>.graph.tryAddSegment(new Segment(<span class="hljs-keyword">this</span>.selected, point));
    }
    <span class="hljs-keyword">this</span>.selected = point;
  }

  #removePoint(point) {
    <span class="hljs-keyword">this</span>.graph.removePoint(point);
    <span class="hljs-keyword">this</span>.hovered = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected == point) {
      <span class="hljs-keyword">this</span>.selected = <span class="hljs-literal">null</span>;
    }
  }

  <span class="hljs-comment">// 辅助函数：找离鼠标最近的点</span>
  #getNearestPoint(point, minThreshold = <span class="hljs-number">15</span>) {
    let nearest = <span class="hljs-literal">null</span>;
    let minDist = Number.MAX_SAFE_INTEGER;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> p of <span class="hljs-keyword">this</span>.graph.points) {
      <span class="hljs-keyword">const</span> dist = Math.hypot(p.x - point.x, p.y - point.y);
      <span class="hljs-keyword">if</span> (dist &lt; minThreshold &amp;&amp; dist &lt; minDist) {
        minDist = dist;
        nearest = p;
      }
    }
    <span class="hljs-keyword">return</span> nearest;
  }

  <span class="hljs-comment">// 专门负责画编辑器相关的 UI（比如高亮、虚线）</span>
  display() {
    <span class="hljs-keyword">this</span>.graph.draw(<span class="hljs-keyword">this</span>.ctx);

    <span class="hljs-comment">// 如果有悬停的点，画个特殊的样式</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hovered) {
      <span class="hljs-keyword">this</span>.hovered.draw(<span class="hljs-keyword">this</span>.ctx, { outline: <span class="hljs-literal">true</span> });
    }

    <span class="hljs-comment">// 如果有选中的点，也高亮一下</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.selected) {
      <span class="hljs-comment">// 获取鼠标位置作为意图终点</span>
      <span class="hljs-keyword">const</span> intent = <span class="hljs-keyword">this</span>.hovered ? <span class="hljs-keyword">this</span>.hovered : <span class="hljs-keyword">this</span>.mouse;
      <span class="hljs-comment">// 画出“虚拟线条”：从选中点 -&gt; 鼠标位置</span>
      new Segment(<span class="hljs-keyword">this</span>.selected, intent).draw(<span class="hljs-keyword">this</span>.ctx, {
        color: <span class="hljs-string">"rgba(0,0,0,0.5)"</span>,
        width: <span class="hljs-number">1</span>,
        dash: [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>],
      });
      <span class="hljs-keyword">this</span>.selected.draw(<span class="hljs-keyword">this</span>.ctx, { outline: <span class="hljs-literal">true</span>, outlineColor: <span class="hljs-string">"blue"</span> });
    }
  }
}

</code></pre>
<h3 data-id="heading-6">4.3. 重构 <code>World</code>：应用视口变换</h3>
<p>最后，去 <code>index.js</code> 把这一切串起来。Canvas 的变换（Translate）需要包裹在 <code>save()</code> 和 <code>restore()</code> 之间，否则你的 UI（如果有的话）也会跟着一起跑。</p>
<p>修改 <code>src/index.js</code>：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> Point2D from <span class="hljs-string">"./primitives/point2D.js"</span>;
<span class="hljs-keyword">import</span> Segment from <span class="hljs-string">"./primitives/segment.js"</span>;
<span class="hljs-keyword">import</span> Graph from <span class="hljs-string">"./math/graph.js"</span>;
<span class="hljs-keyword">import</span> GraphEditor from <span class="hljs-string">"./editors/graphEditor.js"</span>;
<span class="hljs-keyword">import</span> Viewport from <span class="hljs-string">"./view/viewport.js"</span>; <span class="hljs-comment">// 引入新成员</span>

export default <span class="hljs-keyword">class</span> <span class="hljs-title class_">World</span> {
  <span class="hljs-keyword">constructor</span>(canvas, width = <span class="hljs-number">600</span>, height = <span class="hljs-number">600</span>) {
    <span class="hljs-keyword">this</span>.canvas = canvas;
    <span class="hljs-keyword">this</span>.ctx = canvas.getContext(<span class="hljs-string">"2d"</span>);
    <span class="hljs-keyword">this</span>.canvas.width = width;
    <span class="hljs-keyword">this</span>.canvas.height = height;

    <span class="hljs-keyword">this</span>.graph = new Graph();
    <span class="hljs-comment">// 1. 先初始化视口</span>
    <span class="hljs-keyword">this</span>.viewport = new Viewport(<span class="hljs-keyword">this</span>.canvas);
    <span class="hljs-comment">// 2. 把视口传给编辑器</span>
    <span class="hljs-keyword">this</span>.editor = new GraphEditor(<span class="hljs-keyword">this</span>.canvas, <span class="hljs-keyword">this</span>.graph, <span class="hljs-keyword">this</span>.viewport);

    <span class="hljs-keyword">this</span>.animate();
  }

  animate() {
    <span class="hljs-keyword">this</span>.ctx.clearRect(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.canvas.width, <span class="hljs-keyword">this</span>.canvas.height);

    <span class="hljs-comment">// [核心步骤] 保存当前状态 -&gt; 移动画布 -&gt; 画画 -&gt; 恢复状态</span>
    <span class="hljs-keyword">this</span>.ctx.save();
    
    <span class="hljs-comment">// 获取视口当前的偏移，并应用平移变换</span>
    <span class="hljs-comment">// 注意：这里我们用 scale(1/zoom) 是为了配合鼠标计算，暂时还没做缩放，</span>
    <span class="hljs-comment">// 但我们可以把 translate 先写好</span>
    <span class="hljs-keyword">const</span> offset = <span class="hljs-keyword">this</span>.viewport.getOffset();
    <span class="hljs-keyword">this</span>.ctx.translate(offset.x, offset.y);
    
    <span class="hljs-comment">// 所有的绘制现在都在"移动后"的坐标系里进行了</span>
    <span class="hljs-keyword">this</span>.editor.display();
    
    <span class="hljs-keyword">this</span>.ctx.restore();

    requestAnimationFrame(() =&gt; <span class="hljs-keyword">this</span>.animate());
  }
}
</code></pre>
<hr/>
<h2 data-id="heading-7">大概示意图</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7198ab4ff5444e18ac2bf805b5122f5e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aSn5oCqdg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765804929&amp;x-signature=j9FCEAPUwUNYv0tr0I8EtGlYFeA%3D" alt="image.png" loading="lazy"/></p>
<p>嗯....NICE！</p>
<p>今天就这样了。</p>
<p>完整代码戳这里：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FFloat-none%2FJS-Genesis%2Ftree%2Fmain%2F04" target="_blank" title="https://github.com/Float-none/JS-Genesis/tree/main/04" ref="nofollow noopener noreferrer">github.com/Float-none/…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[长上下文、Agent记忆、Text2SQL中，谁会取代RAG？]]></title>    <link>https://juejin.cn/post/7581359420391686171</link>    <guid>https://juejin.cn/post/7581359420391686171</guid>    <pubDate>2025-12-08T13:42:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581359420391686171" data-draft-id="7581406561685372974" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="长上下文、Agent记忆、Text2SQL中，谁会取代RAG？"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-08T13:42:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            长上下文、Agent记忆、Text2SQL中，谁会取代RAG？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T13:42:31.000Z" title="Mon Dec 08 2025 13:42:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>长上下文处理能力、Agent的记忆机制、Text2SQL技术的演进，是否终将取代RAG？</p>
<p>换句话来说：RAG是否仅是技术演进中的"阶段性方案"？</p>
<p>近两年，业界对此的争议持续不断。支持替代的一方认为，随着上下文容量扩展、Agent智能水平提升、数据库交互效率优化，RAG的淘汰已成必然；而反对者则主张，RAG将如同搜索引擎般，成为AI基础设施的核心支柱。</p>
<p>让我们系统性地对比分析：将长上下文、Agent记忆、Text2SQL与RAG置于同一框架下，逐一评估其技术特性与适用场景。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a4b6d49f52d4bac8801379508331e80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765806151&amp;x-signature=czet9JfNqC2JGZgnt%2BCCele5baE%3D" alt="图片" loading="lazy"/></p>
<p><strong>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</strong></p>
<p><strong>一、先承认一个前提：LLM 有“原罪”</strong></p>
<p>所有后续的技术，本质上都在为大模型"查漏补缺"。</p>
<p>尽管LLM能力卓越，仍存在三个固有缺陷：</p>
<p><strong>‌1.幻觉问题‌</strong></p>
<p>表现为高度确信却输出虚构内容。</p>
<p>本质定义：生成内容与事实存在偏差，或缺乏可信依据支撑。</p>
<p><strong>‌2.上下文容量瓶颈</strong>（注意力衰减）‌</p>
<p>从理论看，扩展上下文本应增强记忆能力，但实际存在临界点：</p>
<p>当文本过长时，模型注意力会显著分散，导致后续内容对前文的理解逐渐淡化。</p>
<p>扩展上下文不等于"永久记忆"，而是"容量增加但浓度降低的记忆体"。</p>
<p><strong>‌3.知识边界固化‌</strong></p>
<p>模型的知识体系源自训练数据：公开网络信息+开放数据集。</p>
<p>由此衍生两大局限：</p>
<p>未涵盖非公开数据（企业专有知识库、内部文档等）</p>
<p>时效性滞后：训练截止日期后的新事件完全超出认知范围</p>
<p>因此，核心挑战始终是：</p>
<p>如何在不全量重训的条件下，使模型具备"实时更新的"、"专属领域的"、"系统化的"知识，同时最大限度减少虚构输出？</p>
<p>RAG技术、扩展上下文、智能体记忆机制、Text2SQL等，均为该问题提供了差异化解决方案。</p>
<p><strong>二、RAG 到底在解决什么问题？</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64cc9eccc68e416990c37b7d0153c76e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765806151&amp;x-signature=Saiz7tkXTh8pVmgYrXEsPAYK9RM%3D" alt="图片" loading="lazy"/></p>
<p><strong>一句话概括</strong>：‌</p>
<p>RAG（Retrieval-Augmented Generation）= 检索 + 生成，即在向模型提问前，先从数据中筛选相关内容，再基于这些信息生成回答。</p>
<p>‌详细说明：‌</p>
<p>‌1.<strong>定位与作用‌</strong></p>
<p>RAG是大语言模型（LLM）的补充而非替代，其核心是为模型提供‌上下文支持‌，确保回答基于可信资料。</p>
<p>方法论属性：属于技术架构设计，非特定模型或产品。</p>
<p>示例类比：提问时，先检索“地球自转”的百科段落作为Prompt背景，再要求模型结合内容作答。</p>
<p><strong>2‌.技术优势‌</strong></p>
<p>‌减少幻觉‌：模型优先参考用户提供的文档，而非依赖自身知识库（可设定“严格基于文档回答”规则）。</p>
<p>‌扩展知识源‌：支持企业文档、数据库、PDF等外部数据接入。</p>
<p>‌动态更新‌：数据更新后通过重新索引即时生效，无需重新训练模型。</p>
<p>‌透明可审计‌：可追溯回答的原始文档及段落，满足企业合规需求。</p>
<p>‌低成本部署‌：仅需在现有模型外叠加检索逻辑，无需微调或再训练。</p>
<p><strong>三、RAG vs 微调：它们不是对立面</strong></p>
<p>许多团队初期最常提出的疑问是：‌"究竟该选择RAG，还是直接对现有模型进行微调？"‌</p>
<p>核心结论：RAG与微调本质上是协同而非对立的关系，绝大多数业务场景会优先部署RAG方案。</p>
<p>从多维度对比分析：</p>
<p>‌1.<strong>幻觉控制‌</strong></p>
<p>微调：虽能缓解幻觉问题，但存在过拟合风险；在事实性问答中表现不稳定。</p>
<p>RAG：通过直接引用"原始资料"实现更稳定的幻觉抑制。</p>
<p><strong>‌2.知识整合机制‌</strong></p>
<p>微调：将知识固化至模型参数内部。</p>
<p>RAG：构建外部知识库实现动态检索调用。</p>
<p><strong>‌3.更新效率‌</strong></p>
<p>微调：每次知识更新都需重新训练或增量训练。</p>
<p>RAG：仅需更新索引库，耗时通常为分钟级至秒级。</p>
<p><strong>‌4.个性化适配‌</strong></p>
<p>微调：更适用于调整输出风格（如编程规范、客服话术等）。</p>
<p>RAG：更高效整合业务领域专业知识。</p>
<p><strong>5‌.决策透明度‌</strong></p>
<p>微调：模型内部决策过程不可见。</p>
<p>RAG：可追溯引用文档的具体内容片段。</p>
<p><strong>6‌.资源消耗‌</strong></p>
<p>微调：训练成本高昂，推理延迟与原模型相当。</p>
<p>RAG：因增加检索-排序流程会略微提升端到端延迟。</p>
<p>行业实践建议：</p>
<p>"‌先实施RAG验证效果，待系统稳定运行后，再通过微调优化输出风格与格式‌"的渐进式策略最为常见。</p>
<p><strong>四、RAG 的基本模型：5 个阶段讲清楚</strong></p>
<p>RAG系统的五个核心阶段‌</p>
<p><strong>1.数据加载</strong>（Loading）</p>
<p>功能：整合多源数据输入</p>
<p>支持格式：PDF/Word文档、网页内容、数据库记录、API接口数据等</p>
<p>核心组件：</p>
<p>节点（Node）：文本分块后的最小处理单元</p>
<p>连接器（Connector）：实现不同数据源的标准接入</p>
<p><strong>2.索引构建</strong>（Indexing）</p>
<p>目标：建立高效检索机制</p>
<p>关键技术：</p>
<p>索引（Index）：结构化检索目录</p>
<p>嵌入（Embedding）：文本向量化转换</p>
<p><strong>3.数据存储</strong>（Storage）</p>
<p>存储内容：文本节点、向量表示、元数据</p>
<p>典型方案：Elasticsearch、OpenSearch、Pinecone、Chroma等</p>
<p><strong>4.查询处理</strong>（Querying）</p>
<p>执行流程：</p>
<p>检索器（Retriever）：向量库匹配候选节点</p>
<p>路由器（Router）：确定检索策略、判断是否需要结构化查询、决定是否调用特定Agent</p>
<p>节点后处理器（Node Post-Processor）：结果去重、内容合并、信息扩展</p>
<p>响应合成器（Response Synthesizer）：组合检索结果与用户问题、生成LLM输入Prompt</p>
<p><strong>5.系统评估</strong>（Evaluation）</p>
<p>方法：构建标准问答测试集</p>
<p>评估维度：检索准确率、分块合理性、Prompt有效性</p>
<p>迭代优化：持续调整系统参数</p>
<p><strong>五、RAG 的技术体系和评估指标</strong></p>
<p>检索部分评估</p>
<p>基础检索指标（衡量"检索准确度"）：</p>
<p>‌Precision（精准率）‌：系统返回结果中正确答案的占比。</p>
<p>‌Recall（召回率）‌：所有正确答案中被系统检索到的比例。</p>
<p>‌F1 Score‌：综合精准率与召回率的平衡指标。</p>
<p>排序优化指标（衡量"结果排序质量"）：</p>
<p>‌MRR（Mean Reciprocal Rank）‌：正确答案排名越靠前得分越高。</p>
<p>‌MAP（Mean Average Precision）‌：多查询场景下的平均精确率均值。</p>
<p>‌NDCG‌：对排名靠前的相关文档赋予更高权重。</p>
<p>核心评估维度：</p>
<p>"检索内容对后续回答的支撑作用如何？"</p>
<p>生成结果评估（大模型回答质量）</p>
<p>‌Correctness‌：与标准答案的符合度</p>
<p>‌Relevance‌：对用户问题的贴合程度</p>
<p>‌Logic‌：论证结构的严谨性</p>
<p>‌Style‌：文本长度、语气与品牌调性的匹配</p>
<p>生成过程评估（细粒度指标）</p>
<p>‌Faithfulness‌：回答严格基于检索内容</p>
<p>‌Noise Robustness‌：过滤无关信息的能力</p>
<p>‌Negative Rejection‌：对未知问题的坦诚响应</p>
<p>‌Info Integration‌：多源信息整合能力</p>
<p>‌Counterfactual Robustness‌：抵御错误假设干扰</p>
<p>这些指标共同定义了RAG系统在实际应用中的可靠性水平。</p>
<p><strong>六、长上下文、Agent 记忆、Text2SQL 各自的定位</strong></p>
<p>核心问题回归：‌</p>
<p>这些技术能否真正取代RAG？我们逐一分析。</p>
<p><strong>1‌.长上下文技术</strong>（Long Context）‌</p>
<p>‌核心价值：‌扩展模型单次对话的信息承载量，例如完整解析多页文档或复杂合同。</p>
<p>‌替代RAG的可能性：‌</p>
<p>有限，主要受制于三点：</p>
<p>‌注意力衰减‌：当上下文扩展至数十万token时，模型对远端内容的敏感度会显著降低。</p>
<p>‌非智能筛选‌：该技术仅提供"容量扩展"功能，关键内容筛选仍需人工决策——包括输入内容的选择与排序逻辑，这本质上仍是检索需求的转移。</p>
<p>‌经济性限制‌：大规模上下文推理成本高昂，多数业务场景难以承担。</p>
<p>‌实际应用定位：‌</p>
<p>更适合作为RAG的补充模块，例如：</p>
<p>对RAG预筛选的文档进行深度分析（如长报告摘要、代码库解析）。</p>
<p>作为"增强组件"辅助RAG完成复杂任务。</p>
<p><strong>‌2.Agent记忆系统‌</strong></p>
<p>‌核心价值：‌维护对话连续性，保留用户偏好与任务状态（如写作风格、已确认信息）。</p>
<p>‌替代RAG的不可行性：‌</p>
<p>两者功能维度截然不同：</p>
<p>‌Agent记忆‌：聚焦对话进程管理（如已上传文件、用户选择方案）。</p>
<p>‌RAG‌：专注外部知识库的接入与检索（如企业制度、产品文档）。</p>
<p>‌协同应用场景：‌</p>
<p>Agent将对话上下文（如查询项目/客户）作为检索条件，驱动RAG获取精准数据。</p>
<p>在多轮对话中自动补全背景信息，避免重复描述。</p>
<p><strong>3‌.Text2SQL技术‌</strong></p>
<p>‌核心价值：‌将自然语言查询转换为结构化数据库操作（如"查询2024年10月订单总额"→自动生成SQL→返回精确结果）。</p>
<p>‌替代RAG的边界：‌</p>
<p>在结构化数据查询场景中，其效果优于"文本检索+生成"模式。</p>
<p>但无法覆盖非结构化知识（如规章制度、技术文档）的处理需求。</p>
<p>‌系统集成视角：‌</p>
<p>可作为RAG体系的专用检索后端，由路由机制判断优先调用知识库（向量检索）或数据库（Text2SQL），最终综合输出结果。</p>
<p><strong>七、回到开头的问题：RAG 会被替代吗？</strong></p>
<p>若拆解各项技术的核心定位，可清晰识别其差异化价值：</p>
<p>‌长上下文‌：突破"单次交互的信息容量限制"</p>
<p>‌Agent记忆‌：实现"跨对话轮次的上下文延续"</p>
<p>‌Text2SQL‌：构建"自然语言与结构化数据的桥梁"</p>
<p>‌RAG‌：完成"多源异构知识的智能筛选与整合"</p>
<p>这些能力呈正交关系，共同构成技术矩阵而非替代选项。</p>
<p>面向实际落地的系统架构将呈现以下特征：</p>
<p>知识增强模块（向量检索+文本RAG）、超长文本解析能力、对话状态管理机制、结构化查询接口（Text2SQL+API联动）、可选的特征微调层</p>
<p>由此可推导：RAG作为基础设施层的地位不会动摇，其演进将聚焦于：</p>
<p>技术实现路径创新、效果评估标准优化、与其他组件的协同范式</p>
<p><strong>八、如果你在团队里落地 RAG，可以从哪几步开始？</strong></p>
<p>实操建议推进步骤：‌</p>
<p><strong>1‌.优先确定应用场景‌</strong></p>
<p>明确需求类型：是常见问题解答（FAQ）、企业知识库检索，还是内部文档智能助手？不同场景需匹配差异化的检索策略与评估标准。</p>
<p><strong>2‌.快速构建最小可行产品</strong>（MVP）‌</p>
<p>工具选择：</p>
<p>直接采用可视化平台（如QAnything、Dify、Ragflow）降低开发门槛</p>
<p>或通过LlamaIndex/LangChain框架结合FastAPI/Gradio搭建轻量Demo</p>
<p>核心验证目标：</p>
<p>数据可用性、检索准确率、终端用户操作友好性、建立早期评估机制‌</p>
<p>创建标准化测试问题集，定期进行效果回溯</p>
<p>关键指标监控：</p>
<p>文档召回率与精确度（Recall/Precision、NDCG）</p>
<p>回答与原文一致性（Faithfulness）及幻觉控制（Correctness）</p>
<p><strong>3‌.渐进式功能扩展‌</strong></p>
<p>当场景复杂度提升时，逐步集成：</p>
<p>智能体（Agent）自动化流程、Text2SQL数据查询能力、长上下文理解技术</p>
<p>示例应用：用户请求"分析某产品近三月销售数据并结合策略文档输出建议"时，可组合Text2SQL数据提取+RAG文档检索+LLM综合分析能力。</p>
<p><strong>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[npm几个实用命令]]></title>    <link>https://juejin.cn/post/7581306080434667571</link>    <guid>https://juejin.cn/post/7581306080434667571</guid>    <pubDate>2025-12-08T12:17:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581306080434667571" data-draft-id="7581004702945132571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="npm几个实用命令"/> <meta itemprop="keywords" content="NPM,前端"/> <meta itemprop="datePublished" content="2025-12-08T12:17:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="168169"/> <meta itemprop="url" content="https://juejin.cn/user/2541726614191528"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            npm几个实用命令
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2541726614191528/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    168169
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:17:24.000Z" title="Mon Dec 08 2025 12:17:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>最近接到公司安全团队的项目风险表格，列出了当前前端项目的一些安全风险，大概有190多项，第一个大坨是XSS的，第二大坨就是npm包需要升级的，看了下，需要升级的大概有55个包，最近在做这些包升级的时候发现了NPM以前很少用，但是确是很实用的几个命令，特记录分享</p>
<h2 data-id="heading-1">实用命令</h2>
<h3 data-id="heading-2">npm install package@version</h3>
<p>此命令相对其它要介绍的几个命令应该是使用率算高的，它的功能就是指定安装特定的版本
先来看一下package.json版本规则符号对比表：</p>















































<table><thead><tr><th>符号</th><th>示例</th><th>允许的版本范围</th><th>核心场景</th></tr></thead><tbody><tr><td>无符号</td><td><code>1.4.2</code></td><td>仅 <code>1.4.2</code></td><td>版本敏感，禁止任何更新</td></tr><tr><td>^（插入号）</td><td><code>^1.4.2</code></td><td>1.4.2 → 1.9.9（主版本不变）</td><td>日常依赖，自动更功能/修复</td></tr><tr><td>~（波浪号）</td><td><code>~1.4.2</code></td><td>1.4.2 → 1.4.9（仅修订号更新）</td><td>保守更新，仅接受 bug 修复</td></tr><tr><td>&gt;/&lt;</td><td><code>&gt;=1.4.2 &lt;3.0.0</code></td><td>1.4.2 → 2.9.9</td><td>精确控制版本区间</td></tr><tr><td>*（星号）</td><td><code>1.*</code></td><td>1.0.0 → 1.999.999</td><td>无版本依赖（极少用）</td></tr><tr><td>!（感叹号）</td><td><code>&gt;=1.4.0 !1.4.2</code></td><td>1.4.0、1.4.1、1.4.3+（排除 1.4.2）</td><td>禁止有问题的版本</td></tr></tbody></table>
<p>如果你使用普通的npm install package，那它在package.json里写入的版本规则是第二项，如项目有lock文件的时候问题不大，但是没有的时候，你执行npm i，它会在可允许的范围内主动更新版本，如果你使用npm install package@version，那写入package.json的版本规则会是第一种，此次安全团队给出了要更新到的指定版本，所以在此处我选择的通过npm install package@version来实现安装指定版本并锁死版本号
使用示例:</p>
<pre><code class="hljs language-css" lang="css">npm install sass<span class="hljs-keyword">@1</span>.94.2
</code></pre>
<h3 data-id="heading-3">npm ls package [--depth=0]</h3>
<p>此命令用于查看你当前项目安装的package版本是多少，它会列出安装的所有的版本，此处我们以vue包为例，执行如下命令</p>
<pre><code class="hljs language-bash" lang="bash">npm <span class="hljs-built_in">ls</span> vue
</code></pre>
<p>控制台会看到如下输出结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3263a6b1d2dd406fa3002a81d36a7844~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=w1isBF9XzT6jo3NabVLJQmShd1g%3D" alt="image.png" loading="lazy"/></p>
<p>从上图我们还看到部分包后还带有deduped的灰色字，这个的意思是“去重” 的意思，是 de-duplicated 的缩写，代表这个包是 “重复依赖被合并后，复用了已安装的版本”，核心是 npm 优化依赖树的一种机制，当项目中多个依赖同时需要同一个包（且版本兼容）时，npm 会自动把重复的包合并到依赖树的更上层（比如根目录的 node_modules），避免重复安装。此时在 npm ls 中，被合并的重复包就会标注 deduped，表示 “这个包没单独装，而是复用了其他地方已有的版本”
上面命令还有一个可选参数就是--depth，控制依赖树的显示层级，避免默认npm ls输出过于冗长，用的不多，看二个例子:</p>
<ul>
<li>npm ls vue --depth=0 只显示项目直接依赖（不显示子依赖）</li>
<li>npm ls vue --depth=1 显示直接依赖 + 一级子依赖</li>
</ul>
<h3 data-id="heading-4">npm explain package</h3>
<p>精准解释某个包被安装的原因（谁依赖它、依赖版本范围、安装路径），解决「明明没手动安装，却出现在node_modules」的困惑，个人感觉这个命令和上面ls有一点相似，都可以查看当前包安装了什么版本，哪一个版本被安装是因为哪一个依赖，我们还是以vue包来例</p>
<pre><code class="hljs">npm explain vue
</code></pre>
<p>在命令行看到如下结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf2fbe6f705d461f888f45462e4ab6ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=CMAirSEB3xBk0UZtjcQe3D7IsOc%3D" alt="image1.png" loading="lazy"/></p>
<h3 data-id="heading-5">npm view package [version[s]]</h3>
<p>此命令就是查看package包线上可用的版本,分带versiont和不带version，version又有分带不带s，</p>
<ul>
<li>不带version,从npm官方仓库（或当前配置的镜像源）中查询vue包的公开信息</li>
<li>带version，并且带s就是列出所有可用历史版本</li>
<li>带version，不带s就是当前最新的稳定可用版本
此处我们还是以vue包为例：</li>
</ul>

<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">view</span> vue
</code></pre>
<p>控制台输出如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/30e1d98a707a4d3891d2cdfc53d506ee~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=aWOXRRjIVZn3NlIuHZnIdh2R9Nc%3D" alt="image2.png" loading="lazy"/></p>
<p>此命令还可以指定版本号，使用方式是npm view vue@version，就是查看指定版本的公开信息，这个命令给我的感觉就是在命令行中打开vue包的npm简版详情页</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">view</span> vue versions
</code></pre>
<p>控制台会看到如下输出结果：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/035b66367b03477d9291856eb03f8021~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=eNN4aWAfHbUsNi6m5TKx5%2Fzse24%3D" alt="image3.png" loading="lazy"/></p>
<p>如果不带s,控制台输出如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc5508b76ed44c06a5c9a06aef98fd81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=jvEfLTbhDd5yUJGy6voe%2FOOgkGE%3D" alt="image4.png" loading="lazy"/></p>
<h3 data-id="heading-6">npm view package[@version] dependencies [--json]</h3>
<p>此命令就是上面npm view的另一种用法，它可以查看当前包当指版本的生产依赖和开发依赖，为什么单提出来说了，因为这个是我这一次用的最多的命令，因为安全团队给的需要你做升级的包里，它并不是当前项目的直接依赖，很多都是二级或者三级依赖，如果你要升三级依赖，那你就得去查看祖先级包哪一个版本可以让你这个依赖升级，单提出来的另一个原因是它还有一个在线web工具
此处我们还是以vue包为例：</p>
<pre><code class="hljs language-sql" lang="sql">npm <span class="hljs-keyword">view</span> vue dependencies <span class="hljs-comment">--json</span>
</code></pre>
<p>命令行输出如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64002b044c1043488946ef7428947ce0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=4Ho8Moa1aKmKhQ2HFKqomd2FUNM%3D" alt="image5.png" loading="lazy"/></p>
<p>它有在线版本：<a href="https://link.juejin.cn?target=https%3A%2F%2Fnpmgraph.js.org%2F" target="_blank" title="https://npmgraph.js.org/" ref="nofollow noopener noreferrer">npmgraph.js.org/</a>
使用体验如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cc8c666eb5b940e284c4306b9ab22879~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMTY4MTY5:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801044&amp;x-signature=nHeujxPXjIOQtjCbyZgToKIWzFE%3D" alt="image6.png" loading="lazy"/></p>
<p>一开始我是使用上在命令行查看的，后面发现这个在线的工具后，就使用的都是这个在线的工具了，顺便说个题外话，如果同样的功能可以通过cli来用，也可以通过GUI来用，你通常会选择哪一个来用了？当然，我是后者，你了？</p>
<h2 data-id="heading-7">小结</h2>
<p>对于做前端开发的我们基本每天都有在用NPM命令，但是还是有很多好用的功能是没有发现的，所以我一直都很敬畏技术，就像我写个人简历我觉得我自己掌握了的技术我敢用的二个字就是熟练，从来不敢用精通，因为精通一个东西真的不是那么容易的
个人的知识和能力是有限度，你在使用npm的时候有没有发现其它的一些好用的但是使用不太高频的功能，期待你的留言分享，一起学习一起进步</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[数据会说谎？三大推断方法帮你“审问”数据真相]]></title>    <link>https://juejin.cn/post/7581097111896571958</link>    <guid>https://juejin.cn/post/7581097111896571958</guid>    <pubDate>2025-12-08T12:26:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896571958" data-draft-id="7581117416811610155" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" 数据会说谎？三大推断方法帮你“审问”数据真相"/> <meta itemprop="keywords" content="Python,数据分析,后端"/> <meta itemprop="datePublished" content="2025-12-08T12:26:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="databook"/> <meta itemprop="url" content="https://juejin.cn/user/3526889035006702"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             数据会说谎？三大推断方法帮你“审问”数据真相
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3526889035006702/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    databook
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:26:42.000Z" title="Mon Dec 08 2025 12:26:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>很多刚入行甚至想入行数据分析的朋友，往往会陷入一个<strong>误区</strong>：以为数据分析就是不停地<strong>做报表</strong>、<strong>画饼图</strong>。</p>
<p>其实，数据分析的核心魅力在于 <strong>“推断”——即见微知著</strong>。</p>
<p>在现实生活中，我们很难获取“全量数据”（比如你不可能调查全国每一个人的身高），那么，如何通过手中的“小样本”去推测“大总体”的规律？</p>
<p>这就需要用到统计学中的<strong>推断分析</strong>。</p>
<p>本文将结合代码来介绍<strong>推断分析</strong>中最常用的三大方法：<strong>参数估计</strong>、<strong>假设检验</strong>、<strong>非参数检验</strong>。</p>
<h2 data-id="heading-0">1. 参数估计</h2>
<p>想象你在煮一锅排骨汤。你想知道汤咸不咸，你不会把整锅汤都喝完，而是舀起一勺尝一尝。</p>
<ul>
<li>那一勺汤就是<strong>样本</strong>。</li>
<li>那一勺的咸度就是<strong>样本统计量</strong>。</li>
<li>整锅汤的咸度就是我们要猜的<strong>总体参数</strong>。</li>
</ul>
<p><strong>参数估计</strong>就是：根据样本的特征（比如<strong>样本均值</strong>），去估计总体的特征（比如<strong>总体均值</strong>）。</p>
<p>它通常分为两种：</p>
<ul>
<li><strong>点估计</strong>：直接说“这锅汤是1.5%的盐度”。（但这很容易被打脸，因为太绝对）</li>
<li><strong>区间估计</strong>：说“这锅汤的盐度在1.4%到1.6%之间，我有95%的把握”。（这就是置信区间，更科学）</li>
</ul>
<p><strong>区间估计</strong>是最常使用的方式，下面通过一个示例来演示<strong>参数估计</strong>的具体使用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats

<span class="hljs-comment"># 1. 模拟数据</span>
np.random.seed(<span class="hljs-number">42</span>)
true_mean = <span class="hljs-number">15</span>  <span class="hljs-comment"># 上帝视角的真实均值</span>
sample_salaries = np.random.normal(loc=true_mean, scale=<span class="hljs-number">3</span>, size=<span class="hljs-number">100</span>)  <span class="hljs-comment"># 模拟100个样本</span>

<span class="hljs-comment"># 2. 计算统计量</span>
sample_mean = np.mean(sample_salaries)
sample_std = np.std(sample_salaries, ddof=<span class="hljs-number">1</span>)
n = <span class="hljs-built_in">len</span>(sample_salaries)

<span class="hljs-comment"># 计算95%置信区间</span>
<span class="hljs-comment"># 这里的 scale 使用的是标准误 (Standard Error) = 样本标准差 / sqrt(n)</span>
conf_int = stats.t.interval(
    confidence=<span class="hljs-number">0.95</span>, df=n - <span class="hljs-number">1</span>, loc=sample_mean, scale=sample_std / np.sqrt(n)
)
lower_bound, upper_bound = conf_int

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"样本均值: <span class="hljs-subst">{sample_mean:<span class="hljs-number">.2</span>f}</span>k"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"95%置信区间: [<span class="hljs-subst">{lower_bound:<span class="hljs-number">.2</span>f}</span>k, <span class="hljs-subst">{upper_bound:<span class="hljs-number">.2</span>f}</span>k]"</span>)

<span class="hljs-comment"># 运行结果：</span>
<span class="hljs-string">'''
样本均值: 14.69k
95%置信区间: [14.15k, 15.23k]
'''</span>
</code></pre>
<p>图形化之后的结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2485481dfd374b6f958cd86bf1d60464~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=jHE5ZnE12Qk9cAi9MC1r1J64vjU%3D" alt="" loading="lazy"/></p>
<p>从图中可以看出：</p>
<ol>
<li><strong>灰色的散点</strong>：是你调研的那100个数据分析师的工资。你会发现有的高有的低，散落在各地。</li>
<li><strong>蓝色的点和横线</strong>：</li>
</ol>
<ul>
<li><strong>蓝点</strong>是你算出来的样本均值（约14.67k），虽然不完全等于真实的15k，但很接近。</li>
<li><strong>蓝色的横线</strong>就是置信区间。它的含义是：“虽然我不知道确切数字，但我敢打赌，真实数字就在这根蓝线的范围内。”</li>
</ul>
<ol start="3">
<li><strong>红色的虚线</strong>：这是真实的总体均值（15k）。</li>
<li><strong>结论</strong>：你可以清楚地看到，红色的虚线确实穿过了蓝色的横线。恭喜你！这次“参数估计”成功捕获了真理！</li>
</ol>
<p>数据分析不是算命，算出来的不是一个死的数字，而是一个科学的范围。</p>
<p>我们就是用<strong>参数估计</strong>的方法，在不确定性中寻找确定性。</p>
<h2 data-id="heading-1">2. 假设检验</h2>
<p><strong>假设检验</strong>是数据分析中最常用的决策工具。它的逻辑是：<strong>先立一个Flag（假设），然后看证据（数据）是否打脸</strong>。</p>
<ul>
<li><strong>原假设</strong> ：通常代表“无事发生”、“没有变化”、“运气好”。</li>
<li><strong>备择假设</strong>：通常代表“有事发生”、“真的有效果”。</li>
<li><strong>P值</strong>：表示原假设成立时，出现当前数据的概率。P值越小，说明原假设越不靠谱（通常以0.05为界限）。</li>
</ul>
<p>下面通过一个电商APP的A/B测试场景，来演示<strong>假设检验</strong>的使用。</p>
<p>假设某电商APP想把 <strong>“购买”</strong> 按钮从 <strong>蓝色</strong> 改成 <strong>红色</strong> 。</p>
<ul>
<li><strong>原假设</strong>：红色按钮和蓝色按钮的转化率没区别（差别纯属偶然）。</li>
<li><strong>备择假设</strong>：红色按钮的转化率显著高于蓝色按钮。</li>
</ul>
<p>我们采集了两组用户的消费金额数据来进行T检验。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 模拟AB测试数据</span>
<span class="hljs-comment"># 蓝色按钮组（对照组）：平均消费 100元</span>
group_blue = np.random.normal(loc=<span class="hljs-number">100</span>, scale=<span class="hljs-number">20</span>, size=<span class="hljs-number">1000</span>)
<span class="hljs-comment"># 红色按钮组（实验组）：平均消费 105元 (我们要检验这个提升是否显著)</span>
group_red = np.random.normal(loc=<span class="hljs-number">105</span>, scale=<span class="hljs-number">25</span>, size=<span class="hljs-number">1000</span>)

<span class="hljs-comment"># 2. 进行独立样本T检验 (T-test)</span>
t_stat, p_val = stats.ttest_ind(group_blue, group_red)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"P值: <span class="hljs-subst">{p_val:<span class="hljs-number">.5</span>f}</span>"</span>)

<span class="hljs-comment"># 3. 判断结论</span>
alpha = <span class="hljs-number">0.05</span>
<span class="hljs-keyword">if</span> p_val &lt; alpha:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：拒绝原假设。红色按钮带来的消费提升是【统计显著】的，建议全量上线！"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：无法拒绝原假设。两组差异可能是误差导致的，建议维持原状。"</span>)

<span class="hljs-comment"># 运行结果：</span>
<span class="hljs-string">'''
P值: 0.00000
结论：拒绝原假设。红色按钮带来的消费提升是【统计显著】的，建议全量上线！
'''</span>
</code></pre>
<p>图形化结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/007a998a5b334cc1983d927a81d5cb52~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=m5GveoNuTzkuYjkksK1WM8NmpFY%3D" alt="" loading="lazy"/></p>
<p>从图中，我们可以看出，两条曲线（红色和蓝色）其实重叠度很高。</p>
<p>对于新手，看到这个图，可能会陷入一个误区，觉得“这两座山峰看起来差不多嘛，没啥区别”。</p>
<p>但在统计学上，两座山峰的 <strong>“重心”</strong> （均值）发生了 <strong>显著偏移</strong> 。这就是假设检验的威力--在重叠的噪声中识别出偏移的信号。</p>
<h2 data-id="heading-2">3. 非参数估计</h2>
<p>前面的 <strong>“参数估计”</strong> 和 <strong>“T检验”</strong> 都有一个娇气的脾气：它们通常假设数据是服从 <strong>“正态分布”</strong> 的（也就是漂亮的钟形曲线）。</p>
<p>但在现实生活中，很多数据并不正态，或者数据甚至是定序的（比如：非常满意、满意、一般、不满意）。</p>
<p>这时候，传统的 <strong>T检验</strong> 就失效了，我们需要请出 <strong>非参数检验</strong> 。</p>
<p>它不依赖数据的分布形状，非常抗造。</p>
<p>假设我们要对比两款手游《王者荣耀》和《原神》玩家每天的游玩时长。</p>
<p>由于《原神》玩家可能存在大量的“长尾”用户（玩特别久），数据往往是严重右偏的，不符合正态分布。</p>
<p>这时候对比两组数据差异，就不能用<strong>T检验</strong>，我们使用<strong>非参数估计</strong>中的一种方式：曼-惠特尼U检验 (Mann-Whitney U test)。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 1. 模拟非正态分布数据 (使用指数分布模拟由偏数据)</span>
<span class="hljs-comment"># 游戏A：平均时长较短</span>
game_a_hours = np.random.exponential(scale=<span class="hljs-number">1.0</span>, size=<span class="hljs-number">100</span>)
<span class="hljs-comment"># 游戏B：平均时长较长</span>
game_b_hours = np.random.exponential(scale=<span class="hljs-number">1.5</span>, size=<span class="hljs-number">100</span>)

<span class="hljs-comment"># 2. 首先，检查一下正态性 (Shapiro-Wilk检验)</span>
<span class="hljs-comment"># 如果P &lt; 0.05，说明不是正态分布</span>
_, p_norm_a = stats.shapiro(game_a_hours)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"游戏A正态性检验P值: <span class="hljs-subst">{p_norm_a:<span class="hljs-number">.4</span>f}</span> (小于0.05则非正态)"</span>)

<span class="hljs-comment"># 3. 使用非参数检验：Mann-Whitney U检验</span>
<span class="hljs-comment"># 它可以比较两个独立样本的分布是否存在差异（侧重于中位数/秩次的比较）</span>
u_stat, p_val_nonparam = stats.mannwhitneyu(game_a_hours, game_b_hours, alternative=<span class="hljs-string">'two-sided'</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Mann-Whitney U检验 P值: <span class="hljs-subst">{p_val_nonparam:<span class="hljs-number">.5</span>f}</span>"</span>)

<span class="hljs-keyword">if</span> p_val_nonparam &lt; <span class="hljs-number">0.05</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：两款游戏的玩家游玩时长分布存在显著差异。"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"结论：两款游戏玩家游玩时长无显著差异。"</span>)

<span class="hljs-comment"># 运行结果：</span>
<span class="hljs-string">'''
游戏A正态性检验P值: 0.0000 (小于0.05则非正态)
Mann-Whitney U检验 P值: 0.00003
结论：两款游戏的玩家游玩时长分布存在显著差异。
'''</span>
</code></pre>
<p>可视化结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93946f2319514f0799b428ff9ce98157~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgZGF0YWJvb2s=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801601&amp;x-signature=YIoZEwYKr5SHRNZpgn1OoZhSI24%3D" alt="" loading="lazy"/></p>
<p>尽管数据长得歪瓜裂枣（严重右偏），<strong>U检验</strong>依然稳健地告诉我们：<strong>这两组数据不一样</strong>。</p>
<p><strong>U检验</strong>比较的不仅仅是平均值，它更多是在比较 <strong>“秩次”</strong>（<code>Ranking</code>）。</p>
<p>通俗点说，它发现如果我们把两组玩家混在一起排名，<code>Game B</code>的玩家即使不看具体时长，排名也普遍比<code>Game A</code>的玩家靠前。</p>
<p>从图中来看，你会看到橙色（<code>Game B</code>）的尾巴明显比蓝色（<code>Game A</code>）拖得更长、更厚实。</p>
<p>这说明<code>Game B</code>（比如《原神》）更容易让玩家沉浸更久，或者拥有更多的重度玩家。</p>
<h2 data-id="heading-3">4. 总结</h2>
<p>恭喜你！你已经掌握了数据<strong>推断分析</strong>的核心逻辑：</p>
<ol>
<li><strong>参数估计</strong>：当你只有样本，想知道总体的数值范围时使用。（比如估算平均薪资）</li>
<li><strong>假设检验</strong>：当你数据比较“完美”（正态分布），想判断差异是不是真的时使用。（比如A/B测试）</li>
<li><strong>非参数检验</strong>：当你数据分布奇怪、或者只有排名/等级数据时使用。（比如评分对比、长尾数据分析）</li>
</ol>
<p>这<strong>三板斧</strong>是数据分析师行走江湖的必备技能。掌握了它们，你就不仅仅是一个“做表的”，而是一个能从数据中挖掘真相的“侦探”！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Agent】MemOS 源码笔记---(3)---搜索]]></title>    <link>https://juejin.cn/post/7581312433529733163</link>    <guid>https://juejin.cn/post/7581312433529733163</guid>    <pubDate>2025-12-08T12:31:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581312433529733163" data-draft-id="7577647745110425600" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Agent】MemOS 源码笔记---(3)---搜索"/> <meta itemprop="keywords" content="算法,机器学习"/> <meta itemprop="datePublished" content="2025-12-08T12:31:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="罗西的思考"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Agent】MemOS 源码笔记---(3)---搜索
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    罗西的思考
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:31:41.000Z" title="Mon Dec 08 2025 12:31:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">【Agent】MemOS 源码笔记---(3)---搜索</h2>
<h3 data-id="heading-1">0x00 摘要</h3>
<p>TreeTextMemory 提供了一个完整的记忆管理系统，能存储、组织、检索和维护各种类型的文本记忆、适用需要复杂记忆管理的AI系统。这是一个基于图的、树形明文记忆，支持以结构化方式组织、关联并检索记忆，同时保留丰富的上下文信息与良好的可解释性。我们可以通过这个TreeTextMemory 对象与庞大的知识库进行交互，为AI赋予专业的领域记忆。当前使用Neo4j作为后端，未来计划支持更多图数据库。</p>
<p>因为字数太多，因此把TreeTextMemory拆分为两部分，上一篇介绍基本概念和如何管理，本篇介绍如何搜索。</p>
<h3 data-id="heading-2">0x01 分类</h3>
<p>TreeTextMemory 主要支持几种搜索（注，有些是从其他途径透出）：</p>
<ul>
<li>
<p>混合搜索（Hybrid Search），通过 Searcher.search 方法对外提供服务，整合多种检索策略的结果，具体策略如下：</p>
<ul>
<li>结合向量相似度搜索和图遍历：在 GraphMemoryRetriever中利用图结构和向量信息</li>
<li>全文检索：虽然没有显式的全文搜索API，但可以通过互联网检索器从搜索引擎获取相关内容 InternetRetriever 组件允许集成外部搜索服务（如Google、Bing、Bocha）</li>
</ul>
</li>
<li>
<p>子图检索（Subgraph Retrieval），通过 get_relevant_subgraph 方法可以直接进行子图搜索</p>
<ul>
<li>使用 graph_store.search_by_embedding 方法获取指定节点周围的局部子图结构</li>
<li>支持设置遍历深度和中心节点状态条件</li>
<li>返回包含核心节点、邻居节点和边的完整子图信息</li>
</ul>
</li>
</ul>
<p>以下是图数据库的API，比如位于MemOS-main\src\memos\graph_dbs\nebular.py中，在一些示例中也直接使用：</p>
<ul>
<li>
<p>基于元数据的结构化查询（Metadata-based Structured Query）</p>
<ul>
<li>通过 get_by_metadata方法根据节点元数据字段进行精确匹配或条件查询</li>
<li>支持多种操作符：等于（=）、包含（contains）、在列表中（in）等</li>
<li>可以组合多个条件进行复杂查询</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>标签重叠查询（Tag Overlap Query）</p>
<ul>
<li>使用 get_neighbors_by_tag方法查找具有相似标签的相邻节点</li>
<li>通过计算标签交集大小来确定相关性</li>
<li>支持设置最小标签重叠数要求</li>
</ul>
</li>
<li>
<p>向量相似度搜索（Vector Similarity Search）</p>
<ul>
<li>基于嵌入（embedding）的语义相似度搜索</li>
<li>使用 search_by_embedding 方法根据查询向量找到最相似的记忆节点</li>
<li>支持设置相似度阈值和返回结果数量限制</li>
</ul>
</li>
</ul>
<p>其中最主要的查询接口是 search方法，它内部整合了多种检索策略来提供最优的搜索结果。</p>
<h3 data-id="heading-3">0x02 ## 混合搜索（Hybrid Search）--- Searcher</h3>
<p>Searcher 由 TreeTextMemory 创建并作为主要的搜索接口使用，Searcher 是整个记忆检索系统的核心协调者，负责整合各种检索源并提供高质量的检索结果。Searcher 类的主要功能是执行记忆检索任务。以下是其核心职责和工作流程：</p>
<ul>
<li>
<p>多路径并行检索，同时从多个来源检索相关信息：</p>
<ul>
<li>工作记忆（WorkingMemory）</li>
<li>长期记忆（LongTermMemory）</li>
<li>用户记忆（UserMemory）</li>
<li>互联网检索器（可选）</li>
<li>MemCubes（可选）</li>
</ul>
</li>
<li>
<p>任务解析与查询优化</p>
<ul>
<li>使用 TaskGoalParser 解析用户查询意图</li>
<li>根据不同模式（fast/fine）采用不同的检索策略</li>
<li>在精细模式下先进行嵌入搜索获取上下文</li>
</ul>
</li>
<li>
<p>结果重排序与去重</p>
<ul>
<li>使用 reranker 对检索结果进行重新排序</li>
<li>去除重复的记忆项</li>
<li>保留最相关的结果</li>
</ul>
</li>
<li>
<p>高级推理处理</p>
<ul>
<li>利用 MemoryReasoner 对检索到的记忆进行推理和知识综合</li>
<li>提取最有价值的信息片段</li>
</ul>
</li>
<li>
<p>使用历史追踪</p>
<ul>
<li>更新记忆项的使用历史记录</li>
<li>并发处理使用统计更新</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">2.1 定义</h4>
<pre><code class="hljs language-ini" lang="ini">class Searcher:
    def __init__(
        self,
        dispatcher_llm: OpenAILLM | OllamaLLM | AzureLLM,
        graph_store: Neo4jGraphDB,
        embedder: OllamaEmbedder,
        reranker: BaseReranker,
        internet_retriever: InternetRetrieverFactory | <span class="hljs-attr">None</span> = None,
        moscube: <span class="hljs-attr">bool</span> = <span class="hljs-literal">False</span>,
    ):
        <span class="hljs-attr">self.graph_store</span> = graph_store
        <span class="hljs-attr">self.embedder</span> = embedder
​
        <span class="hljs-attr">self.task_goal_parser</span> = TaskGoalParser(dispatcher_llm)
        <span class="hljs-attr">self.graph_retriever</span> = GraphMemoryRetriever(self.graph_store, self.embedder)
        <span class="hljs-attr">self.reranker</span> = reranker
        <span class="hljs-attr">self.reasoner</span> = MemoryReasoner(dispatcher_llm)
​
        <span class="hljs-comment"># Create internet retriever from config if provided</span>
        <span class="hljs-attr">self.internet_retriever</span> = internet_retriever
        <span class="hljs-attr">self.moscube</span> = moscube
​
        <span class="hljs-attr">self._usage_executor</span> = ContextThreadPoolExecutor(max_workers=<span class="hljs-number">4</span>, thread_name_prefix=<span class="hljs-string">"usage"</span>)
</code></pre>
<h4 data-id="heading-5">2.2 核心函数</h4>
<p>其核心方法如下：</p>
<ul>
<li>search()：主入口，协调整个检索过程</li>
<li>_parse_task()：解析任务和查询</li>
<li>_retrieve_paths()：执行多路径检索</li>
<li>_deduplicate_results()：结果去重</li>
<li>_sort_and_trim()：排序和截断结果</li>
<li>update_usage_history()：更新使用历史</li>
</ul>
<p>主入口如下，或者说Searcher 编排搜索流水线如下：</p>
<ul>
<li>查询解析和理解</li>
<li>从多个来源并行检索</li>
<li>结果重新排序</li>
<li>去重处理</li>
<li>对结果进行推理</li>
<li>使用情况跟踪</li>
</ul>

<pre><code class="hljs language-python" lang="python">    @timed
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">
        self,
        query: <span class="hljs-built_in">str</span>,
        top_k: <span class="hljs-built_in">int</span>,
        info=<span class="hljs-literal">None</span>,
        mode=<span class="hljs-string">"fast"</span>,
        memory_type=<span class="hljs-string">"All"</span>,
        search_filter: <span class="hljs-built_in">dict</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>,
    </span>) -&gt; <span class="hljs-built_in">list</span>[TextualMemoryItem]:
        <span class="hljs-string">"""
        Search for memories based on a query.
        User query -&gt; TaskGoalParser -&gt; GraphMemoryRetriever -&gt;
        MemoryReranker -&gt; MemoryReasoner -&gt; Final output
        Args:
            query (str): The query to search for.
            top_k (int): The number of top results to return.
            info (dict): Leave a record of memory consumption.
            mode (str, optional): The mode of the search.
            - 'fast': Uses a faster search process, sacrificing some precision for speed.
            - 'fine': Uses a more detailed search process, invoking large models for higher precision, but slower performance.
            memory_type (str): Type restriction for search.
            ['All', 'WorkingMemory', 'LongTermMemory', 'UserMemory']
            search_filter (dict, optional): Optional metadata filters for search results.
        Returns:
            list[TextualMemoryItem]: List of matching memories.
        """</span>
        logger.info(
            <span class="hljs-string">f"[SEARCH] Start query='<span class="hljs-subst">{query}</span>', top_k=<span class="hljs-subst">{top_k}</span>, mode=<span class="hljs-subst">{mode}</span>, memory_type=<span class="hljs-subst">{memory_type}</span>"</span>
        )
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> info:
            logger.warning(
                <span class="hljs-string">"Please input 'info' when use tree.search so that "</span>
                <span class="hljs-string">"the database would store the consume history."</span>
            )
            info = {<span class="hljs-string">"user_id"</span>: <span class="hljs-string">""</span>, <span class="hljs-string">"session_id"</span>: <span class="hljs-string">""</span>}
        <span class="hljs-keyword">else</span>:
            logger.debug(<span class="hljs-string">f"[SEARCH] Received info dict: <span class="hljs-subst">{info}</span>"</span>)
​
        parsed_goal, query_embedding, context, query = self._parse_task(
            query, info, mode, search_filter=search_filter
        )
        results = self._retrieve_paths(
            query, parsed_goal, query_embedding, info, top_k, mode, memory_type, search_filter
        )
        deduped = self._deduplicate_results(results)
        final_results = self._sort_and_trim(deduped, top_k)
        self._update_usage_history(final_results, info)
​
        logger.info(<span class="hljs-string">f"[SEARCH] Done. Total <span class="hljs-subst">{<span class="hljs-built_in">len</span>(final_results)}</span> results."</span>)
        res_results = <span class="hljs-string">""</span>
        <span class="hljs-keyword">for</span> _num_i, result <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(final_results):
            res_results += <span class="hljs-string">"\n"</span> + (
                result.<span class="hljs-built_in">id</span> + <span class="hljs-string">"|"</span> + result.metadata.memory_type + <span class="hljs-string">"|"</span> + result.memory
            )
        logger.info(<span class="hljs-string">f"[SEARCH] Results. <span class="hljs-subst">{res_results}</span>"</span>)
        <span class="hljs-keyword">return</span> final_results
</code></pre>
<h4 data-id="heading-6">2.3 依赖关系和关联关系</h4>
<h5 data-id="heading-7">2.3.1 依赖项（Searcher 依赖的组件）</h5>
<p>Searcher 依赖的组件如下：</p>
<ul>
<li>
<p>大语言模型组件：</p>
<ul>
<li>dispatcher_llm – 用于任务解析和推理</li>
<li>TaskGoalParser – 将用户查询解析为结构化目标</li>
</ul>
</li>
<li>
<p>存储组件：</p>
<ul>
<li>graph_store – Neo4j 图数据库用于存储记忆</li>
<li>GraphMemoryRetriever – 从图存储中检索记忆</li>
</ul>
</li>
<li>
<p>处理组件：</p>
<ul>
<li>embedder – 为查询和记忆创建嵌入向量</li>
<li>reranker – 对检索结果进行重新排序</li>
<li>MemoryReasoner – 对检索到的记忆进行推理</li>
<li>internet_retriever – 可选的互联网搜索功能</li>
</ul>
</li>
</ul>
<h5 data-id="heading-8">2.3.2 依赖 Searcher 的组件</h5>
<p>依赖 Searcher 的组件如下：</p>
<ul>
<li>TreeTextMemory – 在其 search 方法中使用 Searcher</li>
<li>GeneralScheduler – 通过检索器在 process_session_turn 中使用 Searcher</li>
</ul>
<h4 data-id="heading-9">2.4 图例</h4>
<p>Searcher 被调度器系统用于在查询处理过程中检索相关记忆，总的来说，Searcher 充当一个中央协调者，将各种组件整合在一起，为跨不同记忆源和外部数据提供全面的检索能力。</p>
<h5 data-id="heading-10">2.4.1 Searcher 组件关系流程图</h5>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4d979d43803436495c2d5112601d62b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801901&amp;x-signature=ASPi6KA1T8DHkJmZVPlKSM71oLY%3D" alt="Searcher 组件关系流程图" loading="lazy"/></p>
<h5 data-id="heading-11">2.4.2 Searcher 详细搜索过程流程</h5>
<p>用户查询 → TaskGoalParser 解析 → 多路径并行检索 → 结果重排序 → 去重处理 → 推理优化 → 返回最终结果。</p>
<p>各组件详细说明</p>
<p><strong>主要阶段</strong></p>
<ul>
<li>任务解析：使用 TaskGoalParser 解析查询，根据模式决定是否使用 LLM</li>
<li>并行检索：同时执行多个检索路径</li>
<li>结果重排：使用 Reranker 对各路径的结果进行重排</li>
<li>合并去重：合并所有路径的结果并去除重复项</li>
<li>排序截取：按分数排序并截取前 K 个结果</li>
<li>更新记录：更新使用历史记录</li>
</ul>
<p><strong>并行检索路径</strong></p>
<ul>
<li>路径 A：工作内存检索 (WorkingMemory)</li>
<li>路径 B：长期和用户内存检索 (LongTermMemory, UserMemory)</li>
<li>路径 C：互联网检索（可选）</li>
<li>路径 D：MemCubes 检索（可选）</li>
</ul>
<p><strong>数据流向</strong>：输入查询经过解析后，被分发到多个检索路径并行处理，每个路径都会产生一批候选结果。这些结果经过重排、合并，最后经过去重、排序和截取得到最终结果。整个过程中还会更新使用历史记录以便后续优化。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01aba941f206483ebb9f8f10fe53633e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801901&amp;x-signature=rNFzz9A6wN2jeY0MUyhnQVm5i%2Fg%3D" alt="Searcher 详细搜索过程流程" loading="lazy"/></p>
<p>用户搜索流程如下：用户查询 → TaskGoalParser 解析 → 多路径并行检索 → 结果重排序 → 去重处理 → 推理优化 → 返回最终结果。</p>
<p>其中涉及到如下组件：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f081aae6b54641a4b2bfad88d3a3de0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765801901&amp;x-signature=DgjU47dG3RRzhr9mIOuKkwe15Nc%3D" alt="搜索流程" loading="lazy"/></p>
<p>因此，我们按照如下流程进行分析。</p>
<h4 data-id="heading-12">2.5 TaskGoalParser</h4>
<p>_parse_task 方法主要是使用 TaskGoalParser 来分析query。</p>
<pre><code class="hljs language-ini" lang="ini">        <span class="hljs-attr">parsed_goal</span> = self.task_goal_parser.parse(
            <span class="hljs-attr">task_description</span>=query,
            <span class="hljs-attr">context</span>=<span class="hljs-string">"\n"</span>.join(context),
            <span class="hljs-attr">conversation</span>=info.get(<span class="hljs-string">"chat_history"</span>, []),
            <span class="hljs-attr">mode</span>=mode,
        )
</code></pre>
<p>TaskGoalParser 是一个任务目标解析器，负责将用户的自然语言查询解析为结构化的语义层表示，以便后续的检索系统能够更有效地理解和处理查询。</p>
<h5 data-id="heading-13">2.5.1 主要功能</h5>
<p>TaskGoalParser 主要功能为：</p>
<ul>
<li>
<p>查询解析。</p>
<ul>
<li>将用户输入的自然语言查询转换为结构化的查询表示</li>
<li>提供两种解析模式：快速模式（fast）和精细模式（fine）</li>
</ul>
</li>
<li>
<p>结构化语义表示</p>
<ul>
<li>将查询分解为多个语义层次：主题（topic）、关键词（keys）、标签（tags）等 提取查询的核心意图和相关信息</li>
</ul>
</li>
</ul>
<h5 data-id="heading-14">2.5.2 工作模式</h5>
<h6 data-id="heading-15">Fast 模式</h6>
<pre><code class="hljs language-ini" lang="ini">def _parse_fast(self, task_description: str, limit_num: <span class="hljs-attr">int</span> = <span class="hljs-number">5</span>) -&gt; ParsedTaskGoal:
    <span class="hljs-comment"># 快速模式：简单的分词处理</span>
    return ParsedTaskGoal(
        <span class="hljs-attr">memories</span>=[task_description],
        <span class="hljs-attr">keys</span>=[task_description],
        <span class="hljs-attr">tags</span>=[],
        <span class="hljs-attr">goal_type</span>=<span class="hljs-string">"default"</span>,
        <span class="hljs-attr">rephrased_query</span>=task_description,
        <span class="hljs-attr">internet_search</span>=<span class="hljs-literal">False</span>,
</code></pre>
<h6 data-id="heading-16">Fine 模式</h6>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_parse_fine</span>(<span class="hljs-params">
    self, query: <span class="hljs-built_in">str</span>, context: <span class="hljs-built_in">str</span> = <span class="hljs-string">""</span>, conversation: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">dict</span>] | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>
</span>) -&gt; ParsedTaskGoal:
    <span class="hljs-comment"># 精细模式：使用 LLM 进行结构化解析</span>
    <span class="hljs-comment"># 构建提示词并调用 LLM 进行解析</span>
    prompt = Template(TASK_PARSE_PROMPT).substitute(
        task=query.strip(), context=context, conversation=conversation_prompt
    )
    response = self.llm.generate(messages=[{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}])
    <span class="hljs-keyword">return</span> self._parse_response(response)
</code></pre>
<h5 data-id="heading-17">2.5.3 输出结构</h5>
<p>TaskGoalParser 解析后的结果存储在 ParsedTaskGoal 对象中，包含以下字段：</p>
<ul>
<li>memories：相关记忆项列表</li>
<li>keys：关键词列表</li>
<li>tags：标签列表</li>
<li>rephrased_query：重述的查询（更清晰的表达）</li>
<li>internet_search：是否需要联网搜索</li>
<li>goal_type：目标类型</li>
</ul>
<h5 data-id="heading-18">2.5.4 prompt</h5>
<pre><code class="hljs language-python" lang="python">TASK_PARSE_PROMPT = <span class="hljs-string">"""
You are a task parsing expert. Given a user task instruction, optional former conversation and optional related memory context,extract the following structured information:
1. Keys: the high-level keywords directly relevant to the user’s task.
2. Tags: thematic tags to help categorize and retrieve related memories.
3. Goal Type: retrieval | qa | generation
4. Rephrased instruction: Give a rephrased task instruction based on the former conversation to make it less confusing to look alone. If you think the task instruction is easy enough to understand, or there is no former conversation, set "rephrased_instruction" to an empty string.
5. Need for internet search: If the user's task instruction only involves objective facts or can be completed without introducing external knowledge, set "internet_search" to False. Otherwise, set it to True.
6. Memories: Provide 2–5 short semantic expansions or rephrasings of the rephrased/original user task instruction. These are used for improved embedding search coverage. Each should be clear, concise, and meaningful for retrieval.
​
Former conversation (if any):
"""</span>
$conversation
<span class="hljs-string">"""
​
Task description(User Question):
"""</span>$task<span class="hljs-string">"""
​
Context (if any):
"""</span>$context<span class="hljs-string">"""
​
Return strictly in this JSON format, note that the
keys/tags/rephrased_instruction/memories should use the same language as the
input query:
{
  "keys": [...],
  "tags": [...],
  "goal_type": "retrieval | qa | generation",
  "rephrased_instruction": "...", # return an empty string if the original instruction is easy enough to understand
  "internet_search": True/False,
  "memories": ["...", "...", ...]
}
"""</span>
</code></pre>
<h5 data-id="heading-19">2.5.5 优势</h5>
<p>总的来说，TaskGoalParser 在记忆检索系统中扮演着“查询理解器”的角色，通过解析用户查询为结构化表示，为后续的检索和推理过程提供更精确的输入。其优势为：</p>
<ul>
<li>灵活性：支持两种解析模式，适应不同性能和精度需求</li>
<li>结构化：将自然语言查询转换为结构化表示，便于后续处理</li>
<li>上下文感知：在精细模式下可以考虑上下文和对话历史</li>
<li>错误处理：当精细模式失败时会回退到快速模式</li>
</ul>
<h4 data-id="heading-20">2.6 GraphMemoryRetriever</h4>
<p>GraphMemoryRetriever 是一个统一的记忆检索器，结合了图结构检索和向量相似性检索两种方式，用于从知识图谱中检索相关记忆项。</p>
<h5 data-id="heading-21">2.6.1 主要功能</h5>
<p>GraphMemoryRetriever 实现混合检索，这种设计使得系统既能利用结构化信息进行精确检索，又能通过向量相似性捕获语义相关的内容，从而提高了检索的准确性和召回率。</p>
<ul>
<li>
<p>混合检索机制</p>
<ul>
<li>结构化图检索：基于解析后的任务目标（keys/tags）进行精确匹配</li>
<li>向量相似性检索：基于查询嵌入进行语义相似度搜索</li>
<li>合并两种检索结果并去重</li>
</ul>
</li>
<li>
<p>多范围记忆检索</p>
<ul>
<li>支持不同类型的记忆范围：WorkingMemory、LongTermMemory、UserMemory</li>
<li>针对不同范围采用不同的检索策略</li>
</ul>
</li>
</ul>
<h5 data-id="heading-22">2.6.2 核心方法</h5>
<ul>
<li>
<p>retrieve 方法：这是主要的检索入口，执行以下步骤：</p>
<ul>
<li>对于 WorkingMemory，直接获取所有条目；</li>
<li>对于其他记忆类型，同时执行 _graph_recall 和 _vector_recall；</li>
<li>合并结果并去除重复项。</li>
</ul>
</li>
<li>
<p>_graph_recall 方法：执行基于图结构的检索：</p>
<ul>
<li>基于 keys 进行精确匹配检索；</li>
<li>基于 tags 进行包含匹配检索；</li>
<li>对候选结果进行后过滤，确保至少有 2 个标签重叠。</li>
</ul>
</li>
<li>
<p>_vector_recall 方法：执行基于向量的相似性检索：</p>
<ul>
<li>使用查询嵌入在图数据库中搜索最相似的记忆项；</li>
<li>支持带过滤条件的搜索和不带过滤条件的搜索路径；</li>
<li>并发执行多个搜索任务以提高效率。</li>
</ul>
</li>
<li>
<p>retrieve_from_cube 方法：专门用于从特定的 cube 中检索记忆项，这在多租户或分片场景中很有用。</p>
</li>
</ul>
<h5 data-id="heading-23">2.6.3 工作流程总结</h5>
<ul>
<li>接收用户查询和解析后的任务目标</li>
<li>并行执行图结构检索和向量检索</li>
<li>合并两种检索结果</li>
<li>去除重复项并返回最终结果</li>
</ul>
<h4 data-id="heading-24">2.7 Reranker</h4>
<p>使用 CosineLocalReranker 做解析。CosineLocalReranker 是一个本地实现的重排序器，它使用余弦相似度算法对检索到的记忆项进行重新排序，以提高检索结果的相关性。</p>
<h5 data-id="heading-25">2.7.1 主要功能</h5>
<p>主要功能是余弦相似度计算</p>
<ul>
<li>计算查询向量与候选记忆项向量之间的余弦相似度</li>
<li>支持单个查询向量与多个候选向量的同时计算</li>
</ul>
<h5 data-id="heading-26">2.7.2 工作流程总结</h5>
<ul>
<li>接收来自 GraphMemoryRetriever 的初步检索结果</li>
<li>获取查询的嵌入向量和候选记忆项的嵌入向量</li>
<li>计算查询向量与每个候选向量的余弦相似度</li>
<li>根据记忆项的层级类型应用相应权重</li>
<li>按照加权相似度分数对结果进行排序</li>
<li>返回前 K 个最相关的结果给下一个处理阶段</li>
</ul>
<p>这种设计使得系统能够在本地快速完成重排序操作，而无需依赖外部服务，同时通过层级权重机制可以优先考虑某些类型的记忆项，从而提高检索结果的质量。</p>
<h4 data-id="heading-27">2.8 MemoryReasoner</h4>
<p>MemoryReasoner 是一个专门负责对检索到的记忆项进行推理和知识综合的组件。它的主要职责是对从不同来源检索到的记忆进行分析、筛选和优化，从而提供更精确和相关的记忆结果。</p>
<h5 data-id="heading-28">2.8.1 主要功能</h5>
<ul>
<li>
<p>记忆推理与综合</p>
<ul>
<li>接收原始查询和已检索的相关记忆项</li>
<li>利用大型语言模型分析多个检索到的记忆项</li>
<li>根据用户的查询目标综合相关信息</li>
<li>生成更加精确和相关的记忆响应</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>智能筛选</p>
<ul>
<li>通过 LLM 判断哪些记忆项与当前查询最相关</li>
<li>只返回经过筛选的相关记忆项</li>
</ul>
</li>
</ul>
<h5 data-id="heading-29">2.8.2 核心方法</h5>
<p>reason 是主要的推理方法，执行以下步骤：</p>
<ul>
<li>
<p>构建提示词：</p>
<ul>
<li>使用模板 REASON_PROMPT 构建推理提示词</li>
<li>将检索到的记忆项格式化为字符串列表</li>
</ul>
</li>
<li>
<p>调用 LLM：</p>
<ul>
<li>将构建好的提示词发送给语言模型生成响应</li>
</ul>
</li>
<li>
<p>解析响应：</p>
<ul>
<li>提取模型选择的记忆项 ID</li>
<li>返回对应的记忆项列表</li>
</ul>
</li>
</ul>
<p>parse_selected_ids 方法负责从模型响应中提取选定的记忆项 ID：</p>
<ul>
<li>JSON 解析：首先尝试将响应解析为 JSON 格式</li>
<li>正则表达式回退：如果 JSON 解析失败，则使用正则表达式匹配 UUID 格式的 ID</li>
</ul>
<h5 data-id="heading-30">2.8.3 提示词</h5>
<pre><code class="hljs language-css" lang="css">REASON_PROMPT = """
You are <span class="hljs-selector-tag">a</span> reasoning agent working with <span class="hljs-selector-tag">a</span> memory system. You will synthesize knowledge <span class="hljs-selector-tag">from</span> multiple memory cards <span class="hljs-selector-tag">to</span> construct <span class="hljs-selector-tag">a</span> meaningful response <span class="hljs-selector-tag">to</span> the task below.
​
Task: ${task}
​
Memory cards (with metadata):
${detailed_memory_list}
​
Please perform:
<span class="hljs-number">1</span>. Clustering by theme (topic/concept/fact)
<span class="hljs-number">2</span>. Identify useful chains or connections
<span class="hljs-number">3</span>. Return a curated list of memory card IDs with reasons.
​
Output in JSON:
{
  "selected_ids": [...],
  <span class="hljs-string">"explanation"</span>: <span class="hljs-string">"..."</span>
}
"""
</code></pre>
<h5 data-id="heading-31">2.8.4 工作流程总结</h5>
<ul>
<li>
<p>接收来自上一阶段的检索和重排序结果</p>
</li>
<li>
<p>构建推理提示词：</p>
<ul>
<li>将用户的查询、解析后的任务目标以及检索到的记忆项组合成一个结构化的提示词</li>
<li>使用预定义的 REASON_PROMPT 模板</li>
</ul>
</li>
<li>
<p>调用 LLM 进行推理：</p>
<ul>
<li>将构建好的提示词发送给大型语言模型</li>
<li>使用 LLM 进一步分析和推理这些记忆项的相关性</li>
<li>获取模型的响应，该响应包含对记忆项的相关性判断</li>
</ul>
</li>
<li>
<p>解析和筛选结果：</p>
<ul>
<li>
<p>解析 LLM 的响应，提取被选中的记忆项 ID</p>
</li>
<li>
<p>支持两种解析方式：</p>
<ul>
<li>JSON 格式：直接提取 selected_ids 字段</li>
<li>文本格式：通过正则表达式匹配 UUID 模式</li>
</ul>
</li>
</ul>
</li>
<li>
<p>返回精选记忆：</p>
<ul>
<li>根据解析出的 ID 列表筛选原始记忆项</li>
<li>返回最相关的结果子集</li>
</ul>
</li>
</ul>
<p>这种设计使得系统能够利用 LLM 的理解和推理能力，从大量检索到的记忆中选出最符合用户需求的部分，提高了系统的准确性和智能化水平。</p>
<h5 data-id="heading-32">2.8.5 优势</h5>
<ul>
<li>智能化处理：利用 LLM 的理解能力对记忆项进行语义层面的分析</li>
<li>灵活性：支持多种输出格式的解析</li>
<li>精准性：能够进一步提升检索结果的相关性和质量</li>
</ul>
<p>总的来说，MemoryReasoner 在整个记忆检索系统中扮演着“智能筛选器”的角色，通过引入 LLM 的推理能力，使系统能够更准确地理解用户需求并返回最相关的记忆项。</p>
<h4 data-id="heading-33">2.9 Reranker 和 Reasoner</h4>
<p>在系统中同时使用 Reranker 和 Reasoner 是为了实现不同层次的检索结果处理和优化，它们各自承担不同的职责。</p>
<h5 data-id="heading-34">2.9.1 Reranker 的作用</h5>
<p>Reranker（重排序器）主要负责对初步检索结果进行相关性重新排序：</p>
<ul>
<li>功能：基于查询和候选结果的相似度计算，对检索结果进行重新排序</li>
<li>方法：通常使用数学计算（如余弦相似度）来评估相关性</li>
<li>输出：返回按相关性得分排序的记忆项列表</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">def rerank(self, query, graph_results, top_k, **kwargs):
    <span class="hljs-comment"># 计算相似度</span>
    <span class="hljs-attr">sims</span> = _cosine_one_to_many(query_embedding, cand_vecs)
    <span class="hljs-comment"># 应用权重调整</span>
    <span class="hljs-attr">weighted</span> = [sim * get_weight(it) for sim, it in zip(sims, items_with_emb)]
    <span class="hljs-comment"># 排序并返回前 K 个结果</span>
    scored_pairs.sort(<span class="hljs-attr">key</span>=lambda x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>)
    return scored_pairs<span class="hljs-section">[:top_k]</span>
</code></pre>
<h5 data-id="heading-35">2.9.2 Reasoner 的作用</h5>
<p>Reasoner（推理器）主要负责对排序后的结果进行语义理解和推理：</p>
<ul>
<li>功能：基于语言模型对检索到的记忆项进行语义理解和推理</li>
<li>方法：使用大语言模型分析查询和记忆项之间的深层语义关系</li>
<li>输出：返回经过语义推理筛选后的最终记忆项</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">def reason(self, query, ranked_memories, parsed_goal):
    <span class="hljs-comment"># 构建推理提示</span>
    <span class="hljs-attr">prompt</span> = prompt_template.substitute(task=query, detailed_memory_list=memory_detailed_str)
    <span class="hljs-comment"># 使用 LLM 进行推理</span>
    <span class="hljs-attr">response</span> = self.llm.generate([{<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: prompt}])
    <span class="hljs-comment"># 解析并返回推理结果</span>
    <span class="hljs-attr">selected_ids</span> = self._parse_selected_ids(content)
    return <span class="hljs-section">[m for m in ranked_memories if m.id in id_set]</span>
</code></pre>
<h5 data-id="heading-36">2.9.3 为什么需要两者结合？</h5>
<ol start="0">
<li>不同的处理层次</li>
</ol>
<p>Reranker：在数学向量空间中进行快速相关性计算</p>
<p>Reasoner：在语义层面进行深度理解和推理</p>
<ol start="2">
<li>
<p>互补的优势</p>
<p>效率 vs 精度：Reranker 快速筛选，Reasoner 精确推理</p>
<p>定量 vs 定性：Reranker 基于数值计算，Reasoner 基于语义理解</p>
</li>
</ol>
<p>系统设计优势</p>
<ul>
<li>
<p>性能优化：避免直接对大量候选结果使用昂贵的 LLM 推理</p>
</li>
<li>
<p>精度提升：先用数学方法粗筛，再用语义方法精筛</p>
</li>
<li>
<p>模块化设计：两个组件职责分明，便于独立优化和替换</p>
</li>
<li>
<p>适应不同场景：</p>
<ul>
<li>快速模式：可能只使用 Reranker</li>
<li>精细模式：两者都使用以获得最佳结果</li>
</ul>
</li>
</ul>
<p>这种设计使得系统既能在保证检索质量的同时控制计算成本，又能根据不同的应用场景灵活调整处理流程。</p>
<h5 data-id="heading-37">2.9.4 具体示例</h5>
<p>假设用户查询：“机器学习中的梯度下降算法如何工作？”</p>
<ul>
<li>
<p>初始检索：系统可能检索到 100 个相关记忆项</p>
</li>
<li>
<p>Reranker 处理：</p>
<ul>
<li>计算查询与每个记忆项的余弦相似度</li>
<li>根据层级权重（topic/concept/fact）调整得分</li>
<li>返回前 20 个最相关的记忆项</li>
</ul>
</li>
<li>
<p>Reasoner 处理：</p>
<ul>
<li>将前 20 个记忆项和查询一起交给 LLM</li>
<li>LLM 分析哪些记忆项真正回答了用户的问题</li>
<li>可能发现只有其中 5 个记忆项真正相关且互补</li>
<li>返回这 5 个最合适的记忆项</li>
</ul>
</li>
</ul>
<h3 data-id="heading-38">0x03 子图检索</h3>
<h4 data-id="heading-39">3.1 功能</h4>
<p>get_relevant_subgraph方法的功能是：</p>
<ul>
<li>
<p>查找与查询相关的局部子图（Find Relevant Local Subgraph）</p>
<ul>
<li>接收用户查询字符串作为输入</li>
<li>通过嵌入模型将查询转换为向量表示</li>
<li>在图数据库中搜索与查询向量最相似的前k个节点</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>构建邻域子图（Build Neighborhood Subgraphs），对每个相似节点：</p>
<ul>
<li>确保其状态符合指定条件（默认为"activated"）</li>
<li>获取以该节点为中心、指定深度（默认2跳）的局部子图</li>
<li>收集中心节点、邻居节点和连接边</li>
</ul>
</li>
</ul>

<ul>
<li>
<p>合并多个子图为统一结构（Merge Subgraphs）</p>
<ul>
<li>
<p>将所有检索到的局部子图合并成一个连通的子图</p>
</li>
<li>
<p>去除重复节点和边</p>
</li>
<li>
<p>返回包含以下信息的字典结构：</p>
<ul>
<li>core_id: 最匹配的核心节点ID</li>
<li>nodes: 合并后的唯一节点列表</li>
<li>edges: 合并后的唯一边列表</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>这种方法特别适用于需要理解复杂关系和上下文的场景，比如：</p>
<ul>
<li>查找与特定主题相关的知识网络片段</li>
<li>进行多跳推理以发现间接关联</li>
<li>提供可解释的记忆检索结果，展示节点间的关系路径</li>
</ul>
<p>主要优势在于它不仅返回相关节点，还保留了它们之间的语义关系结构，这对于高级推理任务非常有用。</p>
<h4 data-id="heading-40">3.2 代码</h4>
<p>具体代码如下：</p>
<pre><code class="hljs language-python" lang="python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_relevant_subgraph</span>(<span class="hljs-params">
        self, query: <span class="hljs-built_in">str</span>, top_k: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span>, depth: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span>, center_status: <span class="hljs-built_in">str</span> = <span class="hljs-string">"activated"</span>
    </span>) -&gt; <span class="hljs-built_in">dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:
        <span class="hljs-string">"""
        Find and merge the local neighborhood sub-graphs of the top-k
        nodes most relevant to the query.
         Process:
             1. Embed the user query into a vector representation.
             2. Use vector similarity search to find the top-k similar nodes.
             3. For each similar node:
                 - Ensure its status matches `center_status` (e.g., 'active').
                 - Retrieve its local subgraph up to `depth` hops.
                 - Collect the center node, its neighbors, and connecting edges.
             4. Merge all retrieved subgraphs into a single unified subgraph.
             5. Return the merged subgraph structure.
​
         Args:
             query (str): The user input or concept to find relevant memories for.
             top_k (int, optional): How many top similar nodes to retrieve. Default is 5.
             depth (int, optional): The neighborhood depth (number of hops). Default is 2.
             center_status (str, optional): Status condition the center node must satisfy (e.g., 'active').
​
         Returns:
             dict[str, Any]: A subgraph dict with:
                 - 'core_id': ID of the top matching core node, or None if none found.
                 - 'nodes': List of unique nodes (core + neighbors) in the merged subgraph.
                 - 'edges': List of unique edges (as dicts with 'from', 'to', 'type') in the merged subgraph.
        """</span>
        <span class="hljs-comment"># Step 1: Embed query</span>
        query_embedding = self.embedder.embed([query])[<span class="hljs-number">0</span>]
​
        <span class="hljs-comment"># Step 2: Get top-1 similar node</span>
        similar_nodes = self.graph_store.search_by_embedding(query_embedding, top_k=top_k)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> similar_nodes:
            logger.info(<span class="hljs-string">"No similar nodes found for query embedding."</span>)
            <span class="hljs-keyword">return</span> {<span class="hljs-string">"core_id"</span>: <span class="hljs-literal">None</span>, <span class="hljs-string">"nodes"</span>: [], <span class="hljs-string">"edges"</span>: []}
​
        <span class="hljs-comment"># Step 3: Fetch neighborhood</span>
        all_nodes = {}
        all_edges = <span class="hljs-built_in">set</span>()
        cores = []
​
        <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> similar_nodes:
            core_id = node[<span class="hljs-string">"id"</span>]
            score = node[<span class="hljs-string">"score"</span>]
​
            subgraph = self.graph_store.get_subgraph(
                center_id=core_id, depth=depth, center_status=center_status
            )
​
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> subgraph[<span class="hljs-string">"core_node"</span>]:
                logger.info(<span class="hljs-string">f"Skipping node <span class="hljs-subst">{core_id}</span> (inactive or not found)."</span>)
                <span class="hljs-keyword">continue</span>
​
            core_node = subgraph[<span class="hljs-string">"core_node"</span>]
            neighbors = subgraph[<span class="hljs-string">"neighbors"</span>]
            edges = subgraph[<span class="hljs-string">"edges"</span>]
​
            <span class="hljs-comment"># Collect nodes</span>
            all_nodes[core_node[<span class="hljs-string">"id"</span>]] = core_node
            <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> neighbors:
                all_nodes[n[<span class="hljs-string">"id"</span>]] = n
​
            <span class="hljs-comment"># Collect edges</span>
            <span class="hljs-keyword">for</span> e <span class="hljs-keyword">in</span> edges:
                all_edges.add((e[<span class="hljs-string">"source"</span>], e[<span class="hljs-string">"target"</span>], e[<span class="hljs-string">"type"</span>]))
​
            cores.append(
                {<span class="hljs-string">"id"</span>: core_id, <span class="hljs-string">"score"</span>: score, <span class="hljs-string">"core_node"</span>: core_node, <span class="hljs-string">"neighbors"</span>: neighbors}
            )
​
        top_core = cores[<span class="hljs-number">0</span>]
        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">"core_id"</span>: top_core[<span class="hljs-string">"id"</span>],
            <span class="hljs-string">"nodes"</span>: <span class="hljs-built_in">list</span>(all_nodes.values()),
            <span class="hljs-string">"edges"</span>: [{<span class="hljs-string">"source"</span>: f, <span class="hljs-string">"target"</span>: t, <span class="hljs-string">"type"</span>: ty} <span class="hljs-keyword">for</span> (f, t, ty) <span class="hljs-keyword">in</span> all_edges],
        }
</code></pre>
<h3 data-id="heading-41">0x04 图数据库</h3>
<p>因为图数据库比较复杂，我们通过示例来进行学习，以管窥豹。</p>
<h4 data-id="heading-42">4.1 示例</h4>
<p>run_user_session 函数中便有搜索内容。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_user_session</span>(<span class="hljs-params">
    user_name: <span class="hljs-built_in">str</span>,
    db_name: <span class="hljs-built_in">str</span>,
    topic_text: <span class="hljs-built_in">str</span>,
    concept_texts: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],
    fact_texts: <span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>],
</span>):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n=== <span class="hljs-subst">{user_name}</span> starts building their memory graph ==="</span>)
​
    <span class="hljs-comment"># Manually initialize correct GraphDB class</span>
    config = GraphDBConfigFactory(
        backend=<span class="hljs-string">"nebular"</span>,
        config={
            <span class="hljs-string">"uri"</span>: json.loads(os.getenv(<span class="hljs-string">"NEBULAR_HOSTS"</span>, <span class="hljs-string">"localhost"</span>)),
            <span class="hljs-string">"user"</span>: os.getenv(<span class="hljs-string">"NEBULAR_USER"</span>, <span class="hljs-string">"root"</span>),
            <span class="hljs-string">"password"</span>: os.getenv(<span class="hljs-string">"NEBULAR_PASSWORD"</span>, <span class="hljs-string">"xxxxxx"</span>),
            <span class="hljs-string">"space"</span>: db_name,
            <span class="hljs-string">"user_name"</span>: user_name,
            <span class="hljs-string">"use_multi_db"</span>: <span class="hljs-literal">False</span>,
            <span class="hljs-string">"auto_create"</span>: <span class="hljs-literal">True</span>,
            <span class="hljs-string">"embedding_dimension"</span>: embedder_dimension,
        },
    )
    graph = GraphStoreFactory.from_config(config)
​
    <span class="hljs-comment"># Start with a clean slate for this user</span>
    graph.clear()
​
    now = datetime.now(timezone.utc).isoformat()
​
    <span class="hljs-comment"># === Step 1: Create a root topic node (e.g., user's research focus) ===</span>
    topic = TextualMemoryItem(
        memory=topic_text,
        metadata=TreeNodeTextualMemoryMetadata(
            memory_type=<span class="hljs-string">"LongTermMemory"</span>,
            key=<span class="hljs-string">"Research Topic"</span>,
            hierarchy_level=<span class="hljs-string">"topic"</span>,
            <span class="hljs-built_in">type</span>=<span class="hljs-string">"fact"</span>,
            memory_time=<span class="hljs-string">"2024-01-01"</span>,
            status=<span class="hljs-string">"activated"</span>,
            visibility=<span class="hljs-string">"public"</span>,
            tags=[<span class="hljs-string">"research"</span>, <span class="hljs-string">"rl"</span>],
            updated_at=now,
            embedding=embed_memory_item(topic_text),
        ),
    )
    graph.add_node(topic.<span class="hljs-built_in">id</span>, topic.memory, topic.metadata.model_dump(exclude_none=<span class="hljs-literal">True</span>))
​
    <span class="hljs-comment"># === Step 2: Create two concept nodes linked to the topic ===</span>
    concept_items = []
    <span class="hljs-keyword">for</span> i, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(concept_texts):
        concept = TextualMemoryItem(
            memory=text,
            metadata=TreeNodeTextualMemoryMetadata(
                memory_type=<span class="hljs-string">"LongTermMemory"</span>,
                key=<span class="hljs-string">f"Concept <span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>"</span>,
                hierarchy_level=<span class="hljs-string">"concept"</span>,
                <span class="hljs-built_in">type</span>=<span class="hljs-string">"fact"</span>,
                memory_time=<span class="hljs-string">"2024-01-01"</span>,
                status=<span class="hljs-string">"activated"</span>,
                visibility=<span class="hljs-string">"public"</span>,
                updated_at=now,
                embedding=embed_memory_item(text),
                tags=[<span class="hljs-string">"concept"</span>],
                confidence=<span class="hljs-number">90</span> + i,
            ),
        )
        graph.add_node(concept.<span class="hljs-built_in">id</span>, concept.memory, concept.metadata.model_dump(exclude_none=<span class="hljs-literal">True</span>))
        graph.add_edge(topic.<span class="hljs-built_in">id</span>, concept.<span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">"PARENT"</span>)
        concept_items.append(concept)
​
    <span class="hljs-comment"># === Step 3: Create supporting facts under each concept ===</span>
    <span class="hljs-keyword">for</span> i, text <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(fact_texts):
        fact = TextualMemoryItem(
            memory=text,
            metadata=TreeNodeTextualMemoryMetadata(
                memory_type=<span class="hljs-string">"WorkingMemory"</span>,
                key=<span class="hljs-string">f"Fact <span class="hljs-subst">{i + <span class="hljs-number">1</span>}</span>"</span>,
                hierarchy_level=<span class="hljs-string">"fact"</span>,
                <span class="hljs-built_in">type</span>=<span class="hljs-string">"fact"</span>,
                memory_time=<span class="hljs-string">"2024-01-01"</span>,
                status=<span class="hljs-string">"activated"</span>,
                visibility=<span class="hljs-string">"public"</span>,
                updated_at=now,
                embedding=embed_memory_item(text),
                confidence=<span class="hljs-number">85.0</span>,
                tags=[<span class="hljs-string">"fact"</span>],
            ),
        )
        graph.add_node(fact.<span class="hljs-built_in">id</span>, fact.memory, fact.metadata.model_dump(exclude_none=<span class="hljs-literal">True</span>))
        graph.add_edge(concept_items[i % <span class="hljs-built_in">len</span>(concept_items)].<span class="hljs-built_in">id</span>, fact.<span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">"PARENT"</span>)
​
    <span class="hljs-comment"># === Step 4: Retrieve memory using semantic search ===</span>
    vector = embed_memory_item(<span class="hljs-string">"How is memory retrieved?"</span>)
    search_result = graph.search_by_embedding(vector, top_k=<span class="hljs-number">2</span>)
    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> search_result:
        node = graph.get_node(r[<span class="hljs-string">"id"</span>])
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"🔍 Search result:"</span>, node[<span class="hljs-string">"memory"</span>])
​
    <span class="hljs-comment"># === Step 5: Tag-based neighborhood discovery ===</span>
    neighbors = graph.get_neighbors_by_tag([<span class="hljs-string">"concept"</span>], exclude_ids=[], top_k=<span class="hljs-number">2</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📎 Tag-related nodes:"</span>, [neighbor[<span class="hljs-string">"memory"</span>] <span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> neighbors])
​
    <span class="hljs-comment"># === Step 6: Retrieve children (facts) of first concept ===</span>
    children = graph.get_children_with_embeddings(concept_items[<span class="hljs-number">0</span>].<span class="hljs-built_in">id</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📍 Children of concept:"</span>, [child[<span class="hljs-string">"memory"</span>] <span class="hljs-keyword">for</span> child <span class="hljs-keyword">in</span> children])
​
    <span class="hljs-comment"># === Step 7: Export a local subgraph and grouped statistics ===</span>
    subgraph = graph.get_subgraph(topic.<span class="hljs-built_in">id</span>, depth=<span class="hljs-number">2</span>)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📌 Subgraph node count:"</span>, <span class="hljs-built_in">len</span>(subgraph[<span class="hljs-string">"neighbors"</span>]))
​
    stats = graph.get_grouped_counts([<span class="hljs-string">"memory_type"</span>, <span class="hljs-string">"status"</span>])
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📊 Grouped counts:"</span>, stats)
​
    <span class="hljs-comment"># === Step 8: Demonstrate updates and cleanup ===</span>
    graph.update_node(
        concept_items[<span class="hljs-number">0</span>].<span class="hljs-built_in">id</span>, {<span class="hljs-string">"confidence"</span>: <span class="hljs-number">99.0</span>, <span class="hljs-string">"created_at"</span>: <span class="hljs-string">"2025-07-24T20:11:56.375687"</span>}
    )
    graph.remove_oldest_memory(<span class="hljs-string">"WorkingMemory"</span>, keep_latest=<span class="hljs-number">1</span>)
    graph.delete_edge(topic.<span class="hljs-built_in">id</span>, concept_items[<span class="hljs-number">0</span>].<span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span>=<span class="hljs-string">"PARENT"</span>)
    graph.delete_node(concept_items[<span class="hljs-number">1</span>].<span class="hljs-built_in">id</span>)
​
    <span class="hljs-comment"># === Step 9: Export and re-import the entire graph structure ===</span>
    exported = graph.export_graph()
    graph.import_graph(exported)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"📦 Graph exported and re-imported, total nodes:"</span>, <span class="hljs-built_in">len</span>(exported[<span class="hljs-string">"nodes"</span>]))
​
    <span class="hljs-comment"># ====================================</span>
    <span class="hljs-comment"># 🔍 Step 10: extra function</span>
    <span class="hljs-comment"># ====================================</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n=== 🔍 Extra Tests for user: <span class="hljs-subst">{user_name}</span> ==="</span>)
​
    <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Memory count:"</span>, graph.get_memory_count(<span class="hljs-string">"LongTermMemory"</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Node count:"</span>, graph.count_nodes(<span class="hljs-string">"LongTermMemory"</span>))
    <span class="hljs-built_in">print</span>(<span class="hljs-string">" - All LongTermMemory items:"</span>, graph.get_all_memory_items(<span class="hljs-string">"LongTermMemory"</span>))
​
    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(exported[<span class="hljs-string">"edges"</span>]) &gt; <span class="hljs-number">0</span>:
        n1, n2 = exported[<span class="hljs-string">"edges"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"source"</span>], exported[<span class="hljs-string">"edges"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"target"</span>]
        <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Edge exists?"</span>, graph.edge_exists(n1, n2, exported[<span class="hljs-string">"edges"</span>][<span class="hljs-number">0</span>][<span class="hljs-string">"type"</span>]))
        <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Edges for node:"</span>, graph.get_edges(n1))
​
    filters = [{<span class="hljs-string">"field"</span>: <span class="hljs-string">"memory_type"</span>, <span class="hljs-string">"op"</span>: <span class="hljs-string">"="</span>, <span class="hljs-string">"value"</span>: <span class="hljs-string">"LongTermMemory"</span>}]
    <span class="hljs-built_in">print</span>(<span class="hljs-string">" - Metadata query result:"</span>, graph.get_by_metadata(filters))
    <span class="hljs-built_in">print</span>(
        <span class="hljs-string">" - Optimization candidates:"</span>, graph.get_structure_optimization_candidates(<span class="hljs-string">"LongTermMemory"</span>)
    )
    <span class="hljs-keyword">try</span>:
        graph.drop_database()
    <span class="hljs-keyword">except</span> ValueError <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">" - drop_database raised ValueError as expected:"</span>, e)
</code></pre>
<h4 data-id="heading-43">4.2 get_neighbors_by_tag</h4>
<p>get_neighbors_by_tag 功能说明如下：</p>
<h5 data-id="heading-44">4.2.1 功能概述</h5>
<p>get_neighbors_by_tag 是基于标签的邻居节点检索方法，用于在图数据库中查找与给定节点具有相似标签的相邻节点。通过计算标签重叠度识别语义相关节点，支持基于标签的图遍历与推荐。</p>
<h5 data-id="heading-45">4.2.2 应用场景</h5>
<p>记忆重组阶段发现具有共同主题或概念的相关记忆节点。</p>
<p>支持推理与关联分析，构建记忆之间的语义连接。</p>
<p>用于聚类分析，识别标签组合相似的节点群组。</p>
<h5 data-id="heading-46">4.2.3 参数说明</h5>
<ul>
<li>tags (list[str])：目标标签列表，用于匹配相似节点。</li>
<li>_exclude_ids (list[str])：需排除的节点 ID 列表，避免返回自身或已知节点。</li>
<li>top_k (int)：返回结果数量上限，默认通常为 5。</li>
<li>min_overlap (int)：最小标签重叠数，仅返回满足该条件的节点。</li>
</ul>
<h5 data-id="heading-47">4.2.4 筛选机制</h5>
<ul>
<li>标签交集计算：比较目标标签与候选节点标签的交集大小确定相关性。</li>
<li>最小重叠阈值：仅返回标签重叠数≥min_overlap 的节点。</li>
<li>排除机制：过滤 _exclude_ids 指定的节点，防止循环引用。</li>
</ul>
<h5 data-id="heading-48">4.2.5 检索流程</h5>
<ul>
<li>根据输入标签在图数据库中查找包含这些标签的所有节点。</li>
<li>计算每个候选节点与目标标签集合的交集大小。</li>
<li>过滤不满足最小重叠要求的节点。</li>
<li>按标签重叠程度排序并截取前 k 个节点。</li>
</ul>
<h5 data-id="heading-49">4.2.6 性能优化</h5>
<ul>
<li>利用图数据库索引加速标签查询。</li>
<li>通过批量操作减少数据库访问次数。</li>
<li>支持并发执行，提高大规模图检索效率。</li>
</ul>
<p>MemOS-main\src\memos\graph_dbs\nebular.py 代码如下：</p>
<pre><code class="hljs language-less" lang="less">    <span class="hljs-variable">@timed</span>
    def <span class="hljs-built_in">get_neighbors_by_tag</span>(
        self,
        <span class="hljs-attribute">tags</span>: list[str],
        <span class="hljs-attribute">exclude_ids</span>: list[str],
        <span class="hljs-attribute">top_k</span>: int = <span class="hljs-number">5</span>,
        <span class="hljs-attribute">min_overlap</span>: int = <span class="hljs-number">1</span>,
        <span class="hljs-attribute">include_embedding</span>: bool = False,
    ) -&gt; list[dict[str, Any]]:
        <span class="hljs-string">""</span>"
        Find top-K neighbor nodes with maximum tag overlap.
​
        <span class="hljs-attribute">Args</span>:
            <span class="hljs-attribute">tags</span>: The list of tags to match.
            <span class="hljs-attribute">exclude_ids</span>: Node IDs to exclude (e.g., local cluster).
            <span class="hljs-attribute">top_k</span>: Max number of neighbors to return.
            <span class="hljs-attribute">min_overlap</span>: Minimum number of overlapping tags required.
            <span class="hljs-attribute">include_embedding</span>: with/without embedding
​
        <span class="hljs-attribute">Returns</span>:
            List of dicts with node details <span class="hljs-keyword">and</span> overlap count.
        <span class="hljs-string">""</span>"
        if <span class="hljs-keyword">not</span> <span class="hljs-attribute">tags</span>:
            return []
​
        where_clauses = [
            <span class="hljs-string">'n.status = "activated"'</span>,
            <span class="hljs-string">'NOT (n.node_type = "reasoning")'</span>,
            <span class="hljs-string">'NOT (n.memory_type = "WorkingMemory")'</span>,
        ]
        if <span class="hljs-attribute">exclude_ids</span>:
            where_clauses.<span class="hljs-built_in">append</span>(f<span class="hljs-string">"NOT (n.id IN {exclude_ids})"</span>)
​
        where_clauses.<span class="hljs-built_in">append</span>(f<span class="hljs-string">'n.user_name = "{self.config.user_name}"'</span>)
​
        where_clause = <span class="hljs-string">" AND "</span>.<span class="hljs-built_in">join</span>(where_clauses)
        tag_list_literal = <span class="hljs-string">"["</span> + <span class="hljs-string">", "</span>.<span class="hljs-built_in">join</span>(f<span class="hljs-string">'"{_escape_str(t)}"'</span> for t in tags) + <span class="hljs-string">"]"</span>
​
        return_fields = self.<span class="hljs-built_in">_build_return_fields</span>(include_embedding)
        query = f<span class="hljs-string">""</span>"
            LET tag_list = {<span class="hljs-selector-tag">tag_list_literal</span>}
​
            <span class="hljs-selector-tag">MATCH</span> (n<span class="hljs-variable">@Memory</span> <span class="hljs-comment">/*+ INDEX(idx_memory_user_name) */</span>)
            <span class="hljs-selector-tag">WHERE</span> {<span class="hljs-selector-tag">where_clause</span>}
            <span class="hljs-selector-tag">RETURN</span> {<span class="hljs-selector-tag">return_fields</span>},
               <span class="hljs-selector-tag">size</span>( <span class="hljs-built_in">filter</span>( n.tags, t -&gt; t IN tag_list ) ) <span class="hljs-selector-tag">AS</span> <span class="hljs-selector-tag">overlap_count</span>
            <span class="hljs-selector-tag">ORDER</span> <span class="hljs-selector-tag">BY</span> <span class="hljs-selector-tag">overlap_count</span> <span class="hljs-selector-tag">DESC</span>
            <span class="hljs-selector-tag">LIMIT</span> {<span class="hljs-selector-tag">top_k</span>}
            """
​
        <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">.execute_query</span>(query)
        <span class="hljs-selector-tag">neighbors</span>: <span class="hljs-selector-tag">list</span><span class="hljs-selector-attr">[dict[str, Any]</span>] = <span class="hljs-selector-attr">[]</span>
        <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">r</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">result</span>:
            <span class="hljs-selector-tag">props</span> = {k: v.value for k, v in r.items() if k != "overlap_count"}
            <span class="hljs-selector-tag">parsed</span> = <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">._parse_node</span>(props)
            <span class="hljs-selector-tag">parsed</span><span class="hljs-selector-attr">[<span class="hljs-string">"overlap_count"</span>]</span> = <span class="hljs-selector-tag">r</span><span class="hljs-selector-attr">[<span class="hljs-string">"overlap_count"</span>]</span><span class="hljs-selector-class">.value</span>
            <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-class">.append</span>(parsed)
​
        <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-class">.sort</span>(key=lambda <span class="hljs-attribute">x</span>: x[<span class="hljs-string">"overlap_count"</span>], reverse=True)
        <span class="hljs-selector-tag">neighbors</span> = <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-attr">[:top_k]</span>
        <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-attr">[]</span>
        <span class="hljs-selector-tag">for</span> <span class="hljs-selector-tag">neighbor</span> <span class="hljs-selector-tag">in</span> <span class="hljs-selector-tag">neighbors</span><span class="hljs-selector-attr">[:top_k]</span>:
            <span class="hljs-selector-tag">neighbor</span><span class="hljs-selector-class">.pop</span>(<span class="hljs-string">"overlap_count"</span>)
            <span class="hljs-selector-tag">result</span><span class="hljs-selector-class">.append</span>(neighbor)
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">result</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[不谈技术，搞点文化 🧀 —— 从复活一句明代残诗破局产品迭代]]></title>    <link>https://juejin.cn/post/7581299982671069218</link>    <guid>https://juejin.cn/post/7581299982671069218</guid>    <pubDate>2025-12-08T12:54:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581299982671069218" data-draft-id="7581306080434618419" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="不谈技术，搞点文化 🧀  ——  从复活一句明代残诗破局产品迭代"/> <meta itemprop="keywords" content="前端,后端,人工智能"/> <meta itemprop="datePublished" content="2025-12-08T12:54:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="HiStewie"/> <meta itemprop="url" content="https://juejin.cn/user/1591748568038823"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            不谈技术，搞点文化 🧀  ——  从复活一句明代残诗破局产品迭代
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1591748568038823/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    HiStewie
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T12:54:02.000Z" title="Mon Dec 08 2025 12:54:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"「"}.markdown-body b:after,.markdown-body strong:after{content:"」"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>上一篇文章：<a href="https://juejin.cn/post/7577653509862654002" target="_blank" title="https://juejin.cn/post/7577653509862654002">3天，1人，从0到付费产品：AI时代个人开发者的生存指南</a>，讲解了如何从技术层面，个人开发从前到后，从产品到设计，从会计到保安的开发闭环商业产品。这篇主要讲如何迭代项目，丰富内核，搭建 <strong>Content is King</strong> 产品思路</p>
<h2 data-id="heading-0">00｜引言：当程序员开始写诗</h2>
<p>最近在做生图产品 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nthme.org%2F" target="_blank" title="https://www.nthme.org/" ref="nofollow noopener noreferrer">The Nth Me</a></strong> 的迭代构思时，我陷入了一个思考：</p>
<ul>
<li><strong>我做 AI 产品的终极目的是什么？</strong></li>
</ul>
<p>是更快的推理速度？还是更低的显存占用？更便宜的定价？更好的用户体验？</p>
<p>那如何才能在同质化的套壳产品中脱颖而出？</p>
<ul>
<li>是：<strong>“赋能表达！！！”</strong></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8fb892c7aa546c79fd335f7b0ee8ed5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=pNr31RJzwjrReJTyFXDMf0IyanA%3D" alt="截屏2025-12-08 19.26.09.png" loading="lazy"/></p>
<p>偶然读到明代张穆的一句诗：</p>
<blockquote>
<p>“万里独吟迎雪去，平生一剑带霜携。”</p>
</blockquote>
<p>那种孤独与傲骨瞬间击中了我。我决定暂时放下代码，用现有的AI工具链，试图复活这位300年前的剑客。
在这个过程中，我摸索出了一套 <strong>“文化驱动”的工作流</strong>，也踩了不少坑。</p>
<p>而这些“坑”，正是我下一步产品迭代的方向。</p>
<hr/>
<h2 data-id="heading-1">01｜完整工作流拆解 (SOP)</h2>
<h3 data-id="heading-2">1. 炼字：先有骨，再有皮</h3>
<p>AI绘画最怕“词不达意”。在生成画面前，必须先打磨意境。
原句虽好，但为了配合画面张力，我跟 <strong>Gemini3 Pro</strong> 进行了多轮的次对话，沟通讨论<strong>意境、平仄，心境</strong>写了一首浊诗，下附最终作品的诗词品评，如果没入法眼，请大家多做自我批评（遮脸逃💨）</p>
<blockquote>
<p>原句：万里独吟迎雪去，平生一剑带霜携。</p>
</blockquote>
<h3 data-id="heading-3">《蛰龙吟》—— 剑气藏锋，外冷内热</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a7aaba326376485384cf9bccf33f0868~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=O%2F58YJJGejHfiZgSKZYONMzyGgE%3D" alt="截屏2025-12-08 20.20.44.png" loading="lazy"/></p>
<h4 data-id="heading-4">【气象：如古剑入鞘】</h4>
<p>整首诗的张力，源于 <strong>“冷”与“热”的极致反差</strong>。
表象是冰雪、风霜、尘泥的极寒低压；
内核却是傲骨、气象、风雷的滚烫野心。
压得越低，弹起时便越是万钧雷霆。</p>
<h4 data-id="heading-5">【炼字：四字破局】</h4>
<ul>
<li><strong>起于“迎”</strong>：凡人避雪，侠客独迎。一字立起逆流而上的姿态。</li>
<li><strong>承于“任”</strong>：视霜雪为雕刻之刀。这是“他强任他强”的顶级傲气。</li>
<li><strong>转于“藏”</strong>：全诗之眼。变“被动落魄”为“主动蛰伏”。身在泥涂，心在九霄。</li>
<li><strong>合于“卷”</strong>：风雷一动，乾坤倒转。所有的隐忍，只为这一刻的爆发。</li>
</ul>
<h4 data-id="heading-6">【哲思：强者的宣言】</h4>
<p>这首诗成功地刻画了一位 <strong>“受得了委屈，撑得起野心”</strong> 的人物形象</p>
<ul>
<li>君子当有龙蛇之变，龙蛇之变，在于能大能小，能升能隐。身在烂泥，心怀气象，这是枭雄心性。</li>
<li>它不再是单纯的抱怨怀才不遇，而是一种藏器于身，待时而动的生活态度。</li>
</ul>
<h3 data-id="heading-7">2. 画骨：视觉张力</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ec995deb611439a8d85842bc2b172ca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=9cjhANQMdeTQNfNL7%2BVMupURFsc%3D" alt="nthme-1765190372526.png" loading="lazy"/></p>
<ul>
<li><strong>工具</strong>：Nano Banana 普通模型</li>
<li><strong>核心思路</strong>：
很多模型喜欢把画面填满，但国风水墨讲究的是 <strong>“留白”</strong>。
我刻意引导模型生成“<strong>疏可走马，密不透风</strong>”的构图。
<ul>
<li><strong>关键Prompt</strong>：<code>negative space</code> (留白), <code>minimalism</code>, <code>dragon in clouds</code>, <code>swordsman back view</code>.</li>
<li><strong>目的</strong>：这里的留白不是空，而是为了给后续的“题字”留出生态位，营造“压抑感”的张力。</li>
</ul>
</li>
</ul>
<p>完整提示词</p>
<p><strong>适用场景：</strong> 想要一种古风、苍凉、留白、意境深远的画面。</p>
<p><strong>画面描述：</strong> 巨大的留白雪景，一个渺小的墨色背影，脚下是泥泞，天边隐约有龙形的云气和雷光。</p>
<p>Prompt (英文提示词):</p>
<pre><code class="hljs language-text" lang="text">masterpiece, best quality, traditional chinese ink wash painting, shuimo, a vast snowy landscape, heavy blizzard, one solitary swordsman walking away, back view, wearing tattered long robes, holding a sword, frost on clothes, standing in mud and snow, subtle dragon-shaped clouds in the dark stormy sky, lightning breaking through the clouds, strong contrast between black ink and white paper, epic atmosphere, lonely, majestic, calligraphy brush strokes.
</code></pre>
<h3 data-id="heading-8">3. 点睛：字是画的胆</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef8b64ec0ec840a5a2a2444343fd94f9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=QvCyj4G3qXR5pfw%2BiOT0w%2BikhEs%3D" alt="截屏2025-12-08 20.16.51.png" loading="lazy"/></p>
<ul>
<li><strong>工具</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.hellofont.cn%2F" target="_blank" title="https://www.hellofont.cn/" ref="nofollow noopener noreferrer">字由 (HelloFont)</a></li>
<li><strong>痛点</strong>：目前的AI生图模型（如SD, MJ）生成的汉字基本是“鬼画符”，不可用。</li>
<li><strong>解决方案</strong>：
不要迷信全自动。我选择后期合成。
使用 <strong>字由</strong> 挑选了免费商用的书法字体（推荐行楷或瘦金体风格）。
<ul>
<li><strong>排版技巧</strong>：采用古籍竖排，右起。文字颜色吸取画面深墨色，让字“长”在画上。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-9">4. 注魂：让画面流动</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b63a93515d864adab5df833acb9ffd9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=%2B02JEo2KaTjVqI3Wc%2B8UABTwgvM%3D" alt="IMG_1776.PNG" loading="lazy"/></p>
<ul>
<li><strong>工具</strong>：豆包 (Doubao)</li>
<li><strong>操作</strong>：图生视频 (Image-to-Video)。</li>
<li><strong>效果</strong>：提示词控制“风雪剧烈飘动”、“雷龙在云层隐现”，但人物保持相对静止。动静结合，压迫感拉满。</li>
<li><strong>❌ 遇到的痛点</strong>：
虽然豆包生成的动态效果不错，但<strong>水印</strong>问题非常影响成片的沉浸感。对于追求极致审美的创作者来说，这是无法忍受的瑕疵。还有一些弱智画面突然跳出来，自己要裁减。</li>
</ul>
<h3 data-id="heading-10">5. 音源：氛围营造</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6555d5dfefa744729adba6ad69df2f8c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=YPBNY%2F7iE8bFK4OGaz1Y57qCgv8%3D" alt="截屏2025-12-08 20.24.23.png" loading="lazy"/>
单纯的画面是不够的，声音是情绪的放大器。</p>
<ul>
<li><strong>音源获取</strong>：在B站找到一段极具古风压迫感的视频素材。
<ul>
<li>📥 <strong>视频下载</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fsnapany.com%2Fzh%2Fbilibili" target="_blank" title="https://snapany.com/zh/bilibili" ref="nofollow noopener noreferrer">SnapAny</a> (支持B站视频解析下载)</li>
</ul>
</li>
<li><strong>音频提取</strong>：
<ul>
<li>🎵 <strong>音轨分离</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.fineshare.com%2Fcn%2Faudio-extractor%2F" target="_blank" title="https://www.fineshare.com/cn/audio-extractor/" ref="nofollow noopener noreferrer">FineShare Audio Extractor</a></li>
</ul>
</li>
<li><strong>后期剪辑</strong>：
<ul>
<li>使用剪映将画面与音频对齐，制作成<strong>循环播放的短视频（Loop Video）</strong>。</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-11">02｜从痛点到产品迭代：The Nth Me 的下一步</h2>
<p>走完这一整套流程，我最大的感受是：<strong>割裂</strong>。</p>
<p>我需要切换5个工具（Nano Banana -&gt; Keynote/字由 -&gt; 豆包 -&gt; SnapAny -&gt; 剪映），还要忍受水印，才能勉强通过“拼凑”完成一个作品。</p>
<p>这让我重新审视我正在做的产品 —— <strong>The Nth Me</strong>。</p>
<h3 data-id="heading-12">💡 为什么要做 The Nth Me？</h3>
<p>“The Nth Me”意为“第N个我”。我们每个人在平行时空里，都可能是那个“万里独吟”的剑客。
我希望它不仅仅是一个网站，而是一个 <strong>“审美容器”</strong>。</p>
<h3 data-id="heading-13">🚀 迭代 Roadmap</h3>
<p>基于这次创作的痛点，我决定在 <strong>The Nth Me</strong> 的后续版本中重点解决以下问题：</p>
<ol>
<li><strong>全流程闭环</strong>：
计划接入图生视频模型，用户在站内生成图片后，可以直接一键“注魂”生成视频，无需跳转。但是音源获取还是个问题，总是要前置处理。如果网站内做可能会把功能写成「剪映」，我又想不变成剪辑软件。
<ul>
<li>有些困扰，如果有好建议的 jym 可以发在评论区，<strong>若采纳，送你体验积分兑换码</strong></li>
</ul>
</li>
<li><strong>去水印化</strong>：
作为独立开发者，我深知版权和纯净度的重要性。未来的视频生成功能将主打<strong>高清、无水印</strong>，把画面还给创作者。</li>
<li><strong>文化资产沉淀</strong>：
不仅仅是生成，还要能分享。全流媒体/社交软件如何设计分享途径，都要处理。</li>
</ol>
<hr/>
<h2 data-id="heading-14">03｜结语</h2>
<h3 data-id="heading-15">1.掘金的视频到底怎么上传？</h3>
<p>我本来想把视频放上来给大家看看，但是编辑器有点问题。不清楚怎么上传，特别是文案还说只支持西瓜视频，现在进西瓜视频官网直接跳到抖音去了，这个上传逻辑都废了。@掘金技术，麻烦有空跟进一下。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a1b01cf3764b6895e4c24ad8f27db6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSGlTdGV3aWU=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765803242&amp;x-signature=s2h2mR3Y1C%2FHtaa5Tyid1Mqb%2FEE%3D" alt="截屏2025-12-08 20.36.48.png" loading="lazy"/></p>
<p>放个小红书的：</p>
<p>明·张穆 x AI：跨越时空的“蛰龙”对话 “万里独吟迎... <a href="https://link.juejin.cn?target=http%3A%2F%2Fxhslink.com%2Fo%2F4AqiRBWgFbf" target="_blank" title="http://xhslink.com/o/4AqiRBWgFbf" ref="nofollow noopener noreferrer">xhslink.com/o/4AqiRBWgF…</a>
复制后打开【小红书】查看笔记！</p>
<h3 data-id="heading-16">2.关于灵感</h3>
<p>很多人问我，为什么要做这种“无用”的东西？</p>
<p>其实，我们每个人身体里都住着无数个自己。 也许是那个想仗剑天涯的少年，也许是那个想在风雪中大喊的疯子。在这个名为 The Nth Me 的概念里，我找到了第N个自己。 它不仅仅是一个名字，更像是一个存放我们“未竟之梦”的赛博空间。</p>
<ul>
<li>在这里，所有的意志和想象，都能被看见。</li>
<li>如果你也想找到你的第 N 种可能，不妨去搜搜看 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nthme.org%2F" target="_blank" title="https://www.nthme.org/" ref="nofollow noopener noreferrer"><strong>The Nth Me</strong></a>。 或许，那里也有你的影子。</li>
<li>如果你也想打破次元壁，去探索AI科技与古代诗词文化的交融，不妨按照我这个路径图自己尝试一下</li>
</ul>
<blockquote>
<p>愿你一身傲骨，终遇风雷。</p>
</blockquote>
<p>如果你也对这种 <strong>“技术+人文”</strong> 的探索感兴趣，或者想体验未来的无水印工作流，欢迎关注我的项目：</p>
<p>👉 <strong>The Nth Me</strong>: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.nthme.org%2F" target="_blank" title="https://www.nthme.org/" ref="nofollow noopener noreferrer">www.nthme.org/</a></p>
<p>让我们一起，在赛博世界里，复活心中的那条“蛰龙”。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[为什么第一性原理思维可以改变你解决问题的方式]]></title>    <link>https://juejin.cn/post/7581097111896457270</link>    <guid>https://juejin.cn/post/7581097111896457270</guid>    <pubDate>2025-12-08T11:44:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7581097111896457270" data-draft-id="7581117416811479083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="为什么第一性原理思维可以改变你解决问题的方式"/> <meta itemprop="keywords" content="架构,前端框架"/> <meta itemprop="datePublished" content="2025-12-08T11:44:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MobotStone"/> <meta itemprop="url" content="https://juejin.cn/user/3839909554568840"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            为什么第一性原理思维可以改变你解决问题的方式
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3839909554568840/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MobotStone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-08T11:44:31.000Z" title="Mon Dec 08 2025 11:44:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-08
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>我仍然记得前不久的一段小经历。那时候，我们在为一个新的业务需求找技术方案，大家开了好几次会，却始终拿不定主意。每次讨论都像是在修一台特别复杂的大机器——方案一个比一个“高级”，但一谈到具体实现，就陷进细节里出不来。</p>
<p>那天下午，我索性放下手头的活儿，问了自己一个特别简单的问题：业务到底最在乎的是什么？带着这个问题，我重新把整个业务流程梳理了一遍，才突然发现：我们之前一直忽略了一个关键点——真正要解决的问题，其实非常简单，是我们自己把它搞复杂了。</p>
<p>想通这一点之后，我们重新审视了需求，不再追求“又大又全”的方案，而是选择了一个极简、直接、好落地的做法。结果不仅省下了不少开发资源，业务的体验也更好了。</p>
<p>这次经历让我明白：解决问题的关键，不在于方案有多先进，算法多牛，而在于有没有真正满足业务当前的需求</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/088e214bf5a74ba1aa156bc947b3c4e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9ib3RTdG9uZQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765799070&amp;x-signature=2SuC7jhfI%2BMsQT4esmV%2B9bbtxrM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">什么是第一性原理思考？</h2>
<p>第一性原理思考，就是把问题拆解到最基本的真相，然后从这些真相出发一步步推理，而不是跟着“大家都知道”的老说法走。它不是要你从头发明轮子，而是搞清楚轮子为什么是圆的、它怎么滚的，以及能不能用其他形状滚得更好。</p>
<p>通过找出问题的核心“砖块”，你就避开了那种小修小补的死胡同。你会逐一审视每一步：哪些是铁板钉钉的、哪些能变、哪些变不了。这种方法，能把超级复杂的难题，变成简单明了的“小儿科”问题，一下子就搞定。</p>
<h2 data-id="heading-1">这种思维方式的强大之处在哪</h2>
<p>第一性原理思维之所以能带来颠覆性改变，是因为它：</p>
<ul>
<li><strong>激发真正创新</strong>：当你跳出现有框架，就能发现那些被常人视为“理所当然”而忽略的全新可能。</li>
<li><strong>化繁为简</strong>：把看似复杂无比的问题，拆解成清晰、可逐个攻克的小模块。</li>
<li><strong>省时省力</strong>：避免在表面修补上浪费时间，只把资源投入到真正关键、能推动进展的地方。</li>
<li><strong>建立深度认知</strong>：逼你去弄懂事物背后的科学原理、市场规律或人性因素，而不只是停留在表面。</li>
<li><strong>让决策更有底气</strong>：每个假设都经过验证，你的选择就不再只凭直觉，而是建立在扎实的基础上。</li>
</ul>
<h2 data-id="heading-2"><strong>从根本原理出发的创新案例</strong></h2>
<h4 data-id="heading-3"><strong>1. SpaceX 的火箭革命</strong></h4>
<p>伊隆·马斯克问了一个简单却关键的问题：<strong>为什么火箭只能用一次？</strong> 他从零开始重新思考火箭的设计，拆解了发射成本和材料结构，最终让 SpaceX 的火箭实现了<strong>可回收利用</strong>。这一改变让每次发射的成本<strong>降低了 90% 以上</strong>，彻底颠覆了航天业。</p>
<h4 data-id="heading-4"><strong>2. 特斯拉的电动车突破</strong></h4>
<p>传统车企只是在油车底盘上加装电池，而特斯拉则<strong>从电池出发</strong>，重新设计了车身结构、动力系统和热管理。这种“从根本出发”的思路，让电动车<strong>续航更长、充电更快</strong>，从小众产品变成了主流选择。</p>
<h4 data-id="heading-5"><strong>3. 厨师的酱料革命</strong></h4>
<p>一位大厨想要突破传统番茄酱的局限。她没有遵循古法，而是从科学角度分析"鲜味"的来源。通过将烤蘑菇与长时间炖煮的番茄混合，竟调配出媲美肉汁酱的浓郁口感——完全靠新鲜蔬菜！这个案例完美展现了"用最基础原理重构事物"的思维力量。</p>
<h2 data-id="heading-6">如何实践第一性原理思维</h2>
<p><strong>第一步：识别问题，列出所有假设</strong></p>
<p>首先，明确你要解决的具体问题，然后把你对这个问题的所有预设和假设都写下来。接着，逐条问自己："为什么我会这样想？这个假设真的是必须的吗？"这样做的目的是打破我们习惯性的思维定式，去掉那些理所当然但其实未必正确的想法。</p>
<p><strong>第二步：把问题拆解成最基础的组成部分</strong></p>
<p>想象你在拆一个复杂的机器——不要急着看整体怎样运作，而是先问自己："这个问题的核心是什么？哪些是真正起作用的关键因素？"把这些基本元素一一列出来，这样你就能看清问题的本质，而不是被表面的复杂性迷惑。</p>
<p><strong>第三步：独立验证每个基础要素</strong></p>
<p>对于你列出的每个核心组成部分，都要主动去验证它。你可以查找资料、做一些小的测试、或者请教相关领域的专家。目的是用实际数据或事实来证明这些基础要素是否真的存在，那些你认为理所当然的东西是否真的可靠。</p>
<p><strong>第四步：从零开始重新组建解决方案</strong></p>
<p>现在你已经知道了真实的、经过验证的基础事实，问自己："如果只基于这些真实情况，我们会想到什么样的解决办法？"这时往往会出现一些全新的、之前从未考虑过的想法和可能性。</p>
<p><strong>第五步：快速改进并记录经验</strong></p>
<p>不要认为第一次的结论就是完美的。要持续改进，当有新的数据或发现出现时，不断调整你对问题的理解。第一性原理不是一成不变的——随着情境的变化，我们对基础原理的认识也应该不断演进和完善。</p>
<h2 data-id="heading-7">如何避免常见的坑</h2>
<h4 data-id="heading-8"><strong>把第一原理和过度分析混为一体</strong></h4>
<ul>
<li>**问题：**花数月时间研究细微的细节，可能会导致进度停滞。 <strong>解决方案：</strong> 为研究设定明确的边界，然后迅速进入原型开发阶段。不要陷入过度分析的泥潭中。</li>
</ul>
<h4 data-id="heading-9"><strong>依赖错误的基础</strong></h4>
<ul>
<li>**问题：**如果你的核心数据或对物理学的理解有误，那么你所构建的一切都会崩塌。 <strong>解决方案：</strong> 通过简单的测试或同行评审尽早验证你的基础。确保你的数据和理论基础是正确的。</li>
</ul>
<h4 data-id="heading-10"><strong>忽视渐进价值</strong></h4>
<ul>
<li>**问题：**有时候，对现有解决方案进行小的调整仍然很重要。 <strong>解决方案：</strong> 当完全重新发明解决方案并不现实时，使用第一原理来指导渐进式的改进。即使是小的优化，也能带来显著的价值。</li>
</ul>
<h2 data-id="heading-11">一个简单的第一性原理检查清单</h2>
<ul>
<li>我自己对这个问题有哪些不容置疑的事实？</li>
<li>我能检验或剔除哪些假设？</li>
<li>如何分离并单独实验其中一个最基本的要素？</li>
<li>如果我从零开始重建，会有什么全新的设计或策略出现？</li>
<li>我是否为调研设定了时间限制，以免陷入无休止的思考？</li>
</ul>
<p>第一性原理思维不仅仅是个流行词汇——它是你面对重大挑战时的一套思维工具，帮助你跳出传统框架。当你下次遭遇顽固的难题时，无论是在商业策略、DIY项目还是个人目标上，都可以暂停下来问自己：我真正掌握的是什么？把“这就是一直以来的做法”这一层层概念剥离开，下面隐藏的创新思路可能会令你大吃一惊。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>