<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[【Claude code官网文章】通过 Skills 改进前端设计]]></title>    <link>https://juejin.cn/post/7573904312712347683</link>    <guid>https://juejin.cn/post/7573904312712347683</guid>    <pubDate>2025-11-18T19:13:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573904312712347683" data-draft-id="7573892573346070580" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Claude code官网文章】通过 Skills 改进前端设计"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-18T19:13:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Claude code官网文章】通过 Skills 改进前端设计
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T19:13:38.000Z" title="Tue Nov 18 2025 19:13:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fimproving-frontend-design-through-skills" target="_blank" title="https://www.claude.com/blog/improving-frontend-design-through-skills" ref="nofollow noopener noreferrer">转载</a></p>
<blockquote>
<p>说实话这个话题社区里的实践和观点可太多了。openai和anthropic真的从社区里拿到了太多真金白银的反馈。</p>
<p>什么时候国产模型不是“登顶”“超越”的宣传稿满天飞，而且社区里有很多踏踏实实讨论最佳实践、反馈问题的帖子，热度能和这几个海外顶流一样高，那才是真的超越海外大模型的时刻。</p>
<p>国产加油！</p>
</blockquote>
<p><strong>日期</strong>: 2025年11月12日</p>
<p><strong>阅读时间</strong>: 5 分钟</p>
<p>你可能会注意到，当你在没有指导的情况下要求 LLM 构建一个 landing page 时，它几乎总是采用 Inter 字体、白色背景上的紫色渐变，以及最少的动画。</p>
<p>问题是什么？<strong>分布收敛</strong>（distributional convergence）。在采样过程中，模型基于训练数据中的统计模式来预测 token。安全的设计选择——那些普遍适用且不会冒犯任何人的选择——在网页训练数据中占主导地位。在没有方向指导的情况下，Claude 从这个高概率中心进行采样。</p>
<p>对于构建面向客户产品的开发者来说，这种通用美学会削弱品牌身份，并使 AI 生成的界面立即变得可识别——并且容易被忽视。</p>
<h2 data-id="heading-0">可引导性挑战</h2>
<p>好消息是，Claude 在正确的提示下具有高度的可引导性。告诉 Claude "避免使用 Inter 和 Roboto" 或 "使用有氛围的背景而不是纯色"，结果会立即改善。对指导的敏感性是一个特性；这意味着 Claude 可以适应不同的设计上下文、约束和美学偏好。</p>
<p>但这产生了一个实际的挑战：任务越是专门化，你需要提供的上下文就越多。对于前端设计，有效的指导涵盖字体设计原则、色彩理论、动画模式和背景处理。你需要在多个维度上指定要避免哪些默认值以及首选哪些替代方案。</p>
<p>你可以把所有这些都打包到系统提示中，但这样每个请求——调试 Python、分析数据、写邮件——都会携带前端设计上下文。问题变成了：你如何在需要时为 Claude 提供特定领域的指导，而不会为不相关的任务带来永久的上下文开销？</p>
<h2 data-id="heading-1">Skills：动态上下文加载</h2>
<p>这正是 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fnews%2Fskills" target="_blank" title="https://www.anthropic.com/news/skills" ref="nofollow noopener noreferrer">Skills</a> 的设计目的：按需提供专门的上下文，而没有永久的开销。Skill 是一个包含指令、约束和领域知识的文档（通常是 markdown），存储在指定目录中，Claude 可以通过简单的文件读取工具访问。</p>
<p>Claude 可以利用这些技能在运行时动态加载所需的信息，逐步增强其上下文，而不是预先加载所有内容。当配备这些技能以及读取它们所需的必要工具时，Claude 可以根据手头的任务自主识别和加载相关技能。例如，当被要求构建 landing page 或创建 React 组件时，Claude 可以加载前端设计技能并及时应用其指令。</p>
<p>这是核心的思维模型：技能是按需激活的提示和上下文资源，为特定任务类型提供专门指导，而不会产生永久的上下文开销。</p>
<p>这使得开发者能够获得 Claude 可引导性的好处，而不会通过将许多不同任务的指令塞入系统提示来过载上下文窗口。正如我们<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Feffective-context-engineering-for-ai-agents" target="_blank" title="https://www.anthropic.com/engineering/effective-context-engineering-for-ai-agents" ref="nofollow noopener noreferrer">之前解释的</a>，上下文窗口中过多的 token 会导致性能下降，因此保持上下文窗口内容的精简和集中对于从模型中引出最佳性能极其重要。Skills 通过使有效的提示可重用和上下文化来解决这个问题。</p>
<h2 data-id="heading-2">为更好的前端输出进行提示</h2>
<p>我们可以通过创建前端设计技能来从 Claude 解锁显著更好的 UI 生成，而无需永久的上下文开销。核心洞察是以前端工程师的思维方式思考前端设计。你越是能将美学改进映射到可实现的前端代码，Claude 就能越好地执行。</p>
<p>利用这一洞察，我们确定了几个有针对性的提示效果很好的领域：字体设计、动画、背景效果和主题。这些都清晰地转换为 Claude 可以编写的代码。在你的提示中实现这一点并不需要详细的技术指令，只是使用有针对性的语言来促使模型更批判性地思考这些设计轴就足以引出更强的输出。这与我们在<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.anthropic.com%2Fengineering%2Feffective-context-engineering-for-ai-agents" target="_blank" title="https://www.anthropic.com/engineering/effective-context-engineering-for-ai-agents" ref="nofollow noopener noreferrer">上下文工程</a>博客文章中提供的指导密切对应，关于在正确的高度提示模型，避免指定精确十六进制代码的低空硬编码逻辑和假设共享上下文的模糊高空指导这两个极端。</p>
<h3 data-id="heading-3">字体设计</h3>
<p>为了看到这一点，让我们开始将字体设计视为我们可以通过提示影响的一个维度。下面的提示专门引导 Claude 使用更有趣的字体：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">use_interesting_fonts</span>&gt;</span></span>
  排版立即传达品质信号。避免使用无聊、通用的字体。

  切勿使用：Inter、Roboto、Open Sans、Lato、默认系统字体

  以下是一些优秀、有影响力的选择示例：
<span class="hljs-bullet">  -</span> 代码美学：JetBrains Mono、Fira Code、Space Grotesk
<span class="hljs-bullet">  -</span> 编辑风格：Playfair Display、Crimson Pro
<span class="hljs-bullet">  -</span> 技术风格：IBM Plex 系列、Source Sans 3
<span class="hljs-bullet">  -</span> 独特风格：Bricolage Grotesque、Newsreader

  配对原则：高对比度 = 有趣。Display + 等宽字体、serif + 几何 sans、跨权重的可变字体。

  使用极端值：100/200 权重 vs 800/900，而不是 400 vs 600。3 倍以上的大小跳跃，而不是 1.5 倍。

  选择一个独特的字体，果断地使用它。从 Google Fonts 加载。
  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">use_interesting_fonts</span>&gt;</span></span>
</code></pre>
<p><strong>使用基础提示生成的输出：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b927b8da3ee40ce9a830b5ccebf250e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=vXs9boHkF1Pu7fk5eiEbdkGZb68%3D" alt="" loading="lazy"/></p>
<p><strong>使用基础提示和字体设计部分生成的输出</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f8e0abfcdcca4aed844cca4c6ad9ab5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=KJqBkV1JVfJ9ccChvK2z5heIZP4%3D" alt="" loading="lazy"/></p>
<p>有趣的是，使用更有趣字体的指令似乎也鼓励模型改进设计的其他方面。</p>
<p>仅字体设计就带来了显著的改进，但字体只是一个维度。整个界面的连贯美学如何？</p>
<h3 data-id="heading-4">主题</h3>
<p>我们可以提示的另一个维度是受知名主题和美学启发的设计。Claude 对流行主题有丰富的理解；我们可以利用这一点来传达我们希望前端体现的具体美学。这是一个例子：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">always_use_rpg_theme</span>&gt;</span></span>
  始终使用 RPG 美学进行设计：
<span class="hljs-bullet">  -</span> 奇幻启发的调色板，具有丰富、戏剧性的色调
<span class="hljs-bullet">  -</span> 华丽的边框和装饰性框架元素
<span class="hljs-bullet">  -</span> 羊皮纸纹理、皮革装订风格和风化材料
<span class="hljs-bullet">  -</span> 史诗般的、冒险的氛围，具有戏剧性的光照
<span class="hljs-bullet">  -</span> 中世纪风格的 serif 排版，具有装饰性标题
  <span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">always_use_rpg_theme</span>&gt;</span></span>
</code></pre>
<p>这产生了以下 RPG 风格的 UI：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c48935e730a74bba8c7916e620b50ec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=K3XmDaPzbRfrULsRrBQlU%2BKHpe4%3D" alt="" loading="lazy"/></p>
<p>字体设计和主题显示了有针对性的提示是有效的。但手动指定每个维度是乏味的。如果我们能将所有这些改进组合到一个可重用的资产中会怎么样？</p>
<h3 data-id="heading-5">通用提示</h3>
<p>同样的原则扩展到其他设计维度：为动画（动画和微交互）添加提示会增加静态设计缺乏的抛光效果，而引导模型选择更有趣的背景选择会创建深度和视觉趣味。这是一个全面技能大放异彩的地方。</p>
<p>将这一切汇集在一起，我们开发了一个约 400 token 的提示——足够紧凑，可以在不膨胀上下文的情况下加载（即使作为技能加载）——显著改善字体设计、色彩、动画和背景的前端输出：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">frontend_aesthetics</span>&gt;</span></span>
  你倾向于收敛到通用的、"分布内"输出。在前端设计中，这创造了用户称为"AI slop"的美学。避免这一点：制作创造性的、独特的前端，让用户惊喜和愉悦。

  专注于：
<span class="hljs-bullet">  -</span> 排版：选择美观、独特和有趣的字体。避免通用字体如 Arial 和 Inter；相反，选择提升前端美学的独特选择。
<span class="hljs-bullet">  -</span> 颜色和主题：致力于统一的美学。使用 CSS 变量保持一致性。主导色配以鲜明强调色胜过胆怯的、均匀分布的调色板。从 IDE 主题和文化美学中汲取灵感。
<span class="hljs-bullet">  -</span> 动画：为效果和微交互使用动画。优先为 HTML 使用仅 CSS 解决方案。React 可用时使用 Motion
  库。专注于高影响力时刻：一个精心编排的页面加载，带有错开的揭示（animation-delay）比分散的微交互创造更多愉悦感。
<span class="hljs-bullet">  -</span> 背景：创造氛围和深度，而不是默认为纯色。

避免通用的 AI 生成美学：
<span class="hljs-bullet">  -</span> 过度使用的字体系列（Inter、Roboto、Arial、系统字体）
<span class="hljs-bullet">  -</span> 陈词滥调的配色方案（特别是白色背景上的紫色渐变）
<span class="hljs-bullet">  -</span> 可预测的布局和组件模式
<span class="hljs-bullet">  -</span> 缺乏上下文特定特色的千篇一律设计

  创造性解释并做出感觉真正为上下文设计的意外选择。在明暗主题、不同字体、不同美学之间变化。你仍然倾向于在各代之间收敛到常见选择（例如，Space
Grotesk）。避免这一点：跳出思维定势至关重要！
<span class="hljs-code">      &lt;/frontend_aesthetics&gt;
</span></code></pre>
<p>在上面的例子中，我们首先给 Claude 关于问题和我们要解决的问题的一般上下文。我们发现给模型这种类型的高级上下文是一种有帮助的提示策略来校准输出。然后我们确定了之前讨论的改进设计向量，并提供有针对性的建议来鼓励模型在所有这些维度上更有创意地思考。</p>
<p>我们还在末尾包含额外的指导来防止 Claude 收敛到不同的局部最大值。即使有明确的指令来避免某些模式，模型也可能默认选择其他常见选择（比如字体设计的 Space Grotesk）。最后提醒"think outside the box"加强了创意变化。</p>
<h3 data-id="heading-6">对前端设计的影响</h3>
<p>使用这个技能激活，Claude 的输出在几种类型的前端设计中都有所改善，包括：</p>
<p><strong>示例 1：SaaS landing page</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23c05410c5334db8a7ba45719ab176be~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=yAKAwY3KxsnVOKGg6aOTX%2FITGOk%3D" alt="" loading="lazy"/></p>
<p><strong>说明：</strong> AI 生成的 SaaS landing page，使用通用的 Inter 字体、紫色渐变和标准布局。没有使用 Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6469fb74fce4b55bff1223630ac3344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=niuZcK5iN2rmlS4%2BLqcxc%2BNbQxw%3D" alt="" loading="lazy"/></p>
<p><strong>说明：</strong> 使用与上述渲染相同的提示以及前端技能生成的 AI 前端，现在具有独特的字体设计、连贯的色彩方案和分层背景。</p>
<p><strong>示例 2：Blog 布局</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3d74477cd6f4ed284cec63e2441967d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=ldSHxTnBxwlCHigx4voQpv8jncM%3D" alt="" loading="lazy"/></p>
<p>使用默认系统字体和平面白色背景的 AI 生成 blog 布局。没有使用 Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d11cbda014344d6f9acf1f97bdae3b51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=5jKws4y9IBc94p%2F2%2F9%2Fj1g7Hiqw%3D" alt="" loading="lazy"/></p>
<p>使用相同提示以及前端技能生成的 AI blog 布局，具有编辑风格的字体设计和有氛围的深度以及精细的间距。</p>
<p><strong>示例 3：Admin dashboard</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/917777c1b21f41b683c5eae70fa7f404~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=y9NjPEMaweHmr0Br%2BYLJ%2FqAh3To%3D" alt="" loading="lazy"/></p>
<p>具有标准 UI 组件和最简化视觉层级的 AI 生成 admin dashboard。没有使用 Skills。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3ec09b0b8ff426990f3fc83e1dba090~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=iOAfd2GuENAiQYrHxxdNa%2BRa0sM%3D" alt="" loading="lazy"/></p>
<p>使用相同提示以及前端技能生成的 AI admin dashboard，具有粗体字体设计、连贯的深色主题和有目的性的动画。</p>
<h2 data-id="heading-7">使用 Skills 改进 claude.ai 中的 artifacts 质量</h2>
<p>设计品味不是唯一的限制。Claude 在构建 artifacts 时还面临架构约束。<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.claude.com%2Fen%2Farticles%2F9487310-what-are-artifacts-and-how-do-i-use-them" target="_blank" title="https://support.claude.com/en/articles/9487310-what-are-artifacts-and-how-do-i-use-them" ref="nofollow noopener noreferrer">Artifacts</a> 是 Claude 创建并显示在聊天旁边的交互式、可编辑内容（如代码或文档）。</p>
<p>除了上面探讨的设计品味问题外，Claude 还有另一个默认行为限制了它在 claude.ai 中生成出色的前端 artifacts 的能力。目前，当被要求创建前端时，Claude 只是构建一个带有 CSS 和 JS 的单一 HTML 文件。这是因为 Claude 知道前端必须是单一 HTML 文件才能正确渲染为 artifacts。</p>
<p>就像你期望一个人类开发者如果只能用单一文件编写 HTML/CSS/JS 只能创建非常基本的前端一样，我们假设如果我们给 Claude 指令来使用更丰富的工具，Claude 将能够生成更令人印象深刻的前端 artifacts。</p>
<p>这导致我们创建了一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Fblob%2Fmain%2Fartifacts-builder%2FSKILL.md" target="_blank" title="https://github.com/anthropics/skills/blob/main/artifacts-builder/SKILL.md" ref="nofollow noopener noreferrer">web-artifacts-builder skill</a>，它利用 Claude <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fcreate-files" target="_blank" title="https://www.claude.com/blog/create-files" ref="nofollow noopener noreferrer">使用计算机</a> 的能力，并指导 Claude 使用多个文件和现代网络技术（如 <a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">React</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2F" target="_blank" title="https://tailwindcss.com/" ref="nofollow noopener noreferrer">Tailwind CSS</a> 和 <a href="https://link.juejin.cn?target=https%3A%2F%2Fui.shadcn.com%2F" target="_blank" title="https://ui.shadcn.com/" ref="nofollow noopener noreferrer">shadcn/ui</a>）来构建 artifacts。在底层，该技能公开了脚本：(1) 帮助 Claude 高效设置基本的 React 仓库，(2) 在完成后使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fparceljs.org%2F" target="_blank" title="https://parceljs.org/" ref="nofollow noopener noreferrer">Parcel</a> 将所有内容捆绑到单一文件中以满足单一 HTML 文件的要求。这是技能的核心好处之一——通过给 Claude 访问脚本来执行样板操作，Claude 能够最小化 token 使用，同时提高可靠性和性能。</p>
<p>通过 web-artifacts-builder skill，Claude 可以利用 shadcn/ui 的表单组件和 Tailwind 的响应式网格系统来创建更全面的 artifact。</p>
<h3 data-id="heading-8">示例 1：白板应用</h3>
<p>例如，当被要求创建白板应用时，如果没有 web-artifacts-builder skill，Claude 输出了非常基本的界面：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2647d886f74d4ca197e3d8570d236471~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=%2BQuUMPfBl68SpueD6SqQdppxsCg%3D" alt="" loading="lazy"/></p>
<p>另一方面，当使用新的 web-artifacts-builder skill 时，Claude 生成了一个更清晰、功能更多的开箱即用应用程序，包括绘制不同形状和文本：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c8eb625c0494fdea915f8f0c391440f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=arb2cza1J3qaGWecx%2FBKwmKVgno%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">示例 2：任务管理器应用</h3>
<p>类似地，当被要求创建任务管理应用时，没有技能的情况下，Claude 生成了一个功能齐全但非常最小的应用程序：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2b5f41862a4b4f19a1b506a5a9e17f98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=%2Fsj9qcBHEFsOM7NfAXBq22dbJLs%3D" alt="" loading="lazy"/></p>
<p>使用技能，Claude 生成了一个开箱即用时功能更多的应用。例如，Claude 包含了一个"创建新任务"表单组件，允许用户为任务设置相关的类别和截止日期：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/750193bb5e2240a2a8893cfb649b50e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=6EK31AtcPFErY64B2YUfYeBES%2Bw%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/13a3056301bf4b4ebacb9ad78c3548bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5piv6a2U5Li45ZWK:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764099065&amp;x-signature=fe23u2uqKBkUsmXixE7qiMwplnk%3D" alt="" loading="lazy"/></p>
<p>要在 Claude.ai 中尝试这个新技能，只需启用该技能，然后在构建 artifacts 时要求 Claude "使用 web-artifacts-builder skill"。</p>
<h2 data-id="heading-10">使用 Skills 优化 Claude 的前端设计能力</h2>
<p>这个前端设计技能展示了一个关于语言模型能力的更广泛原则：模型通常有能力做得比它们默认表达的更多。Claude 具有强大的设计理解力，但没有指导时分布收敛掩盖了这一点。虽然你可以将这些指令添加到系统提示中，但这意味着每个请求都会携带前端设计上下文，即使这些知识与当前任务无关。相反，使用 Skills 将 Claude 从一个需要不断指导的工具转变为一个为每个任务带来领域专业知识的工具。</p>
<p>Skills 也高度可定制——你可以创建适合你特定需求的自己的技能。这允许你定义想要嵌入技能的确切原语，无论是你公司的设计系统、特定的组件模式，还是行业特定的 UI 约定。通过将这些决策编码到 Skill 中，你可以将 agent 思考的组件部分转换为整个开发团队可以利用的可重用资产。技能成为持久化和扩展的组织知识，确保跨项目的一致质量。</p>
<p>这种模式扩展到前端工作之外。任何 Claude 产生通用输出尽管有更广泛理解的领域都是 Skill 开发的候选者。方法是一致的：识别收敛的默认值，提供具体的替代方案，在正确的高度构建指导，并通过 Skills 使其可重用。</p>
<p>对于前端开发，这意味着 Claude 可以生成独特的界面，而无需每次请求的提示工程。要开始，请探索我们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-cookbooks%2Fblob%2Fmain%2Fcoding%2Fprompting_for_frontend_aesthetics.ipynb" target="_blank" title="https://github.com/anthropics/claude-cookbooks/blob/main/coding/prompting_for_frontend_aesthetics.ipynb" ref="nofollow noopener noreferrer">前端设计 cookbook</a> 或尝试我们在 Claude Code 中的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fclaude-code%2Ftree%2Fmain%2Fplugins%2Ffrontend-design" target="_blank" title="https://github.com/anthropics/claude-code/tree/main/plugins/frontend-design" ref="nofollow noopener noreferrer">新前端设计插件</a>。</p>
<p><strong>感到启发？要创建你自己的前端技能，请查看我们的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%2Ftree%2Fmain%2Fskill-creator" target="_blank" title="https://github.com/anthropics/skills/tree/main/skill-creator" ref="nofollow noopener noreferrer">skill-creator</a>。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何用Claude Code构建公司：三家YC初创公司的案例研究]]></title>    <link>https://juejin.cn/post/7573892573346054196</link>    <guid>https://juejin.cn/post/7573892573346054196</guid>    <pubDate>2025-11-18T17:42:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573892573346054196" data-draft-id="7573864324713955380" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何用Claude Code构建公司：三家YC初创公司的案例研究"/> <meta itemprop="keywords" content="Claude"/> <meta itemprop="datePublished" content="2025-11-18T17:42:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="是魔丸啊"/> <meta itemprop="url" content="https://juejin.cn/user/3217622495411292"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何用Claude Code构建公司：三家YC初创公司的案例研究
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3217622495411292/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    是魔丸啊
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T17:42:35.000Z" title="Tue Nov 18 2025 17:42:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fblog%2Fbuilding-companies-with-claude-code" target="_blank" title="https://www.claude.com/blog/building-companies-with-claude-code" ref="nofollow noopener noreferrer">转载</a></p>
<p><strong>日期</strong>：2025年11月17日</p>
<p><strong>阅读时间</strong>：5分钟</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ycombinator.com%2F" target="_blank" title="https://www.ycombinator.com/" ref="nofollow noopener noreferrer">Y Combinator</a>是一家创业加速器，自2005年以来已经孵化了超过5000家公司，这些公司的总估值超过8000亿美元，包括Airbnb、Stripe和DoorDash等知名企业。</p>
<p>如今，像<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://www.claude.com/product/claude-code" ref="nofollow noopener noreferrer">Claude Code</a>这样的agent编码工具正在从根本上改变YC初创公司构建和扩展的方式。创始人现在可以直接从终端发布产品，将开发周期从几周压缩到几小时，甚至让非技术创始人从第一天起就能与成熟企业竞争。</p>
<p>我们采访了三家展示这一变革实践的YC初创公司：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.claude.com%2Fproduct%2Fclaude-code" target="_blank" title="https://www.claude.com/product/claude-code" ref="nofollow noopener noreferrer">HumanLayer</a>（F24）使用Claude Code构建了他们的整个平台，并开创了上下文工程实践</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ambral.com%2F" target="_blank" title="https://www.ambral.com/" ref="nofollow noopener noreferrer">Ambral</a>（W25）正在使用Claude Code和Claude Agents SDK构建的复杂sub-agent驱动工作流来扩展AI驱动的客户管理</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fvulcan-tech.com%2F" target="_blank" title="https://vulcan-tech.com/" ref="nofollow noopener noreferrer">Vulcan Technologies</a>（S25）正在使用Claude Code为政府和行业解决监管复杂性</p>
<p>让我们深入了解。</p>
<h2 data-id="heading-0">HumanLayer：从SQL agents到扩展AI优先的工程团队</h2>
<blockquote>
<p>一个给 <em>agent 开发者</em> 用的 <strong>Human-in-the-Loop 平台 + Coding Agent 工具链</strong></p>
</blockquote>
<p>Dexter Horthy在构建自主AI agents来管理SQL仓库时，注意到agent采用面临一个根本性（但可以理解的）挑战：公司不愿意让AI应用在无人监督的情况下访问敏感操作，比如删除数据库表。</p>
<h3 data-id="heading-1">改变一切的转型</h3>
<p>这一认识成为HumanLayer的核心洞察：通常，任何软件中最有用的功能也是风险最高的，特别是对于非确定性的LLM驱动系统。</p>
<p>"我们的MVP是一个在Slack中与人类协调的agent，可以进行基本的清理工作，比如删除90多天未被查询的任何表格，"Horthy解释说。"我们不愿意让AI应用在无人监督的情况下运行原始SQL，所以我们加入了一些基本的人工审批步骤。"</p>
<p>2024年8月，Horthy构建了一个MVP，向旧金山的各个初创公司演示，并获得了他的第一批付费客户。这一进展使HumanLayer进入了YC F24批次，团队全力以赴提供API和SDK，让AI agents可以通过Slack、电子邮件、短信和其他渠道联系人类获取反馈、输入和批准。</p>
<p>通过2025年第一季度的广泛客户发现，HumanLayer团队与数十个构建AI agents的工程团队交流，意识到他们在agent开发循环中存在一个未曾预料到的差距。</p>
<p>"每个团队都有自己的agent架构，"Horthy解释说。"我们意识到我们不能只是构建一个更好的API——我们需要帮助建立让生态系统成熟的模式和原则。"</p>
<p>这促使Horthy在"<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhumanlayer%2F12-factor-agents" target="_blank" title="https://github.com/humanlayer/12-factor-agents" ref="nofollow noopener noreferrer">"12-Factor Agents: Patterns of reliable LLM applications"</a>"中记录了他们的学习成果。该指南于2025年4月发布，迅速走红，综合了他们构建生产agent系统的经验，并突出了新兴上下文工程学科的最佳实践。</p>
<h3 data-id="heading-2">使用Claude Code构建一切</h3>
<p>有了这些学习成果，HumanLayer团队开始探索替代产品理念和转型角度。</p>
<p>当Anthropic推出Claude Code时，Horthy和他的团队已经是Claude模型编码的强烈支持者。他们立即开始使用它来构建这些实验。</p>
<p>"我们只是用Claude Code编写所有内容，"Horthy说。"当Claude Agent SDK与Opus 4和Sonnet 4一起推出，支持无头agent执行时，我们知道这将是大事。"</p>
<p>在内部完善Claude Code工作流程几个月后，Horthy开始与亲密的创始人朋友分享它们。</p>
<p>"告诉我需要全力投入的时刻是与BoundaryML（YC W23）的Vaibhav进行的全天配对编程会议，"Horthy回忆说。"Vaibhav起初持怀疑态度，但在我们花了7个小时完成了通常需要1-2周的工作后，他被说服了。我意识到这个工作流程可以适用于其他团队和其他代码库。"</p>
<h3 data-id="heading-3">构建CodeLayer：扩展AI优先的工程</h3>
<p>如今，HumanLayer的产品CodeLayer帮助团队使用worktree和远程云端workers并行运行多个Claude agent会话。他们发现了一个关键模式：一旦工程师掌握了Claude Code，他们的生产力提升如此之大，以至于真正的挑战变成了组织性的——如何在整个团队中扩展这些工作流程。</p>
<p>"当你团队中的多个人都在发布AI编写的代码时，你面临的是完全不同类型的问题，"Horthy解释说。"这是一个沟通、协作、工具和管理问题。你必须重新构建团队构建软件的一切方式。"</p>
<p>自2025年第四季度开始以来，HumanLayer已经与各种规模的工程团队关闭了几个大型试点项目，部署这些工具和工作流程，所有这些都是用Claude Code构建的。</p>
<h2 data-id="heading-4">Ambral：用subagents构建生产系统</h2>
<blockquote>
<p>一家B2B SaaS / Salestech，做 <strong>AI Account Management Team / Customer Mission Control</strong>。</p>
<p>核心价值：</p>
<p>把 客户信号（产品使用日志、邮件、会议记录、工单等）汇总成每个账户的 <strong>AI 模型画像</strong>；</p>
<p>自动识别哪个客户需要关注、为什么需要关注，是 <strong>扩容机会</strong> 还是 <strong>流失风险</strong>；</p>
<p>主动给 AM/CSM 提建议甚至直接代为执行下一步动作（跟进邮件、安排会议等），本质上是“AI 版 post-sale 团队”。</p>
</blockquote>
<p>Jack Stettner和Sam Brickman创立Ambral来解决每个B2B创始人和CRO都熟悉的问题：随着公司扩展，推动早期增长的创始人级别的客户亲密关系变得不可能维持。</p>
<h3 data-id="heading-5">由Claude subagents驱动的客户管理</h3>
<p>无论是在经历高速增长的早期公司还是在成熟的企业公司，客户经理通常同时管理50到100个账户。"你无法用1/50的注意力提供有效的客户管理体验，"Stettner解释说。曾经适合创始人头脑中的客户背景分散在系统、日志、Slack消息、会议记录和产品使用数据中。</p>
<p>Ambral将来自客户活动和交互的信号综合成每个账户的AI驱动模型。系统精确指出谁需要关注以及为什么，自主驱动或推荐扩展，同时捕捉不满的早期迹象以防止流失。</p>
<p>"我们试图为每个客户提供一对一客户经理的体验，"Stettner说。</p>
<p>作为这家年轻初创公司的CTO和唯一工程师，Stettner在开发方面大量依赖Claude Code，并使用Claude的Agent SDK为产品本身提供动力。技术架构反映了对如何从不同Claude模型中提取最大价值的复杂理解。</p>
<h3 data-id="heading-6">委托工作流：Opus负责思考，Sonnet负责构建，周围都是subagents</h3>
<p>Stettner采用了一种精确的工作流程，结合subagents利用不同Claude模型的优势：</p>
<p>"我使用Opus 4.1进行研究规划。Sonnet 4.5在执行我在Markdown中创建的计划方面绝对killer，"Stettner解释说。</p>
<p>他的开发过程遵循三个不同阶段：</p>
<p><strong>研究阶段（Opus 4.1）</strong>：对功能实现所需的任何背景进行深入研究。"我认为最重要的是在规划之前做研究，"Stettner强调。"让Claude为你做研究，创建一个大的、长的研究文档。"他使用一系列subagents并行研究代码库的多个领域。</p>
<p><strong>规划阶段（Opus 4.1）</strong>：创建一个包含不同阶段的计划，说明如何实现功能。"我会让Opus创建一个包含阶段的计划，关于实际如何实现的具体阶段，然后我会修改那个计划。也许我会与Opus讨论某些细节的问题，或者我会手动更新这个markdown文件。"</p>
<p><strong>实现阶段（Sonnet 4.5）</strong>：系统地执行计划的每个阶段。"然后我会使用Sonnet 4.5去实现每个阶段。"</p>
<p>这种方法战胜了Stettner尝试的其他工作流程，并受到Humanlayer的Horthy正在做的一些工作的影响："我尝试了每个编码工具，基本上实验了每个模型。我只是认为Anthropic的模型目前在工具使用方面是最好的，这转化为代码。"</p>
<h3 data-id="heading-7">构建强大的研究引擎</h3>
<p>产品本身镜像了这种多agent方法。Stettner使用Claude Agent SDK构建了Ambral的核心研究引擎，每种数据类型都有专门的sub-agents。</p>
<p>"我花了很多时间使用Claude Agent SDK基本上构建了一个非常强大的研究引擎，可以在所有这些数据中运行，"Stettner解释说。"它基于Claude sub-agents，对于每种数据类型，我们都有一个专门的sub-agent，它是理解该数据的专家。"</p>
<p>无论用户与系统聊天还是Ambral为客户构建自动化，一切都由<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.claude.com%2Fen%2Fapi%2Fagent-sdk%2Foverview" target="_blank" title="https://docs.claude.com/en/api/agent-sdk/overview" ref="nofollow noopener noreferrer">Claude Agent SDK</a>和一系列sub-agents支持，这些sub-agents跨使用数据、Slack消息、会议记录和产品交互进行检索和推理。</p>
<p>架构灵感直接来自Stettner的开发经验："我认为Claude Code subagents做得多么好以及帮助我进行开发，这启发了我基本上想要采用那些相同的sub-agents并在产品本身的研究引擎中使用它。"</p>
<h2 data-id="heading-8">Vulcan Technologies：赋能非技术创始人发布产品</h2>
<blockquote>
<p>一家Reg-Tech / LegalTech**，做 <strong>AI 法规起草与合规</strong>，自称 <strong>“AI legal cartography”</strong> 。</p>
<p>用 AI 把美国的 <strong>法律、法规、判例</strong> 做成一个巨大的“法律图谱 / 知识图”；</p>
<p>帮政府部门、监管机构、行业组织和大企业做新法规/规章的起草、对现有法规进行一致性和合规性检查、找到“法律条文 vs 实际执行”中的错配</p>
</blockquote>
<p>对于Vulcan的CEO兼联合创始人Tanner Jones来说，Claude Code的影响远远超出了生产力——它构成了公司构建的民主化。在创立他们的初创公司时，Vulcan团队相信必须有一个能让政府为公民提供更好服务的产品。如果没有Claude Code，这一愿景将不可能实现，因为两位创始人都没有工程背景。</p>
<h3 data-id="heading-9">在没有专门工程师的情况下发布产品</h3>
<p>Vulcan解决了一个已经积累了几个世纪的问题：<a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FCode_of_Federal_Regulations" target="_blank" title="https://en.wikipedia.org/wiki/Code_of_Federal_Regulations" ref="nofollow noopener noreferrer">监管条例</a>复杂性。弗吉尼亚州众议院，世界上最古老的持续运作的民主机构，体现了这一挑战。400多年的监管积累创造了美国最细致和复杂的法规之一。</p>
<p>当Aleksander Mekhanik和Tanner Jones在2025年4月联合创立Vulcan时，两人都没有传统的工程背景。Mekhanik在大学学习ML和数学，而Jones的最后一次编程经历是高中的AP JavaScript课程，当时他们用纸和笔编写代码。然而，这对组合在5月1日为弗吉尼亚州州长办公室构建了他们第一个产品的原型——并且在竞标中击败了成熟的咨询公司。</p>
<p>"整个原型都是使用Claude制作的，"Jones解释说。"这是Claude Code之前的事情。它实际上是将脚本复制粘贴到web应用程序中，然后替换其中的实现方法。。"在构建原型后，他们聘请了他们的CTO Christopher Minge，他有在Google的Gemini和Waymo工作的经验。然后，当Claude Code在6月推出时，三人的速度又成倍增长。</p>
<p>Vulcan的AI驱动监管分析帮助将弗吉尼亚州新房的平均价格降低了24,000美元，通过识别冗余和重复的监管要求，每年为弗吉尼亚人节省超过十亿美元。弗吉尼亚州州长非常喜欢Vulcan的工作，以至于他<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.govtech.com%2Fartificial-intelligence%2Fvirginia-to-use-agentic-ai-to-power-review-of-regulations" target="_blank" title="https://www.govtech.com/artificial-intelligence/virginia-to-use-agentic-ai-to-power-review-of-regulations" ref="nofollow noopener noreferrer">签署了第51号行政命令</a>，强制要求所有州机构使用"agentic AI监管审查"。</p>
<h3 data-id="heading-10">公司构建的民主化</h3>
<p>对于Jones来说，Claude Code的影响超越了生产力指标。</p>
<p>"如果你理解语言并且理解批判性思维，你就能很好地使用Claude Code，"他说。"我实际上认为学过人文科学的人可能会有一些边际好处，因为我们与AI交流的媒介是语言。如果你对语言有很好的掌握，擅长构建组织良好的有序列表、嵌套项目符号和深思熟虑的过程，你的prompts可能会执行得更好。"</p>
<p>Jones赞扬Claude Code是Vulcan成功的重要组成部分："在四个月内，三个创始人，只有一个真正是技术背景，我们获得了州和联邦政府合同，并从一些顶级VC那里筹集了1100万美元的种子轮。没有Anthropic令人难以置信的工具，这一切都不可能实现。"</p>
<p>拥有"真正技术"背景训练的Vulcan CTO Christopher Minge，在如何思考工程方面经历了自己的转变。</p>
<p>"感觉有点像我在Google有一个同事，我把所有的想法和任务都给他们，他们经常犯错，但我的角色是委托给几个Claude Code实例，并善于检查常见错误和有效沟通想法，"Minge解释说。</p>
<h2 data-id="heading-11">YC创始人的最佳实践</h2>
<p>这三家初创公司已经开发了最大化Claude Code影响的经过实战考验的方法，包括：</p>
<h3 data-id="heading-12">1. 将研究、规划和实现分离到不同的会话中</h3>
<p>"不要让Claude在试图规划的时候进行研究，在试图实现的时候进行规划，"Stettner建议。"使用不同的prompts，并将它们变成不同的步骤。"</p>
<p>这种模式防止了上下文污染，允许每个阶段专注于其核心目标。为每个主要阶段启动一个新的Claude Code会话，只向前传递提炼的结论，而不是拖拽整个上下文历史。</p>
<h3 data-id="heading-13">2. 审慎地进行上下文管理</h3>
<p>Stettner对其他创始人的建议集中在审慎的上下文管理上：</p>
<p>"上下文至关重要。当我看到意外或低质量的输出时，通常是因为我在某个prompt中有矛盾，"他解释说。"在向系统prompt中放入什么信息或选择何时开始新对话方面要非常审慎，因为你不想混淆你的上下文。如果你的prompt中有任何矛盾，你将收到更低质量的输出。"</p>
<h3 data-id="heading-14">3. 监控并中断思维链</h3>
<p>"试着审视思维链并观察它在做什么，"Jones建议。"把手指放在扳机上，随时准备逃脱并中断任何不良行为。"</p>
<p>这在运行多个实例时变得尤其重要。在早期——前几次工具调用内——捕捉错误方向比让Claude Code完成整个错误方法节省更多时间。</p>
<h2 data-id="heading-15">新构建者优势</h2>
<p>这三家初创公司展示了使用像Claude Code这样的工具构建公司的根本转变。HumanLayer在转型和扩展的同时，制定了现在在YC生态系统中使用的上下文工程实践。Ambral正在用精简的创始团队大规模解决客户成功问题。Vulcan作为非工程师赢得了政府合同。</p>
<p>构建软件的传统障碍——技术专长、团队规模、开发时间——正在让位于新的竞争优势：清晰思考、结构化问题分解以及与AI有效协作的能力。</p>
<p>准备用Claude Code构建吗？</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Cursor & Claude 操作 Figma 画图]]></title>    <link>https://juejin.cn/post/7573899782803226670</link>    <guid>https://juejin.cn/post/7573899782803226670</guid>    <pubDate>2025-11-18T16:32:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782803226670" data-draft-id="7572749797469503497" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Cursor &amp; Claude 操作 Figma 画图"/> <meta itemprop="keywords" content="MCP,Cursor,Claude"/> <meta itemprop="datePublished" content="2025-11-18T16:32:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Keely40285"/> <meta itemprop="url" content="https://juejin.cn/user/2594503171249997"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Cursor &amp; Claude 操作 Figma 画图
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2594503171249997/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Keely40285
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T16:32:48.000Z" title="Tue Nov 18 2025 16:32:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>版权声明：本文为博主原创文章，未经博主允许不得转载。 文章底部留言可联系作者。</p>
</blockquote>
<h2 data-id="heading-0">一、背景</h2>
<p>现在各种AI工具的普及让人眼花缭乱，大家都在拥抱AI，之前朋友推荐某音的一个小视频看到可以使用Cursor操作Figma自动画图感觉非常神奇，正好我 Claude和Cursor 都在使用，对有意思的工具做了一些尝试，现在总结下经验希望可以帮助大家。</p>
<h2 data-id="heading-1">二、Cursor 如何操作 Figma</h2>
<h3 data-id="heading-2">1. 安装 Cursor</h3>
<p>Cursor 可以点击<a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fcn%2Fdownload" target="_blank" title="https://cursor.com/cn/download" ref="nofollow noopener noreferrer">官网下载</a>选择合适版本进行使用。新账号试用过后需要付费使用，具体使用方法可以自行网上百度各种方案,比如无限续杯，或者某鱼看看。如果公司能提供使用的账号那就更不错了。本人目前开通的是Pro版本。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aae7950fb5d6458eb52bf393999016c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=UqzGwPSqXWxeR7PxYcHhj%2F2vPLU%3D" alt="Cursor下载页面.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99128ec1639e4ccd854b40d87d7396ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=m8AqvXMvppXq8b2VSmRl6unLTLE%3D" alt="Cursor购买方案.png" loading="lazy"/></p>
<p>Cursor安装后如何使用这边可以看B站的教学视频进行学习：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1zen9zHEVD%2F%3Fshare_source%3Dcopy_web%26vd_source%3D786b02b55d0bbbdeb4ec93c491968dac" target="_blank" title="https://www.bilibili.com/video/BV1zen9zHEVD/?share_source=copy_web&amp;vd_source=786b02b55d0bbbdeb4ec93c491968dac" ref="nofollow noopener noreferrer">【AI编程】2025最新Cursor全套使用教程，通俗易懂，从入门到实战！新手友好，学不会我退出AI圈！AI编程|Cursor教程</a></li>
</ul>
<h3 data-id="heading-3">2. 安装Figma</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2F" target="_blank" title="https://www.figma.com/" ref="nofollow noopener noreferrer">Figma</a> 也是付费软件才能使用MCP功能，这里可能会有小伙伴疑惑MCP是什么东西，<a href="https://link.juejin.cn?target=https%3A%2F%2Fmodelcontextprotocol.io%2Fdocs%2Fgetting-started%2Fintro" target="_blank" title="https://modelcontextprotocol.io/docs/getting-started/intro" ref="nofollow noopener noreferrer">点击这里链接</a>  来了解什么是MCP。总之有了MCP以后，Cursor、Claude 就可以操作Figma了。</p>
<p>Figma <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2Fdownloads%2F" target="_blank" title="https://www.figma.com/downloads/" ref="nofollow noopener noreferrer">点击官网进行下载</a>安装。付费版才可以使用MCP功能，开通方式自行搜索，或者有公司提供账号更好。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acc3d1c97e92454a84bd880a11fe4be5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=LtKunKsxdTDXFfWU%2B0YHw5P5gik%3D" alt="figma下载.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efa6432067e4408d881665d6e4faeb04~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=nfNPbyDcXskybox6Rtwtz315h1I%3D" alt="figma 付费方案.png" loading="lazy"/></p>
<p><strong>注意：</strong></p>
<ul>
<li>figma 可以通过 <code>shift+D</code> 或者右下角 <code>&lt;/&gt;</code> 按钮 切换 <code>DevMode</code>，然后开启 <code>MCP server</code>，但是开启这个MCP 无法在 Cursor 中操作画图。</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4972554100474067a24b6061c605049e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=3rhiktSzNb9mPYrayjGckB4Zz7Q%3D" alt="shift+D.png" loading="lazy"/></p>
<h3 data-id="heading-4">3. 配置MCP</h3>
<p>当前面两步搞定之后，我们就可以给Cursor配置MCP了。首先从github上搜相关MCP，找到了star最多的，理论上应该也是最好用的MCP：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgrab%2Fcursor-talk-to-figma-mcp" target="_blank" title="https://github.com/grab/cursor-talk-to-figma-mcp" ref="nofollow noopener noreferrer">cursor-talk-to-figma-mcp</a>。</p>
<p>此时你一定会好奇为什么不是上面的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FGLips%2FFigma-Context-MCP" target="_blank" title="https://github.com/GLips/Figma-Context-MCP" ref="nofollow noopener noreferrer">Figma-Context-MCP</a> ？这是因为这款MCP主要是用来将设计稿转成代码的。可以参考下这篇文章<a href="https://link.juejin.cn?target=https%3A%2F%2Fzhuanlan.zhihu.com%2Fp%2F1953846512003059905" target="_blank" title="https://zhuanlan.zhihu.com/p/1953846512003059905" ref="nofollow noopener noreferrer">《Cursor集成Figma Context MCP，设计稿直接生成代码》</a>来学习下。而我们的目标是通过Cursor来操作Figma生成设计稿所以就略微不太合适了。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b325c81fe7344237a363dc29ef7fe24f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=z48WF7UvBU0OcL%2FXHQNaZ61LGGg%3D" alt="搜索Figma的MCP.jpg" loading="lazy"/></p>
<h4 data-id="heading-5">拷贝项目到本地并启动</h4>
<p>首先把项目克隆到本地，然后按照文档提示，安装依赖并启动</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> git@github.com:grab/cursor-talk-to-figma-mcp.git
<span class="hljs-built_in">cd</span> cursor-talk-to-figma-mcp

bun setup
</code></pre>
<p>启动服务：</p>
<pre><code class="hljs language-perl" lang="perl">bun <span class="hljs-keyword">socket</span>
</code></pre>
<p>启动效果如下图：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e6f08367a8748669013eb858d2e2f77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=wRnTqvAXwRYIpTHVR6b%2F8aquwj0%3D" alt="启动效果.png" loading="lazy"/></p>
<h4 data-id="heading-6">Figma中配置plugin</h4>
<p>打开figma软件以后，新建 Design</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7b40027fef9f4bdc992202ed89d1c4bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=n6gNMj8p9%2BRJHNMXTUiNR5u29uU%3D" alt="新建 Design.png" loading="lazy"/></p>
<p>选择菜单栏 Plugins -&gt; Development
然后导入 <code>src/claude_mcp_plugin/manifest.json</code> 文件</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9df689da444f482594421bd7c0195e39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=keKzBJbwHHajjrbmjOMBXkYePTI%3D" alt="菜单.png" loading="lazy"/></p>
<p>或者点击 Plugins -&gt; Manage Plugins... 打开下面弹窗，直接搜索<code>Cursor Talk To Figma MCP Plugin</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ad12fc9090e4bf98b0c948887bf1bde~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=l%2BjnGTGA2TdJ0c37aL6lHH6b83c%3D" alt="Cursor Talk To Figma MCP Plugin.png" loading="lazy"/></p>
<p>安装后点击打开：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61e32df60c4e47cc9d79dc985d23a106~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=QnlQf2jQaYz9bBpPbeDm17bkNCE%3D" alt="mcp已连接.png" loading="lazy"/></p>
<h4 data-id="heading-7">在Cursor配置MCP</h4>
<p>将上面json格式文件复制，打开Cursor，选择<code>Tools &amp; MCP</code>菜单，点击 <code>New MCP Server</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/140ae6389f3f4e9b811871027d41a363~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=s4s5kmYNBwkvO172lPwpO8qLz8o%3D" alt="Cursor mcp.png" loading="lazy"/></p>
<p>将刚才json文件添加进去：
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de481b65076348a8b03065b23d1b9367~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=OvHFAlqtzpg%2FRxwIkIR2oA%2FuO6Y%3D" alt="mcp配置.png" loading="lazy"/></p>
<p>然后启用<code>TalkToFigma</code>这个 MCP</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/082a0946344145289ffd0bc0898afc10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=gk%2BmFnC2uXCNpseRa%2BzoBGaoFHo%3D" alt="TalkToFigma.png" loading="lazy"/></p>
<p>此时就可以在Cursor对话框中输入<code>channel id</code> 进行连接，提示连接成功以后如下图所示：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/88b23062a6f0458f8e96813646ce2a5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=tpxtxDonCxkVAyowH1dg%2BzavzKU%3D" alt="连接figma.png" loading="lazy"/></p>
<h4 data-id="heading-8">通过Cursor 操作 Figma</h4>
<p>此时就可以让Cursor在Figma中进行画图了，如下效果所示：</p>
<p>让figma设计一个移动端的登录页面</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dddd30ee06b140e6956ccf45992ef987~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=Ss1oFUpdvcmsr%2FmcMA%2FNuW1NyNE%3D" alt="移动端的登录界面.png" loading="lazy"/></p>
<h2 data-id="heading-9">三、Claude 如何操作 Figma</h2>
<h3 data-id="heading-10">1. 安装 Claude</h3>
<p>点击查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fen%2Foverview%23npm" target="_blank" title="https://code.claude.com/docs/en/overview#npm" ref="nofollow noopener noreferrer">Claude 官方文档</a>进行安装，
网上有很多安装教程，如果没有 Claude的API key，可以参考这篇教程 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1678591" target="_blank" title="https://developer.aliyun.com/article/1678591" ref="nofollow noopener noreferrer">通过 DeepSeek 3.1 配置 Claude Code 教程</a>，API key 也可以。</p>
<p>安装完成，<strong>启动 Claude Code</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 控制台输入</span>
claude
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8094e2c3e4a4fe0bdce7151349ba451~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=1e5lrPbRyycIELAhIWh5EGkESTI%3D" alt="claude启动效果.png" loading="lazy"/></p>
<h3 data-id="heading-11">2. 配置MCP</h3>
<p>前面已经介绍过如何安装Figma了，这里接介绍下如何给Claude配置MCP，MCP依然使用前面安装的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgrab%2Fcursor-talk-to-figma-mcp" target="_blank" title="https://github.com/grab/cursor-talk-to-figma-mcp" ref="nofollow noopener noreferrer">cursor-talk-to-figma-mcp</a></p>
<blockquote>
<p><strong>注意：</strong> 可能你也可以搜索到 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Farinspunk%2Fclaude-talk-to-figma-mcp" target="_blank" title="https://github.com/arinspunk/claude-talk-to-figma-mcp" ref="nofollow noopener noreferrer">claude-talk-to-figma-mcp</a> 这个MCP，但是很遗憾在使用时，启动时会报错，暂时还没有找到解决办法，可以看这个issues：
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Farinspunk%2Fclaude-talk-to-figma-mcp%2Fissues%2F19" target="_blank" title="https://github.com/arinspunk/claude-talk-to-figma-mcp/issues/19" ref="nofollow noopener noreferrer">github.com/arinspunk/c…</a> 。但是发现 cursor-talk-to-figma-mcp 是可以在claude中使用。</p>
</blockquote>
<ul>
<li>前面步骤中Figma中配置plugin 获取到的MCP的json文件可以配置到项目 .mcp.json 文件中（只有在当前项目目录下才有这个MCP），MCP配置方式可以<a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fmcp" target="_blank" title="https://code.claude.com/docs/zh-CN/mcp" ref="nofollow noopener noreferrer">参考Claude 官方文档</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e04c8f2b91294a16918868be284bea5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=D6NYl22vMMshik4fTVsnLuZbK4U%3D" alt="配置claude mcp.png" loading="lazy"/></p>
<p>然后通过 <code>/mcp</code> 来查看配置的MCP是否连接正常</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f5c6c2877044228a2750bc5a636c38b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=%2F8iPvNzasBorRO0iuSP4FCZeQEA%3D" alt="查看mcp.png" loading="lazy"/></p>
<h3 data-id="heading-12">3. Claude 操作 Figma</h3>
<p>Figma配置和启动等步骤和前面Cursor中介绍的相同，这里配置完MCP就可以测试连接figma：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6a61043e52d4490787e682f354ef4e8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=OtlHahJYXJes9eVQJD5PtHkam%2F4%3D" alt="连接figma.png" loading="lazy"/></p>
<p>操作figma生成移动端登录页面：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84161c8b7f3545b3b77115bb346a969c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgS2VlbHk0MDI4NQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764088368&amp;x-signature=XCYARewBO4qA2I%2B9SUAqgTegAE4%3D" alt="claude 控制figma.png" loading="lazy"/></p>
<h2 data-id="heading-13">参考文档</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcursor.com%2Fcn%2F" target="_blank" title="https://cursor.com/cn/" ref="nofollow noopener noreferrer">Cursor</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.figma.com%2F" target="_blank" title="https://www.figma.com/" ref="nofollow noopener noreferrer">Figma</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fen%2Foverview%23npm" target="_blank" title="https://code.claude.com/docs/en/overview#npm" ref="nofollow noopener noreferrer">Claude 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F1678591" target="_blank" title="https://developer.aliyun.com/article/1678591" ref="nofollow noopener noreferrer">通过 DeepSeek 3.1 配置 Claude Code 教程</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.claude.com%2Fdocs%2Fzh-CN%2Fmcp" target="_blank" title="https://code.claude.com/docs/zh-CN/mcp" ref="nofollow noopener noreferrer">通过 MCP 将 Claude Code 连接到工具</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今晚Cloudflare一哆嗦，我的加班计划全泡汤]]></title>    <link>https://juejin.cn/post/7573886599433830451</link>    <guid>https://juejin.cn/post/7573886599433830451</guid>    <pubDate>2025-11-18T15:38:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433830451" data-draft-id="7573900332637126666" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今晚Cloudflare一哆嗦，我的加班计划全泡汤"/> <meta itemprop="keywords" content="后端,前端,程序员"/> <meta itemprop="datePublished" content="2025-11-18T15:38:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一旅人"/> <meta itemprop="url" content="https://juejin.cn/user/3485898277388519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今晚Cloudflare一哆嗦，我的加班计划全泡汤
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485898277388519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一旅人
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T15:38:35.000Z" title="Tue Nov 18 2025 15:38:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>事情发生在今晚加班的黄金时间。我正对着代码发愁，想着让ChatGPT帮我debug一下。结果连续三次重试，等来的都是冷冰冰的错误页面。</p>
<p>"行吧，AI也有累的时候"，我自我安慰着，顺手想点开X摸鱼五分钟。</p>
<p>结果呢？小鸟直接躺平了。页面加载圈转得比我家旧电脑开机还慢。</p>
<p>那一刻我突然顿悟——这不是某个网站的问题，这是互联网的"大动脉"堵了。</p>
<p>而罪魁祸首，就是那个你可能从未听说过，却在背后支撑着你每天访问的大半个互联网的<strong>Cloudflare</strong>。</p>
<hr/>
<h3 data-id="heading-0">这个幕后大佬，到底在互联网里扮演什么角色？</h3>
<p>想象一下，你要从北京点一份上海的生煎包。如果没有Cloudflare，你得亲自跑一趟上海，等包子送到你手里，早就凉透了。</p>
<p>但有了Cloudflare，就相当于在每个小区门口开了家"包子铺分店"——你下楼就能吃到热腾腾的包子，还省了机票钱。</p>
<p>具体来说，Cloudflare在互联网里干着三件大事：</p>
<p><strong>全球快递网络（CDN）</strong>
它在全球300多个城市建立了"分店"，把你网站的内容复制到世界各地。用户访问时，直接从最近的节点获取数据，速度快到飞起。</p>
<p><strong>24小时保安队长（安全防护）</strong>
它站在网站门口，识别并拦截恶意流量，把黑客攻击挡在门外。就像商场安检，让捣乱分子根本进不了门。</p>
<p><strong>永不迷路的导航系统（DNS解析）</strong>
它负责把"juejin.cn"这样的域名翻译成服务器能听懂的IP地址。今晚就是这个"导航系统"突然抽风，让大家都迷了路。</p>
<hr/>
<h3 data-id="heading-1">一次看似普通的维护，怎么就演变成了全球崩盘？</h3>
<p>根据Cloudflare状态页面的信息，故障从UTC时间06:40（北京时间14:40）左右开始。</p>
<p>其实在故障发生前，Cloudflare确实有几个数据中心的维护计划。这本来是个常规操作，就像给大楼换个灯泡那么简单。</p>
<p>但意外发生了：维护过程中触发了<strong>自动化故障转移的连锁反应</strong>。简单说，就是关掉A线路时，本该自动切换到B线路，结果B线路没接住，还把C线路也给带崩了。</p>
<p>这就好比你只是想换个灯泡，结果不小心触发了整栋楼的短路保护，连电梯都停运了。</p>
<p>多米诺骨牌开始接连倒下：</p>
<ul>
<li>X平台用户报告数在短时间内激增到<strong>5600多条</strong></li>
<li>ChatGPT直接摆烂，显示"请取消阻止challenges.cloudflare.com"</li>
<li>各种网站开始刷屏"500 Internal Server Error"</li>
<li>连Cloudflare自己的管理后台都进不去了</li>
</ul>
<p>最讽刺的是什么？就像一个修车师傅，在客户的车坏掉的同时，发现自己的工具箱也打不开了。</p>
<hr/>
<h3 data-id="heading-2">为什么Cloudflare一出事，影响范围就这么广？</h3>
<p>要理解这一点，先来看看Cloudflare在互联网世界的地位。</p>
<p>数据显示，全球<strong>超过20%</strong> 的网站使用Cloudflare的服务。这还不包括那些间接依赖它的大型平台。</p>
<p>把它想象成<strong>北京东直门立交桥</strong>：当这个交通枢纽突然封闭，受影响的不仅是桥上的车，还会导致整个二环、三环陷入瘫痪，进而波及整个城市的交通系统。</p>
<p>这不是Cloudflare第一次"牵一发而动全身"。根据你提供的资料，在故障期间，Cloudflare股价盘前下跌约<strong>4.1%</strong>，市场反应立竿见影。</p>
<hr/>
<h3 data-id="heading-3">从今晚的"数字便秘"中，我们该学到什么？</h3>
<p>这次事件与其说是一次事故，不如说是一次<strong>互联网依赖度的压力测试</strong>。</p>
<p><strong>别把鸡蛋都放在一个篮子里</strong>
再可靠的服务商也可能出问题。关键业务应该有备用方案，就像你不会只记电话号码在手机上，还会备份在别处。</p>
<p><strong>自动化是双刃剑</strong>
自动化系统能提高效率，但也可能放大错误。一个微小的配置问题，通过自动化流程的传导，可能演变成全球故障。</p>
<p><strong>监控不能只靠感觉</strong>
等到用户反馈问题时才意识到故障，为时已晚。建立完善的监控体系，才能在问题萌芽时就发现它。</p>
<hr/>
<h3 data-id="heading-4">写在最后</h3>
<p>几小时后，服务逐渐恢复。ChatGPT重新变得健谈，X上的小鸟再次起飞。</p>
<p>但这次短暂的"全球断联"，给我们提了个醒：我们习以为常的数字化生活，其实建立在一系列复杂且脆弱的基础设施之上。</p>
<p>下次再遇到全网抽风，不妨先泡杯茶——很可能不是你的网线出了问题，而是某个遥远的"云"，又打了个喷嚏。</p>
<p>而我们能做的，就是在享受便利的同时，随时准备好自己的"伞"。毕竟在这个高度互联的时代，<strong>越是便利，越是集中；越是集中，风险越高。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Anthropic 出手，大幅降低 MCP 的 Token 消耗]]></title>    <link>https://juejin.cn/post/7573888000020463679</link>    <guid>https://juejin.cn/post/7573888000020463679</guid>    <pubDate>2025-11-18T14:06:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573888000020463679" data-draft-id="7573888000020447295" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Anthropic 出手，大幅降低 MCP 的 Token 消耗"/> <meta itemprop="keywords" content="Claude,MCP,人工智能"/> <meta itemprop="datePublished" content="2025-11-18T14:06:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="飞哥数智谈"/> <meta itemprop="url" content="https://juejin.cn/user/3825956195409223"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Anthropic 出手，大幅降低 MCP 的 Token 消耗
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956195409223/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    飞哥数智谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T14:06:43.000Z" title="Tue Nov 18 2025 14:06:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>以前要实现一个 <code>Agent</code>，需要手动完成一个个 <code>API</code> 的接入和调试，现在有了 <code>MCP</code>，接入外部能力的工作简单了许多。</p>
<p>但 MCP 多了之后，模型上下文中塞入了大量的工具定义，导致模型既慢，又浪费 <code>Token</code>。</p>
<p>直到看到了 <code>Anthropic</code> 的《Code execution with MCP: Building more efficient agents》，我才发现 MCP 的调用原来也是可以很高效的。</p>
<h2 data-id="heading-0">传统 MCP 的效率瓶颈</h2>
<p><code>MCP</code> 在规模化应用中有两个关键短板：</p>
<h3 data-id="heading-1">工具定义“占满”上下文</h3>
<p>为了让智能体知道如何使用工具，<code>MCP</code> 方式会把所有工具的功能描述、参数要求等加载到模型的上下文中。</p>
<p>在大规模项目中，这些定义信息可能就会占用数十万 <code>Token</code>，不仅拖慢响应速度，还会大幅增加使用成本。</p>
<h3 data-id="heading-2">中间结果重复消耗资源</h3>
<p>智能体完成复杂任务时，往往需要多次调用工具，并传递中间结果。</p>
<p>比如将云盘文档同步到业务系统，文档会在云盘 MCP 和业务系统 MCP 中<strong>多次传输</strong>，导致上下文超出限制，甚至任务中断。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f8e7cdd6e8b4bb2b2d052bb3223c4cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764079603&amp;x-signature=MJOYgjsP2SDAciUlcZddJjxkvUI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">解决方案：代码执行</h2>
<p><strong>代码执行</strong>的核心逻辑，是把 MCP 工具从 “直接调用的功能” 转变为 “可由代码调用的 API”。</p>
<p>智能体不再被动接收全部的工具定义，而是根据需要自动编写代码进行 MCP 调用，这一方案带来了多重提升：</p>
<h3 data-id="heading-4">渐进式披露，减轻上下文负担</h3>
<p>将工具以代码形式呈现在文件系统上，能让模型按需读取工具定义，而非预先全部读取。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e300d0a2907e4218a438926816ae608d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764079603&amp;x-signature=z%2BsjuxRR4EfY0BCbRdgqqxB69l8%3D" alt="代码执行的工具定义" loading="lazy"/></p>
<p>“渐进式披露”的工作流程如下：</p>
<p>1、预加载极简提示： 在 LLM 的上下文窗口中，我们只植入工具的名称、主要参数和功能的精炼代码签名（例如 tool.searchOrders(customer_id: str)）。这部分信息占用的 Token 非常少。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c796f8f9ede644ac9d692920fbb61c0f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6aOe5ZOl5pWw5pm66LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764079603&amp;x-signature=kjU3iVuKKubtvsu2QO2B3KCTFH8%3D" alt="" loading="lazy"/></p>
<p>2、Schema 外部化： 所有工具冗长、复杂的 JSON Schema 和验证规则，被移出 LLM 上下文，存储在外部的 MCP Server 的“工具注册中心”。</p>
<p>3、代码触发查找： 当 LLM 生成代码 tool.searchOrders('U456') 并发送给 Server 执行时，Server 才会去其外部的工具注册中心查找 searchOrders 的完整定义，并用它来执行 API 调用。</p>
<h3 data-id="heading-5">本地处理数据，减少中间传输</h3>
<p>面对大文件、海量数据任务时，智能体可以编写代码，在执行容器中先筛选、处理，最后只需把<strong>结果返回给模型</strong>，避免大量冗余数据消耗传输 Token。</p>
<p>这个思路竟然与我们上半年实现“问数”的思路类似。不过，我们当时还没有意识到这样节省 Token 传输，我们仅仅是因为 text2sql 不太可靠，采用了智能体调用各种“算子”（各种已有的数据处理类 API）。</p>
<h3 data-id="heading-6">简化复杂流程，降低操作成本</h3>
<p>在一些复杂场景中，比如系统监控通知、批量处理数据场景中，代码执行模式还可以利用<strong>代码的循环、条件判断逻辑</strong>，简化实现，减少智能体的反复工具调用，大幅减少延迟及操作成本。</p>
<h3 data-id="heading-7">数据隐私保护</h3>
<p>除了上述提升效率、降低成本的益处外，代码执行还有一个隐藏的好处。</p>
<p>由于中间结果默认保留在安全的执行环境中，原始数据无需进入模型的上下文，只有统计结果才会返回给智能体，这在很大程度上可以<strong>保护用户的数据隐私</strong>。</p>
<h2 data-id="heading-8">结语</h2>
<p>尽管 <code>Anthropic</code> 在某些政策上存在争议，但其在 <code>Agent</code> 道路上的技术探索不得不说非常值得学习。</p>
<p>推荐大家多关注他们的技术博客，收益良多~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Visual Studio 2026真的值得升级吗中国开发者实测报告]]></title>    <link>https://juejin.cn/post/7573886599433699379</link>    <guid>https://juejin.cn/post/7573886599433699379</guid>    <pubDate>2025-11-18T14:17:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433699379" data-draft-id="7573896789365686310" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Visual Studio 2026真的值得升级吗中国开发者实测报告"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T14:17:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Visual Studio 2026真的值得升级吗中国开发者实测报告
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T14:17:21.000Z" title="Tue Nov 18 2025 14:17:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025年11月11日，微软正式发布Visual Studio 2026，国内开发者社区瞬间炸锅！这款号称"世界首个智能开发环境（IDE）"的更新，解决5000多个bug、响应300多项功能请求，实测解决方案加载速度和UI响应时间直接砍半，最关键的是承诺100%兼容VS2022的项目和扩展。面对这样的开发神器，你还要守着VS2022当"钉子户"吗？</p>
<h2 data-id="heading-0">为什么现在必须升级到Visual Studio 2026</h2>
<p>在咱们码农的世界里，效率就是生命线！当你调试线上紧急bug或赶deadline时，IDE每卡顿一秒都可能让你头皮发麻。Visual Studio 2026的推出，正是来解救"效率焦虑症患者"的。微软官方数据显示，VS2026不仅解决5000多个bug，还响应300多个开发者功能请求，稳定性和实用性实现质的飞跃！</p>
<p>更重要的是，VS2026引入"智能开发环境"概念，把AI无缝融入开发全流程。这可不是简单的代码补全，而是从调试、性能分析到应用现代化的全方位智能支持。微软说："这不是为了AI而AI，而是工具的自然进化。"在AI驱动开发的时代，拒绝升级可能意味着你正在慢慢掉队！</p>
<p>国内开发者实测反馈更香！有位老哥在论坛分享："我用VS2026打开公司包含20多个微服务的解决方案，以前VS2022要加载3分钟，现在居然45秒搞定，编译速度也快不少，再也不用边喝咖啡边等IDE响应了！"这样的效率提升，难道不是每个开发者梦寐以求的吗？</p>
<p>早期采用者的反馈更印证这点。NimblePros首席软件架构师Steve Smith兴奋表示："我刚刚打开包含100多个项目的解决方案，简直不敢相信启动这么快，马上就能用了！干得好，Visual Studio团队！"</p>
<h2 data-id="heading-1">Visual Studio 2026与2022对比五大显著优化改变开发体验</h2>
<p>说到升级，咱们最关心的是：VS2026到底比VS2022强在哪儿？直接上干货！</p>
<p>首先是<strong>解决方案加载速度</strong>的革命性提升。微软测试数据显示，加载大型.NET解决方案时，VS2026交互就绪时间比VS2022快很多。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60046b4d92a74910adfbb30d072b2e87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764080241&amp;x-signature=nAtYFsNjBP6%2FmniIOX0EOajTyJU%3D" alt="Visual Studio 2026与2022解决方案加载时间对比" loading="lazy"/></p>
<p>但速度快只是一方面，更重要的是<strong>UI响应性</strong>提升。咱们都经历过打开大型解决方案时IDE界面"卡死"的尴尬。VS2026彻底解决这个痛点，把UI无响应时间减少一半以上！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f9743db817e74abf8de3c3c9ea626641~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764080241&amp;x-signature=5kxDuqZp3Eraav%2BtEJlOQow%2BY%2Fk%3D" alt="Visual Studio 2026与2022解决方案加载挂起时间对比" loading="lazy"/></p>
<p>第三大优化是<strong>整体性能和流畅度</strong>提升。虽然数字直观，但真正的爽快感只有用过才知道。VS2026给人的感觉就是"快、流畅、响应迅速"，这种体验飞跃没法用简单数字衡量。</p>
<p>第四，<strong>用户界面的现代化</strong>也是亮点。VS2026采用全新UI设计，不仅好看更重要的是好用。Context&amp; A/S的Erik Ejlskov Jensen特别提到："我最喜欢Visual Studio 2026的是它的性能和清新明快的UI——对Mermaid图表的支持更是锦上添花。"</p>
<p>最后，最让咱们兴奋的是<strong>AI原生体验</strong>的引入。VS2026不再简单添加AI功能，而是把AI深度融入整个开发流程，从代码编写到调试优化，AI都在恰当时候提供帮助，不会打断工作流。</p>
<h2 data-id="heading-2">Visual Studio 2026的AI革命智能但不越界的支持策略</h2>
<p>Visual Studio 2026最吸睛的莫过于AI功能。微软称其为"世界首个智能开发环境（IDE）"，这到底意味着什么？</p>
<p>说白了，VS2026的AI不是来抢饭碗的，而是当"超级助手"。它采用"需要时才出现"的策略，在你调试复杂问题、分析性能瓶颈或现代化应用时，AI会主动跳出来帮忙，消除障碍，提供洞见，让你更快前进，不会打断工作流。</p>
<p>这种策略核心是"增强而非替代"。微软强调："这意味着在最重要的时候给你智能。它旨在提升你已经信任的实践，而不是取代它们。"这种理念开发者太认同了！Redis高级全球解决方案架构师Roberto Perez分享："Visual Studio中的Profiler Agent立即突出瓶颈，并指导我实现更快、更简洁的性能——就像有一个内置的性能教练。"</p>
<p>VS2026还引入新的C#和C++智能代理，专为需要精确和速度的专业开发者设计。这些功能扩展能力却不增加复杂性，让你保持控制的同时，用更少时间干更多活儿。</p>
<p>国内多语言项目团队狂喜！有位做跨境电商系统的架构师分享："我们项目同时用C#写后端、C++做底层算法，VS2026的智能代理简直是救星！自动识别不同语言最佳实践，还能提示多语言交互坑点，比以前省至少30%调试时间。"</p>
<p>值得注意的是，微软选择将GitHub Copilot深度整合到VS2026中。这不是拍脑袋决定，而是基于开发者实际需求的战略选择。GitHub Copilot已成为VS中使用最广泛的功能之一，深受依赖它的开发者好评。通过将AI能力与实际开发需求紧密结合，VS2026成功避免"为AI而AI"的陷阱，真正做到"智能但不越界"。</p>
<h2 data-id="heading-3">从VS2022到VS2026开发者真正的无痛迁移如何实现</h2>
<p>对很多开发者来说，升级IDE最头疼的是兼容性问题。项目能不能打开？扩展还能不能用？会不会有隐藏的坑？VS2026给出惊喜答案：100%兼容！</p>
<p>微软承诺，VS2026完全兼容VS2022的项目和扩展。打开现有解决方案，立即开始编码，无需任何迁移步骤，不会有任何意外。所有喜欢的扩展都能使用，让工作区、工具和项目无缝过渡，从第一次启动就让IDE感觉像家一样。</p>
<p>国内云服务集成毫无压力！某互联网公司DevOps工程师分享："我们项目用了阿里云、腾讯云的各种SDK和工具，升级VS2026前还担心兼容性问题，结果完全多虑了！所有云服务集成代码直接跑，连调试断点都能完美命中，这才是真正的'无痛迁移'。"</p>
<p>数据显示，目前与VS2022兼容的4000多个扩展，全部都能在VS2026上运行。Aspen Technology首席软件工程师Didier Donner表示："能够从Visual Studio 2022获得扩展是一个明显优势：我可以立即开始使用VS 2026。"</p>
<p>更革命性的是，VS2026将IDE与构建工具解耦。过去，更新Visual Studio通常意味着必须升级.NET和C++构建工具，往往带来很多麻烦。现在，可以随时更新VS2026，不会影响.NET或C++编译器。更棒的是，将获得每月自动更新，新鲜功能、设计调整和 productivity 提升直接送到IDE，同时保持工具链稳定。</p>
<p>低配置设备福音！有位独立开发者分享："我那台用了三年的笔记本，跑VS2022经常卡顿，本来以为带不动VS2026，结果实测比VS2022还流畅！特别是解决方案加载速度，以前要等一分多钟，现在20秒搞定，这优化太良心了！"</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4b1defe181c422ea77c8b373fde404a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764080241&amp;x-signature=qnoGC%2FfglQxt7A80Qe4dioVzWRs%3D" alt="Visual Studio团队过去12个月修复的反馈工单统计" loading="lazy"/></p>
<p>这张图表展示Visual Studio团队过去12个月修复的反馈工单数量，充分体现微软对开发者体验的重视。有这样的支持，还有什么理由拒绝升级呢？</p>
<h2 data-id="heading-4">结语升级VS2026拥抱开发者的未来</h2>
<p>Visual Studio 2026的推出，不仅是常规版本更新，更是开发工具的革命性进化。它带来的不仅是速度提升和bug修复，更是全新开发体验——AI驱动、无缝流畅、兼容稳定。</p>
<p>从解决5000多个bug到300多项功能改进，从解决方案加载速度飞跃到UI响应时间减少50%以上，再到100%兼容VS2022项目和扩展，VS2026用实实在在的数据证明价值。早期采用者热烈反馈印证：这不仅是更好的IDE，更是能真正提升开发效率和质量的智能助手。</p>
<p>在软件开发这个快速发展的领域，停滞不前就意味着落后。Visual Studio 2026不仅让你跟上时代，更让你走在前沿。现在就下载升级，体验"更快、更智能"的开发快感，让代码之旅与众不同！</p>
<p>记住，最好的开发工具，是让你忘记工具的存在，专注于创造本身。Visual Studio 2026，正是为开发者而来。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[电科金仓在医院怎么用？从迁移到跑稳，聊点实在的]]></title>    <link>https://juejin.cn/post/7573890735579021322</link>    <guid>https://juejin.cn/post/7573890735579021322</guid>    <pubDate>2025-11-18T14:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735579021322" data-draft-id="7573899782803095598" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="电科金仓在医院怎么用？从迁移到跑稳，聊点实在的"/> <meta itemprop="keywords" content="数据库"/> <meta itemprop="datePublished" content="2025-11-18T14:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="倔强的石头_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            电科金仓在医院怎么用？从迁移到跑稳，聊点实在的
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    倔强的石头_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T14:42:23.000Z" title="Tue Nov 18 2025 14:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读18分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5c873ea1428415e8b6199d526503984~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=n7Pow7bQwpsoF0xCanm3sP70%2FuM%3D" alt="" loading="lazy"/>
@[toc]</p>
<h2 data-id="heading-0">写在前面</h2>
<p>近些年来，医院向数字化转型的速度极快，数据库这块“地基”非常关键，选型是否稳定，使用起来是否顺手，后期能否控制得住，这些都会影响到整个医院信息系统的根基。本文不过多阐述抽象概念，而是站在医院立场，用简单易懂的语言探讨电科金仓数据库如何切实落地，包含从国产化迁移以确保系统稳定运行的具体办法与步骤，并附上一些现成的SQL语句，这样一线工作人员在模仿操作时会更为便捷。</p>
<p>据公开资料，金仓数据库，已被许多三甲医院核心系统采用，云HIS，LIS，PACS，EMR等重要业务均有其应用实例，该产品已通过EAL4 + 这种高级别安全认证，具备主备，高可用，多活等架构能力，还附带一套包含迁移和同步功能的工具，在医疗这个关键领域，其基本形成了一套较为完善的国产化替代方案。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bf575dd9c80490aad70a0347187cbe8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=8quJVqpX4lCty1eS%2Fp2f3fgTzR0%3D" alt="image.png" loading="lazy"/>
2024年中国数据库管理系统市场厂商竞争力象限分析图</p>
<h2 data-id="heading-1">医院信息系统有哪些绕不开的坎儿？</h2>
<ul>
<li><strong>换系统，风险得够低</strong>：核心的诊疗业务，哪个环节都不能出岔子。停机一分钟，外面可能就吵翻天了。所以数据库国产化替代，千万不能“勇”，得讲究“稳”，要好弄、风险小，还得有后悔药（能随时退回去）。</li>
<li><strong>高并发，必须扛得住</strong>：一到周一上午那种就诊高峰，挂号、开药、检验、付费全是人。系统响应稍微慢一点，窗口就得排长队。所以，数据库必须得快、得稳，时延一定得压下去。</li>
<li><strong>安全合规，一条都不能少</strong>：现在国家对数据安全的要求越来越严，等级保护、操作审计、数据加密、权限划分、操作留痕这些，都得有一套完整的方案，而且得是能实实在在落地、经得起检查的。</li>
<li><strong>新老系统，得能聊到一块儿</strong>：医院里老的系统五花八门，Oracle、SQL Server、MySQL、PostgreSQL啥都有。新上的数据库，不能自己玩自己的，得能跟这些老伙计们顺畅地兼容、通上话。</li>
<li><strong>运维要省心，还得可控</strong>：医院业务是7x24小时不能停的。高可用、自动监控、出了问题能自动切、平时能演练，这些都得是实打实能做、能看到效果的，不能光说不练。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fed5261a9dea48359f927140df56ff9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=dPk2iSJKtQL9pgMVHOwi5Fy5W44%3D" alt="a934216b173d5ea60ea5db6d2bcf30ca.png" loading="lazy"/></li>
</ul>
<h2 data-id="heading-2">迁移的“组合拳”：“三低一平”加“双轨并行”</h2>
<ul>
<li><strong>活儿要简单（低难度）</strong>：尽量用兼容模式和现成的工具，让业务系统的代码改动越少越好，这样开发那边的兄弟们才不会骂娘。</li>
<li><strong>花钱要少（低成本）</strong>：从评估、迁移到最后校验，最好都有一套自动化的工具链，这样能省下不少人力，成本自然就下来了。</li>
<li><strong>风险要小（低风险）</strong>：这就是“双轨并行”的核心了。老的数据库先别动，继续跑主要业务。在旁边搭一套新的金仓环境，像个镜子一样实时同步数据。正着同步、反着同步的工具都备好，万一新系统有啥问题，随时能切回老的，业务不受影响。</li>
<li><strong>切换要顺（平滑迁移）</strong>：真到了要正式切换的那天，停机窗口得按小时甚至分钟算。整个过程都得在掌控之中，万一有意外，得能一键退回去。</li>
</ul>
<h2 data-id="heading-3">一般来说，迁移的节奏是这么个“三步走”：</h2>
<p>第一步为适配阶段，此时期老系统居于核心地位，金仓则作为辅助存在，利用即时同步工具将老系统中的数据复制到金仓端，使得两者的数据内容相一致，之后可以将部分查询请求转向金仓处理，也可以借助其执行压力检测，考察其适配情况及性能表现是否良好。</p>
<p>第二步是试运行阶段，在此将金仓设为关键角色，老系统沦为备选方案，而且，要反向调整数据同步方向，即由金仓向老系统执行同步操作，如此一来，若金仓端出现意外状况时，便能够及时切换至老系统以维持业务正常运作。</p>
<p>第三步是正式上线，试运行没有问题的话就可以正式“转正”，也就是下线老系统，并完善好相关的监测，审查以及应急演习等工作，之后就进入到长期稳定的运行及改进阶段。</p>
<h2 data-id="heading-4">架构设计上，有几个关键点得抓住</h2>
<ul>
<li><strong>高可用和多活</strong>：具体是用同城双活，还是搞两地三中心，得看医院的等级和对业务连续性的要求（就是RTO/RPO指标）。方案做得好，RPO（数据零丢失）能接近0，RTO（业务恢复时间）能做到分钟级。当然，这牛不是吹的，得靠实打实的演练和压测数据说话。</li>
<li><strong>读写分离</strong>：这是个好习惯。把挂号、开药这些需要写数据的操作都放主库；像生成报表、数据分析这种只读的操作，就扔到备库或者只读节点上。这样主库的压力就小多了，跑得更欢。</li>
<li><strong>数据“冷热”分开管（分区与分层）</strong>：像门诊、检验、影像这些数据，增长得飞快。可以按时间（比如按季度、按年）或者按业务类型把它们隔开（分区）。时间久了不常用的“冷数据”，就放到便宜点的存储上，这样访问“热数据”的效率就高多了。</li>
<li><strong>数据能对得上，还能倒查（标识与溯源）</strong>：得有一套统一的“身份证”，比如患者ID、就诊ID、医嘱ID，把所有数据都串起来。再配上覆盖整个流程的审计，谁在什么时间动了什么数据，都得有记录，查起来才方便。</li>
<li><strong>运维尽量自动化</strong>：从安装、监控、备份，到诊断问题、搞应急演练，最好都用一个平台搞定。把日常的巡检和演练变成固定动作，这样才能心里有底。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57d47cbd617c4f2c9c0abdf30d37f3cf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=Vu7oiy6ejh5nXaYqqY7Axj95ZSE%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h2 data-id="heading-5">迁移和验证，手上有哪些“兵器”？</h2>
<ul>
<li><strong>“模拟考”工具（评估与回放）</strong>：有个叫“负载回放”的平台，能把老数据库上跑的真实业务流量录下来，然后在金仓上重新放一遍。这样，有啥不兼容的地方或者性能瓶颈，没上线就提前暴露了，可以从容地解决。</li>
<li><strong>“搬家”工具（迁移）</strong>：从数据库表结构到里面的数据，都能自动化地迁移，还支持全量和增量的方式。比人手一点点导数据，风险小得多，也省事儿。</li>
<li><strong>“镜子”工具（实时同步）</strong>：这个工具能在不同的数据库之间（比如Oracle和金仓）实时同步数据。它很聪明，能自动适应主备库的切换，万一网络断了还能断点续传，并且会自己检查两边数据是不是一致。</li>
<li><strong>“微创手术刀”（柔性迁移）</strong>：它的特点是从老系统抽数据的时候，尽量不影响老系统的正常运行。这样就能把正式切换时的停机时间压到最短，整个过程也更好控制。</li>
<li><strong>“对账单”工具（一致性校验）</strong>：不管是老数据还是新增加的数据，它都能帮你比对两边是不是完全一样，最后还能出个报告，让你清清楚楚、明明白白。</li>
</ul>
<h2 data-id="heading-6">再深入聊聊：迁移、验证和同步的细节</h2>
<p>KFS同步工具的“杀手锏”在于此，这个被称作KFS的同步软件到底有何特别之处？其可自动判别源数据库为单机亦或是集群，并且具备自主应对主备切换的能力，无需人工干预，面对网络抖动情形时，具备断点续传功能，而且能够随时核查数据准确性，不论是执行一对多，多对一或者更为繁杂的同步任务，它均能从容应对，在我们推行“双轨并行”策略期间，该软件充当着正向与反向同步的主要力量，是所谓“后悔药”的核心所在。</p>
<ul>
<li>只同步“有用”的数据就会变快，它很聪明，在分析数据库日志时，会先筛除无关数据，这可节省许多系统资源，它经由直接读取物理日志来捕捉数据变化，因此速度极快，通常同步延迟可维持在秒级。</li>
</ul>
<p>KRplay回归验证的“实战演习”这种说法，其中的KRplay这个工具就是前面提到的“模拟考”神器，它会把老数据库里真实业务请求录制下来，并在金仓上直接运行一遍，从而帮你预先找到那些潜藏的适配性问题以及性能不足之处，再加上数据一致性对比和SQL压力加载之后，所得到的测试结果就十分接近实际上线时的情形。</p>
<p>KDTS迁移比对的“一条龙”服务，这个叫KDTS的工具有助于“搬家”与“对账”，其会遵照你原先数据库的类型，自动将表结构及数据迁移过来，迁移完毕之后，还能帮你执行全面或者增加的数据比对，并出具详尽的报告，这样便无需凭借人力逐行对比，既节省时间又省却力气而且准确。</p>
<p>柔性迁移可概括为“准在线，全数据，低侵扰”，其含义在于尽可能不干扰当前业务，将全部数据稳定转移，并达到那些仅给你一至二小时停机时间的严格标准。</p>
<h2 data-id="heading-7">安全合规：红线碰不得</h2>
<ul>
<li><strong>资质得硬</strong>：产品本身通过了EAL4+这种高级别的信息安全认证，对于医院要过的等保三级，核心能力是能满足的。</li>
<li><strong>数据得保密，权限得分开</strong>：从数据传输到存储，都能加密。支持DBA、安全员、审计员“三权分立”的管理模式。权限控制能做到很细的粒度，还能对敏感数据（比如身份证号）做动态脱敏，给不同的人看不同的结果。</li>
<li><strong>操作得有记录</strong>：谁登录了、干了啥、改了什么数据，都得记下来，做到“雁过留声”。这样才能满足医疗数据安全和事后审计的要求。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc161a741ac9401e8d18cf17efc8837b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764081742&amp;x-signature=WunIXybHVGyzqaCuzYmSeSVd0fc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">上手试试：来个挂号抢号的例子</h2>
<p>光说不练假把式。下面这段SQL代码，模拟了医院里最常见的“患者-医生-预约”场景，语法在金仓数据库上跑没问题，可以直接用，或者照着改改。重点是看看怎么建表，以及怎么处理好几个人同时抢一个号的并发问题。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_patient (
  patient_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  id_card <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">UNIQUE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  gender <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">16</span>),
  birth_date <span class="hljs-type">DATE</span>,
  phone <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>),
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_doctor (
  doctor_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  dept_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>),
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_doctor_schedule (
  schedule_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  doctor_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor(doctor_id),
  start_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  end_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  capacity <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  booked <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>,
  <span class="hljs-keyword">UNIQUE</span> (doctor_id, start_time, end_time)
);

<span class="hljs-keyword">CREATE</span> INDEX idx_schedule_doctor_time <span class="hljs-keyword">ON</span> kb_doctor_schedule (doctor_id, start_time);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_appointment (
  appt_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  patient_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_patient(patient_id),
  doctor_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor(doctor_id),
  schedule_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor_schedule(schedule_id),
  appt_time <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  status <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'scheduled'</span>,
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">BEGIN</span>;
<span class="hljs-keyword">SELECT</span> capacity, booked
<span class="hljs-keyword">FROM</span> kb_doctor_schedule
<span class="hljs-keyword">WHERE</span> schedule_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;

<span class="hljs-keyword">UPDATE</span> kb_doctor_schedule
<span class="hljs-keyword">SET</span> booked <span class="hljs-operator">=</span> booked <span class="hljs-operator">+</span> <span class="hljs-number">1</span>
<span class="hljs-keyword">WHERE</span> schedule_id <span class="hljs-operator">=</span> <span class="hljs-number">123</span>
<span class="hljs-keyword">AND</span> booked <span class="hljs-operator">&lt;</span> capacity;

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_appointment (patient_id, doctor_id, schedule_id, appt_time)
<span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, <span class="hljs-number">77</span>, <span class="hljs-number">123</span>, <span class="hljs-string">'2025-11-20 09:00:00'</span>);

<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<p>这里头的门道是：</p>
<ul>
<li>在处理预约时，先用 <code>SELECT ... FOR UPDATE</code> 把这个号源记为“锁定”状态。这样，就算一百个人同时来抢这个号，也得一个个排队来，不会出现一个号卖给两个人的“超卖”情况。</li>
<li>在更新“已预约人数”之前，先检查一下是不是已经满了。然后，在同一个事务里，完成人数+1和插入预约记录这两个动作。这样能保证数据的一致性，不会出错。</li>
<li>一定要记住，整个过程要快！事务要短，干完活儿（<code>INSERT</code>、<code>UPDATE</code>）立刻提交（<code>COMMIT</code>）。最怕的就是一个连接长时间占着茅坑不拉屎（处于 <code>idle in transaction</code> 状态），这样很容易把整个数据库连接池给拖垮。</li>
</ul>
<h2 data-id="heading-9">再来个例子：病历分区和操作审计</h2>
<p>数据量大了，查询就会变慢。一个常见的优化办法就是“分区”，比如，可以把门诊病历按季度或者按年份存到不同的“抽屉”里。同时，为了安全，我们还得给核心操作加上审计，谁动了数据都得记下来。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_medical_record (
  record_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  patient_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_patient(patient_id),
  visit_date <span class="hljs-type">DATE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  dept_code <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  doctor_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">REFERENCES</span> kb_doctor(doctor_id),
  diagnosis TEXT,
  created_at <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span> (visit_date);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_medical_record_2025q4
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> kb_medical_record
  <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2025-10-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2025-12-31'</span>);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_audit_log (
  audit_id BIGSERIAL <span class="hljs-keyword">PRIMARY</span> KEY,
  table_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  op <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">16</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  row_id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  ts <span class="hljs-type">TIMESTAMP</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
);

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">FUNCTION</span> kb_appointment_audit()
<span class="hljs-keyword">RETURNS</span> <span class="hljs-keyword">TRIGGER</span> <span class="hljs-keyword">AS</span> $$
<span class="hljs-keyword">BEGIN</span>
  IF TG_OP <span class="hljs-operator">=</span> <span class="hljs-string">'INSERT'</span> <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_audit_log(table_name, op, row_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'kb_appointment'</span>, <span class="hljs-string">'INSERT'</span>, NEW.appt_id);
  ELSIF TG_OP <span class="hljs-operator">=</span> <span class="hljs-string">'UPDATE'</span> <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_audit_log(table_name, op, row_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'kb_appointment'</span>, <span class="hljs-string">'UPDATE'</span>, NEW.appt_id);
  ELSIF TG_OP <span class="hljs-operator">=</span> <span class="hljs-string">'DELETE'</span> <span class="hljs-keyword">THEN</span>
    <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> kb_audit_log(table_name, op, row_id) <span class="hljs-keyword">VALUES</span>(<span class="hljs-string">'kb_appointment'</span>, <span class="hljs-string">'DELETE'</span>, OLD.appt_id);
  <span class="hljs-keyword">END</span> IF;
  <span class="hljs-keyword">RETURN</span> <span class="hljs-keyword">NULL</span>;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TRIGGER</span> trg_kb_appointment_audit
AFTER <span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-keyword">OR</span> <span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">ON</span> kb_appointment
<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">EACH</span> <span class="hljs-type">ROW</span> <span class="hljs-keyword">EXECUTE</span> <span class="hljs-keyword">PROCEDURE</span> kb_appointment_audit();
</code></pre>
<h2 data-id="heading-10">关于连接池和事务，多啰嗦几句</h2>
<p>连接池需开启，并要调整好相关参数，数据库连接池化很有必要，最大连接数，空闲连接回收时限等参数得依照实际状况来调整，不能让系统在业务高峰期慌乱地生成新的物理连接，这样做速度太慢。</p>
<p>事务需干脆利落，在业务代码当中，每个逻辑单元结束时，要么执行提交（Commit），要么执行回滚（Rollback），不能含糊其辞。格外要防止出现历时过长的“长事务”，也要避开那些占着锁却不做任何事情的“懒汉”行为。</p>
<p>读操作要找“偏殿”，比如跑报表，做数据分析之类的只读任务，就安排到只读节点或者备库执行，不要影响主库处理关键的读写事务。</p>
<p>多留意“仪表盘”，要经常留意一些关键指标，比如连接池已使用的数量，是否存在锁等待情况，慢 SQL 语句有多频繁，哪个分区最为繁忙，以及是否启用了索引等，这些均可作为评判数据库健康状况的“体检报告”。</p>
<p>框架中的“坑”需谨慎对待，这里特意提及一个实际操作时会碰上的问题，假定你采用像 SqlSugar 这样的 ORM 框架，并且搭配金仓的 Kdbndp 驱动，就要格外留意事务的闭合情况。代码若调用了 <code>BeginTran()</code> 来开启事务，之后却忘记了执行 <code>CommitTran()</code> 或实施回滚，那么这个数据库连接就会一直陷于 <code>idle in transaction</code> 的状态，要么就是无法被释放，连接池很快就会被这些“僵尸”连接填满，从而致使整个应用程序因得不到新的连接而陷入瘫痪，所以，切记要有头有尾！</p>
<p>一个连接字符串的例子（参数根据你的环境改）：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">Host</span>=<span class="hljs-number">10.10</span>.<span class="hljs-number">10.10</span><span class="hljs-comment">;Port=54321;Database=hospital;</span>
User <span class="hljs-attr">ID</span>=app_user<span class="hljs-comment">;Password=******;</span>
<span class="hljs-attr">Pooling</span>=<span class="hljs-literal">true</span><span class="hljs-comment">;Maximum Pool Size=100;</span>
Connection Idle <span class="hljs-attr">Lifetime</span>=<span class="hljs-number">300</span><span class="hljs-comment">;Connection Pruning Interval=10</span>
</code></pre>
<h2 data-id="heading-11">性能调优：是个持续的活儿</h2>
<ul>
<li><strong>存数据要有规划</strong>：前面提过的，按时间或业务给数据分区、分冷热层，能大大减少查询时扫描的数据量，IO自然就下来了。再配合定期的归档和分区滚动策略，让主库保持“苗条”身材。</li>
<li><strong>索引要建得巧，统计信息要新</strong>：对于那些天天被查的SQL，要量身定做复合索引或者覆盖索引。另外，要记得定期执行 <code>ANALYZE</code>，更新数据库的统计信息，不然数据库“脑子”里的成本估算可能是错的，好好的索引它不用，非要去全表扫，慢SQL就是这么来的。</li>
<li><strong>人多力量大，任务要分担</strong>：有些复杂的查询或者大批量的处理，可以试试开启并行模式，让数据库调动多个CPU核心一起干。读的压力大了，就用只读节点或备库来分担，前面再架个负载均衡就更完美了。</li>
<li><strong>平时多“体检”，出事不慌张</strong>：先通过压力测试摸清系统的性能底线。然后把监控系统建起来，天天盯着响应时间、吞吐量、锁等待、缓存命中率这些关键指标。一旦发现数据有异常波动，就能快速定位问题，对症下药。</li>
</ul>
<p>再举两个索引优化的例子：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_appt_doctor_time_status <span class="hljs-keyword">ON</span> kb_appointment (doctor_id, appt_time, status);

<span class="hljs-keyword">CREATE</span> INDEX idx_patient_name_lower <span class="hljs-keyword">ON</span> kb_patient (<span class="hljs-built_in">lower</span>(name));
<span class="hljs-keyword">SELECT</span> patient_id, name
<span class="hljs-keyword">FROM</span> kb_patient
<span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">lower</span>(name) <span class="hljs-keyword">LIKE</span> <span class="hljs-built_in">lower</span>(<span class="hljs-string">'%张三%'</span>);
</code></pre>
<p>分区滚动是这么个意思：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> kb_medical_record_2026q1
  <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">OF</span> kb_medical_record
  <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">VALUES</span> <span class="hljs-keyword">FROM</span> (<span class="hljs-string">'2026-01-01'</span>) <span class="hljs-keyword">TO</span> (<span class="hljs-string">'2026-03-31'</span>);
</code></pre>
<h2 data-id="heading-12">上线之后：怎么让系统一直稳如老狗？</h2>
<p>演练！再演练！多次开展演练，高可用切换，数据回退，容灾演练这些关键措施，不能仅仅停留在口头上，而是应该定时将其拿出来实际操作一番，从而形成一种类似于肌肉记忆的效果，如此一来，一旦发生意外状况时就不会手足无措。</p>
<p>索引与统计信息需不断更新，业务情况及查询模式均会发生改变，所以要定时查看统计信息是否过时，并遵照新的查询特征来改良索引，去除多余部分并增添必要的内容。</p>
<p>要掌握好数据的“生老病死”，即分区和归档策略一旦制定，就要按时执行，不能让主库的数据无限制增长，否则早晚会出现IO压力过大这种情况。</p>
<p>要定时回溯审查，查看审计，权限以及脱敏策略是否仍有效执行，从而保证可以随时应对诸如等保之类的检测。</p>
<p>对于性能趋势要心中有数，留意事务延误和并发量的变向趋势，一旦察觉其不断上升，便要考虑是否需增加机器执行扩容，或者要在架构层面做一些小调整。</p>
<h2 data-id="heading-13">听听别人家的故事：几个案例的要点</h2>
<ul>
<li><strong>替换掉不听话的OGG</strong>：有家三甲医院，原来用OGG给SQL Server做异构同步。结果主备一切换，OGG就“懵了”，没法自动跟上，导致业务断了好长时间。后来换成金仓的KFS，主备切换后能自动识别，断了网也能续传，稳稳地搞定了两边SQL Server的实时同步。</li>
<li><strong>支撑互联网诊疗平台</strong>：在广州医科大学附属肿瘤医院，他们的互联网智慧医疗平台就跑在金仓上。用的是高可用双节点架构，服务等级协议（SLA）要求超过99.7%。对性能的要求也很具体：普通操作响应要小于2秒，精确查询小于2秒，模糊查询小于4秒。这套系统要能撑住2000个用户同时在线，每年还要处理超过500万条数据。</li>
<li><strong>灾备的目标值</strong>：在医疗行业，大家普遍追求的目标是RPO（数据丢失量）等于0，RTO（业务恢复时间）小于10分钟。通过部署多活架构和环形同步，只要方案设计得好，演练得充分，实现分钟级的RTO是完全可能的，能最大程度保证核心业务不中断。</li>
</ul>
<h2 data-id="heading-14">最后总结几句</h2>
<p>医院数据库实行国产化，并非仅点击“替换”按钮这么简单，这属于系统工程范畴，依照电科金仓以往的操作经验，其成败与否主要取决于几个要点，“替换进程需处于控制之下”，“高可用要可靠”，“迁移及数据一致性可予以验证”，“运维应当做到自动化”。</p>
<p>打法上采用“双轨并行”这种形式作为支撑，配合“柔性迁移”工具来缩减停机时间，并且利用“一致性校验”和“负载回放”多次核对，如此一来才能以风险尽可能小的方式，平稳地切换核心业务。</p>
<p>换过来仅仅是一步，后续需不断加以改善，要合理执行分区，妥善完成读写分离，持之以恒地开展演习，并切实做好审查工作，如此才能渐渐使系统变得更为流畅，进而提升患者的就医感受以及自身的运维水准。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[十亿 JSON 秒级响应：Apache Doris vs ClickHouse，Elasticsearch，PostgreSQL]]></title>    <link>https://juejin.cn/post/7573886599433601075</link>    <guid>https://juejin.cn/post/7573886599433601075</guid>    <pubDate>2025-11-18T13:09:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433601075" data-draft-id="7573899782802866222" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="十亿 JSON 秒级响应：Apache Doris vs ClickHouse，Elasticsearch，PostgreSQL"/> <meta itemprop="keywords" content="算法"/> <meta itemprop="datePublished" content="2025-11-18T13:09:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            十亿 JSON 秒级响应：Apache Doris vs ClickHouse，Elasticsearch，PostgreSQL
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:09:20.000Z" title="Tue Nov 18 2025 13:09:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>坦白讲，每次看性能测试排行榜，我都会下意识地先找找 Apache Doris 在哪个位置。</p>
<p>这次打开 JSONBench 的榜单，心情一如既往的期待加紧张。</p>
<p>好在结果让我松了一口气：默认配置下就能排到第三，仅次于维护方 ClickHouse 的两个版本。</p>
<p>不过，Doris 只能止步于此了吗？经过一系列优化后，查询时长能不能再缩短点？和 ClickHouse 的差距在哪里？</p>
<p>调优前后对比图镇楼，至于调优的具体思路，请一起往下看吧。</p>
<ul>
<li>
<p>Apache Doris 排名 (Default)</p>
<p><img src="https://cdn.selectdb.com/static/banner_3934965562.png" alt="Apache Doris 排名 (Default)" loading="lazy"/></p>
</li>
<li>
<p>Apache Doris 排名 (Unofficial Tuned)</p>
<p><img src="https://cdn.selectdb.com/static/JSON_Apache_Doris_vs_Click_House_Elasticsearch_Postgre_SQL_8e28e8e820.png" alt="Apache Doris 排名 (Unofficial Tuned)" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-0">JSONBench 简介</h2>
<p>JSONBench 是一个为 JSON 数据而生的数据分析 Benchmark，简单来说，它由 10 亿条来自真实生产环境的 JSON  数据、5 个针对 JSON  构造的特定 SQL 查询组成，旨在对比各个数据库系统对半结构化数据的处理能力。目前榜单包括 ClickHouse、MongoDB、Elasticsearch、DuckDB、PostgreSQL 等知名数据库系统，截至目前，<strong>Doris 的性能表现是 Elasticsearch 的 2 倍，是 PostgreSQL 的 80 倍</strong>。</p>
<blockquote>
<p><em>JSONBench 官网地址：jsonbench.com</em></p>
</blockquote>
<p><img src="https://cdn.selectdb.com/static/JSON_Bench_55427187e6.png" alt="JSONBench 简介.png" loading="lazy"/></p>
<p>不仅在性能上 Apache Doris 领先其他同类产品，<strong>在数据集相同的情况下，Apache Doris 的存储占用是 Elasticsearch 的 1/2、PostgreSQL 的 1/3</strong>。</p>
<p><img src="https://cdn.selectdb.com/static/JSON_Bench_2_cd1de97882.png" alt="JSONBench 简介-2.png" loading="lazy"/></p>
<p>JSONBench 测试具体流程：首先在数据库中创建一张名为 Bluesky 的表，并导入十亿条真实的用户行为日志数据。测试过程中，每个查询重复执行三次，并且在每次查询前清空操作系统的 Page Cache，以模拟冷热查询的不同场景。最终，通过综合计算各查询的执行耗时得出数据库的性能排名。</p>
<p>在这个测试中，Apache Doris 使用了 Variant 数据类型来存储 JSON 数据，默认的建表 Schema 如下：</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> bluesky (
    `id` <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,
    `data` variant <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(id) BUCKETS <span class="hljs-number">32</span>
PROPERTIES ("replication_num"<span class="hljs-operator">=</span>"1");
</code></pre>
<p>Variant 是 Apache Doris 2.1 中引入一种新的数据类型 ，它可以存储半结构化 JSON 数据，并且允许存储包含不同数据类型（如整数、字符串、布尔值等）的复杂数据结构，而无需在表结构中提前定义具体的列。Variant 类型特别适用于处理复杂的嵌套结构，而这些结构可能随时会发生变化。在写入过程中，该类型可以自动根据列的结构、类型推断列信息，动态合并写入的 schema，并通过将 JSON 键及其对应的值存储为列和动态子列。</p>
<blockquote>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.0%2Fsql-manual%2Fbasic-element%2Fsql-data-types%2Fsemi-structured%2FVARIANT" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.0/sql-manual/basic-element/sql-data-types/semi-structured/VARIANT" ref="nofollow noopener noreferrer">Apache Doris Variant 类型详情</a></li>
</ul>
</blockquote>
<h2 data-id="heading-1">调优思路与原理</h2>
<p>JSONBench 榜单排名依据各个数据库系统在默认配置下的性能数据，那么能否通过调优，让 Apache Doris 进一步释放性能潜力，实现更好的性能效果呢？</p>
<h3 data-id="heading-2">01 环境说明</h3>
<ul>
<li>测试机器：AWS M6i.8xlarge(32C128G);</li>
<li>操作系统：Ubuntu24.04;</li>
<li>Apache Doris: 3.0.5;</li>
</ul>
<h3 data-id="heading-3">02 Schema 结构化处理</h3>
<p>由于 JSONBench 特定查询中涉及到的 JSON 数据都是固定的提取路径，换言之，半结构化数据的 Schema 是固定的，因此，我们可以借助生成列，将常用的字段提取出来，实现半结构化数据和结构化数据结合的效果。类似的高频访问的 JSON 路径或者需要计算的表达式，都可以使用该优化思路，添加对应的生成列来实现查询加速。</p>
<blockquote>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FClickHouse%2FJSONBench%2Fblob%2Fmain%2Fdoris%2Fqueries_default.sql" target="_blank" title="https://github.com/ClickHouse/JSONBench/blob/main/doris/queries_default.sql" ref="nofollow noopener noreferrer">查看 JSONBench 查询</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdoris.apache.org%2Fzh-CN%2Fdocs%2F3.0%2Fsql-manual%2Fsql-statements%2Ftable-and-view%2Ftable%2FCREATE-TABLE" target="_blank" title="https://doris.apache.org/zh-CN/docs/3.0/sql-manual/sql-statements/table-and-view/table/CREATE-TABLE" ref="nofollow noopener noreferrer">Apache Doris 生成列详情</a></li>
</ul>
</blockquote>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> bluesky (
    kind <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data, <span class="hljs-string">'$.kind'</span>)) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    operation <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data, <span class="hljs-string">'$.commit.operation'</span>)) <span class="hljs-keyword">NULL</span>,
    collection <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data, <span class="hljs-string">'$.commit.collection'</span>)) <span class="hljs-keyword">NULL</span>,
    did <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) GENERATED ALWAYS <span class="hljs-keyword">AS</span> (get_json_string(data,<span class="hljs-string">'$.did'</span>)) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    <span class="hljs-type">time</span> DATETIME GENERATED ALWAYS <span class="hljs-keyword">AS</span> (from_microsecond(get_json_bigint(data, <span class="hljs-string">'$.time_us'</span>))) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    `data` variant <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
)
DUPLICATE KEY (kind, operation, collection)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(collection, did) BUCKETS <span class="hljs-number">32</span>
PROPERTIES ("replication_num"<span class="hljs-operator">=</span>"1");
</code></pre>
<p>除了可以减少查询时提取数据的开销，还可以用展平出来的列作为分区列，使得数据分布更均衡。</p>
<p>需要注意的是，查询的 SQL 语句也要改为使用展平列的版本：</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> JSONBench 原始查询：
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count, <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'did'</span>] <span class="hljs-keyword">AS</span> TEXT )) <span class="hljs-keyword">AS</span> users <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> event, <span class="hljs-keyword">HOUR</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>))) <span class="hljs-keyword">AS</span> hour_of_day, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">IN</span> (<span class="hljs-string">'app.bsky.feed.post'</span>, <span class="hljs-string">'app.bsky.feed.repost'</span>, <span class="hljs-string">'app.bsky.feed.like'</span>) <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event, hour_of_day <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hour_of_day, event;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'did'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> user_id, <span class="hljs-built_in">MIN</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>))) <span class="hljs-keyword">AS</span> first_post_ts <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_post_ts <span class="hljs-keyword">ASC</span> LIMIT <span class="hljs-number">3</span>;
<span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'did'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-keyword">AS</span> user_id, MILLISECONDS_DIFF(<span class="hljs-built_in">MAX</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>))),<span class="hljs-built_in">MIN</span>(from_microsecond(<span class="hljs-built_in">CAST</span>(data[<span class="hljs-string">'time_us'</span>] <span class="hljs-keyword">AS</span> <span class="hljs-type">BIGINT</span>)))) <span class="hljs-keyword">AS</span> activity_span <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'kind'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'operation'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> <span class="hljs-built_in">cast</span>(data[<span class="hljs-string">'commit'</span>][<span class="hljs-string">'collection'</span>] <span class="hljs-keyword">AS</span> TEXT ) <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> activity_span <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">3</span>;

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> 使用展平列改写的查询：
<span class="hljs-keyword">SELECT</span> collection <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> collection <span class="hljs-keyword">AS</span> event, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count, <span class="hljs-built_in">COUNT</span>(<span class="hljs-keyword">DISTINCT</span> did) <span class="hljs-keyword">AS</span> users <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> count <span class="hljs-keyword">DESC</span>;
<span class="hljs-keyword">SELECT</span> collection <span class="hljs-keyword">AS</span> event, <span class="hljs-keyword">HOUR</span>(<span class="hljs-type">time</span>) <span class="hljs-keyword">AS</span> hour_of_day, <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">AS</span> count <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> collection <span class="hljs-keyword">IN</span> (<span class="hljs-string">'app.bsky.feed.post'</span>, <span class="hljs-string">'app.bsky.feed.repost'</span>, <span class="hljs-string">'app.bsky.feed.like'</span>) <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> event, hour_of_day <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> hour_of_day, event;
<span class="hljs-keyword">SELECT</span> did <span class="hljs-keyword">AS</span> user_id, <span class="hljs-built_in">MIN</span>(<span class="hljs-type">time</span>) <span class="hljs-keyword">AS</span> first_post_ts <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> collection <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> first_post_ts <span class="hljs-keyword">ASC</span> LIMIT <span class="hljs-number">3</span>;
<span class="hljs-keyword">SELECT</span> did <span class="hljs-keyword">AS</span> user_id, MILLISECONDS_DIFF(<span class="hljs-built_in">MAX</span>(<span class="hljs-type">time</span>),<span class="hljs-built_in">MIN</span>(<span class="hljs-type">time</span>)) <span class="hljs-keyword">AS</span> activity_span <span class="hljs-keyword">FROM</span> bluesky <span class="hljs-keyword">WHERE</span> kind <span class="hljs-operator">=</span> <span class="hljs-string">'commit'</span> <span class="hljs-keyword">AND</span> operation <span class="hljs-operator">=</span> <span class="hljs-string">'create'</span> <span class="hljs-keyword">AND</span> collection <span class="hljs-operator">=</span> <span class="hljs-string">'app.bsky.feed.post'</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> activity_span <span class="hljs-keyword">DESC</span> LIMIT <span class="hljs-number">3</span>;
</code></pre>
<h3 data-id="heading-4">03 Page Cache 调整</h3>
<p>调整查询语句后，开启 profile，执行完整的查询测试：</p>
<pre><code class="hljs language-Plain" lang="Plain">set enable_profile=true;
</code></pre>
<p>进入 FE 8030 端口的 Web 页面，找到相关 profile 进行分析，此时发现 SCAN Operator 中的 Page Cache 命中率较低，导致热读测试过程中存在一部分冷读操作。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">-</span>  CachedPagesNum:  <span class="hljs-number">1.258</span>K  (<span class="hljs-number">1258</span>)
<span class="hljs-operator">-</span>  TotalPagesNum:  <span class="hljs-number">7.422</span>K  (<span class="hljs-number">7422</span>)
</code></pre>
<p>这种情况通常是由于 Page Cache 容量不足，无法完整缓存 Bluesky 表中的数据。建议在 <code>be.conf</code> 中添加配置项 <code>storage_page_cache_limit=60%</code>，将 Page Cache 的大小从默认的内存总量的 20% 提升至 60%。重新运行测试后，可以观察到冷读问题已得到解决。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">-</span>  CachedPagesNum:  <span class="hljs-number">7.316</span>K  (<span class="hljs-number">7316</span>)
<span class="hljs-operator">-</span>  TotalPagesNum:  <span class="hljs-number">7.316</span>K  (<span class="hljs-number">7316</span>)
</code></pre>
<h3 data-id="heading-5">04 最大化并行度</h3>
<p>为了进一步挖掘 Doris 的性能潜力，可以将 Session 变量中的<code>parallel_pipeline_task_num</code>设为 32，因为本次 Benchmark 测试机器<code>m6i.8xlarge</code>为 32 核，所以我们将并行度设置为 32 以最大程度发挥 CPU 的计算能力。</p>
<pre><code class="hljs language-SQL" lang="SQL"><span class="hljs-operator">/</span><span class="hljs-operator">/</span> 单个 Fragment 的并行度
<span class="hljs-keyword">set</span> <span class="hljs-keyword">global</span> parallel_pipeline_task_num<span class="hljs-operator">=</span><span class="hljs-number">32</span>;
</code></pre>
<h2 data-id="heading-6">调优结果</h2>
<p>经过上述对 Schema、Query、内存限制、CPU 等参数的调整，我们对比了调优前后 Doris 的性能表现以及一些其他数据库系统的成绩，有如下结果：</p>
<p><img src="https://cdn.selectdb.com/static/_02b0f7abc5.png" alt="调优结果.png" loading="lazy"/></p>
<p>可以看到，<strong>对比调优前的 Doris，调优后 Doris 查询整体耗时降低了 74%，对比原榜单第一的 ClickHouse 产品实现了 39% 的领先优势</strong>。</p>
<h2 data-id="heading-7">总结与展望</h2>
<p>通过对 Schema 的结构化处理、查询语句的优化、缓存配置的调整以及并行参数的设置，Apache Doris 整体查询耗时显著下降，并超越 ClickHouse。</p>
<p>在默认设置下，Doris 在 10 亿条 JSON 的查询耗时与 ClickHouse 仍有数秒的差异。然而，依托于 Doris 在 JSON 处理、Variant 类型支持及生成列等能力的加持，经调优后，其半结构化数据处理性能获得了进一步显著提升，并在同类数据库中表现出明显的领先优势。</p>
<p>未来，Apache Doris 将继续打磨在半结构化领域的数据处理能力，为用户带来更加优质、高效的分析体验，包括：</p>
<ul>
<li>优化 Variant 类型稀疏列的存储空间，支持万列以上的子列；</li>
<li>优化万列大宽表的内存占用；</li>
<li>支持 Variant 子列根据列名的 Pattern 自定义类型、索引等。</li>
</ul>
<h2 data-id="heading-8">推荐阅读</h2>
<ul>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F949" target="_blank" title="https://www.selectdb.com/blog/949" ref="nofollow noopener noreferrer">Apache Doris 针对半结构化数据分析的解决方案及典型场景</a></p>
</li>
<li>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.selectdb.com%2Fblog%2F185" target="_blank" title="https://www.selectdb.com/blog/185" ref="nofollow noopener noreferrer">揭秘 Variant 数据类型：灵活应对半结构化数据，JSON 查询提速超 8 倍，存储空间节省 65%</a></p>
</li>
</ul>
<p>欢迎扫码并备注 “半结构化” 加入 Apache Doris 社区专项交流群，免费领取 100+ 企业实践案例集和 Doris x AI 更多资料、获取技术帮助、了解最新动态，并与更多开发者和用户互动。</p>
<p><img src="https://cdn.selectdb.com/static/qrcode_4de53ab5c5.png" alt="qrcode" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Doris MCP Server v0.6.0 正式发布]]></title>    <link>https://juejin.cn/post/7573899782802964526</link>    <guid>https://juejin.cn/post/7573899782802964526</guid>    <pubDate>2025-11-18T13:11:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782802964526" data-draft-id="7573899782802948142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Doris MCP Server v0.6.0 正式发布"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-18T13:11:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Doris MCP Server v0.6.0 正式发布
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:11:51.000Z" title="Tue Nov 18 2025 13:11:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Doris MCP Server v0.6.0 正式发布！</p>
<p>本次 v0.6.0 版本是里程碑式升级，从数据库连接工具全面跃升为企业级认证和数据库管理系统，核心亮点包括：</p>
<ul>
<li><strong>企业级多重认证体系</strong>：Token、JWT、OAuth 完整支持，创新性的 Token 绑定数据库配置，Doris-MCP-Server 与 Doris 权限全面打通，每个 Token 携带独立数据库连接参数，真正实现多租户数据完全隔离，由系统管理员统一赋权，避免敏感信息传递泄露。</li>
<li><strong>零停机运维能力</strong>：革命性热重载配置，10 秒内自动生效无需重启；即时数据库验证，100% 消除后期连接失败；多 Worker 水平扩展，按需拓展并发处理能力。</li>
<li><strong>Web 端可视化管理界面</strong>：全新安全的 localhost 专用 Token 管理面板，支持实时统计、一键创建、批量管理、自动持久化，复杂操作变得简单直观。</li>
<li><strong>连接池性能飞跃</strong>：智能会话缓存减少 60% 连接开销，100% 消除连接超时问题，自动连接释放与重连管理。</li>
<li><strong>企业级安全增强</strong>：多层 IP 限制、管理员认证、SQL 注入防护升级、完整审计追踪，生产环境安全无忧。</li>
<li><strong>架构全面优化</strong>：统一配置框架、Docker 跨平台兼容、异步操作标准化，部署运维更简单。</li>
</ul>
<p><strong>典型应用场景</strong>：多租户 SaaS（customer_a_token → database_a 完全隔离）、高可用环境零停机配置更新、安全敏感组织的企业级权限管控。</p>
<p>本次升级完全向后兼容 v0.5.x，现有 API 和配置无需修改，可平滑升级。</p>
<p>🚀 Doris MCP Server v0.6.0，开启企业级数据平台与认证管理新时代！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Grok 4.1：马斯克AI的里程碑式飞跃，它到底有多强？]]></title>    <link>https://juejin.cn/post/7573899782802997294</link>    <guid>https://juejin.cn/post/7573899782802997294</guid>    <pubDate>2025-11-18T13:36:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782802997294" data-draft-id="7573896789365637158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Grok 4.1：马斯克AI的里程碑式飞跃，它到底有多强？"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-18T13:36:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="墨风如雪"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Grok 4.1：马斯克AI的里程碑式飞跃，它到底有多强？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    墨风如雪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:36:39.000Z" title="Tue Nov 18 2025 13:36:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>嘿，AI圈的朋友们！最近有没有感受到一股暗流涌动？没错，埃隆·马斯克旗下的xAI，这次玩了个“低调奢华”的大动作——Grok 4.1，它不是简单地来了，而是“炸裂”式地登场了！虽然从11月1日开始就已静默推送，直到11月17日才正式公布，并在11月18日实现全面可用，但这短短几周的“暗中观察”，已经足够让整个AI界为之侧目。</p>
<p>这次Grok 4.1的更新，绝不是小修小补，而是一次脱胎换骨的性能飞跃。它不仅仅是数字的堆砌，更是向我们展示了AI如何能变得更聪明、更懂你、甚至更有“人情味”。作为一名AI观察者，我不得不说，Grok 4.1带来的震撼，远超预期。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fwdasf-1024x738.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/wdasf-1024x738.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09878e04fdb54d1ebbd77973d63796dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=vMtA7nAOEn0s1hQaIgXhcAZ7ZN0%3D" alt="wdasf" loading="lazy"/></a></p>
<h3 data-id="heading-0">核心能力大盘点：它凭什么“碾压”群雄？</h3>
<p>让我们直接看看Grok 4.1在各项指标上的“疯狂表现”，你就知道我为什么会用“炸裂”来形容它了。</p>
<h4 data-id="heading-1">🏆 霸榜LMArena：通用能力的王座</h4>
<p>想象一下，在一个汇聚了全球顶尖AI模型的竞技场上，Grok 4.1直接包揽了冠亚军！ 它的<strong>思考模式（Grok 4.1 Thinking，代号quasarflux）<strong>以1483的Elo得分稳居榜首，而更令人惊叹的是，即便是为了追求极速响应而生的</strong>非推理模式（Grok 4.1 Fast，代号tensor）</strong>，也以1465的Elo得分位列第二，甚至超越了其他所有模型的完整推理配置。这简直是坐火箭的速度，要知道Grok 4此前还在第33位徘徊，这次直接冲上云霄，简直是逆风翻盘的教科书！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-18_21.25.34-1024x312.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-18_21.25.34-1024x312.png" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f677134f3b9461383304694dce3f3b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=tEAcMFeFXOcKXRIm4NA22v2uz4c%3D" alt="iShot_2025-11-18_21.25.34" loading="lazy"/></a></p>
<h4 data-id="heading-2">❤️ 情商爆表：情感理解更上一层楼</h4>
<p>我们总说AI缺乏“人情味”，但Grok 4.1却狠狠地打了我们的脸。在EQ-Bench 3情感智力测试中，Grok 4.1的两种模式双双包揽榜单前两名，Elo得分高达1586。当你说“我丢失了猫咪”时，它不再是冰冷的模板回复，而是能提供温暖、实用且富有同理心的建议。这种捕捉对话中细微意图的能力，让Grok 4.1的交互体验变得更具体、更有温度。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fbhdfbrgn-1024x648.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/bhdfbrgn-1024x648.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3477ac3d4ff54ba5be3331faa231ca74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=dDfDTrAHwJevm3ydrLo8u9fUxTU%3D" alt="bhdfbrgn" loading="lazy"/></a></p>
<h4 data-id="heading-3">📝 文采斐然：创意写作的新高峰</h4>
<p>写作能力更是突飞猛进。在Creative Writing v3测试中，Grok 4.1的两种模式分别位列第二和第三。Elo得分跃升至1722，较上一代提升了近600分。这意味着它能生成更具想象力、更连贯的文本，无论是叙事故事还是文学表达，甚至能写出让你惊叹的X帖子——这哪是AI，简直是未来世界的诗人！</p>
<h4 data-id="heading-4">✅ 告别“幻觉”：事实准确性质的飞跃</h4>
<p>最让人头疼的“幻觉”问题，Grok 4.1也给出了漂亮的解决方案。它的幻觉率从上一代的约12.09%大幅降低至约4.22%，降幅接近3倍。这意味着它在信息查询时产生错误或虚构信息的概率显著下降，它提供的信息更可靠，更能成为你值得信赖的助手。在长达两周的静默发布盲测中，用户对Grok 4.1的回答偏好率达到64.78%。这可不是小数字，这代表了实打实的认可！</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Fasdasdyyynn-954x1024.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/asdasdyyynn-954x1024.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/caf6a601316e4f6c9ba8a18eff763431~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=iTsm87P%2BUGmZXXjTLmdjIb0UGoI%3D" alt="asdasdyyynn" loading="lazy"/></a></p>
<h3 data-id="heading-5">揭秘幕后：它究竟藏着什么“黑科技”？</h3>
<p>Grok 4.1之所以能取得如此逆天的表现，离不开xAI在技术上的大胆创新。</p>
<ul>
<li><strong>两种推理模式</strong>：Grok 4.1提供了“<strong>思考模式（quasarflux）</strong>”和“<strong>非推理模式（tensor）</strong>”两种选择。前者会展示其内部的推理链条，让你看到它如何一步步“思考”，特别适合解决复杂的数学、编程或多步骤逻辑问题，追求的是深度和精准；后者则以极快的响应速度著称，适合日常对话和快速查询，在速度与效率上做到了极致。</li>
<li><strong>智能体推理作为奖励模型</strong>：性能提升得益于训练方法的改进。xAI采用了前沿的<strong>智能体推理模型作为奖励模型</strong>，这让模型能够自主、大规模地评估和迭代输出结果。通俗来讲，就像给AI请了一个极其严苛又专业的老师，它会不断地“自我批评”和“自我优化”，最终在风格一致性和事实准确性上取得了显著进步。</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Ffegefb-1024x617.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/fegefb-1024x617.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0884ed1380d247da9e042f5646dbd9f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=bRoxgNraS64Q4QjnXT%2BRiFEMcYM%3D" alt="fegefb" loading="lazy"/></a></p>
<h3 data-id="heading-6">如何体验：免费的AI未来近在眼前！</h3>
<p>好消息是，如此强大的Grok 4.1目前<strong>已免费向所有用户开放使用</strong>！你无需任何额外订阅，就可以通过以下平台轻松访问：</p>
<ul>
<li>Grok 官网 (grok.com)</li>
<li>X（原推特）平台</li>
<li>iOS 和 Android 官方移动应用</li>
</ul>
<p>在平台的应用内，你可以直接在模型选择器中手动指定使用“Grok 4.1”，当然，系统默认的“Auto”模式也会自动为你分配这个最新、最强的模型。</p>
<h3 data-id="heading-7">写在最后：AI的“人性化”之路</h3>
<p>Grok 4.1的发布，无疑是xAI在人工智能领域投下的一枚重磅炸弹。它不仅在客观性能测试中占据了领先地位，更重要的是，在情感理解、创意写作等体现“人性化”交互的维度上取得了显著进步，同时大幅提升了回答的可靠性。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2Febeer-1024x492.webp" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/ebeer-1024x492.webp" ref="nofollow noopener noreferrer"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/684bdaaa8e954699a8eff657c954ef37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764077799&amp;x-signature=WFGsauZ8fQ8vHl16yzwLysJc6lw%3D" alt="ebeer" loading="lazy"/></a></p>
<p>这让我不禁思考，未来的AI，或许真能成为我们生活和工作中最懂、最得力的伙伴，不再是冰冷的工具，而是有温度、有创造力、值得信赖的“数字友人”。你准备好迎接Grok 4.1带来的新体验了吗？</p>
<p><strong>如果你也对最新的AI信息感兴趣或者有疑问 都可以加入我的大家庭 第一时间分享最新AI资讯、工具、教程、文档 欢迎你的加入！！！😉😉😉</strong></p>
<p>公众号：墨风如雪小站</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Jetpack Compose中的阴影艺术]]></title>    <link>https://juejin.cn/post/7573896789365669926</link>    <guid>https://juejin.cn/post/7573896789365669926</guid>    <pubDate>2025-11-18T13:50:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789365669926" data-draft-id="7573886599432683571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Jetpack Compose中的阴影艺术"/> <meta itemprop="keywords" content="Android,Android Jetpack,Kotlin"/> <meta itemprop="datePublished" content="2025-11-18T13:50:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="稀有猿诉"/> <meta itemprop="url" content="https://juejin.cn/user/2788017216685784"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Jetpack Compose中的阴影艺术
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2788017216685784/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    稀有猿诉
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:50:16.000Z" title="Tue Nov 18 2025 13:50:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文译自「The Art of Shadows in Jetpack Compose」，原文链接<a href="https://link.juejin.cn?target=https%3A%2F%2Fmedium.com%2Fproandroiddev%2Fthe-art-of-shadows-in-jetpack-compose-63a75070882f" target="_blank" title="https://medium.com/proandroiddev/the-art-of-shadows-in-jetpack-compose-63a75070882f" ref="nofollow noopener noreferrer">medium.com/proandroidd…</a>，由Stefano Natali发布于2025年10月4日。</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd6f100018f54ef9b05abaaf576913dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=6BCjP1%2BLZWcJpa0zweOSpj9LDqU%3D" alt="0.png" loading="lazy"/></p>
<p>UI中的阴影发挥着至关重要的作用：它们在视觉上<strong>提升</strong>元素，指示着<strong>交互性</strong>，并提供用户操作的即时<strong>反馈</strong>。多年来，我们一直依赖于<strong>高度</strong>属性，但 Jetpack Compose 现在提供了一套强大的工具，可以对<strong>阴影渲染</strong>进行精细控制。</p>
<p>Google 最近新增了一个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fdevelop%2Fui%2Fcompose%2Fgraphics%2Fdraw%2Fshadows" target="_blank" title="https://developer.android.com/develop/ui/compose/graphics/draw/shadows" ref="nofollow noopener noreferrer">文档页面</a>，其中包含一系列有趣的用例。本文将探索 Compose 中的主要阴影修改器，并深入讲解创建渐变和炫酷特效等高级技巧，从而提升应用的风格。</p>
<p>本文讨论的所有技巧的完整代码示例都可以在我的 GitHub 仓库 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fstefanoq21%2FComposePlayground" target="_blank" title="https://github.com/stefanoq21/ComposePlayground" ref="nofollow noopener noreferrer"><strong>Compose Playground</strong></a> 中找到。</p>
<h2 data-id="heading-0">阴影修改器（Shadow Modifiers）</h2>
<p>添加阴影最简单但自定义程度最低的方法是使用 <strong>Modifier.shadow()</strong>。与以往一样，它的行为依赖于<strong>基于高度的阴影</strong>，模拟来自上方的光源，阴影深度直接取决于你提供的高度值。其主要限制在于阴影始终被裁剪到可合成对象的形状内，并且你无法自定义扩展、颜色色调或偏移等属性。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">Box(
    Modifier
        .size(<span class="hljs-number">100.</span>dp)
        .shadow(
            elevation = <span class="hljs-number">10.</span>dp, 
            shape = RectangleShape
        )
        .background(Color.White)
)
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/848a6de852dc4ec98cbf114959ffa2e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=NFnaXqKpvCMsNSlQVf6bujmEQns%3D" alt="" loading="lazy"/></p>
<p>让我们从一些新功能开始，这些功能赋予我们更强大的力量。使用 <strong>dropShadow()</strong>，我们可以在内容后面创建自定义阴影。这个修饰符是创建复杂阴影的关键，它允许对内容后面的阴影进行精细控制，使元素看起来像是被抬升了一样。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> .dropShadow(
    shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp), shadow = Shadow(
            radius = <span class="hljs-number">6.</span>dp,
            spread = <span class="hljs-number">2.</span>dp,
            color = Color.Black.copy(alpha = <span class="hljs-number">0.3f</span>),
            offset = DpOffset(<span class="hljs-number">2.</span>dp, <span class="hljs-number">2.</span>dp)
              )
            )
 .background(
    color = Color.White, shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp)
            )
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d04d0db2e6142188d9e693cd946ce97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=f%2FRqIkoaJAUcgt5gB11w%2B0Zyg%2Bo%3D" alt="" loading="lazy"/></p>
<p>它使用 <strong>Shadow</strong> 参数，可以精确控制视觉效果。这个参数允许你使用几个关键属性来塑造阴影。 <strong>半径</strong> 决定了边缘的柔和度和扩散（模糊）程度。<strong>扩散</strong> 值控制阴影几何形状相对于可组合元素大小的扩展或收缩。最后，<strong>偏移</strong> 沿 <strong>X 轴和 Y 轴</strong>定位阴影，从而确定光源的视觉方向。结合阴影的<strong>颜色</strong>，这些属性可以实现完全自定义。</p>
<p>💡 <strong>顺序很重要：<strong>在修改器链中，<strong>dropShadow()</strong> 修改器必须出现在 <strong>background()</strong> 修改器</strong>之前</strong>，因为阴影先绘制，背景绘制在其上方。</p>
<p><strong>innerShadow()</strong> 修改器是 <strong>dropShadow()</strong> 的逆操作，它在可组合元素边界的<strong>内部</strong>创建阴影，从而实现元素凹陷或压入表面的视觉效果。与它的对应项一样，它也使用可自定义的<strong>Shadow</strong>对象，允许你使用<strong>半径</strong>、<strong>颜色</strong>、<strong>偏移</strong>和<strong>扩散</strong>来微调效果。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.background(
    Color.White, shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp)
)
.innerShadow(
    shape = RoundedCornerShape(<span class="hljs-number">20.</span>dp), shadow = Shadow(
        radius = <span class="hljs-number">6.</span>dp,
        spread = <span class="hljs-number">2.</span>dp,
        color = Color.Black.copy(alpha = <span class="hljs-number">0.3f</span>),
        offset = DpOffset(<span class="hljs-number">2.</span>dp, <span class="hljs-number">2.</span>dp)
    )
)
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc6fdb94495942e68c714abf39be614f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=jUvLmZvZqyc69AmZPBjbM9PKR5w%3D" alt="" loading="lazy"/></p>
<p>💡<strong>再次强调，顺序很重要：****innerShadow()<strong>修改器</strong>必须</strong>放在<strong>background()<strong>修改器</strong>之后</strong>。如果将其放在背景之前，内容将绘制在阴影之上，完全遮盖阴影。</p>
<p>这些修改器的真正强大之处在于它们的自定义和组合。通过叠加<strong>innerShadow()<strong>和</strong>dropShadow()</strong>，你可以创建复杂而逼真的视觉效果。我们来看一些高级用例。</p>
<h2 data-id="heading-1">高级技巧：组合和自定义阴影</h2>
<h3 data-id="heading-2">自定义阴影</h3>
<p>当你在 <strong>dropShadow()</strong> 函数中将 <strong>Brush</strong> 对象而非纯色传递给 <strong>Shadow</strong> 对象时，自定义的强大功能便显而易见。此功能允许你使用 <strong>Brush.sweepGradient</strong> 创建渐变效果。此外，无论你使用标准形状还是完全自定义的几何体，阴影始终会贴合可组合对象的形状。</p>
<pre><code class="hljs language-kotlin" lang="kotlin">.dropShadow(
    shape = MaterialShapes.Cookie12Sided.toShape(), shadow = Shadow(
        radius = <span class="hljs-number">10.</span>dp,
        spread = <span class="hljs-number">6.</span>dp,
        brush = Brush.sweepGradient(
            listOf(Color.Green, Color.Blue, Color.Yellow, Color.Green)
        ),
        offset = DpOffset(<span class="hljs-number">2.</span>dp, <span class="hljs-number">2.</span>dp)
    )
)
.background(
    color = Color.White,
    shape = MaterialShapes.Cookie12Sided.toShape(),
)
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94aaa942ba8e41ea821bd59e15634086~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=FYtpT6eJ2E5othJYE%2BadtHhazhE%3D" alt="4.png" loading="lazy"/></p>
<h3 data-id="heading-3">新粗犷主义阴影</h3>
<p>这种风格完美地展现了 <strong>dropShadow()</strong> 修改器在实现极致高对比度效果方面的强大功能。要实现新粗犷主义（Neobrutalism）那种粗犷、棱角分明的视觉效果，你必须使用 <code>dropShadow()</code> 函数，并设置模糊度为零，偏移量要明显，通常还要配合粗边框。具体来说，你需要同时设置 <code>radius = 0.dp</code> 和 <code>spread = 0.dp</code> 来消除扩散，然后应用鲜艳的色彩，并设置一个明显的偏移量，从而创建出标志性的锐利轮廓。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> .dropShadow(
     shape = RoundedCornerShape(<span class="hljs-number">0.</span>dp),
     shadow = Shadow(
        radius = <span class="hljs-number">0.</span>dp,
        spread = <span class="hljs-number">0.</span>dp,
        color = dropShadowColor,
        offset = DpOffset(x = <span class="hljs-number">8.</span>dp, <span class="hljs-number">8.</span>dp)
                    )
        )
 .border(
    <span class="hljs-number">8.</span>dp, borderColor
        )
 .background(
    color = Color.White,
    shape = RoundedCornerShape(<span class="hljs-number">0.</span>dp)
        )
</code></pre>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f06cd7d3b604a68802ecf34b7ff63e0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=%2Fh2btXZeUZ31bXwv3jXPh7uW5do%3D" alt="5.png" loading="lazy"/></p>
<h3 data-id="heading-4">具有动效的阴影</h3>
<p>阴影并非只是静态的；它们可以制作成动画，从而提供即时的用户反馈。我们将要探索的最后一个高级技巧是创建交互式阴影，使其在特定操作（例如点击或按下）时平滑过渡。这项技术对于模拟物理交互至关重要，它能直观地确认元素的抬升或状态发生了变化。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"> Box(Modifier.fillMaxSize()) {
        <span class="hljs-keyword">val</span> interactionSource = remember { MutableInteractionSource() }
        <span class="hljs-keyword">val</span> isPressed <span class="hljs-keyword">by</span> interactionSource.collectIsPressedAsState()

        <span class="hljs-comment">// Create transition with pressed state</span>
        <span class="hljs-keyword">val</span> transition = updateTransition(
            targetState = isPressed, label = <span class="hljs-string">"button_press_transition"</span>
        )

        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">buttonPressAnimation</span><span class="hljs-params">()</span></span> = tween&lt;T&gt;(
            durationMillis = <span class="hljs-number">400</span>, easing = Ease
        )

        <span class="hljs-comment">// Animate all properties using the transition</span>
        <span class="hljs-keyword">val</span> shadowAlpha <span class="hljs-keyword">by</span> transition.animateFloat(
            label = <span class="hljs-string">"shadow_alpha"</span>, transitionSpec = { buttonPressAnimation() }) { pressed -&gt;
            <span class="hljs-keyword">if</span> (pressed) <span class="hljs-number">0f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1f</span>
        }

        <span class="hljs-comment">//to animate the color</span>
        <span class="hljs-keyword">val</span> colorDropShadow <span class="hljs-keyword">by</span> transition.animateColor(
            label = <span class="hljs-string">"shadow_color"</span>, transitionSpec = { buttonPressAnimation() }) { pressed -&gt;
            <span class="hljs-keyword">if</span> (pressed) Color.Transparent <span class="hljs-keyword">else</span> Color.Green.copy(alpha = (<span class="hljs-number">0.5f</span>))
        }
        <span class="hljs-keyword">val</span> innerShadowAlpha <span class="hljs-keyword">by</span> transition.animateFloat(
            label = <span class="hljs-string">"inner_shadow_alpha"</span>, transitionSpec = { buttonPressAnimation() }) { pressed -&gt;
            <span class="hljs-keyword">if</span> (!pressed) <span class="hljs-number">0f</span> <span class="hljs-keyword">else</span> <span class="hljs-number">1f</span>
        }

        Box(
            Modifier
                .clickable(
                    interactionSource, indication = <span class="hljs-literal">null</span>
                ) {
                    <span class="hljs-comment">//...</span>
                }
                .width(<span class="hljs-number">300.</span>dp)
                .height(<span class="hljs-number">200.</span>dp)
                .align(Alignment.Center)
                .dropShadow(
                    shape = RoundedCornerShape(<span class="hljs-number">70.</span>dp), shadow = Shadow(
                        radius = <span class="hljs-number">10.</span>dp,
                        spread = <span class="hljs-number">0.</span>dp,
                        color = Color.Green.copy(alpha = (<span class="hljs-number">0.5f</span>)),
                        offset = DpOffset(x = <span class="hljs-number">0.</span>dp, <span class="hljs-number">0.</span>dp),
                        alpha = shadowAlpha
                    )
                )
                <span class="hljs-comment">// note that the background needs to be defined before defining the inner shadow</span>
                .background(
                    color = Color(<span class="hljs-number">0xFFFFFFFF</span>), shape = RoundedCornerShape(<span class="hljs-number">70.</span>dp)
                )
                .innerShadow(
                    shape = RoundedCornerShape(<span class="hljs-number">70.</span>dp), shadow = Shadow(
                        radius = <span class="hljs-number">8.</span>dp,
                        spread = <span class="hljs-number">4.</span>dp,
                        color = Color.Green.copy(alpha = (<span class="hljs-number">0.5f</span>)),
                        alpha = innerShadowAlpha,
                        offset = DpOffset(x = <span class="hljs-number">0.</span>dp, <span class="hljs-number">0.</span>dp)
                    )
                )
        ) {
            <span class="hljs-comment">//...</span>
        }
    }
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d57558daa7c40759bfe7307cf83be86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iA5pyJ54y_6K-J:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078616&amp;x-signature=2YM%2BP7i5yiWt8iP%2B1WVWaeOacCY%3D" alt="6.gif" loading="lazy"/></p>
<p>好的，我们已经了解了如何使用 <strong>updateTransition</strong> API 来创建流畅的交互反馈。它首先使用 <strong>MutableInteractionSource</strong> 跟踪按下状态。该状态会驱动一个 <strong>400 毫秒的过渡动画</strong>，同时为两个方向相反的阴影添加动画效果。外部的 <strong>dropShadow</strong> 在按下时会淡出，而内部的 <strong>innerShadow</strong> 则会淡入。这种双阴影动画使组件从 <strong>抬升</strong> 状态平滑过渡到 <strong>凹陷</strong> 状态，从而在用户交互时提供清晰且动态的反馈。</p>
<h2 data-id="heading-5">结论</h2>
<p>Compose 全新的阴影 API 标志着对传统 <strong>elevation</strong> 属性局限性的重大突破。它将核心概念拆分为 <strong>dropShadow()</strong> 和 <strong>innerShadow()</strong>，并赋予我们对 <strong>Shadow</strong> 对象属性的完全控制权。</p>
<p>无论你是打造简单的渐变效果、模拟物理深度，还是实现新粗野主义的高对比度视觉冲击，这种全新的自定义程度都意味着你的 <strong>UI 终于可以充分展现你设计的艺术愿景</strong>。</p>
<p>不妨尝试这些修饰符，为你的 Jetpack Compose 应用注入全新的创意维度！</p>
<p>如果你觉得这篇文章有趣，欢迎关注我，获取更多关于 Android 开发和 Jetpack Compose 的精彩内容。我会定期发布相关主题的文章。欢迎随时分享你的评论，或通过 <a href="https://link.juejin.cn?target=https%3A%2F%2Fbsky.app%2Fprofile%2Fstefanoq21.bsky.social" target="_blank" title="https://bsky.app/profile/stefanoq21.bsky.social" ref="nofollow noopener noreferrer"><strong>Bluesky</strong></a> 或 <a href="https://link.juejin.cn?target=http%3A%2F%2Fwww.linkedin.com%2Fin%2Fstefano-natali-q21" target="_blank" title="http://www.linkedin.com/in/stefano-natali-q21" ref="nofollow noopener noreferrer"><strong>LinkedIn</strong></a> 与我联系，进行更深入的讨论。</p>
<p>祝你开心，编程快乐！</p>
<blockquote>
<p>欢迎搜索并关注 <em>公众号<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fqrcode%3Fscene%3D10000004%26size%3D512%26__biz%3DMzU1MDg0NDczNA%3D%3D%26mid%3D2247484417%26idx%3D1%26sn%3D60c15f0d3c4be75e37748c2472a74102" target="_blank" title="https://mp.weixin.qq.com/mp/qrcode?scene=10000004&amp;size=512&amp;__biz=MzU1MDg0NDczNA==&amp;mid=2247484417&amp;idx=1&amp;sn=60c15f0d3c4be75e37748c2472a74102" ref="nofollow noopener noreferrer">「稀有猿诉」</a></em> 获取更多的优质文章！</p>
<p>保护原创，请勿转载！</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[N8N工作流中文转换神器！一键转中文]]></title>    <link>https://juejin.cn/post/7573670400154402868</link>    <guid>https://juejin.cn/post/7573670400154402868</guid>    <pubDate>2025-11-18T13:50:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573670400154402868" data-draft-id="7573864324713873460" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" N8N工作流中文转换神器！一键转中文"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-18T13:50:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Java中文社群"/> <meta itemprop="url" content="https://juejin.cn/user/61228381386487"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             N8N工作流中文转换神器！一键转中文
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/61228381386487/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Java中文社群
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T13:50:21.000Z" title="Tue Nov 18 2025 13:50:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>无论是 N8N 官方的工作流模板，还是社区开源的工作流都是英文的，这对国内用户来说是非常不友好的。</p>
<p>因此，我花了一些时间开发了一个 <strong>「N8N 工作流中文转换器」</strong>，一键将英文工作流转换为中文，先看效果吧。</p>
<p>这是原版工作流：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0c53cb00433456d92b38e0ae94d1a9a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078621&amp;x-signature=Rewf2PhF%2FDISpZT%2B9N8r%2B53n75E%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>PS：全英文的看不太懂。</p>
</blockquote>
<p>这是转换成中文的工作流：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f71798d54f4f758434516fee18ebd5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078621&amp;x-signature=ZMIKicM57ul%2BUZFQ3Y%2FXaDLYTMo%3D" alt="" loading="lazy"/></p>
<p>这样就能让国内的用户也能轻松上手了。</p>
<h2 data-id="heading-0">实现思路</h2>
<ol>
<li>读取原本英文 N8N 模板内容。</li>
<li>将 N8N 模板内容交给大模型，并明确任务目标。大致思路是：将工作流中的英文备注全部替换成中文（将 JSON 文件中 type = stickyNote 的所有节点中的 content 翻译为中文）。</li>
<li>将转换后的中文工作流保存至本地。</li>
</ol>
<p>工作流如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0713686d68e54ac8aee85b17eadbc835~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeS4reaWh-ekvue-pA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764078621&amp;x-signature=4CU0dSu7mZ8rB8XY%2BKVgAlKBuvw%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>因此，整个工作流中<strong>最核心的就是 AI Agent 的提示词了，我们需要把工作流的特征给大模型，让大模型进行中文转换</strong>。而提示词也分享给大家了，可以在下面视频中获取。</p>
</blockquote>
<h2 data-id="heading-1">视频教程</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1vay3BKEz3%2F" target="_blank" title="https://www.bilibili.com/video/BV1vay3BKEz3/" ref="nofollow noopener noreferrer">www.bilibili.com/video/BV1va…</a></p>
<h2 data-id="heading-2">小结</h2>
<p>上述工作流仅支持单个文件的转换。如需批量处理，你可以使用 Java 或 Python 等语言遍历所有英文工作流，并将其传递至本工作流（可将起始节点改为 WebHook），从而实现一次性批量转换。</p>
<blockquote>
<p>本文已收录到我的技术小站 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.javacn.site" target="_blank" title="https://www.javacn.site" ref="nofollow noopener noreferrer">www.javacn.site</a>，其中包含的内容有：Spring AI、Spring AI Alibaba、LangChain4j、Dify、Coze、N8N、智能体（AI Agent）、MCP、Function Call、RAG、向量数据库、Prompt、多模态、向量数据库、嵌入模型、AI 常见面试问题等内容。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[你支持游戏内显示电量、信号或时间吗？]]></title>    <link>https://juejin.cn/post/7573896789365456934</link>    <guid>https://juejin.cn/post/7573896789365456934</guid>    <pubDate>2025-11-18T12:10:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789365456934" data-draft-id="7572481101711147062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="你支持游戏内显示电量、信号或时间吗？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-18T12:10:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="亿元程序员"/> <meta itemprop="url" content="https://juejin.cn/user/1972988307323236"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            你支持游戏内显示电量、信号或时间吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972988307323236/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    亿元程序员
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:10:20.000Z" title="Tue Nov 18 2025 12:10:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>点击上方亿元程序员+关注和★星标</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e96fc9ff08364138841c93be17b9f6d6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=0eY8XMp4DISNf8bd9OjJiNIM0xg%3D" alt="素材源于网络" loading="lazy"/></p>
<h2 data-id="heading-0">引言</h2>
<p><strong>哈喽大家好</strong>，周末的时候，我看到了一个非常有趣的话题，就是我们的游戏里面，应该/不应该显示电量、信号或时间？</p>
<p><strong>不知道</strong>大家在玩王者荣耀的时候有没有这样类似的经历：当你打得正起劲的时候，勇冠三军，即将超神，突然间被一个弹框秒了。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb847c09f3244c7aa3236eff5a6d672e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=GWAyx5eVBRw1%2BL15Ww0NABNFjHA%3D" alt="素材源于网络" loading="lazy"/></p>
<p><strong>没错</strong>，这个弹框就是天下苦<code>iOS</code>久矣的电池电量不足弹框。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bd10bcf22ea448b835d38668eb05a6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=7YzEK7sw102S%2FZTR5tY3f9KH0xc%3D" alt="还剩10%的电量" loading="lazy"/></p>
<p><strong>这个</strong>和显不显示电量有什么关系，难道王者荣耀没有显示电量吗？--的确没什么关系，只是吐槽一下这个电量不足的弹框。</p>
<p><strong>硬要说有关系</strong>的话，那就是电量没有显示数值，没办法提前预防弹框。</p>
<p><strong>言归正传</strong>，今天一起来聊一聊游戏内应该/不应该显示电量、信号或时间？</p>
<p><strong>本文源工程可在文末获取，小伙伴们自行前往。</strong></p>
<h2 data-id="heading-1">沉浸式的体验</h2>
<p><strong>首先</strong>，我们来看看反对方（游戏内不应该显示电量、信号或时间）的观点：</p>
<h3 data-id="heading-2">1.游戏的核心价值在于提供沉浸式的体验</h3>
<p><strong>经常</strong>做游戏的小伙伴都知道，我们做游戏的目的，很多时候就是为了让玩家能够“沉迷”进去游戏，产生共鸣。</p>
<p><strong>可以理解</strong>，玩家们为了得到放松，会暂时逃离现实世界，进入到游戏世界中，上演一个不一样的自己。</p>
<p><strong>但是</strong>，游戏内的电量、信号或时间，这些现实中的元素就会不断提醒玩家还在现实，没办法沉浸式代入游戏。</p>
<h3 data-id="heading-3">2.时间焦虑、电量焦虑</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91a2f4546a9f4a11a3c25d75e6d376ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=wC4RxPnqXdUJJBRCrYDPes21vgk%3D" alt="图片由AI生成" loading="lazy"/></p>
<p><strong>往往</strong>游戏内不显示时间、电池的目的为了避免玩家不必要心理干扰和焦虑。</p>
<p><strong>时间的显示</strong>，会让人产生“我玩了多久了？”的焦虑；电量的显示则会引发“我还能玩多久？”的担忧。</p>
<p><strong>这些</strong>与游戏没太大关联的焦虑和担忧，很容易让玩家分心，送人头。</p>
<p><strong>游戏</strong>应该是放松和享受的，而不是另一个焦虑的来源。</p>
<h3 data-id="heading-4">3.多此一举</h3>
<p><strong>如果</strong>玩家实在是想看看电池电量、当前时间或者网络信号，顶部轻轻下滑就能看到，何必多此一举的优化呢？</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/091ef8997ec4424bb3d193bc0a6e244f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=OJOPu9td4vr5PBsaC74Mnsl%2FdF4%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">笔者的想法</h2>
<p><strong>我觉得</strong>游戏内显示电量、信号或时间挺好的：</p>
<h3 data-id="heading-6">1.提醒玩家</h3>
<p><strong>游戏</strong>内显示时间，目的就是为了方便提醒玩家。例如活动的开始和结束时间，某个<strong>Boss</strong>刷新的时间，或者副本的剩余时间，这些都是比较有效和玩家乐意收到的提醒。</p>
<h3 data-id="heading-7">2.转移压力</h3>
<p><strong>网络信号信息</strong>，当玩家，网络状态见红，或者高延迟时，那么玩家能够意识到自己的网络环境可能不太好，假如没有这个显示，那么玩家可能就对游戏开喷了，这是一种常见的转移压力手段。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/db54a941f60842ee9c738018599b988f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=z2AmnHmHAJ4FEpa%2FH6Gby8L8Um8%3D" alt="素材源于网络" loading="lazy"/></p>
<h3 data-id="heading-8">3.心理预防</h3>
<p><strong>正如</strong>开篇的例子，假如游戏内有电池电量预防，那么我会在将要没电的时候去充电，或者避免一些重要的操作，因电量不足造成损失。例如“<strong>等等再开团，等我先充个电！</strong>”</p>
<h2 data-id="heading-9">聊着聊着又要上例子了</h2>
<p><strong>既然如此</strong>，我们在Cocos游戏开发中，如何显示电量、信号和时间信息呢？下面一起来看个例子。</p>
<h3 data-id="heading-10">1.相关API</h3>
<ul>
<li>
<p><strong>获取网络类型</strong>：常用于优化弱网体验以及网络调优，通过接口我们可以判断当前是是否连接<code>wifi</code>，是否是弱网环境。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9aafa791ef7f41a3aed1697fc5e1f669~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=XtO3hetVzSKnOV9vwteBLi0WZSA%3D" alt="来源于微信官方文档" loading="lazy"/></p>
</li>
<li>
<p><strong>获取设备电池信息</strong>：常用于获取设备电池信息，通过接口我们可以获取当前电量，是否正在充电，是否处于省电模式。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd0d54197e264ce19ba40cbfd7506906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=aniq7KwFuMTrDpfzAC3OCa5r5cc%3D" alt="来源于微信官方文档" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-11">2.资源准备</h3>
<p><strong>老规矩</strong>，先找<code>AI</code>搭子搞几个<code>Wifi</code>、<code>4G</code>信号、电池资源。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171a80470c04407f84766978065a636c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=n1QUI%2F2VtxzsPZFfEJGqJMblu7c%3D" alt="" loading="lazy"/></p>
<p><strong>然后</strong>在场景中简单拼接一下。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9da2f87ba1f04f338d9bc6fad316811d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=5qH%2BOltFPq3GzZeohr9UDe6SAVg%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">3.写代码</h3>
<p><strong>首先</strong>创建一个<code>Main</code>脚本，因为本次演示环境是微信小游戏，所以我们声明一下<code>declare const wx: any; </code>使用微信的<code>API</code>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbdd1efaef5c4bdba53382129ad03436~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=pH5YIJ%2BB7VzghRa3aWxQyJ2vjhw%3D" alt="" loading="lazy"/></p>
<p><strong>定时</strong>获取信息。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b383b418c1d4fb7b533cdd771ea9f25~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=m9n03HHUXp4CjkTs%2BjOMocAzY6U%3D" alt="" loading="lazy"/></p>
<p><strong>设置</strong>时间。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1aa50929ea62463c9dba034514b2a2c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=mruSBowH6aAyCsyzfs4kMIPQ%2FSA%3D" alt="" loading="lazy"/></p>
<p><strong>设置</strong>网络状态，由于延迟数据的判断涉及服务端，小伙伴们可以通过心跳包等方式计算，笔者这里不做详细演示。</p>
<p><strong>甚至可以使用<code>Math.random</code>，简单快捷，建议不要学</strong>。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e29d0ef7e25490b8d1d67c927938a36~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=wbgbKGXW4ckcY%2FcYX5EcudVhafE%3D" alt="" loading="lazy"/></p>
<p><strong>设置</strong>电池信息。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f887bc8854b416988a75a9c299b906c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=1t8mIEe0JJjlCNmQJXEoQBAXdq4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">4.效果演示</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/649c3290bd124071bbb8df6286764c99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=OorzOoaxhCkrw6yq5k%2F9ogjeIoY%3D" alt="" loading="lazy"/></p>
<p><strong>Wifi</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f908c07c90c84b789eb069ae8cf5f6a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=0i6pGd6zMAzHQscy6fNobcsdeNI%3D" alt="" loading="lazy"/></p>
<p><strong>4G</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2a7f8ce9b573470496bd04d2922d5d74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=2nwP5tkjvs7VlQTsn4B7XouTs70%3D" alt="" loading="lazy"/></p>
<p><strong>正在充电</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17f7dd7eb009477da3ef9b5d9294271e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=RoAGPGwYDk6e5aIPD43RG2rZx%2B0%3D" alt="" loading="lazy"/></p>
<p><strong>不在充电</strong>:</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8c7b001e1754eaeb855da0b3d428765~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq_5YWD56iL5bqP5ZGY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072620&amp;x-signature=2NmYgnjAm%2BxdcvsT38H3AN7J1JI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-14">结语</h2>
<p><strong>看到这里</strong>的小伙伴们，你们支持游戏内显示电量、信号或时间吗？</p>
<p>本文<strong>源工程</strong>可通过<strong>私信</strong>发送 <strong>TopBar</strong> 获取。</p>
<p><strong>我是"亿元程序员"，一位有着8年游戏行业经验的主程。在游戏开发中，希望能给到您帮助, 也希望通过您能帮助到大家。</strong></p>
<p>AD:笔者线上的小游戏《打螺丝闯关》《贪吃蛇掌机经典》《重力迷宫球》《填色之旅》《方块掌机经典》大家可以自行点击搜索体验。</p>
<p>实不相瞒，想要个<strong>赞</strong>和<strong>爱心</strong>！请把该文章<strong>分享</strong>给你觉得有需要的其他小伙伴。谢谢！</p>
<p>推荐专栏：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3175880857546129410%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3175880857546129410#wechat_redirect" ref="nofollow noopener noreferrer">知识付费专栏</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26mid%3D2247487282%26idx%3D1%26sn%3De3cb8ab6f5c0d5f804d5c29e2e90b9ad%26chksm%3Dc00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54%26token%3D336413522%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=Mzg5NTY2MjIzMg==&amp;mid=2247487282&amp;idx=1&amp;sn=e3cb8ab6f5c0d5f804d5c29e2e90b9ad&amp;chksm=c00daec5f77a27d33933e877464d8cde24c4c947d3755f5e8262c634634617e7c26de3953a54&amp;token=336413522&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">你知道和不知道的微信小游戏常用API整理，赶紧收藏用起来~</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3207702867494305797%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3207702867494305797#wechat_redirect" ref="nofollow noopener noreferrer">100个Cocos实例</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3073771187570999299%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3073771187570999299#wechat_redirect" ref="nofollow noopener noreferrer">8年主程手把手打造Cocos独立游戏开发框架</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg5NTY2MjIzMg%3D%3D%26action%3Dgetalbum%26album_id%3D3121583619634626562%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg5NTY2MjIzMg==&amp;action=getalbum&amp;album_id=3121583619634626562#wechat_redirect" ref="nofollow noopener noreferrer">和8年游戏主程一起学习设计模式</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3Faction%3Dgetalbum%26__biz%3DMzg5NTY2MjIzMg%3D%3D%26scene%3D1%26album_id%3D3038883468588089350%26count%3D3%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?action=getalbum&amp;__biz=Mzg5NTY2MjIzMg==&amp;scene=1&amp;album_id=3038883468588089350&amp;count=3#wechat_redirect" ref="nofollow noopener noreferrer">从零开始开发贪吃蛇小游戏到上线系列</a></p>
<p>点击下方绿色按钮+关注。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快速构建一个基础、现代化的 WinForm 管理系统]]></title>    <link>https://juejin.cn/post/7573886599433584691</link>    <guid>https://juejin.cn/post/7573886599433584691</guid>    <pubDate>2025-11-18T12:15:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433584691" data-draft-id="7573890735578759178" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快速构建一个基础、现代化的 WinForm 管理系统"/> <meta itemprop="keywords" content="后端,.NET"/> <meta itemprop="datePublished" content="2025-11-18T12:15:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="追逐时光者"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快速构建一个基础、现代化的 WinForm 管理系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    追逐时光者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:15:53.000Z" title="Tue Nov 18 2025 12:15:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>前段时间有小伙伴在后台留言问：<code>有没有好用的 WinForm 管理系统?</code>今天大姚给大家分享一个基于 AntdUI 构建的 WinForm 管理系统，不需要我们写一行代码既能快速构建一个基础、现代化的 WinForm 管理系统。</p>
<h2 data-id="heading-1">项目介绍</h2>
<p>WenAntdUI-Admin 是一个基于 AntdUI 构建、基础、现代化的 WinForm 管理系统，基于 Apache-2.0 License 开源，项目包含：AOT发布、字典管理、用户管理、菜单管理、权限管理、用户设置等功能。内部封装了很多常用组件，包含AdminTable等通用组件。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fe43W9dqTWnmwI2STQREolw" target="_blank" title="https://mp.weixin.qq.com/s/e43W9dqTWnmwI2STQREolw" ref="nofollow noopener noreferrer">DotNetGuide 突破了 9.5K + Star，一份全面的C#/.NET/.NET Core学习、工作、面试指南知识库！</a></li>
</ul>
<h2 data-id="heading-2">AntdUI 介绍</h2>
<p>AntdUI 是一款基于 Ant Design 设计语言的开源（Apache License） WinForm UI 界面库，致力于将现代美观的前端设计风格带入到桌面应用程序中。采用纯GDI绘图，不需任何图片资源，全面支持AOT，最低兼容 .NET Framework 4.0。</p>
<ul>
<li><strong>详细介绍：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FH46V1EZ7DCduUeS9j7wO0w" target="_blank" title="https://mp.weixin.qq.com/s/H46V1EZ7DCduUeS9j7wO0w" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/H46V1EZ7D…</a></li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/73e49a776a70450b97e49626991e1a27~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=zevIe9UueOQQFvJO5ObuYqUZiAk%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-3">功能模块</h2>

































<table><thead><tr><th>功能</th><th>状态</th></tr></thead><tbody><tr><td>AOT发布</td><td>✅</td></tr><tr><td>字典管理</td><td>✅</td></tr><tr><td>用户管理</td><td>✅</td></tr><tr><td>菜单管理</td><td>✅</td></tr><tr><td>权限管理</td><td>✅</td></tr><tr><td>用户设置</td><td>✅</td></tr></tbody></table>
<h2 data-id="heading-4">项目源代码</h2>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99946371293348eeb790d7848fb9f13d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=Vq5UtVVTxF58SuZdNzbK5VZru4Q%3D" alt="" loading="lazy"/></p>
<p><strong>项目分层介绍：</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/239898acaebd4ca78514505431ffd1c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=LkgxO2TNK3MFuU1YE7QkUMVv1WU%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">初始化 WinForm 管理系统</h2>
<p>首先我们设置 <code>WenAntdUI.Demo</code> 为启动项目，首次运行会自动初始化 <code>SQLite</code> 数据库，并且在运行目录下创建一个 <code>data.db</code>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bceb1df19bc24408860001c1cf8bff88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=WXYtMlyLExZshop8lPLSoa%2BUCtM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a32e9f23af3424293810f68d9176249~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=haW70gAtBN9cuc3g3cbU98wXlJY%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/693d5cacd8554510958a16d6a2b30b66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=Iw4ViJVY%2FbV2foacYdYnUdLTPeg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">运行效果演示</h2>
<blockquote>
<p>账户：admin 密码：admin</p>
</blockquote>
<h3 data-id="heading-7">用户登录</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f2631fd417c47529247cf38359194a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=ShyJ6c3f5MiA9E%2FExvy0UoOH9Pc%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-8">图表预览</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5263d96ef6d744afbc20b34a52fc05b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=KIllHGEhPKBQx%2BtDvOlstJ%2FvILw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">字典管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d1dfb3b246e4914ae0c8a822082a681~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=wqONinkleI0ZPiMG6KmsRADPQ5g%3D" alt="" loading="lazy"/></p>
<p><img src="" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">菜单管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ce3a87fb55412385b3cc651b2e880a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=VBkiMKlcYvRWGmqG4r6HeYwCh4Y%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93f09742a6934640baadcf9a6d57a122~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=UsfguZ9CyZQriJohYf4Xna2lMYw%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-11">角色管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e1b137eaa74b3d8c46edeb737c9d0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=vUunICMqG75LDJRk8xBAWsfrgqE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5354c4e7b4b24307bdcd2a6bc9e57efa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=1tOe%2F4%2BFejDg8jxiZZzjVXarGb4%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-12">用户管理</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25f6c84fae2a40d5bcd68191f6f7efd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=qQ%2FsefG2fw1n77RrwJ1XAmLTq0I%3D" alt="" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1b598486f4e480eabccea4fd371991c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=1MD0O302dgtrhjd48Y1qXQ3y1hM%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">系统本地设置</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7249b7b7c784b4a981fc23c081818e5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=7DztIwyrPuh1bg6zaQIXjA7by3M%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-14">系统主题切换</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b701b357ed54684b1ff0e01e452bf59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764072953&amp;x-signature=E7UOYOKqmC8CSdx0o4AMP8k%2B9og%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-15">项目源码地址</h2>
<p>更多项目实用功能和特性欢迎前往项目开源地址查看👀，别忘了给项目一个Star支持💖。</p>
<ul>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2FAntdUI%2Fwen-antd-ui" target="_blank" title="https://gitee.com/AntdUI/wen-antd-ui" ref="nofollow noopener noreferrer">gitee.com/AntdUI/wen-…</a></li>
</ul>
<h2 data-id="heading-16">优秀项目和框架精选</h2>
<p>该项目已收录到C#/.NET/.NET Core优秀项目和框架精选中，关注优秀项目和框架精选能让你及时了解C#、.NET和.NET Core领域的最新动态和最佳实践，提高开发工作效率和质量。坑已挖，欢迎大家踊跃提交PR推荐或自荐（<strong>让优秀的项目和框架不被埋没🤞</strong>）。</p>
<ul>
<li><strong>GitHub开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHar…</a></li>
<li><strong>Gitee开源地址：</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetProjectPicks.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetProjectPicks.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayup…</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂：localhost和局域网 IP 的核心区别与使用场景]]></title>    <link>https://juejin.cn/post/7573890735578857482</link>    <guid>https://juejin.cn/post/7573890735578857482</guid>    <pubDate>2025-11-18T12:38:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735578857482" data-draft-id="7573899782802833454" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂：localhost和局域网 IP 的核心区别与使用场景"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-11-18T12:38:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="拉不动的猪"/> <meta itemprop="url" content="https://juejin.cn/user/1429793504759630"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂：localhost和局域网 IP 的核心区别与使用场景
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1429793504759630/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    拉不动的猪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:38:34.000Z" title="Tue Nov 18 2025 12:38:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>前端项目运行时给出的 <code>localhost:3000</code> 和 <code>192.168.1.41:3000</code> 本质上指向同一项目服务，但适用场景和访问范围不同，具体区别及选择建议如下：</p>
<h3 data-id="heading-0">一、核心区别</h3>

























<table><thead><tr><th>维度</th><th><code>localhost:3000</code></th><th><code>192.168.1.41:3000</code></th></tr></thead><tbody><tr><td><strong>指向对象</strong></td><td>仅指向「当前运行项目的本机」（通过本地回环地址 <code>127.0.0.1</code> 实现）</td><td>指向本机在局域网中的 IP 地址（<code>192.168.1.41</code> 是本机在路由器分配的私有 IP）</td></tr><tr><td><strong>访问范围</strong></td><td>只能在「本机」上访问（其他设备无法通过 <code>localhost</code> 访问）</td><td>同一局域网内的所有设备（如手机、其他电脑、平板）均可访问</td></tr><tr><td><strong>依赖条件</strong></td><td>无需网络（断网也能访问），仅依赖本机服务是否启动</td><td>需保证本机和其他设备在同一局域网（如同一 WiFi / 网线），且本机防火墙允许端口访问</td></tr></tbody></table>
<h3 data-id="heading-1">二、选择建议：根据场景决定</h3>
<ol>
<li>
<p><strong>开发调试时优先用 <code>localhost:3000</code></strong></p>
<ul>
<li>优势：访问速度更快（本地回环不经过网络路由），且不受局域网波动影响（断网也能工作），更稳定。</li>
<li>适用场景：自己在电脑上写代码、调试功能、修改样式等。</li>
</ul>
</li>
<li>
<p><strong>需要跨设备测试时用 <code>192.168.1.41:3000</code></strong></p>
<ul>
<li>优势：可以在手机、平板或同事的电脑上访问你的项目，验证响应式布局、多设备兼容性等。</li>
<li>适用场景：测试移动端显示效果、让团队成员临时查看项目进度、跨设备联调（如手机扫码测试支付流程）。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-2">三、注意事项</h3>
<ul>
<li>若用局域网地址访问失败，可能是本机防火墙阻止了 <code>3000</code> 端口，或项目配置限制了仅本地访问（部分框架需手动开启局域网访问权限）。</li>
<li>局域网 IP 可能会变化（路由器重启可能重新分配），若后续访问失败，可重新运行项目获取新的局域网地址。</li>
</ul>
<p>总之，日常开发用 <code>localhost</code> 更高效，跨设备测试时再用局域网 IP 即可。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[今天 Cloudflare 全球事故，连 GPT 和你的网站都一起“掉线”了]]></title>    <link>https://juejin.cn/post/7573680361991077928</link>    <guid>https://juejin.cn/post/7573680361991077928</guid>    <pubDate>2025-11-18T12:38:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573680361991077928" data-draft-id="7573680361991061544" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="今天 Cloudflare 全球事故，连 GPT 和你的网站都一起“掉线”了"/> <meta itemprop="keywords" content="程序员,前端,后端"/> <meta itemprop="datePublished" content="2025-11-18T12:38:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="摆烂工程师"/> <meta itemprop="url" content="https://juejin.cn/user/1552933235470589"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            今天 Cloudflare 全球事故，连 GPT 和你的网站都一起“掉线”了
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1552933235470589/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    摆烂工程师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:38:15.000Z" title="Tue Nov 18 2025 12:38:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天 Cloudeflare 挂了，其实很多人都“躺枪”了。</p>
<p>当你刷着社交媒体、打开博客、访问网站的时候，发现页面卡住、提示 500 错误、或者直接 “访问失败”，这不是你的网线出了问题，而是男主角登场了：Cloudflare。</p>
<p>根据最新报道，Cloudflare 的全球网络正在遭遇技术障碍——多个平台、网站及服务一起受波及，连 ChatGPT、推特、Cladude 等等都躲不过～</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c78565b02d974d7a86675ed8c8215ff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764074295&amp;x-signature=8hOlbc%2FzHf321q%2BRgkPQxNC%2FO0w%3D" alt="" loading="lazy"/></p>
<p>为什么“中招”这么多人？因为 Cloudflare 本身就是 “中枢”之一。它负责的网站加速、内容分发、DNS解析、安全防护——换句话说，它帮成千上万的网站在世界各地更快速、更安全地“上线”。而当这个“枢纽”出现问题，连锁反应几乎瞬时扩散。</p>
<p>比如，ChatGPT 就被用户报告 “请取消阻止 challenges.cloudflare.com 后继续”。 再比如，一些博客、个人网站甚至客户端服务，都可能因为 Cloudflare 的网络中断而直接“打不开网页”或“访问延迟严重”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b000b17a303646ffaabffd5bc84a5582~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pGG54OC5bel56iL5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764074295&amp;x-signature=6AukcRAnkk99%2FoYRct664oYMpMQ%3D" alt="" loading="lazy"/></p>
<p>这提醒我们两个现实：</p>
<ol>
<li><strong>互联网依赖度极高</strong>。我们平时并不觉得连接了多少“中介服务”，但其实你访问的某个网站，背后很可能借助了 Cloudflare 这样的“隐形网络服务商”。当它出问题，你我都中招。</li>
<li><strong>风险并非只在“黑客”或“攻击”层面</strong>。很多时候，出问题的是基础网络设施、节点故障、数据中心切换、配置误操作……不是谁“故意”要让你上不了网，而是“链条”中某一环出了状况。</li>
</ol>
<p>那么，对普通用户来说，遇到这种情况怎么办？简单三步：</p>
<ul>
<li>放松——不是你的设备、不是你犯错了，只是他们的服务暂时“挂了”。</li>
<li>刷新状态页面、社交公告。Cloudflare 官方在其状态页已说明：他们“意识到问题，正在调查并缓解中”。</li>
<li>耐心等待。此类基础服务恢复可能需要几分钟也可能更久。若你的网站也挂了，建议先做降级处理或通知用户“正在恢复中”。</li>
</ul>
<p>最后，作为网站运营者或内容创造者，也建议从今天这个事件里学到一点：<strong>依赖越深，风险越集中</strong>。即便使用云服务、CDN加速、防火墙保护，也不应忽视备用方案、冗余部署、用户提示机制。因为当“枢纽”失效，你依赖它的一切就可能“掉链子”。</p>
<p><strong>目前大部分服务都恢复了～ 如果你的服务还没有恢复，可能是地域性的问题，出去散散步，回来之后差不多就恢复了。</strong></p>
<p>总之，今天互联网“肠道”里出现一个短暂的“堵塞”，提醒我们：在这个看似“无处不在”的网络时代，也正是依赖与隐患并存。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[API无缝升级方案：从推模式到拉模式的架构演进]]></title>    <link>https://juejin.cn/post/7573900332636880906</link>    <guid>https://juejin.cn/post/7573900332636880906</guid>    <pubDate>2025-11-18T12:34:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573900332636880906" data-draft-id="7573890735578841098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="API无缝升级方案：从推模式到拉模式的架构演进"/> <meta itemprop="keywords" content="后端,GraphQL,RESTful"/> <meta itemprop="datePublished" content="2025-11-18T12:34:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            API无缝升级方案：从推模式到拉模式的架构演进
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T12:34:25.000Z" title="Tue Nov 18 2025 12:34:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>知乎上有人问了一个问题：<strong>Java微服务API版本兼容如何实现平滑升级</strong>？</p>
<p>在微服务架构中，服务频繁迭代导致API版本差异增大，而客户端（如App、Web前端）的升级节奏往往滞后，这常常引发兼容性问题，甚至导致线上故障。常见的版本控制策略，比如在URL路径中加版本号（<code>/v1/user</code>）或使用请求头区分版本，虽然能明确区分不同版本，但也带来了维护多个版本接口的沉重成本，并增加了客户端的适配难度。</p>
<p>本文将分析这一问题的根源所在，并介绍 <strong>NopGraphQL 框架如何创新地解决这一问题</strong>。</p>
<h2 data-id="heading-0">1. 问题根源：推模式导致的共变问题</h2>
<p>REST 本质上是“推模式”，在理论层面必然导致<strong>共变问题</strong>。
REST API 的设计范式是由服务端预先定义每个端点返回的完整数据结构（DTO）。客户端被动接收这些数据，无法控制内容粒度。这种“服务端推送、客户端全盘接受”的模型，在信息论上属于 <strong>封闭输出系统</strong>。</p>
<p>一旦服务端对返回结构做出变更——无论是新增字段、修改嵌套结构，还是调整字段语义——所有消费该接口的客户端都必须同步适配。这就形成了典型的 <strong>共变耦合</strong>（covariance coupling）：服务端和客户端被迫在版本上强绑定，违背了微服务“独立演进”的核心原则。</p>
<p>即使采用 URL 路径（<code>/v1/user</code>）或 Accept Header 等版本控制手段，也只是将耦合显式化，并未消除根本问题：<strong>每个版本仍是一个刚性、全量的数据契约</strong>，维护成本随版本数线性甚至指数增长。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// REST接口的刚性数据契约</span>
<span class="hljs-meta">@GetMapping("/api/v1/users/{id}")</span>
<span class="hljs-keyword">public</span> UserDTOV1 <span class="hljs-title function_">getUserV1</span><span class="hljs-params">()</span> {  <span class="hljs-comment">// 版本1的固定结构</span>
  <span class="hljs-keyword">return</span> userService.getUser();
}

<span class="hljs-meta">@GetMapping("/api/v2/users/{id}")</span>
<span class="hljs-keyword">public</span> UserDTOV2 <span class="hljs-title function_">getUserV2</span><span class="hljs-params">()</span> {  <span class="hljs-comment">// 版本2的固定结构</span>
  <span class="hljs-keyword">return</span> userService.getUser();
}
<span class="hljs-comment">// 每个版本都是完整的DTO，变更需要新接口</span>
</code></pre>
<p>更糟糕的是，当 <code>UserDTO</code> 被嵌入到多个不同 API 的响应中时（如订单详情、审批流、通知中心），它的任何变动都将引发<strong>涟漪效应</strong>，导致大量接口连锁修改，形成典型的“组合爆炸”。</p>
<h2 data-id="heading-1">2. 解决方案：反转信息流向，转向拉模式</h2>
<p>GraphQL 提出了一种颠覆性的思路：<strong>由客户端声明所需字段，服务端按需返回</strong>。这种“客户端驱动的拉取模型”天然支持 <strong>渐进式演进</strong>，其核心在于<strong>解耦了服务端信息完整性与客户端消费粒度之间的强绑定</strong>。</p>
<pre><code class="hljs language-graphql" lang="graphql"><span class="hljs-comment"># 2018年客户端 - 仅请求基础字段</span>
<span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  getUser<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment"># 2020年客户端 - 开始使用新增的安全字段</span>
<span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  getUser<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
    twoFactorEnabled  <span class="hljs-comment"># 新增字段，老客户端不受影响</span>
    lastLoginIp
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>

<span class="hljs-comment"># 2023年客户端 - 使用完整功能集</span>
<span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  getUser<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
    twoFactorEnabled
    lastLoginIp
    preferences <span class="hljs-punctuation">{</span>     <span class="hljs-comment"># 新增嵌套对象</span>
      theme
      language
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>在传统 REST 的“推模式”中，服务端必须为每个接口预定义一个固定的响应结构。这意味着：</p>
<ul>
<li>服务端和客户端对“什么是有效数据”的理解必须完全一致；</li>
<li>一旦服务端模型扩展（例如用户对象新增 <code>twoFactorEnabled</code> 字段），要么强行让所有客户端升级以处理新字段，要么维护多个版本的 DTO 和端点。</li>
</ul>
<p>而拉取模型彻底改变了这一范式：</p>
<ul>
<li><strong>服务端作为完整、权威的信息源，持续演进其领域模型</strong>；</li>
<li><strong>客户端则根据自身场景，仅拉取当前所需的字段子集</strong>。</li>
</ul>
<h3 data-id="heading-2">GraphQL 拉模式的核心优势：</h3>
<ul>
<li>新增字段对旧客户端不可见；</li>
<li>字段删除可通过废弃标记逐步下线；</li>
<li>嵌套查询避免多次往返，同时保持细粒度控制。</li>
</ul>
<p>然而，在现有 Java 微服务体系中全面切换到 GraphQL 协议面临显著障碍：</p>
<ul>
<li>需要重构网关、鉴权、限流、监控等基础设施；</li>
<li>客户端（尤其是移动端或第三方）需重写调用逻辑；</li>
<li>团队需掌握新语法、类型系统和性能调优模式；</li>
<li>与 gRPC、消息队列等其他通信方式难以统一。</li>
</ul>
<p>因此，尽管 GraphQL 思想先进，但<strong>协议绑定限制了其在存量系统中的落地效率</strong>。</p>
<h2 data-id="heading-3">3. 创新方案：NopGraphQL 的多协议通用框架</h2>
<p>NopGraphQL 的关键创新在于：<strong>将 GraphQL 从一种传输协议，升维为通用的信息操作引擎</strong>。它提取 GraphQL 的核心思想——“字段级动态选择”——并将其泛化为可跨协议复用的能力。</p>
<p>在 Nop 中，同一个服务函数可以同时暴露为：</p>
<ul>
<li>REST 接口（通过 <code>@selection=name,email</code> 查询参数）</li>
<li>GraphQL 查询</li>
<li>gRPC 方法</li>
<li>Kafka 消息处理器</li>
<li>批处理任务入口</li>
</ul>
<p>开发者只需编写一次业务逻辑：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@BizModel("NopAuthUser")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBizModel</span> {
    <span class="hljs-meta">@BizQuery</span>
    <span class="hljs-keyword">public</span> NopAuthUser <span class="hljs-title function_">getUser</span><span class="hljs-params">(
        <span class="hljs-meta">@Name("id")</span> String id,
        FieldSelectionBean selection  // 自动注入客户端字段选择信息
    )</span> {
        <span class="hljs-comment">// 同一业务逻辑，多协议复用</span>
        <span class="hljs-type">NopAuthUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> dao.getById(id);

        <span class="hljs-comment">// 可选：根据 selection 决定是否加载 expensive 字段</span>
        <span class="hljs-keyword">if</span> (selection != <span class="hljs-literal">null</span> &amp;&amp; selection.hasField(<span class="hljs-string">"totalOrders"</span>)) {
            user.setTotalOrders(orderDao.countByUserId(id));
        }

        <span class="hljs-keyword">return</span> user;
    }
}
</code></pre>
<p>即可通过多种协议调用。</p>
<h3 data-id="heading-4">GraphQL 协议调用：</h3>
<pre><code class="hljs language-graphql" lang="graphql"><span class="hljs-keyword">query</span> <span class="hljs-punctuation">{</span>
  NopAuthUser__get<span class="hljs-punctuation">(</span><span class="hljs-symbol">id</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"123"</span><span class="hljs-punctuation">)</span> <span class="hljs-punctuation">{</span>
    id
    name
    email
    roles <span class="hljs-punctuation">{</span>
      name
      permissions
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-5">REST 协议调用：</h3>
<pre><code class="hljs language-http" lang="http">GET /r/NopAuthUser__get?id=123&amp;@selection=id,name,email,roles{name,permissions}
</code></pre>
<p>NopGraphQL 通过统一的协议适配层，将不同协议的请求转换为标准化的内部表示：</p>
<pre><code class="hljs language-css" lang="css">GraphQL请求 → GraphQL适配器 → 统一服务调用引擎 → 业务函数
<span class="hljs-attribute">REST</span>请求   → <span class="hljs-attribute">REST</span>适配器    → 统一服务调用引擎 → 业务函数
gRPC请求   → gRPC适配器    → 统一服务调用引擎 → 业务函数
</code></pre>
<p>业务逻辑完全与协议解耦。开发者只需关注领域模型和字段加载逻辑，协议适配由框架自动完成。这使得团队可以在不改变现有调用链的前提下，<strong>渐进引入“拉模式”能力</strong>。</p>
<h2 data-id="heading-6">4. 核心机制：字段选择与默认策略</h2>
<p>NopGraphQL 在字段返回策略上做了精细化设计，对 GraphQL 进行了简化，并使其自然映射到 REST 协议。</p>
<ul>
<li>每个实体类型可定义一个默认字段集合 <code>F_defaults</code>（例如 <code>id, name, status</code>）；</li>
<li>当客户端未显式传入 <code>@selection</code> 时，自动返回 <code>F_defaults</code> 中的字段，行为等价于传统 REST，保障向后兼容；</li>
<li><strong>所有新增字段默认标记为 <code>lazy</code></strong>：除非客户端在 <code>@selection</code> 中明确请求，否则不会加载也不会返回；</li>
<li>客户端可通过 <code>...F_defaults</code> 语法快速继承默认字段集，并叠加新增字段。</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-http" lang="http">GET /r/NopAuthUser__get?id=123&amp;@selection=...F_defaults,avatarUrl,roles{name}
</code></pre>
<p>表示：“返回所有默认字段 + <code>avatarUrl</code> + <code>roles</code> 的 <code>name</code> 子字段”。</p>
<blockquote>
<p>💡 <strong>Lazy 字段的实现</strong>：在 XMeta 元模型中，字段可声明为 <code>&lt;prop name="avatarUrl" lazy="true"&gt;</code>，并且可以通过 <code>@BizLoader</code> 注解实现批量加载，避免 N+1 问题。</p>
</blockquote>
<p>这种方式既保留了 REST 的简单性，又赋予了 GraphQL 的灵活性。服务端可以自由扩展模型，而客户端按需消费，<strong>彻底解耦了 API 的演进节奏</strong>。</p>
<h3 data-id="heading-7">结语</h3>
<p>API 版本兼容的本质，不是管理多个版本，而是<strong>消除不必要的耦合</strong>。
NopGraphQL 通过将 GraphQL 的“拉取思想”从协议中剥离，并以 <code>@selection</code> + <code>F_defaults</code> + <code>lazy</code> 字段机制落地到多协议场景，为 Java 微服务提供了一条 <strong>低侵入、高兼容、易演进</strong> 的平滑升级路径。</p>
<p>未来，后端不应再是一堆僵化的 REST 端点，而应是一个<strong>活的信息空间</strong>——客户端可以像查询数据库一样，精确、安全、高效地从中拉取所需知识。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用LangSmith评估智能体]]></title>    <link>https://juejin.cn/post/7573679820632719395</link>    <guid>https://juejin.cn/post/7573679820632719395</guid>    <pubDate>2025-11-18T09:21:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573679820632719395" data-draft-id="7573670400153714740" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用LangSmith评估智能体"/> <meta itemprop="keywords" content="Agent,LangChain,Python"/> <meta itemprop="datePublished" content="2025-11-18T09:21:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="FreeCode"/> <meta itemprop="url" content="https://juejin.cn/user/1282499717900794"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用LangSmith评估智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1282499717900794/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    FreeCode
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:21:29.000Z" title="Tue Nov 18 2025 09:21:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#383838;font-size:15px;line-height:30px;letter-spacing:2px;word-break:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;scroll-behavior:smooth;background-image:linear-gradient(0deg,transparent 24%,rgba(201,195,195,.329) 25%,hsla(0,8%,80.4%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent),linear-gradient(90deg,transparent 24%,rgba(204,196,196,.226) 25%,hsla(0,4%,66.1%,.05) 26%,transparent 27%,transparent 74%,hsla(0,5.2%,81%,.185) 75%,rgba(180,176,176,.05) 76%,transparent 77%,transparent);background-color:#fff;background-size:50px 50px;padding-bottom:60px}.markdown-body ::selection{color:#fff;background-color:#a862ea}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin:24px 0 12px;color:#a862ea}.markdown-body h1{line-height:2;font-size:1.4em}.markdown-body h1~p:first-of-type:first-letter{color:#a862ea;float:left;font-size:2em;margin-right:.4em;font-weight:bolder}.markdown-body h2{font-size:1.2em}.markdown-body h3{font-size:1.1em}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;padding-left:.2em}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#a862ea}.markdown-body ol li.task-list-item,.markdown-body ul li.task-list-item{list-style:none}.markdown-body ol li.task-list-item ol,.markdown-body ol li.task-list-item ul,.markdown-body ul li.task-list-item ol,.markdown-body ul li.task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:10px}.markdown-body a,.markdown-body code,.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6,.markdown-body li,.markdown-body p{opacity:.85;vertical-align:baseline;transition:all .1s ease}.markdown-body a:hover,.markdown-body code:hover,.markdown-body h1:hover,.markdown-body h2:hover,.markdown-body h3:hover,.markdown-body h4:hover,.markdown-body h5:hover,.markdown-body h6:hover,.markdown-body li:hover,.markdown-body p:hover{opacity:1}.markdown-body a{display:inline-block;color:#a862ea;cursor:pointer;text-decoration:none;position:relative}.markdown-body a:after{content:"";position:absolute;width:98%;height:1px;bottom:0;left:0;transform:scaleX(0);background-color:#a862ea;transform-origin:bottom right;transition:transform .3s ease-in-out}.markdown-body a:hover:after{transform:scaleX(1);transform-origin:bottom left}.markdown-body a:active,.markdown-body a:link{color:#a862ea}.markdown-body img{max-width:100%;user-select:none;margin:1em 0;transition:transform .2s ease 0s;background-color:#f8f5ff;box-shadow:0 0 10px #e7daff}.markdown-body img:hover{opacity:1;box-shadow:0 0 20px #e7daff;transform:translateY(-1px)}.markdown-body blockquote{padding:.5em 1em;margin:12px 0;border-top-left-radius:2px;border-bottom-left-radius:2px;border-left:3px solid #a862ea;background-color:#f8f5ff}.markdown-body blockquote&gt;p{margin:0}.markdown-body .math{font-style:italic;margin:12px 0;padding:.5em 1em;background-color:#f8f5ff}.markdown-body .math&gt;p{margin:0}.markdown-body code{padding:2px .4em;overflow-x:auto;color:#a862ea;font-weight:700;word-break:break-word;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;background-color:#f8f5ff}.markdown-body pre{margin:2em 0}.markdown-body pre&gt;code{display:block;padding:1.5em;word-break:normal;font-size:.9em;font-style:normal;font-weight:400;font-family:Operator Mono,Consolas,Monaco,Menlo,monospace;line-height:18px;color:#383838;border-radius:2px;scroll-behavior:smooth;box-shadow:0 0 10px #e7daff}.markdown-body pre&gt;code:hover{box-shadow:0 0 20px #e7daff}.markdown-body pre&gt;code::-webkit-scrollbar{height:6px;background-color:#f8f5ff}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:#e7daff;border-bottom-left-radius:3px;border-bottom-right-radius:3px}.markdown-body hr{margin:2em 0;border-top:1px solid #a862ea}.markdown-body table{width:100%;font-size:12px;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{color:#a862ea;background:#f8f5ff}.markdown-body td,.markdown-body th{padding:.5em;border:1px solid #e7daff}.markdown-body tr{background-color:#f8f5ff}@media (max-width:720px){.markdown-body{font-size:12px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>评估（Evaluations）是衡量大模型（LLM）应用程序性能的一种量化方式。LLM 的行为可能存在不确定性，即便对提示词、模型或输入做出微小调整，也可能对结果产生显著影响。而评估能够提供一种结构化方法，帮助识别故障、对比版本，并构建更可靠的人工智能应用程序。</p>
<p>在LangSmith中执行评估需要三个关键组件：</p>
<ul>
<li>数据集（Dataset）：一组测试输入（可选包含预期输出）。</li>
<li>目标函数（Target function）：你希望测试的应用程序部分 —— 可能是使用新提示词的单次LLM调用、某个模块，或是整个工作流程。</li>
<li>评估器（Evaluators）：为目标函数的输出打分的函数。</li>
</ul>
<p>本文将使用LangSmith SDK带你完成一次基础评估（验证LLM 响应的正确性）。</p>
<h2 data-id="heading-0">准备</h2>
<ul>
<li>一个 LangSmith 账号：可在 smith.langchain.com 注册或登录。</li>
<li>一个 LangSmith API 密钥：请参考《创建 API 密钥指南》操作。</li>
<li>一个 OpenAI API 密钥：可在 OpenAI 控制台（dashboard）中生成</li>
</ul>
<h2 data-id="heading-1">安装依赖</h2>
<pre><code class="hljs language-bash" lang="bash">pip install -U langsmith openevals openai
</code></pre>
<h2 data-id="heading-2">设置环境变量</h2>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">export</span> LANGSMITH_TRACING=<span class="hljs-literal">true</span>
<span class="hljs-built_in">export</span> LANGSMITH_API_KEY=<span class="hljs-string">"&lt;your-langsmith-api-key&gt;"</span>
<span class="hljs-built_in">export</span> OPENAI_API_KEY=<span class="hljs-string">"&lt;your-openai-api-key&gt;"</span>
<span class="hljs-built_in">export</span> LANGSMITH_WORKSPACE_ID=<span class="hljs-string">"&lt;your-workspace-id&gt;"</span>
</code></pre>
<h2 data-id="heading-3">创建数据集</h2>
<p>创建一个文件并添加以下代码，代码将实现以下功能：</p>
<ul>
<li>导入 Client 以连接 LangSmith。</li>
<li>创建一个数据集。</li>
<li>定义示例输入和输出。</li>
<li>在 LangSmith 中关联输入输出对与该数据集，以便它们能在评估中使用。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># dataset.py</span>
<span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    client = Client()

    <span class="hljs-comment"># Programmatically create a dataset in LangSmith</span>
    dataset = client.create_dataset(
        dataset_name=<span class="hljs-string">"Sample dataset"</span>,
        description=<span class="hljs-string">"A sample dataset in LangSmith."</span>
    )

    <span class="hljs-comment"># Create examples</span>
    examples = [
        {
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"question"</span>: <span class="hljs-string">"Which country is Mount Kilimanjaro located in?"</span>},
            <span class="hljs-string">"outputs"</span>: {<span class="hljs-string">"answer"</span>: <span class="hljs-string">"Mount Kilimanjaro is located in Tanzania."</span>},
        },
        {
            <span class="hljs-string">"inputs"</span>: {<span class="hljs-string">"question"</span>: <span class="hljs-string">"What is Earth's lowest point?"</span>},
            <span class="hljs-string">"outputs"</span>: {<span class="hljs-string">"answer"</span>: <span class="hljs-string">"Earth's lowest point is The Dead Sea."</span>},
        },
    ]

    <span class="hljs-comment"># Add examples to the dataset</span>
    client.create_examples(dataset_id=dataset.<span class="hljs-built_in">id</span>, examples=examples)
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"Created dataset:"</span>, dataset.name)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<p>运行文件以创建数据集：</p>
<pre><code class="hljs language-bash" lang="bash">python dataset.py
</code></pre>
<h2 data-id="heading-4">创建目标函数</h2>
<p>定义一个包含待评估内容的目标函数（target function）。在本文中，将定义一个目标函数，该函数包含一次用于回答问题的大模型调用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># eval.py</span>
<span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client, wrappers
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI

<span class="hljs-comment"># Wrap the OpenAI client for LangSmith tracing</span>
openai_client = wrappers.wrap_openai(OpenAI())

<span class="hljs-comment"># Define the application logic you want to evaluate inside a target function</span>
<span class="hljs-comment"># The SDK will automatically send the inputs from the dataset to your target function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">target</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    response = openai_client.chat.completions.create(
        model=<span class="hljs-string">"gpt-5-mini"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Answer the following question accurately"</span>},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: inputs[<span class="hljs-string">"question"</span>]},
        ],
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"answer"</span>: response.choices[<span class="hljs-number">0</span>].message.content.strip()}
</code></pre>
<h2 data-id="heading-5">定义评估器</h2>
<p>在本步骤中，你需要告知LangSmith如何为应用程序生成的答案评分。从openevals中导入一个预构建的评估提示词（CORRECTNESS_PROMPT），以及一个辅助工具 —— 该工具会将其封装为 “以 LLM 作为评判者” 的评估器，此评估器将为应用程序的输出打分。
该评估器会对以下三类信息进行对比：
输入（inputs）：传入目标函数的内容（例如，问题文本）。
输出（outputs）：目标函数返回的内容（例如，模型生成的答案）。
参考输出（reference_outputs）：在创建数据集时，你为每个数据集示例附加的基准真值答案（即 “标准答案”）。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client, wrappers
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">from</span> openevals.llm <span class="hljs-keyword">import</span> create_llm_as_judge
<span class="hljs-keyword">from</span> openevals.prompts <span class="hljs-keyword">import</span> CORRECTNESS_PROMPT

<span class="hljs-comment"># Wrap the OpenAI client for LangSmith tracing</span>
openai_client = wrappers.wrap_openai(OpenAI())

<span class="hljs-comment"># Define the application logic you want to evaluate inside a target function</span>
<span class="hljs-comment"># The SDK will automatically send the inputs from the dataset to your target function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">target</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    response = openai_client.chat.completions.create(
        model=<span class="hljs-string">"gpt-5-mini"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Answer the following question accurately"</span>},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: inputs[<span class="hljs-string">"question"</span>]},
        ],
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"answer"</span>: response.choices[<span class="hljs-number">0</span>].message.content.strip()}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">correctness_evaluator</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span>, outputs: <span class="hljs-built_in">dict</span>, reference_outputs: <span class="hljs-built_in">dict</span></span>):
    evaluator = create_llm_as_judge(
        prompt=CORRECTNESS_PROMPT,
        model=<span class="hljs-string">"openai:o3-mini"</span>,
        feedback_key=<span class="hljs-string">"correctness"</span>,
    )
    <span class="hljs-keyword">return</span> evaluator(
        inputs=inputs,
        outputs=outputs,
        reference_outputs=reference_outputs
    )
</code></pre>
<h2 data-id="heading-6">运行评估实验</h2>
<p>若要运行评估实验，需调用 evaluate(...) 函数，该函数将执行以下操作：</p>
<ul>
<li>从数据集里提取示例数据。</li>
<li>将每个示例的输入传递至目标函数。</li>
<li>收集输出结果（即模型生成的答案）。</li>
<li>将输出结果与参考输出一同传递至评估器。</li>
<li>在LangSmith中以实验形式记录所有结果，以便你在界面（UI）中查看。</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> langsmith <span class="hljs-keyword">import</span> Client, wrappers
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">from</span> openevals.llm <span class="hljs-keyword">import</span> create_llm_as_judge
<span class="hljs-keyword">from</span> openevals.prompts <span class="hljs-keyword">import</span> CORRECTNESS_PROMPT

<span class="hljs-comment"># Wrap the OpenAI client for LangSmith tracing</span>
openai_client = wrappers.wrap_openai(OpenAI())

<span class="hljs-comment"># Define the application logic you want to evaluate inside a target function</span>
<span class="hljs-comment"># The SDK will automatically send the inputs from the dataset to your target function</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">target</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">dict</span>:
    response = openai_client.chat.completions.create(
        model=<span class="hljs-string">"gpt-5-mini"</span>,
        messages=[
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"Answer the following question accurately"</span>},
            {<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: inputs[<span class="hljs-string">"question"</span>]},
        ],
    )
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"answer"</span>: response.choices[<span class="hljs-number">0</span>].message.content.strip()}

<span class="hljs-keyword">def</span> <span class="hljs-title function_">correctness_evaluator</span>(<span class="hljs-params">inputs: <span class="hljs-built_in">dict</span>, outputs: <span class="hljs-built_in">dict</span>, reference_outputs: <span class="hljs-built_in">dict</span></span>):
    evaluator = create_llm_as_judge(
        prompt=CORRECTNESS_PROMPT,
        model=<span class="hljs-string">"openai:o3-mini"</span>,
        feedback_key=<span class="hljs-string">"correctness"</span>,
    )
    <span class="hljs-keyword">return</span> evaluator(
        inputs=inputs,
        outputs=outputs,
        reference_outputs=reference_outputs
    )

<span class="hljs-comment"># After running the evaluation, a link will be provided to view the results in langsmith</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    client = Client()
    experiment_results = client.evaluate(
        target,
        data=<span class="hljs-string">"Sample dataset"</span>,
        evaluators=[
            correctness_evaluator,
            <span class="hljs-comment"># can add multiple evaluators here</span>
        ],
        experiment_prefix=<span class="hljs-string">"first-eval-in-langsmith"</span>,
        max_concurrency=<span class="hljs-number">2</span>,
    )
    <span class="hljs-built_in">print</span>(experiment_results)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Go 入门实战：音乐专辑管理 API]]></title>    <link>https://juejin.cn/post/7573899782802587694</link>    <guid>https://juejin.cn/post/7573899782802587694</guid>    <pubDate>2025-11-18T10:11:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573899782802587694" data-draft-id="7573988811916148786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Go 入门实战：音乐专辑管理 API"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T10:11:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OlahOlah"/> <meta itemprop="url" content="https://juejin.cn/user/1576016232062667"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Go 入门实战：音乐专辑管理 API
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1576016232062667/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OlahOlah
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:11:17.000Z" title="Tue Nov 18 2025 10:11:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>作为 Go 新手，光看语法很难真正掌握编程。通过实践一个小项目，你可以同时了解 <strong>Go 基础语法、数据库操作和 Web 开发</strong>。</p>
<h2 data-id="heading-0">数据库设计</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> music_store;
USE music_store;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> albums (
    id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,
    title <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    artist <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">255</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
);

<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> albums (id, title, artist, price) <span class="hljs-keyword">VALUES</span>
(<span class="hljs-string">'1'</span>, <span class="hljs-string">'Blue Train'</span>, <span class="hljs-string">'John Coltrane'</span>, <span class="hljs-number">56.99</span>),
(<span class="hljs-string">'2'</span>, <span class="hljs-string">'Jeru'</span>, <span class="hljs-string">'Gerry Mulligan'</span>, <span class="hljs-number">17.99</span>),
(<span class="hljs-string">'3'</span>, <span class="hljs-string">'Sarah Vaughan and Clifford Brown'</span>, <span class="hljs-string">'Sarah Vaughan'</span>, <span class="hljs-number">39.99</span>);
</code></pre>
<h2 data-id="heading-1">代码示例</h2>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
	<span class="hljs-string">"fmt"</span>
	<span class="hljs-string">"net/http"</span>

	<span class="hljs-string">"github.com/gin-gonic/gin"</span>
	<span class="hljs-string">"gorm.io/driver/mysql"</span>
	<span class="hljs-string">"gorm.io/gorm"</span>
)

<span class="hljs-comment">// Album 定义音乐专辑的数据模型</span>
<span class="hljs-keyword">type</span> Album <span class="hljs-keyword">struct</span> {
	ID     <span class="hljs-type">string</span>  <span class="hljs-string">`json:"id" gorm:"primaryKey"`</span> <span class="hljs-comment">// 主键</span>
	Title  <span class="hljs-type">string</span>  <span class="hljs-string">`json:"title"`</span>                <span class="hljs-comment">// 专辑标题</span>
	Artist <span class="hljs-type">string</span>  <span class="hljs-string">`json:"artist"`</span>               <span class="hljs-comment">// 艺术家</span>
	Price  <span class="hljs-type">float64</span> <span class="hljs-string">`json:"price"`</span>                <span class="hljs-comment">// 价格</span>
}

<span class="hljs-keyword">var</span> db *gorm.DB
<span class="hljs-keyword">var</span> err <span class="hljs-type">error</span>

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">initDB</span><span class="hljs-params">()</span></span> {
	dsn := <span class="hljs-string">"root:123456@tcp(127.0.0.1:3306)/music_store"</span>
	db, err = gorm.Open(mysql.Open(dsn), &amp;gorm.Config{}) <span class="hljs-comment">// 连接数据库</span>
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		fmt.Println(<span class="hljs-string">"连接数据库失败:"</span>, err)
		<span class="hljs-built_in">panic</span>(<span class="hljs-string">"连接数据库失败"</span>)
	}
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
	initDB()                  <span class="hljs-comment">// 初始化数据库连接</span>
	router := gin.Default()   <span class="hljs-comment">// 创建 Gin 路由实例</span>

	<span class="hljs-comment">// 路由定义</span>
	router.GET(<span class="hljs-string">"/albums"</span>, getAlbums)        <span class="hljs-comment">// 获取所有专辑</span>
	router.GET(<span class="hljs-string">"/albums/:id"</span>, getAlbumByID) <span class="hljs-comment">// 根据 ID 获取专辑</span>
	router.POST(<span class="hljs-string">"/albums"</span>, postAlbum)       <span class="hljs-comment">// 创建新专辑</span>

	router.Run(<span class="hljs-string">"localhost:8080"</span>) <span class="hljs-comment">// 启动 HTTP 服务</span>
}

<span class="hljs-comment">// 获取所有专辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getAlbums</span><span class="hljs-params">(c *gin.Context)</span></span> {
	<span class="hljs-keyword">var</span> albums []Album
	db.Find(&amp;albums)                    <span class="hljs-comment">// 查询所有专辑</span>
	c.IndentedJSON(http.StatusOK, albums) <span class="hljs-comment">// 返回 JSON</span>
}

<span class="hljs-comment">// 根据 ID 获取专辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getAlbumByID</span><span class="hljs-params">(c *gin.Context)</span></span> {
	id := c.Param(<span class="hljs-string">"id"</span>)                 <span class="hljs-comment">// 获取 URL 参数</span>
	<span class="hljs-keyword">var</span> album Album
	db.First(&amp;album, <span class="hljs-string">"id = ?"</span>, id)      <span class="hljs-comment">// 查询指定 ID 的专辑</span>
	c.IndentedJSON(http.StatusOK, album) <span class="hljs-comment">// 返回 JSON</span>
}

<span class="hljs-comment">// 创建新专辑</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">postAlbum</span><span class="hljs-params">(c *gin.Context)</span></span> {
	<span class="hljs-keyword">var</span> newAlbum Album
	c.BindJSON(&amp;newAlbum)               <span class="hljs-comment">// 解析请求 JSON</span>
	db.Create(&amp;newAlbum)                <span class="hljs-comment">// 插入数据库</span>
	c.IndentedJSON(http.StatusCreated, newAlbum) <span class="hljs-comment">// 返回创建结果</span>
}
</code></pre>
<h2 data-id="heading-2">测试 API</h2>
<p>启动服务后，可使用 <code>curl</code> 测试接口：</p>
<ol>
<li>获取所有专辑：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:8080/albums
</code></pre>
<ol start="2">
<li>获取单个专辑：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:8080/albums/2
</code></pre>
<ol start="3">
<li>新增专辑：</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">curl -X POST http://localhost:8080/albums \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-d <span class="hljs-string">'{"id":"4","title":"New Album","artist":"New Artist","price":29.99}'</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【穿越Effective C++】条款21：必须返回对象时，别妄想返回其reference——对象返回的语义与效率平衡]]></title>    <link>https://juejin.cn/post/7573988811916214322</link>    <guid>https://juejin.cn/post/7573988811916214322</guid>    <pubDate>2025-11-18T10:15:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573988811916214322" data-draft-id="7573710392213815323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【穿越Effective C++】条款21：必须返回对象时，别妄想返回其reference——对象返回的语义与效率平衡"/> <meta itemprop="keywords" content="C++,面试"/> <meta itemprop="datePublished" content="2025-11-18T10:15:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="沐怡旸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【穿越Effective C++】条款21：必须返回对象时，别妄想返回其reference——对象返回的语义与效率平衡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    沐怡旸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:15:14.000Z" title="Tue Nov 18 2025 10:15:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这个条款揭示了C++函数返回语义的核心原则：当函数必须返回新对象时，应该直接返回值而非引用。试图返回局部对象的引用会导致悬空引用，而返回其他生命周期受控对象的引用则会带来接口复杂性和潜在错误。</p>
<hr/>
<h3 data-id="heading-0"><strong>思维导图：对象返回策略的完整体系</strong></h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b84346e6e9c148c0870ef9b038dfc2a7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065714&amp;x-signature=YZGfs79PEmf3a6L3b%2FBug7tJolE%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1"><strong>关键洞见与行动指南</strong></h3>
<h4 data-id="heading-2"><strong>必须遵守的核心原则：</strong></h4>
<ol>
<li><strong>绝不返回局部对象的引用</strong>：局部对象在函数结束时销毁，返回其引用必然导致悬空引用</li>
<li><strong>优先直接返回对象</strong>：依赖编译器的RVO和移动语义优化，而非手动返回引用</li>
<li><strong>明确所有权语义</strong>：返回值意味着所有权转移，引用意味着共享访问</li>
<li><strong>信任编译器优化</strong>：现代编译器能高效处理对象返回，无需手动优化</li>
</ol>
<h4 data-id="heading-3"><strong>现代C++开发建议：</strong></h4>
<ol>
<li><strong>利用移动语义</strong>：为资源管理类实现移动操作，使返回大对象变得廉价</li>
<li><strong>使用智能指针</strong>：当需要返回动态分配对象时，使用智能指针明确所有权</li>
<li><strong>依赖RVO/NRVO</strong>：直接返回局部对象，让编译器处理优化</li>
<li><strong>避免过度工程</strong>：简单的返回值通常比复杂的引用返回更优</li>
</ol>
<h4 data-id="heading-4"><strong>设计原则总结：</strong></h4>
<ol>
<li><strong>语义正确性原则</strong>：接口行为应该清晰明确，不依赖隐晦的生命周期假设</li>
<li><strong>简单性原则</strong>：最简单的解决方案往往是最正确和最高效的</li>
<li><strong>零开销抽象原则</strong>：在不牺牲性能的前提下提供清晰的抽象</li>
<li><strong>最小惊讶原则</strong>：返回值的行为应该符合用户的合理预期</li>
</ol>
<h4 data-id="heading-5"><strong>需要警惕的陷阱：</strong></h4>
<ol>
<li><strong>悬空引用陷阱</strong>：返回局部stack对象的引用</li>
<li><strong>内存泄漏陷阱</strong>：返回堆对象引用导致无法正确释放</li>
<li><strong>线程安全陷阱</strong>：返回静态对象引用在多线程环境中的竞争</li>
<li><strong>封装破坏陷阱</strong>：返回成员变量引用破坏类的封装性</li>
</ol>
<p><strong>最终建议：</strong> 将对象返回视为语言设计者已经优化过的常见操作。培养"值语义思维"——在需要返回新对象时，直接返回对象值，让编译器的RVO、移动语义和拷贝省略为你工作。只有在确实需要共享现有对象且其生命周期明确受控时，才考虑返回引用。</p>
<p>记住：<strong>在C++中，返回对象值通常是安全、清晰且高效的。试图通过返回引用来优化往往适得其反，引入复杂性和错误。</strong> 条款21教会我们的不仅是一种技术选择，更是对C++对象模型和编译器能力的深刻信任。</p>
<hr/>
<h3 data-id="heading-6"><strong>深入解析：返回引用的致命陷阱</strong></h3>
<h4 data-id="heading-7"><strong>1. 问题根源：悬空引用的必然性</strong></h4>
<p><strong>返回局部对象引用的经典错误：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ExpensiveResource</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-type">const</span> std::string&amp; name) : <span class="hljs-built_in">name_</span>(name) {
        data_.<span class="hljs-built_in">resize</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">42</span>);  <span class="hljs-comment">// 模拟昂贵资源</span>
        std::cout &lt;&lt; <span class="hljs-string">"构造 ExpensiveResource: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    ~<span class="hljs-built_in">ExpensiveResource</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"析构 ExpensiveResource: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-type">const</span> ExpensiveResource&amp; other) 
        : <span class="hljs-built_in">name_</span>(other.name_ + <span class="hljs-string">"(拷贝)"</span>), <span class="hljs-built_in">data_</span>(other.data_) {
        std::cout &lt;&lt; <span class="hljs-string">"拷贝构造: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">ExpensiveResource</span>(ExpensiveResource&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">name_</span>(std::<span class="hljs-built_in">move</span>(other.name_)), <span class="hljs-built_in">data_</span>(std::<span class="hljs-built_in">move</span>(other.data_)) {
        std::cout &lt;&lt; <span class="hljs-string">"移动构造: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"使用资源: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
<span class="hljs-keyword">private</span>:
    std::string name_;
    std::vector&lt;<span class="hljs-type">int</span>&gt; data_;
};

<span class="hljs-comment">// 错误示例1：返回局部对象的引用</span>
<span class="hljs-function"><span class="hljs-type">const</span> ExpensiveResource&amp; <span class="hljs-title">createResourceWrong1</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function">ExpensiveResource <span class="hljs-title">local</span><span class="hljs-params">(<span class="hljs-string">"局部资源"</span>)</span></span>;
    <span class="hljs-keyword">return</span> local;  <span class="hljs-comment">// 致命错误：返回局部对象的引用！</span>
}

<span class="hljs-comment">// 错误示例2：返回临时对象的引用  </span>
<span class="hljs-function"><span class="hljs-type">const</span> ExpensiveResource&amp; <span class="hljs-title">createResourceWrong2</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"临时资源"</span>);  <span class="hljs-comment">// 更糟：返回临时对象的引用！</span>
}

<span class="hljs-comment">// 错误示例3：返回动态分配对象的引用</span>
<span class="hljs-function"><span class="hljs-type">const</span> ExpensiveResource&amp; <span class="hljs-title">createResourceWrong3</span><span class="hljs-params">()</span> </span>{
    ExpensiveResource* resource = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"堆资源"</span>);
    <span class="hljs-keyword">return</span> *resource;  <span class="hljs-comment">// 内存泄漏！调用者不知道需要delete</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_dangling_references</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 演示悬空引用问题 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：局部对象引用</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. 返回局部对象引用:"</span> &lt;&lt; std::endl;
    <span class="hljs-type">const</span> ExpensiveResource&amp; ref1 = <span class="hljs-built_in">createResourceWrong1</span>();
    <span class="hljs-comment">// 此时local已销毁，ref1是悬空引用！</span>
    <span class="hljs-comment">// ref1.use();  // 未定义行为！可能崩溃或输出乱码</span>
    
    <span class="hljs-comment">// 情况2：临时对象引用</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. 返回临时对象引用:"</span> &lt;&lt; std::endl;
    <span class="hljs-type">const</span> ExpensiveResource&amp; ref2 = <span class="hljs-built_in">createResourceWrong2</span>();
    <span class="hljs-comment">// 临时对象立即销毁，ref2是悬空引用！</span>
    <span class="hljs-comment">// ref2.use();  // 未定义行为！</span>
    
    <span class="hljs-comment">// 情况3：堆对象引用泄漏</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 返回堆对象引用:"</span> &lt;&lt; std::endl;
    <span class="hljs-type">const</span> ExpensiveResource&amp; ref3 = <span class="hljs-built_in">createResourceWrong3</span>();
    ref3.<span class="hljs-built_in">use</span>();  <span class="hljs-comment">// 虽然能工作，但内存泄漏！</span>
    <span class="hljs-comment">// 调用者不知道需要delete，也无法正确delete（没有原始指针）</span>
    <span class="hljs-comment">// delete &amp;ref3;  // 可能工作，但接口设计糟糕</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 悬空引用演示结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-8"><strong>2. 静态对象引用的线程安全问题</strong></h4>
<p><strong>返回静态对象引用的陷阱：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;mutex&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Configuration</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Configuration</span>(<span class="hljs-type">const</span> std::string&amp; name) : <span class="hljs-built_in">name_</span>(name) {
        std::cout &lt;&lt; <span class="hljs-string">"初始化配置: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
        data_ = std::<span class="hljs-built_in">vector</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">100</span>, <span class="hljs-number">1</span>);
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"使用配置: "</span> &lt;&lt; name_ &lt;&lt; <span class="hljs-string">" (数据大小: "</span> &lt;&lt; data_.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">modify</span><span class="hljs-params">()</span> </span>{
        data_.<span class="hljs-built_in">push_back</span>(<span class="hljs-number">42</span>);  <span class="hljs-comment">// 修改内部状态</span>
        std::cout &lt;&lt; <span class="hljs-string">"修改配置: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
<span class="hljs-keyword">private</span>:
    std::string name_;
    std::vector&lt;<span class="hljs-type">int</span>&gt; data_;
};

<span class="hljs-comment">// 危险的单例模式实现</span>
<span class="hljs-function"><span class="hljs-type">const</span> Configuration&amp; <span class="hljs-title">getGlobalConfig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function"><span class="hljs-type">static</span> Configuration <span class="hljs-title">config</span><span class="hljs-params">(<span class="hljs-string">"全局配置"</span>)</span></span>;  <span class="hljs-comment">// 第一次调用时构造</span>
    <span class="hljs-keyword">return</span> config;
}

<span class="hljs-comment">// 线程安全的单例模式</span>
<span class="hljs-function">Configuration&amp; <span class="hljs-title">getThreadSafeConfig</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-function"><span class="hljs-type">static</span> Configuration <span class="hljs-title">config</span><span class="hljs-params">(<span class="hljs-string">"线程安全配置"</span>)</span></span>;
    <span class="hljs-keyword">return</span> config;
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_static_reference_issues</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 静态对象引用问题 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 单线程下看似正常工作</span>
    <span class="hljs-type">const</span> Configuration&amp; config1 = <span class="hljs-built_in">getGlobalConfig</span>();
    config1.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-type">const</span> Configuration&amp; config2 = <span class="hljs-built_in">getGlobalConfig</span>();
    config2.<span class="hljs-built_in">use</span>();  <span class="hljs-comment">// 同一个对象</span>
    
    <span class="hljs-comment">// 多线程环境下的问题</span>
    <span class="hljs-keyword">auto</span> worker = [](<span class="hljs-type">int</span> id) {
        std::this_thread::<span class="hljs-built_in">sleep_for</span>(std::chrono::<span class="hljs-built_in">milliseconds</span>(<span class="hljs-number">100</span>));
        Configuration&amp; config = <span class="hljs-built_in">getThreadSafeConfig</span>();  <span class="hljs-comment">// 注意：返回非const引用！</span>
        config.<span class="hljs-built_in">modify</span>();  <span class="hljs-comment">// 多个线程可能同时修改！</span>
        std::cout &lt;&lt; <span class="hljs-string">"线程 "</span> &lt;&lt; id &lt;&lt; <span class="hljs-string">" 修改配置"</span> &lt;&lt; std::endl;
    };
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 多线程竞争演示 ==="</span> &lt;&lt; std::endl;
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">(worker, <span class="hljs-number">1</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">(worker, <span class="hljs-number">2</span>)</span></span>;
    <span class="hljs-function">std::thread <span class="hljs-title">t3</span><span class="hljs-params">(worker, <span class="hljs-number">3</span>)</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    t3.<span class="hljs-built_in">join</span>();
    
    <span class="hljs-comment">// 数据竞争！未定义行为！</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>解决方案：正确返回对象</strong></h3>
<h4 data-id="heading-10"><strong>1. 直接返回对象值 + 编译器优化</strong></h4>
<p><strong>依赖RVO和移动语义的正确方式：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedReturn</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 正确方式1：返回匿名临时对象 - RVO优化</span>
    <span class="hljs-function"><span class="hljs-type">static</span> ExpensiveResource <span class="hljs-title">createWithRVO</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"RVO优化"</span>);  <span class="hljs-comment">// 直接构造到调用者位置</span>
    }
    
    <span class="hljs-comment">// 正确方式2：返回具名局部对象 - NRVO优化</span>
    <span class="hljs-function"><span class="hljs-type">static</span> ExpensiveResource <span class="hljs-title">createWithNRVO</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">ExpensiveResource <span class="hljs-title">local</span><span class="hljs-params">(<span class="hljs-string">"NRVO优化"</span>)</span></span>;
        <span class="hljs-comment">// 一些处理...</span>
        local.<span class="hljs-built_in">use</span>();
        <span class="hljs-keyword">return</span> local;  <span class="hljs-comment">// 编译器可能直接构造到调用者位置</span>
    }
    
    <span class="hljs-comment">// 正确方式3：多路径返回 - 仍然可能优化</span>
    <span class="hljs-function"><span class="hljs-type">static</span> ExpensiveResource <span class="hljs-title">createWithMultiplePaths</span><span class="hljs-params">(<span class="hljs-type">int</span> type)</span> </span>{
        <span class="hljs-keyword">if</span> (type == <span class="hljs-number">1</span>) {
            <span class="hljs-function">ExpensiveResource <span class="hljs-title">resource</span><span class="hljs-params">(<span class="hljs-string">"类型1"</span>)</span></span>;
            <span class="hljs-keyword">return</span> resource;  <span class="hljs-comment">// NRVO可能仍然工作</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">ExpensiveResource</span>(<span class="hljs-string">"类型2"</span>);  <span class="hljs-comment">// RVO</span>
        }
    }
    
    <span class="hljs-comment">// 正确方式4：返回移动语义优化的对象</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::vector&lt;std::string&gt; <span class="hljs-title">createStrings</span><span class="hljs-params">()</span> </span>{
        std::vector&lt;std::string&gt; strings;
        strings.<span class="hljs-built_in">reserve</span>(<span class="hljs-number">100</span>);
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; ++i) {
            strings.<span class="hljs-built_in">push_back</span>(<span class="hljs-string">"字符串_"</span> + std::<span class="hljs-built_in">to_string</span>(i));
        }
        
        <span class="hljs-keyword">return</span> strings;  <span class="hljs-comment">// 移动语义或NRVO</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_correct_object_return</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 正确返回对象演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：RVO优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. RVO优化返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> resource1 = OptimizedReturn::<span class="hljs-built_in">createWithRVO</span>();
    resource1.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况2：NRVO优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. NRVO优化返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> resource2 = OptimizedReturn::<span class="hljs-built_in">createWithNRVO</span>();
    resource2.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况3：多路径返回</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 多路径返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> resource3 = OptimizedReturn::<span class="hljs-built_in">createWithMultiplePaths</span>(<span class="hljs-number">1</span>);
    resource3.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况4：移动语义优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"4. 移动语义优化:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> strings = OptimizedReturn::<span class="hljs-built_in">createStrings</span>();
    std::cout &lt;&lt; <span class="hljs-string">"创建字符串数量: "</span> &lt;&lt; strings.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 正确返回演示结束 ==="</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// 测试编译器优化</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">test_compiler_optimizations</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"\n=== 编译器优化验证 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 观察构造/析构调用，验证优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"创建资源..."</span> &lt;&lt; std::endl;
    ExpensiveResource res = OptimizedReturn::<span class="hljs-built_in">createWithRVO</span>();
    std::cout &lt;&lt; <span class="hljs-string">"资源使用中..."</span> &lt;&lt; std::endl;
    res.<span class="hljs-built_in">use</span>();
    std::cout &lt;&lt; <span class="hljs-string">"资源即将销毁..."</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-11"><strong>2. 移动语义的革命性影响</strong></h4>
<p><strong>移动语义使返回大对象变得廉价：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">MoveOptimized</span> {
<span class="hljs-keyword">private</span>:
    std::vector&lt;<span class="hljs-type">int</span>&gt; data_;
    std::string name_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">MoveOptimized</span>(<span class="hljs-type">const</span> std::string&amp; name, <span class="hljs-type">size_t</span> size) 
        : <span class="hljs-built_in">name_</span>(name), <span class="hljs-built_in">data_</span>(size, <span class="hljs-number">42</span>) {
        std::cout &lt;&lt; <span class="hljs-string">"构造 "</span> &lt;&lt; name_ &lt;&lt; <span class="hljs-string">" (大小: "</span> &lt;&lt; data_.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 移动构造函数 - 关键！</span>
    <span class="hljs-built_in">MoveOptimized</span>(MoveOptimized&amp;&amp; other) <span class="hljs-keyword">noexcept</span> 
        : <span class="hljs-built_in">name_</span>(std::<span class="hljs-built_in">move</span>(other.name_))
        , <span class="hljs-built_in">data_</span>(std::<span class="hljs-built_in">move</span>(other.data_)) {
        std::cout &lt;&lt; <span class="hljs-string">"移动构造 "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 移动赋值运算符</span>
    MoveOptimized&amp; <span class="hljs-keyword">operator</span>=(MoveOptimized&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span> != &amp;other) {
            name_ = std::<span class="hljs-built_in">move</span>(other.name_);
            data_ = std::<span class="hljs-built_in">move</span>(other.data_);
            std::cout &lt;&lt; <span class="hljs-string">"移动赋值 "</span> &lt;&lt; name_ &lt;&lt; std::endl;
        }
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// 拷贝控制：禁止拷贝（或实现深拷贝）</span>
    <span class="hljs-built_in">MoveOptimized</span>(<span class="hljs-type">const</span> MoveOptimized&amp;) = <span class="hljs-keyword">delete</span>;
    MoveOptimized&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> MoveOptimized&amp;) = <span class="hljs-keyword">delete</span>;
    
    ~<span class="hljs-built_in">MoveOptimized</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"析构 "</span> &lt;&lt; name_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"使用 "</span> &lt;&lt; name_ &lt;&lt; <span class="hljs-string">" (数据: "</span> &lt;&lt; data_.<span class="hljs-built_in">size</span>() &lt;&lt; <span class="hljs-string">" 元素)"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// 工厂方法 - 高效返回</span>
    <span class="hljs-function"><span class="hljs-type">static</span> MoveOptimized <span class="hljs-title">createLargeObject</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; name)</span> </span>{
        <span class="hljs-function">MoveOptimized <span class="hljs-title">obj</span><span class="hljs-params">(name, <span class="hljs-number">1000000</span>)</span></span>;  <span class="hljs-comment">// 百万元素！</span>
        <span class="hljs-comment">// 一些处理...</span>
        <span class="hljs-keyword">return</span> obj;  <span class="hljs-comment">// NRVO或移动语义</span>
    }
    
    <span class="hljs-comment">// 返回处理后的对象</span>
    <span class="hljs-function">MoveOptimized <span class="hljs-title">process</span><span class="hljs-params">()</span> &amp;&amp; </span>{  <span class="hljs-comment">// 右值引用限定符</span>
        std::cout &lt;&lt; <span class="hljs-string">"处理右值对象: "</span> &lt;&lt; name_ &lt;&lt; std::endl;
        std::<span class="hljs-built_in">transform</span>(data_.<span class="hljs-built_in">begin</span>(), data_.<span class="hljs-built_in">end</span>(), data_.<span class="hljs-built_in">begin</span>(),
                      [](<span class="hljs-type">int</span> x) { <span class="hljs-keyword">return</span> x * <span class="hljs-number">2</span>; });
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(*<span class="hljs-keyword">this</span>);  <span class="hljs-comment">// 显式移动</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_move_semantics</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 移动语义演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：移动构造优化</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. 工厂方法返回:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj1 = MoveOptimized::<span class="hljs-built_in">createLargeObject</span>(<span class="hljs-string">"大对象1"</span>);
    obj1.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况2：链式移动操作</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. 链式处理:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj2 = MoveOptimized::<span class="hljs-built_in">createLargeObject</span>(<span class="hljs-string">"大对象2"</span>).<span class="hljs-built_in">process</span>();
    obj2.<span class="hljs-built_in">use</span>();
    
    <span class="hljs-comment">// 情况3：容器中的移动</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 容器存储:"</span> &lt;&lt; std::endl;
    std::vector&lt;MoveOptimized&gt; objects;
    objects.<span class="hljs-built_in">reserve</span>(<span class="hljs-number">3</span>);
    
    <span class="hljs-comment">// 使用emplace_back或移动插入</span>
    objects.<span class="hljs-built_in">push_back</span>(MoveOptimized::<span class="hljs-built_in">createLargeObject</span>(<span class="hljs-string">"容器对象1"</span>));
    objects.<span class="hljs-built_in">emplace_back</span>(<span class="hljs-string">"容器对象2"</span>, <span class="hljs-number">500000</span>);  <span class="hljs-comment">// 原位构造</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"容器大小: "</span> &lt;&lt; objects.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 移动语义演示结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>智能指针的正确使用</strong></h3>
<h4 data-id="heading-13"><strong>1. 工厂模式与所有权转移</strong></h4>
<p><strong>明确所有权的智能指针返回：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdexcept&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PolymorphicBase</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">PolymorphicBase</span>() = <span class="hljs-keyword">default</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteA</span> : <span class="hljs-keyword">public</span> PolymorphicBase {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ConcreteA</span>() { std::cout &lt;&lt; <span class="hljs-string">"构造 ConcreteA"</span> &lt;&lt; std::endl; }
    ~<span class="hljs-built_in">ConcreteA</span>() <span class="hljs-keyword">override</span> { std::cout &lt;&lt; <span class="hljs-string">"析构 ConcreteA"</span> &lt;&lt; std::endl; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"ConcreteA::execute"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-function">std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteA&gt;(*<span class="hljs-keyword">this</span>);
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConcreteB</span> : <span class="hljs-keyword">public</span> PolymorphicBase {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">ConcreteB</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> : value_(value) {</span>
        std::cout &lt;&lt; <span class="hljs-string">"构造 ConcreteB: "</span> &lt;&lt; value_ &lt;&lt; std::endl;
    }
    ~<span class="hljs-built_in">ConcreteB</span>() <span class="hljs-keyword">override</span> { std::cout &lt;&lt; <span class="hljs-string">"析构 ConcreteB"</span> &lt;&lt; std::endl; }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"ConcreteB::execute: "</span> &lt;&lt; value_ &lt;&lt; std::endl;
    }
    
    <span class="hljs-function">std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">override</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(*<span class="hljs-keyword">this</span>);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> value_;
};

<span class="hljs-comment">// 正确的工厂模式实现</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectFactory</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 返回unique_ptr - 明确所有权转移</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::unique_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">createObject</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; type)</span> </span>{
        <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"A"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteA&gt;();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"B"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(<span class="hljs-number">42</span>);
        }
        <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"未知类型: "</span> + type);
    }
    
    <span class="hljs-comment">// 返回shared_ptr - 共享所有权</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::shared_ptr&lt;PolymorphicBase&gt; <span class="hljs-title">createSharedObject</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; type)</span> </span>{
        <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"A"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;ConcreteA&gt;();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"B"</span>) {
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;ConcreteB&gt;(<span class="hljs-number">100</span>);
        }
        <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"未知类型: "</span> + type);
    }
    
    <span class="hljs-comment">// 返回unique_ptr的容器</span>
    <span class="hljs-type">static</span> std::vector&lt;std::unique_ptr&lt;PolymorphicBase&gt;&gt; <span class="hljs-built_in">createObjectCollection</span>() {
        std::vector&lt;std::unique_ptr&lt;PolymorphicBase&gt;&gt; objects;
        objects.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteA&gt;());
        objects.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(<span class="hljs-number">1</span>));
        objects.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;ConcreteB&gt;(<span class="hljs-number">2</span>));
        <span class="hljs-keyword">return</span> objects;  <span class="hljs-comment">// 移动语义！</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_smart_pointer_factory</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 智能指针工厂演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况1：unique_ptr工厂</span>
    std::cout &lt;&lt; <span class="hljs-string">"1. unique_ptr工厂:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj1 = ObjectFactory::<span class="hljs-built_in">createObject</span>(<span class="hljs-string">"A"</span>);
    obj1-&gt;<span class="hljs-built_in">execute</span>();
    
    <span class="hljs-keyword">auto</span> obj2 = ObjectFactory::<span class="hljs-built_in">createObject</span>(<span class="hljs-string">"B"</span>);
    obj2-&gt;<span class="hljs-built_in">execute</span>();
    
    <span class="hljs-comment">// 情况2：shared_ptr工厂</span>
    std::cout &lt;&lt; <span class="hljs-string">"2. shared_ptr工厂:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> shared1 = ObjectFactory::<span class="hljs-built_in">createSharedObject</span>(<span class="hljs-string">"A"</span>);
    <span class="hljs-keyword">auto</span> shared2 = shared1;  <span class="hljs-comment">// 共享所有权</span>
    shared1-&gt;<span class="hljs-built_in">execute</span>();
    shared2-&gt;<span class="hljs-built_in">execute</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"共享引用计数: "</span> &lt;&lt; shared1.<span class="hljs-built_in">use_count</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 情况3：对象集合</span>
    std::cout &lt;&lt; <span class="hljs-string">"3. 对象集合:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> collection = ObjectFactory::<span class="hljs-built_in">createObjectCollection</span>();
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; obj : collection) {
        obj-&gt;<span class="hljs-built_in">execute</span>();
    }
    
    <span class="hljs-comment">// 情况4：克隆模式</span>
    std::cout &lt;&lt; <span class="hljs-string">"4. 克隆模式:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> original = ObjectFactory::<span class="hljs-built_in">createObject</span>(<span class="hljs-string">"A"</span>);
    <span class="hljs-keyword">auto</span> cloned = original-&gt;<span class="hljs-built_in">clone</span>();
    original-&gt;<span class="hljs-built_in">execute</span>();
    cloned-&gt;<span class="hljs-built_in">execute</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 智能指针工厂结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-14"><strong>2. 构建器模式的流畅接口</strong></h4>
<p><strong>返回*this引用的正确使用场景：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sstream&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span>;  <span class="hljs-comment">// 前向声明</span>
    
    <span class="hljs-comment">// 只能通过Builder构造</span>
    <span class="hljs-function"><span class="hljs-type">static</span> Builder <span class="hljs-title">create</span><span class="hljs-params">()</span> </span>{ <span class="hljs-keyword">return</span> <span class="hljs-built_in">Builder</span>(); }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"连接到: "</span> &lt;&lt; host_ &lt;&lt; <span class="hljs-string">":"</span> &lt;&lt; port_ 
                  &lt;&lt; <span class="hljs-string">" 用户: "</span> &lt;&lt; username_ &lt;&lt; std::endl;
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-built_in">DatabaseConnection</span>() = <span class="hljs-keyword">default</span>;
    
    std::string host_;
    <span class="hljs-type">int</span> port_ = <span class="hljs-number">3306</span>;
    std::string username_;
    std::string password_;
    <span class="hljs-type">int</span> timeout_ = <span class="hljs-number">30</span>;
    
    <span class="hljs-keyword">friend</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span>::Builder {
<span class="hljs-keyword">private</span>:
    std::unique_ptr&lt;DatabaseConnection&gt; connection_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Builder</span>() : <span class="hljs-built_in">connection_</span>(std::<span class="hljs-built_in">make_unique</span>&lt;DatabaseConnection&gt;()) {}
    
    <span class="hljs-comment">// 流畅接口 - 返回Builder&amp;引用</span>
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setHost</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; host)</span> </span>{
        connection_-&gt;host_ = host;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setPort</span><span class="hljs-params">(<span class="hljs-type">int</span> port)</span> </span>{
        <span class="hljs-keyword">if</span> (port &lt;= <span class="hljs-number">0</span> || port &gt; <span class="hljs-number">65535</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"端口无效"</span>);
        }
        connection_-&gt;port_ = port;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setCredentials</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; username, <span class="hljs-type">const</span> std::string&amp; password)</span> </span>{
        connection_-&gt;username_ = username;
        connection_-&gt;password_ = password;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-function">Builder&amp; <span class="hljs-title">setTimeout</span><span class="hljs-params">(<span class="hljs-type">int</span> timeout)</span> </span>{
        <span class="hljs-keyword">if</span> (timeout &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">invalid_argument</span>(<span class="hljs-string">"超时无效"</span>);
        }
        connection_-&gt;timeout_ = timeout;
        <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>;
    }
    
    <span class="hljs-comment">// 关键：返回unique_ptr，明确所有权转移</span>
    <span class="hljs-function">std::unique_ptr&lt;DatabaseConnection&gt; <span class="hljs-title">build</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-comment">// 验证必填参数</span>
        <span class="hljs-keyword">if</span> (connection_-&gt;host_.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">logic_error</span>(<span class="hljs-string">"必须设置主机"</span>);
        }
        <span class="hljs-keyword">if</span> (connection_-&gt;username_.<span class="hljs-built_in">empty</span>()) {
            <span class="hljs-keyword">throw</span> std::<span class="hljs-built_in">logic_error</span>(<span class="hljs-string">"必须设置用户名"</span>);
        }
        
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(connection_);  <span class="hljs-comment">// 转移所有权</span>
    }
    
    <span class="hljs-comment">// 返回shared_ptr的版本</span>
    <span class="hljs-function">std::shared_ptr&lt;DatabaseConnection&gt; <span class="hljs-title">buildShared</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(connection_);  <span class="hljs-comment">// 从unique_ptr转换</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_builder_pattern</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 构建器模式演示 ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 流畅接口构建</span>
        <span class="hljs-keyword">auto</span> connection = DatabaseConnection::<span class="hljs-built_in">create</span>()
            .<span class="hljs-built_in">setHost</span>(<span class="hljs-string">"localhost"</span>)
            .<span class="hljs-built_in">setPort</span>(<span class="hljs-number">3306</span>)
            .<span class="hljs-built_in">setCredentials</span>(<span class="hljs-string">"admin"</span>, <span class="hljs-string">"secret"</span>)
            .<span class="hljs-built_in">setTimeout</span>(<span class="hljs-number">60</span>)
            .<span class="hljs-built_in">build</span>();  <span class="hljs-comment">// 返回unique_ptr</span>
        
        connection-&gt;<span class="hljs-built_in">connect</span>();
        
        <span class="hljs-comment">// shared_ptr版本</span>
        <span class="hljs-keyword">auto</span> shared_connection = DatabaseConnection::<span class="hljs-built_in">create</span>()
            .<span class="hljs-built_in">setHost</span>(<span class="hljs-string">"127.0.0.1"</span>)
            .<span class="hljs-built_in">setPort</span>(<span class="hljs-number">5432</span>)
            .<span class="hljs-built_in">setCredentials</span>(<span class="hljs-string">"user"</span>, <span class="hljs-string">"pass"</span>)
            .<span class="hljs-built_in">buildShared</span>();
        
        shared_connection-&gt;<span class="hljs-built_in">connect</span>();
        
    } <span class="hljs-built_in">catch</span> (<span class="hljs-type">const</span> std::exception&amp; e) {
        std::cout &lt;&lt; <span class="hljs-string">"构建错误: "</span> &lt;&lt; e.<span class="hljs-built_in">what</span>() &lt;&lt; std::endl;
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 构建器模式结束 ==="</span> &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-15"><strong>编译器优化的信任与验证</strong></h3>
<h4 data-id="heading-16"><strong>1. RVO/NRVO的实际验证</strong></h4>
<p><strong>测试编译器优化能力：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizationTest</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">OptimizationTest</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"默认构造"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">OptimizationTest</span>(<span class="hljs-type">const</span> OptimizationTest&amp; other) {
        std::cout &lt;&lt; <span class="hljs-string">"拷贝构造"</span> &lt;&lt; std::endl;
    }
    
    <span class="hljs-built_in">OptimizationTest</span>(OptimizationTest&amp;&amp; other) <span class="hljs-keyword">noexcept</span> {
        std::cout &lt;&lt; <span class="hljs-string">"移动构造"</span> &lt;&lt; std::endl;
    }
    
    ~<span class="hljs-built_in">OptimizationTest</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"析构"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-comment">// 测试各种返回场景</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizationDemonstrator</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 场景1：RVO - 返回匿名临时对象</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testRVO</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">OptimizationTest</span>();  <span class="hljs-comment">// 应该只有一次构造</span>
    }
    
    <span class="hljs-comment">// 场景2：NRVO - 返回具名局部对象</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testNRVO</span><span class="hljs-params">()</span> </span>{
        OptimizationTest local;
        <span class="hljs-keyword">return</span> local;  <span class="hljs-comment">// 应该只有一次构造</span>
    }
    
    <span class="hljs-comment">// 场景3：多路径返回</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testMultiplePaths</span><span class="hljs-params">(<span class="hljs-type">bool</span> flag)</span> </span>{
        <span class="hljs-keyword">if</span> (flag) {
            OptimizationTest local1;
            <span class="hljs-keyword">return</span> local1;  <span class="hljs-comment">// NRVO可能工作</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">OptimizationTest</span>();  <span class="hljs-comment">// RVO</span>
        }
    }
    
    <span class="hljs-comment">// 场景4：阻止NRVO - 使用std::move</span>
    <span class="hljs-function"><span class="hljs-type">static</span> OptimizationTest <span class="hljs-title">testBlockedNRVO</span><span class="hljs-params">()</span> </span>{
        OptimizationTest local;
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(local);  <span class="hljs-comment">// 阻止NRVO，强制移动构造</span>
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_optimization_verification</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 编译器优化验证 ==="</span> &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"1. RVO测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj1 = OptimizationDemonstrator::<span class="hljs-built_in">testRVO</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"2. NRVO测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj2 = OptimizationDemonstrator::<span class="hljs-built_in">testNRVO</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"3. 多路径测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj3 = OptimizationDemonstrator::<span class="hljs-built_in">testMultiplePaths</span>(<span class="hljs-literal">true</span>);
    
    std::cout &lt;&lt; <span class="hljs-string">"4. 阻止NRVO测试:"</span> &lt;&lt; std::endl;
    <span class="hljs-keyword">auto</span> obj4 = OptimizationDemonstrator::<span class="hljs-built_in">testBlockedNRVO</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 优化验证结束 ==="</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// 性能基准测试</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;chrono&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">PerformanceTest</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">static</span> std::vector&lt;<span class="hljs-type">int</span>&gt; <span class="hljs-title">createVectorByValue</span><span class="hljs-params">(<span class="hljs-type">size_t</span> size)</span> </span>{
        std::vector&lt;<span class="hljs-type">int</span>&gt; vec;
        vec.<span class="hljs-built_in">reserve</span>(size);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; size; ++i) {
            vec.<span class="hljs-built_in">push_back</span>(<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">int</span>&gt;(i));
        }
        <span class="hljs-keyword">return</span> vec;  <span class="hljs-comment">// NRVO或移动语义</span>
    }
    
    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">benchmark</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-type">const</span> <span class="hljs-type">size_t</span> size = <span class="hljs-number">1000000</span>;
        <span class="hljs-type">const</span> <span class="hljs-type">int</span> iterations = <span class="hljs-number">100</span>;
        
        std::cout &lt;&lt; <span class="hljs-string">"=== 性能基准测试 ==="</span> &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"向量大小: "</span> &lt;&lt; size &lt;&lt; <span class="hljs-string">", 迭代次数: "</span> &lt;&lt; iterations &lt;&lt; std::endl;
        
        <span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
        
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; iterations; ++i) {
            <span class="hljs-keyword">auto</span> vec = <span class="hljs-built_in">createVectorByValue</span>(size);
            <span class="hljs-comment">// 使用vec...</span>
            (<span class="hljs-type">void</span>)vec.<span class="hljs-built_in">size</span>();  <span class="hljs-comment">// 防止优化</span>
        }
        
        <span class="hljs-keyword">auto</span> end = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
        <span class="hljs-keyword">auto</span> duration = std::chrono::<span class="hljs-built_in">duration_cast</span>&lt;std::chrono::milliseconds&gt;(end - start);
        
        std::cout &lt;&lt; <span class="hljs-string">"总耗时: "</span> &lt;&lt; duration.<span class="hljs-built_in">count</span>() &lt;&lt; <span class="hljs-string">"ms"</span> &lt;&lt; std::endl;
        std::cout &lt;&lt; <span class="hljs-string">"平均每次: "</span> &lt;&lt; duration.<span class="hljs-built_in">count</span>() / <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">double</span>&gt;(iterations) &lt;&lt; <span class="hljs-string">"ms"</span> &lt;&lt; std::endl;
    }
};
</code></pre>
<hr/>
<h3 data-id="heading-17"><strong>现代C++的最佳实践总结</strong></h3>
<p><strong>最终决策框架与示例：</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ModernBestPractices</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 规则1：小型对象直接返回值</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">calculateSum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> a + b;  <span class="hljs-comment">// 内置类型直接返回</span>
    }
    
    <span class="hljs-comment">// 规则2：标准库容器依赖移动语义</span>
    <span class="hljs-function">std::vector&lt;std::string&gt; <span class="hljs-title">getStrings</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> {<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>, <span class="hljs-string">"modern"</span>, <span class="hljs-string">"C++"</span>};  <span class="hljs-comment">// 移动语义优化</span>
    }
    
    <span class="hljs-comment">// 规则3：自定义大对象实现移动语义</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">LargeData</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">LargeData</span>() = <span class="hljs-keyword">default</span>;
        <span class="hljs-built_in">LargeData</span>(LargeData&amp;&amp;) <span class="hljs-keyword">noexcept</span> = <span class="hljs-keyword">default</span>;
        LargeData&amp; <span class="hljs-keyword">operator</span>=(LargeData&amp;&amp;) <span class="hljs-keyword">noexcept</span> = <span class="hljs-keyword">default</span>;
        
        <span class="hljs-comment">// 禁止拷贝（或实现深拷贝）</span>
        <span class="hljs-built_in">LargeData</span>(<span class="hljs-type">const</span> LargeData&amp;) = <span class="hljs-keyword">delete</span>;
        LargeData&amp; <span class="hljs-keyword">operator</span>=(<span class="hljs-type">const</span> LargeData&amp;) = <span class="hljs-keyword">delete</span>;
        
        <span class="hljs-function"><span class="hljs-type">static</span> LargeData <span class="hljs-title">create</span><span class="hljs-params">()</span> </span>{
            LargeData data;
            <span class="hljs-comment">// 初始化...</span>
            <span class="hljs-keyword">return</span> data;  <span class="hljs-comment">// NRVO或移动</span>
        }
    };
    
    <span class="hljs-comment">// 规则4：多态对象返回智能指针</span>
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> std::unique_ptr&lt;ModernBestPractices&gt; <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ModernBestPractices&gt;(*<span class="hljs-keyword">this</span>);
    }
    
    <span class="hljs-comment">// 规则5：工厂方法返回unique_ptr</span>
    <span class="hljs-function"><span class="hljs-type">static</span> std::unique_ptr&lt;ModernBestPractices&gt; <span class="hljs-title">create</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;ModernBestPractices&gt;();
    }
    
    <span class="hljs-comment">// 规则6：构建器返回对象值或智能指针</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Builder</span> {
        <span class="hljs-keyword">public</span>:
            <span class="hljs-function">Builder&amp; <span class="hljs-title">setValue</span><span class="hljs-params">(<span class="hljs-type">int</span> val)</span> </span>{ value_ = val; <span class="hljs-keyword">return</span> *<span class="hljs-keyword">this</span>; }
            
            <span class="hljs-function">Config <span class="hljs-title">build</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">Config</span>(value_);  <span class="hljs-comment">// 返回值</span>
            }
            
            <span class="hljs-function">std::unique_ptr&lt;Config&gt; <span class="hljs-title">buildUnique</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
                <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;Config&gt;(value_);  <span class="hljs-comment">// 返回智能指针</span>
            }
            
        <span class="hljs-keyword">private</span>:
            <span class="hljs-type">int</span> value_ = <span class="hljs-number">0</span>;
        };
        
    <span class="hljs-keyword">private</span>:
        <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">Config</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> : value_(value) {</span>}
        <span class="hljs-type">int</span> value_;
    };
};

<span class="hljs-comment">// 最终建议的实用模板</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObjectCreator</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// 通用工厂方法</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">static</span> T <span class="hljs-title">create</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">T</span>(std::forward&lt;Args&gt;(args)...);  <span class="hljs-comment">// 完美转发 + RVO</span>
    }
    
    <span class="hljs-comment">// 智能指针工厂</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">static</span> std::unique_ptr&lt;T&gt; <span class="hljs-title">createUnique</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_unique</span>&lt;T&gt;(std::forward&lt;Args&gt;(args)...);
    }
    
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span>... Args&gt;
    <span class="hljs-type">static</span> std::shared_ptr&lt;T&gt; <span class="hljs-title">createShared</span><span class="hljs-params">(Args&amp;&amp;... args)</span> </span>{
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">make_shared</span>&lt;T&gt;(std::forward&lt;Args&gt;(args)...);
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_modern_best_practices</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== 现代C++最佳实践 ==="</span> &lt;&lt; std::endl;
    
    ModernBestPractices practices;
    
    <span class="hljs-comment">// 1. 小型对象返回值</span>
    <span class="hljs-type">int</span> sum = practices.<span class="hljs-built_in">calculateSum</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>);
    std::cout &lt;&lt; <span class="hljs-string">"和: "</span> &lt;&lt; sum &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 2. 容器移动语义</span>
    <span class="hljs-keyword">auto</span> strings = practices.<span class="hljs-built_in">getStrings</span>();
    std::cout &lt;&lt; <span class="hljs-string">"字符串数量: "</span> &lt;&lt; strings.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    <span class="hljs-comment">// 3. 大对象移动语义</span>
    <span class="hljs-keyword">auto</span> largeData = ModernBestPractices::LargeData::<span class="hljs-built_in">create</span>();
    
    <span class="hljs-comment">// 4. 智能指针工厂</span>
    <span class="hljs-keyword">auto</span> obj = ModernBestPractices::<span class="hljs-built_in">create</span>();
    <span class="hljs-keyword">auto</span> cloned = obj-&gt;<span class="hljs-built_in">clone</span>();
    
    <span class="hljs-comment">// 5. 构建器模式</span>
    <span class="hljs-keyword">auto</span> config1 = ModernBestPractices::Config::<span class="hljs-built_in">Builder</span>().<span class="hljs-built_in">setValue</span>(<span class="hljs-number">42</span>).<span class="hljs-built_in">build</span>();
    <span class="hljs-keyword">auto</span> config2 = ModernBestPractices::Config::<span class="hljs-built_in">Builder</span>().<span class="hljs-built_in">setValue</span>(<span class="hljs-number">100</span>).<span class="hljs-built_in">buildUnique</span>();
    
    <span class="hljs-comment">// 6. 通用对象创建器</span>
    <span class="hljs-keyword">auto</span> created = ObjectCreator&lt;std::vector&lt;<span class="hljs-type">int</span>&gt;&gt;::<span class="hljs-built_in">create</span>(<span class="hljs-number">10</span>, <span class="hljs-number">42</span>);
    std::cout &lt;&lt; <span class="hljs-string">"创建的向量大小: "</span> &lt;&lt; created.<span class="hljs-built_in">size</span>() &lt;&lt; std::endl;
    
    std::cout &lt;&lt; <span class="hljs-string">"=== 最佳实践演示结束 ==="</span> &lt;&lt; std::endl;
}

<span class="hljs-comment">// 最终的性能建议验证</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">final_performance_advice</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"\n=== 最终性能建议 ==="</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"1. 默认直接返回对象值"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"2. 为资源管理类实现移动语义"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"3. 多态对象使用智能指针工厂"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"4. 信任编译器的RVO/NRVO优化"</span> &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"5. 实际测量性能，而非猜测"</span> &lt;&lt; std::endl;
    
    PerformanceTest::<span class="hljs-built_in">benchmark</span>();
}

<span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-built_in">demonstrate_dangling_references</span>();
    <span class="hljs-built_in">demonstrate_static_reference_issues</span>();
    <span class="hljs-built_in">demonstrate_correct_object_return</span>();
    <span class="hljs-built_in">demonstrate_move_semantics</span>();
    <span class="hljs-built_in">demonstrate_smart_pointer_factory</span>();
    <span class="hljs-built_in">demonstrate_builder_pattern</span>();
    <span class="hljs-built_in">demonstrate_optimization_verification</span>();
    <span class="hljs-built_in">demonstrate_modern_best_practices</span>();
    <span class="hljs-built_in">final_performance_advice</span>();
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<p>通过以上全面分析，我们深刻理解了条款21的核心智慧：当必须返回新对象时，应该直接返回对象值，而非试图通过返回引用来优化。现代C++的编译器优化（RVO/NRVO）和语言特性（移动语义）已经使得对象返回变得高效，而试图手动优化往往引入复杂性和错误。正确的做法是信任语言设计者和编译器，编写语义清晰、正确性有保证的代码。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[本地 AI Code Review 探索及落地]]></title>    <link>https://juejin.cn/post/7573680361990750248</link>    <guid>https://juejin.cn/post/7573680361990750248</guid>    <pubDate>2025-11-18T10:15:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573680361990750248" data-draft-id="7573679820632604707" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="本地 AI Code Review 探索及落地"/> <meta itemprop="keywords" content="AIGC,人工智能"/> <meta itemprop="datePublished" content="2025-11-18T10:15:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三金得鑫"/> <meta itemprop="url" content="https://juejin.cn/user/4406498335130216"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            本地 AI Code Review 探索及落地
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4406498335130216/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三金得鑫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:15:56.000Z" title="Tue Nov 18 2025 10:15:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>近期在参与实现本地 AI Code Review 的事情，以下是一些思考输出。感兴趣的小伙伴可以在评论区一起讨论～</p>
<h3 data-id="heading-0">引言</h3>
<p>从 AI Code Review 的目的上看，我们更多的是需要增强代码的健壮性和稳定性，然后是代码的可读性及保证风格统一，持续推进项目标准化、规范化。</p>
<p>这样既能保证发布后的产品稳定，又能确保项目可以有节奏地、清晰地进行演进，还能让其他同学在 CR 过程中取长补短、查漏补缺，进行自我提升。</p>
<h3 data-id="heading-1">目标</h3>
<p>那有哪些问题是我们需要在 CR 中找出并必须让同学进行修改的？我认为有以下几种：</p>
<ul>
<li>明显的语法问题、边界问题、异常处理、竞态问题等；</li>
<li>潜在的逻辑漏洞或者其他 bug；</li>
<li>业务逻辑耦合，可读性和可维护性差！</li>
<li>不符合项目规范，代码风格差异大；</li>
<li>存在安全漏洞；</li>
<li>代码变更风险等级：主要通过静态分析来进行评估，分为深度和广度。
<ul>
<li>深度：比如该代码属于基础函数，被多个其他函数所使用；</li>
<li>广度：比如该代码属于公共函数，被多个模块所使用；</li>
<li>其实从业务层面来讲，这里也可以 hack 一些风险数据，不同的模块会命中不同的风险等级；</li>
</ul>
</li>
</ul>
<p>而 CR 本身也应该从两个维度进行：</p>
<ul>
<li>个人本地 CR（AI 主力 - 模型为 GLM 4.6）
<ul>
<li>缺点：高频触发 CR，耗费时间</li>
<li>解决：制定一些软链、工具或者直接脚本，将是否触发交给开发人员。但默认需要触发！</li>
</ul>
</li>
<li>团队 CR（AI + 人工协作）</li>
</ul>
<h3 data-id="heading-2">应该</h3>
<p>在实际过程中，我们应该参考或者遵循以 Spec 驱动的方式来制定 CR 规范。比如通用的 CR 规则 + 项目编码规范和工作流程 + 团队内部知识库积累。</p>
<blockquote>
<p>如果并没有项目规范和知识库，我们需要同时推动规范落地和知识积累。从长远收益来看，它是非常有必要的。</p>
</blockquote>
<p>这里列举一些比较常规的 Spec：</p>
<ul>
<li>项目编码规范；</li>
<li>内部框架或当前使用框架文档；</li>
<li>最佳 Code Style 以及优秀的案例文档；</li>
<li>遵循 MR（Merge Request）规则，明确规定需要使用 Git 的哪些命令获取正确的 diff 文件和内容；</li>
<li>其他</li>
</ul>
<h3 data-id="heading-3">需要了解的前置知识</h3>
<p>既然要实现 Code Review，那么就需要知道 Code Review 的时机以及内容。</p>
<p>通常来说，我们一般只有在提交完代码，并发起一个 Merge Request （MR）的时候，才会触发 Code Review。而需要评审的内容：是自开发分支从指定分支（比如 master 或者 main）分叉以来的增量代码（避免把指定分支上最新的变更都算进来）。</p>
<p>可以认为是在本地以 merge-base 为基准的三点比较，这是与 PR/MR 最接近的 Diff 手段。同时还需要启用 -M（重命名检测）和 -C（复制检测），避免混入一些不必要的文件内容到 CR 当中。</p>
<p>对于本地 AI CR 来说，我们把 CR 时机放在 pre-commit 这一环节，那 CR 的内容就是「已提交的内容 + 暂存区」的内容，最简单的实现方式就是：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">计算变更基线</span>
BASE=$(git merge-base origin/master HEAD)
<span class="hljs-meta prompt_">
# </span><span class="bash">查看差异文件</span>
git diff --name-only --cached "$BASE"
<span class="hljs-meta prompt_">
# </span><span class="bash">查看完整补丁</span>
git diff --cached -M -C "$BASE"
</code></pre>
<p><strong>用 merge-base 作为变更基线的什么意思呢？</strong></p>
<p>要知道在做分支比较时，我们不会直接拿 master 的快照来当左侧基线，而是先找到 master 与当前分支的“共同祖先”（通常来说就是分支分叉点），使用它来作为对比起点。这样得到的差异就是——从分支创建以来你真正引入的改动，从而避免被 master 分支上后续 push 进去的代码提交所污染。</p>
<p>用 merge-base 就是获取该分叉点的主要手段，<code>git diff master...HEAD</code> （或者 <code>git merge-base master HEAD</code>) 只会展示——从分叉点到你当前分支头部的增量，在 PR/MR 中基本都采用这种三点（...）语义。</p>
<p><strong>为什么要在 pre-commit 发起 AI CR？</strong></p>
<ul>
<li>很多开发者都有一些“陋习”，只管码代码，不自测。这就导致一些很低级的代码问题被提交到仓库；</li>
<li>开发任我行，和项目编码规范偏差十万八千里，在整个项目“一枝独秀”；</li>
<li>能 “run” 不能看，业务耦合度堪称防御性输出典范——谁敢动我的代码试试！</li>
<li>「commit-push -&gt; CR -&gt; 修改」流程，往返好几遍才达到发布标准；评审人员也无法保证立即 CR 你的代码，整个流程下来费时费力</li>
</ul>
<p>综上，我们在 pre-commit 环节借助 AI CR，可以缩短整个评审周期和发布周期。既减少了 commit 次数，又能保证代码质量和功能稳定，还能减轻评审人的压力，何乐而不为？</p>
<h3 data-id="heading-4">落地</h3>
<p>我们直接使用 Shell 脚本的方式搭配 Claude Code 或者 iflow 来实现本地 AI Code Review。以 iflow 为例：</p>
<ul>
<li>首先需要进行安装 <code>npm install -g iflow</code>；</li>
<li>然后在项目根目录中的 <code>.husky/pre-commit</code> 文件中增加调用脚本
<ul>
<li>先设定获取 diff 的脚本，主要是上述内容中 Git diff 的命令；</li>
<li>再通过 <code>iflow -y -p "your_prompt"</code> 的形势，触发 iflow 终端运行</li>
<li>通过“必须通过项”或者 AI 打分的形势，在不符合预期时进行拦截，直至开发者修改通过后方可 commit 成功；</li>
<li>iflow 报错不可 block 用户 commit 操作；</li>
<li>需要提供跳过 AI CR 的能力，防止在一些紧急状况下拦截开发者提交；</li>
<li>基于上一条，可以选择继续评审，但将评审结果和代码一起提交至仓库</li>
</ul>
</li>
<li>最终的形式是脚本 + AI CR</li>
</ul>
<h3 data-id="heading-5">附加项</h3>
<ul>
<li>是否增加 RAG 和内部知识库</li>
</ul>
<p>这个是扩展项，如果从知识库的角度来进行 Code Review，可以有效地提高准确率（预期）。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于 Hologres 构建智能驾驶图像高性能分析系统]]></title>    <link>https://juejin.cn/post/7573708620870975540</link>    <guid>https://juejin.cn/post/7573708620870975540</guid>    <pubDate>2025-11-18T10:16:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573708620870975540" data-draft-id="7573679820632342563" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于 Hologres 构建智能驾驶图像高性能分析系统"/> <meta itemprop="keywords" content="数据分析"/> <meta itemprop="datePublished" content="2025-11-18T10:16:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于 Hologres 构建智能驾驶图像高性能分析系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:16:35.000Z" title="Tue Nov 18 2025 10:16:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着人工智能技术的深入发展，企业对数据的利用已不再局限于传统的结构化数据分析。越来越多的行业开始依赖多模态数据进行智能决策，涵盖商品推荐、驾驶行为分析、金融风控、教育个性化等多个场景。这些场景普遍具备一个共同特征：<strong>数据形态多样、分析需求复杂、检索方式多元</strong>。Hologres 4.0的整体架构围绕“多模态分析检索 all-in-one”设计，实现“一份数据、一份计算、多模分析”的一站式目标，一条SQL即可完成从数据接入、AI加工到多模查询的全流程。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/954b03bd631747bc9ecdbc804bc7276b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065957&amp;x-signature=UXzee7usV9IDcPSda96iKERLGV8%3D" alt="image.png" loading="lazy"/></p>
<p>智能驾驶场景中，可以看到采集的车机各种信号数据，以大宽表的形式存储在数据库中。这些信号数据通常会包含结构化数据（车辆状态、车机版本等）、半结构化数据（车机信号）、非结构化数据（轨迹照片等）。在业务应用的时候，要进行点查、OLAP分析、全文检索、向量检索、混合检索等多种场景。</p>
<p>传统架构往往依赖多个独立引擎协同工作，导致系统复杂、成本高昂、数据不一致等问题频发。AI时代的应用需要在一个统一平台上完成OLAP分析、点查服务、全文检索、向量搜索以及AI推理等多种能力的融合使用。本文以自动驾驶图像数据集为例，介绍Hologres如何在传统的结构化分析的基础上，完成文搜图、图搜图等多模态分析场景。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51e2915b7deb45cea3632a5a2ee92aea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065957&amp;x-signature=gavDrk9mOWaDApHcEgrFfrQ12UA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0"><strong>基于Hologres构建自动驾驶图像高性能分析系统</strong></h2>
<p>在自动驾驶系统中，车辆图片分析是环境感知模块的核心场景之一，主要用于实时解析车辆内外部摄像头捕捉的视觉信息，以实现对周围环境的精准理解与决策。本文以BDD自动驾驶数据集为例模拟自动驾驶场景，模拟真实驾驶场景，采集10万张包括驾驶区域、地理、环境、天气多样性等数据的图片，通过对图片的分析与检索，进行了行驶轨迹分析、环境感知优化及行人车辆识别精度提升等全栈技术验证，提升系统对复杂交通场景的适应能力、安全性和用户体验。</p>
<p>基于Hologres构建自动驾驶图像高性能分析系统包含的主要能力如下：</p>
<ul>
<li>非结构化数据（Object Table）：支持通过表的形式读取OSS中非结构化数据（PDF、IMAGE、PPT等）。</li>
<li>AI Function：在Hologres中可以用标准SQL的方式调用Function，自动调用内置大模型，完成AI服务建设场景。
<ul>
<li>数据加工：提供Embed、Chunk算子，可以对非结构化数据加工成结构化数据存储，无需使用外部算法就能自动Embed。</li>
<li>数据检索和分析：提供ai_gen、ai_summarize等算子，使用SQL就能对数据进行推理、问题总结以及翻译等能力。</li>
</ul>
</li>
<li>Dynamic Table介绍：支持增量刷新模式对非结构化数据自动加工，每次只计算增量的数据有效减少重复计算，降低资源利用率。</li>
<li>向量检索：支持标准SQL的向量检索，用于非结构化数据的相似度搜索、场景识别等，在同一个查询中可以自由地实现向量和标量的检索。</li>
<li>全文检索：通过倒排索引、分词等机制实现对非结构化数据的高效检索，支持关键词匹配、短语检索等丰富的检索方式，实现更加灵活的检索。</li>
</ul>
<h2 data-id="heading-1"><strong>方案优势</strong></h2>
<p>通过如上核心能力，在Hologres中对图片检索的核心优势如下：</p>
<ul>
<li><strong>完整的<strong><strong>AI</strong></strong>数据处理流程</strong>：涵盖从数据Embed、Chunk、增量加工和检索/分析的全流程，与使用大数据系统一样轻松构建AI应用。</li>
<li><strong>标准<strong><strong>SQL</strong></strong>加工图片数据</strong>：无需使用专用开发语言，<strong>纯SQL</strong>就能完成图片数据提取、加工。</li>
<li><strong>一个平台支持跨模态检索</strong>：支持以文搜图、以图搜图，语义理解突破关键词局限，在Hologres就能实现跨模态检索。</li>
<li><strong>检索更精准、灵活和智能</strong>：可以轻松构建“关键词+语义+多模态”的混合检索链路，覆盖从精准搜索到意图理解的全场景需求。还能结合AI Function实现对用户意图的深度理解，语义关联和上下文推理，实现更智能的检索能力。</li>
<li><strong>数据不出库，安全性更高</strong>：不需要将数据导出到外部系统，与Hologres的多种安全能力无缝集成，并高效保护数据安全。</li>
</ul>
<h2 data-id="heading-2">方案流程</h2>
<p>本次方案的流程如下：</p>
<ol>
<li>数据集准备。</li>
</ol>
<p>将图片数据上传至OSS存储。</p>
<ol start="2">
<li>图片加工。</li>
</ol>
<p>使用Object Table读取图片的元数据信息，然后创建增量刷新的Dynamic Table对数据进行Embed，并为Dynamic Table构建向量索引，以便后续检索能够充分利用索引的功能。</p>
<ol start="3">
<li>使用ai_embed算子将自然语言的问题进行Embedding，然后使用向量检索输出Top N的结果。</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61d6d9715947417bbfa09193822f216c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065957&amp;x-signature=GSSEtM2lHOc6a8afhygWFOuFuuc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>准备工作</strong></h2>
<ol>
<li>数据准备</li>
</ol>
<p>本文使用ModelScope公开的BDD100K 自动驾驶图像数据集中<code>val.zip</code>文件，模拟多个车辆真是行驶数据。</p>
<ol start="2">
<li>环境准备</li>
</ol>
<ul>
<li>购买Hologres V4.0及以上版本实例并创建数据库。</li>
<li>购买AI资源。</li>
</ul>
<p>本文以<code>large-96core-512GB-384GB</code>、1个节点为例。</p>
<ul>
<li>模型部署。本次方案使用的模型以及分配的资源为：</li>
</ul>







<table><thead><tr><th/><th/></tr></thead></table>





































<table><thead><tr><th align="left"><strong>类别</strong></th><th align="left"><strong>示例值</strong></th></tr></thead><tbody><tr><td align="left"><strong>模型名称</strong></td><td align="left">image_embed</td></tr><tr><td align="left"><strong>模型类别</strong></td><td align="left">clip-ViT-B-32</td></tr><tr><td align="left"><strong>模型作用描述</strong></td><td align="left">图片Embedding</td></tr><tr><td align="left"><strong>单副本CPU（Core）</strong></td><td align="left">7</td></tr><tr><td align="left"><strong>单副本内存</strong></td><td align="left">30 GB</td></tr><tr><td align="left"><strong>单副本GPU</strong></td><td align="left">1卡(96 GB)</td></tr><tr><td align="left"><strong>资源副本数</strong></td><td align="left">1</td></tr></tbody></table>
<p><strong>说明：</strong>上述模型的资源均为默认分配的资源。</p>
<h2 data-id="heading-4"><strong>操作步骤</strong></h2>
<p>1.下载图片数据并导入至OSS。</p>
<ul>
<li>下载BDD100K 自动驾驶图像数据集中的文件。</li>
<li>登录OSS管理控制台，创建Bucket并将已下载的文件上传至该Bucket路径下。上传操作详情，请参见简单上传。</li>
</ul>
<p><strong>说明：</strong>文件夹名称请使用小写。</p>
<ol start="2">
<li>账号授权。</li>
</ol>
<p>a. 登录RAM控制台，创建阿里云RAM角色并授予OSS的相关权限。
推荐授予AliyunOSSReadOnlyAccess权限。</p>
<p>b.为上述阿里云RAM角色添加登录和Hologres的访问权限。</p>
<ul>
<li>阿里云账号（主账号）</li>
</ul>
<p>修改RAM角色的信任策略。重点需更新如下参数：</p>
<ul>
<li>Action:更新为 sts:AssumeRole.</li>
<li>Service:更新为 hologres.aliyuncs.com</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sts:AssumeRole"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Principal"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"RAM"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"acs:ram::1866xxxx:root"</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"Service"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"hologres.aliyuncs.com"</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>RAM用户（子账号）</li>
</ul>
<ol>
<li>为RAM用户授权。</li>
</ol>
<ul>
<li>在<strong>权限管理 &gt; 权限策略</strong>页面，单击<strong>创建权限策略</strong>，并选择<strong>脚本编辑</strong>模式创建权限策略。具体操作，请参见创建自定义权限策略</li>
</ul>
<p>Hologres可通过该策略判断当前RAM用户是否具备创建对应RAM角色的权限。权限策略内容如下。</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"hologram:GrantAssumeRole"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"&lt;arn账号&gt;"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ul>
<li>在<strong>身份管理 &gt; 用户</strong>页面，单击目标RAM用户<strong>操作</strong>列中的<strong>添加权限</strong>，为RAM用户（子账号）授予上述步骤已创建的权限策略。具体操作，请参见为RAM用户授权。</li>
</ul>
<ol start="2">
<li>为已创建的RAM角色授权。</li>
</ol>
<p>修改RAM角色的信任策略。重点需更新如下参数：</p>
<ul>
<li>Action：更新为sts:AssumeRole。</li>
<li>Service：更新为hologres.aliyuncs.com。</li>
</ul>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"Statement"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"Action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sts:AssumeRole"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Effect"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Allow"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"Principal"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"RAM"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"acs:ram::1866xxxx:root"</span>
        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"Service"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
          <span class="hljs-string">"hologres.aliyuncs.com"</span>
        <span class="hljs-punctuation">]</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"Version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<ol start="3">
<li>对图片进行Embedding。</li>
</ol>
<p>创建Object Table和Dynamic Table读取图片元数据，并对图片加工Embedding。因为流程较长，Hologres直接将过程封装成附录：存储过程。该存储过程包括的能力如下：</p>
<ul>
<li>创建一张Object Table，用于读取图片的元数据。</li>
<li>创建一张增量刷新的Dynamic Table结果表，用于存储加工后的数据，并设置向量索引。该Dynamic Table未设置自动刷新，需要手动刷新。</li>
<li>Dynamic Table的刷新过程中会使用ai_embed对图片进行Embedding。</li>
</ul>
<p>该存储过程的使用如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--存储过程，创建Object Table和Dynamic Table，使用dt对图片进行Embedding</span>
<span class="hljs-keyword">CALL</span> create_image_table_from_oss(
    oss_path <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'oss://xxxx/bdd100k/val/images'</span>,
    oss_endpoint <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'oss-cn-hangzhou-internal.aliyuncs.com'</span>,
    oss_role_arn <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'acs:ram::1xxxx:role/xxxx'</span>,
    image_table <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'public.dt_image_bdd100k'</span>,
    embedding_model <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span><span class="hljs-string">'image_embed'</span>
);
</code></pre>
<ol start="4">
<li>刷新结果表。</li>
</ol>
<p>通过上述步骤创建的Object Table和Dynamic Table都需要手动刷新，才能完成数据加工。该步骤已被封装为附录：存储过程，该存储过程包括的能力如下：</p>
<ul>
<li>刷新一次Object Table获取图片元数据。</li>
<li>刷新一次Dynamic Table，进行图片的Embedding加工。</li>
</ul>
<p>该存储过程的使用如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--刷新Dynamic Table，将图片Embedding</span>
<span class="hljs-keyword">CALL</span> refresh_image_table(
    image_table <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'public.dt_image_bdd100k'</span>
);
</code></pre>
<ol start="5">
<li>图片检索。</li>
</ol>
<p>图片数据处理过后可以使用向量检索和AI Function进行检索。</p>
<p><strong>以文搜图：</strong></p>
<p>如果使用clip-ViT-B-32模型进行以文搜图，问题请使用英文。如果是中文问题，请换成LLM模型。以文搜图的示例SQL如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--以文搜图</span>
<span class="hljs-keyword">SELECT</span>
    object_uri,
    approx_cosine_distance (embedding_vector, ai_embed (<span class="hljs-string">'image_embed'</span>, <span class="hljs-string">'a red car in the rain'</span>)) <span class="hljs-keyword">AS</span> score
<span class="hljs-keyword">FROM</span>
    public.dt_image_bdd100k
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>
    score <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">1</span>;

                            object_uri                         <span class="hljs-operator">|</span>  score   
<span class="hljs-comment">---------------------------------------------------------------+-------</span>
 oss:<span class="hljs-operator">/</span><span class="hljs-comment">/****/</span>bd<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>k<span class="hljs-operator">/</span>val<span class="hljs-operator">/</span>images<span class="hljs-operator">/</span>b836b14a<span class="hljs-operator">-</span>fb13<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>.jpg｜ <span class="hljs-number">0.322337151</span>
(<span class="hljs-number">5</span> <span class="hljs-keyword">rows</span>)
</code></pre>
<p>在OSS中找到第一个结果的图片如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74b4c914d822445ebf39ca0181b51a47~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065957&amp;x-signature=pKp7g4Lu4ubZpCntviH6qdPW6H8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>以图搜图：</strong></p>
<p>以图搜图的示例SQL如下：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">--以图搜图</span>
<span class="hljs-keyword">SELECT</span>
    object_uri,
    approx_cosine_distance (embedding_vector, ai_embed (<span class="hljs-string">'image_embed'</span>, to_file (<span class="hljs-string">'oss://xxxx/val/images/b9b53753-91a5d5f8.jpg'</span>, <span class="hljs-string">'oss-cn-hangzhou-internal.aliyuncs.com'</span>, <span class="hljs-string">'acs:ram::18xxx:role/xxx'</span>))) <span class="hljs-keyword">AS</span> score
<span class="hljs-keyword">FROM</span>
    public.dt_image_bdd100k
<span class="hljs-keyword">WHERE</span>
    object_uri <span class="hljs-operator">&lt;&gt;</span> <span class="hljs-string">'oss://hm-**-hangzhou/bd****k/val/images/b9b53753-91a5****.jpg'</span> <span class="hljs-comment">--排除自身</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span>
    score <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">1</span>;

                          object_uri                           <span class="hljs-operator">|</span>  score   
<span class="hljs-comment">---------------------------------------------------------------+------</span>
 oss:<span class="hljs-operator">/</span><span class="hljs-comment">/****/</span>bd<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>k<span class="hljs-operator">/</span>val<span class="hljs-operator">/</span>images<span class="hljs-operator">/</span>c0e9b7c4<span class="hljs-operator">-</span>cd8b<span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span><span class="hljs-operator">*</span>.jpg <span class="hljs-operator">|</span> <span class="hljs-number">0.918008327</span>
</code></pre>
<p>在OSS中找到召回的图片，并做对比，结果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/98bb4d9d1b17467990c1a03b84160c69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5aSn5pWw5o2uQUnmioDmnK8=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065957&amp;x-signature=3ZVmWanJAhS%2B0GlZ%2Bd3H1XZjW%2FY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">附录：存储过程</h2>
<ul>
<li>创建Object Table和Dynamic Table </li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- Query查询结果默认限制200行，如需更多数据请修改limit，最多展示10000行或20M。</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">PROCEDURE</span> create_image_table_from_oss(
    oss_path TEXT,
    oss_endpoint TEXT,
    oss_role_arn TEXT,
    image_table TEXT,
    embedding_model TEXT <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,
    overwrite <span class="hljs-type">BOOLEAN</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-literal">FALSE</span>
)
<span class="hljs-keyword">AS</span> $$
<span class="hljs-keyword">DECLARE</span>
    image_schema_name TEXT;
    image_table_name TEXT;
    obj_table_name TEXT;
    full_image_table_ident TEXT;
    full_obj_ident TEXT;
    embed_expr TEXT;
    create_sql TEXT;
    embedding_dims <span class="hljs-type">INT</span>;
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-comment">-- 1. 拆 schema name + table name</span>
    IF <span class="hljs-built_in">position</span>(<span class="hljs-string">'.'</span> <span class="hljs-keyword">in</span> image_table) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
        image_schema_name :<span class="hljs-operator">=</span> split_part(image_table, <span class="hljs-string">'.'</span>, <span class="hljs-number">1</span>);
        image_table_name  :<span class="hljs-operator">=</span> split_part(image_table, <span class="hljs-string">'.'</span>, <span class="hljs-number">2</span>);
    <span class="hljs-keyword">ELSE</span>
        image_schema_name :<span class="hljs-operator">=</span> <span class="hljs-string">'public'</span>;
        image_table_name  :<span class="hljs-operator">=</span> image_table;
    <span class="hljs-keyword">END</span> IF;

    obj_table_name :<span class="hljs-operator">=</span> image_table_name <span class="hljs-operator">||</span> <span class="hljs-string">'_obj_table'</span>;

    full_image_table_ident :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, image_schema_name, image_table_name);
    full_obj_ident    :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, image_schema_name, obj_table_name);
    
    <span class="hljs-comment">-- 2. 如果需要覆盖，先删表和索引</span>
    IF overwrite <span class="hljs-keyword">THEN</span>
        <span class="hljs-keyword">DECLARE</span>
            dyn_table_exists <span class="hljs-type">BOOLEAN</span>;
            rec RECORD;
        <span class="hljs-keyword">BEGIN</span>
            <span class="hljs-comment">-- 检查 dynamic table 是否存在</span>
            <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">EXISTS</span> (
                <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>
                <span class="hljs-keyword">FROM</span> pg_class c
                <span class="hljs-keyword">JOIN</span> pg_namespace n <span class="hljs-keyword">ON</span> n.oid <span class="hljs-operator">=</span> c.relnamespace
                <span class="hljs-keyword">WHERE</span> c.relname <span class="hljs-operator">=</span> image_table_name
                <span class="hljs-keyword">AND</span> n.nspname <span class="hljs-operator">=</span> image_schema_name
            )
            <span class="hljs-keyword">INTO</span> dyn_table_exists;

            IF dyn_table_exists <span class="hljs-keyword">THEN</span>
                <span class="hljs-comment">-- 2.1 关闭动态表自动刷新</span>
                <span class="hljs-comment">-- RAISE NOTICE 'Disabling auto refresh for %', full_image_table_ident;</span>
                <span class="hljs-comment">-- EXECUTE format('ALTER TABLE IF EXISTS %s SET (auto_refresh_enable=false)', full_image_table_ident);</span>

                <span class="hljs-comment">-- 2.2 查找 RUNNING 刷新任务并取消</span>
                <span class="hljs-keyword">FOR</span> rec <span class="hljs-keyword">IN</span>
                    <span class="hljs-keyword">EXECUTE</span> format(
                        $f$
                        <span class="hljs-keyword">SELECT</span> query_job_id
                            <span class="hljs-keyword">FROM</span> hologres.hg_dynamic_table_refresh_log(<span class="hljs-operator">%</span>L)
                            <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'RUNNING'</span>;
                        $f$,
                        image_table
                    )
                LOOP
                    RAISE NOTICE <span class="hljs-string">'Found running refresh job: %'</span>, rec.query_job_id;
                    IF hologres.hg_internal_cancel_query_job(rec.query_job_id::<span class="hljs-type">bigint</span>) <span class="hljs-keyword">THEN</span>
                        RAISE NOTICE <span class="hljs-string">'Cancel job % succeeded.'</span>, rec.query_job_id;
                    <span class="hljs-keyword">ELSE</span>
                        RAISE WARNING <span class="hljs-string">'Cancel job % failed.'</span>, rec.query_job_id;
                    <span class="hljs-keyword">END</span> IF;
                <span class="hljs-keyword">END</span> LOOP;

                <span class="hljs-comment">-- 2.3 删除 Dynamic Table</span>
                <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP TABLE IF EXISTS %s;'</span>, full_image_table_ident);
            <span class="hljs-keyword">ELSE</span>
                RAISE NOTICE <span class="hljs-string">'Dynamic table % does not exist, skip cancel job and drop.'</span>, full_image_table_ident;
            <span class="hljs-keyword">END</span> IF;

            <span class="hljs-comment">-- 2.4 无论如何，Object Table 都要删除</span>
            <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP OBJECT TABLE IF EXISTS %s;'</span>, full_obj_ident);
        <span class="hljs-keyword">END</span>;
    <span class="hljs-keyword">END</span> IF;

    <span class="hljs-comment">-- 3. 创建 Object Table</span>
    RAISE NOTICE <span class="hljs-string">'Create object table: %'</span>, obj_table_name;
    <span class="hljs-keyword">EXECUTE</span> format(
        $f$
        <span class="hljs-keyword">CREATE</span> OBJECT <span class="hljs-keyword">TABLE</span> <span class="hljs-operator">%</span>s
        <span class="hljs-keyword">WITH</span> (
            path <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>L,
            oss_endpoint <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>L,
            role_arn <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>L
        );
        $f$,
        full_obj_ident,
        oss_path,
        oss_endpoint,
        oss_role_arn
    );

    <span class="hljs-keyword">COMMIT</span>;

    <span class="hljs-comment">-- 4. 刷新 Object Table</span>
    RAISE NOTICE <span class="hljs-string">'Refresh object table: %'</span>, obj_table_name;
    <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'REFRESH OBJECT TABLE %s;'</span>, full_obj_ident);

    <span class="hljs-keyword">COMMIT</span>;

    <span class="hljs-comment">-- 5. embedding 模型选择</span>
    IF embedding_model <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">OR</span> length(<span class="hljs-built_in">trim</span>(embedding_model)) <span class="hljs-operator">=</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
        embed_expr :<span class="hljs-operator">=</span> <span class="hljs-string">'ai_embed(file)'</span>;

        <span class="hljs-keyword">EXECUTE</span> <span class="hljs-string">'SELECT array_length(ai_embed(''dummy''), 1)'</span>
        <span class="hljs-keyword">INTO</span> embedding_dims;
    <span class="hljs-keyword">ELSE</span>
        embed_expr :<span class="hljs-operator">=</span> format(<span class="hljs-string">'ai_embed(%L, file)'</span>, embedding_model);

        <span class="hljs-keyword">EXECUTE</span> format(
            <span class="hljs-string">'SELECT array_length(ai_embed(%L, ''dummy''), 1)'</span>,
            embedding_model
        )
        <span class="hljs-keyword">INTO</span> embedding_dims;
    <span class="hljs-keyword">END</span> IF;

    RAISE NOTICE <span class="hljs-string">'embedding dimension is: %'</span>, embedding_dims;

    <span class="hljs-comment">-- 6. 创建 RAG 输出动态表</span>
    RAISE NOTICE <span class="hljs-string">'create dynamic table: %'</span>, image_table_name;
    <span class="hljs-keyword">EXECUTE</span> format(
        $f$
        <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">DYNAMIC</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-operator">%</span>s(
            <span class="hljs-keyword">CHECK</span>(array_ndims(embedding_vector) <span class="hljs-operator">=</span> <span class="hljs-number">1</span> <span class="hljs-keyword">AND</span> array_length(embedding_vector, <span class="hljs-number">1</span>) <span class="hljs-operator">=</span> <span class="hljs-operator">%</span>s)
        )
        <span class="hljs-keyword">WITH</span> (
            vectors <span class="hljs-operator">=</span> <span class="hljs-string">'{
                "embedding_vector": {
                    "algorithm": "HGraph",
                    "distance_method": "Cosine",
                    "builder_params": {
                    "base_quantization_type": "sq8_uniform",
                    "max_degree": 64,
                    "ef_construction": 400,
                    "precise_quantization_type": "fp32",
                    "use_reorder": true
                    }
                }
            }'</span>,
            auto_refresh_mode <span class="hljs-operator">=</span> <span class="hljs-string">'incremental'</span>,
            freshness <span class="hljs-operator">=</span> <span class="hljs-string">'5 minutes'</span>,
            auto_refresh_enable <span class="hljs-operator">=</span> <span class="hljs-string">'false'</span>
        ) <span class="hljs-keyword">AS</span>
        <span class="hljs-keyword">SELECT</span>
            object_uri,
            etag,
            <span class="hljs-operator">%</span>s <span class="hljs-keyword">AS</span> embedding_vector
        <span class="hljs-keyword">FROM</span> <span class="hljs-operator">%</span>s;
        $f$,
        full_image_table_ident,
        embedding_dims,
        embed_expr,
        obj_table_name
    );

    <span class="hljs-keyword">COMMIT</span>;

    RAISE NOTICE <span class="hljs-string">''</span>;
    RAISE NOTICE <span class="hljs-string">'Create image table success: %'</span>, image_table;
    RAISE NOTICE <span class="hljs-string">'    Vector index is: %.embedding_vector'</span>, image_table;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;
</code></pre>
<ul>
<li>Object Table和Dynamic Table</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">PROCEDURE</span> refresh_image_table(
    image_table TEXT
)
<span class="hljs-keyword">AS</span> $$
<span class="hljs-keyword">DECLARE</span>
    image_schema_name TEXT;
    image_table_name   TEXT;
    obj_table_name TEXT;
    full_image_table_ident TEXT;
    full_obj_ident    TEXT;
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-comment">-- 1. 解析 schema 和表名</span>
    IF <span class="hljs-built_in">position</span>(<span class="hljs-string">'.'</span> <span class="hljs-keyword">in</span> image_table) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
        image_schema_name :<span class="hljs-operator">=</span> split_part(image_table, <span class="hljs-string">'.'</span>, <span class="hljs-number">1</span>);
        image_table_name  :<span class="hljs-operator">=</span> split_part(image_table, <span class="hljs-string">'.'</span>, <span class="hljs-number">2</span>);
    <span class="hljs-keyword">ELSE</span>
        image_schema_name :<span class="hljs-operator">=</span> <span class="hljs-string">'public'</span>;
        image_table_name  :<span class="hljs-operator">=</span> image_table;
    <span class="hljs-keyword">END</span> IF;

    obj_table_name :<span class="hljs-operator">=</span> image_table_name <span class="hljs-operator">||</span> <span class="hljs-string">'_obj_table'</span>;

    full_image_table_ident :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, image_schema_name, image_table_name);
    full_obj_ident    :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, image_schema_name, obj_table_name);

    <span class="hljs-comment">-- 2. 刷新 Object Table</span>
    RAISE NOTICE <span class="hljs-string">'Refreshing Object Table: %'</span>, obj_table_name;
    <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'REFRESH OBJECT TABLE %s;'</span>, full_obj_ident);

    <span class="hljs-comment">-- 3. 刷新 Dynamic Table</span>
    RAISE NOTICE <span class="hljs-string">'Refreshing Dynamic Table: %'</span>, image_table_name;
    <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'REFRESH TABLE %s;'</span>, full_image_table_ident);

    RAISE NOTICE <span class="hljs-string">'Refresh image table complete: %'</span>, image_table;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;
</code></pre>
<ul>
<li>删除存储过程</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">OR</span> REPLACE <span class="hljs-keyword">PROCEDURE</span> drop_image_table(
    image_table TEXT
)
<span class="hljs-keyword">AS</span> $$
<span class="hljs-keyword">DECLARE</span>
    image_schema_name TEXT;
    image_table_name   TEXT;
    obj_table_name TEXT;
    full_image_table_ident TEXT;
    full_obj_ident    TEXT;
    rec RECORD;
<span class="hljs-keyword">BEGIN</span>
    <span class="hljs-comment">-- 1. 解析 schema 和表名</span>
    IF <span class="hljs-built_in">position</span>(<span class="hljs-string">'.'</span> <span class="hljs-keyword">in</span> image_table) <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span> <span class="hljs-keyword">THEN</span>
        image_schema_name :<span class="hljs-operator">=</span> split_part(image_table, <span class="hljs-string">'.'</span>, <span class="hljs-number">1</span>);
        image_table_name   :<span class="hljs-operator">=</span> split_part(image_table, <span class="hljs-string">'.'</span>, <span class="hljs-number">2</span>);
    <span class="hljs-keyword">ELSE</span>
        image_schema_name :<span class="hljs-operator">=</span> <span class="hljs-string">'public'</span>;
        image_table_name   :<span class="hljs-operator">=</span> image_table;
    <span class="hljs-keyword">END</span> IF;

    obj_table_name :<span class="hljs-operator">=</span> image_table_name <span class="hljs-operator">||</span> <span class="hljs-string">'_obj_table'</span>;

    full_image_table_ident :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, image_schema_name, image_table_name);
    full_obj_ident    :<span class="hljs-operator">=</span> format(<span class="hljs-string">'%I.%I'</span>, image_schema_name, obj_table_name);

    <span class="hljs-comment">-- 2. 删除表</span>
    <span class="hljs-comment">-- 2.1 关闭动态表自动刷新</span>
    <span class="hljs-comment">-- RAISE NOTICE 'Disabling auto refresh for %', full_image_table_ident;</span>
    <span class="hljs-comment">-- EXECUTE format('ALTER TABLE IF EXISTS %s SET (auto_refresh_enable=false)', full_image_table_ident);</span>

    <span class="hljs-comment">-- 2.2 查找 RUNNING 刷新任务并取消</span>
    <span class="hljs-keyword">FOR</span> rec <span class="hljs-keyword">IN</span>
        <span class="hljs-keyword">EXECUTE</span> format(
            $f$
            <span class="hljs-keyword">SELECT</span> query_job_id
                <span class="hljs-keyword">FROM</span> hologres.hg_dynamic_table_refresh_log(<span class="hljs-operator">%</span>L)
                <span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-string">'RUNNING'</span>;
            $f$,
            image_table
        )
    LOOP
        RAISE NOTICE <span class="hljs-string">'Found running refresh job: %'</span>, rec.query_job_id;
        IF hologres.hg_internal_cancel_query_job(rec.query_job_id::<span class="hljs-type">bigint</span>) <span class="hljs-keyword">THEN</span>
            RAISE NOTICE <span class="hljs-string">'Cancel job % succeeded.'</span>, rec.query_job_id;
        <span class="hljs-keyword">ELSE</span>
            RAISE WARNING <span class="hljs-string">'Cancel job % failed.'</span>, rec.query_job_id;
        <span class="hljs-keyword">END</span> IF;
    <span class="hljs-keyword">END</span> LOOP;

    <span class="hljs-comment">-- 2.3 删除 Dynamic Table</span>
    RAISE NOTICE <span class="hljs-string">'Dropping Dynamic Table: %'</span>, image_table_name;
    <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP TABLE IF EXISTS %s;'</span>, full_image_table_ident);

    <span class="hljs-comment">-- 2.4 删除 Object Table</span>
    RAISE NOTICE <span class="hljs-string">'Dropping Object Table: %'</span>, obj_table_name;
    <span class="hljs-keyword">EXECUTE</span> format(<span class="hljs-string">'DROP OBJECT TABLE IF EXISTS %s;'</span>, full_obj_ident);

    RAISE NOTICE <span class="hljs-string">'Drop image table complete: %'</span>, image_table;
<span class="hljs-keyword">END</span>;
$$ <span class="hljs-keyword">LANGUAGE</span> plpgsql;
</code></pre>
<p>如果想体验更多操作流程，欢迎到阿里云官网领取Hologres免费试用，开通Hologres4.0，并按照操作文档实践。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fhologres%2Fuser-guide%2Fvisual-data-analysis-for-autonomous-driving" target="_blank" title="https://help.aliyun.com/zh/hologres/user-guide/visual-data-analysis-for-autonomous-driving" ref="nofollow noopener noreferrer">help.aliyun.com/zh/hologres…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[入围名单公布｜2025 MGPIC 决赛即将拉开帷幕！]]></title>    <link>https://juejin.cn/post/7573679820633047075</link>    <guid>https://juejin.cn/post/7573679820633047075</guid>    <pubDate>2025-11-18T10:09:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573679820633047075" data-draft-id="7573864324713480244" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="入围名单公布｜2025 MGPIC 决赛即将拉开帷幕！"/> <meta itemprop="keywords" content="后端,算法"/> <meta itemprop="datePublished" content="2025-11-18T10:09:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="MoonBit"/> <meta itemprop="url" content="https://juejin.cn/user/3609050528885565"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            入围名单公布｜2025 MGPIC 决赛即将拉开帷幕！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3609050528885565/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    MoonBit
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:09:42.000Z" title="Tue Nov 18 2025 10:09:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>总决赛名单公布</strong></p>
<p>MoonBit 编程创新挑战赛由粤港澳大湾区数字经济研究院基础软件中心主办，是面向全球开发者的年度技术挑战赛事。自连续两届举办以来，赛事累计吸引全球<strong>上千名选手参赛</strong>，已成为编程语言与基础软件领域的重要创新舞台。</p>
<p>历经两个多月的角逐，本年度大赛正式进入 <strong>决赛阶段</strong>。来自全球的优秀参赛者在双赛道中展现出卓越的工程能力与创造力，竞争异常激烈。</p>
<p>截至 11 月 14 日，本届「编程语言赛道」与「游戏开发赛道」双赛道作品提交已全部结束。本次比赛整体质量远超往年，两个赛道均涌现出数量可观的高水准作品。</p>
<p>为了让更多优秀的创作者获得展示舞台，我们决定<strong>扩大名额</strong>，经过专家评委的细致评审与严格打分，共甄选出 <strong>15 支最具实力的队伍/参赛者</strong> 参与本年度现场总决赛！</p>
<p>同时，今年的决赛现场我们特别邀请了来自学界与工业界的 <strong>10 余位重磅嘉宾</strong> 到场评审和颁奖，与你共同见证年度最高舞台的荣耀时刻。</p>
<p>以下为 <strong>2025 MoonBit 全球编程挑战赛 · 决赛入围名单</strong>：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c19485ed4d6941398ed942fa8b7aaf28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9vbkJpdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065382&amp;x-signature=5FP4QAiKC1lMEkmr5znlxo%2BlA8s%3D" alt="图片" loading="lazy"/></p>
<p><strong>决赛地址</strong></p>
<p>深圳市福田保税区河套科创中心一层报告厅</p>
<p><strong>决赛邀请</strong></p>
<p>决赛现场将汇聚多位业界大咖，他们将作为评委和嘉宾，为参赛者们带来专业的点评和宝贵的建议。这不仅是一次展示才华的舞台，更是一次与行业领袖面对面交流的难得机会。此外，我们还准备了精美的赛事礼包以及 MoonBit 专属周边、茶歇等，让每位参与者在享受比赛的同时，也能收获满满的惊喜。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e22e6f7186e24eabba237237574e7873~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9vbkJpdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065382&amp;x-signature=5E4PWGB4G9z1keGG2t3Z2lEb70E%3D" alt="图片" loading="lazy"/>现场场地<br/>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e5ca0d65ad74c6882ec349b97518dc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9vbkJpdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065382&amp;x-signature=8cA%2Bz1FI2RdZZ%2Bj4cMBccKEQWdg%3D" alt="图片" loading="lazy"/>茶歇</p>
<p>我们诚挚邀请所有参赛选手携带您的亲友、同学一同来到决赛现场，共同见证这场编程界的盛宴。11月23日，我们不见不散！</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2329483f35934f64a83fa2b3f93177a2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTW9vbkJpdA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764065382&amp;x-signature=qzSk%2BTXIYmfJLse4EHEddjwPgjc%3D" alt="图片" loading="lazy"/>欢迎各位一同现场见证冠军的诞生！</p>
<p>对于无法亲临现场的朋友，我们也为您准备了线上直播的便利。本次决赛将同步进行全程直播，让您无论身在何处，都能实时感受比赛的紧张刺激和精彩瞬间，直播信息稍后公布，欢迎持续关注～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[真机RL！最强VLA模型π*0.6来了，机器人在办公室开起咖啡厅]]></title>    <link>https://juejin.cn/post/7573896789364867110</link>    <guid>https://juejin.cn/post/7573896789364867110</guid>    <pubDate>2025-11-18T10:29:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573896789364867110" data-draft-id="7573988811916230706" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="真机RL！最强VLA模型π*0.6来了，机器人在办公室开起咖啡厅"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-18T10:29:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            真机RL！最强VLA模型π*0.6来了，机器人在办公室开起咖啡厅
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:29:43.000Z" title="Tue Nov 18 2025 10:29:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读13分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>新方法大幅提升了具身智能的成功率、处理效率。</p>
</blockquote>
<p>完全使用真实世界数据训练的具身智能，具备什么级别的能力？</p>
<p>本周，美国具身智能创业公司 Physical Intelligence（简称 PI 或 π）发布了旗下的最新机器人基础模型 π*0.6。</p>
<p>PI 是一家总部位于旧金山的机器人与 AI 创业公司，其使命是将通用人工智能从数字世界带入物理世界：他们的首个机器人通用基础模型名为 π₀，让同一套软件控制多种物理平台执行各类任务。  </p>
<p>在 2024 年，PI 获得超过 4 亿美元融资，估值突破 20 亿美元，成为具身智能赛道最受瞩目的玩家之一。</p>
<p>PI 的技术路线强调 「视觉 - 语言 - 动作」（VLA）模型，通过大规模机器人感知与动作数据训练出具备泛化能力的策略，使机器人不再局限于预设动作，而能在未知环境中灵活执行。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/baf5dbd84a874be99dfa96c6af52dab1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066583&amp;x-signature=9I5ZVqosK5wdbEhcQC6NE3Fa%2BDY%3D" alt="图片" loading="lazy"/></p>
<p>机器学习与决策控制领域的知名专家、UC Berkeley 副教授、Physical Intelligence 联合创始人 Sergey Levine 表示，搭载这个模型的机器人已经可以在公司的办公室里为人们制作拿铁、美式和意式咖啡了。</p>
<p>Sergey Levine 表示，通过对 π*0.6 模型进行微调，可以使其在多种任务上表现出色，除了处理衣物之外的任务都可以达到 90% 成功率，而且任务处理的效率也大大提升了。</p>
<p>在 Physical Intelligence 的一篇博客中，工程师们详细介绍了 π*0.6 的机制与性能。</p>
<p>想一下，要组装一个纸箱需要哪些步骤？</p>
<p>作为人类，想要快速高效地完成这个任务，首先你应该会请人教你一些基础知识：哪些方法有效，常见的错误有哪些，以及正确的技巧是什么。其次，一位优秀的老师不仅会演示如何操作，还会指导你，纠正你自行操作时犯的错误。但是，仅仅依靠指导是不够的：最终熟能生巧，成为纸箱组装大师的第三步是反复练习，直到熟练掌握，成为一种本能反应。</p>
<p>过去一年，我们在机器人学习领域看到的许多令人瞩目的成果，都仅仅使用了第一步 —— 通过人提供的演示来训练机器人。仅凭这一步，让机器人成功完成一半的任务并不难，但要让它每次都成功却非常困难，更不用说在复杂的实际任务中达到人类水平的效率了。这是一个很大的问题，因为实际的机器人任务需要一个能够可靠且快速运行的系统。</p>
<p>基于这样的思考，Physical Intelligence 开发了一种名为 Recap（基于优势条件策略的经验与纠错强化学习）的方法，它实现了所有三个步骤：通过演示训练机器人、通过纠错指导机器人，并使其能够从自主经验中改进。作者使用 Recap 改进了最新版本的视觉 - 语言 - 动作 (VLA) 模型 π(0.6)，使其能够稳健高效地执行复杂任务，例如制作意式浓缩咖啡、组装纸箱和折叠各种衣物。</p>
<p>这款经过强化学习训练后的模型称为 π*(0.6)，利用 Recap 在自主经验上训练 π*(0.6) 可以将一些最困难任务的吞吐量提高一倍以上，并将失败率降低 2 倍或更多。这使得 π*(0.6) 达到了实际应用所需的鲁棒性水平：它能够连续运行一整天制作意式浓缩咖啡，在新家中连续数小时不间断地折叠各种衣物，以及组装工厂实际包装所需的纸箱。</p>
<p>模仿是远远不够的</p>
<p>我们可能会想，为什么 VLA 仅依靠监督学习（即模仿）时难以持续取得成功，而监督学习在 LLMs 和其他机器学习系统中却效果很好。这个问题的原因实际上已经被很好地理解了，不过此前一直缺乏实用的解决方案。</p>
<p>当一个通过模仿训练的 VLA 控制机器人时，它会像任何模型一样犯一些小错误 —— 它可能把夹爪放在略微错误的位置、抓取失败，或撞倒一个物体。</p>
<p>由于机器人在真实的物理环境中进行交互，这些错误会产生与训练数据略有不同的情境，而在这些情境中，错误是会累积的。机器人更可能犯下另一个更大的错误，小错误是可以修复的，但累积错误会导致失败。</p>
<p>对于产生静态输出的 AI 系统（例如 LLMs）来说，这并不是一个大问题；但在模型作为一个持续与外部环境互动的控制策略时（例如现实世界中的机器人），这就是一个特定的问题。实际上，这意味着，虽然让 VLA 偶尔完成某项任务相对容易，但让它们可靠，稳定的实现成功却非常困难。</p>
<p>如果我们使用来自 VLA 自身行为的额外数据，本质上让它在真实世界中纠正它实际犯下的错误，就像人类可以通过练习在某项任务上不断提高一样，通过允许 VLA 反复练习，就可以解决累积错误的问题。</p>
<p>但对于这种类型的经验，能用什么作为真实标签？如果我们训练策略只是去复制它之前做过的事情，那我们只是教会它继续犯相同的错误。让模型能够从经验中学习的关键，是从糟糕的经验数据中提取出良好的训练信号。</p>
<p>纠正式指导与强化学习</p>
<p>Recap 使我们能够从「质量较差」的经验数据中获得良好的训练信号，途径包括两种：</p>
<ul>
<li>
<p>纠正式指导（coaching with corrections）：由专家展示机器人如何修复错误或做得更好；</p>
</li>
<li>
<p>强化学习（reinforcement learning）：机器人依据整个任务过程的最终结果自行判断哪些行为更好或更差，并通过迭代学习强化好的行为、避免不好的行为。</p>
</li>
</ul>
<p>纠正式指导要发挥作用，专家远程操作人员需要提供纠正信号，展示如何从机器人在真实世界中实际犯下的错误中恢复。</p>
<p>实践中，这意味着运行当前最强的策略，并在机器人出错时通过手动远程接管（teleoperation）控制。这种干预可以作为监督信号使用，但与用于训练原始策略的演示不同，该干预针对的正是策略实际将机器人带入的那些状态，从而解决错误累积的问题。</p>
<p>然而，仅依靠纠正式指导是有限的：这类监督的质量受制于人类是否能及时判断应当介入以及是否能提供高质量的纠正。对于明显或严重的错误，这种方式可以奏效，但若想获得最佳性能 —— 即快速、可靠且一致地完成任务 —— 机器人必须能够自主学习。</p>
<p>从任务结果中通过强化学习进行学习的核心挑战在于信用分配（credit assignment）：即理解机器人执行的哪些动作导致了好的结果，哪些导致了坏的结果。</p>
<p>如果机器人以错误的方式抓起意式咖啡机的手柄（portafilter），它在插入时可能会遇到困难。错误并不发生在插入阶段，而是在最初的抓取动作上。一个正确的信用分配方法应当将该失败归因于抓取错误，即使失败只是在之后的步骤中表现出来。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8ce71cbbe8eb423a98407a0c78643ea2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066583&amp;x-signature=E%2BSEauDn1w5J%2FMK0HP0U6HehzB4%3D" alt="图片" loading="lazy"/></p>
<p>仅通过模仿学习训练的基础模型在将手柄插入意式咖啡机时会遇到困难。导致失败的错误可能发生在更早的阶段。</p>
<p>信用分配是强化学习中的一个关键挑战。Recap 通过训练一个价值函数来解决这一问题。</p>
<p>举例来说，在象棋这类游戏中，智能体只有在赢得比赛时才会获得奖励，那么价值函数就会根据当前棋局预测智能体获胜的概率。使价值函数上升的动作是应该被鼓励的好动作；而使价值函数下降的动作则应被抑制。</p>
<p>下图展示了价值函数在任务执行过程中所做的预测。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae931bc9632d4eb08c8173d47cc6bac8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066583&amp;x-signature=Ef0SeYr2qso40%2BI3zQc1GXapNFM%3D" alt="图片" loading="lazy"/></p>
<p>在一个回合中不同时间点的值函数预测。这个值函数预测完成任务的（负）步数。请注意，当机器人取得进展时预测会增加，而当进展很小时预测会保持平稳。</p>
<p>在训练好价值函数之后，我们需要利用它来得到一个更好的策略。实现这一点的方法有多种，但我们需要的是一种可扩展、并且能够与大型 VLA 模型结合使用的方法。</p>
<p>在 Recap 中，Physical Intelligence 将 VLA 在价值变化上调整：使用所有训练数据（包括好的和不好的动作），同时告诉 VLA 哪些动作是好是坏。由于模型在拥有大量数据时通常具有最佳的泛化能力，在训练中保留全部数据并仅仅将价值变化注释作为输入，是一个非常具有吸引力的选择。</p>
<p>在强化学习中，这种「价值变化」被称为优势（advantage）。在执行阶段，我们只需让这个按优势条件化的 VLA 去选择高优势的动作，从而得到一个比训练数据本身更优的策略。</p>
<p>面向真实世界任务</p>
<p>Physical Intelligence 使用 Recap 来训练 π*(0.6) 模型，使其能够执行多项真实世界应用。π*(0.6) 是基于 π(0.6) 模型训练得到的，而 π(0.6) 则是早期 π(0.5) 模型的改进版本。</p>
<p>它采用了稍大一些的骨干网络，并能够处理更加异质化的提示与条件信息，如下图所示。关于 π(0.6) 模型架构的更详细描述，请参阅模型卡。</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwebsite.pi-asset.com%2Fpi06star%2FPI06_model_card.pdf" target="_blank" title="https://website.pi-asset.com/pi06star/PI06_model_card.pdf" ref="nofollow noopener noreferrer">website.pi-asset.com/pi06star/PI…</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b71e5a81c4a40958d640983a1770305~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066583&amp;x-signature=XYTBQ%2FcrlJxEBDb7xSAi4dF8h9Q%3D" alt="图片" loading="lazy"/></p>
<p>Physical Intelligence 研究了三个应用场景：制作意式咖啡饮品、折叠多种类型的衣物，以及组装包装用的纸盒。Recap 的第一阶段，是使用离线强化学习（offline RL）对 π*(0.6) 模型进行预训练，这与基础 π(0.6) 和 π(0.5) VLA 所采用的标准监督学习方法形成对比。在此基础上，再通过示范数据对 π*(0.6) 进行任务级微调，随后利用机器人在真实环境中收集的额外数据继续通过强化学习进行训练，其中包括专家提供的纠正（用于修复大的错误）以及来自奖励的反馈（用于根据自主经验进一步改进）。</p>
<p>下方的图表对比了不同阶段模型的性能：监督学习训练的基础 π(0.6) 模型；使用离线强化学习预训练的基础 π*(0.6) 模型（即 Recap 的第一阶段）；通过示范对每个任务微调后的 π*(0.6) 模型；以及结合机器人真实执行经验进行微调后的最终 π*(0.6) 模型。对每个任务，Physical Intelligence 测量了吞吐量（每小时成功完成任务的次数）以及成功率。</p>
<p>值得注意的是，对于一些最困难的任务（如制作意式咖啡），加入机器人真实执行经验后，吞吐量和成功率都提升了超过两倍。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4d7ce49edf974c298144124743496107~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066583&amp;x-signature=B2yc%2Bi2q9mCPaA6DtK3%2B%2FQPKhu8%3D" alt="图片" loading="lazy"/></p>
<p>Recap 在所有任务中都显著提升了吞吐量，并且通常还能带来成功率的大幅提升。</p>
<p>从质量上看，最终的 π*(0.6) 模型在结合示范数据和机器人自身经验学习后，能够熟练掌握每个应用任务。下面的视频展示了这些任务的一些评估亮点。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2c8ee8a8d9d4fe49fe37df2cc78d92b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066583&amp;x-signature=Efz9%2B%2BnMoxKkfypTDU34HW514Lw%3D" alt="图片" loading="lazy"/></p>
<p>π*(0.6) 在每项真实世界任务中的质性示例。π*(0.6) 能够应对多种条件，并从错误中恢复。</p>
<p>每一项任务都包含许多挑战，使得实现高吞吐量的自主执行变得困难。</p>
<p>箱子组装任务需要执行高度复杂的物理操作 —— 在保持箱体结构的同时折叠箱盖。此外，该任务需要反复执行并处理各种边缘情况，正如上方视频中所示：有时扁平的纸箱会粘在一起，导致机器人一次抓起多个箱子，此时它必须将多余的箱子放回去；有时在出现错误后还需要重新折叠箱子。</p>
<p>衣物折叠任务则需要处理高度的多样性，并在不同初始条件和不同衣物种类之间实现泛化。这非常困难，因为不仅不同的衣物需要不同的折叠策略，不同材质的布料也具有不同的动力学特性。</p>
<p>最后，意式咖啡制作任务需要处理一个跨度非常长的操作序列，新模型使用了类似于之前 π(0.5) 模型的高层语言策略。该任务还涉及倒液体、判断咖啡研磨机和意式咖啡机何时完成工作、以及在制作结束后用布巾清洁机器。</p>
<p>这些步骤对当前最先进的 VLA 模型来说都极具挑战性，而 π*(0.6) 能够以超过 90% 的成功率完成这些任务。</p>
<p>下一步？</p>
<p>目前，机器人基础模型主要依赖人为收集的示范数据（例如通过远程操作）。这种方式使训练过程简单直接，但也带来了一个严重的障碍：数据需要大量人工投入，模型的速度与可靠性受限于人类的操作水平，而机器人本身无法通过经验不断变得更好。像 Recap 这样的方法在原理上能够解决这些限制，因为它还能直接从机器人自身的经验中学习。</p>
<p>随着机器人在真实世界中的部署越来越广泛，从经验中学习可能会成为一种重要的数据来源，并成为实现高性能模型不可或缺的组成部分。</p>
<p>就像人类通过「指导 — 辅导 — 练习」的组合方式成长一样，机器人同样将从多种不同的数据来源中学习。但这些数据来源会承担不同的角色：专家示范用于定义新的行为，纠正式指导用于改进策略，而自主经验 —— 可能是规模最大的数据来源 —— 则用于打磨行为，使其最终有可能达到超越人类的表现。</p>
<p>参考链接：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pi.website%2Fblog%2Fpistar06%255B%23where%255D()-are-we-headed" target="_blank" title="https://www.pi.website/blog/pistar06%5B#where%5D()-are-we-headed" ref="nofollow noopener noreferrer">www.pi.website/blog/pistar…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[马斯克Grok 4.1低调发布！通用能力碾压其他一切模型]]></title>    <link>https://juejin.cn/post/7573890735578529802</link>    <guid>https://juejin.cn/post/7573890735578529802</guid>    <pubDate>2025-11-18T10:30:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573890735578529802" data-draft-id="7573988811916247090" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="马斯克Grok 4.1低调发布！通用能力碾压其他一切模型"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-11-18T10:30:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            马斯克Grok 4.1低调发布！通用能力碾压其他一切模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:30:35.000Z" title="Tue Nov 18 2025 10:30:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>几乎毫无预兆，马斯克人工智能公司 xAI 发布了最新模型 Grok 4.1。</p>
<p>就在刚刚，xAI 宣布，Grok 4.1 已经向所有用户开放，可以在 Grok 官网、X 以及 iOS 和 Android 应用中使用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0b844101a3594d75bb6022df3c2373df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=4Cqbu%2Fwpr9pVtRknWAJOX1qesx4%3D" alt="图片" loading="lazy"/></p>
<p>Grok 4.1将立即在 Auto 模式中推送，并可在模型选择器中手动选择。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b60ee01e9b404475b5aba85467730c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=oTrf4zhHRHhKutXm0rxTaR7caO8%3D" alt="图片" loading="lazy"/></p>
<p>此次，Grok 4.1 将在真实世界可用性方面带来显著提升，尤其是在创造力、情感互动和协作交互方面表现出色。Grok 4.1 对细微意图的感知能力更强，与用户对话更加吸引人，整体人格也更连贯，同时完全保留了前代模型强大的智能与可靠性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55ddd725adf74b11b465b770714b331b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=vm%2Beoo2n%2Ba%2B1oAndakPJ5eVRPIE%3D" alt="图片" loading="lazy"/></p>
<p>马斯克在 x 上宣传一波自家模型。</p>
<p>为实现这些提升，xAI 在支撑 Grok 4 的同一套大规模强化学习基础设施上进一步优化了模型的风格、个性、助人性和对齐性。并且，为了优化这些不可直接验证的奖励信号，xAI 开发了全新的方法，能够利用前沿的智能体式推理模型作为奖励模型，从而可以大规模自主评估并迭代输出结果。</p>
<p>与此前的线上生产模型相比，Grok 4.1 在对比评估中有 64.78% 的概率被用户偏好选择。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4dcd91aa78964f02828c77cb7685a16f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=0RyrGnPSiiXvTbF%2B6SUZ8ZXApVU%3D" alt="图片" loading="lazy"/></p>
<p>接下来看 Grok 4.1 的能力特征。</p>
<p>SOTA 通用能力</p>
<p>Grok 4.1 在盲测的人类偏好评估中树立了全新的标杆。</p>
<p>在 LMArena 的 Text Arena 排行榜上，Grok 4.1 的推理模式（代号：quasarflux）以 1483 的 Elo 分数位居总榜首位，领先最高的非 xAI 模型整整 31 分。</p>
<p>Grok 4.1 的非推理模式（代号：tensor）无需使用思维 token 便能即时响应，在排行榜上以 1465 Elo 分数位居第二。即便不启用推理，Grok 4.1 也超越了其他所有模型在启用完整推理配置下的表现。</p>
<p>与 Grok 4 相比，Grok 4.1 的整体表现实现了大幅超越 ，前者此前的总排名仅为第 33 名。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f16f9f7ec04a0da2e0896c2e9561ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=ROe4bkPKux4pFyQz%2FVIXpOAaBDw%3D" alt="图片" loading="lazy"/></p>
<p>情感智能</p>
<p>为了评估模型在个性与人际互动能力方面的进展，xAI 在 EQ-Bench3 上对 Grok 4.1 进行了测试。</p>
<p>EQ-Bench 是一个由大语言模型评判的测试，用于评估主动情绪智能，包括情绪理解、洞察力、同理心以及人际交往技能。测试集包含 45 个具有挑战性的角色扮演场景，其中大多数由预先编写的三轮对话提示组成。该基准通过多项标准验证模型的回答质量，以评估模型表现。此外，它还通过成对对比的方式，为排行榜中的每个模型计算归一化的 Elo 分数。</p>
<p>xAI 使用官方基准仓库运行测试，并报告评分细则（rubric score）与归一化 Elo 分数。所有分数均在遵循基准要求的条件下计算：使用默认采样参数、指定的评判模型（Claude Sonnet 3.7），并且不添加 system prompt。</p>
<p>结果显示，Grok 4.1 的推理模式和非推理模式位居榜单前两名。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb20cbc5d0874a41b5ffbd384303efca~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=3EGpUXBspq31AGKxpW53R3CT4tU%3D" alt="图片" loading="lazy"/></p>
<p>以下示例展示了 Grok 4.1 对情绪类提示的回应方式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41dde2d05f38484ea824284d420ee7a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=vAHJ7rsrr0wwnEmechI7YwFbwBw%3D" alt="图片" loading="lazy"/></p>
<p>创意写作</p>
<p>xAI 还在 Creative Writing v3 基准测试上评估了 4.1 系列模型的表现。</p>
<p>在该基准中，模型需要针对 32 个不同的写作提示生成回答，并进行 3 轮迭代。与 EQ-Bench 类似，评分同时基于评分细则（rubrics）和模型对战的归一化 Elo 分数进行计算。</p>
<p>结果显示，Grok 4.1 的推理模式和非推理模式位居基准测试第二和第三名，仅次于早期 GPT 5.1。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19a8047a80c4433981049c8c8b857362~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=wlDcVgLfG07AJe9%2BRXMj257T%2BPY%3D" alt="图片" loading="lazy"/></p>
<p>以下示例展示了 Grok 4.1 在创意写作提示下的回答方式：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de820a06b4024c079d5c287d971d2e24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=hFuhayXLZvZeA%2FeanQqvnaHY1zA%3D" alt="图片" loading="lazy"/></p>
<p>减少幻觉</p>
<p>配备搜索工具的 Fast（非推理）模型能够提供即时答案，但由于推理深度受限、工具调用次数有限，它们更容易出现事实性错误。</p>
<p>在 Grok 4.1 的后训练过程中，xAI 着重降低了信息查询类提示的事实幻觉。随后，xAI 在抽样的生产环境信息查询提示中观察到了幻觉率的显著下降。</p>
<p>xAI 使用来自生产流量的真实信息查询请求，按类别分层抽样评估模型幻觉率。同时，也评测了 FActScore —— 一个包含 500 个关于不同人物的传记类问题的公共基准测试。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5b7d51746a443569438d0dc42e7d139~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=tVBi1VDTkn%2B4T2XcEE9sFgZHpVk%3D" alt="图片" loading="lazy"/></p>
<p>更多 Grok 4.1 的技术细节请参阅模型卡：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cf8541313064a3f956bbf61a7b9d566~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764066635&amp;x-signature=gALyFvA2LRt%2BaFcIZjeHGeMV%2B0w%3D" alt="图片" loading="lazy"/></p>
<p>模型卡地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdata.x.ai%2F2025-11-17-grok-4-1-model-card.pdf" target="_blank" title="https://data.x.ai/2025-11-17-grok-4-1-model-card.pdf" ref="nofollow noopener noreferrer">data.x.ai/2025-11-17-…</a></p>
<p>官方博客：<a href="https://link.juejin.cn?target=https%3A%2F%2Fx.ai%2Fnews%2Fgrok-4-1%255B%23silent%255D()-rollout-november-114-2025" target="_blank" title="https://x.ai/news/grok-4-1%5B#silent%5D()-rollout-november-114-2025" ref="nofollow noopener noreferrer">x.ai/news/grok-4…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如果让我从头再来学习并发编程]]></title>    <link>https://juejin.cn/post/7573876900230627391</link>    <guid>https://juejin.cn/post/7573876900230627391</guid>    <pubDate>2025-11-18T10:44:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573876900230627391" data-draft-id="7573506713867190323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如果让我从头再来学习并发编程"/> <meta itemprop="keywords" content="Java,性能优化,设计模式"/> <meta itemprop="datePublished" content="2025-11-18T10:44:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="桦说编程"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如果让我从头再来学习并发编程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    桦说编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:44:59.000Z" title="Tue Nov 18 2025 10:44:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>大学时，我学习了一本国外的教科书，书名叫做《计算机网络——自顶向下方法》，这本书改变了我看待学习的角度。学习的顺序不是一成不变的，常规的路线通常从底层学习，这本书从应用层面入手，逐步讲解到底层，以一种对常规学习路线相反的方向学习，在我看来恰恰学习计算机网络最轻松上手的路径。很多时候我们追求一步到位，鞭辟入里的理解，反而忽略对于初学者，最佳的学习路线往往是兴趣与试错、感性和求索交织的，认识是逐渐深刻的。</p>
<p>知之者往往陷入知识的诅咒，知道的内容很难遗忘，甚至忘记了自己也是从不理解到懂的。有些书籍和文章对于初学者来说是不友好的，它们往往默认你掌握了很多前置知识。如果让我重头学习并发编程，我希望有类似自顶向下的学习路线。</p>
<p>以下是我总结的学习路线，感兴趣的朋友可以参考：</p>
<p>一、基础（并发与并行，性能与瓶颈，SIMD，MISD，进程、线程模型，虚拟线程，生命周期，上下文切换的开销有多大，跳过同步器、JMM等底层内容）<br/>
二、常用的并发模式</p>
<ol>
<li>单线程（单线程实现简单且高效，很多多线程问题可以使用单线程解决）</li>
<li>ThreadLocal/ScopedValue/TTL</li>
<li>消息队列（生产者消费者模式）</li>
<li>结构化并发（任务编排、资源安全管理、可观测性、快速失败思想）</li>
<li>函数式解决方案（纯函数、不可变对象、CopyOnWrite）</li>
<li>执行器与线程池（分离任务与执行的思想、资源管理与生命周期、多种执行器的特点(缓存执行器、固定线程执行器、线性执行器、直接执行器)、舱壁模式）</li>
<li>异步编程：CompletableFuture/ListenableFuture(函数式思想、回调地狱、任务编排/拆分、取消传播）</li>
<li>调度器（ScheduledExecutorService（常常被忽略却很有用），资源管理与调度算法)</li>
<li>延迟计算与记忆化，缓存与SingleFlight模式</li>
<li>ForkJoin框架，并行流，分治思想</li>
<li>EventLoop</li>
</ol>
<p>三、并发集合类，使用与陷阱，阻塞队列<br/>
四、原子操作与原子类<br/>
五、锁（临界区、锁接口设计、锁的特点、可重入锁、读写锁、等待队列、条件队列，原生隐式同步锁，选择/构造线程安全的数据结构）<br/>
六、同步器和相关类（信号量、mutex、几种栅栏）<br/>
七、活性问题：死锁、饥饿、活锁，如何避免<br/>
八、性能优化、测试、监控、debug<br/>
九、底层实现原理（可见性、原子性、有序性）JMM，volatile实现（可见性窗口技巧），竞争条件，happens-before，DCL，VarHandler</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[啊？微博7800美元训的大模型，数学能力超了DeepSeek-R1]]></title>    <link>https://juejin.cn/post/7573864324713037876</link>    <guid>https://juejin.cn/post/7573864324713037876</guid>    <pubDate>2025-11-18T09:12:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573864324713037876" data-draft-id="7573708620870484020" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="啊？微博7800美元训的大模型，数学能力超了DeepSeek-R1"/> <meta itemprop="keywords" content="DeepSeek,AI编程"/> <meta itemprop="datePublished" content="2025-11-18T09:12:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            啊？微博7800美元训的大模型，数学能力超了DeepSeek-R1
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:12:07.000Z" title="Tue Nov 18 2025 09:12:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当整个 AI 行业陷入 “参数竞赛” 的狂热时，<strong>微博 AI</strong> 交出了一份出乎意料的答卷，为沸腾的大模型战场开辟了一条充满想象力的新路径。</p>
<p>近日，微博正式发布首个自研开源大模型 <strong>VibeThinker</strong>，这个仅拥有 15 亿参数的 “轻量级选手”，在国际顶级数学竞赛基准测试上击败了参数量是其数百倍的、高达 6710 亿的 DeepSeek R1 模型。</p>
<p>更令人瞩目的是，其单次 “后训练” 的成本仅 <strong>7800 美元</strong>，对比 DeepSeek-R1 和 MiniMax-M1 等成本直接降低了几十倍。</p>
<p>这一突破不仅重新定义了大模型的技术评价标准，更有望推动 AI 产业从 “规模竞赛” 转向“效率革命”。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7a59affe4dde4148b88ef0ba6dc61ef9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061927&amp;x-signature=IC1buZbQ0ls%2FLvC%2FNUjegmZWFQo%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">行业黑马：小模型打破参数崇拜</h2>
<p>在 AI 发展史上，参数量曾被视为衡量模型能力的核心指标。</p>
<p>行业普遍认为，复杂推理能力需要 1000 亿以上参数才能涌现，而小模型则因无法处理高难度问题被视为 “天生不足”。</p>
<p>但如果从小模型入手，通过巧妙的训练策略，能否挖掘出隐藏的推理能力？</p>
<p>微博自研开源大模型 VibeThinker，给出了行业一个肯定的答案。</p>
<p>当大多数 AI 厂商仍遵循着 “规模扩大即智能提升” 的 Scaling Law 法则时，微博 AI 研发人员转而优化模型结构和训练范式，并创新提出了 <strong>“频谱到信号原理”（SSP）方法训练</strong>，创造出了一个仅拥有 15 亿参数的 “轻量级选手”，但在 AI 竞技场上战胜了超越其数百倍体量的 “巨人”。</p>
<p>VibeThinker 一经发布，立即引起了全球 AI 研究界的广泛关注，因其在一系列涵盖数学、编码的权威基准测试中，交出了一份出乎意料的答卷：</p>
<h6 data-id="heading-1"><strong><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/04aa5cd0871c4584ade49bb031827622~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061927&amp;x-signature=mkEvGgyjTUN48nHTqdei7pTl3rg%3D" alt="" loading="lazy"/>△</strong>HuggingFace 官方主动下场发文宣传 VibeThinker 论文</h6>
<p>在 AIME24、AIME25 以及 HMMT25 三个高难度数学测试集上的表现，VibeThinker 超越了参数量超其 400 倍的模型 DeepSeek-R1-0120 版本_（模型大小 671B）_，与规模为 456B 的 MiniMax-M1 效果接近或相当，甚至媲美 Gemini 2.5 flash 和 Claude Opus 4。</p>
<p>此外，在 LiveCodeBench v6_（编程算法题测试集）_中的成绩，VibeThinker 成功追平参数量数超其数十倍的模型，比如欧洲领先 AI 企业 Minstral.AI 的深度思考模型 Magistral-Medium-2506 版本。</p>
<p>VibeThinker 雄辩地证明，通过精巧的算法设计和训练策略，一个小规模模型完全有潜力在复杂的逻辑推理任务上，达到甚至超越那些体量庞大数百倍的巨型模型，更为 AI 产业的成本结构、技术路线和资本布局带来了全新的思考路径。</p>
<p>需要说明的是，VibeThinker 目前发布的版本尚处于实验性版本，其研发重点主要集中于极大强化小模型复杂数学与竞赛编程等方面的能力，其在日常聊天等能力还没有做过针对性训练优化，所以暂不适合作为日常聊天工具进行互动，更适用于<strong>数学和代码</strong>等高智能应用场景。</p>
<h2 data-id="heading-2">成本革命：7800 美元门槛重塑产业生态</h2>
<p>训练成本一直是制约 AI 技术普及的关键瓶颈，VibeThinker 的成就不仅在于惊艳的性能，更在于其极致的成本效益。</p>
<p>根据公开数据，2025 年主流大模型单次后训练_（Post-Training）_成本普遍在数十万美元级别。</p>
<p>上海 AI 企业 MiniMax 于今年 6 月发布的 M1 模型，使用 512 块 H800 GPU 训练三周，租赁成本约 53.5 万美元，创始人发文表示：“第一次感觉到大山不是不能翻越。”</p>
<p>今年 9 月，AI 初创公司 DeepSeek_（深度求索）_的论文登上《自然》杂志。论文首次揭示了训练 R1 的成本：仅为 29.4 万美元。这不包括 DeepSeek 公司在开发 R1 所基于的基础 LLM（即 DeepSeek-V3）上花费的约 600 万美元，但总成本仍然远低于竞争对手模型被认为花费的数千万美元。</p>
<p>在这样的行业背景下，VibeThinker 整个后训练过程_（包括 SFT 和 RL 阶段）_总共只花费了约 3900 个 GPU 小时。按照当时的市场租赁价格，总计算成本仅 <strong>7800 美元</strong>。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/de4b4818825547d8bd4890a3433f90e7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061927&amp;x-signature=35reAQHx62rIIVmSIdApDIrxXXg%3D" alt="" loading="lazy"/></p>
<p>这也意味着，其用不到 8000 美元的成本，达到了需要花费 30 万、甚至 50 万美元才能企及的性能水平，成本效益比达到了惊人的 <strong>30 到 60 倍</strong>。</p>
<p>这种成本上的显著优势，也意味着强大的 AI 推理能力不再是少数科技巨头的专利，原本被巨头垄断的技术资源得以普惠，更多中小型公司、研究机构和大学，都有机会参与到前沿 AI 创新开发中来，极大地促进了 AI 研究的普惠化，推动整个行业朝着更开放、更多元、更具活力的方向发展。</p>
<h2 data-id="heading-3">应用落地：微博 AI 生态多点开花</h2>
<p>技术突破的最终价值在于<strong>应用落地</strong>。</p>
<p>微博积极拥抱人工智能发展趋势，全面促进 AI 技术在多项业务场景的落地。</p>
<p>2024 年，微博自主研发 <strong>“知微” 大语言模型</strong>，并成功通过备案，更陆续推出微博智搜、内容总结、AI 互动号等前沿功能，优化用户体验，提升内容生产和互动效率。</p>
<p>基于自研的 “知微” 大模型，微博构建了适配微博场景的 AI 应用生态，并创造了两大顶流 AI 产品：</p>
<ul>
<li>
<p>一是<strong>微博智搜</strong>，它通过深度分析平台内海量优质内容，构建可信知识图谱，实现 “精准捕捉用户需求、理解情感与场景” 的突破性体验，6 月智搜月活跃用户突破 5000 万；</p>
</li>
<li>
<p>二是<strong>评论罗伯特</strong>，作为 AI 互动账号，它从毒舌风格起步，逐渐进化出温情与聪明版本，成为广大用户 “又爱又恨” 的交流对象，全网粉丝近 200 万，展现了 AI 评论助手的另一种可能性。</p>
</li>
</ul>
<p>随着自研大模型 VibeThinker 取得突破，更标志着微博 AI 战略迈入新阶段。</p>
<p>立足于自研大模型 VibeThinker，微博的未来规划凸显了鲜明的 “数据赋能” 路径。公司计划深度融合其在心理等垂直领域积累的独特数据资产，目标是打造一个更洞悉公众情绪、更能服务社会化需求的专属模型。</p>
<p>微博不仅是在优化一个大模型，更是在解锁其数据生态的深层价值，以提供更精准、更懂用户心理状态的下一代社交服务。</p>
<p>VibeThinker 的强大技术能力，或将成为驱动微博 AI 应用 “多点开花” 的核心引擎，深度融入平台全业务生态。</p>
<p>未来，VibeThinker 有望在微博智搜等核心 AI 产品中落地，不仅能持续提升用户使用体验，更有望打破场景边界，裂变出兼具社交属性与智能服务的下一个 “社交超级生态”。</p>
<p>此外，VibeThinker 的技术突破有望大幅降低微博 AI 应用成本。</p>
<p>无论是智能搜索的算力损耗，还是实时互动场景的 AI 响应成本，都将得到高效优化，让平台在规模化投入 AI 能力时无需承担过高的资源压力，进一步释放微博的生态创新能力，为用户带来更丰富、更便捷的智能体验。</p>
<ul>
<li>本文系量子位获授权刊载，观点仅为原作者所有。</li>
</ul>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[App Store 上架条件全解析，开发者必备资质、技术要求与跨平台工具指南]]></title>    <link>https://juejin.cn/post/7573863952116269062</link>    <guid>https://juejin.cn/post/7573863952116269062</guid>    <pubDate>2025-11-18T09:22:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573863952116269062" data-draft-id="7573855399717191699" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="App Store 上架条件全解析，开发者必备资质、技术要求与跨平台工具指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T09:22:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS开发上架哦"/> <meta itemprop="url" content="https://juejin.cn/user/3336394949004844"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            App Store 上架条件全解析，开发者必备资质、技术要求与跨平台工具指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3336394949004844/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS开发上架哦
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:22:54.000Z" title="Tue Nov 18 2025 09:22:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于许多首次准备发布 iOS 应用的开发者来说，“满足 App Store 上架条件” 比写代码更让人焦虑。
有人认为只要上传 IPA 就好，有人认为必须要用 Mac，还有人被证书、截图、隐私政策等要求卡得寸步难行。</p>
<p>事实上，App Store 上架并不是神秘流程，而是由一系列明确且严格的条件组成。
只要理解这些条件背后的逻辑，准备工作会非常高效；
甚至在 <strong>Windows 或 Linux</strong> 环境下，也可以顺利完成整个上架流程。</p>
<p>本文将以开发者实战角度，拆解 <strong>App Store 上架必须满足的条件</strong>，并给出在不同系统环境下的可行实现方案。</p>
<hr/>
<h2 data-id="heading-0">一、App Store 上架的基本条件是什么？</h2>
<p>苹果对于应用上架有明确要求，总体可分为三类：</p>
<h3 data-id="heading-1"><strong>1. 开发者资质条件</strong></h3>
<p>必须满足：</p>
<ul>
<li>购买 Apple Developer Program（$99/年）</li>
<li>提供真实的开发者身份信息（个人或企业）</li>
<li>通过 App Store Connect 创建应用项目</li>
</ul>
<h3 data-id="heading-2"><strong>2. 技术条件</strong></h3>
<p>包括：</p>
<ul>
<li>合法签名（证书 + 描述文件）</li>
<li>生成正确的 iOS IPA 文件</li>
<li>应用可在真机稳定运行</li>
<li>权限用途说明完整（Info.plist）</li>
<li>应用截图满足规范</li>
</ul>
<h3 data-id="heading-3"><strong>3. 审核条件</strong></h3>
<p>审核主要检查：</p>
<ul>
<li>功能是否完整</li>
<li>是否存在隐私违规</li>
<li>页面内容是否真实</li>
<li>是否使用安全的登录与支付方式</li>
</ul>
<p>任何一个环节不符合要求，都可能导致拒审。</p>
<hr/>
<h2 data-id="heading-4">二、开发者账号：上架的基础条件</h2>
<p>申请 App Store 上架必须满足以下账号条件：</p>
<ol>
<li><strong>加入 Apple Developer Program（付费）</strong></li>
<li>账号状态正常（无未支付费用或合规问题）</li>
<li>能访问 App Store Connect 和证书管理页面</li>
</ol>
<p>企业账号（Company）可以邀请多个成员协作，而个人账号（Individual）权限比较集中。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c27b0384d34c444396e8515c6582e9e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764062574&amp;x-signature=fNeV9nFvV7TdqzL78REUOxRixJY%3D" alt="账号" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5">三、证书与描述文件：技术条件的核心</h2>
<p>iOS 应用发布需要满足完整的签名体系，包括：</p>
<ul>
<li><strong>iOS Distribution Certificate</strong>（发布证书）</li>
<li><strong>App Store Provisioning Profile</strong>（描述文件）</li>
<li><strong>App ID（Bundle Identifier）</strong></li>
</ul>
<p>没有正确证书，App Store 不会接受上传。</p>
<h3 data-id="heading-6">传统方式</h3>
<p>在 macOS 上使用钥匙串助手生成 CSR 再生成证书。</p>
<h3 data-id="heading-7">跨平台方式（无需 Mac）</h3>
<p>如今开发者可在 Windows 上生成证书，使用开心上架（Appuploader）：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49fd295050104dcf8f475d07615e3f01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764062574&amp;x-signature=fURB1r5v5ZZfAUBEfwYjuqGpq4U%3D" alt="证书" loading="lazy"/></p>
<p>即可生成：</p>
<ul>
<li>p12 证书</li>
<li>描述文件</li>
<li>与 Apple 账号匹配的配置</li>
</ul>
<p>支持跨电脑使用，适合团队协作。</p>
<hr/>
<h2 data-id="heading-8">四、IPA 构建要求：上架必须提供正确的包文件</h2>
<p>苹果要求上传 IPA 文件（iOS App 的打包格式），必须满足：</p>
<ul>
<li>版本号合法（遵循 major.minor.patch）</li>
<li>使用 App Store 描述文件签名</li>
<li>支持 64 位架构</li>
<li>无调试符号和开发者残留配置</li>
</ul>
<h3 data-id="heading-9">技术栈不同，IPA 构建方式不同：</h3>
<h4 data-id="heading-10"><strong>1. 原生 iOS（Xcode）</strong></h4>
<p>必须使用 macOS 构建。</p>
<h4 data-id="heading-11"><strong>2. uni-app / HBuilderX</strong></h4>
<p>可使用云端打包服务，Windows 和 Linux 均可生成 IPA。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/959f67ac27244185b5c6bed5d3b0e92f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764062574&amp;x-signature=6krt9RtBK9%2BbiQSbxqvqNGAIER0%3D" alt="hb打包" loading="lazy"/></p>
<h4 data-id="heading-12"><strong>3. Flutter / React Native / Cocos / Unity</strong></h4>
<p>常用云构建平台：</p>
<ul>
<li>Codemagic</li>
<li>Bitrise</li>
<li>GitHub Actions（Mac Runner）</li>
</ul>
<p>构建完成后即可获得 IPA。</p>
<hr/>
<h2 data-id="heading-13">五、IPA 上传条件：必须使用符合苹果协议的上传方式</h2>
<p>苹果规定 IPA 必须通过官方协议上传。</p>
<h3 data-id="heading-14">苹果官方方式（仅 macOS）</h3>





















<table><thead><tr><th>工具</th><th>说明</th></tr></thead><tbody><tr><td>Xcode Organizer</td><td>支持发布</td></tr><tr><td>Transporter</td><td>图形化 IPA 上传</td></tr><tr><td>altool</td><td>已废弃</td></tr></tbody></table>
<h3 data-id="heading-15">跨平台上传方式（Windows / Linux 可用）</h3>
<p>开发者可使用跨平台上传工具，例如：</p>
<h4 data-id="heading-16"><strong>开心上架（Appuploader）命令行上传 IPA</strong></h4>
<p>示例命令：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u ios@team.com -p xxx-xxx-xxx-xxx -c 2 -f ./output/app.ipa
</code></pre>
<p>可以满足苹果上传条件，且支持：</p>
<ul>
<li>新旧两种上传通道</li>
<li>全平台系统（Win/Mac/Linux）</li>
<li>自动化脚本</li>
<li>无需登录 Xcode 或 Transporter</li>
</ul>
<p>上传成功后，可在：</p>
<ul>
<li>TestFlight</li>
<li>App Store Connect “构建版本”</li>
</ul>
<p>看到构建记录。</p>
<hr/>
<h2 data-id="heading-17">六、App Store Connect 信息填写条件</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cc81dac899648ef87aef789e73c225a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgaU9T5byA5Y-R5LiK5p625ZOm:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764062574&amp;x-signature=wT2IzcGkX7eNYN1F1d4wZbJxSJY%3D" alt="asc" loading="lazy"/></p>
<p>苹果有严格的元数据要求，包括：</p>
<h3 data-id="heading-18"><strong>1. 截图要求</strong></h3>
<p>必须上传真实截图（不同设备尺寸）：</p>
<ul>
<li>6.5 寸 iPhone</li>
<li>5.5 寸 iPhone</li>
<li>iPad（如适配）</li>
</ul>
<h3 data-id="heading-19"><strong>2. 隐私政策 URL</strong></h3>
<p>必须是能访问的网页。</p>
<h3 data-id="heading-20"><strong>3. 权限用途说明</strong></h3>
<p>如应用使用：</p>
<ul>
<li>相机</li>
<li>麦克风</li>
<li>相册</li>
<li>定位</li>
</ul>
<p>必须在 Info.plist 中提供用途描述。</p>
<h3 data-id="heading-21"><strong>4. 分类、评级、联系方式</strong></h3>
<p>必须按照要求填写完整。</p>
<p>不符合条件会直接退回审核。</p>
<hr/>
<h2 data-id="heading-22">七、审核条件：功能完整、合规、可用</h2>
<p>苹果最重视以下几点：</p>

































<table><thead><tr><th>审核项</th><th>描述</th></tr></thead><tbody><tr><td>功能完整性</td><td>App 不可闪退、不可出现空白页</td></tr><tr><td>内容真实性</td><td>截图与功能必须一致</td></tr><tr><td>隐私合规</td><td>不得泄露用户数据</td></tr><tr><td>登录机制</td><td>必须规范（含 Apple 登录规则）</td></tr><tr><td>支付规范</td><td>不得绕过 IAP 机制</td></tr><tr><td>版权内容</td><td>不得侵犯版权（音乐、视频、图片等）</td></tr></tbody></table>
<p>审核人员会真机测试 App，如果表现异常，会直接拒绝。</p>
<hr/>
<h2 data-id="heading-23">满足条件后，上架流程变得简单</h2>
<p>一旦满足这些条件：</p>
<ul>
<li>有开发者账号</li>
<li>有合法证书</li>
<li>能构建 IPA</li>
<li>能上传 IPA</li>
<li>能填写完整元数据</li>
</ul>
<p>上架流程实际上是可控、可复用、可自动化的工程步骤。</p>
<p>无论是在 macOS、Windows 还是 Linux 环境中，都可以完成整个流程。
参考链接：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.applicationloader.net%2Ftutorial%2Fzh%2F1%2F1.html" target="_blank" title="https://www.applicationloader.net/tutorial/zh/1/1.html" ref="nofollow noopener noreferrer">www.applicationloader.net/tutorial/zh…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解析视觉：视觉识别的七层模型]]></title>    <link>https://juejin.cn/post/7573863952116285446</link>    <guid>https://juejin.cn/post/7573863952116285446</guid>    <pubDate>2025-11-18T09:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573863952116285446" data-draft-id="7573738017988280363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解析视觉：视觉识别的七层模型"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-18T09:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Juchecar"/> <meta itemprop="url" content="https://juejin.cn/user/284133851925070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解析视觉：视觉识别的七层模型
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/284133851925070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Juchecar
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:26:16.000Z" title="Tue Nov 18 2025 09:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>将视觉识别划分为一个从低到高、从具体到抽象的<strong>七层模型</strong>。这个模型不仅涵盖了已知过程，也自然引向了更低和更高的层次。</p>
<hr/>
<h3 data-id="heading-0">视觉识别的七层模型</h3>
<p>下面的流程图清晰地展示了这七个层次如何逐级演进，从底层的信号处理直至顶层的哲学思考：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A["第1层&lt;br&gt;物理信号检测"] --&gt; B["第2层&lt;br&gt;特征提取"]
    B --&gt; C["第3层&lt;br&gt;初步整合"]
    C --&gt; D["第4层&lt;br&gt;客体识别"]
    D --&gt; E["第5层&lt;br&gt;意义赋予"]
    E --&gt; F["第6层&lt;br&gt;审美判断"]
    F --&gt; G["第7层&lt;br&gt;哲学反思"]
</code></pre>
<h4 data-id="heading-1"><strong>层次 1 &amp; 2: 从物理信号到视觉特征</strong></h4>
<p>这是视觉处理的起点。首先，<strong>视网膜</strong>上的感光细胞（第1层）捕获光子，完成光电转换。随后，信号在视网膜内和<strong>初级视觉皮层</strong>进行初步加工（第2层），提取出线条、朝向、颜色、运动方向等最基本的视觉特征。此时，大脑处理的仍是“数据”，而非“形象”。</p>
<h4 data-id="heading-2"><strong>层次 3 &amp; 4: 从局部特征到完整客体</strong></h4>
<p>大脑开始将零散的特征“组装”起来。在<strong>V2、V4等视觉区</strong>（第3层），线段被组合成轮廓，颜色和形状被初步绑定。随后，在<strong>下颞叶皮层</strong>等高级区域（第4层），这些信息被整合成有意义的、独立的“客体”，如一张脸、一把椅子、一个单词。这时，你知道了“<strong>那里有什么</strong>”。</p>
<h4 data-id="heading-3"><strong>层次 5 &amp; 6: 从客体识别到价值判断</strong></h4>
<p>这是产生“意义”和“感受”的关键跃迁。当客体被识别后，大脑的<strong>记忆系统（海马体）、情绪系统（杏仁核）和奖赏系统</strong>被广泛激活（第5层），为你识别的客体赋予含义和情感价值——它是朋友的脸、是危险的蛇、是心爱的礼物。</p>
<p>在此基础上，一个更复杂的评估网络开始工作（第6层）。这个网络综合了来自本能、文化、个人经验的信号，对这个客体做出一个<strong>情感性和价值性</strong>的判断——它是美的、丑的、吸引人的还是令人厌恶的。这就是<strong>审美判断</strong>的形成。</p>
<h4 data-id="heading-4"><strong>层次 7: 超越个体的哲学反思</strong></h4>
<p>这是最高、最抽象的层次。它超越了即时的、个人的好恶，涉及<strong>元认知</strong>和<strong>抽象思维</strong>，主要依赖于高度发达的<strong>前额叶皮层</strong>。在这个层面，我们反思的已不是对象本身，而是“美”的本质：</p>
<ul>
<li>“为什么我认为这是美的？”</li>
<li>“美是客观存在的吗？”</li>
<li>“我的审美观是如何被社会塑造的？”</li>
<li>“丑在艺术中可以扮演什么角色？”</li>
</ul>
<hr/>
<h3 data-id="heading-5">还有更低或更高的层次吗？</h3>
<p><strong>1. 更低的层次：亚神经处理与物理世界</strong>
从严格意义上讲，在视网膜处理之前，还存在：</p>
<ul>
<li><strong>物理光学层</strong>：光线在通过角膜、晶状体时的折射，瞳孔对光量的调节。这属于物理过程。</li>
<li><strong>光化学层</strong>：视色素分子在吸收光子后发生的异构化反应。这属于生物化学过程。</li>
</ul>
<p>但这些通常不被认为是“神经识别”的一部分，而是视觉系统的<strong>前置信号准备</strong>阶段。因此，我们的模型从神经信号的产生和初步检测开始是合理的。</p>
<p><strong>2. 更高的层次：系统级影响与哲学建构</strong>
在哲学反思之上，视觉识别的影响还能继续向外延伸，进入更广阔的系统：</p>
<ul>
<li><strong>文化建构层</strong>：个人的审美判断汇聚成群体性的审美潮流，进而影响艺术批评、设计哲学和整个时代的文化风貌。一个人的辨别行为，成为了社会文化建构的一部分。</li>
<li><strong>形而上学层</strong>：这是最极致的“高阶层”，它追问的是视觉识别与存在本身的关系。例如：“我们通过视觉所辨别的世界，是世界的本来面目吗？”（康德的自在之物问题），或“视觉经验如何塑造了我们对‘实在’的理解？”</li>
</ul>
<h3 data-id="heading-6">结论</h3>
<p>这个七层模型是一个强大的框架，它清晰地描绘了视觉信息如何从物理信号一步步转化为人类最复杂的抽象思维和情感体验。<strong>层次越低，处理越自动、越普遍（几乎所有视觉健全的人类都共享）；层次越高，处理越受控、越具个体性和文化特异性。</strong></p>
<p>因此，从“看见红色”到“认为一幅红色调的画作是杰作”，中间跨越的正是这个从感觉感知到价值创造、从生物学到哲学的宏大光谱。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[学习React-DnD：实现多任务项拖动-维护多任务项数组]]></title>    <link>https://juejin.cn/post/7573864324713185332</link>    <guid>https://juejin.cn/post/7573864324713185332</guid>    <pubDate>2025-11-18T09:28:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573864324713185332" data-draft-id="7573680361990471720" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="学习React-DnD：实现多任务项拖动-维护多任务项数组"/> <meta itemprop="keywords" content="前端,React.js"/> <meta itemprop="datePublished" content="2025-11-18T09:28:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Wect"/> <meta itemprop="url" content="https://juejin.cn/user/4185164878720068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            学习React-DnD：实现多任务项拖动-维护多任务项数组
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185164878720068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Wect
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:28:44.000Z" title="Tue Nov 18 2025 09:28:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、功能承接与需求概述</h2>
<p>上一篇文档中，我们已完成单个任务项的拖动排序功能。本次迭代的核心需求是实现<strong>多个任务项的批量选中</strong>，具体需达成以下目标：</p>
<ul>
<li>扩展状态管理，支持存储选中的任务项集合</li>
<li>新增选中、取消选中任务项的操作逻辑</li>
<li>在任务项组件中关联单选框与选中状态的交互</li>
</ul>
<h2 data-id="heading-1">二、核心状态扩展（TodoProvider）</h2>
<p>要实现多任务选中与拖拽，首先需要在全局状态中新增“选中任务集合”字段，并同步更新上下文供组件调用。</p>
<h3 data-id="heading-2">2.1 初始化状态修改</h3>
<p>在<code>initialState</code>中添加<code>selectedTodos</code>数组，用于存储当前选中的任务项，同时确保任务项模型的完整性：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> initialState = {
  <span class="hljs-attr">todos</span>: [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Learn React'</span>, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">selected</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Build a Todo App'</span>, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">selected</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Build a Demo'</span>, <span class="hljs-attr">completed</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">selected</span>: <span class="hljs-literal">false</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Fix a Bug'</span>, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">selected</span>: <span class="hljs-literal">true</span> },

  ],
  <span class="hljs-comment">// 当前选中的任务数组</span>
  <span class="hljs-attr">selectedTodos</span>: [{ <span class="hljs-attr">id</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">text</span>: <span class="hljs-string">'Fix a Bug'</span>, <span class="hljs-attr">completed</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">selected</span>: <span class="hljs-literal">true</span> }],
};
</code></pre>
<h3 data-id="heading-3">2.2 上下文同步更新</h3>
<p>将新增的<code>selectedTodos</code>状态注入上下文，确保子组件能获取到选中任务集合：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// TodoProvider内部的上下文值配置</span>
<span class="hljs-keyword">const</span> contextValue = {
  <span class="hljs-attr">todos</span>: state.<span class="hljs-property">todos</span>,
  <span class="hljs-attr">selectedTodos</span>: state.<span class="hljs-property">selectedTodos</span>,
  ...actions,
};
</code></pre>
<h2 data-id="heading-4">三、核心操作逻辑实现（Reducer）</h2>
<p>基于需求新增两个核心操作类型：<code>ADD_SELECT_TODOS</code>（添加选中任务）、<code>REMOVE_SELECT_TODOS</code>（移除选中任务），以下是完整实现逻辑。</p>
<h3 data-id="heading-5">3.1 操作类型常量定义（建议单独维护）</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ActionTypes.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">ActionTypes</span> = {
  <span class="hljs-comment">// 原有操作类型...</span>
  <span class="hljs-attr">ADD_SELECT_TODOS</span>: <span class="hljs-string">'ADD_SELECT_TODOS'</span>,
  <span class="hljs-attr">REMOVE_SELECT_TODOS</span>: <span class="hljs-string">'REMOVE_SELECT_TODOS'</span>,
};
</code></pre>
<h3 data-id="heading-6">3.2 添加选中任务（ADD_SELECT_TODOS）</h3>
<p>通过任务ID查找目标任务，确保任务存在且未被选中后，添加到<code>selectedTodos</code>集合中，避免重复选中：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ADD_SELECT_TODOS</span>
<span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">ADD_SELECT_TODOS</span>:
  {
    <span class="hljs-comment">// 找到要添加的todo对象</span>
    <span class="hljs-keyword">const</span> todoToAdd = state.<span class="hljs-property">todos</span>.<span class="hljs-title function_">find</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> === action.<span class="hljs-property">payload</span>.<span class="hljs-property">id</span>);
    <span class="hljs-comment">// 确保todo存在且尚未被选中（避免重复添加）</span>
    <span class="hljs-keyword">if</span> (todoToAdd &amp;&amp; !state.<span class="hljs-property">selectedTodos</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> === todoToAdd.<span class="hljs-property">id</span>)) {
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">selectedTodos</span>: [...state.<span class="hljs-property">selectedTodos</span>, todoToAdd],
      };
    }
    <span class="hljs-keyword">return</span> state;
  }
</code></pre>
<h3 data-id="heading-7">3.3 移除选中任务（REMOVE_SELECT_TODOS）</h3>
<p>根据任务ID从<code>selectedTodos</code>集合中过滤掉目标任务：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// REMOVE_SELECT_TODOS</span>
<span class="hljs-keyword">case</span> <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REMOVE_SELECT_TODOS</span>:
  <span class="hljs-keyword">return</span> {
    ...state,
    <span class="hljs-attr">selectedTodos</span>: state.<span class="hljs-property">selectedTodos</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">todo</span> =&gt;</span> todo.<span class="hljs-property">id</span> !== action.<span class="hljs-property">payload</span>.<span class="hljs-property">id</span>),
  };
</code></pre>
<h2 data-id="heading-8">四、任务项组件交互（TodoItem）</h2>
<p>在TodoItem组件中，通过Ref绑定单选框，并在单选框状态变化时，触发选中/取消选中的操作，实现视图与状态的同步。</p>
<h3 data-id="heading-9">4.1 组件核心逻辑</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { useContext, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> useTodoContext <span class="hljs-keyword">from</span> <span class="hljs-string">'@/context/TodoContext/useTodoContext'</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">TodoItem</span> = (<span class="hljs-params">{ todo }</span>) =&gt; {
  <span class="hljs-keyword">const</span> { addSelectTodos, removeSelectTodos } = <span class="hljs-title function_">useTodoContext</span>();
  <span class="hljs-comment">// 用Ref绑定单选框元素，便于后续操作（如主动获取状态）</span>
  <span class="hljs-keyword">const</span> checkboxRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// 单选框状态变化处理函数</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCheckboxChange</span> = (<span class="hljs-params">e</span>) =&gt; {
    <span class="hljs-title function_">toggleSelected</span>(todo.<span class="hljs-property">id</span>);
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">target</span>.<span class="hljs-property">checked</span>) {
      <span class="hljs-comment">// 选中：调用添加选中任务的action</span>
      <span class="hljs-title function_">addSelectTodos</span>(todo.<span class="hljs-property">id</span>);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 取消选中：调用移除选中任务的action</span>
      <span class="hljs-title function_">removeSelectTodos</span>(todo.<span class="hljs-property">id</span>);
    }
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">todo-item</span>${<span class="hljs-attr">isDragging</span> ? ' <span class="hljs-attr">isDragging</span>' <span class="hljs-attr">:</span> ''}`} <span class="hljs-attr">ref</span>=<span class="hljs-string">{divRef}</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"todo-item-content"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"checkbox"</span>
          <span class="hljs-attr">id</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">todo-</span>${<span class="hljs-attr">todo.id</span>}`}
          <span class="hljs-attr">checked</span>=<span class="hljs-string">{todo.selected}</span>
          <span class="hljs-attr">onChange</span>=<span class="hljs-string">{handleCheckboxChange}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">"todo-checkbox"</span>
          <span class="hljs-attr">ref</span>=<span class="hljs-string">{checkboxRef}</span>
        /&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      {/* 原有单个任务拖拽相关逻辑 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">TodoItem</span>;
</code></pre>
<p>注意：仅保留必需内容，不包含TodoItem组件的所有内容。</p>
<h3 data-id="heading-10">4.2 关键交互说明</h3>
<ul>
<li><strong>Ref绑定</strong>：通过<code>checkboxRef</code>可在需要时主动控制单选框（如全选/取消全选功能），提升组件灵活性。</li>
<li><strong>状态双向绑定</strong>：单选框的<code>checked</code>属性直接绑定任务项的<code>selected</code>状态，确保视图与全局状态一致。</li>
<li><strong>操作触发</strong>：状态变化时通过上下文获取的<code>addSelectTodos</code>和<code>removeSelectTodos</code>方法更新全局状态，实现跨组件状态同步。</li>
</ul>
<h2 data-id="heading-11">五、配套Action函数实现</h2>
<p>为了让组件更便捷地调用上述操作，需在TodoProvider中定义对应的action函数，并注入上下文：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> actions = {
  <span class="hljs-comment">// 原有action...</span>
  
    <span class="hljs-comment">// 添加选中任务</span>
    <span class="hljs-attr">addSelectTodos</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
      <span class="hljs-title function_">dispatch</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">ADD_SELECT_TODOS</span>,
        <span class="hljs-attr">payload</span>: { id },
      });
    },

    <span class="hljs-comment">// 移除选中任务</span>
    <span class="hljs-attr">removeSelectTodos</span>: <span class="hljs-function">(<span class="hljs-params">id</span>) =&gt;</span> {
      <span class="hljs-title function_">dispatch</span>({
        <span class="hljs-attr">type</span>: <span class="hljs-title class_">ActionTypes</span>.<span class="hljs-property">REMOVE_SELECT_TODOS</span>,
        <span class="hljs-attr">payload</span>: { id },
      });
    },
    
};
</code></pre>
<h2 data-id="heading-12">六、测试要点</h2>
<ol>
<li>单个任务选中/取消：勾选单选框后，<code>selectedTodos</code>应同步增减，任务项<code>selected</code>状态正确。</li>
<li>多个任务选中：选中多个任务后，<code>selectedTodos</code>应包含所有选中项，无重复数据。</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CentOS 7/8/9 上安装 MySQL 8.0+ 完整指南]]></title>    <link>https://juejin.cn/post/7573670400153813044</link>    <guid>https://juejin.cn/post/7573670400153813044</guid>    <pubDate>2025-11-18T09:29:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573670400153813044" data-draft-id="7573670400153763892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CentOS 7/8/9 上安装 MySQL 8.0+ 完整指南"/> <meta itemprop="keywords" content="Linux,MySQL"/> <meta itemprop="datePublished" content="2025-11-18T09:29:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LumenL1u"/> <meta itemprop="url" content="https://juejin.cn/user/3406736546858211"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CentOS 7/8/9 上安装 MySQL 8.0+ 完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3406736546858211/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LumenL1u
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:29:06.000Z" title="Tue Nov 18 2025 09:29:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、流程图</h2>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[安装前准备] --&gt; B{选择安装方式}
    B --&gt;|推荐新手| C[1.使用包管理器安装]
    B --&gt;|需要更多控制| D[2.手动安装二进制包]

    C --&gt; C1[添加Yum存储库]
    C1 --&gt; C2[安装mysql-server]
    C2 --&gt; C3[启动服务]
    C3 --&gt; F[重置账户密码]

    D --&gt; D1[下载并解压二进制包]
    D1 --&gt; D2[创建专用用户和组]
    D2 --&gt; D3[创建配置文件和初始化数据目录]
    D3 --&gt; D4[创建systemd 单元文件]
    D4 --&gt; D5[启动服务]
    D5 --&gt; F

    F --&gt; G[测试MySQL服务]
    G --&gt; H[开启远程访问权限]

</code></pre>
<h2 data-id="heading-1">二、安装前的准备工作</h2>
<p>在开始安装之前，建议你先完成以下步骤：</p>
<p>更新系统软件包： 更新系统，确保所有软件包都是最新状态。（对于启用 dnf 的系统，请在命令中将  <strong>yum</strong>  替换为  <strong>dnf</strong>）</p>
<pre><code class="hljs language-bash" lang="bash">yum update
</code></pre>
<p>检查是否已安装 MySQL：执行以下命令检查</p>
<pre><code class="hljs language-bash" lang="bash">yum list installed | grep mysql
yum list installed | grep mariadb
</code></pre>
<p>卸载：如果存在旧版本，建议卸载以避免冲突。</p>
<pre><code class="hljs language-bash" lang="bash">yum remove 包名
</code></pre>
<p>清理残留文件：卸载后建议删除相关配置文件和数据目录。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 删除配置文件</span>
<span class="hljs-built_in">rm</span> -rf /etc/my.cnf

<span class="hljs-comment"># 删除数据目录（注意：会删除所有数据）</span>
<span class="hljs-built_in">rm</span> -rf /var/lib/mysql

<span class="hljs-comment"># 删除日志文件</span>
<span class="hljs-built_in">rm</span> -rf /var/log/localhost.log
</code></pre>
<h2 data-id="heading-2">三、使用包管理器安装（简单，易管理）</h2>
<h3 data-id="heading-3">1. <strong>添加 MySQL Yum 存储库</strong></h3>
<p>从 MySQL Yum 存储库页面 (<a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysqlserver.cn%2Fdownloads%2Frepo%2Fyum%2F)%25EF%25BC%2588%25E5%259C%25A8" target="_blank" title="https://dev.mysqlserver.cn/downloads/repo/yum/)%EF%BC%88%E5%9C%A8" ref="nofollow noopener noreferrer">dev.mysqlserver.cn/downloads/r…</a> MySQL 开发者专区）下载它。上传到服务器后执行（对于启用 dnf 的系统，请在命令中将  <strong>yum</strong>  替换为  <strong>dnf</strong>）</p>
<pre><code class="hljs language-bash" lang="bash">yum localinstall mysql84-community-release-el9-1.noarch.rpm
</code></pre>
<p>您可以通过以下命令检查 MySQL Yum 存储库是否已成功添加并启用</p>
<pre><code class="hljs language-bash" lang="bash">yum repolist enabled | grep mysql.*-community
</code></pre>
<h3 data-id="heading-4"><strong>2. 禁用默认的 MySQL 模块</strong></h3>
<p>(仅限 EL8 系统) 基于 EL8 的系统（例如 RHEL8 和 Oracle Linux 8）包含一个默认情况下启用的 MySQL 模块。</p>
<pre><code class="hljs language-bash" lang="bash">yum module <span class="hljs-built_in">disable</span> mysql
</code></pre>
<h3 data-id="heading-5"><strong>3. 安装 MySQL</strong></h3>
<p>通过以下命令安装 MySQL</p>
<pre><code class="hljs language-bash" lang="bash">yum install mysql-community-server
</code></pre>
<p>这将安装 MySQL 服务器软件包 (<code>mysql-community-server</code>)，以及运行服务器所需组件的软件包，包括客户端软件包 (<code>mysql-community-client</code>)、客户端和服务器的通用错误消息和字符集 (<code>mysql-community-common</code>) 以及共享客户端库 (<code>mysql-community-libs</code>)。</p>
<h3 data-id="heading-6">4. 启动 MySQL 服务器</h3>
<p>使用以下命令启动 MySQL 服务器。</p>
<pre><code class="hljs language-bash" lang="bash">systemctl start mysqld
</code></pre>
<p>您可以使用以下命令检查 MySQL 服务器的状态。</p>
<pre><code class="hljs language-bash" lang="bash">systemctl status mysqld
</code></pre>
<p>如果操作系统启用了 systemd，则应使用标准的  <strong>systemctl</strong>（或者，使用参数反转的  <strong>service</strong>）命令，例如  <strong>stop</strong>、<strong>start</strong>、<strong>status</strong>  和  <a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysqlserver.cn%2Fdoc%2Frefman%2F9.0%2Fen%2Frestart.html" target="_blank" title="https://dev.mysqlserver.cn/doc/refman/9.0/en/restart.html" ref="nofollow noopener noreferrer"><strong>restart</strong></a>  来管理 MySQL 服务器服务。 <code>mysqld</code>  服务默认情况下处于启用状态，并且在系统重启时启动。</p>
<h2 data-id="heading-7">四、手动安装二进制包（难，但更灵活）</h2>
<h3 data-id="heading-8"><strong>1. MySQL Linux 通用二进制分发目录</strong></h3>





































<table><thead><tr><th><strong>目录</strong></th><th><strong>目录内容</strong></th></tr></thead><tbody><tr><td><code>bin</code></td><td><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysqlserver.cn%2Fdoc%2Frefman%2F9.0%2Fen%2Fmysqld.html" target="_blank" title="https://dev.mysqlserver.cn/doc/refman/9.0/en/mysqld.html" ref="nofollow noopener noreferrer"><strong>mysqld</strong></a>  服务器、客户端和实用程序</td></tr><tr><td><code>docs</code></td><td>Info 格式的 MySQL 手册</td></tr><tr><td><code>man</code></td><td>Unix 手册页</td></tr><tr><td><code>include</code></td><td>包含（头）文件</td></tr><tr><td><code>lib</code></td><td>库</td></tr><tr><td><code>share</code></td><td>错误消息、字典和用于数据库安装的 SQL</td></tr><tr><td><code>support-files</code></td><td>各种支持文件</td></tr></tbody></table>
<h3 data-id="heading-9"><strong>2. 命令序列如下所示</strong></h3>
<pre><code class="hljs language-bash" lang="bash">yum install libaio
tar -xvf /path/to/mysql-VERSION-OS.tar.xz
<span class="hljs-built_in">ln</span> -s full-path-to-mysql-VERSION-OS mysql
groupadd mysql
useradd -r -g mysql -s /bin/false mysql
<span class="hljs-built_in">cd</span> /etc
<span class="hljs-built_in">touch</span> my.cnf
<span class="hljs-built_in">chown</span> root:root my.cnf
<span class="hljs-built_in">cd</span> /usr/local/mysql
<span class="hljs-built_in">mkdir</span> data
<span class="hljs-built_in">chmod</span> 750 data
<span class="hljs-built_in">chown</span> mysql:mysql data
bin/mysqld --defaults-file=/etc/my.cnf --initialize
<span class="hljs-built_in">cat</span> data/localhost.localdomain.err
<span class="hljs-built_in">cd</span> /usr/lib/systemd/system
<span class="hljs-built_in">touch</span> mysqld.service
systemctl <span class="hljs-built_in">enable</span> mysqld.service
systemctl start mysqld
</code></pre>
<h3 data-id="heading-10">3. 安装二进制包</h3>
<p><strong>安装 libaio 库</strong>：MySQL 依赖于该<code>libaio</code>  库。如果未在本地安装此库，则数据目录初始化和后续服务器启动步骤将失败。如有必要，请使用适当的包管理器安装它。例如，在基于 Yum 的系统上：</p>
<pre><code class="hljs language-bash" lang="bash">yum search libaio  <span class="hljs-comment"># search for info</span>
yum install libaio <span class="hljs-comment"># install library</span>
</code></pre>
<p><strong>下载和解压</strong>：从 MySQL 官网<a href="https://link.juejin.cn?target=https%3A%2F%2Fdownloads.mysql.com%2Farchives%2Fcommunity%2F" target="_blank" title="https://downloads.mysql.com/archives/community/" ref="nofollow noopener noreferrer">下载</a>对应版本的二进制压缩包（如 mysql-9.4.0-linux-glibc2.28-x86_64.tar.xz），使用 <code>tar -xzf</code> 命令解压。</p>
<pre><code class="hljs language-bash" lang="bash">tar xvf mysql-9.4.0-linux-glibc2.28-x86_64.tar.xz -C /usr/local/
<span class="hljs-built_in">cd</span> /usr/local/

<span class="hljs-built_in">mv</span> mysql-9.4.0-linux-glibc2.28-x86_64 mysql
<span class="hljs-comment">#或</span>
<span class="hljs-built_in">ln</span> -s mysql-9.4.0-linux-glibc2.28-x86_64 mysql
</code></pre>
<p><strong>创建专用用户和组</strong>：创建一个不允许登录系统的 MySQL 专用用户，提升安全性。</p>
<pre><code class="hljs language-bash" lang="bash">groupadd mysql
useradd -r -g mysql -s /bin/false mysql
<span class="hljs-comment">#或</span>
useradd -r -g mysql -s /usr/sbin/nologin mysql
</code></pre>
<p><code>-s</code> 设置用户的登录 shell</p>
<p><code>/bin/false</code> 一个总是返回失败的程序，这样设置后，该用户<strong>无法通过 shell 登录系统</strong></p>
<p><code>/usr/sbin/nologin</code> 达到类似效果，并给出友好提示</p>
<h3 data-id="heading-11">4. 安装后配置</h3>
<p><strong>配置环境变量</strong>：将 mysql 加入环境变量中。</p>
<pre><code class="hljs language-bash" lang="bash">vim /etc/profile.d/mysql.sh
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#编辑mysql.sh内容</span>
<span class="hljs-built_in">export</span> MYSQL_HOME=/usr/local/mysql
<span class="hljs-built_in">export</span> PATH=<span class="hljs-variable">$MYSQL_HOME</span>/bin:<span class="hljs-variable">$PATH</span>
</code></pre>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">source</span> /etc/profile.d/mysql.sh
</code></pre>
<p><strong>创建配置文件</strong>：通过将它们放在 MySQL 配置文件中来指定 MySQL 服务器在启动时应使用的选项。如果不这样做，服务器将以其默认设置启动，要创建 MySQL 配置文件，请以 root 身份发出以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /etc
vim my.cnf
</code></pre>
<p>添加以下设置到配置文件中</p>
<pre><code class="hljs language-bash" lang="bash">[client]
socket=/usr/local/mysql/data/mysql.sock

[mysqld]
datadir=/usr/local/mysql/data
socket=/usr/local/mysql/data/mysql.sock
port=3306
log-error=/usr/local/mysql/data/localhost.log
user=mysql
secure_file_priv=NULL
local_infile=OFF
</code></pre>
<p><strong>初始化数据目录</strong>：进入 MySQL 目录并初始化数据目录</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /usr/local/mysql
<span class="hljs-built_in">mkdir</span> data
<span class="hljs-built_in">chmod</span> 750 data
<span class="hljs-built_in">chown</span> mysql:mysql data
bin/mysqld --defaults-file=/etc/my.cnf --initialize
</code></pre>
<p>初始化输出被打印到日志 ( <code>/usr/local/mysql/data/localhost.log</code>) 中。</p>
<h3 data-id="heading-12"><strong>5. 使用 systemd 启动服务器</strong></h3>
<p>添加一个 systemd 服务单元配置文件</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> /usr/lib/systemd/system
vim mysqld.service
</code></pre>
<p>将此配置信息添加到 mysqld.service 文件中：</p>
<pre><code class="hljs language-bash" lang="bash">[Unit]
Description=MySQL Server
Documentation=man:mysqld(8)
Documentation=http://dev.mysql.com/doc/refman/en/using-systemd.html
After=network.target
After=syslog.target

[Install]
WantedBy=multi-user.target

[Service]
User=mysql
Group=mysql

<span class="hljs-comment"># Have mysqld write its state to the systemd notify socket</span>
Type=notify

<span class="hljs-comment"># Disable service start and stop timeout logic of systemd for mysqld service.</span>
TimeoutSec=0

<span class="hljs-comment"># Start main service</span>
ExecStart=/usr/local/mysql/bin/mysqld --defaults-file=/etc/my.cnf <span class="hljs-variable">$MYSQLD_OPTS</span>

<span class="hljs-comment"># Use this to switch malloc implementation</span>
EnvironmentFile=-/etc/sysconfig/mysql

<span class="hljs-comment"># Sets open_files_limit</span>
LimitNOFILE = 10000

<span class="hljs-comment">#Restart=on-failure</span>

<span class="hljs-comment">#RestartPreventExitStatus=1</span>

<span class="hljs-comment"># Set environment variable MYSQLD_PARENT_PID. This is required for restart.</span>
<span class="hljs-comment">#Environment=MYSQLD_PARENT_PID=1</span>

<span class="hljs-comment">#PrivateTmp=false</span>
</code></pre>
<p>使用以下命令来管理 MySQL 服务。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment">#使mysqld服务在重新启动时自动启动。</span>
systemctl <span class="hljs-built_in">enable</span> mysqld.service

<span class="hljs-comment">#手动启动mysqld服务</span>
systemctl start mysqld

<span class="hljs-comment">#检查mysqld服务的状态</span>
systemctl status mysqld
</code></pre>
<h2 data-id="heading-13">五、重置 MySQL root 账户密码</h2>
<p>使用客户端，使用服务器在初始化序列期间生成的随机密码  <code>mysql</code>连接到服务器：<code>root@localhost</code></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Yum 安装</span>
grep <span class="hljs-string">'temporary password'</span> /var/log/mysqld.log
<span class="hljs-comment"># 二进制安装</span>
grep <span class="hljs-string">'temporary password'</span> /usr/local/mysql/data/*.err

mysql -u root -p
</code></pre>
<pre><code class="hljs language-sql" lang="sql">mysql<span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'root'</span>@<span class="hljs-string">'localhost'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'password'</span>;
mysql<span class="hljs-operator">&gt;</span> exit
</code></pre>
<blockquote>
<p>💡 提示：如果启用了 validate_password 插件（默认开启），密码必须满足强度策略（大写、小写、数字、特殊字符、长度 ≥ 8）。</p>
</blockquote>
<h2 data-id="heading-14">六、测试 MySQL 服务器</h2>
<p>使用<strong>mysqlshow</strong>验证您是否可以从服务器检索信息。</p>
<pre><code class="hljs language-bash" lang="bash">mysqlshow -u root -p
</code></pre>
<p>使用<strong>mysqladmin</strong>查看 MySQL 服务器版本信息。</p>
<pre><code class="hljs language-bash" lang="bash">mysqladmin -u root -p version
</code></pre>
<h2 data-id="heading-15">七、开启远程访问权限</h2>
<p>需要登录到 MySQL 服务器，执行下面的命令：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 创建用户</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">'username'</span>@<span class="hljs-string">'%'</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">'password'</span>;

<span class="hljs-comment">-- 2. 授权</span>
<span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">ALL</span> PRIVILEGES <span class="hljs-keyword">ON</span> <span class="hljs-operator">*</span>.<span class="hljs-operator">*</span> <span class="hljs-keyword">TO</span> <span class="hljs-string">'username'</span>@<span class="hljs-string">'%'</span>;

<span class="hljs-comment">-- 3.刷新权限</span>
FLUSH PRIVILEGES;
</code></pre>
<p>这里的 <code>username</code> 和 <code>password</code> 分别是远程用户的用户名和密码，<code>%</code> 表示允许任何 IP 地址的用户连接。如果需要限制特定 IP 地址，可以将 <code>%</code> 替换为具体的 IP 地址。</p>
<p>编辑 MySQL 的配置文件 <code>my.cnf</code> ， 允许任意 IP 地址访问：</p>
<pre><code class="hljs language-bash" lang="bash">[mysqld]
<span class="hljs-comment"># 注释掉或删除这一行（如果存在）：</span>
<span class="hljs-comment"># 如果不想暴露MySQL，可以保留，通过SSH 隧道（端口转发）安全地连接，具体见常见问题</span>
<span class="hljs-comment"># bind-address = 127.0.0.1</span>

<span class="hljs-comment"># 或显式绑定到所有地址：</span>
bind-address = 0.0.0.0
</code></pre>
<p>修改后，保存文件并重启 MySQL 服务以使更改生效：</p>
<pre><code class="hljs language-bash" lang="bash">systemctl restart mysqld
</code></pre>
<p>在客户端计算机上，使用以下命令尝试连接到远程 MySQL 服务器：</p>
<pre><code class="hljs language-bash" lang="bash">mysql -h server_ip -P 3306 -u username -p

<span class="hljs-comment">#例如</span>
mysql -h192.168.100.128 -P3306 -uroot -p123456
</code></pre>
<h2 data-id="heading-16">八、常见问题</h2>
<h3 data-id="heading-17"><strong>1. MySQL 服务无法启动</strong></h3>
<p>可以运行 <code>systemctl status mysql</code> 查看服务状态，或者通过 <code>journalctl -xe</code> 查看系统日志来排查问题。</p>
<h3 data-id="heading-18"><strong>2. SELinux 或 AppArmor 阻止执行</strong></h3>
<p>临时禁用 SELinux 测试：</p>
<pre><code class="hljs language-bash" lang="bash">setenforce 0
systemctl start mysqld
</code></pre>
<p>如果成功，说明是 SELinux 策略问题。可恢复后添加策略：</p>
<pre><code class="hljs language-bash" lang="bash">setenforce 1
restorecon -R /usr/local/mysql
<span class="hljs-comment"># 或使用 audit2allow 生成自定义策略</span>
</code></pre>
<h3 data-id="heading-19"><strong>3. 客户端连接失败</strong>：</h3>
<p><strong>检查防火墙设置</strong>：确保服务器的防火墙开放了 MySQL 的默认 3306 端口。可以使用以下命令。</p>
<pre><code class="hljs language-bash" lang="bash">firewall-cmd --list-ports | grep 3306
</code></pre>
<p>如果没有放行（输出是空的），执行以下命令，重新检查</p>
<pre><code class="hljs language-bash" lang="bash">firewall-cmd --permanent --add-port=3306/tcp
firewall-cmd --reload
</code></pre>
<p><strong>检查 MySQL 绑定地址</strong>：查看 MySQL 配置文件（如 <code>/etc/mysql/my.cnf</code>）中的 <code>bind-address</code> 选项。如果希望从其他机器连接，需将其设置为服务器的 IP 地址或 <code>0.0.0.0</code>（注意安全风险），或者直接注释掉该行。</p>
<p>如果服务端只允许本机访问（127.0.0.1），则在客户端执行下面的命令：</p>
<pre><code class="hljs language-bash" lang="bash">ssh -L 3307:127.0.0.1:3306 user@your-server.com
<span class="hljs-comment">#或</span>
ssh -fNL 3307:127.0.0.1:3306 user@your-server.com

mysql -h 127.0.0.1 -P 3307 -u myuser -p
</code></pre>
<p><code>-L 3307:127.0.0.1:3306</code>：表示将本地机器的  <strong>3307 端口</strong>  转发到远程服务器上的  <code>127.0.0.1:3306</code> 。</p>
<p><code>user@your-server.com</code>：是你在远程服务器上的登录账户和主机地址。</p>
<p><code>-fNL</code> ：在后台运行，不执行远程命令，同时设置本地端口转发。</p>
<p>如果是后台运行，Linux/MacOS 用 <code>ps aux | grep ssh</code> ，Windows 用 <code>get-process ssh*</code> ，找到进程并 <code>kill &lt;PID&gt;</code> 。</p>
<h3 data-id="heading-20"><strong>4. 忘记 root 密码</strong>：</h3>
<ol>
<li>停止 MySQL 服务。</li>
<li>在配置文件中（如 <code>[mysqld]</code> 段下）添加 <code>skip-grant-tables</code>。</li>
<li>重启 MySQL 服务，此时可以不需密码登录。</li>
<li>执行 <code>FLUSH PRIVILEGES;</code> 后重设 root 密码。</li>
<li>移除 <code>skip-grant-tables</code> 配置，重启 MySQL 服务。</li>
</ol>
<p>参考：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysqlserver.cn%2Fdoc%2Frefman%2F9.0%2Fen%2Flinux-installation-yum-repo.html" target="_blank" title="https://dev.mysqlserver.cn/doc/refman/9.0/en/linux-installation-yum-repo.html" ref="nofollow noopener noreferrer">MySQL :: MySQL 9.0 参考手册 :: 2.5.1 使用 MySQL Yum 存储库在 Linux 上安装 MySQL - MySQL 数据库</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdev.mysqlserver.cn%2Fdoc%2Frefman%2F9.0%2Fen%2Fbinary-installation.html" target="_blank" title="https://dev.mysqlserver.cn/doc/refman/9.0/en/binary-installation.html" ref="nofollow noopener noreferrer">MySQL :: MySQL 9.0 参考手册 :: 2.2 在 Unix/Linux 上使用通用二进制文件安装 MySQL - MySQL 数据库</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmysql.net.cn%2Fdoc%2Fmysql-secure-deployment-guide%2F8.0%2Fen%2Fsecure-deployment-post-install.html" target="_blank" title="https://mysql.net.cn/doc/mysql-secure-deployment-guide/8.0/en/secure-deployment-post-install.html" ref="nofollow noopener noreferrer">第 5 章安装后设置_MySQL 8.0 安全部署指南</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Uniapp如何下载图片到本地相册]]></title>    <link>https://juejin.cn/post/7573710392213602331</link>    <guid>https://juejin.cn/post/7573710392213602331</guid>    <pubDate>2025-11-18T09:29:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573710392213602331" data-draft-id="7573669819029340170" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Uniapp如何下载图片到本地相册"/> <meta itemprop="keywords" content="前端,Vue.js,微信小程序"/> <meta itemprop="datePublished" content="2025-11-18T09:29:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="努力呆呆鸟"/> <meta itemprop="url" content="https://juejin.cn/user/1313268769494019"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Uniapp如何下载图片到本地相册
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1313268769494019/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    努力呆呆鸟
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:29:48.000Z" title="Tue Nov 18 2025 09:29:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">uniapp如何下载图片到本地相册？</h2>
<blockquote>
<p>在一些特定的情况下面，我们需要在uniapp开发的小程序中将图片保存到本地相册，比如壁纸小程序其他小程序，这个使用情况还是十分普遍的，现在我来分享一下我的实现方法和思路</p>
</blockquote>
<h3 data-id="heading-1">实现方案</h3>
<p>文档地址：
saveImageToPhotosAlbum:<a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Fapi%2Fmedia%2Fimage.html%23saveimagetophotosalbum" target="_blank" title="https://uniapp.dcloud.net.cn/api/media/image.html#saveimagetophotosalbum" ref="nofollow noopener noreferrer">uniapp.dcloud.net.cn/api/media/i…</a>
getImageInfo: <a href="https://link.juejin.cn?target=https%3A%2F%2Funiapp.dcloud.net.cn%2Fapi%2Fmedia%2Fimage.html%23getimageinfo" target="_blank" title="https://uniapp.dcloud.net.cn/api/media/image.html#getimageinfo" ref="nofollow noopener noreferrer">uniapp.dcloud.net.cn/api/media/i…</a></p>
<p>我们通过查找uniapp官方文档可以发现里面有一个<code>uni.saveImageToPhotosAlbum({})</code>保存图片到系统相册的API接口可以让我们使用，其中最关键的就是<code>filePath</code>参数，这个参数不支持网络地址就是我们服务器返回的图片地址不可以使用</p>
<p>所以我们需要使用另外一个API接口来帮助我们生成一个临时的<code>filePath</code>路径这个api就是<code>uni.getImageInfo</code>
使用这个api就可以将我们接口返回的网络地址生成一个临时的file地址，这样我就可以配合<code>uni.saveImageToPhotosAlbum({})</code>来实现图片保存到本地相册的功能了</p>
<p><em><strong>实例代码：</strong></em></p>
<pre><code class="hljs language-js" lang="js">		uni.<span class="hljs-title function_">getImageInfo</span>({
			<span class="hljs-attr">src</span>: currentInfo.<span class="hljs-property">value</span>.<span class="hljs-property">picurl</span>,
			<span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
				uni.<span class="hljs-title function_">saveImageToPhotosAlbum</span>({
					<span class="hljs-attr">filePath</span>: res.<span class="hljs-property">path</span>,
					<span class="hljs-attr">success</span>: <span class="hljs-function">(<span class="hljs-params">fileRes</span>) =&gt;</span> {
						<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fileRes, <span class="hljs-string">"图片"</span>);
					}
				})
			}
		})
</code></pre>
<h3 data-id="heading-2">需要注意的问题</h3>
<p>我们在小程序实现下载功能的时候我们还需要到小程序的配置当中将<code>downloadFile合法域名</code>行一个配置不然是无法完成下载的，同时还需要在小程序后台配置中进行一个授权不然也是无法实现保存到微信相册的。</p>
<h4 data-id="heading-3">1.downloadFile合法域名配置步骤</h4>
<p>进入到小程序配置信息页面 <strong>点击开发管理</strong> 同时在显示中的页面里面<strong>下滑到服务器域名位置</strong> 可以看见<strong>downloadFile合法域名</strong>的位置信息 点击<strong>右上角</strong>的 <strong>修改</strong> 然后将我们的downloadFile域名添加就可以了</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3d1dd17d8bb141a2860094d956724287~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb5ZGG5ZGG6bif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764062988&amp;x-signature=dstWCt9FtIE5EqsCjPWYszO%2Fpp8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f08cdcbbf644b42b201b7e5071603b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Yqq5Yqb5ZGG5ZGG6bif:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764062988&amp;x-signature=B4HVSCECFWcyXc%2B54VQ9r4aA3hA%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-4">2. 进行授权配置</h4>
<p>进入小程序后台设置 鼠标移入到头像上 根据你的小程序信息进行一个填写和备案 后面找到<code>服务内容声明</code>用户隐私保护指引 进入到里面根据信息提示就可以完成下载图片并且保存到手机本地相册的功能了！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[item_get接口详解：高效获取某鱼商品详情数据]]></title>    <link>https://juejin.cn/post/7573708620870680628</link>    <guid>https://juejin.cn/post/7573708620870680628</guid>    <pubDate>2025-11-18T09:32:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573708620870680628" data-draft-id="7573864324713152564" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="item_get接口详解：高效获取某鱼商品详情数据"/> <meta itemprop="keywords" content="爬虫"/> <meta itemprop="datePublished" content="2025-11-18T09:32:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="电商api跨境独立站程序猿"/> <meta itemprop="url" content="https://juejin.cn/user/2900974868106540"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            item_get接口详解：高效获取某鱼商品详情数据
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2900974868106540/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    电商api跨境独立站程序猿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:32:01.000Z" title="Tue Nov 18 2025 09:32:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在二手电商生态中，商品详情数据是数据分析、价格监控、智能推荐等业务场景的核心基础。某鱼平台的<code>item_get</code>接口为开发者提供了标准化的商品信息获取能力。本文将深度解析该接口的设计原理、调用方法及实战技巧。</p>
<hr/>
<h2 data-id="heading-0">一、接口定位与能力边界</h2>
<p><code>item_get</code>是某鱼开放平台的基础数据接口，用于<strong>实时获取单个商品的完整详情信息</strong>。其核心能力包括：</p>
<ul>
<li><strong>毫秒级响应</strong>：平均响应时长&lt;200ms，支持高并发调用</li>
<li><strong>全字段覆盖</strong>：包含商品标题、价格、描述、图片、卖家信息等30+维度</li>
<li><strong>数据新鲜度</strong>：实时读取源站数据，确保价格、库存等动态信息准确</li>
<li><strong>合规访问</strong>：通过OAuth 2.0授权，符合平台数据安全规范</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、接口技术规范</h2>
<h3 data-id="heading-2">2.1 基础信息</h3>
<pre><code class="hljs language-http" lang="http">请求地址：[https://api.xianyu.com/router/rest](https://o0b.cn/jelena    )
接口名称：xianyu.item.get
请求方式：GET/POST（推荐POST）
数据格式：JSON
字符编码：UTF-8
</code></pre>
<h3 data-id="heading-3">2.2 请求参数结构</h3>





























































<table><thead><tr><th align="left">参数名称</th><th align="left">类型</th><th align="left">必填</th><th align="left">说明</th><th align="left">示例值</th></tr></thead><tbody><tr><td align="left"><code>method</code></td><td align="left">string</td><td align="left">是</td><td align="left">固定值：xianyu.item.get</td><td align="left"><code>xianyu.item.get</code></td></tr><tr><td align="left"><code>app_key</code></td><td align="left">string</td><td align="left">是</td><td align="left">应用唯一标识</td><td align="left"><code>12345678</code></td></tr><tr><td align="left"><code>access_token</code></td><td align="left">string</td><td align="left">是</td><td align="left">OAuth授权令牌</td><td align="left"><code>6100a52b7c8d8a9d9e8f7g6h5</code></td></tr><tr><td align="left"><code>item_id</code></td><td align="left">string</td><td align="left">是</td><td align="left">商品数字ID</td><td align="left"><code>658767890123</code></td></tr><tr><td align="left"><code>fields</code></td><td align="left">string</td><td align="left">否</td><td align="left">指定返回字段（逗号分隔）</td><td align="left"><code>title,price,desc,images</code></td></tr><tr><td align="left"><code>timestamp</code></td><td align="left">string</td><td align="left">是</td><td align="left">请求时间戳（秒）</td><td align="left"><code>1731923400</code></td></tr><tr><td align="left"><code>sign</code></td><td align="left">string</td><td align="left">是</td><td align="left">签名串（MD5加密）</td><td align="left"><code>a1b2c3d4e5f6g7h8i9j0</code></td></tr></tbody></table>
<p><strong>签名生成规则</strong>：</p>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># 伪代码示例</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_sign</span>(<span class="hljs-params">params, secret</span>):
    <span class="hljs-comment"># 1. 过滤空值参数</span>
    <span class="hljs-comment"># 2. 按key升序排序</span>
    <span class="hljs-comment"># 3. 拼接key+value+secret</span>
    <span class="hljs-comment"># 4. MD5加密生成32位小写签名</span>
    sorted_params = <span class="hljs-built_in">sorted</span>(params.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">0</span>])
    sign_str = <span class="hljs-string">''</span>.join([<span class="hljs-string">f"<span class="hljs-subst">{k}</span><span class="hljs-subst">{v}</span>"</span> <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> sorted_params]) + secret
    <span class="hljs-keyword">return</span> md5(sign_str.encode(<span class="hljs-string">'utf-8'</span>)).hexdigest()
</code></pre>
<hr/>
<h2 data-id="heading-4">三、返回数据模型详解</h2>
<p>成功调用后返回的JSON数据结构如下：</p>
<pre><code class="hljs language-JSON" lang="JSON"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"code"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">200</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"success"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"item"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"item_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"658767890123"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"iPhone 15 Pro 256G 原色"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"desc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"自用半年，成色99新，配件齐全..."</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"price"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"current"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"7200.00"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"original"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"8999.00"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"currency"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CNY"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"images"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"https://img.xianyu.com/1.jpg"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"https://img.xianyu.com/2.jpg"</span>
      <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"category"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"50025526"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"手机"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"location"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"city"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"杭州市"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"district"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"西湖区"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"onsale"</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// onsale/reserved/sold</span>
      <span class="hljs-attr">"publish_time"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2024-11-15 14:32:18"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"seller"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"user_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"user_abc123"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"nick"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"数码达人小王"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"level"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"L3"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"credit_score"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">95</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"verify_status"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"stats"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"view_count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1280</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"want_count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">45</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"comment_count"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"sku"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"brand"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Apple"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"model"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"iPhone 15 Pro"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"原色钛金属"</span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"shipping"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"method"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"express"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"cost"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.00"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"free_shipping"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"tags"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"包邮"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"急售"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"可小刀"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"request_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"20251118143000_12345"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>核心字段速查表</strong>：</p>









































<table><thead><tr><th align="left">字段路径</th><th align="left">数据类型</th><th align="left">业务价值</th><th align="left">注意事项</th></tr></thead><tbody><tr><td align="left"><code>item.price.current</code></td><td align="left">decimal</td><td align="left">实时售价</td><td align="left">字符串格式，需转换计算</td></tr><tr><td align="left"><code>item.status</code></td><td align="left">enum</td><td align="left">销售状态</td><td align="left">sold商品不可再购买</td></tr><tr><td align="left"><code>item.seller.credit_score</code></td><td align="left">int</td><td align="left">信誉评估</td><td align="left">80分以上为优质卖家</td></tr><tr><td align="left"><code>item.stats.view_count</code></td><td align="left">int</td><td align="left">热度指标</td><td align="left">单位时间内增长趋势有价值</td></tr><tr><td align="left"><code>item.publish_time</code></td><td align="left">datetime</td><td align="left">上架时间</td><td align="left">UTC+8时区</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-5">四、多语言调用示例</h2>
<h3 data-id="heading-6">Python 实现</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> hashlib
<span class="hljs-keyword">import</span> time

<span class="hljs-keyword">class</span> <span class="hljs-title class_">XianyuClient</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, app_key, app_secret, access_token</span>):
        self.base_url = <span class="hljs-string">"https://api.xianyu.com/router/rest"</span>
        self.app_key = app_key
        self.app_secret = app_secret
        self.access_token = access_token
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_item_detail</span>(<span class="hljs-params">self, item_id, fields=<span class="hljs-literal">None</span></span>):
        params = {
            <span class="hljs-string">"method"</span>: <span class="hljs-string">"xianyu.item.get"</span>,
            <span class="hljs-string">"app_key"</span>: self.app_key,
            <span class="hljs-string">"access_token"</span>: self.access_token,
            <span class="hljs-string">"item_id"</span>: item_id,
            <span class="hljs-string">"timestamp"</span>: <span class="hljs-built_in">str</span>(<span class="hljs-built_in">int</span>(time.time())),
            <span class="hljs-string">"v"</span>: <span class="hljs-string">"2.0"</span>,
            <span class="hljs-string">"format"</span>: <span class="hljs-string">"json"</span>
        }
        <span class="hljs-keyword">if</span> fields:
            params[<span class="hljs-string">"fields"</span>] = fields
        
        <span class="hljs-comment"># 生成签名</span>
        params[<span class="hljs-string">"sign"</span>] = self._generate_sign(params)
        
        response = requests.post(self.base_url, data=params, timeout=<span class="hljs-number">10</span>)
        <span class="hljs-keyword">return</span> response.json()
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_generate_sign</span>(<span class="hljs-params">self, params</span>):
        sorted_params = <span class="hljs-built_in">sorted</span>(params.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">0</span>])
        sign_str = <span class="hljs-string">''</span>.join([<span class="hljs-string">f"<span class="hljs-subst">{k}</span><span class="hljs-subst">{v}</span>"</span> <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> sorted_params]) + self.app_secret
        <span class="hljs-keyword">return</span> hashlib.md5(sign_str.encode(<span class="hljs-string">'utf-8'</span>)).hexdigest()

<span class="hljs-comment"># 调用示例</span>
client = XianyuClient(<span class="hljs-string">"your_app_key"</span>, <span class="hljs-string">"your_secret"</span>, <span class="hljs-string">"your_token"</span>)
result = client.get_item_detail(<span class="hljs-string">"658767890123"</span>, <span class="hljs-string">"title,price,desc"</span>)
<span class="hljs-built_in">print</span>(result[<span class="hljs-string">'data'</span>][<span class="hljs-string">'item'</span>][<span class="hljs-string">'title'</span>])
</code></pre>
<h3 data-id="heading-7">Node.js 实现</h3>
<pre><code class="hljs language-JavaScript" lang="JavaScript"><span class="hljs-keyword">const</span> axios = <span class="hljs-built_in">require</span>(<span class="hljs-string">'axios'</span>);
<span class="hljs-keyword">const</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);

<span class="hljs-keyword">class</span> <span class="hljs-title class_">XianyuClient</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">appKey, appSecret, accessToken</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseURL</span> = <span class="hljs-string">'https://api.xianyu.com/router/rest'</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">appKey</span> = appKey;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">appSecret</span> = appSecret;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">accessToken</span> = accessToken;
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getItemDetail</span>(<span class="hljs-params">itemId, fields = <span class="hljs-literal">null</span></span>) {
    <span class="hljs-keyword">const</span> params = {
      <span class="hljs-attr">method</span>: <span class="hljs-string">'xianyu.item.get'</span>,
      <span class="hljs-attr">app_key</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">appKey</span>,
      <span class="hljs-attr">access_token</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">accessToken</span>,
      <span class="hljs-attr">item_id</span>: itemId,
      <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() / <span class="hljs-number">1000</span>).<span class="hljs-title function_">toString</span>(),
      <span class="hljs-attr">v</span>: <span class="hljs-string">'2.0'</span>,
      <span class="hljs-attr">format</span>: <span class="hljs-string">'json'</span>
    };
    
    <span class="hljs-keyword">if</span> (fields) params.<span class="hljs-property">fields</span> = fields;
    params.<span class="hljs-property">sign</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_generateSign</span>(params);

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">baseURL</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(params), {
      <span class="hljs-attr">timeout</span>: <span class="hljs-number">10000</span>,
      <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span> }
    });
    <span class="hljs-keyword">return</span> response.<span class="hljs-property">data</span>;
  }

  <span class="hljs-title function_">_generateSign</span>(<span class="hljs-params">params</span>) {
    <span class="hljs-keyword">const</span> sorted = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(params).<span class="hljs-title function_">sort</span>().<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">k</span> =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${k}</span><span class="hljs-subst">${params[k]}</span>`</span>);
    <span class="hljs-keyword">const</span> signStr = sorted.<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>) + <span class="hljs-variable language_">this</span>.<span class="hljs-property">appSecret</span>;
    <span class="hljs-keyword">return</span> crypto.<span class="hljs-title function_">createHash</span>(<span class="hljs-string">'md5'</span>).<span class="hljs-title function_">update</span>(signStr, <span class="hljs-string">'utf8'</span>).<span class="hljs-title function_">digest</span>(<span class="hljs-string">'hex'</span>);
  }
}

<span class="hljs-comment">// 调用示例</span>
<span class="hljs-keyword">const</span> client = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XianyuClient</span>(<span class="hljs-string">'your_app_key'</span>, <span class="hljs-string">'your_secret'</span>, <span class="hljs-string">'your_token'</span>);
client.<span class="hljs-title function_">getItemDetail</span>(<span class="hljs-string">'658767890123'</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">data</span>.<span class="hljs-property">item</span>.<span class="hljs-property">price</span>.<span class="hljs-property">current</span>))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(err));
</code></pre>
<hr/>
<h2 data-id="heading-8">五、高频应用场景</h2>
<h3 data-id="heading-9">场景1：价格监控系统</h3>
<pre><code class="hljs language-Python" lang="Python"><span class="hljs-comment"># 定时轮询核心商品</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">price_monitor</span>(<span class="hljs-params">item_id_list</span>):
    <span class="hljs-keyword">for</span> item_id <span class="hljs-keyword">in</span> item_id_list:
        detail = client.get_item_detail(item_id, <span class="hljs-string">"title,price,status"</span>)
        <span class="hljs-keyword">if</span> detail[<span class="hljs-string">'code'</span>] == <span class="hljs-number">200</span>:
            item = detail[<span class="hljs-string">'data'</span>][<span class="hljs-string">'item'</span>]
            <span class="hljs-comment"># 写入时序数据库</span>
            save_to_influxdb(item_id, item[<span class="hljs-string">'price'</span>][<span class="hljs-string">'current'</span>], item[<span class="hljs-string">'status'</span>])
</code></pre>
<h3 data-id="heading-10">场景2：智能选品决策</h3>
<p>通过分析商品详情中的<code>view_count</code>、<code>want_count</code>、<code>publish_time</code>等字段，计算商品热度指数：</p>
<p><code>热度指数 = (想要人数 × 0.6 + 浏览量 × 0.4) / 上架天数</code></p>
<h3 data-id="heading-11">场景3：供应链溯源</h3>
<p>结合<code>seller.verify_status</code>、<code>credit_score</code>及商品描述，构建可信度模型，识别高风险商品。</p>
<hr/>
<h2 data-id="heading-12">六、注意事项与问题排查</h2>
<h3 data-id="heading-13">6.1 调用限制</h3>
<ul>
<li><strong>频率限制</strong>：IP级100次/分钟，应用级1000次/分钟</li>
<li><strong>数据新鲜度</strong>：API数据有5分钟缓存，实时性要求高的场景需订阅Webhook推送</li>
<li><strong>字段精简</strong>：务必使用<code>fields</code>参数指定所需字段，减少带宽消耗</li>
</ul>
<h3 data-id="heading-14">6.2 错误码速查</h3>








































<table><thead><tr><th align="left">错误码</th><th align="left">说明</th><th align="left">处理建议</th></tr></thead><tbody><tr><td align="left">400</td><td align="left">参数错误</td><td align="left">检查item_id是否为纯数字</td></tr><tr><td align="left">401</td><td align="left">授权失效</td><td align="left">refresh_token或重新OAuth</td></tr><tr><td align="left">403</td><td align="left">权限不足</td><td align="left">申请item_get接口权限包</td></tr><tr><td align="left">404</td><td align="left">商品不存在</td><td align="left">商品已下架或ID错误</td></tr><tr><td align="left">429</td><td align="left">频率超限</td><td align="left">实现指数退避重试策略</td></tr><tr><td align="left">500</td><td align="left">服务异常</td><td align="left">联系技术支持并提供request_id</td></tr></tbody></table>
<h3 data-id="heading-15">6.3 性能优化技巧</h3>
<ul>
<li><strong>连接池</strong>：使用HTTP keep-alive，复用TCP连接</li>
<li><strong>批量查询</strong>：如需获取多个商品，使用<code>item_list_get</code>接口（支持20个ID）</li>
<li><strong>缓存策略</strong>：对非敏感字段（如商品标题）缓存10分钟</li>
<li><strong>降级方案</strong>：接口超时返回缓存数据，并异步更新</li>
</ul>
<hr/>
<h2 data-id="heading-16">七、数据合规与安全建议</h2>
<ol>
<li><strong>用户隐私保护</strong>：返回数据中的<code>seller.user_id</code>需脱敏后展示，禁止公开</li>
<li><strong>图片防盗链</strong>：<code>images</code>字段URL含时效token，有效期2小时，禁止永久存储</li>
<li><strong>价格数据使用</strong>：不得用于价格歧视或恶意竞价，遵守平台数据使用协议</li>
<li><strong>日志审计</strong>：记录所有API调用日志，保留90天以供合规审查</li>
</ol>
<hr/>
<h2 data-id="heading-17">八、未来能力展望</h2>
<p>某鱼平台正逐步开放更多高价值接口：</p>
<ul>
<li><code>item_recommendations_get</code>：获取相似商品推荐</li>
<li><code>seller_items_get</code>：批量获取卖家在售商品</li>
<li><code>price_trend_get</code>：获取商品价格走势图</li>
</ul>
<p>建议开发者关注开放平台动态，及时申请新能力权限。</p>
<hr/>
<h2 data-id="heading-18">结语</h2>
<p><code>item_get</code>接口是连接某鱼商品数据与业务创新的桥梁。通过合理的调用策略、健壮的错误处理与严格的数据合规，开发者可以基于此构建选品工具、数据分析平台、智能定价系统等多样化应用。记住：<strong>尊重数据价值，遵守平台规则</strong>，方能实现长期稳定的数据服务集成。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 Gin 框架加载 HTML 模板：`LoadHTMLGlob` 和 `LoadHTMLFiles` 的比较与优化]]></title>    <link>https://juejin.cn/post/7573876900230348863</link>    <guid>https://juejin.cn/post/7573876900230348863</guid>    <pubDate>2025-11-18T09:38:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573876900230348863" data-draft-id="7573855399717273619" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 Gin 框架加载 HTML 模板：`LoadHTMLGlob` 和 `LoadHTMLFiles` 的比较与优化"/> <meta itemprop="keywords" content="后端,Go,Gin"/> <meta itemprop="datePublished" content="2025-11-18T09:38:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="嘿嘿"/> <meta itemprop="url" content="https://juejin.cn/user/325111172830792"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 Gin 框架加载 HTML 模板：`LoadHTMLGlob` 和 `LoadHTMLFiles` 的比较与优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/325111172830792/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    嘿嘿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:38:37.000Z" title="Tue Nov 18 2025 09:38:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>PS:在使用gin框架渲染前端模板时遇到了问题，关于这俩方法的一个区别，记录下来备忘一下。</p>
<p>在使用 Gin 框架开发 Web 应用时，模板渲染是一个常见的需求。Gin 提供了 <code>LoadHTMLGlob</code> 和 <code>LoadHTMLFiles</code> 两个函数来加载 HTML 模板。本文将详细介绍这两个函数的用法，并结合实际项目需求，探讨如何更灵活地加载模板文件，特别是当模板文件分布在多个子文件夹中时。</p>
<h2 data-id="heading-0">1. <code>LoadHTMLGlob</code> 函数</h2>
<p><code>LoadHTMLGlob</code> 函数用于根据通配符模式加载模板文件。它的签名如下：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> LoadHTMLGlob(pattern <span class="hljs-type">string</span>)
</code></pre>
<h3 data-id="heading-1">用法示例</h3>
<pre><code class="hljs language-css" lang="css">r := gin.<span class="hljs-built_in">Default</span>()
r.<span class="hljs-built_in">LoadHTMLGlob</span>(<span class="hljs-string">"templates/*"</span>)
</code></pre>
<h3 data-id="heading-2">特点</h3>
<ul>
<li><strong>一次调用</strong>：<code>LoadHTMLGlob</code> <strong>只能调用一次，多次调用时只有最后一次调用生效。</strong></li>
<li><strong>通配符模式</strong>：支持通配符模式，可以一次性加载多个文件。</li>
<li><strong>灵活性</strong>：适用于模板文件位于同一目录下的情况。</li>
</ul>
<h3 data-id="heading-3">示例</h3>
<p>假设模板文件结构如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">web/
└── templates/
<span class="hljs-code">    ├── index.html
    └── user/
        └── profile.html
</span></code></pre>
<p>使用 <code>LoadHTMLGlob</code> 加载模板文件：</p>
<pre><code class="hljs language-arduino" lang="arduino">r.<span class="hljs-built_in">LoadHTMLGlob</span>(<span class="hljs-string">"web/templates/**/*"</span>)
</code></pre>
<h3 data-id="heading-4">注意事项</h3>
<ul>
<li>通配符模式需要正确设置，否则可能无法加载所有模板文件。</li>
<li><strong>只能调用一次，多次调用时只有最后一次生效</strong>。</li>
</ul>
<h2 data-id="heading-5">2. <code>LoadHTMLFiles</code> 函数</h2>
<p><code>LoadHTMLFiles</code> 函数用于加载指定的模板文件。它的签名如下：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(engine *Engine)</span></span> LoadHTMLFiles(files ...<span class="hljs-type">string</span>)
</code></pre>
<h3 data-id="heading-6">用法示例</h3>
<pre><code class="hljs language-css" lang="css">r := gin.<span class="hljs-built_in">Default</span>()
r.<span class="hljs-built_in">LoadHTMLFiles</span>(<span class="hljs-string">"templates/index.html"</span>, <span class="hljs-string">"templates/user/profile.html"</span>)
</code></pre>
<h3 data-id="heading-7">特点</h3>
<ul>
<li><strong>多次调用</strong>：可以多次调用，每次调用都会加载新的模板文件。</li>
<li><strong>指定文件</strong>：需要明确指定每个模板文件的路径。</li>
<li><strong>灵活性</strong>：适用于模板文件分布在多个目录下的情况。</li>
</ul>
<h3 data-id="heading-8">示例</h3>
<p>假设模板文件结构如下：</p>
<pre><code class="hljs language-markdown" lang="markdown">web/
└── templates/
<span class="hljs-code">    ├── index.html
    └── user/
        └── profile.html
</span></code></pre>
<p>使用 <code>LoadHTMLFiles</code> 加载模板文件：</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">var</span> tplFiles []<span class="hljs-type">string</span>
filepath.WalkDir(<span class="hljs-string">"./web/templates"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(path <span class="hljs-type">string</span>, d fs.DirEntry, err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">error</span> {
    <span class="hljs-keyword">if</span> d.IsDir() {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    }
    tplFiles = <span class="hljs-built_in">append</span>(tplFiles, path)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
})
r.LoadHTMLFiles(tplFiles...)
</code></pre>
<h3 data-id="heading-9">注意事项</h3>
<ul>
<li>需要手动遍历目录并收集所有模板文件路径。</li>
<li>每次调用都会加载新的模板文件，可能会导致性能问题。</li>
</ul>
<h2 data-id="heading-10">优化方案</h2>
<p>在实际项目中，模板文件可能会分布在多个子文件夹中，使用 <code>LoadHTMLGlob</code> 可能无法满足需求。<code>LoadHTMLFiles</code> 提供了更大的灵活性，但需要手动收集模板文件路径。下面是一个优化方案，结合 <code>filepath.WalkDir</code> 和 <code>LoadHTMLFiles</code> 来灵活加载模板文件。</p>
<h3 data-id="heading-11">步骤</h3>
<ol>
<li><strong>遍历目录</strong>：使用 <code>filepath.WalkDir</code> 遍历模板目录，收集所有模板文件路径。</li>
<li><strong>加载模板</strong>：使用 <code>LoadHTMLFiles</code> 加载收集到的模板文件路径。</li>
</ol>
<h3 data-id="heading-12">实现代码</h3>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"embed"</span>
    <span class="hljs-string">"fmt"</span>
    <span class="hljs-string">"log"</span>
    <span class="hljs-string">"net/http"</span>
    <span class="hljs-string">"path/filepath"</span>

    <span class="hljs-string">"github.com/gin-gonic/gin"</span>
)

<span class="hljs-comment">//go:embed web/templates</span>
<span class="hljs-keyword">var</span> templates embed.FS

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    r := gin.Default()

    <span class="hljs-comment">// 收集所有模板文件路径</span>
    <span class="hljs-keyword">var</span> tplFiles []<span class="hljs-type">string</span>
    err := filepath.WalkDir(<span class="hljs-string">"./web/templates"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(path <span class="hljs-type">string</span>, d fs.DirEntry, err <span class="hljs-type">error</span>)</span></span> <span class="hljs-type">error</span> {
        <span class="hljs-keyword">if</span> d.IsDir() {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
        }
        tplFiles = <span class="hljs-built_in">append</span>(tplFiles, path)
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
    })
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"Failed to walk templates directory: %v"</span>, err)
    }

    <span class="hljs-comment">// 加载模板文件</span>
    r.LoadHTMLFiles(tplFiles...)

    <span class="hljs-comment">// 定义路由</span>
    r.GET(<span class="hljs-string">"/"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        c.HTML(http.StatusOK, <span class="hljs-string">"index.html"</span>, gin.H{
            <span class="hljs-string">"title"</span>: <span class="hljs-string">"Home Page"</span>,
        })
    })

    r.GET(<span class="hljs-string">"/user/profile"</span>, <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(c *gin.Context)</span></span> {
        c.HTML(http.StatusOK, <span class="hljs-string">"user/profile.html"</span>, gin.H{
            <span class="hljs-string">"title"</span>: <span class="hljs-string">"User Profile"</span>,
        })
    })

    <span class="hljs-comment">// 启动服务器</span>
    <span class="hljs-keyword">if</span> err := r.Run(<span class="hljs-string">":8080"</span>); err != <span class="hljs-literal">nil</span> {
        log.Fatalf(<span class="hljs-string">"Failed to start server: %v"</span>, err)
    }
}
</code></pre>
<h3 data-id="heading-13">详细说明</h3>
<ol>
<li>
<p><strong>遍历目录</strong>：</p>
<ul>
<li>使用 <code>filepath.WalkDir</code> 遍历 <code>web/templates</code> 目录，收集所有文件路径。</li>
<li><code>filepath.WalkDir</code> 会递归地遍历目录，确保所有子目录中的文件都被收集。</li>
</ul>
</li>
<li>
<p><strong>加载模板</strong>：</p>
<ul>
<li>使用 <code>r.LoadHTMLFiles(tplFiles...)</code> 加载所有收集到的模板文件路径。</li>
<li><code>LoadHTMLFiles</code> 可以多次调用，但这里只调用一次，确保所有模板文件都被加载。</li>
</ul>
</li>
<li>
<p><strong>定义路由</strong>：</p>
<ul>
<li>定义路由并渲染模板。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-14">优点</h3>
<ul>
<li><strong>灵活性</strong>：可以加载分布在多个子文件夹中的模板文件。</li>
<li><strong>可维护性</strong>：模板文件路径自动收集，无需手动指定。</li>
</ul>
<h3 data-id="heading-15">注意事项</h3>
<ul>
<li>确保模板文件路径正确。</li>
<li>大量模板文件时，遍历和加载可能会影响性能，可以考虑缓存模板文件。</li>
</ul>
<h2 data-id="heading-16">总结</h2>
<p><code>LoadHTMLGlob</code> 和 <code>LoadHTMLFiles</code> 都是 Gin 框架中用于加载 HTML 模板的函数，各有优缺点。<code>LoadHTMLGlob</code> 适用于模板文件位于同一目录下的情况，而 <code>LoadHTMLFiles</code> 提供了更大的灵活性，适用于模板文件分布在多个目录中的情况。通过结合 <code>filepath.WalkDir</code> 和 <code>LoadHTMLFiles</code>，可以更灵活地加载模板文件，满足复杂项目的需求。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[视觉分层，对人工神经网络的启示]]></title>    <link>https://juejin.cn/post/7573855399717306387</link>    <guid>https://juejin.cn/post/7573855399717306387</guid>    <pubDate>2025-11-18T09:39:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573855399717306387" data-draft-id="7573863952116318214" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="视觉分层，对人工神经网络的启示"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-11-18T09:39:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Juchecar"/> <meta itemprop="url" content="https://juejin.cn/user/284133851925070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            视觉分层，对人工神经网络的启示
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/284133851925070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Juchecar
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:39:03.000Z" title="Tue Nov 18 2025 09:39:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    3
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>人脑视觉系统的层次化处理模型为人工神经网络（尤其是计算机视觉和AGI）的发展提供了至关重要的借鉴路线图、批判性镜子和灵感源泉。</p>
<p>以下是一些关键的借鉴意义：</p>
<h3 data-id="heading-0">1. 核心架构启示：层次化与模块化</h3>
<p><strong>人脑的启示</strong>：视觉通路是清晰的层次化结构（V1 -&gt; V2 -&gt; V4 -&gt; IT...），且存在一定程度的模块化（如面孔区、文字区）。</p>
<p><strong>对ANN的借鉴</strong>：</p>
<ul>
<li><strong>深度卷积网络的成功</strong>：CNN的“卷积层 -&gt; 池化层 -&gt; 全连接层”结构本身就是对大脑层次化处理的最直接致敬。浅层网络学习边缘、纹理等通用特征，深层网络学习更抽象的特征（如车轮、眼睛）。</li>
<li><strong>超越“端到端”的黑箱</strong>：当前很多模型是单一任务的“端到端”学习。大脑告诉我们，<strong>构建一些专门化的“子系统”可能更高效</strong>。例如，在通用视觉模型之上，微调出用于医疗影像、自动驾驶、工业质检的专用模块，这类似于大脑在通用物体识别区旁“长出”了面孔识别区。</li>
<li><strong>通向AGI的路径</strong>：要实现通用人工智能，不能只靠一个巨型网络。可能需要一个由多个专门化、层次化的子系统组成的“联盟”，就像大脑有不同的视觉流（腹侧通路“是什么”，背侧通路“在哪里”）。</li>
</ul>
<h3 data-id="heading-1">2. 处理策略启示：从通用到专用，从无监督到有监督</h3>
<p><strong>人脑的启示</strong>：大脑的低级视觉皮层（如V1）在出生时就具备了一定的结构，对线条、朝向等有先天偏好。随后通过海量的无监督学习（婴儿不停地看世界）来锤炼这些连接，最后才由文化教育（有监督学习）来精细调整高级区域（如文字识别区）。</p>
<p><strong>对ANN的借鉴</strong>：</p>
<ul>
<li><strong>预训练与迁移学习</strong>：这类似于大脑的“先天结构+无监督学习”。我们先在海量无标签数据（如ImageNet）上对模型进行预训练，让它学习通用的视觉特征，然后再用少量有标签数据对特定任务（如医学影像分类）进行微调。这正是大脑从“学会看”到“看懂特定东西”的缩影。</li>
<li><strong>重视无监督/自监督学习</strong>：大脑主要依靠无监督学习。这激励我们大力发展自监督学习算法，让模型能从世界本身的结构中学习，减少对昂贵人工标注数据的依赖。这才是通向更智能系统的关键。</li>
</ul>
<h3 data-id="heading-2">3. 信息流启示：前馈与反馈的闭环</h3>
<p><strong>人脑的启示</strong>：大脑中的“前馈连接”负责快速传递信息，但更有大量的是“反馈连接”。高级区域会不断向低级区域发送信号，调节其活动。这就是<strong>注意力机制</strong>和<strong>预测编码</strong> 的神经基础。你看到的不仅是你眼睛收到的，更是你大脑“预期”收到的。</p>
<p><strong>对ANN的借鉴</strong>：</p>
<ul>
<li><strong>注意力机制的普及</strong>：Transformer架构中的自注意力机制和CNN中的注意力模块，正是对这种反馈调节的模拟。它让模型能够“聚焦”于输入中更重要的部分，动态调整其处理资源，极大地提升了性能。</li>
<li><strong>生成式模型与预测学习</strong>：像GANs、Diffusion Models这样的生成式模型，其核心思想是让模型学习数据的分布，并能够“预测”或“生成”完整数据。这类似于大脑不断根据上下文和先验知识对感官输入进行预测和补全。未来的感知模型很可能将是“分析-生成”一体化的。</li>
</ul>
<h3 data-id="heading-3">4. 多模态融合启示：跨模态的深度融合</h3>
<p><strong>人脑的启示</strong>：当你看到一个苹果，你大脑中关于它的颜色、形状、触感、味道、名称的神经网络会同时激活。视觉识别不是孤立的，它与触觉、听觉、语义、情感记忆紧密交织。</p>
<p><strong>对ANN的借鉴</strong>：</p>
<ul>
<li><strong>多模态大模型是未来</strong>：CLIP模型的成功证明了这一点。通过将图像和文本在同一个嵌入空间中对齐，模型获得了强大的零样本推理能力。这正是对大脑“概念系统”的模仿，一个苹果的视觉表象和“apple”这个词义，在大脑中是指向同一个概念的。</li>
<li><strong>符号与感知的结合</strong>：纯连接主义模型（如ANN）在处理抽象推理和符号逻辑上仍有困难。大脑则完美地将亚符号的感知（一个红色的圆形物体）与符号化的概念（“苹果”、“食物”）结合在一起。这提示我们，<strong>下一代AI可能需要连接主义与符号主义的新融合</strong>。</li>
</ul>
<h3 data-id="heading-4">5. 对“美”的理解的启示：构建价值系统</h3>
<p><strong>人脑的启示</strong>：“美”的判断是一个多因素评估系统，涉及本能、学习、情感和文化的复杂互动。</p>
<p><strong>对ANN的借鉴</strong>：</p>
<ul>
<li><strong>超越分类和检测</strong>：当前AI的目标函数多是“准确分类”、“精确检测”。但要实现更高级的智能（如具身AI、创意AI），我们需要为它们引入<strong>内在动机和价值系统</strong>。</li>
<li><strong>AI艺术与评估</strong>：我们能否训练一个AI来评估“美感”？这需要为它提供不仅仅是物体标签的数据，而是融合了对称性、色彩和谐、文化语境、甚至情感共鸣的复杂训练目标。这实际上是尝试将人类的“价值判断”机制部分地编码到模型中。</li>
</ul>
<h3 data-id="heading-5">总结与挑战</h3>

































<table><thead><tr><th align="left">人脑特性</th><th align="left">对人工神经网络的借鉴与挑战</th></tr></thead><tbody><tr><td align="left"><strong>层次化与模块化</strong></td><td align="left">深度网络的成功；需发展更灵活的模块化架构。</td></tr><tr><td align="left"><strong>无监督学习为主</strong></td><td align="left">需大力发展自监督学习，减少对标注数据的依赖。</td></tr><tr><td align="left"><strong>强大的反馈连接</strong></td><td align="left">引入注意力机制、预测编码，构建分析-生成一体化模型。</td></tr><tr><td align="left"><strong>多模态深度融合</strong></td><td align="left">发展多模态大模型，探索符号与感知的结合。</td></tr><tr><td align="left"><strong>具身与互动</strong></td><td align="left">AI需要与世界互动，才能获得真正的“理解”。</td></tr><tr><td align="left"><strong>价值与情感系统</strong></td><td align="left">为高级AI构建内在动机和价值判断系统。</td></tr></tbody></table>
<p><strong>最终，人脑给我们的最大启示是：智能不是一个单一的“识别”任务，而是一个由感知、行动、记忆、情感和价值判断紧密交织而成的、与环境持续互动的动态过程。</strong> 当前的人工神经网络在“感知”的某些方面已经取得了惊人成就，但在走向更通用智能的道路上，我们必须借鉴大脑的这种整体性、互动性和价值导向性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[CSS奇技淫巧：用你意想不到的4种属性实现裁剪遮罩效果]]></title>    <link>https://juejin.cn/post/7573680361990602792</link>    <guid>https://juejin.cn/post/7573680361990602792</guid>    <pubDate>2025-11-18T09:40:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573680361990602792" data-draft-id="7566537463567810600" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="CSS奇技淫巧：用你意想不到的4种属性实现裁剪遮罩效果"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-18T09:40:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一诺滚雪球"/> <meta itemprop="url" content="https://juejin.cn/user/2824015112318094"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            CSS奇技淫巧：用你意想不到的4种属性实现裁剪遮罩效果
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2824015112318094/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一诺滚雪球
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:40:33.000Z" title="Tue Nov 18 2025 09:40:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">背景</h2>
<p>在公司开发图片裁剪功能时，需要实现一个裁剪框效果：选中区域清晰显示，而周围区域用半透明遮罩覆盖。正常我实现会用4个div分别盖住上、下、左、右四个区域用于裁剪框周围的遮罩。</p>
<p>本文将介绍几种纯CSS实现的巧妙实现方案，主要内容有：</p>
<ol>
<li>box-shadow 阴影方法</li>
<li>outline 轮廓法</li>
<li>clip-path 裁剪方法</li>
<li>background 渐变方法</li>
</ol>
<p>展示的效果如下：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fc83681b2577489598c9f143929bd2af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6K-65rua6Zuq55CD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764063633&amp;x-signature=ox%2FordQ53Rkxc%2BstSEbwr92EkEM%3D" alt="image.png" loading="lazy"/></p>
<p>下面分别介绍下每种方式的实现。</p>
<h2 data-id="heading-1">1. box-shadow 方法</h2>
<p>原理是利用 box-shadow 的扩散半径特性，设置一个超大的阴影覆盖整个画布。 优点是：代码量最少，只需一行CSS，实现简单。</p>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-property">crop</span>-box {
  box-<span class="hljs-attr">shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> 9999px <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
}
</code></pre>
<h2 data-id="heading-2">2. outline 方法</h2>
<p>原理和box-shadow 类似，使用超大的 outline 实现遮罩。
outline（轮廓）与border类似，但不占用文档流空间，且不会影响元素尺寸。通过超大outline覆盖非裁剪区域，实现遮罩效果。</p>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-property">crop</span>-box {
  <span class="hljs-attr">outline</span>: 9999px solid <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
}
</code></pre>
<h2 data-id="heading-3">3. 伪元素 + clip-path 方法</h2>
<p>原理是使用 ::before 伪元素创建遮罩，通过 clip-path 的 polygon 裁剪出中间镂空区域。</p>
<pre><code class="hljs language-js" lang="js">  .<span class="hljs-property">wrapper</span>::before {
      <span class="hljs-attr">content</span>: <span class="hljs-string">''</span>;
      <span class="hljs-attr">background</span>: <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.5</span>);
      clip-<span class="hljs-attr">path</span>: <span class="hljs-title function_">polygon</span>(
          <span class="hljs-number">0</span> <span class="hljs-number">0</span>, <span class="hljs-number">0</span> <span class="hljs-number">100</span>%, 50px <span class="hljs-number">100</span>%, 50px 50px,
          250px 50px, 250px 200px, 50px 200px,
          50px <span class="hljs-number">100</span>%, <span class="hljs-number">100</span>% <span class="hljs-number">100</span>%, <span class="hljs-number">100</span>% <span class="hljs-number">0</span>
      );
  }
</code></pre>
<h2 data-id="heading-4">4. background 渐变方法</h2>
<p>原理是使用 linear-gradient 创建十字交叉的渐变遮罩。利用线性渐变（linear-gradient）的“颜色断层”特性，生成四宫格状的遮罩效果，非裁剪区域用半透明色覆盖，目标区域为透明。</p>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-property">wrapper</span> {
    <span class="hljs-attr">position</span>: absolute;
    <span class="hljs-attr">inset</span>: <span class="hljs-number">0</span>;
    background-<span class="hljs-attr">image</span>:
        <span class="hljs-comment">/* 上方遮罩 */</span>
        linear-<span class="hljs-title function_">gradient</span>(<span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>), <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>)),
        <span class="hljs-comment">/* 下方遮罩 */</span>
        linear-<span class="hljs-title function_">gradient</span>(<span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>), <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>)),
        <span class="hljs-comment">/* 左侧遮罩 */</span>
        linear-<span class="hljs-title function_">gradient</span>(<span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>), <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>)),
        <span class="hljs-comment">/* 右侧遮罩 */</span>
        linear-<span class="hljs-title function_">gradient</span>(<span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>), <span class="hljs-title function_">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.5</span>));
    background-<span class="hljs-attr">size</span>:
        <span class="hljs-number">100</span>% 50px,      <span class="hljs-comment">/* 上方 */</span>
        <span class="hljs-number">100</span>% <span class="hljs-title function_">calc</span>(<span class="hljs-number">100</span>% - 200px), <span class="hljs-comment">/* 下方 */</span>
        50px 150px,     <span class="hljs-comment">/* 左侧 */</span>
        <span class="hljs-title function_">calc</span>(<span class="hljs-number">100</span>% - 250px) 150px; <span class="hljs-comment">/* 右侧 */</span>
    background-<span class="hljs-attr">position</span>:
        <span class="hljs-number">0</span> <span class="hljs-number">0</span>,            <span class="hljs-comment">/* 上方 */</span>
        <span class="hljs-number">0</span> 200px,        <span class="hljs-comment">/* 下方 */</span>
        <span class="hljs-number">0</span> 50px,         <span class="hljs-comment">/* 左侧 */</span>
        250px 50px;     <span class="hljs-comment">/* 右侧 */</span>
    background-<span class="hljs-attr">repeat</span>: no-repeat;
    pointer-<span class="hljs-attr">events</span>: none;
}

</code></pre>
<h2 data-id="heading-5">总结</h2>
<p>最后总结一下：实现裁剪框遮罩效果有多种方案,在实际项目中，推荐使用 box-shadow 方法，简单高效。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别终端低效，10个让同事直呼卧槽的小技巧]]></title>    <link>https://juejin.cn/post/7573988811916017714</link>    <guid>https://juejin.cn/post/7573988811916017714</guid>    <pubDate>2025-11-18T09:48:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573988811916017714" data-draft-id="7573899782802440238" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别终端低效，10个让同事直呼卧槽的小技巧"/> <meta itemprop="keywords" content="后端,命令行"/> <meta itemprop="datePublished" content="2025-11-18T09:48:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="该用户已不存在"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别终端低效，10个让同事直呼卧槽的小技巧
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    该用户已不存在
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:48:09.000Z" title="Tue Nov 18 2025 09:48:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 IDE 横行的今天，我们这些程序员依然需要跟终端打交道，三五年下来，谁还没踩过一些坑，又或者自己琢磨出一些能让效率起飞的小窍门呢？</p>
<p>今天不聊那些 <code>ls -la</code> 比 <code>ls</code> 好用之类的基础知识，只分享那些真正改变我工作流、甚至让旁边同事忍不住探过头来问“哥们，你这手速没单身30年练不下来吧”的实战技巧。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e28acc21c0c44b3b8d9d20be99840c43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064858&amp;x-signature=eaHurpyHPqlEfwxvIvtgxbAYC7Y%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0">快速定位系统性能瓶颈</h3>
<p>服务器或者自己电脑突然变卡，得快速知道是谁在捣鬼。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查看哪个目录最占硬盘空间（只看当前目录下一级）</span>
<span class="hljs-built_in">du</span> -ah --max-depth=1 | <span class="hljs-built_in">sort</span> -rh | <span class="hljs-built_in">head</span> -n 10

<span class="hljs-comment"># 按 CPU 使用率列出排名前 10 的进程</span>
ps aux --<span class="hljs-built_in">sort</span>=-%cpu | <span class="hljs-built_in">head</span> -n 11

<span class="hljs-comment"># 按内存使用率列出排名前 10 的进程</span>
ps aux --<span class="hljs-built_in">sort</span>=-%mem | <span class="hljs-built_in">head</span> -n 11
</code></pre>
<h3 data-id="heading-1">环境和配置管理？交给专业的来</h3>
<p>以前，管理本地开发环境简直是一场灾难。一会儿要配 PHP，一会儿又要弄 Node.js，还得装个 Python。各种环境变量、数据库配置写在 <code>.bashrc</code> 或 <code>.zshrc</code> 里，像这样：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 老办法：用函数切换环境</span>
<span class="hljs-function"><span class="hljs-title">switch_env</span></span>() {
    <span class="hljs-keyword">if</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"proj_a"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">export</span> DB_HOST=<span class="hljs-string">"localhost"</span>
        <span class="hljs-built_in">export</span> DB_PORT=<span class="hljs-string">"3306"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"切换到项目 A 环境"</span>
    <span class="hljs-keyword">elif</span> [ <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> = <span class="hljs-string">"proj_b"</span> ]; <span class="hljs-keyword">then</span>
        <span class="hljs-built_in">export</span> DB_HOST=<span class="hljs-string">"127.0.0.1"</span>
        <span class="hljs-built_in">export</span> DB_PORT=<span class="hljs-string">"5432"</span>
        <span class="hljs-built_in">echo</span> <span class="hljs-string">"切换到项目 B 环境"</span>
    <span class="hljs-keyword">fi</span>
}
</code></pre>
<p>这种方式手动维护起来很麻烦，项目一多，配置文件就变得特别臃肿，切换起来也容易出错。</p>
<p>但是，时代变了，朋友们。现在我处理本地开发环境，都用 ServBay。</p>
<p>请注意，ServBay不是命令行工具，而是一个集成的<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com" target="_blank" title="https://www.servbay.com" ref="nofollow noopener noreferrer">本地开发环境平台</a>。它把程序员常用的语言，比如 PHP、Node.js、Python、Go、Rust 都打包好了，需要哪个版本点一下就行，完全不用自己去折腾编译和环境变量。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f229b9b0b3047bf80e51111c6cc3dcf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064858&amp;x-signature=XZuUaSxfK%2BPVtpIb5MAIfMJbXlU%3D" alt="CleanShot 2025-11-18 at 18.00.15@2x.png" loading="lazy"/></p>
<p>数据库也一样，无论是 SQL（MySQL, PostgreSQL）还是 NoSQL（Redis, MongoDB），都给你准备得妥妥的。而且它支持<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com" target="_blank" title="https://www.servbay.com" ref="nofollow noopener noreferrer">一键部署本地 AI</a>，适合vibe coder。</p>
<p>用了 ServBay 之后，上面那些复杂的环境切换脚本我早就删了。所有环境和配置管理都通过一个清爽的图形界面搞定，我变强了，也变快了。</p>
<h3 data-id="heading-2">一行搞定网络调试</h3>
<p>简单测试一下端口通不通，或者 API 能不能访问，完全没必要打开 Postman 那么重的工具。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查本地 3306 端口是否开放</span>
nc -zv 127.0.0.1 3306

<span class="hljs-comment"># 快速给 API 发送一个 POST 请求</span>
curl -X POST http://localhost:8080/api/v1/users \
  -H <span class="hljs-string">"Content-Type: application/json"</span> \
  -d <span class="hljs-string">'{"username":"test","role":"admin"}'</span>
</code></pre>
<h3 data-id="heading-3">目录间的闪转腾挪：<code>pushd</code> 和 <code>popd</code></h3>
<p>还在用一连串的 <code>cd ../../..</code> 来返回之前的目录吗？那也太“复古”了。试试目录栈吧。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 你当前在 /Users/me/workspace/project-a/src</span>
<span class="hljs-built_in">pushd</span> /etc/nginx/conf.d
<span class="hljs-comment"># 这时你瞬间移动到了 Nginx 配置目录，并且终端会记住你来的地方</span>

<span class="hljs-comment"># 在这里查看和修改配置...</span>
vim default.conf

<span class="hljs-comment"># 搞定之后，想回去了？</span>
<span class="hljs-built_in">popd</span>
<span class="hljs-comment"># “嗖”的一下，你又回到了 /Users/me/workspace/project-a/src</span>
</code></pre>
<p><code>pushd</code> 可以多次使用，它会把目录一个个地压入一个“栈”里。可以用 <code>dirs -v</code> 查看这个栈，然后用 <code>pushd +N</code> 跳到指定的目录。对于需要在多个不相关的目录之间反复横跳的场景，这就是大杀器。</p>
<h3 data-id="heading-4">文件操作的骚操作</h3>
<p>用 <code>cp</code> 复制大文件时，看着光标一动不动，你是不是也曾怀疑过电脑是不是死机了？</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 rsync (macOS 自带，Linux 大部分也自带)</span>
<span class="hljs-comment"># 复制文件并显示进度条</span>
rsync -avh --progress source-large-file.zip /path/to/destination/
</code></pre>
<p>查找文件，<code>find</code> 命令固然强大，但参数复杂得像咒语。我更推荐用 <code>fd</code>，一个更快、更友好的替代品。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 fd (brew install fd / apt install fd-find)</span>
<span class="hljs-comment"># 查找所有 tsx 文件</span>
fd <span class="hljs-string">".tsx$"</span>

<span class="hljs-comment"># 查找并删除所有 .log 文件</span>
fd <span class="hljs-string">".log$"</span> --<span class="hljs-built_in">exec</span> <span class="hljs-built_in">rm</span> {}
</code></pre>
<p>批量重命名文件，也不用再写复杂的脚本了。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 比如把所有的 .jpeg 后缀改成 .jpg</span>
<span class="hljs-keyword">for</span> img <span class="hljs-keyword">in</span> *.jpeg; <span class="hljs-keyword">do</span>
    <span class="hljs-built_in">mv</span> <span class="hljs-string">"<span class="hljs-variable">$img</span>"</span> <span class="hljs-string">"<span class="hljs-variable">${img%.jpeg}</span>.jpg"</span>
<span class="hljs-keyword">done</span>
</code></pre>
<h3 data-id="heading-5">历史命令的魔法：<code>!!</code> 和 <code>!$</code></h3>
<p>这个绝对是手残党和健忘症患者的良药。最常见的场景就是，刚敲了一个需要管理员权限的命令，然后……</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 信心满满地创建目录</span>
<span class="hljs-built_in">mkdir</span> /usr/local/my-app
<span class="hljs-comment"># 得到一个冷冰冰的 "Permission denied"</span>

<span class="hljs-comment"># 这时候别傻乎乎地重敲一遍，优雅地输入：</span>
sudo !!
<span class="hljs-comment"># 这行命令会自动展开成：sudo mkdir /usr/local/my-app</span>
</code></pre>
<p><code>!!</code> 代表上一条完整的命令。而 <code>!$</code> 则更精妙，它代表上一条命令的最后一个参数。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建一个藏得很深的项目目录</span>
<span class="hljs-built_in">mkdir</span> -p projects/a-very-long/and-nested/project-name

<span class="hljs-comment"># 紧接着，想进入这个目录</span>
<span class="hljs-built_in">cd</span> !$
<span class="hljs-comment"># 是的，它会自动展开成：cd projects/a-very-long/and-nested/project-name</span>

<span class="hljs-comment"># 或者，想在那个目录下创建一个文件</span>
<span class="hljs-built_in">touch</span> !$/index.js
</code></pre>
<p>自从熟练掌握了这两个符号，我的键盘方向上键和 <code>Ctrl+C</code> 的使用频率都降低了不少。</p>
<h3 data-id="heading-6">进程管理不用抓狂</h3>
<p>以前杀个进程，得先 <code>ps aux | grep xxx</code>，然后复制 PID，再 <code>kill -9 PID</code>，一套操作下来黄花菜都凉了。现在，我们可以更直接一点。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 按名字干掉某个进程</span>
pkill -f <span class="hljs-string">"gunicorn"</span>

<span class="hljs-comment"># 优雅地请所有 Python 脚本进程“离开”</span>
pkill -f <span class="hljs-string">"python.*.py"</span>
</code></pre>
<p>对于我们这些经常和端口打交道的开发者来说，端口被占用的问题更是家常便饭。下面这个函数，我把它写进了我的 <code>.zshrc</code> 里，谁用谁知道。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 定义一个函数，专门用来释放被占用的端口</span>
<span class="hljs-function"><span class="hljs-title">free_port</span></span>() {
    lsof -i tcp:<span class="hljs-variable">$1</span> | grep LISTEN | awk <span class="hljs-string">'{print $2}'</span> | xargs <span class="hljs-built_in">kill</span> -9
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"端口 <span class="hljs-variable">$1</span> 已释放"</span>
}

<span class="hljs-comment"># 比如，干掉占用 8000 端口的那个“钉子户”</span>
free_port 8000
</code></pre>
<h3 data-id="heading-7">给 Git 整个外挂</h3>
<p>把这些别名（alias）加到 <code>~/.gitconfig</code> 文件里，每天能省下无数次敲击键盘的力气。</p>
<pre><code class="hljs language-bash" lang="bash">[<span class="hljs-built_in">alias</span>]
    co = checkout
    br = branch
    ci = commit -m
    st = status -sb
    lg = <span class="hljs-built_in">log</span> --graph --pretty=format:<span class="hljs-string">'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset'</span>
    
    <span class="hljs-comment"># 把暂存区的修改撤销回来</span>
    unstage = reset HEAD --
    
    <span class="hljs-comment"># 彻底丢弃上一次提交，但保留代码改动</span>
    undo = reset --soft HEAD~1

    <span class="hljs-comment"># 一键推送当前分支到远程</span>
    pushup = <span class="hljs-string">"!git push --set-upstream origin <span class="hljs-subst">$(git rev-parse --abbrev-ref HEAD)</span>"</span>
</code></pre>
<p>还有一个我特别喜欢的，一键清理已经合并到主干的本地分支，分支列表干净清爽。</p>
<pre><code class="hljs language-bash" lang="bash">git branch --merged main | grep -v <span class="hljs-string">"*|main|develop"</span> | xargs -n 1 git branch -d
</code></pre>
<h3 data-id="heading-8">文本处理，快准狠</h3>
<p>从日志里捞个邮箱，或者快速格式化一坨 JSON，都是日常操作。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 从文件里提取所有 URL</span>
grep -oE <span class="hljs-string">'https?://[a-zA-Z0-9./-]+'</span> access.log

<span class="hljs-comment"># 格式化粘贴板里的 JSON (macOS)</span>
pbpaste | jq .

<span class="hljs-comment"># 从 API 响应中只提取需要的字段</span>
curl -s <span class="hljs-string">'https://api.github.com/users/torvalds'</span> | jq <span class="hljs-string">'.name, .followers'</span>
</code></pre>
<h3 data-id="heading-9">把重复劳动变成自动化脚本</h3>
<p>真正拉开效率差距的，是把那些每天都在重复的操作，变成一个可以随时呼叫的函数或脚本。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 比如，创建一个新前端项目的完整流程</span>
<span class="hljs-function"><span class="hljs-title">new_react_project</span></span>() {
    npx create-react-app <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span> &amp;&amp; <span class="hljs-built_in">cd</span> <span class="hljs-string">"<span class="hljs-variable">$1</span>"</span>
    git init &amp;&amp; git add .
    git commit -m <span class="hljs-string">"🎉 Initial commit"</span>
    <span class="hljs-comment"># 自动在 VS Code 中打开</span>
    code .
}

<span class="hljs-comment"># 比如，在执行危险操作前，快速打包备份当前目录</span>
<span class="hljs-function"><span class="hljs-title">backup</span></span>() {
    <span class="hljs-built_in">local</span> fname=<span class="hljs-string">"backup-<span class="hljs-subst">$(date +%Y%m%d-%H%M)</span>.tar.gz"</span>
    tar -czvf <span class="hljs-string">"<span class="hljs-variable">$fname</span>"</span> . --exclude-from=.gitignore
    <span class="hljs-built_in">echo</span> <span class="hljs-string">"备份完成: <span class="hljs-variable">$fname</span>"</span>
}
</code></pre>
<p>把这些函数写进 <code>.bashrc</code> 或 <code>.zshrc</code>，下次再做同样的事情时，只需要敲一个命令就搞定了。</p>
<h3 data-id="heading-10">写在最后</h3>
<p>这些技巧本身并不复杂，但它们就像肌肉记忆，一旦养成习惯，就能在日常工作中节省大量时间。对程序员来说，时间就是头发。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Qt6 QML 实现DateTimePicker组件]]></title>    <link>https://juejin.cn/post/7573855399717371923</link>    <guid>https://juejin.cn/post/7573855399717371923</guid>    <pubDate>2025-11-18T09:49:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573855399717371923" data-draft-id="7573876900230414399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Qt6 QML 实现DateTimePicker组件"/> <meta itemprop="keywords" content="前端,Qt"/> <meta itemprop="datePublished" content="2025-11-18T09:49:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="喵个咪"/> <meta itemprop="url" content="https://juejin.cn/user/1350630784901262"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Qt6 QML 实现DateTimePicker组件
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1350630784901262/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    喵个咪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:49:52.000Z" title="Tue Nov 18 2025 09:49:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Qt6 QML 实现DateTimePicker组件</h2>
<h3 data-id="heading-1">实现代码</h3>
<p>基于QT6.10</p>
<pre><code class="hljs language-qmllang" lang="qmllang">// DateTimePicker.qml
import QtQuick
import QtQuick.Controls
import QtQuick.Layouts

Popup {
    id: dateTimePicker

    width: 650
    height: 480

    modal: true
    closePolicy: Popup.CloseOnEscape | Popup.CloseOnPressOutside
    padding: 0
    focus: true

    readonly property color colorBackground: "#2b2b2b"
    readonly property color colorSurface: "#1e1e1e"
    readonly property color colorSurfaceVariant: "#222"
    readonly property color colorBorder: "#444"
    readonly property color colorBorderLight: "#555"

    readonly property color colorPrimary: "#007AFF"
    readonly property color colorPrimaryHover: "#0066CC"

    readonly property color colorTextPrimary: "white"
    readonly property color colorTextSecondary: "#aaa"
    readonly property color colorTextTertiary: "#888"
    readonly property color colorTextDisabled: "#444"

    readonly property color colorHover: "#333"
    readonly property color colorHoverLight: "#444"
    readonly property color colorHoverDark: "#555"

    readonly property color colorScrollbar: "#555"
    readonly property color colorScrollbarHover: "#666"
    readonly property color colorScrollbarPressed: "#888"

    readonly property color colorDisabled: "#555"

    property string dateTime: Qt.formatDateTime(new Date(), "yyyy-MM-dd hh:mm:ss")
    property string dateFormat: "yyyy-MM-dd"
    property string timeFormat: "hh:mm:ss"
    property string minDateTime: ""
    property string maxDateTime: ""

    property date selectedDate: new Date()
    property int selectedHour: 0
    property int selectedMinute: 0
    property int selectedSecond: 0

    property int currentYear: new Date().getFullYear()
    property int currentMonth: new Date().getMonth()

    property bool hasSelection: false  // 选择状态标记

    // 焦点区域属性
    property int focusArea: 0  // 0: 日期, 1: 时, 2: 分, 3: 秒
    property int focusedDateIndex: 0  // 日历格子索引

    signal confirmed(date datetime)

    background: Rectangle {
        color: dateTimePicker.colorBackground
        radius: 8

        FocusScope {
            id: keyboardHandler
            anchors.fill: parent
            focus: true

            Keys.onPressed: function (event) {
                if (event.key === Qt.Key_Left) {
                    if (dateTimePicker.focusArea === 0) {
                        dateTimePicker.focusedDateIndex = Math.max(0, dateTimePicker.focusedDateIndex - 1)
                        dateTimePicker.selectedDate = getDateForCell(dateTimePicker.focusedDateIndex)
                        dateTimePicker.hasSelection = true
                    } else if (dateTimePicker.focusArea &gt; 0) {
                        dateTimePicker.focusArea = Math.max(0, dateTimePicker.focusArea - 1)
                    }
                    event.accepted = true
                } else if (event.key === Qt.Key_Right) {
                    if (dateTimePicker.focusArea === 0) {
                        dateTimePicker.focusedDateIndex = Math.min(41, dateTimePicker.focusedDateIndex + 1)
                        dateTimePicker.selectedDate = getDateForCell(dateTimePicker.focusedDateIndex)
                        dateTimePicker.hasSelection = true
                    } else if (dateTimePicker.focusArea &lt; 3) {
                        dateTimePicker.focusArea = Math.min(3, dateTimePicker.focusArea + 1)
                    }
                    event.accepted = true
                } else if (event.key === Qt.Key_Up) {
                    if (dateTimePicker.focusArea === 0) {
                        dateTimePicker.focusedDateIndex = Math.max(0, dateTimePicker.focusedDateIndex - 7)
                        dateTimePicker.selectedDate = getDateForCell(dateTimePicker.focusedDateIndex)
                        dateTimePicker.hasSelection = true
                    } else {
                        if (dateTimePicker.focusArea === 1) {
                            dateTimePicker.selectedHour = (dateTimePicker.selectedHour - 1 + 24) % 24
                        } else if (dateTimePicker.focusArea === 2) {
                            dateTimePicker.selectedMinute = (dateTimePicker.selectedMinute - 1 + 60) % 60
                        } else {
                            dateTimePicker.selectedSecond = (dateTimePicker.selectedSecond - 1 + 60) % 60
                        }
                        dateTimePicker.hasSelection = true
                    }
                    event.accepted = true
                } else if (event.key === Qt.Key_Down) {
                    if (dateTimePicker.focusArea === 0) {
                        dateTimePicker.focusedDateIndex = Math.min(41, dateTimePicker.focusedDateIndex + 7)
                        dateTimePicker.selectedDate = getDateForCell(dateTimePicker.focusedDateIndex)
                        dateTimePicker.hasSelection = true
                    } else {
                        if (dateTimePicker.focusArea === 1) {
                            dateTimePicker.selectedHour = (dateTimePicker.selectedHour + 1) % 24
                        } else if (dateTimePicker.focusArea === 2) {
                            dateTimePicker.selectedMinute = (dateTimePicker.selectedMinute + 1) % 60
                        } else {
                            dateTimePicker.selectedSecond = (dateTimePicker.selectedSecond + 1) % 60
                        }
                        dateTimePicker.hasSelection = true
                    }
                    event.accepted = true
                } else if (event.key === Qt.Key_Tab) {
                    dateTimePicker.focusArea = (dateTimePicker.focusArea + 1) % 4
                    event.accepted = true
                } else if (event.key === Qt.Key_Backtab) {
                    dateTimePicker.focusArea = (dateTimePicker.focusArea - 1 + 4) % 4
                    event.accepted = true
                } else if (event.key === Qt.Key_Return || event.key === Qt.Key_Enter) {
                    if (dateTimePicker.hasSelection) {
                        let dt = new Date(dateTimePicker.selectedDate)
                        dt.setHours(dateTimePicker.selectedHour)
                        dt.setMinutes(dateTimePicker.selectedMinute)
                        dt.setSeconds(dateTimePicker.selectedSecond)
                        dateTimePicker.confirmed(dt)
                        dateTimePicker.close()
                    }
                    event.accepted = true
                } else if (event.key === Qt.Key_Escape) {
                    dateTimePicker.close()
                    event.accepted = true
                }
            }
        }
    }

    ColumnLayout {
        anchors.fill: parent
        spacing: 0

        // 顶部日期时间显示
        Rectangle {
            Layout.fillWidth: true
            Layout.preferredHeight: 50
            color: dateTimePicker.colorSurface
            radius: 8

            Rectangle {
                anchors.left: parent.left
                anchors.right: parent.right
                anchors.bottom: parent.bottom
                height: 8
                color: parent.color
            }

            Label {
                id: dateTimeLabel

                anchors.centerIn: parent
                color: dateTimePicker.colorPrimary
                font.pixelSize: 16
                font.bold: true
                text: Qt.formatDateTime(new Date(selectedDate.getFullYear(), selectedDate.getMonth(), selectedDate.getDate(), selectedHour, selectedMinute, selectedSecond), dateFormat + " " + timeFormat)
            }
        }

        // 主内容区域
        RowLayout {
            Layout.fillWidth: true
            Layout.fillHeight: true
            Layout.margins: 20
            spacing: 20

            // 左侧日历区域
            ColumnLayout {
                Layout.fillWidth: true
                Layout.fillHeight: true
                spacing: 12

                // 月份导航栏
                RowLayout {
                    Layout.fillWidth: true
                    spacing: 8

                    Button {
                        text: "&lt;&lt;"
                        Layout.preferredWidth: 40
                        Layout.preferredHeight: 32
                        onClicked: {
                            currentYear -= 1
                        }
                        background: Rectangle {
                            color: parent.hovered ? dateTimePicker.colorHoverDark : dateTimePicker.colorBorder
                            radius: 4
                        }
                        contentItem: Text {
                            text: parent.text
                            color: dateTimePicker.colorTextPrimary
                            horizontalAlignment: Text.AlignHCenter
                            verticalAlignment: Text.AlignVCenter
                        }
                    }
                    Button {
                        text: "&lt;"
                        Layout.preferredWidth: 40
                        Layout.preferredHeight: 32
                        onClicked: {
                            currentMonth -= 1
                            if (currentMonth &lt; 0) {
                                currentMonth = 11
                                currentYear -= 1
                            }
                        }
                        background: Rectangle {
                            color: parent.hovered ? dateTimePicker.colorHoverDark : dateTimePicker.colorBorder
                            radius: 4
                        }
                        contentItem: Text {
                            text: parent.text
                            color: dateTimePicker.colorTextPrimary
                            horizontalAlignment: Text.AlignHCenter
                            verticalAlignment: Text.AlignVCenter
                        }
                    }
                    Label {
                        text: Qt.formatDate(new Date(currentYear, currentMonth), "yyyy年 M月")
                        color: dateTimePicker.colorTextPrimary
                        font.pixelSize: 16
                        font.bold: true
                        Layout.fillWidth: true
                        horizontalAlignment: Text.AlignHCenter
                    }
                    Button {
                        text: "&gt;"
                        Layout.preferredWidth: 40
                        Layout.preferredHeight: 32
                        onClicked: {
                            currentMonth += 1
                            if (currentMonth &gt; 11) {
                                currentMonth = 0
                                currentYear += 1
                            }
                        }
                        background: Rectangle {
                            color: parent.hovered ? dateTimePicker.colorHoverDark : dateTimePicker.colorBorder
                            radius: 4
                        }
                        contentItem: Text {
                            text: parent.text
                            color: dateTimePicker.colorTextPrimary
                            horizontalAlignment: Text.AlignHCenter
                            verticalAlignment: Text.AlignVCenter
                        }
                    }
                    Button {
                        text: "&gt;&gt;"
                        Layout.preferredWidth: 40
                        Layout.preferredHeight: 32
                        onClicked: {
                            currentYear += 1
                        }
                        background: Rectangle {
                            color: parent.hovered ? dateTimePicker.colorHoverDark : dateTimePicker.colorBorder
                            radius: 4
                        }
                        contentItem: Text {
                            text: parent.text
                            color: dateTimePicker.colorTextPrimary
                            horizontalAlignment: Text.AlignHCenter
                            verticalAlignment: Text.AlignVCenter
                        }
                    }
                }

                // 星期标题行
                GridLayout {
                    Layout.fillWidth: true
                    columns: 7
                    rowSpacing: 0
                    columnSpacing: 0

                    Repeater {
                        model: ["周一", "周二", "周三", "周四", "周五", "周六", "周日"]
                        Label {
                            text: modelData
                            color: dateTimePicker.colorTextTertiary
                            font.pixelSize: 12
                            horizontalAlignment: Text.AlignHCenter
                            verticalAlignment: Text.AlignVCenter
                            Layout.fillWidth: true
                            Layout.preferredHeight: 30
                        }
                    }
                }

                // 日期网格
                GridLayout {
                    Layout.fillWidth: true
                    Layout.fillHeight: true
                    columns: 7
                    rowSpacing: 8
                    columnSpacing: 8

                    Repeater {
                        model: 42
                        Rectangle {
                            Layout.fillWidth: true
                            Layout.fillHeight: true
                            Layout.minimumHeight: 40
                            radius: 4

                            color: {
                                if (!isInRange) return dateTimePicker.colorSurfaceVariant

                                let date = getDateForCell(index)
                                if (date.getDate() === selectedDate.getDate() &amp;&amp; date.getMonth() === selectedDate.getMonth() &amp;&amp; date.getFullYear() === selectedDate.getFullYear()) {
                                    return dateTimePicker.colorPrimary
                                }
                                return dateMouseArea.containsMouse ? dateTimePicker.colorBorder : "transparent"
                            }

                            border.color: {
                                let date = cellDate
                                if (date.getDate() === selectedDate.getDate() &amp;&amp; date.getMonth() === selectedDate.getMonth() &amp;&amp; date.getFullYear() === selectedDate.getFullYear()) {
                                    return "white"
                                }
                                return "transparent"
                            }
                            border.width: 2

                            property var cellDate: getDateForCell(index)

                            property bool isInRange: {
                                let testDate = new Date(cellDate)
                                testDate.setHours(selectedHour, selectedMinute, selectedSecond)
                                return isDateTimeInRange(testDate)
                            }

                            Label {
                                anchors.centerIn: parent
                                text: parent.cellDate.getDate()
                                color: {
                                    if (!parent.isInRange) return dateTimePicker.colorTextDisabled
                                    return parent.cellDate.getMonth() === currentMonth ? dateTimePicker.colorTextPrimary : dateTimePicker.colorBorderLight
                                }
                                font.pixelSize: 14
                            }

                            MouseArea {
                                id: dateMouseArea
                                anchors.fill: parent
                                hoverEnabled: true
                                enabled: parent.isInRange
                                cursorShape: enabled ? Qt.PointingHandCursor : Qt.ForbiddenCursor
                                onClicked: {
                                    if (parent.isInRange) {
                                        let clickedDate = parent.cellDate
                                        selectedDate = clickedDate

                                        // 如果点击的日期不在当前月,自动切换到该月
                                        if (clickedDate.getMonth() !== currentMonth || clickedDate.getFullYear() !== currentYear) {
                                            currentMonth = clickedDate.getMonth()
                                            currentYear = clickedDate.getFullYear()
                                        }

                                        dateTimePicker.hasSelection = true
                                    }
                                }
                            }
                        }
                    }
                }
            }

            // 分隔线
            Rectangle {
                Layout.preferredWidth: 1
                Layout.fillHeight: true
                color: dateTimePicker.colorBorder
            }

            // 右侧时间选择区域
            RowLayout {
                Layout.preferredWidth: 210
                Layout.fillHeight: true
                spacing: 8

                // 时间列组件
                Repeater {
                    model: [{label: "时", value: selectedHour, max: 24}, {
                        label: "分", value: selectedMinute, max: 60
                    }, {label: "秒", value: selectedSecond, max: 60}]

                    ColumnLayout {
                        Layout.fillWidth: true
                        Layout.fillHeight: true
                        spacing: 8

                        property string timeLabel: modelData.label

                        Label {
                            text: timeLabel
                            color: dateTimePicker.colorTextTertiary
                            font.pixelSize: 12
                            Layout.alignment: Qt.AlignHCenter
                        }

                        Rectangle {
                            Layout.fillWidth: true
                            Layout.fillHeight: true
                            color: dateTimePicker.colorSurface
                            radius: 4
                            border.color: dateTimePicker.colorBorder
                            border.width: 1

                            ScrollView {
                                anchors.fill: parent
                                anchors.margins: 2
                                clip: true
                                ScrollBar.horizontal.policy: ScrollBar.AlwaysOff

                                ScrollBar.vertical: ScrollBar {
                                    policy: ScrollBar.AsNeeded
                                    width: 8

                                    contentItem: Rectangle {
                                        implicitWidth: 8
                                        radius: 4
                                        color: parent.pressed ? dateTimePicker.colorScrollbarPressed : (parent.hovered ? dateTimePicker.colorScrollbarHover : dateTimePicker.colorScrollbar)
                                    }

                                    background: Rectangle {
                                        implicitWidth: 6
                                        color: "transparent"
                                    }
                                }

                                ListView {
                                    id: timeListView

                                    model: modelData.max
                                    highlightFollowsCurrentItem: false
                                    highlightMoveDuration: 0
                                    snapMode: ListView.SnapToItem

                                    readonly property string timeType: timeLabel

                                    readonly property int currentValue: {
                                        if (timeType === "时") return dateTimePicker.selectedHour
                                        if (timeType === "分") return dateTimePicker.selectedMinute
                                        return dateTimePicker.selectedSecond
                                    }

                                    function selectTime(value) {
                                        console.log("Selected " + timeListView.timeType + ": " + value + ", hasSelection: " + dateTimePicker.hasSelection)

                                        dateTimePicker.hasSelection = true

                                        if (timeType === "时") {
                                            dateTimePicker.selectedHour = value
                                        } else if (timeType === "分") {
                                            dateTimePicker.selectedMinute = value
                                        } else {
                                            dateTimePicker.selectedSecond = value
                                        }

                                        // 滚动到列表顶部
                                        positionViewAtIndex(value, ListView.Beginning)
                                    }

                                    delegate: Rectangle {
                                        width: timeListView.width
                                        height: 44
                                        radius: 4

                                        color: {
                                            if (index === timeListView.currentValue) return dateTimePicker.colorPrimary
                                            return timeItemMouseArea.containsMouse ? dateTimePicker.colorHover : "transparent"
                                        }

                                        Label {
                                            anchors.centerIn: parent
                                            text: index.toString().padStart(2, '0')
                                            color: index === timeListView.currentValue ? dateTimePicker.colorTextPrimary : dateTimePicker.colorTextSecondary
                                            font.pixelSize: 16
                                            font.bold: index === timeListView.currentValue
                                        }

                                        MouseArea {
                                            id: timeItemMouseArea
                                            anchors.fill: parent
                                            hoverEnabled: true
                                            cursorShape: Qt.PointingHandCursor
                                            onClicked: {
                                                timeListView.selectTime(index)
                                            }
                                        }
                                    }

                                    Component.onCompleted: {
                                        positionViewAtIndex(modelData.value, ListView.Beginning)
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        // 底部按钮区域
        Rectangle {
            Layout.fillWidth: true
            Layout.preferredHeight: 60
            color: dateTimePicker.colorSurface

            Rectangle {
                anchors.left: parent.left
                anchors.right: parent.right
                anchors.top: parent.top
                height: 8
                color: parent.color
            }

            RowLayout {
                anchors.fill: parent
                anchors.margins: 15
                spacing: 10

                Button {
                    text: qsTr("今天")
                    Layout.preferredWidth: 80
                    Layout.preferredHeight: 36
                    onClicked: {
                        var now = new Date()
                        selectedDate = now
                        selectedHour = now.getHours()
                        selectedMinute = now.getMinutes()
                        selectedSecond = now.getSeconds()
                        currentYear = now.getFullYear()
                        currentMonth = now.getMonth()
                        hasSelection = true
                    }
                    background: Rectangle {
                        color: parent.hovered ? dateTimePicker.colorHoverDark : dateTimePicker.colorBorder
                        radius: 4
                        border.color: dateTimePicker.colorBorderLight
                        border.width: 1
                    }
                    contentItem: Text {
                        text: parent.text
                        color: dateTimePicker.colorTextSecondary
                        font.pixelSize: 14
                        horizontalAlignment: Text.AlignHCenter
                        verticalAlignment: Text.AlignVCenter
                    }
                }

                Item {
                    Layout.fillWidth: true
                }

                Button {
                    text: qsTr("取消")
                    Layout.preferredWidth: 80
                    Layout.preferredHeight: 36
                    onClicked: dateTimePicker.close()
                    background: Rectangle {
                        color: parent.hovered ? dateTimePicker.colorHoverDark : dateTimePicker.colorBorder
                        radius: 4
                        border.color: dateTimePicker.colorBorderLight
                        border.width: 1
                    }
                    contentItem: Text {
                        text: parent.text
                        color: dateTimePicker.colorTextSecondary
                        font.pixelSize: 14
                        horizontalAlignment: Text.AlignHCenter
                        verticalAlignment: Text.AlignVCenter
                    }
                }

                Button {
                    text: qsTr("确定")
                    Layout.preferredWidth: 80
                    Layout.preferredHeight: 36
                    enabled: dateTimePicker.hasSelection
                    onClicked: {
                        let dt = new Date(selectedDate)
                        dt.setHours(selectedHour)
                        dt.setMinutes(selectedMinute)
                        dt.setSeconds(selectedSecond)

                        if (isDateTimeInRange(dt)) {
                            dateTimePicker.dateTime = formatDateTime(dt)
                            confirmed(dt)
                            close()
                        }
                    }
                    background: Rectangle {
                        color: {
                            if (!parent.enabled) return dateTimePicker.colorDisabled
                            return parent.hovered ? dateTimePicker.colorPrimaryHover : dateTimePicker.colorPrimary
                        }
                        radius: 4
                    }
                    contentItem: Text {
                        text: parent.text
                        color: parent.enabled ? dateTimePicker.colorTextPrimary : dateTimePicker.colorTextTertiary
                        font.pixelSize: 14
                        font.bold: true
                        horizontalAlignment: Text.AlignHCenter
                        verticalAlignment: Text.AlignVCenter
                    }
                }
            }
        }
    }

    function getDateForCell(index) {
        let firstDay = new Date(currentYear, currentMonth, 1)
        let dayOfWeek = (firstDay.getDay() + 6) % 7
        let cellDate = new Date(currentYear, currentMonth, 1 - dayOfWeek + index)
        return cellDate
    }

    function isDateTimeInRange(date) {
        if (minDateTime) {
            let minDt = new Date(minDateTime)
            if (!isNaN(minDt.getTime()) &amp;&amp; date &lt; minDt) {
                return false
            }
        }
        if (maxDateTime) {
            let maxDt = new Date(maxDateTime)
            if (!isNaN(maxDt.getTime()) &amp;&amp; date &gt; maxDt) {
                return false
            }
        }
        return true
    }

    function formatDateTime(date) {
        return Qt.formatDateTime(date, dateFormat + " " + timeFormat)
    }

    onDateTimeChanged: {
        if (!hasSelection) {
            let dt = new Date(dateTime)
            if (!isNaN(dt.getTime())) {
                selectedDate = dt
                selectedHour = dt.getHours()
                selectedMinute = dt.getMinutes()
                selectedSecond = dt.getSeconds()
                currentYear = dt.getFullYear()
                currentMonth = dt.getMonth()
            }
        }
    }

    Component.onCompleted: {
        if (dateTime) {
            let dt = new Date(dateTime)
            if (!isNaN(dt.getTime())) {
                selectedDate = dt
                selectedHour = dt.getHours()
                selectedMinute = dt.getMinutes()
                selectedSecond = dt.getSeconds()
                currentYear = dt.getFullYear()
                currentMonth = dt.getMonth()

                hasSelection = true
            }
        }

        // 初始化焦点位置
        let firstDay = new Date(currentYear, currentMonth, 1)
        let dayOfWeek = (firstDay.getDay() + 6) % 7
        focusedDateIndex = dayOfWeek + selectedDate.getDate() - 1

        // 延迟设置焦点,确保 FocusScope 已完全初始化
        Qt.callLater(function () {
            keyboardHandler.forceActiveFocus()
        })
    }
}
</code></pre>
<h3 data-id="heading-2">使用代码</h3>
<pre><code class="hljs language-qmllang" lang="qmllang">DateTimePicker {
    id: dateTimePicker

    width: 250
    height: 40

    // 初始值为当前日期时间
    dateTime: Qt.formatDateTime(new Date(), "yyyy-MM-dd hh:mm:ss")

    // 日期格式
    dateFormat: "yyyy-MM-dd"
    // 时间格式
    timeFormat: "hh:mm:ss"

    // 最小可选日期时间
    minDateTime: "2023-01-01 00:00:00"
    // 最大可选日期时间
    maxDateTime: "2024-12-31 23:59:59"

    onConfirmed: function (datetime) {
        startDateField.text = Qt.formatDateTime(datetime, "yyyy-MM-dd HH:mm")
    }
}
</code></pre>
<p>显示效果：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2122ba4d3e8f4e61a878cb995c2fa832~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Za15Liq5ZKq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064191&amp;x-signature=WoFWVkVZGgFQvlGfqYZlGoXAsoE%3D" alt="后台用户登录界面" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C# 14 新功能全面解析：提升生产力与性能的革命性更新]]></title>    <link>https://juejin.cn/post/7573886599432732723</link>    <guid>https://juejin.cn/post/7573886599432732723</guid>    <pubDate>2025-11-18T08:51:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599432732723" data-draft-id="7573890735578071050" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C# 14 新功能全面解析：提升生产力与性能的革命性更新"/> <meta itemprop="keywords" content="C#"/> <meta itemprop="datePublished" content="2025-11-18T08:51:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="葡萄城技术团队"/> <meta itemprop="url" content="https://juejin.cn/user/3227821868332765"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C# 14 新功能全面解析：提升生产力与性能的革命性更新
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3227821868332765/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    葡萄城技术团队
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T08:51:44.000Z" title="Tue Nov 18 2025 08:51:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">C# 14 新功能全面解析：提升生产力与性能的革命性更新</h2>
<h3 data-id="heading-1"><strong>引言</strong></h3>
<p>C# 语言作为.NET生态的核心，始终致力于提升开发者的生产力与应用程序性能。C# 14带来了多项突破性特性，包括<strong>扩展成员</strong>、<strong>字段关键词</strong>、<strong>空条件赋值</strong>等，这些改进显著减少了样板代码，增强了类型系统的灵活性。本文将深入解析这些新功能的设计原理、应用场景及实际价值，帮助开发者快速掌握C# 14的核心优势。</p>
<h4 data-id="heading-2"><strong>1. 扩展成员：类型系统的革命性扩展</strong></h4>
<h5 data-id="heading-3"><strong>1.1 扩展属性的实现</strong></h5>
<p>C# 14的扩展成员（Extension Members）允许开发者在不修改原始类型的前提下，为现有类型添加属性、运算符甚至静态成员。这一特性通过<code>extension</code>语法块实现，且完全兼容既有扩展方法。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EnumerableExtensions</span>
{
    extension&lt;tsource&gt;(IEnumerable&lt;tsource&gt; source)
    {
        <span class="hljs-comment">// 扩展属性：判断集合是否为空</span>
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">bool</span> IsEmpty =&amp;gt; !source.Any();

        <span class="hljs-comment">// 扩展运算符：合并两个集合</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> IEnumerable&lt;tsource&gt; <span class="hljs-keyword">operator</span> +(
            IEnumerable&lt;tsource&gt; left, 
            IEnumerable&lt;tsource&gt; right) =&amp;gt; left.Concat(right);
    }
}
</code></pre>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-built_in">int</span>[] data = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
<span class="hljs-keyword">if</span> (data.IsEmpty) { <span class="hljs-comment">/* ... */</span> }          <span class="hljs-comment">// 调用扩展属性</span>
<span class="hljs-keyword">var</span> combined = data + [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>];            <span class="hljs-comment">// 调用扩展运算符</span>
</code></pre>
<h5 data-id="heading-4"><strong>1.2 兼容性与迁移策略</strong></h5>
<p>扩展块设计为<strong>二进制兼容</strong>，允许逐步迁移现有扩展方法，依赖程序集无需重新编译。例如，原先的扩展方法可逐个替换为扩展块内的成员，而不会破坏现有代码。</p>
<hr/>
<h4 data-id="heading-5"><strong>2. 字段关键词：简化属性逻辑的利器</strong></h4>
<h5 data-id="heading-6"><strong>2.1 自动属性与字段的桥梁</strong></h5>
<p>传统属性开发中，简单的自动属性（Auto-Property）一旦需要添加逻辑（如空值检查），就必须重写完整属性。C# 14引入<code>field</code>关键词，允许仅在需要逻辑的访问器中注入代码：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// C# 14之前</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">string</span> _message = <span class="hljs-string">""</span>;
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Message
{
    <span class="hljs-keyword">get</span> =&amp;gt; _message;
    <span class="hljs-keyword">init</span> =&amp;gt; _message = <span class="hljs-keyword">value</span> ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(<span class="hljs-keyword">value</span>));
}

<span class="hljs-comment">// C# 14之后</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Message
{
    <span class="hljs-keyword">get</span>; <span class="hljs-comment">// 自动实现</span>
    <span class="hljs-keyword">init</span> =&amp;gt; field = <span class="hljs-keyword">value</span> ?? <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-keyword">nameof</span>(<span class="hljs-keyword">value</span>));
}
</code></pre>
<h5 data-id="heading-7"><strong>2.2 优势与应用场景</strong></h5>
<ul>
<li><strong>减少样板代码</strong>：避免手动声明私有字段和重复的getter逻辑。</li>
<li><strong>视觉简洁性</strong>：类定义更紧凑，适合需要大量简单校验的场景（如DTO验证）。</li>
</ul>
<hr/>
<h4 data-id="heading-8"><strong>3. 空条件赋值：安全且简洁的链式操作</strong></h4>
<h5 data-id="heading-9"><strong>3.1 语法改进</strong></h5>
<p>此前，空值保护赋值需要显式条件判断，而C# 14允许直接在赋值左侧使用<code>?.</code>操作符：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 旧写法</span>
<span class="hljs-keyword">if</span> (customer <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">null</span>) 
{
    customer.Order = CreateOrder();
}

<span class="hljs-comment">// 新写法</span>
customer?.Order = CreateOrder();  <span class="hljs-comment">// 仅当customer非空时执行赋值</span>
</code></pre>
<h5 data-id="heading-10"><strong>3.2 复合赋值支持</strong></h5>
<p>该特性同样适用于<code>+=</code>等复合操作：</p>
<pre><code class="hljs language-csharp" lang="csharp">customer?.Total += CalculateIncrement();  <span class="hljs-comment">// 避免中间变量和重复检查</span>
</code></pre>
<hr/>
<h4 data-id="heading-11"><strong>4. 部分事件与构造函数：增强代码组织能力</strong></h4>
<h5 data-id="heading-12"><strong>4.1 分部类型的扩展</strong></h5>
<p>C# 14允许将<strong>事件</strong>和<strong>构造函数</strong>的逻辑拆分到多个文件中，这对大型生成代码（如Source Generators）尤为重要：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 文件1：声明部分</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">event</span> EventHandler Changed;
}

<span class="hljs-comment">// 文件2：实现部分</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">event</span> EventHandler Changed
    {
        <span class="hljs-keyword">add</span> =&amp;gt; _changed += <span class="hljs-keyword">value</span>;
        <span class="hljs-keyword">remove</span> =&amp;gt; _changed -= <span class="hljs-keyword">value</span>;
    }
}
</code></pre>
<h5 data-id="heading-13"><strong>4.2 主构造函数的分布式实现</strong></h5>
<p>主构造函数（Primary Constructor）现在支持在分部类中添加初始化逻辑：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span>(<span class="hljs-params"><span class="hljs-built_in">int</span> size</span>)</span> 
{
    <span class="hljs-comment">// 主构造函数声明</span>
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">Widget</span>
{
    <span class="hljs-comment">// 添加初始化逻辑</span>
    <span class="hljs-keyword">public</span> Widget { Initialize(); }
}
</code></pre>
<hr/>
<h4 data-id="heading-14"><strong>5. 性能优化特性</strong></h4>
<h5 data-id="heading-15"><strong>5.1 隐式Span转换</strong></h5>
<p><code>Span&lt;t&gt;</code>和<code>ReadOnlySpan&lt;t&gt;</code>是高性能无分配API的核心。C# 14允许数组和字符串切片直接隐式转换为Span，减少显式调用<code>AsSpan()</code>：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 旧写法</span>
ReadOnlySpan&lt;<span class="hljs-built_in">char</span>&gt; key = line.AsSpan(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);

<span class="hljs-comment">// 新写法</span>
ProcessKey(line[.<span class="hljs-number">.5</span>]);  <span class="hljs-comment">// 隐式转换为Span</span>
</code></pre>
<h5 data-id="heading-16"><strong>5.2 用户自定义复合赋值</strong></h5>
<p>高性能数值类型（如向量计算）可通过定义<code>+=</code>运算符避免临时对象：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">public</span> <span class="hljs-keyword">struct</span> Vector3D
{
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-keyword">operator</span> +=(Vector3D other) 
    { 
        X += other.X; 
        Y += other.Y;
    }
}
</code></pre>
<p>此特性可提升SIMD和数学库的性能，减少循环中的中间结果分配。</p>
<hr/>
<h3 data-id="heading-17"><strong>结论</strong></h3>
<p>C# 14通过<strong>扩展成员</strong>、<strong>字段关键词</strong>等特性显著提升了开发效率，同时借助<strong>隐式Span转换</strong>和<strong>复合赋值</strong>优化了运行时性能。这些改进共同推动C#成为更强大、更灵活的语言选择。开发者可通过以下步骤快速上手：</p>
<ol>
<li>在现有项目中逐步替换扩展方法为扩展块；</li>
<li>使用<code>field</code>简化属性逻辑；</li>
<li>在资源敏感场景中应用Span和自定义运算符。</li>
</ol>
<p>C# 14不仅是语法糖的集合，更是对开发范式的升级，值得所有.NET开发者深入探索。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🔥 99%由 Trae AI 开发的 React KeepAlive 组件，竟然如此优雅！✨]]></title>    <link>https://juejin.cn/post/7573694361475285019</link>    <guid>https://juejin.cn/post/7573694361475285019</guid>    <pubDate>2025-11-18T09:38:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573694361475285019" data-draft-id="7573694361474891803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🔥 99%由 Trae AI 开发的 React KeepAlive 组件，竟然如此优雅！✨"/> <meta itemprop="keywords" content="前端,Trae"/> <meta itemprop="datePublished" content="2025-11-18T09:38:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端开发呀"/> <meta itemprop="url" content="https://juejin.cn/user/3562073406322600"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🔥 99%由 Trae AI 开发的 React KeepAlive 组件，竟然如此优雅！✨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562073406322600/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端开发呀
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:38:19.000Z" title="Tue Nov 18 2025 09:38:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">🔥 99%由 Trae AI 开发的 React KeepAlive 组件，竟然如此优雅！✨</h2>
<blockquote>
<p><strong>温馨提示：除本文第一行提示之外，本项目的代码 99%由 Trae AI 开发，如您在使用过程中遇到任何问题，欢迎提交 Issue 或 Pull Request。</strong></p>
<p><strong>—— 项目 README</strong></p>
</blockquote>
<p>Hey 各位前端小伙伴们～ ଘ(੭<em>ˊᵕˋ)੭</em> ੈ✩</p>
<p>今天要给大家介绍一个超级有趣的 React 组件——<code>react-activity-keep-alive</code>！这个项目可不简单呢，它有 99% 的代码都是由 Trae AI 生成的，是不是很厉害？~ (｡♡‿♡｡)</p>
<h3 data-id="heading-1">🎯 为啥要做这个组件？</h3>
<p>用过 Vue 的小伙伴们都知道，Vue 有个超好用的 <code>&lt;KeepAlive&gt;</code> 组件，可以在路由切换时缓存页面状态。但是 React 一直缺少这样的优雅解决方案，对不对？٩(˘◡˘)۶</p>
<p>直到 React 19.2 引入了 <code>Activity</code> API，这个局面才有所改变。而我们这个项目，就是基于这个新 API 打造的 React 版 KeepAlive！</p>
<h3 data-id="heading-2">🌟 项目亮点一览</h3>
<p>让我来给大家介绍这个项目的几大亮点吧～ (≧∇≦)/</p>
<h4 data-id="heading-3">1. 🚀 99% AI 开发，质量还这么高！</h4>
<p>没错，你没看错！这个项目的源代码几乎全部由 Trae AI 生成。从架构设计到代码实现，从类型定义到注释文档，都是 AI 的杰作！是不是很震撼？ Σ(っ °Д °;)っ</p>
<h4 data-id="heading-4">2. 📱 完整的 KeepAlive 语义支持</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">KeepAlive</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-activity-keep-alive"</span>;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">KeepAlive</span>
  <span class="hljs-attr">activeKey</span>=<span class="hljs-string">{pathname}</span>
  <span class="hljs-attr">include</span>=<span class="hljs-string">{[/^\/demo/]}</span> // <span class="hljs-attr">只缓存</span> /<span class="hljs-attr">demo</span> <span class="hljs-attr">开头的路由</span>
  <span class="hljs-attr">exclude</span>=<span class="hljs-string">{[/^\/admin/]}</span> // <span class="hljs-attr">不缓存</span> /<span class="hljs-attr">admin</span> <span class="hljs-attr">开头的路由</span>
  <span class="hljs-attr">max</span>=<span class="hljs-string">{3}</span> // <span class="hljs-attr">最多缓存</span> <span class="hljs-attr">3</span> <span class="hljs-attr">个</span>，<span class="hljs-attr">LRU</span> <span class="hljs-attr">策略</span>
&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">KeepAlive</span>&gt;</span></span>;
</code></pre>
<p>是不是很眼熟？没错，它完美复刻了 Vue KeepAlive 的 API 设计！☆*:.｡. o(≧▽≦)o .｡.:*☆</p>
<h4 data-id="heading-5">3. 🎪 丰富的演示场景</h4>
<p>项目内置了一个超棒的 playground，包含各种演示：</p>
<p>🌐 <strong>在线演示</strong>：你可以直接访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fliujiayii.github.io%2Freact-keep-alive%2F" target="_blank" title="https://liujiayii.github.io/react-keep-alive/" ref="nofollow noopener noreferrer">liujiayii.github.io/react-keep-…</a> 体验所有功能！不需要本地搭建～ ✨</p>
<ul>
<li><strong>LRU 缓存演示</strong>：观察缓存淘汰策略</li>
<li><strong>生命周期演示</strong>：看看激活/失活钩子的效果</li>
<li><strong>嵌套缓存演示</strong>：多层 KeepAlive 的复杂场景</li>
<li><strong>状态保持演示</strong>：输入框数据、滚动位置都能完美保持</li>
</ul>
<h4 data-id="heading-6">4. 🎛️ 强大的控制能力</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useAliveController } <span class="hljs-keyword">from</span> <span class="hljs-string">"react-activity-keep-alive"</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">CacheController</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> { drop, dropScope, refresh, refreshScope, clear } = <span class="hljs-title function_">useAliveController</span>();

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> drop("/demo/a")}&gt;删除缓存<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> clear()}&gt;清空所有<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> refresh("/demo/b")}&gt;刷新缓存<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      {/* 等等... */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>想要主动控制缓存？没问题！随意删除、刷新、清空，统统支持～ ( ◕‿◕ )</p>
<h3 data-id="heading-7">🔧 技术实现揭秘</h3>
<p>现在来聊聊技术实现吧～ ✧(≖ ◡ ≖)</p>
<h4 data-id="heading-8">历史背景：致敬 react-activation</h4>
<p>在 React 19.2 之前，社区里有一个非常优秀的库叫 <code>react-activation</code>！它为 React 生态带来了 KeepAlive 的概念，让无数开发者受益～ (´∀`)</p>
<p><strong>react-activation 的贡献</strong>：</p>
<ul>
<li>✅ 开创了 React KeepAlive 的先河，满足了无数开发者的需求</li>
<li>✅ 提供了完整的生命周期管理和状态保持功能</li>
<li>✅ 虽然使用了快照技术，但在当时的技术条件下是个很好的解决方案</li>
<li>✅ API 设计清晰，学习成本可控</li>
</ul>
<p>由于它基于 React 18 的技术栈设计，自然无法适配 React 19.2 的新特性。但正是它的存在，让我们看到了 KeepAlive 的巨大价值！</p>
<p>当 React 19.2 带来了原生的 <code>Activity</code> API 时，我们有了更好的技术基础来重新实现这个功能～ ✨ 这就是站在巨人肩膀上的力量！٩(˘◡˘)۶</p>
<h4 data-id="heading-9">基于 React 19.2 Activity</h4>
<p>这个组件的核心在于 React 19.2 的 <code>Activity</code> API：</p>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">Activity</span> active={isActive}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">display:</span> <span class="hljs-attr">isActive</span> ? <span class="hljs-attr">undefined</span> <span class="hljs-attr">:</span> "<span class="hljs-attr">none</span>" }}&gt;</span>
    {/* 组件内容 */}
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">Activity</span>&gt;;
</code></pre>
<p><code>Activity</code> 的巧妙之处在于：<strong>失活的组件不会 unmount，只会隐藏</strong>！这就为 KeepAlive 提供了技术基础～ (｡◕‿◕｡)</p>
<h4 data-id="heading-10">LRU 缓存策略实现</h4>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// LRU 队列：最旧在前，最新在后</span>
<span class="hljs-keyword">const</span> orderRef = useRef&lt;<span class="hljs-built_in">string</span>[]&gt;([]);

<span class="hljs-comment">// 淘汰超出容量的缓存</span>
<span class="hljs-keyword">while</span> (cache.<span class="hljs-property">size</span> &gt; max) {
  <span class="hljs-keyword">const</span> victim = orderRef.<span class="hljs-property">current</span>[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">if</span> (!victim || victim === activeKey)
    <span class="hljs-keyword">break</span>;
  orderRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">shift</span>();
  cacheRef.<span class="hljs-property">current</span>.<span class="hljs-title function_">delete</span>(victim);
}
</code></pre>
<p>LRU 算法确保最近最少使用的缓存会被优先淘汰，保持缓存的高效利用～ ଘ(੭ˊᵕˋ)੭* ੈ</p>
<h4 data-id="heading-11">作用域嵌套管理</h4>
<h4 data-id="heading-12">作用域嵌套管理</h4>
<p>项目内部实现了作用域管理机制来支持多层 <code>&lt;KeepAlive&gt;</code> 的嵌套：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">// 内部实现（用户无需关心）</span>
&lt;<span class="hljs-title class_">AliveScopeProvider</span> name={key}&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">AliveItemProvider</span> <span class="hljs-attr">active</span>=<span class="hljs-string">{isActive}</span>&gt;</span>
    {node}
  <span class="hljs-tag">&lt;/<span class="hljs-name">AliveItemProvider</span>&gt;</span></span>
&lt;/<span class="hljs-title class_">AliveScopeProvider</span>&gt;;
</code></pre>
<p>这个机制让项目能够优雅地处理复杂的嵌套缓存场景，自动管理不同层级的作用域～ ヾ(≧∇≦*)ゝ</p>
<h3 data-id="heading-13">🎮 实际使用效果</h3>
<p>让我给大家展示一下实际的使用效果吧！</p>
<p>假设我们有这样一个计数器页面：</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">function</span> <span class="hljs-title function_">DemoPage</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>
        计数器：
        {count}
      <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;
        点我增加
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>切换路由再回来，看看数据还在不在～ (◕‿◕)<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p>当你点击按钮增加到 10，然后切换到其他页面，再回来的时候：</p>
<p>✨ <strong>数据完全保持！还是 10！没有重新渲染！</strong> ✨</p>
<p>这就是 KeepAlive 的魅力所在～ (≧∇≦)/</p>
<h3 data-id="heading-14">🏗️ 项目结构一览</h3>
<pre><code class="hljs language-bash" lang="bash">react-keep-alive/
├── src/                    <span class="hljs-comment"># 核心库代码</span>
│   ├── KeepAlive.tsx      <span class="hljs-comment"># 主组件（244 行精华代码）</span>
│   ├── hooks.ts           <span class="hljs-comment"># 生命周期钩子</span>
│   └── context.tsx        <span class="hljs-comment"># 作用域管理</span>
├── playground/            <span class="hljs-comment"># 演示应用</span>
│   ├── src/pages/         <span class="hljs-comment"># 各种演示页面</span>
│   └── src/App.tsx        <span class="hljs-comment"># 主应用</span>
└── README.md              <span class="hljs-comment"># 超详细的文档</span>
</code></pre>
<p>整个项目只有 4 个主要文件，却实现了完整的 KeepAlive 功能，是不是很精简？ Σ(っ °Д °;)っ</p>
<h3 data-id="heading-15">🛠️ 开发体验</h3>
<p>开发这个项目的感觉真的很棒～ (｡♡‿♡｡)</p>
<ul>
<li><strong>TypeScript 支持</strong>：完整的类型定义，IDE 友好</li>
<li><strong>ESLint 配置</strong>：代码质量有保障</li>
<li><strong>Husky + lint-staged</strong>：提交前自动检查</li>
<li><strong>Playground 演示</strong>：边开发边验证</li>
</ul>
<p>最关键的是，有了 Trae AI 的加持，开发效率真的太高了！几乎所有的代码逻辑、类型定义、注释文档，都是 AI 自动生成的！</p>
<h3 data-id="heading-16">🎊 总结</h3>
<p>这个 <code>react-activity-keep-alive</code> 项目真的很让人兴奋呢～ ✨</p>
<ol>
<li><strong>技术先进</strong>：基于 React 19.2 Activity，性能优秀</li>
<li><strong>API 友好</strong>：完全对齐 Vue KeepAlive，学习成本低</li>
<li><strong>功能完整</strong>：LRU 缓存、生命周期、控制接口一应俱全</li>
<li><strong>AI 加持</strong>：99% 代码由 AI 生成，开发效率惊人</li>
<li><strong>演示丰富</strong>：内置 playground，所见即所得</li>
</ol>
<p>如果你的项目正在使用 React 19.2+，真的推荐试试这个组件！让你的路由切换体验更上一层楼～ ( ◕‿◕ )</p>
<h3 data-id="heading-17">🔗 相关链接</h3>
<ul>
<li><strong>GitHub 地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fliujiayii%2Freact-keep-alive" target="_blank" title="https://github.com/liujiayii/react-keep-alive" ref="nofollow noopener noreferrer">github.com/liujiayii/r…</a></li>
<li><strong>🌐 在线演示</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fliujiayii.github.io%2Freact-keep-alive%2F" target="_blank" title="https://liujiayii.github.io/react-keep-alive/" ref="nofollow noopener noreferrer">liujiayii.github.io/react-keep-…</a> - 直接浏览器体验！</li>
<li><strong>本地演示</strong>：启动 playground：<code>pnpm -C playground dev</code></li>
</ul>
<hr/>
<p><strong>小贴士</strong>：项目要求 React 19.2+ 版本哦，如果你的项目还在用旧版本，建议升级一下～ ଘ(੭<em>ˊᵕˋ)੭</em> ੈ✩</p>
<p>好啦，今天的介绍就到这里！希望这个由 Trae AI 开发的 KeepAlive 组件能给大家带来帮助～ 如果觉得有用的话，记得给项目点个 Star 哦！☆*:.｡. o(≧▽≦)o .｡.:*☆</p>
<p>(◕‿◕)ﾉbye bye~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Canvas学习笔记（一）]]></title>    <link>https://juejin.cn/post/7573738017988640811</link>    <guid>https://juejin.cn/post/7573738017988640811</guid>    <pubDate>2025-11-18T09:49:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573738017988640811" data-draft-id="7573855399716470803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Canvas学习笔记（一）"/> <meta itemprop="keywords" content="前端,JavaScript,Canvas"/> <meta itemprop="datePublished" content="2025-11-18T09:49:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="不是鱼"/> <meta itemprop="url" content="https://juejin.cn/user/1704656590610676"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Canvas学习笔记（一）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1704656590610676/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    不是鱼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:49:33.000Z" title="Tue Nov 18 2025 09:49:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">什么是 Canvas</h3>
<p>Canvas 是 HTML5 中新增的一种标签，表示一个画布，只是图形容器，绘制功能必须使用js来实现。</p>
<pre><code class="hljs language-js" lang="js">&lt;!doctype html&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>基础的HTML5页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"canvas"</span>&gt;</span>
            这里是canvas标签，当你的浏览器不支持canvas时，会显示这行文字
	<span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span> 

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</span></code></pre>
<p>打开后会是一个完全空白的画面，因为canvas本意就是一块画布，画布在html5中是透明的，不可见的。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/646cf23d6a26415c90537a193f6ecaac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=zzyq3cyC2ZfdAXRL51Jr6L%2FArbo%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1">绘制前的准备</h3>
<h5 data-id="heading-2">获取 Canvas 对象：</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'canvas'</span>);
</code></pre>
<h5 data-id="heading-3">获取画笔</h5>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> context = canvas.<span class="hljs-title function_">getContext</span>(contextType, contextAttributes?);
<span class="hljs-keyword">const</span> context = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
<span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>, {
  <span class="hljs-attr">alpha</span>: <span class="hljs-literal">true</span>,          <span class="hljs-comment">// 启用透明通道（默认就是true）</span>
});
</code></pre>
<p><code>getContext</code>方法用于获取 Canvas 元素的绘图上下文，来对 Canvas 元素进行绘制操作，通常是 2D 类型，用于二维绘图。第一个参数是必须传的，第二个参数代表配置上下文的行为，不同的上下文的配置属性不同。</p>
<ul>
<li><code>2d</code></li>
</ul>






























<table><thead><tr><th>属性</th><th>说明</th><th>默认值</th></tr></thead><tbody><tr><td><code>alpha</code></td><td>是否包含alpha通道（透明度）</td><td><code>true</code></td></tr><tr><td><code>colorSpace</code></td><td>指定渲染上下文的色彩空间（<code>srgb</code>或<code>display-p3</code>）</td><td><code>srgb</code></td></tr><tr><td><code>desynchronized</code></td><td>是否将画布绘制周期与事件循环解耦以减少延迟</td><td><code>false</code></td></tr><tr><td><code>willReadFrequently</code></td><td>是否频繁读取像素（用于优化<code>getImageData()</code>性能）</td><td><code>false</code></td></tr></tbody></table>
<ul>
<li><code>webgl</code></li>
</ul>


















































<table><thead><tr><th>属性</th><th>作用</th><th>说明</th></tr></thead><tbody><tr><td><code>alpha</code></td><td>是否包含alpha通道</td><td>和2D一样</td></tr><tr><td><code>antialias</code></td><td>是否开启抗锯齿</td><td>让图形边缘更平滑</td></tr><tr><td><code>depth</code></td><td>是否包含深度缓冲区</td><td>用于3D场景的深度检测</td></tr><tr><td><code>failIfMajorPerformanceCaveat</code></td><td>性能低时是否创建上下文</td><td><code>true</code>：性能差时失败</td></tr><tr><td><code>powerPreference</code></td><td>GPU电源偏好</td><td><code>default</code>/<code>high-performance</code>/<code>low-power</code></td></tr><tr><td><code>premultipliedAlpha</code></td><td>是否预混合alpha</td><td>用于图像合成</td></tr><tr><td><code>preserveDrawingBuffer</code></td><td>是否保存缓冲区</td><td><code>true</code>：可以多次读取</td></tr><tr><td><code>stencil</code></td><td>是否包含模版缓冲区</td><td>用于复杂遮罩效果</td></tr></tbody></table>
<p>小结一下：准备工作就分为三步：</p>
<ol>
<li><strong>布置画布：通过添加</strong><code> &lt;canvas&gt; </code><strong>标签，添加canvas元素</strong></li>
<li><strong>获取画布：通过</strong><code> &lt;canvas&gt; </code><strong>标签的id，获得canvas对象</strong></li>
<li><strong>获得画笔：通过canvas对象的</strong><code>getContext("2d") </code><strong>方法，获得2D环境</strong></li>
</ol>
<hr/>
<h3 data-id="heading-4"><strong>绘制线段：</strong></h3>
<p>在Canvas中，<strong>是基于状态的绘制</strong>，所以前面几步都是在确定状态，直到最后一步才会具体绘制。</p>
<p>绘画步骤和现实中画画差不多，可以分为四步：</p>
<h6 data-id="heading-5">1.  首先移动画笔至绘画的起始位置</h6>
<pre><code class="hljs language-js" lang="js">context.<span class="hljs-title function_">moveTo</span>(x, y)
<span class="hljs-comment">// 将笔画移至 x, y 这个位置，canvas中是以画布的左上角为坐标原点，x轴的正方向向右，y轴的正方向向下</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eddbf10a40c648e79bca69ee62fc8c79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=KQQcZApygxHa46214P6J2b6iVxE%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-6">2.  确定第一笔的停止点</h6>
<pre><code class="hljs language-js" lang="js">context.<span class="hljs-title function_">lineTo</span>(x, y)
<span class="hljs-comment">// 从上一个笔的停止点，移动至x，y这里</span>
</code></pre>
<h6 data-id="heading-7">3.  规划好路线后，选择画笔（粗细，颜色，线条等）</h6>
<p>因为 Canvas 是基于状态的，所以我们在选择画笔粗细和颜色的同时，其实也是选择了线条的粗细和颜色。</p>









































<table><thead><tr><th>属性</th><th>说明</th><th>默认值</th><th>示例</th></tr></thead><tbody><tr><td><code>context.lineWidth</code></td><td><strong>线条粗细（宽度）</strong> ，单位是像素</td><td><code>1.0</code></td><td><code>ctx.lineWidth = 5;</code></td></tr><tr><td><code>context.strokeStyle</code></td><td><strong>描边颜色/样式</strong>（可为颜色、渐变、图案）</td><td><code>#000000</code>（黑色）</td><td><code>ctx.strokeStyle = "#AA394C";``ctx.strokeStyle = "red";``ctx.strokeStyle = gradient;</code></td></tr><tr><td><code>context.lineCap</code></td><td><strong>线段末端样式</strong></td><td><code>"butt"</code></td><td><code>"butt"</code>（平头） <code>"round"</code>（圆头） <code>"square"</code>（方头）</td></tr><tr><td><code>context.lineJoin</code></td><td><strong>两条线相交处的连接样式</strong></td><td><code>"miter"</code></td><td><code>"miter"</code>（尖角） <code>"round"</code>（圆角） <code>"bevel"</code>（斜角）</td></tr><tr><td><code>context.miterLimit</code></td><td><strong>尖角（miter）的最大长度限制</strong>（防止过长尖角）</td><td><code>10</code></td><td><code>ctx.miterLimit = 5;</code></td></tr></tbody></table>
<h6 data-id="heading-8">4. 进行绘制</h6>
<p>确定绘制有两种方法：</p>
<pre><code class="hljs language-js" lang="js">context.<span class="hljs-title function_">fill</span>() <span class="hljs-comment">// 填充</span>
context.<span class="hljs-title function_">stroke</span>() <span class="hljs-comment">// 描边</span>
</code></pre>
<h6 data-id="heading-9">5. 画一个线条！</h6>
<pre><code class="hljs language-js" lang="js">&lt;body&gt;
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">canvas</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"myCanvas"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"border: 1px solid black;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">canvas</span>&gt;</span></span>
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myCanvas'</span>);
        <span class="hljs-keyword">const</span> ctx = canvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">'2d'</span>);
        
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>);

        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'red'</span>;

        ctx.<span class="hljs-title function_">stroke</span>();
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
&lt;/body&gt;
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4110ef73c4114e18963318062516e274~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=SsyKWdVRHvhf3uKvPmm1xVknuCs%3D" alt="image.png" loading="lazy"/></p>
<p>一条红色的线条就画好了。但是我们现在只给 Canvas 设置了边框，那它的宽高是从哪来的呢？</p>
<p>这是浏览器默认给 Canvas 分配的尺寸 300x150 像素的画布。如果我们要自己设置 Canvas 宽高的话有两种方法</p>
<ol>
<li>通过标签内部设置</li>
</ol>
<pre><code class="hljs language-js" lang="js"> &lt;canvas id=<span class="hljs-string">"myCanvas"</span> style=<span class="hljs-string">"border: 1px solid black;"</span> width = <span class="hljs-string">"500"</span> height = <span class="hljs-string">"500"</span>&gt;&lt;/canvas&gt;
</code></pre>
<ol start="2">
<li>通过 JS 设置</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> canvas = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'myCanvas'</span>);

canvas.<span class="hljs-property">width</span> = <span class="hljs-number">500</span>;
canvas.<span class="hljs-property">height</span> = <span class="hljs-number">500</span>;
</code></pre>
<p>这两种方式设置的宽高是等效的</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d52a13df55f64a10a2d554ccc2758a14~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=0l8dw4moyAx3C8OT5wiXS5r5%2FtE%3D" alt="image.png" loading="lazy"/>
<strong>这里有一个特别需要注意的点：我们设置的是画布的物理宽高，也就是 Canvas 元素的真实宽高，并不是通过 Css 设置的样式宽高，如果我们通过 Css 设置了 Canvas 的宽高，效果其实是在物理宽高的基础上进行了等比的缩小或者拉伸</strong></p>
<pre><code class="hljs language-js" lang="js">&lt;canvas id=<span class="hljs-string">"myCanvas"</span> 
    style=<span class="hljs-string">"border: 1px solid black; width: 100px; height: 100px;"</span> width=<span class="hljs-string">"500"</span> height=<span class="hljs-string">"500"</span>&gt;
&lt;/canvas&gt;
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/346e123667244b89b96c41c560b51a44~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=OTkv5MMzOxJOhOSImkGHzDB0MXI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-10">线条组成图形</h3>
<h6 data-id="heading-11">绘制折线</h6>
<p>当我们学会绘制线条后，就可以用线条来组成图形了，方法其实很简单，就是复用上文用过的<code>lineTo()</code> 方法即可：</p>
<pre><code class="hljs language-js" lang="js">    ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>);
    ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>);

    ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span>;
    ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'red'</span>;

    ctx.<span class="hljs-title function_">stroke</span>();
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acfa8e95b0114d508c7c6a1f1a012e8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=NR5MR5V6tN24HE1jz6s2JlGVWxo%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-12">绘制多条折线</h6>
<p>如果需要绘制多条不连接的线条，只需在绘制完一次后，再重新移动画笔，重新绘制一次即可</p>
<pre><code class="hljs language-js" lang="js">        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'red'</span>;
        ctx.<span class="hljs-title function_">stroke</span>();

        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">150</span>, <span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'blue'</span>;
        ctx.<span class="hljs-title function_">stroke</span>(); 
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8c6c2b8f523e4707b5718d1f60ca827a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=bA3T3WYG186JmI5Hm7yMfhgCOco%3D" alt="image.png" loading="lazy"/>
诶？这是不是很奇怪，明明是先红色再蓝色，为什么就全变为蓝色了呢？<strong>是因为上文说过的 Canvas 是基于状态绘制的。我们每次使用<code>stroke()</code> 时，它都会把之前设置的状态再次绘制一遍，第一次<code>stroke</code>时会绘制一条红色折线，第二次<code>stroke</code>时，会再次重新绘制之前那条红色的折线，但是画笔已经变为蓝色的了，所以画出的折线全是蓝色的</strong>。</p>
<p>为了解决这个问题，我们需要在每次重新绘制时加上<code>beginPath()</code>，这个 API 代表下次绘制的起始处为<code>beginPath()</code>之后的代码。</p>
<pre><code class="hljs language-js" lang="js">        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'red'</span>;
        ctx.<span class="hljs-title function_">stroke</span>();
        
        ctx.<span class="hljs-title function_">beginPath</span>(); <span class="hljs-comment">// 重新定义起始位置</span>
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">150</span>, <span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">0</span>);
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">10</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">'blue'</span>;
        ctx.<span class="hljs-title function_">stroke</span>(); 
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2051424865964361add06983e8ced723~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=qfI07s%2Bfueduzns526hUJ1ojnZ4%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-13">绘制矩形</h3>
<p>我们先使用绘制线条的方式绘制一个矩形</p>
<pre><code class="hljs language-js" lang="js">        <span class="hljs-comment">// 绘制一个矩形</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">50</span>,<span class="hljs-number">50</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">50</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>,<span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>,<span class="hljs-number">50</span>);

        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">5</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">"black"</span>;

        ctx.<span class="hljs-title function_">stroke</span>();   
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/411bf8c2bde24ccc82a179d3ae34b4a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=JK89zyVVV7gQSVQmvVxRxJO1AGE%3D" alt="image.png" loading="lazy"/>
会发现此时最后一笔画时有一个小缺口，这种情况是因为我们设置了<code>lineWidth</code>导致的，如果是默认笔触为1的话是不会有问题的，但是如果笔触越大，线条越宽，这个小缺口就会越明显。此时需要使用<code>closePath()</code>闭合图形。</p>
<pre><code class="hljs language-js" lang="js">        <span class="hljs-comment">// 绘制一个矩形</span>
        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">50</span>,<span class="hljs-number">50</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">50</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>,<span class="hljs-number">100</span>);
        <span class="hljs-comment">// ctx.lineTo(50,50); // 最后一笔可以不画</span>
        ctx.<span class="hljs-title function_">closePath</span>();
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbc42c23f5504718ab0fb038c009fabc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=ujspluWf9vSFLeIbu6xk2SsdBfs%3D" alt="image.png" loading="lazy"/></p>
<p>所以我们在绘制图形时需要使用<code>beginPath()</code>和 <code>closePath()</code>包裹起来。</p>
<h6 data-id="heading-14">给矩形上色</h6>
<p>上文中有提过绘制的两种方法分别是<code>stroke()</code>和<code>fill()</code>，我们需要使用<code>fill()</code>方法给矩形上色。和使用<code>stroke</code>前相同，我们需要先给它设置好属性。</p>
<pre><code class="hljs language-js" lang="js">        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">50</span>,<span class="hljs-number">50</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">50</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>,<span class="hljs-number">100</span>);
        ctx.<span class="hljs-title function_">closePath</span>();

        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">5</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">"black"</span>;

        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"red"</span>;

        ctx.<span class="hljs-title function_">fill</span>();
        ctx.<span class="hljs-title function_">stroke</span>();   
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34d863746af641cf951ba66a6be6130f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=kLDHbM6wuZR2DRNNs9eTMRDR%2F5I%3D" alt="image.png" loading="lazy"/></p>
<h6 data-id="heading-15">使用<code>rect()</code>方法绘制矩形</h6>
<p>由于矩形是常用的图形，所以 Canvas API 封装好了一个定义矩形位置信息的方法，这个方法接受四个参数，分别表示矩形的起点坐标和宽高。</p>
<pre><code class="hljs language-js" lang="js">        ctx.<span class="hljs-title function_">rect</span>(x,y,width,height);

        ctx.<span class="hljs-title function_">beginPath</span>();
        ctx.<span class="hljs-title function_">rect</span>(<span class="hljs-number">50</span>,<span class="hljs-number">50</span>,<span class="hljs-number">100</span>,<span class="hljs-number">100</span>);
        
        ctx.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">5</span>;
        ctx.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">"black"</span>;
        ctx.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"red"</span>;

        ctx.<span class="hljs-title function_">fill</span>();
        ctx.<span class="hljs-title function_">stroke</span>();
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46338e599a61409da3d39828c7175cb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5piv6bG8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064172&amp;x-signature=rLsP6iePRQqqRkhjDjOr%2FcTtrZU%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>今天 Canvas 的学习就到这啦</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI视频进入“加速度”时代：30%加速＋细节随手P，等等党和抽卡党都有救了！]]></title>    <link>https://juejin.cn/post/7573864324713054260</link>    <guid>https://juejin.cn/post/7573864324713054260</guid>    <pubDate>2025-11-18T09:13:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573864324713054260" data-draft-id="7573679820632670243" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI视频进入“加速度”时代：30%加速＋细节随手P，等等党和抽卡党都有救了！"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-11-18T09:13:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI视频进入“加速度”时代：30%加速＋细节随手P，等等党和抽卡党都有救了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:13:05.000Z" title="Tue Nov 18 2025 09:13:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>等等党和抽卡党们，这回做视频终于不用等！半！天！了！</p>
<p>相信大家都有这种感觉：每次用 AI 生成视频，刚按下按钮，屏幕就跳出来一句 “前方排队 xxx 人”，等吧，好不容易排到了，结果还得再磨个两三分钟才能出片……</p>
<p>而且生成效果到底咋样，几乎纯看运气，不满意还得重新抽卡，这次终于不一样了，等等党有救，抽卡党翻身～</p>
<p>现在，从点击生成到看到成片，不到一分钟就能轻松产出一条 5 秒的高清视频大片，画质妥妥拉满，效果 be like：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/36e4f0c5ddce482aacbdb67f120974a5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=8Gagp56jI%2FWB8IcctaAdC4tY%2FSI%3D" alt="" loading="lazy"/></p>
<p>你以为这就结束了？大 NO 特 NO！现在碰到不满意的视频也不用重新抽卡，直接在线精修，想怎么 P 就怎么 P。</p>
<p>周末来得刚刚好，蒙娜丽莎牵着兵马俑走进了魔都街头，这回不当文艺女神，当起了 “沪上阿姨”：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c56f0070b564cee91e02ef9fda1fe3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=OmU%2FnaAs22qUU31u6veO9otmUYQ%3D" alt="" loading="lazy"/></p>
<p>emm… 人都到上海了，手里却还举着杯可乐，怎么看都不太对劲，于是我顺手一改，把可乐 P 成了奶茶，这样才对嘛，入乡随俗入乡随俗～</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5dd37fd6660148db9cae3ae448dbe0d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=EnV7FObt5q5sN5BLx43qfl%2Fl6OE%3D" alt="" loading="lazy"/></p>
<p>不卖关子，这就是「拍我 AI」（即 PixVerse）重磅上线的升级版：V5 Fast，视频生成速度提升超 <strong>30%</strong>，此外还上线了**「Modify」精修功能**，支持端到端视频编辑，生成完还能接着改～</p>
<p>两项关键能力一起落地，让视频创作第一次有了 “快＋可控” 的完整体验，目前新功能已在「拍我 AI」重磅上线，废话不多说，跟我一起 roll 起来吧！</p>
<h2 data-id="heading-0">AI 视频也实现 P 图自由了</h2>
<p>过去这一年，AI 视频从创作者工具变成了商业化生产力。</p>
<p>品牌在用它做 campaign，自媒体在手搓各种 AIGC 新玩法，商家用它做新品素材，而更能感受到变化的，是大众化的使用场景——</p>
<p>旅行时随手做个 vlog、给猫猫剪段日常、记录小朋友的成长瞬间…… 越来越多人不再只是看别人用 AI 做视频，而是开始用 AI 记录自己的生活、讲自己的故事、创作属于自己的灵感。</p>
<p>然而，现在市面上绝大多数的 AI 视频工具更像是一次生成定生死，一旦要改，流程立刻变得又慢又不确定：</p>
<p>一个细节的错位、一个画面的跳帧都可能让全片重来，角色不稳要返工，元素乱跳要重生，提示词不准又得重新 roll，专业团队焦虑，普通用户更无从下手，明明是小改动，时间精力的投入成本却很大。</p>
<p>这直接带来的影响是：对内容团队是流程割裂，对商用制作是交付风险，对普通用户更是一道专业门槛的困扰。</p>
<p>因此，可修改性目前已经成为现在 AI 视频市场最真实、也最迫切的需求之一。</p>
<p>拍我 AI 的 <strong>Modify</strong> 精修能力，就是顺着这条需求线自然进化出来的，它所代表的是一类真正意义上的「市场创新」。</p>
<p>它把单帧修改变成了模型对全片的重新理解和一致化处理，实现跨帧推理、统一风格、主体稳态等一系列高要求的流程。</p>
<p>这类底层架构的精修方式目前在业内极为稀缺，基本属于拍我 AI 的<strong>独特能力</strong>。</p>
<p>也就是让创作者的工作流真正闭环，也让普通用户第一次拥有了<strong>拍了视频还能随手改</strong>的自由度。</p>
<p>AI 视频从 “能生成” 走向 “能被每个人掌控” 这一步，终于变得可行了。</p>
<h4 data-id="heading-1">元素替换：实物级别的可控编辑</h4>
<p>在这次全新推出的「Modify」精修功能中，我们不必再因为某个元素生成得不对、哪一帧出了小差错就从头反复生成，也不用担心提示词没写准、没编辑到位会导致整段视频推倒重来。</p>
<p>现在我们可以想改哪里就改哪里，真的做到了<strong>万物皆可替换</strong>。</p>
<p>先从我们创作中出现频率最高、需求最迫切的<strong>物品替换</strong>能力说起，我先让 V5 Fast 帮我生成了一段 “男子在 KTV 放飞自我唱歌” 的视频：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4a40895ba5e1406489ad9bdfe17d58bb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=aUpiZ8BYa816jsB01NbxPEFN5F4%3D" alt="" loading="lazy"/></p>
<p>接着我在 Modify 里把男子换成了一只沉浸式飙歌的小猫：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/467861bb0a204018ae078c764552fa7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=KG0Yfsf7sSzoBuqvsj9oUEVrz1E%3D" alt="" loading="lazy"/></p>
<p>AI 不仅保留了原视频里人物的肢体姿势、口型节奏，连服装细节也一起 copy 过去了，最关键的是整个场景环境都没崩，替换得非常自然。</p>
<p>除了能替换物品、人物外，Modify 还能<strong>替换背景</strong>，我把一个超飒女孩登山的视频丢给了 AI：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cb927405431d41269dfd0cc1240d5aa4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=X7IViWAan9op0LQMG4pLDI78hO0%3D" alt="" loading="lazy"/></p>
<p>嗯… 感觉这身专业户外装备用来登一座普通小山多少有点 “杀鸡用牛刀”！于是我让 Modify 把背景换成积雪覆盖的雪山，这下才对味儿嘛：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddb71e6bb4924928bde989074baa6b64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=cHaj9aVtoYFlfkiux7ayi3mwxw0%3D" alt="" loading="lazy"/></p>
<p>这个替换的难点在于原视频的背景是移动的，但 AI 不仅完成了背景替换，还自动补足了每一帧的场景一致性，甚至连女孩发丝透出的光线，都和雪山环境的冷色调对上了，可以说是非常周到了～</p>
<p>这种级别的元素替换能力，实质上把「改视频」这件事从高门槛的专业技能，重新交回给了所有用户。</p>
<p>无论是换物件、调环境，还是修一个不满意的细节，都终于能简单到<strong>人人敢下手、人人能做好</strong>。</p>
<h4 data-id="heading-2">局部修改：从风格到质感都能调</h4>
<p>除了能修改那些 “看得见摸得着” 的视频元素外，一些更抽象、更细微的局部变化，比如光影、质感、整体氛围这种非实体的细节，Modify 也完全 hold 得住。</p>
<p>这类需求在行业里一直是痛点：元素替换容易量化，但<strong>无形的局部</strong>往往最难改，一不小心就会破坏整段视频的连贯性。</p>
<p>咱们不走简单路线，直接上点难度，先来考验一下 AI 的<strong>风格修改</strong>能力。</p>
<p>现在打工人的怨气是真越来越重了，看下面这位小哥，工作崩溃到想直接怒砸键盘（但还是忍住了）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f981dfabd0b43039252c5ced7a78698~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=BgYgVpsuNaJIl1Py%2FfOlSdtC8BQ%3D" alt="" loading="lazy"/></p>
<p>我们就用 Modify 给他换个画风，试试把这场 “社畜崩溃现场” 重绘成「美式漫画」风格：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4a9066cd85245778efd51a6a2cd4752~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=dBsTYYye4FjJbgYS6NN05tIhwBs%3D" alt="" loading="lazy"/></p>
<p>不光是整体风格切得干净，连衣服的褶皱、肢体动作、情绪张力都被 1:1 保留下来，风格想怎么改就怎么改，还能保持动作一致性，这才叫真正的 “可控风格替换”～</p>
<p>不仅如此，Modify 还能对物品的「<strong>材质</strong>」进行精确修改，我先是用 V5 Fast 生成了一段黑色亮面跑车驰骋在公路上的视频：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ddc961159f4f4067a57d1dd80d57d24e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=GkinEkCGN7h7f809%2BpO1a7wPwMc%3D" alt="" loading="lazy"/></p>
<p>随后让 Modify 把车身材质替换成红色哑光，在镜头运动不变、光影一致的前提下，AI 依然稳稳完成了替换：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2399481002414d61bce5bd81cd535e69~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=xR0tlAIyOEAxmqhMB6zI4ESZoYU%3D" alt="" loading="lazy"/></p>
<p>亮面换哑光、金属换塑料、皮革换织物，看似只是质感变化，但牵涉光影反射、表面细节、镜头轨迹，一旦处理不到位就会立刻穿帮。</p>
<p>而 Modify 既做到了替换材质，又保证每帧视觉逻辑都成立。</p>
<p>除了能修改风格和材质，Modify 还能同步修改「<strong>光线</strong>」、「<strong>色调</strong>」等非实体细节，那些在传统视频制作里最费力、最考验眼力的部分，也终于能交给 AI 来稳稳搞定。</p>
<h4 data-id="heading-3">人物编辑：跟修图烦恼说 bye bye</h4>
<p>经常拍照的人应该都有这种痛苦体验——给视频「<strong>人物修图</strong>」真的太、太、太麻烦了！</p>
<p>毕竟图片想怎么修就怎么修，可视频一旦要改就麻烦得多，过去那些在修图软件里拖一拖、点两下就能解决的小调整，放到视频里往往得重做整条。</p>
<p>这次 Modify 也把这个现实痛点考虑进去了：</p>
<p>视频人物不仅能用一句提示词直接改，还能自由调整年龄、服装、气质，甚至做到 “整个状态” 一起同步变化。</p>
<p>这是我喂给 Modify 的一张游客照，一个和长颈鹿合影的小男孩，因为拍摄角度的原因，男孩的眼睛显得有点小，皮肤也有些小瑕疵：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3ba29df1842f48c5857abc7d62d99622~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=MMTmRLhdbwSQfrJcKV9ndbj%2BjBs%3D" alt="" loading="lazy"/></p>
<p>于是乎，我给 AI 下的指令是，让男孩眼睛更大一点、皮肤更平滑一点，Modify 立刻就给出了效果：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c41c55113754497cb9bcb0c19f3a2302~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=WivAVx21hvpoep7uQ056n1cutt4%3D" alt="" loading="lazy"/></p>
<p>眼睛肉眼可见地放大，皮肤也有了明显的磨皮效果，不得不说，这波 P 图功底确实有点东西～</p>
<p>再来玩点有意思的，来试试 AI 邪修术之——<strong>年龄修改</strong>！我先喂给 AI 一段老奶奶的视频：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/179148cbc6ac4b77860defcd8d75583d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=NyLQJ0qRGXEMTTZgiXe3K7zfrGs%3D" alt="" loading="lazy"/></p>
<p>然后只对 Modify 说了三个字——变！年！轻！结果老奶奶直接年轻了三十岁：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a63380038dc9461eb47de73fb87db17f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=pW6e13nWqhlk5fBG%2FX0TPINCbu0%3D" alt="" loading="lazy"/></p>
<p>人物能被自由修改，并不只是创意玩法。</p>
<p>在这个过程中，行业得到了更可控的创作能力，但对普通人而言，更大的价值在于：<strong>影像不再只能记录当下，它还能记录 “可能的样子”</strong>。</p>
<p>爷爷奶奶可以看看年轻时的模样，普通人也可以看到自己理想中的自己，AI 视频让影像变得更温柔、更有想象力。</p>
<p>此外，Modify 还具备「<strong>尺寸修改</strong>」能力，哪怕第一次生成的比例不太对，也能用一句提示词随心调整，彻底摆脱 “尺寸错了只能重生” 的麻烦事儿。</p>
<p>随着 Modify 把「可编辑性」补齐，AI 视频终于从一次性生成的模型能力，走向可反复打磨的创作工具。</p>
<p>这不仅让专业内容生产更可控，也让普通人拥有了<strong>真正掌控动态影像的权利</strong>，未来的视频创作，不再由模型决定，而是由使用它的每一个人决定。</p>
<h2 data-id="heading-4">生成提速 30%，大片稳出不误事</h2>
<p>生成速度一直是 AI 视频创作里绕不过去的问题。</p>
<p>无论是内容团队、短视频创作者，还是需要频繁验证想法的品牌方，都面临同一个困扰：</p>
<p>目前绝大多数 AI 视频的生成速度，赶不上用户内容交付的节奏，也赶不上用户灵感增长的速度。</p>
<p>团队需要高频实时产出，短视频创作者需要快速 AB 测试，品牌方则需要在短周期内验证创意想法，只要生成一慢，所有链路就一起被卡住。</p>
<p>这次爱诗科技上线的拍我 AI（PixVerse）V5 Fast，就是在这个现实痛点上做了明显优化。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c571786de4094611baa9dcd473e57536~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764061985&amp;x-signature=DfMlm3TvEtiRfKXxjh4JgTx5sfE%3D" alt="" loading="lazy"/></p>
<p>相比上一代 V5 模型，V5 Fast 生成速度提升了 30%+，举个直观的例子就是，原本 5 秒的高清视频要等 1～2 分钟，现在只需要在 1 分钟以内就能看到成片。</p>
<p>原因很简单，以前的 Sora、视频版 Stable Diffusion 都是直接用一个超级大的模型一次性预测几十上百帧，模型看得太多太远，算得特别慢。</p>
<p>而 V5 Fast 让模型推理结构变得轻量化、帧间计算依赖被缩短，高分辨率的视频生成不再是 “倍速变慢” 的瓶颈环节。</p>
<p>看似还是那条推理链，但加速点遍布每一个视频节点，速度自然就提升得非常明显。</p>
<p>最关键的是，速度提上来了，效果也没掉链子，动作细节和风格依旧在线，对内容创作者来说，这种 “赶得上点” 的生成速度，才是真正能用起来的节奏。</p>
<p>为了更直观地对比，我们测试了拍我 AI（PixVerse）V5 Fast 与市面主流产品在相同提示词 &amp; 参数条件下的表现，没见过比这更快的：</p>
<p><a title="" ref="nofollow noopener noreferrer" href="https://link.juejin.cn?target=">视频详情</a></p>
<p>拍我 AI(PixVerse) V5 Fast 约 40 秒即可生成完成 1080P 的 5 秒视频，等待过程更短、生成体验更连贯。符合社交平台传播的 360P 和 720P 生成速度更快，数秒也就完成了。</p>
<p>从 Modify 精修功能到 V5 Fast 提速模型，背后是「爱诗科技」在 AI 视频生成领域持续的技术投入与产品打磨。</p>
<p>今年 10 月，爱诗科技完成了 1 亿元人民币的 B+ 轮融资，仅用两年时间就完成了五次模型迭代、八个版本更新，率先在行业内实现了 DiT 架构、准实时生成、角色驱动视频等关键突破。</p>
<p>更值得注意的，爱诗还是最早在 V3.5 破 10 秒大关的（去年 12 月）。进入 2025 年 1 月，V4 进入 5 秒准实时生成时代的平台，在全球已具规模的视频生成平台中生成速度最快。</p>
<p>作为其旗下核心产品，海外版 PixVerse 与国内版「拍我 AI」累计服务超过一亿用户，月活突破 1600 万，自去年启动商业化以来，收入增长超 10 倍，成为全球增长最快的 AI 视频平台之一。</p>
<p>这次发布的 V5 Fast 模式与 Modify 精修功能，进一步降低了 AI 视频的创作门槛，提升了创作自由度，视频生成不再因「慢」和「一次定生死」而被卡住。</p>
<p>生成能跟上节奏，修改能随手完成，AI 视频创作的工作流才真正完整起来。灵感不再被速度拖住，视频也不再是一锤子买卖，而是成为人人都能打磨、能调整、能反复利用的创意载体。</p>
<p>更重要的是，那些平时不太被注意、却跟日常生活贴得很紧的小需求，也能被看到、被重视、被满足，AI 也不再高高在上，而是开始贴着我们的日常需求去跑，贴着每一个细微的小动作去做。</p>
<p>这次「拍我 AI」新功能上线的意义，也正是在这里：</p>
<p>每一个人都可以无差别享受先进 AI 技术的乐趣。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android U 自由窗口(浮窗)——启动流程（system_server侧流程）]]></title>    <link>https://juejin.cn/post/7573708620870844468</link>    <guid>https://juejin.cn/post/7573708620870844468</guid>    <pubDate>2025-11-18T09:51:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573708620870844468" data-draft-id="7573708620870811700" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android U 自由窗口(浮窗)——启动流程（system_server侧流程）"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-18T09:51:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yi诺千金"/> <meta itemprop="url" content="https://juejin.cn/user/4464480371870584"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android U 自由窗口(浮窗)——启动流程（system_server侧流程）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4464480371870584/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yi诺千金
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:51:42.000Z" title="Tue Nov 18 2025 09:51:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>接 <a href="https://juejin.cn/editor/drafts/7566064705879867419" target="_blank" title="https://juejin.cn/editor/drafts/7566064705879867419">juejin.cn/editor/draf…</a></p>
<h2 data-id="heading-0">system_server侧流程</h2>
<p>代码路径：frameworks/base/services/core/java/com/android/server/wm/ActivityTaskManagerService.java</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">startActivityFromRecents</span><span class="hljs-params">(<span class="hljs-type">int</span> taskId, Bundle bOptions)</span> {
        mAmInternal.enforceCallingPermission(START_TASKS_FROM_RECENTS,
                <span class="hljs-string">"startActivityFromRecents()"</span>);
        <span class="hljs-comment">//获取</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">callingPid</span> <span class="hljs-operator">=</span> Binder.getCallingPid();
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">callingUid</span> <span class="hljs-operator">=</span> Binder.getCallingUid();
        <span class="hljs-comment">//封装options</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">SafeActivityOptions</span> <span class="hljs-variable">safeOptions</span> <span class="hljs-operator">=</span> SafeActivityOptions.fromBundle(bOptions);
        <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">origId</span> <span class="hljs-operator">=</span> Binder.clearCallingIdentity();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> mTaskSupervisor.startActivityFromRecents(callingPid, callingUid, taskId,
                    safeOptions);
        } <span class="hljs-keyword">finally</span> {
            Binder.restoreCallingIdentity(origId);
        }
    }
</code></pre>
<p>这里<code>callingPid</code>和<code>callingUid</code>为桌面<strong>pid</strong>和<strong>uid</strong>，后续传递参数继续调用到ActivityTaskSupervisor.startActivityFromRecents。</p>
<p>代码路径：frameworks/base/services/core/java/com/android/server/wm/ActivityTaskSupervisor.java</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * Start the given task from the recent tasks. Do not hold WM global lock when calling this
     * method to avoid potential deadlock or permission deny by UriGrantsManager when resolving
     * activity (see {<span class="hljs-doctag">@link</span> ActivityStarter.Request#resolveActivity} and
     * {<span class="hljs-doctag">@link</span> com.android.server.am.ContentProviderHelper#checkContentProviderUriPermission}).
     *
     * <span class="hljs-doctag">@return</span> The result code of starter.
     */</span>
    <span class="hljs-type">int</span> <span class="hljs-title function_">startActivityFromRecents</span><span class="hljs-params">(<span class="hljs-type">int</span> callingPid, <span class="hljs-type">int</span> callingUid, <span class="hljs-type">int</span> taskId,
            SafeActivityOptions options)</span> {
        <span class="hljs-keyword">final</span> Task task;
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> taskCallingUid;
        <span class="hljs-keyword">final</span> String callingPackage;
        <span class="hljs-keyword">final</span> String callingFeatureId;
        <span class="hljs-keyword">final</span> Intent intent;
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> userId;
        <span class="hljs-comment">//获取传递过来的options</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">ActivityOptions</span> <span class="hljs-variable">activityOptions</span> <span class="hljs-operator">=</span> options != <span class="hljs-literal">null</span>
                ? options.getOptions(<span class="hljs-built_in">this</span>)
                : <span class="hljs-literal">null</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">moveHomeTaskForward</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">synchronized</span> (mService.mGlobalLock) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isCallerRecents</span> <span class="hljs-operator">=</span> mRecentTasks.isCallerRecents(callingUid);
            <span class="hljs-type">int</span> <span class="hljs-variable">activityType</span> <span class="hljs-operator">=</span> ACTIVITY_TYPE_UNDEFINED;
            <span class="hljs-keyword">if</span> (activityOptions != <span class="hljs-literal">null</span>) {
                activityType = activityOptions.getLaunchActivityType();
                <span class="hljs-comment">//这里主要就是判断是否要 冻结当前最近的任务列表顺序，直到用户与当前应用程序进行交互或发生超时。</span>
                <span class="hljs-keyword">if</span> (activityOptions.freezeRecentTasksReordering() &amp;&amp; (isCallerRecents
                        || ActivityTaskManagerService.checkPermission(MANAGE_ACTIVITY_TASKS,
                                callingPid, callingUid) == PERMISSION_GRANTED)) {
                    mRecentTasks.setFreezeTaskListReordering();
                }
                <span class="hljs-comment">//传递过来options中没有设置过mLaunchRootTask，因此getLaunchRootTask()的值为空</span>
                <span class="hljs-keyword">if</span> (activityOptions.getLaunchRootTask() != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// Don't move home activity forward if there is a launch root set.</span>
                    moveHomeTaskForward = <span class="hljs-literal">false</span>;
                }
            }
            <span class="hljs-comment">//判断当前activity类型的合法性</span>
            <span class="hljs-keyword">if</span> (activityType == ACTIVITY_TYPE_HOME || activityType == ACTIVITY_TYPE_RECENTS) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"startActivityFromRecents: Task "</span>
                        + taskId + <span class="hljs-string">" can't be launch in the home/recents root task."</span>);
            }

            <span class="hljs-type">boolean</span> <span class="hljs-variable">shouldStartActivity</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-comment">//延迟窗口布局</span>
            mService.deferWindowLayout();
            <span class="hljs-keyword">try</span> {
                <span class="hljs-comment">//根据taskId获取Task对象</span>
                task = mRootWindowContainer.anyTaskForId(taskId,
                        MATCH_ATTACHED_TASK_OR_RECENT_TASKS_AND_RESTORE, activityOptions, ON_TOP);
                <span class="hljs-comment">//task为空时，做窗口绘制处理并抛出异常</span>
                <span class="hljs-keyword">if</span> (task == <span class="hljs-literal">null</span>) {
                    mWindowManager.executeAppTransition();
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(
                            <span class="hljs-string">"startActivityFromRecents: Task "</span> + taskId + <span class="hljs-string">" not found."</span>);
                }

                <span class="hljs-keyword">if</span> (moveHomeTaskForward) {
                    <span class="hljs-comment">// We always want to return to the home activity instead of the recents</span>
                    <span class="hljs-comment">// activity from whatever is started from the recents activity, so move</span>
                    <span class="hljs-comment">// the home root task forward.</span>
                    <span class="hljs-comment">// TODO (b/115289124): Multi-display supports for recents.</span>
                    <span class="hljs-comment">//moveHomeRootTaskToFront会获取桌面rootTask，然后将其移至最前台</span>
                    mRootWindowContainer.getDefaultTaskDisplayArea().moveHomeRootTaskToFront(
                            <span class="hljs-string">"startActivityFromRecents"</span>);
                }

                <span class="hljs-comment">// If the user must confirm credentials (e.g. when first launching a work</span>
                <span class="hljs-comment">// app and the Work Challenge is present) let startActivityInPackage handle</span>
                <span class="hljs-comment">// the intercepting.</span>
                
                <span class="hljs-comment">//android 13之前的的版本可能会进入该流程，</span>
                <span class="hljs-comment">//本地使用的android 14，task.getRootActivity()为null，因此不进入此流程</span>
                <span class="hljs-keyword">if</span> (!mService.mAmInternal.shouldConfirmCredentials(task.mUserId)
                        &amp;&amp; task.getRootActivity() != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">final</span> <span class="hljs-type">ActivityRecord</span> <span class="hljs-variable">targetActivity</span> <span class="hljs-operator">=</span> task.getTopNonFinishingActivity();
                    ......
                    <span class="hljs-keyword">try</span> {
                        <span class="hljs-comment">//这里是把自由窗口的Task移到最顶部前端</span>
                        mService.moveTaskToFrontLocked(<span class="hljs-literal">null</span> <span class="hljs-comment">/* appThread */</span>,
                                <span class="hljs-literal">null</span> <span class="hljs-comment">/* callingPackage */</span>, task.mTaskId, <span class="hljs-number">0</span>, options);
                        ......
                    } <span class="hljs-keyword">finally</span> {
                        mActivityMetricsLogger.notifyActivityLaunched(launchingState,
                                START_TASK_TO_FRONT, <span class="hljs-literal">false</span> <span class="hljs-comment">/* newActivityCreated */</span>,
                                targetActivity, activityOptions);
                    }

                    mService.getActivityStartController().postStartActivityProcessingForLastStarter(
                            task.getTopNonFinishingActivity(), ActivityManager.START_TASK_TO_FRONT,
                            task.getRootTask());

                    <span class="hljs-comment">// As it doesn't go to ActivityStarter.executeRequest() path, we need to resume</span>
                    <span class="hljs-comment">// app switching here also.</span>
                    mService.resumeAppSwitches();
                    <span class="hljs-keyword">return</span> ActivityManager.START_TASK_TO_FRONT;
                }
                <span class="hljs-comment">// The task is empty or needs to show the confirmation for credential.</span>
                shouldStartActivity = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-keyword">if</span> (!shouldStartActivity) {
                    <span class="hljs-comment">//继续窗口布局，与前面mService.deferWindowLayout()延迟窗口布局相呼应。</span>
                    mService.continueWindowLayout();
                }
            }
            ......
        }
        <span class="hljs-comment">// ActivityStarter will acquire the lock where the places need, so execute the request</span>
        <span class="hljs-comment">// outside of the lock.</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// We need to temporarily disable the explicit intent filter matching enforcement</span>
            <span class="hljs-comment">// because Task does not store the resolved type of the intent data, causing filter</span>
            <span class="hljs-comment">// mismatch in certain cases. (b/240373119)</span>
            PackageManagerServiceUtils.DISABLE_ENFORCE_INTENTS_TO_MATCH_INTENT_FILTERS.set(<span class="hljs-literal">true</span>);
            <span class="hljs-comment">//通过startActivityInPackage启动相应的Task中对应Activity并将其移至最前台，传递options、task等关键参数。</span>
            <span class="hljs-keyword">return</span> mService.getActivityStartController().startActivityInPackage(taskCallingUid,
                    callingPid, callingUid, callingPackage, callingFeatureId, intent, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
                    <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, options, userId, task, <span class="hljs-string">"startActivityFromRecents"</span>,
                    <span class="hljs-literal">false</span> <span class="hljs-comment">/* validateIncomingUser */</span>, <span class="hljs-literal">null</span> <span class="hljs-comment">/* originatingPendingIntent */</span>,
                    BackgroundStartPrivileges.NONE);
        } <span class="hljs-keyword">finally</span> {
            PackageManagerServiceUtils.DISABLE_ENFORCE_INTENTS_TO_MATCH_INTENT_FILTERS.set(<span class="hljs-literal">false</span>);
            <span class="hljs-keyword">synchronized</span> (mService.mGlobalLock) {
                <span class="hljs-comment">//继续窗口布局，与前面mService.deferWindowLayout()延迟窗口布局相呼应。</span>
                mService.continueWindowLayout();
            }
        }
    }
</code></pre>
<p>startActivityFromRecents方法主要做了两件事：</p>
<ol>
<li>使用<code>anyTaskForId</code>方法，通过taskId找到对应的Task并设置其windowingMode。</li>
<li>通过<code>startActivityInPackage</code>方法，启动Task中对应Activity并将其移至最前台。</li>
</ol>
<h3 data-id="heading-1">通过taskId找到对应的Task并设置其windowingMode</h3>
<pre><code class="hljs language-java" lang="java">task = mRootWindowContainer.anyTaskForId(taskId,
        MATCH_ATTACHED_TASK_OR_RECENT_TASKS_AND_RESTORE, activityOptions, ON_TOP);
</code></pre>
<p>这里主要传递应用taskId和activityOptions（携带需要设置的自由窗口相关参数）。</p>
<h4 data-id="heading-2">RootWindowContainer.anyTaskForId</h4>
<p>代码路径：frameworks/base/services/core/java/com/android/server/wm/RootWindowContainer.java</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * Returns a {<span class="hljs-doctag">@link</span> Task} for the input id if available. {<span class="hljs-doctag">@code</span> null} otherwise.
     *
     * <span class="hljs-doctag">@param</span> id        Id of the task we would like returned.
     * <span class="hljs-doctag">@param</span> matchMode The mode to match the given task id in.
     * <span class="hljs-doctag">@param</span> aOptions  The activity options to use for restoration. Can be null.
     * <span class="hljs-doctag">@param</span> onTop     If the root task for the task should be the topmost on the display.
     */</span>
    Task <span class="hljs-title function_">anyTaskForId</span><span class="hljs-params">(<span class="hljs-type">int</span> id, <span class="hljs-meta">@RootWindowContainer</span>.AnyTaskForIdMatchTaskMode <span class="hljs-type">int</span> matchMode,
            <span class="hljs-meta">@Nullable</span> ActivityOptions aOptions, <span class="hljs-type">boolean</span> onTop)</span> {
        <span class="hljs-comment">// If options are set, ensure that we are attempting to actually restore a task</span>
        <span class="hljs-keyword">if</span> (matchMode != MATCH_ATTACHED_TASK_OR_RECENT_TASKS_AND_RESTORE &amp;&amp; aOptions != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">"Should not specify activity options for non-restore"</span>
                    + <span class="hljs-string">" lookup"</span>);
        }

        <span class="hljs-comment">//简单说就是创建了一个 task -&gt; task.isTaskId(id) 的lamda表达式</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">PooledPredicate</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> PooledLambda.obtainPredicate(
                Task::isTaskId, PooledLambda.__(Task.class), id);
        <span class="hljs-comment">//查找符合条件的task</span>
        <span class="hljs-type">Task</span> <span class="hljs-variable">task</span> <span class="hljs-operator">=</span> getTask(p);
        <span class="hljs-comment">//将 PooledPredicate 对象回收到对象池中，以便重用，避免频繁的垃圾回收</span>
        p.recycle();

        <span class="hljs-keyword">if</span> (task != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (aOptions != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// Resolve the root task the task should be placed in now based on options</span>
                <span class="hljs-comment">// and reparent if needed.</span>
                <span class="hljs-comment">// TODO(b/229927851) For split-screen, setLaunchRootTask is no longer the "root"</span>
                <span class="hljs-comment">// task, consider to rename methods like "parentTask" instead of "rootTask".</span>
                <span class="hljs-comment">//找到rootTask</span>
                <span class="hljs-keyword">final</span> <span class="hljs-type">Task</span> <span class="hljs-variable">targetRootTask</span> <span class="hljs-operator">=</span>
                        getOrCreateRootTask(<span class="hljs-literal">null</span>, aOptions, task, onTop);
                <span class="hljs-comment">// When launch with ActivityOptions#getLaunchRootTask, the "root task" just mean the</span>
                <span class="hljs-comment">// parent of current launch, not the "root task" in hierarchy.</span>
                <span class="hljs-comment">//这里是判断当前Task的获取到的rootTask与其task.getRootTask()的场景</span>
                <span class="hljs-comment">//我们一般启动应用时情况如下：</span>
                <span class="hljs-comment">//targetRootTask != null,true</span>
                <span class="hljs-comment">//task.getRootTask() != targetRootTask，false</span>
                <span class="hljs-comment">//task.getParent() != targetRootTask，false</span>
                <span class="hljs-comment">//因此我们这里为false</span>
                <span class="hljs-comment">//这个场景一般是task参数在特殊情况变null时，getOrCreateRootTask中会重新创建Task</span>
                <span class="hljs-keyword">if</span> (targetRootTask != <span class="hljs-literal">null</span> &amp;&amp; task.getRootTask() != targetRootTask
                        &amp;&amp; task.getParent() != targetRootTask) {
                    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">reparentMode</span> <span class="hljs-operator">=</span> onTop
                            ? REPARENT_MOVE_ROOT_TASK_TO_FRONT : REPARENT_LEAVE_ROOT_TASK_IN_PLACE;
                    task.reparent(targetRootTask, onTop, reparentMode, ANIMATE, DEFER_RESUME,
                            <span class="hljs-string">"anyTaskForId"</span>);
                }
            }
            <span class="hljs-comment">//返回获取到的task</span>
            <span class="hljs-keyword">return</span> task;
        }

        <span class="hljs-comment">//task为空的其他情况，省略</span>
        ......
        
        <span class="hljs-keyword">if</span> (DEBUG_RECENTS) Slog.w(TAG_RECENTS, <span class="hljs-string">"Restored task id="</span> + id + <span class="hljs-string">" from in recents"</span>);
        <span class="hljs-keyword">return</span> task;
    }
</code></pre>
<p>这个方法实际上就是通过getOrCreateRootTask做一些操作，然后返回给targetRootTask，做后续的条件判断处理。
在代码我们分析了后面的流程一般情况不会去走，因此暂不考虑。这里最后return 通过<code>getTask(p)</code>获取到的task。</p>
<p>这里我们重点分析下getOrCreateRootTask方法。</p>
<pre><code class="hljs language-java" lang="java">                <span class="hljs-keyword">final</span> <span class="hljs-type">Task</span> <span class="hljs-variable">targetRootTask</span> <span class="hljs-operator">=</span>
                        getOrCreateRootTask(<span class="hljs-literal">null</span>, aOptions, task, onTop);
</code></pre>
<p>这里传递了从taskId中找到的对应task，以及前面创建options，其中参数<code>null</code>表示ActivityRecord为空。</p>
<h4 data-id="heading-3">RootWindowContainer.getOrCreateRootTask</h4>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * Returns the right root task to use for launching factoring in all the input parameters.
     *
     * <span class="hljs-doctag">@param</span> r              The activity we are trying to launch. Can be null.
     * <span class="hljs-doctag">@param</span> options        The activity options used to the launch. Can be null.
     * <span class="hljs-doctag">@param</span> candidateTask  The possible task the activity might be launched in. Can be null.
     * <span class="hljs-doctag">@param</span> sourceTask     The task requesting to start activity. Can be null.
     * <span class="hljs-doctag">@param</span> launchParams   The resolved launch params to use.
     * <span class="hljs-doctag">@param</span> launchFlags    The launch flags for this launch.
     * <span class="hljs-doctag">@param</span> realCallingPid The pid from {<span class="hljs-doctag">@link</span> ActivityStarter#setRealCallingPid}
     * <span class="hljs-doctag">@param</span> realCallingUid The uid from {<span class="hljs-doctag">@link</span> ActivityStarter#setRealCallingUid}
     * <span class="hljs-doctag">@return</span> The root task to use for the launch.
     */</span>
    Task <span class="hljs-title function_">getOrCreateRootTask</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ActivityRecord r,
            <span class="hljs-meta">@Nullable</span> ActivityOptions options, <span class="hljs-meta">@Nullable</span> Task candidateTask,
            <span class="hljs-meta">@Nullable</span> Task sourceTask, <span class="hljs-type">boolean</span> onTop,
            <span class="hljs-meta">@Nullable</span> LaunchParamsController.LaunchParams launchParams, <span class="hljs-type">int</span> launchFlags)</span> {
        <span class="hljs-comment">// First preference goes to the launch root task set in the activity options.</span>
        <span class="hljs-keyword">if</span> (options != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">//这边传递过来的options没有设置过mLaunchRootTask</span>
            <span class="hljs-comment">//因此options.getLaunchRootTask()为null，因此不进入此流程</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">Task</span> <span class="hljs-variable">candidateRoot</span> <span class="hljs-operator">=</span> Task.fromWindowContainerToken(options.getLaunchRootTask());
            <span class="hljs-keyword">if</span> (candidateRoot != <span class="hljs-literal">null</span> &amp;&amp; canLaunchOnDisplay(r, candidateRoot)) {
                <span class="hljs-keyword">return</span> candidateRoot;
            }
        }

        <span class="hljs-comment">// Next preference goes to the task id set in the activity options.</span>
        <span class="hljs-keyword">if</span> (options != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">//options.getLaunchRootTask()为null，因此不进入此流程</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">candidateTaskId</span> <span class="hljs-operator">=</span> options.getLaunchTaskId();
            <span class="hljs-keyword">if</span> (candidateTaskId != INVALID_TASK_ID) {
                ......
            }
        }

        <span class="hljs-comment">// Next preference goes to the TaskDisplayArea candidate from launchParams</span>
        <span class="hljs-comment">// or activity options.</span>
        <span class="hljs-type">TaskDisplayArea</span> <span class="hljs-variable">taskDisplayArea</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-comment">//launchParams传递过来的值为null</span>
        <span class="hljs-keyword">if</span> (launchParams != <span class="hljs-literal">null</span> &amp;&amp; launchParams.mPreferredTaskDisplayArea != <span class="hljs-literal">null</span>) {
            taskDisplayArea = launchParams.mPreferredTaskDisplayArea;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options != <span class="hljs-literal">null</span>) {<span class="hljs-comment">//options不为空，进入此流程给taskDisplayArea赋值</span>
            <span class="hljs-comment">//当前的options中没有设置，因此options.getLaunchTaskDisplayArea()值为空</span>
            <span class="hljs-comment">//即taskDisplayArea获取的值为null。</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">WindowContainerToken</span> <span class="hljs-variable">daToken</span> <span class="hljs-operator">=</span> options.getLaunchTaskDisplayArea();
            taskDisplayArea = daToken != <span class="hljs-literal">null</span>
                    ? (TaskDisplayArea) WindowContainer.fromBinder(daToken.asBinder()) : <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span> (taskDisplayArea == <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">//options.getLaunchDisplayId()为null，因此不进入此流程</span>
                <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">launchDisplayId</span> <span class="hljs-operator">=</span> options.getLaunchDisplayId();
                <span class="hljs-keyword">if</span> (launchDisplayId != INVALID_DISPLAY) {
                    <span class="hljs-keyword">final</span> <span class="hljs-type">DisplayContent</span> <span class="hljs-variable">displayContent</span> <span class="hljs-operator">=</span> getDisplayContent(launchDisplayId);
                    <span class="hljs-keyword">if</span> (displayContent != <span class="hljs-literal">null</span>) {
                        taskDisplayArea = displayContent.getDefaultTaskDisplayArea();
                    }
                }
            }
        }

        <span class="hljs-comment">//获取activityType</span>
        <span class="hljs-comment">//我们这里r即ActivityRecord为空，因此获取candidateTask的type</span>
        <span class="hljs-comment">//即activityType为ACTIVITY_TYPE_STANDARD</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">activityType</span> <span class="hljs-operator">=</span> resolveActivityType(r, options, candidateTask);
        <span class="hljs-comment">//此时taskDisplayArea仍然为空</span>
        <span class="hljs-keyword">if</span> (taskDisplayArea != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (canLaunchOnDisplay(r, taskDisplayArea.getDisplayId())) {
                <span class="hljs-keyword">return</span> taskDisplayArea.getOrCreateRootTask(r, options, candidateTask,
                        sourceTask, launchParams, launchFlags, activityType, onTop);
            } <span class="hljs-keyword">else</span> {
                taskDisplayArea = <span class="hljs-literal">null</span>;
            }
        }

        <span class="hljs-comment">// Give preference to the root task and display of the input task and activity if they</span>
        <span class="hljs-comment">// match the mode we want to launch into.</span>
        <span class="hljs-type">Task</span> <span class="hljs-variable">rootTask</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-comment">//传递过来的candidateTask不为空，因此获取其rootTask</span>
        <span class="hljs-keyword">if</span> (candidateTask != <span class="hljs-literal">null</span>) {
            rootTask = candidateTask.getRootTask();
        }
        <span class="hljs-comment">//rootTask为空且ActivityRecord不为空的情况，通过ActivityRecord获取rootTask</span>
        <span class="hljs-keyword">if</span> (rootTask == <span class="hljs-literal">null</span> &amp;&amp; r != <span class="hljs-literal">null</span>) {
            rootTask = r.getRootTask();
        }
        <span class="hljs-comment">//launchParams为null，此时windowingMode为WINDOWING_MODE_UNDEFINED</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">windowingMode</span> <span class="hljs-operator">=</span> launchParams != <span class="hljs-literal">null</span> ? launchParams.mWindowingMode
                : WindowConfiguration.WINDOWING_MODE_UNDEFINED;
        <span class="hljs-keyword">if</span> (rootTask != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">//获取rootTask对应的taskDisplayArea</span>
            taskDisplayArea = rootTask.getDisplayArea();
            <span class="hljs-comment">//此时taskDisplayArea不为null</span>
            <span class="hljs-comment">//canLaunchOnDisplay中传递的r（ActivityRecord）和DisplayContent的DisplayId</span>
            <span class="hljs-comment">//其中ActivityRecord为空，从canLaunchOnDisplay方法流程中可以得知该情况返回为true</span>
            <span class="hljs-keyword">if</span> (taskDisplayArea != <span class="hljs-literal">null</span>
                    &amp;&amp; canLaunchOnDisplay(r, taskDisplayArea.mDisplayContent.mDisplayId)) {
                <span class="hljs-comment">//此时windowingMode为WINDOWING_MODE_UNDEFINED</span>
                <span class="hljs-keyword">if</span> (windowingMode == WindowConfiguration.WINDOWING_MODE_UNDEFINED) {
                    <span class="hljs-comment">//该方法通过options.getLaunchWindowingMode()获取了自由窗口的windowingMode，其值为WINDOWING_MODE_FREEFORM</span>
                    windowingMode = taskDisplayArea.resolveWindowingMode(r, options, candidateTask);
                }
                <span class="hljs-comment">// Always allow organized tasks that created by organizer since the activity type</span>
                <span class="hljs-comment">// of an organized task is decided by the activity type of its top child, which</span>
                <span class="hljs-comment">// could be incompatible with the given windowing mode and activity type.</span>
                <span class="hljs-comment">//rootTask.isCompatible(windowingMode, activityType)，判断当前应用的windowingMode和activityType</span>
                <span class="hljs-comment">//和新设置的windowingMode和activityType是否一致，一致则返回true，不一致则返回false</span>
                <span class="hljs-comment">//简单来说这个方法就是判断windowingMode和activityType是否需要更新，如果需要更新就继续后面的流程。</span>
                <span class="hljs-comment">//rootTask.mCreatedByOrganizer从代码上看涉及TaskFragment才会有true的情况</span>
                <span class="hljs-keyword">if</span> (rootTask.isCompatible(windowingMode, activityType)
                        || rootTask.mCreatedByOrganizer) {
                    <span class="hljs-comment">//直接返回当前rootTask</span>
                    <span class="hljs-keyword">return</span> rootTask;
                }
            } <span class="hljs-keyword">else</span> {
                taskDisplayArea = <span class="hljs-literal">null</span>;
            }

        }

        <span class="hljs-comment">// Falling back to default task container</span>
        <span class="hljs-comment">//taskDisplayArea为空时，直接获取默认的taskDisplayArea</span>
        <span class="hljs-keyword">if</span> (taskDisplayArea == <span class="hljs-literal">null</span>) {
            taskDisplayArea = getDefaultTaskDisplayArea();
        }
        <span class="hljs-comment">//在taskDisplayArea中调用getOrCreateRootTask</span>
        <span class="hljs-keyword">return</span> taskDisplayArea.getOrCreateRootTask(r, options, candidateTask, sourceTask,
                launchParams, launchFlags, activityType, onTop);
    }
</code></pre>
<p>本次启动自由窗口时，<code>rootTask = candidateTask.getRootTask();</code>不为null，因此进入到<code>rootTask != null</code>的流程。
这里com.android.messaging进入自由窗口为例，使用dump命令<code>adb shell dumpsys activity containers</code>。
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8d8573140ff04da0b3fc3cab074d401d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeWnor7rljYPph5E=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764064301&amp;x-signature=hv%2FHvj9tcFTviO9NxDlmhvukHdE%3D" alt="在这里插入图片描述" loading="lazy"/>
从dump中可以看到com.android.messaging的task为1226，在其之上没有别的task，因此rootTask实际上就是candidateTask它本身。</p>
<p>在<code>rootTask.isCompatible(windowingMode, activityType) || rootTask.mCreatedByOrganizer</code>条件中，返回的是false，因此不会直接返回<code>rootTask</code>。
这里我们主要先讲解下<code>rootTask.isCompatible(windowingMode, activityType)</code>
代码路径：frameworks/base/services/core/java/com/android/server/wm/Task.java</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCompatible</span><span class="hljs-params">(<span class="hljs-type">int</span> windowingMode, <span class="hljs-type">int</span> activityType)</span> {
        <span class="hljs-comment">// <span class="hljs-doctag">TODO:</span> Should we just move this to ConfigurationContainer?</span>
        <span class="hljs-keyword">if</span> (activityType == ACTIVITY_TYPE_UNDEFINED) {
            <span class="hljs-comment">// Undefined activity types end up in a standard root task once the root task is</span>
            <span class="hljs-comment">// created on a display, so they should be considered compatible.</span>
            activityType = ACTIVITY_TYPE_STANDARD;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.isCompatible(windowingMode, activityType);
    }
</code></pre>
<p>判断activityType类型是否是<code>ACTIVITY_TYPE_UNDEFINED</code>，如果是则改为<code>ACTIVITY_TYPE_STANDARD</code>，之后调用其父类ConfigurationContainer.isCompatible方法
代码路径：frameworks/base/services/core/java/com/android/server/wm/ConfigurationContainer.java</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * Returns true if this container is compatible with the input windowing mode and activity type.
     * The container is compatible:
     * - If {<span class="hljs-doctag">@param</span> activityType} and {<span class="hljs-doctag">@param</span> windowingMode} match this container activity type and
     * windowing mode.
     * - If {<span class="hljs-doctag">@param</span> activityType} is {<span class="hljs-doctag">@link</span> WindowConfiguration#ACTIVITY_TYPE_UNDEFINED} or
     * {<span class="hljs-doctag">@link</span> WindowConfiguration#ACTIVITY_TYPE_STANDARD} and this containers activity type is also
     * standard or undefined and its windowing mode matches {<span class="hljs-doctag">@param</span> windowingMode}.
     * - If {<span class="hljs-doctag">@param</span> activityType} isn't {<span class="hljs-doctag">@link</span> WindowConfiguration#ACTIVITY_TYPE_UNDEFINED} or
     * {<span class="hljs-doctag">@link</span> WindowConfiguration#ACTIVITY_TYPE_STANDARD} or this containers activity type isn't
     * also standard or undefined and its activity type matches {<span class="hljs-doctag">@param</span> activityType} regardless of
     * if {<span class="hljs-doctag">@param</span> windowingMode} matches the containers windowing mode.
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isCompatible</span><span class="hljs-params">(<span class="hljs-type">int</span> windowingMode, <span class="hljs-type">int</span> activityType)</span> {
        <span class="hljs-comment">//获取当前activityType和windowingMode</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">thisActivityType</span> <span class="hljs-operator">=</span> getActivityType();
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">thisWindowingMode</span> <span class="hljs-operator">=</span> getWindowingMode();
        <span class="hljs-comment">//比较当前activityType和windowingMode和传递过来的activityType和windowingMode</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">sameActivityType</span> <span class="hljs-operator">=</span> thisActivityType == activityType;
        <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">sameWindowingMode</span> <span class="hljs-operator">=</span> thisWindowingMode == windowingMode;
        
        <span class="hljs-comment">//activityType和windowingMode均未发生变化</span>
        <span class="hljs-keyword">if</span> (sameActivityType &amp;&amp; sameWindowingMode) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }

        <span class="hljs-comment">//activityType发生了变化</span>
        <span class="hljs-keyword">if</span> ((activityType != ACTIVITY_TYPE_UNDEFINED &amp;&amp; activityType != ACTIVITY_TYPE_STANDARD)
                || !isActivityTypeStandardOrUndefined()) {
            <span class="hljs-comment">// Only activity type need to match for non-standard activity types that are defined.</span>
            <span class="hljs-keyword">return</span> sameActivityType;
        }

        <span class="hljs-comment">// Otherwise we are compatible if the windowing mode is the same.</span>
        <span class="hljs-comment">//windowingMode发生了变化</span>
        <span class="hljs-keyword">return</span> sameWindowingMode;
    }
</code></pre>
<p>通过getActivityType()和getWindowingMode()分别获取了当前activityType和windowingMode，然后进行变化，如果两者之一出现变化则返回false。</p>
<p>因此我们这里没有直接返回rootTask，而是调用到了taskDisplayArea.getOrCreateRootTask。</p>
<pre><code class="hljs language-java" lang="java">        <span class="hljs-keyword">return</span> taskDisplayArea.getOrCreateRootTask(r, options, candidateTask, sourceTask,
                launchParams, launchFlags, activityType, onTop);
</code></pre>
<p>这里先回顾说明下传递的参数：
<code>r</code>：ActivityRecord类型，其值由RootWindowContainer.anyTaskForId中传递过来，值为<code>null</code>。</p>
<p><code>options</code>：ActivityOptions类型，其值从最初桌面侧FreeformSystemShortcut.startActivity调用startActivityFromRecents传递过来，包含来设置 <strong>窗口模式(<code>mLaunchWindowingMode</code>)</strong> 和 <strong>窗口大小(<code>mLaunchBounds</code>)</strong> 参数。</p>
<p><code>candidateTask</code>：Task类型，其值由RootWindowContainer.anyTaskForId中传递过来，值为<code>桌面侧传递过来taskId对应的Task</code>。</p>
<p><code>sourceTask</code>：Task类型，其值由RootWindowContainer.getOrCreateRootTask传递，值为<code>null</code>。</p>
<p><code>activityType</code>：其值由RootWindowContainer.getOrCreateRootTask获取并传递，值为<code>ACTIVITY_TYPE_STANDARD</code>即<code>1</code>。</p>
<p><code>launchParams</code>：LaunchParamsController.LaunchParams类型，其值由RootWindowContainer.getOrCreateRootTask传递，值为<code>null</code>。</p>
<p><code>launchFlags</code>：int类型，其值由RootWindowContainer.getOrCreateRootTask传递，值为<code>0</code>。</p>
<p><code>onTop</code>：boolean类型，其值由ActivityTaskSupervisor.startActivityFromRecents的anyTaskForId中传递过来，值为
<code>ActivityTaskSupervisor.ON_TOP</code>即<code>true</code>。</p>
<h4 data-id="heading-4">TaskDisplayArea.getOrCreateRootTask</h4>
<p>代码路径：frameworks/base/services/core/java/com/android/server/wm/TaskDisplayArea.java</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * Returns an existing root task compatible with the input params or creates one
     * if a compatible root task doesn't exist.
     *
     * <span class="hljs-doctag">@see</span> #getOrCreateRootTask(int, int, boolean)
     */</span>
    Task <span class="hljs-title function_">getOrCreateRootTask</span><span class="hljs-params">(<span class="hljs-meta">@Nullable</span> ActivityRecord r, <span class="hljs-meta">@Nullable</span> ActivityOptions options,
            <span class="hljs-meta">@Nullable</span> Task candidateTask, <span class="hljs-meta">@Nullable</span> Task sourceTask,
            <span class="hljs-meta">@Nullable</span> LaunchParams launchParams, <span class="hljs-type">int</span> launchFlags, <span class="hljs-type">int</span> activityType, <span class="hljs-type">boolean</span> onTop)</span> {
        <span class="hljs-comment">//设置windowingMode初始值为WINDOWING_MODE_UNDEFINED</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">windowingMode</span> <span class="hljs-operator">=</span> WINDOWING_MODE_UNDEFINED;
        <span class="hljs-keyword">if</span> (launchParams != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// If launchParams isn't null, windowing mode is already resolved.</span>
            windowingMode = launchParams.mWindowingMode;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (options != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// If launchParams is null and options isn't let's use the windowing mode in the</span>
            <span class="hljs-comment">// options.</span>
            <span class="hljs-comment">//这里options不为空，options.getLaunchWindowingMode()值为WINDOWING_MODE_FREEFORM</span>
            windowingMode = options.getLaunchWindowingMode();
        }
        <span class="hljs-comment">// Validate that our desired windowingMode will work under the current conditions.</span>
        <span class="hljs-comment">// UNDEFINED windowing mode is a valid result and means that the new root task will inherit</span>
        <span class="hljs-comment">// it's display's windowing mode.</span>
        <span class="hljs-comment">//判断windowingMode有效性，并赋值</span>
        windowingMode = validateWindowingMode(windowingMode, r, candidateTask);
        <span class="hljs-comment">//继续传递参数</span>
        <span class="hljs-keyword">return</span> getOrCreateRootTask(windowingMode, activityType, onTop, candidateTask, sourceTask,
                options, launchFlags);
    }
</code></pre>
<p>这里主要就是通过<code>options.getLaunchWindowingMode()</code>获取了<code>windowingMode (WINDOWING_MODE_FREEFORM)</code>，在将其传递到getOrCreateRootTask方法中。</p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * When two level tasks are required for given windowing mode and activity type, returns an
     * existing compatible root task or creates a new one.
     * For one level task, the candidate task would be reused to also be the root task or create
     * a new root task if no candidate task.
     *
     * <span class="hljs-doctag">@param</span> windowingMode The windowing mode the root task should be created in.
     * <span class="hljs-doctag">@param</span> activityType  The activityType the root task should be created in.
     * <span class="hljs-doctag">@param</span> onTop         If true the root task will be created at the top of the display,
     *                      else at the bottom.
     * <span class="hljs-doctag">@param</span> candidateTask The possible task the activity might be launched in. Can be null.
     * <span class="hljs-doctag">@param</span> sourceTask    The task requesting to start activity. Used to determine which of the
     *                      adjacent roots should be launch root of the new task. Can be null.
     * <span class="hljs-doctag">@param</span> options       The activity options used to the launch. Can be null.
     * <span class="hljs-doctag">@param</span> launchFlags   The launch flags for this launch.
     * <span class="hljs-doctag">@return</span> The root task to use for the launch.
     * <span class="hljs-doctag">@see</span> #getRootTask(int, int)
     */</span>
    Task <span class="hljs-title function_">getOrCreateRootTask</span><span class="hljs-params">(<span class="hljs-type">int</span> windowingMode, <span class="hljs-type">int</span> activityType, <span class="hljs-type">boolean</span> onTop,
            <span class="hljs-meta">@Nullable</span> Task candidateTask, <span class="hljs-meta">@Nullable</span> Task sourceTask,
            <span class="hljs-meta">@Nullable</span> ActivityOptions options, <span class="hljs-type">int</span> launchFlags)</span> {
        <span class="hljs-comment">//我们这里windowingMode传递的是WINDOWING_MODE_FREEFORM，</span>
        <span class="hljs-comment">//因此resolvedWindowingMode为WINDOWING_MODE_FREEFORM</span>
        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">resolvedWindowingMode</span> <span class="hljs-operator">=</span>
                windowingMode == WINDOWING_MODE_UNDEFINED ? getWindowingMode() : windowingMode;
        <span class="hljs-comment">// Need to pass in a determined windowing mode to see if a new root task should be created,</span>
        <span class="hljs-comment">// so use its parent's windowing mode if it is undefined.</span>
        <span class="hljs-comment">//我们这里resolvedWindowingMode是WINDOWING_MODE_FREEFORM</span>
        <span class="hljs-comment">//activityType是ACTIVITY_TYPE_STANDARD，因此alwaysCreateRootTask为true</span>
        <span class="hljs-comment">//这取反为false，因此不进入该逻辑</span>
        <span class="hljs-keyword">if</span> (!alwaysCreateRootTask(resolvedWindowingMode, activityType)) {
            <span class="hljs-type">Task</span> <span class="hljs-variable">rootTask</span> <span class="hljs-operator">=</span> getRootTask(resolvedWindowingMode, activityType);
            <span class="hljs-keyword">if</span> (rootTask != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> rootTask;
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (candidateTask != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> onTop ? POSITION_TOP : POSITION_BOTTOM;
            <span class="hljs-comment">//这里getLaunchRootTask是同options获取，我们这里options没有设置过mLaunchRootTask，因此为null</span>
            <span class="hljs-keyword">final</span> <span class="hljs-type">Task</span> <span class="hljs-variable">launchParentTask</span> <span class="hljs-operator">=</span> getLaunchRootTask(resolvedWindowingMode, activityType,
                    options, sourceTask, launchFlags, candidateTask);
            <span class="hljs-comment">//launchParentTask为null不进入该流程</span>
            <span class="hljs-keyword">if</span> (launchParentTask != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">if</span> (candidateTask.getParent() == <span class="hljs-literal">null</span>) {
                    launchParentTask.addChild(candidateTask, position);
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (candidateTask.getParent() != launchParentTask) {
                    candidateTask.reparent(launchParentTask, position);
                }
            <span class="hljs-comment">//candidateTask.getDisplayArea()和this都是默认的TaskDisplayArea，即DefaultTaskDisplayArea</span>
            <span class="hljs-comment">//两者相同，即candidateTask.getDisplayArea() != this 为false，因此不进入该流程</span>
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (candidateTask.getDisplayArea() != <span class="hljs-built_in">this</span> 
                    || candidateTask.getRootTask().mReparentLeafTaskIfRelaunch) {
                <span class="hljs-keyword">if</span> (candidateTask.getParent() == <span class="hljs-literal">null</span>) {
                    addChild(candidateTask, position);
                } <span class="hljs-keyword">else</span> {
                    candidateTask.reparent(<span class="hljs-built_in">this</span>, onTop);
                }
            }
            <span class="hljs-comment">// Update windowing mode if necessary, e.g. launch into a different windowing mode.</span>
            <span class="hljs-comment">//windowingMode传递的是WINDOWING_MODE_FREEFORM</span>
            <span class="hljs-comment">//candidateTask自身就是rootTask</span>
            <span class="hljs-comment">//candidateTask前后windowingMode有发生变化</span>
            <span class="hljs-keyword">if</span> (windowingMode != WINDOWING_MODE_UNDEFINED &amp;&amp; candidateTask.isRootTask()
                    &amp;&amp; candidateTask.getWindowingMode() != windowingMode) {
                <span class="hljs-comment">//ShellTransitions调用collect处理</span>
                candidateTask.mTransitionController.collect(candidateTask);
                <span class="hljs-comment">//设置task窗口模式</span>
                candidateTask.setWindowingMode(windowingMode);
            }
            <span class="hljs-comment">//返回candidateTask的rootTask</span>
            <span class="hljs-keyword">return</span> candidateTask.getRootTask();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Task</span>.Builder(mAtmService)
                .setWindowingMode(windowingMode)
                .setActivityType(activityType)
                .setOnTop(onTop)
                .setParent(<span class="hljs-built_in">this</span>)
                .setSourceTask(sourceTask)
                .setActivityOptions(options)
                .setLaunchFlags(launchFlags)
                .build();
    }
</code></pre>
<p>这里我们重点看这一段</p>
<pre><code class="hljs language-java" lang="java">            <span class="hljs-keyword">if</span> (windowingMode != WINDOWING_MODE_UNDEFINED &amp;&amp; candidateTask.isRootTask()
                    &amp;&amp; candidateTask.getWindowingMode() != windowingMode) {
                candidateTask.mTransitionController.collect(candidateTask);
                candidateTask.setWindowingMode(windowingMode);
            }
            <span class="hljs-keyword">return</span> candidateTask.getRootTask();
</code></pre>
<p>先解析下这个条件</p>
<ul>
<li>
<p><code>windowingMode != WINDOWING_MODE_UNDEFINED</code>
windowingMode传递的是WINDOWING_MODE_FREEFORM，因此该条件为true。</p>
</li>
<li>
<p><code>candidateTask.isRootTask()</code>
判断candidateTask是否是rootTask，关于这点前面有讲到，当前candidateTask就是rootTask，因此该条件为true。</p>
</li>
<li>
<p><code>candidateTask.getWindowingMode() != windowingMode)</code>
获取当前candidateTask的windowingMode，判断该windowingMode和传递过来的windowingMode是否一致，我们这里还没有启动到自由窗口，因此candidateTask.getWindowingMode()不是WINDOWING_MODE_FREEFORM，所以不一致，即该条件为true。</p>
</li>
</ul>
<p>综上，所有条件都满足，所有进入该条件。
其中<code>candidateTask.mTransitionController.collect(candidateTask);</code>涉及ShellTransitions，这里不涉及，暂不讲解。</p>
<p>最终通过<code>candidateTask.setWindowingMode(windowingMode)</code>方法给candidateTask的windowingMode设置成了WINDOWING_MODE_FREEFORM。</p>
<h4 data-id="heading-5">总结</h4>
<p>从<code>mRootWindowContainer.anyTaskForId</code>开始到<code>TaskDisplayArea.getOrCreateRootTask</code>结束，简单概括为一句话就是<strong>通过taskId获取对应task并设置该task的windowingMode为WINDOWING_MODE_FREEFORM（自由窗口）</strong>。</p>
<h3 data-id="heading-6">启动Task中对应Activity并将其移至最前台</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">return</span> mService.getActivityStartController().startActivityInPackage(taskCallingUid,
        callingPid, callingUid, callingPackage, callingFeatureId, intent, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
        <span class="hljs-literal">null</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, options, userId, task, <span class="hljs-string">"startActivityFromRecents"</span>,
        <span class="hljs-literal">false</span> <span class="hljs-comment">/* validateIncomingUser */</span>, <span class="hljs-literal">null</span> <span class="hljs-comment">/* originatingPendingIntent */</span>,
        BackgroundStartPrivileges.NONE);
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[订单超时自动取消：从业务场景到技术落地的完整设计方案]]></title>    <link>https://juejin.cn/post/7573886599433191475</link>    <guid>https://juejin.cn/post/7573886599433191475</guid>    <pubDate>2025-11-18T09:59:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573886599433191475" data-draft-id="7573899782802522158" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="订单超时自动取消：从业务场景到技术落地的完整设计方案"/> <meta itemprop="keywords" content="后端,分布式"/> <meta itemprop="datePublished" content="2025-11-18T09:59:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="回家路上绕了弯"/> <meta itemprop="url" content="https://juejin.cn/user/536217404587134"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            订单超时自动取消：从业务场景到技术落地的完整设计方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/536217404587134/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    回家路上绕了弯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T09:59:50.000Z" title="Tue Nov 18 2025 09:59:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">订单超时自动取消：从业务场景到技术落地的完整设计方案</h2>
<p>在电商、外卖、票务等业务中，“订单超时自动取消” 是保障资源高效利用的核心功能 —— 比如用户下单后 30 分钟未支付，若不自动取消，会导致商品库存被长期占用，其他用户无法购买；外卖订单 15 分钟未接单，若不取消，会让用户长时间等待。但当订单量达百万级、超时场景多样时，简单的 “定时遍历数据库” 会彻底失效，需设计一套适配高并发、保证数据一致性的方案。</p>
<p>本文从 “业务场景→核心需求→技术方案→工程落地” 四层，完整讲解订单超时自动取消的设计思路，覆盖不同业务规模的选型与避坑点。</p>
<h3 data-id="heading-1">一、先明确：哪些订单需要 “超时自动取消”？</h3>
<p>不同业务场景的超时规则差异极大，设计前需先分类梳理，避免 “一刀切” 的方案无法适配实际需求：</p>









































<table><thead><tr><th>订单类型</th><th>超时场景</th><th>超时时间</th><th>核心痛点（不取消的后果）</th></tr></thead><tbody><tr><td>电商普通订单</td><td>下单后未支付</td><td>30 分钟</td><td>库存占用，商品无法卖给其他用户</td></tr><tr><td>电商预售订单</td><td>付定金后未付尾款</td><td>24 小时</td><td>预售库存锁定，影响后续补货计划</td></tr><tr><td>外卖订单</td><td>商家未接单 / 骑手未取餐</td><td>15 分钟 / 30 分钟</td><td>用户长时间等待，投诉率升高</td></tr><tr><td>酒店 / 票务订单</td><td>预订后未支付</td><td>1 小时</td><td>房间 / 座位锁定，错失潜在客户</td></tr><tr><td>售后订单</td><td>退款申请后未上传凭证</td><td>72 小时</td><td>售后流程卡顿，用户体验差</td></tr></tbody></table>
<p><strong>核心共性</strong>：所有超时场景都需解决 “<strong>状态闭环</strong>”（超时后订单从 “待支付 / 待接单” 转为 “已取消”）和 “<strong>资源回补</strong>”（如库存、优惠券、座位释放）两大问题。</p>
<h3 data-id="heading-2">二、核心需求拆解：不止 “自动取消”，还要 “可靠”</h3>
<p>设计方案时，需满足以下功能性与非功能性需求，否则会出现 “取消失败导致资损”“延迟太久引发投诉” 等问题：</p>
<h4 data-id="heading-3">1. 功能性需求</h4>
<ul>
<li><strong>超时时间可配置</strong>：支持不同订单类型设置不同超时时间（如普通订单 30 分钟，预售订单 24 小时），且支持动态修改（如大促期间临时将未支付超时改为 15 分钟）；</li>
</ul>

<ul>
<li><strong>状态校验严格</strong>：取消前必须确认订单仍处于 “待超时状态”（如用户在超时前 1 秒支付了，不能再取消）；</li>
</ul>

<ul>
<li><strong>资源回补完整</strong>：取消后需同步回补关联资源（如释放库存、返还优惠券、解锁座位），且回补必须成功（不能出现 “订单取消了但库存没回来” 的情况）；</li>
</ul>

<ul>
<li><strong>通知触达</strong>：取消后需告知用户（如短信、APP 推送），说明取消原因（“订单超时未支付已自动取消”）。</li>
</ul>
<h4 data-id="heading-4">2. 非功能性需求</h4>
<ul>
<li><strong>数据一致性</strong>：100% 确保 “该取消的订单必须取消，不该取消的绝不取消”，不允许出现 “重复取消”（导致库存多回补）或 “漏取消”（导致库存长期占用）；</li>
</ul>

<ul>
<li><strong>实时性</strong>：超时后需在合理时间内取消（如超时后 1 分钟内），不能延迟太久（用户发现订单还在 “待支付”，但实际已超时，会困惑）；</li>
</ul>

<ul>
<li><strong>高并发支撑</strong>：大促期间订单量达百万级，方案需支撑每秒数百次的取消请求，且不影响核心下单流程；</li>
</ul>

<ul>
<li><strong>可监控可追溯</strong>：需记录每笔订单的 “超时时间、取消时间、取消结果、回补状态”，方便问题排查（如用户反馈 “订单没取消但扣了优惠券”，能快速定位原因）。</li>
</ul>
<h3 data-id="heading-5">三、技术方案对比：3 种主流方案的优劣与选型</h3>
<p>目前行业内实现订单超时自动取消的方案主要有 3 种，需根据业务规模、实时性要求选择适配方案：</p>





































<table><thead><tr><th>方案类型</th><th>核心原理</th><th>实时性</th><th>一致性</th><th>并发支撑</th><th>适用场景</th></tr></thead><tbody><tr><td>分布式定时任务</td><td>定时遍历数据库 / 缓存，筛选超时订单</td><td>中（分钟级）</td><td>高（需加锁）</td><td>中（百万级订单）</td><td>电商大促、库存占用敏感场景</td></tr><tr><td>延迟队列</td><td>订单创建时发送延迟消息，超时后消费</td><td>高（秒级）</td><td>高（消息可靠）</td><td>高（千万级订单）</td><td>外卖、票务等实时性要求高的场景</td></tr><tr><td>Redis 过期回调</td><td>订单 ID 作为 Redis Key，过期后触发回调</td><td>低（秒 - 分钟级，依赖 Redis 过期策略）</td><td>中（可能漏回调）</td><td>低（十万级订单）</td><td>中小业务、实时性要求不高的场景</td></tr></tbody></table>
<h4 data-id="heading-6">方案 1：分布式定时任务（适合海量订单，一致性优先）</h4>
<h5 data-id="heading-7">1. 原理</h5>
<ul>
<li>订单创建时，记录 “订单创建时间” 和 “超时时间”（如create_time=1688888888，timeout=1800秒）；</li>
</ul>

<ul>
<li>用分布式定时任务框架（如 XXL-Job、Elastic-Job）按固定频率（如每分钟）执行任务，筛选出 “当前时间 - create_time ≥ timeout” 且状态为 “待支付” 的订单；</li>
</ul>

<ul>
<li>对筛选出的订单执行取消逻辑（状态修改 + 资源回补）。</li>
</ul>
<h5 data-id="heading-8">2. 关键实现细节</h5>
<ul>
<li><strong>筛选优化</strong>：避免全表扫描，在create_time和order_status上建立联合索引（如idx_create_status (order_status, create_time)），查询 SQL 示例：</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> order_id <span class="hljs-keyword">FROM</span> orders 
<span class="hljs-keyword">WHERE</span> order_status <span class="hljs-operator">=</span> <span class="hljs-string">'PENDING_PAY'</span>  <span class="hljs-comment">-- 待支付状态</span>
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">+</span> timeout <span class="hljs-operator">&lt;=</span> UNIX_TIMESTAMP(NOW())  <span class="hljs-comment">-- 已超时</span>
LIMIT <span class="hljs-number">1000</span>;  <span class="hljs-comment">-- 分批处理，避免一次处理太多订单</span>
</code></pre>
<ul>
<li><strong>并发控制</strong>：用分布式锁（如 Redis 锁）防止同一订单被多个定时任务实例重复处理，锁 Key 为order:cancel:lock:{order_id}，持有时间设为 30 秒（足够完成一次取消流程）；</li>
</ul>

<ul>
<li><strong>失败重试</strong>：处理失败的订单（如资源回补失败），加入重试队列（如 Redis List），单独用一个定时任务重试（重试次数 3 次，每次间隔 5 分钟），仍失败则触发人工告警。</li>
</ul>
<h5 data-id="heading-9">3. 优劣势</h5>
<ul>
<li><strong>优势</strong>：不依赖复杂中间件，实现简单；支持海量订单筛选，适合大促场景；</li>
</ul>

<ul>
<li><strong>劣势</strong>：实时性中等（依赖定时频率，最快每分钟执行一次，超时后可能延迟 1 分钟才取消）；定时任务执行时会对数据库造成一定压力（需控制分批大小）。</li>
</ul>
<h5 data-id="heading-10">4. 选型建议</h5>
<p>适合 “订单量百万级 +，实时性要求不极致（允许 1 分钟延迟）” 的场景，如电商普通订单、预售订单。</p>
<h4 data-id="heading-11">方案 2：延迟队列（适合实时性高，中高并发）</h4>
<h5 data-id="heading-12">1. 原理</h5>
<ul>
<li>订单创建时，不直接写入数据库监控，而是向延迟队列发送一条 “延迟消息”，消息内容包含order_id，延迟时间设为订单的超时时间（如 30 分钟）；</li>
</ul>

<ul>
<li>延迟队列在消息达到延迟时间后，将消息投递到 “取消消费队列”；</li>
</ul>

<ul>
<li>消费端监听 “取消消费队列”，收到消息后执行订单取消逻辑。</li>
</ul>
<h5 data-id="heading-13">2. 主流延迟队列实现对比</h5>





























<table><thead><tr><th>中间件</th><th>实现方式</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>RabbitMQ</td><td>基于 “死信队列 + TTL”（消息过期后进入死信队列）</td><td>轻量，易集成，支持消息持久化</td><td>不支持动态修改延迟时间；延迟精度中等（秒级）</td></tr><tr><td>RocketMQ</td><td>原生支持定时消息（延迟级别或自定义时间）</td><td>延迟精度高（毫秒级），支持海量消息</td><td>依赖 RocketMQ，部署成本稍高；自定义延迟时间需配置</td></tr><tr><td>Kafka</td><td>基于 “时间轮 + 主题分区”（如 Kafka Streams）</td><td>高吞吐，适合千万级订单</td><td>实现复杂，需自定义时间轮逻辑；不支持消息重试</td></tr></tbody></table>
<h5 data-id="heading-14">3. 关键实现细节（以 RocketMQ 为例）</h5>
<ul>
<li><strong>消息发送</strong>：订单创建时发送定时消息，指定延迟时间为订单超时时间：</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// RocketMQ发送定时消息示例（Java）</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">sendDelayMsg</span><span class="hljs-params">(<span class="hljs-type">String</span> orderId, <span class="hljs-type">long</span> timeoutSeconds)</span> </span>{
    Message msg = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Message</span>(<span class="hljs-string">"order_timeout_topic"</span>,  <span class="hljs-comment">// 主题</span>
                              <span class="hljs-string">"cancel_tag"</span>,           <span class="hljs-comment">// 标签</span>
                              orderId.<span class="hljs-built_in">getBytes</span>());    <span class="hljs-comment">// 消息体（订单ID）</span>
    <span class="hljs-comment">// 设置定时时间：timeoutSeconds秒后投递（RocketMQ支持自定义毫秒级延迟）</span>
    msg.<span class="hljs-built_in">setDelayTimeMs</span>(timeoutSeconds * <span class="hljs-number">1000</span>);
    <span class="hljs-comment">// 发送消息（开启事务，确保“订单创建成功”和“消息发送成功”原子性）</span>
    rocketMQTemplate.<span class="hljs-built_in">send</span>(msg);
}
</code></pre>
<ul>
<li><strong>事务保障</strong>：用 “本地事务表 + 消息确认” 确保 “订单创建” 和 “延迟消息发送” 的原子性（避免 “订单创建了但消息没发出去，导致漏取消”）：</li>
</ul>
<ol>
<li>
<ol>
<li>订单创建时，先写入 “订单表” 和 “本地事务表”（记录order_id和msg_status=UNSENT）；</li>
</ol>
</li>
</ol>

<ol>
<li>
<ol start="2">
<li>发送延迟消息，若发送成功，更新 “本地事务表”msg_status=SENT；</li>
</ol>
</li>
</ol>

<ol>
<li>
<ol start="3">
<li>启动定时任务，扫描 “本地事务表” 中msg_status=UNSENT的订单，重新发送消息。</li>
</ol>
</li>
</ol>
<ul>
<li><strong>消费逻辑</strong>：消费端收到消息后，先查订单状态，再执行取消：</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RocketMQMessageListener</span>(topic = <span class="hljs-string">"order_timeout_topic"</span>, consumerGroup = <span class="hljs-string">"cancel_consumer_group"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderCancelConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;<span class="hljs-title class_">String</span>&gt; {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">OrderService</span> orderService;
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onMessage</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderId</span>) {
        <span class="hljs-comment">// 1. 查订单当前状态（必须加锁，防止并发支付）</span>
        <span class="hljs-title class_">OrderDO</span> order = orderService.<span class="hljs-title function_">getOrderWithLock</span>(orderId);
        <span class="hljs-keyword">if</span> (order == <span class="hljs-literal">null</span> || !<span class="hljs-string">"PENDING_PAY"</span>.<span class="hljs-title function_">equals</span>(order.<span class="hljs-title function_">getStatus</span>())) {
            <span class="hljs-keyword">return</span>; <span class="hljs-comment">// 订单不存在或已支付，不取消</span>
        }
        
        <span class="hljs-comment">// 2. 执行取消逻辑（状态修改+资源回补）</span>
        <span class="hljs-built_in">boolean</span> cancelSuccess = orderService.<span class="hljs-title function_">cancelOrder</span>(order);
        <span class="hljs-keyword">if</span> (!cancelSuccess) {
            <span class="hljs-comment">// 3. 取消失败，发送重试消息（延迟5分钟后重试）</span>
            <span class="hljs-title function_">sendDelayMsg</span>(orderId, <span class="hljs-number">300</span>);
        }
    }
}
</code></pre>
<h5 data-id="heading-15">4. 优劣势</h5>
<ul>
<li><strong>优势</strong>：实时性高（超时后秒级内取消）；消息持久化，不担心漏取消；支持高并发（RocketMQ 每秒可处理数万条消息）；</li>
</ul>

<ul>
<li><strong>劣势</strong>：依赖中间件（如 RocketMQ），需维护中间件集群；动态修改超时时间较复杂（需先删除旧消息，再发新消息）。</li>
</ul>
<h5 data-id="heading-16">5. 选型建议</h5>
<p>适合 “实时性要求高（如外卖、票务）、订单量中高（十万 - 千万级）” 的场景。</p>
<h4 data-id="heading-17">方案 3：Redis 过期回调（适合中小业务，快速落地）</h4>
<h5 data-id="heading-18">1. 原理</h5>
<ul>
<li>订单创建时，将order_id作为 Redis Key，值为订单状态（如PENDING_PAY），并设置 Key 的过期时间为订单超时时间（如 30 分钟）；</li>
</ul>

<ul>
<li>开启 Redis 的keyspace notifications（键空间通知），当 Key 过期时，Redis 会发送 “Key 过期事件”；</li>
</ul>

<ul>
<li>应用端监听 Redis 过期事件，收到事件后执行订单取消逻辑。</li>
</ul>
<h5 data-id="heading-19">2. 关键实现细节</h5>
<ul>
<li><strong>开启 Redis 通知</strong>：在 Redis 配置文件中开启过期通知（notify-keyspace-events "Ex"），或通过命令临时开启：</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino">config set notify-keyspace-events Ex
</code></pre>
<ul>
<li><strong>监听过期事件</strong>：用 Redis 客户端（如 Redisson）监听事件：</li>
</ul>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// Redisson监听Redis过期事件示例</span>
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">listenRedisExpireEvent</span><span class="hljs-params">()</span> </span>{
    RPatternTopic topic = redissonClient.<span class="hljs-built_in">getPatternTopic</span>(<span class="hljs-string">"__keyevent@0__:expired"</span>);
    topic.<span class="hljs-built_in">addListener</span>(<span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>, (channel, orderId) -&gt; {
        <span class="hljs-comment">// 判断是否为订单超时Key（避免监听无关Key）</span>
        <span class="hljs-keyword">if</span> (orderId.<span class="hljs-built_in">startsWith</span>(<span class="hljs-string">"order:timeout:"</span>)) {
            <span class="hljs-type">String</span> realOrderId = orderId.<span class="hljs-built_in">replace</span>(<span class="hljs-string">"order:timeout:"</span>, <span class="hljs-string">""</span>);
            <span class="hljs-comment">// 执行取消逻辑（同延迟队列消费逻辑）</span>
            orderService.<span class="hljs-built_in">handleTimeoutCancel</span>(realOrderId);
        }
    });
}
</code></pre>
<ul>
<li><strong>规避 Redis 过期延迟</strong>：Redis 的过期删除采用 “惰性删除 + 定期删除” 策略，可能导致 Key 过期后几秒甚至几分钟才触发回调，需在取消逻辑中再次校验订单是否真的超时：</li>
</ul>
<pre><code class="hljs language-ini" lang="ini">public void handleTimeoutCancel(String orderId) {
    OrderDO <span class="hljs-attr">order</span> = orderService.getOrder(orderId)<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">order</span> == null) return<span class="hljs-comment">;</span>
    // 二次校验：当前时间是否真的超过订单超时时间（避免Redis回调延迟导致误判）
    long <span class="hljs-attr">currentTime</span> = System.currentTimeMillis() / <span class="hljs-number">1000</span><span class="hljs-comment">;</span>
    long <span class="hljs-attr">timeoutTime</span> = order.getCreateTime() + order.getTimeoutSeconds()<span class="hljs-comment">;</span>
    if (currentTime &lt; timeoutTime || !"PENDING_PAY".equals(order.getStatus())) {
        return<span class="hljs-comment">;</span>
    }
    // 执行取消逻辑
    orderService.cancelOrder(order)<span class="hljs-comment">;</span>
}
</code></pre>
<h5 data-id="heading-20">3. 优劣势</h5>
<ul>
<li><strong>优势</strong>：实现简单，无需依赖复杂中间件；开发成本低，适合中小团队；</li>
</ul>

<ul>
<li><strong>劣势</strong>：实时性低（依赖 Redis 过期策略，可能延迟几分钟）；Redis 集群环境下，过期事件可能丢失（部分客户端不支持集群监听）；不适合海量订单（Redis 处理过期事件的能力有限）。</li>
</ul>
<h5 data-id="heading-21">4. 选型建议</h5>
<p>适合 “中小业务、订单量十万级以内、实时性要求不高” 的场景（如小型电商、内部订单系统）。</p>
<h3 data-id="heading-22">四、核心业务逻辑：取消流程的 “避坑指南”</h3>
<p>无论选择哪种技术方案，订单取消的核心业务逻辑都需严格遵循 “<strong>校验→取消→回补→通知</strong>” 四步，且每一步都要处理异常，确保数据一致：</p>
<h4 data-id="heading-23">1. 第一步：订单状态严格校验（防误取消）</h4>
<p>取消前必须用 “<strong>排他锁</strong>” 锁定订单，防止用户在取消过程中支付（如用户超时前 1 秒支付，同时系统在执行取消）：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">// 用数据库行锁锁定订单（<span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FOR</span> UPDATE）
@Transactional
<span class="hljs-keyword">public</span> OrderDO getOrderWithLock(<span class="hljs-type">String</span> orderId) {
    <span class="hljs-keyword">return</span> orderMapper.selectByOrderIdForUpdate(orderId);
}
// 校验逻辑
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> checkCanCancel(OrderDO <span class="hljs-keyword">order</span>) {
    // <span class="hljs-number">1</span>. 订单状态必须是“待支付/待接单”等可取消状态
    <span class="hljs-keyword">if</span> (!Arrays.asList(<span class="hljs-string">"PENDING_PAY"</span>, <span class="hljs-string">"PENDING_ACCEPT"</span>).contains(<span class="hljs-keyword">order</span>.getStatus())) {
        log.info(<span class="hljs-string">"订单{}状态为{}，不可取消"</span>, <span class="hljs-keyword">order</span>.getOrderId(), <span class="hljs-keyword">order</span>.getStatus());
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    // <span class="hljs-number">2</span>. 订单确实已超时（二次校验，避免定时任务/Redis回调延迟）
    <span class="hljs-type">long</span> currentTime = System.currentTimeMillis() / <span class="hljs-number">1000</span>;
    <span class="hljs-type">long</span> timeoutTime = <span class="hljs-keyword">order</span>.getCreateTime() + <span class="hljs-keyword">order</span>.getTimeoutSeconds();
    <span class="hljs-keyword">if</span> (currentTime &lt; timeoutTime) {
        log.info(<span class="hljs-string">"订单{}未超时（当前时间{}，超时时间{}），不可取消"</span>, 
                 <span class="hljs-keyword">order</span>.getOrderId(), currentTime, timeoutTime);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h4 data-id="heading-24">2. 第二步：订单状态修改（原子性）</h4>
<p>修改订单状态必须在事务中执行，确保 “状态修改” 与 “资源回补” 要么同时成功，要么同时失败：</p>
<pre><code class="hljs language-php" lang="php">@Transactional
<span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title function_ invoke__">cancelOrder</span>(OrderDO order) {
    <span class="hljs-comment">// 1. 再次校验（防止事务等待期间状态变化）</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">checkCanCancel</span>(order)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    
    <span class="hljs-comment">// 2. 修改订单状态为“已取消”</span>
    <span class="hljs-keyword">int</span> updateCount = orderMapper.<span class="hljs-title function_ invoke__">updateStatus</span>(order.<span class="hljs-title function_ invoke__">getOrderId</span>(), <span class="hljs-string">"CANCELED"</span>, <span class="hljs-string">"TIMEOUT"</span>);
    <span class="hljs-keyword">if</span> (updateCount != <span class="hljs-number">1</span>) {
        log.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">"订单{}修改状态失败，影响行数{}"</span>, order.<span class="hljs-title function_ invoke__">getOrderId</span>(), updateCount);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"订单状态修改失败"</span>); <span class="hljs-comment">// 触发事务回滚</span>
    }
    
    <span class="hljs-comment">// 3. 回补关联资源（库存、优惠券、座位等）</span>
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// 回补库存</span>
        inventoryService.<span class="hljs-title function_ invoke__">releaseInventory</span>(order.<span class="hljs-title function_ invoke__">getSkuId</span>(), order.<span class="hljs-title function_ invoke__">getQuantity</span>());
        <span class="hljs-comment">// 回补优惠券（如果下单时锁定了优惠券）</span>
        <span class="hljs-keyword">if</span> (order.<span class="hljs-title function_ invoke__">getCouponId</span>() != <span class="hljs-literal">null</span>) {
            couponService.<span class="hljs-title function_ invoke__">unlockCoupon</span>(order.<span class="hljs-title function_ invoke__">getUserId</span>(), order.<span class="hljs-title function_ invoke__">getCouponId</span>());
        }
        <span class="hljs-comment">// 回补座位/房间（票务/酒店订单）</span>
        <span class="hljs-keyword">if</span> (order.<span class="hljs-title function_ invoke__">getOrderType</span>().<span class="hljs-title function_ invoke__">equals</span>(<span class="hljs-string">"TICKET"</span>)) {
            ticketService.<span class="hljs-title function_ invoke__">unlockSeat</span>(order.<span class="hljs-title function_ invoke__">getSeatId</span>());
        }
    } <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> e) {
        log.<span class="hljs-title function_ invoke__">error</span>(<span class="hljs-string">"订单{}资源回补失败"</span>, order.<span class="hljs-title function_ invoke__">getOrderId</span>(), e);
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">RuntimeException</span>(<span class="hljs-string">"资源回补失败"</span>); <span class="hljs-comment">// 触发事务回滚，订单状态恢复为待支付</span>
    }
    
    <span class="hljs-comment">// 4. 记录取消日志（用于问题排查）</span>
    orderLogService.<span class="hljs-title function_ invoke__">recordLog</span>(order.<span class="hljs-title function_ invoke__">getOrderId</span>(), <span class="hljs-string">"ORDER_CANCELED"</span>, <span class="hljs-string">"订单超时自动取消"</span>);
    
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<h4 data-id="heading-25">3. 第三步：用户通知（提升体验）</h4>
<p>取消后需通过多渠道通知用户，说明原因和后续操作（如 “订单已取消，库存已释放，可重新下单”）：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">sendCancelNotice</span>(OrderDO order) {
    <span class="hljs-comment">// 1. 短信通知（核心渠道，确保用户能收到）</span>
    <span class="hljs-selector-tag">smsService</span><span class="hljs-selector-class">.send</span>(order.<span class="hljs-built_in">getPhone</span>(), String.<span class="hljs-built_in">format</span>(
        <span class="hljs-string">"【XX平台】您的订单%s因超时未支付已自动取消，库存已释放，可重新下单。"</span>, 
        order.<span class="hljs-built_in">getOrderId</span>()
    ));
    
    <span class="hljs-comment">// 2. APP推送（针对已安装APP的用户）</span>
    <span class="hljs-selector-tag">pushService</span><span class="hljs-selector-class">.send</span>(order.<span class="hljs-built_in">getUserId</span>(), <span class="hljs-string">"订单取消通知"</span>, 
        String.<span class="hljs-built_in">format</span>(<span class="hljs-string">"订单%s已自动取消，原因：超时未支付"</span>, order.<span class="hljs-built_in">getOrderId</span>()));
    
    <span class="hljs-comment">// 3. 站内信（补充渠道）</span>
    <span class="hljs-selector-tag">messageService</span><span class="hljs-selector-class">.sendInboxMsg</span>(order.<span class="hljs-built_in">getUserId</span>(), <span class="hljs-string">"订单取消"</span>, 
        String.<span class="hljs-built_in">format</span>(<span class="hljs-string">"订单%s于%s因超时未支付自动取消，如有疑问请联系客服。"</span>, 
        order.<span class="hljs-built_in">getOrderId</span>(), new <span class="hljs-built_in">SimpleDateFormat</span>(<span class="hljs-string">"yyyy-MM-dd HH:mm:ss"</span>).<span class="hljs-built_in">format</span>(new <span class="hljs-built_in">Date</span>())));
}
</code></pre>
<h3 data-id="heading-26">五、工程落地：监控与运维不可少</h3>
<p>即使方案设计完善，也需配套监控与运维措施，避免 “问题发生后才发现”：</p>
<h4 data-id="heading-27">1. 核心监控指标</h4>









































<table><thead><tr><th>指标名称</th><th>监控频率</th><th>阈值建议</th><th>告警方式</th></tr></thead><tbody><tr><td>超时订单总量</td><td>1 分钟</td><td>无（需观察趋势）</td><td>无（用于业务分析）</td></tr><tr><td>取消成功率</td><td>1 分钟</td><td>&lt;99.9%</td><td>短信 + 钉钉告警</td></tr><tr><td>取消延迟时间</td><td>1 分钟</td><td>&gt;3 分钟（超时后到取消的时间）</td><td>短信告警</td></tr><tr><td>资源回补失败率</td><td>1 分钟</td><td>&gt;0.1%</td><td>电话 + 短信告警</td></tr><tr><td>定时任务 / 延迟队列堆积数</td><td>10 秒</td><td>&gt;1000 条</td><td>钉钉 + 邮件告警</td></tr></tbody></table>
<h4 data-id="heading-28">2. 日志与追溯</h4>
<ul>
<li>每笔订单的取消流程需记录完整日志，包含 “订单 ID、触发方式（定时任务 / 延迟队列）、开始时间、结束时间、状态、回补资源列表、失败原因（如有）”；</li>
</ul>

<ul>
<li>用 ELK（Elasticsearch+Logstash+Kibana）存储和查询日志，支持按 “订单 ID、时间范围、失败原因” 检索，方便快速排查问题（如用户反馈 “订单没取消”，输入订单 ID 即可查看取消日志）。</li>
</ul>
<h4 data-id="heading-29">3. 应急方案</h4>
<ul>
<li><strong>取消失败应急</strong>：针对 “取消失败且重试多次仍失败” 的订单，触发人工介入流程（如发送工单给运营，手动取消并回补资源）；</li>
</ul>

<ul>
<li><strong>中间件故障应急</strong>：若延迟队列 / Redis 故障，临时切换为 “分布式定时任务” 方案，确保取消功能不中断；</li>
</ul>

<ul>
<li><strong>大促峰值应急</strong>：大促期间提前扩容定时任务 / 延迟队列的节点，避免因并发过高导致堆积。</li>
</ul>
<h3 data-id="heading-30">六、方案选型速查表</h3>





























<table><thead><tr><th>业务规模</th><th>实时性要求</th><th>推荐方案</th><th>关键注意点</th></tr></thead><tbody><tr><td>中小业务（&lt;10 万单 / 天）</td><td>低（允许 5 分钟延迟）</td><td>Redis 过期回调</td><td>开启 Redis 通知，二次校验超时时间</td></tr><tr><td>中业务（10 万 - 100 万单 / 天）</td><td>中（允许 1 分钟延迟）</td><td>分布式定时任务（XXL-Job）</td><td>分批处理，加分布式锁防重复取消</td></tr><tr><td>大业务（&gt;100 万单 / 天）</td><td>高（秒级）</td><td>延迟队列（RocketMQ）</td><td>消息持久化，事务保障订单与消息一致性</td></tr></tbody></table>
<h3 data-id="heading-31">总结</h3>
<p>订单超时自动取消功能的设计，核心不是 “选哪种技术方案”，而是 “<strong>确保一致性与可靠性</strong>”—— 无论用定时任务、延迟队列还是 Redis，都需做到：</p>
<ol>
<li>取消前严格校验订单状态，防误判；</li>
</ol>

<ol start="2">
<li>取消中用事务保障 “状态修改 + 资源回补” 原子性，防资损；</li>
</ol>

<ol start="3">
<li>取消后完善监控与日志，防问题不可追溯。</li>
</ol>
<p>最终，方案需适配自身业务规模与实时性要求：中小业务用 Redis 快速落地，中大规模用定时任务或延迟队列保障可靠，核心是 “不追求最复杂的技术，只选最适合的方案”。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一张图 + 五条时间线，彻底拆透 StarRocks 主键表 UPSERT 链路]]></title>    <link>https://juejin.cn/post/7573708620870926388</link>    <guid>https://juejin.cn/post/7573708620870926388</guid>    <pubDate>2025-11-18T10:02:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573708620870926388" data-draft-id="7573864324713431092" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一张图 + 五条时间线，彻底拆透 StarRocks 主键表 UPSERT 链路"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-11-18T10:02:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="shengjk1"/> <meta itemprop="url" content="https://juejin.cn/user/2647279732524957"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一张图 + 五条时间线，彻底拆透 StarRocks 主键表 UPSERT 链路
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279732524957/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    shengjk1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T10:02:41.000Z" title="Tue Nov 18 2025 10:02:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="gruvbox-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#282828}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#ebdbb2}.hljs-deletion,.hljs-formula,.hljs-keyword,.hljs-link,.hljs-selector-tag{color:#fb4934}.hljs-built_in,.hljs-emphasis,.hljs-name,.hljs-quote,.hljs-strong,.hljs-title,.hljs-variable{color:#83a598}.hljs-attr,.hljs-params,.hljs-template-tag,.hljs-type{color:#fabd2f}.hljs-builtin-name,.hljs-doctag,.hljs-literal,.hljs-number{color:#8f3f71}.hljs-code,.hljs-meta,.hljs-regexp,.hljs-selector-id,.hljs-template-variable{color:#fe8019}.hljs-addition,.hljs-meta-string,.hljs-section,.hljs-selector-attr,.hljs-selector-class,.hljs-string,.hljs-symbol{color:#b8bb26}.hljs-attribute,.hljs-bullet,.hljs-class,.hljs-function,.hljs-function .hljs-keyword,.hljs-meta-keyword,.hljs-selector-pseudo,.hljs-tag{color:#8ec07c}.hljs-comment{color:#928374}.hljs-link_label,.hljs-literal,.hljs-number{color:#d3869b}.hljs-comment,.hljs-emphasis{font-style:italic}.hljs-section,.hljs-strong,.hljs-tag{font-weight:700}</style><p>你好，我是 shengjk1，多年大厂经验，努力构建 通俗易懂的、好玩的编程语言教程。 欢迎关注！你会有如下收益：</p>
<ol>
<li>了解大厂经验</li>
<li>拥有和大厂相匹配的技术等</li>
</ol>
<p>希望看什么，评论或者私信告诉我！</p>
<h2 data-id="heading-0">一、 前言</h2>
<p>“为什么 StarRocks 主键表可以毫秒级 UPSERT，还能保证点查性能不崩，数据不丢？”<br/>
社区里 90% 的调优踩坑，归根结底是没把 <strong>dump</strong> 和 <strong>apply</strong> 这两件事分开。<br/>
今天用“一张图 + 五条时间线”把完整读写链路拆到代码级，让你 10 分钟变成“主键表懂王”。</p>
<hr/>
<h2 data-id="heading-1">二、 鸟瞰图：把 4 个核心组件先印在脑子里</h2>
<pre><code class="hljs language-sql" lang="sql">┌────────────┐  <span class="hljs-number">1</span>  write  ┌──────────────┐  <span class="hljs-number">2</span>  dump   ┌──────────────┐
│ Flink<span class="hljs-operator">/</span>Java │ ────────►  │ Memory       │ ────────►  │ Disk       │
│ Clients    │  <span class="hljs-keyword">INSERT</span><span class="hljs-operator">/</span>   │ DeltaBuffer  │  Mem→Disk  │ Delta RS <span class="hljs-operator">*</span> │
└────────────┘  <span class="hljs-keyword">UPDATE</span><span class="hljs-operator">/</span>   │ (跳表<span class="hljs-operator">+</span>索引)  │            │ (尚未合并) │
              <span class="hljs-keyword">DELETE</span>      └──────────────┘            └──────────────┘
                                                        │
                                                        │ <span class="hljs-number">3</span>  apply
                                                        ▼
┌────────────┐  <span class="hljs-number">4</span>  read   ┌──────────────┐            ┌──────────────┐
│ <span class="hljs-keyword">SQL</span>        │ ◄────────  │ Index        │ ◄────────  │ Base RS      │
│ <span class="hljs-keyword">SELECT</span>     │            │ PrimaryKey   │            │ (已合并)     │
└────────────┘            │ <span class="hljs-operator">+</span> DelVec     │            └──────────────┘
                          └──────────────┘
</code></pre>
<p>一句话注解：<br/>
<strong>写只碰 DeltaBuffer → dump 只落盘不合并 → apply 才真正把 Delta 合并进 Base → 读永远三路归并。</strong><br/>
把这张图截屏当桌面，后面所有概念都能一一映射回来。</p>
<hr/>
<h2 data-id="heading-2">2 五条时间线：写 → dump → apply → 读 → 后台维护</h2>
<h3 data-id="heading-3">2.1 写入：内存里完成 UPSERT，不到 1 ms</h3>






























<table><thead><tr><th>步骤</th><th>动作</th><th>并发保证</th></tr></thead><tbody><tr><td>① Write Ahead Log</td><td>追加写 <code>_wal/xxx.log</code></td><td>崩溃后可重放</td></tr><tr><td>② DeltaBuffer 插入</td><td>跳表（skiplist）按 pk 排序，同 key 覆盖</td><td>行级锁仅怼跳表，无 IO</td></tr><tr><td>③ 更新 PK Index</td><td>内存 B+ 树直接覆盖 RowLocation</td><td>无锁 CAS</td></tr><tr><td>④ 返回客户端</td><td>纯内存，延迟 P99 &lt; 1 ms</td><td>—</td></tr></tbody></table>
<p>关键点：</p>
<ul>
<li>跳表只保留 <strong>最新版本</strong>，天然 UPSERT。</li>
<li><strong>Base 数据文件零写入</strong>，因此没有随机写放大。</li>
</ul>
<h3 data-id="heading-4">2.2 dump：内存 → 磁盘，<strong>只写不合并</strong></h3>
<p>触发三件套：</p>
<ol>
<li>时间间隔：<code>pk_dump_interval_seconds</code>（默认 1 h）。</li>
<li>内存水位：<code>update_memory_limit_percent</code> 30%。</li>
<li>文件个数：Delta Rowset ≥ 1000。</li>
</ol>
<p>内部三步：</p>
<ol>
<li>把跳表顺序扫一遍 → 按主键排好序的列存块（含 DELETE 标记）。</li>
<li>写临时文件 <code>.dat/.idx</code> → 原子 rename 成 <code>DeltaRowsetID</code>。</li>
<li>释放整块 DeltaBuffer，内存瞬间掉回 0。</li>
</ol>
<p>结果：</p>
<ul>
<li>查询需要 <strong>Union 所有 Delta RS + 残留内存</strong>。</li>
<li><strong>不会去重 Base</strong>，所以 dump 越快，文件越碎，读放大越高。</li>
</ul>
<h3 data-id="heading-5">2.3 apply：磁盘 Delta + Base → 新 Base，<strong>真正合并</strong></h3>
<p>StarRocks 里叫 <strong>update compaction</strong>。<br/>
触发阈值：</p>
<ul>
<li>总 Delta 大小 ≥ 256 MB（<code>update_compaction_size_threshold</code>）。</li>
<li>Delta 文件数 ≥ 1000。</li>
<li>手动 <code>ADMIN COMPACT TABLE tbl;</code></li>
</ul>
<p>四步完成：</p>
<ol>
<li><strong>选集</strong>：挑一个 Base + 若干 Delta（主键区间对齐）。</li>
<li><strong>多路归并</strong>：顺序扫描，同 key 只保留最新一条；遇到 DELETE 就丢弃。</li>
<li><strong>写新 Base</strong>：全新 <code>.dat/.idx/.col/.del</code> 四件套。</li>
<li><strong>原子切换</strong>：元数据版本号 +1，老文件引用计数减 1，GC 线程 5 min 后物理删除。</li>
</ol>
<p>副作用：</p>
<ul>
<li>CPU 密集 + 读放大（要读旧 Base），但 <strong>查询无阻塞</strong>（快照隔离）。</li>
</ul>
<h3 data-id="heading-6">2.4 读取：点查 / 范围扫都靠“三路归并”</h3>
<p>可见性顺序（从新到旧）：</p>
<pre><code class="hljs">内存 DeltaBuffer → 磁盘 Delta RS → Base RS
</code></pre>
<p>点查流程：</p>
<ol>
<li>PK Index 先定位 &lt;RowSetId, RowId&gt;。</li>
<li>按类型取行：
<ul>
<li>DeltaBuffer → 直接返回。</li>
<li>Delta RS → 读主键索引页解析。</li>
<li>Base RS → 先查 DelVec，bit=1 表示已删，否则返回。<br/>
范围扫：对三路建迭代器 → 小顶堆归并 → 输出最新版本。</li>
</ul>
</li>
</ol>
<p>性能关键：</p>
<ul>
<li>PK Index 全内存，点查 <strong>O(logN)</strong> 毫秒级。</li>
<li>Delta RS 越多，堆归并层数越高 → 范围查询 CPU 飙升；<strong>因此需要 apply</strong>。</li>
</ul>
<h3 data-id="heading-7">2.5 后台维护：DelVec / GC / PIndex 重建</h3>
<ul>
<li><strong>DelVec</strong><br/>
每份 Base 一份位图，apply 时把删除标记合并进新 Base，旧 DelVec 直接扔。</li>
<li><strong>GC</strong><br/>
引用计数为 0 后延迟 5 min 删除，保证正在跑的查询快照不踩空。</li>
<li><strong>PK Index 重建</strong><br/>
老版本：BE 重启要扫 <strong>全量 Base + Delta</strong> 重建 B+ 树，10 亿行≈5 min。<br/>
3.1+：支持 <strong>持久化 pindex 快照</strong>，重启增量恢复，<strong>秒级</strong>。</li>
</ul>
<hr/>
<h2 data-id="heading-8">三、 dump vs apply 对照表：别再混淆！</h2>





























<table><thead><tr><th>误区</th><th>真相</th></tr></thead><tbody><tr><td>dump 就是合并</td><td>❌ 只落盘，<strong>不去重</strong> Base</td></tr><tr><td>dump 越频繁越好</td><td>❌ 文件更碎，读放大，IOPS 爆炸</td></tr><tr><td>apply 会锁表</td><td>❌ 快照隔离，<strong>读写无锁</strong></td></tr><tr><td>DelVec 会无限膨胀</td><td>❌ 每次 apply 生成新 Base，旧位图丢弃</td></tr><tr><td>主键表写放大严重</td><td>❌ 写只进内存，<strong>零随机写 Base</strong></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">四、 一张时序图再串一遍（文字版）</h2>
<pre><code class="hljs language-ini" lang="ini">时间轴 ──►
| 写入 ─┐                    ┌─ dump ─┐               ┌─ apply ─┐
|       │ DeltaBuffer        │ 新 Delta RS            │ 新 Base RS
| <span class="hljs-attr">key</span>=<span class="hljs-number">1</span> │ v1 → v2 → v3       │ v3 落盘                │ v3 进 Base
| <span class="hljs-attr">key</span>=<span class="hljs-number">2</span> │ delete             │ delete 标记落盘        │ 丢弃 key=<span class="hljs-number">2</span>
| 查询  │ 看 v3              │ 看 v3                   │ 仍看 v3（无锁切换）
</code></pre>
<h2 data-id="heading-10">五、 总结</h2>
<p>StarRocks 主键表 = <strong>内存 DeltaBuffer + 磁盘 Delta/Base + 内存 PKIndex + DelVec</strong> 四件套：<br/>
<strong>写只进内存，dump 不落基线，apply 真正合并，读三路归并，全程无锁。</strong></p>
<p>把 <strong>dump（落盘） vs apply（合并）</strong> 这条分界线刻进脑子，<br/>
以后任何“UPSERT 延迟高 / 点查毛刺 / 磁盘 IOPS 爆炸”的报警，<br/>
你都能 30 秒内说出根因和参数。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[milvus向量数据库详解与应用实战]]></title>    <link>https://juejin.cn/post/7573776814948237331</link>    <guid>https://juejin.cn/post/7573776814948237331</guid>    <pubDate>2025-11-18T08:15:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573776814948237331" data-draft-id="7573855399716814867" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="milvus向量数据库详解与应用实战"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-18T08:15:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            milvus向量数据库详解与应用实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T08:15:29.000Z" title="Tue Nov 18 2025 08:15:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Milvus 是一款专为人工智能时代设计的<strong>开源向量数据库</strong>，核心使命是高效处理由非结构化数据（如图像、文本、音频、视频）生成的<strong>嵌入向量</strong>，并提供高效的相似性搜索。简单来说，它将非结构化数据转换为计算机可理解的多维向量，并能在海量数据中快速找到最相似的内容 。</p>
<p>下表清晰地展示了Milvus与其他主流向量数据库的核心差异，帮助您理解其独特定位。</p>









































<table><thead><tr><th>数据库名称</th><th>类型</th><th>核心优势</th><th>典型适用场景</th></tr></thead><tbody><tr><td><strong>Milvus</strong>​</td><td>开源/托管</td><td><strong>高性能、可扩展性极强</strong>，支持多种索引和分布式架构</td><td>大规模图像/视频检索、推荐系统、RAG系统</td></tr><tr><td><strong>Pinecone</strong>​</td><td>全托管</td><td><strong>开箱即用，易上手</strong>，无需管理基础设施</td><td>快速原型开发、实时推荐、语义搜索</td></tr><tr><td><strong>ChromaDB</strong>​</td><td>嵌入式</td><td><strong>轻量级，易用</strong>，适合本地开发和轻量级应用</td><td>轻量级AI应用、RAG系统、原型设计</td></tr><tr><td><strong>Weaviate</strong>​</td><td>开源/托管</td><td><strong>支持混合搜索</strong>（向量+关键字），内置模块化设计</td><td>知识图谱、混合搜索应用</td></tr><tr><td><strong>PgVector</strong>​</td><td>PostgreSQL扩展</td><td><strong>与PostgreSQL无缝集成</strong>，可使用标准SQL查询</td><td>已有PostgreSQL基础设施的中小规模AI应用</td></tr></tbody></table>
<h3 data-id="heading-0">🔄 核心工作原理：从数据到结果</h3>
<p>Milvus 的工作流程可以清晰地划分为以下四个关键步骤，下图展示了从数据注入到返回结果的完整路径：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b2af55162d41f68972b1f722b88776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTmqZjlrZDnmq4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764058528&amp;x-signature=Ez%2Bcnts2KfI3PFphi%2FFejreKFNU%3D" alt="image.png" loading="lazy"/></p>
<ol>
<li>
<p><strong>数据向量化</strong>：利用 Embedding 模型（如 BERT、ResNet）将图片、文本等非结构化数据转换为高维向量 。</p>
</li>
<li>
<p><strong>数据存储与索引</strong>：将这些向量及其对应的元数据（如ID、描述）插入Milvus。Milvus会为向量构建高效的索引（如HNSW、IVF_FLAT），将搜索从“大海捞针”变为“查图索骥”，这是实现高速检索的关键 。</p>
</li>
<li>
<p><strong>相似性搜索</strong>：当输入查询（例如一段问题文本）时，先将其转换为查询向量。Milvus会在索引中快速计算该查询向量与库中所有向量的距离（如欧氏距离L2、内积IP） 。</p>
</li>
<li>
<p><strong>返回结果</strong>：最后，根据距离远近（代表相似度高低），返回最相似的若干个向量及其关联的原始数据（如最相关的文档片段）作为结果 。</p>
</li>
</ol>
<h3 data-id="heading-1">🛠️ 实战：构建RAG知识库的核心步骤</h3>
<p>以下是一个使用 Python 构建 RAG 知识库的完整示例。</p>
<h4 data-id="heading-2">步骤一：环境准备与连接</h4>
<p>首先安装必要的库，并初始化 Milvus 客户端。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">from</span> pymilvus import connections, Collection, FieldSchema, CollectionSchema, DataType, utility

<span class="hljs-meta"># 连接到 Milvus 服务器（以单机版为例）</span>
connections.connect(<span class="hljs-keyword">alias</span>=<span class="hljs-string">"default"</span>, host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-string">'19530'</span>)
</code></pre>
<h4 data-id="heading-3">步骤二：设计数据表（Collection Schema）</h4>
<p>根据你的数据特征定义表结构，例如，一个用于存储知识库文档片段的集合可能需要以下字段：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 定义字段</span>
<span class="hljs-attr">fields</span> = [
    FieldSchema(name=<span class="hljs-string">"id"</span>, dtype=DataType.VARCHAR, is_primary=<span class="hljs-literal">True</span>, max_length=<span class="hljs-number">100</span>),  <span class="hljs-comment"># 主键</span>
    FieldSchema(name=<span class="hljs-string">"doc_id"</span>, dtype=DataType.VARCHAR, max_length=<span class="hljs-number">100</span>),  <span class="hljs-comment"># 文档ID</span>
    FieldSchema(name=<span class="hljs-string">"content"</span>, dtype=DataType.VARCHAR, max_length=<span class="hljs-number">1000</span>),  <span class="hljs-comment"># 文档内容文本</span>
    FieldSchema(name=<span class="hljs-string">"vector"</span>, dtype=DataType.FLOAT_VECTOR, dim=<span class="hljs-number">768</span>)  <span class="hljs-comment"># 向量字段，维度需与模型匹配</span>
]
<span class="hljs-comment"># 创建集合Schema</span>
<span class="hljs-attr">schema</span> = CollectionSchema(fields=fields, description=<span class="hljs-string">"RAG knowledge base collection"</span>)
<span class="hljs-comment"># 创建集合</span>
<span class="hljs-attr">rag_collection</span> = Collection(name=<span class="hljs-string">"rag_kb"</span>, schema=schema)
</code></pre>
<h4 data-id="heading-4">步骤三：配置索引</h4>
<p>为向量字段创建索引是保证高效查询的关键。</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># 配置索引参数（以IVF_FLAT索引为例）</span>
index_params = {
    <span class="hljs-string">"index_type"</span>: <span class="hljs-string">"IVF_FLAT"</span>,
    <span class="hljs-string">"metric_type"</span>: <span class="hljs-string">"L2"</span>,  <span class="hljs-comment"># 使用欧氏距离作为相似度度量</span>
    <span class="hljs-string">"params"</span>: {<span class="hljs-string">"nlist"</span>: 1024}  <span class="hljs-comment"># 聚类中心数量，值越大，精度越高，搜索越慢</span>
}
<span class="hljs-comment"># 为向量字段创建索引</span>
rag_collection.create_index(field_name=<span class="hljs-string">"vector"</span>, index_params=index_params)
</code></pre>
<h4 data-id="heading-5">步骤四：插入数据</h4>
<p>将文档向量及其元数据存入集合。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 假设 documents 是包含文档文本和对应向量的列表</span>
<span class="hljs-comment"># 示例数据</span>
<span class="hljs-attr">documents</span> = [
    {<span class="hljs-string">"doc_id"</span>: <span class="hljs-string">"doc1"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"机器学习是人工智能的核心领域之一..."</span>, <span class="hljs-string">"vector"</span>: [<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, ..., <span class="hljs-number">0.768</span>]},
    {<span class="hljs-string">"doc_id"</span>: <span class="hljs-string">"doc2"</span>, <span class="hljs-string">"content"</span>: <span class="hljs-string">"深度学习是基于神经网络的技术..."</span>, <span class="hljs-string">"vector"</span>: [<span class="hljs-number">0.3</span>, <span class="hljs-number">0.4</span>, ..., <span class="hljs-number">0.768</span>]},
    <span class="hljs-comment"># ... 更多数据</span>
]

<span class="hljs-comment"># 准备插入的数据列表</span>
<span class="hljs-attr">data</span> = [
    [doc[<span class="hljs-string">"doc_id"</span>] for doc in documents],  <span class="hljs-comment"># ID列表，这里简单使用doc_id</span>
    [doc[<span class="hljs-string">"doc_id"</span>] for doc in documents],  <span class="hljs-comment"># 文档ID列表</span>
    [doc[<span class="hljs-string">"content"</span>] for doc in documents],  <span class="hljs-comment"># 内容列表</span>
    [doc[<span class="hljs-string">"vector"</span>] for doc in documents]   <span class="hljs-comment"># 向量列表</span>
]

<span class="hljs-comment"># 插入数据</span>
<span class="hljs-attr">insert_result</span> = rag_collection.insert(data)
rag_collection.flush()  <span class="hljs-comment"># 确保数据被持久化</span>
print(f"已插入 {len(insert_result.primary_keys)} 条数据。")
</code></pre>
<h4 data-id="heading-6">步骤五：执行相似性搜索</h4>
<p>用户查询时，先将其向量化，然后在 Milvus 中搜索。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 加载集合到内存（首次搜索前需要）</span>
rag_collection.load()

<span class="hljs-comment"># 2. 准备搜索参数（需与索引参数匹配）</span>
<span class="hljs-attr">search_params</span> = {<span class="hljs-string">"metric_type"</span>: <span class="hljs-string">"L2"</span>, <span class="hljs-string">"params"</span>: {<span class="hljs-string">"nprobe"</span>: <span class="hljs-number">10</span>}}  <span class="hljs-comment"># nprobe定义搜索的聚类中心数量</span>

<span class="hljs-comment"># 3. 执行搜索（假设 query_vector 是用户查询转换后的向量）</span>
<span class="hljs-attr">results</span> = rag_collection.search(
    <span class="hljs-attr">data</span>=[query_vector],
    <span class="hljs-attr">anns_field</span>=<span class="hljs-string">"vector"</span>,  <span class="hljs-comment"># 在哪个字段上搜索</span>
    <span class="hljs-attr">param</span>=search_params,
    <span class="hljs-attr">limit</span>=<span class="hljs-number">3</span>,  <span class="hljs-comment"># 返回最相似的3个结果</span>
    <span class="hljs-attr">output_fields</span>=[<span class="hljs-string">"id"</span>, <span class="hljs-string">"doc_id"</span>, <span class="hljs-string">"content"</span>]  <span class="hljs-comment"># 指定返回哪些元数据字段</span>
)

<span class="hljs-comment"># 4. 处理结果</span>
for hits in results:
    for hit in hits:
        print(f"ID: {hit.id}, 相似度距离: {hit.distance}")
        print(f"内容: {hit.entity.get('content')}")
        print("---")
</code></pre>
<h3 data-id="heading-7">💡 核心技巧与优化建议</h3>
<ol>
<li>
<p><strong>索引选择策略</strong>：</p>
<ul>
<li>
<p><strong>HNSW</strong>：适用于<strong>高召回率、低延迟</strong>的搜索场景，但内存占用较高 。</p>
</li>
<li>
<p><strong>IVF_FLAT/IVF_PQ</strong>：<strong>平衡精度、内存和速度</strong>的通用选择。IVF_PQ通过量化压缩向量，能显著减少内存占用，适合超大规模数据集，但会带来少量精度损失 。</p>
</li>
<li>
<p><strong>CAGRA</strong>：Milvus 2.4 新增，为<strong>GPU加速</strong>设计，特别适合需要极致性能的生成式AI应用 。</p>
</li>
<li>
<p><strong>FLAT</strong>：<strong>精度100%保证</strong>，适用于数据量小（如万级）或需要绝对精确结果的场景 。</p>
</li>
</ul>
</li>
<li>
<p><strong>性能调优参数</strong>：</p>
<ul>
<li>
<p><strong><code>nlist</code>和 <code>nprobe</code></strong>：在IVF索引中，<code>nlist</code>是聚类中心数，<code>nprobe</code>是搜索时涉及的聚类中心数。增加 <code>nprobe</code>能提高召回率，但会降低搜索速度，需要在两者间权衡 。</p>
</li>
<li>
<p><strong><code>ef</code></strong>：在HNSW索引中，控制搜索深度，值越大，结果越精确，但速度越慢 。</p>
</li>
</ul>
</li>
<li>
<p><strong>数据持久化与高可用</strong>：对于生产环境，务必使用<strong>分布式部署</strong>模式，并依赖 etcd 管理元数据，使用 MinIO 或 SSO作为对象存储，通过 Pulsar 等管理日志，以确保数据可靠和服务高可用 。</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ChromaDB详解与应用实战]]></title>    <link>https://juejin.cn/post/7573738017988149291</link>    <guid>https://juejin.cn/post/7573738017988149291</guid>    <pubDate>2025-11-18T08:17:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573738017988149291" data-draft-id="7573776814948253715" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ChromaDB详解与应用实战"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-11-18T08:17:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT橘子皮"/> <meta itemprop="url" content="https://juejin.cn/user/3148645291002232"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ChromaDB详解与应用实战
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3148645291002232/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT橘子皮
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T08:17:04.000Z" title="Tue Nov 18 2025 08:17:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ChromaDB 是一款专为AI应用设计的开源向量数据库，它让机器能够真正“理解”数据的语义，而不仅仅是匹配关键词。下面这张图能帮你快速把握它的核心运作机制：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14812f12de8d4a24852a00ccb004d9af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSVTmqZjlrZDnmq4=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764058666&amp;x-signature=X9vn3ngfUanfXb5wlqNT8aqEZ%2Bw%3D" alt="image.png" loading="lazy"/></p>
<p>下面，我将带你深入了解如何用它解决实际问题。</p>
<h3 data-id="heading-0">🔄 ChromaDB 核心概念</h3>
<p>理解以下几个关键概念是熟练使用ChromaDB的基础 ：</p>
<ul>
<li>
<p><strong>集合（Collection）</strong> ：类似于关系型数据库中的“表”，是存储相关数据的基本单元。</p>
</li>
<li>
<p><strong>文档（Document）</strong> ：你想要存储和搜索的原始数据本身，比如一段文本。</p>
</li>
<li>
<p><strong>嵌入向量（Embedding）</strong> ：文档经过Embedding模型转换后得到的一串高维数字，代表了其语义特征。这是ChromaDB操作的真正对象。</p>
</li>
<li>
<p><strong>元数据（Metadata）</strong> ：与文档相关的附加信息（如作者、分类、来源），可用于精确过滤。</p>
</li>
<li>
<p><strong>嵌入函数（Embedding Function）</strong> ：负责将文档转换为向量的模型。ChromaDB支持多种内置及自定义模型。</p>
</li>
</ul>
<h3 data-id="heading-1">🛠️ 核心功能与实战应用</h3>
<h4 data-id="heading-2">1. 环境配置与快速开始</h4>
<p>首先安装ChromaDB，并根据你的使用场景选择合适的客户端 ：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 安装</span>
pip install chromadb

<span class="hljs-comment"># 场景1: 实验调试 - 使用内存客户端（数据不保存）</span>
<span class="hljs-attr">client</span> = chromadb.Client()

<span class="hljs-comment"># 场景2: 本地应用 - 使用持久化客户端（数据保存到磁盘）</span>
<span class="hljs-attr">client</span> = chromadb.PersistentClient(path=<span class="hljs-string">"./chroma_db"</span>)

<span class="hljs-comment"># 场景3: 生产环境 - 连接远程服务器 </span>
<span class="hljs-comment"># 首先用 Docker 启动服务端: docker run -p 8000:8000 chromadb/chroma</span>
<span class="hljs-attr">client</span> = chromadb.HttpClient(host=<span class="hljs-string">'localhost'</span>, port=<span class="hljs-number">8000</span>)
</code></pre>
<h4 data-id="heading-3">2. 创建集合并添加数据</h4>
<p>创建一个集合来管理你的数据。关键是选择合适的<strong>嵌入函数（Embedding Function）</strong> ，它直接影响向量化质量和搜索效果 。</p>
<pre><code class="hljs language-ini" lang="ini">import chromadb
from chromadb.utils import embedding_functions

<span class="hljs-comment"># 连接客户端</span>
<span class="hljs-attr">client</span> = chromadb.PersistentClient(path=<span class="hljs-string">"./my_chroma_db"</span>)

<span class="hljs-comment"># 选择嵌入函数 - 以 Sentence Transformer 为例（本地运行，免费）</span>
<span class="hljs-attr">sentence_transformer_ef</span> = embedding_functions.SentenceTransformerEmbeddingFunction(model_name=<span class="hljs-string">"all-MiniLM-L6-v2"</span>)

<span class="hljs-comment"># 创建集合时指定嵌入函数</span>
<span class="hljs-attr">collection</span> = client.get_or_create_collection(
    <span class="hljs-attr">name</span>=<span class="hljs-string">"my_knowledge_base"</span>,
    <span class="hljs-attr">embedding_function</span>=sentence_transformer_ef <span class="hljs-comment"># 指定嵌入函数</span>
)

<span class="hljs-comment"># 准备并添加数据</span>
<span class="hljs-attr">documents</span> = [
    <span class="hljs-string">"ChromaDB是一个开源的向量数据库。"</span>,
    <span class="hljs-string">"熊猫是中国的国宝，主要以竹子为食。"</span>,
    <span class="hljs-string">"大型语言模型（LLM）在自然语言处理中表现出色。"</span>,
    <span class="hljs-string">"北京是中国的首都，是一座历史悠久的城市。"</span>
]
<span class="hljs-attr">metadatas</span> = [
    {<span class="hljs-string">"topic"</span>: <span class="hljs-string">"database"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"tech"</span>},
    {<span class="hljs-string">"topic"</span>: <span class="hljs-string">"animal"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"nature"</span>},
    {<span class="hljs-string">"topic"</span>: <span class="hljs-string">"AI"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"tech"</span>},
    {<span class="hljs-string">"topic"</span>: <span class="hljs-string">"city"</span>, <span class="hljs-string">"type"</span>: <span class="hljs-string">"geography"</span>}
]
<span class="hljs-attr">ids</span> = [<span class="hljs-string">"doc1"</span>, <span class="hljs-string">"doc2"</span>, <span class="hljs-string">"doc3"</span>, <span class="hljs-string">"doc4"</span>]

<span class="hljs-comment"># 添加数据到集合，ChromaDB会自动调用嵌入函数将文档转为向量</span>
collection.add(
    <span class="hljs-attr">documents</span>=documents,
    <span class="hljs-attr">metadatas</span>=metadatas,
    <span class="hljs-attr">ids</span>=ids
)
print("数据添加成功！")
</code></pre>
<h4 data-id="heading-4">3. 执行语义搜索与过滤</h4>
<p>这是ChromaDB的核心能力，它能找到语义上最相近的结果，而不仅仅是关键词匹配。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 基础语义搜索：直接使用自然语言查询</span>
<span class="hljs-attr">results</span> = collection.query(
    <span class="hljs-attr">query_texts</span>=[<span class="hljs-string">"一种吃竹子的动物"</span>], <span class="hljs-comment"># 查询文本是“熊猫”的另一种说法</span>
    <span class="hljs-attr">n_results</span>=<span class="hljs-number">2</span>
)

print("语义搜索结果显示它能理解含义:")
for i, doc in enumerate(results<span class="hljs-section">['documents']</span><span class="hljs-section">[0]</span>):
    print(f"{i+1}. {doc} (ID: {results<span class="hljs-section">['ids']</span><span class="hljs-section">[0]</span><span class="hljs-section">[i]</span>})")
    print(f"   元数据: {results<span class="hljs-section">['metadatas']</span><span class="hljs-section">[0]</span><span class="hljs-section">[i]</span>}")
    print(f"   相似度距离: {results<span class="hljs-section">['distances']</span><span class="hljs-section">[0]</span><span class="hljs-section">[i]</span>:.4f}") <span class="hljs-comment"># 距离越小越相似</span>

<span class="hljs-comment"># 组合过滤查询：语义搜索 + 元数据条件 </span>
print("\n结合元数据过滤后的结果（只搜索技术类文档）:")
<span class="hljs-attr">filtered_results</span> = collection.query(
    <span class="hljs-attr">query_texts</span>=[<span class="hljs-string">"一种开源的数据库技术"</span>],
    <span class="hljs-attr">n_results</span>=<span class="hljs-number">2</span>,
    <span class="hljs-attr">where</span>={<span class="hljs-string">"type"</span>: <span class="hljs-string">"tech"</span>} <span class="hljs-comment"># 元数据过滤条件：只返回 type 为 tech 的文档</span>
)
for i, doc in enumerate(filtered_results<span class="hljs-section">['documents']</span><span class="hljs-section">[0]</span>):
    print(f"{i+1}. {doc}")
</code></pre>
<h4 data-id="heading-5">4. 实战案例：为AI Agent添加长期记忆</h4>
<p>这是一个非常经典的应用场景 。普通的AI对话机器人没有记忆，每次对话都是新的开始。利用ChromaDB，我们可以让它记住之前的对话内容。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AgentMemory</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, persist_directory=<span class="hljs-string">"./agent_memory"</span></span>):
        self.client = chromadb.PersistentClient(path=persist_directory)
        <span class="hljs-comment"># 使用一个能理解中文的嵌入模型</span>
        self.embedding_function = embedding_functions.SentenceTransformerEmbeddingFunction(model_name=<span class="hljs-string">"paraphrase-multilingual-MiniLM-L12-v2"</span>)
        self.collection = self.client.get_or_create_collection(
            name=<span class="hljs-string">"conversation_history"</span>,
            embedding_function=self.embedding_function
        )
        self._next_id = <span class="hljs-number">1</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">remember</span>(<span class="hljs-params">self, conversation_text, metadata=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""记住一段对话"""</span>
        doc_id = <span class="hljs-string">f"memory_<span class="hljs-subst">{self._next_id}</span>"</span>
        self._next_id += <span class="hljs-number">1</span>
        self.collection.add(
            documents=[conversation_text],
            metadatas=[metadata] <span class="hljs-keyword">if</span> metadata <span class="hljs-keyword">else</span> [{}],
            ids=[doc_id]
        )
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Agent 已记住一段对话 (ID: <span class="hljs-subst">{doc_id}</span>)"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">recall_relevant_memories</span>(<span class="hljs-params">self, current_query, n_results=<span class="hljs-number">3</span></span>):
        <span class="hljs-string">"""根据当前问题，回忆相关的历史对话"""</span>
        results = self.collection.query(
            query_texts=[current_query],
            n_results=n_results
        )
        <span class="hljs-keyword">return</span> results

<span class="hljs-comment"># 使用示例</span>
agent_brain = AgentMemory()

<span class="hljs-comment"># 模拟一些历史对话</span>
agent_brain.remember(<span class="hljs-string">"用户昨天说喜欢科幻电影，特别是关于时间旅行的。"</span>, metadata={<span class="hljs-string">"date"</span>: <span class="hljs-string">"2024-11-17"</span>, <span class="hljs-string">"topic"</span>: <span class="hljs-string">"preference"</span>})
agent_brain.remember(<span class="hljs-string">"我们上周讨论过《三体》这本书的黑暗森林法则。"</span>, metadata={<span class="hljs-string">"date"</span>: <span class="hljs-string">"2024-11-10"</span>, <span class="hljs-string">"topic"</span>: <span class="hljs-string">"discussion"</span>})

<span class="hljs-comment"># 今天用户提出了一个新问题</span>
today_question = <span class="hljs-string">"有没有类似《三体》那样有深度设定的电影推荐？"</span>
relevant_memories = agent_brain.recall_relevant_memories(today_question)

<span class="hljs-built_in">print</span>(<span class="hljs-string">"用户当前问题:"</span>, today_question)
<span class="hljs-built_in">print</span>(<span class="hljs-string">"\nAgent 回忆起的相关历史对话："</span>)
<span class="hljs-keyword">for</span> i, memory <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(relevant_memories[<span class="hljs-string">'documents'</span>][<span class="hljs-number">0</span>]):
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{i+<span class="hljs-number">1</span>}</span>. <span class="hljs-subst">{memory}</span>"</span>)
</code></pre>
<p>在这个例子中，当你问出新问题时，AI Agent不再是“失忆”的。它会自动从ChromaDB中找出语义上最相关的历史对话，从而给出更具连续性、更个性化的回答。这正是<strong>检索增强生成（RAG）</strong> ​ 系统的核心思想之一 。</p>
<h3 data-id="heading-6">💡 最佳实践与总结</h3>






























<table><thead><tr><th>特性/场景</th><th>推荐做法</th><th>说明</th></tr></thead><tbody><tr><td><strong>嵌入模型选择</strong>​</td><td><strong>起步/本地开发</strong>：<code>all-MiniLM-L6-v2</code> <strong>生产/重质量</strong>：<code>text-embedding-ada-002</code>(OpenAI) <strong>多语言/中文</strong>：<code>text2vec-base-chinese</code></td><td>模型选择直接影响搜索精度，中文应用务必选支持中文的模型。</td></tr><tr><td><strong>元数据设计</strong>​</td><td>提前规划好要记录的字段，如 <code>source</code>, <code>category</code>, <code>author</code>, <code>timestamp</code>。</td><td>丰富的元数据是实现精准过滤和高效管理的关键 。</td></tr><tr><td><strong>部署模式</strong>​</td><td><strong>开发测试</strong>：内存模式或持久化模式 <strong>生产环境</strong>：客户端-服务器模式（如Docker部署）</td><td>生产环境一定要用服务端模式，保证稳定性和可扩展性。</td></tr><tr><td><strong>性能优化</strong>​</td><td>对大规模数据集，可调整HNSW索引参数或在应用层添加缓存策略 。</td><td>根据数据量和性能要求进行调优。</td></tr></tbody></table>
<p><strong>ChromaDB的核心价值</strong>在于，它以一种开发者友好（API简单）且资源友好（轻量级）的方式，将强大的语义搜索能力带给了每一位开发者，极大地降低了构建智能应用的门槛 。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python文件类型大全：从.py到.pyd，你见过几种？]]></title>    <link>https://juejin.cn/post/7573669819029209098</link>    <guid>https://juejin.cn/post/7573669819029209098</guid>    <pubDate>2025-11-18T08:16:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573669819029209098" data-draft-id="7573669819029176330" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python文件类型大全：从.py到.pyd，你见过几种？"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-11-18T08:16:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="程序员晚枫"/> <meta itemprop="url" content="https://juejin.cn/user/2327002779758760"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python文件类型大全：从.py到.pyd，你见过几种？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2327002779758760/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    程序员晚枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T08:16:22.000Z" title="Tue Nov 18 2025 08:16:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/802ed047c120429a98105172c4ae2d97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iL5bqP5ZGY5pma5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1764058582&amp;x-signature=WlKy41c0uGmX0id4N4%2Bi29rOMvg%3D" alt="image.png" loading="lazy"/></p>
<p>大家好，我是程序员晚枫。</p>
<p>最近有了[AI编程]，Python的热度降低了，我也终于有时间关注一直感兴趣的Python话题，而不是回答Python怎么安装这种入门问题了。</p>
<p>我对于Python兴趣的探索，主要基于两本书：《流畅的Python》、《Python高性能编程》。越深入了解Python高级语法，越能深入理解这门语言设计的精妙之处。</p>
<p>今天我们来聊聊Python世界中那些形形色色的文件类型。</p>
<blockquote>
<p>作为一个Python开发者，你肯定经常跟<code>.py</code>文件打交道。但Python生态中其实还有很多其他重要的文件类型，每种都有其独特的用途。</p>
</blockquote>
<h2 data-id="heading-0">📁 Python核心文件类型</h2>





















































<table><thead><tr><th>文件类型</th><th>主要用途</th><th>是否可读</th><th>生成方式</th></tr></thead><tbody><tr><td><strong>.py</strong></td><td>Python源代码</td><td>✅ 是</td><td>手动创建</td></tr><tr><td><strong>.pyc</strong></td><td>编译后的字节码</td><td>❌ 否</td><td>Python自动生成</td></tr><tr><td><strong>.pyo</strong></td><td>优化后的字节码</td><td>❌ 否</td><td>Python带-O参数生成</td></tr><tr><td><strong>.pyd</strong></td><td>Windows动态链接库</td><td>❌ 否</td><td>Cython/C扩展编译</td></tr><tr><td><strong>.so</strong></td><td>Linux/Mac动态库</td><td>❌ 否</td><td>Cython/C扩展编译</td></tr><tr><td><strong>.pyw</strong></td><td>无控制台Python脚本</td><td>✅ 是</td><td>手动创建</td></tr><tr><td><strong>.pyx</strong></td><td>Cython源代码</td><td>✅ 是</td><td>手动创建</td></tr></tbody></table>
<p>有一些文件类型你可能没见过，有2种原因：</p>
<ul>
<li>你没有这么复杂的工作场景，例如so文件的使用</li>
<li>部分类型被编辑器给自动屏蔽了，例如：pyc文件</li>
</ul>
<h2 data-id="heading-1">🔧 详细解析</h2>
<h3 data-id="heading-2">1. .py - Python源代码文件</h3>
<p>这是最常见的Python文件，包含人类可读的Python代码。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># hello.py</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">greet</span>(<span class="hljs-params">name</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Hello, <span class="hljs-subst">{name}</span>!"</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-built_in">print</span>(greet(<span class="hljs-string">"Python开发者: 程序员晚枫"</span>))
</code></pre>
<h3 data-id="heading-3">2. .pyc - 编译字节码文件</h3>
<p>Python解释器将.py文件编译成字节码，加速后续执行。</p>
<p><strong>生成方式</strong>：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Python会自动在__pycache__目录生成.pyc文件</span>
python -m py_compile hello.py
</code></pre>
<p><strong>文件结构</strong>：</p>
<ul>
<li>位于<code>__pycache__</code>目录</li>
<li>命名格式：<code>hello.cpython-39.pyc</code></li>
<li>包含Python字节码，不是机器码</li>
</ul>
<h3 data-id="heading-4">3. .pyd - Windows动态链接库</h3>
<p><code>.pyd</code>文件本质上是DLL文件，但可以被Python直接导入。</p>
<blockquote>
<p>这种类型，可以理解为java中的jar包格式，可以打包后给别人使用。</p>
</blockquote>
<p><strong>创建示例</strong>（使用Cython）：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安装Cython</span>
pip install cython

<span class="hljs-comment"># 创建Cython文件</span>
<span class="hljs-comment"># hello.pyx</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">cython_greet</span>(<span class="hljs-params">name</span>):
    <span class="hljs-keyword">return</span> <span class="hljs-string">f"Hello from Cython, <span class="hljs-subst">{name}</span>!"</span>

<span class="hljs-comment"># setup.py</span>
<span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup
<span class="hljs-keyword">from</span> Cython.Build <span class="hljs-keyword">import</span> cythonize

setup(ext_modules=cythonize(<span class="hljs-string">"hello.pyx"</span>))

<span class="hljs-comment"># 编译生成.pyd</span>
python setup.py build_ext --inplace
</code></pre>
<p><strong>使用.pyd文件</strong>：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 像普通模块一样导入</span>
<span class="hljs-keyword">import</span> hello
<span class="hljs-built_in">print</span>(hello.cython_greet(<span class="hljs-string">"程序员晚枫"</span>))
</code></pre>
<h3 data-id="heading-5">4. .pyx - Cython源代码文件</h3>
<p>Cython是Python的超集，允许编写C扩展。</p>
<pre><code class="hljs language-cython" lang="cython"># fastmath.pyx
def fibonacci(int n):
    cdef int i
    cdef double a = 0.0, b = 1.0
    for i in range(n):
        a, b = b, a + b
    return a
</code></pre>
<h3 data-id="heading-6">5. .pyw - 无控制台脚本</h3>
<p>在Windows上，<code>.pyw</code>文件运行时不会显示控制台窗口，适合GUI应用。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># my_app.pyw</span>
<span class="hljs-keyword">import</span> tkinter <span class="hljs-keyword">as</span> tk

root = tk.Tk()
root.title(<span class="hljs-string">"无控制台应用"</span>)
root.mainloop()
</code></pre>
<h2 data-id="heading-7">📦 包与分发文件</h2>
<h3 data-id="heading-8">包相关文件</h3>

















<table><thead><tr><th>文件类型</th><th>用途</th></tr></thead><tbody><tr><td><strong><strong>init</strong>.py</strong></td><td>包初始化文件（Python 3.3+可选）</td></tr><tr><td><strong><strong>main</strong>.py</strong></td><td>包作为脚本执行时的入口</td></tr></tbody></table>
<h3 data-id="heading-9">分发与安装</h3>

































<table><thead><tr><th>文件类型</th><th>用途</th></tr></thead><tbody><tr><td><strong>.whl</strong></td><td>Python包的分发格式（wheel）</td></tr><tr><td><strong>.egg</strong></td><td>旧版包分发格式</td></tr><tr><td><strong>setup.py</strong></td><td>包安装脚本</td></tr><tr><td><strong>setup.cfg</strong></td><td>包配置</td></tr><tr><td><strong>pyproject.toml</strong></td><td>现代包配置</td></tr><tr><td><strong>requirements.txt</strong></td><td>依赖列表</td></tr></tbody></table>
<h2 data-id="heading-10">🛠️ 配置文件类型</h2>
<h3 data-id="heading-11">项目配置</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># pyproject.toml（现代Python项目）</span>
[build-system]
requires = [<span class="hljs-string">"setuptools"</span>, <span class="hljs-string">"wheel"</span>]

[project]
name = <span class="hljs-string">"my-project"</span>
version = <span class="hljs-string">"0.1.0"</span>

<span class="hljs-comment"># setup.cfg（传统配置）</span>
[metadata]
name = my-project
version = <span class="hljs-number">0.1</span><span class="hljs-number">.0</span>

<span class="hljs-comment"># requirements.txt</span>
requests&gt;=<span class="hljs-number">2.25</span><span class="hljs-number">.0</span>
pandas&gt;=<span class="hljs-number">1.3</span><span class="hljs-number">.0</span>
</code></pre>
<h3 data-id="heading-12">环境与工具配置</h3>

























<table><thead><tr><th>文件类型</th><th>用途</th></tr></thead><tbody><tr><td><strong>.python-version</strong></td><td>pyenv版本文件</td></tr><tr><td><strong>Pipfile</strong></td><td>pipenv依赖管理</td></tr><tr><td><strong>Pipfile.lock</strong></td><td>依赖锁文件</td></tr><tr><td><strong>environment.yml</strong></td><td>conda环境配置</td></tr></tbody></table>
<h2 data-id="heading-13">🔍 特殊用途文件</h2>
<h3 data-id="heading-14">1. .pyi - 存根文件</h3>
<p>用于类型提示，不包含实现代码。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># math.pyi</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">sqrt</span>(<span class="hljs-params">x: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>: ...
<span class="hljs-keyword">def</span> <span class="hljs-title function_">pow</span>(<span class="hljs-params">x: <span class="hljs-built_in">float</span>, y: <span class="hljs-built_in">float</span></span>) -&gt; <span class="hljs-built_in">float</span>: ...
</code></pre>
<h3 data-id="heading-15">2. .pth - 路径配置文件</h3>
<p>在Python路径中添加自定义路径。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># my_paths.pth</span>
/home/user/my_python_libs
../relative/path/to/modules
</code></pre>
<h3 data-id="heading-16">3. .pyz - 自包含应用</h3>
<p>包含所有依赖的zip应用。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建.pyz文件</span>
python -m zipapp my_app -o app.pyz

<span class="hljs-comment"># 运行</span>
python app.pyz
</code></pre>
<h2 data-id="heading-17">💻 开发工具文件</h2>
<h3 data-id="heading-18">测试相关</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># test_example.py</span>
<span class="hljs-keyword">import</span> pytest

<span class="hljs-keyword">def</span> <span class="hljs-title function_">test_addition</span>():
    <span class="hljs-keyword">assert</span> <span class="hljs-number">1</span> + <span class="hljs-number">1</span> == <span class="hljs-number">2</span>

<span class="hljs-comment"># conftest.py（pytest配置）</span>
<span class="hljs-keyword">import</span> pytest

<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">sample_data</span>():
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"key"</span>: <span class="hljs-string">"value"</span>}
</code></pre>
<h3 data-id="heading-19">代码质量</h3>

























<table><thead><tr><th>文件类型</th><th>用途</th></tr></thead><tbody><tr><td><strong>.pylintrc</strong></td><td>Pylint配置</td></tr><tr><td><strong>.flake8</strong></td><td>Flake8配置</td></tr><tr><td><strong>.coveragerc</strong></td><td>测试覆盖率配置</td></tr><tr><td><strong>.pre-commit-config.yaml</strong></td><td>Git钩子配置</td></tr></tbody></table>
<h2 data-id="heading-20">🎯 实际项目示例</h2>
<p>一个典型的Python项目结构：</p>
<pre><code class="hljs language-css" lang="css">my_project/
├── <span class="hljs-attribute">src</span>/
│   ├── __init__<span class="hljs-selector-class">.py</span>
│   ├── <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span>
│   └── utils<span class="hljs-selector-class">.py</span>
├── tests/
│   ├── __init__<span class="hljs-selector-class">.py</span>
│   └── test_main<span class="hljs-selector-class">.py</span>
├── docs/
│   └── conf<span class="hljs-selector-class">.py</span>
├── <span class="hljs-selector-class">.python-version</span>
├── pyproject<span class="hljs-selector-class">.toml</span>
├── requirements<span class="hljs-selector-class">.txt</span>
├── setup<span class="hljs-selector-class">.py</span>
└── README<span class="hljs-selector-class">.md</span>
</code></pre>
<h2 data-id="heading-21">💡 实用技巧</h2>
<h3 data-id="heading-22">1. 查看.pyc文件内容</h3>
<pre><code class="hljs language-bash" lang="bash">python -m dis hello.pyc
</code></pre>
<h3 data-id="heading-23">2. 将Python包编译成.pyd</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 使用Cython批量编译</span>
<span class="hljs-keyword">from</span> Cython.Build <span class="hljs-keyword">import</span> cythonize
<span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup, Extension

extensions = [
    Extension(<span class="hljs-string">"my_module"</span>, [<span class="hljs-string">"my_module.pyx"</span>])
]

setup(ext_modules=cythonize(extensions))
</code></pre>
<h3 data-id="heading-24">3. 创建专业的分发包</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># setup.py</span>
<span class="hljs-keyword">from</span> setuptools <span class="hljs-keyword">import</span> setup, find_packages

setup(
    name=<span class="hljs-string">"my-package"</span>,
    version=<span class="hljs-string">"1.0.0"</span>,
    packages=find_packages(),
    install_requires=[
        <span class="hljs-string">"requests&gt;=2.25.0"</span>,
    ],
    entry_points={
        <span class="hljs-string">'console_scripts'</span>: [
            <span class="hljs-string">'my-command=my_package.cli:main'</span>,
        ],
    },
)
</code></pre>
<h2 data-id="heading-25">🚀 性能对比：.py vs .pyd</h2>
<p>在某些场景下，编译成.pyd可以显著提升性能：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 性能测试示例</span>
<span class="hljs-keyword">import</span> timeit

<span class="hljs-comment"># Python版本</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">python_fib</span>(<span class="hljs-params">n</span>):
    <span class="hljs-keyword">if</span> n &lt;= <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> n
    <span class="hljs-keyword">return</span> python_fib(n-<span class="hljs-number">1</span>) + python_fib(n-<span class="hljs-number">2</span>)

<span class="hljs-comment"># Cython编译版本（假设已编译为.pyd）</span>
<span class="hljs-keyword">from</span> cython_fib <span class="hljs-keyword">import</span> cython_fib

<span class="hljs-comment"># 测试性能</span>
n = <span class="hljs-number">35</span>
python_time = timeit.timeit(<span class="hljs-keyword">lambda</span>: python_fib(n), number=<span class="hljs-number">1</span>)
cython_time = timeit.timeit(<span class="hljs-keyword">lambda</span>: cython_fib(n), number=<span class="hljs-number">1</span>)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Python: <span class="hljs-subst">{python_time:<span class="hljs-number">.2</span>f}</span>s"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"Cython: <span class="hljs-subst">{cython_time:<span class="hljs-number">.2</span>f}</span>s"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"加速比: <span class="hljs-subst">{python_time/cython_time:<span class="hljs-number">.1</span>f}</span>x"</span>)
</code></pre>
<h2 data-id="heading-26">📊 总结</h2>
<p>Python的文件生态系统非常丰富，从源代码到编译文件，从配置到分发，每种文件类型都有其特定用途：</p>
<ul>
<li><strong>开发阶段</strong>：主要使用<code>.py</code>、<code>.pyx</code></li>
<li><strong>运行阶段</strong>：涉及<code>.pyc</code>、<code>.pyd</code>、<code>.so</code></li>
<li><strong>分发阶段</strong>：使用<code>.whl</code>、<code>.egg</code></li>
<li><strong>配置管理</strong>：各种配置文件</li>
</ul>
<p>掌握这些文件类型的特点和用途，能够帮助你更好地组织项目、优化性能和管理依赖。</p>
<hr/>
<p><strong>互动话题</strong>：你在项目中还遇到过哪些特殊的Python文件类型？欢迎在评论区分享你的经验！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[跨域问题深度剖析：为何CORS设置了还是报错？]]></title>    <link>https://juejin.cn/post/7573669819029028874</link>    <guid>https://juejin.cn/post/7573669819029028874</guid>    <pubDate>2025-11-18T07:56:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7573669819029028874" data-draft-id="7573710392212881435" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="跨域问题深度剖析：为何CORS设置了还是报错？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-11-18T07:56:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Function66"/> <meta itemprop="url" content="https://juejin.cn/user/2436173499477623"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            跨域问题深度剖析：为何CORS设置了还是报错？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173499477623/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Function66
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-18T07:56:57.000Z" title="Tue Nov 18 2025 07:56:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-18
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    11
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题背景</h2>
<p>最近在项目中遇到了一个棘手的跨域问题：B域名的网页被嵌入在A域名内部，B域名的接口请求也出现了跨域错误。尽管后端同学已经配置了<code>Access-Control-Allow-Origin</code>等CORS相关头部，但控制台仍然持续报跨域错误。</p>
<h2 data-id="heading-1">问题排查过程</h2>
<h3 data-id="heading-2">初步排查</h3>
<p>一开始我们按照常规跨域问题的排查思路：</p>
<ul>
<li>检查后端CORS配置是否正确</li>
<li>验证<code>Access-Control-Allow-Origin</code>头是否包含A域名</li>
<li>确认<code>Access-Control-Allow-Credentials</code>设置为true</li>
</ul>
<p>但所有这些配置都正确，问题依然存在。</p>
<h3 data-id="heading-3">深入分析</h3>
<p>经过仔细排查，发现了问题的本质：<strong>B域名没有成功携带A域名的Cookie</strong>，导致请求被服务端的passport权限拦截中间件拦截，从而触发了跨域错误。</p>
<p>这里的关键点是：即使后端正确配置了CORS，如果请求因为权限问题被前端中间件拦截，同样会表现为跨域错误。</p>
<h2 data-id="heading-4">解决方案</h2>
<h3 data-id="heading-5">方案一：种植Cookie方案</h3>
<p>javascript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// B页面中的请求处理</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">makeRequest</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();
  
  <span class="hljs-comment">// 关键：添加x-requested-with头，阻止浏览器自动处理302重定向</span>
  xhr.<span class="hljs-title function_">setRequestHeader</span>(<span class="hljs-string">'x-requested-with'</span>, <span class="hljs-string">'XMLHttpRequest'</span>);
  
  xhr.<span class="hljs-property">onreadystatechange</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">readyState</span> === <span class="hljs-number">4</span>) {
      <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">302</span>) {
        <span class="hljs-comment">// 手动处理302重定向</span>
        <span class="hljs-keyword">const</span> redirectUrl = <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>;
        <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span> = <span class="hljs-string">`/sso/logon?redirectUrl=<span class="hljs-subst">${<span class="hljs-built_in">encodeURIComponent</span>(redirectUrl)}</span>`</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (xhr.<span class="hljs-property">status</span> === <span class="hljs-number">200</span>) {
        <span class="hljs-comment">// 正常处理响应</span>
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'请求成功'</span>, xhr.<span class="hljs-property">responseText</span>);
      }
    }
  };
  
  xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'/api/data'</span>, <span class="hljs-literal">true</span>);
  xhr.<span class="hljs-title function_">send</span>();
}
</code></pre>
<p><strong>后端配合调整：</strong></p>
<p>java</p>
<pre><code class="hljs language-vbscript" lang="vbscript">// 当检测到x-requested-<span class="hljs-keyword">with</span>头时，不自动重定向
<span class="hljs-keyword">if</span> (<span class="hljs-string">"XMLHttpRequest"</span>.equals(<span class="hljs-built_in">request</span>.getHeader(<span class="hljs-string">"x-requested-with"</span>))) {
    <span class="hljs-built_in">response</span>.setStatus(<span class="hljs-number">302</span>);
    <span class="hljs-built_in">response</span>.setHeader(<span class="hljs-string">"Location"</span>, <span class="hljs-string">""</span>); // 清空或不设置Location头
    // 通过其他方式传递重定向URL，如响应体
} <span class="hljs-keyword">else</span> {
    <span class="hljs-built_in">response</span>.sendRedirect(<span class="hljs-string">"/sso/logon?redirectUrl="</span> + url);
}
</code></pre>
<p><strong>方案缺陷：</strong></p>
<ul>
<li>部分浏览器出于安全策略考虑，禁止跨域名种植Cookie</li>
<li>实现相对复杂，需要前后端协同调整</li>
</ul>
<h3 data-id="heading-6">方案二：同源部署方案（推荐）</h3>
<p>将B页面的模板直接部署到A域名的服务器上，从根本上消除跨域问题。</p>
<p><strong>实施步骤：</strong></p>
<ol>
<li>将B页面的前端资源打包部署到A域名服务</li>
<li>调整路由配置，确保B页面的访问路径在A域名下</li>
<li>更新所有相关的资源引用路径</li>
</ol>
<p>nginx</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Nginx配置示例</span>
server {
    listen 80;
    server_name a-domain.com;
    
    location /b-page/ {
        <span class="hljs-comment"># 代理到B页面服务或直接服务静态资源</span>
        proxy_pass http://b-service/;
        <span class="hljs-comment"># 或者直接服务本地文件</span>
        root /path/to/b-page-static-files;
    }
    
    location /api/ {
        proxy_pass http://b-api-service/;
    }
}
</code></pre>
<p><strong>优势：</strong></p>
<ul>
<li>彻底解决跨域问题</li>
<li>Cookie自然共享，无需特殊处理</li>
<li>更好的性能和用户体验</li>
</ul>
<h2 data-id="heading-7">技术要点总结</h2>
<h3 data-id="heading-8">1. CORS与Cookie的关系</h3>
<ul>
<li>跨域请求默认不携带Cookie</li>
<li>需要设置<code>withCredentials: true</code>（前端）和<code>Access-Control-Allow-Credentials: true</code>（后端）</li>
<li><code>Access-Control-Allow-Origin</code>不能为<code>*</code>，必须指定具体域名</li>
</ul>
<h3 data-id="heading-9">2. 302重定向的Ajax处理</h3>
<ul>
<li>默认情况下，浏览器会自动处理302重定向，前端无法拦截</li>
<li>通过<code>x-requested-with: XMLHttpRequest</code>头告知后端需要特殊处理</li>
<li>后端据此决定是否让前端手动处理重定向</li>
</ul>
<h3 data-id="heading-10">3. 跨域问题的本质</h3>
<p>跨域问题不仅仅是技术配置问题，更是安全策略的体现。浏览器的同源策略是为了保护用户数据安全。</p>
<h2 data-id="heading-11">经验教训</h2>
<ol>
<li><strong>不要盲目相信错误信息</strong>：跨域错误可能是其他问题的表象</li>
<li><strong>系统化排查</strong>：从前端到后端，从网络到安全策略全面排查</li>
<li><strong>优先选择根本解决方案</strong>：相比各种workaround，从架构层面解决问题更可靠</li>
</ol>
<h2 data-id="heading-12">结语</h2>
<p>跨域问题是前端开发中的常见挑战，理解其背后的原理和浏览器安全策略至关重要。通过这次问题的解决，我们不仅修复了bug，更重要的是加深了对Web安全机制的理解。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>