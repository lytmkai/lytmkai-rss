<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[Akamai Cloud客户案例 | IPPRA的简洁、经济、易用的云计算服务]]></title>    <link>https://juejin.cn/post/7584680708138418227</link>    <guid>https://juejin.cn/post/7584680708138418227</guid>    <pubDate>2025-12-17T11:16:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584680708138418227" data-draft-id="7584657447802601498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Akamai Cloud客户案例 | IPPRA的简洁、经济、易用的云计算服务"/> <meta itemprop="keywords" content="人工智能,云计算"/> <meta itemprop="datePublished" content="2025-12-17T11:16:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AKAMAI"/> <meta itemprop="url" content="https://juejin.cn/user/829502942352628"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Akamai Cloud客户案例 | IPPRA的简洁、经济、易用的云计算服务
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/829502942352628/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AKAMAI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:16:24.000Z" title="Wed Dec 17 2025 11:16:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>"我们必须快速获取数据，并具备在紧迫时间内管理此类项目所需的一切条件。这就是为什么让Linode（现属Akamai）协助我们变得如此重要。"</p>
<p>——俄克拉荷马大学IPPRA研究院副主任 Joe Ripberger 博士</p>
</blockquote>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251217_blogarticles236" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251217_blogarticles236" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p>
<hr/>
<p>要理解并应对社会风险，提升社区与社会的韧性，离不开海量数据和强大基础设施的支持。公共政策研究与分析研究院（IPPRA）便是最好的例证——作为全球顶尖的风险研究机构，该院致力于研究自然、科技及人为因素引发的风险，并开展相关教学与公众推广。IPPRA坐落于俄克拉荷马大学，汇聚政策、心理、传播、工程等跨领域专家，结合前沿建模技术，共同探索帮助社区增强风险应对能力的更优路径。</p>
<p>Joe Ripberger和Matthew Henderson是推动IPPRA使命的核心成员，他们的工作正让世界变得更安全。"我们研究各类风险，从能源安全、核武器等国家安全议题，到自然灾害等公共健康风险，"IPPRA研究院副主任Ripberger介绍道。</p>
<p>自该研究在俄克拉荷马大学启动以来，IPPRA的职责范围和应对的风险场景不断扩展。从最初专注于风险与危机管理，如今已发展成为跨学科研究机构，研究人员曾与美国国家科学基金会、国家海洋和大气管理局及能源部等全球关键科研组织合作。</p>
<p>研究院的部分工作包括与国家气象局合作设计调查问卷，分析人们如何接收、理解不同天气预警信息并采取防护行动。研究人员通过分析收集的数据，在地方和区域层面构建精准的危险天气系统社区预警机制。</p>
<p>另一项研究则关注新冠疫情中的公众认知与错误信息。2020年3月，IPPRA团队开始分析数百万条疫情相关社交媒体帖子，并与全国性调查数据交叉比对，通过数据集对比深入解析错误信息与个人疫情认知对行为决策的影响。</p>
<p>这些关键且及时的研究成果，既帮助政策制定者理解准确健康信息对行为的正向引导作用，也为其评估错误信息导致负面健康后果的行为影响提供了衡量依据。</p>
<p><strong><strong>简洁、经济、易用的云计算服务</strong></strong></p>
<p>面对如此规模的研究项目，IPPRA研究团队需要可靠的云基础设施合作伙伴来处理海量信息。正因如此，Ripberger、Henderson及其团队与Linode（现属Akamai）已保持逾十年合作。</p>
<p>借助灵活可扩展的数据存储架构和便捷的信息获取能力，IPPRA团队在持续收集数据的同时能够无缝呈现研究成果。这种能力使研究人员得以通过数据构建重要合作关系，并始终保持研究完整性。</p>
<p>"这正是Linode（现属Akamai）多年来对我们至关重要的原因之一，"研究院研究支持与整合副主任Henderson强调，"我们大量项目需要在线上线下灵活切换，必须确保快速响应能力。"</p>
<p>对于需在物理防火墙后运行的工作负载，IPPRA采用云基础设施与本地资源混合的部署模式。</p>
<p>Akamai（原Linode）以符合研究院预算规划的固定价格提供云计算服务，持续赋能IPPRA的前沿研究。Ripberger指出，在学术领域，成本预判往往直接决定项目能否立项："实现可靠的成本预估，赋予我们推进项目的充足信心。计算资源绝不能超支，因为我们根本无法承担赤字运营。"</p>
<p>随着IPPRA研究团队持续探索全球社区风险应对新路径，Henderson和Ripberger深信，与Akamai的合作将始终助力这个具有前瞻思维的团队保持这项宝贵研究的领先优势。</p>
<p><strong><strong>关于IPPRA</strong></strong></p>
<p>IPPRA团队通过融合公共政策学术研究与物理工程科学，致力于构建合作伙伴关系并开展前沿研究。其工作聚焦解决复杂公共政策问题，创造贯通自然、科技与社会系统的机遇，从而提升人类福祉，优化社会选择基础设施，增强社会韧性。</p>
<hr/>
<p>如您所在的企业也在考虑采购云服务或进行云迁移，</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.akamai.com%2Fzh%2Flp%2Fakamai-cloud-computing-freetrial%3Futm_campaign%3Df-mc-65893%26utm_id%3Dapj_cc%26utm_source%3Djuejin%26utm_medium%3Darticle_advertorial%26utm_content%3Djuejin_251217_blogarticles236_end" target="_blank" title="https://www.akamai.com/zh/lp/akamai-cloud-computing-freetrial?utm_campaign=f-mc-65893&amp;utm_id=apj_cc&amp;utm_source=juejin&amp;utm_medium=article_advertorial&amp;utm_content=juejin_251217_blogarticles236_end" ref="nofollow noopener noreferrer">点击链接</a>了解Akamai Linode解决方案，现在申请试用可得高达5000美元专属额度</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Nop入门：增加DSL模型解析器]]></title>    <link>https://juejin.cn/post/7584653722593525812</link>    <guid>https://juejin.cn/post/7584653722593525812</guid>    <pubDate>2025-12-17T11:26:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584653722593525812" data-draft-id="7584472215976067087" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Nop入门：增加DSL模型解析器"/> <meta itemprop="keywords" content="后端,架构,Spring Boot"/> <meta itemprop="datePublished" content="2025-12-17T11:26:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="canonical_entropy"/> <meta itemprop="url" content="https://juejin.cn/user/4212984289694429"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Nop入门：增加DSL模型解析器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4212984289694429/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    canonical_entropy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:26:22.000Z" title="Wed Dec 17 2025 11:26:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nop平台为开发自定义DSL（Domain Specific Language，领域特定语言）提供了一系列基础设施，核心机制是通过XDef元模型（Nop平台的元模型语言）定义XML格式的语法结构，然后自动根据XDef生成AST（Abstract Syntax Tree，抽象语法树）节点类，并实现解析器、
生成器、验证器等工具。具体介绍参见<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FgEvFblzpQghOfr9qzVRydA" target="_blank" title="https://mp.weixin.qq.com/s/gEvFblzpQghOfr9qzVRydA" ref="nofollow noopener noreferrer">XDef：一种面向演化的元模型及其构造哲学</a>。</p>
<p>虽然XDef元模型语言采用XML语法格式，但这并不意味着Nop平台中的DSL只能使用XML格式表达。实际上，根据<strong>可逆计算理论</strong>, 同一信息结构具有多种表达形式，这些表达形式之间可以自动进行可逆转换。</p>
<p>本文将介绍如何为DSL引入Markdown语法格式，并演示如何实现Markdown与XML/JSON之间的双向转换。</p>
<p>为了更好地理解如何扩展DSL加载器，我们首先需要了解Nop平台的核心模块结构：</p>
<h2 data-id="heading-0">1. nop-kernel核心模块</h2>
<p>Nop平台内置了丰富的模块，但用于支持DSL定义和实现的核心部分（也是可逆计算理论的实现核心）完全集中在<code>nop-kernel</code>目录下。该目录包含以下关键子模块：</p>
<ol>
<li><strong>nop-dependencies</strong>: 统一管理Nop平台使用的外部第三方依赖库版本</li>
<li><strong>nop-api-core</strong>: 提供各类注解以及<code>ApiRequest</code>/<code>ApiResponse</code>等框架级别的DTO定义</li>
<li><strong>nop-commons</strong>: 包含各种工具类（Utility Helpers）</li>
<li><strong>nop-core</strong>: 实现虚拟文件系统、XML/JSON等基础格式解析器和反射机制</li>
<li><strong>nop-javac</strong>: 对Java内置JavaC编译器的封装</li>
<li><strong>nop-dataset</strong>: 封装<code>IRecordInput</code>/<code>IDataSet</code>接口，统一处理各类列表数据和表格数据</li>
<li><strong>nop-xdefs</strong>: 集中存放Nop平台内置的所有XDef元模型</li>
<li><strong>nop-xlang</strong>: 实现Xpl模板语言、XScript脚本语言以及Delta合并算法</li>
<li><strong>nop-antlr4</strong>: 为XScript脚本语言提供antlr4扩展和封装支持</li>
<li><strong>nop-codegen</strong>: 提供<code>XCodeGenerator</code>代码生成器</li>
<li><strong>nop-record-mapping</strong>: 实现异构对象映射模型，用于辅助实现Markdown结构与一般模型对象之间的双向映射</li>
<li><strong>nop-markdown</strong>: 为Markdown格式的DSL解析提供额外封装，包含一个简易的Markdown解析器</li>
<li><strong>nop-kernel-cli</strong>: 演示用的命令行工具，提供<code>convert</code>（模型格式转换）和<code>gen</code>（模板驱动代码生成）两个指令</li>
</ol>
<ul>
<li>其中，<code>nop-kernel-cli</code>模块下的<code>demo</code>目录包含了DSL自定义解析器和自定义代码生成模板的示例</li>
</ul>
<p>了解了核心模块结构后，接下来我们将学习如何为DSL注册自定义加载器：</p>
<h2 data-id="heading-1">2. 注册加载器</h2>
<p>在Nop平台中，所有DSL文件格式都对应一个唯一的文件类型(fileType)。
全局模型加载器<code>ResourceComponentManager</code>在加载文件时会根据文件类型动态确定使用的加载器。</p>
<p>因此，为了给<code>orm.xml</code>这种文件定义DSL加载器，需要编写<code>/nop/core/registry/orm.register-model.xml</code></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">model</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/register-model.xdef"</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span>
       <span class="hljs-attr">name</span>=<span class="hljs-string">"orm"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">loaders</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- 为XML/JSON/YAML格式注册内置加载器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xdsl-loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.xml"</span> <span class="hljs-attr">schemaPath</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xdsl-loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.json"</span> <span class="hljs-attr">schemaPath</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xdsl-loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.yaml"</span> <span class="hljs-attr">schemaPath</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span>/&gt;</span>

    <span class="hljs-comment">&lt;!-- 为Markdown格式注册自定义加载器 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">loader</span> <span class="hljs-attr">fileType</span>=<span class="hljs-string">"orm.md"</span> <span class="hljs-attr">mappingName</span>=<span class="hljs-string">"orm.Md_to_OrmModel"</span>
            <span class="hljs-attr">class</span>=<span class="hljs-string">"io.nop.record_mapping.md.MarkdownDslResourceLoaderFactory"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">loaders</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">model</span>&gt;</span>
</code></pre>
<p>上述配置文件定义了ORM模型的加载器注册信息：</p>
<ul>
<li><code>xdsl-loader</code>：用于配置XML/JSON/YAML格式的模型加载器。Nop平台内置了<code>DslJsonResourceLoader</code>和<code>DslXmlResourceLoader</code>，它们会根据文件类型自动选择合适的解析器。</li>
<li><code>loader</code>：用于定义扩展加载器，可支持自定义文件格式。
<ul>
<li><code>fileType</code>：指定文件类型标识符</li>
<li><code>mappingName</code>：指定用于解析的映射规则名称</li>
<li><code>class</code>：指定加载器工厂类的实现路径，需实现<code>IResourceObjectLoaderFactory</code>或<code>IResourceObjectLoader</code>接口</li>
</ul>
</li>
</ul>
<p>以下是相关接口的定义：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 资源对象加载器工厂接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IResourceObjectLoaderFactory</span>&lt;T&gt; {
    IResourceObjectLoader&lt;T&gt; <span class="hljs-title function_">newResourceObjectLoader</span><span class="hljs-params">(ComponentModelConfig config, Map&lt;String, Object&gt; attributes)</span>;
}

<span class="hljs-comment">// 资源对象加载器接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IResourceObjectLoader</span>&lt;T&gt; {
  T <span class="hljs-title function_">loadObjectFromResource</span><span class="hljs-params">(IResource resource)</span>;
}

<span class="hljs-comment">// 资源对象保存器接口</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IResourceObjectSaver</span>&lt;T&gt; {
  <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveObjectToResource</span><span class="hljs-params">(IResource resource, T obj)</span>;
}
</code></pre>
<p>MarkdownDslResourceLoaderFactory返回的MarkdownDslResourceLoader实现了如下四个接口</p>
<ul>
<li><code>IResourceObjectLoader</code>: 解析资源文件得到模型对象</li>
<li><code>IResourceObjectSaver</code>: 将模型对象保存到资源文件中</li>
<li><code>IResourceDslNodeLoader</code>: 解析资源文件得到XNode（Nop平台中通用的DSL抽象语法树节点，用于统一表示不同格式的DSL结构）</li>
<li><code>IResourceDslNodeSaver</code>: 将XNode保存到资源文件中</li>
</ul>
<p>除了<code>IResourceObjectLoader</code>接口之外，其他三个接口都是可选的。实现这些接口后，就可以支持双向转换功能。</p>
<p>注册完加载器后，我们需要定义Markdown与模型对象之间的映射规则。这正是<code>RecordMapping</code>机制的用武之地：</p>
<h2 data-id="heading-2">3. 基于Mapping模型的Markdown解析和生成</h2>
<p><code>RecordMapping</code>是Nop平台内置的对象映射机制，用于定义两个异构Java对象之间的相互映射规则，支持字段映射、类型转换、表达式计算等功能。
在RecordMapping格式的基础上补充<code>md:format</code>等扩展字段信息，就可以实现MarkdownSection对象与DSL模型对象之间的映射。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/record/record-mappings.xdef"</span>
             <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"md"</span> <span class="hljs-attr">x:dump</span>=<span class="hljs-string">"true"</span>&gt;</span>


  <span class="hljs-comment">&lt;!-- 定义从Markdown到ORM模型的映射规则 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_OrmModel"</span> <span class="hljs-attr">md:titleField</span>=<span class="hljs-string">"displayName"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">fields</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 直接映射displayName字段 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"displayName"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"displayName"</span>/&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射extends字段，并指定别名 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"x:extends"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"extends"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Extends"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"string"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射实体定义，使用Md_to_EntityModel作为子项映射规则 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"entities"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"实体定义"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Entities"</span> <span class="hljs-attr">keyProp</span>=<span class="hljs-string">"name"</span>
             <span class="hljs-attr">itemMapping</span>=<span class="hljs-string">"Md_to_EntityModel"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">fields</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

  <span class="hljs-comment">&lt;!-- 定义从Markdown到实体模型的映射规则 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_EntityModel"</span> <span class="hljs-attr">md:titleField</span>=<span class="hljs-string">"name"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">fields</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- 映射对象名，使用表达式生成完整类名 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"对象名"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Object Name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"class-name"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">valueExpr</span>&gt;</span>
          value?.$fullClassName(rootRecord['ext:entityPackageName'])
        <span class="hljs-tag">&lt;/<span class="hljs-name">valueExpr</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射表名，设置为必填字段 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"tableName"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"表名"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Table Name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"prop-name"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射中文名，设置为必填字段 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"displayName"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"中文名"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Chinese Name"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">schema</span> <span class="hljs-attr">stdDomain</span>=<span class="hljs-string">"string"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射字段列表，指定为表格格式 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"columns"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"字段列表"</span> <span class="hljs-attr">keyProp</span>=<span class="hljs-string">"name"</span>
             <span class="hljs-attr">alias</span>=<span class="hljs-string">"Column List"</span> <span class="hljs-attr">itemMapping</span>=<span class="hljs-string">"Md_to_ColumnModel"</span> <span class="hljs-attr">md:format</span>=<span class="hljs-string">"table"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- 映射关联列表，指定为表格格式 --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"relations"</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"关联列表"</span> <span class="hljs-attr">alias</span>=<span class="hljs-string">"Relation List"</span>
             <span class="hljs-attr">itemMapping</span>=<span class="hljs-string">"Md_to_RelationModel"</span> <span class="hljs-attr">md:format</span>=<span class="hljs-string">"table"</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

    <span class="hljs-tag">&lt;/<span class="hljs-name">fields</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<p>Nop平台通过<code>MappingBasedMarkdownParser</code>和<code>MappingBasedMarkdownGenerator</code>根据Mapping模型配置实现解析与生成功能：</p>
<ul>
<li><code>md:titleField</code>: 用于指定标题对应的解析字段</li>
<li><code>md:format</code>: 指定字段对应的Markdown格式，目前支持<code>table|code</code>，分别对应表格格式和代码块格式</li>
</ul>
<p>我们约定了简单的Markdown编码规则：</p>
<ol>
<li>每个section只能是List/Table/CodeBlock等几种格式</li>
<li>通过子section实现复杂对象，标题对应属性名</li>
<li>若section对应于List，则每个子section对应一个对象，此时section的标题对应对象的titleField</li>
</ol>
<p>以下是一个完整的Markdown格式ORM模型示例：</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section"># AI模型管理</span>

<span class="hljs-bullet">-</span> extends:  demo.orm.md

<span class="hljs-section">## gen-extends</span>
<span class="hljs-code">```xml
&lt;orm-gen:DefaultPostExtends xpl:lib="/xlib/orm-gen.xlib"/&gt;
```</span>

<span class="hljs-section">## 5 实体定义</span>

<span class="hljs-section">### 5.1 NopAiProject</span>

<span class="hljs-bullet">-</span> 表名: nop<span class="hljs-emphasis">_ai_</span>project
<span class="hljs-bullet">-</span> 类名: NopAiProject
<span class="hljs-bullet">-</span> 中文名: AI项目
<span class="hljs-bullet">-</span> 备注: 存储AI项目基本信息

<span class="hljs-section">#### 5.1.1 字段列表</span>

|编号|标签|主键|非空|字段名|属性名|显示|中文名|英文名|数据域|标准域|类型|长度|小数位数|字典|备注|缺省值|控件|根节点级别|
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 1 | seq | true | true | id | id | X | 主键 |  |  |  | VARCHAR | 36 |  |  |  |  |  |  |
| 2 |  | false | true | language | language |  | 项目语言 |  |  |  | VARCHAR | 4 |  | ai/project<span class="hljs-emphasis">_language | 项目使用的编程语言类型：JAVA, PYTHON等 |  |  |  |
| 3 |  | false | true | name | name |  | 项目名称 |  |  |  | VARCHAR | 100 |  |  |  |  |  |  |
| 4 |  | false | false | prototype_</span>id | prototypeId |  | 模板项目ID |  |  |  | VARCHAR | 36 |  |  |  |  |  |  |
| 5 |  | false | false | project<span class="hljs-emphasis">_dir | projectDir |  | 项目目录 |  |  |  | VARCHAR | 400 |  |  | 项目在文件系统中的存储路径，例如：/data/projects/order-system |  | textarea |  |

</span></code></pre>
<p>上述Markdown文件解析后得到的XML格式如下：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">orm</span> <span class="hljs-attr">ext:mavenArtifactId</span>=<span class="hljs-string">"nop-ai"</span> <span class="hljs-attr">ext:entityPackageName</span>=<span class="hljs-string">"io.nop.ai.dao.entity"</span> <span class="hljs-attr">ext:allowIdAsColName</span>=<span class="hljs-string">"true"</span>
     <span class="hljs-attr">ext:basePackageName</span>=<span class="hljs-string">"io.nop.ai"</span> <span class="hljs-attr">ext:appName</span>=<span class="hljs-string">"nop-ai"</span> <span class="hljs-attr">ext:registerShortName</span>=<span class="hljs-string">"true"</span>
     <span class="hljs-attr">ext:mavenGroupId</span>=<span class="hljs-string">"io.github.entropy-cloud"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/orm/orm.xdef"</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span>
     <span class="hljs-attr">xmlns:ext</span>=<span class="hljs-string">"ext"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"AI模型管理"</span>
     <span class="hljs-attr">xmlns:ui</span>=<span class="hljs-string">"ui"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entities</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">entity</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"io.nop.ai.dao.entity.NopAiProject"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"AI项目"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"io.nop.ai.dao.entity.NopAiProject"</span>
            <span class="hljs-attr">registerShortName</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">tableName</span>=<span class="hljs-string">"nop_ai_project"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">columns</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"主键"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"36"</span> <span class="hljs-attr">primary</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"1"</span>
                <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span> <span class="hljs-attr">tagSet</span>=<span class="hljs-string">"seq"</span> <span class="hljs-attr">ui:show</span>=<span class="hljs-string">"X"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"language"</span> <span class="hljs-attr">comment</span>=<span class="hljs-string">"项目使用的编程语言类型：JAVA, PYTHON等"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"项目语言"</span>
                <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span>
                <span class="hljs-attr">name</span>=<span class="hljs-string">"language"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"4"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"2"</span> <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>
                <span class="hljs-attr">ext:dict</span>=<span class="hljs-string">"ai/project_language"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"项目名称"</span> <span class="hljs-attr">mandatory</span>=<span class="hljs-string">"true"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"100"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"3"</span>
                <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"prototype_id"</span> <span class="hljs-attr">displayName</span>=<span class="hljs-string">"模板项目ID"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"prototypeId"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"36"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"4"</span>
                <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">column</span> <span class="hljs-attr">code</span>=<span class="hljs-string">"project_dir"</span> <span class="hljs-attr">comment</span>=<span class="hljs-string">"项目在文件系统中的存储路径，例如：/data/projects/order-system"</span>
                <span class="hljs-attr">displayName</span>=<span class="hljs-string">"项目目录"</span>
                <span class="hljs-attr">name</span>=<span class="hljs-string">"projectDir"</span> <span class="hljs-attr">precision</span>=<span class="hljs-string">"400"</span> <span class="hljs-attr">propId</span>=<span class="hljs-string">"5"</span> <span class="hljs-attr">stdDataType</span>=<span class="hljs-string">"string"</span> <span class="hljs-attr">stdSqlType</span>=<span class="hljs-string">"VARCHAR"</span>
                <span class="hljs-attr">ui:control</span>=<span class="hljs-string">"textarea"</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">columns</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>存储AI项目基本信息<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">entity</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">entities</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">orm</span>&gt;</span>
</code></pre>
<p>可以看到，Markdown中定义的字段列表（表格格式）被正确转换为XML中的<code>&lt;columns&gt;</code>节点，包括字段名称、数据类型、约束条件等信息都被准确映射。</p>
<p>完成了加载器注册和映射规则定义后，我们就可以使用<code>nop-kernel-cli</code>工具进行实际的模型转换和代码生成操作了：</p>
<h2 data-id="heading-3">4. 通过元编程自动生成反向映射</h2>
<p>Nop平台提供了强大的元编程能力，可以根据已定义的正向映射自动生成反向映射配置。例如，当我们定义了从Markdown到ORM模型的映射<code>Md_to_OrmModel</code>后，系统可以自动生成从ORM模型到Markdown的反向映射<code>OrmModel_to_Md</code>。</p>
<h3 data-id="heading-4">4.1 自动生成反向映射的配置</h3>
<p>通过在RecordMapping配置中添加<code>record-mapping-gen:GenReverseMappings</code>扩展，系统会自动为所有正向映射生成对应的反向映射：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/record/record-mappings.xdef"</span>
             <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"md"</span> <span class="hljs-attr">x:dump</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:post-extends</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"/nop/record/xlib/record-mapping-gen.xlib"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">record-mapping-gen:GenReverseMappings</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:post-extends</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 正向映射配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_OrmModel"</span> <span class="hljs-attr">...</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 正向映射规则 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 系统会自动生成OrmModel_to_Md反向映射 --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<p>执行后，系统会自动生成名为<code>OrmModel_to_Md</code>的反向映射，其字段映射关系与<code>Md_to_OrmModel</code>相反，确保数据可以在两种格式之间无损转换。</p>
<h3 data-id="heading-5">4.2 差量修正反向映射配置</h3>
<p>自动生成的反向映射可能无法完全满足所有需求，这时可以在当前文件中添加差量修正部分来微调配置。根据可逆计算理论，差量定义与全量定义格式完全一致。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">definitions</span> <span class="hljs-attr">xmlns:x</span>=<span class="hljs-string">"/nop/schema/xdsl.xdef"</span> <span class="hljs-attr">x:schema</span>=<span class="hljs-string">"/nop/schema/record/record-mappings.xdef"</span>
             <span class="hljs-attr">xmlns:md</span>=<span class="hljs-string">"md"</span> <span class="hljs-attr">x:dump</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">x:post-extends</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">c:import</span> <span class="hljs-attr">from</span>=<span class="hljs-string">"/nop/record/xlib/record-mapping-gen.xlib"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">record-mapping-gen:GenReverseMappings</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">x:post-extends</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- 正向映射配置 --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"Md_to_OrmModel"</span> <span class="hljs-attr">...</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 正向映射规则 --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">mapping</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"EntityModel_to_Md"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">fields</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"对象名"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">valueExpr</span>&gt;</span>
                    value?.$removePackageName(sourceRoot['ext:entityPackageName']);
                <span class="hljs-tag">&lt;/<span class="hljs-name">valueExpr</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>

            <span class="hljs-tag">&lt;<span class="hljs-name">field</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"类名"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">valueExpr</span>&gt;</span>
                    value?.$removePackageName(sourceRoot['ext:entityPackageName']);
                <span class="hljs-tag">&lt;/<span class="hljs-name">valueExpr</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">field</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">fields</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">mapping</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">definitions</span>&gt;</span>
</code></pre>
<h2 data-id="heading-6">5. 使用nop-kernel-cli执行模型转换和代码生成</h2>
<p>完成DSL加载器配置后，可以使用<code>nop-kernel-cli</code>工具执行模型格式转换和代码生成操作。以下是常用命令示例：</p>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">将XML格式的ORM模型转换为Markdown格式</span>
java -jar nop-kernel-cli.jar convert demo.orm.xml -o=demo.orm.md
<span class="hljs-meta prompt_">
# </span><span class="bash">将Markdown格式的ORM模型转换回XML格式</span>
java -jar nop-kernel-cli.jar convert demo.orm.md -o=demo.orm.xml
<span class="hljs-meta prompt_">
# </span><span class="bash">基于Markdown格式的ORM模型生成代码</span>
java -jar nop-kernel-cli.jar gen demo.orm.md -t=/nop/templates/orm -o=target
</code></pre>
<p>通过上述命令，我们可以实现不同格式DSL模型之间的双向转换，以及基于这些模型的代码生成，充分体现了Nop平台的灵活性和可逆计算理论的实践价值。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（15）Netty的线程模型是什么？它有哪些线程池类型？]]></title>    <link>https://juejin.cn/post/7584633505105690676</link>    <guid>https://juejin.cn/post/7584633505105690676</guid>    <pubDate>2025-12-17T11:55:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105690676" data-draft-id="7584653722593558580" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（15）Netty的线程模型是什么？它有哪些线程池类型？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T11:55:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（15）Netty的线程模型是什么？它有哪些线程池类型？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:55:55.000Z" title="Wed Dec 17 2025 11:55:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty的线程模型是基于事件循环的，它使用了一种称为"Reactor"模式的设计模式。在Netty中，所有的I/O操作都是异步的，通过事件驱动的方式进行处理。</p>
<p>Netty的线程模型主要由两个部分组成：EventLoopGroup和EventLoop。</p>
<ol>
<li>
<p>EventLoopGroup：
EventLoopGroup是一个线程池，负责管理一组EventLoop。它可以有多个EventLoop，并且可以选择使用不同的线程池类型。EventLoopGroup通常用于处理连接的接受和建立，并将连接分配给EventLoop进行处理。</p>
</li>
<li>
<p>EventLoop：
EventLoop是一个单独的线程，负责处理事件和执行任务。每个EventLoop都绑定到一个特定的线程，并且只能在绑定的线程上执行任务。EventLoop通过事件循环（Event Loop）来处理事件，包括接收数据、处理数据、发送数据和定时任务等。</p>
</li>
</ol>
<p>Netty提供了不同类型的线程池，可以根据实际需求选择合适的线程池类型。以下是一些常见的线程池类型：</p>
<ol>
<li>NioEventLoopGroup：基于Java NIO的线程池，适用于TCP和UDP传输。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();
</code></pre>
<ol start="2">
<li>OioEventLoopGroup：基于Java IO的线程池，适用于阻塞I/O。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OioEventLoopGroup</span>();
</code></pre>
<ol start="3">
<li>EpollEventLoopGroup：基于Linux epoll的线程池，适用于高性能的TCP传输。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">EpollEventLoopGroup</span>();
</code></pre>
<ol start="4">
<li>KQueueEventLoopGroup：基于BSD kqueue的线程池，适用于高性能的TCP传输。</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">KQueueEventLoopGroup</span>();
</code></pre>
<p>通过选择合适的线程池类型，可以充分利用底层操作系统的特性和优化，提高Netty应用程序的性能和可扩展性。</p>
<p>以下是一个使用NioEventLoopGroup的示例代码：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">EventLoopGroup</span> <span class="hljs-variable">group</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NioEventLoopGroup</span>();

<span class="hljs-keyword">try</span> {
    <span class="hljs-type">ServerBootstrap</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServerBootstrap</span>();
    b.group(group)
            .channel(NioServerSocketChannel.class)
            .childHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyChannelInitializer</span>())
            .option(ChannelOption.SO_BACKLOG, <span class="hljs-number">128</span>)
            .childOption(ChannelOption.SO_KEEPALIVE, <span class="hljs-literal">true</span>);

    <span class="hljs-type">ChannelFuture</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> b.bind(port).sync();
    f.channel().closeFuture().sync();
} <span class="hljs-keyword">finally</span> {
    group.shutdownGracefully();
}
</code></pre>
<p>在上面的示例中，我们创建了一个NioEventLoopGroup，并将其作为参数传递给ServerBootstrap。通过调用bind()方法来绑定端口，并最终调用closeFuture()方法来关闭服务器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Netty（16）Netty的零拷贝机制是什么？它如何提高性能？]]></title>    <link>https://juejin.cn/post/7584633505105707060</link>    <guid>https://juejin.cn/post/7584633505105707060</guid>    <pubDate>2025-12-17T11:57:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105707060" data-draft-id="7584653722593574964" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Netty（16）Netty的零拷贝机制是什么？它如何提高性能？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T11:57:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Netty（16）Netty的零拷贝机制是什么？它如何提高性能？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T11:57:25.000Z" title="Wed Dec 17 2025 11:57:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Netty的零拷贝（Zero-copy）机制是一种优化技术，用于在数据传输过程中减少数据拷贝的次数，从而提高性能和降低CPU开销。</p>
<p>传统的I/O操作中，数据通常需要从内核空间（Kernel Space）拷贝到用户空间（User Space），然后再进行处理或发送。这个过程涉及了多次数据拷贝，会增加CPU的负载和内存带宽的消耗。</p>
<p>Netty的零拷贝机制通过使用操作系统提供的特性来避免数据拷贝，从而提高性能。具体来说，Netty使用了以下两种技术来实现零拷贝：</p>
<ol>
<li>零拷贝文件传输：
Netty通过FileRegion接口，实现了零拷贝的文件传输。当需要将文件从一个地方传输到另一个地方时，Netty可以直接将文件描述符传递给操作系统，而不需要将文件的内容拷贝到用户空间。这样可以避免数据在内核空间和用户空间之间的多次拷贝。</li>
</ol>
<p>以下是一个示例代码，演示了如何使用零拷贝实现文件传输：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">File</span> <span class="hljs-variable">file</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"path/to/file"</span>);
<span class="hljs-type">RandomAccessFile</span> <span class="hljs-variable">raf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RandomAccessFile</span>(file, <span class="hljs-string">"r"</span>);

<span class="hljs-type">FileChannel</span> <span class="hljs-variable">channel</span> <span class="hljs-operator">=</span> raf.getChannel();
<span class="hljs-type">long</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
<span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> file.length();

ctx.write(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultFileRegion</span>(channel, position, count));
</code></pre>
<p>在上面的示例中，我们创建了一个FileRegion对象，并将其写入到Channel中进行传输。通过使用DefaultFileRegion，Netty可以直接传递文件描述符给操作系统，而不需要进行数据拷贝。</p>
<ol start="2">
<li>零拷贝内存传输：
Netty通过使用Direct Memory（直接内存）来实现零拷贝的内存传输。直接内存是一种在堆外分配的内存，可以直接与操作系统进行交互。在Netty中，通过使用ByteBuf的零拷贝特性，可以在内存之间直接传输数据，而不需要进行额外的拷贝操作。</li>
</ol>
<p>以下是一个示例代码，演示了如何使用零拷贝实现内存传输：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">ByteBuf</span> <span class="hljs-variable">buffer</span> <span class="hljs-operator">=</span> Unpooled.directBuffer();
buffer.writeBytes(<span class="hljs-string">"Hello, Netty!"</span>.getBytes());

ctx.write(buffer);
</code></pre>
<p>在上面的示例中，我们创建了一个Direct Buffer（直接缓冲区），并将数据写入到其中。通过使用Direct Buffer，Netty可以直接将数据传递给操作系统，而不需要进行数据拷贝。</p>
<p>通过使用零拷贝机制，Netty可以减少数据拷贝的次数，降低CPU的负载和内存带宽的消耗，从而提高性能和吞吐量。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SIGGRAPH Asia 2025：摩尔线程赢图形顶会3DGS挑战赛大奖，自研LiteGS全面开源]]></title>    <link>https://juejin.cn/post/7584680708138238003</link>    <guid>https://juejin.cn/post/7584680708138238003</guid>    <pubDate>2025-12-17T10:13:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584680708138238003" data-draft-id="7584657447802322970" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SIGGRAPH Asia 2025：摩尔线程赢图形顶会3DGS挑战赛大奖，自研LiteGS全面开源"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-17T10:13:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SIGGRAPH Asia 2025：摩尔线程赢图形顶会3DGS挑战赛大奖，自研LiteGS全面开源
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:13:02.000Z" title="Wed Dec 17 2025 10:13:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>12 月 17 日，在香港举办的全球图形学领域备受瞩目的顶级学术盛会 SIGGRAPH Asia 2025 上，摩尔线程在 3D Gaussian Splatting Reconstruction Challenge（3DGS 重建挑战赛）中凭借自研技术 LiteGS 出色的算法实力和软硬件协同优化能力，斩获大赛银奖，再次证明摩尔线程在新一代图形渲染技术上的深度积累与学术界的高度认可。 <br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/552761f19ba8419ea2beff725acdc12d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=pM4u98HZlG9SL7%2FzNTPJk5H45NI%3D" alt="图片" loading="lazy"/></p>
<p>3DGS：下一代图形渲染的范式革命</p>
<p>开启 AI 加速的高效渲染时代</p>
<p>3D Gaussian Splatting（3DGS，三维高斯溅射）是 2023 年提出的一项革命性 3D 场景表示与渲染技术，以可参数化的 3D 高斯分布为核心，实现了画质、效率与资源占用之间的卓越平衡。与传统 NeRF 相比，3DGS 在保持逼真渲染质量的前提下，将渲染效率提升数百至上千倍，并在光线追踪、VR/AR 实时渲染、多模态融合等方向展现出极强的适应性与扩展性。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c4eeed73d7754990ac9f6e0aaefb87d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=2OaB681wVkDQ3OvHibY6R28HILo%3D" alt="图片" loading="lazy"/></p>
<p>（* 上图仅作示意）</p>
<p>作为近年来快速发展的神经渲染技术，3DGS 不仅在三维重建与实时渲染等方向展现出卓越优势，也在更广泛的 AI 场景中具备潜在的基础价值。尤其是在具身智能（Embodied AI）等需要智能体理解并与真实环境交互的前沿领域，高质量、低延迟的三维环境建模至关重要。3DGS 以其高保真场景显示、快速优化能力和轻量级结构，为构建准确的世界模型提供了可靠支撑，有助于提升路径规划、环境感知和复杂操作任务的能力。随着 AI 技术向 “理解并操作真实世界” 方向不断延展，3DGS 正逐渐成为具身智能训练场景中的关键基础技术之一。</p>
<p>正因其对未来图形学技术路线的关键意义，3DGS 已成为全球学术界与产业界竞相投入的研究方向，受到 SIGGRAPH Asia 等权威机构的高度关注。</p>
<p>极致挑战：60 秒高质量重建</p>
<p>推动 3DGS 技术走向实用化临界点</p>
<p>本次竞赛为参赛团队设置了极具挑战性的任务：参赛者需在 60 秒内，基于主办方提供的真实终端视频序列（10–30 秒）、存在误差的相机轨迹以及终端 SLAM 点云，在极短时间内完成完整的 3DGS 高质量重建。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c87bd05ae60410fb50149c244a46757~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=Co0Jp%2FpxKOR9ok4R7hBofNFz7xQ%3D" alt="图片" loading="lazy"/></p>
<p>主办方以 PSNR（重建质量）与重建速度为综合评价指标，力求在完全公开、公正的条件下得出权威排名。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eedccefa71ee427f9abc0630b033e777~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=5j3TzDmRvXcUkirjJX2Cfz1M3SA%3D" alt="图片" loading="lazy"/></p>
<p>目前 3D Gaussian Splatting Reconstruction Challenge（3DGS 重建挑战赛）的结果及数据集已向全球公开，相关资料可在 SIGGRAPH Asia 官方网站获取。</p>
<p>地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgaplab.cuhk.edu.cn%2Fprojects%2FgsRaceSIGA2025%2F" target="_blank" title="https://gaplab.cuhk.edu.cn/projects/gsRaceSIGA2025/" ref="nofollow noopener noreferrer">gaplab.cuhk.edu.cn/projects/gs…</a></p>
<p>摩尔线程的技术答卷</p>
<p>以全栈能力实现精度与速度的极致平衡</p>
<p>摩尔线程 AI 团队以参赛编号 “MT-AI” 进入决赛阶段，在重建精度与效率两项指标上取得均衡且亮眼的表现：</p>
<ul>
<li>
<p>平均 PSNR：27.58（位列前三）</p>
</li>
<li>
<p>重建耗时：34 秒（显著领先多数队伍）</p>
</li>
</ul>
<p>凭借行业领先的 3DGS 算法构建能力与软硬件协同优化优势，摩尔线程最终获得二等奖（银牌）的优秀成绩。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/14c21f2c651c4cb2a502b5c1e9f9fdfa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=TvuSIf9svVQczJwsj24Ydswa7OU%3D" alt="图片" loading="lazy"/></p>
<p>开放协作</p>
<p>摩尔线程开源 3DGS 基础库 LiteGS</p>
<p>作为一种新兴的场景表示与新视角合成技术，3DGS 凭借高渲染质量与实时渲染速度，在计算机图形学与视觉领域实现了显著突破。该技术通过数以百万计的各向异性三维高斯基元来表示三维场景，以实现逼真的渲染效果，并在自动驾驶、虚拟现实、数字孪生等领域展现出巨大潜力。然而，尽管 3DGS 的渲染速度极快，其训练过程却往往需要数十分钟甚至数小时，成为制约其广泛应用的主要瓶颈。现有优化方案往往仅从单一层面入手，难以系统性地解决训练过程中的性能制约。</p>
<p>为此，摩尔线程自主研发了 3DGS 基础库 LiteGS，首次实现了从底层 GPU 系统、中层数据管理到高层算法设计的全链路协同优化：</p>
<ul>
<li>
<p>在 GPU 系统层面，摩尔线程创新提出基于 “One Warp Per Tile” 原则的 “Warp-Based Raster” 新范式，将梯度聚合简化为一次 Warp 内归约，并结合扫描线算法与混合精度策略，大幅降低梯度计算开销，同时实现高效的像素级统计能力；</p>
</li>
<li>
<p>在数据管理层，引入 “聚类-剔除-压缩” 流水线，借助 Morton 编码以极低开销对高斯基元进行动态空间重排，显著提升数据局部性，减少缓存失效与 Warp 分支；</p>
</li>
<li>
<p>在算法设计层，摒弃原有模糊的度量指标，采用更为鲁棒的像素不透明度梯度方差作为致密化的核心判据，精准识别欠拟合区域，其轻量化计算直接受益于底层光栅化器的高效统计支持。</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c35476dc45384f6d9226d698423f5856~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=hLqvscMt4e5iWsb5sOIKKqAc0%2Bg%3D" alt="图片" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e750b1047f04fb793352e5629ec9049~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571181&amp;x-signature=ze1820j4peW2QXedZq1nQFvmmpQ%3D" alt="图片" loading="lazy"/></p>
<p>通过系统与算法的协同优化，LiteGS 在训练效率与重建质量上均实现显著领先，树立了该领域新的性能标杆。</p>
<ul>
<li>
<p>在达到与当前质量最优方案同等水平时，LiteGS 可获得高达 10.8 倍的训练加速，且参数量减少一半以上。</p>
</li>
<li>
<p>在相同参数量下，LiteGS 在 PSNR 指标上超出主流方案 0.2–0.4 dB，训练时间缩短 3.8 至 7 倍。</p>
</li>
<li>
<p>针对轻量化模型，LiteGS 仅需原版 3DGS 约 10% 的训练时间与 20% 的参数量，即可实现同等质量，展现出卓越的工程实用性与技术前瞻性。</p>
</li>
</ul>
<p>目前，LiteGS 已在 GitHub 平台全面开源，以推动三维重建与渲染技术的开放协作与持续演进。</p>
<p>开源地址：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FMooreThreads%2FLiteGS" target="_blank" title="https://github.com/MooreThreads/LiteGS" ref="nofollow noopener noreferrer">github.com/MooreThread…</a></p>
<p>摩尔线程此次在国际图形学顶会赛事上的获奖，不止是一次竞赛胜利，更是准确把握全球技术发展趋势并引领未来图形计算技术方向的战略体现。作为图形学领域未来发展的重要方向，3DGS 技术对算法与硬件协同提出了极高要求。摩尔线程通过创新的算法设计、深度优化的自研硬件以及高效的软硬件协同，在本次赛事中展现了卓越的综合能力。这一成就，印证了摩尔线程在图形智能计算领域技术路径的前瞻性与工程可行性，并体现了公司将前沿研究快速转化为实践成果的强大执行力。</p>
<p>2025 年 12 月 20 日 - 21 日，摩尔线程将于首届 MUSA 开发者大会设立技术专题，深入探讨 3DGS 等图形智能技术如何塑造未来，赋能具身智能等前沿领域，诚邀您共同关注与探讨。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[OpenAI推出全新ChatGPT Images，奥特曼亮出腹肌搞宣传]]></title>    <link>https://juejin.cn/post/7584742635484069898</link>    <guid>https://juejin.cn/post/7584742635484069898</guid>    <pubDate>2025-12-17T10:11:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584742635484069898" data-draft-id="7584742635484037130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="OpenAI推出全新ChatGPT Images，奥特曼亮出腹肌搞宣传"/> <meta itemprop="keywords" content="人工智能,OpenAI"/> <meta itemprop="datePublished" content="2025-12-17T10:11:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="机器之心"/> <meta itemprop="url" content="https://juejin.cn/user/1873223543167902"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            OpenAI推出全新ChatGPT Images，奥特曼亮出腹肌搞宣传
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1873223543167902/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    机器之心
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:11:42.000Z" title="Wed Dec 17 2025 10:11:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你刚刚打开 X 并且正好关注了 OpenAI 和山姆・奥特曼，那么你可能会看到这样的照片：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/84b05c34cc2f4c329d320db475d4fe96~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=tTTEJECbSpycA7SpUdztvXog%2FmE%3D" alt="图片" loading="lazy"/></p>
<p>是的，确实有点辣眼睛。就连 OpenAI 官方号也忍不住吐槽（其实是刷热度）：sam.</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7cad5ad4ed9d46daadb5ddbcd97e0e8d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=Mr7M3EgDVOI080GjC8Uia9sednw%3D" alt="图片" loading="lazy"/></p>
<p>而在评论区，更是一片吐槽和调侃：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bbe7a10715c4712807afb103cf6ea64~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=dtF%2F5JPmC9Js8tJw9QynrLjgfEA%3D" alt="图片" loading="lazy"/></p>
<p>但不管怎么说，热度是有了。</p>
<p>实际上，山姆・奥特曼之所以发这样一张辣眼睛的图片，正是为 OpenAI 刚刚推出的全新 ChatGPT Images 造势。而且这也不是唯一一张基于奥特曼照片改的图。OpenAI 官方号还专门单独特地发了一张这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c21d5949c894830bef36aba0c3c0fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=W05tQuK3RpP8VPiJDsP5TWdZqRA%3D" alt="图片" loading="lazy"/></p>
<p>而且以身入局的 OpenAI 大佬还不止他一个。OpenAI 首席研究官 Mark Chen 和 OpenAI 总裁 Greg Brockman 都贡献了自己的照片。比如下面即是其官方博客分享的修图对话记录：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b50f6ad55c3240f89beb682eb9ce9c3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=jGnHoW1B7GqGrb%2FASxR6hqEjE70%3D" alt="长图滚动查看" loading="lazy"/>上下滑动查看</p>
<p>新版 ChatGPT Images</p>
<p>ChatGPT Images 的新版本由 OpenAI 全新的旗舰图像生成模型驱动。该公司表示：「现在，无论你是从零开始创作还是编辑照片，都能得到你脑海中构想的画面。它能在进行精准编辑的同时保持细节完好，图像生成速度更是提升了 4 倍。」</p>
<p>其核心特性是：精准编辑，保留关键细节。</p>
<p>现在，当用户要求对上传的图片进行编辑时，模型能更可靠地遵循用户的意图。按 OpenAI 的说法是「细致入微到每一个小细节」，比如仅改变用户要求的部分，同时在输入、输出和后续编辑中保持光影、构图和人物外观等元素的一致性。</p>
<p>这能解锁很多潜在用例，比如更实用的照片编辑、更逼真的服装和发型试穿，还是保留原始图像精髓的风格滤镜和概念转换。</p>
<p>编辑功能</p>
<p>OpenAI 表示：该模型擅长各种类型的编辑，包括添加、删减、组合、融合和置换。</p>
<p>下面是一个从生成到各种编辑的示例。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58e42fa63c4b486a93adda66d7769243~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=S%2Bfbc811o4bG%2Bosq335eMb1Ai3k%3D" alt="长图滚动查看" loading="lazy"/></p>
<p>创意转换</p>
<p>该模型还具备 transformation 功能，即可以改变和添加元素（如文本和布局）来实现想法，同时保留重要细节。OpenAI 表示，这些转换既适用于简单的概念，也适用于复杂的概念，并且可以通过新版 ChatGPT Images 功能中的预设风格和创意轻松尝试 —— 无需手动编写提示词。</p>
<p>比如，你可以将一张日常照片转换成电影海报。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/46125a89a79f4f06b6d6942ec41695a0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=jUGRDSfw%2Brkts643EYZl8Zko94E%3D" alt="图片" loading="lazy"/></p>
<p>或制作一张戴珍珠耳环的奥特曼。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e7eb3e8ae3d47618fbc36f008497953~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=f%2FcYb6x7GpdKqvAaSIrvvF4zZEw%3D" alt="图片" loading="lazy"/></p>
<p>遵循指令</p>
<p>OpenAI 称：「与我们的初始版本相比，该模型能更可靠地遵循指令。这不仅实现了更精准的编辑，还能处理更复杂的原始构图，按预期保留元素之间的关系。」下面给出了一个对比示例：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c50096c0ffa4115b68963675e1861cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=ujtYhphYGb9yainbQFa791TGf24%3D" alt="图片" loading="lazy"/></p>
<p>文本渲染</p>
<p>该模型在文本渲染方面又迈进了一步，能够处理更密集、更小的文本。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61105c618a1642588228aa7e2519d09c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=MI4GElIJMxzkkZnNV5wOSTLiuUE%3D" alt="长图滚动查看" loading="lazy"/></p>
<p>其他质量改进</p>
<p>该模型还在其他维度上进行了改进，使得输出结果能更直接地投入使用，例如渲染许多小尺寸的人脸以及提升输出结果的自然程度。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1651ecefa0804391b0349885da78499d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=ujPlpFAa62BJh6Vhw6L%2FvqjtWdw%3D" alt="图片" loading="lazy"/></p>
<p>全新的创作空间</p>
<p>另外，OpenAI 还在 ChatGPT 中推出了全新的「Images」（图片）功能，「旨在让图像生成体验更加令人愉悦 —— 不仅能激发灵感，还能让创意探索变得毫不费力。」</p>
<p>用户可通过移动应用的侧边栏和 chatgpt.com 访问，让图像的探索和尝试变得更快、更简单。它包含了数十种预设滤镜和提示词以快速激发灵感，并会定期更新以反映新兴趋势。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37980b8a9648476898be8f28de849bfc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=iohd53uf39BsJEb5jip25XU3Ie4%3D" alt="图片" loading="lazy"/></p>
<p>可用性</p>
<p>全新的 Images 模型于今日起向所有 ChatGPT 用户推出，并通过 API 以 GPT Image 1.5 的形式提供。与 GPT Image 1 相比，GPT Image 1.5 的图像输入和输出价格降低了 20%，因此用户可以在预算不变的情况下生成和迭代更多图像。</p>
<p>ChatGPT 中全新的 Images 体验也于今日向大多数用户开放，商业版（Business）和企业版（Enterprise）的访问权限将在稍后推出。</p>
<p>OpenAI 表示：「我们相信，我们仍处于图像生成所能实现的可能性的开端。今天的更新是向前迈出的有意义的一步，未来还将有更多功能推出，从更细粒度的编辑到跨语言的更丰富、更详细的输出。」</p>
<p>结语</p>
<p>最后，我们也使用一个同样的提示词，简单测试对比了 ChatGPT Images 与谷歌的 Nano Banana Pro。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c09530327164ebd89acb7ffee50b85c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=05Gr0A%2BXipvc30CWUCeFvm4N9wQ%3D" alt="图片" loading="lazy"/></p>
<p>ChatGPT Images 的结果</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dd8926f0ede74544b82dd987817c4f99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5py65Zmo5LmL5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571102&amp;x-signature=twXowkatk3pICSto%2FlLGYykOeuM%3D" alt="图片" loading="lazy"/></p>
<p>Nano Banana Pro 的结果</p>
<p>看起来，至少在这个特定案例中，ChatGPT Images 的结果更加符合我们的指令。</p>
<p>综合来看，在这场 AI 生图之战中，OpenAI 此次发布的 ChatGPT Images 标志着竞争的维度正在变化：从单纯的「模型能力」转向了综合的「产品体验」。OpenAI 这一次甚至没有放出任何量化的基准测试结果！</p>
<p>同时，Sam Altman 亲自下场自黑虽然充满了硅谷式的幽默，但其背后的信号非常清晰：OpenAI 正在极力降低用户的心理门槛。通过推出独立的「Images」入口、预设风格滤镜以及极大幅度的降价，OpenAI 试图将图像生成从一种需要精心调试提示词的专业技能，变成一种像发推特一样简单的日常交互。</p>
<p>你看好 ChatGPT Images 吗？</p>
<p>参考链接</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fopenai.com%2Findex%2Fnew-chatgpt-images-is-here%2F" target="_blank" title="https://openai.com/index/new-chatgpt-images-is-here/" ref="nofollow noopener noreferrer">openai.com/index/new-c…</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2FOpenAI%2Fstatus%2F2000990989629161873" target="_blank" title="https://x.com/OpenAI/status/2000990989629161873" ref="nofollow noopener noreferrer">x.com/OpenAI/stat…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter运行iOS26真机的两个问题]]></title>    <link>https://juejin.cn/post/7584633505105313844</link>    <guid>https://juejin.cn/post/7584633505105313844</guid>    <pubDate>2025-12-17T10:14:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105313844" data-draft-id="7584379805899817012" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter运行iOS26真机的两个问题"/> <meta itemprop="keywords" content="Flutter,iOS"/> <meta itemprop="datePublished" content="2025-12-17T10:14:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="往来凡尘"/> <meta itemprop="url" content="https://juejin.cn/user/3553229180502071"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter运行iOS26真机的两个问题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3553229180502071/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    往来凡尘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:14:59.000Z" title="Wed Dec 17 2025 10:14:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Debug编译崩溃</h2>
<blockquote>
<p>../../../flutter/third_party/dart/runtime/vm/virtual_memory_posix.cc: 428: error: mprotect failed: 13 (Permission denied)</p>
</blockquote>
<blockquote>
<p>在iOS上Dart不管是JIT运行还是进行hotload的时候，都需要涉及代码在内存从RW变成RX的调整，而这在Flutter低版本是通过<code>mprotect</code>完成，而这在iOS 26被禁止了</p>
</blockquote>
<p>所以Flutter在Debug模式下真机运行iOS 26设备就崩溃了。如果确实需要在iOS 26上真机调试，方案如下：</p>
<ol>
<li>目前测试最新的3.38.5版本可以正常在Debug模式运行iOS 26设备。</li>
<li>如果不能升级Flutter版本，只能暂时使用Release或Profile模式运行(修改iOS项目Scheme,设置run-&gt;Build Configuration)</li>
</ol>
<h2 data-id="heading-1">二、Flutter适配UIScene</h2>
<p>当我的iOS 26的设备正常运行后，发现Xcode控制台有一行打印：</p>
<blockquote>
<p><code>UIScene</code> lifecycle will soon be required. Failure to adopt will result in an assert in the future.</p>
</blockquote>
<p>强制使用UIScene不然未来就可能触发断言，太可怕了😱那就顺便做了吧。</p>
<p>Flutter<code>最低版本</code>：</p>
<pre><code class="hljs language-dart" lang="dart">environment:
  sdk: ^<span class="hljs-number">3.10</span><span class="hljs-number">.0</span>
  flutter: <span class="hljs-string">"&gt;=3.38.0"</span>
</code></pre>
<p><strong>方案一：</strong> 自动化迁移，适合iOS <code>AppDelegate</code>文件没有大量定制化修改,在项目终端运行命令：</p>
<pre><code class="hljs language-sh" lang="sh">flutter config --enable-uiscene-migration
</code></pre>
<p>迁移成功后，会在构建日志中看到 <strong>"Finished migration to UIScene lifecycle"</strong> 的提示，否则工具会给出警告，并提示你手动迁移。</p>
<p><strong>方案二：</strong> 手动迁移</p>
<ol>
<li><code>AppDelegate</code>移除window生命周期相关的方法，使用<code>UIScene lifecycle</code>的对应方法，保留<code>application(_:didFinishLaunchingWithOptions:)</code>方法，移除所有创建和设置<code>window</code>的代码</li>
<li><code>AppDelegate</code>类遵循协议：<code>FlutterImplicitEngineDelegate</code>，并在<code>didInitializeImplicitFlutterEngine</code>方法中注册插件，并将创建Method Channels或Platform Views的逻辑都迁移到此处，因为在<code>didFinishLaunchingWithOptions</code>执行时，<code>FlutterViewController</code>可能还不存在</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Flutter
<span class="hljs-keyword">import</span> UIKit

<span class="hljs-keyword">@main</span>
<span class="hljs-keyword">@objc</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AppDelegate</span>: <span class="hljs-title class_">FlutterAppDelegate</span>, <span class="hljs-title class_">FlutterImplicitEngineDelegate</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-keyword">func</span> <span class="hljs-title function_">application</span>(
    <span class="hljs-keyword">_</span> <span class="hljs-params">application</span>: <span class="hljs-type">UIApplication</span>, 
    <span class="hljs-params">didFinishLaunchingWithOptions</span> <span class="hljs-params">launchOptions</span>: [<span class="hljs-type">UIApplication</span>.<span class="hljs-params">LaunchOptionsKey</span>: <span class="hljs-keyword">Any</span>]<span class="hljs-operator">?</span>
  ) -&gt; <span class="hljs-type">Bool</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.application(application, didFinishLaunchingWithOptions: launchOptions)
  }
  
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">didInitializeImplicitFlutterEngine</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">engineBridge</span>: <span class="hljs-keyword">any</span> <span class="hljs-type">FlutterImplicitEngineBridge</span>) {
        <span class="hljs-type">GeneratedPluginRegistrant</span>.register(with: engineBridge.pluginRegistry)
        <span class="hljs-comment">// Channel、Platform Views</span>
    }
}
</code></pre>
<ol start="3">
<li>创建<code>SceneDelegate.swift</code>文件，基础定义如下：</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> UIKit
<span class="hljs-keyword">import</span> Flutter

<span class="hljs-keyword">class</span> <span class="hljs-title class_">SceneDelegate</span>: <span class="hljs-title class_">FlutterSceneDelegate</span> {
}
</code></pre>
<ol start="4">
<li><code>info.plist</code>添加<code>Application Scene Manifest</code>相关key：</li>
</ol>
<pre><code class="hljs language-XML" lang="XML"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIApplicationSceneManifest<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIApplicationSupportsMultipleScenes<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">false</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneConfigurations<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UIWindowSceneSessionRoleApplication<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">array</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dict</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneConfigurationName<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Default Configuration<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneDelegateClassName<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>$(PRODUCT_MODULE_NAME).SceneDelegate<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>UISceneStoryboardFile<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>Main<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">array</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dict</span>&gt;</span>
</code></pre>
<p>key缺失可能会导致启动黑屏或控制台打印xxxkey缺失，其中key：</p>
<ul>
<li>UISceneConfigurationName：<code>Default Configuration</code>或<code>flutter</code>均可</li>
<li>UISceneDelegateClassName：<code>FlutterSceneDelegate</code>或<code>$(PRODUCT_MODULE_NAME).SceneDelegate</code>均可</li>
</ul>
<p>到此基础配置就完成了，恭喜你demo项目可以正常运行了，如果你的项目其他定制化修改还需要迁移，详细可以参考下面的<code>Flutter Docs</code>。</p>
<h3 data-id="heading-2">参考链接</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.flutter.dev%2Frelease%2Fbreaking-changes%2Fuiscenedelegate%23if-you-cant-directly-make-flutterscenedelegate-a-subclass" target="_blank" title="https://docs.flutter.dev/release/breaking-changes/uiscenedelegate#if-you-cant-directly-make-flutterscenedelegate-a-subclass" ref="nofollow noopener noreferrer">Flutter Docs</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Ftechnotes%2Ftn3187-migrating-to-the-uikit-scene-based-life-cycle" target="_blank" title="https://developer.apple.com/documentation/technotes/tn3187-migrating-to-the-uikit-scene-based-life-cycle" ref="nofollow noopener noreferrer">Apple Docs</a></li>
<li><a href="https://juejin.cn/post/7565733796269981738" target="_blank" title="https://juejin.cn/post/7565733796269981738">iOS 26 开始强制 UIScene</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[是个公司都在用AI Agent，但大家真的用明白了吗？？| MEET2026圆桌论坛]]></title>    <link>https://juejin.cn/post/7584408254820483107</link>    <guid>https://juejin.cn/post/7584408254820483107</guid>    <pubDate>2025-12-17T10:19:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584408254820483107" data-draft-id="7584472215975788559" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="是个公司都在用AI Agent，但大家真的用明白了吗？？| MEET2026圆桌论坛"/> <meta itemprop="keywords" content="AI编程,AIGC"/> <meta itemprop="datePublished" content="2025-12-17T10:19:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            是个公司都在用AI Agent，但大家真的用明白了吗？？| MEET2026圆桌论坛
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:19:48.000Z" title="Wed Dec 17 2025 10:19:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读29分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“每个人每天使用最高频的三个 APP 中有两个是 Agent 时，才意味着 AI Agent 进入新发展阶段。”</p>
<p>“一个好 Agent 的衡量指标，包括可控性、可解释性以及持续稳定执行任务的能力。”</p>
<p>“多数 Agent 存在负毛利问题，完成任务的代价高于用户支付意愿，这对创业者来说是巨大挑战。”</p>
<p>……</p>
<p>在量子位 MEET2026 智能未来大会的<strong>圆桌环节</strong>，三位来自产业一线的嘉宾围绕 <strong>AI Agent 的革新进程</strong>展开深入讨论。他们分别是：</p>
<ul>
<li>
<p>联汇科技 CEO 兼首席科学家赵天成博士</p>
</li>
<li>
<p>小宿科技联合创始人兼 CEO 杜知恒先生</p>
</li>
<li>
<p>蚂蚁集团平台体验技术部负责人徐达峰先生</p>
</li>
</ul>
<p>2025 年普遍被视为 “Agent 元年”。从客服、理赔等相对标准化的场景开始，Agent 已经完成了初步落地，并验证了技术可行性与阶段性价值。</p>
<p>但真正的难题才刚刚显现——</p>
<p>如何让 Agent 同时跑通技术、产品与商业三条曲线，形成可持续的正向闭环，仍是摆在整个行业面前的共同挑战。</p>
<p>而在这场圆桌讨论中，三位嘉宾从产品形态、技术演进与商业现实等多个维度出发，分享了他们对 Agent 下一程的判断。</p>
<p>透过这些观点，我们或可窥见 Agent 从技术概念走向规模应用的关键路径，以及产业先行者们在探索中所面临的思考与抉择。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d43778f4e8c43e0a10943928136ac2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=dfLK7hyJH%2Fo%2B7PIRrE9UUmIEVDI%3D" alt="" loading="lazy"/></p>
<p>本次圆桌环节由量子位智库首席分析师刘萌媛主持。在不改变原意的基础上，本文对内容进行了编辑整理。希望能够给你带来更多的启发与思考。</p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，近 30 位产业代表与会讨论。线下到场参会观众近 1500 人，线上直播观众 350 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">话题要点</h2>
<ul>
<li>
<p>目前在 AI Agent 及相关领域重点从事哪些工作？</p>
</li>
<li>
<p>各自落地效果最好的案例是什么？</p>
</li>
<li>
<p>真正好用的 AI Agent 产品应该关注哪些指标？</p>
</li>
<li>
<p>未来还有哪些对于 AI Agent 发展比较关键的卡点？</p>
</li>
<li>
<p>AI Agent 的下一步关键演进方向是什么？进入新阶段的标志性节点是什么？</p>
</li>
</ul>
<p><em>以下为圆桌对话全文：</em></p>
<h2 data-id="heading-1">圆桌实录</h2>
<p><strong>量子位</strong>：</p>
<p>无论是在前面各位嘉宾的演讲中，还是在整个 2025 年的讨论里，相信大家已经多次听到 “AI Agent” 这一关键词。</p>
<p>无论是技术迭代还是产品涌现，AI Agent 确实屡屡让人眼前一亮。今天，我们将从更加理性、务实的角度来探讨：<strong>千行百业距离广泛应用 AI Agent 究竟还有多远？</strong></p>
<p>为此，我们邀请到三位嘉宾，他们分别代表 AI Agent 产业链上不同领域的最前沿产品与技术，来为大家带来切实的分享。</p>
<p><strong>首先，请三位嘉宾简要介绍一下自己，以及目前在 AI Agent 相关领域所从事的工作</strong>。</p>
<p><strong>赵天成</strong>：</p>
<p>大家好，我是来自联汇科技的赵天成。在过去的五年里，我们团队一直在做的事情是：</p>
<p>第一，研发信号终端侧的多模态模型；</p>
<p>第二，探索如何让智能体从在虚拟世界做 PPT、写写画画，走向物理世界，真正操控终端设备，也就是实现所谓的 <strong>“物理智能体”</strong>。</p>
<p>目前我们在两个方向做了很多工作，一是致力于让多模态智能体本地化运行，不完全依赖云端强大算力。例如，让它在端侧设备_（如 AI PC）_上，甚至在飞机等无网络环境中，也能高效处理海量多模态数据，并转化为真正实用、能帮用户解决实际问题的智能体。</p>
<p>更进一步，我们致力于将无人机、机器人、摄像头等具备真正执行能力的智能终端串联起来，形成协同工作的智能体网络。这是一个非常有意思的课题。目前大家熟悉的智能体，或许更多体现在处理工作流或特定查询场景中。<strong>而我们探索的是更系统的物理联动</strong>。</p>
<p>举个例子，一个智能摄像头探测到火灾，它可以自动通知另一个终端——比如一台配备灭火装置的机器狗。机器狗收到指令后前往现场扑灭火情，并在任务完成后返回基地，自动生成一份报告给管理员，说明 “火灾已发生并被扑灭，问题已解决”。</p>
<p>这样一个从感知、决策、执行到反馈的完整闭环，能否通过智能体流畅地串联与调度，从而实现智能体从数字世界走向物理世界的跨越？这正是我们团队过去两年来持续深耕的核心方向。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f00532be7d44eaa82c1fc60a1a60e86~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=cXbwz58Wo%2F0vjap38hDGDLRxWZU%3D" alt="" loading="lazy"/></p>
<p><strong>徐达峰</strong>：</p>
<p>大家好，我是来自蚂蚁平台体验技术团队的徐达峰。我们目前主要聚焦在两个方向：</p>
<p><strong>一是重构软件的研发方式</strong>。我们正在构建一套完整的智能研发体系——WeaveFox，其中包含 WeaveFox-Coder、Vibe-Coding、Spec-Coding 等模块，并打造了面向工程体系的 Coding-Agent 基础设施和软件工程 - Agent 基础设施。</p>
<p>我们的核心目标，不仅仅是 “让模型能够写代码”，更是要将多模态生成代码、任务自动拆解、工具链智能协同等能力，真正融入到生产环境中。我们致力于让 AI 从辅助工具，转变为研发体系的原生能力，从而推动整个工程链路实现更高水平的自动化。</p>
<p><strong>二是致力于将多智能体能力带给大众用户</strong>。</p>
<p>为此，我们推出了 “蚂蚁百宝箱” 以及“百宝箱超级智能体”。我们的愿景是将其打造成一个“通用 Agent 平台”——无需任何代码依赖，也不要求使用者具备技术背景，真正做到开箱即用。用户只需用自然语言描述需求，就能轻松构建并发布属于自己的智能体应用。</p>
<p>无论是内容创作类的需求，如生成文案、制作 PPT、撰写报告、设计网页，还是通过多 Agent 协作完成更复杂的工作流任务，都可以通过这个平台实现。我们的目标，是将 AI 智能体从高门槛的 “专业工具”，转变为人人都能用起来的 “工具箱”。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d55c3d4ee31b4c618eac4d1e4cfd8a63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=1oZImH%2FnZ0Cr72B9lpjEWbKD9NQ%3D" alt="" loading="lazy"/></p>
<p><strong>杜知恒</strong>：</p>
<p>我是杜知恒，小宿科技打造的是<strong>面向 Agent 的一站式基础设施平台</strong>。</p>
<p>我们认为，其中尤为重要的一个产品是为 Agent 设计的搜索引擎。这里我们也呼应一下蚂蚁的观点：我们相信，优秀的 Agent 能够胜任人类可以完成的工作。</p>
<p>过去，搜索引擎和信息获取一直是人们工作、学习乃至日常生活中最主要的信息获取工具。我们提供的正是一个多语言、全球化的搜索引擎工具，专门服务于 Agent。</p>
<p>除了搜索能力，我们还提供模型服务、AI 沙盒等多样化的 Agent 工具集，致力于为大家打造一站式的 Agent Infra 平台。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40ed1f23e7d0406398f65667f72d8cc2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=M0Lw48N2wuStv%2BwAratKkyP6XTY%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-2">各自落地效果最好的案例是什么？</h4>
<p><strong>量子位</strong>：</p>
<p>在三位做的 Agent 相关的产品里面，效果最好的 Agent 落地案例是什么？能否结合具体数据和观众分享一下，让大家对 Agent 落地价值有更直观的感受？</p>
<p><strong>赵天成</strong>：</p>
<p>今年有两个点带来的 ROI_（投资回报率）_提升还是非常明显的。</p>
<p>第一个是有了<strong>多模态</strong>。今年的确是 VLM_（视觉语言大模型）_大幅度成熟的一年，之前大家用 ChatGPT、GPT-4 比较多，今年 GPT-4o、Gemini 3 这些新出来的多模态模型对于图像和视频的理解能力其实有质的飞跃。</p>
<p>有了这个能力之后，我们的智能体可以算是打开了新的窗户。之前 Agent 只能处理文本，要做图片任务还需要一段描述，再给到模型去理解执行，现在有了端到端模型之后，直接给视频、给扫描件、给一张图片甚至混合在一起都可以直接做（任务），很多以前不敢想的场景瞬间打开。</p>
<p>我们在多模态领域扎根很久，之前就在做很多探索，今年的确感受到建模本身的提升，多模态能力可以让我们的智能体即使在数字空间场景中，也可以做很多以前不可能做到的事情。</p>
<p>第二个是有了<strong>执行智能体</strong>。以前的 AI 即使可以理解视频、理解图像，也只能给你一个提醒 “这边发生事故赶快修复”、“这边有问题赶快派人去吧”，现在有了执行智能体，无论是操控机械臂还是执行其他操作，现场就能直接解决问题。</p>
<p>这对于用户来说，投资回报率和价值完全不在一个量级，比如以前一个终端最多付一千块钱，有了智能执行端之后愿意付十万块钱，这是一百倍的本身价值的提升。</p>
<p>智能体核心逻辑在于<strong>结果即服务</strong>，提供的是一个结果，这个结果的价值定义了产品有多大的能力边界，一个是帮你看着，提醒你赶快灭火吧；第二个是直接告诉你已经帮你把火扑灭了，比人扑的更快一些，这个对客户来说价值是 100 倍的提升，这也是为什么我们非常笃定地相信<strong>多模态 + 执行</strong>是智能体在后续发展中非常重要的板块和体现。</p>
<p><strong>杜知恒</strong>：</p>
<p>过去这一年 Agent 进化还是很明显的，从大家只会用 Chatbot 到真正开始用 AI 做各种各样的任务、工作，包括陪伴式的娱乐、学习。</p>
<p>我观察到在这几个场景中，Agent 能做越来越多智能化的工作。</p>
<p>第一个就是刚才说的做 PPT、写产品文档，包括 Coding，在核心工作流中 Agent 开始能交付实习生水平的结果，这是过去一年中 Agent 领域非常明显的进步和进化。</p>
<p>另外可以看到，各种各样的垂类软件正在越来越多地采用 AI 技术，无论是客服系统、数据平台还是其他各类软件工具。我的观察是，上一代 SaaS 公司正在快速引入 AI 能力，这显著提升了它们服务客户的效率与质量。</p>
<p><strong>徐达峰</strong>：</p>
<p>前面老师提到智能客服，还有端到端多模态 + 执行，我补充一个 Coding Agent 能力方面的个人观察。</p>
<p>Coding Agent 已经从<strong>写一段代码进化为跑一段流程</strong>。在 WeaveFox 的实践中，Agent 能看懂设计稿、理解上下文和组件规范，然后自动生成可上线代码。过去通常需要工程师在 IDE 中花半天时间调试，现在 Agent 几十秒就能跑完。而且这是在多个规模化项目里，我们稳定看到了 3~5 倍的效率提升。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f36425066d5141feb4546069166fc804~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=2vQ8H9oE3ABPQNCRxPenBQ%2B6p%2FM%3D" alt="" loading="lazy"/></p>
<p>这说明，<strong>只要工具链和上下文足够清晰，Agent 的能力是可以被 “工程化复制” 的</strong>。</p>
<h4 data-id="heading-3">真正好用的 AI Agent 产品应该关注哪些指标？</h4>
<p><strong>量子位</strong>：</p>
<p>今天邀请到的三位嘉宾在 AI Agent 里面处于不同的生态位，小宿处于基础设施层，另外两位老师偏向于产品层，请各位在不同的生态位上定义真的好用、或者有价值的 AI Agent 产品，你们觉得现在更应该关注哪些指标？有哪些指标大家没有关注？下一步应该在哪些方面投入更多技术和精力呢？</p>
<p><strong>杜知恒</strong>：</p>
<p>我的观点还是一样的，（如果 AI）能更像人一样，交付一个从高中生到大学生到博士生能交付的结果，这就是好场景。</p>
<p>企业愿意为这类 AI 支付更高成本，背后的逻辑很明确：过去，大家把 AI 当作普通软件看待，关注点局限在软件订阅费的高低；而现在，大家会将其价值与实习生、全职员工的人力价值做对比。</p>
<p>即便目前存在<strong>堆砌 Token 完成任务</strong>的争议，包括我们公司在内，许多企业在高频使用 AI 进行代码编写（Coding）、撰写产品需求文档（PRD）、搭建各类工作流以优化效率的过程中，通过 AI 节省的人工成本，也远远超过了在 Token 上投入的费用，即使 Claude Code 很贵。</p>
<p>我觉得我们内部对 Agent 可用性最主要的评判标准，就是<strong>它能不能在特定场景交付一个相对完整的结果</strong>。</p>
<p>Agent 在中国被叫智能体，但其实我觉得 <strong>“代理人”</strong> 这个翻译是更好的，一个 Agent 不能给你交付结果，你肯定不会花钱雇他，包括 Coding 这些场景在内，AI 越来越能够真正交付结果。</p>
<p>现在 Coding 还有抽卡的情况，但即使是抽卡抽三次性价比依然很高。</p>
<p><strong>赵天成</strong>：</p>
<p>我们从时间上来看，有两方面是整个业界要慢慢接受和改变的，因为智能体跟以前信息化系统和纯粹软件还是不太一样的。</p>
<p>第一个是之前很多人说做 AI 原生的 Agent，我们发现以前软件系统有很多 UI 式、表单式结构，很多时候 AI 就是把表单的某些环节换成模型，这是比较方便的方式，但也有很多时候换汤不换药，还是原来的工作流做的事情。</p>
<p>其实可以把一个环节彻底用 Agent 代替，这时候可能会有一些更加创新型的产品并落地应用，这样才真正能把智能体的优势发挥出来，而不是受限于很条条框框的地方，只能做以前一些环节的替代。大家（才）会接受智能体可以真正替代一个流程一个环节，真正用 AI 的方式做这个事情。</p>
<p>第二个是 Agent 本身是可以进化的，在以往的 AI 应用中，包括我们的不少甲方客户在内，很多人会陷入一种认知误区：认为采购 AI 本质上就是采购一套算法，并且对算法的准确率、召回率有明确要求，若初始阶段无法达到既定指标，就不会验收。</p>
<p>但实际上，Agent 的价值体现在实际应用过程中，Context_（上下文信息）_会不断丰富，它自身具备记忆能力，再结合用户给出的反馈，会逐渐熟悉用户的业务流程，最终真正帮用户解决实际问题。然而当前许多场景下，用户并不能接受这种渐进式优化的模式，他们往往期望一步到位，要求 AI 在初始阶段就达到 95% 的准确率。</p>
<p>这就陷入了 “鸡生蛋还是蛋生鸡” 的矛盾问题。如果用户不使用 AI、不提供反馈、不补充 Context，不给 AI 学习和适应的机会，AI 自然无法达到理想的使用效果；可用户又因 AI 初始效果未达预期而不愿启用，形成了恶性循环。</p>
<p>不过这种情况也在逐渐改变，越来越多人也正在接受，说明大家用豆包、用 GPT，已经习惯了越聊越聪明的交互模式，慢慢（把它）变成自己想要的数字员工。</p>
<p>这个可进化性也是我们内部衡量智能体的非常重要的指标。假如一个智能体做出来就是这样了，你再跟它聊它都不会有变化，那就不是好的智能体，如果通过一天、一周、一个月使用变得更加个性化了，就是好的智能体。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/00476deb3e5f436b99118fe51f2e4e71~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=8EiEmBNIo4OUQH9E0Z7NhLzXazM%3D" alt="" loading="lazy"/></p>
<p><strong>量子位</strong>：</p>
<p>我想再追问一下赵总，您刚刚提到用 Agent 彻底替代某一部分工作流，或者某一部分工作场景，那让你畅想一下在未来 6 个月或者一年之内，您觉得会有哪些行业或者场景率先有可能被彻底改变工作流呢？</p>
<p><strong>赵天成</strong>：</p>
<p>假如是 6 个月的时间，在那些失败结果没有那么灾难性的地方，相关问题或许可以得到彻底解决。（这些场景的容错空间相对较大），AI 一次没做好，大不了再做一次，而且如果做三次的成本，比我自己干整个过程的成本还是低很多，那这类工作就可以被替换掉。</p>
<p><strong>量子位</strong>：</p>
<p>也就是说结果不够致命，有一点容错空间的任务基本可以实现 AI 替代人。</p>
<p>那么徐总，蚂蚁目前在做的这些产品，包括您刚才提到的 Coding Agent，以及面向群众的产品，从您的角度来说，一款 AI Agent 产品最值得关注的指标是什么呢？</p>
<p><strong>徐达峰</strong>：</p>
<p>在我看来，判断一款 Agent 是否优秀，可以从以下几个角度界定标准，比如可控性、可解释性，乃至于稳定性，这是基础要求，在此就不赘述了。</p>
<p>需要明确的是，Agent 一定是基于某一类特定任务去设计的，很多场景里，任务本身就是开放型问题、还存在各种例外情况，模型也不可能 100% 完美解决所有问题。所以我认为优秀的标准是<strong>看 Agent 产品有没有设计人机协作的流程</strong>。</p>
<p>企业真正需要的不是 “永不犯错”，而是犯错时能暴露不确定性，是否具有回滚的能力，能不能回溯回去找到问题。另外在这个过程中，在出现问题后，能顺畅地将任务交由人工接管。</p>
<p>也就是说，它要像一位可靠的同事，而不是像一名（缺乏协作性的）天才小学生。如果没有如上指标，即便效果再惊艳，也很难真正落地，我觉得这是一个好的 Agent 的标准指标。</p>
<p><strong>量子位</strong>：</p>
<p>如果把刚刚给赵总的问题再抛给您，目前您涉及的所有用户场景里，未来 6 个月，您觉得哪一个是被改写最彻底的？</p>
<p><strong>徐达峰</strong>：</p>
<p>彻底不敢谈。我认为<strong>软件工程</strong>可能仍会面临较大的冲击和变革。</p>
<p>这主要是因为其工具链相对成熟，有上一代数字基建作为基础，且任务本身偏向结构化。</p>
<p>同时，进一步自动化的收益非常高。这些因素共同作用，将推动整个流程越来越自动化，通过辅助编码和自动化流程，研发团队也会更容易接受。因此，我认为是软件工程。</p>
<p><strong>量子位</strong>：</p>
<p>我们把这个问题换一个方向问杜总，您作为基础设施层的代表，您认为基础设施层究竟是如何影响不同 AI Agent 产品最终呈现的任务水平呢？能否结合小宿或其他具体案例，为我们解析一下具体的影响链路？</p>
<p><strong>杜知恒</strong>：</p>
<p>其实我们很难直接影响到 Agent 本身，更多是客户基于自身场景对基础设施提出更高要求，我们去响应和满足。</p>
<p>回到搜索本身，从 ToC 时代到 ToAgent 时代，三十年来它的核心标准——<strong>相关性、权威性、时效性</strong>，本质上没有改变。变化的是这些标准的重要程度。</p>
<p>过去，用户搜索时前三条结果必须吸引点击，所以相关性是最重要的指标。（但仅有相关性还不够）即使内容相关但质量很差，排到前面用户接受的概率，也比展示不相关信息要低得多。</p>
<p>但对于 AI 而言，调用搜索的核心原因在于消除信息幻觉与获取时效内容。</p>
<p>对 AI Agent 来说，搜索的首要要求是<strong>权威性——信息必须准确、全面</strong>。即便在前十条结果中，哪怕极端情况下有两条不相关，也远比 “十条看似相关、却缺乏精准性和时效性的信息” 要好，后者带来的后果反而更加灾难性。</p>
<h4 data-id="heading-4">未来还有哪些对于 AI Agent 发展比较关键的卡点？</h4>
<p><strong>量子位</strong>：</p>
<p>我们刚刚几个问题都聊的是 Agent 今天有怎么样的成就和价值，那我们现在从批判的角度聊一聊。</p>
<p>首先想问一下，从各位的角度来看，除了现在常说的推理大模型，或者语言大模型，还有哪些对于 AI Agent 未来发展比较关键的卡点？</p>
<p>既可以是技术方面，也可以是生态运营方面的，不知道各位是怎么看待这个问题的？</p>
<p><strong>赵天成</strong>：</p>
<p>我最近比较关注的是智能体的<strong>双脑架构</strong>。</p>
<p>刚才提到的代码生成这些创新都是用大语言模型做快速的处理，但是到我们这种物理场景之后，有时候你逃不掉，必须做双脑架构。</p>
<p>什么叫双脑？比如大语言模型给出一个指令，说无人机几点几分到这个地方去，但是在飞行过程中怎么飞？假如还是依赖云端语言模型思考的话，这个飞机干脆不要飞了，每飞 5 米就要想一想再飞一下，不太现实。</p>
<p>所以必须在端侧要有快速的、类似于小脑的模型做飞行这一块的执行，这个就跟常规的 MCP 模式还不太一样，以往云端模型调用工具，可能只是完成一次搜索、查询或简单指令下发；但在双脑架构里，云端大脑调用的不是普通工具，而是要驱动端侧小脑模型，让它把飞机飞过去。</p>
<p>这其实和目前主流智能体架构有区别，跟学术界研究的问题也不太一样。这里面得有一个框架，方便把各种小脑和大脑集成在一起，真正形成一个指挥官和类似于行动单元的组合的形态。</p>
<p>这个是我们近期一直在看的点，因为现在的确碰到了这样的现实问题，而且需要解决这些问题。</p>
<p><strong>徐达峰</strong>：</p>
<p>我可以补充一个企业视角下的观点，Agent 如果要在企业中落地，可能还会有一些挑战。尤其是大规模用在企业端时，首当其冲的可能是会面临访问核心资产数据，以及隐私和安全审计问题。</p>
<p>怎么样能够让这样的 Agent 可以被安全地运行？它访问数据是否有权限？能不能被审计？这些都是关键命题。</p>
<p>**以往很多流程设计更多是针对常规系统和人类操作场景设计的，很少有为 Agent 设计的，这是很关键的基础设施的缺漏。**这样的安全基础设施建立起来之后，才可能会为 Agent 大规模落地铺好前提。</p>
<p>面向 Agent 的设计，很可能是权限体系的重新设计和重塑。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b1bbc086ccb6437fa355c9978b810f34~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=6cT8uGoodjlSQLJamAy%2F8LvsaVo%3D" alt="" loading="lazy"/></p>
<p><strong>杜知恒</strong>：</p>
<p>我也说一个非常现实的问题，我们看 Agent，特别是 ToC 的 Agent 最大的挑战就是成本和 ROI 的问题。</p>
<p>因为即使当下的 Agent 可以帮你完成一些任务，但其实它完成任务所付出的代价和用户愿意付的成本还是有一个很明显的差距，目前市场上绝大多数的 Agent 都是以负毛利在运营，这在长期看来是一个很大的挑战，因为你很难在一个负毛利商业模式下做大规模的用户渗透。</p>
<p>除非像蚂蚁、字节这样的巨头，可以为获取客户长期承担非常大规模的亏损，这个对于大部分的 Agent 创业者来说可能也是一个挑战。所以核心问题就是怎么能把商业模式跑通，能够把用掉的 Token 和工具的钱赚回来？</p>
<p>对于一个基础设施提供方来说，对客户健康度的判断很重要，如果我的客户都很赚钱，那我大概率收取的价格是比较合理且可持续的，如果所有人都在亏钱，或者说大家都是期待下一轮的融资再来付今天用的基础设施的钱，（那么整个生态的健康度就会存疑），对于我们来说也非常关心这个问题。</p>
<p><strong>量子位</strong>：</p>
<p>有关产品线的 ROI，也想再问一下徐总，您刚刚提到咱们有做一些面向大众普惠型的产品，像刚刚提到收费方面的问题，会不会从您的角度来看，为了让大众使用 AI Agent 的产品，除了技术上要达成一些目标，是不是还有其他的要素也需要注意的？</p>
<p><strong>徐达峰</strong>：</p>
<p>说一点个人的粗浅判断。</p>
<p>首先，使用门槛在产品设计上必须足够低，不能预设用户具备专业知识背景，更不能假定他们本身就懂代码。现实中，这样的前提不太可能成立。</p>
<p>其次，更高频的使用场景，可能集中在文案、PPT 等内容创作上，其本质是信息的聚合、创作过程的协助，以及后续内容排版等工作。这类场景天然更适合大众用户。</p>
<p>此外，还会出现许多新的特色玩法。比如蚂蚁最近发布的 “灵光” 产品，就是一款很有意思的 App，用户可以用它制作小游戏、小应用，实用性很强。大致会是这类产品设计方向。</p>
<h4 data-id="heading-5">Agent 的下一步关键演进方向是什么？</h4>
<p><strong>量子位</strong>：</p>
<p>众所周知，2025 年已被视为 AI Agent 的元年。那么，元年之后下一个关键的演进方向是什么？刚才赵总提到了 “双端” 和“多模态”，我们想请各位具体展望一下，对于 Agent 而言，下一步的关键方向是什么？</p>
<p><strong>赵天成</strong>：</p>
<p>虽然 2025 年被称为 “智能体元年”，但可能现实生活中还没有那么多智能体。<strong>今年更像是 iPhone 1 的阶段，距离真正成熟、普及的 iPhone 4，还有很多要做的事情</strong>。</p>
<p>就我个人在 C 端的使用体验而言，日常可能会用一个类似豆包的智能体，来替代部分搜索类工作，我觉得已经达到了 “可用” 的水平。但如果是下一轮融资的 PPT，让智能体来完成，即便是现在最好的智能体也做不到，这仍然需要我自己完成大量策略层面的思考，才能有比较好的结果。</p>
<p>所以在我看来，即使是目前定义已经相当成熟的智能体，在可靠性和实际效果上，依然有大量提升空间。</p>
<p>这种提升可能来自基础模型能力的增强，也可能来自工程化能力的改进，也可能正如前面几位所提到的，是多个层面的共同进步。</p>
<p>只有这些条件都到位，智能体才能真正把哪怕是 “做 PPT” 这样看似简单的功能，提升到一个全民都能够使用的水平——这是第一个方面。</p>
<p>第二个方面，是我们自己正在做的事情。我们一直相信，如果未来的 AI 只停留在替代一部分数字化工作，那一定是不够的。它最终必须能够替代部分蓝领工作，走向现实世界，帮我们在物理世界干活。</p>
<p>（而要实现这一点），需要解决的问题依然非常多，包括前面多位老师提到的 VLA、世界模型等，这些很可能都是不可或缺的组成部分，只有在它们被有效拼合之后，智能体才有可能真正走向物理世界。</p>
<p>在这里有两个关键问题。第一，未来是否会一直是 “大语言模型 + 其他模型” 的组合形式？短期来看大概率如此，但从长期看并不一定——完全有可能被一种全新的架构彻底取代，这并非不可能。其实早两年我们看待大语言模型时，也曾觉得这条路径不太可能，但现在它已经成为主流。</p>
<p>第二，还是可靠性的问题。（当智能体进入物理世界），可靠性就变得更加严肃，不能说一下子把桌子砸了，那会是灾难性的后果——在电脑里最多是误删文件，虽然也很严重，但相比之下还是要轻一些。</p>
<p>因此我认为，<strong>可靠性是所有智能体真正成为 “每个人每天都在使用” 的工具之前，必须解决的核心问题之一</strong>。</p>
<p><strong>杜知恒</strong>：</p>
<p>我可能更多是从商业视角来看这个问题。对于 2026 年，我有几个基本预期。</p>
<p><strong>第一会是巨头的大规模下场</strong>。</p>
<p>无论是在 B 端还是 C 端，都会出现真正意义上的重投入，去争夺 DAU、ARR 和核心客户。2025 年我们已经看到，超大规模投入主要来自字节的豆包，BAT 其他几家以及蚂蚁更多是在下半年才逐渐发力。</p>
<p>我认为到明年，这一趋势会变得非常清晰且激烈——所有 Tier 1、Tier 2 的传统大型互联网公司，都会在 Agent 方向上加大投入，围绕 “入口” 展开竞争。</p>
<p>第二个预期也由此引出：在这种大规模投入的推动下，<strong>AI 的整体渗透率会显著提升</strong>。</p>
<p>包括现场各位的手机和电脑，其 AI 含量也都会大幅上升。头部 Agent 会开始真正进入二线、三线城市，被非专业用户广泛使用，甚至包括我们父母这一代人，也会逐步开始接受和使用。</p>
<p>因此，在我看来，Agent 的大规模渗透将是 2026 年我比较期待的事情。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59bc58cf760a48308c6d273dc743013a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571588&amp;x-signature=9ROruT724lkIc7YmK0KfRo5d8IU%3D" alt="" loading="lazy"/></p>
<p><strong>徐达峰</strong>：</p>
<p>如果说未来一年的 Agent 的话，我可能会分几个层次看。</p>
<p><strong>第一层次是数据和算法，再上层是模型能力</strong>，可以看到，这两层的技术能力呈现慢慢收敛的趋势。<strong>第三层是 Agent 的框架，以及和系统交互和集成</strong>，无论是 C 端还是 B 端，都可以看到有更多的数据管控、权限管控、接入集成等多方面的实践。</p>
<p>另外再往上延伸至产品侧与行业应用层面。目前可以看到越来越明显的趋势。</p>
<p>除了能解决一些日常小工具类的任务，或者一些小型的效率场景，也可以看到有一些 Killer App（现象级应用）出现。这类应用往往会锚定泛娱乐赛道，给用户提供很多情绪价值，甚至慢慢 App 扩展到智能硬件上，这些是能看到的趋势。</p>
<p>当然，也期待 2026 年这样的趋势逐步爆发，可以给大家带来更多的 AI Agent 在各行业，各领域的体验。</p>
<h4 data-id="heading-6">AI Agent 进入新发展阶段的标志节点</h4>
<p><strong>量子位</strong>：</p>
<p>最后一个问题，再替公众朋友们试图向三位嘉宾询问一下不确定中的确定性。</p>
<p>像刚刚提到，不管是从技术需要的基础设施，还是未来的产品形态，其实都有可能还有很多新的内容出现。</p>
<p>如果从三位嘉宾的角度来看，有没有哪个节点是你们觉得如果看到了就意味着 AI Agent 已经进入新的发展阶段了，不是像现在这样只是从无到有，而是真正彻底改写，而且普惠大众的，有没有哪个标志性的节点是各位现在最期待的？</p>
<p><strong>杜知恒</strong>：</p>
<p>可能是我妈妈开始用 Manus 开始画 PPT 或者做一个什么事情的时候开始。</p>
<p>我觉得当前 Agent 的渗透率虽然看起来如火如荼，但是在三、四线城市和人们日常生活中还是一个超级低的状态。</p>
<p>可能我自己的观察指标是身边的年长，或者非技术行业的人真正开始在用一些 Agent，改变他的生活方式，或者提升他的生活体验。</p>
<p><strong>赵天成</strong>：</p>
<p>我觉得就是当你每天最高频使用的三个 APP 里面有两个是 Agent，到那天可能就差不多了。</p>
<p><strong>徐达峰</strong>：</p>
<p>我比较赞同赵天成老师的看法，如果你每天用的软件都已经是 Agent，那就已经产生质变了。</p>
<p><strong>量子位</strong>：</p>
<p>确实，今年我们看到很多 Agent 产品出现，无论是现场和线上的观众可以多去尝试尝试不断出现的新的 Agent 产品，看这些产品能不能带来一些新的收获和新的价值。</p>
<p>再次感谢三位嘉宾今天来到圆桌，跟我们从一线视角聊一聊 AI Agent 还需要进步的地方，以及现在明确能够带给我们的价值，谢谢大家。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[【Starrocks + Hive 】BitMap + 物化视图 实战记录]]></title>    <link>https://juejin.cn/post/7584659460245880851</link>    <guid>https://juejin.cn/post/7584659460245880851</guid>    <pubDate>2025-12-17T10:17:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584659460245880851" data-draft-id="7584443518036951103" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="【Starrocks + Hive 】BitMap + 物化视图 实战记录"/> <meta itemprop="keywords" content="大数据"/> <meta itemprop="datePublished" content="2025-12-17T10:17:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小C806"/> <meta itemprop="url" content="https://juejin.cn/user/2596377122057817"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            【Starrocks + Hive 】BitMap + 物化视图 实战记录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2596377122057817/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小C806
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:17:50.000Z" title="Wed Dec 17 2025 10:17:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">BitMap 简单介绍</h2>
<p>高效的数据结构（bit数组），使用二进制位（0或1）来简洁地表示信息，适用于处理海量数据（大规模整数）的去重、查询和统计。</p>
<p><em><strong>更优的Bitmap - RoaringBitmap</strong></em></p>
<p>将32位整数分成高16位(计算桶的索引位置)和低16位（实际存放数据的桶），使用桶来存储。Container有三种类型：ArrayContainer、BitmapContainer和RunContainer</p>
<p><strong>使用要求:</strong></p>
<p>字段为 int 类型:
连续性越好，性能越高</p>
<p><strong>示例:</strong></p>
<p>单位关系: (1byte = 8bit) 1 int = 4byte</p>
<p>bitmap 实际空间: 99999999 / 8 / 1024 /1024 = 11.92 M</p>
<p>RoaringBitmap 实际空间:  2<em>2 + 2</em>2 = 8 byte
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ceb44d4f833c449e8b2f182827474c00~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=%2FrXfWGvXNdc%2Bw8oWewChOL3lOJQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-1">在Hive 和 Starrocks 联合使用</h2>
<p><em><strong>使用场景:</strong></em></p>
<p>大量数据精确去重场景: 热门网站 pv pu , 用户画像圈人等场景</p>
<ul>
<li>bitmap 索引加速(starrocks 使用较多)</li>
<li>hive 中使用（包括spark）</li>
<li>hive中原生不支持 bitmap，一般需要自己构建UDF将数据转成bitmap格式，然后存储为 binary 类型。</li>
</ul>
<h2 data-id="heading-2">UDF 构建</h2>
<p>在新版本的starrocks中，有官方提高的 <strong>hive-udf.jar</strong> 包可以支持 hive bitmap的使用;</p>
<p>jar 包地址</p>
<blockquote>
<p>fe/hive-udf/hive-udf-1.0.0.jar</p>
</blockquote>
<p><strong>使用场景</strong></p>
<ul>
<li>原始数据量大，需要导入 starrocks 构建bitmap类型字段，直接导入会导致 SR 集群<strong>负载高</strong>，希望在 hive 中构建完成再导入。</li>
<li>导出 starrocks 中的 bitmap 至 hive，提供其他场景使用</li>
</ul>
<p><strong>支持的 hive bitmap udf 函数:</strong></p>
<p>具体参考: <code>https://docs.starrocks.io/zh/docs/3.5/sql-reference/sql-functions/hive_bitmap_udf/#%E6%94%AF%E6%8C%81%E7%94%9F%E6%88%90%E7%9A%84-hive-bitmap-udf-%E5%87%BD%E6%95%B0</code></p>
<p><strong>常用以下：</strong></p>
<ul>
<li>bitmapAgg ：将数据列转成 bitmap 类型，性能好</li>
<li>bitmapcount：统计bitmap中的数据值</li>
<li>bitmapunion: 求一组bitmap的并集一般联合 bitmapcount 使用, 效果类时 count distinct</li>
</ul>
<p><em><strong>使用前提(对象列必须为 整数类型):</strong></em></p>
<p>非整数字符串数据需要构建<strong>全局字典表</strong>进行映射</p>
<p><strong>构建方式:</strong></p>
<ol>
<li>hive 中处理</li>
</ol>
<pre><code class="hljs language-sql" lang="sql">

<span class="hljs-comment">-- 字典表</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> prd_tmp.dict_test (id string,load_date string, id_int <span class="hljs-type">bigint</span>) <span class="hljs-keyword">using</span> orc;
 
<span class="hljs-comment">-- 数据写入 or 更新</span>
<span class="hljs-keyword">with</span>
  max_id_int <span class="hljs-keyword">as</span> (
  <span class="hljs-keyword">select</span> ifnull(<span class="hljs-built_in">max</span>(id_int),<span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> max_id_int <span class="hljs-keyword">from</span> prd_tmp.dict_test
  )
  ,
  new_data <span class="hljs-keyword">as</span> (
<span class="hljs-keyword">select</span>
  sale_ordr_doc
  ,date_format(<span class="hljs-built_in">CURRENT_TIMESTAMP</span>(),<span class="hljs-string">'yyyyMMdd'</span>) load_date
  ,(<span class="hljs-built_in">row_number</span>() <span class="hljs-keyword">over</span>(<span class="hljs-keyword">order</span> <span class="hljs-keyword">by</span> sale_ordr_doc )) <span class="hljs-operator">+</span> (<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> max_id_int) id_int
  <span class="hljs-keyword">from</span> prd_dwd.ordr_detl  t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2 <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span> t2.id <span class="hljs-keyword">is</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">and</span> t1.stat_date <span class="hljs-operator">=</span> <span class="hljs-string">'20251213'</span>
  <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> sale_ordr_doc limit <span class="hljs-number">100</span>
)
 
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> prd_tmp.dict_test
<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> new_data


</code></pre>
<p><strong>效果如下:</strong>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/62be12a251bc42afaedf15c5040a3f85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=oW1FmFwOFDgmDLlAIL7uQMEbHSA%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol start="2">
<li>Starrocks 中处理</li>
</ol>
<p>Starrocks 3.0 + 版本支持，<strong>auto_increment</strong> 可简化全局字典构建流程</p>
<p>详情：<code>https://docs.starrocks.io/zh/docs/sql-reference/sql-statements/table_bucket_part_index/auto_increment/</code></p>
<p>使用注意事项：<code>https://docs.starrocks.io/zh/docs/sql-reference/sql-statements/table_bucket_part_index/auto_increment/#%E5%8D%95%E8%B0%83%E6%80%A7%E4%BF%9D%E8%AF%81</code></p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 构建带自增的主键表，主键为需要替换的ID</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> test_tbl1
(
    id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    number <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT
)
<span class="hljs-keyword">PRIMARY</span> KEY (id)
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(id)
PROPERTIES("replicated_storage" <span class="hljs-operator">=</span> "true");
</code></pre>
<h2 data-id="heading-3">hive 中使用bitmap UDF查询</h2>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 1. 将 hive-udf.jar 上传至hdfs目录, 这里假如上传至 /tmp 目录</span>
<span class="hljs-comment">-- 2. 链接hive或者spark</span>
 
<span class="hljs-comment">-- 3. 注册jar</span>
<span class="hljs-keyword">add</span> jar hdfs:<span class="hljs-operator">/</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>tmp<span class="hljs-operator">/</span>hive<span class="hljs-operator">-</span>udf.jar;
 
<span class="hljs-comment">-- 4. 创建函数</span>
<span class="hljs-keyword">create</span> temporary <span class="hljs-keyword">function</span> bitmap_count <span class="hljs-keyword">as</span> <span class="hljs-string">'com.starrocks.hive.udf.UDFBitmapCount'</span>;
<span class="hljs-keyword">create</span> temporary <span class="hljs-keyword">function</span> bitmap_agg <span class="hljs-keyword">as</span> <span class="hljs-string">'com.starrocks.hive.udf.UDAFBitmapAgg'</span>;
 
<span class="hljs-comment">-- 5. bitmap 函数去重查询</span>
<span class="hljs-keyword">select</span> bitmap_count(bitmap_agg(id_int)) <span class="hljs-keyword">from</span>
  (<span class="hljs-keyword">select</span>
  t1.sale_ordr_doc,
  t2.id_int
  <span class="hljs-keyword">from</span>
  ordr_detl t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2 <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span> t1.dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'20250710'</span> <span class="hljs-keyword">and</span> t1.dt<span class="hljs-operator">&lt;=</span><span class="hljs-string">'20251210'</span> ) a ;
 
 
<span class="hljs-comment">-- 6. 不使用bitmap 函数去重查询 (也可以不关联 prd_tmp.dict_test ，直接count原表的 id，这里为了验证 id_int 的数据量是否准确，所以保持一致 )</span>
<span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> id_int) <span class="hljs-keyword">from</span>
  (<span class="hljs-keyword">select</span>
  t1.sale_ordr_doc,
  t2.id_int
  <span class="hljs-keyword">from</span>
  ordr_detl t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2 <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span>  t1.stat_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'20250710'</span> <span class="hljs-keyword">and</span> t1.stat_date<span class="hljs-operator">&lt;=</span><span class="hljs-string">'20251210'</span> ) a ;
</code></pre>
<p>两者执行DAG和耗时如下: 左边为不使用 bitmap，右边为使用 bitmap, 耗时方面有所提升 （<em><code>为什么: 因为 【bitmap_agg(id_int)】过程为将查询的 int_id 构建为bitmap , 也存在性能损耗</code></em>）</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7df0c8c8c0fe4fff89b75c0216a4f0c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=t8e1OciF%2BVLIUGktSiHeAqCm5NI%3D" alt="在这里插入图片描述" loading="lazy"/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b206071a6804ea8a53388653487c932~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=CoW8NUaAHIBGlGjkdQru7CVSqwU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>对比下来，速度有一定提升，主要差别体现在执行计划上, 使用bitmap是，少了一段 shuffle 过程, 在数据的交换上也比count distinct 上小一个量级，<strong>在资源上有一定的节省</strong>。</p>
<h2 data-id="heading-4">Starrocks 中使用</h2>
<p>方式 ：</p>
<ul>
<li>在hive中根据使用场景构建完bitmap后导入starrocks</li>
<li>直接在starrocks中使用明细数据在物化视图中使用</li>
</ul>
<p>两者根据场景选择，第一种适用于查询场景固定且数据量巨大，可以降低starrocks的集群负载，</p>
<p>第二种属于直接在starrocks中进行计算构建，集群负载比第一种场景要高。</p>
<p><em><strong>hive中构建导入</strong></em></p>
<p>某个商品的订单数:</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 构建 hive bitmap 表</span>
<span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> prd_tmp.bitmap_goods_ordr_test(
goods_code <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>),
bitmap_col <span class="hljs-type">binary</span>) <span class="hljs-keyword">using</span> orc;
 
<span class="hljs-comment">-- 数据写入</span>
 
<span class="hljs-keyword">insert</span> <span class="hljs-keyword">into</span> prd_tmp.bitmap_goods_ordr_test
<span class="hljs-keyword">select</span>
  t1.goods_code
  ,bitmap_agg(t2.id_int) <span class="hljs-keyword">as</span> bitmap_col
  <span class="hljs-keyword">from</span>
  ordr_detl t1
  <span class="hljs-keyword">left</span> <span class="hljs-keyword">join</span> prd_tmp.dict_test t2
  <span class="hljs-keyword">on</span> t1.sale_ordr_doc <span class="hljs-operator">=</span> t2.id
  <span class="hljs-keyword">where</span>  t2.id <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">null</span> <span class="hljs-keyword">and</span> t1.stat_date <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'20250710'</span> <span class="hljs-keyword">and</span> t1.stat_date<span class="hljs-operator">&lt;=</span><span class="hljs-string">'20251210'</span>
  <span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> t1.goods_code
 
<span class="hljs-comment">-- sr 建表</span>
 <span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> bitmap_goods_ordr_test(
goods_code <span class="hljs-type">varchar</span>(<span class="hljs-number">16</span>), bitmap_col bitmap bitmap_union)
aggregate key(goods_code) 
distributed <span class="hljs-keyword">by</span> hash(goods_code);
 
<span class="hljs-comment">-- 数据写入 方式有很多种这里使用 broker load</span>
LOAD LABEL rpt_db.bitmap_goods_ordr_test_1
(
    data infile("hdfs://xxxx:8020/warehouse/tablespace/managed/hive/prd_tmp.db/bitmap_goods_ordr_test/*")
    <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> bitmap_goods_ordr_test
    format <span class="hljs-keyword">as</span> "orc"
)
<span class="hljs-keyword">WITH</span> BROKER
(
    "username" <span class="hljs-operator">=</span> "hdfs"
)
 
<span class="hljs-comment">-- starrocks 数据查询</span>
<span class="hljs-comment">-- bitmap_to_string(bitmap_col) 将 bitmap 转成字符串</span>
<span class="hljs-comment">-- bitmap_count 计算bitmap中的id个数</span>
 
<span class="hljs-keyword">select</span>  goods_code,bitmap_to_string(bitmap_col) <span class="hljs-keyword">as</span> c2,bitmap_count(bitmap_col) <span class="hljs-keyword">as</span> cnt 
<span class="hljs-keyword">from</span> bitmap_goods_ordr_test <span class="hljs-keyword">where</span> goods_code <span class="hljs-keyword">in</span> (<span class="hljs-string">'1000310'</span>,<span class="hljs-string">'1000324'</span>,<span class="hljs-string">'1000330'</span>);
</code></pre>
<p>c2 为转换后的 int 类型的订单ID
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b4e56cbb620544dea29806ffaddc9773~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=XsjPhZywdh3CtW3WJJVdoJjl6F8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>Starrocks 中使用构建使用</strong></p>
<ul>
<li>创建明细表</li>
<li>创建字典表</li>
<li>替换或者关联字典表使用</li>
<li>使用 dit_mapping 函数， <code>版本 3.x 之后且不支持存算分离部署方式</code>
结合物化视图</li>
</ul>
<pre><code class="hljs language-sql" lang="sql">
```<span class="hljs-keyword">sql</span>
<span class="hljs-comment">-- 创建明细表</span>
 
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> ordr_detl (
store_code string,
goods_code string,
sale_ordr_doc string ,
int_sale_ordr_doc <span class="hljs-type">bigint</span> ,
dt <span class="hljs-type">date</span>
)
ENGINE<span class="hljs-operator">=</span>OLAP
DUPLICATE KEY(store_code,goods_code,sale_ordr_doc,dt)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span>(`dt`)()
 DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(`store_code`) BUCKETS <span class="hljs-number">10</span>
PROPERTIES (
 "replication_num" <span class="hljs-operator">=</span> "3",
 "dynamic_partition.enable" <span class="hljs-operator">=</span> "true",
 "dynamic_partition.time_unit" <span class="hljs-operator">=</span> "DAY",
 "dynamic_partition.time_zone" <span class="hljs-operator">=</span> "Asia/Shanghai",
 "dynamic_partition.start" <span class="hljs-operator">=</span> "-180",
 "dynamic_partition.end" <span class="hljs-operator">=</span> "1",
 "dynamic_partition.prefix" <span class="hljs-operator">=</span> "p",
 "dynamic_partition.replication_num" <span class="hljs-operator">=</span> "3",
 "dynamic_partition.buckets" <span class="hljs-operator">=</span> "3",
 "in_memory" <span class="hljs-operator">=</span> "false"
);
 
<span class="hljs-comment">-- 示例查询</span>
<span class="hljs-keyword">select</span> stsc_mon , phmc_code , <span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> sale_ordr_doc)
<span class="hljs-keyword">from</span> ordr_detl <span class="hljs-keyword">where</span> dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-07-01'</span>
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>  phmc_code,stsc_mon;
 
 
<span class="hljs-keyword">select</span> stsc_mon , phmc_code , bitmap_count(bitmap_union(to_bitmap(int_sale_ordr_doc)))
<span class="hljs-keyword">from</span> ordr_detl <span class="hljs-keyword">where</span> dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-07-01'</span>
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span>  phmc_code,stsc_mon;
</code></pre>
<p>耗时对比: 上述为 bitmap ， 下述为 count distinct <code>修正这里的耗时仅作为参考，bitmap_union(to_bitmap(int_sale_ordr_doc) ) 代表需要从整数构建成bitmap类型的过程，当基数较大时耗费的时间和CPU会很长，从而导致耗时比distinct更长，所以一般将该部分放在物化视图中进行构建，查询时之间使用</code></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d4a8f55f8554f40a263df5b61401971~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=J133DJaFEw5o8ajBidC4nNPN49A%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>在查询资源消耗上 bitmap 有很大的节省. [图片太大无法上传]</p>
<p><strong>使用场景分析</strong></p>
<ul>
<li>需要实时分析的场景+数据量较大的count去重分析+查询灵活多变：一般建议使用明细模型+物化视图+bitmap进行处理 灵活处理。</li>
<li>固定场景+离线分析：可以使用hive进行离线计算后导入使用，及预计算。</li>
</ul>
<h2 data-id="heading-5">物化视图</h2>
<p>分为<strong>同步物化视图</strong>和<strong>异步物化视图</strong></p>
<ul>
<li>同步物化视图
<ul>
<li>仅支持单表</li>
<li>同步刷新，无需人工操作</li>
<li>仅支持基于 default catalog 的单表构建</li>
<li>支持的聚合函数: min, max, hll_union, percentile_union, count, sum, bitmap_union</li>
</ul>
</li>
<li>异步物化视图
<ul>
<li>支持多表关联</li>
<li>异步更新，手动刷新</li>
<li>支持多表构建：Default catalog、external catalog (v2.5)、已有异步物化视图(v2.5)、已有视图（v3.1）</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 定义查询场景</span>
<span class="hljs-keyword">select</span> dt,phmc_code,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> int_sale_ordr_doc) ordr_cnt
<span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code ;
 
<span class="hljs-comment">-- 构建物化视图</span>
<span class="hljs-keyword">CREATE</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> store_ordr_cnt <span class="hljs-keyword">AS</span>
<span class="hljs-keyword">select</span> dt,phmc_code,bitmap_union(to_bitmap(int_sale_ordr_doc))  ordr_cnt
<span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code ;
 
<span class="hljs-comment">-- 查看物化视图构建状态</span>
<span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">ALTER</span> MATERIALIZED <span class="hljs-keyword">VIEW</span>
 
<span class="hljs-comment">-- 取消正在构建的物化视图 12090 为 job ID 使用 【SHOW ALTER MATERIALIZED VIEW】 获取</span>
CANCEL <span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">ROLLUP</span> <span class="hljs-keyword">FROM</span>  ordr_detl  (<span class="hljs-number">12090</span>);
 
<span class="hljs-comment">-- 删除构建完成的物化视图</span>
 
<span class="hljs-keyword">DROP</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> store_amt;
</code></pre>
<p>构建状态：
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/80c8c4088bb54a7d962e96eded56f496~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=nfrYfgmxuojhpvrS4bdXvCdHjIs%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>之前的查询计划：【使用原表作为查询底表】
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9cbc3694ea64e4e8852b866bf4f3636~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=8mEt4Y%2B%2Feiwiw0Unjnj%2FjgYE2nM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>构建完成后再次执行查看执行计划:【<strong>使用物化视图作为底表查询</strong>】</p>
<p>备注 在执行sql  SR 会根据已有的物化视图自动改写查询，如果匹配中有可用的物化视图则会</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">select</span> dt,phmc_code,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> int_sale_ordr_doc) ordr_cnt
<span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code ;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ab46e2ee209451b85f79621c1340838~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=5wv1c74GYbwNBw3FAaJvwLvRxVM%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>查看表结构会发现多出一个物化视图相关的信息：【DESC ordr_detl_flag ALL】
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ce84d0c0263487395a25d0c920f0a7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=BR%2FtzB5xkBY3kK2zrVSGYoVs2sU%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<h2 data-id="heading-6">异步物化视图</h2>
<ul>
<li>多表关联</li>
<li>手动调用、定时任务、或者自动触发刷新</li>
<li>支持部分分区刷新</li>
<li>支持更多的聚合算子</li>
</ul>
<p><strong>使用场景</strong>：</p>
<p><strong>数仓环境</strong>:</p>
<ul>
<li>加速重复聚合查询：大量可重复使用的子查询，占用大量资源</li>
<li>周期性多表关联查询：多表关联形成宽表，可以避免手动关联调度任务，设置定期刷新规则</li>
<li>数仓分层</li>
<li>湖仓加速：查询数据湖可能因为网络延迟或者对象存储吞吐限制变慢，构建物化视图固化</li>
</ul>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询示例 </span>
<span class="hljs-keyword">select</span> dt,phmc_code,ordr_sour_code ,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> sale_ordr_doc) ordr_cnt <span class="hljs-keyword">from</span> dwb_sd_so_ordr_detl_flag_d
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code,ordr_sour_code
 
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH(`order_id`)
<span class="hljs-keyword">CREATE</span> MATERIALIZED <span class="hljs-keyword">VIEW</span> order_mv
REFRESH ASYNC <span class="hljs-keyword">START</span>(<span class="hljs-string">'2022-09-01 10:00:00'</span>) <span class="hljs-keyword">EVERY</span> (<span class="hljs-type">interval</span> <span class="hljs-number">1</span> <span class="hljs-keyword">day</span>)
<span class="hljs-keyword">AS</span>
<span class="hljs-keyword">select</span> dt,phmc_code,ordr_sour_code ,bitmap_union(to_bitmap(int_sale_ordr_doc)) ordr_cnt <span class="hljs-keyword">from</span> dwb_sd_so_ordr_detl_flag_d
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> dt,phmc_code,ordr_sour_code
</code></pre>
<p>查看异步视图执行状态：</p>
<p>查看 tasks 表中的最新任务 <code>select * from information_schema.tasks order by CREATE_TIME desc limit 1;</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/33d7b2eebe39434b9907dca519791830~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=z70UpOTl85vdvyQzd6D1uAzNHUQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>查看 在 task_runs 表中的执行状态 <code>select * from information_schema.task_runs where task_name='mv-10647552' order by CREATE_TIME;</code>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d08f439409ba4ef988b9eb756075e906~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=H5skegcsILu%2FmbhGxzBhQFewKTQ%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p>手动刷新异步视图 <code>REFRESH MATERIALIZED VIEW order_mv;</code></p>
<p><strong>实际使用:</strong></p>
<p>基于 异步视图 order_mv 测试</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 查询语句在 ordr_mv 的子集中 SR 自动改写使用了 物化视图</span>
 
<span class="hljs-keyword">select</span> phmc_code,ordr_sour_code,<span class="hljs-built_in">count</span>(<span class="hljs-keyword">DISTINCT</span> int_sale_ordr_doc) ordr_cnt <span class="hljs-keyword">from</span> ordr_detl
<span class="hljs-keyword">where</span> dt <span class="hljs-operator">&gt;=</span> <span class="hljs-string">'2025-10-01'</span>
<span class="hljs-keyword">group</span> <span class="hljs-keyword">by</span> phmc_code,ordr_sour_code
</code></pre>
<p>explain 如下:  count distinct 也转成了 bitmap 操作</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aef22c5941b44227b51e7555c3a0faf1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCPQzgwNg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571470&amp;x-signature=SjzwexWnZSdUiV%2FxAY9PqjjQO%2B8%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<p><strong>可以将物化视图看成一张物理表，索引、分区、分桶等优化操作都可执行，具体参考官网 ： <code>https://docs.starrocks.io/zh/docs/3.5/sql-reference/sql-statements/materialized_view/CREATE_MATERIALIZED_VIEW/</code></strong></p>
<h2 data-id="heading-7">性能虽好合理使用：</h2>
<p><strong>优点：</strong></p>
<ul>
<li>提升响应速度，优化查询性能</li>
<li>优化任务分层逻辑</li>
</ul>
<p><strong>不足：</strong></p>
<ul>
<li>人工配置，维护成本高</li>
<li>异步视图，定时刷新，难以保证数据的强一致性</li>
<li>过多的物化视图导致集群压力过大，维护困难</li>
<li>物化视图空间换时间，存储成本增加</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Google全链路赋能出海：3人团队调度千个智能体，可成独角兽｜MEET2026]]></title>    <link>https://juejin.cn/post/7584639987212845090</link>    <guid>https://juejin.cn/post/7584639987212845090</guid>    <pubDate>2025-12-17T10:20:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584639987212845090" data-draft-id="7584633505105362996" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Google全链路赋能出海：3人团队调度千个智能体，可成独角兽｜MEET2026"/> <meta itemprop="keywords" content="AIGC,AI编程"/> <meta itemprop="datePublished" content="2025-12-17T10:20:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="量子位"/> <meta itemprop="url" content="https://juejin.cn/user/2858385963484488"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Google全链路赋能出海：3人团队调度千个智能体，可成独角兽｜MEET2026
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2858385963484488/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    量子位
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:20:41.000Z" title="Wed Dec 17 2025 10:20:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>未来应该是智能体之间自主协同，解决复杂问题、自动化工作流程、自主下达任务，创建一种全新的商业模式。</p>
</blockquote>
<p>在量子位 MEET2026 智能未来大会上 Google Cloud 大中华区企业与中国初创业务负责人 Dennis Yue 分享了一个与技术本身同样重要的命题：AI 智能体作为新的生产力单元，正在为初创企业的出海逻辑注入新的内涵。</p>
<p>这不仅是对技术趋势的判断，也是对创业范式转移的思考。当 3 到 10 人的团队可以调度成百上千个智能体，当智能体与智能体之间能够跨企业自主通信，创业公司的边界、人效比、商业模式都将被重新定义。</p>
<p>在 Dennis 看来，<strong>智能体赛道才刚刚开始，未来一两年会经历剧烈变化，这也是中国初创企业出海的重大机遇窗口</strong>。</p>
<p>面对这一机遇与挑战，谷歌推出了 AI 驱动的一体化解决方案，全链路赋能初创企业高效出海。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3245d5434cce433ea8a0d74b5fa84630~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YeP5a2Q5L2N:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571640&amp;x-signature=n0fQ5B9z0CjNXxX82g3JmW8hKrw%3D" alt="" loading="lazy"/></p>
<p><em>MEET2026 智能未来大会是由量子位主办的行业峰会，近 30 位产业代表与会讨论。线下参会观众近 1500 人，线上直播观众 350 万 +，获得了主流媒体的广泛关注与报道。</em></p>
<h2 data-id="heading-0">核心观点</h2>
<ul>
<li>
<p>初创企业在全球化过程中面临不同侧重点与挑战，Google 的全链路生态在每一阶段都可以为初创企业助力，赋能高效出海。</p>
</li>
<li>
<p>Gemini 3 是一次真正的突破，在多个权威榜单中排名第一，标志着从 “辅助工具” 向“自主智能体”的跨越。</p>
</li>
<li>
<p>谷歌主导推出了 A2A 协议（Agent-to-Agent Protocol，智能体间通信协议），旨在打通跨企业、跨系统的智能体协同。</p>
</li>
<li>
<p>商业模式正在从 SaaS 按月订阅转向 Outcome-based 按结果付费，这是智能体时代的底层逻辑变化。</p>
</li>
<li>
<p>3 到 10 人的初创团队完全可能通过调度大量智能体成长为独角兽，但需要重视数据壁垒、行业深度集成以及法律合规。</p>
</li>
</ul>
<h2 data-id="heading-1">初创出海的五个阶段与 Google 全链路解决方案</h2>
<p>在演讲开篇，Dennis 系统梳理了初创企业出海的五个阶段，以及谷歌在每个阶段能够提供的支持。</p>
<p>第一阶段是萌芽与战略规划期。 创始人刚刚有了初步想法，需要进行大量信息收集和竞品分析。Dennis 观察到，很多创始人会使用 Gemini 进行市场调研，因为它储存了海量资料，能够辅助完成从市场洞察到 MVP（最小可行产品）的整个流程。</p>
<p>第二阶段是产品推出期。 当第一个产品成型并准备推向市场时，Google Cloud 平台可以提供稳定的云基础设施支撑。</p>
<p>第三阶段是首个市场验证期。 找到第一批客户是从 0 到 1 破局的关键，此时 Google Ads 团队可以帮助初创公司，通过高效的广告渠道触达目标客户群体。</p>
<p>第四阶段是多市场扩张期。 当第一个市场站稳脚跟、准备拓展第二个市场时，Google Play、Google AdMob/AdSense、Google Maps 等产品都可以提供协同支持。</p>
<p>第五阶段是 IPO 成熟期。 公司进入持续迭代和规模化增长阶段，谷歌的数据分析工具和周边服务可以助力企业完成上市前的最后冲刺。</p>
<p>Dennis 还谈到了大模型领域的共同难题：幻觉（Hallucination，即模型生成不准确或虚构的信息）。</p>
<p>解决路径包括更好的模型训练、更好的工程化实践、以及引导客户侧进行更好的上下文工程。配合 Gemini 本身强大的原生推理能力，幻觉问题正在逐步得到缓解。</p>
<p>Dennis 认为，未来一年整个 AI 领域会继续快速演进。对于初创公司而言，无论产品是刚刚起步还是已经上路，都应该认真思考如何将智能体协同、上下文工程、按结果付费等新概念融入自身业务。 </p>
<p>“我认为 AI 智能体才刚刚开始，未来一两年变化会非常大。如果通过智能体这个赛道出海，现在是值得认真考虑的时机。”</p>
<p>Google 全链路生态，高效驱动出海创业增长，欢迎扫描文末二维码，了解更多 Google 出海解决方案。</p>
<h2 data-id="heading-2">Gemini 的进化：从初具雏形到全面领先</h2>
<p>谈及对中国出海初创企业的赋能，Dennis 回顾了 Gemini 的成长历程。</p>
<p>两年多前，谷歌将 Google Brain 与 DeepMind 两大 AI 团队合并，在极短时间内推出了 Gemini 1。</p>
<p>Gemini 1 作为第一个原生多模态模型，已经开始帮助一批初创公司开展业务。</p>
<p>到了 1.5 和 2 版本，Gemini 经历了质的提升，推理能力、理解能力和问题解决能力都有了显著增强。<strong>而 2025 年 11 月发布的 Gemini 3，则全面超越了前两代产品</strong>。这一版本基于此前迭代积累的经验进行了重构，在多个权威评测榜单中拿下第一名，引发了行业媒体的广泛报道。</p>
<p>为什么 Gemini 3 是一次突破？Dennis 认为，这几年 AI 发展出了两条路径：一条是智能体（Agent），另一条是代理式 AI（Agentic AI）。他在与初创公司的交流中发现，已经有团队成功地将智能体产品化，转化为真实的 ARR（年度经常性收入）和 ACV（年度合同价值）。</p>
<p><strong>智能体不再是概念，而是具备真实变现能力的应用。</strong></p>
<h2 data-id="heading-3">A2A 协议：打通智能体之间的 “语言”</h2>
<p>当单个企业内部的智能体逐渐成熟，一个更棘手的问题浮出水面：不同企业的智能体之间如何有效通信？</p>
<p>企业内部的智能体相对容易连接，通过编写提示词（Prompt）或配置工作流就能实现协同。<strong>但当一个企业的智能体需要与另一个企业的智能体对话时，就缺乏统一的标准和协议。</strong></p>
<p>为此，谷歌主导推出了 A2A 协议（Agent-to-Agent Protocol）。这一协议的核心目标是让智能体之间能够自主协同、自主下达任务、自主执行工作流程。</p>
<p>可以想象这样一幅图景：每一个节点代表企业内部不同部门的智能体，或者代表不同企业的智能体，甚至是企业外部的第三方智能体。如果为每个智能体定义好功能层面的 API（应用程序接口），这些 API 就可以被复用，智能体之间就能跨界协同。在特定场景或问题面前，它们可以自主请求其他智能体提供方案，再通过 AI 算法做出最优选择。</p>
<p><strong>A2A 协议不是谷歌的独角戏。</strong> 埃森哲、Salesforce、麦肯锡等全球顶级咨询公司，SAP 等传统 ERP 厂商，以及众多知名科技公司都已开始拥抱这一协议。谷歌正在推动将 A2A 全球化，让智能体之间的通信基于统一标准进行。</p>
<p>除了通信协议，商业世界还需要解决信任和支付问题。为此，谷歌又提出了 AP2 协议（Agent Payment Protocol，智能体支付协议）。这一协议已获得传统金融机构和新兴金融科技公司的广泛支持，目标是让智能体之间的交易不被锁定在某个单一支付系统中，而是基于多方共识形成高信任度的支付网络。</p>
<h2 data-id="heading-4">商业模式之变：从 SaaS 订阅到按结果付费</h2>
<p>Dennis 在与大量创业者交流后观察到，智能体时代正在催生商业模式的根本性变化。</p>
<p>**旧生态的典型形态是 SaaS（软件即服务）：**B2B 公司以按月订阅的方式，帮助企业解决特定功能需求。这更像是一个助手模式，帮你写邮件、帮你安排会议，按时间收费。</p>
<p>**新生态的核心逻辑是 Outcome-based（按结果付费）：**智能体不仅帮你写邮件，还帮你成功约到客户、安排好视频会议。你为最终结果付费，而不是为过程中的动作付费。这种模式已经开始在市场上出现，甚至逐渐成为竞争中的差异化卖点。</p>
<p>这种转变带来了一个令人振奋的可能性：**3 到 10 人的初创公司可以成长为独角兽。**因为在智能体时代，每个员工都可以调度十个、一百个、甚至一千个智能体。繁重的执行工作由智能体完成，人类专注于战略决策和系统优化。</p>
<p>但 Dennis 也提醒，新模式下的护城河正在发生变化。以往，漂亮的 UI（用户界面）和良好的用户体验是竞争壁垒；现在，<strong>真正的护城河来自与传统行业的深度集成，以及独有的专有数据。</strong></p>
<p>同时，智能体自主决策也带来了新的风险：如果智能体犯错，赔偿责任如何界定？不同国家对此有不同的法律规定。这是初创公司在出海时必须认真考量的问题。</p>
<h2 data-id="heading-5">Gemini 3 的三大能力与工程化思维</h2>
<p>在技术层面，Dennis 介绍了 Gemini 3 的几个关键能力。</p>
<p><strong>第一是超长上下文窗口，支持 100 万 Token。</strong></p>
<p>过去大家关注的是 Prompt Engineering（提示词工程），现在更重要的是 Context Engineering（上下文工程）。如果丢给智能体的信息未经整理和结构化处理，即便模型再强大，输出的结果也不会足够智能。</p>
<p><strong>第二是原生多模态能力。</strong></p>
<p>Gemini 3 可以像理解文字一样理解视频、图像和语音，且清晰度和准确度大幅提升。</p>
<p><strong>第三是 Function Calling（精准工具调用）能力。</strong></p>
<p>这让智能体开始 “长出手脚”，能够调用外部工具和服务。配合 Vertex AI、Agent Builder 等工程化平台，开发者可以构建更加智能、更加专业化的智能体。</p>
<p>Dennis 特别强调，Gemini 3 是我们迄今为止最安全的模型，并且接受了 Google AI 模型中最全面的一套安全评估。</p>
<p>对 Google 全链路出海解决方案感兴趣的中国出海初创企业可以扫码进一步了解。</p>
<p><strong>欢迎在评论区留下你的想法！</strong></p>
<p>— <strong>完</strong> —</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[改了CSS刷新没反应-你可能不懂HTTP缓存]]></title>    <link>https://juejin.cn/post/7584650421124333609</link>    <guid>https://juejin.cn/post/7584650421124333609</guid>    <pubDate>2025-12-17T10:24:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650421124333609" data-draft-id="7584443518037033023" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="改了CSS刷新没反应-你可能不懂HTTP缓存"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-17T10:24:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="也无风雨也雾晴"/> <meta itemprop="url" content="https://juejin.cn/user/2175258804632332"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            改了CSS刷新没反应-你可能不懂HTTP缓存
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2175258804632332/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    也无风雨也雾晴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:24:20.000Z" title="Wed Dec 17 2025 10:24:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">改了 CSS 刷新没反应？你可能不懂 HTTP 缓存</h2>
<p>做前端的应该都遇到过这种情况：明明改了 CSS，浏览器里看到的还是旧样式。网上搜一下，告诉你"清缓存"，Ctrl+F5 一刷新就好了。</p>
<p>但问题是：</p>
<ul>
<li>缓存到底是怎么工作的？</li>
<li>为什么有时候会用缓存，有时候不会？</li>
<li>Network 面板里的 <code>(disk cache)</code> 和 <code>304 Not Modified</code> 有什么区别？</li>
</ul>
<p>今天把这个问题彻底搞清楚。</p>
<h3 data-id="heading-1">HTTP 缓存的两层机制</h3>
<p>浏览器缓存分两层：<strong>强缓存</strong>和<strong>协商缓存</strong>。</p>
<p>简单说：</p>
<ul>
<li><strong>强缓存</strong>：直接用本地缓存，不问服务器</li>
<li><strong>协商缓存</strong>：问一下服务器"我这个还能用吗？"服务器说"能"，就用缓存</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">浏览器想请求资源
    │
    ▼
检查本地缓存
    │
    ├── 有缓存且没过期 → 强缓存命中 → 返回 <span class="hljs-number">200</span> (<span class="hljs-keyword">from</span> cache)
    │
    └── 没缓存 / 过期了
            │
            ▼
        发请求给服务器，带上验证信息
            │
            ├── 服务器说没变 → 协商缓存命中 → 返回 <span class="hljs-number">304</span>
            │
            └── 服务器说变了 → 返回 <span class="hljs-number">200</span> + 新资源
</code></pre>
<h3 data-id="heading-2">强缓存：完全不发请求</h3>
<p>强缓存命中时，浏览器直接从本地拿资源，Network 面板会显示：</p>
<ul>
<li><strong>Size</strong> 列：<code>(disk cache)</code> 或 <code>(memory cache)</code></li>
<li><strong>Time</strong> 列：<code>0ms</code> 或很小的数字</li>
</ul>
<p>控制强缓存的响应头：</p>
<pre><code class="hljs language-http" lang="http"># 方式1：Cache-Control（推荐）
Cache-Control: max-age=31536000

# 方式2：Expires（老方式，优先级低于 Cache-Control）
Expires: Wed, 21 Oct 2025 07:28:00 GMT
</code></pre>
<p><code>max-age=31536000</code> 意思是"这个资源 31536000 秒（一年）内有效"。</p>
<h4 data-id="heading-3">memory cache vs disk cache</h4>
<p>两者区别：</p>























<table><thead><tr><th>类型</th><th>存储位置</th><th>速度</th><th>什么时候用</th></tr></thead><tbody><tr><td>memory cache</td><td>内存</td><td>最快</td><td>当前会话、小文件、频繁访问的资源</td></tr><tr><td>disk cache</td><td>硬盘</td><td>稍慢</td><td>跨会话、大文件</td></tr></tbody></table>
<p>关了浏览器 Tab，memory cache 就没了，disk cache 还在。</p>
<h3 data-id="heading-4">协商缓存：问一下服务器</h3>
<p>当强缓存过期（或被设置为 <code>no-cache</code>），浏览器会发请求给服务器验证资源是否变化。</p>
<p>有两种验证方式：</p>
<h4 data-id="heading-5">方式1：ETag / If-None-Match（推荐）</h4>
<p>基于内容哈希：</p>
<pre><code class="hljs language-http" lang="http"># 第一次请求，服务器返回
HTTP/1.1 200 OK
ETag: "abc123"
Cache-Control: no-cache

# 后续请求，浏览器带上 If-None-Match
GET /style.css HTTP/1.1
If-None-Match: "abc123"

# 如果内容没变，服务器返回
HTTP/1.1 304 Not Modified
ETag: "abc123"

# 如果内容变了，服务器返回
HTTP/1.1 200 OK
ETag: "xyz789"
[新的文件内容]
</code></pre>
<h4 data-id="heading-6">方式2：Last-Modified / If-Modified-Since</h4>
<p>基于修改时间：</p>
<pre><code class="hljs language-http" lang="http"># 第一次请求，服务器返回
HTTP/1.1 200 OK
Last-Modified: Wed, 21 Oct 2024 07:28:00 GMT

# 后续请求，浏览器带上 If-Modified-Since
GET /style.css HTTP/1.1
If-Modified-Since: Wed, 21 Oct 2024 07:28:00 GMT

# 如果文件没改过，服务器返回 304
</code></pre>
<h4 data-id="heading-7">ETag vs Last-Modified</h4>
<p>优先用 ETag，因为 Last-Modified 有问题：</p>
<ol>
<li><strong>精度只到秒</strong> - 1 秒内改多次，检测不到</li>
<li><strong>时间可能不准</strong> - 服务器时间、部署时间等问题</li>
<li><strong>只看时间不看内容</strong> - 文件内容没变但时间变了，也会重新下载</li>
</ol>
<h3 data-id="heading-8">不同资源该用什么策略？</h3>
<h4 data-id="heading-9">静态资源（JS/CSS/图片）</h4>
<pre><code class="hljs language-http" lang="http">Cache-Control: max-age=31536000, immutable
</code></pre>
<p>配合文件名哈希：<code>app.abc123.js</code></p>
<p>内容变了 → 文件名变了 → 请求新文件，老文件继续用缓存。</p>
<p>这是现代前端打包工具（Webpack、Vite）的标准做法。</p>
<h4 data-id="heading-10">HTML 文件</h4>
<pre><code class="hljs language-http" lang="http">Cache-Control: no-cache
ETag: "page-v1"
</code></pre>
<p><code>no-cache</code> 不是"不缓存"，而是"每次都要验证"。HTML 文件要保证用户能拿到最新版本，否则会引用旧的 JS/CSS 文件名。</p>
<h4 data-id="heading-11">API 接口</h4>
<p>根据数据特性选择：</p>
<pre><code class="hljs language-http" lang="http"># 几乎不变的数据（如配置）
Cache-Control: max-age=3600

# 实时性要求高的数据
Cache-Control: no-cache

# 敏感数据（不要缓存）
Cache-Control: no-store
</code></pre>
<p><code>no-store</code> 才是真正的"不缓存"，连验证都不做。</p>
<h3 data-id="heading-12">常见问题排查</h3>
<h4 data-id="heading-13">改了文件，浏览器没反应</h4>
<p>原因：强缓存还没过期。</p>
<p>解决方案：</p>
<ol>
<li><strong>开发环境</strong> - 打开 DevTools，勾选 "Disable cache"</li>
<li><strong>生产环境</strong> - 用文件名哈希，别用 <code>?v=1.0</code> 这种</li>
</ol>
<h4 data-id="heading-14">用了 ?v=1.0 还是不行</h4>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/css/style.css?v=1.0"</span>&gt;</span>
</code></pre>
<p>问题：有些 CDN 会忽略查询参数，或者浏览器缓存策略不一致。</p>
<p>正确做法：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/css/style.abc123.css"</span>&gt;</span>
</code></pre>
<p>让打包工具自动生成哈希，内容变了文件名才变。</p>
<h4 data-id="heading-15">CDN 缓存了旧文件</h4>
<p>部署了新版本，但用户还是拿到旧文件。</p>
<p>原因：CDN 节点还在缓存期内。</p>
<p>解决方案：</p>
<ol>
<li>部署时清除 CDN 缓存</li>
<li>用文件名哈希（CDN 会认为是新文件）</li>
</ol>
<h3 data-id="heading-16">Nginx 配置参考</h3>
<pre><code class="hljs language-nginx" lang="nginx"># 静态资源长期缓存
location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# HTML 文件协商缓存
location ~* \.html$ {
    add_header Cache-Control "no-cache";
    etag on;
}

# API 不缓存
location /api/ {
    add_header Cache-Control "no-store";
}
</code></pre>
<h3 data-id="heading-17">快速判断缓存类型</h3>
<p>打开 DevTools Network 面板：</p>






























<table><thead><tr><th>看到什么</th><th>缓存类型</th><th>含义</th></tr></thead><tbody><tr><td>200 + <code>(disk cache)</code></td><td>强缓存</td><td>从硬盘读取</td></tr><tr><td>200 + <code>(memory cache)</code></td><td>强缓存</td><td>从内存读取</td></tr><tr><td>304 Not Modified</td><td>协商缓存</td><td>服务器说没变</td></tr><tr><td>200 + 正常大小</td><td>无缓存</td><td>重新下载</td></tr></tbody></table>
<h3 data-id="heading-18">一句话总结</h3>
<ul>
<li><strong>强缓存</strong>：不问服务器，直接用。适合长期不变的静态资源。</li>
<li><strong>协商缓存</strong>：问服务器，没变就用缓存。适合需要保持最新的内容。</li>
<li><strong>文件名哈希</strong>：解决缓存更新问题的银弹。</li>
</ul>
<hr/>
<p>如果你觉得这篇文章有帮助，欢迎关注我的 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i" target="_blank" title="https://github.com/tt-a1i" ref="nofollow noopener noreferrer">GitHub</a>，下面是我的一些开源项目：</p>
<p><strong>Claude Code Skills</strong>（按需加载，意图自动识别，不浪费 token，<a href="https://juejin.cn/post/7578714735307735066" target="_blank" title="https://juejin.cn/post/7578714735307735066">介绍文章</a>）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fcode-review-skill" target="_blank" title="https://github.com/tt-a1i/code-review-skill" ref="nofollow noopener noreferrer">code-review-skill</a> - 代码审查技能，覆盖 React 19、Vue 3、TypeScript、Rust 等约 9000 行规则（<a href="https://juejin.cn/post/7578709098255908902" target="_blank" title="https://juejin.cn/post/7578709098255908902">详细介绍</a>）</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2F5-whys-skill" target="_blank" title="https://github.com/tt-a1i/5-whys-skill" ref="nofollow noopener noreferrer">5-whys-skill</a> - 5 Whys 根因分析，说"找根因"自动激活</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Ffirst-principles-skill" target="_blank" title="https://github.com/tt-a1i/first-principles-skill" ref="nofollow noopener noreferrer">first-principles-skill</a> - 第一性原理思考，适合架构设计和技术选型</li>
</ul>
<p><strong>全栈项目</strong>（适合学习现代技术栈）：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fprompt-vault" target="_blank" title="https://github.com/tt-a1i/prompt-vault" ref="nofollow noopener noreferrer">prompt-vault</a> - Prompt 管理器，用的都是最新的技术栈，适合用来学习了解最新的前端全栈开发范式：Next.js 15 + React 19 + tRPC 11 + Supabase 全栈示例，clone 下来配个免费 Supabase 就能跑</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftt-a1i%2Fchat_edit" target="_blank" title="https://github.com/tt-a1i/chat_edit" ref="nofollow noopener noreferrer">chat_edit</a> - 双模式 AI 应用（聊天+富文本编辑），Vue 3.5 + TypeScript + Vite 5 + Quill 2.0 + IndexedDB</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[快速构建企业 AI 开放平台，HiMarket 重磅升级]]></title>    <link>https://juejin.cn/post/7584659460245930003</link>    <guid>https://juejin.cn/post/7584659460245930003</guid>    <pubDate>2025-12-17T10:26:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584659460245930003" data-draft-id="7584443518163615780" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="快速构建企业 AI 开放平台，HiMarket 重磅升级"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2025-12-17T10:26:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云云原生"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            快速构建企业 AI 开放平台，HiMarket 重磅升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云云原生
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:26:26.000Z" title="Wed Dec 17 2025 10:26:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文作者：赵恒、岛风、文想、彦林、于怀2025 是 Agent 元年，企业开始大规模落地 Agent，都会遇到多 Agent 管理，多 MCP 工具管理，多模型管理问题，如何查找和选择合适的 Agent/MCP/Model？哪些高频场景可以快速让所有人参与？多个团队如何协同，权限如何管理，成本如何分摊？</p>
<p>为了解决这些挑战，阿里巴巴升级 AI 开放平台 HiMarket，基于阿里巴巴内部 IdeaLAB，扩展 AI 开放平台的能力，推出 v0.5.0 版本，<strong>提供 Agent/MCP/Model 市场能力，提供基于 Chat 的高频使用场景，提供账号权限管理和成本分摊能力。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e4cc6dcce1d44e98ccea2903f4ae066~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=YnmhmYVYmj3CQjedUd2ghxprgKk%3D" alt="BB584FD1-A8C3-4F31-8338-910BA4BB8499.png" loading="lazy"/></p>
<h2 data-id="heading-0">HiMarket 是什么</h2>
<p>HiMarket 是开源的 AI 开放平台，帮助企业快速构建 Agent 市场，释放 AI 创新潜能。对企业全员提供高频 AI 场景，释放 AI 创新潜能；为开发者提供 Agent 市场/MCP 市场/Model 市场，提升研发效能；为维护者提供 AI 治理能力，提升 AI 把控力。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c71ab916fc4141f993a7cc3153e7abe7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=rrV0ugC%2BY0pL4JiE53I7VPQ05nI%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">使用场景</h2>
<h3 data-id="heading-2">AI 场景（面对企业员工）</h3>
<p>HiMarket 提供了 HiChat 能力，通过 Chat 模式替代搜索，做市场调研和产品调研，生成运营图片等工作。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5d77eb3517f49b08e35f2601e412d05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=T1UXNe2dc45bRyjV8XeQl2TbJkw%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>企业全员 AI 使用入口</strong>：通过 HiMarket AI 开放平台，同时解决了员工不知道用哪些模型，企业如何管控员工用模型的两个问题；全员可以通过这个入口进行使用 AI 模型能力，企业可以进行整体安全合规审核，保证企业和员工使用 AI 范围安全可控。</li>
<li><strong>多模型对比</strong>：可以选择多个模型市场的模型，输入一次对比多个模型，快速直接对比模型返回内容差异，选取最优内容。</li>
<li><strong>会话历史记录</strong>：方便员工管理历史会话记录，可以快速基于历史信息进行对话回溯，并且计划后续基于对话可以形成知识点，知识点可以进行横向传递，提升数据共享效率。</li>
<li><strong>联网搜索</strong>：通过体验中心可以支持配置联网搜索能力，配置 Higress AI 网关联网搜索能力之后，所有模型都可以支持联网搜索，AI 网关会把对应搜索内容传递给模型使用摘取，扩大实时数据能力。</li>
<li><strong>支持关联 MCP 工具</strong>：体验中心聊天框支持关联 MCP 市场，可以实时快速的使用 MCP 能力，可以快速体验验证 MCP 本身能力情况，并且支持企业原本 API 快速配置化转换成 MCP 协议，结合模型做快速验证。</li>
</ul>
<h3 data-id="heading-3">AI 市场（面对开发者）</h3>
<p>HiMarket 支持构建涵盖 Agent、MCP Server、Model 的完整 AI 市场，让企业的各类 AI 资源不再分散，而是以标准化方式汇聚在一个平台上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b5b53549f1f54eda87997e9280a31483~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=ARsw05IOiqCHoLgl5JdSfii%2F0yg%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>Agent 市场</strong>：支持将复杂的 AI Agent 应用打包上架，可对接 AgentScope 等 Agent 开发平台，例如通过 AgentScope 构建的 Agent 可一键注册到 HiMarket，其他开发者订阅后即可直接使用，无需从零搭建；支持跨框架、跨语言的 agent 一键发布到 Agent 市场。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4207d39a8b064864aee33fecfa09bc01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=VBf8dWb0FNEsacYKcRWCLnAzIss%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>MCP 市场</strong>：支持接入不同平台的 MCP Server，并支持将外部 API 转换为标准化的 MCP Server，开发者订阅后，即可让 AI 应用轻松调用外部能力。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbc913cb2745434e8ee8b3c925978091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=FwANgRUj77A0%2FMihW%2FsW4dmuOD4%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>模型市场</strong>：支持公有云模型及企业自研私有模型的快速接入，平台以 Higress 作为模型服务的网关代理，提供内容安全、Token 限流等防护能力，保障模型服务对外开放的安全合规。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5d9888e1541243b7838c754a4edeb0ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=gc9jrg9vzRuEXk1zBm%2FAOwPff9E%3D" alt="image.png" loading="lazy"/></p>
<ul>
<li><strong>AI 资产生命周期管理</strong>：管理员将资源接入平台，配置访问策略和使用文档，发布上架；开发者在门户浏览、订阅、获取调用凭证即可订阅使用。</li>
</ul>
<h3 data-id="heading-4">AI 治理（面对 AI 维护者）</h3>
<p>HiMarket 实现了对 AI 资源的集中式治理，提供全方位的安全管控和协作能力：</p>
<ul>
<li><strong>安全合规保障</strong>：通过 Higress 网关统一管控所有 AI 资源的访问，支持内容安全检测、敏感信息过滤、访问权限控制，确保企业 AI 能力对外开放时符合安全合规要求。</li>
<li><strong>高效协作共享</strong>：打破团队间的“能力孤岛”，一个模型或工具接入后，可被多个部门订阅复用，避免重复采购和重复开发。</li>
<li><strong>降低使用门槛</strong>：开发者无需逐一对接不同厂商的 API，HiMarket 提供统一的协议标准和开箱即用的调用凭证，大幅降低接入成本，让团队更专注于业务创新而非基础设施搭建。</li>
</ul>
<h2 data-id="heading-5">产品优势</h2>
<h3 data-id="heading-6">企业级能力</h3>
<p>HiMarket 内置完善的企业级管理能力，确保 AI 资源的安全开放与高效运营。</p>
<ul>
<li><strong>产品管理</strong>：管理员可为不同 API 产品配置独立的认证鉴权和可见性策略，同时提供流量控制、IP 白名单等防护能力，保障服务安全稳定。</li>
<li><strong>观测分析</strong>：提供管理员视角的全局观测大盘，展示 AI API 的调用趋势、热门产品排行、异常流量预警等，支持按时间、产品类型、开发者等维度进行多维分析，为企业运营优化提供数据依据。</li>
<li><strong>计量计费</strong>：支持基于 Token、调用次数等多种计量模式，自动统计资源消耗并生成账单明细，既能服务企业内部的成本核算，也能支撑对外商业化运营。</li>
<li><strong>版本管理</strong>：支持 API 产品的多版本并行，管理员可以发布新版本、维护旧版本并平滑迁移用户，通过版本对比、灰度发布、快速回滚等功能，确保产品迭代的安全稳定。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2d59b45cba94fd2910f81d2fa8c24a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=2x9bm4MpE2iLfGSr4IwAjrv16ic%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-7">丰富观测能力</h3>
<p>观测分析（目前 v0.5.0 版本依赖阿里云商业化 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.aliyun.com%2Fproduct%2Fsls%3Fspm%3Da1z389.11499242.0.0.65452413PLWe13%26utm_content%3Dg_1000408139" target="_blank" title="https://www.aliyun.com/product/sls?spm=a1z389.11499242.0.0.65452413PLWe13&amp;utm_content=g_1000408139" ref="nofollow noopener noreferrer">SLS</a>，开源版本的观测分析实现计划在后续版本中提供）：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/518f976e75e04e21a4678c55609f05d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=z72oV2gq5252xG7MbIbGsBuoFjg%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-8">灵活扩展能力</h3>
<p>为了能够快速对接企业现有的系统，HiMarket 提供了灵活的定制能力，包括：</p>
<ul>
<li><strong>门户品牌</strong>：管理员可为门户配置自定义域名、Logo、主题色、布局样式等元素，并灵活配置首页模块、产品分类、推荐栏等功能区域。</li>
<li><strong>身份认证</strong>：支持内置账号密码和企业 OIDC 认证方式，可与企业 SSO、IDaaS 等身份系统无缝集成，实现统一的用户管理和身份认证。</li>
<li><strong>审批流程</strong>：开发者注册、凭证申请、API 订阅等关键流程可灵活配置自动或人工审批。</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/752c1b918c074137993e97043f8d5e89~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=ddBJO9VG5%2F7jt70v%2BlVhT1Ee47Y%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-9">快速体验</h2>
<p>HiMarket 提供多种部署方式，满足不同场景需求：</p>
<ul>
<li>本地快速体验：HiMarket 本地部署指南 <strong>[</strong> <strong>1]</strong> 。</li>
<li>Docker Compose 部署：HiMarket Docker 部署指南 <strong>[</strong> <strong>2]</strong> 。</li>
<li>Kubernetes 部署：HiMarket Helm 部署指南 <strong>[</strong> <strong>3]</strong> 。</li>
</ul>
<h3 data-id="heading-10">一键部署，开箱即用的完整方案</h3>
<p>HiMarket、Higress、Nacos 三大组件自动编排部署，无需人工干预。部署过程自动完成示例 MCP Server 的注册、配置和发布，让你在部署完成后即可体验 HiMarket 能力市场。无论是 Docker Compose 还是 Kubernetes 部署，均只需一条命令：</p>
<pre><code class="hljs language-bash" lang="bash">./deploy.sh install
</code></pre>
<p>部署脚本会自动完成以下所有工作：</p>
<ul>
<li><strong>核心组件部署</strong>：自动拉起 MySQL、Nacos 配置中心、Higress 网关服务</li>
<li><strong>应用本体部署</strong>：部署 HiMarket 全套服务（管理后台、开发者门户、后端服务）</li>
<li><strong>智能初始化</strong>：自动创建管理员账号、配置示例 MCP Server、发布演示 API 产品</li>
<li><strong>即开即用</strong>：部署完成后即可访问管理后台和开发者门户，无需任何手动配置</li>
</ul>
<p>方案支持灵活的场景适配：</p>
<ul>
<li>支持使用内置 MySQL 或对接已有数据库</li>
<li>支持使用阿里云商业化 MSE 服务和 AI 网关服务</li>
<li>支持 ./deploy.sh himarket-only<code> </code>仅部署 HiMarket 本体</li>
</ul>
<p>详细步骤请参考：HiMarket Docker 一键部署指南 <strong>[</strong> <strong>4]</strong> ，HiMarket Helm 一键部署指南 <strong>[</strong> <strong>5]</strong> 。</p>
<h2 data-id="heading-11">HiMarket Roadmap 规划</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41ef995213464ff4bd5b237faf2b6176~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766571986&amp;x-signature=9V3OWgQipWNfEeJaPdTulSW9aVc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-12">欢迎共建</h2>
<p>HiMarket 是多个开源社区共同发起的开源项目，核心参与者包括阿里云、蚂蚁数科、高德、淘天等团队，面向开源可以助力企业快速构建 AI 开放平台，提供开箱即用的能力。</p>
<p>特别感谢淘天 IdeaLAB 团队为 HiMarket 提供的基础，期待更多企业一起参与共建～</p>
<p>HiMarket 仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2FHiMarket" target="_blank" title="https://github.com/higress-group/HiMarket" ref="nofollow noopener noreferrer">github.com/higress-gro…</a><br/>
基于 HiMarket 实现的 MCP 金融级市场：<a href="https://link.juejin.cn?target=https%3A%2F%2Fantdigital.com%2Fproducts%2FMCP" target="_blank" title="https://antdigital.com/products/MCP" ref="nofollow noopener noreferrer">antdigital.com/products/MC…</a></p>
<p>HiMarket 钉钉社区群（2 群）：163370001036</p>
<p>入群链接（复制到浏览器打开）：<a href="https://link.juejin.cn?target=https%3A%2F%2Fqr.dingtalk.com%2Faction%2Fjoingroup%3Fcode%3Dv1%2Ck1%2Cd%2BMJWsDVtfHq6XanvQEUxsVX3vVL1m%2B7DWfkoUkYxVM%3D%26_dt_no_comment%3D1%26origin%3D11" target="_blank" title="https://qr.dingtalk.com/action/joingroup?code=v1,k1,d+MJWsDVtfHq6XanvQEUxsVX3vVL1m+7DWfkoUkYxVM=&amp;_dt_no_comment=1&amp;origin=11" ref="nofollow noopener noreferrer">qr.dingtalk.com/action/join…</a></p>
<p><strong>推荐文章：</strong></p>
<p>《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzU4NzU0MDIzOQ%3D%3D%26mid%3D2247520193%26idx%3D1%26sn%3Dcb69fc4c4e061fc0065e1f245f55bbed%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&amp;mid=2247520193&amp;idx=1&amp;sn=cb69fc4c4e061fc0065e1f245f55bbed&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AgentScope Java v1.0 发布，让 Java 开发者轻松构建企业级 Agentic 应用</a>》</p>
<p><strong>相关链接：</strong></p>
<p>[1] HiMarket 本地部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2FREADME.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/README.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[2] HiMarket Docker 部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fdocker%2FDocker%25E9%2583%25A8%25E7%25BD%25B2%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/docker/Docker%E9%83%A8%E7%BD%B2%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[3] HiMarket Helm 部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fhelm%2FHelm%25E9%2583%25A8%25E7%25BD%25B2%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/helm/Helm%E9%83%A8%E7%BD%B2%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[4] HiMarket Docker 一键部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fdocker%2FDocker%25E9%2583%25A8%25E7%25BD%25B2%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/docker/Docker%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p>
<p>[5] HiMarket Helm 一键部署指南</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhigress-group%2Fhimarket%2Fblob%2Fmain%2Fdeploy%2Fhelm%2FHelm%25E9%2583%25A8%25E7%25BD%25B2%25E8%2584%259A%25E6%259C%25AC%25E8%25AF%25B4%25E6%2598%258E.md" target="_blank" title="https://github.com/higress-group/himarket/blob/main/deploy/helm/Helm%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC%E8%AF%B4%E6%98%8E.md" ref="nofollow noopener noreferrer">github.com/higress-gro…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在 DataWorks 中一键部署大模型，即刻用于数据集成和数据开发]]></title>    <link>https://juejin.cn/post/7584633505105444916</link>    <guid>https://juejin.cn/post/7584633505105444916</guid>    <pubDate>2025-12-17T10:43:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105444916" data-draft-id="7584633505105412148" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在 DataWorks 中一键部署大模型，即刻用于数据集成和数据开发"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-17T10:43:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿里云大数据AI技术"/> <meta itemprop="url" content="https://juejin.cn/user/2414974667341287"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在 DataWorks 中一键部署大模型，即刻用于数据集成和数据开发
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2414974667341287/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿里云大数据AI技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:43:08.000Z" title="Wed Dec 17 2025 10:43:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在 AI 应用快速落地的今天，越来越多企业希望将大模型能力融入数据处理流程——无论是文本分析、智能摘要，还是 RAG 知识库构建。但传统模式下，模型部署依赖专业 MLOps 团队，需自行搭建推理环境、配置 GPU 资源、维护服务稳定性，门槛高、周期长、成本重。</p>
<p>现在，阿里云 <strong>DataWorks 发布大模型服务能力</strong>，基于 <strong>Serverless 资源组</strong>，支持用户 <strong>一键部署主流大模型</strong>，并可在 <strong>数据集成和数据开发任务中直接调用模型 API</strong>，实现“部署—集成—使用”全流程闭环，真正让数据工程师也能轻松玩转大模型！</p>
<p><img src="https://static001.geekbang.org/infoq/b7/b7d9d38118d77f6bef7b12ee83eb1538.png" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">三步完成模型部署，零代码上手</h2>
<p>通过 DataWorks 大模型服务管理功能，您只需三个步骤即可完成模型上线：</p>
<ol>
<li>
<p><strong>选择模型</strong> 支持通义千问 Qwen3 系列、DeepSeek 系列等多种主流模型，涵盖生成、推理、向量化等场景。</p>
</li>
<li>
<p><strong>一键部署</strong> 在控制台点击“部署”，选择目标 <strong>Serverless 资源组</strong> 和 GPU 规格（如 vGPU-1/4、vGPU-1），系统自动完成镜像拉取、服务启动与健康检查。</p>
</li>
<li>
<p><strong>获取调用地址</strong> 部署成功后，自动生成标准 OpenAPI 接口地址和鉴权 Token，可用于后续任务调用。</p>
</li>
</ol>
<p><img src="https://static001.geekbang.org/infoq/21/21954c17748c0bb90aa8d7c75f4b83cc.png" alt="" loading="lazy"/></p>
<p><em>大模型部署页面</em></p>
<p>整个过程 <strong>无需关注底层资源调度、容器编排或网络配置</strong>，真正做到“点一下，就可用”，大幅降低大模型落地门槛。</p>
<h2 data-id="heading-1">核心优势</h2>
<p><img src="https://static001.geekbang.org/infoq/35/350b5a1610e02f6f1128735628ec6693.png" alt="" loading="lazy"/></p>
<p>得益于底层资源优化与轻量化推理引擎，对于参数规模较小的模型（如 Qwen-Turbo、Embedding 模型），在 Serverless 资源组上的 <strong>平均推理延迟显著降低，性能提升近 10 倍</strong>，特别适合高频、低延迟的在线推理场景。</p>
<h2 data-id="heading-2">一键开启数据集成与开发的大模型应用</h2>
<p>目前支持在数据集成、数据开发中调用大模型，实现对数据的智能处理。</p>
<h3 data-id="heading-3">数据集成中调用</h3>
<p>在单表离线同步任务中，可使用大模型服务对同步中的数据进行<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Foffline-synchronization-task-ai-auxiliary-processing" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/offline-synchronization-task-ai-auxiliary-processing" ref="nofollow noopener noreferrer">AI辅助处理</a>。</p>
<p><img src="https://static001.geekbang.org/infoq/5d/5d0552e369f5436e0d3caa4e5f1fcb17.png" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">数据开发中调用</h3>
<h4 data-id="heading-5">方式1、大模型节点调用大语言模型</h4>
<p>DataWorks 新版数据开发 Data Studio 提供专属的大模型节点，支持通过可视化配置方式直接调用已部署的生成类或向量类大模型。用户无需编写代码，只需选择目标模型、输入提示词（Prompt）并设置参数，即可完成文本生成、摘要提取或文本向量化等任务，适用于快速验证模型效果和构建轻量级 AI 流程。</p>
<p><img src="https://static001.geekbang.org/infoq/27/27b9ee04aa350f0795e8a1dc60799f69.gif" alt="" loading="lazy"/></p>
<h4 data-id="heading-6">方式2、Shell 节点调用大语言模型</h4>
<p>用户可在 Shell 节点中通过 curl 命令调用大模型服务 API，实现对生成模型或向量模型的灵活调用。例如，发送自然语言请求获取模型回复，或将文本传入 Embedding 模型生成向量。该方式适合熟悉命令行操作的开发者，结合调度配置可实现自动化任务执行。</p>
<h4 data-id="heading-7">方式3、Python节点调用大语言模型</h4>
<p>通过 Python 节点，用户可使用 requests 等库编写脚本，以编程方式调用大模型服务。支持流式输出处理、自定义解析逻辑和复杂业务封装，适用于写诗、报告生成、结构化输出等需要精细控制的场景。需基于自定义镜像安装必要依赖后运行，并可集成至完整数据链路中。</p>
<p>接下来举个🌰展示如何在Python节点通过调用大语言模型完成写诗指令。</p>
<ol>
<li>当前示例依赖Python的<code>requests</code>库，请参考以下主要参数，基于DataWorks官方镜像创建<a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Fcustom-image" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/custom-image" ref="nofollow noopener noreferrer">自定义镜像</a>安装该依赖环境。</li>
</ol>
<p><img src="https://static001.geekbang.org/infoq/4d/4d163cb955199f76f1fdaa7ce5007cba.png" alt="" loading="lazy"/></p>
<p>2. <a href="https://link.juejin.cn?target=https%3A%2F%2Fhelp.aliyun.com%2Fzh%2Fdataworks%2Fuser-guide%2Fnode-development-of-data-studio%2F%2313d1ad442e1tc" target="_blank" title="https://help.aliyun.com/zh/dataworks/user-guide/node-development-of-data-studio/#13d1ad442e1tc" ref="nofollow noopener noreferrer">创建Python节点</a>，在Python节点添加如下示例代码：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> json
<span class="hljs-keyword">import</span> time
<span class="hljs-keyword">import</span> sys

<span class="hljs-keyword">def</span> <span class="hljs-title function_">stream_print_response</span>():
    httpUrl = <span class="hljs-string">"http://ms-xxxx.cn-beijing.dataworks-model.aliyuncs.com"</span>
    apikey = <span class="hljs-string">"DW-ms-xxxx"</span>
    url = httpUrl + <span class="hljs-string">"/v1/completions"</span>
    headers = {
        <span class="hljs-string">"Authorization"</span>: apikey,
        <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
    }
    data = {
        <span class="hljs-string">"prompt"</span>: <span class="hljs-string">"请写一篇关于春天的诗"</span>,
        <span class="hljs-string">"stream"</span>: <span class="hljs-literal">True</span>,
        <span class="hljs-string">"max_tokens"</span>: <span class="hljs-number">512</span>
    }

    <span class="hljs-keyword">try</span>:
        response = requests.post(url, headers=headers, json=data, stream=<span class="hljs-literal">True</span>)
        response.raise_for_status()

        full_text = <span class="hljs-string">""</span>  <span class="hljs-comment"># 累积完整回复，防止丢失</span>
        buffer = <span class="hljs-string">""</span>     <span class="hljs-comment"># 用于处理不完整的 JSON 行（可选）</span>

        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> response.iter_lines():
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> line:
                <span class="hljs-keyword">continue</span>  <span class="hljs-comment"># 跳过空行</span>

            line_str = line.decode(<span class="hljs-string">'utf-8'</span>).strip()
            <span class="hljs-comment"># print(f"[DEBUG] 收到行: {line_str}")  # 调试用</span>

            <span class="hljs-keyword">if</span> line_str.startswith(<span class="hljs-string">"data:"</span>):
                data_str = line_str[<span class="hljs-number">5</span>:].strip()  <span class="hljs-comment"># 去掉 "data: "</span>

                <span class="hljs-keyword">if</span> data_str == <span class="hljs-string">"[DONE]"</span>:
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">"\n[流式响应结束]"</span>)
                    <span class="hljs-keyword">break</span>

                <span class="hljs-comment"># 尝试解析 JSON</span>
                <span class="hljs-keyword">try</span>:
                    parsed = json.loads(data_str)
                    choices = parsed.get(<span class="hljs-string">"choices"</span>, [])
                    <span class="hljs-keyword">if</span> choices:
                        delta_text = choices[<span class="hljs-number">0</span>].get(<span class="hljs-string">"text"</span>, <span class="hljs-string">""</span>)
                        <span class="hljs-keyword">if</span> delta_text:
                            <span class="hljs-comment"># 累积到完整文本</span>
                            full_text += delta_text

                            <span class="hljs-comment"># 逐字打印新增的字符</span>
                            <span class="hljs-keyword">for</span> char <span class="hljs-keyword">in</span> delta_text:
                                <span class="hljs-built_in">print</span>(char, end=<span class="hljs-string">''</span>, flush=<span class="hljs-literal">True</span>)
                                sys.stdout.flush()
                                time.sleep(<span class="hljs-number">0.03</span>)  <span class="hljs-comment"># 打字机效果</span>

                <span class="hljs-keyword">except</span> json.JSONDecodeError <span class="hljs-keyword">as</span> e:
                    <span class="hljs-comment"># print(f"[警告] JSON 解析失败: {e}, 原文: {data_str}")</span>
                    <span class="hljs-keyword">continue</span>

        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n\n[完整回复长度: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(full_text)}</span> 字]"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"[ 完整内容]:\n<span class="hljs-subst">{full_text}</span>"</span>)

    <span class="hljs-keyword">except</span> requests.exceptions.RequestException <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f" 请求失败: <span class="hljs-subst">{e}</span>"</span>)
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f" 其他错误: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    stream_print_response()
</code></pre>
<p><strong>说明</strong>：请将代码中以<code>http</code>开头的大模型服务调用地址和以<code>DW</code>开头的Token信息替换为您的实际值。</p>
<p>3. 编辑节点内容后，在节点编辑页面右侧的<strong>调试配置</strong>中，选择已完成网络连通配置的资源组和<code>步骤1</code>中安装了<code>requests</code>库的自定义<strong>镜像</strong>。</p>
<p>4. 单击<strong>运行</strong>节点，即可调用已部署的服务模型执行相关命令。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[PF4J 日志类冲突与 JVM 类加载机制]]></title>    <link>https://juejin.cn/post/7584651851904811027</link>    <guid>https://juejin.cn/post/7584651851904811027</guid>    <pubDate>2025-12-17T10:48:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584651851904811027" data-draft-id="7584650421124366377" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="PF4J 日志类冲突与 JVM 类加载机制"/> <meta itemprop="keywords" content="JVM,后端"/> <meta itemprop="datePublished" content="2025-12-17T10:48:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Jaising666"/> <meta itemprop="url" content="https://juejin.cn/user/2418581311850301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            PF4J 日志类冲突与 JVM 类加载机制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2418581311850301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Jaising666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:48:34.000Z" title="Wed Dec 17 2025 10:48:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>本文从 JVM 类加载机制出发，分析 PF4J 插件框架的类加载原理，并通过 ClickHouse 插件的实际案例解释类加载冲突的根本原因和解决方案。</p>
<h2 data-id="heading-0">JVM 类加载机制（Java 8）</h2>
<h3 data-id="heading-1">为什么需要类加载机制</h3>
<p><strong>类加载机制的核心价值</strong>：</p>
<ol>
<li><strong>动态性</strong>：Java 程序在运行时才加载需要的类，而不是启动时加载所有类</li>
<li><strong>安全性</strong>：通过类加载器验证字节码，防止恶意代码执行</li>
<li><strong>隔离性</strong>：不同类加载器提供独立的命名空间，避免类冲突</li>
<li><strong>扩展性</strong>：支持自定义类加载器，实现插件化架构</li>
</ol>
<p><strong>解决的核心问题</strong>：</p>
<ul>
<li><strong>内存优化</strong>：按需加载，减少内存占用</li>
<li><strong>版本管理</strong>：同一 JVM 中可以存在同一类的多个版本</li>
<li><strong>安全控制</strong>：限制类的加载来源和权限</li>
<li><strong>模块化</strong>：支持复杂应用的模块化部署</li>
</ul>
<h3 data-id="heading-2">类加载器层次结构</h3>
<pre><code class="hljs language-java" lang="java">Bootstrap <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(启动类加载器)</span>
    ↓
Extension <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(扩展类加载器)</span> 
    ↓
Application <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(应用类加载器)</span>
    ↓
Custom <span class="hljs-title function_">ClassLoader</span> <span class="hljs-params">(自定义类加载器)</span>
</code></pre>
<h4 data-id="heading-3">1. Bootstrap ClassLoader</h4>
<ul>
<li><strong>职责</strong>：加载 JVM 核心类库（如 <code>java.lang.*</code>、<code>java.util.*</code> 等）</li>
<li><strong>实现</strong>：C++ 实现，Java 中表现为 null</li>
<li><strong>加载路径</strong>：<code>$JAVA_HOME/jre/lib/rt.jar</code> 等核心 jar 包</li>
</ul>
<h4 data-id="heading-4">2. Extension ClassLoader</h4>
<ul>
<li><strong>职责</strong>：加载 Java 扩展库</li>
<li><strong>实现</strong>：<code>sun.misc.Launcher$ExtClassLoader</code></li>
<li><strong>加载路径</strong>：<code>$JAVA_HOME/jre/lib/ext/</code> 目录下的 jar 包</li>
</ul>
<h4 data-id="heading-5">3. Application ClassLoader</h4>
<ul>
<li><strong>职责</strong>：加载应用程序类路径（classpath）下的类</li>
<li><strong>实现</strong>：<code>sun.misc.Launcher$AppClassLoader</code></li>
<li><strong>加载路径</strong>：<code>-cp</code> 参数指定的路径、当前目录下的类</li>
</ul>
<h3 data-id="heading-6">双亲委托模型</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-type">boolean</span> resolve) <span class="hljs-keyword">throws</span> ClassNotFoundException {
    <span class="hljs-comment">// 1. 检查类是否已被加载</span>
    Class&lt;?&gt; c = findLoadedClass(name);
    <span class="hljs-keyword">if</span> (c == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 委托给父类加载器</span>
            <span class="hljs-keyword">if</span> (parent != <span class="hljs-literal">null</span>) {
                c = parent.loadClass(name, <span class="hljs-literal">false</span>);
            } <span class="hljs-keyword">else</span> {
                c = findBootstrapClassOrNull(name);
            }
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
            <span class="hljs-comment">// 3. 父类加载器无法加载时，自己尝试加载</span>
            c = findClass(name);
        }
    }
    <span class="hljs-keyword">return</span> c;
}
</code></pre>
<p><strong>委托流程</strong>：</p>
<ol>
<li>检查类是否已加载</li>
<li>委托父类加载器加载</li>
<li>父类加载器失败时，自己加载</li>
<li>都失败则抛出 <code>ClassNotFoundException</code></li>
</ol>
<h3 data-id="heading-7">类加载器特性</h3>
<h4 data-id="heading-8">1. 唯一性</h4>
<p>同一个类加载器不会重复加载同一个类。</p>
<h4 data-id="heading-9">2. 可见性</h4>
<p>子类加载器可以看到父类加载器加载的类，反之不行。</p>
<h4 data-id="heading-10">3. 隔离性</h4>
<p>不同类加载器加载的同名类被 JVM 视为不同类型，每个类加载器都有独立的命名空间，类的完整标识是：<code>类加载器 + 类全名</code>。</p>
<h2 data-id="heading-11">PF4J 类加载架构</h2>
<h3 data-id="heading-12">类加载器扩展层次</h3>
<pre><code class="hljs language-css" lang="css">Bootstrap ClassLoader
    ↓
Extension ClassLoader  
    ↓
Application ClassLoader (主应用)
    ↓
PluginClassLoader (插件<span class="hljs-selector-tag">A</span>)    PluginClassLoader (插件<span class="hljs-selector-tag">B</span>)
    ↓                           ↓
Plugin <span class="hljs-selector-tag">A</span> Classes            Plugin <span class="hljs-selector-tag">B</span> Classes
</code></pre>
<p>PF4J 在标准 JVM 类加载器基础上，为每个插件创建独立的 <code>PluginClassLoader</code>：</p>
<ol>
<li><strong>插件隔离</strong>：每个插件拥有独立的类加载器和命名空间</li>
<li><strong>委托机制</strong>：继承双亲委托模型，优先使用主应用的类</li>
<li><strong>依赖共享</strong>：插件可访问主应用类，但插件间相互隔离</li>
</ol>
<h3 data-id="heading-13">PluginClassLoader 实现原理</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginClassLoader</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">URLClassLoader</span> {
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="hljs-type">boolean</span> resolve) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-comment">// 1. 检查类缓存</span>
        Class&lt;?&gt; loadedClass = findLoadedClass(name);
        <span class="hljs-keyword">if</span> (loadedClass != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> loadedClass;
        }
        
        <span class="hljs-comment">// 2. 委托给父类加载器（遵循双亲委托）</span>
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.loadClass(name, resolve);
        } <span class="hljs-keyword">catch</span> (ClassNotFoundException e) {
            <span class="hljs-comment">// 3. 从插件jar中加载</span>
            <span class="hljs-keyword">return</span> findClass(name);
        }
    }
    
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="hljs-keyword">throws</span> ClassNotFoundException {
        <span class="hljs-comment">// 从插件jar包中查找并定义类</span>
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.findClass(name);
    }
}
</code></pre>
<p><strong>加载策略</strong>：</p>
<ol>
<li>优先使用主应用已加载的类（避免重复加载核心库）</li>
<li>主应用无法提供时，从插件 jar 中加载</li>
<li>保持插件间的类隔离</li>
</ol>
<h2 data-id="heading-14">类加载冲突案例分析</h2>
<h3 data-id="heading-15">问题现象</h3>
<p>在 ClickHouse 插件中出现以下异常：</p>
<pre><code class="hljs language-kotlin" lang="kotlin">java.lang.LinkageError: loader constraint violation: 
<span class="hljs-keyword">when</span> resolving method <span class="hljs-string">"org.slf4j.impl.StaticLoggerBinder.getLoggerFactory()Lorg/slf4j/ILoggerFactory;"</span> 
the <span class="hljs-keyword">class</span> <span class="hljs-title class_">loader</span> (instance of org/pf4j/PluginClassLoader) of the current <span class="hljs-keyword">class</span>, org/slf4j/LoggerFactory, 
and the <span class="hljs-keyword">class</span> <span class="hljs-title class_">loader</span> (instance of sun/misc/Launcher$AppClassLoader) <span class="hljs-keyword">for</span> the method<span class="hljs-string">'s defining class, 
org/slf4j/impl/StaticLoggerBinder, have different Class objects for the type org/slf4j/ILoggerFactory 
used in the signature
</span></code></pre>
<h3 data-id="heading-16">冲突原理分析</h3>
<h4 data-id="heading-17">1. 类加载器隔离导致的问题</h4>
<pre><code class="hljs language-markdown" lang="markdown">主应用 (AppClassLoader)
├── slf4j-api-1.7.30.jar
│   ├── org.slf4j.LoggerFactory
│   └── org.slf4j.ILoggerFactory
└── logback-classic-1.2.3.jar
<span class="hljs-code">    └── ch.qos.logback.classic.Logger
</span>
ClickHouse插件 (PluginClassLoader)
├── clickhouse-jdbc-0.3.2.jar
└── slf4j-api-1.7.25.jar  ← 版本冲突！
<span class="hljs-code">    ├── org.slf4j.LoggerFactory
    └── org.slf4j.ILoggerFactory
</span></code></pre>
<h4 data-id="heading-18">2. 类型不匹配分析</h4>
<p><strong>冲突场景</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ClickHouse 插件代码</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClickHousePlugin</span> {
    <span class="hljs-comment">// LoggerFactory 来自 PluginClassLoader (slf4j-1.7.25)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> LoggerFactory.getLogger(ClickHousePlugin.class);
}
</code></pre>
<p><strong>调用链分析</strong>：</p>
<ol>
<li><code>LoggerFactory.getLogger()</code> → <code>getILoggerFactory()</code></li>
<li><code>getILoggerFactory()</code> → <code>StaticLoggerBinder.getLoggerFactory()</code></li>
<li><code>StaticLoggerBinder</code> 由 AppClassLoader 加载（主应用 logback）</li>
<li>返回 AppClassLoader 中的 <code>ILoggerFactory</code> 实例</li>
<li>但调用方期望 PluginClassLoader 中的 <code>ILoggerFactory</code> 类型</li>
<li>JVM 类型检查失败 → <code>LinkageError</code></li>
</ol>
<p><strong>根本原因</strong>：同一接口的不同版本被不同类加载器加载，JVM 无法进行类型转换。</p>
<h4 data-id="heading-19">3. LinkageError 详解</h4>
<p><strong>JVM 类型约束</strong>：
JVM 要求方法签名中的所有类型必须由相同类加载器加载，或存在可见性关系。</p>
<p><strong>违反约束的调用链</strong>:</p>
<pre><code class="hljs language-scss" lang="scss">PluginClassLoader<span class="hljs-selector-class">.LoggerFactory</span> (slf4j-<span class="hljs-number">1.7</span>.<span class="hljs-number">25</span>)
    ↓ 调用方法
AppClassLoader<span class="hljs-selector-class">.StaticLoggerBinder</span> (logback-<span class="hljs-number">1.2</span>.<span class="hljs-number">3</span>)  
    ↓ 返回类型
AppClassLoader<span class="hljs-selector-class">.ILoggerFactory</span> (slf4j-<span class="hljs-number">1.7</span>.<span class="hljs-number">30</span>)
    ↓ 类型检查
PluginClassLoader期望的ILoggerFactory (slf4j-<span class="hljs-number">1.7</span>.<span class="hljs-number">25</span>) ← 类型不匹配
</code></pre>
<p><strong>JVM 检查逻辑</strong>：</p>
<ol>
<li>方法调用时检查参数和返回值类型</li>
<li>发现 <code>ILoggerFactory</code> 存在两个不同的 Class 对象</li>
<li>无法确定类型兼容性</li>
<li>抛出 <code>LinkageError</code> 保证类型安全</li>
</ol>
<h2 data-id="heading-20">解决方案：exclude 配置</h2>
<h3 data-id="heading-21">配置方式</h3>
<p>在 ClickHouse 插件的 <code>build.gradle</code> 中添加：</p>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('ru.yandex.clickhouse:clickhouse-jdbc:0.3.2') {
        exclude group: 'org.slf4j'  // 排除 SLF4J 依赖
    }
    // 其他依赖...
}
</code></pre>
<h3 data-id="heading-22">解决原理</h3>
<h4 data-id="heading-23">1. 依赖排除机制</h4>
<pre><code class="hljs language-gradle" lang="gradle">// 排除冲突依赖
exclude group: 'org.slf4j'
</code></pre>
<p><strong>依赖树变化</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">修改前：
ClickHouse 插件 (PluginClassLoader)
├── clickhouse-jdbc-<span class="hljs-number">0.3</span><span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.jar</span>
│   └── slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-selector-class">.25</span><span class="hljs-selector-class">.jar</span>  ← 冲突源
└── 其他依赖

修改后：
ClickHouse 插件 (PluginClassLoader)  
├── clickhouse-jdbc-<span class="hljs-number">0.3</span><span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.jar</span> (无 slf4j 依赖)
└── 其他依赖
</code></pre>
<h4 data-id="heading-24">2. 类加载委托生效</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 插件中的日志调用</span>
LoggerFactory.getLogger(ClickHousePlugin.class)
    ↓
<span class="hljs-comment">// PluginClassLoader 中无 LoggerFactory</span>
<span class="hljs-comment">// 根据双亲委托，向上查找</span>
AppClassLoader.loadClass(<span class="hljs-string">"org.slf4j.LoggerFactory"</span>)
    ↓  
<span class="hljs-comment">// 统一使用主应用的 SLF4J 实现</span>
<span class="hljs-comment">// 所有相关类都来自 AppClassLoader</span>
<span class="hljs-comment">// 类型一致，调用成功</span>
</code></pre>
<h4 data-id="heading-25">3. 统一命名空间</h4>
<pre><code class="hljs language-scss" lang="scss">解决后的类加载结构：
AppClassLoader (统一命名空间)
├── org<span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.LoggerFactory</span>
├── org<span class="hljs-selector-class">.slf4j</span><span class="hljs-selector-class">.ILoggerFactory</span>
├── ch<span class="hljs-selector-class">.qos</span><span class="hljs-selector-class">.logback</span><span class="hljs-selector-class">.classic</span><span class="hljs-selector-class">.StaticLoggerBinder</span>  
└── ch<span class="hljs-selector-class">.qos</span><span class="hljs-selector-class">.logback</span><span class="hljs-selector-class">.classic</span><span class="hljs-selector-class">.LoggerContext</span>

插件通过委托机制共享主应用的日志实现
</code></pre>
<h2 data-id="heading-26">最佳实践</h2>
<h3 data-id="heading-27">1. 依赖管理策略</h3>
<pre><code class="hljs language-gradle" lang="gradle">// 推荐：排除常见的日志框架
dependencies {
    implementation('third-party-library:1.0.0') {
        exclude group: 'org.slf4j'
        exclude group: 'ch.qos.logback'
        exclude group: 'log4j'
        exclude group: 'commons-logging'
    }
}
</code></pre>
<h3 data-id="heading-28">2. 类加载冲突预防规范</h3>
<h4 data-id="heading-29">依赖作用域对比</h4>













































<table><thead><tr><th>作用域</th><th>编译时</th><th>运行时</th><th>测试时</th><th>打包</th><th>说明</th></tr></thead><tbody><tr><td>implementation</td><td>✓</td><td>✓</td><td>✓</td><td>✓</td><td>完整依赖</td></tr><tr><td>compileOnly</td><td>✓</td><td>✗</td><td>✗</td><td>✗</td><td>编译时依赖，类似provided</td></tr><tr><td>runtimeOnly</td><td>✗</td><td>✓</td><td>✓</td><td>✓</td><td>运行时依赖</td></tr><tr><td>testImplementation</td><td>✗</td><td>✗</td><td>✓</td><td>✗</td><td>测试依赖</td></tr></tbody></table>
<h4 data-id="heading-30">最佳实践配置</h4>
<pre><code class="hljs language-gradle" lang="gradle">// 最佳实践：既支持独立调试，又避免冲突
dependencies {
    // 1. 主应用 API（编译时需要，运行时由主应用提供）
    compileOnly project(':plugin-api')
    
    // 2. 主应用基础设施（编译时需要，运行时由主应用提供）
    compileOnly 'org.slf4j:slf4j-api:1.7.30'
    compileOnly 'com.fasterxml.jackson.core:jackson-core:2.12.3'
    compileOnly 'org.apache.commons:commons-lang3:3.12.0'
    
    // 3. 插件特有依赖（会打包到插件中，需要排除冲突）
    implementation('ru.yandex.clickhouse:clickhouse-jdbc:0.3.2') {
        exclude group: 'org.slf4j'
        exclude group: 'com.fasterxml.jackson.core'
        exclude group: 'org.apache.commons'
    }
    
    // 4. 测试和调试依赖（完整依赖，支持独立运行）
    testImplementation project(':plugin-api')
    testImplementation 'org.slf4j:slf4j-api:1.7.30'
    testImplementation 'ch.qos.logback:logback-classic:1.2.3'
    testImplementation 'com.fasterxml.jackson.core:jackson-core:2.12.3'
    testImplementation 'org.apache.commons:commons-lang3:3.12.0'
}

// 插件打包（只包含 implementation 依赖）
jar {
    archiveClassifier = 'plugin'
    
    manifest {
        attributes(
            'Plugin-Class': 'com.idss.plugin.impl.ClickHousePlugin',
            'Plugin-Id': 'clickhouse-plugin',
            'Plugin-Version': version
        )
    }
}
</code></pre>
<h3 data-id="heading-31">4. JVM 类加载诊断工具</h3>
<h4 data-id="heading-32">使用 -verbose:class 参数</h4>
<p>JVM 提供了内置的类加载跟踪功能：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动应用时添加 verbose 参数</span>
java -verbose:class -jar your-application.jar

<span class="hljs-comment"># 或者更详细的类加载信息</span>
java -verbose:class -XX:+TraceClassLoading -jar your-application.jar
</code></pre>
<p><strong>输出示例</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript">[<span class="hljs-title class_">Loaded</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">LoggerFactory</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/app/</span>lib/slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-number">.30</span>.<span class="hljs-property">jar</span>]
[<span class="hljs-title class_">Loaded</span> org.<span class="hljs-property">slf4j</span>.<span class="hljs-property">ILoggerFactory</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/app/</span>lib/slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-number">.30</span>.<span class="hljs-property">jar</span>]
[<span class="hljs-title class_">Loaded</span> ch.<span class="hljs-property">qos</span>.<span class="hljs-property">logback</span>.<span class="hljs-property">classic</span>.<span class="hljs-property">Logger</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/app/</span>lib/logback-classic-<span class="hljs-number">1.2</span><span class="hljs-number">.3</span>.<span class="hljs-property">jar</span>]
[<span class="hljs-title class_">Loaded</span> com.<span class="hljs-property">idss</span>.<span class="hljs-property">plugin</span>.<span class="hljs-property">impl</span>.<span class="hljs-property">ClickHousePlugin</span> <span class="hljs-keyword">from</span> <span class="hljs-attr">file</span>:<span class="hljs-regexp">/plugins/</span>clickhouse-plugin.<span class="hljs-property">jar</span>]
</code></pre>
<h4 data-id="heading-33">使用 jcmd 工具</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 获取进程 ID</span>
jps

<span class="hljs-comment"># 查看类加载器层次</span>
jcmd &lt;pid&gt; VM.classloader_stats

<span class="hljs-comment"># 查看已加载的类</span>
jcmd &lt;pid&gt; VM.class_hierarchy
</code></pre>
<h4 data-id="heading-34">使用 JConsole/VisualVM</h4>
<p>通过 JMX 监控类加载情况：</p>
<ul>
<li>连接到目标 JVM 进程</li>
<li>查看"类"标签页</li>
<li>监控类加载数量和卸载情况</li>
</ul>
<h2 data-id="heading-35">相同版本依赖的情况分析</h2>
<h3 data-id="heading-36">场景：插件和主应用使用相同版本 SLF4J</h3>
<p>假设主应用和 ClickHouse 插件都使用 <code>slf4j-api-1.7.30</code>：</p>
<pre><code class="hljs language-scss" lang="scss">主应用 (AppClassLoader)
├── slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-selector-class">.30</span><span class="hljs-selector-class">.jar</span>
└── logback-classic-<span class="hljs-number">1.2</span><span class="hljs-selector-class">.3</span><span class="hljs-selector-class">.jar</span>

ClickHouse 插件 (PluginClassLoader)  
├── clickhouse-jdbc-<span class="hljs-number">0.3</span><span class="hljs-selector-class">.2</span><span class="hljs-selector-class">.jar</span>
└── slf4j-api-<span class="hljs-number">1.7</span><span class="hljs-selector-class">.30</span><span class="hljs-selector-class">.jar</span>  ← 相同版本
</code></pre>
<h3 data-id="heading-37">是否还会有冲突？</h3>
<p><strong>答案：仍然会有 LinkageError！</strong></p>
<p><strong>原因分析</strong>：</p>
<ol>
<li><strong>类加载器隔离依然存在</strong>：即使版本相同，PluginClassLoader 仍会加载自己的 SLF4J 类</li>
<li><strong>JVM 类型检查机制</strong>：JVM 比较的是 Class 对象的身份，而不是类的内容</li>
<li><strong>不同命名空间</strong>：两个类加载器创建了两个不同的 <code>ILoggerFactory</code> Class 对象</li>
</ol>
<p><strong>冲突流程</strong>：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 插件中的调用</span>
PluginClassLoader.LoggerFactory.getLogger()  <span class="hljs-comment">// slf4j-1.7.30 (插件版本)</span>
    ↓
AppClassLoader.StaticLoggerBinder.getLoggerFactory()  <span class="hljs-comment">// logback 实现</span>
    ↓  
返回 AppClassLoader.ILoggerFactory 实例  <span class="hljs-comment">// slf4j-1.7.30 (主应用版本)</span>
    ↓
类型检查: PluginClassLoader.ILoggerFactory != AppClassLoader.ILoggerFactory
    ↓
LinkageError: 不同 Class 对象
</code></pre>
<h3 data-id="heading-38">验证代码</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SameVersionConflictDemo</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 模拟两个类加载器加载相同版本的类</span>
        URL[] urls = {<span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">"slf4j-api-1.7.30.jar"</span>).toURI().toURL()};
        
        <span class="hljs-comment">// 设置 parent 为 null，打破双亲委派</span>
        <span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">loader1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLClassLoader</span>(urls, <span class="hljs-literal">null</span>);
        <span class="hljs-type">URLClassLoader</span> <span class="hljs-variable">loader2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">URLClassLoader</span>(urls, <span class="hljs-literal">null</span>);
        
        Class&lt;?&gt; class1 = loader1.loadClass(<span class="hljs-string">"org.slf4j.ILoggerFactory"</span>);
        Class&lt;?&gt; class2 = loader2.loadClass(<span class="hljs-string">"org.slf4j.ILoggerFactory"</span>);
        
        System.out.println(<span class="hljs-string">"相同版本，不同类加载器:"</span>);
        System.out.println(<span class="hljs-string">"Class1: "</span> + class1);
        System.out.println(<span class="hljs-string">"Class2: "</span> + class2);
        System.out.println(<span class="hljs-string">"是否相等: "</span> + (class1 == class2)); <span class="hljs-comment">// false!</span>
        System.out.println(<span class="hljs-string">"类加载器1: "</span> + class1.getClassLoader());
        System.out.println(<span class="hljs-string">"类加载器2: "</span> + class2.getClassLoader());
    }
}
</code></pre>
<p><strong>输出结果</strong>:</p>
<pre><code class="hljs language-kotlin" lang="kotlin">相同版本，不同类加载器:
Class1: <span class="hljs-keyword">interface</span> <span class="hljs-title class_">org</span>.<span class="hljs-title">slf4j</span>.<span class="hljs-title">ILoggerFactory</span>
Class2: <span class="hljs-keyword">interface</span> <span class="hljs-title class_">org</span>.<span class="hljs-title">slf4j</span>.<span class="hljs-title">ILoggerFactory</span>
是否相等: <span class="hljs-literal">false</span>
类加载器<span class="hljs-number">1</span>: java.net.<span class="hljs-symbol">URLClassLoader@</span>232204a1
类加载器<span class="hljs-number">2</span>: java.net.<span class="hljs-symbol">URLClassLoader@</span>677327b6
</code></pre>
<h3 data-id="heading-39">关键结论</h3>
<p><strong>版本相同不等于类型相同</strong>！JVM 的类型系统基于以下规则：</p>
<pre><code class="hljs language-java" lang="java">类的完整标识 = 类加载器实例 + 类的全限定名
</code></pre>
<p>即使是完全相同的字节码，被不同类加载器加载后也是不同的类型。</p>
<h2 data-id="heading-40">其他常见冲突场景</h2>
<h3 data-id="heading-41">1. Jackson 序列化框架冲突</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('some-library:1.0.0') {
        exclude group: 'com.fasterxml.jackson.core'
        exclude group: 'com.fasterxml.jackson.databind'
    }
}
</code></pre>
<h3 data-id="heading-42">2. Apache Commons 冲突</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('some-library:1.0.0') {
        exclude group: 'commons-lang'
        exclude group: 'commons-io'
        exclude group: 'commons-collections'
    }
}
</code></pre>
<h3 data-id="heading-43">3. Spring 框架冲突</h3>
<pre><code class="hljs language-gradle" lang="gradle">dependencies {
    implementation('some-library:1.0.0') {
        exclude group: 'org.springframework'
    }
}
</code></pre>
<h2 data-id="heading-44">类加载冲突的本质</h2>
<h3 data-id="heading-45">冲突根源</h3>
<ol>
<li><strong>类加载器隔离</strong>：JVM 将不同类加载器的同名类视为不同类型（即使版本相同）</li>
<li><strong>跨类加载器调用</strong>：方法调用跨越类加载器边界时的类型不匹配</li>
<li><strong>JVM 类型安全</strong>：严格的类型检查机制防止类型混淆</li>
</ol>
<p><strong>重要认知</strong>：冲突的根本原因不是版本差异，而是类加载器隔离！</p>
<h3 data-id="heading-46">解决策略</h3>
<ol>
<li><strong>依赖排除</strong>：移除插件中的冲突依赖，统一使用主应用版本</li>
<li><strong>委托机制</strong>：利用双亲委托让插件使用主应用的类</li>
<li><strong>命名空间统一</strong>：确保相关类都在同一类加载器的命名空间中</li>
</ol>
<h2 data-id="heading-47">总结</h2>
<p><strong>JVM 类加载机制</strong>为 Java 提供了强大的模块化能力，但也带来了复杂的类型安全约束。<strong>PF4J 插件框架</strong>在此基础上实现了插件隔离，但需要 careful 处理共享依赖。</p>
<p><strong>核心原则</strong>：</p>
<ul>
<li>理解双亲委托模型的工作机制</li>
<li>识别类加载器边界和可见性规则</li>
<li>通过依赖管理避免类型冲突</li>
<li>利用委托机制实现依赖共享</li>
</ul>
<p>通过 <code>exclude</code> 配置解决 SLF4J 冲突，本质上是将插件的日志依赖委托给主应用，确保所有相关类都在 AppClassLoader 的统一命名空间中，从而避免 JVM 的类型安全检查失败。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零搭建使用 Open-AutoGML 搜索附近的美食]]></title>    <link>https://juejin.cn/post/7584650421124382761</link>    <guid>https://juejin.cn/post/7584650421124382761</guid>    <pubDate>2025-12-17T10:49:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650421124382761" data-draft-id="7584640225645051967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零搭建使用 Open-AutoGML 搜索附近的美食"/> <meta itemprop="keywords" content="人工智能,Android"/> <meta itemprop="datePublished" content="2025-12-17T10:49:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Exploring"/> <meta itemprop="url" content="https://juejin.cn/user/2172290705131016"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零搭建使用 Open-AutoGML 搜索附近的美食
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2172290705131016/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Exploring
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:49:17.000Z" title="Wed Dec 17 2025 10:49:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. 环境配置</h2>
<p>下载项目库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a> ，
使用 Open-AutoGML 需要安装以下开发环境：</p>
<ul>
<li>python 环境</li>
<li>ADB 调试工具</li>
<li>ADB Keyboard(用于文本输入)</li>
<li>模型部署（可以使用 BigModel 三方模型）</li>
</ul>
<h3 data-id="heading-1">1.1. Python 环境搭建</h3>
<p>检查 python 环境。建议使用 Python 3.10 及以上版本。</p>
<pre><code class="hljs">python3 -V
</code></pre>
<p>这里建议使用虚拟环境创建对应的环境。可以使用 Poetry 或 Python 自带的虚拟环境管理。这里使用 Python 自带的虚拟环境管理。</p>
<ul>
<li>创建虚拟环境：python3 -m venv 环境名</li>
<li>激活虚拟环境：source 环境名/bin/activate</li>
<li>删除旧环境：rm -rf venv</li>
<li>用python3.9创建新环境：python3.9 -m venv venv</li>
<li>退出环境：deactivate</li>
</ul>
<p>安装示例如下：</p>
<pre><code class="hljs language-sql" lang="sql">➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) python3<span class="hljs-number">.10</span> <span class="hljs-operator">-</span>m venv venv3<span class="hljs-number">.10</span>
➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) source venv3<span class="hljs-number">.10</span><span class="hljs-operator">/</span>bin<span class="hljs-operator">/</span>activate
(venv3<span class="hljs-number">.10</span>) ➜  <span class="hljs-keyword">Open</span><span class="hljs-operator">-</span>AutoGLM git:(main) 
</code></pre>
<p>这样我们就进入了创建的3.14虚拟环境。</p>
<h3 data-id="heading-2">1.2. ADB 调试工具</h3>
<p>这里可以参照 Android 官方 ADB 指令的下载与安装文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Ftools%2Freleases%2Fplatform-tools%3Fhl%3Dzh-cn" target="_blank" title="https://developer.android.com/tools/releases/platform-tools?hl=zh-cn" ref="nofollow noopener noreferrer">developer.android.com/tools/relea…</a></p>
<p>adb 安装完毕后，可打开终端命令行来检查一下是否成功。</p>
<pre><code class="hljs language-arduino" lang="arduino">➜  ~ adb devices
List of devices attached
<span class="hljs-number">2212</span>d99e	device
</code></pre>
<h3 data-id="heading-3">1.3. ADB Keyboard(用于文本输入)</h3>
<p>下载 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsenzhk%2FADBKeyBoard%2Fblob%2Fmaster%2FADBKeyboard.apk" target="_blank" title="https://github.com/senzhk/ADBKeyBoard/blob/master/ADBKeyboard.apk" ref="nofollow noopener noreferrer">安装包</a> 并在对应的安卓设备中进行安装。 注意，安装完成后还需要到 <code>设置-输入法</code> 或者 <code>设置-键盘列表</code> 中启用 <code>ADB Keyboard</code> 才能生效(或使用命令<code>adb shell ime enable com.android.adbkeyboard/.AdbIME</code><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fsenzhk%2FADBKeyBoard%2Fblob%2Fmaster%2FREADME.md%23how-to-use" target="_blank" title="https://github.com/senzhk/ADBKeyBoard/blob/master/README.md#how-to-use" ref="nofollow noopener noreferrer">How-to-use</a>)。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/866b2c19d59a44eaa4b398d93c04a811~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=QyYmAvYasAAz63gcLA1GSzgl31E%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">1.4. 安装项目依赖</h3>
<p>将 Open-AutoGML（<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzai-org%2FOpen-AutoGLM" target="_blank" title="https://github.com/zai-org/Open-AutoGLM" ref="nofollow noopener noreferrer">github.com/zai-org/Ope…</a>）项目下载到本地后，进入该项目对应的环境。执行以下指令：</p>
<pre><code class="hljs language-erlang" lang="erlang">pip install -r requirements.txt 
pip install -e .
</code></pre>
<h3 data-id="heading-5">1.5. 启动模型服务</h3>
<p>你可以选择自行部署模型服务，或使用第三方模型服务商。如果机器资源比较大，可以选择自行部署模型服务。这里我选择使用<strong>智谱 BigModel。</strong></p>
<ul>
<li>文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fapi%2Fintroduction" target="_blank" title="https://docs.bigmodel.cn/cn/api/introduction" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/api/intr…</a></li>
<li><code>--base-url</code>: <code>https://open.bigmodel.cn/api/paas/v4</code></li>
<li><code>--model</code>: <code>autoglm-phone</code></li>
<li><code>--apikey</code>: 在智谱平台申请你的 API Key</li>
</ul>
<p>使用示例：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 使用智谱 BigModel</span>
python main.py --base-url <span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/open.bigmodel.cn/api</span><span class="hljs-regexp">/paas/v</span>4 --model <span class="hljs-string">"autoglm-phone"</span> --apikey <span class="hljs-string">"your-bigmodel-api-key"</span> <span class="hljs-string">"打开美团搜索附近的火锅店"</span>
</code></pre>
<h4 data-id="heading-6">1.5.1. 验证 apiKey</h4>
<p>我们在智谱AI开放平台申请 apikey 后可以参照 API 使用文档（<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bigmodel.cn%2Fcn%2Fapi%2Fintroduction" target="_blank" title="https://docs.bigmodel.cn/cn/api/introduction" ref="nofollow noopener noreferrer">docs.bigmodel.cn/cn/api/intr…</a>）来验证是否可用。</p>
<p>使用 curl 指令输入：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">curl -X POST <span class="hljs-string">"https://open.bigmodel.cn/api/paas/v4/chat/completions"</span> \
-H <span class="hljs-string">"Content-Type: application/json"</span> \
-H <span class="hljs-string">"Authorization: Bearer YOUR_API_KEY"</span> \
-d <span class="hljs-comment">'{</span>
    <span class="hljs-string">"model"</span>: <span class="hljs-string">"glm-4.6"</span>,
    <span class="hljs-string">"messages"</span>: [
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"你是一个有用的AI助手。"</span>
        },
        {
            <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>,
            <span class="hljs-string">"content"</span>: <span class="hljs-string">"你好，请介绍一下自己。"</span>
        }
    ],
    <span class="hljs-string">"temperature"</span>: <span class="hljs-number">1.0</span>,
    <span class="hljs-string">"stream"</span>: <span class="hljs-literal">true</span>
}<span class="hljs-comment">'</span>
</code></pre>
<p>输出类似下面的内容时说明可用：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fca7d48b6c16488eae3d33227edaa029~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=VmYVS0qQte7xx9%2Blwskm9VVsBHI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-7">2. 实操用智谱 AI 帮我点外卖</h2>
<p>在完成环境安装后，我们来进行一次火锅的搜索。在工程项目目录中执行：</p>
<pre><code class="hljs language-css" lang="css"> python <span class="hljs-selector-tag">main</span><span class="hljs-selector-class">.py</span> <span class="hljs-attr">--base-url</span> https://open.bigmodel.cn/api/paas/v4 --model <span class="hljs-string">"autoglm-phone"</span> --apikey <span class="hljs-string">"apikey"</span> <span class="hljs-string">"打开美团搜索附近的火锅店"</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0019ec9625eb452c8185e5ea1027c87c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=kKBrvzqQ%2BjctNtwH0z2t3tejpS4%3D" alt="desktop1.gif" loading="lazy"/></p>
<h2 data-id="heading-8">3. 常见错误</h2>
<h3 data-id="heading-9">3.1. ERROR: No matching distribution found for Pillow&gt;=12.0.0</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">ERROR:</span> No matching distribution found <span class="hljs-keyword">for</span> Pillow&gt;=<span class="hljs-number">12.0</span>.<span class="hljs-number">0</span>
<span class="hljs-symbol">WARNING:</span> You are <span class="hljs-keyword">using</span> pip version <span class="hljs-number">21.1</span>.<span class="hljs-number">2</span>; however, version <span class="hljs-number">25.3</span> <span class="hljs-built_in">is</span> available.
You should consider upgrading via the <span class="hljs-comment">'/Users/dengshiwei/Documents/AI/Open-AutoGLM/venv/bin/python -m pip install --upgrade pip' command.</span>
</code></pre>
<p>使用的 python3.14 版本，在安装依赖时找不到 Pillow &gt;= 12.0.0 的版本，解决方法时降低到 python 版本到 3.10。这里可以使用 pyenv 来管理本地多个 python 版本。</p>
<pre><code class="hljs language-sql" lang="sql">brew <span class="hljs-keyword">update</span>
brew install pyenv
pyenv install <span class="hljs-number">3.10</span><span class="hljs-number">.14</span>
进入到项目，切换对应的 python 版本：pyenv <span class="hljs-keyword">local</span> <span class="hljs-number">3.10</span><span class="hljs-number">.14</span>
</code></pre>
<h3 data-id="heading-10">3.2. 键盘没效果</h3>
<p>我本地已经展示安装了键盘，但是运行 main.py 时还是提示找不到。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8498eef71b564b82a86e530ae71446b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXhwbG9yaW5n:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766573356&amp;x-signature=VIo%2BI6cp5a2DPuumTXqUJOc%2BKbQ%3D" alt="" loading="lazy"/></p>
<p>这里的原因是源码中的检测方法遇到手机权限的问题。</p>
<pre><code class="hljs language-ini" lang="ini"> <span class="hljs-attr">result</span> = subprocess.run(
          <span class="hljs-section">["adb", "shell", "ime", "list", "-s"]</span>,
          <span class="hljs-attr">capture_output</span>=<span class="hljs-literal">True</span>,
          <span class="hljs-attr">text</span>=<span class="hljs-literal">True</span>,
          <span class="hljs-attr">timeout</span>=<span class="hljs-number">10</span>,
      )
</code></pre>
<p>本质上是 <code>adb shell ime list -s</code> 指令，但是很多手机都没权限了。</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">java.lang.SecurityException:</span> <span class="hljs-string">uid</span> <span class="hljs-number">2000 </span><span class="hljs-string">does</span> <span class="hljs-string">not</span> <span class="hljs-string">have</span> <span class="hljs-string">android.permission.WRITE_SECURE_SETTINGS.</span>
</code></pre>
<p>这里可以改为：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">result</span> = subprocess.run(
    <span class="hljs-section">["adb", "shell", "settings", "get", "secure", "enabled_input_methods"]</span>,
    <span class="hljs-attr">capture_output</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">text</span>=<span class="hljs-literal">True</span>,
    <span class="hljs-attr">timeout</span>=<span class="hljs-number">3</span>,
)
</code></pre>
<p>后续我会提交一个 MR 来兼容一下这个问题。</p>
<h2 data-id="heading-11">4. 体验感受</h2>
<p>使用 <strong>智谱 BigModel 的模型情况下，</strong> 环境的搭建还是比较方便的，能够很快把开发环境搭建完成。如果是本地部署模型会比较耗费时间。总体来看还是比较智能的，能够操作挺多 App 的，还需要继续体验，但是目前感觉要商业化这个耗时还得继续优化，我执行了一个搜索火锅的指令，大概整体耗时在35s左右，跟中兴的 AI 手机体验比，耗时还有点多。持续进步吧。</p>
<p>#AutoGLM #智谱AI #OpenAutoGLM</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解锁Git隐藏力量：从熟练到大师的高级命令指南]]></title>    <link>https://juejin.cn/post/7583912899389521963</link>    <guid>https://juejin.cn/post/7583912899389521963</guid>    <pubDate>2025-12-16T00:14:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583912899389521963" data-draft-id="7583910637958742035" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解锁Git隐藏力量：从熟练到大师的高级命令指南"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-16T00:14:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小马写码"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解锁Git隐藏力量：从熟练到大师的高级命令指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小马写码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:14:36.000Z" title="Tue Dec 16 2025 00:14:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾对Git感到畏惧，认为它仅仅是一个复杂的版本控制工具？对于许多开发者而言，Git的日常使用仅限于<code>add</code>、<code>commit</code>和<code>push</code>这几个基础命令。然而，在这看似简单的界面之下，隐藏着一个强大而优雅的版本控制系统，等待着我们去探索和掌握。</p>
<p>本文将带你超越Git的基础操作，深入那些能够显著提升工作效率、解决复杂问题的高级命令和技巧，让你从Git使用者蜕变为Git大师。</p>
<h2 data-id="heading-0">一、时光旅行者：精准操控提交历史</h2>
<h3 data-id="heading-1">交互式变基：重写历史的能力</h3>
<pre><code class="hljs language-bash" lang="bash">git rebase -i HEAD~5
</code></pre>
<p>这个命令会打开一个交互式界面，允许你重新排序、合并、编辑或删除最近的5个提交。这不仅仅是整理提交历史的美容工具，更是保持项目历史清晰可读的关键。</p>
<p><strong>实用场景</strong>：将多个琐碎的提交合并成一个逻辑完整的提交，使代码审查更加高效。</p>
<h3 data-id="heading-2">引用日志：找回丢失的提交</h3>
<pre><code class="hljs language-bash" lang="bash">git reflog
</code></pre>
<p>当你意外地执行了<code>git reset --hard</code>或删除了分支，<code>reflog</code>就是你的时光机。它记录了仓库中所有的HEAD移动历史，让你能够找回看似"丢失"的提交。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 找回丢失的提交</span>
git reflog
<span class="hljs-comment"># 找到对应的提交哈希</span>
git checkout &lt;commit-hash&gt;
</code></pre>
<h2 data-id="heading-3">二、侦探模式：深入代码变更分析</h2>
<h3 data-id="heading-4">二分查找：快速定位问题引入点</h3>
<pre><code class="hljs language-bash" lang="bash">git bisect start
git bisect bad HEAD
git bisect good v1.0
</code></pre>
<p>当你在数百个提交中寻找引入bug的那个特定提交时，<code>git bisect</code>可以自动化这个过程。Git会智能地引导你在提交历史中进行二分查找，大大缩短问题定位时间。</p>
<h3 data-id="heading-5">高级日志筛选：精准过滤提交历史</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 查找特定作者在特定时间范围内的提交</span>
git <span class="hljs-built_in">log</span> --author=<span class="hljs-string">"John"</span> --since=<span class="hljs-string">"2023-01-01"</span> --until=<span class="hljs-string">"2023-06-30"</span>

<span class="hljs-comment"># 查找包含特定字符串的提交</span>
git <span class="hljs-built_in">log</span> -S <span class="hljs-string">"functionName"</span> --oneline

<span class="hljs-comment"># 可视化分支拓扑结构</span>
git <span class="hljs-built_in">log</span> --graph --oneline --all --decorate
</code></pre>
<h2 data-id="heading-6">三、工作流优化：提升日常效率</h2>
<h3 data-id="heading-7">储藏区的高级用法</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 储藏时添加描述</span>
git stash push -m <span class="hljs-string">"正在修复登录功能"</span>

<span class="hljs-comment"># 应用特定储藏</span>
git stash apply stash@{2}

<span class="hljs-comment"># 创建新分支并应用储藏</span>
git stash branch feature-login-fix stash@{1}
</code></pre>
<p>储藏不仅仅是临时保存更改，结合描述和分支创建，它可以成为上下文切换的强大工具。</p>
<h3 data-id="heading-8">提交修正：完善最近的提交</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 修改最近的提交信息</span>
git commit --amend

<span class="hljs-comment"># 添加文件到最近的提交</span>
git add forgotten_file.js
git commit --amend --no-edit
</code></pre>
<p><code>--amend</code>选项允许你修改最近的提交，而不是创建一个新的提交，保持历史整洁。</p>
<h2 data-id="heading-9">四、高级合并与冲突解决</h2>
<h3 data-id="heading-10">使用ours/theirs策略</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 在合并冲突时，选择特定版本</span>
git checkout --ours conflicted-file.js
git checkout --theirs conflicted-file.js
</code></pre>
<p>当处理复杂合并冲突时，这些命令可以快速选择保留当前分支或合并分支的版本。</p>
<h3 data-id="heading-11">重新应用合并</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 放弃当前合并尝试，重新开始</span>
git merge --abort

<span class="hljs-comment"># 使用特定策略重新合并</span>
git merge -X patience feature-branch
</code></pre>
<p><code>-X patience</code>选项使用更智能的差异算法，在处理复杂重构时特别有用。</p>
<h2 data-id="heading-12">五、钩子与自定义：自动化工作流</h2>
<p>Git钩子位于<code>.git/hooks</code>目录中，允许你在特定事件发生时执行脚本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 示例：提交前检查代码格式</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-comment"># pre-commit hook</span>
<span class="hljs-keyword">if</span> ! npm run lint; <span class="hljs-keyword">then</span>
  <span class="hljs-built_in">echo</span> <span class="hljs-string">"代码格式检查失败，请修复后再提交"</span>
  <span class="hljs-built_in">exit</span> 1
<span class="hljs-keyword">fi</span>
</code></pre>
<p>通过自定义钩子，你可以集成代码检查、测试运行、提交信息验证等自动化流程。</p>
<h2 data-id="heading-13">六、性能优化与维护</h2>
<h3 data-id="heading-14">垃圾回收与优化</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理不必要的文件并优化本地仓库</span>
git gc --aggressive --prune=now

<span class="hljs-comment"># 重新打包对象以提高效率</span>
git repack -a -d --depth=250 --window=250
</code></pre>
<p>对于大型仓库，定期执行这些维护命令可以显著提升Git性能。</p>
<h3 data-id="heading-15">部分克隆：处理巨型仓库</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 只克隆最近的历史</span>
git <span class="hljs-built_in">clone</span> --depth=1 https://github.com/large-repo.git

<span class="hljs-comment"># 按需获取特定目录</span>
git <span class="hljs-built_in">clone</span> --filter=blob:none --sparse https://github.com/large-repo.git
<span class="hljs-built_in">cd</span> large-repo
git sparse-checkout <span class="hljs-built_in">set</span> src/core
</code></pre>
<h2 data-id="heading-16">结语：从工具使用者到流程设计者</h2>
<p>正如我们所见，Git远不止于基础版本控制。这些高级命令和技巧将你从被动的工具使用者转变为主动的版本控制流程设计者。当你掌握了<code>reflog</code>的恢复能力、<code>bisect</code>的侦探技巧、交互式变基的历史重塑能力时，Git不再是一个需要小心应对的复杂系统，而是你开发工作流的自然延伸。</p>
<p>真正掌握Git的高级功能意味着你能以更少的努力完成更多工作，在团队协作中提供更多价值，并在面对复杂版本控制场景时保持从容。开始尝试这些命令，将它们融入你的日常工作中，你将会发现一个更高效、更可控的开发体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一个看似“送分”的需求为何翻车？——前端状态机实战指南]]></title>    <link>https://juejin.cn/post/7584071941025497103</link>    <guid>https://juejin.cn/post/7584071941025497103</guid>    <pubDate>2025-12-16T10:55:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584071941025497103" data-draft-id="7583799807594201122" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一个看似“送分”的需求为何翻车？——前端状态机实战指南"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2025-12-16T10:55:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端一小卒"/> <meta itemprop="url" content="https://juejin.cn/user/1943592286564045"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一个看似“送分”的需求为何翻车？——前端状态机实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1943592286564045/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端一小卒
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T10:55:02.000Z" title="Tue Dec 16 2025 10:55:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>源码太枯燥？一个人啃不动？关注公众号-「前端小卒」，让我做你的源码领读人。这里没有晦涩的说教，只有清晰的 <strong>Vue 3 &amp; React 19</strong> 源码拆解。积跬步以至千里，<strong>小卒也能进阶为大将</strong>，我们一起过河！♟️</p>
</blockquote>
<p>故事的开始总是惊人的相似。</p>
<p>上个月，需求评审会上，收到了产品经理的一个需求：“做一个扫码支付弹窗。逻辑很简单：打开弹窗获取二维码，然后每隔 2 秒轮询一次接口，扫码成功就跳转，30 秒超时就让用户刷新”</p>
<p>一拍脑袋，凭经验判断，需求不难。作为一名熟练的“React工程师”，我极其自信地敲下代码，开始写需求代码。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> [isLoading, setIsLoading] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 加载二维码中</span>
<span class="hljs-keyword">const</span> [isPolling, setIsPolling] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>); <span class="hljs-comment">// 轮询接口中</span>
<span class="hljs-keyword">const</span> [isError, setIsError] = <span class="hljs-title function_">useState</span>(<span class="hljs-literal">false</span>);     <span class="hljs-comment">// 出错了</span>
<span class="hljs-keyword">const</span> [retryCount, setRetryCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>);   <span class="hljs-comment">// 重试次数</span>
<span class="hljs-comment">// ...后面还有一堆 useEffect 和 useRef 用来存定时器ID</span>
</code></pre>
<p>当时的我还未意识到，这几个state给我带来了好几个bug单。</p>
<h2 data-id="heading-0">隐形的“状态爆炸”</h2>
<p>正式提测之后，我就陆陆续续收到了好几个bug单。</p>
<p>“大佬，我就在网络卡顿的时候多点了几下‘刷新’，页面就乱了”</p>
<p>浏览器的Network 面板上，几十个轮询请求在并发执行。UI 界面上，“正在加载”的转圈动画和“网络错误”的红字提示竟然同时存在，甚至还能点击“重试”按钮！！！</p>
<p>按照我的逻辑，<code>isLoading</code> 为 <code>true</code> 时，<code>isError</code> 肯定得是 <code>false</code> 啊。我明明写了 <code>setLoading(true); setError(false)</code>，为啥会出现这种问题！</p>
<p><strong>为什么会失控？</strong></p>
<p>问题的根源就在于试图用线性的逻辑，去对抗非线性的现实。</p>
<p>当 <code>isLoading</code>、<code>isPolling</code>、<code>isError</code> 三个布尔值混在一起时，理论上它们能组合出 2^3=8 种状态。而在真实的业务逻辑中，合法的状态可能只有 3 种（加载中、轮询中、失败）。那么<strong>剩下的那 5 种“不可能存在的状态”，一不小心没处理就会存在大量的缺陷。</strong></p>
<p>我们花费 80% 的时间，不是在写业务，而是在写防御代码，去堵那些因为逻辑漏洞而产生的混沌状态。</p>
<p>面对那坨膨胀且脆弱的代码，再进行修修补补已经无济于事，必须要大刀阔斧式的推倒重来，和PM和运营沟通，需求进行延期，代码打回去重写。</p>
<p>解决此类问题的最佳方案，不是更高超的 <code>if-else</code> 技巧，而是一个经典的数学模型——<strong>有限状态机</strong> 。它的核心理念是：<strong>系统在任何时刻只能处于一种状态，且状态的流转是确定的。</strong></p>
<h2 data-id="heading-1">引入有限状态机 (FSM)</h2>
<h3 data-id="heading-2">绘制状态流转图</h3>
<p>在写代码之前，我先画了一张图。这才是逻辑的核心：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1a5e676a636492fa064b0e5d1417ea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LiA5bCP5Y2S:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766487301&amp;x-signature=bhvOGCRnUe0UJ6YFfe0nvs14GVQ%3D" alt="svgviewer-png-output (52).png" loading="lazy"/></p>
<p>流程图清晰的展示出来：</p>
<ul>
<li>只有在 <code>FAILURE</code> 或 <code>IDLE</code> 状态下，才允许发起 <code>FETCH</code>。</li>
<li>在 <code>LOADING</code> 状态下，无论用户怎么点击，都不会触发多余的请求。</li>
</ul>
<h3 data-id="heading-3">引入useReducer</h3>
<p>React 的 <code>useReducer</code> 是实现状态机的绝佳工具，通过它可以将状态管理收敛到一个纯函数中。</p>
<p><strong>定义状态与事件</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// 状态枚举，只有这五种状态</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">STATES</span> = {
  <span class="hljs-attr">IDLE</span>: <span class="hljs-string">'idle'</span>,
  <span class="hljs-attr">LOADING</span>: <span class="hljs-string">'loading'</span>,
  <span class="hljs-attr">POLLING</span>: <span class="hljs-string">'polling'</span>,
  <span class="hljs-attr">SUCCESS</span>: <span class="hljs-string">'success'</span>,
  <span class="hljs-attr">FAILURE</span>: <span class="hljs-string">'failure'</span>,
};

<span class="hljs-comment">// 事件枚举：用户或系统能做的动作</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">EVENTS</span> = {
  <span class="hljs-attr">FETCH</span>: <span class="hljs-string">'FETCH'</span>,      <span class="hljs-comment">// 触发获取</span>
  <span class="hljs-attr">RESOLVE</span>: <span class="hljs-string">'RESOLVE'</span>,  <span class="hljs-comment">// 成功拿到二维码</span>
  <span class="hljs-attr">REJECT</span>: <span class="hljs-string">'REJECT'</span>,    <span class="hljs-comment">// 失败</span>
  <span class="hljs-attr">DONE</span>: <span class="hljs-string">'DONE'</span>,        <span class="hljs-comment">// 支付完成</span>
  <span class="hljs-attr">TIMEOUT</span>: <span class="hljs-string">'TIMEOUT'</span>,  <span class="hljs-comment">// 超时</span>
};
</code></pre>
<p><strong>编写 Reducer</strong></p>
<p>这里使用双重 Switch 结构：先判断<strong>当前处于什么状态</strong>，再判断<strong>发生了什么事件</strong>。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> machineReducer = (state, event) =&gt; {
  <span class="hljs-keyword">switch</span> (state.status) {
    <span class="hljs-keyword">case</span> STATES.IDLE:
    <span class="hljs-keyword">case</span> STATES.FAILURE:
      <span class="hljs-comment">// 只有在空闲或失败时，才允许发起 FETCH</span>
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.FETCH) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.LOADING, <span class="hljs-type">error</span>: null };
      }
      <span class="hljs-keyword">return</span> state; <span class="hljs-comment">// 其他事件直接忽略！</span>

    <span class="hljs-keyword">case</span> STATES.LOADING:
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.RESOLVE) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.POLLING, qrCode: event.data };
      }
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.REJECT) {
        <span class="hljs-keyword">return</span> { ...state, status: STATES.FAILURE, <span class="hljs-type">error</span>: event.<span class="hljs-type">error</span> };
      }
      <span class="hljs-comment">// 🔥 重点：这里没有处理 'FETCH' 事件。</span>
      <span class="hljs-comment">// 这意味着：在 Loading 状态下，无论用户怎么狂点按钮，代码都不会有任何反应！</span>
      <span class="hljs-keyword">return</span> state;

    <span class="hljs-keyword">case</span> STATES.POLLING:
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.DONE) <span class="hljs-keyword">return</span> { ...state, status: STATES.SUCCESS };
      <span class="hljs-keyword">if</span> (event.<span class="hljs-keyword">type</span> === EVENTS.TIMEOUT) <span class="hljs-keyword">return</span> { ...state, status: STATES.FAILURE, <span class="hljs-type">error</span>: <span class="hljs-string">'超时'</span> };
      <span class="hljs-keyword">return</span> state;

    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};
</code></pre>
<p><strong>组件层调用（分离副作用）</strong></p>
<p>现在，组件层的代码变得异常清爽。我们只需要根据状态去渲染 UI，并利用 <code>useEffect</code> 处理轮询副作用。</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">PaymentModal</span> = () =&gt; {
  const <span class="hljs-section">[state, dispatch]</span> = useReducer(machineReducer, { status: STATES.IDLE })<span class="hljs-comment">;</span>

  // 业务动作：只负责派发意图，不负责判断逻辑
  const <span class="hljs-attr">handleFetch</span> = () =&gt; {
    dispatch({ type: EVENTS.FETCH })<span class="hljs-comment">;</span>
    api.getQrCode()
      .then(<span class="hljs-attr">data</span> =&gt; dispatch({ type: EVENTS.RESOLVE, data }))
      .catch(<span class="hljs-attr">err</span> =&gt; dispatch({ type: EVENTS.REJECT, error: err }))<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>

  // 副作用管理：由状态驱动轮询
  useEffect(() =&gt; {
    let <span class="hljs-attr">timer</span> = null<span class="hljs-comment">;</span>
    if (<span class="hljs-attr">state.status</span> === STATES.POLLING) {
      <span class="hljs-attr">timer</span> = setInterval(async () =&gt; {
        const <span class="hljs-attr">res</span> = await api.checkStatus()<span class="hljs-comment">;</span>
        if (res.success) dispatch({ type: EVENTS.DONE })<span class="hljs-comment">;</span>
      }, 2000)<span class="hljs-comment">;</span>
    }
    return () =&gt; clearInterval(timer)<span class="hljs-comment">;</span>
  }, <span class="hljs-section">[state.status]</span>)<span class="hljs-comment">; // 状态变了，副作用自动清理或重启</span>

  return (
    &lt;div&gt;
      {<span class="hljs-attr">state.status</span> === STATES.LOADING &amp;&amp; &lt;Spinner /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.POLLING &amp;&amp; &lt;QRCode img={state.qrCode} /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.FAILURE &amp;&amp; &lt;ErrorView <span class="hljs-literal">on</span>Retry={handleFetch} /&gt;}
      {<span class="hljs-attr">state.status</span> === STATES.SUCCESS &amp;&amp; &lt;SuccessView /&gt;}
    &lt;/div&gt;
  )<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
</code></pre>
<p>看懂了吗？我们不再修补漏洞，通过清晰的定义状态和触发事件，收敛业务代码复杂度，消除可能产生的bug。</p>
<hr/>
<h2 data-id="heading-4">深度解析状态机</h2>
<p>写到这里，可能很多同学会问： <strong>“这不就是 Switch-Case 吗？为什么要叫它状态机？”</strong> 我们需要把视角拉高，从理论层面彻底理解它，以便应对更复杂的场景。</p>
<h3 data-id="heading-5">什么是有限状态机</h3>
<p>有限状态机不是一种代码写法，而是一个数学模型。它由五个要素组成：</p>
<ul>
<li><strong>有限的状态</strong> ：比如红绿灯只有红、黄、绿，不可能出现“红绿”。</li>
<li><strong>有限的事件</strong> ：比如“倒计时结束”、“按下按钮”。</li>
<li><strong>转换规则</strong> ：即 <code>状态 A + 事件 B -&gt; 状态 C</code>。</li>
<li><strong>初始状态</strong> 。</li>
<li><strong>最终状态</strong> 。</li>
</ul>
<p>它的核心理念就是：<strong>系统在任何时刻只能处于一种状态，且状态的流转是确定的。</strong></p>
<h3 data-id="heading-6">为什么前端需要它</h3>
<p>前端早已不是“展示页面”那么简单了，我们是在浏览器里跑 APP。以下场景如果不以状态机思维去写，迟早会崩：</p>
<ul>
<li><strong>多媒体播放器</strong>： 你以为只有 <code>Play</code> 和 <code>Pause</code>？错。 还有 <code>Buffering</code>（缓冲中）、<code>Seeking</code>（拖拽进度条中）、<code>Ended</code>（播放结束）、<code>Error</code>（加载失败）这些场景。</li>
<li><strong>复杂的表单向导</strong> ： 第一步 -&gt; 第二步 -&gt; 第三步。 用户在第二步点了“上一步”，数据怎么存？在第三步提交失败了，退回哪一步？</li>
<li><strong>TCP/WebSocket 连接管理</strong>： <code>Connecting</code> -&gt; <code>Connected</code> -&gt; <code>Reconnecting</code> -&gt; <code>Disconnected</code>。 如果在 <code>Reconnecting</code> 期间用户手动点了“断开”，应该去哪？</li>
<li><strong>Canvas 游戏/交互可视化</strong>： 拖拽模式、绘图模式、选中模式。</li>
</ul>
<p>读到这里，你可能已经热血沸腾，准备把项目里的所有组件都重写一遍。</p>
<p><strong>且慢。</strong></p>
<p>软件工程的核心在于权衡，如果需求仅仅是控制一个模态框的显示与隐藏，引入状态机只会增加无谓的代码复杂度。</p>
<p>那么，在实际业务开发中，我们应该依据哪些标准来判定是否需要引入状态机？当你的组件出现以下三种特征之一时，就可以结合业务适当的考虑重构了。</p>
<h3 data-id="heading-7">存在多个需要“手动同步”的boolean变量</h3>
<p>这是最显著的信号。检查一下你的组件 State 定义，如果出现了两个及以上的boolean，且彼此之间存在逻辑关联，就需要警惕，<strong>当你需要维护多个布尔值变量的同步关系时，状态机是更优解</strong>。</p>
<p>例如：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 典型的高风险代码</span>
const <span class="hljs-selector-attr">[isLoading, setLoading]</span> = <span class="hljs-built_in">useState</span>(false);
const <span class="hljs-selector-attr">[isError, setError]</span> = <span class="hljs-built_in">useState</span>(false);
const <span class="hljs-selector-attr">[hasData, setHasData]</span> = <span class="hljs-built_in">useState</span>(false);
</code></pre>
<p>在这种结构下，开发者需要时刻警惕变量间的同步问题。比如在 <code>setLoading(true)</code> 时，必须记得同时重置 <code>setError(false)</code>。这种依赖“人为细心”来维护的代码，随着迭代周期的拉长，几乎必然会产生 Bug。</p>
<h3 data-id="heading-8">业务逻辑要求状态必须“互斥”</h3>
<p>在很多场景下，业务状态在逻辑上是完全排他的。</p>
<p>比如开头的“扫码轮询”场景：一个请求不可能既在“进行中”又“已失败”。然而，如果使用分散的布尔值控制，代码层面是允许 <code>{ isLoading: true, isError: true }</code> 这种非法组合存在的。</p>
<p>这种逻辑上的“排他性”如果不能在代码结构上得到强制保证，就会导致 UI 渲染出错（例如 Loading 动画和错误提示重叠显示）。所以如果UI展示依赖于严格互斥的状态（如 Promise 的 Pending/Resolved/Rejected），请尽可能的使用状态机强制约束。</p>
<h3 data-id="heading-9">状态流转路径有严格限制</h3>
<p>简单的业务状态流转是自由的，而复杂的业务往往是有向图。</p>
<p>以“退款流程”为例：</p>
<ul>
<li>✅ 合法路径：<code>申请中</code> -&gt; <code>审核通过</code> -&gt; <code>打款中</code></li>
<li>❌ 非法路径：<code>申请中</code> -&gt; <code>打款中</code>（跳过审核）</li>
</ul>
<p>如果使用传统的 <code>if-else</code> 来防御非法跳转，代码中会充斥着大量 <code>if (status === 'AUDIT_PASS')</code> 这样的防御性判断。而状态机可以通过配置 <code>transitions</code>，天然地禁止了所有未定义的跳转路径。</p>
<p>所以当业务逻辑不仅仅关乎“当前是什么状态”，更关乎“当前状态允许变更为哪些状态”时，可以考虑引入状态机。</p>
<h3 data-id="heading-10">技术选型对照表</h3>
<p>在开始写代码前，可以参考下表进行决策：</p>

























<table><thead><tr><th><strong>业务场景特征</strong></th><th><strong>推荐方案</strong></th></tr></thead><tbody><tr><td>简单的开/关状态 (Toggle)</td><td><code>useState(boolean)</code></td></tr><tr><td>简单的互斥状态 (Loading/Success/Error)</td><td>字符串枚举 (String Enum)</td></tr><tr><td><strong>状态复杂，且存在特定的流转规则</strong></td><td><strong>状态机 (Reducer / XState)</strong></td></tr><tr><td><strong>涉及定时器、重试、取消等异步竞态问题</strong></td><td><strong>状态机 (推荐)</strong></td></tr></tbody></table>
<p>记住，工具是为了解决复杂度而生的。简单留给 <code>useState</code>，复杂留给状态机。</p>
<h2 data-id="heading-11">限制即自由</h2>
<p>写烂代码的本质，往往是我们试图在混乱中保留过多的“自由度”。而优秀架构的本质，通常在于<strong>限制</strong>。正如那句话说的：「<strong>喜欢就会放肆，但爱就是克制</strong>」</p>
<p>状态机严格规定了什么状态下能做什么事，这种克制提高了我们的前端稳定性。</p>
<p><strong>最后送给所有的前端的一句话：</strong></p>
<blockquote>
<p>所有的 Bug，本质上都是 <strong>“非法的状态”或“错误的转换”</strong>。</p>
<p>TypeScript 帮我们在编译时静态地规避了非法类型，而状态机则帮我们在运行时动态地管理状态流转。</p>
<p>TypeScript + State Machine = 前端逻辑的绝对防御。</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微信小程序真机预览-数字不等宽如何解决]]></title>    <link>https://juejin.cn/post/7584650857070051337</link>    <guid>https://juejin.cn/post/7584650857070051337</guid>    <pubDate>2025-12-17T09:55:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584650857070051337" data-draft-id="7584742635483529226" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微信小程序真机预览-数字不等宽如何解决"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-17T09:55:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="人生_何处_不相逢"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036976285"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微信小程序真机预览-数字不等宽如何解决
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036976285/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    人生_何处_不相逢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:55:41.000Z" title="Wed Dec 17 2025 09:55:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"🍋"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"🍓"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"🍑"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"🍉"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"🍒"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h4 data-id="heading-0"><strong>数字显示不等宽</strong></h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fa06a35eb6fe4196aed98801878d1b37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=3zXRONF6Pdr3LsINcE18a903n9A%3D" alt="image.png" loading="lazy"/></p>
<p><strong>你按照设计稿， 把右侧时间设置了同一个字号， 以为就是100%还原了UI设计，还心里小小得意🤔</strong></p>
<p><strong>真机预览你发现</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5e97b9d23f0b44679f19d53a31693a94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=WWrqgV205ODyhCMXcRW5IOAesFU%3D" alt="image.png" loading="lazy"/></p>
<p><strong>哎呦我去</strong>，我猜你肯定区检查了字体大小，肯定也预览了好几遍，才确认这个情况确实不是字体大小不一样导致的</p>
<p>😂😂😂 其实是因为 <code>0</code> 和 <code>1</code> 与其它数字宽度不一致导致的</p>
<p>那解决方法肯定是 <strong>设置一个等宽字体</strong> 但是那么多等宽字体 <strong>到底应该选择那个字体？</strong></p>
<p>选择的不对，就会造成下面的效果</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8b5796ff319e4786b3fc54d4890fdb37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=sX%2F%2FwSH36ggY7f71Qag7wX%2FspfA%3D" alt="image.png" loading="lazy"/></p>
<p>或者这样</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4395107f11f4853a8165fa1f34b3ae3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=naE%2FFV1antOI1%2BStGw0dE31p3Hc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>如果你也出现上述问题，你不妨设置</strong></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-attribute">font-family</span>: Helvetica Neue;
</code></pre>
<p>这个试试看，你会得到以下结果</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93017b3d83704a3fa27d6927c7a0c933~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lq655SfX-S9leWkhF_kuI3nm7jpgKI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570140&amp;x-signature=H%2Bk9DfgO87dFlaGeK8qB5%2FFiixA%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>好了，最后希望大家都不要踩坑，愿所有bug的解决方法 都可以百度到 谢谢</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter使用package_info_plus库获取应用信息的教程]]></title>    <link>https://juejin.cn/post/7583910637958807571</link>    <guid>https://juejin.cn/post/7583910637958807571</guid>    <pubDate>2025-12-16T00:40:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583910637958807571" data-draft-id="7583577045578530842" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter使用package_info_plus库获取应用信息的教程"/> <meta itemprop="keywords" content="前端,Flutter,Android"/> <meta itemprop="datePublished" content="2025-12-16T00:40:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鹏多多"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter使用package_info_plus库获取应用信息的教程
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鹏多多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T00:40:41.000Z" title="Tue Dec 16 2025 00:40:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"•";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><h2 data-id="heading-0">1. 简介</h2>
<p>在 Flutter 应用开发中，获取应用自身的信息（如应用名称、版本号、包名等）是一项常见需求，这些信息可用于展示在关于页面、用于统计分析或实现特定业务逻辑。<code>package_info_plus</code> 插件是 Flutter 生态中获取应用元数据的最佳选择，支持多平台且使用简单。本文将详细介绍如何使用该插件获取各类应用信息。</p>
<p><code>package_info_plus</code> 是一个跨平台插件，用于获取应用的包信息和元数据，它是 <code>package_info</code> 插件的升级版，由 Flutter Community 维护。</p>
<p><strong>核心特点</strong>：</p>
<ul>
<li>支持 iOS、Android、Web、Windows、macOS 和 Linux 多平台</li>
<li>能够获取应用名称、包名、版本号、构建号等关键信息</li>
<li>用法简单，API 直观</li>
<li>与最新的 Flutter 版本保持兼容</li>
</ul>
<p><strong>可获取的主要信息</strong>：</p>
<ul>
<li>应用名称（应用商店中显示的名称）</li>
<li>包名/应用 ID（如 com.example.myapp）</li>
<li>版本名称（如 1.0.0）</li>
<li>版本号/构建号（如 1）</li>
<li>应用签名（部分平台）</li>
</ul>
<h2 data-id="heading-1">2. 安装与配置</h2>
<p>在项目的 <code>pubspec.yaml</code> 文件中添加 <code>package_info_plus</code> 依赖：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">flutter:</span>
    <span class="hljs-attr">sdk:</span> <span class="hljs-string">flutter</span>
  <span class="hljs-attr">package_info_plus:</span> <span class="hljs-string">^4.0.0</span>  <span class="hljs-comment"># 使用最新版本</span>
</code></pre>
<p>运行以下命令安装依赖：</p>
<pre><code class="hljs language-bash" lang="bash">flutter pub get
</code></pre>
<h3 data-id="heading-2">2.1. 平台特定配置</h3>
<p><code>package_info_plus</code> 在大多数平台上无需额外配置即可使用，但某些平台可能需要注意以下事项：</p>
<p><strong>Web 平台</strong>：
需要在 <code>web/index.html</code> 中添加一些元数据，插件会从这里读取信息：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-comment">&lt;!-- 其他头部内容 --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"application-name"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"你的应用名称"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"version"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1.0.0"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"build-number"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"1"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"package"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"com.example.myapp"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
</code></pre>
<p><strong>其他平台</strong>：
Android、iOS、Windows、macOS 和 Linux 平台不需要额外配置，插件会自动从各自的配置文件中读取信息。</p>
<h2 data-id="heading-3">3. 基本使用方法</h2>
<p>在需要使用的 Dart 文件中导入 <code>package_info_plus</code>：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;
</code></pre>
<h3 data-id="heading-4">3.1. 获取应用信息</h3>
<p><code>package_info_plus</code> 提供了一个 <code>PackageInfo</code> 类，通过它可以获取所有应用信息。获取过程是异步的，通常使用 <code>await</code> 关键字：</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; getAppInfo() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-built_in">String</span> appName = packageInfo.appName;
  <span class="hljs-built_in">String</span> packageName = packageInfo.packageName;
  <span class="hljs-built_in">String</span> version = packageInfo.version;
  <span class="hljs-built_in">String</span> buildNumber = packageInfo.buildNumber;
  
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'应用名称: <span class="hljs-subst">$appName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'包名: <span class="hljs-subst">$packageName</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'版本号: <span class="hljs-subst">$version</span>'</span>);
  <span class="hljs-built_in">print</span>(<span class="hljs-string">'构建号: <span class="hljs-subst">$buildNumber</span>'</span>);
}
</code></pre>
<h3 data-id="heading-5">3.2. 详细信息说明</h3>
<p><code>PackageInfo</code> 类提供的主要属性：</p>








































<table><thead><tr><th>属性</th><th>说明</th><th>平台支持</th></tr></thead><tbody><tr><td><code>appName</code></td><td>应用的用户可见名称</td><td>所有平台</td></tr><tr><td><code>packageName</code></td><td>应用的唯一标识符（Android 的包名，iOS 的 Bundle ID 等）</td><td>所有平台</td></tr><tr><td><code>version</code></td><td>应用的版本名称（如 1.0.0）</td><td>所有平台</td></tr><tr><td><code>buildNumber</code></td><td>应用的构建号或版本代码（通常是整数）</td><td>所有平台</td></tr><tr><td><code>buildSignature</code></td><td>应用的签名信息</td><td>Android 特有</td></tr><tr><td><code>installerStore</code></td><td>应用的安装来源商店</td><td>Android 特有</td></tr></tbody></table>
<h2 data-id="heading-6">4. 实战示例</h2>
<p>下面是一个完整的示例，创建一个展示应用信息的"关于"页面：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:flutter/material.dart'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'package:package_info_plus/package_info_plus.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AboutPage</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> AboutPage({<span class="hljs-keyword">super</span>.key});

  <span class="hljs-meta">@override</span>
  State&lt;AboutPage&gt; createState() =&gt; _AboutPageState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_AboutPageState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">AboutPage</span>&gt; </span>{
  <span class="hljs-keyword">late</span> Future&lt;PackageInfo&gt; _packageInfoFuture;

  <span class="hljs-meta">@override</span>
  <span class="hljs-keyword">void</span> initState() {
    <span class="hljs-keyword">super</span>.initState();
    <span class="hljs-comment">// 初始化时获取应用信息</span>
    _packageInfoFuture = PackageInfo.fromPackageInfo();
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(
        title: <span class="hljs-keyword">const</span> Text(<span class="hljs-string">'关于我们'</span>),
      ),
      body: FutureBuilder&lt;PackageInfo&gt;(
        future: _packageInfoFuture,
        builder: (context, snapshot) {
          <span class="hljs-keyword">if</span> (snapshot.connectionState == ConnectionState.waiting) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: CircularProgressIndicator());
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (snapshot.hasError) {
            <span class="hljs-keyword">return</span> Center(child: Text(<span class="hljs-string">'获取应用信息失败: <span class="hljs-subst">${snapshot.error}</span>'</span>));
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!snapshot.hasData) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> Center(child: Text(<span class="hljs-string">'无法获取应用信息'</span>));
          }

          PackageInfo packageInfo = snapshot.data!;

          <span class="hljs-keyword">return</span> SingleChildScrollView(
            padding: <span class="hljs-keyword">const</span> EdgeInsets.all(<span class="hljs-number">16.0</span>),
            child: Column(
              children: [
                <span class="hljs-comment">// 应用图标</span>
                <span class="hljs-keyword">const</span> CircleAvatar(
                  radius: <span class="hljs-number">60</span>,
                  child: Icon(Icons.android, size: <span class="hljs-number">60</span>), <span class="hljs-comment">// 实际项目中替换为应用图标</span>
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// 应用名称</span>
                Text(
                  packageInfo.appName,
                  style: Theme.of(context).textTheme.headlineMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">8</span>),
                
                <span class="hljs-comment">// 版本信息</span>
                Text(
                  <span class="hljs-string">'版本: <span class="hljs-subst">${packageInfo.version}</span> (<span class="hljs-subst">${packageInfo.buildNumber}</span>)'</span>,
                  style: Theme.of(context).textTheme.titleMedium,
                ),
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">24</span>),
                
                <span class="hljs-comment">// 详细信息列表</span>
                _buildInfoItem(<span class="hljs-string">'包名'</span>, packageInfo.packageName),
                <span class="hljs-keyword">if</span> (packageInfo.buildSignature.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'应用签名'</span>, packageInfo.buildSignature),
                <span class="hljs-keyword">if</span> (packageInfo.installerStore != <span class="hljs-keyword">null</span> &amp;&amp; packageInfo.installerStore!.isNotEmpty)
                  _buildInfoItem(<span class="hljs-string">'安装来源'</span>, packageInfo.installerStore!),
                
                <span class="hljs-keyword">const</span> SizedBox(height: <span class="hljs-number">32</span>),
                
                <span class="hljs-comment">// 版权信息</span>
                <span class="hljs-keyword">const</span> Text(
                  <span class="hljs-string">'© 2023 你的公司名称. 保留所有权利.'</span>,
                  style: TextStyle(color: Colors.grey),
                ),
              ],
            ),
          );
        },
      ),
    );
  }

  <span class="hljs-comment">// 构建信息项</span>
  Widget _buildInfoItem(<span class="hljs-built_in">String</span> label, <span class="hljs-built_in">String</span> value) {
    <span class="hljs-keyword">return</span> Padding(
      padding: <span class="hljs-keyword">const</span> EdgeInsets.symmetric(vertical: <span class="hljs-number">8.0</span>),
      child: Row(
        crossAxisAlignment: CrossAxisAlignment.start,
        children: [
          Text(
            <span class="hljs-string">'<span class="hljs-subst">$label</span>: '</span>,
            style: <span class="hljs-keyword">const</span> TextStyle(
              fontWeight: FontWeight.bold,
              width: <span class="hljs-number">100</span>,
            ),
          ),
          Expanded(
            child: Text(value),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<p>这个示例创建了一个完整的"关于"页面，包含以下功能：</p>
<ul>
<li>使用 <code>FutureBuilder</code> 处理异步获取应用信息的过程</li>
<li>展示加载状态、错误状态和成功状态</li>
<li>显示应用名称、图标、版本号等基本信息</li>
<li>根据平台特性选择性展示签名和安装来源信息</li>
</ul>
<h2 data-id="heading-7">5. 高级应用场景</h2>
<p>下面是一些高级的应用场景，例如：</p>
<h3 data-id="heading-8">5.1. 版本更新检查</h3>
<p>可以使用获取到的版本号实现版本更新检查功能：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">VersionChecker</span> </span>{
  <span class="hljs-comment">// 假设这是从服务器获取的最新版本号</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> _latestVersion = <span class="hljs-string">"1.1.0"</span>;
  
  Future&lt;<span class="hljs-built_in">bool</span>&gt; isUpdateAvailable() <span class="hljs-keyword">async</span> {
    PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
    <span class="hljs-keyword">return</span> _compareVersions(packageInfo.version, _latestVersion) &lt; <span class="hljs-number">0</span>;
  }
  
  <span class="hljs-comment">// 版本号比较工具方法</span>
  <span class="hljs-built_in">int</span> _compareVersions(<span class="hljs-built_in">String</span> current, <span class="hljs-built_in">String</span> latest) {
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; currentParts = current.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    <span class="hljs-built_in">List</span>&lt;<span class="hljs-built_in">int</span>&gt; latestParts = latest.split(<span class="hljs-string">'.'</span>).map(<span class="hljs-built_in">int</span>.parse).toList();
    
    <span class="hljs-built_in">int</span> maxLength = max(currentParts.length, latestParts.length);
    
    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">int</span> i = <span class="hljs-number">0</span>; i &lt; maxLength; i++) {
      <span class="hljs-built_in">int</span> currentPart = i &lt; currentParts.length ? currentParts[i] : <span class="hljs-number">0</span>;
      <span class="hljs-built_in">int</span> latestPart = i &lt; latestParts.length ? latestParts[i] : <span class="hljs-number">0</span>;
      
      <span class="hljs-keyword">if</span> (currentPart &lt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
      <span class="hljs-keyword">if</span> (currentPart &gt; latestPart) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }
}

<span class="hljs-comment">// 使用示例</span>
<span class="hljs-keyword">void</span> checkForUpdates() <span class="hljs-keyword">async</span> {
  VersionChecker checker = VersionChecker();
  <span class="hljs-built_in">bool</span> hasUpdate = <span class="hljs-keyword">await</span> checker.isUpdateAvailable();
  <span class="hljs-keyword">if</span> (hasUpdate) {
    <span class="hljs-comment">// 显示更新提示</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"有新版本可用！"</span>);
  }
}
</code></pre>
<h3 data-id="heading-9">5.2. 应用使用统计</h3>
<p>结合设备信息和应用信息，可以实现应用使用统计：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:device_info_plus/device_info_plus.dart'</span>;

Future&lt;<span class="hljs-keyword">void</span>&gt; trackAppUsage() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  DeviceInfoPlugin deviceInfo = DeviceInfoPlugin();
  
  <span class="hljs-built_in">String</span> trackingInfo = <span class="hljs-string">'''
  应用信息:
  - 名称: <span class="hljs-subst">${packageInfo.appName}</span>
  - 版本: <span class="hljs-subst">${packageInfo.version}</span>
  - 包名: <span class="hljs-subst">${packageInfo.packageName}</span>
  
  设备信息:
  '''</span>;
  
  <span class="hljs-keyword">if</span> (Platform.isAndroid) {
    AndroidDeviceInfo androidInfo = <span class="hljs-keyword">await</span> deviceInfo.androidInfo;
    trackingInfo += <span class="hljs-string">'- 设备: <span class="hljs-subst">${androidInfo.brand}</span> <span class="hljs-subst">${androidInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- 系统版本: Android <span class="hljs-subst">${androidInfo.version.release}</span>'</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Platform.isIOS) {
    IosDeviceInfo iosInfo = <span class="hljs-keyword">await</span> deviceInfo.iosInfo;
    trackingInfo += <span class="hljs-string">'- 设备: <span class="hljs-subst">${iosInfo.model}</span>\n'</span>;
    trackingInfo += <span class="hljs-string">'- 系统版本: iOS <span class="hljs-subst">${iosInfo.systemVersion}</span>'</span>;
  }
  
  <span class="hljs-comment">// 实际项目中，这里会将统计信息发送到服务器</span>
  <span class="hljs-built_in">print</span>(trackingInfo);
}
</code></pre>
<h3 data-id="heading-10">5.3. 动态配置应用行为</h3>
<p>根据应用版本动态配置应用行为：</p>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-keyword">void</span>&gt; configureAppBehavior() <span class="hljs-keyword">async</span> {
  PackageInfo packageInfo = <span class="hljs-keyword">await</span> PackageInfo.fromPackageInfo();
  
  <span class="hljs-comment">// 根据不同版本启用不同功能</span>
  <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.0.'</span>)) {
    <span class="hljs-comment">// v1.0.x 版本的配置</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'配置基础功能'</span>);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (packageInfo.version.startsWith(<span class="hljs-string">'1.1.'</span>)) {
    <span class="hljs-comment">// v1.1.x 版本的配置</span>
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'配置高级功能'</span>);
  }
  
  <span class="hljs-comment">// 根据构建号启用测试功能</span>
  <span class="hljs-built_in">int</span> buildNumber = <span class="hljs-built_in">int</span>.tryParse(packageInfo.buildNumber) ?? <span class="hljs-number">0</span>;
  <span class="hljs-keyword">if</span> (buildNumber &gt;= <span class="hljs-number">100</span>) {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">'启用beta功能'</span>);
  }
}
</code></pre>
<h2 data-id="heading-11">6. 注意事项</h2>
<ul>
<li><strong>异步处理</strong>
<ul>
<li><code>PackageInfo.fromPackageInfo()</code> 是异步方法，必须正确处理异步操作</li>
<li>建议在应用启动时获取一次应用信息并缓存，避免重复获取</li>
<li>使用 <code>FutureBuilder</code> 或状态管理工具（如 Provider、Bloc）处理 UI 渲染</li>
</ul>
</li>
<li><strong>平台差异</strong>
<ul>
<li>不同平台上的信息可能有所不同，尤其是 <code>buildSignature</code> 和 <code>installerStore</code> 等平台特定属性</li>
<li>Web 平台需要手动配置元数据，其他平台则自动读取</li>
<li>处理平台特定属性时，应先检查其是否存在或不为空</li>
</ul>
</li>
<li><strong>版本号管理</strong>
<ul>
<li>保持 <code>pubspec.yaml</code>、AndroidManifest.xml 和 Info.plist 中的版本信息同步</li>
<li>建立清晰的版本号命名规则（如语义化版本 主版本.次版本.修订号）</li>
<li>构建号应随每次构建递增，用于区分不同构建</li>
</ul>
</li>
<li><strong>性能考虑</strong>
<ul>
<li>应用信息不会频繁变化，无需多次获取</li>
<li>建议在应用初始化阶段获取并存储在全局状态中</li>
<li>避免在 UI 渲染关键路径中获取应用信息</li>
</ul>
</li>
</ul>
<h2 data-id="heading-12">7. 常见问题解决</h2>
<ul>
<li><strong>信息不准确或未更新</strong>
<ul>
<li>确保所有平台的配置文件都已更新版本信息</li>
<li>运行 <code>flutter clean</code> 清理缓存后重新构建</li>
<li>对于 Web 平台，检查 <code>index.html</code> 中的元数据是否正确</li>
</ul>
</li>
<li><strong>某些属性为空</strong>
<ul>
<li>某些属性（如 <code>installerStore</code>）仅在特定条件下才有值</li>
<li>检查是否在正确的平台上访问平台特定属性</li>
<li>Web 平台需要手动配置所有属性</li>
</ul>
</li>
<li><strong>构建错误</strong>
<ul>
<li>确保使用的 <code>package_info_plus</code> 版本与 Flutter 版本兼容</li>
<li>检查是否正确导入了包</li>
<li>尝试更新插件到最新版本</li>
</ul>
</li>
</ul>
<h2 data-id="heading-13">8. 总结</h2>
<p><code>package_info_plus</code> 是 Flutter 开发中获取应用元数据的实用工具，它提供了简单直观的 API，支持多平台，能够满足大多数应用对获取自身信息的需求。</p>
<p>合理利用应用信息可以提升用户体验，简化开发流程，并为应用的统计分析提供支持。更多详细信息可以参考 <a href="https://link.juejin.cn?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fpackage_info_plus" target="_blank" title="https://pub.dev/packages/package_info_plus" ref="nofollow noopener noreferrer">官方文档</a>。</p>
<hr/>
<blockquote>
<p>本次分享就到这儿啦，我是鹏多多，深耕前端的技术创作者，如果您看了觉得有帮助，欢迎评论，关注，点赞，转发，我们下次见~</p>
</blockquote>
<p>PS：在本页按F12，在console中输入document.getElementsByClassName('panel-btn')[0].click();有惊喜哦~</p>
<p><code>往期文章</code></p>
<ul>
<li><a href="https://juejin.cn/post/7582808491582619684" target="_blank" title="https://juejin.cn/post/7582808491582619684">Flutter输入框TextField的属性与实战用法全面解析+示例</a></li>
<li><a href="https://juejin.cn/post/7581693431740448831" target="_blank" title="https://juejin.cn/post/7581693431740448831">Flutter自定义日历table_calendar完全指南+案例</a></li>
<li><a href="https://juejin.cn/post/7580389111921786943" target="_blank" title="https://juejin.cn/post/7580389111921786943">flutter-屏幕自适应插件flutter_screenutil教程全指南</a></li>
<li><a href="https://juejin.cn/post/7579101504289882166" target="_blank" title="https://juejin.cn/post/7579101504289882166">flutter-使用url_launcher打开链接/应用/短信/邮件和评分跳转等</a></li>
<li><a href="https://juejin.cn/post/7570923924365230143" target="_blank" title="https://juejin.cn/post/7570923924365230143">flutter图片选择库multi_image_picker_plus和image_picker的对比和使用解析</a></li>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">解锁flutter弹窗新姿势：dialog-flutter_smart_dialog插件解读+案例</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-切换状态显示不同组件10种实现方案全解析</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-详解控制组件显示的两种方式Offstage与Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-使用AnimatedDefaultTextStyle实现文本动画</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-使用SafeArea组件处理各机型的安全距离</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-实现渐变色边框背景以及渐变色文字</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-使用confetti制作炫酷纸屑爆炸粒子动画</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[微前端架构（二）：封装与实现]]></title>    <link>https://juejin.cn/post/7584059298697216041</link>    <guid>https://juejin.cn/post/7584059298697216041</guid>    <pubDate>2025-12-16T09:53:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584059298697216041" data-draft-id="7584273076645658630" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="微前端架构（二）：封装与实现"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2025-12-16T09:53:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码农胖大海"/> <meta itemprop="url" content="https://juejin.cn/user/4195392102086967"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            微前端架构（二）：封装与实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4195392102086967/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码农胖大海
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T09:53:19.000Z" title="Tue Dec 16 2025 09:53:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、前言</h2>
<p>很荣幸由我设计并实现了公司自研的微前端框架，目前该框架已在多个业务项目中广泛应用。</p>
<p>本文是我结合内部培训、产品文档及相关实践梳理而成的总结，旨在对微前端技术体系进行系统性的整理与沉淀。</p>
<p>本篇是系列文章的第二篇，分享一些关于微前端的封装和实践。</p>
<h2 data-id="heading-1">二、产品简介</h2>
<p>XX微前端是基于qiankun和公司权限管理系统实现的微前端架构解决方案，旨在帮助大家能更简单、无痛地构建一个生产可用微前端架构系统。</p>
<p>它在XX基础模板的基础上，兼容适配了XX已有的用户认证、权限控制、埋点功能，并集成了一系列微前端能力，包括应用加载、应用通信、应用隔离、应用缓存等。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/19e50befbb384003b8bef3f838d65c8e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5Yac6IOW5aSn5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766483598&amp;x-signature=8HU6uvvSZjKSWFtic1y4ktT865U%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">三、核心封装与实现</h2>
<h3 data-id="heading-3">3.1 应用缓存</h3>
<p>在主应用中使用<code> v-show </code>指令控制子应用容器，以实现子应用的切换与缓存。</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 子应用容器 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in apps"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"app-container"</span>
    <span class="hljs-attr">v-show</span>=<span class="hljs-string">"currentAppName &amp;&amp; currentAppName === item.name"</span>
    <span class="hljs-attr">:id</span>=<span class="hljs-string">"`container-${item.name}`"</span>
    <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.name"</span>
  &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
</code></pre>
<h3 data-id="heading-4">3.2 应用加载</h3>
<p>采用qiankun的loadMicroApp实现多标签页场景下的应用加载。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d26fe558168249ea826cb799b21543a3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5Yac6IOW5aSn5rW3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766483598&amp;x-signature=kqJvHzuSWkteh5vz7Brv8kSX81Y%3D" alt="image.png" loading="lazy"/></p>
<p>核心逻辑说明：监听路由变化=》根据路由匹配子应用=》loadMicroApp手动加载子应用，给挂载到指定容器。</p>
<pre><code class="hljs language-vue" lang="vue">// 1. 监听路由变化
watch: {
    $route: {
      immediate: false,
      handler(route) {
        this.openMicroApp(route);
      }
    }
  },
// 2. 根据路由信息获取菜单数据及子应用信息
const resource = getMenuByRoute(route);
subApp = resource &amp;&amp; this.getAppById(resource.rootResourceId);
// 2.1 菜单资源数据映射关系
{
  id: item.resourceId, // web应用资源id
  name: item.resourceCode, // web应用资源编码
  entry: item.resourceUrl // web应用基础路径
}
// 3. 调用loadMicroApp加载子应用
const { name, entry } = subApp;
const appInstances = loadMicroApp({
  name,
  entry,
  container: `#container-${name}`,
  props: {}
});
</code></pre>
<p>以上代码是简化后的示意代码，实际实现中还包含有对容器节点、路由、loading等细节的处理。</p>
<h3 data-id="heading-5">3.3 应用通信</h3>
<h4 data-id="heading-6">3.3.1 基于props</h4>
<p>qiankun的<code>loadMicroApp</code> 方法支持通过props配置选项，传递数据或者方法给子应用。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 主应用定义并通过props.data传递</span>
<span class="hljs-keyword">const</span> mainAppName = <span class="hljs-string">'app-main'</span>
<span class="hljs-keyword">const</span> appInstances = <span class="hljs-title function_">loadMicroApp</span>({
  name,
  entry,
  <span class="hljs-attr">container</span>: <span class="hljs-string">`#container-<span class="hljs-subst">${name}</span>`</span>,
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">data</span>: {
      mainAppName
    }
  }
});

<span class="hljs-comment">// 2. 子应用接收</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mount</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-title function_">render</span>(props);
}
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { data = {}, container } = props || {};
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">mainAppName</span>)
}
</code></pre>
<h4 data-id="heading-7">3.3.2 基于window</h4>
<p>通过挂载全局属性和方法，供其他应用使用。</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 1. 主应用定义</span>
window.<span class="hljs-variable">$mainAxxxxxxx</span> = <span class="hljs-built_in">initAxxxxxxx</span>(router);

<span class="hljs-comment">// 2. 子应用通过window调用</span>
window.<span class="hljs-variable">$mainAxxxxxxx</span><span class="hljs-selector-class">.xxx</span>();
</code></pre>
<h4 data-id="heading-8">3.3.3 基于事件</h4>
<p>框架选用Node.js的EventEmitter，由主应用集成并对外提供event-bus基于事件总线的应用间通信能力。包含事件的注册、派发和移除功能。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. 主应用实例化事件对象</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventEmitter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'events'</span>;
<span class="hljs-keyword">const</span> eventBus = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EventEmitter</span>();
<span class="hljs-comment">// 2. 监听事件</span>
eventBus.<span class="hljs-title function_">on</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-function">(<span class="hljs-params">params1, params2</span>) =&gt;</span> {
  <span class="hljs-comment">// ...do some things</span>
});
<span class="hljs-comment">// 3. 传递实例给子应用</span>
<span class="hljs-title function_">loadMicroApp</span>({
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">data</span>: {
      eventBus
    }
  }
});

<span class="hljs-comment">// 4. 子应用接收并派发事件</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">props</span>) {
  <span class="hljs-keyword">const</span> { data = {}, container } = props || {};
  <span class="hljs-keyword">if</span> (data.<span class="hljs-property">eventBus</span>) {
    data.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event1'</span>, params1, params2);
  }
}
<span class="hljs-comment">// 5. 子应用也可以 监听其他应用派发的事件</span>
data.<span class="hljs-property">eventBus</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'xxx'</span>,xxx)
</code></pre>
<p>注意事项：</p>
<ul>
<li>在绝大多数情况下，不鼓励使用全局的事件总线在组件之间进行通信。虽然在短期内往往是最简单的解决方案，但从长期来看，它维护起来总是令人头疼。可以用，但不建议大量使用。</li>
<li>删除在其他地方添加的监听器是不好的做法，特别是当 <code>EventEmitter</code> 实例是由其他组件或模块（例如套接字或文件流）创建时。存在较大风险隐患。</li>
</ul>
<h4 data-id="heading-9">3.3.4 基于vuex</h4>
<p>通过共享主应用store, 可以快速将基座的vuex注册到微应用自己的vuex实例上。</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. 主应用定义并通过props传递store</span>
<span class="hljs-keyword">import</span> qiankunCommonStore from <span class="hljs-string">'@/store/modules/common'</span>;
loadMicroApp({
  name,
  entry,
  container: `#container-${name}`,
  props: {
    <span class="hljs-keyword">data</span>: {
      store: qiankunCommonStore,
    }
  }
});
<span class="hljs-comment">// 2. 子应用store注册到自己的vuex实例上</span>
function render(props) {
  <span class="hljs-keyword">const</span> { <span class="hljs-keyword">data</span> = {}, container } = props || {};
  <span class="hljs-keyword">if</span> (store &amp;&amp; store.hasModule &amp;&amp; <span class="hljs-keyword">data</span>.store) {
    store.registerModule(<span class="hljs-string">'mainAppStore'</span>, <span class="hljs-keyword">data</span>.store);
  }
}
<span class="hljs-comment">// 3.1 使用：取值</span>
<span class="hljs-keyword">const</span> userInfo = <span class="hljs-keyword">this</span>.$store.state.mainAppStore.userInfo
<span class="hljs-comment">// 3.2 使用：赋值</span>
<span class="hljs-keyword">this</span>.$store.commit(<span class="hljs-string">'mainAppStore/setUserInfo'</span>, { ...<span class="hljs-keyword">this</span>.userInfo, newData: <span class="hljs-string">'home-new-data'</span> });
</code></pre>
<h4 data-id="heading-10">3.3.5 基于initGlobalState</h4>
<p>qiankun提供的基于全局状态的通信方式。模板中未集成，如需使用，可参看<a href="https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Fzh%2Fapi%23initglobalstatestate" target="_blank" title="https://qiankun.umijs.org/zh/api#initglobalstatestate" ref="nofollow noopener noreferrer">qiankun文档</a>自行扩展。</p>
<p>未集成的原因是，作者并<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fumijs%2Fqiankun%2Fdiscussions%2F1378%23discussioncomment-1475671" target="_blank" title="https://github.com/umijs/qiankun/discussions/1378#discussioncomment-1475671" ref="nofollow noopener noreferrer">不推荐该API</a>并计划在未来版本中移除。</p>
<p>globalState 不是合理的微前端通信方案，会加剧应用之间的耦合.。 -- qiankun官方issues</p>
<h3 data-id="heading-11">3.4 应用跳转</h3>
<h4 data-id="heading-12">3.4.1 应用内跳转</h4>
<p>调用自身路由router的方法</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onJump</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>({
    path,
    query
  });
},
</code></pre>
<h4 data-id="heading-13">3.4.2 应用间跳转</h4>
<p>使用主应用路由方法</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title function_">onJumpOther</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">$root</span>.<span class="hljs-property">mainAppRouter</span>.<span class="hljs-title function_">push</span>({
    path,
    query
  });
},
</code></pre>
<h3 data-id="heading-14">3.5 应用隔离</h3>
<h4 data-id="heading-15">3.5.1 js沙箱</h4>
<p>众所周知javaScript的全局作用域存在命名冲突、变量污染等风险，为了解决该问题，qiankun借助 ES6 的 proxy ，创建js代理沙箱，实现了应用间环境的隔离。</p>
<p>qiankun已有实现，默认为开启状态。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://juejin.cn/post/6846687602439897101#heading-21" target="_blank" title="https://juejin.cn/post/6846687602439897101#heading-21">蚂蚁金服体验技术部 qiankun 的核心贡献者 - 方涣的分享</a></li>
</ul>
<h4 data-id="heading-16">3.5.2 样式隔离</h4>
<p>为了确保不同组件或模块之间的样式不会相互影响，从而提高代码的可维护性和可复用性。qiankun提供有两种样式隔离方案，strictStyleIsolation和experimentalStyleIsolation。</p>
<p>qiankun默认开启strictStyleIsolation严格的样式隔离模式。这种模式下 qiankun 会为每个微应用的容器包裹上一个 <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FWeb_Components%2FUsing_shadow_DOM" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/Web_Components/Using_shadow_DOM" ref="nofollow noopener noreferrer">shadow dom</a> 节点，从而确保微应用的样式不会对全局造成影响。</p>
<p>参考资料：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fqiankun.umijs.org%2Fzh%2Fapi%23loadmicroappapp-configuration" target="_blank" title="https://qiankun.umijs.org/zh/api#loadmicroappapp-configuration" ref="nofollow noopener noreferrer">loadMicroApp.sandbox配置说明</a></li>
</ul>
<h4 data-id="heading-17">3.5.3 本地存储隔离</h4>
<p>为了防止各微应用间操作本地存储时，数据覆盖、误删除等问题，框架封装并集成了本地存储功能模块。原理是在基座运行时，覆写localStorage、sessionStorage方法，给本地存储的<code>key</code> 统一加上前缀。</p>
<p>我们对此封装了一个组件，代码 和API就不赘述了，这里仅分享，在去覆写的时候遇到的一个卡点问题和解决方案。</p>
<p>问题描述：修改Storage接口的原型方法后，乾坤无法隔离， 导致所有应用（包括主应用）的相关方法均被修改。</p>
<p>解决方案：在引入qiankun之前删除window.localStorage，随后再重新声明，此时的window.localStorage是隔离的，在主子应用分别定义，互不影响。</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 主应用</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span> = <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>;
<span class="hljs-keyword">delete</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span>;
<span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> = {
 <span class="hljs-title function_">getItem</span>(<span class="hljs-params">...ags</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"this"</span>, <span class="hljs-variable language_">this</span>);
   <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span>.<span class="hljs-title function_">getItem</span>(...ags);
},
};

<span class="hljs-comment">// 子应用</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">localStorage</span> = {
 <span class="hljs-title function_">getItem</span>(<span class="hljs-params">key, ...ags</span>) {
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"insub"</span>);
   <span class="hljs-keyword">return</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">originStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">`app-vue<span class="hljs-subst">${key}</span>`</span>, ...ags);
},
};
</code></pre>
<p>原理是qiankun的沙箱（proxySandBox），会从window对象拷贝不可配置的属性并filter掉，不走proxy代理，比如location、localStorage等。现在咱们在qiankun沙箱逻辑执行前，把localStorage属性移除，它拷贝不到，后面咱们再加上的localStorage就会走proxy然后被隔离起来。</p>
<h3 data-id="heading-18">3.6 权限控制</h3>
<p>整体策略是，各微应用分别进行权限控制，谁的页面谁管控。</p>
<p>在微前端场景下，由于各微应用的路由监听的是同一url，当url切换时，所有微应用的路由守卫都会触发。需要对不是自己应用路由放行。</p>
<pre><code class="hljs language-vbnet" lang="vbnet">// 微前端运行时的路由守卫
<span class="hljs-keyword">function</span> microAppHook(<span class="hljs-keyword">to</span>, <span class="hljs-keyword">from</span>, <span class="hljs-keyword">next</span>){
  <span class="hljs-keyword">const</span> isAppNameMatched = <span class="hljs-keyword">to</span>.meta.appName ? <span class="hljs-keyword">to</span>.meta.appName === appName : <span class="hljs-literal">true</span>,
    isNotMyRoute = !<span class="hljs-keyword">to</span>.path || !<span class="hljs-keyword">to</span>.name || !isAppNameMatched;
  <span class="hljs-keyword">if</span> (isNotMyRoute) {
    // 非当前应用路由，跳过处理
    <span class="hljs-keyword">next</span>();
    <span class="hljs-keyword">return</span>;
  }
  // 权限控制：白名单、角色菜单权限判断
  <span class="hljs-keyword">if</span> (hasPermission(<span class="hljs-keyword">to</span>) || hasPermission(<span class="hljs-keyword">to</span>, <span class="hljs-literal">false</span>)) {
    <span class="hljs-keyword">next</span>();
  }<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">next</span>({path: <span class="hljs-comment">'/404', replace: true});</span>
  }
}
</code></pre>
<h2 data-id="heading-19">四、后续改进</h2>
<ol>
<li>
<p>性能提升</p>
<ol>
<li>内存占用高：在低版本火狐浏览器内存占用经常性超过2G，页面卡顿明显</li>
<li>加载速度慢：超过5M的子应用资源，请求和加载长达3-5秒</li>
</ol>
</li>
<li>
<p>简化路由、菜单资源的处理</p>
<ol>
<li>当前关于菜单资源的处理较复杂且不灵活，有较大提升空间</li>
</ol>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Boot 项目docker分层镜像构建案例]]></title>    <link>https://juejin.cn/post/7583980250734608447</link>    <guid>https://juejin.cn/post/7583980250734608447</guid>    <pubDate>2025-12-16T06:04:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583980250734608447" data-draft-id="7583980250734592063" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Boot 项目docker分层镜像构建案例"/> <meta itemprop="keywords" content="Spring Boot,Docker,CI/CD"/> <meta itemprop="datePublished" content="2025-12-16T06:04:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="昵称为空C"/> <meta itemprop="url" content="https://juejin.cn/user/1267096172897005"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Boot 项目docker分层镜像构建案例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1267096172897005/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    昵称为空C
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T06:04:51.000Z" title="Tue Dec 16 2025 06:04:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    25
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>摘要：本文主要介绍<code>Spring Boot</code>项目的<code>docker</code>镜像分层构建，分为外部依赖和内部依赖和项目<code>classes</code>依赖，让<code>docker</code>构建的时候，可以使用之前的缓存，加快构建速度和测试环境镜像拉取速度。</p>
<h2 data-id="heading-0">为什么使用分层 Docker 镜像？</h2>
<p>传统的 Docker 镜像构建方式会将整个应用程序 JAR/WAR 文件复制到一个层中。当你修改代码时，整个层都会失效，导致 Docker 必须重新构建整个应用程序层，即使只是做了微小的代码更改。</p>
<p>通过我们的分层方法，我们将以下内容分离：</p>
<ol>
<li>外部依赖（第三方库）</li>
<li>内部依赖（公司特定库）</li>
<li>应用程序代码（实际业务逻辑）</li>
</ol>
<p>这样，当你修改代码时，只需要重新构建应用程序代码层，而依赖层可以从缓存中重用。</p>
<h2 data-id="heading-1">Maven 插件配置详解</h2>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">executions</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-external-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/external<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-internal-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/internal<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">executions</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">source</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">source</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">target</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">target</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">encoding</span>&gt;</span>UTF-8<span class="hljs-tag">&lt;/<span class="hljs-name">encoding</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- 如果使用预览特性 --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">compilerArgs</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">arg</span>&gt;</span>--enable-preview<span class="hljs-tag">&lt;/<span class="hljs-name">arg</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">compilerArgs</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">release</span>&gt;</span>21<span class="hljs-tag">&lt;/<span class="hljs-name">release</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span>
</code></pre>
<h2 data-id="heading-2">工作原理</h2>
<h3 data-id="heading-3">1. Maven 依赖分离插件配置详解</h3>
<p>我们的 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">pom.xml</a> 使用 <code>maven-dependency-plugin</code> 在构建过程中分离依赖。该插件包含两个执行配置：</p>
<h4 data-id="heading-4">外部依赖复制配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-external-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/external<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
</code></pre>
<p>配置参数说明：</p>
<ul>
<li><code>&lt;id&gt;</code>: 执行的唯一标识符</li>
<li><code>&lt;phase&gt;</code>: 绑定到 Maven 生命周期的 package 阶段</li>
<li><code>&lt;goals&gt;</code>: 执行的目标是 copy-dependencies</li>
<li><code>&lt;configuration&gt;</code>: 配置详情</li>
</ul>

<ul>
<li>
<ul>
<li><code>&lt;outputDirectory&gt;</code>: 输出目录，<code>${project.build.directory}</code> 是 target 目录</li>
<li><code>&lt;includeScope&gt;</code>: 包含作用域为 compile 的依赖</li>
<li><code>&lt;excludeGroupIds&gt;</code>: 排除 groupId 为 cn.hutool 的依赖（将其视为内部依赖）</li>
</ul>
</li>
</ul>
<h4 data-id="heading-5">内部依赖复制配置</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">execution</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>copy-internal-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">phase</span>&gt;</span>package<span class="hljs-tag">&lt;/<span class="hljs-name">phase</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">goals</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">goal</span>&gt;</span>copy-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">goal</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">goals</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">outputDirectory</span>&gt;</span>${project.build.directory}/lib/internal<span class="hljs-tag">&lt;/<span class="hljs-name">outputDirectory</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeScope</span>&gt;</span>compile<span class="hljs-tag">&lt;/<span class="hljs-name">includeScope</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">execution</span>&gt;</span>
</code></pre>
<p>配置参数说明：</p>
<ul>
<li><code>&lt;id&gt;</code>: 执行的唯一标识符</li>
<li><code>&lt;phase&gt;</code>: 同样绑定到 Maven 生命周期的 package 阶段</li>
<li><code>&lt;goals&gt;</code>: 执行的目标也是 copy-dependencies</li>
<li><code>&lt;configuration&gt;</code>: 配置详情</li>
</ul>

<ul>
<li>
<ul>
<li><code>&lt;outputDirectory&gt;</code>: 输出目录为 target/lib/internal</li>
<li><code>&lt;includeScope&gt;</code>: 包含作用域为 compile 的依赖</li>
<li><code>&lt;includeGroupIds&gt;</code>: 只包含 groupId 为 cn.hutool 的依赖（作为内部依赖处理）</li>
</ul>
</li>
</ul>
<p>通过这两个执行配置，Maven 会在 package 阶段自动将依赖分别复制到对应的目录中：</p>
<ul>
<li><code>target/lib/external/</code> - 第三方依赖（排除了 cn.hutool）</li>
<li><code>target/lib/internal/</code> - 内部/公司特定依赖（只有 cn.hutool）</li>
<li><code>target/classes/</code> - 编译后的应用程序代码</li>
</ul>
<h3 data-id="heading-6">2. 分层 Dockerfile 详解</h3>
<p>我们的 <a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer">Dockerfile</a> 通过首先复制依赖来利用 Docker 层缓存：</p>
<pre><code class="hljs language-bash" lang="bash">FROM eclipse-temurin:21-jre-alpine
WORKDIR /app

<span class="hljs-comment"># 1. 复制外部依赖（很少更改）</span>
COPY target/lib/external/*.jar ./lib/external/

<span class="hljs-comment"># 2. 复制内部依赖（偶尔更改）</span>
COPY target/lib/internal/*.jar ./lib/internal/

<span class="hljs-comment"># 3. 复制应用程序类（经常更改）</span>
COPY target/classes ./classes

EXPOSE 8080

ENV CUSTOM_OPTS=<span class="hljs-string">"-Xms256m -Xmx768m"</span>
ENV JAVA_OPTS=<span class="hljs-string">"--enable-preview -XX:+UseSerialGC"</span>
ENTRYPOINT [<span class="hljs-string">"sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"java <span class="hljs-variable">$CUSTOM_OPTS</span> <span class="hljs-variable">$JAVA_OPTS</span> -cp /app/classes:/app/lib/external/*:/app/lib/internal/* com.example.layer.Sp3LayerApplication"</span>]
</code></pre>
<p>Dockerfile 配置说明：</p>
<ul>
<li><code>FROM eclipse-temurin:21-jre-alpine</code>: 使用轻量级的 Alpine Linux 上的 Temurin JDK 21 运行时环境</li>
<li><code>WORKDIR /app</code>: 设置工作目录为 /app</li>
<li><code>COPY target/lib/external/*.jar ./lib/external/</code>: 将外部依赖复制到镜像中，这是最稳定的层</li>
<li><code>COPY target/lib/internal/*.jar ./lib/internal/</code>: 将内部依赖复制到镜像中，这层比外部依赖更可能变化</li>
<li><code>COPY target/classes ./classes</code>: 将应用程序类文件复制到镜像中，这层最容易发生变化</li>
<li><code>EXPOSE 8080</code>: 暴露应用程序端口</li>
<li><code>ENV</code> 指令设置 JVM 参数：</li>
</ul>

<ul>
<li>
<ul>
<li><code>CUSTOM_OPTS</code>: 自定义 JVM 参数，设置初始堆内存和最大堆内存</li>
<li><code>JAVA_OPTS</code>: Java 虚拟机选项，启用预览特性和使用串行垃圾收集器</li>
</ul>
</li>
</ul>

<ul>
<li><code>ENTRYPOINT</code>: 定义容器启动时执行的命令，使用类路径包含所有依赖和应用程序类</li>
</ul>
<p>类路径说明：<br/>
<code>-cp /app/classes:/app/lib/external/*:/app/lib/internal/*</code> 指定了类路径的顺序：</p>
<ol>
<li><code>/app/classes</code>: 应用程序编译后的类文件优先级最高</li>
<li><code>/app/lib/external/*</code>: 外部依赖次之</li>
<li><code>/app/lib/internal/*</code>: 内部依赖最后</li>
</ol>
<p>这种顺序确保了应用程序类可以覆盖依赖中的同名类（如果需要的话），并且保证了正确的类加载顺序。</p>
<h3 data-id="heading-7">3. 构建过程详解</h3>
<h4 data-id="heading-8">Maven 构建生命周期集成</h4>
<p>当执行 <code>mvn package</code> 命令时，Maven 会按照以下顺序执行构建阶段：</p>
<ol>
<li><code>validate</code> - 验证项目正确性</li>
<li><code>compile</code> - 编译源代码</li>
<li><code>test</code> - 运行测试</li>
<li><code>package</code> - 打包应用程序</li>
</ol>
<p>在 <code>package</code> 阶段，<code>maven-dependency-plugin</code> 会自动执行我们配置的两个依赖复制任务：</p>
<ol>
<li>首先执行 <code>copy-external-dependencies</code>，将外部依赖复制到 <code>target/lib/external/</code></li>
<li>然后执行 <code>copy-internal-dependencies</code>，将内部依赖复制到 <code>target/lib/internal/</code></li>
<li>同时，Maven 默认会将编译后的类文件放在 <code>target/classes/</code> 目录中</li>
</ol>
<h4 data-id="heading-9">完整构建步骤</h4>
<ol>
<li>清理并打包应用程序：</li>
</ol>
<pre><code class="hljs language-go" lang="go">mvn clean <span class="hljs-keyword">package</span>
</code></pre>
<p>此命令会触发依赖分离过程，生成三个目录：</p>
<ul>
<li>
<ul>
<li><code>target/classes/</code> - 应用程序编译后的类文件</li>
<li><code>target/lib/external/</code> - 外部依赖 JAR 文件</li>
<li><code>target/lib/internal/</code> - 内部依赖 JAR 文件</li>
</ul>
</li>
</ul>
<ol start="2">
<li>构建 Docker 镜像：</li>
</ol>
<pre><code class="hljs language-erlang" lang="erlang">docker build -t sp3-layer .
</code></pre>
<p>Docker 构建过程会按顺序创建四个层：</p>
<ul>
<li>
<ul>
<li>基础镜像层（eclipse-temurin:21-jre-alpine）</li>
<li>外部依赖层（COPY target/lib/external/*.jar）</li>
<li>内部依赖层（COPY target/lib/internal/*.jar）</li>
<li>应用程序类层（COPY target/classes）</li>
</ul>
</li>
</ul>
<h4 data-id="heading-10">构建优化效果</h4>
<p>由于 Docker 的层缓存机制：</p>
<ul>
<li>当只修改应用程序代码时，只有最后一层需要重建</li>
<li>当添加新的外部依赖时，需要重建外部依赖层及其后的所有层</li>
<li>当添加新的内部依赖时，需要重建内部依赖层和应用程序类层</li>
<li>只有基础镜像变更时，才需要完全重建</li>
</ul>
<h2 data-id="heading-11">优势</h2>
<ol>
<li><strong>更快的构建速度</strong>：代码更改时只需重新构建应用程序代码层</li>
<li><strong>更小的传输量</strong>：推送到注册中心时，只传输更改的层</li>
<li><strong>更好的缓存效果</strong>：依赖层在各个构建之间缓存并重用</li>
<li><strong>减少带宽消耗</strong>：在 CI/CD 流水线中减少数据传输</li>
</ol>
<h2 data-id="heading-12">版本更新工作流程</h2>
<ol>
<li>在应用程序中进行代码更改</li>
<li>运行 <code>mvn clean package</code> 仅重新编译更改的代码</li>
<li>运行 <code>docker build -t sp3-layer:v2 .</code> 构建新镜像</li>
<li>只有 <code>target/classes</code> 层会被重新构建</li>
<li>只将更改的层推送到容器注册中心</li>
</ol>
<h2 data-id="heading-13">配置自定义指南</h2>
<p>要将此配置应用于其他项目，您需要根据项目的依赖结构调整配置：</p>
<h3 data-id="heading-14">修改依赖分组</h3>
<p>如果您有不同的内部依赖，需要修改 <code>excludeGroupIds</code> 和 <code>includeGroupIds</code> 配置：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- 外部依赖配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">excludeGroupIds</span>&gt;</span>com.yourcompany,org.another.internal.group<span class="hljs-tag">&lt;/<span class="hljs-name">excludeGroupIds</span>&gt;</span>
<span class="hljs-comment">&lt;!-- 内部依赖配置 --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">includeGroupIds</span>&gt;</span>com.yourcompany,org.another.internal.group<span class="hljs-tag">&lt;/<span class="hljs-name">includeGroupIds</span>&gt;</span>
</code></pre>
<h2 data-id="heading-15">最佳实践</h2>
<ol>
<li><strong>顺序很重要</strong>：首先复制不经常更改的层</li>
<li><strong>最小化层数</strong>：只分离实际在不同频率下更改的内容</li>
<li><strong>多阶段构建</strong>：考虑与多阶段构建结合使用以获得更小的最终镜像</li>
<li><strong>缓存失效</strong>：了解 Docker 的层缓存机制以最大化收益</li>
</ol>
<p>这种方法可以显著减少 CI/CD 流水线中的构建时间，并在部署更新时最小化网络传输。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。]]></title>    <link>https://juejin.cn/post/7583969283790061622</link>    <guid>https://juejin.cn/post/7583969283790061622</guid>    <pubDate>2025-12-16T02:43:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583969283790061622" data-draft-id="7583984122235027498" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-16T02:43:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="逛逛GitHub"/> <meta itemprop="url" content="https://juejin.cn/user/1442202996186093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            推荐 4 个 yyds 的 AI 控制安卓手机的 GitHub 项目。
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1442202996186093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    逛逛GitHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:43:56.000Z" title="Tue Dec 16 2025 02:43:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>逛逛在 11 月发了一篇文章，盘点了 GitHub 上 AI 操纵手机的开源项目。</p>
<p>获得了 3 万多阅读，3000 多人转发收藏：</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3bd8410fb07046d8b8a6f6db0a62988d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=gPXulglpgqrxG9q4eQbYdwXMbEE%3D" alt="图片" loading="lazy"/></p>
<p>没想到那篇文章发布 5 天后，豆包就官宣推出了 AI 手机，紧接着智谱 AI 就开源了 AutoGLM 模型。</p>
<p>我又搜罗了几个 AI 操作手机的开源项目，再加上我之前发的那篇。整个 GitHub 上关于 AI 控制手机的项目算是被逛逛搜刮干净了。</p>
<p>欢迎收藏转发👏</p>
<h2 data-id="heading-0">01、智谱开源：Open-AutoGLM</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da34e068012e4bc0bd7c51154d930bbe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=WbikuqLDP0%2FID5RLuXWW92pCQrk%3D" alt="图片" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>这个开源项目太顶了，不到一周就 1.3 万的 Star 了。</p>
<p>基于这个开源框架，就能让 AI 可以<strong>像人眼一样看手机屏幕</strong>，然后像人手一样去点击。</p>
<p>你给它一个任务，比如：帮我总结下长春的景点，到高德地图上收藏一下这几个景点，特别是具体看看博物馆门票价格，再去12306上订一张上午十点从北京去长春的高铁票，把相关信息整理好给我。</p>
<p>AutoGLM 会先把手机屏幕截个图，模型会分析截图，通过视觉定位找到当前要点击哪个按钮或者做啥操作。</p>
<p>并通过 ADB（Android Debug Bridge）工具，直接向手机发送点击、滑动、输入文字的指令。</p>
<p>最终这样一步步模拟人看手机、操纵手机的行为，完成你给的任务。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/64e6aa6b09424c75b4fdaa5772bc82e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=wpzrBWk26HX97tTekzAskgdwF8s%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/zai-org/Open-AutoGLM</span>
</code></pre>
<p>而且这个开源可以本地部署，而且如果你有显卡，大约需要 24GB+ 显存，你可以把这个 Agent 跑在本地。</p>
<p>隐私数据，比如聊天记录、支付画面啥的不上传到云端也能自动化的你的安卓手机了。</p>
<p>如何使用</p>
<p>你可以使用Claude Code，配置 GLM Coding Plan 后，输入以下提示词，快速部署本项目。 </p>
<pre><code class="hljs language-bash" lang="bash">访问文档，为我安装 AutoGLM ：https://raw.githubusercontent.com/zai-org/Open-AutoGLM/refs/heads/main/README.md
</code></pre>
<h2 data-id="heading-1">02、通过 MCP 控制手机：DroidMind</h2>
<p><strong>DroidMind 这个开源项目的的核心逻辑是不自己训练一个新模型，而是做一个</strong> <strong>超级适配器</strong>。</p>
<p>它通过 MCP 协议，把你的 <strong>Android 手机</strong>直接挂载到 <strong>Claude Desktop</strong>、<strong>Cursor</strong> 或者 Claude <strong>Code</strong> 上。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b02d0991fb2a43488648ebd3373427ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=ZyI3vsHOF6tLB5rtRPlXnQvddEM%3D" alt="图片" loading="lazy"/></p>
<p>你不需要运行一个沉重的本地模型。</p>
<p>你直接用最聪明的 <strong>Claude 或 Gemini</strong>，通过 DroidMind 这个翻译官，直接操控你的安卓手机。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea8675948f544464986d155332699dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=l4ZxsDMfoe0IMphZqUryM7iUZSI%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/hyperb1iss/DroidMind</span>
</code></pre>
<h2 data-id="heading-2">03、微软开源：UFO</h2>
<p>这个叫 UFO 的开源项目其实是微软开源的 AI 操作 Windows 系统的开源项目。</p>
<p>只不过 11 月推出的 UFO³ Galaxy 已经演变成了一个<strong>跨设备、跨平台的编排框架。</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b417d760183748f090dae85f029b2531~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=xJbKxU1sIV9N1HQhBISkQzbImJA%3D" alt="图片" loading="lazy"/><strong>UFO³ Galaxy</strong> 涉及到操纵 <strong>Android 手机设备</strong>的部分是这次更新的核心亮点之一。它也是通过引入 <strong>MCP 架构来实现的，这使得 UFO 不再局限于 Windows，而是能像指挥官一样控制安卓手机。</strong><br/>
<strong><strong><strong><strong>UFO³ Galaxy</strong> 是一个</strong>多设备编排系统</strong>。它的核心理念包含两个部分。</strong></p>
<ul>
<li>Galaxy (星系)：整个控制中枢，负责分发任务。</li>
<li>Constellation (星座)：它将一个复杂的用户指令，比如把手机上的刚拍的照片传到电脑并用 Photoshop 编辑，拆解成一个 DAG（有向无环图）。</li>
</ul>
<p>Windows 电脑、Linux 服务器、<strong>Android 手机</strong> 等都作为独立的节点接入这个网络。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd0c8f3f4526455695729b40dc244788~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=9pxL%2FnAnkqzhnRzTDxKoFdSNlZ4%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/microsoft/UFO</span>
</code></pre>
<h2 data-id="heading-3">04、字节开源：UI-TARS</h2>
<p>字节跳动开源的一个基于视觉-语言模型（VLM）的 GUI 智能体（Agent）项目。</p>
<p>它的核心目标是让 AI 像人类一样，通过视觉识别屏幕和操作鼠标/键盘/触控，直接控制手机、计算机或网页。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87b02bf798394c6796467a71a90fecc1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=7O9xIgwUtSHFyzxOZb7Vh80wWtI%3D" alt="图片" loading="lazy"/><strong>安卓手机设备操纵，</strong> UI-TARS 采用了一种<strong>端到端、纯视觉驱动、基于 ADB</strong> 的控制方案。</p>
<p>也是截取手机屏幕画面，把截图输入给视觉模型，模型结合用户的指令分析屏幕上的元素，决定下一步做什么。</p>
<p>最后模型输出具体的动作指令，转化为底层的 Android ADB 命令发送给手机执行。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af1610839b4d4f7b88f7c69b7653c7c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCb6YCbR2l0SHVi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766457836&amp;x-signature=PIk7p7%2BqJx7i1I4rR5t9UmhPEPA%3D" alt="图片" loading="lazy"/></p>
<pre><code class="hljs language-arduino" lang="arduino">开源地址：https:<span class="hljs-comment">//github.com/bytedance/UI-TARS</span>
</code></pre>
<p>另外之前发布的另外一个盘点 AI 控制手机开源项目的链接如下，感兴趣的可以去看看：</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzUxNjg4NDEzNA%3D%3D%26mid%3D2247529132%26idx%3D1%26sn%3D0b45b857cfd67f9144472f2017f46a14%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzUxNjg4NDEzNA==&amp;mid=2247529132&amp;idx=1&amp;sn=0b45b857cfd67f9144472f2017f46a14&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">5 个 AI 操纵手机的 GitHub 项目，牛逼了。</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零到一：打造企业级 Vue 3 高性能表格组件的设计哲学与实践]]></title>    <link>https://juejin.cn/post/7584472215975690255</link>    <guid>https://juejin.cn/post/7584472215975690255</guid>    <pubDate>2025-12-17T09:52:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584472215975690255" data-draft-id="7584408254820384803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零到一：打造企业级 Vue 3 高性能表格组件的设计哲学与实践"/> <meta itemprop="keywords" content="前端,Vue.js,架构"/> <meta itemprop="datePublished" content="2025-12-17T09:52:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="大象的鼻子那么长"/> <meta itemprop="url" content="https://juejin.cn/user/2277843821926871"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零到一：打造企业级 Vue 3 高性能表格组件的设计哲学与实践
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2277843821926871/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    大象的鼻子那么长
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.4 融会贯通
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.4 融会贯通" title="VIP.4 融会贯通" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T09:52:27.000Z" title="Wed Dec 17 2025 09:52:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读12分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文将深入剖析一个企业级 Vue 3 表格组件的架构设计、性能优化策略与工程化实践，涵盖 Composition API 深度应用、响应式系统优化、TypeScript 类型体操等核心技术点。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>在企业级 B 端应用开发中，表格组件堪称"兵家必争之地"——它承载着数据展示、交互操作、状态管理等核心职责，其设计质量直接影响着整个系统的用户体验与可维护性。</p>
<p>本文将以笔者主导设计的 <code>CmcCardTable</code> 组件为例，系统性地阐述：</p>
<ul>
<li>🎯 <strong>架构设计</strong>：如何运用 Composition API 实现关注点分离</li>
<li>⚡ <strong>性能优化</strong>：响应式系统的精细化调优策略</li>
<li>🔒 <strong>类型安全</strong>：TypeScript 在复杂组件中的深度实践</li>
<li>🧪 <strong>工程质量</strong>：可测试性设计与单元测试最佳实践</li>
</ul>
<hr/>
<h2 data-id="heading-1">一、架构设计：Composables 模式的深度实践</h2>
<h3 data-id="heading-2">1.1 从"上帝组件"到"关注点分离"</h3>
<p>传统的表格组件往往会演变成一个庞大的"上帝组件"（God Component），动辄数千行代码，维护成本极高。我们采用 <strong>Composables 模式</strong> 将表格的核心功能解耦为独立的组合式函数：</p>
<pre><code class="hljs language-bash" lang="bash">src/components/CmcCardTable/
├── CmcCardTable.vue          <span class="hljs-comment"># 主组件（视图层）</span>
├── composables/
│   ├── useTableSelection.ts  <span class="hljs-comment"># 选择状态管理</span>
│   ├── useTableExpand.ts     <span class="hljs-comment"># 展开/折叠逻辑</span>
│   ├── useTableSort.ts       <span class="hljs-comment"># 排序功能</span>
│   └── useTableLayout.ts     <span class="hljs-comment"># 布局计算</span>
├── types.ts                  <span class="hljs-comment"># 类型定义</span>
└── SubRowGrid.vue            <span class="hljs-comment"># 子行网格组件</span>
</code></pre>
<p>这种架构带来的收益：</p>






























<table><thead><tr><th>维度</th><th>传统方案</th><th>Composables 方案</th></tr></thead><tbody><tr><td>单文件代码量</td><td>3000+ 行</td><td>主组件 &lt; 800 行</td></tr><tr><td>可测试性</td><td>需要挂载整个组件</td><td>可独立单元测试</td></tr><tr><td>复用性</td><td>难以复用</td><td>可跨组件复用</td></tr><tr><td>认知负载</td><td>高</td><td>低（单一职责）</td></tr></tbody></table>
<h3 data-id="heading-3">1.2 Composable 的设计原则</h3>
<p>以 <code>useTableSelection</code> 为例，一个优秀的 Composable 应遵循以下原则：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSelection.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseTableSelectionOptions</span> {
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-title class_">TableRow</span>[]&gt;
  <span class="hljs-attr">rowKey</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">selectionMode</span>: <span class="hljs-title class_">Ref</span>&lt;<span class="hljs-title class_">SelectionMode</span>&gt;
  <span class="hljs-attr">selectedRowKeys</span>: <span class="hljs-title class_">Ref</span>&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;
  reserveSelection?: <span class="hljs-built_in">boolean</span>
  selectable?: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>  <span class="hljs-comment">// 🆕 行级选择控制</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UseTableSelectionReturn</span> {
  <span class="hljs-attr">internalSelectedKeys</span>: <span class="hljs-title class_">Ref</span>&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;
  <span class="hljs-attr">selectionState</span>: <span class="hljs-title class_">ComputedRef</span>&lt;{
    <span class="hljs-attr">isAllSelected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">isIndeterminate</span>: <span class="hljs-built_in">boolean</span>
  }&gt;
  <span class="hljs-attr">isRowSelected</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">isRowSelectable</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
  <span class="hljs-attr">handleRowSelect</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow, selected: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">handleSingleSelect</span>: <span class="hljs-function">(<span class="hljs-params">row: TableRow</span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">handleSelectAll</span>: <span class="hljs-function">(<span class="hljs-params">selected: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">clearSelection</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>
  <span class="hljs-attr">getAllSelectedRows</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">TableRow</span>[]
}
</code></pre>
<p><strong>设计要点</strong>：</p>
<ol>
<li><strong>显式的输入/输出接口</strong>：通过 TypeScript 接口明确定义 Options 和 Return，消除隐式依赖</li>
<li><strong>响应式数据作为参数</strong>：传入 <code>Ref</code> 而非原始值，保持响应式链路</li>
<li><strong>纯函数式设计</strong>：无副作用，所有状态变更都是显式的</li>
</ol>
<hr/>
<h2 data-id="heading-4">二、响应式系统的精细化优化</h2>
<h3 data-id="heading-5">2.1 shallowRef vs ref：内存与性能的权衡</h3>
<p>在处理大数据量表格时，响应式系统的开销不容忽视。我们采用分层的响应式策略：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 反模式：深层响应式导致不必要的依赖追踪</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">ref</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// ✅ 优化方案：使用 shallowRef 减少响应式开销</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// 更新时手动触发响应</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSelection</span>(<span class="hljs-params">key: <span class="hljs-built_in">string</span>, row: TableRow</span>) {
  <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(selectedRowsMap.<span class="hljs-property">value</span>)
  newMap.<span class="hljs-title function_">set</span>(key, row)
  selectedRowsMap.<span class="hljs-property">value</span> = newMap  <span class="hljs-comment">// 触发响应式更新</span>
}
</code></pre>
<p><strong>性能对比</strong>（1000 行数据场景）：</p>




















<table><thead><tr><th>方案</th><th>内存占用</th><th>批量选择耗时</th></tr></thead><tbody><tr><td>ref + Map</td><td>~2.4MB</td><td>~45ms</td></tr><tr><td>shallowRef + Map</td><td>~1.8MB</td><td>~12ms</td></tr></tbody></table>
<h3 data-id="heading-6">2.2 Computed 依赖的精准控制</h3>
<p><code>computed</code> 的依赖追踪是自动的，但这也可能导致"过度追踪"问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ 反模式：整个 data 数组变化都会触发重计算</span>
<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> allKeys = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-comment">// ...</span>
})

<span class="hljs-comment">// ✅ 优化方案：只追踪必要的依赖</span>
<span class="hljs-keyword">const</span> selectableRows = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> 
  data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> <span class="hljs-title function_">isRowSelectable</span>(row, index))
)

<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> selectableKeys = selectableRows.<span class="hljs-property">value</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-keyword">const</span> selectedSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(internalSelectedKeys.<span class="hljs-property">value</span>)
  
  <span class="hljs-keyword">const</span> selectedCount = selectableKeys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> selectedSet.<span class="hljs-title function_">has</span>(key)).<span class="hljs-property">length</span>
  <span class="hljs-keyword">const</span> totalSelectable = selectableKeys.<span class="hljs-property">length</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">isAllSelected</span>: totalSelectable &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount === totalSelectable,
    <span class="hljs-attr">isIndeterminate</span>: selectedCount &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount &lt; totalSelectable,
  }
})
</code></pre>
<h3 data-id="heading-7">2.3 Watch 的防抖与节流策略</h3>
<p>对于高频变化的数据源，直接 watch 可能导致性能问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableExpand.ts</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> data.<span class="hljs-property">value</span>.<span class="hljs-property">length</span>,  <span class="hljs-comment">// 👈 只监听长度变化，而非整个数组</span>
  <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (defaultExpandAll.<span class="hljs-property">value</span>) {
      <span class="hljs-title function_">initializeExpandedKeys</span>()
    }
  },
  { <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span> }  <span class="hljs-comment">// 👈 在 DOM 更新后执行，避免重复计算</span>
)
</code></pre>
<hr/>
<h2 data-id="heading-8">三、TypeScript 类型体操：从"能用"到"好用"</h2>
<h3 data-id="heading-9">3.1 泛型约束与条件类型</h3>
<p>为了让 API 更加智能，我们使用了条件类型来约束参数：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// types.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableColumn</span>&lt;T = <span class="hljs-title class_">TableRow</span>&gt; {
  <span class="hljs-attr">key</span>: keyof T | <span class="hljs-built_in">string</span>
  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span>
  width?: <span class="hljs-built_in">string</span>
  flex?: <span class="hljs-built_in">string</span>
  align?: <span class="hljs-string">'left'</span> | <span class="hljs-string">'center'</span> | <span class="hljs-string">'right'</span>
  sortable?: <span class="hljs-built_in">boolean</span>
  
  <span class="hljs-comment">// 条件渲染函数</span>
  render?: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">unknown</span>, row: T, column: TableColumn&lt;T&gt;</span>) =&gt;</span> <span class="hljs-built_in">string</span>
  
  <span class="hljs-comment">// 行操作项（支持静态配置和动态函数）</span>
  actionItems?: <span class="hljs-title class_">ActionItem</span>[] | (<span class="hljs-function">(<span class="hljs-params">row: T</span>) =&gt;</span> <span class="hljs-title class_">ActionItem</span>[])
}

<span class="hljs-comment">// 使用泛型约束行数据类型</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRow</span> {
  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">orderNo</span>: <span class="hljs-built_in">string</span>
  <span class="hljs-attr">amount</span>: <span class="hljs-built_in">number</span>
  <span class="hljs-attr">status</span>: <span class="hljs-string">'pending'</span> | <span class="hljs-string">'confirmed'</span> | <span class="hljs-string">'shipped'</span>
}

<span class="hljs-keyword">const</span> <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumn</span>&lt;<span class="hljs-title class_">OrderRow</span>&gt;[] = [
  {
    <span class="hljs-attr">key</span>: <span class="hljs-string">'status'</span>,  <span class="hljs-comment">// ✅ IDE 自动补全，类型安全</span>
    <span class="hljs-attr">label</span>: <span class="hljs-string">'状态'</span>,
    <span class="hljs-attr">render</span>: <span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> statusMap[value <span class="hljs-keyword">as</span> <span class="hljs-title class_">OrderRow</span>[<span class="hljs-string">'status'</span>]]
  }
]
</code></pre>
<h3 data-id="heading-10">3.2 事件类型的完整定义</h3>
<p>为组件事件提供完整的类型定义，让使用方获得最佳的开发体验：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 定义强类型的 emit 接口</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">TableEmits</span> {
  <span class="hljs-string">'update:selectedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]]
  <span class="hljs-string">'update:expandedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]]
  <span class="hljs-string">'selection-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">selectedRowKeys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]
  }]
  <span class="hljs-string">'select'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">row</span>: <span class="hljs-title class_">TableRow</span>
    <span class="hljs-attr">selected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
  <span class="hljs-string">'select-all'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">selected</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">selectedRows</span>: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">selectionChanges</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
  <span class="hljs-string">'sort-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">column</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>
    <span class="hljs-attr">order</span>: <span class="hljs-string">'asc'</span> | <span class="hljs-string">'desc'</span> | <span class="hljs-literal">null</span>
    <span class="hljs-attr">sortState</span>: <span class="hljs-title class_">SortState</span>
  }]
  <span class="hljs-string">'expand-change'</span>: [<span class="hljs-attr">data</span>: {
    <span class="hljs-attr">row</span>: <span class="hljs-title class_">TableRow</span>
    <span class="hljs-attr">expanded</span>: <span class="hljs-built_in">boolean</span>
    <span class="hljs-attr">expandedRows</span>: <span class="hljs-title class_">TableRow</span>[]
  }]
}

<span class="hljs-comment">// 组件中使用</span>
<span class="hljs-keyword">const</span> emit = defineEmits&lt;<span class="hljs-title class_">TableEmits</span>&gt;()
</code></pre>
<h3 data-id="heading-11">3.3 Props 的智能默认值</h3>
<p>利用 TypeScript 的类型推导，实现带默认值的 Props 定义：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(
  defineProps&lt;{
    data?: <span class="hljs-title class_">TableRow</span>[]
    <span class="hljs-attr">columns</span>: <span class="hljs-title class_">TableColumn</span>[]
    rowKey?: <span class="hljs-built_in">string</span>
    selectionMode?: <span class="hljs-title class_">SelectionMode</span>
    selectable?: <span class="hljs-function">(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>
    reserveSelection?: <span class="hljs-built_in">boolean</span>
    defaultExpandAll?: <span class="hljs-built_in">boolean</span>
  }&gt;(),
  {
    <span class="hljs-attr">data</span>: <span class="hljs-function">() =&gt;</span> [],
    <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
    <span class="hljs-attr">selectionMode</span>: <span class="hljs-string">'none'</span>,
    <span class="hljs-attr">selectable</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 默认所有行可选</span>
    <span class="hljs-attr">reserveSelection</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">defaultExpandAll</span>: <span class="hljs-literal">false</span>,
  }
)
</code></pre>
<hr/>
<h2 data-id="heading-12">四、高级特性实现剖析</h2>
<h3 data-id="heading-13">4.1 跨分页选择保持（Reserve Selection）</h3>
<p>在分页场景下，如何保持用户的选择状态是一个经典问题。我们的解决方案：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 使用 Map 存储选中行的完整数据，而非仅存储 key</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// 数据变化时的处理策略</span>
<span class="hljs-title function_">watch</span>(data, <span class="hljs-function">(<span class="hljs-params">newData</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!reserveSelection) {
    <span class="hljs-comment">// 非保留模式：清除不在新数据中的选中项</span>
    <span class="hljs-keyword">const</span> newDataKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(newData.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey]))
    <span class="hljs-keyword">const</span> newMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;()
    
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [key, row] <span class="hljs-keyword">of</span> selectedRowsMap.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">if</span> (newDataKeys.<span class="hljs-title function_">has</span>(key)) {
        newMap.<span class="hljs-title function_">set</span>(key, row)
      }
    }
    selectedRowsMap.<span class="hljs-property">value</span> = newMap
  }
  <span class="hljs-comment">// 保留模式：Map 中的数据不会被清除，即使该行不在当前页</span>
}, { <span class="hljs-attr">deep</span>: <span class="hljs-literal">false</span> })

<span class="hljs-comment">// 获取所有选中行数据（跨分页）</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">getAllSelectedRows</span>(<span class="hljs-params"/>): <span class="hljs-title class_">TableRow</span>[] {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(selectedRowsMap.<span class="hljs-property">value</span>.<span class="hljs-title function_">values</span>())
}
</code></pre>
<p><strong>核心思想</strong>：将选中行的完整数据存储在 Map 中，而非仅存储 key。这样即使数据源（当前页）不包含某些选中行，我们依然可以获取其完整信息。</p>
<h3 data-id="heading-14">4.2 部分行禁用选择（Selectable）</h3>
<p>业务场景中常需要根据行数据动态禁用选择，我们通过 <code>selectable</code> 函数实现：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/**
 * 判断行是否可选择
 * <span class="hljs-doctag">@description</span> 支持业务自定义禁用逻辑
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isRowSelectable</span>(<span class="hljs-params">row: TableRow, index: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">boolean</span> {
  <span class="hljs-keyword">if</span> (!selectable) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">selectable</span>(row, index)
}

<span class="hljs-comment">// 全选逻辑需要排除不可选行</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">handleSelectAll</span>(<span class="hljs-params">selected: <span class="hljs-built_in">boolean</span></span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> selectableRows = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> 
    <span class="hljs-title function_">isRowSelectable</span>(row, index)
  )
  
  <span class="hljs-keyword">if</span> (selected) {
    <span class="hljs-comment">// 只选中可选的行</span>
    selectableRows.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> key = row[rowKey]
      <span class="hljs-keyword">if</span> (!internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">includes</span>(key)) {
        internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">push</span>(key)
        selectedRowsMap.<span class="hljs-property">value</span>.<span class="hljs-title function_">set</span>(key, row)
      }
    })
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// 只取消可选行的选中状态</span>
    <span class="hljs-keyword">const</span> selectableKeys = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(selectableRows.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey]))
    internalSelectedKeys.<span class="hljs-property">value</span> = internalSelectedKeys.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(
      <span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> !selectableKeys.<span class="hljs-title function_">has</span>(key)
    )
  }
}

<span class="hljs-comment">// 计算全选状态时只考虑可选行</span>
<span class="hljs-keyword">const</span> selectionState = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> selectableRows = data.<span class="hljs-property">value</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">row, index</span>) =&gt;</span> 
    <span class="hljs-title function_">isRowSelectable</span>(row, index)
  )
  <span class="hljs-keyword">const</span> selectableKeys = selectableRows.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row[rowKey])
  <span class="hljs-keyword">const</span> selectedSet = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(internalSelectedKeys.<span class="hljs-property">value</span>)
  
  <span class="hljs-keyword">const</span> selectedCount = selectableKeys.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> selectedSet.<span class="hljs-title function_">has</span>(key)).<span class="hljs-property">length</span>
  
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">isAllSelected</span>: selectableKeys.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount === selectableKeys.<span class="hljs-property">length</span>,
    <span class="hljs-attr">isIndeterminate</span>: selectedCount &gt; <span class="hljs-number">0</span> &amp;&amp; selectedCount &lt; selectableKeys.<span class="hljs-property">length</span>,
  }
})
</code></pre>
<p><strong>使用示例</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;CmcCardTable
    v-model:selected-row-keys="selectedKeys"
    :data="tableData"
    :columns="columns"
    selection-mode="multiple"
    :selectable="(row) =&gt; row.status !== 'locked'"
  /&gt;
&lt;/template&gt;
</code></pre>
<h3 data-id="heading-15">4.3 远程排序与本地排序的统一抽象</h3>
<p>支持本地排序和远程排序两种模式，通过配置切换：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSort.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTableSort</span>(<span class="hljs-params">options: UseTableSortOptions</span>) {
  <span class="hljs-keyword">const</span> { data, defaultSort, remoteSort, onSortChange } = options
  
  <span class="hljs-comment">// 当前排序状态</span>
  <span class="hljs-keyword">const</span> sortState = shallowRef&lt;<span class="hljs-title class_">SortState</span>&gt;({
    <span class="hljs-attr">column</span>: defaultSort?.<span class="hljs-property">column</span> ?? <span class="hljs-literal">null</span>,
    <span class="hljs-attr">order</span>: defaultSort?.<span class="hljs-property">order</span> ?? <span class="hljs-literal">null</span>,
  })
  
  <span class="hljs-comment">// 排序后的数据</span>
  <span class="hljs-keyword">const</span> sortedData = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 远程排序模式：直接返回原数据，排序由后端处理</span>
    <span class="hljs-keyword">if</span> (remoteSort?.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>
    }
    
    <span class="hljs-comment">// 本地排序模式</span>
    <span class="hljs-keyword">if</span> (!sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span> || !sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span>) {
      <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>
    }
    
    <span class="hljs-keyword">return</span> [...data.<span class="hljs-property">value</span>].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> aVal = a[sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>!]
      <span class="hljs-keyword">const</span> bVal = b[sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>!]
      <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">compareValues</span>(aVal, bVal)
      <span class="hljs-keyword">return</span> sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span> === <span class="hljs-string">'desc'</span> ? -result : result
    })
  })
  
  <span class="hljs-comment">// 切换排序</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">toggleSort</span>(<span class="hljs-params">column: <span class="hljs-built_in">string</span></span>) {
    <span class="hljs-keyword">const</span> newOrder = <span class="hljs-title function_">getNextSortOrder</span>(sortState.<span class="hljs-property">value</span>, column)
    sortState.<span class="hljs-property">value</span> = { <span class="hljs-attr">column</span>: newOrder ? column : <span class="hljs-literal">null</span>, <span class="hljs-attr">order</span>: newOrder }
    
    <span class="hljs-comment">// 触发事件，交由父组件处理（远程排序时调用接口）</span>
    onSortChange?.({
      <span class="hljs-attr">column</span>: sortState.<span class="hljs-property">value</span>.<span class="hljs-property">column</span>,
      <span class="hljs-attr">order</span>: sortState.<span class="hljs-property">value</span>.<span class="hljs-property">order</span>,
      <span class="hljs-attr">sortState</span>: sortState.<span class="hljs-property">value</span>,
    })
  }
  
  <span class="hljs-keyword">return</span> { sortState, sortedData, toggleSort }
}
</code></pre>
<hr/>
<h2 data-id="heading-16">五、工程化实践：可测试性设计</h2>
<h3 data-id="heading-17">5.1 Composable 的单元测试</h3>
<p>得益于 Composables 的独立性，我们可以脱离组件进行单元测试：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useTableSelection.test.ts</span>
<span class="hljs-keyword">import</span> { describe, it, expect, vi } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest'</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { useTableSelection } <span class="hljs-keyword">from</span> <span class="hljs-string">'../useTableSelection'</span>

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'useTableSelection'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">createTestData</span> = (<span class="hljs-params"/>) =&gt; [
    { <span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'张三'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'李四'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'locked'</span> },
    { <span class="hljs-attr">id</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'王五'</span>, <span class="hljs-attr">status</span>: <span class="hljs-string">'active'</span> },
  ]

  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'selectable 部分禁用'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'全选时应只选中可选行'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = ref&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;([])
      
      <span class="hljs-keyword">const</span> { handleSelectAll, internalSelectedKeys } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">selectable</span>: <span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>,  <span class="hljs-comment">// 只有 active 可选</span>
      })
      
      <span class="hljs-title function_">handleSelectAll</span>(<span class="hljs-literal">true</span>)
      
      <span class="hljs-comment">// 应只选中 id=1 和 id=3（status='active'）</span>
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-title function_">toEqual</span>([<span class="hljs-number">1</span>, <span class="hljs-number">3</span>])
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-property">not</span>.<span class="hljs-title function_">toContain</span>(<span class="hljs-number">2</span>)
    })
    
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'isIndeterminate 应只基于可选行计算'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>])  <span class="hljs-comment">// 选中一个可选行</span>
      
      <span class="hljs-keyword">const</span> { selectionState } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">selectable</span>: <span class="hljs-function">(<span class="hljs-params">row</span>) =&gt;</span> row.<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>,
      })
      
      <span class="hljs-comment">// 可选行有 2 个（id=1,3），选中了 1 个，应为半选状态</span>
      <span class="hljs-title function_">expect</span>(selectionState.<span class="hljs-property">value</span>.<span class="hljs-property">isIndeterminate</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">true</span>)
      <span class="hljs-title function_">expect</span>(selectionState.<span class="hljs-property">value</span>.<span class="hljs-property">isAllSelected</span>).<span class="hljs-title function_">toBe</span>(<span class="hljs-literal">false</span>)
    })
  })
  
  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'reserveSelection 跨分页保留'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">it</span>(<span class="hljs-string">'应保留不在当前页的选中数据'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> data = <span class="hljs-title function_">ref</span>(<span class="hljs-title function_">createTestData</span>())
      <span class="hljs-keyword">const</span> selectedRowKeys = <span class="hljs-title function_">ref</span>([<span class="hljs-number">1</span>, <span class="hljs-number">99</span>])  <span class="hljs-comment">// 99 不在当前数据中</span>
      
      <span class="hljs-keyword">const</span> { internalSelectedKeys, getAllSelectedRows } = <span class="hljs-title function_">useTableSelection</span>({
        data,
        <span class="hljs-attr">rowKey</span>: <span class="hljs-string">'id'</span>,
        <span class="hljs-attr">selectionMode</span>: <span class="hljs-title function_">ref</span>(<span class="hljs-string">'multiple'</span>),
        selectedRowKeys,
        <span class="hljs-attr">reserveSelection</span>: <span class="hljs-literal">true</span>,
      })
      
      <span class="hljs-comment">// key 99 应被保留</span>
      <span class="hljs-title function_">expect</span>(internalSelectedKeys.<span class="hljs-property">value</span>).<span class="hljs-title function_">toContain</span>(<span class="hljs-number">99</span>)
    })
  })
})
</code></pre>
<h3 data-id="heading-18">5.2 测试覆盖率与质量保障</h3>
<p>我们为核心 Composables 编写了全面的单元测试：</p>
<pre><code class="hljs language-scss" lang="scss">✓ useTableSelection<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span> (<span class="hljs-number">25</span> tests)
✓ useTableExpand<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>    (<span class="hljs-number">27</span> tests)
✓ useTableSort<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>      (<span class="hljs-number">22</span> tests)
✓ useTableLayout<span class="hljs-selector-class">.test</span><span class="hljs-selector-class">.ts</span>    (<span class="hljs-number">31</span> tests)

Total: <span class="hljs-number">105</span> tests passed
</code></pre>
<p>测试用例覆盖：</p>
<ul>
<li>✅ 正常流程</li>
<li>✅ 边界条件（空数据、重复操作等）</li>
<li>✅ 模式切换（单选/多选/禁用）</li>
<li>✅ 响应式同步</li>
<li>✅ 事件触发</li>
</ul>
<hr/>
<h2 data-id="heading-19">六、API 设计的艺术：向 Element Plus 学习</h2>
<h3 data-id="heading-20">6.1 Props 命名的一致性</h3>
<p>我们在 API 设计上尽量与 Element Plus 保持一致，降低用户的学习成本：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- Element Plus Table --&gt;
&lt;el-table
  :data="tableData"
  :row-key="rowKey"
  :default-sort="{ prop: 'date', order: 'descending' }"
  @selection-change="handleSelectionChange"
  @sort-change="handleSortChange"
&gt;
  &lt;el-table-column type="selection" /&gt;
  &lt;el-table-column type="index" /&gt;
  &lt;el-table-column type="expand" /&gt;
&lt;/el-table&gt;

&lt;!-- CmcCardTable（风格一致） --&gt;
&lt;CmcCardTable
  :data="tableData"
  :row-key="rowKey"
  :default-sort="{ column: 'date', order: 'desc' }"
  @selection-change="handleSelectionChange"
  @sort-change="handleSortChange"
  :columns="[
    { key: 'selection', type: 'selection' },
    { key: 'index', type: 'index' },
    { key: 'expand', type: 'expand' },
  ]"
/&gt;
</code></pre>
<h3 data-id="heading-21">6.2 渐进式的功能启用</h3>
<p>通过 Props 开关式地启用功能，保持 API 的简洁性：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 最简用法 --&gt;
&lt;CmcCardTable :data="data" :columns="columns" /&gt;

&lt;!-- 启用选择 --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
/&gt;

&lt;!-- 启用选择 + 部分禁用 --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
  :selectable="row =&gt; row.status === 'active'"
/&gt;

&lt;!-- 启用选择 + 跨分页保留 + 部分禁用 --&gt;
&lt;CmcCardTable 
  :data="data" 
  :columns="columns"
  selection-mode="multiple"
  reserve-selection
  :selectable="row =&gt; row.status === 'active'"
/&gt;
</code></pre>
<hr/>
<h2 data-id="heading-22">七、性能优化清单</h2>



































<table><thead><tr><th>优化点</th><th>技术手段</th><th>效果</th></tr></thead><tbody><tr><td>减少响应式开销</td><td>shallowRef 替代 ref</td><td>内存降低 25%</td></tr><tr><td>避免重复计算</td><td>computed 缓存</td><td>渲染性能提升 40%</td></tr><tr><td>精准依赖追踪</td><td>拆分细粒度 computed</td><td>减少无效更新</td></tr><tr><td>大列表渲染</td><td>CSS Grid 布局</td><td>重排性能提升</td></tr><tr><td>事件处理</td><td>事件委托</td><td>减少监听器数量</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-23">八、进阶优化：突破性能瓶颈</h2>
<h3 data-id="heading-24">8.1 虚拟滚动支持：突破万级数据渲染</h3>
<p>当表格需要渲染数千甚至上万行数据时，传统的 v-for 渲染会导致严重的性能问题。我们实现了 <code>useVirtualScroll</code> composable 来解决这个问题：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// useVirtualScroll.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useVirtualScroll</span>(<span class="hljs-params">options: UseVirtualScrollOptions</span>) {
  <span class="hljs-keyword">const</span> { data, itemHeight, containerHeight, overscan = <span class="hljs-number">5</span> } = options
  
  <span class="hljs-comment">// 当前滚动位置</span>
  <span class="hljs-keyword">const</span> scrollTop = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
  
  <span class="hljs-comment">// 计算可见范围（起始和结束索引）</span>
  <span class="hljs-keyword">const</span> visibleRange = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop.<span class="hljs-property">value</span> / itemHeight)
    <span class="hljs-keyword">const</span> end = start + <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight / itemHeight)
    
    <span class="hljs-comment">// 应用 overscan（预渲染额外行数）</span>
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">start</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, start - overscan),
      <span class="hljs-attr">end</span>: <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(data.<span class="hljs-property">value</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>, end + overscan)
    }
  })
  
  <span class="hljs-comment">// 只渲染可见范围内的数据</span>
  <span class="hljs-keyword">const</span> virtualItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> { start, end } = visibleRange.<span class="hljs-property">value</span>
    <span class="hljs-keyword">return</span> data.<span class="hljs-property">value</span>.<span class="hljs-title function_">slice</span>(start, end + <span class="hljs-number">1</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item, i</span>) =&gt;</span> ({
      <span class="hljs-attr">data</span>: item,
      <span class="hljs-attr">index</span>: start + i,
      <span class="hljs-attr">offsetTop</span>: (start + i) * itemHeight
    }))
  })
  
  <span class="hljs-keyword">return</span> { virtualItems, visibleRange, onScroll, ... }
}
</code></pre>
<p><strong>性能对比</strong>（渲染 10,000 行数据）：</p>

























<table><thead><tr><th>指标</th><th>普通渲染</th><th>虚拟滚动</th></tr></thead><tbody><tr><td>首屏时间</td><td>~3200ms</td><td>~45ms</td></tr><tr><td>DOM 节点数</td><td>10,000+</td><td>~30</td></tr><tr><td>内存占用</td><td>~50MB</td><td>~2MB</td></tr></tbody></table>
<h3 data-id="heading-25">8.2 WeakMap vs Map：内存管理的深层思考</h3>
<p>在 <code>selectedRowsMap</code> 的实现中，我们选择了 <code>Map</code> 而非 <code>WeakMap</code>，这是经过深思熟虑的决定：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ✅ 当前方案：使用 shallowRef + Map</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>, <span class="hljs-title class_">TableRow</span>&gt;())

<span class="hljs-comment">// ❓ 为什么不用 WeakMap？</span>
<span class="hljs-comment">// const selectedRowsMap = shallowRef(new WeakMap&lt;TableRow, boolean&gt;())</span>
</code></pre>
<p><strong>不选择 WeakMap 的原因</strong>：</p>






























<table><thead><tr><th>特性</th><th>Map</th><th>WeakMap</th></tr></thead><tbody><tr><td>键类型</td><td>任意类型</td><td>仅对象</td></tr><tr><td>可枚举</td><td>✅ 支持</td><td>✖️ 不支持</td></tr><tr><td>size 属性</td><td>✅ 有</td><td>✖️ 无</td></tr><tr><td>GC 回收</td><td>手动管理</td><td>自动回收</td></tr></tbody></table>
<p><strong>关键问题</strong>：</p>
<ol>
<li>我们需要用 <code>rowKey</code>（字符串/数字）作为键，WeakMap 只接受对象作为键</li>
<li>我们需要遍历所有选中行（<code>getAllSelectedRows</code>），WeakMap 不可枚举</li>
<li>我们需要知道选中数量，WeakMap 没有 <code>size</code> 属性</li>
</ol>
<p><strong>内存泄漏防护</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 通过 shallowRef 包装，确保随组件生命周期管理</span>
<span class="hljs-keyword">const</span> selectedRowsMap = <span class="hljs-title function_">shallowRef</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>())

<span class="hljs-comment">// 组件卸载时，shallowRef 的引用释放，Map 自然被 GC 回收</span>
<span class="hljs-comment">// 无需手动清理</span>
</code></pre>
<h3 data-id="heading-26">8.3 Vue 3.4 defineModel：简化双向绑定</h3>
<p>Vue 3.4 稳定版引入的 <code>defineModel</code> 宏可以大幅简化双向绑定的代码：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// ❌ Vue 3.4 之前的写法</span>
<span class="hljs-keyword">const</span> props = defineProps&lt;{ <span class="hljs-attr">selectedRowKeys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[] }&gt;()
<span class="hljs-keyword">const</span> emit = defineEmits&lt;{ <span class="hljs-string">'update:selectedRowKeys'</span>: [<span class="hljs-attr">keys</span>: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]] }&gt;()

<span class="hljs-comment">// 需要手动同步</span>
<span class="hljs-title function_">watch</span>(<span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">selectedRowKeys</span>, <span class="hljs-function">(<span class="hljs-params">newKeys</span>) =&gt;</span> {
  internalSelectedKeys.<span class="hljs-property">value</span> = [...newKeys]
})

<span class="hljs-keyword">function</span> <span class="hljs-title function_">updateSelection</span>(<span class="hljs-params">keys: (<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]</span>) {
  <span class="hljs-title function_">emit</span>(<span class="hljs-string">'update:selectedRowKeys'</span>, keys)
}

<span class="hljs-comment">// ✅ Vue 3.4+ 使用 defineModel</span>
<span class="hljs-keyword">const</span> selectedRowKeys = defineModel&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;(<span class="hljs-string">'selectedRowKeys'</span>, {
  <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
})

<span class="hljs-keyword">const</span> expandedRowKeys = defineModel&lt;(<span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>)[]&gt;(<span class="hljs-string">'expandedRowKeys'</span>, {
  <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> []
})

<span class="hljs-comment">// 直接修改即可触发更新，无需手动 emit</span>
selectedRowKeys.<span class="hljs-property">value</span> = [...newKeys]
</code></pre>
<p><strong>优势</strong>：</p>
<ul>
<li>减少约 60% 的模板代码</li>
<li>自动处理 props 和 emit 的同步</li>
<li>更直观的双向绑定语义</li>
</ul>
<h3 data-id="heading-27">8.4 Vue Vapor Mode：无虚拟 DOM 的未来</h3>
<p>Vue 3.6 alpha 引入了实验性的 <strong>Vapor Mode</strong>，它完全跳过虚拟 DOM，直接生成 DOM 操作代码：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 启用 Vapor Mode：只需添加 vapor 关键字 --&gt;
&lt;script setup vapor&gt;
import { ref } from 'vue'
const count = ref(0)
&lt;/script&gt;

&lt;template&gt;
  &lt;button @click="count++"&gt;{{ count }}&lt;/button&gt;
&lt;/template&gt;
</code></pre>
<p><strong>Vapor Mode 的优势</strong>：</p>
<ul>
<li>🚀 更小的包体积（无 VDOM 运行时）</li>
<li>⚡ 更快的渲染（无 diff/patch 开销）</li>
<li>📊 更低的内存占用</li>
</ul>
<p><strong>兼容性设计</strong>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// CmcCardTable 的 Vapor Mode 兼容性设计</span>
<span class="hljs-keyword">import</span> { vaporInteropPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-comment">// 在 VDOM 应用中使用 Vapor 组件</span>
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)
app.<span class="hljs-title function_">use</span>(vaporInteropPlugin)  <span class="hljs-comment">// 启用互操作插件</span>
app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)

<span class="hljs-comment">// CmcCardTable 可以渐进式迁移到 Vapor Mode</span>
<span class="hljs-comment">// 1. 将性能关键的子组件转为 Vapor</span>
<span class="hljs-comment">// 2. 与现有 VDOM 组件无缝共存</span>
</code></pre>
<p><strong>迁移指南</strong>：</p>






























<table><thead><tr><th>特性</th><th>支持状态</th><th>说明</th></tr></thead><tbody><tr><td>Composition API</td><td>✅ 完全支持</td><td>唯一支持的 API 风格</td></tr><tr><td>Options API</td><td>✖️ 不支持</td><td>需迁移到 Composition API</td></tr><tr><td><code>&lt;Transition&gt;</code></td><td>✖️ 暂不支持</td><td>后续版本支持</td></tr><tr><td>Element Plus</td><td>✅ 支持</td><td>需配合 vaporInteropPlugin</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-28">九、总结与展望</h2>
<p>通过 <code>CmcCardTable</code> 组件的设计实践，我们验证了以下技术方案的可行性：</p>
<ol>
<li><strong>Composables 模式</strong> 是组织复杂组件逻辑的最佳实践</li>
<li><strong>分层响应式策略</strong> 能显著提升大数据量场景下的性能</li>
<li><strong>完备的类型定义</strong> 是提升开发体验的关键</li>
<li><strong>可测试性设计</strong> 应贯穿组件开发的始终</li>
<li><strong>虚拟滚动</strong> 是突破大数据量渲染瓶颈的关键技术</li>
</ol>
<p><strong>已完成的优化</strong>：</p>
<ul>
<li>✅ 虚拟滚动 <code>useVirtualScroll</code> composable</li>
<li>✅ <code>shallowRef</code> + <code>Map</code> 内存管理优化</li>
<li>✅ 部分行禁用选择 <code>selectable</code> 支持</li>
</ul>
<p><strong>未来计划</strong>：</p>
<ul>
<li>🔮 迁移到 Vue 3.4 <code>defineModel</code> 简化双向绑定</li>
<li>🔮 探索 Vapor Mode 零虚拟 DOM 方案</li>
<li>🔮 实现列的拖拽排序与宽度调整</li>
<li>🔮 支持动态行高的虚拟滚动</li>
</ul>
<hr/>
<h2 data-id="heading-29">参考资料</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Freusability%2Fcomposables.html" target="_blank" title="https://vuejs.org/guide/reusability/composables.html" ref="nofollow noopener noreferrer">Vue 3 Composition API 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvueuse.org%2F" target="_blank" title="https://vueuse.org/" ref="nofollow noopener noreferrer">VueUse - Collection of Vue Composition Utilities</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Felement-plus%2Felement-plus" target="_blank" title="https://github.com/element-plus/element-plus" ref="nofollow noopener noreferrer">Element Plus Table 源码</a></li>
</ul>
<hr/>
<blockquote>
<p>如果这篇文章对你有帮助，欢迎点赞收藏 ⭐️，你的支持是我持续输出的动力！</p>
<p>有任何问题欢迎在评论区交流讨论 💬</p>
</blockquote>
<p><strong>关于作者</strong>：专注于企业级 Vue 3 应用开发，热衷于组件设计与性能优化。</p>
<hr/>
<p><em>本文首发于掘金，转载请注明出处。</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入理解ThreadLocal]]></title>    <link>https://juejin.cn/post/7583892482599321615</link>    <guid>https://juejin.cn/post/7583892482599321615</guid>    <pubDate>2025-12-16T01:26:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583892482599321615" data-draft-id="7583955708317696000" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入理解ThreadLocal"/> <meta itemprop="keywords" content="Java,Android,源码"/> <meta itemprop="datePublished" content="2025-12-16T01:26:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="愤怒的代码"/> <meta itemprop="url" content="https://juejin.cn/user/4125023358426190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入理解ThreadLocal
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4125023358426190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    愤怒的代码
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:26:52.000Z" title="Tue Dec 16 2025 01:26:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><code>ThreadLocal</code> 是 Java 提供的一个机制，但在 Android 开发，尤其是在理解 <code>Looper</code> 和性能优化时，它扮演着至关重要的角色。</p>
<h3 data-id="heading-0">0x00. <code>ThreadLocal</code> 的核心作用和设计目标</h3>
<h4 data-id="heading-1">核心作用：线程局部变量</h4>
<p><code>ThreadLocal</code> 顾名思义，是<strong>线程的局部变量</strong>。它为每个使用该变量的线程都提供了一个独立的、隔离的变量副本。</p>
<ul>
<li><strong>隔离性：</strong> 当多个线程访问同一个 <code>ThreadLocal</code> 实例时，每个线程看到和操作的都是自己的变量副本，彼此之间互不干扰。</li>
<li><strong>线程安全：</strong> 由于每个线程都有自己的副本，因此天然解决了多线程访问共享变量时的同步问题，<strong>无需使用 <code>synchronized</code> 等锁机制</strong>，从而提升了并发性能。</li>
</ul>
<blockquote>
<p><strong>注意：</strong> <code>ThreadLocal</code> 本身不存储数据，它只是一个访问键（Key）。数据存储在每个线程内部的一个名为 <code>ThreadLocalMap</code> 的结构中。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">0x01. <code>ThreadLocal</code> 的底层原理：<code>ThreadLocalMap</code></h3>
<p>要理解 <code>ThreadLocal</code> 的机制，关键在于理解 <code>Thread</code> 对象内部的一个隐秘字段：</p>
<ol>
<li>
<p><strong>数据存储在哪？</strong></p>
<ul>
<li>每个 <code>java.lang.Thread</code> 对象内部都有一个特殊的成员变量，叫做 <code>ThreadLocal.ThreadLocalMap</code>（注意，这个 Map 是 <code>ThreadLocal</code> 的内部类，但它属于 <code>Thread</code> 实例）。</li>
<li>当你调用 <code>ThreadLocal.set(value)</code> 时，数据实际上是以 <code>(thisThreadLocalInstance, value)</code> 的形式存入了当前线程的 <code>ThreadLocalMap</code> 中。</li>
</ul>
</li>
<li>
<p><strong><code>ThreadLocalMap</code> 的结构：</strong></p>
<ul>
<li><code>ThreadLocalMap</code> 并不是一个普通的 <code>HashMap</code>。它的键（Key）是**弱引用（Weak Reference）**指向 <code>ThreadLocal</code> 对象本身，值（Value）是你要存储的数据。</li>
</ul>
</li>
</ol>
<h3 data-id="heading-3">0x02. <code>ThreadLocal</code> 在 Android 源码中的应用</h3>
<hr/>
<p><code>ThreadLocal</code> 最著名的应用就是实现 Android 的<strong>消息循环机制</strong>：</p>
<h4 data-id="heading-4">A. 实现 <code>Looper</code> 的单例特性</h4>
<p>我们知道，一个线程只能有一个 <code>Looper</code>。<code>ThreadLocal</code> 是如何保证这一点的？</p>
<ul>
<li>
<p>在 <code>Looper</code> 类中，有一个静态的 <code>ThreadLocal</code> 变量：</p>
<p><code>Looper</code>中定义了 <code>sThreadLocal</code> 静态变量</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> ThreadLocal&lt;Looper&gt; sThreadLocal = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;Looper&gt;();
</code></pre>
</li>
<li>
<p><strong><code>Looper.prepare()</code> 的逻辑：</strong></p>
<ol>
<li>调用 <code>sThreadLocal.get()</code> 检查当前线程是否已有 <code>Looper</code>。</li>
<li>如果发现当前线程已经有了 <code>Looper</code>（即 <code>get()</code> 不为空），则抛出异常，强制保证单例。</li>
<li>如果没有，则创建一个新的 <code>Looper</code> 实例，并通过 <code>sThreadLocal.set(newLooper)</code> 将其存入当前线程的 <code>ThreadLocalMap</code> 中。</li>
</ol>
</li>
</ul>
<p>通过这种方式，<code>Looper</code> 机制完美地利用了 <code>ThreadLocal</code> 的隔离性，实现了<strong>线程内的单例</strong>。</p>
<p><code>Looper</code> 代码片段</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">()</span> {
    prepare(<span class="hljs-literal">true</span>);
}

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">prepare</span><span class="hljs-params">(<span class="hljs-type">boolean</span> quitAllowed)</span> {
    <span class="hljs-keyword">if</span> (sThreadLocal.get() != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"Only one Looper may be created per thread"</span>);
    }
    sThreadLocal.set(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Looper</span>(quitAllowed));
}

<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(T value)</span> {
    <span class="hljs-comment">// 获取当前线程实例</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-comment">// 从当前线程中获取 ThreadLocalMap</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>)
        map.set(<span class="hljs-built_in">this</span>, value); <span class="hljs-comment">// ThreadLocal 当作key 把value 保存在 map 中</span>
    <span class="hljs-keyword">else</span>
        createMap(t, value);
}

</code></pre>
<p><code>ThreadLocal</code>代码片段</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 获取当前线程实例</span>
    <span class="hljs-type">Thread</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> Thread.currentThread();
    <span class="hljs-comment">// 从当前线程中获取 ThreadLocalMap 对象</span>
    <span class="hljs-type">ThreadLocalMap</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> getMap(t);
    <span class="hljs-keyword">if</span> (map != <span class="hljs-literal">null</span>) {
        <span class="hljs-comment">// this 就是 ThreadLocal，它是一个 Key</span>
        ThreadLocalMap.<span class="hljs-type">Entry</span> <span class="hljs-variable">e</span> <span class="hljs-operator">=</span> map.getEntry(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>) {
            <span class="hljs-meta">@SuppressWarnings("unchecked")</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> (T)e.value;
            <span class="hljs-keyword">return</span> result;
        }
    }
    <span class="hljs-keyword">return</span> setInitialValue();
}

<span class="hljs-comment">// 从 Thread 实例中获取 threadLocals 对象</span>
ThreadLocalMap <span class="hljs-title function_">getMap</span><span class="hljs-params">(Thread t)</span> {
    <span class="hljs-keyword">return</span> t.threadLocals;
}

</code></pre>
<h4 data-id="heading-5">B. 性能优化：避免参数传递</h4>
<p><code>ThreadLocal</code> 可以用来在同一线程内的不同方法或模块之间共享数据，而无需层层传递参数。</p>
<ul>
<li>例如，在一个复杂的 IO 操作流程中，你可以把数据库连接对象存入 <code>ThreadLocal</code>，流程中任何地方都可以直接 <code>get()</code> 拿到，避免了方法签名膨胀。</li>
</ul>
<hr/>
<h3 data-id="heading-6">0x03. 内存泄露风险</h3>
<p>使用 <code>ThreadLocal</code> <strong>最危险的陷阱是内存泄露</strong>，尤其是在 Android 这种长生命周期的环境（如主线程）中。</p>
<h4 data-id="heading-7">A. 风险分析</h4>
<ol>
<li>
<p><strong><code>ThreadLocalMap</code> 的键是弱引用 (<code>WeakReference&lt;ThreadLocal&gt;</code>)。</strong></p>
</li>
<li>
<p><strong><code>ThreadLocalMap</code> 的值是强引用 (<code>Value</code>)。</strong></p>
</li>
<li>
<p>如果线程一直存活（例如主线程），但外部没有引用指向 <code>ThreadLocal</code> 实例，那么：</p>
<ul>
<li>外部的 <code>ThreadLocal</code> 对象会被 GC 回收（因为是弱引用）。</li>
<li><strong>但存储在 <code>ThreadLocalMap</code> 里的 Value 仍然被 Map 强引用，无法被回收。</strong></li>
<li>键（Key）变成了 <code>null</code>，值（Value）还在，导致内存泄露。</li>
</ul>
</li>
</ol>
<p><code>ThreadLocalMap</code>源码片段中可以看到它的 <code>Entry</code> 是一个弱引用</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadLocalMap</span> {

    <span class="hljs-comment">/**
     * The entries in this hash map extend WeakReference, using
     * its main ref field as the key (which is always a
     * ThreadLocal object).  Note that null keys (i.e. entry.get()
     * == null) mean that the key is no longer referenced, so the
     * entry can be expunged from table.  Such entries are referred to
     * as "stale entries" in the code that follows.
     */</span>
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Entry</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">WeakReference</span>&lt;ThreadLocal&lt;?&gt;&gt; {
        <span class="hljs-comment">/** The value associated with this ThreadLocal. */</span>
        Object value;

        Entry(ThreadLocal&lt;?&gt; k, Object v) {
            <span class="hljs-built_in">super</span>(k);
            value = v;
        }
    }
    ....
}    
</code></pre>
<h4 data-id="heading-8">B. 解决方案</h4>
<p>为了避免内存泄露，<strong>使用完 <code>ThreadLocal</code> 后，务必调用 <code>ThreadLocal.remove()</code> 方法手动清除存储在 Map 中的 Value。</strong></p>
<pre><code class="hljs language-Kotlin" lang="Kotlin"><span class="hljs-comment">// 错误示例：可能导致内存泄露</span>
<span class="hljs-keyword">val</span> localData = ThreadLocal&lt;HeavyObject&gt;()
localData.<span class="hljs-keyword">set</span>(HeavyObject()) 
<span class="hljs-comment">// ... 使用 localData ...</span>
<span class="hljs-comment">// 忘记调用 remove()</span>

<span class="hljs-comment">// 正确做法：</span>
<span class="hljs-keyword">val</span> localData = ThreadLocal&lt;HeavyObject&gt;()
<span class="hljs-keyword">try</span> {
    localData.<span class="hljs-keyword">set</span>(HeavyObject()) 
    <span class="hljs-comment">// ... 使用 localData ...</span>
} <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">// 保证在任何情况下都执行清除操作</span>
    localData.remove() 
}
</code></pre>
<h3 data-id="heading-9">0x04. 总结</h3>
<ul>
<li><strong>作用：</strong> 为每个线程提供独立的变量副本，实现线程安全。</li>
<li><strong>原理：</strong> 数据存储在每个线程内部的 <code>ThreadLocalMap</code> 中。</li>
<li><strong>应用：</strong> Android 中用于实现 <code>Looper</code> 的线程内单例。</li>
<li><strong>风险：</strong> 必须调用 <code>remove()</code>，否则可能导致内存泄露。</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[使用 pnpm + Workspaces 构建 Monorepo 的完整指南]]></title>    <link>https://juejin.cn/post/7583970267132821510</link>    <guid>https://juejin.cn/post/7583970267132821510</guid>    <pubDate>2025-12-16T02:05:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583970267132821510" data-draft-id="7583980250733232191" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="使用 pnpm + Workspaces 构建 Monorepo 的完整指南"/> <meta itemprop="keywords" content="前端,JavaScript,Vue.js"/> <meta itemprop="datePublished" content="2025-12-16T02:05:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="NolanKy"/> <meta itemprop="url" content="https://juejin.cn/user/2841599197616894"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            使用 pnpm + Workspaces 构建 Monorepo 的完整指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2841599197616894/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    NolanKy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T02:05:01.000Z" title="Tue Dec 16 2025 02:05:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、核心概念：pnpm Workspace</h2>
<p>pnpm 内置了对 Monorepo（单一代码仓库）的原生支持，通过 <strong>Workspace（工作区）</strong> ​ 机制实现。Workspace 允许你在一个仓库中管理多个相互关联但独立的项目（包），并智能地处理它们之间的依赖关系。</p>
<h2 data-id="heading-1">二、将普通仓库转变为 Monorepo 的步骤</h2>
<h3 data-id="heading-2">步骤 1：初始化项目结构</h3>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 创建项目根目录</span>
<span class="hljs-keyword">mkdir</span> <span class="hljs-keyword">my</span>-monorepo
cd <span class="hljs-keyword">my</span>-monorepo

<span class="hljs-comment"># 初始化根目录 package.json</span>
pnpm init
</code></pre>
<h3 data-id="heading-3">步骤 2：配置根目录 package.json</h3>
<p>修改根目录的 <code>package.json</code>，关键配置如下：</p>
<pre><code class="hljs language-ruby" lang="ruby">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"my-monorepo"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: <span class="hljs-literal">true</span>,  <span class="hljs-regexp">//</span> 必须设置为 <span class="hljs-literal">true</span>，避免误发布到 npm
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"pnpm -r run dev"</span>,      <span class="hljs-regexp">//</span> -r 表示递归执行所有子包
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"pnpm -r run build"</span>,
    <span class="hljs-string">"test"</span>: <span class="hljs-string">"pnpm -r run test"</span>
  },
  <span class="hljs-string">"keywords"</span>: [],
  <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,
  <span class="hljs-string">"license"</span>: <span class="hljs-string">"ISC"</span>
}
</code></pre>
<p><strong>重要说明</strong>：</p>
<ul>
<li><code>"private": true</code>是必须的，确保整个 Monorepo 不会被意外发布</li>
<li>可以移除 <code>main</code>、<code>test</code>等字段，因为根目录通常不包含业务代码</li>
</ul>
<h3 data-id="heading-4">步骤 3：创建 pnpm-workspace.yaml 配置文件</h3>
<p>在根目录创建 <code>pnpm-workspace.yaml</code>文件，这是 pnpm Workspace 的核心配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  <span class="hljs-comment"># packages 目录下的所有直接子目录</span>
  - <span class="hljs-string">'packages/*'</span>
  
  <span class="hljs-comment"># apps 目录下的所有直接子目录</span>
  - <span class="hljs-string">'apps/*'</span>
  
  <span class="hljs-comment"># components 目录下的所有层级子目录</span>
  - <span class="hljs-string">'components/**'</span>
  
  <span class="hljs-comment"># 排除包含 test 的目录</span>
  - <span class="hljs-string">'!**/test/**'</span>
</code></pre>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>packages/*</code>：匹配 <code>packages</code>目录下的所有一级子目录</li>
<li><code>apps/*</code>：匹配 <code>apps</code>目录下的所有一级子目录</li>
<li><code>components/**</code>：匹配 <code>components</code>目录下的所有层级子目录</li>
<li><code>!**/test/**</code>：排除所有包含 <code>test</code>的目录</li>
</ul>
<p>pnpm 中的两种配置方式</p>
<h4 data-id="heading-5">方式一：使用 <code>package.json</code>的 <code>workspaces</code>字段</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"my-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"workspaces"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"packages/*"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"apps/*"</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-6">方式二：使用 <code>pnpm-workspace.yaml</code>文件</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># pnpm-workspace.yaml</span>
packages:
  - <span class="hljs-string">'packages/*'</span>
  - <span class="hljs-string">'apps/*'</span>
  - <span class="hljs-string">'!**/test/**'</span>  <span class="hljs-comment"># 排除包含 test 的目录</span>
</code></pre>
<h4 data-id="heading-7">两种方式的优先级与兼容性</h4>
<ol>
<li>
<p><strong>pnpm 的读取顺序</strong>：</p>
<ul>
<li>优先读取 <code>pnpm-workspace.yaml</code></li>
<li>如果不存在，则读取 <code>package.json</code>中的 <code>workspaces</code>字段</li>
<li>如果两者都存在，<strong><code>pnpm-workspace.yaml</code>优先级更高</strong>​</li>
</ul>
</li>
<li>
<p><strong>推荐使用 <code>pnpm-workspace.yaml</code>的原因</strong>：</p>
<ul>
<li><strong>更丰富的配置选项</strong>：支持排除模式（<code>!**/test/**</code>）</li>
<li><strong>更好的可读性</strong>：YAML 格式更适合复杂配置</li>
<li><strong>工具兼容性</strong>：明确标识为 pnpm 工作区</li>
<li><strong>未来扩展性</strong>：pnpm 的新功能会优先在 YAML 配置中支持</li>
</ul>
</li>
</ol>
<h3 data-id="heading-8">步骤 4：创建子项目结构</h3>
<p>典型的 Monorepo 目录结构如下：</p>
<pre><code class="hljs language-csharp" lang="csharp">my-monorepo/
├── pnpm-workspace.yaml
├── package.json
├── pnpm-<span class="hljs-keyword">lock</span>.yaml
├── packages/
│   ├── shared-utils/     <span class="hljs-meta"># 共享工具库</span>
│   │   ├── package.json
│   │   └── src/
│   ├── ui-components/    <span class="hljs-meta"># UI 组件库</span>
│   │   ├── package.json
│   │   └── src/
│   └── core-lib/         <span class="hljs-meta"># 核心库</span>
│       ├── package.json
│       └── src/
├── apps/
│   ├── web-app/          <span class="hljs-meta"># 前端应用</span>
│   │   ├── package.json
│   │   └── src/
│   └── mobile-app/       <span class="hljs-meta"># 移动应用</span>
│       ├── package.json
│       └── src/
└── docs/                 <span class="hljs-meta"># 文档</span>
</code></pre>
<h3 data-id="heading-9">步骤 5：配置子项目的 package.json</h3>
<p>每个子项目都需要有自己的 <code>package.json</code>，关键配置如下： <strong>示例：共享工具库 (packages/shared-utils/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"@my-monorepo/shared-utils"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"main"</span>: <span class="hljs-string">"dist/index.js"</span>,
  <span class="hljs-string">"types"</span>: <span class="hljs-string">"dist/index.d.ts"</span>,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"tsc"</span>,
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"tsc --watch"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"lodash"</span>: <span class="hljs-string">"^4.17.21"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"typescript"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<p><strong>示例：前端应用 (apps/web-app/package.json)</strong></p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"web-app"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"scripts"</span>: {
    <span class="hljs-string">"dev"</span>: <span class="hljs-string">"vite"</span>,
    <span class="hljs-string">"build"</span>: <span class="hljs-string">"vite build"</span>,
    <span class="hljs-string">"preview"</span>: <span class="hljs-string">"vite preview"</span>
  },
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,  <span class="hljs-regexp">//</span> 关键：引用本地包
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@types/react"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"@types/react-dom"</span>: <span class="hljs-string">"^18.2.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-10">三、关键配置详解</h2>
<h3 data-id="heading-11">1. workspace:* 协议</h3>
<p>这是 pnpm Workspace 的核心特性，用于声明对本地其他包的依赖：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"@my-monorepo/shared-utils"</span>: <span class="hljs-string">"workspace:*"</span>,      <span class="hljs-regexp">//</span> 使用最新版本
    <span class="hljs-string">"@my-monorepo/ui-components"</span>: <span class="hljs-string">"workspace:^1.0.0"</span>, <span class="hljs-regexp">//</span> 指定版本范围
    <span class="hljs-string">"@my-monorepo/core-lib"</span>: <span class="hljs-string">"workspace:../packages/core-lib"</span> // 相对路径
  }
}
</code></pre>
<p><strong>作用</strong>：</p>
<ul>
<li>建立本地包之间的软链接，无需发布到 npm</li>
<li>修改本地包时，依赖它的项目能立即看到变化</li>
<li>确保所有包使用同一份依赖，避免重复安装</li>
</ul>
<h3 data-id="heading-12">2. 依赖安装与管理</h3>
<h4 data-id="heading-13">在根目录安装全局依赖（所有包共享）</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 安装到根目录，所有包共享</span>
pnpm <span class="hljs-keyword">add</span> typescript -w
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> typescript --workspace-root
</code></pre>
<h4 data-id="heading-14">为特定包安装依赖</h4>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 为 web-app 安装 react</span>
pnpm <span class="hljs-keyword">add</span> react --filter web-app
<span class="hljs-meta"># 或</span>
pnpm <span class="hljs-keyword">add</span> react -F web-app

<span class="hljs-meta"># 为多个包安装依赖</span>
pnpm <span class="hljs-keyword">add</span> axios --filter <span class="hljs-string">"web-app"</span> --filter <span class="hljs-string">"mobile-app"</span>
</code></pre>
<h4 data-id="heading-15">安装本地包依赖</h4>
<pre><code class="hljs language-sql" lang="sql"># 在 web<span class="hljs-operator">-</span>app 中安装 shared<span class="hljs-operator">-</span>utils
pnpm <span class="hljs-keyword">add</span> <span class="hljs-variable">@my</span><span class="hljs-operator">-</span>monorepo<span class="hljs-operator">/</span>shared<span class="hljs-operator">-</span>utils <span class="hljs-comment">--filter web-app</span>
</code></pre>
<h3 data-id="heading-16">3. 脚本执行</h3>
<h4 data-id="heading-17">在所有包中执行相同脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 递归执行所有包的 build 脚本</span>
pnpm -r run build

<span class="hljs-comment"># 递归执行所有包的 test 脚本</span>
pnpm -r run <span class="hljs-built_in">test</span>
</code></pre>
<h4 data-id="heading-18">在特定包中执行脚本</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 仅在 web-app 中执行 dev 脚本</span>
pnpm --filter web-app run dev

<span class="hljs-comment"># 使用包名（package.json 中的 name）</span>
pnpm -F @my-monorepo/shared-utils run build
</code></pre>
<h2 data-id="heading-19">四、完整示例：Vue 项目 Monorepo</h2>
<h3 data-id="heading-20">项目结构</h3>
<pre><code class="hljs language-lua" lang="lua">vue-monorepo/
├── pnpm-workspace.yaml
├── <span class="hljs-built_in">package</span>.json
├── packages/
│   ├── ui-lib/          # UI 组件库
│   │   ├── <span class="hljs-built_in">package</span>.json
│   │   ├── src/
│   │   └── vite.<span class="hljs-built_in">config</span>.ts
│   └── utils/           # 工具函数库
│       ├── <span class="hljs-built_in">package</span>.json
│       └── src/
└── apps/
    ├── admin/           # 后台管理系统
    │   ├── <span class="hljs-built_in">package</span>.json
    │   └── src/
    └── portal/          # 门户网站
        ├── <span class="hljs-built_in">package</span>.json
        └── src/
</code></pre>
<h3 data-id="heading-21">pnpm-workspace.yaml</h3>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-symbol">packages:</span>
  - <span class="hljs-comment">'packages/*'</span>
  - <span class="hljs-comment">'apps/*'</span>
</code></pre>
<h3 data-id="heading-22">根目录 package.json</h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vue-monorepo"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run dev"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"lint"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm -r run lint"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"typescript"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.0.0"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-23">包间依赖示例 (apps/admin/package.json)</h3>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"admin"</span>,
  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,
  <span class="hljs-string">"private"</span>: true,
  <span class="hljs-string">"dependencies"</span>: {
    <span class="hljs-string">"vue"</span>: <span class="hljs-string">"^3.3.0"</span>,
    <span class="hljs-string">"@vue-monorepo/ui-lib"</span>: <span class="hljs-string">"workspace:*"</span>,
    <span class="hljs-string">"@vue-monorepo/utils"</span>: <span class="hljs-string">"workspace:*"</span>
  },
  <span class="hljs-string">"devDependencies"</span>: {
    <span class="hljs-string">"@vitejs/plugin-vue"</span>: <span class="hljs-string">"^4.0.0"</span>,
    <span class="hljs-string">"vite"</span>: <span class="hljs-string">"^5.0.0"</span>
  }
}
</code></pre>
<h2 data-id="heading-24">五、最佳实践与注意事项</h2>
<h3 data-id="heading-25">1. 命名规范</h3>
<ul>
<li>根项目：使用项目总名称，如 <code>my-monorepo</code></li>
<li>子包：使用作用域名称，如 <code>@my-monorepo/ui-components</code></li>
<li>应用：使用描述性名称，如 <code>web-app</code>、<code>admin-console</code></li>
</ul>
<h3 data-id="heading-26">2. 依赖管理</h3>
<ul>
<li>公共依赖（如 TypeScript、ESLint）安装在根目录</li>
<li>业务依赖安装在各自包中</li>
<li>使用 <code>pnpm-lock.yaml</code>确保依赖一致性</li>
</ul>
<h3 data-id="heading-27">3. 版本控制</h3>
<ul>
<li>提交 <code>pnpm-lock.yaml</code>到版本控制系统</li>
<li>考虑使用 Changesets 或 Lerna 进行版本管理和发布</li>
</ul>
<h3 data-id="heading-28">4. 性能优化</h3>
<ul>
<li>pnpm 使用硬链接和符号链接，节省磁盘空间</li>
<li>所有包共享同一份依赖，安装速度快</li>
<li>支持过滤命令，只构建需要的包</li>
</ul>
<h3 data-id="heading-29">5. CI/CD 集成</h3>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># GitHub Actions 示例</span>
<span class="hljs-attr">name:</span> <span class="hljs-string">CI</span>
<span class="hljs-attr">on:</span> [<span class="hljs-string">push</span>]
<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v3</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">pnpm/action-setup@v2</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">version:</span> <span class="hljs-number">8</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">18</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'pnpm'</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">install</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">run:</span> <span class="hljs-string">pnpm</span> <span class="hljs-string">-r</span> <span class="hljs-string">run</span> <span class="hljs-string">test</span>
</code></pre>
<h2 data-id="heading-30">六、常见问题解决</h2>
<h3 data-id="heading-31">1. 幽灵依赖问题</h3>
<p>确保所有依赖都在 <code>package.json</code>中明确声明，避免直接引用 <code>node_modules</code>中的未声明包。</p>
<h3 data-id="heading-32">2. 循环依赖检测</h3>
<p>使用 <code>pnpm why &lt;package-name&gt;</code>检查依赖关系，避免包之间的循环依赖。</p>
<h3 data-id="heading-33">3. 包找不到错误</h3>
<p>如果出现 <code>no matches found</code>错误，检查：</p>
<ul>
<li>包名是否正确（包括作用域）</li>
<li>包是否在 <code>pnpm-workspace.yaml</code>配置的目录中</li>
<li>包是否有正确的 <code>name</code>字段</li>
</ul>
<h3 data-id="heading-34">4. 跨包类型引用</h3>
<p>对于 TypeScript 项目，配置 <code>tsconfig.json</code>中的 <code>paths</code>：</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"compilerOptions"</span>: {
    <span class="hljs-string">"baseUrl"</span>: <span class="hljs-string">"."</span>,
    <span class="hljs-string">"paths"</span>: {
      <span class="hljs-string">"@my-monorepo/*"</span>: [<span class="hljs-string">"packages/*/src"</span>]
    }
  }
}
</code></pre>
<h2 data-id="heading-35">总结</h2>
<p>通过 pnpm + Workspaces 构建 Monorepo 的主要优势包括：</p>
<ol>
<li><strong>依赖共享</strong>：所有包共享同一份依赖，节省磁盘空间和安装时间</li>
<li><strong>原子提交</strong>：跨包变更可以一次性提交，保持一致性</li>
<li><strong>本地链接</strong>：使用 <code>workspace:*</code>协议，本地开发无需发布到 npm</li>
<li><strong>精细控制</strong>：支持按包过滤的命令执行</li>
<li><strong>统一管理</strong>：集中的 CI/CD 和代码质量检查</li>
</ol>
<p>这种架构特别适合中大型项目、微前端架构、组件库开发等场景，能显著提升开发效率和代码复用性。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🎯 Rect 中鼠标移动拾取元素可行性架构分析]]></title>    <link>https://juejin.cn/post/7583952017674190899</link>    <guid>https://juejin.cn/post/7583952017674190899</guid>    <pubDate>2025-12-16T01:46:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583952017674190899" data-draft-id="7583933107689701439" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🎯 Rect 中鼠标移动拾取元素可行性架构分析"/> <meta itemprop="keywords" content="前端,架构,React.js"/> <meta itemprop="datePublished" content="2025-12-16T01:46:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🎯 Rect 中鼠标移动拾取元素可行性架构分析
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T01:46:15.000Z" title="Tue Dec 16 2025 01:46:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body blockquote&gt;:first-child{margin-top:0}.markdown-body blockquote&gt;:last-child{margin-bottom:0}.markdown-body{overflow:hidden;line-height:1.75;font-size:15px;background-image:linear-gradient(90deg,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0),linear-gradient(1turn,rgba(72,42,10,.05) 5%,rgba(72,42,10,0) 0);background-size:20px 20px;background-position:50%;padding-top:0!important}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{position:relative;display:flex;border-bottom:5px solid #6d4e00;line-height:35px;letter-spacing:1px;font-size:25px;padding-left:25px;color:#664900;text-shadow:1px 1px 1px #8a6200;padding-bottom:0}.markdown-body h1:before{content:"";display:flex;position:absolute;left:0;top:3px;bottom:0;margin:auto;width:20px;height:20px;background-size:20px 20px;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC")}.markdown-body h2{position:relative;padding:0 0 0 20px;font-size:20px;font-weight:700;color:#614500}.markdown-body h2:before{content:"";position:absolute;top:3px;bottom:0;left:0;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAQlBMVEVHcEwlRnqtZBj76q4lRnolRnolRnolRnolRnokRnr/gGtrVUeLXDBKTl+hYSHasW7Ik0zs0JG4dCvUdEE0SW+rYxrLQJfjAAAACnRSTlMA////0H/xUaMi5MCoTwAACfVJREFUeNrtnQl3qygUgJ9GXAqosfL//+pgmgXwXmRNJGdu55xO+6rx8+6I8O9fehmGriN93zdN07bVXdpW/ih/SbpuGP6dXbpOXv7z2i3S9ISck2eQOnAhMHG64VQQbmrAaM4B05GmipaGdB+m6BNQPBXzMYtKR3EPbB/RS5eY4g+lIW9WBqnySCvVMrzRpqqs0g9nwVg5p1KYlHEchRT5bftp+y3n6xlQDjAkABtrKULU9f377ev+4/1/NiT+URRiZRhrcZP6WLa/Gq005BORaqXsdYEuHPIP798ZxSyt6d5sVfxJESRCsvB32lfXwhRjnUBGmKXNoJQe04VIASJqRC/9G7yDsyQMiloYz+0pHYghEoPISAGgpDSvHsCoMwmA0mfjSG5UOsqah2RodkljzMkhZZdamiEDB8+Nsbk9T04yGNljDXGOZZ6u0+Tj9DuvbyNJBuPO0ABtLNPlJtfZJ4CNNCWJoY8gddwxNpm9YrHh9DEkBoeMud4Kma8XRZaYpBJOYvg59U9wOsblMvmGrzQe30dyqFZ1dxPfO0FT5BOdw989THVs4q1TFk+iN4PMu7CaLpd4EJOExNaJLE4d0xQKYpJ0cY5Ozcwwu6WOu2cs9TUYxPB4b4fvLRzTUXbT1HH7y0BnB0j6CAehkPFfFzd1TMsi6sU1/P4VM9NiISHBlYnBMR+kad075sXlmMehj1twnfTUqJH4GJfqIKte7S72emPnHbdiYHIB0e6ATjKq1UoTaFh6wBL2csMIVo9fH/v6QRHAgoxrOHQQxG/36tC1ODmGOeBGBRmXalgcdhDQ1xF1vI6a3DF2d4r7G1enOUgNOshlFq7qUCxrca9ldiCam7ilxRbP6JbOYsYtfLFmkcXEgLG1DN/6eroxHjqh5bh+Uw27e1oWVK7pN+AqwzUcq/UYTPw8nWufLFBHN2zcxLRYlmGPs6rA2Wy0uJe/E7TknbHIa1WH1bLA8DAj3JpxET+FCNCWZ5uNT6jxTPZK/1mXoCBeKlGLRT2lP69XN3XdqqCojKX1ZVda6iD2McjeXSHa0I+AHd2InGAJgjRVM6gOBfygDrarRJnho6eQBbrns+HkcNUCWtYClJa66qFgPbqqZEBTCOAgRqxCOhQBWpZeIC6QBq91hEoI5unTjsMsK9DCFigY9WNn19hgVCrELalrTw6WnYMYzjHhQ2/7G2xTx1HvwpzSe4cVi5ORQQwMW9+72FU5L4gGsa6Yu1RcDeIhs64Qs8izt0vGH+n9/IKaIlYpM2UqkYOrwwq5CgBjWpyGtxaonxe4KaJ3hx+7O0HaqVkxLBPj8FmBVmjNevIUFhUuDmMq5NDV9RwyPe/95IvxAhG7ymqxHGE5sZJL2kPLUhUinkXfrnFwGFwXD99djNLSFh/meXEb2B6Oyiwm0I7BC+OlTlOVPk9K8CIYzu5YHwKDTI6XAo5lz3WEqEXwQRKhh5cyLa6D81P4PXBw984as9YaGXHwx4Ba8rmOldUat/BHt9cQ38AaljnBdCJqs60OcXVDJZP//ZwSWtV9FpHNtgg22KuYx/U2tB5Mcp1TYOiphNhiFjgWeJ3DL2OZpuuUisIoUyzZEJ76I+LmyqWdv8LwnEiwMYczihjxeqtBsuFJSTg2oD1ETQx4v6D1VleSZW1xCwvAfVGWpQ069kgrQksAUW2rReYzsboIjSABuDQX0QJwB9cnZVgWVgE31vrklAJnEmVObykgYCk/VGX5OlpuKb5eiovUAvJ2tMstw0kIkNdpiSA91K6XA6K8CVCyr4PePhTo65q3DyX7OpTbSVk1PB62mhJ9HSpSqtKaESxsFRm0tLBVcvTV+vbBrLRK4hC7aitN9B0ZpX6vNMgjGIt5ZdmMv32KrmprD1afsPd4FEhThK0+WfTl3kpd482AGvG3jQdZK1+t8ireDswhofigRb3fxfI/4jj+xkffUX/1ccxxhEP9qyyBEH9Cx9vhf8TB7eiSpBHjZVSa4whQMJC1TqIR6q8RERtjOr2ID0yx3oYi0oAIvZCPz4eG64p3ObuREeOHUIR3MBVJwq9yll5P7KHdiPBOiOoRa/AjXz21J3k04l+i8OjErj4kaXWQiIVO/EvA+KLRAEnUVomtjPd6SvR3RLoeMT54nKFH1EqtkkEGFaQuTlSQrsxhRiOIt51S/Ho8B11+FUlwRaHnU4utEI38/mgSjRJ8PhWEtN6Z6WcncQOU4efjKoh3zfi7/+DfhPrwOZ9a/iYBiVJJxPlei3CqIDTYEqAPFow5/c71fAdVIwmo4n+cTIGbr2n9NULAE5ifcNNS63hvEOFk0wxYnICBBZ0I9xERBVILF0uggNdxuOkR4S6ngvgPmArzHv4KpMKGQFjQ+Rw6q9dC6R6dgZaJF7RVWIH0BTY9h+fz0ohHOyLuy+He/hN4GUR3/RxcBx2f76izarI9CaXmzRmhNQuSfIgJkva5GzN6HJbhQxCNsDGDSh56plmef6sg2eaXPsYBt5W+H6VE6omG6hOS1w4hiTWiThbJ1YO+RSO1vrpMlomf6nhQGz0m7qT6W04XOUHyzhZ4rkG+0hxL66oDW9mnPWyL3TMmssxyQUwr01CHX7b2OvUIaqS48TnMtAoEQTQixJeAlDfSiGmk/l8jpwIpTyFqOfeNIHWBooC036ERtUQp2tm/CKT5jjySbxTlvUVj2yhjvyWDVL3yfKRojXwLSEWUp7q0PBAKPp7m5YGoT3WH7wAZ1BeOywNZv3Gak/LIqriwxbQ5jaTcsEW1eb+FvoWo+zr5V/IUOvNtsapU2zJXSyj0xVB13sPfq0kkZA7dubIIKXIlJ8Cy7u+BN22RVcr+peOuxHdcBbA04FAVmEoEtO5vX55K4KVZS1QJvBBzU1rgUl8JapBNYIowLoZtD9NWRTWKqqe36L48BSz8QPH9epqqIDehlh2UuqocEmrdV7AvhuRoM74m80yeDIEX3ppreNN235FxV58DNjhswn5K8zK21+5ctjut6NmUIoy9tVvitnHr2VDM3ahtW8KQ/Vbsp9GGiWHfk8skyTSFz9/HdxhHe4uR/RxX/mG1SGXwypcDJNmCMfucZ/C1CuCQUbiBUDYbe7tiRkZX8GIat50d+wqR1fdN7ygGzrHrcN4kGFHK02cil5M6INgQVsvnNz77T5PqUFYJJInYmIBplJfP5On4eiOwYfhuCD44oLyYVs43rI1rk3H7usttzq8Qo3j84vavN9mOkAeuq8dHEd9NtCVKX51Oen+MM6IEYvz5StOehKLpIjD+nKU5AQWJpLizdB+1sb5LQvFRxbSJVGHmSdK/0WWaPguEYmcSJ68aWkK6rAw6jwSSCmrTWVHT96R7HwHANEgqybVJL+E2vE2q7Uu91Gr73SbbNUvZDtiOlCeIv4r/AI+0XUwz1lvcAAAAAElFTkSuQmCC");background-size:100% 100%;background-repeat:no-repeat;width:15px;height:15px;margin:auto}.markdown-body h3{width:100%;text-align:left;margin:20px 10px 0 0;font-size:18px;font-weight:700;display:inline-block;padding-left:10px;padding-bottom:0;border-left:5px solid #8f6600;color:#614500}.markdown-body h4,.markdown-body h5,.markdown-body h6{font-weight:700;color:#a37400}.markdown-body h4{font-size:17px}.markdown-body h5,.markdown-body h6{display:flex;align-items:center}.markdown-body h5:after,.markdown-body h6:after{display:inline-block;border:2px solid #fff6e0;color:rgba(189,134,0,.5);border-radius:50%;text-align:center;margin-left:5px}.markdown-body h5{font-size:14px}.markdown-body h5:after{content:"5";width:15px;height:15px;line-height:15px;font-size:13px}.markdown-body h6{font-size:12px}.markdown-body h6:after{content:"6";width:13px;height:13px;line-height:13px;font-size:12px}.markdown-body p{color:#412c0c;letter-spacing:1px;font-weight:400;margin-bottom:16px}.markdown-body img{max-width:100%;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#755300;font-weight:400;border-bottom:1px solid #755300;font-weight:bolder;text-decoration:none}.markdown-body table{width:100%!important;margin:0;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border-spacing:0}.markdown-body table img{box-shadow:none}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body thead tr th{text-align:center}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;box-sizing:border-box;border:1px solid rgba(72,42,10,.1)}.markdown-body blockquote{position:relative;text-size-adjust:100%;line-height:25px;font-weight:400;border-radius:10px;font-style:normal;text-align:left;box-sizing:inherit;border:1px solid #ffd87a;background-color:rgba(189,134,0,.5);margin:20px 0;padding:20px}.markdown-body blockquote p{color:#fff6e0;letter-spacing:2px;margin:0}.markdown-body blockquote:after,.markdown-body blockquote:before{position:absolute;color:#cc9100;font-size:34px;font-weight:700}.markdown-body blockquote:before{content:"❝";top:8px;left:5px}.markdown-body blockquote:after{content:"❞";right:5px;bottom:-5px}.markdown-body strong{color:#c28a00;font-weight:bolder}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{color:#c28a00}.markdown-body em strong{font-style:normal;color:#c28a00;background-color:#8a6200}.markdown-body s{color:#c28a00}.markdown-body hr{border-top:1px solid #805b00}.markdown-body code,.markdown-body li code,.markdown-body p code{color:#996d00;background-color:rgba(130,98,0,.3)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit;color:#858585;font-family:bold;letter-spacing:1px}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection,.markdown-body img::selection{color:rgba(189,134,0,.5);background-color:#fff}.markdown-body a::selection,.markdown-body b::selection,.markdown-body del::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:transparent}.markdown-body pre&gt;code::selection{background-color:rgba(189,134,0,.5)}.markdown-body .math .math-inline::selection,.markdown-body blockquote::selection,.markdown-body ol::selection,.markdown-body p::selection,.markdown-body strong::selection,.markdown-body table::selection,.markdown-body ul::selection{background-color:rgba(189,134,0,.5)}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🧠 一、背景：什么是拾取（Picking）？</h2>
<p>“拾取”是指<strong>从用户交互的二维输入（鼠标、触控）映射到图形对象</strong>的过程。</p>
<p>想象你在一个可视化编辑器中移动鼠标指针——当光标悬浮在某个矩形（Rect）上，它高亮、变色、提示“我被选中了”，这就是 <em>拾取系统</em> 在背后施展魔法。✨</p>
<p>在二维场景中，拾取方案通常分三类：</p>





























<table><thead><tr><th>模式</th><th>原理</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td>几何拾取</td><td>在逻辑层判断 <code>(x,y)</code> 与各对象边界关系</td><td>精确、轻量</td><td>大量元素时耗性能</td></tr><tr><td>GPU颜色拾取（Color Picking）</td><td>每个对象渲染唯一颜色，对鼠标点取色</td><td>准确、独立于形状复杂度</td><td>需额外渲染缓冲区</td></tr><tr><td>空间索引拾取（QuadTree / BVH）</td><td>建立空间数据结构加速命中查找</td><td>高效、可扩展</td><td>实现复杂度高</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">🔬 二、可行性架构核心要点</h2>
<h3 data-id="heading-2">（1）数据层：结构化管理 Rect 元素</h3>
<p>首先要有“<strong>可索引、可快速命中</strong>”的数据结构。<br/>
假设每个矩形元素都有如下属性：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Rect</span> {
  <span class="hljs-keyword">constructor</span>(id, x, y, width, height) {
    <span class="hljs-keyword">this</span>.id = id;
    <span class="hljs-keyword">this</span>.bounds = { x, y, width, height };
    <span class="hljs-keyword">this</span>.state = <span class="hljs-string">"normal"</span>; <span class="hljs-comment">// normal, hover, selected</span>
  }

  contains(px, py) {
    <span class="hljs-keyword">return</span> (
      px &gt;= <span class="hljs-keyword">this</span>.bounds.x &amp;&amp;
      px &lt;= <span class="hljs-keyword">this</span>.bounds.x + <span class="hljs-keyword">this</span>.bounds.width &amp;&amp;
      py &gt;= <span class="hljs-keyword">this</span>.bounds.y &amp;&amp;
      py &lt;= <span class="hljs-keyword">this</span>.bounds.y + <span class="hljs-keyword">this</span>.bounds.height
    );
  }
}
</code></pre>
<p>在小规模下，我们可直接线性扫描，但在数千个Rect场景中，这会让GPU哭泣 😭。</p>
<hr/>
<h3 data-id="heading-3">（2）空间层：区域加速结构设计</h3>
<p>为解决性能问题，可引入 <strong>QuadTree（四叉树）</strong> 进行空间划分。</p>
<p><strong>原理</strong>：</p>
<ul>
<li>将画布平面递归划分为四个象限，每个象限存储矩形对象集合。</li>
<li>鼠标移动时，只查询当前象限节点。</li>
<li>空间复杂度：O(n)，查询复杂度：平均 O(log n)。</li>
</ul>
<p>伪代码演示：</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">QuadTree</span> {
  <span class="hljs-keyword">constructor</span>(boundary, capacity) {
    <span class="hljs-keyword">this</span>.boundary = boundary;  <span class="hljs-comment">// 当前节点矩形区域</span>
    <span class="hljs-keyword">this</span>.capacity = capacity;  <span class="hljs-comment">// 一个节点最多的元素数</span>
    <span class="hljs-keyword">this</span>.rects = [];
    <span class="hljs-keyword">this</span>.divided = <span class="hljs-literal">false</span>;
  }

  insert(rect) { <span class="hljs-comment">/* ...根据边界分裂插入逻辑... */</span> }

  query(point) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.boundary.contains(point)) <span class="hljs-keyword">return</span> [];
    let found = [];
    <span class="hljs-keyword">for</span> (let r of <span class="hljs-keyword">this</span>.rects) {
      <span class="hljs-keyword">if</span> (r.contains(point.x, point.y)) found.push(r);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.divided) {
      found.push(...<span class="hljs-keyword">this</span>.northwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.northeast.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southwest.query(point));
      found.push(...<span class="hljs-keyword">this</span>.southeast.query(point));
    }
    <span class="hljs-keyword">return</span> found;
  }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">（3）事件层：鼠标移动拾取流逻辑</h3>
<p>核心逻辑架构如下：</p>
<pre><code class="hljs language-scss" lang="scss">mousemove
   ↓
拾取管理器 (PickManager)
   ↓
空间查询 (QuadTree.query)
   ↓
检测命中对象 (Rect.contains)
   ↓
状态同步 (hover / leave / select)
   ↓
渲染层重新绘制目标区域
</code></pre>
<p>完整简化实现：</p>
<pre><code class="hljs language-ini" lang="ini">canvas.addEventListener("mousemove", (e) =&gt; {
  const <span class="hljs-attr">mouse</span> = { x: e.<span class="hljs-literal">off</span>setX, y: e.<span class="hljs-literal">off</span>setY }<span class="hljs-comment">;</span>
  const <span class="hljs-attr">hitRects</span> = quadTree.query(mouse)<span class="hljs-comment">;</span>

  const <span class="hljs-attr">newHover</span> = hitRects[<span class="hljs-number">0</span>] || null<span class="hljs-comment">;</span>
  if (currentHover !== newHover) {
    if (currentHover) <span class="hljs-attr">currentHover.state</span> = <span class="hljs-string">"normal"</span><span class="hljs-comment">;</span>
    if (newHover) <span class="hljs-attr">newHover.state</span> = <span class="hljs-string">"hover"</span><span class="hljs-comment">;</span>
    <span class="hljs-attr">currentHover</span> = newHover<span class="hljs-comment">;</span>
    render()<span class="hljs-comment">; // 局部或全局重绘</span>
  }
})<span class="hljs-comment">;</span>
</code></pre>
<p>这样一来，我们实现了：</p>
<ul>
<li>✅ <strong>实时拾取</strong></li>
<li>✅ <strong>高效区域查询</strong></li>
<li>✅ <strong>状态分离与渲染解耦</strong></li>
</ul>
<hr/>
<h3 data-id="heading-5">（4）渲染层：Canvas / WebGL 混合优化</h3>
<p>对于 Canvas 2D 场景，通常直接 redraw。<br/>
对于复杂 WebGL 场景，可采用双通道：</p>
<ol>
<li>主通道绘制可视内容；</li>
<li>拾取通道（off-screen buffer）绘制唯一颜色 ID；</li>
<li>鼠标事件时，通过 <code>gl.readPixels</code> 获取点击像素颜色 -&gt; 反查对象 ID。</li>
</ol>
<p>这种方案在大型交互式图形系统（如 Mapbox、Three.js）中用途极广。🌍</p>
<hr/>
<h2 data-id="heading-6">🧩 三、性能可行性分析</h2>



































<table><thead><tr><th align="left">指标</th><th align="left">几何拾取</th><th align="left">四叉树加速</th><th align="left">GPU颜色拾取</th></tr></thead><tbody><tr><td align="left">查询复杂度</td><td align="left">O(n)</td><td align="left">O(log n)</td><td align="left">O(1)</td></tr><tr><td align="left">渲染性能</td><td align="left">高CPU占用</td><td align="left">中等</td><td align="left">高GPU开销</td></tr><tr><td align="left">延迟</td><td align="left">极低</td><td align="left">低</td><td align="left">取决于颜色缓冲同步</td></tr><tr><td align="left">适用场景</td><td align="left">少量对象</td><td align="left">大量矩形元素</td><td align="left">复杂场景（3D/WebGL）</td></tr></tbody></table>
<p>结论：</p>
<blockquote>
<p>✅ 对于 Web 端二维 Rect 编辑器或设计工具，<strong>QuadTree + 几何拾取混合方案</strong> 是可行且优雅的架构选择。</p>
</blockquote>
<hr/>
<h2 data-id="heading-7">⚙️ 四、工程优化建议 🧪</h2>
<ol>
<li><strong>事件节流（throttle）</strong><br/>
避免每次 <code>mousemove</code> 都触发完整查询，可在 16ms（约60Hz）节流执行。</li>
<li><strong>局部重绘（Dirty Rect）</strong><br/>
只重绘状态变化区域，提升渲染性能。</li>
<li><strong>命中缓存（Hover Cache）</strong><br/>
若连续多帧命中同一元素，不重复查询，降低开销。</li>
<li><strong>交互优先级分层</strong><br/>
针对UI层、图形层分别拾取，按z-index排序命中结果。</li>
</ol>
<hr/>
<h2 data-id="heading-8">🪶 五、哲学层小结：拾取，不只是拾取</h2>
<p>“拾取”看似一个计算几何问题，实则是一次<strong>人与空间的映射关系重建</strong>。</p>
<p>当你从一块平面中精准捕捉一个矩形，背后是：</p>
<ul>
<li>一颗QuadTree在飞速判断区块；</li>
<li>一次GPU在色彩世界编码ID；</li>
<li>一份人机交互的默契在闪光。</li>
</ul>
<blockquote>
<p>工程的浪漫，藏在每一次 <code>mousemove</code> 中。💫</p>
</blockquote>
<hr/>
<h2 data-id="heading-9">🧭 总结</h2>






























<table><thead><tr><th>模块</th><th>关键技术</th><th>工程要点</th></tr></thead><tbody><tr><td>数据层</td><td>Rect 对象结构化</td><td>定义边界与状态</td></tr><tr><td>空间层</td><td>QuadTree or 网格划分</td><td>加速查询性能</td></tr><tr><td>事件层</td><td>MouseMove + 状态机</td><td>处理 hover/leave</td></tr><tr><td>渲染层</td><td>局部刷新 / GPU解码</td><td>平衡性能和准确性</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ruoyi-vue2集成DMN规则引擎实现Dish出餐决策]]></title>    <link>https://juejin.cn/post/7583983152324247578</link>    <guid>https://juejin.cn/post/7583983152324247578</guid>    <pubDate>2025-12-16T04:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583983152324247578" data-draft-id="7584014975242059786" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ruoyi-vue2集成DMN规则引擎实现Dish出餐决策"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T04:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="代码次位面"/> <meta itemprop="url" content="https://juejin.cn/user/1535333867720295"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ruoyi-vue2集成DMN规则引擎实现Dish出餐决策
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1535333867720295/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    代码次位面
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T04:43:11.000Z" title="Tue Dec 16 2025 04:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>DMN决策引擎的核心价值在于将复杂的业务决策逻辑从程序代码中剥离出来，通过标准化的模型进行可视化管理和执行。它在实战中的应用非常广泛，特别是在需要频繁调整业务规则、追求流程自动化与智能化的场景中。<br/>
具体应用场景有:
<strong>金融与风控</strong>​: 信贷审批、金融风险评估、反洗钱检查、
<strong>供应链与生产​</strong>: 保险定价、供应链管理、生产调度
<strong>营销与客户服务​</strong>: 客户分群、精准营销
<strong>其他创新场景​</strong>: 教育分班、智能餐饮</p>
<p>今天我们以一个经典的案例<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">智能餐饮</a>来讲解实战中的用法。</p>
<h3 data-id="heading-1">决策规则</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/895052af95564d8eb2271ef4c89a6d4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=3JR18VYKX7I108Jf45SMZ1JZ%2Fxo%3D" alt="dmn-dish.png" loading="lazy"/>
请点击这个<a href="https://link.juejin.cn?target=https%3A%2F%2Fdemo.bpmn.io%2Fdmn%2Fs%2Fcheck-order" target="_blank" title="https://demo.bpmn.io/dmn/s/check-order" ref="nofollow noopener noreferrer">Dish</a>查询规则建模，以下我们拆解一下这个DMN规则表的含义。</p>
<pre><code class="hljs language-text" lang="text">这个Dish决策表规则是根据当前的气温(tempeature)和日期类型(dayType)决策上什么餐食。主要有三个决策表构成， 核心是Dish-Decision表。
Season Dicision和Guest Count 以输出结果传递给Dish Decision决策表。

Season Dicision规则描述:
tempeature&gt;30, 得到season: Summary
tempeature&lt;10, 得到season: Winter
tempeature=[10..30] 得到season: Spring

Guest Count规则描述:
dayType="Weekday",  客人数量(guestCount): 4 
dayType="Holiday",  客人数量(guestCount): 10
dayType="Weekend",  客人数量(guestCount): 15


Dish-Decision规则描述: 
season=winter, guestCount&lt;=8, desiredDish='Spareribs'
season=winter, guestCount&gt;8, desiredDish='Pasta'
season=Summer, guestCount&gt;10, desiredDish='Light salad'
season=Summer, guestCount&lt;=10, desiredDish='Beans salad'
season=Spring, guestCount&lt;10, desiredDish='Stew'
season=Spring, guestCount&gt;=10, desiredDish='Steak'

</code></pre>
<h3 data-id="heading-2">流程建模</h3>
<ul>
<li>需求描述</li>
</ul>
<pre><code class="hljs language-text" lang="text">我们现在模拟一个流程， 用户输入当天的气温和日期类型(工作日，假期，周末)， 系统决策提供什么类型的餐食。
</code></pre>
<ul>
<li>模型结构</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7b5e4bba9b64ed3a2d5ba644641d5ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=HGn2I1TjLQywUdfRu%2F5VzkKOv%2Bg%3D" alt="dmn-model.png" loading="lazy"/></p>
<ul>
<li>模型定义</li>
</ul>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">bpmn:definitions</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attr">xmlns:bpmn</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/MODEL"</span> <span class="hljs-attr">xmlns:bpmndi</span>=<span class="hljs-string">"http://www.omg.org/spec/BPMN/20100524/DI"</span> <span class="hljs-attr">xmlns:dc</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DC"</span> <span class="hljs-attr">xmlns:camunda</span>=<span class="hljs-string">"http://camunda.org/schema/1.0/bpmn"</span> <span class="hljs-attr">xmlns:di</span>=<span class="hljs-string">"http://www.omg.org/spec/DD/20100524/DI"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Definitions_1"</span> <span class="hljs-attr">targetNamespace</span>=<span class="hljs-string">"http://bpmn.io/schema/bpmn"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:process</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Process_8887"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐决策"</span> <span class="hljs-attr">isExecutable</span>=<span class="hljs-string">"true"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:startEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_1i7sxll"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:startEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1rzb9vm"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Event_1i7sxll"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:userTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"就餐信息"</span> <span class="hljs-attr">camunda:assignee</span>=<span class="hljs-string">"${startUser}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formData</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"temperature"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"气温"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"long"</span> /&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">camunda:formField</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dayType"</span> <span class="hljs-attr">label</span>=<span class="hljs-string">"日期"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"string"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">camunda:formData</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:extensionElements</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1rzb9vm<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:userTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0v0zyja"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0fzwoab"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_08c0387"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:businessRuleTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"决策规则"</span> <span class="hljs-attr">camunda:resultVariable</span>=<span class="hljs-string">"desiredDish"</span> <span class="hljs-attr">camunda:decisionRef</span>=<span class="hljs-string">"dish-decision"</span> <span class="hljs-attr">camunda:mapDecisionResult</span>=<span class="hljs-string">"singleEntry"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0v0zyja<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:businessRuleTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_1ajvk92"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_08c0387"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:serviceTask</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"出餐程序"</span> <span class="hljs-attr">camunda:delegateExpression</span>=<span class="hljs-string">"${dishTask}"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_1ajvk92<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:outgoing</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:outgoing</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:serviceTask</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:endEvent</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Event_0x2ftot"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:incoming</span>&gt;</span>Flow_0r2ykge<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:incoming</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:endEvent</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">bpmn:sequenceFlow</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"Flow_0r2ykge"</span> <span class="hljs-attr">sourceRef</span>=<span class="hljs-string">"Activity_0jobe9d"</span> <span class="hljs-attr">targetRef</span>=<span class="hljs-string">"Event_0x2ftot"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:process</span>&gt;</span>
  
<span class="hljs-tag">&lt;/<span class="hljs-name">bpmn:definitions</span>&gt;</span>

</code></pre>
<ul>
<li>运行结果</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67b57d32b97c49bab66cb8ed12b30c82~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Luj56CB5qyh5L2N6Z2i:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766464990&amp;x-signature=0Npis5NkpVMvANRwGD7kQ7tUMYo%3D" alt="dmn-demo.png" loading="lazy"/></p>
<pre><code class="hljs language-text" lang="text">运行结果解释：
用户输入的气温15度，根据Season Dicision可以得到是=Spring
用户输入的日期类型weekday, 根据Guest Count可以得到客人数量=4

根据season=spring, guestCount=4，根据Dish Decision可以得到=stew 

完全符合预期！
</code></pre>
<p>访问<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ruoyiflow.com" target="_blank" title="https://www.ruoyiflow.com" ref="nofollow noopener noreferrer">若依工作流</a>点击顶部，演示系统立即体验!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VS Code 1.107 更新：多智能体协同与开发体验升级]]></title>    <link>https://juejin.cn/post/7584307642999537707</link>    <guid>https://juejin.cn/post/7584307642999537707</guid>    <pubDate>2025-12-16T11:13:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584307642999537707" data-draft-id="7584287969214070803" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VS Code 1.107 更新：多智能体协同与开发体验升级"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T11:13:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="码事漫谈"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VS Code 1.107 更新：多智能体协同与开发体验升级
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    码事漫谈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:13:08.000Z" title="Tue Dec 16 2025 11:13:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>2025 年 12 月 10 日，微软正式发布了 VS Code 1.107 版本，这次更新堪称年度最重磅！<strong>多智能体协同开发</strong>成为核心亮点，彻底重构了开发者与 AI 协作的模式。想象一下，你可以同时部署多个 AI 助手分工合作：一个负责代码审查，一个处理单元测试，还有一个在后台默默重构 legacy 代码——这不再是科幻场景！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d52455df60c84e1f86b5d74f160b2dbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=eNiPuTrnir8zmc9yYe7V5ZexRlY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">多智能体协同：开发效率的革命性突破</h2>
<h3 data-id="heading-1">Agent HQ：你的 AI 团队指挥中心</h3>
<p>VS Code 1.107 引入了全新的 <strong>Agent HQ</strong> 概念，将所有智能体统一管理。现在，GitHub Copilot 不再是孤军奋战，你可以创建、配置多个自定义智能体，并让它们协同完成复杂任务。</p>
<p>最惊艳的是 <strong>会话管理功能</strong>！所有智能体会话都整合到聊天视图中，你能一目了然地看到每个任务的状态、进度和文件更改统计。右键点击会话，还能选择在编辑器标签页或新窗口中打开，灵活度拉满。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0cf7048587a944f4871619e7940eb0db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=3yONxuXphV23qvW%2F%2FInRYHVFjNo%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-2">背景智能体：让 AI 在后台默默干活</h3>
<p><strong>背景智能体</strong> 彻底改变了工作流！以前用 Copilot 时，你必须等待它完成当前任务才能继续工作。现在，只需点击 <strong>Continue in</strong> 按钮，就能将任务无缝转移到后台智能体，自己继续专注于其他编码工作。</p>
<p>更厉害的是 <strong>Git 工作树隔离</strong> 技术！每个背景智能体都能在独立的 Git 工作树中运行，多个智能体同时修改代码也不会冲突。完成后，你可以一键将更改合并回主工作区，简直是多任务处理的终极解决方案！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/597edcc556e942c685e12af746a53c21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=ley2Th5PgZStx67vL9F2T8YHUWA%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">组织级智能体共享：团队协作新范式</h3>
<p>对于企业用户，1.107 版本带来了 <strong>组织级智能体共享</strong>（实验性功能）。管理员可以在 GitHub 组织级别定义智能体，团队成员无需手动导入就能直接使用。启用方法很简单：</p>
<ul>
<li>打开设置 <code>github.copilot.chat.customAgents.showOrganizationAndEnterpriseAgents</code></li>
<li>将其设为 <code>true</code></li>
</ul>
<p>从此，团队知识库、编码规范、最佳实践都能通过自定义智能体轻松传承，新人上手速度至少提升 50%！</p>
<h2 data-id="heading-4">聊天体验升级：AI 交互更自然</h2>
<h3 data-id="heading-5">语言模型管理：一键切换你的 "AI 大脑"</h3>
<p>面对越来越多的 AI 模型选择，VS Code 新增了 <strong>语言模型编辑器</strong>。在这里，你可以：</p>
<ul>
<li>查看所有可用模型的能力、上下文长度和计费信息</li>
<li>按提供商、能力（工具调用、视觉、智能体）筛选</li>
<li>隐藏不常用模型，让界面更清爽</li>
</ul>
<p>只需按下 <code>Ctrl+Shift+P</code> 并输入 <strong>Chat: Manage Language Models</strong>，就能打开这个强大的管理中心。</p>
<h3 data-id="heading-6">动态内容抓取：连 SPA 网站也能轻松解析</h3>
<p><code>#fetch</code> 工具现在支持 <strong>动态网页内容抓取</strong>！无论是 React、Vue 构建的单页应用，还是 Jira 这样的动态系统，都能准确获取内容。AI 现在能直接分析你公司的内部文档系统，回答问题不再局限于本地代码！</p>
<h3 data-id="heading-7">敏感文件编辑：安全与便捷的完美平衡</h3>
<p>修改 <code>package.json</code> 或 <code>settings.json</code> 这类敏感文件时，VS Code 会自动显示 <strong>差异对比视图</strong>，让你清晰看到每一处变更。再也不用担心 AI 误改配置导致项目崩溃了！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d09085ede19746aba3d4ca78bf7ac859~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=Cl9QvjzYaYeW1hVQhVwlO93C3FQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-8">编辑器体验优化：细节之处见真章</h2>
<h3 data-id="heading-9">按需悬停提示：告别干扰，专注编码</h3>
<p>终于可以告别烦人的自动悬停提示了！在设置中将 <code>editor.hover.enabled</code> 设为 <code>onKeyboardModifier</code>，悬停信息只会在按住特定修饰键时才显示。默认情况下：</p>
<ul>
<li>如果多光标修饰键是 <code>Ctrl/Cmd</code>，则按住 <code>Alt</code> 显示悬停</li>
<li>如果多光标修饰键是 <code>Alt</code>，则按住 <code>Ctrl</code> 显示悬停</li>
</ul>
<p>这个小改进，却能让编码专注度提升一个档次！</p>
<h3 data-id="heading-10">TypeScript 7.0 预览：原生重构，性能飞跃</h3>
<p>VS Code 1.107 带来了 <strong>TypeScript 7.0 预览支持</strong>！这个完全用原生代码重写的版本，性能提升堪称革命性。目前已支持自动导入、重命名和引用代码透镜，安装 <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarketplace.visualstudio.com%2Fitems%3FitemName%3DTypeScriptTeam.native-preview" target="_blank" title="https://marketplace.visualstudio.com/items?itemName=TypeScriptTeam.native-preview" ref="nofollow noopener noreferrer">TypeScript (Native Preview)</a> 扩展即可体验。</p>
<p>根据微软官方数据，TypeScript 7.0 的类型检查速度比 5.0 快 <strong>3-5 倍</strong>，大型项目的编译时间将大幅缩短！</p>
<h2 data-id="heading-11">终端增强：命令行效率倍增</h2>
<h3 data-id="heading-12">终端输出捕获：历史命令随时回溯</h3>
<p>现在，聊天中的终端命令输出会完整保存在 <code>xterm.js</code> 终端中，即使终端已关闭也能随时查看。这意味着你可以：</p>
<ul>
<li>对比不同命令的执行结果</li>
<li>追溯智能体运行的脚本输出</li>
<li>分享完整的错误信息给同事</li>
</ul>
<h3 data-id="heading-13">一键允许所有命令：信任智能体，解放双手</h3>
<p>在聊天中运行终端命令时，新增了 <strong>Allow All Commands in this Session</strong> 选项。启用后，当前会话中的所有终端命令都会自动批准，无需反复确认。对于信任的智能体，这能节省大量交互时间！</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/101390277e4a45e084db64c5abb4fbba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56CB5LqL5ryr6LCI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766488388&amp;x-signature=PHDwOisPS0GAyIAcTOLs9k4%2FqFM%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-14">企业级特性：安全与管理并重</h2>
<h3 data-id="heading-15">智能体工具权限控制：精细管理 AI 能力</h3>
<p>企业管理员现在可以通过 <code>chat.tools.eligibleForAutoApproval</code> 设置，精确控制哪些智能体工具允许自动批准。对于 <code>runTask</code> 这类高危操作，可以强制要求人工确认，安全性大大提升！</p>
<h3 data-id="heading-16">GitHub 企业策略支持：云端开发无缝衔接</h3>
<p>使用 GitHub Codespaces 的团队，现在能自动应用企业策略。无论是 MCP 注册表配置还是智能体权限，都能在云端开发环境中保持一致，开发体验无缝衔接。</p>
<h2 data-id="heading-17">总结：AI 驱动开发的未来已来</h2>
<p>VS Code 1.107 版本通过 <strong>多智能体协同</strong>、<strong>背景任务处理</strong> 和 <strong>组织级智能体共享</strong>，将 AI 辅助开发推向了新阶段。它不仅是工具的升级，更是开发范式的转变——从 "开发者使用 AI" 到 "开发者指挥 AI 团队"。</p>
<p>最令人兴奋的是，这仅仅是开始。随着 TypeScript 7.0 的成熟和更多 AI 能力的整合，VS Code 正在朝着 "开发者思维放大器" 的方向快速进化。</p>
<p>立即通过 <strong>帮助 &gt; 检查更新</strong> 升级到 1.107 版本，或访问 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2F" target="_blank" title="https://code.visualstudio.com/" ref="nofollow noopener noreferrer">VS Code 官网</a> 下载最新安装包，体验这场开发效率的革命！</p>
<blockquote>
<p><strong>提示</strong>：想抢先体验未来功能？可以安装 <a href="https://link.juejin.cn?target=https%3A%2F%2Fcode.visualstudio.com%2Finsiders%2F" target="_blank" title="https://code.visualstudio.com/insiders/" ref="nofollow noopener noreferrer">Insiders 版本</a>，每天获取最新更新！</p>
</blockquote>
<p>Happy Coding！🚀</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[智能开发环境下的 Diagram-as-Code 实践：MCP Mermaid 技术链路拆解]]></title>    <link>https://juejin.cn/post/7584094504630665225</link>    <guid>https://juejin.cn/post/7584094504630665225</guid>    <pubDate>2025-12-16T05:19:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584094504630665225" data-draft-id="7583991680749568027" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="智能开发环境下的 Diagram-as-Code 实践：MCP Mermaid 技术链路拆解"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-16T05:19:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Undoom"/> <meta itemprop="url" content="https://juejin.cn/user/4158824111150512"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            智能开发环境下的 Diagram-as-Code 实践：MCP Mermaid 技术链路拆解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4158824111150512/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Undoom
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T05:19:07.000Z" title="Tue Dec 16 2025 05:19:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>在软件工程、系统架构设计以及日常的项目管理中，图表（Diagrams）是信息传递的核心载体。传统的绘图方式往往需要借助 Visio、Draw.io 等图形化工具，通过繁琐的拖拽操作来完成。而 Mermaid.js 的出现，将“绘图”转变为“编写代码”，实现了图表的文本化与版本控制化。</p>
<p>随着大语言模型（LLM）的兴起，Model Context Protocol (MCP) 应运而生，它作为一种通用协议，连接了 AI 模型与外部工具。本文将详细拆解如何在蓝耘（Lanyun）MCP 广场中获取 Mermaid 服务，并将其集成到 Trae 编辑器中，通过自然语言指令自动生成专业的 Mermaid 图表代码。</p>
<h2 data-id="heading-1">第一阶段：MCP 服务的发现与获取</h2>
<p>MCP 协议的核心在于将工具标准化。在开始集成之前，首先需要在服务供应平台找到对应的工具模块。</p>
<h3 data-id="heading-2">1.1 服务搜索与定位</h3>
<p>在蓝耘 MCP 广场的搜索界面，通过输入关键词 <code>MCP Mermaid</code>，可以快速定位到目标工具。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f13cf4ecc614c88a2a0462351efa870~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=sScaZnF3S%2BJ3wC9ovFNoyHQ0vl4%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了搜索结果页面。可以看到界面中央清晰地列出了搜索到的 <code>MCP Mermaid</code> 卡片。这一步是整个流程的起点，意味着我们不仅仅是在寻找一个绘图工具，而是在寻找一个可以被 AI 调用的标准接口（Interface）。该卡片不仅显示了名称，通常还会包含该工具的版本信息、简要描述以及部署状态。</p>
<h3 data-id="heading-3">1.2 托管状态与配置生成</h3>
<p>点击进入工具详情页后，会发现该 MCP 服务呈现“托管”状态。这是一个关键的技术细节。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f9e962f55d143b19b499a163f369f40~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=wPzfgwEt4GrmeodgDqYYcO7ihMg%3D" alt="image.png" loading="lazy"/></p>
<p>如上图所示，界面显示了“这一款 mcp 已经被蓝耘给托管了”的信息。在传统的 MCP 部署中，用户通常需要在本地环境安装 Node.js 或 Python 运行时，并通过命令行（CLI）启动服务。而“托管”意味着服务运行在云端服务器上，用户无需消耗本地计算资源，也无需处理复杂的依赖安装问题。</p>
<p>界面右侧提供了“生成体验的 json 代码”按钮。这个 JSON 配置文件是连接本地编辑器（客户端）与云端 MCP 服务（服务端）的凭证。</p>
<h3 data-id="heading-4">1.3 配置代码的对比与选择</h3>
<p>在配置环节，通常存在两种模式：本地运行模式和远程 SSE 模式。</p>
<p><strong>官方提供的本地运行 JSON 代码：</strong></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mcp-mermaid"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"command"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"args"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"-y"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-string">"mcp-mermaid"</span>
      <span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>这段代码使用了 <code>npx</code> 命令，意味着它依赖用户本地的 npm 环境来动态下载并执行 <code>mcp-mermaid</code> 包。这种方式虽然灵活，但要求本地具备相应的开发环境，且受限于本地网络状况。</p>
<p><strong>蓝耘提供的托管 JSON 代码（推荐）：</strong></p>
<p>为了简化流程，我们选择蓝耘提供的基于 SSE（Server-Sent Events）的配置：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"MCP Mermaid"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"sse"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"http://d885cc9e62854df8b41f70b4caedd399.mcp.lanyun.net:8088/sse/MCP Mermaid"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294da1d190434d3eb678f344cbe83a18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=4oPD0ZeRa5wmvOqhdTE0wVRhGEg%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了实际获取到的 JSON 配置块。这里有两个关键字段需要解析：</p>
<ol>
<li><strong><code>type</code>: "sse"</strong>：指明了通信协议采用 Server-Sent Events。这是一种允许服务器主动向客户端推送数据的 HTTP 连接方式，非常适合 LLM 流式输出的场景。</li>
<li><strong><code>url</code></strong>：指向了蓝耘云平台的具体端口（8088）和路径。这个 URL 是服务的唯一访问入口，包含了身份验证或会话标识的哈希字符串。</li>
</ol>
<h2 data-id="heading-5">第二阶段：Trae 编辑器中的集成与配置</h2>
<p>获取配置信息后，下一步是在开发环境 Trae 中进行注册。Trae 是一款支持 MCP 协议的现代 IDE，允许用户通过修改配置文件来扩展 AI 的能力。</p>
<h3 data-id="heading-6">2.1 手动添加 MCP 服务</h3>
<p>打开 Trae 的设置或配置文件编辑界面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ac863df8ae1441fea18aad3a1dc04ba5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=SeeEsZhFq2SXshlvWSCCiFCmzho%3D" alt="image.png" loading="lazy"/></p>
<p>如上图所示，用户将之前复制的 JSON 代码块精准地粘贴到了 <code>mcpServers</code> 对象中。Trae 会读取这个配置文件，解析出服务的名称（MCP Mermaid）、类型（sse）以及连接地址。这一步相当于为 IDE 安装了一个新的“驱动程序”，使其具备了生成图表的能力。</p>
<h3 data-id="heading-7">2.2 服务加载状态验证</h3>
<p>配置保存后，IDE 会尝试与远程服务器建立连接。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1c9147a410de4423bff69fe70b237020~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=CG27N1N6YSUZP0UplCr73Cdo7SE%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了服务加载成功的状态。通常在界面上会有一个指示灯变为绿色，或者显示“Connected”/“已连接”字样。这表明 Trae 已经成功通过 HTTP 协议握手连接到了蓝耘托管的 Mermaid 服务端，随时准备接受指令。</p>
<h3 data-id="heading-8">2.3 创建专属智能体</h3>
<p>为了更好地管理上下文，建议创建一个专门用于绘图的智能体（Agent）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ab49bc311b84ea9806218c07d504df2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=GTinXF4PesCSFAKwJrZuf%2BISxM8%3D" alt="image.png" loading="lazy"/></p>
<p>在上图的操作界面中，用户勾选了刚刚添加的 <code>MCP Mermaid</code> 服务。这意味着该智能体在处理用户输入时，拥有了调用 Mermaid 工具的权限。通过这种方式，可以将通用的聊天功能与专业的绘图功能进行隔离，确保生成的代码更加纯粹和专业。</p>
<h2 data-id="heading-9">第三阶段：核心场景实战测试</h2>
<p>环境搭建完毕后，进入核心的实战测试阶段。我们将通过五个不同维度的测试用例，验证 AI 如何将自然语言转化为标准的 Mermaid 语法，并解析每一类图表的结构逻辑。</p>
<h3 data-id="heading-10">3.1 流程图（Flowchart）：逻辑判断与路径控制</h3>
<p><strong>测试场景</strong>：用户登录系统流程。
<strong>输入指令</strong>：“请帮我画一个用户登录系统的流程图：用户输入账号密码 -&gt; 系统验证。如果验证成功，跳转首页；如果验证失败，提示错误并返回登录页。”</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/82e2c8a441094e96a5518809cce17a4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=KSocmNThb1kM%2F5xFnD9D9ZG%2BeNs%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了 Trae 根据指令生成的流程图预览。可以看到，图表清晰地表达了条件分支逻辑。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TD;
    A[用户输入账号密码] --&gt; B[系统验证];
    B --&gt;|验证成功| C[跳转首页];
    B --&gt;|验证失败| D[提示错误并返回登录页];
</code></pre>
<ul>
<li><strong><code>graph TD;</code></strong>：声明这是一个从上到下（Top-Down）的图表。</li>
<li><strong>节点定义</strong>：<code>A[...]</code> 使用方括号定义了矩形节点。</li>
<li><strong>连接线</strong>：<code>--&gt;</code> 表示带箭头的实线。</li>
<li><strong>条件标注</strong>：<code>|验证成功|</code> 是连接线上的文本标签，清晰地展示了逻辑判断的结果导向。</li>
</ul>
<p>该图表准确地捕捉了业务逻辑中的“顺序执行”与“条件分支”两个核心要素。</p>
<h3 data-id="heading-11">3.2 时序图（Sequence Diagram）：对象交互与时间顺序</h3>
<p><strong>测试场景</strong>：网购下单全过程。
<strong>输入指令</strong>：生成一个网购的时序图。参与者包括用户、商城前端、后端API、支付网关。展示点击下单到返回结果的全过程。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba60e7d65e7d4da8a10de7e7b275cc39~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=5EtCGgTDgGODxRMvwmTx8MddCXI%3D" alt="image.png" loading="lazy"/></p>
<p>上图呈现了各个系统组件之间的垂直生命线以及水平的消息传递。这种图表对于理解分布式系统中的调用链路至关重要。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">sequenceDiagram
    participant 用户
    participant 商城前端
    participant 后端API
    participant 支付网关

    用户-&gt;&gt;商城前端: 点击下单
    商城前端-&gt;&gt;后端API: 发起下单请求
    后端API-&gt;&gt;支付网关: 调用支付接口
    支付网关--&gt;&gt;后端API: 返回支付成功结果
    后端API--&gt;&gt;商城前端: 返回下单成功结果
    商城前端--&gt;&gt;用户: 显示支付成功
</code></pre>
<ul>
<li><strong><code>participant</code></strong>：显式声明了参与交互的对象，确保它们在图中按顺序排列。</li>
<li><strong><code>-&gt;&gt;</code></strong>：实线箭头，表示同步请求或异步消息的发送。</li>
<li><strong><code>--&gt;&gt;</code></strong>：虚线箭头，表示响应消息的返回。</li>
</ul>
<p>AI 生成的代码完美遵循了请求-响应（Request-Response）模式，清晰地展示了数据流如何在前端、后端与第三方服务之间流转。</p>
<h3 data-id="heading-12">3.3 甘特图（Gantt Chart）：项目进度与时间管理</h3>
<p><strong>测试场景</strong>：两周周期的项目开发计划。
<strong>输入指令</strong>：包含需求分析（2天）、原型设计（2天）、代码开发（6天）、测试与修复（3天）。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f666eee87e842b68b4d625a8683d85e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=A94Ie7R%2BS5AsqlztyYQgmX0au0U%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了项目的时间轴视图。甘特图是项目经理进行排期和资源可视化的首选工具。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">gantt
    title 项目开发甘特图
    dateFormat  YYYY-MM-DD
    section 项目阶段
    需求分析       :done,    des1, 2025-12-07, 2d
    原型设计       :active,  des2, 2025-12-09, 2d
    代码开发       :         des3, 2025-12-11, 6d
    测试与修复     :         des4, 2025-12-17, 3d
</code></pre>
<ul>
<li><strong><code>dateFormat</code></strong>：定义了日期的解析格式。</li>
<li><strong><code>section</code></strong>：将任务分组，这里统一在“项目阶段”下。</li>
<li><strong>任务状态</strong>：<code>done</code> 表示已完成，<code>active</code> 表示进行中，空白表示未开始。</li>
<li><strong>时间跨度</strong>：<code>2d</code>、<code>6d</code> 等后缀准确定义了任务持续的时长。</li>
</ul>
<p>Mermaid 自动计算了各个任务的起始和结束日期，直观地反映了任务间的依赖关系（虽然此例中为线性依赖）。</p>
<h3 data-id="heading-13">3.4 类图（Class Diagram）：面向对象结构设计</h3>
<p><strong>测试场景</strong>：学校管理系统的数据模型。
<strong>输入指令</strong>：包含学生、老师、课程三个类，定义多对多和一对多关系，以及基本属性和方法。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d66378386be249aaa7153e18f619f776~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=WVgGfV6XRLq2Cc97Y7fd6jKCj1s%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了标准的 UML 类图结构。每个矩形框代表一个类，分为类名、属性、方法三层结构。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">classDiagram
    class 学生 {
        +String 姓名
        +int 学号
        +void 注册课程()
        +void 查看课程()
    }

    class 老师 {
        +String 姓名
        +int 工号
        +void 添加课程()
        +void 查看课程()
    }

    class 课程 {
        +String 课程名称
        +String 课程编号
        +void 添加学生()
        +void 查看学生()
    }

    学生 "*" -- "*" 课程 : 选修
    老师 "1" -- "*" 课程 : 教授
</code></pre>
<ul>
<li><strong>可见性修饰符</strong>：<code>+</code> 表示 Public（公开）属性或方法。</li>
<li><strong>数据类型</strong>：明确标注了 <code>String</code>、<code>int</code> 等类型。</li>
<li><strong>关系基数</strong>：<code>"*"</code> 代表多（Many），<code>"1"</code> 代表一（One）。</li>
<li><strong>关联描述</strong>：<code>: 选修</code> 和 <code>: 教授</code> 对类之间的关系进行了语义化说明。</li>
</ul>
<p>这张图不仅展示了静态结构，还规范了系统的业务规则（例如一个老师可以教授多门课程）。</p>
<h3 data-id="heading-14">3.5 思维导图（Mindmap）：知识结构与发散思维</h3>
<p><strong>测试场景</strong>：人工智能学习路径规划。
<strong>输入指令</strong>：中心节点 AI，分支包含机器学习、深度学习、编程语言、数学基础及其子节点。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/768f1ec6b406480b845046e3c9da23c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgVW5kb29t:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766467146&amp;x-signature=CNVJ7zNOrBk02XmGcA39%2Bmcv9dI%3D" alt="image.png" loading="lazy"/></p>
<p>上图展示了以 AI 为核心的辐射状知识图谱。思维导图非常适合用于头脑风暴、知识梳理和层级展示。</p>
<p><strong>生成的代码解析</strong>：</p>
<pre><code class="hljs language-mermaid" lang="mermaid">mindmap
    root((AI))
        机器学习
            监督学习
            无监督学习
        深度学习
            CNN
            RNN
            Transformer
        编程语言
            Python
            C++
        数学基础
</code></pre>
<ul>
<li><strong><code>root((AI))</code></strong>：定义了中心根节点，双括号使其呈现圆形。</li>
<li><strong>缩进层级</strong>：Mermaid 的思维导图语法依赖缩进来表示层级关系，无需复杂的箭头定义，这使得代码极具可读性。</li>
</ul>
<p>通过这种结构，复杂的知识体系被可视化为层级分明的树状结构，便于记忆和理解。</p>
<h2 data-id="heading-15">总结与展望</h2>
<p>通过上述流程，我们完整体验了从 MCP 服务的搜索、配置，到在 IDE 中通过自然语言生成五种不同类型图表的全过程。</p>
<p>这一方案的优势在于：</p>
<ol>
<li><strong>低门槛</strong>：用户无需学习繁杂的 Mermaid 语法，只需描述需求。</li>
<li><strong>高效率</strong>：蓝耘托管服务免去了本地环境搭建的成本，开箱即用。</li>
<li><strong>可维护性</strong>：生成的图表本质上是文本代码，可以随项目源码一起进行版本控制（Git），便于后续的修改和迭代。</li>
</ol>
<p>MCP Mermaid 不仅是一个绘图工具，更是 AI 辅助工程化（AI4SE）的一个典型切面。它展示了如何通过标准协议将大模型的理解能力转化为实际的生产力工具。对于开发者、产品经理以及系统架构师而言，掌握这一工作流将显著提升文档编写与技术沟通的效率。</p>
<p>如果您对这一技术栈感兴趣，可以通过以下链接注册并体验蓝耘平台提供的服务：
<code>https://console.lanyun.net/#/register?promoterCode=0131</code></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣]]></title>    <link>https://juejin.cn/post/7584243498528227328</link>    <guid>https://juejin.cn/post/7584243498528227328</guid>    <pubDate>2025-12-16T11:54:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584243498528227328" data-draft-id="7584286241487945768" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-12-16T11:54:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="围巾哥萧尘"/> <meta itemprop="url" content="https://juejin.cn/user/1222312659548446"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1222312659548446/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    围巾哥萧尘
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:54:52.000Z" title="Tue Dec 16 2025 11:54:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 在TRAE SOLO中使用PyeChart创建一个HTML格式的子母饼图网站🧣</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f522bac8244f48a38fa79d6e75159325~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=tP7boZEFa9zEoekgbfYDLPum%2BLo%3D" alt="708d8a2df5a594e775fe485ab6d4431568bbd20c.jpg@672w_378h_1c.webp" loading="lazy"/></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ftraeb7l0znrj.vercel.app%2F" target="_blank" title="https://traeb7l0znrj.vercel.app/" ref="nofollow noopener noreferrer">traeb7l0znrj.vercel.app/</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.bilibili.com%2Fvideo%2FBV1fAqhBGErL%2F%3Fspm_id_from%3D333.1387.homepage.video_card.click" target="_blank" title="https://www.bilibili.com/video/BV1fAqhBGErL/?spm_id_from=333.1387.homepage.video_card.click" ref="nofollow noopener noreferrer">视频操作：🚀TRAE SOLO 实战赛 | 智启Coding 码力全开 | 使用PyeChart创建一个HTML格式的子母饼图案例 | @围巾哥萧尘🧣</a></p>
<p><strong>摘要</strong></p>
<p>今天主要利用 TRAE的国内版本 高效实现特定可视化需求，即使用Python的<code>PyeChart</code>库生成THML格式子母品图的实践流程。通过输入结构化的需求描述和对应的范例，我们实现了快速代码生成与图样制作。实际的操作发现，明确的需求描述及其范例是显著加速实现进程的关键因素。</p>
<p><strong>关键词：</strong> 子母品图, HTML, Python, <code>PyeChart</code>, 提示词优化, AI辅助</p>
<h3 data-id="heading-1">1. 研究背景与需求分析</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/adc9dcbd74024126afff561f7f6a1978~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=6bJM0N9vMgeOB8f%2F4%2ByH99kamUw%3D" alt="截屏2025-12-16 19.32.00.png" loading="lazy"/></p>
<p>今天一个小伙伴提出了一个明确的可视化需求，即需要绘制一张<strong>子母饼图</strong>，要求以 <strong>HTML 格式</strong>输出，并需通过 <strong>Python 的 PyeChart</strong>完成实现。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc5c515bbbae485fa8eeb5ec99038246~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=9wMnxadB%2Bl2Yb7IEmTBoE7XStWY%3D" alt="截屏2025-12-16 19.21.00.png" loading="lazy"/></p>
<p>该需求的关键优势在于，她不仅提供了需求点，还提供了<strong>对应的范例</strong>。这种双重确认极大地提高了后续操作的效率，因为在操作时它的效率会很高一点。</p>
<p>虽然基础需求清晰，但在实际操作中，仍需要对需求进行优化，以确保最终生成的品图能够与需求完全一致。</p>
<h3 data-id="heading-2">2. AI驱动的方法论与执行流程</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bac1669f4ed948a6af8e4584adeab18a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=fMVdCwUAcwpHZM5dEPFCpMHCD%2BI%3D" alt="截屏2025-12-16 17.39.00.png" loading="lazy"/></p>
<p>利用“TRAE的国内版本”工具 作为AI驱动的代码生成平台。</p>
<h4 data-id="heading-3">2.1 提示词构建与工具启用</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/202d4a1862f64116af32ce95b5efced5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=vygzvUYuYNkSTSHYmECkwn1Z1Kg%3D" alt="50.gif" loading="lazy"/></p>
<p>我向TRAE提供了<strong>需求分析和范例图片，以及我的制作需求</strong>，通过对应的提示词，完成对应的网页制作。启用了 <strong>plan 功能</strong>，完成项目梳理。</p>
<h4 data-id="heading-4">2.2 结构化执行步骤的自动生成</h4>
<p>TRAE在接收到提示词后，根据需求分析自动生成了一套实现步骤。这些步骤覆盖了从数据准备到基础视图生成的全过程。</p>
<p><strong>表 1：AI工具自动生成的图样实现步骤</strong></p>



































<table><thead><tr><th align="left">序号</th><th align="left">步骤环节</th><th align="left">关键操作描述</th><th align="left">引用</th></tr></thead><tbody><tr><td align="left">1</td><td align="left">数据与文档准备</td><td align="left">完成文档的一个数据准备工作</td><td align="left"/></tr><tr><td align="left">2</td><td align="left">库安装与配置</td><td align="left">安装 <code>PyeChart</code> 库并重启该 <code>PyeChart</code> 库</td><td align="left"/></tr><tr><td align="left">3</td><td align="left">TODO list步骤</td><td align="left">工具提供了五步的操作步骤</td><td align="left"/></tr><tr><td align="left">4</td><td align="left">网页可视化生成</td><td align="left">生成文档，实现字母视图并启动网页</td><td align="left"/></tr></tbody></table>
<h4 data-id="heading-5">2.3 结果验证</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/acd352c2008342eb918e18106fcf6ea2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=SNfpKKsNEhTITA%2Fbgcu8GjbwAzM%3D" alt="截屏2025-12-16 17.39.11.png" loading="lazy"/></p>
<p>程序启动后，即可在浏览器当中去完成图样的制作，实现网页的速度非常快。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31f66193105549bb87ae38c147a781ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu05be-5ZOl6JCn5bCY:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766490891&amp;x-signature=MYjOVXSNJFkgzpgRnNs8HVSm0gI%3D" alt="截屏2025-12-16 19.43.54.png" loading="lazy"/></p>
<p>国内版本没有部署按钮，使用国际版的TRAE完成网页的部署。</p>
<h3 data-id="heading-6">3. 结果、讨论与优化建议</h3>
<h4 data-id="heading-7">3.1 效率与清晰性</h4>
<p>实践证明，<strong>拥有清晰的需求点和对应的范例</strong>是加速实现过程的关键因素。当需求描述清晰、分析到位时，工具能够更快地生成基础视线。</p>
<h4 data-id="heading-8">3.2 复杂布局的实现挑战</h4>
<p>尽管基础实现速度快，但如果要实现如“左边当图，右边当图，中间加这个线的描述的图片”的复杂精细化布局，则需要对<strong>提示词完成更进一步的描述优化</strong>。</p>
<h4 data-id="heading-9">3.3 提示词优化与外部工具辅助</h4>
<p>为了获得更理想的效果，如果用户在自我表述或描述所需图样时遇到困难，可以借鉴外部工具进行辅助分析。例如，可以利用谷歌的 <strong>Gemini</strong>，让它去分析目标图样，进而给出对应的<strong>图描述的提示词</strong>，这能有效提升描述的精确度和加快效果。</p>
<h3 data-id="heading-10">4. 结论</h3>
<p>利用“TRAE国内版”工具和清晰的需求文档，成功完成了基于Python <code>PyeChart</code>库的HTML格式字母饼图制作和分享。在代码实现场景中，<strong>你对问题的清晰描述和分析</strong>是获得良好效果的基石。</p>
<p>如果你有一个清晰需求并附带一个清晰的范例，那么在实现需求的过程中速度上就会更快。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI辅助开发工具实战：从零到一构建AI写真小程序]]></title>    <link>https://juejin.cn/post/7584292514959163401</link>    <guid>https://juejin.cn/post/7584292514959163401</guid>    <pubDate>2025-12-16T11:13:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584292514959163401" data-draft-id="7584276176670752795" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI辅助开发工具实战：从零到一构建AI写真小程序"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2025-12-16T11:13:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="橙午月"/> <meta itemprop="url" content="https://juejin.cn/user/1257497033712414"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI辅助开发工具实战：从零到一构建AI写真小程序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1257497033712414/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    橙午月
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T11:13:59.000Z" title="Tue Dec 16 2025 11:13:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial;color:#00325e}.markdown-body ::selection{background-color:#00325e;color:#fff}.markdown-body blockquote{padding:10px 20px;background-color:#fffaf0;box-shadow:0 3px 10px 0 rgba(255,172,194,.24);border:1px solid #f3ca8e;transition:all .2s;margin:1em 0;border-radius:5px}.markdown-body blockquote p{font-size:14px;line-height:25px;color:#795548}.markdown-body blockquote p:last-child{margin:0}.markdown-body blockquote:hover{border-color:#ff9800;background-color:#fff8e0;box-shadow:0 6px 10px -5px rgba(225,173,98,.3803921569)}.markdown-body blockquote code{color:#ff502c}.markdown-body pre{border:1px solid #8cc0f3;box-shadow:0 3px 10px 0 rgba(255,198,198,.28);border-radius:5px;transition:all .2s;overflow-x:auto;white-space:pre-wrap}.markdown-body pre:hover{border-color:#6d9dce}.markdown-body pre&gt;code{padding:10px 20px;color:#00325e;background:#f0f8ff;font-size:12px;line-height:1.6;display:block}.markdown-body code{background:#f6fbff;color:#0b5393;padding:2px 4px;border-radius:4px;font-size:12px}.markdown-body p{font-size:14px;line-height:28px;text-align:justify;margin-bottom:17px;color:#595959}.markdown-body a{color:#00325e;text-decoration:none}.markdown-body a:after{content:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAQdJREFUKFNt0DtLA0EUBeBzZle0Eks7rcUfEfBRCha7NorYa6NmVJzgyi4smUgKtdZGCJktLMVH4Y8QeztLWyE7VyLEuNFbXj4Oh0P8c8mZm+uJrEN4BJFTeP/MUVe3bnocfALwkOlo1zS7iZAzf6Cx7oXgbaqjxiDEWCcVaGyxQ8pSWo9XhqhoQ/xUFbaKjhe5V+CmR7mnSplEEF6GSmJ+F/d0KHvbCIIJCLc85U6BC5mONgbJNM3uFag++sX7z8O8MzsWBucifMx0dDGE1kmm458KDVukAlnNdDz/exEeW3dNkbfsYC0xtmgDWP6ELLZ0/F6BJu/UoFQN5AkoeUjeJPvx6+i+X5Sjah4tA6gYAAAAAElFTkSuQmCC);margin-left:2px}.markdown-body a:hover{box-shadow:0 1px}.markdown-body table{max-width:100%;border-collapse:collapse;border-spacing:0;box-shadow:0 3px 10px 0 rgba(255,238,172,.24);transition:all .2s}.markdown-body table:hover{box-shadow:0 3px 10px 0 rgba(185,169,103,.24)}.markdown-body table tr th{border:1px solid #8cc0f3;background-color:#f0f8ff;padding:12px 15px}.markdown-body table tr td{border:1px solid rgba(243,202,142,.4);padding:12px 15px}.markdown-body table tbody tr{transition:all .2s}.markdown-body table tbody tr:hover td{border-color:#f3ca8e;background-color:#fff8e0;z-index:1}.markdown-body img{max-width:100%}.markdown-body h1{font-size:20px;margin-top:30px;margin-bottom:10px;padding-left:30px;position:relative}.markdown-body h1&gt;code{font-size:20px}.markdown-body h1:before{content:"🍺";display:block;font-size:18px;width:18px;height:18px;left:0;position:absolute}.markdown-body h2{font-size:18px;margin-top:30px;margin-bottom:10px;padding-left:28px;position:relative}.markdown-body h2&gt;code{font-size:18px}.markdown-body h2:before{content:"🍻";display:block;font-size:16px;width:16px;height:16px;left:0;position:absolute}.markdown-body h3{font-size:16px;margin-top:30px;margin-bottom:10px;padding-left:26px;position:relative}.markdown-body h3&gt;code{font-size:16px}.markdown-body h3:before{content:"🥂";display:block;font-size:14px;width:14px;height:14px;left:0;position:absolute}.markdown-body h4{font-size:14px;margin-top:30px;margin-bottom:10px;padding-left:24px;position:relative}.markdown-body h4&gt;code{font-size:14px}.markdown-body h4:before{content:"🥃";display:block;font-size:12px;width:12px;height:12px;left:0;position:absolute}.markdown-body h5{font-size:12px;margin-top:30px;margin-bottom:10px}.markdown-body h5&gt;code{font-size:12px}.markdown-body h6{font-size:10px;margin-top:30px;margin-bottom:10px}.markdown-body h6&gt;code{font-size:10px}.markdown-body h1,.markdown-body h2{color:#ff502c}.markdown-body hr{height:4px;border:none;margin-top:32px;margin-bottom:32px;background-size:4px 1px;background-image:linear-gradient(270deg,#6d9dce,#8cc0f3 25%,transparent 50%)}.markdown-body hr:nth-child(2n){background-image:linear-gradient(270deg,#ff9800,#fff8e0 25%,transparent 50%)}.markdown-body ul{padding-inline-start:20px}.markdown-body ul li{list-style-type:"🔸"}.markdown-body ul li li{list-style-type:"◻️"}.markdown-body ul li li li{list-style-type:"▫️"}.markdown-body ol{padding-inline-start:20px}.markdown-body ol ::marker{color:#ff9800}.markdown-body ol,.markdown-body ul{line-height:2em}.markdown-body li{padding-inline-start:1ch}.markdown-body li.task-list-item{list-style:none;padding-inline-start:0}.markdown-body li input{padding-right:2px}.markdown-body li input[type=checkbox i]{appearance:none}.markdown-body li input:before{content:"🟩";display:block;width:13px;height:13px}.markdown-body li input:checked:before{content:"✅"}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atelier-sulphurpool-light">.hljs-comment,.hljs-quote{color:#6b7394}.hljs-attribute,.hljs-link,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#c94922}.hljs-built_in,.hljs-builtin-name,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#c76b29}.hljs-bullet,.hljs-string,.hljs-symbol{color:#ac9739}.hljs-section,.hljs-title{color:#3d8fd1}.hljs-keyword,.hljs-selector-tag{color:#6679cc}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#f5f7ff;color:#5e6687}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">写在前面</h2>
<p>最近用TRAE的Solo模式做了个AI写真小程序项目，从零到一走了一遍。项目用Taro + React做前端，NestJS + MongoDB做后端，整体完成度大概60%。</p>
<p>这篇文章主要聊聊Solo模式的实际表现，哪些地方省时间，哪些地方还是得自己来。</p>
<hr/>
<h2 data-id="heading-1">一、项目概述</h2>
<h3 data-id="heading-2">1.1 项目背景</h3>
<p>这个项目是个AI写真小程序，主要做节日主题（圣诞/跨年）的写真生成。需要同时支持微信和抖音两个平台，功能包括用户登录、图片上传、AI预检、风格选择、付费解锁、AI生成、结果展示这些核心流程。</p>
<h3 data-id="heading-3">1.2 技术栈选型</h3>
<p>技术选型是在Solo模式下做的，体验不错。描述了项目需求（小程序、跨平台、AI生成等），Solo模式推荐了技术栈并给出理由。比如为什么选Taro而不是uni-app，为什么选NestJS而不是Express，解释比较合理。</p>
<p>最终选定的技术栈：前端用Taro 4.1.9 + React 18.0.0，后端用NestJS 10.0.0 + MongoDB 7.6.3，AI服务用Google Generative AI 0.24.1。这个阶段省了不少调研时间。</p>
<h3 data-id="heading-4">1.3 项目完成情况</h3>
<p>重新评估了一下，项目完成度确实没有之前估计的那么高。前端大概50%，后端70%左右：</p>
<h4 data-id="heading-5">前端完成度：<strong>50%</strong></h4>








































<table><thead><tr><th>模块</th><th>完成度</th><th>说明</th></tr></thead><tbody><tr><td>基础架构</td><td>100%</td><td>Taro框架搭建完成，项目结构清晰</td></tr><tr><td>UI组件库</td><td>70%</td><td>MobileLayout、Header、Button等核心组件已实现，但样式与设计规范差距大</td></tr><tr><td>页面实现</td><td>60%</td><td>主要页面（首页、登录、上传、风格选择、结果页）已实现，但部分功能使用模拟数据</td></tr><tr><td>API集成</td><td>50%</td><td>基础API调用已实现，但很多接口未完全对接</td></tr><tr><td>样式设计</td><td>40%</td><td>UI样式基本实现，但视觉效果与设计规范存在较大差距，需要大量手动调整</td></tr><tr><td>错误处理</td><td>40%</td><td>基础错误处理已实现，但缺少全局错误处理机制和超时控制</td></tr></tbody></table>
<p><strong>主要未完成项</strong>：</p>
<ul>
<li>部分页面（如支付页、用户中心）功能不完整</li>
<li>结果页使用模拟数据生成，未完全对接后端API</li>
<li>缺少全局错误处理和请求超时控制</li>
<li>UI视觉效果与设计规范存在较大差距，需要大量手动调整</li>
</ul>
<h4 data-id="heading-6">后端完成度：<strong>70%</strong></h4>


















































<table><thead><tr><th>模块</th><th>完成度</th><th>说明</th></tr></thead><tbody><tr><td>基础架构</td><td>100%</td><td>NestJS框架搭建完成，模块化设计清晰</td></tr><tr><td>认证模块</td><td>85%</td><td>微信/抖音登录已实现，JWT认证机制完善，但可能未完全测试</td></tr><tr><td>用户模块</td><td>80%</td><td>用户管理、VIP系统、购买历史等功能已实现，但可能未完全测试</td></tr><tr><td>图片模块</td><td>70%</td><td>图片上传、存储、审核功能已实现，但使用本地存储，未集成云存储</td></tr><tr><td>AI模块</td><td>80%</td><td>Gemini API集成完成，支持图片预检、生成、文案推荐，但可能未完全测试</td></tr><tr><td>生成模块</td><td>60%</td><td>任务管理、状态跟踪已实现，但缺少任务队列和重试机制</td></tr><tr><td>订单模块</td><td>70%</td><td>订单创建、状态管理、支付回调处理已实现，但可能未完全测试</td></tr><tr><td>支付模块</td><td>50%</td><td>微信/抖音支付框架已搭建，但可能未完全测试和验证</td></tr></tbody></table>
<p><strong>主要未完成项</strong>：</p>
<ul>
<li>云存储集成（腾讯云COS）未完成，目前使用本地存储</li>
<li>支付功能可能未完全测试和验证</li>
<li>缺少任务队列和异步处理机制</li>
<li>缺少完整的错误日志和监控系统</li>
<li>很多模块虽然代码写好了，但可能未完全测试</li>
</ul>
<hr/>
<h2 data-id="heading-7">二、Solo模式实战体验</h2>
<h3 data-id="heading-8">2.0 技术选型阶段</h3>
<p>项目最开始在Solo模式下做技术选型，体验不错。描述了需求，Solo模式推荐了技术栈并给出理由，省了不少调研时间。</p>
<h3 data-id="heading-9">2.1 架构设计阶段</h3>
<p>技术选型确定后，在Solo模式下生成架构设计文档。根据技术栈自动生成目录结构、组件化方案、状态管理这些基础架构。</p>
<p>架构设计从2-3天缩短到1小时内，生成的目录结构符合Taro规范，WXSS兼容性问题也能自动处理。不过架构设计比较通用，还是得根据项目实际情况调整。</p>
<h3 data-id="heading-10">2.2 编码实现阶段</h3>
<p>编码阶段用得最多，体验有点两极分化。</p>
<p><strong>做得好的地方</strong>：</p>
<ul>
<li><strong>看AI写代码</strong>：开启自动跟随模式后，描述需求，AI开始写代码，可以看着它一行行生成。有时候会想"原来可以这样写"，能学到一些新写法</li>
<li><strong>组件代码生成</strong>：用自然语言描述需求，很快就能生成符合Taro规范的代码，省时间</li>
</ul>
<p><strong>最大的痛点：UI规范理解能力不足</strong></p>
<p>虽然能读取UI规范文档，但即使给了设计规范，也无法根据规范生成对应的组件。</p>
<p>我试过给它UI规范文档，生成的组件样式和规范差距很大。色彩、间距、字体这些细节都需要手动调整，布局也不够精确。代码语法没问题，但视觉效果完全不符合设计规范。</p>
<p>结果就是代码生成速度快，但UI实现阶段反而要花更多时间手动调整，有点欲速则不达。</p>
<p><strong>开发效率对比</strong>：</p>















































<table><thead><tr><th>开发阶段</th><th>传统开发</th><th>Solo模式</th><th>效率提升</th></tr></thead><tbody><tr><td>组件设计</td><td>30分钟</td><td>5分钟</td><td>6倍</td></tr><tr><td>样式实现</td><td>20分钟</td><td>15分钟</td><td>1.3倍</td></tr><tr><td>UI规范调整</td><td>0分钟</td><td>25分钟</td><td>-</td></tr><tr><td>兼容性处理</td><td>15分钟</td><td>自动</td><td>100%节省</td></tr><tr><td>代码调试</td><td>25分钟</td><td>10分钟</td><td>2.5倍</td></tr><tr><td><strong>总计</strong></td><td><strong>90分钟</strong></td><td><strong>55分钟</strong></td><td><strong>1.6倍</strong></td></tr></tbody></table>
<p>代码生成速度快，重复工作减少，平台兼容性自动处理。但最大问题是即使给了UI规范文档，也无法根据规范生成对应组件，需要大量手动调整。复杂组件和动画效果还是得自己来。</p>
<h3 data-id="heading-11">2.3 测试优化阶段</h3>
<p>测试阶段主要做代码质量检查，还算实用。会自动检测不兼容的CSS特性，比如把<code>border: 'none'</code>改成<code>borderWidth: 0</code>以符合WXSS规范，能省不少调试时间。不过优化建议比较通用，缺乏针对性。</p>
<hr/>
<h2 data-id="heading-12">三、开发中遇到的坑</h2>
<p>AI写代码很快，审核代码却需要时间；尤其是在项目跑不起来，重复报错，重复循环，让人很崩溃。最后还是不得不自己查文档，改错误。</p>
<hr/>
<h2 data-id="heading-13">四、给Solo模式的建议</h2>
<p>基于实际开发体验，提几个建议：</p>
<p><strong>执行流程稳定性</strong>：API请求缺少超时机制，有时候会卡死，需要手动终止。建议加10秒超时控制，完善全局错误处理机制。</p>
<p><strong>代码生成质量</strong>：代码生成缺乏多轮验证，有时候生成的代码能跑但不够优雅。建议引入语法检查、框架规范检查、功能测试等多轮验证机制。</p>
<p><strong>UI规范理解能力（最重要）</strong>：虽然能读取UI规范文档，但无法根据设计规范生成对应的组件。这是最大的痛点。建议增强对UI设计规范的理解能力，能准确解析设计文档中的视觉要求，能根据设计规范生成符合规范的组件代码，而不是只生成语法正确的代码。</p>
<p><strong>上下文理解能力</strong>：对业务逻辑理解不够深入，有时候生成的代码语法正确但不符合项目实际需求。建议增强项目上下文理解，支持项目特定的代码模板。</p>
<p><strong>临时文档过多</strong>：临时文档让AI在处理业务逻辑上起到帮助，但这个文档大部分没有用处，而且会越来越多，增加了阅读的负担。建议完成任务之后自动删除临时文档，没必要占用太多空间，增加心智负担。</p>
<hr/>
<h2 data-id="heading-14">五、结论与展望</h2>
<h3 data-id="heading-15">5.1 总体评价</h3>
<p>Solo模式在技术选型和代码生成速度方面表现不错，自动跟随模式和看AI写代码的体验很有意思。但在UI实现上是个短板，虽然能读取UI规范文档，但无法根据设计规范生成对应的组件，需要大量手动调整，拉低了整体效率。</p>
<p><strong>评分</strong>：72/100</p>
<ul>
<li>开发效率提升：85分（UI实现需要大量手动调整，但代码生成快）</li>
<li>自动跟随模式：90分（看AI写代码很有意思）</li>
<li>上下文理解能力：75分</li>
<li>代码质量：70分</li>
<li><strong>UI规范理解能力：50分</strong>（即使提供规范文档，也无法生成对应组件）</li>
<li>易用性：85分</li>
<li>功能完整性：70分</li>
</ul>
<h3 data-id="heading-16">5.2 项目完成情况</h3>
<p>前端50%：基础架构和核心组件完成，主要页面和业务流程基本实现，但部分功能用模拟数据，UI样式与设计规范差距大，错误处理和性能优化需完善。</p>
<p>后端70%：核心业务模块实现，AI服务集成和认证系统基本完成，但云存储集成未完成，支付功能需进一步测试，很多模块代码写好了但可能未完全测试。</p>
<p>总体完成度约60%。</p>
<h3 data-id="heading-17">5.3 给开发者的建议</h3>
<p>Solo模式是辅助，不是替代。核心技术还是要掌握，不要过度依赖。</p>
<p>技术选型阶段体验不错，能快速给出合理的技术栈建议。自动跟随模式值得试试，看AI写代码的过程能学到不少东西。</p>
<p>UI实现要人工介入，即使给了设计规范，Solo模式也无法根据规范生成组件，需要大量手动调整，这个要有心理准备。生成的代码语法正确，但视觉效果和用户体验需要人工审查。</p>
<hr/>
<h2 data-id="heading-18">六、写在最后</h2>
<p>Solo模式能提升开发效率，特别是在技术选型和代码生成方面。自动跟随模式和看AI写代码的体验不错，有时候看着它写代码，会想"原来可以这样写"，能学到一些新东西。</p>
<p>但在UI实现上还有明显短板——即使给了设计规范文档，也无法根据规范生成对应组件，需要大量人工调整。这是最大的痛点。</p>
<p>Solo模式是很好的辅助，但还不能完全替代开发者。特别是在UI实现这种需要精确理解设计意图的场景，人工介入还是必须的。</p>
<p>如果你也在考虑用Solo模式，建议先试试技术选型和自动跟随模式，看看AI写代码的过程。但UI实现部分，还是要有自己动手的心理准备。</p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[别再手动对齐矩形了！这个开源神器让 AI 帮你画架构图 (Next-AI-Draw-IO 体验)]]></title>    <link>https://juejin.cn/post/7583921477613682723</link>    <guid>https://juejin.cn/post/7583921477613682723</guid>    <pubDate>2025-12-15T16:24:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7583921477613682723" data-draft-id="7583892482598961167" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别再手动对齐矩形了！这个开源神器让 AI 帮你画架构图 (Next-AI-Draw-IO 体验)"/> <meta itemprop="keywords" content="前端,人工智能,Next.js"/> <meta itemprop="datePublished" content="2025-12-15T16:24:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="sumAll"/> <meta itemprop="url" content="https://juejin.cn/user/2863547353939175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别再手动对齐矩形了！这个开源神器让 AI 帮你画架构图 (Next-AI-Draw-IO 体验)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2863547353939175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    sumAll
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-15T16:24:39.000Z" title="Mon Dec 15 2025 16:24:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-15
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>摘要</strong>：作为一个天天和架构图打交道的开发者，我受够了在 Draw.io 里把时间浪费在“像素级对齐”和“连线微调”上。今天推荐的这个开源项目 <code>next-ai-draw-io</code>，直接把 Draw.io 和 LLM 缝合在了一起。不仅能一句话生成架构图，还能把你随手画的白板草图直接变成可编辑的专业图表。它是如何做到的？好用吗？如何本地部署？本文带你一探究竟。</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">引言：那个深夜，我们在与“对齐”较劲</h2>
<p>你有没有过这样的经历？</p>
<p>老板让你画一个微服务架构图，核心逻辑其实你脑子里早就有了：一个网关，后面挂三个服务，再连个 Redis 和 MySQL。</p>
<p>但是，当你打开 Draw.io (或者 Visio/ProcessOn) 时，噩梦开始了：</p>
<ul>
<li>这个矩形是不是比那个宽了 2px？</li>
<li>这条线为什么死活不能变直？</li>
<li>要把整个架构往左移一点，结果选中所有元素一拖，连线全乱了……</li>
</ul>
<p>原本 10 分钟能想清楚的架构，最后花了 2 个小时在<strong>调整 UI</strong> 上。作为技术人，我们应该把时间花在<strong>设计系统</strong>上，而不是花在<strong>排版</strong>上。</p>
<p>最近，在 GitHub 上发现了一个名为 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer"><strong>next-ai-draw-io</strong></a> 的开源项目，它精准地击中了这个痛点。试用完之后，我只想说：<strong>生产力工具的未来，真的来了。</strong></p>
<hr/>
<h2 data-id="heading-1">主角登场：Next-AI-Draw-IO 是什么？</h2>
<p>简单来说，这是一个 <strong>Next.js + AI + Draw.io</strong> 的超级缝合怪。</p>
<p>市面上有很多“文字生成流程图”的工具（比如 Mermaid），但它们生成的图往往<strong>只读不可改</strong>，或者样式非常简陋。</p>
<p><code>next-ai-draw-io</code> 的杀手锏在于：<strong>它生成的是标准的、可编辑的 Draw.io 源文件 (XML)。</strong></p>
<p>这意味着：</p>
<ol>
<li><strong>你可以改</strong>：AI 画完大概，你可以手动微调细节，利用 Draw.io 强大的编辑能力。</li>
<li><strong>不挑模型</strong>：它支持 AWS Bedrock, OpenAI, Anthropic (Claude), Google Gemini, Azure OpenAI, Ollama, OpenRouter, DeepSeek 以及 SiliconFlow 等多种 Provider。</li>
<li><strong>完全开源</strong>：代码在你手中，私有化部署非常方便，不用担心公司架构图泄露给第三方。</li>
</ol>
<hr/>
<h2 data-id="heading-2">实测：见证奇迹的三个时刻</h2>
<p>为了验证它是不是"PPT 骗局"，我进行了三个场景的深度实测，并记录了每次测试的详细过程和结果。</p>
<blockquote>
<p><strong>测试环境说明</strong>：
本次测试使用 <strong>SiliconFlow (硅基流动)</strong> 提供的 API 服务，模型选用 <strong>Kimi-K2-Thinking</strong>。配置如下：</p>
<pre><code class="hljs language-bash" lang="bash">AI_PROVIDER=siliconflow
OPENAI_BASE_URL=https://api.siliconflow.cn/v1
OPENAI_API_KEY=sk-******
AI_MODEL=moonshotai/Kimi-K2-Thinking
</code></pre>
</blockquote>
<h3 data-id="heading-3">时刻 1：一句咒语，平地起高楼 (Text-to-Diagram)</h3>
<p><strong>📝 测试案例 A：复杂云架构图</strong></p>
<p>我输入了这样一段 Prompt：</p>
<blockquote>
<p>"帮我画一个高可用的 AWS 电商系统架构图。包含 Route53, CloudFront, ALB, 一个 Auto Scaling Group 里包含 3 个 EC2 实例，后端连接 RDS 主从数据库和 ElastiCache。"</p>
</blockquote>
<p><strong>⏱️ 生成时间</strong>：12 秒
<strong>📊 生成结果</strong>：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9a3f08c193e54fbfb4559d264f2f568d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=DuZjnkv8qIa4wpgpvvzpbDfmFlg%3D" alt="step_01.jpeg" loading="lazy"/></p>
<p><strong>🎯 实际效果：</strong></p>
<ol>
<li>✅ <strong>逻辑正确性</strong>：流量路径 Route53 → CloudFront → ALB → EC2 → RDS/ElastiCache 清晰准确。</li>
<li>✅ <strong>布局合理</strong>：组件排列有序，没有杂乱的连线。</li>
<li>⚠️ <strong>小瑕疵</strong>：默认组件样式较为朴素。</li>
</ol>
<p>接着，我让它进行精修：</p>
<blockquote>
<p>"帮我优化精修这个架构图，AWS 组件使用 AWS 的组件 Logo。"</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9b7ff87b3864f2384fa83f0756c5c3b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=R9pdT3zQX3Tc1pvzwKPctnLEo3o%3D" alt="step_02.png" loading="lazy"/></p>
<p><strong>效果立竿见影</strong>：所有组件瞬间替换为官方 AWS 图标，专业度直接拉满。</p>
<hr/>
<p><strong>📝 测试案例 B：微服务架构图</strong></p>
<p>Prompt：</p>
<blockquote>
<p>"画一个订单系统的微服务架构：API Gateway 作为入口，后面连接订单服务、库存服务、支付服务、通知服务。服务间通过 Kafka 消息队列解耦，每个服务都有自己的 PostgreSQL 数据库。"</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0620d46802394a87a515843de72c0a23~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=aOhy%2FVe3ee0g6acrpGFKDvBbc%2BA%3D" alt="step_03.png" loading="lazy"/></p>
<p><strong>🎯 亮点分析：</strong></p>
<ul>
<li>✅ <strong>架构理解深刻</strong>：自动识别并居中放置 Kafka，体现了"解耦"的核心思想。</li>
<li>✅ <strong>图例自动生成</strong>：实线表示同步调用，虚线表示异步消息，细节满分。</li>
<li>✅ <strong>智能图标</strong>：API 网关、业务服务、数据库自动区分，视觉层次丰富。</li>
</ul>
<hr/>
<h3 data-id="heading-4">时刻 2：草图复活术 (Image-to-Diagram) 🔥</h3>
<p>这是我觉得<strong>最炸裂</strong>的功能。</p>
<p><strong>📝 测试案例：手绘草图识别</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c5397071afe5433fabae3274e435d281~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=lINnVNcEVxr59%2BzJbX88yCUimPQ%3D" alt="step_05_draft.png" loading="lazy"/></p>
<p><strong>🖼️ 原始草图</strong>：</p>
<ul>
<li>随手画的矩形和菱形，线条歪歪扭扭。</li>
<li>手写文字潦草。</li>
<li>箭头指向随意。</li>
</ul>
<p><strong>⏱️ 识别 + 转换时间</strong>：18 秒</p>
<p><strong>🎯 AI 转换结果：</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7068da74c2340ada98f3fd20901bd84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=zvBSWlgc8q59pFCxGbHQyvhkGSQ%3D" alt="step_05.png" loading="lazy"/></p>
<blockquote>
<p>注意：这边的 AI Model 设置为了 <code>stepfun-ai/step3</code>，该模型支持视觉处理。</p>
</blockquote>
<hr/>
<h3 data-id="heading-5">时刻 3：你可以永远相信"甲方"的修改意见 (Chat-to-Edit)</h3>
<p>AI 生成的图不可能一步到位。这时候，它的<strong>对话修改</strong>功能就派上用场了。</p>
<p><strong>📝 测试案例：逐步迭代完善架构图</strong></p>
<p><strong>初始图</strong>：简单的"用户 → Web 服务器 → 数据库"三层架构。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d0fd5402c98d42299b865aa725a605da~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=pyhZqV5OA9IQJoiATt9fIiQOHQI%3D" alt="step_06.png" loading="lazy"/></p>
<p><strong>迭代过程记录</strong>：</p>
<ol>
<li><strong>"在 Web 服务器和数据库之间加一层 Redis 缓存"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0be204708e8498387857e72a4f60024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=3tG9RgVLSlRjrzWcQKsCSro1sBc%3D" alt="step_06_01.png" loading="lazy"/>
✅ 自动插入 Redis 节点，并调整连线布局。</p>
<ol start="2">
<li><strong>"把数据库改成主从架构，一主两从"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ffe418f729014143bc2d1555270516dd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=6G0kP%2Fu3aghkXupqUDjEr4ctCzc%3D" alt="step_06_02.png" loading="lazy"/>
✅ 数据库分裂为一主两从，标注清晰。</p>
<ol start="3">
<li><strong>"给 Web 服务器加个负载均衡器"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ceedfbe9dea430fb970709cf979515f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=jlH%2FYjB6hZEBFTuK7BuWlc23w7Y%3D" alt="step_06_03.jpeg" loading="lazy"/>
✅ 前置添加 LBs。</p>
<ol start="4">
<li><strong>"把核心组件（数据库和 Redis）的背景色改成红色，表示关键资产"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8f79159ea6d44c7999362e1aed2c0b51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=ejxsdhAfiHMpfi4NuuqiXOivRyk%3D" alt="step_06_04.png" loading="lazy"/>
✅ 精准识别"核心组件"，颜色修改正确。</p>
<ol start="5">
<li><strong>"在图的右上角加一个图例，说明颜色含义"</strong></li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c96297ccc6ae4721bd172073515d50ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=Pjn98L3IZtlUAu67j8Cm3jspd8w%3D" alt="step_06_05.png" loading="lazy"/>
🔥 智能生成图例表格，解释颜色对应关系。</p>
<p><strong>💡 核心价值</strong>：</p>
<ul>
<li><strong>上下文记忆</strong>：它清楚记得之前的修改历史。</li>
<li><strong>模糊指令理解</strong>：无需精确坐标，只需说"加个XX"，它自己知道该放哪。</li>
<li><strong>智能避让</strong>：新增元素时会自动调整周围组件，避免重叠。</li>
</ul>
<hr/>
<p><strong>🎬 小结：三个时刻的核心价值</strong></p>





























<table><thead><tr><th>功能</th><th>传统方式痛点</th><th>AI 方案优势</th><th>适用场景</th></tr></thead><tbody><tr><td>Text-to-Diagram</td><td>从零开始画，找图标找半天</td><td>15 秒生成底稿，90% 工作量消失</td><td>快速原型、文档配图</td></tr><tr><td>Image-to-Diagram</td><td>白板内容无法编辑和版本控制</td><td>草图秒变可编辑文件</td><td>会议记录、头脑风暴</td></tr><tr><td>Chat-to-Edit</td><td>每次改动都要手动拖拽调整</td><td>自然语言控制，AI 自动排版</td><td>迭代优化、客户反馈</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-6">技术极客视角：它怎么做到的？</h2>
<p>作为技术博主，我们不能只看热闹。深挖一下它的实现原理，你会发现作者在 <strong>Prompt Engineering</strong> 和 <strong>工程化落地</strong> 上做了大量精细的工作。</p>
<h3 data-id="heading-7">1. 核心架构：Next.js + AI SDK + Draw.io Embed</h3>
<p>整个项目的架构非常清晰，典型的 <strong>RAG (Retrieval-Augmented Generation)</strong> 变体应用：</p>
<ul>
<li><strong>Frontend</strong>: 基于 <strong>Next.js 15 (App Router)</strong> 构建，使用 <code>react-drawio</code> 组件将 Draw.io 编辑器嵌入页面。</li>
<li><strong>State Management</strong>: <code>DiagramContext</code> 是连接 AI 和 Draw.io 的桥梁。它负责监听 Draw.io 的事件（如 XML 变更），并将当前的 XML 状态注入到 AI 的上下文中。</li>
<li><strong>Backend</strong>: 使用 Vercel 的 <strong>AI SDK</strong> (<code>streamText</code>) 统一封装了 OpenAI, Anthropic, Bedrock, DeepSeek 等十几种模型接口。</li>
</ul>
<h3 data-id="heading-8">2. 核心原理：Diagram as Code (XML)</h3>
<p>Draw.io 的图表本质上是一段压缩的 XML 字符串 (<code>mxGraphModel</code>)。AI 并不是在"画画"，而是在<strong>写代码</strong>。</p>
<p>项目的核心在于让 LLM 理解并生成这种特定的 XML 结构。</p>
<h3 data-id="heading-9">3. Prompt Engineering 的艺术 (<code>lib/system-prompts.ts</code>)</h3>
<p>这是整个项目最值钱的部分。作者设计了一套复杂的 System Prompt，教会 LLM：</p>
<ol>
<li><strong>坐标系统</strong>：如何计算 <code>mxGeometry</code> 的 x/y 坐标，避免节点重叠。</li>
<li><strong>XML 规范</strong>：严格限制 <code>mxCell</code> 的层级结构，强制要求 ID 唯一性。</li>
<li><strong>样式定义</strong>：预设了 AWS、Azure 等图标库的样式代码，让生成的图表不至于太丑。</li>
</ol>
<h3 data-id="heading-10">4. 独特的工具调用机制 (<code>Tool Calling</code>)</h3>
<p>为了解决"全量生成太慢"的问题，项目定义了两个核心工具：</p>
<ul>
<li>
<p><strong><code>display_diagram</code> (全量生成)</strong>：</p>
<ul>
<li>用于从零创建新图，或者进行大范围重构。</li>
<li>AI 会输出完整的 <code>&lt;mxGraphModel&gt;...&lt;/mxGraphModel&gt;</code>。</li>
</ul>
</li>
<li>
<p><strong><code>edit_diagram</code> (增量修改)</strong>：</p>
<ul>
<li>这是<strong>最精彩的设计</strong>。</li>
<li>当你要求"把红色改成蓝色"时，AI <strong>不会</strong>重新生成几千行的 XML。</li>
<li>相反，它会生成一个 <code>search</code> 和 <code>replace</code> 的 JSON 对象。</li>
<li>前端利用正则匹配，只替换 XML 中变动的那几行。这极大地节省了 Token，并显著降低了延迟。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-11">5. Token 优化的黑科技 (<code>Context Pruning</code>)</h3>
<p>Draw.io 的 XML 非常啰嗦，一个复杂的图轻松突破 10k Token。如果每次对话都把历史 XML 带上，Context Window 瞬间就会爆满。</p>
<p>在 <code>app/api/chat/route.ts</code> 中，作者实现了一个 <code>replaceHistoricalToolInputs</code> 函数：</p>
<ul>
<li>在发送给 LLM 之前，<strong>强行剔除</strong>历史对话中生成的 XML 内容。</li>
<li>只保留<strong>当前最新的</strong> XML 作为 Context。</li>
<li>这样，无论对话多少轮，Context 的消耗始终维持在一个可控的范围内。</li>
</ul>
<h3 data-id="heading-12">6. 多模型适配 (<code>lib/ai-providers.ts</code>)</h3>
<p>项目没有绑定死任何一家模型厂商。它通过一个适配层，统一了不同模型的参数差异：</p>
<ul>
<li>对于 <strong>Anthropic</strong>，它开启了 <code>thinking</code> 模式以增强逻辑能力。</li>
<li>对于 <strong>DeepSeek</strong>，它适配了 caching 机制。</li>
<li>对于 <strong>OpenAI o1/o3</strong>，它自动调整 <code>reasoning_effort</code>。</li>
</ul>
<hr/>
<h2 data-id="heading-13">如何拥有它？（本地部署指南）</h2>
<p>作为一个开源项目，最爽的当然是<strong>私有化部署</strong>。既省钱，又安全。</p>
<p>作者提供了两种主流的部署方式，你可以根据自己的喜好选择。</p>
<h3 data-id="heading-14">方案一：源码部署（适合前端开发者）</h3>
<p>如果你想二次开发，或者单纯喜欢折腾代码，可以选择这种方式。</p>
<ol>
<li>
<p><strong>拉取代码</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">clone</span> https://github.com/DayuanJiang/next-ai-draw-io
<span class="hljs-built_in">cd</span> next-ai-draw-io
</code></pre>
</li>
<li>
<p><strong>安装依赖</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">npm install
</code></pre>
</li>
<li>
<p><strong>配置环境变量</strong>：
复制示例配置文件：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cp</span> env.example .env.local
</code></pre>
<p>编辑 <code>.env.local</code>，填入你的 API Key。例如：</p>
<pre><code class="hljs language-env" lang="env">AI_PROVIDER=openai
AI_MODEL=gpt-4o
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_API_KEY=sk-xxxxxx
</code></pre>
</li>
<li>
<p><strong>启动服务</strong>：</p>
<pre><code class="hljs language-bash" lang="bash">npm run dev
</code></pre>
<p>打开浏览器访问 <code>http://localhost:3000</code> 即可。</p>
</li>
</ol>
<h3 data-id="heading-15">方案二：Docker 部署（最简单，推荐）</h3>
<p>如果你不想安装 Node.js 环境，只想快速用起来，Docker 是最好的选择。</p>
<p>确保你已经安装了 Docker，然后执行以下命令：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 一行命令启动 (记得替换你的 API Key)</span>
docker run -d -p 3000:3000 \
  -e AI_PROVIDER=openai \
  -e AI_MODEL=gpt-4o \
  -e OPENAI_API_KEY=sk-xxxxxx \
  ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p>如果你想配合 <strong>Ollama</strong> 使用本地模型（完全免费，适合高性能电脑）：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 配合 Ollama 本地运行</span>
docker run -d -p 3000:3000 \
  -e AI_PROVIDER=ollama \
  -e AI_MODEL=llama3 \
  -e OLLAMA_BASE_URL=http://host.docker.internal:11434 \
  ghcr.io/dayuanjiang/next-ai-draw-io:latest
</code></pre>
<p><em>(注：本地模型生成 XML 的稳定性不如 GPT-4o，可能需要多试几次)</em></p>
<hr/>
<h2 data-id="heading-16">冷静的思考：优缺点分析</h2>
<p><strong>✅ 优点：</strong></p>
<ul>
<li><strong>极大提升起步速度</strong>：从 0 到 1 的过程被压缩到了几秒钟。</li>
<li><strong>交互体验极佳</strong>：基于 Next.js 的 UI 响应非常快，拖拽手感原生。</li>
<li><strong>版本控制 (History)</strong>：AI 改乱了？没事，它内置了版本历史，随时回滚。</li>
</ul>
<p><strong>❌ 局限性：</strong></p>
<ul>
<li><strong>复杂逻辑易“幻觉”</strong>：当节点超过 20+ 时，AI 有时会把线连错，或者重叠在一起。</li>
<li><strong>Token 消耗大</strong>：如果你用 GPT-4o 画超大图，Token 费用在燃烧。</li>
<li><strong>非设计师</strong>：它生成的图偏“工程师审美”，整齐但不够酷炫。</li>
</ul>
<hr/>
<h2 data-id="heading-17">结语：未来的绘图方式</h2>
<p><code>next-ai-draw-io</code> 并不是要取代架构师。相反，它让我们从繁琐的绘图劳动中解脱出来，回归架构设计的本质。</p>
<p>在这个 AI 辅助编程 (Copilot) 已经普及的时代，<strong>AI 辅助绘图</strong> 必然是下一个爆发点。</p>
<p>如果你也受够了在那对齐像素，不妨试试这个项目。哪怕只是用它来生成一个底稿，也能让你的摸鱼时间多出半小时。😉</p>
<p><strong>🔗 项目地址</strong>：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FDayuanJiang%2Fnext-ai-draw-io" target="_blank" title="https://github.com/DayuanJiang/next-ai-draw-io" ref="nofollow noopener noreferrer">github.com/DayuanJiang…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d5798a536834a69a62933238dedbb75~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc3VtQWxs:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766420679&amp;x-signature=47kDXGp%2Ba4HMc1N%2B7v3raiSpet8%3D" alt="4_result.png" loading="lazy"/></p>
<hr/>
<p><em>如果你觉得这篇文章对你有帮助，欢迎点赞、转发，并在评论区告诉我：你平时最头疼画哪种图？</em></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025OpenTiny星光ShowTime！年度贡献者征集启动！]]></title>    <link>https://juejin.cn/post/7584655946086367278</link>    <guid>https://juejin.cn/post/7584655946086367278</guid>    <pubDate>2025-12-17T10:00:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584655946086367278" data-draft-id="7584652662328066098" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025OpenTiny星光ShowTime！年度贡献者征集启动！"/> <meta itemprop="keywords" content="Vue.js,低代码,前端"/> <meta itemprop="datePublished" content="2025-12-17T10:00:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="OpenTiny社区"/> <meta itemprop="url" content="https://juejin.cn/user/3808325101432983"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025OpenTiny星光ShowTime！年度贡献者征集启动！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808325101432983/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    OpenTiny社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:00:23.000Z" title="Wed Dec 17 2025 10:00:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>携手共创，致敬不凡！</p>
<p>2025年，OpenTiny持续在前端开源领域扎根，每一位开发者都是推动项目共同前行的宝贵力量。从bug修复，到技术探讨；从参与开源活动，到输出技术文章；从使用项目，到参与共建，每一步跨越，都凝聚了开发者的智慧与汗水。致敬所有在OpenTiny社区里默默付出、积极贡献、引领创新的杰出个人，我们正式启动“OpenTiny年度贡献者评选”活动！欢迎各位开发者踊跃报名~</p>
<h2 data-id="heading-1">活动详情</h2>
<h3 data-id="heading-2">活动简介：</h3>
<p>本次活动主要是通过开发者申报+社区评选+开发者投票形式开展，入选开发者后续可获得相应活动礼品。本次活动一共设置 4 类奖项。</p>
<ol>
<li> “技术炼金师”（参与共建）、“布道魔法师”（参与分享）、“社区宝藏玩家”（参与社区讨论） 三个类目奖项通过投票评选获奖选手，本次投票共选出5名获奖选手，按照名次顺利依次给予相应奖励。</li>
<li>“技术硬核奖”则由社区自主根据实际共建情况评选 2 位，获得机械键盘/蓝牙音响（2选1）及荣誉证书</li>
</ol>
<h3 data-id="heading-3">活动奖品：</h3>
<table>
    <thead>
        <tr>
            <th>荣誉</th>
            <th>奖项</th>
            <th>礼品</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>第一名</td>
            <td rowspan="4">
                <ul>
                    <li>技术炼金师</li>
                    <li>布道魔法师</li>
                    <li>社区宝藏玩家</li>
                </ul>
            </td>
            <td>机械键盘 / 蓝牙音响（2选1） +荣誉证书</td>
        </tr>
        <tr>
            <td>第二名</td>
            <td>华为 66W 快充充电宝+荣誉证书</td>
        </tr>
        <tr>
            <td>第三名</td>
            <td>BKT 护腰坐垫椅+荣誉证书</td>
        </tr>
        <tr>
            <td>第四/五名</td>
            <td>屏幕挂灯+荣誉证书</td>
        </tr>
        <tr>
            <td>社区优秀共建者</td>
            <td>技术硬核奖</td>
            <td>机械键盘 / 蓝牙音响（2选1） +荣誉证书</td>
        </tr>
    </tbody>
</table>
<h3 data-id="heading-4">活动时间：</h3>
<ul>
<li>年度贡献者征集时间：2025年12月17日-2025年12月24日</li>
<li>年度贡献者投票评选时间：2025年12月25日-2025年12月31日</li>
</ul>
<h3 data-id="heading-5">报名入口：</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fv.wjx.cn%2Fvm%2FtdGJdjR.aspx%23" target="_blank" title="https://v.wjx.cn/vm/tdGJdjR.aspx#" ref="nofollow noopener noreferrer">v.wjx.cn/vm/tdGJdjR.…</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f21447bb06e54855aceb469a8a70b188~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgT3BlblRpbnnnpL7ljLo=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570423&amp;x-signature=hthTmpChy%2BzoY9KAaoE3ksLaJSE%3D" alt="默认标题__2025-12-17+16_34_23.jpg" loading="lazy"/></p>
<h2 data-id="heading-6">关于OpenTiny</h2>
<p>欢迎加入 OpenTiny 开源社区。添加微信小助手：opentiny-official 一起参与交流前端技术～</p>
<p>OpenTiny 官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopentiny.design" target="_blank" title="https://opentiny.design" ref="nofollow noopener noreferrer">opentiny.design</a><br/>
OpenTiny 代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny" target="_blank" title="https://github.com/opentiny" ref="nofollow noopener noreferrer">github.com/opentiny</a><br/>
TinyVue 源码：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-vue" target="_blank" title="https://github.com/opentiny/tiny-vue" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
TinyEngine 源码： <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopentiny%2Ftiny-engine" target="_blank" title="https://github.com/opentiny/tiny-engine" ref="nofollow noopener noreferrer">github.com/opentiny/ti…</a><br/>
欢迎进入代码仓库 Star🌟TinyEngine、TinyVue、TinyNG、TinyCLI、TinyEditor~
如果你也想要共建，可以进入代码仓库，找到 good first issue 标签，一起参与开源贡献~</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Paimon源码解读 -- Compaction-9.SortMergeReaderWithLoserTree]]></title>    <link>https://juejin.cn/post/7584262116388470810</link>    <guid>https://juejin.cn/post/7584262116388470810</guid>    <pubDate>2025-12-16T10:45:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584262116388470810" data-draft-id="7581648776303722505" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Paimon源码解读 -- Compaction-9.SortMergeReaderWithLoserTree "/> <meta itemprop="keywords" content="后端,大数据,Flink"/> <meta itemprop="datePublished" content="2025-12-16T10:45:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="expect7g"/> <meta itemprop="url" content="https://juejin.cn/user/3514471387235735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Paimon源码解读 -- Compaction-9.SortMergeReaderWithLoserTree 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3514471387235735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    expect7g
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-16T10:45:28.000Z" title="Tue Dec 16 2025 10:45:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-16
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>上篇文章<a href="https://juejin.cn/post/7577609608828239898" title="https://juejin.cn/post/7577609608828239898" target="_blank">Paimon源码解读 -- Compaction-1.MergeTreeCompactTask</a>解析了Paimon-Compaction阶段的大概流程</p>
<p>其中Paimon的compaction操作由如下几个部分组成，</p>
<ol>
<li>用<code>SingleFileWriter和RollingFileWriter</code>去执行写入和滚动文件操作 -- 详情看文章<a href="https://juejin.cn/spost/7581306080434339891" target="_blank" title="https://juejin.cn/spost/7581306080434339891">Paimon源码解读 -- Compaction-2.SingleFileWriter和RollingFileWriter</a></li>
<li>用<code>ReducerMergeFunctionWrapper</code>去执行聚合逻辑 -- 详情看文章<a href="https://juejin.cn/post/7576838095518793779" title="https://juejin.cn/post/7576838095518793779" target="_blank">Paimon源码解读 -- PartialUpdateMerge</a></li>
<li>用<code>readerForMergeTree()最后由SortMergeReader</code>去执行特定的合并算法，去将文件进行排序合并重写 -- 调用的流程请看文章<a href="https://juejin.cn/editor/drafts/7581470169840959526" target="_blank" title="https://juejin.cn/editor/drafts/7581470169840959526">Paimon源码解读 -- Compaction-3.MergeSorter</a></li>
</ol>
<h2 data-id="heading-1">一.SortMergeReader</h2>
<h3 data-id="heading-2">1.入口函数</h3>
<p>首先SortMergeReader是在MergeSorter.mergeSortNoSpill()中调用的，具体流程如下</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 无溢出合并的方法</span>
<span class="hljs-keyword">public</span> &lt;T&gt; RecordReader&lt;T&gt; <span class="hljs-title function_">mergeSortNoSpill</span><span class="hljs-params">(
        List&lt;? extends ReaderSupplier&lt;KeyValue&gt;&gt; lazyReaders,
        Comparator&lt;InternalRow&gt; keyComparator,
        <span class="hljs-meta">@Nullable</span> FieldsComparator userDefinedSeqComparator, // 这里只和<span class="hljs-string">'sequence-field'</span>绑定，决定全局的数据新旧情况
        MergeFunctionWrapper&lt;T&gt; mergeFunction)</span>
        <span class="hljs-keyword">throws</span> IOException {
    List&lt;RecordReader&lt;KeyValue&gt;&gt; readers = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(lazyReaders.size());
    <span class="hljs-keyword">for</span> (ReaderSupplier&lt;KeyValue&gt; supplier : lazyReaders) {
        <span class="hljs-keyword">try</span> {
            readers.add(supplier.get()); <span class="hljs-comment">// 底层调MergeTreeReaders.readerForRun()获取当前Sorted Run下所有DF文件创建且合起来的RecordReader，其实就是获取当前Sorted Run对应的RecordReader</span>
        } <span class="hljs-keyword">catch</span> (IOException e) {
            <span class="hljs-comment">// if one of the readers creating failed, we need to close them all.</span>
            <span class="hljs-comment">// 如果当前Sorted Run下所有DF文件创建的RecordReader，有任何一个有问题，则全部关闭</span>
            readers.forEach(IOUtils::closeQuietly);
            <span class="hljs-keyword">throw</span> e;
        }
    }
    <span class="hljs-comment">// 创建一个排序合并读取器，这是创建排序合并算法器的入口</span>
    <span class="hljs-keyword">return</span> SortMergeReader.createSortMergeReader(
            readers, keyComparator, userDefinedSeqComparator, mergeFunction, sortEngine); 
}
</code></pre>
<h3 data-id="heading-3">2.SortMergeReader本身</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">SortMergeReader</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">RecordReader</span>&lt;T&gt; {

    <span class="hljs-comment">// 由MergeSorter.mergeSortNoSpill()调用，该方法是创建排序合并算法器的入口</span>
    <span class="hljs-keyword">static</span> &lt;T&gt; SortMergeReader&lt;T&gt; <span class="hljs-title function_">createSortMergeReader</span><span class="hljs-params">(
            List&lt;RecordReader&lt;KeyValue&gt;&gt; readers,
            Comparator&lt;InternalRow&gt; userKeyComparator,
            <span class="hljs-meta">@Nullable</span> FieldsComparator userDefinedSeqComparator,
            MergeFunctionWrapper&lt;T&gt; mergeFunctionWrapper,
            SortEngine sortEngine)</span> {
        <span class="hljs-comment">// 根据配置的'sort-engine'，去创建对应的算法排序合并器，默认是loser-tree</span>
        <span class="hljs-keyword">switch</span> (sortEngine) {
            <span class="hljs-keyword">case</span> MIN_HEAP: <span class="hljs-comment">// 最小堆min-heap算法</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortMergeReaderWithMinHeap</span>&lt;&gt;(
                        readers, userKeyComparator, userDefinedSeqComparator, mergeFunctionWrapper);
            <span class="hljs-keyword">case</span> LOSER_TREE: <span class="hljs-comment">// 败者树loser-tree算法</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortMergeReaderWithLoserTree</span>&lt;&gt;(
                        readers, userKeyComparator, userDefinedSeqComparator, mergeFunctionWrapper);
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(<span class="hljs-string">"Unsupported sort engine: "</span> + sortEngine);
        }
    }
}
</code></pre>
<h2 data-id="heading-4">二.SortMergeReaderWithLoserTree -- 败者树SortMergeReader</h2>
<h3 data-id="heading-5">1.源码机制</h3>
<h4 data-id="heading-6">(1) 核心属性和构造函数</h4>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">SortMergeReaderWithLoserTree</span>&lt;<span class="hljs-type">T</span>&gt;
  <span class="hljs-operator">├──</span> <span class="hljs-type">MergeFunctionWrapper</span>&lt;<span class="hljs-type">T</span>&gt; mergeFunctionWrapper  <span class="hljs-comment">// 合并函数包装器</span>
  <span class="hljs-operator">└──</span> <span class="hljs-type">LoserTree</span>&lt;<span class="hljs-type">KeyValue</span>&gt; loserTree                 <span class="hljs-comment">// 败者树</span>
       <span class="hljs-operator">├──</span> int[] tree                                <span class="hljs-comment">// 败者索引数组</span>
       <span class="hljs-operator">├──</span> <span class="hljs-type">List</span>&lt;<span class="hljs-type">LeafIterator</span>&lt;<span class="hljs-type">KeyValue</span>&gt;&gt; leaves       <span class="hljs-comment">// 叶子节点列表</span>
       <span class="hljs-operator">├──</span> <span class="hljs-type">Comparator</span>&lt;<span class="hljs-type">KeyValue</span>&gt; firstComparator      <span class="hljs-comment">// Key 比较器</span>
       <span class="hljs-operator">└──</span> <span class="hljs-type">Comparator</span>&lt;<span class="hljs-type">KeyValue</span>&gt; secondComparator     <span class="hljs-comment">// Sequence 比较器</span>

<span class="hljs-type">SortMergeIterator</span> (内部类)
  <span class="hljs-operator">└──</span> boolean released                               <span class="hljs-comment">// 是否已释放</span>

</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MergeFunctionWrapper&lt;T&gt; mergeFunctionWrapper; <span class="hljs-comment">// MergeFunction的包装器，由'merge-engine'参数绑定</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LoserTree&lt;KeyValue&gt; loserTree; <span class="hljs-comment">// 败者树数据结构</span>

<span class="hljs-keyword">public</span> <span class="hljs-title function_">SortMergeReaderWithLoserTree</span><span class="hljs-params">(
        List&lt;RecordReader&lt;KeyValue&gt;&gt; readers,
        Comparator&lt;InternalRow&gt; userKeyComparator,
        <span class="hljs-meta">@Nullable</span> FieldsComparator userDefinedSeqComparator,
        MergeFunctionWrapper&lt;T&gt; mergeFunctionWrapper)</span> {
    <span class="hljs-built_in">this</span>.mergeFunctionWrapper = mergeFunctionWrapper;
    <span class="hljs-comment">// 创建败者树</span>
    <span class="hljs-built_in">this</span>.loserTree =
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">LoserTree</span>&lt;&gt;(
                    readers, <span class="hljs-comment">// 所有RecordReader，每个RecordReader对应一个败者树节点</span>
                    (e1, e2) -&gt; userKeyComparator.compare(e2.key(), e1.key()), <span class="hljs-comment">// Key的比较器</span>
                    createSequenceComparator(userDefinedSeqComparator)); <span class="hljs-comment">// Sequence比较器</span>
}
</code></pre>
<h4 data-id="heading-7">(2) <code>createSequenceComparator()</code> -- 创建sequence比较器</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 创建sequnce比较器</span>
<span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">Comparator</span>&lt;<span class="hljs-selector-tag">KeyValue</span>&gt; <span class="hljs-selector-tag">createSequenceComparator</span>(
        <span class="hljs-variable">@Nullable</span> FieldsComparator userDefinedSeqComparator) {
    <span class="hljs-selector-tag">if</span> (userDefinedSeqComparator == null) {
        <span class="hljs-comment">// 默认：按 sequenceNumber 降序</span>
        <span class="hljs-selector-tag">return</span> (e1, e2) <span class="hljs-selector-tag">-</span>&gt; <span class="hljs-selector-tag">Long</span><span class="hljs-selector-class">.compare</span>(e2.<span class="hljs-built_in">sequenceNumber</span>(), e1.<span class="hljs-built_in">sequenceNumber</span>());
    }
    <span class="hljs-comment">// 用户自定义sequence-field：先降序比较用户字段，再比较 sequenceNumber</span>
    <span class="hljs-selector-tag">return</span> (o1, o2) <span class="hljs-selector-tag">-</span>&gt; {
        <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">result</span> = <span class="hljs-selector-tag">userDefinedSeqComparator</span><span class="hljs-selector-class">.compare</span>(o2.<span class="hljs-built_in">value</span>(), o1.<span class="hljs-built_in">value</span>());
        <span class="hljs-selector-tag">if</span> (result != <span class="hljs-number">0</span>) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">result</span>;
        }
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Long</span><span class="hljs-selector-class">.compare</span>(o2.<span class="hljs-built_in">sequenceNumber</span>(), o1.<span class="hljs-built_in">sequenceNumber</span>());
    };
}
</code></pre>
<h4 data-id="heading-8">(3) <code>readeBatch()</code></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 与min-heap相比，loser-tree只会产生一个批次</span>
<span class="hljs-comment">// 读取批次</span>
<span class="hljs-meta">@Nullable</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> RecordIterator&lt;T&gt; <span class="hljs-title function_">readBatch</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    loserTree.initializeIfNeeded(); <span class="hljs-comment">// 初始化败者树</span>
    <span class="hljs-comment">// 检查是否有数据</span>
    <span class="hljs-comment">// peekWinner() 返回当前全局赢家，如果为 null 说明还没有全局赢家，需要返回SortMergeIterator</span>
    <span class="hljs-keyword">return</span> loserTree.peekWinner() == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : <span class="hljs-keyword">new</span> <span class="hljs-title class_">SortMergeIterator</span>();
}
</code></pre>
<h4 data-id="heading-9">(4) SortMergeIterator -- 核心</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SortMergeIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RecordIterator</span>&lt;T&gt; {

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">released</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

    <span class="hljs-meta">@Nullable</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">next</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-comment">// 1.调整树并更新下一个winner</span>
            loserTree.adjustForNextLoop();
            <span class="hljs-comment">// 2.弹出这个winner，并更新下下一个winner</span>
            <span class="hljs-type">KeyValue</span> <span class="hljs-variable">winner</span> <span class="hljs-operator">=</span> loserTree.popWinner();
            <span class="hljs-keyword">if</span> (winner == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
            <span class="hljs-comment">// 3.调合并函数的reset()重置缓存</span>
            mergeFunctionWrapper.reset();
            <span class="hljs-comment">// 4.调合并函数对winner进行合并</span>
            mergeFunctionWrapper.add(winner); <span class="hljs-comment">// 记住：Key小的先弹出，Key大的后弹出；旧的数据会先弹出，新的数据会后弹出；</span>
            <span class="hljs-comment">// 5.合并所有相同的Key，并返回合并结果</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> merge();
            <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> result;
            }
        }
    }

    <span class="hljs-keyword">private</span> T <span class="hljs-title function_">merge</span><span class="hljs-params">()</span> {
        Preconditions.checkState(
                !released, <span class="hljs-string">"SortMergeIterator#nextImpl is called after release"</span>);
        <span class="hljs-comment">// 持续弹出相同Key的winner，并重新调整树</span>
        <span class="hljs-keyword">while</span> (loserTree.peekWinner() != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 进行合并</span>
            mergeFunctionWrapper.add(loserTree.popWinner());
        }
        <span class="hljs-comment">// 返回合并结果</span>
        <span class="hljs-keyword">return</span> mergeFunctionWrapper.getResult();
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">releaseBatch</span><span class="hljs-params">()</span> {
        released = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h3 data-id="heading-10">2.LoserTree -- 败者树</h3>
<p>核心点就是Key小的、Sequnece小的优先弹出进行优先聚合；Key大的、Sequence大的最后弹出，再进行聚合</p>
<h4 data-id="heading-11">(1) 核心属性、枚举类等</h4>
<h5 data-id="heading-12">&lt;1&gt; 属性</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span>[] tree; <span class="hljs-comment">// 存储败者索引的数组，tree[0]的值表示当前winner的索引位置</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> size; <span class="hljs-comment">// 叶子节点数量</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;LeafIterator&lt;T&gt;&gt; leaves; <span class="hljs-comment">// 叶子节点列表</span>

<span class="hljs-comment">// 补充：如果comparator.compare('a', 'b') &gt; 0 则认为a是胜者，那么a会作为父节点，b作为叶子节点</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Comparator&lt;T&gt; firstComparator; <span class="hljs-comment">// Key 比较器，优先比较</span>

<span class="hljs-comment">/** same as firstComparator, but mainly used to compare sequenceNumber. */</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Comparator&lt;T&gt; secondComparator; <span class="hljs-comment">// Sequence 比较器，其次比较</span>

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> initialized; <span class="hljs-comment">// 是否已初始化</span>
</code></pre>
<h5 data-id="heading-13">&lt;2&gt; 构造函数</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">LoserTree</span><span class="hljs-params">(
        List&lt;RecordReader&lt;T&gt;&gt; nextBatchReaders,  // 所有待合并的 RecordReader
        Comparator&lt;T&gt; firstComparator,           // Key 比较器
        Comparator&lt;T&gt; secondComparator)</span> {        <span class="hljs-comment">// Sequence 比较器</span>
    <span class="hljs-built_in">this</span>.size = nextBatchReaders.size();
    <span class="hljs-built_in">this</span>.leaves = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(size);
    <span class="hljs-built_in">this</span>.tree = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[size]; <span class="hljs-comment">// 树数组大小等于叶子数量</span>
    
    <span class="hljs-comment">// 如果 compare(a, b) &gt; 0，则 a 是赢家（a 更优）</span>
    <span class="hljs-comment">// 如果 compare(a, b) &lt; 0，则 b 是赢家（b 更优）</span>
    <span class="hljs-comment">// 如果 compare(a, b) = 0，则需要使用 secondComparator 继续比较</span>
    
    <span class="hljs-comment">// null 值处理：</span>
    <span class="hljs-comment">// e1 == null =&gt; 返回 -1（e1 是败者）</span>
    <span class="hljs-comment">// e2 == null =&gt; 返回 1（e1 是赢家）</span>
    <span class="hljs-built_in">this</span>.firstComparator =
            (e1, e2) -&gt; e1 == <span class="hljs-literal">null</span> ? -<span class="hljs-number">1</span> : (e2 == <span class="hljs-literal">null</span> ? <span class="hljs-number">1</span> : firstComparator.compare(e1, e2));
    <span class="hljs-built_in">this</span>.secondComparator =
            (e1, e2) -&gt; e1 == <span class="hljs-literal">null</span> ? -<span class="hljs-number">1</span> : (e2 == <span class="hljs-literal">null</span> ? <span class="hljs-number">1</span> : secondComparator.compare(e1, e2));
    <span class="hljs-built_in">this</span>.initialized = <span class="hljs-literal">false</span>;
    <span class="hljs-comment">// 为每个 RecordReader 创建 LeafIterator 包装器</span>
    <span class="hljs-keyword">for</span> (RecordReader&lt;T&gt; reader : nextBatchReaders) {
        LeafIterator&lt;T&gt; iterator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LeafIterator</span>&lt;&gt;(reader);
        <span class="hljs-built_in">this</span>.leaves.add(iterator);
    }
}
</code></pre>
<h5 data-id="heading-14">&lt;3&gt; State枚举类 -- 核心</h5>
<p>整个算法的核心是根据这个状态去判断是赢家还是输家，然后进行调整父子节点位置的</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">State</span> {
    LOSER_WITH_NEW_KEY(<span class="hljs-literal">false</span>),  <span class="hljs-comment">// 败者，新Key</span>
    LOSER_WITH_SAME_KEY(<span class="hljs-literal">false</span>), <span class="hljs-comment">// 败者，相同Key</span>
    LOSER_POPPED(<span class="hljs-literal">false</span>),        <span class="hljs-comment">// 败者，已弹出</span>
    WINNER_WITH_NEW_KEY(<span class="hljs-literal">true</span>),  <span class="hljs-comment">// 胜者，新Key</span>
    WINNER_WITH_SAME_KEY(<span class="hljs-literal">true</span>), <span class="hljs-comment">// 胜者，相同Key</span>
    WINNER_POPPED(<span class="hljs-literal">true</span>);        <span class="hljs-comment">// 胜者，已弹出</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">boolean</span> winner;

    State(<span class="hljs-type">boolean</span> winner) {
        <span class="hljs-built_in">this</span>.winner = winner;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isWinner</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> winner;
    }
}
</code></pre>
<h5 data-id="heading-15">&lt;4&gt; LeafIterator叶子节点迭代器</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 叶子节点迭代器</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LeafIterator</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Closeable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RecordReader&lt;T&gt; reader; <span class="hljs-comment">// 底层RecordReader</span>

    <span class="hljs-keyword">private</span> RecordReader.RecordIterator&lt;T&gt; iterator; <span class="hljs-comment">// 当前批次迭代器</span>

    <span class="hljs-keyword">private</span> T kv; <span class="hljs-comment">// 当前KeyValue</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> endOfInput; <span class="hljs-comment">// 是否读取完毕</span>

    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> firstSameKeyIndex; <span class="hljs-comment">// 第一个相同Key的索引，这个是从上往下算的</span>

    <span class="hljs-keyword">private</span> State state; <span class="hljs-comment">// 节点状态</span>

    <span class="hljs-keyword">private</span> <span class="hljs-title function_">LeafIterator</span><span class="hljs-params">(RecordReader&lt;T&gt; reader)</span> {
        <span class="hljs-built_in">this</span>.reader = reader;
        <span class="hljs-built_in">this</span>.endOfInput = <span class="hljs-literal">false</span>;
        <span class="hljs-built_in">this</span>.firstSameKeyIndex = -<span class="hljs-number">1</span>;
        <span class="hljs-built_in">this</span>.state = State.WINNER_WITH_NEW_KEY; <span class="hljs-comment">// 默认每个叶子节点都是新Key的胜者，后续会和父节点进行比较</span>
    }
    <span class="hljs-comment">// 返回当前叶子节点的KeyValue</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">peek</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> kv;
    }
    <span class="hljs-comment">// 弹出当前叶子节点的KeyValue，并标记该节点的state为胜者已弹出</span>
    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">pop</span><span class="hljs-params">()</span> {
        <span class="hljs-built_in">this</span>.state = State.WINNER_POPPED;
        <span class="hljs-keyword">return</span> kv;
    }
    <span class="hljs-comment">// 更新第一个相同Key节点的索引位置</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFirstSameKeyIndex</span><span class="hljs-params">(<span class="hljs-type">int</span> index)</span> {
        <span class="hljs-keyword">if</span> (firstSameKeyIndex == -<span class="hljs-number">1</span>) {
            firstSameKeyIndex = index;
        }
    }

    <span class="hljs-comment">// 推进到下一个记录</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">advanceIfAvailable</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-comment">// 重置状态</span>
        <span class="hljs-built_in">this</span>.firstSameKeyIndex = -<span class="hljs-number">1</span>;
        <span class="hljs-built_in">this</span>.state = State.WINNER_WITH_NEW_KEY;
        <span class="hljs-comment">// 尝试从当前迭代器读取下一个记录</span>
        <span class="hljs-keyword">if</span> (iterator == <span class="hljs-literal">null</span> || (kv = iterator.next()) == <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// 当前批次已经读完，需要读取新的批次</span>
            <span class="hljs-keyword">while</span> (!endOfInput) {
                <span class="hljs-keyword">if</span> (iterator != <span class="hljs-literal">null</span>) {
                    iterator.releaseBatch(); <span class="hljs-comment">// 释放当前批次内存</span>
                    iterator = <span class="hljs-literal">null</span>;
                }
                <span class="hljs-comment">// 读取下一批次</span>
                iterator = reader.readBatch();
                <span class="hljs-keyword">if</span> (iterator == <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 所有数据已读完，重置属性</span>
                    endOfInput = <span class="hljs-literal">true</span>;
                    kv = <span class="hljs-literal">null</span>;
                    reader.close();
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((kv = iterator.next()) != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// 成功读取到数据，则break</span>
                    <span class="hljs-keyword">break</span>;
                }
            }
        }
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.iterator != <span class="hljs-literal">null</span>) {
            <span class="hljs-built_in">this</span>.iterator.releaseBatch();
            <span class="hljs-built_in">this</span>.iterator = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-built_in">this</span>.reader.close();
    }
}
</code></pre>
<h4 data-id="heading-16">(2) <code>initializeIfNeeded()</code> -- 初始化败者树</h4>
<p>案例</p>
<pre><code class="hljs language-ini" lang="ini">初始数据:
Leaf 0: <span class="hljs-attr">key</span>=<span class="hljs-number">5</span>, seq=<span class="hljs-number">100</span>
Leaf 1: <span class="hljs-attr">key</span>=<span class="hljs-number">3</span>, seq=<span class="hljs-number">200</span>
Leaf 2: <span class="hljs-attr">key</span>=<span class="hljs-number">7</span>, seq=<span class="hljs-number">150</span>

执行过程:
<span class="hljs-attr">1. i</span>=<span class="hljs-number">2</span>: advanceIfAvailable() → key=<span class="hljs-number">7</span>
        adjust(2) → tree<span class="hljs-section">[某位置]</span> = 2 (败者)
        
<span class="hljs-attr">2. i</span>=<span class="hljs-number">1</span>: advanceIfAvailable() → key=<span class="hljs-number">3</span>
        adjust(1) → 与 Leaf 2 比较
        <span class="hljs-attr">key</span>=<span class="hljs-number">3</span> &lt; key=<span class="hljs-number">7</span> → Leaf <span class="hljs-number">1</span> 更优（赢家）
        
<span class="hljs-attr">3. i</span>=<span class="hljs-number">0</span>: advanceIfAvailable() → key=<span class="hljs-number">5</span>
        adjust(0) → 与当前赢家比较
        <span class="hljs-attr">key</span>=<span class="hljs-number">3</span> &lt; key=<span class="hljs-number">5</span> → Leaf <span class="hljs-number">1</span> 仍是赢家

最终结果:
tree<span class="hljs-section">[0]</span> = 1 (Leaf 1 是全局赢家，<span class="hljs-attr">key</span>=<span class="hljs-number">3</span> 最小，先弹出)
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">initializeIfNeeded</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">if</span> (!initialized) {
        Arrays.fill(tree, -<span class="hljs-number">1</span>); <span class="hljs-comment">// 初始化败者数组为-1，最开始没有败者和胜者</span>
        <span class="hljs-comment">// 从最后一个叶子开始，逐个读取数据并构建败者树</span>
        <span class="hljs-comment">// 为什么从后向前？因为败者树是从叶子向根构建的</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> size - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            leaves.get(i).advanceIfAvailable(); <span class="hljs-comment">// 读取该节点的第一个KeyValue，并更新state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-1</span>
            adjust(i); <span class="hljs-comment">// 调整树结构，让该节点参与比较</span>
        }
        initialized = <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h4 data-id="heading-17">(3) <code>adjustForNextLoop()</code> -- 调整并获取下一个winner</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustForNextLoop</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-comment">// 持续调整直到赢家状态不是 WINNER_POPPED</span>
    <span class="hljs-keyword">while</span> (winner.state == State.WINNER_POPPED) {
        winner.advanceIfAvailable();             <span class="hljs-comment">// 读取下一个 KV</span>
        adjust(tree[<span class="hljs-number">0</span>]);                         <span class="hljs-comment">// 重新调整树，尝试将winner相同Key的节点提到下一次的winnerNode中</span>
        winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    }
}
</code></pre>
<h4 data-id="heading-18">(4) <code>popWinner()</code> -- 弹出当前的赢家，并且标记其为WINNER_POPPED</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 弹出当前的赢家，并且标记其为WINNER_POPPED</span>
<span class="hljs-keyword">public</span> T <span class="hljs-title function_">popWinner</span><span class="hljs-params">()</span> {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-comment">// 如果当前winner已经弹出过，返回 null</span>
    <span class="hljs-keyword">if</span> (winner.state == State.WINNER_POPPED) {
        <span class="hljs-comment">// if the winner has already been popped, it means that all the same key has been</span>
        <span class="hljs-comment">// processed.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-comment">// 如果当前winner没有弹出过，将winner弹出，并标记为WINNER_POPED，重新调整树</span>
    <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> winner.pop();
    adjust(tree[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 重新调整树结构，将该winner相同的Key的下一个节点提到winner位置，以便后续继续弹出该key的数据</span>
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<h4 data-id="heading-19">(5) <code>peekWinner()</code> -- 找到当前的赢家</h4>
<p>返回当前的赢家，不可以是已经处理过的赢家；否则，返回null。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">peekWinner</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// 返回当前的赢家，不可以是已经处理过的赢家</span>
    <span class="hljs-keyword">return</span> leaves.get(tree[<span class="hljs-number">0</span>]).state != State.WINNER_POPPED ? leaves.get(tree[<span class="hljs-number">0</span>]).peek() : <span class="hljs-literal">null</span>;
}
</code></pre>
<h4 data-id="heading-20">(6) <code>adjust()</code> -- 算法核心</h4>
<blockquote>
<p>补充：<code>adjust(tree[0])</code>：重新调整树，尝试将当前tree[0]对应winner的相同Key的节点提到下一次的winnerNode中，进行交换位置；如果没有这相同的Key，则进行比较其parent位置节点，进行更新winner</p>
</blockquote>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjust</span><span class="hljs-params">(<span class="hljs-type">int</span> winner)</span> {
    <span class="hljs-comment">// 核心循环：从叶子节点向上遍历到根节点，这里的winner最开始是当前节点</span>
    <span class="hljs-comment">// parent 计算公式：(winner + size) / 2</span>
    <span class="hljs-comment">// 这是完全二叉树的父节点索引计算公式（数组从 0 开始）</span>
    <span class="hljs-comment">// 从叶子节点向上遍历到根节点</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">parent</span> <span class="hljs-operator">=</span> (winner + <span class="hljs-built_in">this</span>.size) / <span class="hljs-number">2</span>; parent &gt; <span class="hljs-number">0</span> &amp;&amp; winner &gt;= <span class="hljs-number">0</span>; parent /= <span class="hljs-number">2</span>) {
        LeafIterator&lt;T&gt; winnerNode = leaves.get(winner);
        LeafIterator&lt;T&gt; parentNode;
        <span class="hljs-comment">// CASE-1: 初始化阶段，都还没有败者和胜者，那么将当前的winner标记为新key败者，以便后续比较</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.tree[parent] == -<span class="hljs-number">1</span>) {
            <span class="hljs-comment">// 重新设置winner节点状态为LOSER_WITH_NEW_KEY</span>
            winnerNode.state = State.LOSER_WITH_NEW_KEY;
        }
        <span class="hljs-comment">// CASE-2: 正常调整，已经有败者了</span>
        <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 获取当前节点的父节点</span>
            parentNode = leaves.get(<span class="hljs-built_in">this</span>.tree[parent]);
            <span class="hljs-comment">// 根据 winner 的当前状态，选择不同的调整策略</span>
            <span class="hljs-keyword">switch</span> (winnerNode.state) {
                <span class="hljs-keyword">case</span> WINNER_WITH_NEW_KEY:
                    <span class="hljs-comment">// winner 持有新 Key，需要完整比较，调adjustWithNewWinnerKey()去处理</span>
                    adjustWithNewWinnerKey(parent, parentNode, winnerNode);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> WINNER_WITH_SAME_KEY:
                    <span class="hljs-comment">// winner 持有相同 Key，只需比较 Sequence，调adjustWithSameWinnerKey()去处理</span>
                    adjustWithSameWinnerKey(parent, parentNode, winnerNode);
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> WINNER_POPPED:
                    <span class="hljs-comment">// winner 已被弹出，快速路径优化</span>
                    <span class="hljs-keyword">if</span> (winnerNode.firstSameKeyIndex &lt; <span class="hljs-number">0</span>) {
                        <span class="hljs-comment">// 没有更多相同 Key 了，停止调整</span>
                        parent = -<span class="hljs-number">1</span>;
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-comment">// 快速路径：根据winner节点记录的firstSameKeyIndex，直接跳转到第一个相同 Key 的位置</span>
                        <span class="hljs-comment">// 更新winner节点的state为LOSER_POPPED，并更新parentNode和其状态，后续会交换</span>
                        parent = winnerNode.firstSameKeyIndex;
                        parentNode = leaves.get(<span class="hljs-built_in">this</span>.tree[parent]);
                        winnerNode.state = State.LOSER_POPPED;
                        parentNode.state = State.WINNER_WITH_SAME_KEY;
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                            <span class="hljs-string">"unknown state for "</span> + winnerNode.state.name());
            }
        }

        <span class="hljs-comment">// if the winner loses, exchange nodes.</span>
        <span class="hljs-comment">// 如果处理完，最开始的胜者节点状态变了，不再是胜者了，那么调整胜者节点</span>
        <span class="hljs-comment">// 原 parent 中的败者成为新 winner，继续向上比较</span>
        <span class="hljs-keyword">if</span> (!winnerNode.state.isWinner()) {
            <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> winner;
            winner = <span class="hljs-built_in">this</span>.tree[parent];
            <span class="hljs-built_in">this</span>.tree[parent] = tmp;
        }
    }
    <span class="hljs-comment">// 循环结束，最终 winner 到达根节点</span>
    <span class="hljs-built_in">this</span>.tree[<span class="hljs-number">0</span>] = winner;
}
</code></pre>
<h4 data-id="heading-21">(7) <code>adjustWithNewWinnerKey()</code> -- 新Key赢家的处理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustWithNewWinnerKey</span><span class="hljs-params">(
        <span class="hljs-type">int</span> index, LeafIterator&lt;T&gt; parentNode, LeafIterator&lt;T&gt; winnerNode)</span> {
    <span class="hljs-comment">// 处理场景：当前 winner 持有的是新 Key（与全局赢家不同）</span>
    <span class="hljs-comment">// 判断父节点情况</span>
    <span class="hljs-keyword">switch</span> (parentNode.state) {
        <span class="hljs-comment">// CASE-1: parentNode 也是新 Key，需要完整比较</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_NEW_KEY:
            <span class="hljs-comment">// when the new winner is also a new key, it needs to be compared.</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">parentKey</span> <span class="hljs-operator">=</span> parentNode.peek();
            <span class="hljs-type">T</span> <span class="hljs-variable">childKey</span> <span class="hljs-operator">=</span> winnerNode.peek();
            <span class="hljs-comment">/* 1.先比较Key，
            注意：SortMergeReaderWithLoserTree传入的Key比较器是(e1, e2) -&gt; userKeyComparator.compare(e2.key(), e1.key())
            firstComparator.compare(parentKey, childKey)
                返回&gt;0，表示child的key大，parent是赢家
                返回&lt;0，表示parent的key大，child是赢家
                返回=0，表示一样大，需要再进行Sequence比较
             */</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">firstResult</span> <span class="hljs-operator">=</span> firstComparator.compare(parentKey, childKey);
            <span class="hljs-comment">// SUB-CASE-1: Key一样，再进行Sequence比较</span>
            <span class="hljs-keyword">if</span> (firstResult == <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// 注意：secondComparator其实是(e1, e2) -&gt; Long.compare(e2.sequenceNumber(), e1.sequenceNumber());</span>
                <span class="hljs-type">int</span> <span class="hljs-variable">secondResult</span> <span class="hljs-operator">=</span> secondComparator.compare(parentKey, childKey);

                <span class="hljs-comment">// parent的Sequence更大，child是旧的数据，因此，它是赢家，优先弹出</span>
                <span class="hljs-keyword">if</span> (secondResult &lt; <span class="hljs-number">0</span>) {
                    parentNode.state = State.LOSER_WITH_SAME_KEY;
                    winnerNode.setFirstSameKeyIndex(index); <span class="hljs-comment">// 记录相同 Key 的位置</span>
                }
                <span class="hljs-comment">// child 的 Sequence 更大或相等，parent是旧的数据，则parent是赢家，优先弹出</span>
                <span class="hljs-keyword">else</span> {
                    winnerNode.state = State.LOSER_WITH_SAME_KEY;
                    parentNode.state = State.WINNER_WITH_NEW_KEY;
                    parentNode.setFirstSameKeyIndex(index);
                }
            }
            <span class="hljs-comment">// SUB-CASE-2: child的Key大，则 parent是赢家，需更新俩节点状态</span>
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (firstResult &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-comment">// the two keys are completely different and just need to update the state.</span>
                parentNode.state = State.WINNER_WITH_NEW_KEY;
                winnerNode.state = State.LOSER_WITH_NEW_KEY;
            }
            <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// CASE-2: 不可能的情况，因为相同的key会走adjustWithSameWinnerKey这个方法，直接抛出异常</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_SAME_KEY:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(
                    <span class="hljs-string">"This is a bug. Please file an issue. A node in the WINNER_WITH_NEW_KEY "</span>
                            + <span class="hljs-string">"state cannot encounter a node in the LOSER_WITH_SAME_KEY state."</span>);
        <span class="hljs-comment">// CASE-3: 仅发生在 adjustForNextLoop 中</span>
        <span class="hljs-comment">// parent 已经被弹出处理过，现在有新数据进来</span>
        <span class="hljs-keyword">case</span> LOSER_POPPED:
            parentNode.state = State.WINNER_POPPED;
            parentNode.firstSameKeyIndex = -<span class="hljs-number">1</span>;
            winnerNode.state = State.LOSER_WITH_NEW_KEY;
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                    <span class="hljs-string">"unknown state for "</span> + parentNode.state.name());
    }
}
</code></pre>
<h4 data-id="heading-22">(8) <code>adjustWithSameWinnerKey()</code> -- 相同key赢家的处理</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustWithSameWinnerKey</span><span class="hljs-params">(
        <span class="hljs-type">int</span> index, LeafIterator&lt;T&gt; parentNode, LeafIterator&lt;T&gt; winnerNode)</span> {
    <span class="hljs-keyword">switch</span> (parentNode.state) {
        <span class="hljs-comment">// CASE-1: parent有相同的Key，则只需要再比较Sequnece即可</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_SAME_KEY:
            <span class="hljs-comment">// the key of the previous loser is the same as the key of the current winner,</span>
            <span class="hljs-comment">// only the sequence needs to be compared.</span>
            <span class="hljs-type">T</span> <span class="hljs-variable">parentKey</span> <span class="hljs-operator">=</span> parentNode.peek();
            <span class="hljs-type">T</span> <span class="hljs-variable">childKey</span> <span class="hljs-operator">=</span> winnerNode.peek();
            <span class="hljs-comment">// 比较Sequence</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">secondResult</span> <span class="hljs-operator">=</span> secondComparator.compare(parentKey, childKey);
            <span class="hljs-comment">// child 的 Sequence 更大，parent 是旧的，需要先弹出，调整两节点的状态</span>
            <span class="hljs-keyword">if</span> (secondResult &gt; <span class="hljs-number">0</span>) {
                parentNode.state = State.WINNER_WITH_SAME_KEY;
                winnerNode.state = State.LOSER_WITH_SAME_KEY;
                parentNode.setFirstSameKeyIndex(index);
            }
            <span class="hljs-comment">// parent 的 Sequence 更大，child 是旧的，需要先弹出，不需要调整状态，只需要记录index即可</span>
            <span class="hljs-keyword">else</span> {
                winnerNode.setFirstSameKeyIndex(index);
            }
            <span class="hljs-keyword">return</span>;
        <span class="hljs-comment">// CASE-2: 其他情况，都不在这个方法处理，会在adjustWithNewWinnerKey()中处理</span>
        <span class="hljs-keyword">case</span> LOSER_WITH_NEW_KEY:
        <span class="hljs-keyword">case</span> LOSER_POPPED:
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">default</span>:
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UnsupportedOperationException</span>(
                    <span class="hljs-string">"unknown state for "</span> + parentNode.state.name());
    }
}
</code></pre>
<h3 data-id="heading-23">3.流程总结</h3>
<h4 data-id="heading-24">(1) 初始状态</h4>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>]
<span class="hljs-attr">size</span> = <span class="hljs-number">3</span>

所有 Leaf 初始状态：
Leaf 0: <span class="hljs-attr">kv</span>=null, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">kv</span>=null, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">kv</span>=null, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<h4 data-id="heading-25">(2) initializeIfNeeded阶段</h4>
<h5 data-id="heading-26">&lt;1&gt; 步骤 1：i=2, adjust(2)</h5>
<p><code>advanceIfAvailable()</code></p>
<pre><code class="hljs language-ini" lang="ini">Leaf 2 读取第一条记录
Leaf 2: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<p><code>adjust(2)</code></p>
<pre><code class="hljs language-java" lang="java">winner = <span class="hljs-number">2</span>
parent = (<span class="hljs-number">2</span> + <span class="hljs-number">3</span>) / <span class="hljs-number">2</span> = <span class="hljs-number">2</span>

循环第 <span class="hljs-number">1</span> 轮：parent=<span class="hljs-number">2</span>, winner=<span class="hljs-number">2</span>
  winnerNode = Leaf <span class="hljs-number">2</span>
  tree[<span class="hljs-number">2</span>] == -<span class="hljs-number">1</span>  <span class="hljs-comment">// 初始化分支</span>
  → winnerNode.state = LOSER_WITH_NEW_KEY
  
  !winnerNode.state.isWinner() = <span class="hljs-literal">true</span>（是 LOSER）
  → 交换：
     tmp = <span class="hljs-number">2</span>
     winner = tree[<span class="hljs-number">2</span>] = -<span class="hljs-number">1</span>
     tree[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>
  
  winner = -<span class="hljs-number">1</span>
  parent /= <span class="hljs-number">2</span> → parent = <span class="hljs-number">1</span>
  循环条件：<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span> &amp;&amp; -<span class="hljs-number">1</span> &gt;= <span class="hljs-number">0</span> → <span class="hljs-literal">false</span>

tree[<span class="hljs-number">0</span>] = -<span class="hljs-number">1</span>
</code></pre>
<p><strong>结果</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]
Leaf 2: <span class="hljs-attr">state</span>=LOSER_WITH_NEW_KEY
</code></pre>
<h5 data-id="heading-27">&lt;2&gt; 步骤 2：i=1, adjust(1)</h5>
<p><code>advanceIfAvailable()</code></p>
<pre><code class="hljs language-ini" lang="ini">Leaf 1: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<p><code>adjust(1)</code></p>
<pre><code class="hljs language-java" lang="java">winner = <span class="hljs-number">1</span>
parent = (<span class="hljs-number">1</span> + <span class="hljs-number">3</span>) / <span class="hljs-number">2</span> = <span class="hljs-number">2</span>

循环第 <span class="hljs-number">1</span> 轮：parent=<span class="hljs-number">2</span>, winner=<span class="hljs-number">1</span>
  winnerNode = Leaf <span class="hljs-number">1</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, state=WINNER_WITH_NEW_KEY)
  tree[<span class="hljs-number">2</span>] == <span class="hljs-number">2</span>
  parentNode = Leaf <span class="hljs-number">2</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, state=LOSER_WITH_NEW_KEY)
  
  winnerNode.state = WINNER_WITH_NEW_KEY
  → 调用 adjustWithNewWinnerKey(<span class="hljs-number">2</span>, Leaf <span class="hljs-number">2</span>, Leaf <span class="hljs-number">1</span>)
  
  adjustWithNewWinnerKey():
    parentNode.state = <span class="hljs-type">LOSER_WITH_NEW_KEY</span>
    <span class="hljs-variable">parentKey</span> <span class="hljs-operator">=</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>}
    childKey = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>}
    
    firstResult = firstComparator.compare(parentKey, childKey)
                = userKeyComparator.compare(childKey, parentKey)
                = userKeyComparator.compare({key=<span class="hljs-number">1</span>}, {key=<span class="hljs-number">1</span>})
                = <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// Key 相同，比较 Sequence</span>
    secondResult = secondComparator.compare(parentKey, childKey)
                 = Long.compare(childKey.seq, parentKey.seq)
                 = Long.compare(<span class="hljs-number">200</span>, <span class="hljs-number">150</span>)
                 = <span class="hljs-number">50</span> &gt; <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// secondResult &gt; 0，进入 else 分支</span>
    <span class="hljs-comment">// parent 的 seq 更小，parent 是赢家</span>
    winnerNode.state = LOSER_WITH_SAME_KEY
    parentNode.state = WINNER_WITH_NEW_KEY
    parentNode.setFirstSameKeyIndex(<span class="hljs-number">2</span>)  <span class="hljs-comment">// 记录 index=2</span>
    
    <span class="hljs-comment">// Leaf 2.firstSameKeyIndex == -1，设置为 2</span>
    Leaf <span class="hljs-number">2.</span>firstSameKeyIndex = <span class="hljs-number">2</span>
  
  <span class="hljs-comment">// 返回后检查</span>
  !winnerNode.state.isWinner() = <span class="hljs-literal">true</span>（Leaf <span class="hljs-number">1</span> 是 LOSER）
  → 交换：
     tmp = <span class="hljs-number">1</span>
     winner = tree[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>
     tree[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
  
  winner = <span class="hljs-number">2</span>
  parent /= <span class="hljs-number">2</span> → parent = <span class="hljs-number">1</span>

循环第 <span class="hljs-number">2</span> 轮：parent=<span class="hljs-number">1</span>, winner=<span class="hljs-number">2</span>
  winnerNode = Leaf <span class="hljs-number">2</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, state=WINNER_WITH_NEW_KEY)
  tree[<span class="hljs-number">1</span>] == -<span class="hljs-number">1</span>  <span class="hljs-comment">// 初始化分支</span>
  → winnerNode.state = LOSER_WITH_NEW_KEY
  
  !isWinner() = <span class="hljs-literal">true</span>
  → 交换：
     tmp = <span class="hljs-number">2</span>
     winner = tree[<span class="hljs-number">1</span>] = -<span class="hljs-number">1</span>
     tree[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
  
  winner = -<span class="hljs-number">1</span>
  parent = <span class="hljs-number">0</span>
  循环条件：<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> → <span class="hljs-literal">false</span>

tree[<span class="hljs-number">0</span>] = -<span class="hljs-number">1</span>
</code></pre>
<p><strong>结果</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [-<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]
Leaf 1: <span class="hljs-attr">state</span>=LOSER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=LOSER_WITH_NEW_KEY, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h5 data-id="heading-28">&lt;3&gt; 步骤 3：i=0, adjust(0)</h5>
<p><code>advanceIfAvailable()</code></p>
<pre><code class="hljs language-ini" lang="ini">Leaf 0: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
</code></pre>
<p><code>adjust(0)</code></p>
<pre><code class="hljs language-java" lang="java">winner = <span class="hljs-number">0</span>
parent = (<span class="hljs-number">0</span> + <span class="hljs-number">3</span>) / <span class="hljs-number">2</span> = <span class="hljs-number">1</span>

循环第 <span class="hljs-number">1</span> 轮：parent=<span class="hljs-number">1</span>, winner=<span class="hljs-number">0</span>
  winnerNode = Leaf <span class="hljs-number">0</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, state=WINNER_WITH_NEW_KEY)
  tree[<span class="hljs-number">1</span>] == <span class="hljs-number">2</span>
  parentNode = Leaf <span class="hljs-number">2</span> (key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, state=LOSER_WITH_NEW_KEY)
  
  调用 adjustWithNewWinnerKey(<span class="hljs-number">1</span>, Leaf <span class="hljs-number">2</span>, Leaf <span class="hljs-number">0</span>):
    parentKey = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>}
    childKey = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>}
    
    firstResult = compare({key=<span class="hljs-number">1</span>}, {key=<span class="hljs-number">1</span>}) = <span class="hljs-number">0</span>
    
    secondResult = Long.compare(<span class="hljs-number">100</span>, <span class="hljs-number">150</span>) = -<span class="hljs-number">50</span> &lt; <span class="hljs-number">0</span>
    
    <span class="hljs-comment">// secondResult &lt; 0，进入 if 分支</span>
    <span class="hljs-comment">// child 的 seq 更小，child 是赢家</span>
    parentNode.state = LOSER_WITH_SAME_KEY
    winnerNode.setFirstSameKeyIndex(<span class="hljs-number">1</span>)
    
    Leaf <span class="hljs-number">0.</span>firstSameKeyIndex = <span class="hljs-number">1</span>
  
  <span class="hljs-comment">// winnerNode 还是 WINNER</span>
  !isWinner() = <span class="hljs-literal">false</span>
  → 不交换
  
  winner = <span class="hljs-number">0</span>
  parent = <span class="hljs-number">0</span>
  循环条件：<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> → <span class="hljs-literal">false</span>

tree[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>
</code></pre>
<h5 data-id="heading-29">&lt;4&gt; 初始化完成</h5>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]
- tree<span class="hljs-section">[0]</span> = 0 → 全局赢家 Leaf 0 (<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>)
- tree<span class="hljs-section">[1]</span> = 2 → 败者 Leaf 2 (<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>)
- tree<span class="hljs-section">[2]</span> = 1 → 败者 Leaf 1 (<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>)

Leaf 0: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>}, state=WINNER_WITH_NEW_KEY, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>}, state=LOSER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">kv</span>={key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>}, state=LOSER_WITH_SAME_KEY, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h4 data-id="heading-30">(3) SortMergeIterator.next() 执行</h4>
<p>第一次调用 next()</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">next</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        loserTree.adjustForNextLoop();       <span class="hljs-comment">// 步骤 1</span>
        <span class="hljs-type">KeyValue</span> <span class="hljs-variable">winner</span> <span class="hljs-operator">=</span> loserTree.popWinner(); <span class="hljs-comment">// 步骤 2</span>
        <span class="hljs-keyword">if</span> (winner == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        
        mergeFunctionWrapper.reset();        <span class="hljs-comment">// 步骤 3</span>
        mergeFunctionWrapper.add(winner);    <span class="hljs-comment">// 步骤 4</span>
        
        <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> merge();                  <span class="hljs-comment">// 步骤 5</span>
        <span class="hljs-keyword">if</span> (result != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h5 data-id="heading-31">&lt;1&gt; 步骤 1：adjustForNextLoop()</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">adjustForNextLoop</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">while</span> (winner.state == State.WINNER_POPPED) {
        winner.advanceIfAvailable();
        adjust(tree[<span class="hljs-number">0</span>]);
        winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    }
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">winner</span> = leaves.get(<span class="hljs-number">0</span>) = Leaf <span class="hljs-number">0</span>
Leaf <span class="hljs-attr">0.state</span> = WINNER_WITH_NEW_KEY ≠ WINNER_POPPED
→ 循环条件不满足，直接返回
</code></pre>
<h5 data-id="heading-32">&lt;2&gt; 步骤 2：popWinner()</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> T <span class="hljs-title function_">popWinner</span><span class="hljs-params">()</span> {
    LeafIterator&lt;T&gt; winner = leaves.get(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">if</span> (winner.state == State.WINNER_POPPED) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }
    <span class="hljs-type">T</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> winner.pop();
    adjust(tree[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">return</span> result;
}
</code></pre>
<pre><code class="hljs language-java" lang="java">winner = Leaf <span class="hljs-number">0</span>
Leaf <span class="hljs-number">0.</span>state = WINNER_WITH_NEW_KEY ≠ <span class="hljs-type">WINNER_POPPED</span>

<span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Leaf <span class="hljs-number">0.</span>pop()
  Leaf <span class="hljs-number">0.</span>state = WINNER_POPPED
  <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}

调用 adjust(<span class="hljs-number">0</span>):
  winner = <span class="hljs-number">0</span>
  parent = <span class="hljs-number">1</span>
  
  循环第 <span class="hljs-number">1</span> 轮：
    winnerNode = Leaf <span class="hljs-number">0</span> (state=WINNER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>)
    tree[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
    parentNode = Leaf <span class="hljs-number">2</span>
    
    <span class="hljs-comment">// WINNER_POPPED 分支</span>
    firstSameKeyIndex = <span class="hljs-number">1</span> ≥ <span class="hljs-number">0</span>
    → 快速路径
    parent = <span class="hljs-number">1</span>
    parentNode = Leaf <span class="hljs-number">2</span> (tree[<span class="hljs-number">1</span>])
    
    Leaf <span class="hljs-number">0.</span>state = LOSER_POPPED
    Leaf <span class="hljs-number">2.</span>state = WINNER_WITH_SAME_KEY
    
    <span class="hljs-comment">// 检查 !winnerNode.state.isWinner()</span>
    <span class="hljs-comment">// Leaf 0 现在是 LOSER_POPPED (不是赢家)</span>
    !isWinner() = <span class="hljs-literal">true</span>
    → 交换：
       tmp = <span class="hljs-number">0</span>
       winner = tree[<span class="hljs-number">1</span>] = <span class="hljs-number">2</span>
       tree[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>
    
    winner = <span class="hljs-number">2</span>
    parent = <span class="hljs-number">0</span>
    循环条件：<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> → <span class="hljs-literal">false</span>
  
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">2</span>

返回：{key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}
</code></pre>
<p><strong>当前状态</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]
- tree<span class="hljs-section">[0]</span> = 2 → Leaf 2 是新的全局赢家

Leaf 0: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">state</span>=LOSER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=WINNER_WITH_SAME_KEY, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h5 data-id="heading-33">&lt;3&gt; 步骤 3-4：reset() 和 add()</h5>
<pre><code class="hljs language-ini" lang="ini">mergeFunctionWrapper.reset()<span class="hljs-comment">;</span>
  <span class="hljs-attr">latestKv</span> = null

mergeFunctionWrapper.add({<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>})<span class="hljs-comment">;</span>
  <span class="hljs-attr">latestKv</span> = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">100</span>, value=<span class="hljs-string">"A"</span>}
</code></pre>
<h5 data-id="heading-34">&lt;4&gt; 步骤 5：merge()</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> T <span class="hljs-title function_">merge</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">while</span> (loserTree.peekWinner() != <span class="hljs-literal">null</span>) {
        mergeFunctionWrapper.add(loserTree.popWinner());
    }
    <span class="hljs-keyword">return</span> mergeFunctionWrapper.getResult();
}
</code></pre>
<h6 data-id="heading-35">《1》第 1 次循环</h6>
<pre><code class="hljs language-java" lang="java">peekWinner():
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">2</span>
  Leaf <span class="hljs-number">2.</span>state = WINNER_WITH_SAME_KEY ≠ WINNER_POPPED
  <span class="hljs-keyword">return</span> Leaf <span class="hljs-number">2.</span>peek() = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}  ✅

popWinner():
  winner = Leaf <span class="hljs-number">2</span>
  Leaf <span class="hljs-number">2.</span>state ≠ <span class="hljs-type">WINNER_POPPED</span>
  
  <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Leaf <span class="hljs-number">2.</span>pop()
    Leaf <span class="hljs-number">2.</span>state = WINNER_POPPED
    <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}
  
  adjust(<span class="hljs-number">2</span>):
    winner = <span class="hljs-number">2</span>
    parent = <span class="hljs-number">2</span>
    
    winnerNode = Leaf <span class="hljs-number">2</span> (WINNER_POPPED, firstSameKeyIndex=<span class="hljs-number">2</span>)
    tree[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
    parentNode = Leaf <span class="hljs-number">1</span>
    
    firstSameKeyIndex = <span class="hljs-number">2</span> ≥ <span class="hljs-number">0</span>
    parent = <span class="hljs-number">2</span>
    parentNode = Leaf <span class="hljs-number">1</span> (tree[<span class="hljs-number">2</span>])
    
    Leaf <span class="hljs-number">2.</span>state = LOSER_POPPED
    Leaf <span class="hljs-number">1.</span>state = WINNER_WITH_SAME_KEY
    
    !isWinner() = <span class="hljs-literal">true</span>
    → 交换：
       tmp = <span class="hljs-number">2</span>
       winner = tree[<span class="hljs-number">2</span>] = <span class="hljs-number">1</span>
       tree[<span class="hljs-number">2</span>] = <span class="hljs-number">2</span>
    
    winner = <span class="hljs-number">1</span>
    parent = <span class="hljs-number">1</span>
    
    循环第 <span class="hljs-number">2</span> 轮：
      winnerNode = Leaf <span class="hljs-number">1</span> (WINNER_WITH_SAME_KEY)
      tree[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>
      parentNode = Leaf <span class="hljs-number">0</span> (LOSER_POPPED)
      
      <span class="hljs-comment">// adjustWithSameWinnerKey</span>
      parentNode.state = LOSER_POPPED
      → <span class="hljs-keyword">return</span>（不处理）
      
      !isWinner() = <span class="hljs-literal">false</span>（Leaf <span class="hljs-number">1</span> 是 WINNER）
      → 不交换
      
      parent = <span class="hljs-number">0</span>
      循环条件：<span class="hljs-number">0</span> &gt; <span class="hljs-number">0</span> → <span class="hljs-literal">false</span>
    
    tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>

add({key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>}):
  latestKv = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">150</span>, value=<span class="hljs-string">"C"</span>} <span class="hljs-comment">// 弹出</span>
</code></pre>
<p><strong>当前状态</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>]

Leaf 0: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">state</span>=WINNER_WITH_SAME_KEY, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h6 data-id="heading-36">《2》第 2 次循环</h6>
<pre><code class="hljs language-java" lang="java">peekWinner():
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>
  Leaf <span class="hljs-number">1.</span>state = WINNER_WITH_SAME_KEY ≠ WINNER_POPPED
  <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}  ✅

popWinner():
  result = Leaf <span class="hljs-number">1.</span>pop()
    Leaf <span class="hljs-number">1.</span>state = WINNER_POPPED
    <span class="hljs-keyword">return</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}
  
  adjust(<span class="hljs-number">1</span>):
    winner = <span class="hljs-number">1</span>
    parent = <span class="hljs-number">2</span>
    
    winnerNode = Leaf <span class="hljs-number">1</span> (WINNER_POPPED, firstSameKeyIndex=-<span class="hljs-number">1</span>)
    
    firstSameKeyIndex = -<span class="hljs-number">1</span> &lt; <span class="hljs-number">0</span>
    → parent = -<span class="hljs-number">1</span>（停止调整）
    
    !isWinner() = <span class="hljs-literal">false</span> → 不处理
    
    循环条件：-<span class="hljs-number">1</span> &gt; <span class="hljs-number">0</span> → <span class="hljs-literal">false</span>
    
    tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>

add({key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}):
  latestKv = {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}  <span class="hljs-comment">// 弹出</span>
</code></pre>
<p><strong>当前状态</strong>：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">tree</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>]

Leaf 0: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">1</span>
Leaf 1: <span class="hljs-attr">state</span>=WINNER_POPPED, firstSameKeyIndex=-<span class="hljs-number">1</span>
Leaf 2: <span class="hljs-attr">state</span>=LOSER_POPPED, firstSameKeyIndex=<span class="hljs-number">2</span>
</code></pre>
<h6 data-id="heading-37">《3》第 3 次循环</h6>
<pre><code class="hljs language-java" lang="java">peekWinner():
  tree[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>
  Leaf <span class="hljs-number">1.</span>state = WINNER_POPPED
  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>  ❌

循环结束

getResult():
  <span class="hljs-type">return</span> <span class="hljs-variable">latestKv</span> <span class="hljs-operator">=</span> {key=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}
</code></pre>
<hr/>
<h4 data-id="heading-38">(4) 最终结果</h4>
<pre><code class="hljs language-ini" lang="ini">以deduplicate覆盖为例子
next() 返回：{<span class="hljs-attr">key</span>=<span class="hljs-number">1</span>, seq=<span class="hljs-number">200</span>, value=<span class="hljs-string">"B"</span>}

所有相同 Key 的记录都被收集：
<span class="hljs-attr">1. seq</span>=<span class="hljs-number">100</span> 先添加
<span class="hljs-attr">2. seq</span>=<span class="hljs-number">150</span> 覆盖
<span class="hljs-attr">3. seq</span>=<span class="hljs-number">200</span> 最终覆盖

保留的是 Sequence 最大（最新）的数据
</code></pre>
<p>官方案例请看<a href="https://link.juejin.cn?target=https%3A%2F%2Fcwiki.apache.org%2Fconfluence%2Fdisplay%2FPAIMON%2FPIP-2%253A%2BOptimize%2BSortMergeReader%2Bwith%2BLoserTree" target="_blank" title="https://cwiki.apache.org/confluence/display/PAIMON/PIP-2%3A+Optimize+SortMergeReader+with+LoserTree" ref="nofollow noopener noreferrer">PIP-2: Optimize SortMergeReader with LoserTree - Paimon - Apache Software Foundation</a></p>
<p>补充:<code>sequence-field</code>和<code>sequence-group</code>的区别
分工如下</p>
<pre><code class="hljs language-vbnet" lang="vbnet">┌─────────────────────────────────────────────────────┐
│  第一层：LoserTree（全局排序层）                      │
│  - 职责：按 <span class="hljs-keyword">Key</span> + sequence.field 全局排序             │
│  - 目标：确保相同 <span class="hljs-keyword">Key</span> 的记录按sequence-field的顺序弹出  │
│  - 比较器：userDefinedSeqComparator（表级全局）        │
└─────────────────────────────────────────────────────┘
                      ↓ 按序弹出记录
┌─────────────────────────────────────────────────────┐
│  第二层：MergeFunction（字段级合并层）                │
│  - 职责：字段级别的细粒度合并控制                      │
│  - 目标：不同字段可以有独立的更新策略                   │
│  - 比较器：sequence-<span class="hljs-keyword">group</span>（字段级局部）                │
└─────────────────────────────────────────────────────┘

</code></pre>
<ol>
<li><code>sequence-field</code>是全局绑定，在loser-tree中决定哪些数据先弹出</li>
<li><code>sequence-group</code>是字段绑定，在mergefunction的时候会去进行相应的聚合判断</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[老项目改造 vue-cli 2.6 升级 rsbuild 提升开发效率300% upupup！！！]]></title>    <link>https://juejin.cn/post/7584633505105215540</link>    <guid>https://juejin.cn/post/7584633505105215540</guid>    <pubDate>2025-12-17T10:01:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584633505105215540" data-draft-id="7584472215975477263" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="老项目改造 vue-cli 2.6 升级 rsbuild 提升开发效率300% upupup！！！"/> <meta itemprop="keywords" content="前端,性能优化"/> <meta itemprop="datePublished" content="2025-12-17T10:01:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="还好还好不是吗"/> <meta itemprop="url" content="https://juejin.cn/user/1781663850575198"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            老项目改造 vue-cli 2.6 升级 rsbuild 提升开发效率300% upupup！！！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1781663850575198/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    还好还好不是吗
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T10:01:13.000Z" title="Wed Dec 17 2025 10:01:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>先上图打包 100m大小和时间37秒</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e58782afde845138d711501b5401518~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=PFzECq%2BWAsGw%2FmOfowfOIN%2FFjnQ%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/335f37d763f44668bd1988238d8e2092~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=e4iAzSSz5TQNxh%2FD%2FxIQI3LW5jc%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8849ce8212642ae9e99bf17a3314834~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=AqiTB1lWtFDqHy5lPS9SetVO20M%3D" alt="image.png" loading="lazy"/></p>
<p>升级后打包37秒</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52c6fdc204d944c4ac7dab0aaa609273~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-Y5aW96L-Y5aW95LiN5piv5ZCX:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766570473&amp;x-signature=50kLNk5SzZ6nDEIV0yyf2VJSh3U%3D" alt="image.png" loading="lazy"/></p>
<p>启动项目2秒左右
打开第一次页面7秒左右后续正常访问 总的9秒左右 和vite差不多项目很大</p>
<p>先上vue-cli 升级示例项目
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1438343098%2Frsbuild-less-module-bug" target="_blank" title="https://github.com/1438343098/rsbuild-less-module-bug" ref="nofollow noopener noreferrer">github.com/1438343098/…</a></p>
<p>贴配置</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/core'</span>
<span class="hljs-keyword">import</span> { pluginVue2 } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-vue2'</span>
<span class="hljs-keyword">import</span> { pluginBabel } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-babel'</span>
<span class="hljs-keyword">import</span> { pluginVue2Jsx } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-vue2-jsx'</span>
<span class="hljs-keyword">import</span> { pluginNodePolyfill } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-node-polyfill'</span>
<span class="hljs-keyword">import</span> { pluginBasicSsl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-basic-ssl'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">resolve</span> = dir =&gt; path.<span class="hljs-title function_">resolve</span>(__dirname, dir)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-title function_">pluginNodePolyfill</span>(),
    <span class="hljs-title function_">pluginBabel</span>({
      <span class="hljs-comment">// 处理子包</span>
      <span class="hljs-attr">include</span>: [<span class="hljs-regexp">/src/</span>, <span class="hljs-regexp">/@kuaizi\/saas-components/</span>],
      <span class="hljs-attr">babelLoaderOptions</span>: {
        <span class="hljs-attr">presets</span>: [[<span class="hljs-string">'@babel/preset-env'</span>, { <span class="hljs-attr">targets</span>: <span class="hljs-string">'defaults'</span> }]]
      }
    }),
    <span class="hljs-title function_">pluginVue2</span>(),
    <span class="hljs-comment">// jsx</span>
    <span class="hljs-title function_">pluginVue2Jsx</span>(),
    <span class="hljs-comment">// ssl</span>
    <span class="hljs-title function_">pluginBasicSsl</span>()
  ],
  <span class="hljs-attr">source</span>: {
    <span class="hljs-attr">entry</span>: {
      <span class="hljs-attr">index</span>: <span class="hljs-string">'./src/main.js'</span>
    },
    <span class="hljs-comment">// 对齐process.env</span>
    <span class="hljs-attr">define</span>: {
      ...(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(
          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(process.<span class="hljs-property">env</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> [
            <span class="hljs-string">`process.env.<span class="hljs-subst">${key}</span>`</span>,
            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value)
          ])
        )
      })()
    }
  },
  <span class="hljs-comment">// @符号</span>
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
      <span class="hljs-comment">// 兼容vue cdn注入和</span>
      <span class="hljs-attr">vue$</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'vue/dist/vue.runtime.esm.js'</span>)
      <span class="hljs-comment">// vuex$: require.resolve('vuex')</span>
    }
  },
  <span class="hljs-attr">html</span>: {
    <span class="hljs-attr">template</span>: <span class="hljs-string">'./public/index.html'</span>,
    <span class="hljs-comment">// 注入环境变量</span>
    <span class="hljs-attr">templateParameters</span>: <span class="hljs-function">(<span class="hljs-params">compilation, assets, assetTags</span>) =&gt;</span> {
      <span class="hljs-keyword">return</span> {
        <span class="hljs-comment">// 兼容 Vue CLI 的 htmlWebpackPlugin 语法 之前webpack 的html直接写这里就不需要修改html了</span>
        <span class="hljs-attr">htmlWebpackPlugin</span>: {
          <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">title</span>: <span class="hljs-string">'test'</span>,
            <span class="hljs-attr">assetPrefix</span>: assets.<span class="hljs-property">publicPath</span>
          }
        },
        <span class="hljs-attr">autoprefixer</span>: {
          <span class="hljs-attr">browsers</span>: [<span class="hljs-string">'&gt; 1%'</span>, <span class="hljs-string">'last 2 versions'</span>, <span class="hljs-string">'not dead'</span>]
        }
      }
    }
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">cssModules</span>: {
      <span class="hljs-attr">auto</span>: <span class="hljs-regexp">/\.module\.(css|less|scss|sass)$/</span>,
      <span class="hljs-attr">localIdentName</span>: <span class="hljs-string">'[local]--[hash:base64:5]'</span>
    }
  },
  <span class="hljs-comment">// Vue 2 项目需要关闭 experiments.css</span>
  <span class="hljs-attr">experiments</span>: {
    <span class="hljs-attr">css</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-comment">// 关闭性能提示 一些日志可以点开查看</span>
  <span class="hljs-attr">performance</span>: {
    <span class="hljs-attr">hints</span>: <span class="hljs-literal">false</span>
  },
  <span class="hljs-attr">server</span>: {
    <span class="hljs-comment">// https: true 如果需要https</span>
  },
  <span class="hljs-attr">tools</span>: {
    <span class="hljs-title function_">rspack</span>(<span class="hljs-params">config, { addRules }</span>) {
      <span class="hljs-comment">// externals 兼容cdn注入</span>
      <span class="hljs-comment">// config.externals = {</span>
      <span class="hljs-comment">//   vue: 'Vue',</span>
      <span class="hljs-comment">//   vuex: 'Vuex',</span>
      <span class="hljs-comment">//   'vue-router': 'VueRouter',</span>
      <span class="hljs-comment">//   'vue-i18n': 'VueI18n',</span>
      <span class="hljs-comment">//   'element-ui': 'ELEMENT',</span>
      <span class="hljs-comment">//   axios: 'axios'</span>
      <span class="hljs-comment">// }</span>

      config.<span class="hljs-property">module</span>.<span class="hljs-property">rules</span> = (config.<span class="hljs-property">module</span>.<span class="hljs-property">rules</span> || []).<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">rule</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> !(rule.<span class="hljs-property">test</span> &amp;&amp; rule.<span class="hljs-property">test</span>.<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">includes</span>(<span class="hljs-string">'less'</span>))
      })

      <span class="hljs-comment">// 全局css变量注入</span>
      <span class="hljs-keyword">const</span> lessVars = {
        <span class="hljs-attr">colorPrimary</span>: <span class="hljs-string">'#0066ff'</span>,
        <span class="hljs-attr">colorPrimaryLight8</span>: <span class="hljs-string">'#d4e7ff'</span>,
        <span class="hljs-attr">colorSuccess</span>: <span class="hljs-string">'#3ec07d'</span>,
        <span class="hljs-attr">colorWarning</span>: <span class="hljs-string">'#f97c56'</span>,
        <span class="hljs-attr">colorDanger</span>: <span class="hljs-string">'#f56c6c'</span>,
        <span class="hljs-attr">colorBg</span>: <span class="hljs-string">'white'</span>,
        <span class="hljs-attr">colorBorder</span>: <span class="hljs-string">'#999'</span>,
        <span class="hljs-attr">colorText</span>: <span class="hljs-string">'#777b7e'</span>,
        <span class="hljs-attr">colorTitle</span>: <span class="hljs-string">'#1d2328'</span>,
        <span class="hljs-attr">colorDark</span>: <span class="hljs-string">'rgba(0, 0, 0, 0.75)'</span>,
        <span class="hljs-attr">headerHeight</span>: <span class="hljs-string">'64px'</span>,
        <span class="hljs-attr">minWidth</span>: <span class="hljs-string">'1200px'</span>,
        <span class="hljs-attr">sideBarWidth</span>: <span class="hljs-string">'210px'</span>,
        <span class="hljs-attr">font</span>: <span class="hljs-string">'14px'</span>,
        <span class="hljs-attr">fontSmall</span>: <span class="hljs-string">'12px'</span>,
        <span class="hljs-attr">bg</span>: <span class="hljs-string">'white'</span>
      }
      <span class="hljs-comment">// svg + rules 和less处理</span>
      <span class="hljs-title function_">addRules</span>([
        {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.less$/</span>,
          <span class="hljs-attr">oneOf</span>: [
            {
              <span class="hljs-comment">// 处理 &lt;style module lang="less"&gt;</span>
              <span class="hljs-attr">resourceQuery</span>: <span class="hljs-regexp">/module/</span>,
              <span class="hljs-attr">use</span>: [
                <span class="hljs-string">'vue-style-loader'</span>,
                {
                  <span class="hljs-attr">loader</span>: <span class="hljs-string">'css-loader'</span>,
                  <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">modules</span>: {
                      <span class="hljs-attr">localIdentName</span>: <span class="hljs-string">'[local]--[hash:base64:5]'</span>
                    }
                  }
                },
                <span class="hljs-string">'postcss-loader'</span>,
                {
                  <span class="hljs-attr">loader</span>: <span class="hljs-string">'less-loader'</span>,
                  <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">lessOptions</span>: {
                      <span class="hljs-attr">javascriptEnabled</span>: <span class="hljs-literal">true</span>,
                      <span class="hljs-attr">globalVars</span>: lessVars
                    }
                    <span class="hljs-comment">// additionalData: sharedLessImports</span>
                  }
                }
              ]
            },
            {
              <span class="hljs-comment">// 普通 less</span>
              <span class="hljs-attr">use</span>: [
                <span class="hljs-string">'vue-style-loader'</span>,
                <span class="hljs-string">'css-loader'</span>,
                <span class="hljs-comment">// 需要有postcss.config.js</span>
                <span class="hljs-string">'postcss-loader'</span>,
                {
                  <span class="hljs-attr">loader</span>: <span class="hljs-string">'less-loader'</span>,
                  <span class="hljs-attr">options</span>: {
                    <span class="hljs-attr">lessOptions</span>: {
                      <span class="hljs-attr">javascriptEnabled</span>: <span class="hljs-literal">true</span>,
                      <span class="hljs-attr">globalVars</span>: lessVars
                    }
                    <span class="hljs-comment">// 注入所有style 顶部的 css代码例如 @import "${resolve('src/style/theme.less')}";</span>
                    <span class="hljs-comment">// additionalData: sharedLessImports</span>
                  }
                }
              ]
            }
          ]
        },
        {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.svg$/</span>,
          <span class="hljs-attr">include</span>: [<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'src/asset/icons/svg'</span>)],
          <span class="hljs-attr">use</span>: [
            {
              <span class="hljs-attr">loader</span>: <span class="hljs-built_in">require</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">'svg-sprite-loader'</span>),
              <span class="hljs-attr">options</span>: {
                <span class="hljs-attr">symbolId</span>: <span class="hljs-string">'icon-[name]'</span>
              }
            }
          ]
        }
      ])
    }
  }
})
</code></pre>
<p>升级遇到的坑详解</p>
<ol>
<li>
 module不通过问题


</li></ol>

<pre><code class="hljs language-javascript" lang="javascript">    去除官方的<span class="hljs-keyword">import</span> { pluginLess } <span class="hljs-keyword">from</span> <span class="hljs-string">'@rsbuild/plugin-less'</span>
     <span class="hljs-comment">//pluginLess()</span>
    改成<span class="hljs-string">'vue-style-loader'</span>,<span class="hljs-string">'vue-style-loader'</span>, <span class="hljs-string">'css-loader'</span>, <span class="hljs-string">'postcss-loader'</span>,
    这几个都集合
    这个也需要 关闭
     <span class="hljs-comment">// Vue 2 项目需要关闭 experiments.css</span>
  <span class="hljs-attr">experiments</span>: {
    <span class="hljs-attr">css</span>: <span class="hljs-literal">false</span>
  },
</code></pre>
<p>2.  jsx 编译问题 安装
import { pluginVue2Jsx } from '@rsbuild/plugin-vue2-jsx'</p>
<p>3.不想改原来的webpack页面就这样子修改</p>
<pre><code class="hljs language-css" lang="css">    // 兼容 Vue CLI 的 htmlWebpackPlugin 语法
        htmlWebpackPlugin: {
          options: {
            title: <span class="hljs-string">'Kuaizi™ - 内容商业一站式AI应用平台'</span>,
            cdn,
            kzCDN: process.env.VUE_APP_CDN_URL,
            npsId: process.env.VUE_APP_NPS_ID || <span class="hljs-string">''</span>,
            personalNpsId: process.env.VUE_APP_PERSONAL_NPS_ID || <span class="hljs-string">''</span>,
            kzENVScript,
            assetPrefix: process.env.VUE_APP_CDN_URL
              ? `${process<span class="hljs-selector-class">.env</span><span class="hljs-selector-class">.VUE_APP_CDN_URL</span>}/plus`
              : <span class="hljs-string">'/'</span>,
            content: <span class="hljs-string">''</span>
          }
        }
</code></pre>
<p>4.处理项目里面大量的process 问题</p>
<pre><code class="hljs language-javascript" lang="javascript"> <span class="hljs-attr">source</span>: {
    <span class="hljs-attr">entry</span>: {
      <span class="hljs-attr">index</span>: <span class="hljs-string">'./src/main.js'</span>
    },
    <span class="hljs-comment">// 对齐process.env</span>
    <span class="hljs-attr">define</span>: {
      ...(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(
          <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(process.<span class="hljs-property">env</span>).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">[key, value]</span>) =&gt;</span> [
            <span class="hljs-string">`process.env.<span class="hljs-subst">${key}</span>`</span>,
            <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value)
          ])
        )
      })()
    }
  },
</code></pre>
<h2 data-id="heading-0">如果大家遇到问题可以下面留言问我</h2></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vue3中动态样式数组的后项覆盖规则如何与计算属性结合实现复杂状态样式管理？]]></title>    <link>https://juejin.cn/post/7584370833705189391</link>    <guid>https://juejin.cn/post/7584370833705189391</guid>    <pubDate>2025-12-17T07:26:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584370833705189391" data-draft-id="7584370833705173007" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Vue3中动态样式数组的后项覆盖规则如何与计算属性结合实现复杂状态样式管理？    "/> <meta itemprop="keywords" content="前端,Trae,AI编程"/> <meta itemprop="datePublished" content="2025-12-17T07:26:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kknone"/> <meta itemprop="url" content="https://juejin.cn/user/1366025597879930"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Vue3中动态样式数组的后项覆盖规则如何与计算属性结合实现复杂状态样式管理？    
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1366025597879930/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kknone
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:26:35.000Z" title="Wed Dec 17 2025 07:26:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、Style绑定的数组语法：组合多个样式对象</h2>
<p>在Vue3中，<code>v-bind:style</code>（简写为<code>:style</code>）除了支持<strong>对象语法</strong>，还可以用<strong>数组语法</strong>组合多个样式对象。这种方式特别适合需要<strong>合并基础样式与动态样式</strong>的场景——比如一个按钮既要保留默认的 padding、border 样式，又要根据“禁用状态”动态切换背景色。</p>
<h3 data-id="heading-1">1.1 基本用法：数组里的样式合并规则</h3>
<p>数组语法的核心逻辑是：<strong>数组中的每个样式对象会被合并，后面的对象会覆盖前面对象的同名属性</strong>（类似CSS的层叠规则）。</p>
<p>举个简单例子：我们需要一个“基础文本样式 + 动态背景色”的div：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- 数组组合baseStyles（基础）和dynamicStyles（动态） --&gt;
  &lt;div :style="[baseStyles, dynamicStyles]"&gt;
    我是数组语法的示例
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

// 基础样式：固定的字体、颜色
const baseStyles = ref({
  fontSize: '18px',  // 驼峰命名（Vue推荐）
  color: '#333',
  padding: '10px'
})

// 动态样式：点击后切换背景色
const dynamicStyles = ref({
  backgroundColor: 'lightblue'  // 初始为浅蓝色
})

// 模拟动态修改：点击div切换背景色
const toggleBg = () =&gt; {
  dynamicStyles.value.backgroundColor = 
    dynamicStyles.value.backgroundColor === 'lightblue' 
      ? 'lightcoral' 
      : 'lightblue'
}
&lt;/script&gt;
</code></pre>
<p><strong>效果说明</strong>：</p>
<ul>
<li>初始时，div的样式是<code>baseStyles</code>（字体18px、深灰） + <code>dynamicStyles</code>（浅蓝背景）的合并结果。</li>
<li>点击div后，<code>dynamicStyles</code>的<code>backgroundColor</code>变为浅红，div的背景色会<strong>自动更新</strong>（因为<code>dynamicStyles</code>是响应式ref）。</li>
</ul>
<h3 data-id="heading-2">1.2 关键规则：后项覆盖前项</h3>
<p>如果数组中的多个对象有<strong>同名属性</strong>，后面的对象会覆盖前面的。比如：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> base = { <span class="hljs-attr">color</span>: <span class="hljs-string">'red'</span>, <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'16px'</span> }
<span class="hljs-keyword">const</span> dynamic = { <span class="hljs-attr">color</span>: <span class="hljs-string">'blue'</span> }
<span class="hljs-keyword">const</span> styles = [base, dynamic]  <span class="hljs-comment">// 最终color是blue，fontSize是16px</span>
</code></pre>
<p>这意味着你可以把<strong>固定样式放在前面</strong>，<strong>动态样式放在后面</strong>——动态样式会“覆盖”基础样式的同名属性，实现灵活的样式调整。</p>
<h2 data-id="heading-3">二、计算属性：让复杂样式组合更优雅</h2>
<p>当样式需要依赖<strong>多个状态</strong>时（比如“禁用+ hover”的按钮），直接在模板里写数组会让代码变得冗长。这时候**计算属性（computed）**是更好的选择——它能把复杂的样式逻辑抽离出来，让模板更简洁。</p>
<h3 data-id="heading-4">2.1 为什么用计算属性？</h3>
<p>假设我们有一个按钮，需要根据三个状态切换样式：</p>
<ul>
<li>基础样式（固定）；</li>
<li>禁用状态（灰色背景、不可点击）；</li>
<li>Hover状态（绿色背景、白色文字）。</li>
</ul>
<p>如果不用计算属性，模板会写成这样：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- 模板里的样式数组会非常长，难以维护 --&gt;
&lt;button :style="[
  { padding: '8px 16px', border: 'none' },
  isDisabled ? { backgroundColor: '#ccc' } : {},
  isHovered &amp;&amp; !isDisabled ? { backgroundColor: '#42b983' } : {}
]"&gt;
  点击我
&lt;/button&gt;
</code></pre>
<p>而用计算属性，可以把样式逻辑移到<code>&lt;script&gt;</code>里，模板只需要绑定一个<code>buttonStyles</code>：</p>
<h3 data-id="heading-5">2.2 示例：带状态的按钮样式</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;button 
    :style="buttonStyles" 
    @click="toggleDisabled"
    @mouseenter="isHovered = true"
    @mouseleave="isHovered = false"
  &gt;
    {{ isDisabled ? '禁用' : '点击' }}
  &lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue'

// 1. 定义响应式状态
const isDisabled = ref(false)  // 是否禁用
const isHovered = ref(false)   // 是否hover

// 2. 计算属性：根据状态生成样式数组
const buttonStyles = computed(() =&gt; [
  // ① 基础样式（固定）
  {
    padding: '8px 16px',
    border: 'none',
    borderRadius: '4px',
    cursor: 'pointer',
    transition: 'background-color 0.2s'  // 过渡动画
  },
  // ② 禁用状态样式（仅当isDisabled为true时生效）
  isDisabled.value ? {
    backgroundColor: '#ccc',
    color: '#999',
    cursor: 'not-allowed'  // 禁用时的鼠标样式
  } : {},
  // ③ Hover状态样式（仅当hover且未禁用时生效）
  isHovered.value &amp;&amp; !isDisabled.value ? {
    backgroundColor: '#42b983',
    color: 'white'
  } : {}
])

// 3. 模拟禁用状态切换
const toggleDisabled = () =&gt; {
  isDisabled.value = !isDisabled.value
}
&lt;/script&gt;
</code></pre>
<p><strong>代码解释</strong>：</p>
<ul>
<li><code>buttonStyles</code>是一个计算属性，依赖<code>isDisabled</code>和<code>isHovered</code>的变化；</li>
<li>数组中的每个元素都是<strong>条件样式对象</strong>：当条件满足时，返回对应的样式；否则返回空对象<code>{}</code>（不影响其他样式）；</li>
<li>计算属性会自动响应状态变化——比如<code>isDisabled</code>从<code>false</code>变<code>true</code>时，<code>buttonStyles</code>会重新计算，按钮样式随之更新。</li>
</ul>
<h2 data-id="heading-6">三、动态内联样式：与数据联动的切换技巧</h2>
<p>数组语法的另一个常用场景是<strong>动态修改单个样式属性</strong>（比如进度条的宽度、文本框的背景色）。这类场景通常需要将样式属性与<strong>响应式数据</strong>绑定，实现“数据变→样式变”的效果。</p>
<h3 data-id="heading-7">3.1 示例1：动态进度条</h3>
<p>假设我们需要一个“点击增加进度”的进度条，核心是<strong>动态修改<code>width</code>属性</strong>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="progress-container"&gt;
    &lt;!-- 动态绑定width：进度值（0-100）+ % --&gt;
    &lt;div class="progress-bar" :style="{ width: progress + '%' }"&gt;&lt;/div&gt;
  &lt;/div&gt;
  &lt;button @click="increaseProgress"&gt;增加进度&lt;/button&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref } from 'vue'

const progress = ref(0)  // 进度值（响应式）

// 点击按钮增加进度（最多100%）
const increaseProgress = () =&gt; {
  if (progress.value &lt; 100) {
    progress.value += 10
  }
}
&lt;/script&gt;

&lt;style scoped&gt;
.progress-container {
  width: 300px;
  height: 20px;
  border: 1px solid #eee;
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 10px;
}
.progress-bar {
  height: 100%;
  background-color: #42b983;
  transition: width 0.3s ease;  // 平滑过渡
}
&lt;/style&gt;
</code></pre>
<p><strong>效果说明</strong>：</p>
<ul>
<li><code>progress</code>是响应式数据，初始为0；</li>
<li>点击按钮时，<code>progress</code>增加10，<code>width</code>属性会自动更新为<code>progress + '%'</code>（比如10% → 20%）；</li>
<li>通过<code>transition</code>实现进度条的平滑动画。</li>
</ul>
<h3 data-id="heading-8">3.2 示例2：根据输入长度动态改背景色</h3>
<p>我们可以扩展数组语法，结合<strong>计算属性</strong>实现更复杂的联动：比如文本框根据输入长度切换背景色（短→白、中→黄、长→红）。</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;input 
    type="text" 
    v-model="inputText" 
    :style="inputStyles"
    placeholder="输入内容..."
  &gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, computed } from 'vue'

const inputText = ref('')  // 绑定输入框内容

// 计算属性：根据输入长度生成样式数组
const inputStyles = computed(() =&gt; [
  // 基础样式（固定）
  {
    padding: '8px',
    border: '1px solid #ccc',
    borderRadius: '4px',
    width: '300px'
  },
  // 动态背景色：根据输入长度切换
  {
    backgroundColor: 
      inputText.value.length &lt; 10 ? 'white' :  // 短：白
      inputText.value.length &lt;= 20 ? 'lightyellow' :  // 中：黄
      'lightcoral'  // 长：红
  }
])
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-9">四、课后Quiz：巩固你的样式绑定技能</h2>
<p><strong>问题</strong>：请用<strong>数组语法 + 计算属性</strong>实现一个“动态标签”组件——标签的背景色根据<code>type</code>属性切换（<code>type="success"</code>为绿色，<code>type="warning"</code>为黄色，<code>type="error"</code>为红色），同时保持基础样式（圆角、padding）。</p>
<p><strong>要求</strong>：</p>
<ol>
<li>基础样式包含：<code>padding: '4px 8px'</code>、<code>border-radius: '4px'</code>、<code>color: 'white'</code>；</li>
<li>动态样式根据<code>type</code>切换<code>backgroundColor</code>；</li>
<li>用计算属性返回样式数组。</li>
</ol>
<h3 data-id="heading-10">答案与解析</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;span :style="tagStyles"&gt;{{ text }}&lt;/span&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed, defineProps } from 'vue'

// 接收父组件传递的type和text
const props = defineProps({
  type: {
    type: String,
    default: 'success'  // 默认成功态
  },
  text: String
})

// 计算属性：生成样式数组
const tagStyles = computed(() =&gt; [
  // ① 基础样式
  {
    padding: '4px 8px',
    borderRadius: '4px',
    color: 'white',
    fontSize: '12px'
  },
  // ② 动态背景色（根据type）
  {
    backgroundColor: {
      success: '#42b983',
      warning: '#f1c40f',
      error: '#e74c3c'
    }[props.type]  // 根据type取对应颜色
  }
])
&lt;/script&gt;
</code></pre>
<p><strong>解析</strong>：</p>
<ol>
<li>用<code>defineProps</code>接收父组件的<code>type</code>和<code>text</code>；</li>
<li>计算属性<code>tagStyles</code>返回数组：基础样式 + 动态背景色；</li>
<li>动态背景色用<strong>对象映射</strong>（<code>{ success: '#42b983', ... }[props.type]</code>），比<code>if-else</code>更简洁。</li>
</ol>
<details>
<summary>往期文章归档</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc85e1fe16a7ae45e965b4e2df4d9d2f4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c85e1fe16a7ae45e965b4e2df4d9d2f4/" ref="nofollow noopener noreferrer">Vue浅响应式如何解决深层响应式的性能问题？适用场景有哪些？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbe04b02d2723994632de0d4ca22a3391%2F" target="_blank" title="https://blog.cmdragon.cn/posts/be04b02d2723994632de0d4ca22a3391/" ref="nofollow noopener noreferrer">Vue 3组合式API中ref与reactive的核心响应式差异及使用最佳实践是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa0af08dd60a37b9a890a9957f2cbfc9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a0af08dd60a37b9a890a9957f2cbfc9f/" ref="nofollow noopener noreferrer">Vue3响应式系统中，对象新增属性、数组改索引、原始值代理的问题如何解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbc287e1e36287afd90750fd907eca85e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bc287e1e36287afd90750fd907eca85e/" ref="nofollow noopener noreferrer">Vue 3中watch侦听器的正确使用姿势你掌握了吗？深度监听、与watchEffect的差异及常见报错解析 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F654b9447ef1ba7ec1126a1bc26a4726d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/654b9447ef1ba7ec1126a1bc26a4726d/" ref="nofollow noopener noreferrer">Vue响应式声明的API差异、底层原理与常见陷阱你都搞懂了吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc405a8d9950af5b7c63b56c348ac36b6%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c405a8d9950af5b7c63b56c348ac36b6/" ref="nofollow noopener noreferrer">为什么Vue 3需要ref函数？它的响应式原理与正确用法是什么？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa7e9abb9691a81e4404d9facabe0f7c3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a7e9abb9691a81e4404d9facabe0f7c3/" ref="nofollow noopener noreferrer">Vue 3中reactive函数如何通过Proxy实现响应式？使用时要避开哪些误区？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbd995ea45161727597fb85b62566c43d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bd995ea45161727597fb85b62566c43d/" ref="nofollow noopener noreferrer">Vue3响应式系统的底层原理与实践要点你真的懂吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F53e3f270a80675df662c6857a3332c0f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/53e3f270a80675df662c6857a3332c0f/" ref="nofollow noopener noreferrer">Vue 3模板如何通过编译三阶段实现从声明式语法到高效渲染的跨越 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fddbce4f2a23aa72c96b1c0473900321e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ddbce4f2a23aa72c96b1c0473900321e/" ref="nofollow noopener noreferrer">快速入门Vue模板引用：从收DOM“快递”到调子组件方法，你玩明白了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F23a2d5a334e15575277814c16e45df50%2F" target="_blank" title="https://blog.cmdragon.cn/posts/23a2d5a334e15575277814c16e45df50/" ref="nofollow noopener noreferrer">快速入门Vue模板里的JS表达式有啥不能碰？计算属性为啥比方法更能打？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6be38de6382e31d282659b689c5b17f0%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6be38de6382e31d282659b689c5b17f0/" ref="nofollow noopener noreferrer">快速入门Vue的v-model表单绑定：语法糖、动态值、修饰符的小技巧你都掌握了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F60ce517684f4a418f453d66aa805606c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/60ce517684f4a418f453d66aa805606c/" ref="nofollow noopener noreferrer">快速入门Vue3事件处理的挑战题：v-on、修饰符、自定义事件你能通关吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe4ae7d5e4a9205bb11b2baccb230c637%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e4ae7d5e4a9205bb11b2baccb230c637/" ref="nofollow noopener noreferrer">快速入门Vue3的v-指令：数据和DOM的“翻译官”到底有多少本事？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F999ce4fb32259ff4fbf4bf7bcb851654%2F" target="_blank" title="https://blog.cmdragon.cn/posts/999ce4fb32259ff4fbf4bf7bcb851654/" ref="nofollow noopener noreferrer">快速入门Vue3，插值、动态绑定和避坑技巧你都搞懂了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fa6997d81b49cd232b87e1cf603888ad1%2F" target="_blank" title="https://blog.cmdragon.cn/posts/a6997d81b49cd232b87e1cf603888ad1/" ref="nofollow noopener noreferrer">想让PostgreSQL快到飞起？先找健康密码还是先换引擎？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F1fee7afbb9abd4540b8aa9c141d6845d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/1fee7afbb9abd4540b8aa9c141d6845d/" ref="nofollow noopener noreferrer">想让PostgreSQL查询快到飞起？分区表、物化视图、并行查询这三招灵不灵？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F79c590fbd87ece535b11a71c9667884f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/79c590fbd87ece535b11a71c9667884f/" ref="nofollow noopener noreferrer">子查询总拖慢查询？把它变成连接就能解决？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F748cdac2536008199abf8a8a2cd0ec85%2F" target="_blank" title="https://blog.cmdragon.cn/posts/748cdac2536008199abf8a8a2cd0ec85/" ref="nofollow noopener noreferrer">PostgreSQL全表扫描慢到崩溃？建索引+改查询+更统计信息三招能破？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F32ca943703226d317d4276a8fb53b0dd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/32ca943703226d317d4276a8fb53b0dd/" ref="nofollow noopener noreferrer">复杂查询总拖后腿？PostgreSQL多列索引+覆盖索引的神仙技巧你get没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fca93f1d53aa910e7ba5ffd8df611c12b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ca93f1d53aa910e7ba5ffd8df611c12b/" ref="nofollow noopener noreferrer">只给表子集建索引？用函数结果建索引？PostgreSQL这俩操作凭啥能省空间又加速？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ff507856ebfddd592448813c510a53669%2F" target="_blank" title="https://blog.cmdragon.cn/posts/f507856ebfddd592448813c510a53669/" ref="nofollow noopener noreferrer">B-tree索引像字典查词一样工作？那哪些数据库查询它能加速，哪些不能？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb2213bfcb5b88a862f2138404c03d596%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b2213bfcb5b88a862f2138404c03d596/" ref="nofollow noopener noreferrer">想抓PostgreSQL里的慢SQL？pg_stat_statements基础黑匣子和pg_stat_monitor时间窗，谁能帮你更准揪出性能小偷？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F26614eb7da6c476dde41d367ad888d2f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/26614eb7da6c476dde41d367ad888d2f/" ref="nofollow noopener noreferrer">PostgreSQL的“时光机”MVCC和锁机制是怎么搞定高并发的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F69f99bc6972a860d559c74aad7280da4%2F" target="_blank" title="https://blog.cmdragon.cn/posts/69f99bc6972a860d559c74aad7280da4/" ref="nofollow noopener noreferrer">PostgreSQL性能暴涨的关键？内存IO并发参数居然要这么设置？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F7b7053f392147a8b3b1a16bebeb08d0a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/7b7053f392147a8b3b1a16bebeb08d0a/" ref="nofollow noopener noreferrer">大表查询慢到翻遍整个书架？PostgreSQL分区表教你怎么“分类”才高效</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc856e3cb073822349f3bf2d29995dcfc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c856e3cb073822349f3bf2d29995dcfc/" ref="nofollow noopener noreferrer">PostgreSQL 查询慢？是不是忘了优化 GROUP BY、ORDER BY 和窗口函数？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fc096347d18e67b7431faacd2c4757093%2F" target="_blank" title="https://blog.cmdragon.cn/posts/c096347d18e67b7431faacd2c4757093/" ref="nofollow noopener noreferrer">PostgreSQL里的子查询和CTE居然在性能上“掐架”？到底该站哪边？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F2eca89463454fd4250d7b66243b9fe5a%2F" target="_blank" title="https://blog.cmdragon.cn/posts/2eca89463454fd4250d7b66243b9fe5a/" ref="nofollow noopener noreferrer">PostgreSQL选Join策略有啥小九九？Nested Loop/Merge/Hash谁是它的菜？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F068ecb772a87d7df20a8c9fb4b233f8e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/068ecb772a87d7df20a8c9fb4b233f8e/" ref="nofollow noopener noreferrer">PostgreSQL新手SQL总翻车？这7个性能陷阱你踩过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd498f63cd0a2d5a77e445c688a8b88db%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d498f63cd0a2d5a77e445c688a8b88db/" ref="nofollow noopener noreferrer">PostgreSQL索引选B-Tree还是GiST？“瑞士军刀”和“多面手”的差别你居然还不知道？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F9101b75bdec6faea9b35d54f14e37f36%2F" target="_blank" title="https://blog.cmdragon.cn/posts/9101b75bdec6faea9b35d54f14e37f36/" ref="nofollow noopener noreferrer">想知道数据库怎么给查询“算成本选路线”？EXPLAIN能帮你看明白？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd527f8ebb6e3dae2c7dfe4c8d8979444%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d527f8ebb6e3dae2c7dfe4c8d8979444/" ref="nofollow noopener noreferrer">PostgreSQL处理SQL居然像做蛋糕？解析到执行的4步里藏着多少查询优化的小心机？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6bfdae84f313cf7ad0bb7045c4392347%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6bfdae84f313cf7ad0bb7045c4392347/" ref="nofollow noopener noreferrer">PostgreSQL备份不是复制文件？物理vs逻辑咋选？误删还能精准恢复到1分钟前？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fde3672803de34dbad244d0a8d48b0eb5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/de3672803de34dbad244d0a8d48b0eb5/" ref="nofollow noopener noreferrer">转账不翻车、并发不干扰，PostgreSQL的ACID特性到底有啥魔法？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fe463e8a2668abdf00a228c9b79324ded%2F" target="_blank" title="https://blog.cmdragon.cn/posts/e463e8a2668abdf00a228c9b79324ded/" ref="nofollow noopener noreferrer">银行转账不白扣钱、电商下单不超卖，PostgreSQL事务的诀窍是啥？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F5c967e595058c4a1fc4474a68e64031d%2F" target="_blank" title="https://blog.cmdragon.cn/posts/5c967e595058c4a1fc4474a68e64031d/" ref="nofollow noopener noreferrer">PostgreSQL里的PL/pgSQL到底是啥？能让SQL从“说目标”变“讲步骤”？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F325047855e3e23b5ef82f7d2db134fbd%2F" target="_blank" title="https://blog.cmdragon.cn/posts/325047855e3e23b5ef82f7d2db134fbd/" ref="nofollow noopener noreferrer">PostgreSQL视图不存数据？那它怎么简化查询还能递归生成序列和控制权限？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fd2dba50bb6e4df7b27e735245a06a2a2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/d2dba50bb6e4df7b27e735245a06a2a2/" ref="nofollow noopener noreferrer">PostgreSQL索引这么玩，才能让你的查询真的“飞”起来？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F849ae5bab0f8c66e94c2f6ad1bb798e3%2F" target="_blank" title="https://blog.cmdragon.cn/posts/849ae5bab0f8c66e94c2f6ad1bb798e3/" ref="nofollow noopener noreferrer">PostgreSQL的表关系和约束，咋帮你搞定用户订单不混乱、学生选课不重复？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fef4800975ffa84f1ca51976a70a1585b%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ef4800975ffa84f1ca51976a70a1585b/" ref="nofollow noopener noreferrer">PostgreSQL查询的筛子、排序、聚合、分组？你会用它们搞定数据吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fbf54711525c507c5eacfa7b0151c39d2%2F" target="_blank" title="https://blog.cmdragon.cn/posts/bf54711525c507c5eacfa7b0151c39d2/" ref="nofollow noopener noreferrer">PostgreSQL数据类型怎么选才高效不踩坑？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F887809b3e0375f5956873cd442f516d8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/887809b3e0375f5956873cd442f516d8/" ref="nofollow noopener noreferrer">想解锁PostgreSQL查询从基础到进阶的核心知识点？你都get了吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F934be1203725e8be9d6f6e9104e5abcc%2F" target="_blank" title="https://blog.cmdragon.cn/posts/934be1203725e8be9d6f6e9104e5abcc/" ref="nofollow noopener noreferrer">PostgreSQL DELETE居然有这些操作？返回数据、连表删你试过没？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0f0622e9b7402b599e618150d0596ffe%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0f0622e9b7402b599e618150d0596ffe/" ref="nofollow noopener noreferrer">PostgreSQL UPDATE语句怎么玩？从改邮箱到批量更新的避坑技巧你都会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F0e3bf7efc030b024ea67ee855a00f2de%2F" target="_blank" title="https://blog.cmdragon.cn/posts/0e3bf7efc030b024ea67ee855a00f2de/" ref="nofollow noopener noreferrer">PostgreSQL插入数据还在逐条敲？批量、冲突处理、返回自增ID的技巧你会吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb6cd3c86da6aac26ed829e472d34078e%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b6cd3c86da6aac26ed829e472d34078e/" ref="nofollow noopener noreferrer">PostgreSQL的“仓库-房间-货架”游戏，你能建出电商数据库和表吗？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fba1f545a3410144552fbdbfcf31b5265%2F" target="_blank" title="https://blog.cmdragon.cn/posts/ba1f545a3410144552fbdbfcf31b5265/" ref="nofollow noopener noreferrer">PostgreSQL 17安装总翻车？Windows/macOS/Linux避坑指南帮你搞定？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fb5474d1480509c5072085abc80b3dd9f%2F" target="_blank" title="https://blog.cmdragon.cn/posts/b5474d1480509c5072085abc80b3dd9f/" ref="nofollow noopener noreferrer">能当关系型数据库还能玩对象特性，能拆复杂查询还能自动管库存，PostgreSQL凭什么这么香？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Fcc098d8836e787baa8a4d92e4d56d5c5%2F" target="_blank" title="https://blog.cmdragon.cn/posts/cc098d8836e787baa8a4d92e4d56d5c5/" ref="nofollow noopener noreferrer">给接口加新字段又不搞崩老客户端？FastAPI的多版本API靠哪三招实现？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F46d05151c5bd31cf37a7bcf0b8f5b0b8%2F" target="_blank" title="https://blog.cmdragon.cn/posts/46d05151c5bd31cf37a7bcf0b8f5b0b8/" ref="nofollow noopener noreferrer">流量突增要搞崩FastAPI？熔断测试是怎么防系统雪崩的？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F65ce343cc5df9faf3a8e2eeaab42ae45%2F" target="_blank" title="https://blog.cmdragon.cn/posts/65ce343cc5df9faf3a8e2eeaab42ae45/" ref="nofollow noopener noreferrer">FastAPI秒杀库存总变负数？Redis分布式锁能帮你守住底线吗 - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Feed6cd8985d9be0a4b092a7da38b3e0c%2F" target="_blank" title="https://blog.cmdragon.cn/posts/eed6cd8985d9be0a4b092a7da38b3e0c/" ref="nofollow noopener noreferrer">FastAPI的CI流水线怎么自动测端点，还能让Allure报告美到犯规？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2F6157d87338ce894d18c013c3c4777abb%2F" target="_blank" title="https://blog.cmdragon.cn/posts/6157d87338ce894d18c013c3c4777abb/" ref="nofollow noopener noreferrer">如何用GitHub Actions为FastAPI项目打造自动化测试流水线？ - cmdragon's Blog</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.cmdragon.cn%2Fposts%2Ffc4ef84559e04693a620d0714cb30787%2F" target="_blank" title="https://blog.cmdragon.cn/posts/fc4ef84559e04693a620d0714cb30787/" ref="nofollow noopener noreferrer">如何用Git Hook和CI流水线为FastAPI项目保驾护航？ - cmdragon's Blog</a></li>
</ul>
</details>
<details>
<summary>免费好用的热门在线工具</summary>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fraid-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/raid-calculator" ref="nofollow noopener noreferrer">RAID 计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fphotoshop-online" target="_blank" title="https://tools.cmdragon.cn/zh/apps/photoshop-online" ref="nofollow noopener noreferrer">在线PS - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmermaid-live-editor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/mermaid-live-editor" ref="nofollow noopener noreferrer">Mermaid 在线编辑器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmath-solver-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/math-solver-calculator" ref="nofollow noopener noreferrer">数学求解计算器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsmart-teleprompter" target="_blank" title="https://tools.cmdragon.cn/zh/apps/smart-teleprompter" ref="nofollow noopener noreferrer">智能提词器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fmagic-resume" target="_blank" title="https://tools.cmdragon.cn/zh/apps/magic-resume" ref="nofollow noopener noreferrer">魔法简历 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-puzzle-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-puzzle-tool" ref="nofollow noopener noreferrer">Image Puzzle Tool - 图片拼图工具 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsubtitle-downloader" target="_blank" title="https://tools.cmdragon.cn/zh/apps/subtitle-downloader" ref="nofollow noopener noreferrer">字幕下载工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flyrics-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lyrics-generator" ref="nofollow noopener noreferrer">歌词生成工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcloud-drive-search" target="_blank" title="https://tools.cmdragon.cn/zh/apps/cloud-drive-search" ref="nofollow noopener noreferrer">网盘资源聚合搜索 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fascii-art-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ascii-art-generator" ref="nofollow noopener noreferrer">ASCII字符画生成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fjwt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/jwt-tool" ref="nofollow noopener noreferrer">JSON Web Tokens 工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbcrypt-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/bcrypt-tool" ref="nofollow noopener noreferrer">Bcrypt 密码工具 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-composer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-composer" ref="nofollow noopener noreferrer">GIF 合成器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fgif-decomposer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/gif-decomposer" ref="nofollow noopener noreferrer">GIF 分解器 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-steganography" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-steganography" ref="nofollow noopener noreferrer">文本隐写术 - 应用商店 | By cmdragon</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh" target="_blank" title="https://tools.cmdragon.cn/zh" ref="nofollow noopener noreferrer">CMDragon 在线工具 - 高级AI工具箱与开发者套件 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%3Fcategory%3Dtrending" target="_blank" title="https://tools.cmdragon.cn/zh/apps?category=trending" ref="nofollow noopener noreferrer">应用商店 - 发现1000+提升效率与开发的AI工具和实用程序 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fchangelog" target="_blank" title="https://tools.cmdragon.cn/zh/changelog" ref="nofollow noopener noreferrer">CMDragon 更新日志 - 最新更新、功能与改进 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fsponsor" target="_blank" title="https://tools.cmdragon.cn/zh/sponsor" ref="nofollow noopener noreferrer">支持我们 - 成为赞助者 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-image-ai" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-image-ai" ref="nofollow noopener noreferrer">AI文本生成图像 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftemp-email" target="_blank" title="https://tools.cmdragon.cn/zh/apps/temp-email" ref="nofollow noopener noreferrer">临时邮箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fqrcode-parser" target="_blank" title="https://tools.cmdragon.cn/zh/apps/qrcode-parser" ref="nofollow noopener noreferrer">二维码解析器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-to-mindmap" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-to-mindmap" ref="nofollow noopener noreferrer">文本转思维导图 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fregex-visualizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/regex-visualizer" ref="nofollow noopener noreferrer">正则表达式可视化工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsteganography-tool" target="_blank" title="https://tools.cmdragon.cn/zh/apps/steganography-tool" ref="nofollow noopener noreferrer">文件隐写工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fiptv-explorer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/iptv-explorer" ref="nofollow noopener noreferrer">IPTV 频道探索器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsnapdrop" target="_blank" title="https://tools.cmdragon.cn/zh/apps/snapdrop" ref="nofollow noopener noreferrer">快传 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Flucky-draw" target="_blank" title="https://tools.cmdragon.cn/zh/apps/lucky-draw" ref="nofollow noopener noreferrer">随机抽奖工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fanime-scene-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/anime-scene-finder" ref="nofollow noopener noreferrer">动漫场景查找器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftime-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/time-toolkit" ref="nofollow noopener noreferrer">时间工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fspeed-test" target="_blank" title="https://tools.cmdragon.cn/zh/apps/speed-test" ref="nofollow noopener noreferrer">网速测试 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-remover" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-remover" ref="nofollow noopener noreferrer">AI 智能抠图工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fbackground-replacer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/background-replacer" ref="nofollow noopener noreferrer">背景替换工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fartistic-qrcode" target="_blank" title="https://tools.cmdragon.cn/zh/apps/artistic-qrcode" ref="nofollow noopener noreferrer">艺术二维码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fopen-graph-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/open-graph-generator" ref="nofollow noopener noreferrer">Open Graph 元标签生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-comparison" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-comparison" ref="nofollow noopener noreferrer">图像对比工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-compressor" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-compressor" ref="nofollow noopener noreferrer">图片压缩专业版 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fpassword-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/password-generator" ref="nofollow noopener noreferrer">密码生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fsvg-optimizer" target="_blank" title="https://tools.cmdragon.cn/zh/apps/svg-optimizer" ref="nofollow noopener noreferrer">SVG优化器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcolor-palette" target="_blank" title="https://tools.cmdragon.cn/zh/apps/color-palette" ref="nofollow noopener noreferrer">调色板生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fonline-metronome" target="_blank" title="https://tools.cmdragon.cn/zh/apps/online-metronome" ref="nofollow noopener noreferrer">在线节拍器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcss-grid-layout" target="_blank" title="https://tools.cmdragon.cn/zh/apps/css-grid-layout" ref="nofollow noopener noreferrer">CSS网格布局生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Femail-validator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/email-validator" ref="nofollow noopener noreferrer">邮箱验证工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fcalligraphy-practice" target="_blank" title="https://tools.cmdragon.cn/zh/apps/calligraphy-practice" ref="nofollow noopener noreferrer">书法练习字帖 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffinance-calculator-suite" target="_blank" title="https://tools.cmdragon.cn/zh/apps/finance-calculator-suite" ref="nofollow noopener noreferrer">金融计算器套件 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fchinese-kinship-calculator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/chinese-kinship-calculator" ref="nofollow noopener noreferrer">中国亲戚关系计算器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fprotobuf-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/protobuf-toolkit" ref="nofollow noopener noreferrer">Protocol Buffer 工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-geolocation" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-geolocation" ref="nofollow noopener noreferrer">IP归属地查询 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fimage-upscaler" target="_blank" title="https://tools.cmdragon.cn/zh/apps/image-upscaler" ref="nofollow noopener noreferrer">图片无损放大 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ftext-compare" target="_blank" title="https://tools.cmdragon.cn/zh/apps/text-compare" ref="nofollow noopener noreferrer">文本比较工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fip-batch-lookup" target="_blank" title="https://tools.cmdragon.cn/zh/apps/ip-batch-lookup" ref="nofollow noopener noreferrer">IP批量查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdomain-finder" target="_blank" title="https://tools.cmdragon.cn/zh/apps/domain-finder" ref="nofollow noopener noreferrer">域名查询工具 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Fdns-toolkit" target="_blank" title="https://tools.cmdragon.cn/zh/apps/dns-toolkit" ref="nofollow noopener noreferrer">DNS工具箱 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fzh%2Fapps%2Ffavicon-generator" target="_blank" title="https://tools.cmdragon.cn/zh/apps/favicon-generator" ref="nofollow noopener noreferrer">网站图标生成器 - 应用商店 | 免费好用的在线工具</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftools.cmdragon.cn%2Fsitemap_index.xml" target="_blank" title="https://tools.cmdragon.cn/sitemap_index.xml" ref="nofollow noopener noreferrer">XML Sitemap</a></li>
</ul>
</details>
<h2 data-id="heading-11">五、常见报错与解决方案</h2>
<p>在Style绑定中，以下错误是新手常犯的，提前避坑！</p>
<h3 data-id="heading-12">报错1：样式键名用“短横线”导致不生效</h3>
<p><strong>错误代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dynamicStyles = <span class="hljs-title function_">ref</span>({
  background-<span class="hljs-attr">color</span>: <span class="hljs-string">'lightblue'</span>  <span class="hljs-comment">// 错误：短横线不能直接作为对象键名</span>
})
</code></pre>
<p><strong>原因</strong>：JavaScript对象的键名如果包含短横线（比如<code>background-color</code>），必须用<strong>字符串引号</strong>包裹，否则会被解析为“减法表达式”（<code>background - color</code>）。</p>
<p><strong>解决方法</strong>：</p>
<ul>
<li>用<strong>驼峰命名</strong>（Vue推荐）：<code>backgroundColor</code>；</li>
<li>用<strong>字符串键名</strong>：<code>'background-color'</code>。</li>
</ul>
<p><strong>正确代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dynamicStyles = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'lightblue'</span>  <span class="hljs-comment">// 推荐</span>
  <span class="hljs-comment">// 或</span>
  <span class="hljs-comment">// 'background-color': 'lightblue'</span>
})
</code></pre>
<h3 data-id="heading-13">报错2：数组中的样式对象为<code>undefined</code></h3>
<p><strong>错误代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> buttonStyles = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> [
  baseStyles,
  isDisabled.<span class="hljs-property">value</span> ? disabledStyles : <span class="hljs-literal">undefined</span>  <span class="hljs-comment">// 错误：返回undefined</span>
])
</code></pre>
<p><strong>原因</strong>：Vue会忽略数组中的<code>undefined</code>或<code>null</code>，但如果数组中有<code>undefined</code>，后面的样式可能无法正确合并。</p>
<p><strong>解决方法</strong>：确保数组中的每个元素都是<strong>有效对象</strong>（空对象<code>{}</code>也可以）。</p>
<p><strong>正确代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> buttonStyles = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> [
  baseStyles,
  isDisabled.<span class="hljs-property">value</span> ? disabledStyles : {}  <span class="hljs-comment">// 空对象不影响合并</span>
])
</code></pre>
<h3 data-id="heading-14">报错3：动态样式没有响应式更新</h3>
<p><strong>错误代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 普通对象，非响应式</span>
<span class="hljs-keyword">const</span> dynamicStyles = {
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'lightblue'</span>
}

<span class="hljs-comment">// 修改时样式不更新</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeColor</span> = (<span class="hljs-params"/>) =&gt; {
  dynamicStyles.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'lightcoral'</span>
}
</code></pre>
<p><strong>原因</strong>：普通对象不是响应式的，Vue无法检测到它的变化。</p>
<p><strong>解决方法</strong>：</p>
<ul>
<li>用<code>ref</code>包裹样式对象（推荐）；</li>
<li>用<code>computed</code>返回样式（依赖响应式数据）。</li>
</ul>
<p><strong>正确代码</strong>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> dynamicStyles = <span class="hljs-title function_">ref</span>({
  <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'lightblue'</span>
})

<span class="hljs-keyword">const</span> <span class="hljs-title function_">changeColor</span> = (<span class="hljs-params"/>) =&gt; {
  dynamicStyles.<span class="hljs-property">value</span>.<span class="hljs-property">backgroundColor</span> = <span class="hljs-string">'lightcoral'</span>  <span class="hljs-comment">// 响应式修改</span>
}
</code></pre>
<h2 data-id="heading-15">参考链接</h2>
<p>Vue官网Style绑定文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2Fguide%2Fessentials%2Fclass-and-style.html%23array-syntax-1" target="_blank" title="https://vuejs.org/guide/essentials/class-and-style.html#array-syntax-1" ref="nofollow noopener noreferrer">vuejs.org/guide/essen…</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[防抖节流里的this传递]]></title>    <link>https://juejin.cn/post/7584346983136804916</link>    <guid>https://juejin.cn/post/7584346983136804916</guid>    <pubDate>2025-12-17T07:29:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584346983136804916" data-draft-id="7584370833704976399" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="防抖节流里的this传递"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2025-12-17T07:29:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="炸土豆"/> <meta itemprop="url" content="https://juejin.cn/user/457011401614381"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            防抖节流里的this传递
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/457011401614381/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    炸土豆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:29:40.000Z" title="Wed Dec 17 2025 07:29:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>今天心血来潮重写防抖节流，写着写着突然冒出一个问题，为什么执行函数的时候要用apply呢，为什么不直接写fn(...args)呢？</p>
<pre><code class="hljs language-js" lang="js">        <span class="hljs-comment">//防抖</span>
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">debounce</span>(<span class="hljs-params">fn, wait, immediate = <span class="hljs-literal">false</span></span>) {
            <span class="hljs-keyword">let</span> timer = <span class="hljs-literal">null</span>;

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
                <span class="hljs-keyword">if</span> (immediate &amp;&amp; timer === <span class="hljs-literal">null</span>) {
                    fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);
                }

                <span class="hljs-built_in">clearTimeout</span>(timer);
                timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
                    timer = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">if</span> (!immediate) {
                        fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);  <span class="hljs-comment">//为什么要用apply？</span>
                    }
                }, wait)
            }
        }
        
        <span class="hljs-keyword">let</span> a = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">function</span> <span class="hljs-title function_">onClick</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>)
            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(a++)
        }
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-title function_">debounce</span>(onClick, <span class="hljs-number">1000</span>, <span class="hljs-literal">true</span>))
</code></pre>
<p>虽然关于this的指向也背的七七八八，但不得不说，在真实的开发中，有时候还是会被绕进去。那么今天就来扫荡一下迷雾吧。</p>
<p>首先，在这个例子当中，给document绑定了一个click事件，事件处理函数是debounce(onClick, 1000, true)，也就是防抖函数这个高阶函数的返回值。</p>
<p>如果这里没有防抖，而是直接这样写：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-title function_">debounce</span>(onClick, <span class="hljs-number">1000</span>, <span class="hljs-literal">true</span>))
</code></pre>
<p>那么onClick内部的this会指向谁呢？答案是指向document。因为浏览器的事件绑定机制是，在哪个元素上绑定了事件函数，该函数的this就指向这个元素。相当于浏览器执行了onClick.call(document, event)。</p>
<p>经过debounce包装了onClick后，它内部的this应该与没包装的时候一样，指向document。</p>
<p>但是，现在onClick与document之间的直接联系已经被切断了，相当于之前是手拉手，现在中间硬插了一个人进来：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// document--onClick  之前</span>
<span class="hljs-comment">// document--debounce--onClick  现在</span>
</code></pre>
<p>于是，我们就只能通过插入的这个人来进行一个传递。现在，事件处理函数从onClick变成了debounce(onClick, 1000, true)，而后者就等同于debounce函数返回的那个函数，因此这个返回函数的this指向了document：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31b03d090578435b9e5efe16332b9613~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54K45Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766561379&amp;x-signature=0K%2FHBwaNHTdrmYY4CzCozb9JMlo%3D" alt="image.png" loading="lazy"/></p>
<p>所以现在事情就好办了，只需要在这个返回函数里面调用fn的时候，把this指向传递进去就可以了。可以用apply，也可以用call。而如果不这样做的话，就会出现下图的情况，this没有正确传递：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0d3c4e6297ec4018882f2a3a4299d01c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54K45Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766561379&amp;x-signature=UFKTZShIuYl2bmlNczRQxDjnLl4%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18d46139e33a4a479e84fba40eed67b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54K45Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766561379&amp;x-signature=Um16chuQFFBtsCuTFElKjukHEvY%3D" alt="image.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter3.32 中使用 webview4.13 与 vue3 项目的 h5 页面通信，以及如何调试]]></title>    <link>https://juejin.cn/post/7584475608220139571</link>    <guid>https://juejin.cn/post/7584475608220139571</guid>    <pubDate>2025-12-17T06:42:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584475608220139571" data-draft-id="7584362317002883099" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter3.32 中使用 webview4.13 与 vue3 项目的 h5 页面通信，以及如何调试"/> <meta itemprop="keywords" content="前端,Flutter"/> <meta itemprop="datePublished" content="2025-12-17T06:42:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="山璞"/> <meta itemprop="url" content="https://juejin.cn/user/2089515413410056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter3.32 中使用 webview4.13 与 vue3 项目的 h5 页面通信，以及如何调试
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2089515413410056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    山璞
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:42:23.000Z" title="Wed Dec 17 2025 06:42:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>随着App混合开发越来越多，如何与h5通信成为一个基础技能，根据最新的版本，实现一个 demo 和一份文档。</p>
<blockquote>
<p>github 地址flutter 端(只实现了 android)：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSuiShanpu%2Fhybrid-app-message-flutter" target="_blank" title="https://github.com/SuiShanpu/hybrid-app-message-flutter" ref="nofollow noopener noreferrer">github.com/SuiShanpu/h…</a><br/>
github 地址 h5 端：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSuiShanpu%2Fhybrid-app-message-h5" target="_blank" title="https://github.com/SuiShanpu/hybrid-app-message-h5" ref="nofollow noopener noreferrer">github.com/SuiShanpu/h…</a></p>
</blockquote>
<h2 data-id="heading-0">一、准备工作</h2>
<h3 data-id="heading-1">1、工具与版本</h3>
<p>App 端开发环境</p>
<ul>
<li>Flutter 3.32.5</li>
<li>Dart 3.8.1</li>
<li>webview_flutter 4.13.0</li>
</ul>
<p>Web 端开发环境</p>
<ul>
<li>node: 22.13.0</li>
<li>node: 10.9.2</li>
<li>vue 3.5.25</li>
<li>vite 7.2.4</li>
</ul>
<p>开发工具:</p>
<ul>
<li>App 端: Android Studio Narwhal 3 Feature Drop | 2025.1.3</li>
<li>Web 端: Visual Studio Code (1.106.3)</li>
</ul>
<h3 data-id="heading-2">2、分别创建新的 App 项目和 Web 项目，并实现基本功能</h3>
<blockquote>
<p>Flutter 工程创建参考:  <a href="https://link.juejin.cn?target=https%3A%2F%2Fcodelabs.developers.google.cn%2Fcodelabs%2Fflutter-codelab-first%3Fhl%3Dzh-cn%232" target="_blank" title="https://codelabs.developers.google.cn/codelabs/flutter-codelab-first?hl=zh-cn#2" ref="nofollow noopener noreferrer">创建第一个 Flutter 项目</a><br/>
Vue3 工程创建参考:  <a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fguide%2Fquick-start.html%23creating-a-vue-application" target="_blank" title="https://cn.vuejs.org/guide/quick-start.html#creating-a-vue-application" ref="nofollow noopener noreferrer">创建一个 Vue 应用</a></p>
</blockquote>
<p>App端: 可以从首页面 跳转到一个新的页面(WebviewPage)</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97ca025f25464c3ebdf20871700de163~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=tcjQ%2FkdgE2D4bzOaWLu3C%2B0JBU4%3D" alt="image.png" width="70%" loading="lazy"/>
<p>Web端: 页面内包含2个按钮，点击后更改文本内容。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ee3400f32cdd478fadca7c6020c04943~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=IpiSO6fFQQcGKhy%2FcFSYax4yeZA%3D" alt="image.png" width="70%" loading="lazy"/>
<h2 data-id="heading-3">二、通信</h2>
<p>webview 组件只能与要渲染 html 首页面进行通信；因为用的是 vue 组件，因此多了一层通信。<br/>
整个通信，用的是<strong>全局的 window 对象</strong>。</p>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6e0422c8ec584497b0d4f3ece0da5977~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=yCWB%2FmOkv6ACLV%2Fn5UMdgL7O7xs%3D" alt="image.png" width="50%" loading="lazy"/>
<h3 data-id="heading-4">1、vue组件 --&gt; webview</h3>
<p>在 vue 组件需要的地方触发，传递参数</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 传递 string 格式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onUseFlutter</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">flutterBridge</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'来自 h5 Home 页面的消息'</span>);
}

<span class="hljs-comment">// 传递 json 格式</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">onUseJsonFlutter</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">jsonBridge</span>.<span class="hljs-title function_">postMessage</span>(
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">'来自 h5 Home 页面的消息'</span> })
  );
}
</code></pre>
<p>在 webview 中注册事件，添加处理函数: 在 web 页面中就会注册一个 window.xxxx 对象。</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 与H5页面进行通信的桥梁</span>
_webViewController.addJavaScriptChannel(
  <span class="hljs-comment">// 会在H5的window上挂载一个FlutterBridge对象，该对象包含一个postMessage方法发送数据给flutter</span>
  <span class="hljs-string">"flutterBridge"</span>,
  onMessageReceived: (JavaScriptMessage jsMsg) {
    <span class="hljs-comment">// 根据 h5 传递的数据类型进行接收</span>
    <span class="hljs-built_in">String</span> message = jsMsg.message; 

    <span class="hljs-comment">// todo something</span>
  }
);

<span class="hljs-comment">// 接收 json 对象数据</span>
_webViewController.addJavaScriptChannel(
  <span class="hljs-comment">// 会在H5的window上挂载一个FlutterBridge对象，该对象包含一个postMessage方法发送数据给flutter</span>
  <span class="hljs-string">"jsonBridge"</span>,
  onMessageReceived: (JavaScriptMessage jsMsg) {
    <span class="hljs-comment">// 如果是 json 对象，则需要使用 jsonDecode 解析</span>
    <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; message = jsonDecode(jsMsg.message);

    <span class="hljs-comment">// todo something</span>
  }
);
</code></pre>
<p>注意: ‘flutterBridge’ 名称是自定义的，需要对应一致。</p>
<h3 data-id="heading-5">2、webview --&gt; html首页面</h3>
<p>在 webview 中触发脚本</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// 从flutter 发送信息</span>
_sendFlutterTestMessage() <span class="hljs-keyword">async</span> {
  <span class="hljs-comment">// 构造要传递的参数（支持任意类型：对象、数组、字符串、数字等）</span>
  <span class="hljs-keyword">final</span> <span class="hljs-built_in">Map</span>&lt;<span class="hljs-built_in">String</span>, <span class="hljs-built_in">dynamic</span>&gt; msgFlutter = {
    <span class="hljs-string">"msg"</span>: <span class="hljs-string">"这是 flutter 中的传递过来的值"</span>,
  };

  <span class="hljs-comment">// 调用 h5 页面中脚本方法</span>
  _webViewController.runJavaScript(<span class="hljs-string">'''
    receiveFromFlutter(<span class="hljs-subst">${jsonEncode(msgFlutter)}</span>);
  '''</span>);
}
</code></pre>
<p>在 html 首页面中添加函数脚本</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">receiveFromFlutter</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"receiveFromFlutter data:"</span>, data);
}
</code></pre>
<h3 data-id="heading-6">3、html首页面 --&gt; vue组件</h3>
<p>在 html 首页面中触发 window 自定义事件（定义自定义事件）</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">receiveFromFlutter</span>(<span class="hljs-params">data</span>) {
  <span class="hljs-comment">// 创建自定义事件并携带数据</span>
  <span class="hljs-keyword">const</span> flutterEvent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CustomEvent</span>(<span class="hljs-string">"flutter-to-home"</span>, { <span class="hljs-attr">detail</span>: data }); 
  <span class="hljs-comment">// 触发事件</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">dispatchEvent</span>(flutterEvent); 
}
</code></pre>
<p>在 vue 组件需要的地方绑定 window 事件 (组件销毁时移除事件)</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'flutter-to-home'</span>, useFlutterMessage);
});

<span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'flutter-to-home'</span>, useFlutterMessage);
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">useFlutterMessage</span>(<span class="hljs-params">ev</span>) {
  <span class="hljs-keyword">const</span> data = ev.<span class="hljs-property">detail</span>;
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"使用 fluter 中的值 data:"</span>, data);
}
</code></pre>
<p>3次通信都完成后，一个完整的通信完成，一次操作结束。</p>
<h2 data-id="heading-7">三、调试</h2>
<p>使用 vConsole 插件。在 html首页面 添加如下脚本内容。</p>
<pre><code class="hljs language-js" lang="js">&lt;script src=<span class="hljs-string">"https://cdn.bootcss.com/vConsole/3.3.0/vconsole.min.js"</span>&gt;&lt;/script&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text/javascript"</span>&gt;</span><span class="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">VConsole</span>();</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/840549bdc9af4ac5a49352609cc207f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx55Ke:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766559465&amp;x-signature=BMOr9NuCqha5Yfve2euG2VyJLOU%3D" alt="image.png" width="70%" loading="lazy"/>
<h2 data-id="heading-8">四、结语</h2>
<p>与h5通信还有很多其他的内容，比如多语言、权限等。后面很有很长的路要走！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutter项目大量使用.obs会导致项目性能极度下降吗]]></title>    <link>https://juejin.cn/post/7584408254819500067</link>    <guid>https://juejin.cn/post/7584408254819500067</guid>    <pubDate>2025-12-17T07:26:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584408254819500067" data-draft-id="7584377629707092003" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutter项目大量使用.obs会导致项目性能极度下降吗"/> <meta itemprop="keywords" content="Flutter"/> <meta itemprop="datePublished" content="2025-12-17T07:26:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yfmingo"/> <meta itemprop="url" content="https://juejin.cn/user/4037062425588136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutter项目大量使用.obs会导致项目性能极度下降吗
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062425588136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yfmingo
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:26:38.000Z" title="Wed Dec 17 2025 07:26:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>简短的回答是：<strong>一般情况下不会，甚至在很多场景下，大量使用 <code>.obs</code> 反而比传统的 <code>setState</code> 性能更好。</strong></p>
<p>但凡事都有“但是”。如果使用姿势不对，确实会导致内存占用增加或帧率下降。</p>
<p>我们需要从**内存（Memory）<strong>和</strong>CPU/渲染（Rendering）**两个维度来分析这个问题。</p>
<h3 data-id="heading-0">1. 内存维度：会有额外开销，但通常可忽略</h3>
<ul>
<li><strong>原理</strong>：一个普通的 <code>int a = 0</code> 在内存中占用极小。但是 <code>var a = 0.obs</code> 实际上创建了一个 <code>RxInt</code> 对象。这个对象内部维护了一个 <code>Stream</code>（流）和监听器列表。</li>
<li><strong>影响</strong>：<code>Rx</code> 类型的对象确实比原始类型（Primitive types）重。</li>
<li><strong>结论</strong>：除非你创建了<strong>数百万个</strong> <code>.obs</code> 对象（例如在一个巨大的循环中为每个数据点都创建独立的 <code>Rx</code> 变量），否则现代手机的内存（6GB+）完全可以忽略这点开销。对于常规 App 的几百上千个状态变量，几乎没有影响。</li>
</ul>
<h3 data-id="heading-1">2. CPU/渲染维度：这是关键（双刃剑）</h3>
<p>GetX 的 <code>.obs</code> + <code>Obx</code> 机制是<strong>细粒度更新</strong>。</p>
<h4 data-id="heading-2">✅ 优势：它为什么快？</h4>
<p>当你使用 <code>setState</code> 时，Flutter 会重建<strong>当前 Widget 及其子树</strong>。
当你使用 <code>Obx</code> 时，GetX 只会重建<strong>包裹在 <code>Obx</code> 内部的那个小组件</strong>。</p>
<ul>
<li><strong>例子</strong>：页面有一个复杂的列表，顶部有一个计数器。</li>
<li><strong><code>setState</code></strong>：计数器变了 -&gt; 整个页面 <code>build</code> 方法重跑 -&gt; 列表也要做 diff（虽然 Element 树可能不重绘，但 diff 也要耗 CPU）。</li>
<li><strong><code>.obs</code></strong>：计数器变了 -&gt; 只有 <code>Obx(() =&gt; Text(...))</code> 这一行代码重跑 -&gt; 列表完全不受影响。</li>
<li><strong>结论</strong>：在这种场景下，大量使用 <code>.obs</code> 反而<strong>提升</strong>了性能。</li>
</ul>
<h4 data-id="heading-3">❌ 陷阱：什么时候会导致性能下降？</h4>
<p>如果你遇到了性能下降，通常是因为犯了以下错误：</p>
<p><strong>1. 滥用 <code>Obx</code> 包裹范围过大（最常见）</strong>
错误做法：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ❌ 错误：只要 count 变了，整个 Column 里的所有东西（包括复杂的 ChartView）都会被重建</span>
Obx(() =&gt; Column(
  children: [
    Text(<span class="hljs-string">"Count: <span class="hljs-subst">${controller.count}</span>"</span>),
    SuperComplexChartView(), <span class="hljs-comment">// 极度消耗性能的组件</span>
    AnotherHeavyWidget(),
  ],
));

</code></pre>
<p>正确做法：</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-comment">// ✅ 正确：count 变了，只有 Text 重建，下面的复杂组件纹丝不动</span>
Column(
  children: [
    Obx(() =&gt; Text(<span class="hljs-string">"Count: <span class="hljs-subst">${controller.count}</span>"</span>)),
    SuperComplexChartView(),
    AnotherHeavyWidget(),
  ],
);

</code></pre>
<p>**2. 在高频更新中使用 <code>.obs**</code>
如果你有一个 <code>.obs</code> 变量绑定在 <code>AnimationController</code> 的回调里，或者用于监听滚动位置（ScrollPosition），每秒更新 60-120 次。</p>
<ul>
<li>如果在 <code>Obx</code> 里做了复杂的逻辑运算，会导致 UI 线程掉帧。</li>
<li><strong>建议</strong>：对于极高频的更新，考虑使用 <code>GetBuilder</code>（手动 <code>update()</code>）或者直接操作 <code>RenderObject</code>，不过通常 <code>Obx</code> 也扛得住，只要别在里面做耗时操作。</li>
</ul>
<p><strong>3. 大列表的 <code>RxList</code> 陷阱</strong></p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">final</span> list = &lt;Item&gt;[].obs;

</code></pre>
<p>当你调用 <code>list.add()</code> 或 <code>list.refresh()</code> 时，所有监听 <code>list</code> 的 <code>Obx</code> 都会重建。
如果你的 <code>ListView</code> 是这样写的：</p>
<pre><code class="hljs language-dart" lang="dart">Obx(() =&gt; ListView.builder(
  itemCount: controller.list.length,
  itemBuilder: (context, index) {
     <span class="hljs-comment">// ...</span>
  }
))

</code></pre>
<p>这通常没问题，因为 <code>ListView.builder</code> 只有视口内的 item 会渲染。但如果你在 <code>Obx</code> 里直接用了 <code>Column</code> 渲染一个长列表，那就会卡顿。</p>
<p><strong>4. 滥用 Workers (ever, debounce, interval)</strong>
如果你定义了大量的 <code>.obs</code> 变量，并且给每一个都绑定了 <code>ever</code> 监听器（每次变化都执行回调），这会消耗大量的 CPU 资源，尤其是在批量更新数据的时候。</p>
<h3 data-id="heading-4">总结与建议</h3>
<p><strong>大量使用 <code>.obs</code> 不会让项目变卡，前提是你遵循“最小更新原则”。</strong></p>
<ul>
<li><strong>放心用</strong>：在 ViewModel (Controller) 中定义几十上百个 <code>.obs</code> 变量完全没问题。</li>
<li><strong>小心用</strong>：在 View 层写 <code>Obx(() =&gt; ...)</code> 时，<strong>范围越小越好</strong>。只包裹那个变化的 Text 或 Icon，不要包裹整个 Scaffold 或 Column。</li>
<li><strong>替代方案</strong>：如果你非常在意内存（例如在低端 IoT 设备上跑 Flutter），或者状态更新不需要响应式流的特性，可以使用 **<code>GetBuilder</code> + <code>update()**</code> 模式。它是最轻量级的，几乎等同于原生的性能，内存占用比 <code>.obs</code> 少，但写起来稍微麻烦一点（需要手动触发更新）。</li>
</ul>
<p><strong>一句话建议</strong>：继续用 <code>.obs</code>，但要养成把 <code>Obx</code> 放在 Widget 树<strong>叶子节点</strong>（最底层）的好习惯。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[上下文协议（MCP）Java SDK 指南]]></title>    <link>https://juejin.cn/post/7584379805899538484</link>    <guid>https://juejin.cn/post/7584379805899538484</guid>    <pubDate>2025-12-17T06:54:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584379805899538484" data-draft-id="7584346983136542772" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="上下文协议（MCP）Java SDK 指南"/> <meta itemprop="keywords" content="架构"/> <meta itemprop="datePublished" content="2025-12-17T06:54:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="神奇小汤圆"/> <meta itemprop="url" content="https://juejin.cn/user/1151943919285431"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            上下文协议（MCP）Java SDK 指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943919285431/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    神奇小汤圆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:54:59.000Z" title="Wed Dec 17 2025 06:54:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    15
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>当我们把各种内部系统、数据源、工具接入大语言模型时，往往会遇到一个尴尬的问题：每个团队、每套系统都有自己的一套“接入规范”。有的用 HTTP API，有的用消息队列，有的直接连数据库，最后一圈串下来，既难以统一治理，又很难在不同应用之间复用。这时，你可能会问：有没有一种通用的协议，既能让 AI 模型方便地调用外部工具、访问数据，又能让后端服务方用标准方式暴露能力？</p>
<p>Model Context Protocol（MCP）就是为此而生的标准之一，而本文要介绍的 Java SDK，则为 Java 开发者提供了一条直接接入 MCP 生态的通路。通过它，你可以用统一的模型，在 Java 应用里暴露工具、资源、提示模版，也可以轻松作为客户端去调用这些能力。本文将从整体架构讲起，一步步带你用一个可运行的示例，搭建起自己的 MCP 服务端与客户端。</p>
<h2 data-id="heading-0">1. 概览</h2>
<p>随着近年来 AI 的快速发展，越来越多的工具和系统开始与 AI 模型集成。但随之而来的一个挑战是：每种集成都可能采用完全不同的标准和方式，将外部工具、资源和系统接入到 AI 模型中。</p>
<p>Model Context Protocol（MCP）是一个开源标准，它定义了 AI 应用（如大语言模型、图像生成模型等）与工具、数据源以及其他资源之间的集成方式。借助 MCP，AI 应用可以按外部系统约定的方式访问数据、调用工具并执行工作流。</p>
<p>MCP 的 Java SDK 为开发者提供了一组库，支持多种协议和通信机制，用于把 Java 应用与 AI 应用连接起来。</p>
<p>在本教程中，我们将一起了解这个 SDK，并通过一个简单示例来体验 MCP 的使用方式。</p>
<h2 data-id="heading-1">2. 架构</h2>
<p>MCP 架构的核心组件主要包括：</p>
<ul>
<li><strong>MCP Host：负责管理多个 MCP Client</strong></li>
<li><strong>MCP Client：从 MCP Server 获取上下文，供 MCP Host 使用</strong></li>
<li><strong>MCP Server：向 MCP Client 提供上下文信息和可调用能力</strong></li>
</ul>
<p>MCP 将通信划分为两个概念层次：<strong>数据层（Data Layer），用于定义客户端与服务端的通信协议和生命周期管理</strong>；以及 <strong>传输层（Transport Layer），用于定义客户端和服务端之间的具体传输通道和机制</strong>。</p>
<p>Java 版的 MCP SDK 将这些概念映射为如下几个层次：</p>
<ul>
<li>Client/Server 层：通过 <code>McpClient</code> / <code>McpServer</code> 实现并管理客户端/服务端的具体操作</li>
<li>Session 层：通过 <code>McpSession</code> 管理通信模式和会话状态</li>
<li>Transport 层：通过 <code>McpTransport</code> 处理消息的序列化与反序列化</li>
</ul>
<p>客户端会调用 MCP 服务端暴露的一到多个工具（tool），而底层的通信则由传输层负责。</p>
<p>在 MCP 中，<strong>Primitive（原语）</strong>  是最基础的构建单元，用来定义可用的上下文信息类型以及可执行的操作范围。服务端和客户端都提供了一些原语。</p>
<p>服务端侧的原语包括工具（tools）、资源（resources）和提示模版（prompts）。<strong>工具是 AI 应用可以调用的可执行函数</strong>，例如查询数据库、文件操作等。<strong>资源是提供给客户端的上下文数据源</strong>，例如数据库结构、文件内容等。<strong>提示模版是可复用的模版，用于与语言模型进行交互</strong>。</p>
<p>客户端侧的原语则帮助 <code>McpServer</code> 的实现者构建更丰富的交互能力，包括采样（sampling）、信息补充（elicitation）和日志（logging）。<strong>采样允许服务端在不集成模型 SDK 的情况下，向客户端请求语言模型补全结果。</strong>  <strong>信息补充让服务端能够向用户请求额外信息或确认操作。</strong>  <strong>日志则允许服务端向客户端发送日志消息，用于调试和监控。</strong></p>
<h2 data-id="heading-2">3. 环境准备</h2>
<p>要使用 MCP Java SDK，我们需要在项目中加入 <code>mcp</code> 依赖：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.modelcontextprotocol.sdk<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mcp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.15.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h3 data-id="heading-3">3.1 定义一个 MCP 工具</h3>
<p>我们先通过 <code>LoggingTool</code> 这个类，定义一个非常简单的 MCP 工具，用来打印收到的提示词（prompt），该方法返回一个 <code>SyncToolSpecification</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingTool</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">McpServerFeatures</span>.<span class="hljs-property">SyncToolSpecification</span> <span class="hljs-title function_">logPromptTool</span>(<span class="hljs-params"/>) {
        <span class="hljs-title class_">McpSchema</span>.<span class="hljs-property">JsonSchema</span> inputSchema = <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-title class_">JsonSchema</span>(<span class="hljs-string">"object"</span>,
            <span class="hljs-title class_">Map</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">"prompt"</span>, <span class="hljs-title class_">String</span>.<span class="hljs-property">class</span>), <span class="hljs-title class_">List</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">"prompt"</span>), <span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpServerFeatures</span>.<span class="hljs-title class_">SyncToolSpecification</span>(
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-title class_">Tool</span>(
              <span class="hljs-string">"logPrompt"</span>, <span class="hljs-string">"Log Prompt"</span>,<span class="hljs-string">"Logs a provided prompt"</span>, inputSchema, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>),
                (exchange, args) -&gt; {
                    <span class="hljs-title class_">String</span> prompt = (<span class="hljs-title class_">String</span>) args.<span class="hljs-title function_">get</span>(<span class="hljs-string">"prompt"</span>);
                    <span class="hljs-keyword">return</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-property">CallToolResult</span>.<span class="hljs-title function_">builder</span>()
                      .<span class="hljs-title function_">content</span>(<span class="hljs-title class_">List</span>.<span class="hljs-title function_">of</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">McpSchema</span>.<span class="hljs-title class_">TextContent</span>(<span class="hljs-string">"Input Prompt: "</span> + prompt)))
                      .<span class="hljs-title function_">isError</span>(<span class="hljs-literal">false</span>)
                      .<span class="hljs-title function_">build</span>();
                });
    }
}
</code></pre>
<p>这里我们首先定义了输入的 JSON Schema，用来为用户输入建立一个清晰的契约。接着，使用该输入 Schema 来实例化一个 <code>Tool</code>，在处理逻辑中提取出 <code>prompt</code> 参数，并最终返回包含该 <code>prompt</code> 的 <code>TextContent</code> 结果。</p>
<h2 data-id="heading-4">4. MCP 客户端与服务端搭建</h2>
<p>接下来，我们需要一个 MCP 服务端来暴露自定义工具，以及一个或多个 MCP 客户端，用于连接该服务端并调用其中的工具。</p>
<h3 data-id="heading-5">4.1 MCP 服务端实现</h3>
<p><code>McpServer</code> 具有一组能力（capabilities），用来告知客户端当前服务器支持哪些类别的协议操作，例如日志记录、提示词补全、资源访问等。此外，工具（tools）则提供给客户端可调用的具体函数。</p>
<p>先来看一个 <code>McpServer</code> 的实现：</p>
<pre><code class="hljs language-scss" lang="scss">public class McpServerApp {

    public static McpSyncServer <span class="hljs-built_in">createServer</span>() {
        JacksonMcpJsonMapper jsonMapper = new <span class="hljs-built_in">JacksonMcpJsonMapper</span>(new ObjectMapper());
        StdioServerTransportProvider transportProvider = new <span class="hljs-built_in">StdioServerTransportProvider</span>(
            jsonMapper);

        return McpServer<span class="hljs-selector-class">.sync</span>(transportProvider)
          <span class="hljs-selector-class">.serverInfo</span>("baeldung-demo-server", "<span class="hljs-number">0.0</span>.<span class="hljs-number">1</span>")
          <span class="hljs-selector-class">.capabilities</span>(McpSchema.ServerCapabilities.builder()
            <span class="hljs-selector-class">.tools</span>(true)
            <span class="hljs-selector-class">.logging</span>()
            <span class="hljs-selector-class">.build</span>())
          <span class="hljs-selector-class">.tools</span>(LoggingTool.logPromptTool())
          <span class="hljs-selector-class">.build</span>();
    }

    public static void <span class="hljs-selector-tag">main</span>(String[] args) {
        <span class="hljs-built_in">createServer</span>();
    }
}
</code></pre>
<p>上面代码定义了一个同步的 <code>McpServer</code>，通过标准输入/输出流并使用 JSON 消息格式进行通信。随后我们声明了服务器的能力：开启工具以及日志功能（基于 SLF4J 日志框架），最后把自定义的 <code>logPromptTool</code> 注册到服务器上。</p>
<h3 data-id="heading-6">4.3 MCP 客户端实现</h3>
<p>下面再定义一个简单的 <code>McpClient</code>，用于连接到服务端：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">McpClientApp</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> McpSyncClient <span class="hljs-title function_">getClient</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ServerParameters</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> ServerParameters
          .builder(<span class="hljs-string">"npx"</span>)
          .args(<span class="hljs-string">"-y"</span>, <span class="hljs-string">"@modelcontextprotocol/server-everything"</span>)
          .build();

        <span class="hljs-type">JacksonMcpJsonMapper</span> <span class="hljs-variable">jsonMapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JacksonMcpJsonMapper</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>());
        <span class="hljs-type">McpClientTransport</span> <span class="hljs-variable">transport</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StdioClientTransport</span>(params, jsonMapper);

        <span class="hljs-keyword">return</span> io.modelcontextprotocol.client.McpClient.sync(transport)
         .build();

    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">McpSyncClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> getClient();
        client.initialize();
    }
}
</code></pre>
<p>这里我们使用 MCP 提供的示例服务端，并通过 <code>ServerParameters</code> 进行配置。客户端同样通过标准输入/输出流以及 JSON 消息格式与服务端进行同步通信。</p>
<h2 data-id="heading-7">5. 测试</h2>
<p>到目前为止，我们已经具备了测试 MCP 交互和核心概念所需的全部组件。</p>
<h3 data-id="heading-8">5.1 测试 MCP 工具与客户端实现</h3>
<p>我们先从测试 <code>LoggingTool</code> 开始，验证其输出是否正确：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Test</span>
void whenLogPromptToolCalled_thenReturnsResult() {
    McpSchema<span class="hljs-selector-class">.CallToolRequest</span> request = new McpSchema<span class="hljs-selector-class">.CallToolRequest</span>("",
        Map.of("prompt", "Unit test message"));

    McpServerFeatures<span class="hljs-selector-class">.SyncToolSpecification</span> toolSpec = LoggingTool<span class="hljs-selector-class">.logPromptTool</span>();
    McpSchema<span class="hljs-selector-class">.CallToolResult</span> result 
        = toolSpec<span class="hljs-selector-class">.callHandler</span>()<span class="hljs-selector-class">.apply</span>(null, request);
    <span class="hljs-built_in">assertNotNull</span>(result);
    <span class="hljs-built_in">assertFalse</span>(result.isError());
    <span class="hljs-built_in">assertEquals</span>(
        "Input Prompt: Unit test message",((McpSchema.TextContent) (result.content()
        <span class="hljs-selector-class">.getFirst</span>()))
        <span class="hljs-selector-class">.text</span>());
}
</code></pre>
<p>在这个测试中，我们创建了一个带有 <code>prompt</code> 的 <code>CallToolRequest</code>，并将其传递给 <code>LoggingTool</code> 的 <code>SyncToolSpecification</code>。随后，我们断言返回结果非空、无错误，并且返回的文本内容与预期相同。</p>
<p>接下来，我们再通过 MCP 提供的示例服务端来测试 <code>McpClient</code>：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Test</span>
void whenCalledViaClient_thenReturnsLoggedResult() {
    McpSchema<span class="hljs-selector-class">.CallToolRequest</span> request = new McpSchema<span class="hljs-selector-class">.CallToolRequest</span>(
        "echo", Map.of("message", "Client-server test message"));
    McpSchema<span class="hljs-selector-class">.CallToolResult</span> result = client<span class="hljs-selector-class">.callTool</span>(request);

    <span class="hljs-built_in">assertNotNull</span>(result);
    <span class="hljs-built_in">assertNull</span>(result.isError());
    <span class="hljs-built_in">assertEquals</span>("Echo: Client-server test message",
        ((McpSchema.TextContent) (result.content()
        <span class="hljs-selector-class">.getFirst</span>()))<span class="hljs-selector-class">.text</span>());
}
</code></pre>
<p>MCP 示例服务端暴露了一个名为 <code>echo</code> 的工具，它会把输入消息原样返回，这与我们之前实现的 <code>LoggingTool</code> 的行为类似。</p>
<h3 data-id="heading-9">5.2 测试本地服务端</h3>
<p>最后，我们来测试自己编写的本地服务端。为此需要定义一个单独的 <code>McpClient</code>，并使用指向本地 JAR 的不同服务端参数：</p>
<pre><code class="hljs language-ini" lang="ini">public class McpClientApp2 {

    private static final Logger <span class="hljs-attr">log</span> = LoggerFactory.getLogger(McpClientApp2.class)<span class="hljs-comment">;</span>

    public static void main(String<span class="hljs-section">[]</span> args) {
        String <span class="hljs-attr">jarPath</span> = new java.io.File(<span class="hljs-string">"java-mcp/target/java-mcp-1.0.0-SNAPSHOT.jar"</span>)
                             .getAbsolutePath()<span class="hljs-comment">;</span>
        ServerParameters <span class="hljs-attr">params</span> = ServerParameters.builder(<span class="hljs-string">"java"</span>)
            .args("-jar", jarPath)
            .build()<span class="hljs-comment">;</span>

        JacksonMcpJsonMapper <span class="hljs-attr">jsonMapper</span> = new JacksonMcpJsonMapper(new ObjectMapper())<span class="hljs-comment">;</span>
        McpClientTransport <span class="hljs-attr">transport</span> = new StdioClientTransport(params, jsonMapper)<span class="hljs-comment">;</span>

        McpSyncClient <span class="hljs-attr">client</span> = McpClient.sync(transport)
            .build()<span class="hljs-comment">;</span>

        client.initialize()<span class="hljs-comment">;</span>

        ListToolsResult <span class="hljs-attr">tools</span> = client.listTools()<span class="hljs-comment">;</span>
        McpClientApp2.log.info("Tools exposed by the server:")<span class="hljs-comment">;</span>
        tools
          .tools()
          .forEach(tool -&gt; System.out.println(" - " + tool.name()))<span class="hljs-comment">;</span>

        McpClientApp2.log.info("\nCalling 'logPrompt' tool...")<span class="hljs-comment">;</span>
        CallToolResult <span class="hljs-attr">result</span> = client.callTool(
          new CallToolRequest("logPrompt", Map.of("prompt", "Hello from MCP client!")))<span class="hljs-comment">;</span>
        McpClientApp2.log.info("Result: " + result.content())<span class="hljs-comment">;</span>

        client.closeGracefully()<span class="hljs-comment">;</span>
    }
}
</code></pre>
<p>运行该客户端后，我们可以通过日志来验证它是否成功连接到了本地 JAR 中定义的服务端：</p>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">27.879</span> [boundedElastic<span class="hljs-number">-1</span>] INFO  i.m.c.transport.StdioClientTransport - MCP <span class="hljs-built_in">server</span> starting.
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">27.920</span> [boundedElastic<span class="hljs-number">-1</span>] INFO  i.m.c.transport.StdioClientTransport - MCP <span class="hljs-built_in">server</span> started
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.517</span> [pool<span class="hljs-number">-4</span>-thread<span class="hljs-number">-1</span>] INFO  i.m.c.transport.StdioClientTransport - STDERR Message received: <span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.504</span> [pool<span class="hljs-number">-1</span>-thread<span class="hljs-number">-1</span>] INFO  i.m.<span class="hljs-built_in">server</span>.McpAsyncServer - Client initialize <span class="hljs-built_in">request</span> - Protocol: <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span>, Capabilities: ClientCapabilities[experimental=<span class="hljs-literal">null</span>, roots=<span class="hljs-literal">null</span>, sampling=<span class="hljs-literal">null</span>, elicitation=<span class="hljs-literal">null</span>], Info: Implementation[name=Java SDK MCP Client, title=<span class="hljs-literal">null</span>, version=<span class="hljs-number">0.15</span><span class="hljs-number">.0</span>]
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.575</span> [pool<span class="hljs-number">-1</span>-thread<span class="hljs-number">-1</span>] INFO  i.m.client.LifecycleInitializer - <span class="hljs-built_in">Server</span> <span class="hljs-built_in">response</span> <span class="hljs-keyword">with</span> Protocol: <span class="hljs-number">2024</span><span class="hljs-number">-11</span><span class="hljs-number">-05</span>, Capabilities: ServerCapabilities[completions=<span class="hljs-literal">null</span>, experimental=<span class="hljs-literal">null</span>, logging=LoggingCapabilities[], prompts=<span class="hljs-literal">null</span>, resources=<span class="hljs-literal">null</span>, tools=ToolCapabilities[listChanged=<span class="hljs-literal">true</span>]], Info: Implementation[name=baeldung-demo-<span class="hljs-built_in">server</span>, title=<span class="hljs-literal">null</span>, version=<span class="hljs-number">0.0</span><span class="hljs-number">.1</span>] <span class="hljs-keyword">and</span> Instructions <span class="hljs-literal">null</span>
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.626</span> [main] INFO  mcp.McpClientApp2 - Tools exposed by the <span class="hljs-built_in">server</span>:
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.626</span> [main] INFO  mcp.McpClientApp2 - 
Calling <span class="hljs-comment">'logPrompt' tool...</span>
 - logPrompt
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.671</span> [main] INFO  mcp.McpClientApp2 - Result: [TextContent[annotations=<span class="hljs-literal">null</span>, text=Input Prompt: Hello from MCP client!, meta=<span class="hljs-literal">null</span>]]
<span class="hljs-number">14</span>:<span class="hljs-number">04</span>:<span class="hljs-number">28.784</span> [ForkJoinPool.commonPool-worker<span class="hljs-number">-1</span>] WARN  i.m.c.transport.StdioClientTransport - Process terminated <span class="hljs-keyword">with</span> code <span class="hljs-number">143</span>

Process finished <span class="hljs-keyword">with</span> <span class="hljs-keyword">exit</span> code <span class="hljs-number">0</span>
</code></pre>
<p>从日志可以看到，首先 <code>McpServer</code> 启动成功，随后客户端完成初始化并与服务端建立连接。接着客户端请求列出服务端暴露的工具，最后在调用 <code>logPrompt</code> 工具之后，我们也看到了来自服务端的返回结果。</p>
<h2 data-id="heading-10">6. 总结</h2>
<p>在本文中，我们首先回顾了 MCP 及其 Java SDK 的整体架构，重点介绍了 <code>McpServer</code>、<code>McpClient</code> 和 <code>McpHost</code> 之间的关系，以及由 <code>McpTransport</code> 负责的传输层细节。</p>
<p>接着，我们了解了 MCP 中的各种原语（primitives），以及在服务端和客户端侧分别可用的类型和能力。</p>
<p>最后，我们实现了一个简单的 MCP 工具，并通过 MCP 示例服务端和本地自建服务端，验证了 <code>McpClient</code> 的连接与调用流程。借助 MCP 标准和 Java SDK，你可以更方便地把现有系统能力以统一的方式暴露给 AI 应用，也能在不同项目之间复用这套集成模式。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Appium实现Android应用数据爬取：从环境搭建到实战优化]]></title>    <link>https://juejin.cn/post/7584443518162255908</link>    <guid>https://juejin.cn/post/7584443518162255908</guid>    <pubDate>2025-12-17T06:56:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584443518162255908" data-draft-id="7584358227612221482" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Appium实现Android应用数据爬取：从环境搭建到实战优化"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2025-12-17T06:56:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="站大爷IP"/> <meta itemprop="url" content="https://juejin.cn/user/2905353241759261"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Appium实现Android应用数据爬取：从环境搭建到实战优化
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2905353241759261/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    站大爷IP
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T06:56:58.000Z" title="Wed Dec 17 2025 06:56:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>​</p>
<p>在移动互联网时代，Android应用数据爬取已成为电商比价、舆情监测、金融风控等场景的核心需求。然而，传统爬虫工具在应对动态加密参数、反爬策略时往往力不从心。Appium作为跨平台自动化测试工具，凭借其非侵入式操作和灵活的元素定位能力，成为移动端数据爬取的利器。本文将以实战案例为主线，拆解Appium爬取Android应用的全流程，并提供可落地的优化方案。</p>
<h2 data-id="heading-0">一、环境搭建：四步构建爬取基础</h2>
<h3 data-id="heading-1">1. 核心组件安装</h3>
<ul>
<li><strong>Appium Desktop</strong>：选择v1.13.0稳定版，避免新版兼容性问题。安装后配置<code>ANDROID_HOME</code>和<code>JAVA_HOME</code>路径，确保能识别Android SDK和Java环境。</li>
<li><strong>Android SDK</strong>：通过Android Studio安装，重点配置<code>platform-tools</code>和<code>tools</code>目录到系统环境变量。验证命令<code>adb devices</code>应显示已连接设备。</li>
<li><strong>Python依赖</strong>：使用<code>pip install Appium-Python-Client</code>安装客户端库，建议Python版本≥3.7以兼容最新协议。</li>
</ul>
<h3 data-id="heading-2">2. 模拟器选择与配置</h3>
<p>以夜神模拟器为例：</p>
<ul>
<li>安装后进入开发者模式：连续点击“设置→关于平板电脑→版本号”7次。</li>
<li>开启USB调试：在“开发者选项”中勾选“USB调试”和“模拟位置”。</li>
<li>解决ADB版本冲突：若出现<code>adb server version doesn't match</code>错误，替换模拟器目录下的<code>nox_adb.exe</code>为Android SDK中的同名文件。</li>
</ul>
<h3 data-id="heading-3">3. 关键参数获取</h3>
<p>通过ADB命令定位目标应用的包名和入口Activity：</p>
<pre><code class="hljs language-shell" lang="shell">adb shell dumpsys window windows | findstr mFocusedApp
<span class="hljs-meta prompt_"># </span><span class="bash">输出示例：mFocusedApp=AppWindowToken{... com.example.app/.MainActivity}</span>
<span class="hljs-meta prompt_"># </span><span class="bash">包名：com.example.app</span>
<span class="hljs-meta prompt_"># </span><span class="bash">入口Activity：.MainActivity</span>
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-4">二、基础爬取：从启动到元素定位</h2>
<h3 data-id="heading-5">1. 初始化Appium会话</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> appium <span class="hljs-keyword">import</span> webdriver

desired_caps = {
    <span class="hljs-string">"platformName"</span>: <span class="hljs-string">"Android"</span>,
    <span class="hljs-string">"platformVersion"</span>: <span class="hljs-string">"11.0"</span>,
    <span class="hljs-string">"deviceName"</span>: <span class="hljs-string">"127.0.0.1:62001"</span>,  <span class="hljs-comment"># 夜神模拟器默认端口</span>
    <span class="hljs-string">"appPackage"</span>: <span class="hljs-string">"com.example.app"</span>,
    <span class="hljs-string">"appActivity"</span>: <span class="hljs-string">".MainActivity"</span>,
    <span class="hljs-string">"noReset"</span>: <span class="hljs-literal">True</span>,  <span class="hljs-comment"># 保留应用状态</span>
    <span class="hljs-string">"unicodeKeyboard"</span>: <span class="hljs-literal">True</span>  <span class="hljs-comment"># 支持中文输入</span>
}

driver = webdriver.Remote(<span class="hljs-string">"http://localhost:4723/wd/hub"</span>, desired_caps)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-6">2. 元素定位与操作</h3>
<p>Appium支持多种定位策略，推荐组合使用以提高稳定性：</p>
<ul>
<li>
<p><strong>ID定位</strong>：适用于唯一标识元素，如登录按钮。</p>
<pre><code class="hljs language-scss" lang="scss">driver<span class="hljs-selector-class">.find_element_by_id</span>("com.example.app:id/btn_login")<span class="hljs-selector-class">.click</span>()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>XPath定位</strong>：处理动态元素时更灵活，如商品列表项。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 定位第3个商品的价格</span>
<span class="hljs-attr">price</span> = driver.find_element_by_xpath(<span class="hljs-string">"//androidx.recyclerview.widget.RecyclerView/android.view.ViewGroup[3]/android.widget.TextView[2]"</span>).text
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>滚动操作</strong>：模拟用户滑动屏幕加载更多数据。</p>
<pre><code class="hljs language-css" lang="css"># 向下滑动（坐标基于屏幕分辨率）
<span class="hljs-attribute">width</span> = driver<span class="hljs-selector-class">.get_window_size</span>()<span class="hljs-selector-attr">[<span class="hljs-string">"width"</span>]</span>
<span class="hljs-attribute">height</span> = driver<span class="hljs-selector-class">.get_window_size</span>()<span class="hljs-selector-attr">[<span class="hljs-string">"height"</span>]</span>
driver<span class="hljs-selector-class">.swipe</span>(<span class="hljs-attribute">width</span>*<span class="hljs-number">0.5</span>, <span class="hljs-attribute">height</span>*<span class="hljs-number">0.7</span>, <span class="hljs-attribute">width</span>*<span class="hljs-number">0.5</span>, <span class="hljs-attribute">height</span>*<span class="hljs-number">0.3</span>, <span class="hljs-number">500</span>)  # <span class="hljs-number">500ms</span>滑动时长
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-7">三、反爬应对：从IP封禁到参数破解</h2>
<h3 data-id="heading-8">1. IP封禁解决方案</h3>
<ul>
<li>
<p><strong>代理池轮换</strong>：集成站大爷隧道代理，实现每请求更换IP。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> <span class="hljs-type">requests</span>
<span class="hljs-variable">proxies</span> <span class="hljs-operator">=</span> {
    <span class="hljs-string">"http"</span>: <span class="hljs-string">"http://user:pass@proxy_ip:port"</span>,
    <span class="hljs-string">"https"</span>: <span class="hljs-string">"https://user:pass@proxy_ip:port"</span>
}
response = requests.get(<span class="hljs-string">"https://target-site.com"</span>, proxies=proxies)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>降低请求频率</strong>：通过随机延迟模拟人类操作。</p>
<pre><code class="hljs language-lua" lang="lua">import <span class="hljs-built_in">time</span>
import <span class="hljs-built_in">random</span>

def random_delay(min_sec=<span class="hljs-number">1</span>, max_sec=<span class="hljs-number">3</span>):
    <span class="hljs-built_in">time</span>.sleep(<span class="hljs-built_in">random</span>.uniform(min_sec, max_sec))
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ul>
<h3 data-id="heading-9">2. 加密参数破解</h3>
<ul>
<li>
<p><strong>动态调试分析</strong>：使用JADX反编译APK，定位加密逻辑。例如某电商APP的签名参数生成：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// 反编译后发现的签名算法</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">generateSign</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> params</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">MD5Utils</span>.<span class="hljs-title function_">md5</span>(params + <span class="hljs-string">"salt_value"</span>);
}
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>Hook注入</strong>：通过Xposed框架修改加密逻辑（需Root设备）。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Xposed模块示例：绕过SSL证书校验</span>
XposedHelpers.findAndHookMethod(SSLContext.class, <span class="hljs-string">"init"</span>, <span class="hljs-literal">null</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">XC_MethodHook</span>() {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterHookedMethod</span><span class="hljs-params">(MethodHookParam param)</span> <span class="hljs-keyword">throws</span> Throwable {
        param.setResult(<span class="hljs-literal">null</span>);  <span class="hljs-comment">// 强制返回空，跳过校验</span>
    }
});
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ul>
<h2 data-id="heading-10">四、实战案例：爬取某电商APP商品数据</h2>
<h3 data-id="heading-11">1. 目标分析</h3>
<ul>
<li><strong>数据字段</strong>：商品名称、价格、销量、评论数。</li>
<li><strong>反爬机制</strong>：IP频率限制、签名参数、WebView加密。</li>
</ul>
<h3 data-id="heading-12">2. 爬取流程</h3>
<ol>
<li>
<p><strong>初始化会话</strong>：配置代理和设备参数。</p>
</li>
<li>
<p><strong>进入搜索页</strong>：输入关键词并点击搜索。</p>
<pre><code class="hljs language-scss" lang="scss">driver<span class="hljs-selector-class">.find_element_by_id</span>("com.example.app:id/et_search")<span class="hljs-selector-class">.send_keys</span>("手机")
driver<span class="hljs-selector-class">.find_element_by_id</span>("com.example.app:id/btn_search")<span class="hljs-selector-class">.click</span>()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
<li>
<p><strong>滚动加载商品</strong>：循环滑动屏幕直至加载完全部商品。</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">items</span> = []
for _ in range(5): <span class="hljs-comment"># 假设加载5页</span>
    <span class="hljs-comment"># 提取当前页商品信息</span>
    <span class="hljs-attr">products</span> =     driver.find_elements_by_xpath(<span class="hljs-string">"//androidx.recyclerview.widget.RecyclerView/android.view.ViewGroup"</span>)
        for product in products:
            <span class="hljs-attr">name</span> = product.find_element_by_id(<span class="hljs-string">"com.example.app:id/tv_name"</span>).text
            <span class="hljs-attr">price</span> = product.find_element_by_id(<span class="hljs-string">"com.example.app:id/tv_price"</span>).text
            items.append({"name": name, "price": price})
            <span class="hljs-comment"># 滑动到下一页</span>
    random_delay()
    driver.swipe(width0.5, height0.7, width0.5, height0.3, 800)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>4. 数据存储：</strong> 保存为CSV文件。</p>
<pre><code class="hljs language-ini" lang="ini">import pandas as pd
<span class="hljs-attr">df</span> = pd.DataFrame(items)
df.to_csv("products.csv", <span class="hljs-attr">index</span>=<span class="hljs-literal">False</span>)
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
</li>
</ol>
<h2 data-id="heading-13">五、性能优化：从单机到分布式</h2>
<h3 data-id="heading-14">1. 多设备并行爬取</h3>
<p>使用Python的<code>multiprocessing</code>模块启动多个Appium会话：</p>
<pre><code class="hljs language-ini" lang="ini">from multiprocessing import Process

def run_on_device(device_name):
    desired_caps<span class="hljs-section">["deviceName"]</span> = device_name
    <span class="hljs-attr">driver</span> = webdriver.Remote(<span class="hljs-string">"http://localhost:4723/wd/hub"</span>, desired_caps)
    <span class="hljs-comment"># 执行爬取逻辑</span>
    driver.quit()

if <span class="hljs-attr">__name__</span> == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-attr">devices</span> = [<span class="hljs-string">"127.0.0.1:62001"</span>, <span class="hljs-string">"127.0.0.1:62025"</span>]  <span class="hljs-comment"># 两个模拟器端口</span>
    for device in devices:
        <span class="hljs-attr">p</span> = Process(target=run_on_device, args=(device,))
        p.start()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h3 data-id="heading-15">2. 分布式爬取架构</h3>
<ul>
<li><strong>主节点</strong>：分发任务并合并数据。</li>
<li><strong>工作节点</strong>：运行Appium实例执行具体爬取。</li>
<li><strong>消息队列</strong>：使用RabbitMQ或Kafka传递任务和结果。</li>
</ul>
<h2 data-id="heading-16">六、常见问题Q&amp;A</h2>
<p><strong>Q1：被网站封IP怎么办？</strong><br/>
A：立即启用备用代理池，建议使用住宅代理（如站大爷IP代理），配合每请求更换IP策略。同时降低请求频率，增加随机延迟。</p>
<p><strong>Q2：Appium无法定位元素怎么办？</strong><br/>
A：优先检查元素定位策略是否正确。若仍失败，使用<code>uiautomatorviewer</code>工具查看元素属性，或通过XPath的<code>contains()</code>函数模糊匹配：</p>
<pre><code class="hljs language-perl" lang="perl">driver.find_element_by_xpath(<span class="hljs-string">"//*[contains(@text, '登录')]"</span>).click()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>Q3：如何处理WebView内容？</strong><br/>
A：切换到WebView上下文：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">contexts</span> = driver.contexts
driver.switch_to.context(contexts<span class="hljs-section">[-1]</span>)  <span class="hljs-comment"># 切换到最后一个WebView</span>
<span class="hljs-comment"># 操作WebView内的元素（需使用Selenium语法）</span>
driver.find_element_by_css_selector(".btn-submit").click()
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<p><strong>Q4：模拟器性能不足导致爬取缓慢？</strong><br/>
A：优化模拟器配置：</p>
<ul>
<li>分配更多CPU和内存（夜神模拟器设置中调整）。</li>
<li>启用OpenGL硬件加速。</li>
<li>使用真机测试（需开启USB调试和授权）。</li>
</ul>
<p><strong>Q5：如何绕过APP的SSL证书校验？</strong><br/>
A：方法一：使用Xposed框架安装<code>JustTrustMe</code>模块。<br/>
方法二：通过Appium的<code>capabilities</code>禁用证书验证（需Root）：</p>
<pre><code class="hljs language-css" lang="css">desired_caps<span class="hljs-selector-attr">[<span class="hljs-string">"skipDeviceInitialization"</span>]</span> = True
desired_caps<span class="hljs-selector-attr">[<span class="hljs-string">"skipServerInstallation"</span>]</span> = True
</code></pre>
<p><img src="" alt="" title="点击并拖拽以移动" loading="lazy"/></p>
<h2 data-id="heading-17">结语</h2>
<p>Appium的强大之处在于其非侵入式操作和跨平台能力，但真正发挥其价值需结合反爬策略分析、性能优化和分布式架构。通过本文的实战案例和优化方案，读者可快速构建稳定高效的Android应用爬取系统。未来，随着AI技术的融入，Appium有望实现自动化反爬策略识别和动态参数生成，进一步降低人工干预成本。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI 驱动的异构 ETL 环境数据血缘管理系统]]></title>    <link>https://juejin.cn/post/7584379805900013620</link>    <guid>https://juejin.cn/post/7584379805900013620</guid>    <pubDate>2025-12-17T07:52:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584379805900013620" data-draft-id="7584377629707255843" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI 驱动的异构 ETL 环境数据血缘管理系统"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-17T07:52:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="南方者"/> <meta itemprop="url" content="https://juejin.cn/user/2840793779295133"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI 驱动的异构 ETL 环境数据血缘管理系统
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2840793779295133/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    南方者
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T07:52:47.000Z" title="Wed Dec 17 2025 07:52:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">📖 系统架构设计</h2>
<h3 data-id="heading-1">1.1 整体架构概述</h3>
<p>该系统是采用微服务架构，通过 AI 技术自动发现和追踪数据在异构ETL环境中的血缘关系。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ccb44e80378b4d90855344b496e1e5d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=htz13FOREdVAgmRQVLz8E02k9bs%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-2">📖 数据血缘发现流程</h2>
<h3 data-id="heading-3">2.1 自动化血缘发现流程</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/997a9554884148e79490b83b0cbbc1b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=7YRMiDTLj7XwAzY53wnHfT8LWdk%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-4">2.2 SQL 解析与血缘提取</h3>
<p><strong>基于 AI 的</strong> <strong>SQL</strong> <strong>解析引擎：</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">AISQLLineageExtractor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.nlp = spacy.load(<span class="hljs-string">"en_core_web_sm"</span>)
        self.classifier = pipeline(<span class="hljs-string">"text-classification"</span>, 
                                   model=<span class="hljs-string">"distilbert-base-uncased"</span>)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">extract_lineage_from_sql</span>(<span class="hljs-params">self, sql_query, context=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""
        从SQL查询中提取数据血缘关系
        """</span>
        <span class="hljs-comment"># 解析SQL结构</span>
        parsed = sqlparse.parse(sql_query)[<span class="hljs-number">0</span>]

        <span class="hljs-comment"># 使用sql_metadata进行基础解析</span>
        parser = Parser(sql_query)

        <span class="hljs-comment"># AI增强的语义分析</span>
        ai_insights = self.analyze_sql_semantics(sql_query, context)

        <span class="hljs-comment"># 构建血缘关系</span>
        lineage_data = {
            <span class="hljs-string">'input_tables'</span>: parser.tables,
            <span class="hljs-string">'input_columns'</span>: parser.columns,
            <span class="hljs-string">'output_columns'</span>: self.extract_output_columns(parsed),
            <span class="hljs-string">'transformations'</span>: self.extract_transformations(parsed, ai_insights),
            <span class="hljs-string">'confidence_score'</span>: ai_insights.get(<span class="hljs-string">'confidence'</span>, <span class="hljs-number">0.8</span>),
            <span class="hljs-string">'parsing_metadata'</span>: {
                <span class="hljs-string">'query_type'</span>: self.classify_query_type(sql_query),
                <span class="hljs-string">'complexity_score'</span>: self.calculate_complexity(sql_query),
                <span class="hljs-string">'ai_analysis'</span>: ai_insights
            }
        }

        <span class="hljs-keyword">return</span> lineage_data

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_sql_semantics</span>(<span class="hljs-params">self, sql_query, context</span>):
        <span class="hljs-string">"""使用AI分析SQL语义"""</span>
        <span class="hljs-comment"># 构建分析提示</span>
        analysis_prompt = <span class="hljs-string">f"""
        Analyze the following SQL query and extract data lineage information:
        
        SQL: <span class="hljs-subst">{sql_query}</span>
        Context: <span class="hljs-subst">{context}</span>
        
        Please identify:
        1. Source tables and columns
        2. Transformation logic
        3. Target tables and columns
        4. Any data quality operations
        """</span>

        <span class="hljs-comment"># 使用NLP模型进行分析</span>
        analysis_result = self.nlp(analysis_prompt)

        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'entities'</span>: [(ent.text, ent.label_) <span class="hljs-keyword">for</span> ent <span class="hljs-keyword">in</span> analysis_result.ents],
            <span class="hljs-string">'dependencies'</span>: self.extract_semantic_dependencies(analysis_result),
            <span class="hljs-string">'confidence'</span>: self.calculate_semantic_confidence(analysis_result)
        }

<span class="hljs-comment"># 使用示例</span>
extractor = AISQLLineageExtractor()
sql = <span class="hljs-string">"""
SELECT 
    customer_id,
    SUM(order_amount) as total_spent,
    COUNT(DISTINCT order_id) as order_count
FROM orders 
WHERE order_date &gt;= '2024-01-01'
GROUP BY customer_id
"""</span>

lineage = extractor.extract_lineage_from_sql(sql)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"发现的输入表: <span class="hljs-subst">{lineage[<span class="hljs-string">'input_tables'</span>]}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"输出列: <span class="hljs-subst">{[col[<span class="hljs-string">'name'</span>] <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> lineage[<span class="hljs-string">'output_columns'</span>]]}</span>"</span>)
</code></pre>
<h2 data-id="heading-5">📖 血缘关系存储设计</h2>
<h3 data-id="heading-6">3.1 图数据库 Schema 设计</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataLineageGraph</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, neptune_client</span>):
        self.client = neptune_client

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_lineage_graph</span>(<span class="hljs-params">self, lineage_data</span>):
        <span class="hljs-string">"""创建血缘关系图"""</span>

        <span class="hljs-comment"># 创建表节点</span>
        table_nodes = {}
        <span class="hljs-keyword">for</span> table <span class="hljs-keyword">in</span> lineage_data[<span class="hljs-string">'input_tables'</span>] + [lineage_data.get(<span class="hljs-string">'output_table'</span>)]:
            <span class="hljs-keyword">if</span> table:
                table_id = self.create_table_node(table)
                table_nodes[table] = table_id

        <span class="hljs-comment"># 创建列节点和关系</span>
        <span class="hljs-keyword">for</span> col_info <span class="hljs-keyword">in</span> lineage_data.get(<span class="hljs-string">'columns'</span>, []):
            col_id = self.create_column_node(col_info)

            <span class="hljs-comment"># 创建列到表的关系</span>
            self.client.add_edge(
                col_id, 
                table_nodes[col_info[<span class="hljs-string">'table'</span>]], 
                <span class="hljs-string">'BELONGS_TO'</span>
            )

            <span class="hljs-comment"># 创建血缘关系</span>
            <span class="hljs-keyword">for</span> source_col <span class="hljs-keyword">in</span> col_info.get(<span class="hljs-string">'source_columns'</span>, []):
                source_col_id = self.get_column_id(source_col)
                <span class="hljs-keyword">if</span> source_col_id:
                    self.client.add_edge(
                        source_col_id, 
                        col_id, 
                        <span class="hljs-string">'LINEAGE'</span>, 
                        properties={
                            <span class="hljs-string">'transformation'</span>: col_info.get(<span class="hljs-string">'transformation'</span>),
                            <span class="hljs-string">'confidence'</span>: lineage_data.get(<span class="hljs-string">'confidence_score'</span>, <span class="hljs-number">0.8</span>)
                        }
                    )
</code></pre>
<h3 data-id="heading-7">3.2 血缘查询 API 设计</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LineageAPI</span>(<span class="hljs-title class_ inherited__">Resource</span>):
<span class="hljs-meta">    @api.expect(<span class="hljs-params">lineage_model</span>)</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">post</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""查询数据血缘关系"""</span>
        data = request.json

        source_type = data.get(<span class="hljs-string">'source_type'</span>)
        source_name = data.get(<span class="hljs-string">'source_name'</span>) 
        depth = data.get(<span class="hljs-string">'depth'</span>, <span class="hljs-number">3</span>)

        <span class="hljs-keyword">try</span>:
            <span class="hljs-comment"># 执行血缘查询</span>
            <span class="hljs-keyword">if</span> source_type == <span class="hljs-string">'table'</span>:
                result = self.get_table_lineage(source_name, depth)
            <span class="hljs-keyword">elif</span> source_type == <span class="hljs-string">'column'</span>:
                result = self.get_column_lineage(source_name, depth)
            <span class="hljs-keyword">else</span>:
                <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-string">'不支持的源类型'</span>}, <span class="hljs-number">400</span>

            <span class="hljs-keyword">return</span> jsonify({
                <span class="hljs-string">'status'</span>: <span class="hljs-string">'success'</span>,
                <span class="hljs-string">'data'</span>: result,
                <span class="hljs-string">'query'</span>: {
                    <span class="hljs-string">'source'</span>: source_name,
                    <span class="hljs-string">'depth'</span>: depth,
                    <span class="hljs-string">'timestamp'</span>: datetime.utcnow().isoformat()
                }
            })

        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-keyword">return</span> {<span class="hljs-string">'error'</span>: <span class="hljs-built_in">str</span>(e)}, <span class="hljs-number">500</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_table_lineage</span>(<span class="hljs-params">self, table_name, depth</span>):
        <span class="hljs-string">"""获取表级别血缘关系"""</span>
        graph = DataLineageGraph(neptune_client)

        <span class="hljs-comment"># 获取下游影响</span>
        downstream = graph.query_impact_analysis(table_name)

        <span class="hljs-comment"># 获取上游依赖</span>
        upstream = graph.query_root_cause(table_name, <span class="hljs-literal">None</span>)

        <span class="hljs-keyword">return</span> {
            <span class="hljs-string">'table'</span>: table_name,
            <span class="hljs-string">'downstream_impact'</span>: self.format_paths(downstream),
            <span class="hljs-string">'upstream_dependencies'</span>: self.format_paths(upstream),
            <span class="hljs-string">'summary'</span>: {
                <span class="hljs-string">'total_downstream'</span>: <span class="hljs-built_in">len</span>(downstream),
                <span class="hljs-string">'total_upstream'</span>: <span class="hljs-built_in">len</span>(upstream),
                <span class="hljs-string">'max_depth'</span>: depth
            }
        }
</code></pre>
<h2 data-id="heading-8">📖 血缘质量评估流程</h2>
<h3 data-id="heading-9">4.1 质量评估流程图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/23df8c7c44a84b52a38d63eedce6d7b7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=o4oLRmIybD5oUy7HCNaWDWP%2FTp0%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">4.2 质量评估算法实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">LineageQualityAssessor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.scaler = StandardScaler()
        self.classifier = RandomForestClassifier(n_estimators=<span class="hljs-number">100</span>)
        self.quality_metrics = []

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">assess_lineage_quality</span>(<span class="hljs-params">self, lineage_data</span>):
        <span class="hljs-string">"""评估血缘关系质量"""</span>

        <span class="hljs-comment"># 计算质量指标</span>
        metrics = self.calculate_quality_metrics(lineage_data)

        <span class="hljs-comment"># AI质量分类</span>
        quality_score = self.ai_quality_classification(metrics)

        <span class="hljs-comment"># 问题检测</span>
        issues = self.detect_quality_issues(lineage_data, metrics)

        assessment_result = {
            <span class="hljs-string">'overall_score'</span>: quality_score,
            <span class="hljs-string">'quality_level'</span>: self.get_quality_level(quality_score),
            <span class="hljs-string">'metrics'</span>: metrics,
            <span class="hljs-string">'issues'</span>: issues,
            <span class="hljs-string">'recommendations'</span>: self.generate_recommendations(issues, metrics),
            <span class="hljs-string">'confidence'</span>: self.calculate_confidence(metrics, issues)
        }

        <span class="hljs-keyword">return</span> assessment_result

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">calculate_quality_metrics</span>(<span class="hljs-params">self, lineage_data</span>):
        <span class="hljs-string">"""计算血缘质量指标"""</span>
        metrics = {}

        <span class="hljs-comment"># 完整性指标</span>
        metrics[<span class="hljs-string">'completeness'</span>] = self.calculate_completeness(lineage_data)

        <span class="hljs-comment"># 准确性指标</span>
        metrics[<span class="hljs-string">'accuracy'</span>] = self.calculate_accuracy(lineage_data)

        <span class="hljs-comment"># 一致性指标</span>
        metrics[<span class="hljs-string">'consistency'</span>] = self.calculate_consistency(lineage_data)

        <span class="hljs-comment"># 时效性指标</span>
        metrics[<span class="hljs-string">'freshness'</span>] = self.calculate_freshness(lineage_data)

        <span class="hljs-comment"># 复杂性指标</span>
        metrics[<span class="hljs-string">'complexity'</span>] = self.calculate_complexity(lineage_data)

        <span class="hljs-keyword">return</span> metrics

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">ai_quality_classification</span>(<span class="hljs-params">self, metrics</span>):
        <span class="hljs-string">"""使用AI进行质量分类"""</span>
        <span class="hljs-comment"># 准备特征数据</span>
        features = np.array([[
            metrics[<span class="hljs-string">'completeness'</span>],
            metrics[<span class="hljs-string">'accuracy'</span>], 
            metrics[<span class="hljs-string">'consistency'</span>],
            metrics[<span class="hljs-string">'freshness'</span>],
            metrics[<span class="hljs-string">'complexity'</span>]
        ]])

        <span class="hljs-comment"># 标准化特征</span>
        features_scaled = self.scaler.transform(features)

        <span class="hljs-comment"># 预测质量分数</span>
        quality_score = self.classifier.predict_proba(features_scaled)[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]

        <span class="hljs-keyword">return</span> quality_score

<span class="hljs-comment"># 使用示例</span>
assessor = LineageQualityAssessor()
quality_result = assessor.assess_lineage_quality(lineage_data)

<span class="hljs-built_in">print</span>(<span class="hljs-string">f"质量评分: <span class="hljs-subst">{quality_result[<span class="hljs-string">'overall_score'</span>]:<span class="hljs-number">.2</span>f}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"质量等级: <span class="hljs-subst">{quality_result[<span class="hljs-string">'quality_level'</span>]}</span>"</span>)
<span class="hljs-built_in">print</span>(<span class="hljs-string">f"发现的问题: <span class="hljs-subst">{<span class="hljs-built_in">len</span>(quality_result[<span class="hljs-string">'issues'</span>])}</span>个"</span>)
</code></pre>
<h2 data-id="heading-11">📖 实时监控与告警</h2>
<h3 data-id="heading-12">5.1 监控告警流程图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2bde5203f5f5471c95adcf6656773edf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=rudNjZUTdMStmAo%2BVk7N77smBAA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-13">5.2 实时监控实现</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">RealTimeLineageMonitor</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, kafka_config, lineage_graph, alert_service</span>):
        self.consumer = KafkaConsumer(
            kafka_config[<span class="hljs-string">'topic'</span>],
            bootstrap_servers=kafka_config[<span class="hljs-string">'bootstrap_servers'</span>],
            value_deserializer=<span class="hljs-keyword">lambda</span> m: json.loads(m.decode(<span class="hljs-string">'utf-8'</span>))
        )
        self.graph = lineage_graph
        self.alert_service = alert_service
        self.monitoring_rules = self.load_monitoring_rules()

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">start_monitoring</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""启动实时监控"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"启动血缘关系实时监控..."</span>)

        <span class="hljs-keyword">for</span> message <span class="hljs-keyword">in</span> self.consumer:
            <span class="hljs-keyword">try</span>:
                <span class="hljs-comment"># 处理变更事件</span>
                <span class="hljs-keyword">await</span> self.process_change_event(message.value)

            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理监控事件失败: <span class="hljs-subst">{e}</span>"</span>)
                <span class="hljs-comment"># 发送监控错误告警</span>
                <span class="hljs-keyword">await</span> self.send_monitoring_alert(
                    <span class="hljs-string">"MONITORING_ERROR"</span>,
                    <span class="hljs-string">f"处理变更事件时发生错误: <span class="hljs-subst">{<span class="hljs-built_in">str</span>(e)}</span>"</span>,
                    <span class="hljs-string">"HIGH"</span>
                )

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">process_change_event</span>(<span class="hljs-params">self, event</span>):
        <span class="hljs-string">"""处理数据变更事件"""</span>
        event_type = event.get(<span class="hljs-string">'event_type'</span>)
        resource_type = event.get(<span class="hljs-string">'resource_type'</span>)
        resource_name = event.get(<span class="hljs-string">'resource_name'</span>)

        <span class="hljs-comment"># 分析变更影响</span>
        impact_analysis = <span class="hljs-keyword">await</span> self.analyze_change_impact(
            event_type, resource_type, resource_name
        )

        <span class="hljs-comment"># 评估风险</span>
        risk_assessment = self.assess_change_risk(impact_analysis, event)

        <span class="hljs-comment"># 触发相应动作</span>
        <span class="hljs-keyword">await</span> self.trigger_actions(risk_assessment, event)

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">analyze_change_impact</span>(<span class="hljs-params">self, event_type, resource_type, resource_name</span>):
        <span class="hljs-string">"""分析变更影响范围"""</span>

        <span class="hljs-keyword">if</span> resource_type == <span class="hljs-string">'TABLE'</span>:
            <span class="hljs-comment"># 表级别影响分析</span>
            impact_paths = self.graph.query_impact_analysis(resource_name)

            <span class="hljs-comment"># 计算影响范围</span>
            impact_scope = {
                <span class="hljs-string">'direct_impact'</span>: self.get_direct_dependencies(resource_name),
                <span class="hljs-string">'indirect_impact'</span>: self.get_indirect_dependencies(resource_name, depth=<span class="hljs-number">3</span>),
                <span class="hljs-string">'critical_assets'</span>: self.identify_critical_assets(impact_paths),
                <span class="hljs-string">'business_impact'</span>: self.assess_business_impact(impact_paths)
            }

            <span class="hljs-keyword">return</span> impact_scope

        <span class="hljs-keyword">elif</span> resource_type == <span class="hljs-string">'COLUMN'</span>:
            <span class="hljs-comment"># 列级别影响分析</span>
            impact_paths = self.graph.query_impact_analysis(<span class="hljs-literal">None</span>, resource_name)

            <span class="hljs-keyword">return</span> {
                <span class="hljs-string">'column_impact'</span>: impact_paths,
                <span class="hljs-string">'affected_reports'</span>: self.find_affected_reports(resource_name),
                <span class="hljs-string">'data_quality_impact'</span>: self.assess_data_quality_impact(resource_name)
            }

<span class="hljs-comment"># 启动监控服务</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    monitor = RealTimeLineageMonitor(
        kafka_config={<span class="hljs-string">'bootstrap_servers'</span>: <span class="hljs-string">'localhost:9092'</span>, <span class="hljs-string">'topic'</span>: <span class="hljs-string">'data-changes'</span>},
        lineage_graph=lineage_graph,
        alert_service=alert_service
    )

    <span class="hljs-keyword">await</span> monitor.start_monitoring()
</code></pre>
<h2 data-id="heading-14">📖 影响分析与根因追踪</h2>
<h3 data-id="heading-15">6.1 影响分析流程图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b8fe88592d594d6d8dcbe4c922cceca4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=57bCoNRzmHHwNaKjGR0Nj2a1kxA%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-16">6.2 根因分析流程图</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2008cbb658db4a789fcffd0fac466269~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Y2X5pa56ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766562767&amp;x-signature=SEvHoPY48qekwLguzWAIBgbJVl0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-17">最后</h2>
<p><strong>这个增强版方案的核心在于利用 AI 技术（如</strong> <strong>Amazon</strong> <strong>Bedrock 的</strong> <strong>LLM</strong> <strong>模型）提升血缘分析的自动化与智能化水平，准确解析复杂的数据逻辑，同时借助图数据库（Neptune）实现高效的血缘关系管理和分析。数据血缘系统通过构建透明、可信的数据链路，有效提升数据驱动决策的信心。</strong></p>
<p>☞☞<a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Ffree%3Ftrk%3Db5edeb0e-6438-44ef-a5b7-5fd7f1145fed%26sc_channel%3Dsm" target="_blank" title="https://aws.amazon.com/cn/free?trk=b5edeb0e-6438-44ef-a5b7-5fd7f1145fed&amp;sc_channel=sm" ref="nofollow noopener noreferrer">【传送门】</a></p>
<p>以上就是本文的全部内容啦。最后提醒一下各位工友，如果后续不再使用相关服务，别忘了在控制台关闭，避免超出免费额度产生费用～</p>
<ul>
<li>GitHub 代码仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Faws-samples%2Fsample-agentic-data-lineage" target="_blank" title="https://github.com/aws-samples/sample-agentic-data-lineage" ref="nofollow noopener noreferrer">sample-agentic-data-lineage</a></li>
<li>样例数据模型与模式结构，来源于 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdbt-labs%2Fjaffle-shop-classic" target="_blank" title="https://github.com/dbt-labs/jaffle-shop-classic" ref="nofollow noopener noreferrer">dbt-labs/jaffle-shop-classic</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fb-ned.github.io%2Fdbt-colibri%2F" target="_blank" title="https://b-ned.github.io/dbt-colibri/" ref="nofollow noopener noreferrer">Dbt-colibri</a>: A lightweight, developer-friendly CLI tool and self-hostable dashboard for extracting and visualizing column-level lineage from your dbt projects.</li>
<li>仅供概念验证（POC）使用，不适用于生产环境</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何在 Spring Boot 中接入 Amazon ElastiCache]]></title>    <link>https://juejin.cn/post/7584370833705418767</link>    <guid>https://juejin.cn/post/7584370833705418767</guid>    <pubDate>2025-12-17T08:01:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584370833705418767" data-draft-id="7584377629707452451" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何在 Spring Boot 中接入 Amazon ElastiCache"/> <meta itemprop="keywords" content="Java,Redis,数据库"/> <meta itemprop="datePublished" content="2025-12-17T08:01:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿杆"/> <meta itemprop="url" content="https://juejin.cn/user/4182956056773160"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何在 Spring Boot 中接入 Amazon ElastiCache
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4182956056773160/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿杆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:01:01.000Z" title="Wed Dec 17 2025 08:01:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>缓存在服务端是一个非常重要的东西，今天我们来聊聊怎么把 <strong>Amazon ElastiCache应用整合到 Spring Boot</strong> 上，让服务响应提速、系统整体轻盈起来。</p>
<h2 data-id="heading-0">一、为什么你迟早要上缓存</h2>
<p>你有多少次在日志里看着那几百毫秒的 SQL 延迟叹气？尤其当系统访问量上去之后，每次都去查数据库，就像让人每次吃饭都去杀猪。数据库不是不给你干活，它只是累。</p>
<p>缓存就是那只“提前备好的猪”。   简单说，它在内存里帮你留存一份热数据，下次请求直接取，不再查数据库。于是性能暴涨、延迟骤降。</p>
<p>而  <strong>ElastiCache</strong> 是一套托管的缓存服务，<strong>兼容 Redis 或 Valkey 引擎</strong>，性能可直接起飞。官方说它能支持“百万级每秒操作、微秒级响应”，对 Spring Boot 应用来说简直是插上翅膀。</p>
<hr/>
<p>如果你没有亚马逊云账号，可以先去 <a href="https://link.juejin.cn?target=https%3A%2F%2Faws.amazon.com%2Fcn%2Ffree%3Ftrk%3D7d27709e-0bfa-419d-808b-7b9e24f4f9d9%26sc_channel%3Dsm" target="_blank" title="https://aws.amazon.com/cn/free?trk=7d27709e-0bfa-419d-808b-7b9e24f4f9d9&amp;sc_channel=sm" ref="nofollow noopener noreferrer">亚马逊云科技官网</a> 注册一个，注册完成后可以领取最少6个月的 ElastiCache 免费套餐。</p>
<h2 data-id="heading-1">二、Spring Boot + ElastiCache 的组合思路</h2>
<p>整合思路其实特别直接，分几层来看：</p>
<ol>
<li><strong>应用层</strong>：Spring Boot 提供了缓存抽象（<code>@EnableCaching</code>、<code>@Cacheable</code> 等）。</li>
<li><strong>缓存层</strong>：ElastiCache 负责托管 Redis 服务，自动伸缩、自动备份、自动修复。</li>
<li><strong>运行逻辑</strong>：
<ul>
<li>先查缓存</li>
<li>
<ul>
<li>有 → 直接返回；    </li>
</ul>
</li>
<li>
<ul>
<li>没 → 查数据库，再把结果放进缓存。</li>
</ul>
</li>
</ul>
</li>
<li><strong>配置层</strong>：Spring Boot 配 Redis 客户端、连接信息、TTL、SSL 等。</li>
</ol>
<p>这样一来，数据库的压力能被明显削减，服务的响应速度也更稳定。</p>
<h2 data-id="heading-2">三、动手整合：Spring Boot 端配置</h2>
<p>我们直接来实操下，一步步搞起来。</p>
<h3 data-id="heading-3">1. 加依赖</h3>
<p>在 <code>pom.xml</code> 里加入两行依赖就行：</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-cache<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p>第一个是缓存抽象层，第二个是 Redis 实现层。它俩搭配，就是官方标准套路。</p>
<h3 data-id="heading-4">2. 启用缓存功能</h3>
<p>在主类或者配置类上标注 <code>@EnableCaching</code>，就能让 Spring Boot 识别缓存注解。</p>
<p>然后在你的业务方法上加个 <code>@Cacheable</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheableComponent</span> {
  <span class="hljs-meta">@Cacheable</span>(<span class="hljs-string">"userCache"</span>)
  <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getUserInfo</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> uid</span>) {
      <span class="hljs-comment">// 模拟一次数据库调用</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">queryUserFromDB</span>(uid);
  }
}
</code></pre>
<p>第一次调用会触发实际逻辑，之后的调用直接从缓存返回。   Spring Boot 会自动帮你处理 key 生成和缓存写入，非常省心。</p>
<h3 data-id="heading-5">3. 配置 Redis 连接</h3>
<p>在 <code>application.yml</code> 中配置 ElastiCache 的连接地址和 TTL：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">data:</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">host:</span> <span class="hljs-string">my-elasticache-endpoint.amazonaws.com</span>
      <span class="hljs-attr">ssl:</span>
        <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>
  <span class="hljs-attr">cache:</span>
    <span class="hljs-attr">redis:</span>
      <span class="hljs-attr">time-to-live:</span> <span class="hljs-string">10m</span>
</code></pre>
<p>解释一下：</p>
<ul>
<li><code>host</code> 就是你的 ElastiCache 实例地址；</li>
<li><code>ssl.enabled</code> 如果你启用了加密；</li>
<li><code>time-to-live</code> 控制缓存的过期时间，这里设 10 分钟。</li>
</ul>
<p>这几行配置基本能让缓存系统跑起来，咱们就先用这个简单的项目作为示例。</p>
<h2 data-id="heading-6">四、Amazon 端准备：建个 ElastiCache 实例</h2>
<p>如果你还没在 Amazon 上开缓存服务，可以直接用 “Serverless ElastiCache for Redis” 版本。   官方提供了命令行示例，大致是这样：</p>
<pre><code class="hljs language-lua" lang="lua">aws elasticache <span class="hljs-built_in">create</span>-serverless-cache \
  <span class="hljs-comment">--serverless-cache-name spring-demo \</span>
  <span class="hljs-comment">--engine redis \</span>
  <span class="hljs-comment">--subnet-ids subnet-xxxx subnet-yyyy</span>
</code></pre>
<p>创建完之后，再执行：</p>
<pre><code class="hljs language-css" lang="css">aws elasticache describe-serverless-caches \
  <span class="hljs-attr">--serverless-cache-name</span> spring-demo \
  <span class="hljs-attr">--query</span> "ServerlessCaches<span class="hljs-selector-attr">[0]</span><span class="hljs-selector-class">.Endpoint</span><span class="hljs-selector-class">.Address</span>"
</code></pre>
<p>这一步会返回缓存的 endpoint，把它贴到你的 <code>application.yml</code> 里就行。   别忘了打开安全组访问规则，让你的应用主机能访问缓存的 6379 端口。</p>
<h2 data-id="heading-7">五、跑起来试试</h2>
<p>接下来就是验证缓存效果了。运行应用后，第一次请求接口时日志会显示实际方法被执行；</p>
<p>第二次请求时，你会发现方法体不再执行，而是直接返回缓存数据。</p>
<p>这时候你就知道，它已经成功跑起来了。</p>
<p>多说一句，ElastiCache 现在还支持一个叫 <strong>Valkey</strong> 的 Redis 兼容引擎。</p>
<p>它的好处是开源、兼容、可直接替换。如果你想试试更开放的方案，只需要在创建实例时把引擎参数从 <code>redis</code> 改成 <code>valkey</code> 即可。Spring Boot 这边的代码完全不用改。</p>
<h2 data-id="heading-8">六、踩坑警示</h2>
<p>下面是一些常见的注意事项，每一位服务端程序员都应该了解：</p>
<ol>
<li><strong>序列化格式</strong>：默认 JDK 序列化效率不高，建议改成 JSON 或 Kryo。</li>
<li><strong>缓存失效策略</strong>：TTL 设置要合理，避免缓存雪崩。</li>
<li><strong>监控</strong>：用 CloudWatch 监控缓存命中率、延迟、Eviction 情况。</li>
<li><strong>安全配置</strong>：生产环境一定要开 SSL 和访问控制。</li>
</ol>
<p>这些都是缓存落地后必须考虑的细节，不然你就等着半夜被叫醒修 bug 吧。</p>
<h2 data-id="heading-9">七、项目实践建议</h2>
<p>如果你现在手头正好有一个 Spring Boot 项目，可以按这个流程动手：</p>
<ol>
<li>先分析系统的热点接口，挑最耗时的地方加缓存；</li>
<li>设计合理的 key 结构，比如 <code>user:id</code>、<code>product:sku</code>；</li>
<li>在代码里启用 <code>@Cacheable</code>；</li>
<li>本地用 Redis 模拟，验证逻辑；</li>
<li>测试环境切换到 ElastiCache；</li>
<li>部署上线后监控命中率；</li>
<li>定期清理无效数据和优化 TTL。</li>
</ol>
<p>搞完这套下来，你的系统性能会稳得像加了氮气加速器。</p>
<h2 data-id="heading-10">八、结语</h2>
<p>缓存这玩意，说白了就是“用空间换时间”的艺术。</p>
<p>Spring Boot 给了你抽象层，ElastiCache 给了你基础设施，剩下的就看你会不会用。</p>
<p>别等到线上服务卡得像 PPT 才想起缓存。早点加，早点轻松。</p>
<p>以上就是本文的全部内容啦。最后提醒一下各位工友，如果后续不再使用相关服务，别忘了在控制台关闭，避免超出免费额度产生费用～</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[iOS 应用发布流程中常被忽视的关键环节]]></title>    <link>https://juejin.cn/post/7584567736186880038</link>    <guid>https://juejin.cn/post/7584567736186880038</guid>    <pubDate>2025-12-17T08:03:34.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584567736186880038" data-draft-id="7584567736186863654" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="iOS 应用发布流程中常被忽视的关键环节"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T08:03:34.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="开心猴爷"/> <meta itemprop="url" content="https://juejin.cn/user/2179705232165364"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            iOS 应用发布流程中常被忽视的关键环节
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2179705232165364/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    开心猴爷
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:03:34.000Z" title="Wed Dec 17 2025 08:03:34 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在很多项目里，“发布 iOS 应用”经常被视为开发结束后的自然延伸。但当你真正负责一次完整发布时，很快会意识到，这并不是一个单点操作，而是一段横跨多个工具、多个系统、多个角色的工程过程。</p>
<p>我第一次完整跑完 iOS 发布全流程时，代码其实早已稳定，功能也经过验证，但发布阶段仍然反复被打断。问题并不集中在某一个步骤，而是出现在 <strong>步骤之间的衔接</strong>：证书从哪里来、Bundle ID 是否一致、IPA 是否真的符合上架要求、上传由谁来完成。</p>
<p>这些问题单独看都不复杂，但组合在一起，就会不断放大。</p>
<hr/>
<h2 data-id="heading-0"><strong>发布的起点，其实早于构建那一步</strong></h2>
<p>很多人会把 iOS 发布的起点放在“生成 IPA”，但从工程角度看，真正的起点是 <strong>应用身份是否已经确定</strong>。</p>
<p>在实际项目中，发布前我通常会先确认两件事：</p>
<ul>
<li>当前账号下是否已经存在可用的 Bundle ID</li>
<li>这个 Bundle ID 是否已经被其他项目或历史版本使用</li>
</ul>
<p>这一步如果跳过，后面所有环节都可能需要返工。</p>
<p>在 Windows 或非 Xcode 环境下，我会用 <strong>开心上架（Appuploader）查看 Apple 开发者账号中的 Bundle ID 列表</strong>，目的并不是创建，而是确认现状。
这让发布流程从一开始就基于“已知事实”，而不是假设。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e3034525db54c2bacdfd440ff0e5717~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=QJEKaVYC1nh0BxrFmVfuIr%2FTZm8%3D" alt="查看bid" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-1"><strong>证书并不是发布当天才该关心的东西</strong></h2>
<p>证书问题几乎是所有 iOS 发布流程里的高频风险点。
真正的问题通常不是“不会生成证书”，而是：</p>
<ul>
<li>不清楚当前项目在用哪一份</li>
<li>证书只存在某一台 Mac 上</li>
<li>构建节点和上传节点使用的证书不一致</li>
</ul>
<p>在一些项目中，我们把证书管理从 Xcode 自动流程中拆出来，转而使用更明确的方式。</p>
<p>例如，通过 <strong>开心上架（Appuploader）创建 iOS 证书</strong>，直接生成可复用的证书文件，用于构建和发布。这么做的好处是：</p>
<ul>
<li>证书来源清晰</li>
<li>不依赖钥匙串状态</li>
<li>可以在 CI 或不同系统中使用</li>
</ul>
<p>这一步并不会替代 Xcode 的构建能力，但能显著降低发布阶段的不确定性。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e5449909714c73bdf3557a001ba469~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=YRtU1HA36xsuH3KQo%2BjMYZmFRiw%3D" alt="创建证书" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-2"><strong>描述文件的问题，通常不是“没有”，而是“用错了”</strong></h2>
<p>在发布阶段，描述文件（mobileprovision）是一个很容易被忽视的对象。
很多构建失败或上传失败的情况，本质上并不是证书错误，而是描述文件与当前发布目标不匹配。</p>
<p>我见过的情况包括：</p>
<ul>
<li>使用了开发描述文件进行发布</li>
<li>描述文件绑定的 Bundle ID 与当前 IPA 不一致</li>
<li>描述文件权限与实际功能不匹配</li>
</ul>
<p>在发布前，我通常会直接检查描述文件内容，而不是只看文件名。
在 Windows 环境下，这一步可以通过 <strong>Appuploader 查看 mobileprovision 文件信息</strong> 完成，确认：</p>
<ul>
<li>类型是否为 App Store</li>
<li>绑定的 Bundle ID</li>
<li>使用的证书指纹</li>
</ul>
<p>这个动作虽然简单，但它能提前排除大量隐蔽问题。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3059a0a6f09a418c96aede86859fa18e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=RoOg2S%2FppiCmwZVGhcEXkad85a0%3D" alt="查看文件" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-3"><strong>构建只是生成 IPA，不等于“可以发布”</strong></h2>
<p>无论是 Xcode、本地构建，还是 Fastlane、CI 生成的 IPA，构建成功都不代表这个包已经具备发布条件。</p>
<p>在多个项目中，我遇到过：</p>
<ul>
<li>IPA 内 Bundle ID 与预期不一致</li>
<li>使用了调试签名</li>
<li>缺少图标资源或 Assets</li>
<li>Info.plist 权限说明不完整</li>
</ul>
<p>这些问题如果等到上传或审核阶段才暴露，处理成本会明显增加。</p>
<p>因此，在发布前，我会把 IPA 当成一个需要被检查的工程产物，而不是一个“生成即用”的文件。
通过 开心上架（Appuploader）查看 IPA 内容，可以在不依赖 Xcode 的情况下确认这些关键信息。</p>
<hr/>
<h2 data-id="heading-4"><strong>上传并不只是“点一下按钮”</strong></h2>
<p>在单人开发时，用 Xcode 或 Transporter 上传 IPA 很自然。但在团队环境中，上传往往涉及：</p>
<ul>
<li>谁负责上传</li>
<li>上传是否可重复</li>
<li>是否能自动化</li>
<li>是否依赖特定系统</li>
</ul>
<p>当构建发生在 CI 或云端，而上传仍然只能在某一台 Mac 上完成时，发布流程就会变得脆弱。</p>
<p>在一些项目中，我们选择使用 <strong>开心上架（Appuploader）的命令行上传方式</strong>，原因很直接：</p>
<ul>
<li>可以在 Windows、Linux 或 macOS 上执行</li>
<li>支持命令行，便于脚本化</li>
<li>构建和上传可以拆分为独立阶段</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-bash" lang="bash">appuploader_cli -u appleid@example.com -p xxxx-xxxx -c 1 -f app.ipa
</code></pre>
<p>这并不会改变苹果的审核规则，但它改变了发布流程的组织方式。
GUI界面：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d3fbea7ef78f4589b294f1d31dd80dba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5byA5b-D54y054i3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563413&amp;x-signature=MpDh0TcuBxBUoZx7KphAAlQed1s%3D" alt="ipa上传" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-5"><strong>发布之后，流程并没有真正结束</strong></h2>
<p>IPA 上传只是发布过程的一部分。
后续还包括：</p>
<ul>
<li>App Store Connect 中的元数据配置</li>
<li>TestFlight 验证</li>
<li>审核沟通</li>
</ul>
<p>这些步骤大多是 Web 操作，但它们是否顺利，很大程度上取决于前面工程步骤是否干净。</p>
<p>如果证书、Bundle ID、IPA 本身都没有问题，发布阶段通常不会再出现技术层面的阻断。</p>
<hr/>
<h2 data-id="heading-6"><strong>回头看，iOS 发布更像一条流水线一样</strong></h2>
<p>在经历过多次发布之后，我对 iOS 发布全流程的理解逐渐发生变化：</p>
<ul>
<li>它不是一个工具能解决的事情</li>
<li>它不是开发结束后的附属动作</li>
<li>它更像一条需要被设计和维护的工程流水线</li>
</ul>
<p>Xcode、Fastlane、CI、构建工具和开心上架（Appuploader）各自负责不同阶段</p>
<p>当每一步都清楚自己在处理什么对象，发布流程才真正变得稳定。</p>
<hr/>
<p>iOS 发布全流程的难点，很少体现在某一个具体操作上，而是体现在多个环节之间的衔接质量。
当我开始用工程的视角看待证书、Bundle ID、描述文件、IPA 和上传行为时，发布这件事才不再充满不确定性。</p>
<p>代码只是交付的一部分，发布流程本身，同样需要被认真对待。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[重磅！小米刚刚发布新模型MiMo-V2-Flash开源了！]]></title>    <link>https://juejin.cn/post/7584680708125687854</link>    <guid>https://juejin.cn/post/7584680708125687854</guid>    <pubDate>2025-12-17T08:07:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584680708125687854" data-draft-id="7584725608866545690" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="重磅！小米刚刚发布新模型MiMo-V2-Flash开源了！"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-17T08:07:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="智泊AI"/> <meta itemprop="url" content="https://juejin.cn/user/3572727470361578"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            重磅！小米刚刚发布新模型MiMo-V2-Flash开源了！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3572727470361578/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    智泊AI
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:07:54.000Z" title="Wed Dec 17 2025 08:07:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>开源界又来了一位重量级新成员！小米今天正式推出并开源其最新模型 ‌MiMo-V2-Flash‌。</p>
<p>该模型采用专家混合架构（MoE），总参数量达 ‌3090 亿‌，活跃参数为 ‌150 亿‌，性能表现足以与当前顶尖开源模型 ‌DeepSeek-V3.2‌、‌Kimi-K2‌ 等媲美。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cfceae5f2ce4b74a1943655fb261697~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=0Zmx2wmgmyNe83dqCqUezYQjnFk%3D" alt="图片" loading="lazy"/></p>
<p>此外，MiMo-V2-Flash 的代码遵循 MIT 开源协议，基础模型权重已同步上传至 Hugging Face 平台供公开使用。</p>
<p><strong>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9b9124d1b4c245c299b4b24144a94091~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=ZUi8b2XvAdocnUF4DcFVDwYW9O4%3D" alt="图片" loading="lazy"/></p>
<p>抛开"开源"不谈，新模型的核心突破就是架构设计的颠覆性革新，实现‌150 tokens/秒‌的推理速度，并将成本控制在每百万token输入‌0.1美元‌、输出‌0.3美元‌，以极致性价比为最大卖点。（还得是小米！）</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c0f0b57e51b9405ea386e4e6d0815d78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=m77pLBHJWbHWxPdP3rZf3IEizys%3D" alt="图片" loading="lazy"/></p>
<p>根据官方体验页面信息，MiMo-V2-Flash 还具备深度思考和联网搜索能力，不仅可用于日常对话交流，还能在获取实时数据、追踪最新动态或验证资料时发挥作用。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a114bd352cab4260a008d72ed216f2ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=nVxtFUySgwqOWgBTMIoQFczMhvk%3D" alt="图片" loading="lazy"/></p>
<p><strong>开源模型新标杆，MiMo-V2-Flash 跑分全线开花</strong></p>
<p>‌性能表现方面‌，MiMo-V2-Flash的测试数据如下：</p>
<p>在AIME 2025数学竞赛与GPQA-Diamond科学知识测试中，该模型均位列开源模型‌前两名‌。</p>
<p>而且编程能力很突出！SWE-bench Verified测试以‌73.4%‌的得分率碾压所有开源模型，逼近GPT-5-High水平。该测试要求AI修复真实软件漏洞，‌73.4%的成功率‌充分证明其可应对绝大多数实际编程挑战。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d22f89b37350463ea05d4bc324534c87~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=0RixEO5oYQI7j7WiNO2rHka%2BFRY%3D" alt="图片" loading="lazy"/></p>
<p><strong>多语言编程基准测试表现‌</strong></p>
<p>在SWE-Bench Multilingual的评估中，MiMo-V2-Flash展现出71.7%的代码问题解决率。</p>
<p><strong>‌智能体任务性能分析‌</strong></p>
<p>‌τ²-Bench分类得分‌：</p>
<p>通信领域以95.3分领先，零售类达79.5分，航空类为66.0分。</p>
<p>‌搜索代理能力‌：</p>
<p>BrowseComp初始得分45.4，通过上下文管理优化后显著提升至58.3分。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c157274166bc479697b6bc8f5f313540~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=%2B%2BzN3L%2FXi1mM5beCpMy3dNw2y98%3D" alt="图片" loading="lazy"/></p>
<p>实验数据表明，MiMo-V2-Flash 不仅具备代码生成能力，更能深入解析复杂任务逻辑，实现多轮智能体协同交互。其写作质量媲美顶尖闭源模型，进一步验证了该模型不仅是高效工具，更能胜任日常辅助角色。</p>
<p>在维持长文本处理性能的前提下，MiMo-V2-Flash 显著降低了成本，这一突破源于两项关键技术革新：</p>
<p>‌混合滑动窗口注意力机制‌：传统大模型采用全局注意力机制时，计算复杂度呈二次增长，KV 缓存存储需求也随之激增。</p>
<p>‌创新架构设计‌：通过采用5:1的激进分层策略（5层滑动窗口注意力与1层全局注意力交替运行），滑动窗口仅聚焦128个token。该方案使KV缓存存储量缩减约6倍，同时完整保留了256k上下文窗口的长文本处理能力。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3f8e9520be14ebb904ee291e8a24278~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=x0YfFAss%2BpwaPz13rZgiWsQxvuI%3D" alt="图片" loading="lazy"/></p>
<p>尽管采用如此激进的窗口配置，模型仍能保持长文本处理的稳定性。罗福莉在社交媒体上揭示了一个违反直觉的结论：窗口尺寸128被验证为"最优甜点值"。</p>
<p>实验数据显示，过度扩展窗口（例如提升至512）将直接引发性能衰减。此外，她明确强调，在该机制的应用过程中，‌sink values‌的保留对性能维持至关重要，任何情况下均不可省略。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/025822c39872482680025932b6af9272~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=imGDrmlErbdQjgtlHT68n83S4YQ%3D" alt="图片" loading="lazy"/></p>
<p>这项创新技术名为轻量级多Token预测（MTP）。传统文本生成模型每次仅能输出一个Token，如同逐字输入的打字机。而MiMo-V2-Flash凭借其内置的MTP模块，可同步预测后续多个Token，实现"一猜多词"的高效输出。</p>
<p>实际测试显示，该技术平均每次可处理2.8至3.6个Token，推理效率提升达2至2.6倍。其优势不仅体现在推理环节，还能优化训练过程中的采样速度，降低GPU闲置率，达成训练与推理的双重加速效果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87870e4927084770a562d2dfecaa17a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=G46m7ohoKV5nweL4HhAiQV5dBCw%3D" alt="图片" loading="lazy"/></p>
<p>罗福莉指出，采用三层MTP架构时，实验数据显示平均接受长度突破3，编码效率提升至原有水平的2.5倍。该方法显著改善了小批量On-Policy强化学习场景中因"长尾样本"导致的GPU资源闲置问题。</p>
<p>所谓长尾样本，即那些复杂度高、耗时长的任务，会阻塞后续任务执行，导致GPU处于等待状态。MTP技术通过创新机制解决了这一瓶颈，实现资源利用率的大幅提升。</p>
<p>同时罗福莉说明，由于项目周期限制，当前尚未完成MTP与RL训练循环的全面整合，但两者在架构设计上具有高度兼容性。小米已开放三层MTP的源代码，开发者可将其直接应用于实际项目中进行二次开发。</p>
<p><strong>算力只用 1/50，性能如何不打折？</strong></p>
<p><strong>‌预训练阶段‌</strong></p>
<p>新模型采用FP8混合精度训练框架，在规模达27万亿token的数据集上完成训练，并原生支持32k超长序列处理。FP8混合精度通过压缩数值位宽实现高效计算，在显著降低显存占用的同时维持模型精度，当前行业应用较少，需对底层计算架构进行针对性优化。</p>
<p><strong>‌后训练阶段‌</strong></p>
<p>小米团队创新性地开发了多教师在线策略蒸馏（MOPD）方法。传统监督微调结合强化学习的训练管线存在训练波动大、计算资源消耗高等缺陷。MOPD的核心机制是：通过学生模型自主采样策略分布，由多专家教师网络对每个token实施高密度奖励反馈，从而提升训练效率与稳定性。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63317782b59a4474b520d4483b85065b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=VLplEaL8y8ey3sRIoOMJGyG%2F%2FNg%3D" alt="图片" loading="lazy"/></p>
<p>通俗来讲，学生模型就像在实时完成作业，教师模型会对每个字即时打分，无需等待整篇作业提交。这种机制让学生模型能快速吸收教师模型的精华，同时训练过程更加稳定。</p>
<p>最惊人的是效率突破。MOPD仅需传统方法1/50的算力，就能让学生模型达到教师模型的性能巅峰。这使得小米能够以更低的资源消耗实现更快速的模型迭代。</p>
<p>此外，MOPD具备动态接入新教师的能力，成长后的学生模型可反向担任教师角色，构建"教学相长"的闭环进化系统。今天的学员、明天的导师、后天培养出更优秀的学生，这种层层递进的强化机制确实颇具创新性。</p>
<p>正如罗福莉所述，团队基于Thinking Machine的On-Policy Distillation方法论，通过融合多个强化学习模型，实现了效率的显著提升。这不仅建立了自我强化的循环系统基础，更使得学生模型能持续进化，最终超越教师模型的能力边界。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4e9d1873b5c24a46920a1e2335fc607b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=3OP4AsbE%2F2s0WRQUuuiGEb2x22E%3D" alt="图片" loading="lazy"/></p>
<p>在智能体强化学习领域扩展方面，小米MiMo-V2-Flash研究团队通过真实GitHub issue构建了规模达10万+的可验证任务体系。其自动化流水线部署于Kubernetes集群环境，支持最高10000+ Pod并发运行，实现70%的环境部署成功率。</p>
<p>针对网页开发场景的创新设计体现在多模态验证机制上，采用动态视频录制替代传统静态截图验证，有效规避视觉误差问题，精准保障代码执行准确性。该模型与开发者生态的兼容性表现突出，可无缝集成Claude Code、Cursor、Cline等主流开发工具，凭借256K超长上下文窗口容量（相当于一部中篇小说或数十页技术文档的文本量），支持数百轮智能体交互与复杂工具调用流程的稳定执行。</p>
<p>技术开源方面，小米不仅将完整推理代码贡献至SGLang项目，还通过LMSYS博客公开了深度优化经验。技术报告披露了全量模型参数细节，包含MiMo-V2-Flash-Base在内的所有模型权重均通过Hugging Face平台以MIT协议开放。这种程度的开源实践在国内头部科技企业中具有显著突破性。当前该模型已在API Platform提供限时免费服务，开发者可立即接入实际开发环境进行体验验证。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0990129288cc44baac6fb1985bbc359f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=sb%2BEJmj6cqLPQe0XSxrRO%2F0G8hY%3D" alt="图片" loading="lazy"/></p>
<p><strong>小米的 AI 野心，不止于手机助手</strong></p>
<p>MiMo-V2-Flash的推出，展现了小米在AI领域的战略布局全面升级。</p>
<p>据罗福莉在社交媒体披露的最新动态，"MiMo-V2-Flash现已开放使用。这仅是我们在AGI发展路径中的第二个里程碑。" 仅第二步便已具备如此突破性，后续的技术演进更令人充满想象空间。</p>
<p>小米的技术文档同时指出，当前MiMo-V2-Flash性能仍领先闭源模型存在提升空间。但企业战略清晰可见：将通过扩展模型参数与计算资源投入持续优化性能边界，同步推进更可靠、更敏捷的智能体框架研发。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41af4cb3417b4a359d2cbd8c77994d1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pm65rOKQUk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766563674&amp;x-signature=Yr6yiDi0rhFVaama%2Fl6eHQAA0%2F0%3D" alt="图片" loading="lazy"/></p>
<p>在MOPD框架中，教师模型与学生模型通过双向迭代实现协同进化，为后续的性能拓展保留了充分潜力。从战略层面审视，这标志着小米对AI生态体系的一次关键布局。面对手机、IoT设备与智能汽车构成的硬件矩阵，小米亟需一个支撑全域的AI核心架构，而MiMo-V2-Flash正是为此战略需求打造的基座型解决方案。</p>
<p>正如2011年小米手机以1999元颠覆旗舰机定价体系，当前MiMo-V2-Flash凭借极致的成本控制与73.4%的SWE-Bench基准表现，正在重塑开源大模型的价值标杆。这场技术上的革新，无疑迎来了开源领域小米的爆发时刻。</p>
<p><strong>更多AI大模型学习视频及资源，都在<a href="https://link.juejin.cn?target=https%3A%2F%2Fyuan.zhipoai.cn%2F" target="_blank" title="https://yuan.zhipoai.cn/" ref="nofollow noopener noreferrer">智泊AI</a>。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[鸿蒙HarmonyOS多线程编程实战：AI语音]]></title>    <link>https://juejin.cn/post/7584443518035968063</link>    <guid>https://juejin.cn/post/7584443518035968063</guid>    <pubDate>2025-12-17T08:04:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584443518035968063" data-draft-id="7584439538312871999" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="鸿蒙HarmonyOS多线程编程实战：AI语音 "/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T08:04:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户859968167769"/> <meta itemprop="url" content="https://juejin.cn/user/2086203644184827"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            鸿蒙HarmonyOS多线程编程实战：AI语音 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2086203644184827/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户859968167769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:04:35.000Z" title="Wed Dec 17 2025 08:04:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>鸿蒙HarmonyOS多线程编程实战：AI语音---xingkeit.top/8704/</strong></p>
<h2 data-id="heading-0">亲历鸿蒙AI语音多线程开发：新手快速上手的实战经验谈</h2>
<h3 data-id="heading-1">从零到一的鸿蒙AI语音初体验</h3>
<p>初次接触鸿蒙系统的AI语音开发时，我被其多线程架构与分布式能力所震撼。与传统安卓开发相比，鸿蒙的"一次开发，多端部署"特性让语音交互开发效率大幅提升：</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 基础语音识别初始化（HarmonyOS版）</span>
private void <span class="hljs-built_in">initSpeechRecognizer</span>() {
    <span class="hljs-comment">// 创建语音识别插件对象</span>
    mSpeechRecognizer = AudioCaptor<span class="hljs-selector-class">.create</span>(AudioCaptor.AudioCaptorType.TYPE_VOICE_RECOGNITION);
    
    <span class="hljs-comment">// 设置监听器</span>
    mSpeechRecognizer<span class="hljs-selector-class">.setCaptorListener</span>(new AudioCaptorListener() {
        <span class="hljs-keyword">@Override</span>
        public void onCaptorDataAvailable(AudioCaptor captor, byte[] bytes) {
            <span class="hljs-comment">// 语音数据处理线程</span>
            new <span class="hljs-built_in">Thread</span>(() -&gt; <span class="hljs-built_in">processVoiceData</span>(bytes))<span class="hljs-selector-class">.start</span>();
        }
    });
}
</code></pre>
<h3 data-id="heading-2">多线程开发的三大核心挑战</h3>
<h4 data-id="heading-3">1. 线程安全与资源竞争</h4>
<p>语音处理涉及多个并行线程：</p>
<ul>
<li>音频采集线程</li>
<li>特征提取线程</li>
<li>网络请求线程</li>
<li>UI更新线程</li>
</ul>
<p>Java</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-comment">// 线程安全的数据共享方案</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">VoiceDataBuffer</span> {
    <span class="hljs-keyword">private</span> final ReentrantLock <span class="hljs-keyword">lock</span> = <span class="hljs-keyword">new</span> ReentrantLock();
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">byte</span>[] buffer;
    
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateBuffer</span>(<span class="hljs-params"><span class="hljs-built_in">byte</span>[] newData</span>)</span> {
        <span class="hljs-keyword">lock</span>.<span class="hljs-keyword">lock</span>();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">this</span>.buffer = newData.clone();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">lock</span>.unlock();
        }
    }
}
</code></pre>
<h4 data-id="heading-4">2. 实时性与延迟的平衡</h4>
<p>语音交互对实时性要求极高，我们的优化方案：</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 双缓冲队列实现低延迟处理</span>
ArrayBlockingQueue&lt;byte<span class="hljs-selector-attr">[]</span>&gt; audioQueue = new ArrayBlockingQueue&lt;&gt;(<span class="hljs-number">2</span>); <span class="hljs-comment">// 容量2的队列</span>

void <span class="hljs-built_in">onAudioData</span>(byte[] data) {
    if (!audioQueue.offer(data)) {  <span class="hljs-comment">// 非阻塞写入</span>
        audioQueue<span class="hljs-selector-class">.poll</span>();          <span class="hljs-comment">// 丢弃旧数据</span>
        audioQueue<span class="hljs-selector-class">.offer</span>(data);
    }
}
</code></pre>
<h4 data-id="heading-5">3. 多设备协同的分布式处理</h4>
<p>鸿蒙的分布式能力让语音处理可以跨设备：</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 发现附近设备</span>
List&lt;DeviceInfo&gt; devices = DeviceManager<span class="hljs-selector-class">.getDeviceList</span>(DeviceFilter.ALL);

<span class="hljs-comment">// 分布式任务分发</span>
if (devices.size() &gt; <span class="hljs-number">0</span>) {
    DistributedTaskDispatcher dispatcher = 
        DistributedTaskDispatcher<span class="hljs-selector-class">.getInstance</span>(context);
    dispatcher<span class="hljs-selector-class">.syncDispatch</span>(devices.get(<span class="hljs-number">0</span>), 
        new <span class="hljs-built_in">VoiceProcessTask</span>(rawAudioData));
}
</code></pre>
<h3 data-id="heading-6">语音处理流水线实战</h3>
<p>我们构建的高效处理流水线：</p>
<p>PlainText</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[麦克风采集]</span> → <span class="hljs-selector-attr">[环形缓冲区]</span> → <span class="hljs-selector-attr">[特征提取线程]</span> 
    → <span class="hljs-selector-attr">[AI推理线程]</span> → <span class="hljs-selector-attr">[结果分发线程]</span>
</code></pre>
<p>关键代码实现：</p>
<p>Java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 特征提取线程</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FeatureExtractor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (isRunning) {
            <span class="hljs-type">byte</span>[] data = audioQueue.take();
            <span class="hljs-type">float</span>[] features = AudioProcessor.extractMFCC(data);
            featureQueue.put(features);  <span class="hljs-comment">// 传递给下一阶段</span>
        }
    }
}

<span class="hljs-comment">// AI推理线程</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AIPredictor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">while</span> (isRunning) {
            <span class="hljs-type">float</span>[] features = featureQueue.take();
            <span class="hljs-type">Result</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> Model.predict(features);
            EventBus.post(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResultEvent</span>(result));
        }
    }
}
</code></pre>
<h3 data-id="heading-7">新手必知的五个调试技巧</h3>
<ol>
<li>
<p><strong>时间戳标记法</strong>：跟踪数据在各线程的流转</p>
<p>Java</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">Log</span><span class="hljs-selector-class">.info</span>(<span class="hljs-string">"TIMESTAMP"</span>, <span class="hljs-string">"特征提取开始: "</span> + 
    System.<span class="hljs-built_in">currentTimeMillis</span>());
</code></pre>
</li>
<li>
<p><strong>线程可视化工具</strong>：使用DevEco Studio的Thread Analyzer</p>
</li>
<li>
<p><strong>模拟延迟测试</strong>：人为添加延迟验证健壮性</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss">Thread<span class="hljs-selector-class">.sleep</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// 模拟处理延迟</span>
</code></pre>
</li>
<li>
<p><strong>内存快照分析</strong>：检查音频数据的内存占用</p>
</li>
<li>
<p><strong>分布式调试模式</strong>：通过hilog命令查看跨设备日志</p>
<p>Shell</p>
<p><em></em></p>
<pre><code class="hljs language-perl" lang="perl">hilog | <span class="hljs-keyword">grep</span> VoiceService
</code></pre>
</li>
</ol>
<h3 data-id="heading-8">性能优化关键指标</h3>
<p>我们建立的监控指标体系：</p>






























<table><thead><tr><th>指标</th><th>目标值</th><th>测量方法</th></tr></thead><tbody><tr><td>端到端延迟</td><td>&lt;300ms</td><td>从语音输入到响应输出的时间差</td></tr><tr><td>CPU占用率</td><td>&lt;30%</td><td>使用PerformanceMonitor监控</td></tr><tr><td>内存波动</td><td>&lt;50MB</td><td>内存快照对比</td></tr><tr><td>线程切换耗时</td><td>&lt;5ms</td><td>Systrace工具分析</td></tr></tbody></table>
<p>优化后的线程调度方案：</p>
<p>Java</p>
<pre><code class="hljs language-ini" lang="ini">// 使用鸿蒙的优先级线程池
TaskDispatcher <span class="hljs-attr">dispatcher</span> = 
    TaskDispatcherFactory.getPriorityDispatcher(
        TaskPriority.HIGH)<span class="hljs-comment">;</span>
        
dispatcher.asyncDispatch(new CriticalTask())<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-9">踩坑记录与解决方案</h3>
<p><strong>坑1：音频数据丢失</strong></p>
<ul>
<li>
<p>现象：部分语音片段未被处理</p>
</li>
<li>
<p>原因：缓冲区溢出</p>
</li>
<li>
<p>解决：实现动态缓冲池</p>
<p>Java</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">AdaptiveBuffer</span> <span class="hljs-variable">audioBuffer</span> <span class="hljs-operator">=</span> 
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AdaptiveBuffer</span>(<span class="hljs-number">1024</span>, <span class="hljs-number">0.75f</span>);
</code></pre>
</li>
</ul>
<p><strong>坑2：跨设备响应不同步</strong></p>
<ul>
<li>
<p>现象：多设备响应时间差异大</p>
</li>
<li>
<p>解决：添加时间同步协议</p>
<p>Java</p>
<pre><code class="hljs language-ini" lang="ini">long <span class="hljs-attr">baseTime</span> = DistributedTimeManager.getSyncTime()<span class="hljs-comment">;</span>
</code></pre>
</li>
</ul>
<p><strong>坑3：唤醒词误触发</strong></p>
<ul>
<li>
<p>现象：环境噪声导致误唤醒</p>
</li>
<li>
<p>解决：二级验证机制</p>
<p>Java</p>
<pre><code class="hljs language-scss" lang="scss">if (WakeWordDetector.check(rawAudio)) {
    if (NoiseFilter.verify(rawAudio)) {
        <span class="hljs-built_in">triggerWake</span>();
    }
}
</code></pre>
</li>
</ul>
<h3 data-id="heading-10">给鸿蒙新手的建议</h3>
<ol>
<li><strong>先理解Ability框架</strong>：掌握Page Ability和Service Ability的区别</li>
<li><strong>善用DevEco工具链</strong>：特别是分布式调试功能</li>
<li><strong>从官方Demo入手</strong>：重点研究AI子系统示例</li>
<li><strong>加入鸿蒙社区</strong>：及时获取最新的API变更信息</li>
<li><strong>保持原子化设计</strong>：每个Ability保持单一职责</li>
</ol>
<p>鸿蒙的AI语音开发就像指挥一支交响乐团，多线程是各种乐器，分布式能力是演奏厅的声学设计。经过这个项目的锤炼，我总结出鸿蒙开发的黄金法则：<strong>理解线程生命周期，拥抱分布式思维，严格监控性能指标</strong>。记住，优秀的鸿蒙开发者不仅是程序员，更是多设备协同交响乐的指挥家。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[UE5虚幻引擎汽车HMI设计高级研修课]]></title>    <link>https://juejin.cn/post/7584439538313052223</link>    <guid>https://juejin.cn/post/7584439538313052223</guid>    <pubDate>2025-12-17T08:14:04.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584439538313052223" data-draft-id="7584443518036082751" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="UE5虚幻引擎汽车HMI设计高级研修课"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2025-12-17T08:14:04.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户859968167769"/> <meta itemprop="url" content="https://juejin.cn/user/2086203644184827"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            UE5虚幻引擎汽车HMI设计高级研修课
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2086203644184827/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户859968167769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:14:04.000Z" title="Wed Dec 17 2025 08:14:04 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>UE5虚幻引擎汽车HMI设计高级研修课---xingkeit.top/8657/</strong></p>
<h2 data-id="heading-0">UE5汽车HMI设计避坑指南：高级研修课总结的常见渲染问题解决方案</h2>
<h3 data-id="heading-1">HMI渲染的三大核心挑战</h3>
<p>在UE5汽车HMI开发中，我们面临着独特的渲染挑战，研修课将这些挑战系统归纳为：</p>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// HMI渲染质量评估指标（概念代码）</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">HMIRenderingMetrics</span> {
    <span class="hljs-type">float</span> frameRate;         <span class="hljs-comment">// 必须稳定在60fps以上</span>
    <span class="hljs-type">float</span> latency;           <span class="hljs-comment">// 输入延迟&lt;50ms</span>
    <span class="hljs-type">float</span> colorAccuracy;     <span class="hljs-comment">// 色差ΔE&lt;3</span>
    <span class="hljs-type">bool</span> temporalStability;  <span class="hljs-comment">// 时间稳定性（无闪烁）</span>
};
</code></pre>
<h3 data-id="heading-2">材质系统常见陷阱与修复</h3>
<h4 data-id="heading-3">1. 仪表盘反光失控问题</h4>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 错误的材质设置导致过度反光</span>
Material<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetScalarParameterValue</span>(<span class="hljs-string">"Roughness"</span>, <span class="hljs-number">0.1</span>f); <span class="hljs-comment">// 粗糙度过低</span>

<span class="hljs-comment">// 课程推荐的汽车HMI材质参数</span>
MaterialInstance<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetScalarParameterValue</span>(<span class="hljs-string">"Roughness"</span>, <span class="hljs-number">0.6</span>f);
MaterialInstance<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetScalarParameterValue</span>(<span class="hljs-string">"Metallic"</span>, <span class="hljs-number">0.3</span>f);
MaterialInstance<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetVectorParameterValue</span>(<span class="hljs-string">"BaseColor"</span>, <span class="hljs-title function_ invoke__">FLinearColor</span>(<span class="hljs-number">0.05</span>f, <span class="hljs-number">0.05</span>f, <span class="hljs-number">0.1</span>f));
</code></pre>
<h4 data-id="heading-4">2. 夜间模式色偏问题</h4>
<p>课程提供的<strong>色彩校正方案</strong>：</p>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-ini" lang="ini">// 在PostProcessVolume中设置
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_ColorGamma</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.ColorGamma</span> = FVector4(<span class="hljs-number">2.2</span>f, <span class="hljs-number">2.2</span>f, <span class="hljs-number">2.2</span>f, <span class="hljs-number">0.0</span>f)<span class="hljs-comment">; </span>
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_ColorGain</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.ColorGain</span> = FVector4(<span class="hljs-number">0.9</span>f, <span class="hljs-number">0.95</span>f, <span class="hljs-number">1.0</span>f, <span class="hljs-number">0.0</span>f)<span class="hljs-comment">; // 减少蓝光</span>
</code></pre>
<h3 data-id="heading-5">光照系统优化方案</h3>
<h4 data-id="heading-6">1. 动态光照性能消耗</h4>
<p><strong>课程解决方案</strong>：</p>
<ul>
<li>使用Lumen的软阴影替代传统动态阴影</li>
<li>对HMI元素启用"Static Lighting"标记</li>
<li>优化光照图分辨率（建议128-256px/m）</li>
</ul>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-rust" lang="rust"><span class="hljs-comment">// 光照优化配置代码</span>
PrimaryLight<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetShadowResolution</span>(<span class="hljs-number">512</span>); <span class="hljs-comment">// 降低阴影分辨率</span>
HMI_Mesh<span class="hljs-punctuation">-&gt;</span><span class="hljs-title function_ invoke__">SetLightingChannels</span>(<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 使用专用光照通道</span>
</code></pre>
<h4 data-id="heading-7">2. 环境光遮蔽(SSAO)问题</h4>
<p><strong>参数调优方案</strong>：</p>
<p>Ini</p>
<p><em></em></p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">; DefaultEngine.ini配置</span>
<span class="hljs-section">[/Script/Engine.RendererSettings]</span>
<span class="hljs-attr">r.SSAO.Quality</span>=<span class="hljs-number">2</span>
<span class="hljs-attr">r.SSAO.Radius</span>=<span class="hljs-number">50.0</span>
<span class="hljs-attr">r.SSAO.FadeRadius</span>=<span class="hljs-number">50.0</span>
<span class="hljs-attr">r.SSAO.Power</span>=<span class="hljs-number">2.0</span>
<span class="hljs-attr">r.SSAO.Bias</span>=<span class="hljs-number">0.1</span>
</code></pre>
<h3 data-id="heading-8">UI渲染关键技巧</h3>
<h4 data-id="heading-9">1. 字体边缘锯齿修复</h4>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-ini" lang="ini">// Slate字体渲染设置
FSlateFontInfo <span class="hljs-attr">FontInfo</span> = FCoreStyle::GetDefaultFontStyle(<span class="hljs-string">"Regular"</span>, <span class="hljs-number">24</span>)<span class="hljs-comment">;</span>
<span class="hljs-attr">FontInfo.OutlineSettings.OutlineSize</span> = <span class="hljs-number">1</span><span class="hljs-comment">;</span>
<span class="hljs-attr">FontInfo.OutlineSettings.OutlineColor</span> = FLinearColor::Black<span class="hljs-comment">;</span>
<span class="hljs-attr">FontInfo.FontMaterial</span> = LoadObject&lt;UMaterialInterface&gt;(...)<span class="hljs-comment">;</span>
</code></pre>
<h4 data-id="heading-10">2. 动态UI元素闪烁问题</h4>
<p><strong>课程推荐的解决方案</strong>：</p>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 在Widget蓝图中设置</span>
Widget-&gt;<span class="hljs-built_in">SetClipping</span>(EWidgetClipping::ClipToBounds);
Widget-&gt;<span class="hljs-built_in">SetVisibility</span>(ESlateVisibility::Visible);
Widget-&gt;<span class="hljs-built_in">SetRenderTransformPivot</span>(FVector2D(<span class="hljs-number">0.5</span>f, <span class="hljs-number">0.5</span>f));

<span class="hljs-comment">// 引擎级修复（4.27+版本有效）</span>
static FAutoConsoleVariableRef <span class="hljs-built_in">CVar</span>(
    TEXT("r.VSync"),
    GVsyncEnabled,
    TEXT("Enable VSync to avoid tearing"),
    ECVF_RenderThreadSafe
);
</code></pre>
<h3 data-id="heading-11">后处理特效优化</h3>
<h4 data-id="heading-12">1. 抗锯齿选择策略</h4>





























<table><thead><tr><th>方案</th><th>适用场景</th><th>性能消耗</th><th>推荐参数</th></tr></thead><tbody><tr><td>TAA</td><td>高动态场景</td><td>中</td><td>TemporalSampleCount=8</td></tr><tr><td>FXAA</td><td>静态HMI</td><td>低</td><td>Quality=3</td></tr><tr><td>MSAA</td><td>矢量UI元素</td><td>高</td><td>Samples=4</td></tr></tbody></table>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 动态切换抗锯齿方案</span>
void <span class="hljs-built_in">SetAAMethod</span>(EHMIState CurrentState) {
    if (CurrentState == EHMIState::Driving) {
        Engine-&gt;<span class="hljs-built_in">SetAAMethod</span>(ETAAMethod::TAA);
    } else {
        Engine-&gt;<span class="hljs-built_in">SetAAMethod</span>(ETAAMethod::FXAA);
    }
}
</code></pre>
<h4 data-id="heading-13">2. Bloom过曝控制</h4>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-ini" lang="ini">// 仪表盘专用Bloom设置
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_BloomIntensity</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.BloomIntensity</span> = <span class="hljs-number">0.8</span>f<span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_BloomThreshold</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.BloomThreshold</span> = <span class="hljs-number">5.0</span>f<span class="hljs-comment">; // 提高阈值避免UI元素过亮</span>
PostProcess-&gt;<span class="hljs-attr">Settings.bOverride_BloomDirtMaskIntensity</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
PostProcess-&gt;<span class="hljs-attr">Settings.BloomDirtMaskIntensity</span> = <span class="hljs-number">0.3</span>f<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-14">平台特定优化方案</h3>
<h4 data-id="heading-15">1. 车载芯片适配问题</h4>
<p><strong>课程总结的优化清单</strong>：</p>
<ul>
<li>禁用动态分辨率</li>
<li>使用Mobile HDR渲染路径</li>
<li>简化粒子系统</li>
<li>限制骨骼网格体数量</li>
</ul>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// 检测硬件性能自动降级</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ApplyQualityPreset</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (GPUBenchmarkScore &lt; <span class="hljs-number">500</span>) {
        Scalability::<span class="hljs-built_in">SetQualityLevel</span>(<span class="hljs-number">1</span>);
        PostProcess-&gt;Settings.bOverride_MobileHQGaussian = <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<h4 data-id="heading-16">2. 多屏同步渲染</h4>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 多视口同步方案</span>
for (UMGDisplay* Display : Displays) {
    <span class="hljs-attribute">Display</span>-&gt;<span class="hljs-built_in">GetViewportClient</span>()-&gt;bLockToVsync = true;
    <span class="hljs-attribute">Display</span>-&gt;<span class="hljs-built_in">GetViewportClient</span>()-&gt;<span class="hljs-built_in">SetTickGroup</span>(TG_PostUpdateWork);
    <span class="hljs-attribute">Display</span>-&gt;<span class="hljs-built_in">GetViewportClient</span>()-&gt;<span class="hljs-built_in">SetTickMode</span>(ETickMode::Enabled);
}
</code></pre>
<h3 data-id="heading-17">性能监控与调试</h3>
<p>课程推荐的<strong>实时监控方案</strong>：</p>
<p>Cpp</p>
<p><em></em></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 内置性能HUD设置</span>
UHUD::AddStatOverride(
    TEXT(<span class="hljs-string">"HMI"</span>), 
    TEXT(<span class="hljs-string">"60FPS"</span>), 
    FLinearColor::Green,
    [<span class="hljs-keyword">this</span>](){ <span class="hljs-keyword">return</span> IsRunningAtTargetFrameRate(); }
);

<span class="hljs-comment">// 自定义性能指标</span>
FEnginePerformanceTargets Targets;
Targets.SetPerformanceTargets(
    <span class="hljs-number">60.0f</span>,    <span class="hljs-comment">// 帧率</span>
    <span class="hljs-number">15.0f</span>,    <span class="hljs-comment">// 帧时间(ms)</span>
    <span class="hljs-number">50.0f</span>,    <span class="hljs-comment">// 渲染线程时间(ms)</span>
    <span class="hljs-number">50.0f</span>     <span class="hljs-comment">// 游戏线程时间(ms)</span>
);
</code></pre>
<h3 data-id="heading-18">课程精华：HMI渲染黄金法则</h3>
<ol>
<li><strong>稳定性优先</strong>：任何特效都不能以牺牲帧稳定性为代价</li>
<li><strong>物理准确性</strong>：光照和材质必须符合真实物理参数</li>
<li><strong>人因工程</strong>：所有视觉元素必须通过ISO-9241可用性测试</li>
<li><strong>平台适配</strong>：针对不同硬件提供3级质量预设</li>
<li><strong>数据驱动</strong>：建立自动化视觉质量评估体系</li>
</ol>
<p>这套高级研修课最宝贵的不是具体的技术方案，而是培养了对汽车HMI渲染的<strong>系统级思考框架</strong>。记住课程的核心观点：优秀的车载HMI=50%技术精度+30%人因工程+20%美学设计。现在就开始用课程中的"渲染问题诊断树"来检查你的项目，你会发现90%的视觉问题都有迹可循！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[深入ClassLoader：从双亲委派到SPI]]></title>    <link>https://juejin.cn/post/7584408254819827747</link>    <guid>https://juejin.cn/post/7584408254819827747</guid>    <pubDate>2025-12-17T08:14:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584408254819827747" data-draft-id="7582783931164147747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="深入ClassLoader：从双亲委派到SPI"/> <meta itemprop="keywords" content="JVM"/> <meta itemprop="datePublished" content="2025-12-17T08:14:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="葛二蛋"/> <meta itemprop="url" content="https://juejin.cn/user/3562073405268862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            深入ClassLoader：从双亲委派到SPI
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562073405268862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    葛二蛋
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:14:05.000Z" title="Wed Dec 17 2025 08:14:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>读懂了class文件之后, 今天来聊一聊加载class的那些事儿（基于Java SE 8）</p>
</blockquote>
<h2 data-id="heading-0">一、类加载器</h2>
<p>在jvm中主要有三大内置类加载器</p>





























<table><thead><tr><th>加载器类型</th><th>实现类</th><th>加载路径</th><th>源码位置</th></tr></thead><tbody><tr><td>Bootstrap</td><td>C/C++实现</td><td><code>sun.boot.class.path</code></td><td><code>hotspot/src/share/vm/...</code></td></tr><tr><td>Extension</td><td><code>ExtClassLoader</code></td><td><code>java.ext.dirs</code></td><td><code>sun.misc.Launcher$ExtClassLoader</code></td></tr><tr><td>Application</td><td><code>AppClassLoader</code></td><td><code>java.class.path</code></td><td><code>sun.misc.Launcher$AppClassLoader</code></td></tr></tbody></table>
<h3 data-id="heading-1">Bootstrap类加载器</h3>
<p>作为jvm最顶层类加载器，jvm实现的一部分，由C/C++实现（HotspotVM是C++）也是唯一一个非ClassLoader子类的加载器，默认情况下负责加载%JAVA_HOME%/jre/lib目录,也可以通过<code>-Xbootclasspath</code>指定加载路径(但这一步有较高的风险性，如果指定加载了与核心jar包同名同路径的class，会造成逻辑破坏）</p>
<p>可以通过getClassLoader()查看类被哪个加载器加载</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/453dfe9fc3d64cadb71afead659838f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=tJNe1NSHfZ4W7hy4aMzIGgQiqd8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f782648351db448a96fda196264ebb05~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=4DlJfMczwpgTzNYzY8Gid7kdPxg%3D" alt="image.png" loading="lazy"/></p>
<p>这段示例代码中输出了两个信息，一是First类本身的类加载器位于rt.jar中的<code>sum.misc.Launcher$AppClassLoader</code>，二则是负责加载核心jar包的<code>BootstrapClassLoader</code>, 但因为Bootstrap是由本地语言实现，所以在java程序中通过getClassLoader()获取其结果显示为<code>null</code></p>
<h3 data-id="heading-2">Extension类加载器</h3>
<p>该类加载器是由java代码实现，位于rt.jar中<code>sun.misc.Launcher$ExtClassloader</code>从这里可以发现，他与AppClassLoader同为Launcher的内部类，且都继承自<code>java.net.URLClassLoader</code>这里暂不展开，<code>ExtClassLoader</code>主要负责加载%JAVA_HOME%/jre/lib/ext/目录</p>
<p>比如随便找一个ext下的jaccess.jar中的ButtonTranslator类：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a83e43bde954baaa8df9f9616c36fab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=TWjI8wq5M85fucNV6o0YqADn19A%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e47968ee941c4e7e8e2aee70d67c9f24~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=JdMQp8FnXLysBlczCeue%2BWMFjCI%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-3">Application类加载器</h3>
<p>该类加载器也是java代码实现，主要负责加载classpath目录，也就是我们开发的应用代码的类加载器，比如第一个demo中的First类，其加载器就是<code>AppClassLoader</code></p>
<h3 data-id="heading-4">类加载器层级(实现层面）</h3>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/383a54bc18394a9396ea423406b73bfe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=dwyYg7uPHgVR20Id8OF0lKIr6xs%3D" alt="image.png" loading="lazy"/></p>
<p>这是从实现的角度上Ext/App加载器的关系，从抽象的角度，ClassLoader定义了加载器的规范，SecureClassLoader扩展了安全性，URLClassLoader扩展了通过url加载的能力，而Ext和App则各自分工，那么从逻辑角度，Ext和App包括Bootstrap是如何做到各自分工的呢？</p>
<h2 data-id="heading-5">二、双亲委派模型 Parent Delegation Model</h2>
<h4 data-id="heading-6">基础概念</h4>
<p>双亲委派模型是JVM定义的一套默认的类加载机制，当一个类被类加载器加载时，他首先不会自身尝试加载该类，而是把加载请求委托给<code>父加载器</code>去完成，层层往上，只有当所有父加载器都无法完成加载请求时，子加载器才会尝试去加载，其核心概念总结为：<code>自底向上委托，自顶向下加载</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe5bb276164a4b90877d7376cef705e3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6JGb5LqM6JuL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1766564445&amp;x-signature=zzR1WOlXp%2FcoI0mb8iqYBjo2UGg%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-7">源码分析</h4>
<h3 data-id="heading-8">一、核心初始化流程</h3>
<h4 data-id="heading-9"><strong>1.1 Launcher构建加载器层次</strong></h4>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">public Launcher() {
    // 1. 创建ExtClassLoader（父加载器）
    ClassLoader <span class="hljs-attr">extcl</span> = ExtClassLoader.getExtClassLoader()<span class="hljs-comment">;</span>
    
    // 2. 创建AppClassLoader，传入extcl作为parent
    <span class="hljs-attr">loader</span> = AppClassLoader.getAppClassLoader(extcl)<span class="hljs-comment">;</span>
}
</code></pre>
<p><strong>关键</strong>：必须先创建父加载器，再创建子加载器，构建完整的委托链。</p>
<hr/>
<h3 data-id="heading-10">二、ExtClassLoader创建过程</h3>
<h4 data-id="heading-11"><strong>2.1 单例模式获取实例</strong></h4>
<pre><code class="hljs language-scss" lang="scss">public static ExtClassLoader <span class="hljs-built_in">getExtClassLoader</span>() throws IOException {
    if (instance == null) {
        <span class="hljs-built_in">synchronized</span>(ExtClassLoader.class) {
            if (instance == null) {
                instance = <span class="hljs-built_in">createExtClassLoader</span>();  <span class="hljs-comment">// 双重检查锁</span>
            }
        }
    }
    return instance;
}
</code></pre>
<h4 data-id="heading-12"><strong>2.2 确定扩展加载路径</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> ExtClassLoader <span class="hljs-title function_">createExtClassLoader</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-keyword">return</span> AccessController.doPrivileged(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivilegedExceptionAction</span>&lt;ExtClassLoader&gt;() {
            <span class="hljs-keyword">public</span> ExtClassLoader <span class="hljs-title function_">run</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> IOException {
                <span class="hljs-comment">// 获取扩展目录：java.ext.dirs系统属性</span>
                <span class="hljs-keyword">final</span> File[] dirs = getExtDirs();
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExtClassLoader</span>(dirs);  <span class="hljs-comment">// 创建实例</span>
            }
        });
}
</code></pre>
<h4 data-id="heading-13"><strong>2.3 ExtClassLoader构造函数</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">ExtClassLoader</span><span class="hljs-params">(File[] dirs)</span> <span class="hljs-keyword">throws</span> IOException {
    <span class="hljs-comment">// 关键：parent=null，表示父加载器是BootstrapClassLoader</span>
    <span class="hljs-built_in">super</span>(getExtURLs(dirs), <span class="hljs-literal">null</span>, factory);
}
</code></pre>
<p><strong>设计要点</strong>：<code>parent=null</code>表示委托链顶端，由BootstrapClassLoader加载。</p>
<hr/>
<h3 data-id="heading-14">三、AppClassLoader创建过程</h3>
<h4 data-id="heading-15"><strong>3.1 获取类路径并创建实例</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ClassLoader <span class="hljs-title function_">getAppClassLoader</span><span class="hljs-params">(<span class="hljs-keyword">final</span> ClassLoader extcl)</span> 
        <span class="hljs-keyword">throws</span> IOException {
    
    <span class="hljs-comment">// 获取应用类路径：java.class.path系统属性</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> System.getProperty(<span class="hljs-string">"java.class.path"</span>);
    <span class="hljs-keyword">final</span> File[] path = getClassPath(s);
    
    <span class="hljs-keyword">return</span> AccessController.doPrivileged(
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">PrivilegedAction</span>&lt;AppClassLoader&gt;() {
            <span class="hljs-keyword">public</span> AppClassLoader <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                URL[] urls = pathToURLs(path);
                <span class="hljs-comment">// 关键：传入extcl作为parent参数</span>
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AppClassLoader</span>(urls, extcl);
            }
        });
}
</code></pre>
<h4 data-id="heading-16"><strong>3.2 AppClassLoader构造函数</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">AppClassLoader</span>(URL[] urls, ClassLoader parent) {
    <span class="hljs-comment">// 关键：parent参数是ExtClassLoader实例</span>
    super(urls, parent, factory);
}
</code></pre>
<hr/>
<h3 data-id="heading-17">四、核心设计要点</h3>
<h4 data-id="heading-18"><strong>4.1 委托链完整构建</strong></h4>
<pre><code class="hljs">启动顺序：ExtClassLoader → AppClassLoader
委托链：AppClassLoader → ExtClassLoader → BootstrapClassLoader
</code></pre>
<h4 data-id="heading-19"><strong>4.2 加载范围配置</strong></h4>




















<table><thead><tr><th>加载器</th><th>系统属性</th><th>职责范围</th></tr></thead><tbody><tr><td>ExtClassLoader</td><td><code>java.ext.dirs</code></td><td>扩展JAR包</td></tr><tr><td>AppClassLoader</td><td><code>java.class.path</code></td><td>应用类路径</td></tr></tbody></table>
<h4 data-id="heading-20"><strong>4.3 关键设计决策</strong></h4>
<ol>
<li><strong>单例模式</strong>：ExtClassLoader全局唯一</li>
<li><strong>parent=null</strong>：ExtClassLoader父加载器为Bootstrap</li>
<li><strong>层次传递</strong>：AppClassLoader以ExtClassLoader为parent</li>
<li><strong>安全上下文</strong>：通过<code>AccessController.doPrivileged</code>执行</li>
</ol>
<hr/>
<h3 data-id="heading-21">五、验证委托链</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 运行时验证委托链</span>
ClassLoader appLoader = ClassLoader<span class="hljs-selector-class">.getSystemClassLoader</span>();
System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(appLoader);  <span class="hljs-comment">// AppClassLoader</span>
System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(appLoader.getParent());  <span class="hljs-comment">// ExtClassLoader  </span>
System<span class="hljs-selector-class">.out</span><span class="hljs-selector-class">.println</span>(appLoader.getParent()<span class="hljs-selector-class">.getParent</span>());  <span class="hljs-comment">// null (Bootstrap)</span>
</code></pre>
<p><strong>总结</strong>：Launcher通过精确的初始化顺序和参数传递，构建了不可变的三层类加载器委托链，这是双亲委派机制能够稳定运行的基石。</p>
<h3 data-id="heading-22">六、核心加载过程</h3>
<p>双亲委派机制的执行分为两个明确阶段：</p>
<p><strong>1. 委派阶段（递归向上查询）</strong><br/>
请求从子加载器发起，通过<code>parent.loadClass()</code>递归调用，沿加载器层次结构向上传递，直至<code>parent</code>为<code>null</code>的BootstrapClassLoader。这一阶段仅进行<strong>类查询</strong>，不执行实际加载。</p>
<p><strong>2. 加载阶段（逐级向下尝试）</strong><br/>
从BootstrapClassLoader开始，每层加载器依次尝试：</p>
<ul>
<li><code>findBootstrapClassOrNull()</code> / <code>findClass()</code>：在自身责任范围内查找类资源</li>
<li>若找到资源，则通过<code>defineClass()</code> → <code>defineClass0()</code>本地方法，将字节码转换为Class对象</li>
<li>若未找到，则返回<code>null</code>或抛出异常，控制权传递到下一级加载器</li>
</ul>
<p><strong>关键洞察</strong>：</p>
<ul>
<li><strong>递归发生在委派阶段</strong>，是方法调用层面的递归</li>
<li><strong>实际加载发生在返回阶段</strong>，是责任链模式的逐级尝试</li>
<li>每一层加载器都是先依赖父加载器，失败后才自主加载，确保核心类优先由高层加载器加载</li>
</ul>
<p>这种设计既保证了Java核心库的安全性（防止用户替换核心类），又通过逐级回退机制实现了类加载的灵活扩展。</p>
<h2 data-id="heading-23">三、SPI Service Provider Interface</h2>
<h3 data-id="heading-24">一、SPI核心概念</h3>
<h4 data-id="heading-25"><strong>1.1 什么是SPI？</strong></h4>
<p>SPI是Java提供的一种<strong>服务发现机制</strong>，通过解耦接口与实现，实现<strong>可插拔的组件扩展</strong>。</p>
<h4 data-id="heading-26"><strong>1.2 核心思想</strong></h4>
<pre><code class="hljs language-markdown" lang="markdown">接口定义（标准） ← 配置文件 → 具体实现（扩展）
<span class="hljs-code">     ↑                          ↑
    JDK                       开发者
</span></code></pre>
<hr/>
<h3 data-id="heading-27">二、SPI打破双亲委派的原理</h3>
<h4 data-id="heading-28"><strong>2.1 经典问题：JDBC驱动加载</strong></h4>
<pre><code class="hljs language-ini" lang="ini">// 传统方式需要显式加载驱动,硬编码且不够灵活
Connection <span class="hljs-attr">conn</span> = DriverManager.getConnection(new com.mysql.Driver())<span class="hljs-comment">;</span>

// SPI方式：自动发现并加载驱动
Connection <span class="hljs-attr">conn</span> = DriverManager.getConnection(url)<span class="hljs-comment">;</span>
//DriverManager通过SPI自动发现
</code></pre>
<h4 data-id="heading-29"><strong>2.2 关键类：ServiceLoader</strong></h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SPI的核心加载器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceLoader</span>&lt;S&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterable</span>&lt;S&gt; {
    <span class="hljs-comment">// 配置文件路径</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"META-INF/services/"</span>;
    
    <span class="hljs-comment">// 加载服务实现</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;S&gt; ServiceLoader&lt;S&gt; <span class="hljs-title function_">load</span><span class="hljs-params">(Class&lt;S&gt; service)</span> {
        <span class="hljs-comment">// 使用线程上下文类加载器</span>
        <span class="hljs-type">ClassLoader</span> <span class="hljs-variable">cl</span> <span class="hljs-operator">=</span> Thread.currentThread().getContextClassLoader();
        <span class="hljs-keyword">return</span> ServiceLoader.load(service, cl);
    }
}
</code></pre>
<h4 data-id="heading-30"><strong>2.3 打破双亲委派的关键</strong></h4>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// DriverManager的静态初始化块</span>
static {
    <span class="hljs-built_in">loadInitialDrivers</span>();  <span class="hljs-comment">// 驱动加载</span>
    <span class="hljs-built_in">println</span>("JDBC DriverManager initialized");
}

private static void <span class="hljs-built_in">loadInitialDrivers</span>() {
    <span class="hljs-comment">// 通过ServiceLoader加载驱动，load中传递当前线程上下文的ClassLoader进行处理</span>
    ServiceLoader&lt;Driver&gt; loadedDrivers = 
        ServiceLoader<span class="hljs-selector-class">.load</span>(Driver.class);
    
    Iterator&lt;Driver&gt; driversIterator = loadedDrivers<span class="hljs-selector-class">.iterator</span>();
    while (driversIterator.hasNext()) {
        driversIterator<span class="hljs-selector-class">.next</span>();  <span class="hljs-comment">// 触发驱动加载和注册</span>
    }
}
</code></pre>
<p>"SPI机制的核心类<code>ServiceLoader</code>在设计时就固定使用线程上下文类加载器来加载服务实现。当由BootstrapClassLoader加载的<code>DriverManager</code>调用<code>ServiceLoader.load(Driver.class)</code>时，<code>ServiceLoader</code>获取当前线程的上下文类加载器（通常是AppClassLoader，或其他自定义加载器），然后在后续的<code>Class.forName(className, false, loader)</code>中明确指定使用这个加载器来加载驱动类。这样就绕过了双亲委派模型中'父加载器加载的代码不能直接访问子加载器中的类'的限制。"</p>
<h3 data-id="heading-31">总结</h3>
<p><strong>Java类加载体系是一个精心设计的层次化安全模型，双亲委派是其基石，保障了Java平台的核心稳定性。SPI机制则是这一模型的智慧扩展，通过线程上下文类加载器这一"桥梁"，在保持安全的前提下实现了父加载器对子加载器服务的发现。这种"规范中的灵活"设计哲学，使得Java既能坚守类型安全的核心原则，又能支撑起庞大的生态系统，成为企业级应用的首选平台。</strong></p>
<p>理解这一机制不仅有助于解决类加载相关问题，更是深入理解Java平台设计思想、编写高质量可扩展代码的关键。从<code>Class.forName</code>的硬编码到SPI的自动发现，从严格委派到有控制打破，Java类加载机制的演进正是软件工程"关注点分离"、"约定优于配置"等原则的完美体现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[基于大模型LLM的开发与编程教程]]></title>    <link>https://juejin.cn/post/7584443518035935295</link>    <guid>https://juejin.cn/post/7584443518035935295</guid>    <pubDate>2025-12-17T08:02:47.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7584443518035935295" data-draft-id="7584443518035918911" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="基于大模型LLM的开发与编程教程 "/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2025-12-17T08:02:47.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户859968167769"/> <meta itemprop="url" content="https://juejin.cn/user/2086203644184827"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            基于大模型LLM的开发与编程教程 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2086203644184827/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户859968167769
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-17T08:02:47.000Z" title="Wed Dec 17 2025 08:02:47 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-17
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    12
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>基于大模型LLM的开发与编程教程---xingkeit.top/8708/</strong></p>
<h2 data-id="heading-0">大模型LLM开发避坑指南：编程中常见的参数调优与故障排查</h2>
<h3 data-id="heading-1">温度参数(Temperature)：创造力与稳定性的平衡</h3>
<p>温度参数是控制生成多样性的关键开关，但开发者常陷入两个极端：</p>
<p>Python</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 错误示范：极端温度设置</span>
output = llm.generate(prompt, temperature=<span class="hljs-number">0</span>)  <span class="hljs-meta"># 完全确定性输出</span>
output = llm.generate(prompt, temperature=<span class="hljs-number">1</span>)  <span class="hljs-meta"># 过度随机性</span>

<span class="hljs-meta"># 推荐设置区间</span>
<span class="hljs-function">def <span class="hljs-title">get_optimal_temperature</span>(<span class="hljs-params">task_type</span>):
    settings</span> = {
        <span class="hljs-string">'factual_qa'</span>: <span class="hljs-number">0.3</span>,    <span class="hljs-meta"># 事实性问题需要稳定性</span>
        <span class="hljs-string">'creative_writing'</span>: <span class="hljs-number">0.7</span>,  <span class="hljs-meta"># 创意写作需要多样性</span>
        <span class="hljs-string">'code_generation'</span>: <span class="hljs-number">0.5</span>    <span class="hljs-meta"># 代码生成需要平衡</span>
    }
    <span class="hljs-keyword">return</span> settings.<span class="hljs-keyword">get</span>(task_type, <span class="hljs-number">0.5</span>)
</code></pre>
<h3 data-id="heading-2">Top-p采样(Nucleus Sampling)的陷阱</h3>
<p>Top-p采样虽能提高生成质量，但参数设置不当会导致：</p>
<ol>
<li><strong>p值过大</strong>：包含低概率词元，输出不稳定</li>
<li><strong>p值过小</strong>：限制创造力，输出重复</li>
</ol>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 典型问题场景</span>
<span class="hljs-attr">problem_output</span> = llm.generate(
    prompt,
    <span class="hljs-attr">top_p</span>=<span class="hljs-number">0.99</span>,  <span class="hljs-comment"># 几乎包含所有词元</span>
    <span class="hljs-attr">temperature</span>=<span class="hljs-number">0.7</span>
)

<span class="hljs-comment"># 推荐调试方法</span>
for p in <span class="hljs-section">[0.3, 0.5, 0.7, 0.9]</span>:  <span class="hljs-comment"># 阶梯式测试</span>
    test_output(p, p)
</code></pre>
<h3 data-id="heading-3">最大长度(max_length)与重复惩罚(repetition_penalty)</h3>
<h4 data-id="heading-4">常见问题症状：</h4>
<ul>
<li><strong>输出截断</strong>：max_length设置过小</li>
<li><strong>无限循环</strong>：缺乏重复惩罚机制</li>
<li><strong>语义不完整</strong>：未考虑token分段</li>
</ul>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 智能长度调整方案</span>
def dynamic_max_length(prompt):
    <span class="hljs-attr">base_length</span> = len(tokenizer.encode(prompt))
    return min(
        base_length + 256,  <span class="hljs-comment"># 根据输入动态调整</span>
        2048  <span class="hljs-comment"># 模型上限</span>
    )

<span class="hljs-comment"># 重复惩罚增强</span>
<span class="hljs-attr">response</span> = llm.generate(
    prompt,
    <span class="hljs-attr">repetition_penalty</span>=<span class="hljs-number">1.2</span>,  <span class="hljs-comment"># 适度惩罚</span>
    <span class="hljs-attr">no_repeat_ngram_size</span>=<span class="hljs-number">3</span>   <span class="hljs-comment"># 防止3-gram重复</span>
)
</code></pre>
<h3 data-id="heading-5">内存溢出(OOM)问题诊断流程</h3>
<p>当遇到CUDA out of memory时，系统化排查：</p>
<ol>
<li>
<p><strong>检查显存占用基线</strong></p>
<p>Python</p>
<pre><code class="hljs language-bash" lang="bash">torch.cuda.memory_summary()  <span class="hljs-comment"># 显存分析</span>
</code></pre>
</li>
<li>
<p><strong>批量处理(Batch Size)调优</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 自动寻找最大batch size</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">find_max_batch</span>(<span class="hljs-params">model, input_size</span>):
    <span class="hljs-keyword">for</span> bs <span class="hljs-keyword">in</span> [<span class="hljs-number">32</span>, <span class="hljs-number">16</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>]:
        <span class="hljs-keyword">try</span>:
            test_memory_usage(model, bs, input_size)
            <span class="hljs-keyword">return</span> bs
        <span class="hljs-keyword">except</span> RuntimeError:
            <span class="hljs-keyword">continue</span>
</code></pre>
</li>
<li>
<p><strong>精度优化方案</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 混合精度训练</span>
<span class="hljs-attr">scaler</span> = torch.cuda.amp.GradScaler()
with torch.cuda.amp.autocast():
    <span class="hljs-attr">outputs</span> = model(inputs)
</code></pre>
</li>
</ol>
<h3 data-id="heading-6">梯度异常与训练不稳定的应对</h3>
<h4 data-id="heading-7">典型症状：</h4>
<ul>
<li>Loss出现NaN/INF</li>
<li>梯度爆炸(&gt;1e5)</li>
<li>模型输出无意义内容</li>
</ul>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 梯度裁剪实现</span>
torch.nn.utils.clip_grad_norm_(
    model.parameters(),
    <span class="hljs-attr">max_norm</span>=<span class="hljs-number">1.0</span>  <span class="hljs-comment"># 推荐0.5-2.0</span>
)

<span class="hljs-comment"># 损失值监控</span>
if torch.isnan(loss).any():
    logger.warning("NaN detected in loss!")
    adjust_learning_rate(optimizer, <span class="hljs-attr">factor</span>=<span class="hljs-number">0.5</span>)
</code></pre>
<h3 data-id="heading-8">提示工程(Prompt Engineering)的黄金法则</h3>
<ol>
<li>
<p><strong>指令明确性测试</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 测试不同指令格式</span>
<span class="hljs-attr">prompts</span> = [
    <span class="hljs-string">"解释机器学习"</span>,  <span class="hljs-comment"># 模糊</span>
    <span class="hljs-string">"用200字通俗解释机器学习的基本概念，面向高中生"</span>,  <span class="hljs-comment"># 明确</span>
    <span class="hljs-string">"列出机器学习的三个主要类型，每个类型用一句话说明"</span>  <span class="hljs-comment"># 结构化</span>
]
compare_responses(prompts)
</code></pre>
</li>
<li>
<p><strong>少样本学习(Few-shot)模板</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">few_shot_prompt</span> = <span class="hljs-string">"""
示例1:
输入: 法国的首都是哪里？
输出: 法国的首都是巴黎

示例2:
输入: 日本的首都是哪里？
输出: 日本的首都是东京

现在回答:
输入: 意大利的首都是哪里？
输出:"""</span>
</code></pre>
</li>
</ol>
<h3 data-id="heading-9">模型服务化中的性能陷阱</h3>
<h4 data-id="heading-10">高频错误及解决方案：</h4>
<ol>
<li>
<p><strong>冷启动延迟</strong></p>
<p>Python</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 预热模型</span>
<span class="hljs-attr">warmup_inputs</span> = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">64</span>).to(device)
for _ in range(3):
    <span class="hljs-attr">_</span> = model(warmup_inputs)
</code></pre>
</li>
<li>
<p><strong>长文本处理优化</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 分块处理长文档</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">chunk_process</span>(<span class="hljs-params">text, chunk_size=<span class="hljs-number">512</span></span>):
    <span class="hljs-keyword">return</span> [text[i:i+chunk_size] 
            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(text), chunk_size)]
</code></pre>
</li>
<li>
<p><strong>并发请求管理</strong></p>
<p>Python</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 使用信号量控制并发</span>
semaphore = asyncio.Semaphore(<span class="hljs-number">5</span>)  <span class="hljs-comment"># 最大5并发</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">limited_generate</span>(<span class="hljs-params">prompt</span>):
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> semaphore:
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> generate(prompt)
</code></pre>
</li>
</ol>
<h3 data-id="heading-11">监控与评估体系建立</h3>
<p>必须建立的<strong>三大看板</strong>：</p>
<ol>
<li>
<p><strong>质量看板</strong></p>
<p>Python</p>
<pre><code class="hljs language-arduino" lang="arduino">monitor_metrics = {
    <span class="hljs-string">'bleu_score'</span>: calculate_bleu,
    <span class="hljs-string">'toxicity'</span>: check_toxicity_level,
    <span class="hljs-string">'fact_accuracy'</span>: verify_against_kb
}
</code></pre>
</li>
<li>
<p><strong>性能看板</strong></p>
<p>Python</p>
<pre><code class="hljs language-css" lang="css">performance_stats = {
    'latency_p99': <span class="hljs-built_in">get_latency_percentile</span>(<span class="hljs-number">0.99</span>),
    <span class="hljs-string">'throughput'</span>: <span class="hljs-built_in">count_requests_per_minute</span>(),
    <span class="hljs-string">'error_rate'</span>: <span class="hljs-built_in">calculate_error_percentage</span>()
}
</code></pre>
</li>
<li>
<p><strong>成本看板</strong></p>
<p>Python</p>
<pre><code class="hljs language-css" lang="css">cost_analysis = {
    'tokens_per_request': <span class="hljs-built_in">count_output_tokens</span>(),
    <span class="hljs-string">'api_cost'</span>: <span class="hljs-built_in">estimate_api_expense</span>(),
    <span class="hljs-string">'infra_cost'</span>: <span class="hljs-built_in">calculate_cloud_bill</span>()
}
</code></pre>
</li>
</ol>
<p>大模型开发如同驾驭一头巨兽，参数调优是手中的缰绳。本文总结的避坑指南来自数百小时的实战教训，核心思想是：<strong>理解每个参数背后的数学原理，建立系统化的监控机制，始终保持对模型行为的可解释性控制</strong>。记住，优秀的LLM开发者不是调参魔术师，而是理解模型行为原理的工程师。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>