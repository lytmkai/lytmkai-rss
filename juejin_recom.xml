<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[ğŸš€ LangGraph ä¿å§†çº§æ•™ç¨‹ï¼šä»é›¶æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª AI Agent å·¥ä½œæµ]]></title>    <link>https://juejin.cn/post/7579264485258854415</link>    <guid>https://juejin.cn/post/7579264485258854415</guid>    <pubDate>2025-12-03T08:31:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485258854415" data-draft-id="7579264485258838031" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ LangGraph ä¿å§†çº§æ•™ç¨‹ï¼šä»é›¶æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª AI Agent å·¥ä½œæµ"/> <meta itemprop="keywords" content="LangChain,Node.js,Agent"/> <meta itemprop="datePublished" content="2025-12-03T08:31:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Dr_å“ˆå“ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/2208293602984286"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ LangGraph ä¿å§†çº§æ•™ç¨‹ï¼šä»é›¶æ„å»ºä½ çš„ç¬¬ä¸€ä¸ª AI Agent å·¥ä½œæµ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2208293602984286/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Dr_å“ˆå“ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:31:40.000Z" title="Wed Dec 03 2025 08:31:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ğŸ”¥ æœ¬æ–‡ 1.2w å­—ï¼Œä»å…¥é—¨åˆ°å®æˆ˜ï¼Œå¸¦ä½ å½»åº•ææ‡‚ LangGraphï¼é€‚åˆæœ‰ä¸€å®š LangChain åŸºç¡€çš„å¼€å‘è€…ã€‚</p>
</blockquote>
<h2 data-id="heading-0">ğŸ“Œ å‰è¨€</h2>
<p>ä½ æ˜¯å¦é‡åˆ°è¿‡è¿™äº›é—®é¢˜ï¼Ÿ</p>
<ul>
<li>ç”¨ LangChain çš„ <code>pipe()</code> å†™å¤æ‚æµç¨‹æ—¶ï¼Œä»£ç å˜å¾—ä¸€å›¢ä¹±éº»ï¼Ÿ</li>
<li>æƒ³è®© AI Agent è‡ªåŠ¨å¾ªç¯è°ƒç”¨å·¥å…·ï¼Œå´ä¸çŸ¥é“æ€ä¹ˆå®ç°ï¼Ÿ</li>
<li>éœ€è¦æ ¹æ®æ¡ä»¶èµ°ä¸åŒåˆ†æ”¯ï¼Œå´å‘ç° Chain ä¸æ”¯æŒï¼Ÿ</li>
</ul>
<p>å¦‚æœä½ æœ‰ä»¥ä¸Šå›°æ‰°ï¼Œ<strong>LangGraph</strong> å°±æ˜¯ä½ çš„ç­”æ¡ˆï¼</p>
<p>LangGraph æ˜¯ LangChain å›¢é˜Ÿæ¨å‡ºçš„<strong>å·¥ä½œæµç¼–æ’æ¡†æ¶</strong>ï¼Œä¸“é—¨ç”¨äºæ„å»ºå¤æ‚çš„ AI Agentã€‚å®ƒç”¨<strong>å›¾ï¼ˆGraphï¼‰</strong> çš„æ–¹å¼æ¥å®šä¹‰å·¥ä½œæµï¼ŒåŸç”Ÿæ”¯æŒ<strong>åˆ†æ”¯ã€å¾ªç¯ã€çŠ¶æ€ç®¡ç†</strong>ï¼Œæ˜¯æ„å»ºç”Ÿäº§çº§ AI åº”ç”¨çš„åˆ©å™¨ã€‚</p>
<p><strong>é˜…è¯»æœ¬æ–‡ä½ å°†æ”¶è·ï¼š</strong></p>
<ul>
<li>âœ… ç†è§£ LangGraph çš„æ ¸å¿ƒæ¦‚å¿µï¼ˆStateGraphã€Annotationã€Nodeã€Edgeï¼‰</li>
<li>âœ… æŒæ¡çŠ¶æ€ç®¡ç†å’Œæµç¨‹æ§åˆ¶</li>
<li>âœ… å­¦ä¼šå®ç°æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯æµç¨‹</li>
<li>âœ… èƒ½å¤Ÿç‹¬ç«‹æ„å»º ReAct Agent</li>
</ul>
<hr/>
<h2 data-id="heading-1">ğŸ“š ç›®å½•</h2>
<ol>
<li><a href="#1-%E4%BB%80%E4%B9%88%E6%98%AF-langgraph" title="#1-%E4%BB%80%E4%B9%88%E6%98%AF-langgraph">ä»€ä¹ˆæ˜¯ LangGraph</a></li>
<li><a href="#2-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E9%80%9F%E8%A7%88" title="#2-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E9%80%9F%E8%A7%88">æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ</a></li>
<li><a href="#3-stategraph-%E7%8A%B6%E6%80%81%E5%9B%BE" title="#3-stategraph-%E7%8A%B6%E6%80%81%E5%9B%BE">StateGraph çŠ¶æ€å›¾</a></li>
<li><a href="#4-annotation-%E7%8A%B6%E6%80%81%E5%AE%9A%E4%B9%89" title="#4-annotation-%E7%8A%B6%E6%80%81%E5%AE%9A%E4%B9%89">Annotation çŠ¶æ€å®šä¹‰</a></li>
<li><a href="#5-node-%E8%8A%82%E7%82%B9%E8%AF%A6%E8%A7%A3" title="#5-node-%E8%8A%82%E7%82%B9%E8%AF%A6%E8%A7%A3">Node èŠ‚ç‚¹è¯¦è§£</a></li>
<li><a href="#6-edge-%E8%BE%B9%E4%B8%8E%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6" title="#6-edge-%E8%BE%B9%E4%B8%8E%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6">Edge è¾¹ä¸æµç¨‹æ§åˆ¶</a></li>
<li><a href="#7-%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF%E5%AE%9E%E6%88%98" title="#7-%E6%9D%A1%E4%BB%B6%E5%88%86%E6%94%AF%E5%AE%9E%E6%88%98">æ¡ä»¶åˆ†æ”¯å®æˆ˜</a></li>
<li><a href="#8-%E5%BE%AA%E7%8E%AF%E6%B5%81%E7%A8%8B%E5%AE%9E%E7%8E%B0" title="#8-%E5%BE%AA%E7%8E%AF%E6%B5%81%E7%A8%8B%E5%AE%9E%E7%8E%B0">å¾ªç¯æµç¨‹å®ç°</a></li>
<li><a href="#9-react-agent-%E5%AE%8C%E6%95%B4%E5%AE%9E%E6%88%98" title="#9-react-agent-%E5%AE%8C%E6%95%B4%E5%AE%9E%E6%88%98">ReAct Agent å®Œæ•´å®æˆ˜</a></li>
<li><a href="#10-%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA" title="#10-%E6%B5%81%E5%BC%8F%E8%BE%93%E5%87%BA">æµå¼è¾“å‡º</a></li>
<li><a href="#11-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97" title="#11-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97">æœ€ä½³å®è·µä¸è¸©å‘æŒ‡å—</a></li>
<li><a href="#12-%E9%99%84%E5%BD%95llm-%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE" title="#12-%E9%99%84%E5%BD%95llm-%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE">é™„å½•ï¼šLLM å‚æ•°é…ç½®</a></li>
</ol>
<hr/>
<h2 data-id="heading-2">1. ä»€ä¹ˆæ˜¯ LangGraph</h2>
<h3 data-id="heading-3">1.1 ä¸€å¥è¯å®šä¹‰</h3>
<p><strong>LangGraph = ç”¨ã€Œç”»æµç¨‹å›¾ã€çš„æ–¹å¼æ„å»º AI åº”ç”¨</strong></p>
<p>å®ƒå°†å·¥ä½œæµå»ºæ¨¡ä¸ºå›¾ï¼ˆGraphï¼‰ï¼š</p>
<ul>
<li><strong>èŠ‚ç‚¹ï¼ˆNodesï¼‰</strong> = æ‰§è¡Œæ­¥éª¤ï¼ˆå‡½æ•°ï¼‰</li>
<li><strong>è¾¹ï¼ˆEdgesï¼‰</strong> = æ­¥éª¤ä¹‹é—´çš„è¿çº¿</li>
<li><strong>çŠ¶æ€ï¼ˆStateï¼‰</strong> = åœ¨èŠ‚ç‚¹é—´ä¼ é€’çš„æ•°æ®</li>
</ul>
<h3 data-id="heading-4">1.2 ä¸ºä»€ä¹ˆéœ€è¦ LangGraphï¼Ÿ</h3>








































<table><thead><tr><th>åœºæ™¯</th><th>LangChain (pipe)</th><th>LangGraph</th></tr></thead><tbody><tr><td>ç®€å•çº¿æ€§æµç¨‹</td><td>âœ… è¶³å¤Ÿ</td><td>å¯ä»¥ä½†æ²¡å¿…è¦</td></tr><tr><td>æ¡ä»¶åˆ†æ”¯</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… åŸç”Ÿæ”¯æŒ</td></tr><tr><td>å¾ªç¯/è¿­ä»£</td><td>âŒ éš¾å®ç°</td><td>âœ… åŸç”Ÿæ”¯æŒ</td></tr><tr><td>å¤æ‚ Agent</td><td>âŒ éœ€æ‰‹å†™å¾ªç¯</td><td>âœ… å£°æ˜å¼å®šä¹‰</td></tr><tr><td>çŠ¶æ€ç®¡ç†</td><td>âŒ æ‰‹åŠ¨ä¼ é€’</td><td>âœ… è‡ªåŠ¨ç®¡ç†</td></tr><tr><td>å¯è§†åŒ–è°ƒè¯•</td><td>âŒ å›°éš¾</td><td>âœ… LangGraph Studio</td></tr></tbody></table>
<h3 data-id="heading-5">1.3 å®‰è£…</h3>
<pre><code class="hljs language-bash" lang="bash">npm install @langchain/langgraph
</code></pre>
<hr/>
<h2 data-id="heading-6">2. æ ¸å¿ƒæ¦‚å¿µé€Ÿè§ˆ</h2>
<p>åœ¨æ·±å…¥ç»†èŠ‚ä¹‹å‰ï¼Œå…ˆå»ºç«‹å…¨å±€è®¤çŸ¥ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  LangGraph æ ¸å¿ƒæ¦‚å¿µ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚    StateGraph (çŠ¶æ€å›¾å®¹å™¨)                                â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚    â”‚                                               â”‚    â”‚
â”‚    â”‚   <span class="hljs-selector-attr">[START]</span> â”€â”€â†’ <span class="hljs-selector-attr">[Node1]</span> â”€â”€â†’ <span class="hljs-selector-attr">[Node2]</span> â”€â”€â†’ <span class="hljs-selector-attr">[END]</span>  â”‚    â”‚
â”‚    â”‚                 â”‚           â”‚                â”‚    â”‚
â”‚    â”‚                 â–¼           â–¼                â”‚    â”‚
â”‚    â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚    â”‚
â”‚    â”‚            â”‚  State (å…±äº«çŠ¶æ€)    â”‚          â”‚    â”‚
â”‚    â”‚            â”‚  { <span class="hljs-selector-tag">input</span>, output }  â”‚          â”‚    â”‚
â”‚    â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚    â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>













































<table><thead><tr><th>ç»„ä»¶</th><th>ä½œç”¨</th><th>ç±»æ¯”</th></tr></thead><tbody><tr><td><strong>StateGraph</strong></td><td>çŠ¶æ€å›¾å®¹å™¨</td><td>æµç¨‹å›¾ç”»å¸ƒ</td></tr><tr><td><strong>State</strong></td><td>å·¥ä½œæµæ•°æ®</td><td>å…¨å±€å˜é‡</td></tr><tr><td><strong>Annotation</strong></td><td>çŠ¶æ€ç»“æ„å®šä¹‰</td><td>TypeScript æ¥å£</td></tr><tr><td><strong>Node</strong></td><td>æ‰§è¡Œå•å…ƒ</td><td>å‡½æ•°</td></tr><tr><td><strong>Edge</strong></td><td>è¿æ¥å…³ç³»</td><td>ç®­å¤´</td></tr><tr><td><strong>START</strong></td><td>èµ·å§‹ç‚¹</td><td>main()</td></tr><tr><td><strong>END</strong></td><td>ç»“æŸç‚¹</td><td>return</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-7">3. StateGraph çŠ¶æ€å›¾</h2>
<h3 data-id="heading-8">3.1 åŸºæœ¬ç”¨æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StateGraph</span>, <span class="hljs-title class_">Annotation</span>, <span class="hljs-variable constant_">START</span>, <span class="hljs-variable constant_">END</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph"</span>;

<span class="hljs-comment">// 1ï¸âƒ£ å®šä¹‰çŠ¶æ€ç»“æ„</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyState</span> = <span class="hljs-title class_">Annotation</span>.<span class="hljs-title class_">Root</span>({
  <span class="hljs-attr">input</span>: <span class="hljs-title class_">Annotation</span>({ <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">_, x</span>) =&gt;</span> x, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">""</span> }),
  <span class="hljs-attr">output</span>: <span class="hljs-title class_">Annotation</span>({ <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">_, x</span>) =&gt;</span> x, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">""</span> }),
});

<span class="hljs-comment">// 2ï¸âƒ£ åˆ›å»ºçŠ¶æ€å›¾</span>
<span class="hljs-keyword">const</span> graph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateGraph</span>(<span class="hljs-title class_">MyState</span>)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"step1"</span>, step1Function) <span class="hljs-comment">// æ·»åŠ èŠ‚ç‚¹</span>
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"step2"</span>, step2Function)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-variable constant_">START</span>, <span class="hljs-string">"step1"</span>) <span class="hljs-comment">// æ·»åŠ è¾¹</span>
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"step1"</span>, <span class="hljs-string">"step2"</span>)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"step2"</span>, <span class="hljs-variable constant_">END</span>);

<span class="hljs-comment">// 3ï¸âƒ£ ç¼–è¯‘</span>
<span class="hljs-keyword">const</span> app = graph.<span class="hljs-title function_">compile</span>();

<span class="hljs-comment">// 4ï¸âƒ£ æ‰§è¡Œ</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">invoke</span>({ <span class="hljs-attr">input</span>: <span class="hljs-string">"hello"</span> });
</code></pre>
<h3 data-id="heading-9">3.2 æ ¸å¿ƒ API</h3>








































<table><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>addNode(name, fn)</code></td><td>æ·»åŠ èŠ‚ç‚¹</td><td><code>graph.addNode("process", processFn)</code></td></tr><tr><td><code>addEdge(from, to)</code></td><td>æ·»åŠ æ— æ¡ä»¶è¾¹</td><td><code>graph.addEdge("A", "B")</code></td></tr><tr><td><code>addConditionalEdges()</code></td><td>æ·»åŠ æ¡ä»¶è¾¹</td><td>è§ä¸‹æ–‡è¯¦è§£</td></tr><tr><td><code>compile()</code></td><td>ç¼–è¯‘å›¾</td><td><code>const app = graph.compile()</code></td></tr><tr><td><code>invoke(state)</code></td><td>åŒæ­¥æ‰§è¡Œ</td><td><code>await app.invoke({...})</code></td></tr><tr><td><code>stream(state)</code></td><td>æµå¼æ‰§è¡Œ</td><td><code>for await (const e of app.stream({...}))</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">4. Annotation çŠ¶æ€å®šä¹‰</h2>
<h3 data-id="heading-11">4.1 ä»€ä¹ˆæ˜¯ Annotationï¼Ÿ</h3>
<p><strong>Annotation = å‘Šè¯‰ LangGraphã€ŒçŠ¶æ€é•¿ä»€ä¹ˆæ ·ã€+ã€ŒçŠ¶æ€æ€ä¹ˆæ›´æ–°ã€</strong></p>
<p>æŠŠå®ƒæƒ³è±¡æˆã€Œå¿«é€’å•ã€çš„æ ¼å¼å®šä¹‰ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">ğŸ“¦ Annotation å®šä¹‰ã€Œå¿«é€’å•ã€æ ¼å¼

   å¿«é€’å•ä¸Šæœ‰å“ªäº›å­—æ®µï¼Ÿ
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ æ”¶ä»¶äºº: <span class="hljs-strong">____</span><span class="hljs-strong">____</span>                â”‚
   â”‚ åœ°å€:   <span class="hljs-strong">____</span><span class="hljs-strong">____</span>                â”‚
   â”‚ ç‰©å“:   <span class="hljs-strong">____</span><span class="hljs-strong">____</span>                â”‚
   â”‚ å¤‡æ³¨:   <span class="hljs-strong">____</span><span class="hljs-strong">____</span> (å¯è¿½åŠ )       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   æ¯ä¸ªç«™ç‚¹ï¼ˆèŠ‚ç‚¹ï¼‰éƒ½èƒ½çœ‹åˆ°è¿™å¼ å•ï¼Œä¹Ÿèƒ½ä¿®æ”¹å®ƒ
</code></pre>
<h3 data-id="heading-12">4.2 åŸºæœ¬è¯­æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Annotation</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyState</span> = <span class="hljs-title class_">Annotation</span>.<span class="hljs-title class_">Root</span>({
  <span class="hljs-attr">fieldName</span>: <span class="hljs-title class_">Annotation</span>({
    <span class="hljs-attr">reducer</span>: reducerFunction, <span class="hljs-comment">// çŠ¶æ€å¦‚ä½•æ›´æ–°</span>
    <span class="hljs-attr">default</span>: defaultFunction, <span class="hljs-comment">// é»˜è®¤å€¼</span>
  }),
});
</code></pre>
<h3 data-id="heading-13">4.3 Reducer è¯¦è§£</h3>
<p>Reducer å†³å®šã€Œå½“èŠ‚ç‚¹è¿”å›æ–°å€¼æ—¶ï¼Œæ€ä¹ˆæ›´æ–°çŠ¶æ€ã€ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. æ›¿æ¢æ¨¡å¼ - æ–°å€¼è¦†ç›–æ—§å€¼</span>
<span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> next;
<span class="hljs-comment">// èŠ‚ç‚¹è¿”å› { name: "æå››" } â†’ state.name å˜æˆ "æå››"</span>

<span class="hljs-comment">// 2. ç´¯åŠ æ¨¡å¼ - é€‚ç”¨äºæ¶ˆæ¯åˆ—è¡¨ï¼ˆæœ€å¸¸ç”¨ï¼ï¼‰</span>
<span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> [...prev, ...next];
<span class="hljs-comment">// èŠ‚ç‚¹è¿”å› { messages: [æ–°æ¶ˆæ¯] } â†’ è¿½åŠ åˆ° messages æ•°ç»„</span>

<span class="hljs-comment">// 3. æ•°å­—ç´¯åŠ </span>
<span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> prev + next;
<span class="hljs-comment">// èŠ‚ç‚¹è¿”å› { count: 1 } â†’ count åŠ  1</span>
</code></pre>
<h3 data-id="heading-14">4.4 å®é™…æ¡ˆä¾‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¯¹è¯ Agent çš„çŠ¶æ€å®šä¹‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AgentState</span> = <span class="hljs-title class_">Annotation</span>.<span class="hljs-title class_">Root</span>({
  <span class="hljs-comment">// æ¶ˆæ¯åˆ—è¡¨ - ç´¯åŠ æ¨¡å¼ï¼ˆé‡è¦ï¼ï¼‰</span>
  <span class="hljs-attr">messages</span>: <span class="hljs-title class_">Annotation</span>({
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> [...prev, ...next],
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> [],
  }),

  <span class="hljs-comment">// å½“å‰ä»»åŠ¡ - æ›¿æ¢æ¨¡å¼</span>
  <span class="hljs-attr">currentTask</span>: <span class="hljs-title class_">Annotation</span>({
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">_, next</span>) =&gt;</span> next,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">""</span>,
  }),

  <span class="hljs-comment">// è¿­ä»£æ¬¡æ•° - æ•°å­—ç´¯åŠ </span>
  <span class="hljs-attr">iterations</span>: <span class="hljs-title class_">Annotation</span>({
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> prev + next,
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-number">0</span>,
  }),
});
</code></pre>
<h3 data-id="heading-15">4.5 ä¸ºä»€ä¹ˆéœ€è¦ Reducerï¼Ÿ</h3>
<p><strong>ç—›ç‚¹</strong>ï¼šå¤šä¸ªèŠ‚ç‚¹éƒ½æƒ³æ›´æ–°åŒä¸€ä¸ªå­—æ®µ</p>
<pre><code class="hljs language-css" lang="css">ä¾‹å¦‚ï¼šæ¶ˆæ¯åˆ—è¡¨
  - èŠ‚ç‚¹ <span class="hljs-selector-tag">A</span> è¿”å›: { messages: [new <span class="hljs-built_in">HumanMessage</span>(<span class="hljs-string">"hi"</span>)] }
  - èŠ‚ç‚¹ <span class="hljs-selector-tag">B</span> è¿”å›: { messages: [new <span class="hljs-built_in">AIMessage</span>(<span class="hljs-string">"hello"</span>)] }

âŒ æ²¡æœ‰ Reducerï¼šèŠ‚ç‚¹ <span class="hljs-selector-tag">B</span> çš„å€¼è¦†ç›–èŠ‚ç‚¹ <span class="hljs-selector-tag">A</span>ï¼Œç”¨æˆ·æ¶ˆæ¯ä¸¢å¤±ï¼
âœ… æœ‰ Reducerï¼š  <span class="hljs-selector-attr">[...prev, ...next]</span>ï¼Œä¸¤æ¡æ¶ˆæ¯éƒ½ä¿ç•™ï¼
</code></pre>
<hr/>
<h2 data-id="heading-16">5. Node èŠ‚ç‚¹è¯¦è§£</h2>
<h3 data-id="heading-17">5.1 èŠ‚ç‚¹å‡½æ•°ç­¾å</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// èŠ‚ç‚¹ = æ¥æ”¶ stateï¼Œè¿”å›éƒ¨åˆ†æ›´æ–°çš„å‡½æ•°</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-comment">// ä» state è¯»å–æ•°æ®</span>
  <span class="hljs-keyword">const</span> input = state.<span class="hljs-property">input</span>;

  <span class="hljs-comment">// å¤„ç†é€»è¾‘</span>
  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">someOperation</span>(input);

  <span class="hljs-comment">// åªè¿”å›éœ€è¦æ›´æ–°çš„å­—æ®µ</span>
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">output</span>: result };
}
</code></pre>
<h3 data-id="heading-18">5.2 å¸¸è§èŠ‚ç‚¹ç±»å‹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 1. çº¯å¤„ç†èŠ‚ç‚¹ - æ•°æ®å¤„ç†ï¼Œå¯ä»¥æ˜¯åŒæ­¥çš„</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">processNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">result</span>: state.<span class="hljs-property">input</span>.<span class="hljs-title function_">toUpperCase</span>() };
}

<span class="hljs-comment">// 2. LLM èŠ‚ç‚¹ - è°ƒç”¨ AI æ¨¡å‹ï¼ˆå¿…é¡»å¼‚æ­¥ï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">llmNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>([<span class="hljs-keyword">new</span> <span class="hljs-title class_">HumanMessage</span>(state.<span class="hljs-property">question</span>)]);
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">answer</span>: response.<span class="hljs-property">content</span> };
}

<span class="hljs-comment">// 3. API èŠ‚ç‚¹ - è°ƒç”¨å¤–éƒ¨æ¥å£ï¼ˆå¿…é¡»å¼‚æ­¥ï¼‰</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">apiNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> data = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">"https://api.example.com/data"</span>);
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">apiResult</span>: <span class="hljs-keyword">await</span> data.<span class="hljs-title function_">json</span>() };
}

<span class="hljs-comment">// 4. å·¥å…·èŠ‚ç‚¹ - ä½¿ç”¨å†…ç½® ToolNode</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ToolNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph/prebuilt"</span>;
<span class="hljs-keyword">const</span> toolNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolNode</span>(tools);
</code></pre>
<h3 data-id="heading-19">5.3 è¿”å›å€¼è§„åˆ™</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… æ­£ç¡®ï¼šåªè¿”å›éœ€è¦æ›´æ–°çš„å­—æ®µ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">goodNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">output</span>: <span class="hljs-string">"result"</span> };
}

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šä¸éœ€è¦å±•å¼€æ•´ä¸ª state</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">badNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">output</span>: <span class="hljs-string">"result"</span> };
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šè¿”å›ç©ºå¯¹è±¡ = ä¸æ›´æ–°ä»»ä½•å­—æ®µ</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">noUpdateNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(state);
  <span class="hljs-keyword">return</span> {};
}
</code></pre>
<hr/>
<h2 data-id="heading-20">6. Edge è¾¹ä¸æµç¨‹æ§åˆ¶</h2>
<h3 data-id="heading-21">6.1 ä»€ä¹ˆæ˜¯ Edgeï¼Ÿ</h3>
<p><strong>Edge = æµç¨‹å›¾é‡Œçš„ã€Œç®­å¤´ã€= å®šä¹‰æ‰§è¡Œé¡ºåº</strong></p>
<pre><code class="hljs language-css" lang="css">        Edgeï¼ˆè¾¹ï¼‰
           â†“
<span class="hljs-selector-attr">[START]</span> â”€â”€â”€â”€â”€â”€â”€â”€â†’ <span class="hljs-selector-attr">[NodeA]</span> â”€â”€â”€â”€â”€â”€â”€â”€â†’ <span class="hljs-selector-attr">[END]</span>
          â†‘                  â†‘
       è¿™æ˜¯è¾¹             è¿™ä¹Ÿæ˜¯è¾¹

æ„æ€ï¼šSTART å®Œäº†æ‰§è¡Œ NodeAï¼ŒNodeA å®Œäº†ç»“æŸ
</code></pre>
<h3 data-id="heading-22">6.2 ä¸¤ç§è¾¹çš„å¯¹æ¯”</h3>























<table><thead><tr><th>ç±»å‹</th><th>è¯´æ˜</th><th>æ¯”å–»</th><th>ä»£ç </th></tr></thead><tbody><tr><td><strong>æ™®é€šè¾¹</strong></td><td>A å®Œäº†ä¸€å®šåˆ° B</td><td>ç›´çº¿</td><td><code>addEdge("A", "B")</code></td></tr><tr><td><strong>æ¡ä»¶è¾¹</strong></td><td>æ ¹æ®çŠ¶æ€å†³å®šå»å“ª</td><td>å²”è·¯å£</td><td><code>addConditionalEdges(...)</code></td></tr></tbody></table>
<h3 data-id="heading-23">6.3 æ™®é€šè¾¹è¯­æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">START</span>, <span class="hljs-variable constant_">END</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph"</span>;

<span class="hljs-comment">// ä» A åˆ° B</span>
graph.<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>);

<span class="hljs-comment">// å…¥å£</span>
graph.<span class="hljs-title function_">addEdge</span>(<span class="hljs-variable constant_">START</span>, <span class="hljs-string">"firstNode"</span>);

<span class="hljs-comment">// å‡ºå£</span>
graph.<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"lastNode"</span>, <span class="hljs-variable constant_">END</span>);

<span class="hljs-comment">// é“¾å¼è°ƒç”¨</span>
graph.<span class="hljs-title function_">addEdge</span>(<span class="hljs-variable constant_">START</span>, <span class="hljs-string">"A"</span>).<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"A"</span>, <span class="hljs-string">"B"</span>).<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"B"</span>, <span class="hljs-string">"C"</span>).<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"C"</span>, <span class="hljs-variable constant_">END</span>);
</code></pre>
<h3 data-id="heading-24">6.4 addEdge vs pipe() å¯¹æ¯”</h3>
<p>å¦‚æœä½ ç”¨è¿‡ LangChain çš„ <code>pipe()</code>ï¼š</p>

























<table><thead><tr><th>ç‰¹æ€§</th><th>pipe()</th><th>addEdge()</th></tr></thead><tbody><tr><td>æµç¨‹ç±»å‹</td><td>åªèƒ½çº¿æ€§ Aâ†’Bâ†’C</td><td>å¯åˆ†æ”¯ã€å¾ªç¯</td></tr><tr><td>æ¡ä»¶åˆ†æ”¯</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr><tr><td>å¾ªç¯</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ</td></tr></tbody></table>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">pipe</span>():      <span class="hljs-selector-tag">A</span> â”€â”€â†’ <span class="hljs-selector-tag">B</span> â”€â”€â†’ <span class="hljs-selector-tag">C</span> â”€â”€â†’ ç»“æŸï¼ˆåªèƒ½å¾€å‰ï¼‰

<span class="hljs-selector-tag">addEdge</span>():   <span class="hljs-selector-tag">A</span> â”€â”€â†’ <span class="hljs-selector-tag">B</span> â”€â”€â†’ <span class="hljs-selector-tag">C</span> â”€â”€â†’ ç»“æŸ
                  â†‘     â”‚
                  â””â”€â”€â”€â”€â”€â”˜  ï¼ˆå¯ä»¥å¾ªç¯å›å»ï¼ï¼‰
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>æ€»ç»“</strong>ï¼šç®€å•çº¿æ€§æµç¨‹ç”¨ pipeï¼Œéœ€è¦åˆ†æ”¯/å¾ªç¯ç”¨ LangGraphï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-25">7. æ¡ä»¶åˆ†æ”¯å®æˆ˜</h2>
<h3 data-id="heading-26">7.1 è¯­æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript">graph.<span class="hljs-title function_">addConditionalEdges</span>(
  fromNode, <span class="hljs-comment">// æºèŠ‚ç‚¹</span>
  routerFunction, <span class="hljs-comment">// è·¯ç”±å‡½æ•°</span>
  routeMapping <span class="hljs-comment">// è·¯ç”±æ˜ å°„</span>
);
</code></pre>
<h3 data-id="heading-27">7.2 è·¯ç”±å‡½æ•°</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·¯ç”±å‡½æ•°ï¼šæ¥æ”¶ stateï¼Œè¿”å›è·¯ç”± key</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">router</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">score</span> &gt; <span class="hljs-number">80</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"high"</span>;
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">score</span> &gt; <span class="hljs-number">60</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"medium"</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">"low"</span>;
}

<span class="hljs-comment">// è·¯ç”±æ˜ å°„ï¼škey â†’ èŠ‚ç‚¹å</span>
<span class="hljs-keyword">const</span> routeMapping = {
  <span class="hljs-attr">high</span>: <span class="hljs-string">"celebrateNode"</span>,
  <span class="hljs-attr">medium</span>: <span class="hljs-string">"normalNode"</span>,
  <span class="hljs-attr">low</span>: <span class="hljs-string">"improveNode"</span>,
};

graph.<span class="hljs-title function_">addConditionalEdges</span>(<span class="hljs-string">"scoreNode"</span>, router, routeMapping);
</code></pre>
<h3 data-id="heading-28">7.3 å®Œæ•´ç¤ºä¾‹ï¼šæƒ…æ„Ÿåˆ†æè·¯ç”±</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·¯ç”±å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">sentimentRouter</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> sentiment = state.<span class="hljs-property">sentiment</span>;
  <span class="hljs-keyword">if</span> (sentiment.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"ç§¯æ"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">"positive"</span>;
  <span class="hljs-keyword">if</span> (sentiment.<span class="hljs-title function_">includes</span>(<span class="hljs-string">"æ¶ˆæ"</span>)) <span class="hljs-keyword">return</span> <span class="hljs-string">"negative"</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">"neutral"</span>;
}

<span class="hljs-comment">// æ„å»ºå›¾</span>
<span class="hljs-keyword">const</span> graph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateGraph</span>(<span class="hljs-title class_">MyState</span>)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"analyze"</span>, analyzeNode)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"positive"</span>, positiveHandler)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"negative"</span>, negativeHandler)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"neutral"</span>, neutralHandler)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-variable constant_">START</span>, <span class="hljs-string">"analyze"</span>)
  .<span class="hljs-title function_">addConditionalEdges</span>(<span class="hljs-string">"analyze"</span>, sentimentRouter, {
    <span class="hljs-attr">positive</span>: <span class="hljs-string">"positive"</span>,
    <span class="hljs-attr">negative</span>: <span class="hljs-string">"negative"</span>,
    <span class="hljs-attr">neutral</span>: <span class="hljs-string">"neutral"</span>,
  })
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"positive"</span>, <span class="hljs-variable constant_">END</span>)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"negative"</span>, <span class="hljs-variable constant_">END</span>)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"neutral"</span>, <span class="hljs-variable constant_">END</span>);
</code></pre>
<p>æµç¨‹å›¾ï¼š</p>
<pre><code class="hljs language-css" lang="css">                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”Œâ”€â”€â”€â†’â”‚  positive   â”‚â”€â”€â”€â”
               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
<span class="hljs-selector-attr">[START]</span>â†’<span class="hljs-selector-attr">[analyze]</span>                     â”‚â†’<span class="hljs-selector-attr">[END]</span>
               â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
               â”œâ”€â”€â”€â†’â”‚  negative   â”‚â”€â”€â”€â”¤
               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
               â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
               â””â”€â”€â”€â†’â”‚  neutral    â”‚â”€â”€â”€â”˜
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h2 data-id="heading-29">8. å¾ªç¯æµç¨‹å®ç°</h2>
<h3 data-id="heading-30">8.1 æ ¸å¿ƒæ€è·¯</h3>
<p>é€šè¿‡æ¡ä»¶è¾¹å®ç°å¾ªç¯ï¼šå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œæµç¨‹å›åˆ°ä¹‹å‰çš„èŠ‚ç‚¹ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">shouldContinue</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-comment">// å®‰å…¨ä¿æŠ¤ï¼šæœ€å¤šè¿­ä»£ N æ¬¡</span>
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">iterations</span> &gt;= <span class="hljs-number">3</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;
  <span class="hljs-comment">// ä¸šåŠ¡æ¡ä»¶</span>
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">isComplete</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">"continue"</span>;
}

<span class="hljs-keyword">const</span> graph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateGraph</span>(<span class="hljs-title class_">MyState</span>)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"process"</span>, processNode)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"check"</span>, checkNode)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-variable constant_">START</span>, <span class="hljs-string">"process"</span>)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"process"</span>, <span class="hljs-string">"check"</span>)
  .<span class="hljs-title function_">addConditionalEdges</span>(<span class="hljs-string">"check"</span>, shouldContinue, {
    <span class="hljs-attr">continue</span>: <span class="hljs-string">"process"</span>, <span class="hljs-comment">// ğŸ”„ å¾ªç¯å› process</span>
    <span class="hljs-attr">end</span>: <span class="hljs-variable constant_">END</span>,
  });
</code></pre>
<p>æµç¨‹å›¾ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[START]</span> â”€â”€â†’ <span class="hljs-selector-attr">[process]</span> â”€â”€â†’ <span class="hljs-selector-attr">[check]</span>
                â†‘            â”‚
                â”‚  continue  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                             â”‚ end
                             â†“
                          <span class="hljs-selector-attr">[END]</span>
</code></pre>
<h3 data-id="heading-31">8.2 âš ï¸ é˜²æ­¢æ— é™å¾ªç¯</h3>
<p><strong>è¿™æ˜¯æœ€é‡è¦çš„ï¼ä¸€å®šè¦è®¾ç½®æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_ITERATIONS</span> = <span class="hljs-number">10</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">shouldContinue</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-comment">// 1ï¸âƒ£ å…ˆæ£€æŸ¥è¿­ä»£æ¬¡æ•°ï¼ˆå®‰å…¨ä¿æŠ¤ï¼‰</span>
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">iterations</span> &gt;= <span class="hljs-variable constant_">MAX_ITERATIONS</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"âš ï¸ è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå¼ºåˆ¶ç»“æŸ"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;
  }

  <span class="hljs-comment">// 2ï¸âƒ£ å†æ£€æŸ¥ä¸šåŠ¡æ¡ä»¶</span>
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">isComplete</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;

  <span class="hljs-keyword">return</span> <span class="hljs-string">"continue"</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-32">9. ReAct Agent å®Œæ•´å®æˆ˜</h2>
<h3 data-id="heading-33">9.1 ä»€ä¹ˆæ˜¯ ReActï¼Ÿ</h3>
<p><strong>ReAct = Reasoning + Acting</strong>ï¼Œè®© LLM è‡ªä¸»ä½¿ç”¨å·¥å…·çš„æ¨¡å¼ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> ğŸ¤” Reasoning (æ¨ç†): LLM åˆ†æé—®é¢˜ï¼Œå†³å®šéœ€è¦ä»€ä¹ˆ
<span class="hljs-bullet">2.</span> ğŸ”§ Acting (è¡ŒåŠ¨): è°ƒç”¨å·¥å…·è·å–ä¿¡æ¯
<span class="hljs-bullet">3.</span> ğŸ‘€ Observation (è§‚å¯Ÿ): æŸ¥çœ‹å·¥å…·è¿”å›ç»“æœ
<span class="hljs-bullet">4.</span> ğŸ”„ å¾ªç¯: ç›´åˆ°å¯ä»¥ç»™å‡ºæœ€ç»ˆç­”æ¡ˆ
</code></pre>
<h3 data-id="heading-34">9.2 æµç¨‹å›¾</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[START]</span> â”€â”€â†’ <span class="hljs-selector-attr">[agent]</span> â”€â”€â†’ <span class="hljs-selector-attr">[router]</span>
               â†‘            â”‚
               â”‚   tools    â”‚ has_tools
               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  â†“                   â†“
           <span class="hljs-selector-attr">[tools]</span>              no_tools
               â”‚                      â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†“
                                   <span class="hljs-selector-attr">[END]</span>
</code></pre>
<h3 data-id="heading-35">9.3 å®Œæ•´ä»£ç </h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StateGraph</span>, <span class="hljs-title class_">Annotation</span>, <span class="hljs-variable constant_">START</span>, <span class="hljs-variable constant_">END</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ToolNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph/prebuilt"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">HumanMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/core/messages"</span>;

<span class="hljs-comment">// 1ï¸âƒ£ å®šä¹‰çŠ¶æ€</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">AgentState</span> = <span class="hljs-title class_">Annotation</span>.<span class="hljs-title class_">Root</span>({
  <span class="hljs-attr">messages</span>: <span class="hljs-title class_">Annotation</span>({
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">prev, next</span>) =&gt;</span> [...prev, ...next],
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> [],
  }),
});

<span class="hljs-comment">// 2ï¸âƒ£ å®šä¹‰å·¥å…· &amp; ç»‘å®šåˆ° LLM</span>
<span class="hljs-keyword">const</span> tools = [calculatorTool, searchTool, weatherTool];
<span class="hljs-keyword">const</span> llmWithTools = llm.<span class="hljs-title function_">bindTools</span>(tools);

<span class="hljs-comment">// 3ï¸âƒ£ Agent èŠ‚ç‚¹ï¼šè°ƒç”¨ LLM åšå†³ç­–</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">agentNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> llmWithTools.<span class="hljs-title function_">invoke</span>(state.<span class="hljs-property">messages</span>);
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">messages</span>: [response] };
}

<span class="hljs-comment">// 4ï¸âƒ£ å·¥å…·èŠ‚ç‚¹ï¼šçœŸæ­£æ‰§è¡Œå·¥å…·</span>
<span class="hljs-keyword">const</span> toolNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolNode</span>(tools);

<span class="hljs-comment">// 5ï¸âƒ£ è·¯ç”±å‡½æ•°ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦è°ƒç”¨å·¥å…·</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">shouldCallTools</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> lastMessage = state.<span class="hljs-property">messages</span>[state.<span class="hljs-property">messages</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];
  <span class="hljs-keyword">if</span> (lastMessage.<span class="hljs-property">tool_calls</span>?.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"tools"</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;
}

<span class="hljs-comment">// 6ï¸âƒ£ æ„å»ºå›¾</span>
<span class="hljs-keyword">const</span> agentGraph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateGraph</span>(<span class="hljs-title class_">AgentState</span>)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"agent"</span>, agentNode)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"tools"</span>, toolNode)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-variable constant_">START</span>, <span class="hljs-string">"agent"</span>)
  .<span class="hljs-title function_">addConditionalEdges</span>(<span class="hljs-string">"agent"</span>, shouldCallTools, {
    <span class="hljs-attr">tools</span>: <span class="hljs-string">"tools"</span>,
    <span class="hljs-attr">end</span>: <span class="hljs-variable constant_">END</span>,
  })
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-string">"tools"</span>, <span class="hljs-string">"agent"</span>); <span class="hljs-comment">// ğŸ”„ å·¥å…·æ‰§è¡Œå®Œå›åˆ° agent</span>

<span class="hljs-comment">// 7ï¸âƒ£ ç¼–è¯‘ &amp; æ‰§è¡Œ</span>
<span class="hljs-keyword">const</span> agent = agentGraph.<span class="hljs-title function_">compile</span>();
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> agent.<span class="hljs-title function_">invoke</span>({
  <span class="hljs-attr">messages</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">HumanMessage</span>(<span class="hljs-string">"åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>)],
});
</code></pre>
<h3 data-id="heading-36">9.4 æ‰§è¡Œæµç¨‹æ¼”ç¤º</h3>
<pre><code class="hljs language-vbnet" lang="vbnet">ç”¨æˆ·: <span class="hljs-string">"åŒ—äº¬å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"</span>

<span class="hljs-keyword">Step</span> <span class="hljs-number">1</span>: [agent]
  â””â”€ LLM æ€è€ƒ: <span class="hljs-string">"éœ€è¦è°ƒç”¨ get_weather å·¥å…·"</span>
  â””â”€ è¾“å‡º: tool_calls: [{name: <span class="hljs-string">"get_weather"</span>, args: {city: <span class="hljs-string">"åŒ—äº¬"</span>}}]

<span class="hljs-keyword">Step</span> <span class="hljs-number">2</span>: [router] â†’ æ£€æµ‹åˆ° tool_calls â†’ å» [tools]

<span class="hljs-keyword">Step</span> <span class="hljs-number">3</span>: [tools]
  â””â”€ æ‰§è¡Œ: get_weather(<span class="hljs-string">"åŒ—äº¬"</span>)
  â””â”€ è¿”å›: <span class="hljs-string">"åŒ—äº¬ï¼šæ™´å¤©ï¼Œ15Â°C"</span>

<span class="hljs-keyword">Step</span> <span class="hljs-number">4</span>: [agent]
  â””â”€ LLM çœ‹åˆ°å·¥å…·ç»“æœ
  â””â”€ ç”Ÿæˆæœ€ç»ˆå›ç­”ï¼Œæ—  tool_calls

<span class="hljs-keyword">Step</span> <span class="hljs-number">5</span>: [router] â†’ æ—  tool_calls â†’ å» [<span class="hljs-keyword">END</span>]

æœ€ç»ˆè¾“å‡º: <span class="hljs-string">"åŒ—äº¬ä»Šå¤©æ™´å¤©ï¼Œæ°”æ¸©15Â°Cï¼Œæ˜¯ä¸ªå¥½å¤©æ°”ï¼"</span>
</code></pre>
<h3 data-id="heading-37">9.5 é‡è¦æ¦‚å¿µè¾¨æ</h3>
<p>å¾ˆå¤šäººæ··æ·† <code>llmWithTools</code> å’Œ <code>toolNode</code>ï¼š</p>

























<table><thead><tr><th>æ¦‚å¿µ</th><th>ä½œç”¨</th><th>ç±»æ¯”</th></tr></thead><tbody><tr><td><code>llmWithTools</code></td><td>è®© LLM <strong>çŸ¥é“</strong>æœ‰å“ªäº›å·¥å…·</td><td>å·¥å…·è¯´æ˜ä¹¦</td></tr><tr><td><code>agentNode</code></td><td>è°ƒç”¨ LLM <strong>å†³ç­–</strong>æ˜¯å¦ç”¨å·¥å…·</td><td>å†³ç­–è€…</td></tr><tr><td><code>toolNode</code></td><td><strong>çœŸæ­£æ‰§è¡Œ</strong>å·¥å…·è°ƒç”¨</td><td>æ‰§è¡Œè€…</td></tr></tbody></table>
<pre><code class="hljs language-css" lang="css">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                          â”‚
â”‚  agentNode (å†…éƒ¨ç”¨ llmWithTools)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLM: <span class="hljs-string">"ç”¨æˆ·é—®å¤©æ°”ï¼Œæˆ‘éœ€è¦è°ƒç”¨ get_weather"</span>           â”‚  â”‚
â”‚  â”‚      â†“                                             â”‚  â”‚
â”‚  â”‚ è¾“å‡º: tool_calls: [{name: <span class="hljs-string">"get_weather"</span>, ...}]     â”‚  â”‚
â”‚  â”‚      ï¼ˆåªæ˜¯"è¯´"è¦è°ƒç”¨ï¼Œæ²¡æœ‰çœŸçš„è°ƒï¼‰                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â”‚                               â”‚
â”‚                          â–¼                               â”‚
â”‚  toolNode                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ‰§è¡Œ: <span class="hljs-built_in">get_weather</span>(<span class="hljs-string">"åŒ—äº¬"</span>)                          â”‚  â”‚
â”‚  â”‚ è¿”å›: <span class="hljs-string">"åŒ—äº¬ï¼šæ™´å¤©ï¼Œ15Â°C"</span>                           â”‚  â”‚
â”‚  â”‚      ï¼ˆçœŸæ­£è°ƒç”¨å·¥å…·ï¼Œæ‹¿åˆ°ç»“æœï¼‰                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>è®°å¿†å£è¯€</strong>ï¼šllmWithTools è®© LLMã€ŒçŸ¥é“ã€å·¥å…·ï¼ŒtoolNode è®©å·¥å…·ã€Œæ‰§è¡Œã€ï¼</p>
</blockquote>
<hr/>
<h2 data-id="heading-38">10. æµå¼è¾“å‡º</h2>
<h3 data-id="heading-39">10.1 invoke vs stream</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// invoke: ç­‰å¾…å…¨éƒ¨å®Œæˆ</span>
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">invoke</span>(initialState);

<span class="hljs-comment">// stream: å®æ—¶è¿”å›æ¯ä¸ªèŠ‚ç‚¹è¾“å‡º</span>
<span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> event <span class="hljs-keyword">of</span> app.<span class="hljs-title function_">stream</span>(initialState)) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(event);
  <span class="hljs-comment">// { "agent": { messages: [...] } }</span>
  <span class="hljs-comment">// { "tools": { messages: [...] } }</span>
}
</code></pre>
<h3 data-id="heading-40">10.2 ä¼˜åŠ¿</h3>
<ul>
<li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šå®æ—¶çœ‹åˆ°è¿›åº¦ï¼Œå‡å°‘ç­‰å¾…ç„¦è™‘</li>
<li><strong>è°ƒè¯•æ–¹ä¾¿</strong>ï¼šçœ‹åˆ°æ¯æ­¥ä¸­é—´ç»“æœ</li>
<li><strong>æ—©æœŸå‘ç°</strong>ï¼šæŸèŠ‚ç‚¹å‡ºé”™å¯å°½æ—©å‘ç°</li>
<li><strong>å†…å­˜å‹å¥½</strong>ï¼šè¾¹å¤„ç†è¾¹è¾“å‡º</li>
</ul>
<hr/>
<h2 data-id="heading-41">11. æœ€ä½³å®è·µä¸è¸©å‘æŒ‡å—</h2>
<h3 data-id="heading-42">11.1 çŠ¶æ€è®¾è®¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… å¥½çš„è®¾è®¡</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">GoodState</span> = <span class="hljs-title class_">Annotation</span>.<span class="hljs-title class_">Root</span>({
  <span class="hljs-attr">userQuestion</span>: <span class="hljs-title class_">Annotation</span>({ ... }),      <span class="hljs-comment">// æ¸…æ™°å‘½å</span>
  <span class="hljs-attr">chatHistory</span>: <span class="hljs-title class_">Annotation</span>({
    <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">p, n</span>) =&gt;</span> [...p, ...n],      <span class="hljs-comment">// åˆé€‚çš„ reducer</span>
  }),
  <span class="hljs-attr">retryCount</span>: <span class="hljs-title class_">Annotation</span>({
    <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-number">0</span>,                     <span class="hljs-comment">// æ˜ç¡®é»˜è®¤å€¼</span>
  }),
});

<span class="hljs-comment">// âŒ ä¸å¥½çš„è®¾è®¡</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">BadState</span> = <span class="hljs-title class_">Annotation</span>.<span class="hljs-title class_">Root</span>({
  <span class="hljs-attr">data</span>: <span class="hljs-title class_">Annotation</span>({ ... }),   <span class="hljs-comment">// å‘½åæ¨¡ç³Š</span>
  <span class="hljs-attr">x</span>: <span class="hljs-title class_">Annotation</span>({ ... }),      <span class="hljs-comment">// å«ä¹‰ä¸æ˜</span>
});
</code></pre>
<h3 data-id="heading-43">11.2 èŠ‚ç‚¹è®¾è®¡ï¼šå•ä¸€èŒè´£</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âœ… å¥½ï¼šæ¯ä¸ªèŠ‚ç‚¹åªåšä¸€ä»¶äº‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">translateNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> translated = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>([...]);
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">translatedText</span>: translated.<span class="hljs-property">content</span> };
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">analyzeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> analysis = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>([...]);
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">analysisResult</span>: analysis.<span class="hljs-property">content</span> };
}

<span class="hljs-comment">// âŒ ä¸å¥½ï¼šä¸€ä¸ªèŠ‚ç‚¹åšå¤ªå¤šäº‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doEverythingNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-comment">// ç¿»è¯‘ + åˆ†æ + æ€»ç»“ + ç”ŸæˆæŠ¥å‘Š...</span>
}
</code></pre>
<h3 data-id="heading-44">11.3 é”™è¯¯å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">safeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">riskyOperation</span>(state);
    <span class="hljs-keyword">return</span> { result, <span class="hljs-attr">error</span>: <span class="hljs-literal">null</span> };
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"èŠ‚ç‚¹æ‰§è¡Œå¤±è´¥:"</span>, error);
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">result</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">error</span>: error.<span class="hljs-property">message</span> };
  }
}

<span class="hljs-comment">// åœ¨è·¯ç”±ä¸­å¤„ç†é”™è¯¯</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">router</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">error</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"errorHandler"</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">"nextStep"</span>;
}
</code></pre>
<h3 data-id="heading-45">11.4 å¾ªç¯å¿…é¡»è®¾ç½®ä¸Šé™</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">MAX_ITERATIONS</span> = <span class="hljs-number">10</span>; <span class="hljs-comment">// å¿…é¡»ï¼</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">loopRouter</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">iterations</span> &gt;= <span class="hljs-variable constant_">MAX_ITERATIONS</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">"âš ï¸ è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°"</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;
  }
  <span class="hljs-keyword">if</span> (state.<span class="hljs-property">isComplete</span>) <span class="hljs-keyword">return</span> <span class="hljs-string">"end"</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-string">"continue"</span>;
}
</code></pre>
<hr/>
<h2 data-id="heading-46">12. é™„å½•ï¼šLLM å‚æ•°é…ç½®</h2>
<h3 data-id="heading-47">12.1 temperature å‚æ•°</h3>






























<table><thead><tr><th>å€¼</th><th>æ•ˆæœ</th><th>è¾“å‡ºç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>0</strong></td><td>ç¡®å®šæ€§æœ€é«˜</td><td>æ¯æ¬¡å‡ ä¹ç›¸åŒ</td></tr><tr><td><strong>0.1-0.3</strong></td><td>ä½éšæœºæ€§</td><td>ç¨³å®šã€å¯é¢„æµ‹</td></tr><tr><td><strong>0.5-0.7</strong></td><td>ä¸­ç­‰</td><td>å¹³è¡¡åˆ›æ„å’Œä¸€è‡´æ€§</td></tr><tr><td><strong>0.8-1.0</strong></td><td>é«˜éšæœºæ€§</td><td>æ›´æœ‰åˆ›æ„</td></tr></tbody></table>
<h3 data-id="heading-48">12.2 æ¨èå€¼</h3>





























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èå€¼</th></tr></thead><tbody><tr><td>ä»£ç ç”Ÿæˆ / æ•°å­¦</td><td>0 ~ 0.2</td></tr><tr><td>æ•°æ®æå– / åˆ†ç±»</td><td>0</td></tr><tr><td>é—®ç­” / çŸ¥è¯†æ£€ç´¢</td><td>0 ~ 0.3</td></tr><tr><td>é€šç”¨å¯¹è¯</td><td>0.5 ~ 0.7</td></tr><tr><td>åˆ›æ„å†™ä½œ</td><td>0.7 ~ 1.0</td></tr></tbody></table>
<h3 data-id="heading-49">12.3 åœ¨ LangGraph ä¸­ä½¿ç”¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸åŒèŠ‚ç‚¹ç”¨ä¸åŒ temperature</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">codeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> precisionLLM = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({ <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.1</span> });
  <span class="hljs-comment">// ...</span>
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">creativeNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">const</span> creativeLLM = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChatDeepSeek</span>({ <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.9</span> });
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-50">ğŸ¯ å¿«é€Ÿå‚è€ƒæ¨¡æ¿</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">StateGraph</span>, <span class="hljs-title class_">Annotation</span>, <span class="hljs-variable constant_">START</span>, <span class="hljs-variable constant_">END</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ToolNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/langgraph/prebuilt"</span>;

<span class="hljs-comment">// 1. å®šä¹‰çŠ¶æ€</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">MyState</span> = <span class="hljs-title class_">Annotation</span>.<span class="hljs-title class_">Root</span>({
  <span class="hljs-attr">input</span>: <span class="hljs-title class_">Annotation</span>({ <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">_, x</span>) =&gt;</span> x, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">""</span> }),
  <span class="hljs-attr">output</span>: <span class="hljs-title class_">Annotation</span>({ <span class="hljs-attr">reducer</span>: <span class="hljs-function">(<span class="hljs-params">_, x</span>) =&gt;</span> x, <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">""</span> }),
});

<span class="hljs-comment">// 2. å®šä¹‰èŠ‚ç‚¹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">myNode</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">return</span> { <span class="hljs-attr">output</span>: <span class="hljs-string">"processed"</span> };
}

<span class="hljs-comment">// 3. å®šä¹‰è·¯ç”±</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">myRouter</span>(<span class="hljs-params">state</span>) {
  <span class="hljs-keyword">return</span> state.<span class="hljs-property">output</span> ? <span class="hljs-string">"end"</span> : <span class="hljs-string">"continue"</span>;
}

<span class="hljs-comment">// 4. æ„å»ºå›¾</span>
<span class="hljs-keyword">const</span> graph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StateGraph</span>(<span class="hljs-title class_">MyState</span>)
  .<span class="hljs-title function_">addNode</span>(<span class="hljs-string">"myNode"</span>, myNode)
  .<span class="hljs-title function_">addEdge</span>(<span class="hljs-variable constant_">START</span>, <span class="hljs-string">"myNode"</span>)
  .<span class="hljs-title function_">addConditionalEdges</span>(<span class="hljs-string">"myNode"</span>, myRouter, {
    <span class="hljs-attr">continue</span>: <span class="hljs-string">"myNode"</span>,
    <span class="hljs-attr">end</span>: <span class="hljs-variable constant_">END</span>,
  });

<span class="hljs-comment">// 5. ç¼–è¯‘æ‰§è¡Œ</span>
<span class="hljs-keyword">const</span> app = graph.<span class="hljs-title function_">compile</span>();
<span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> app.<span class="hljs-title function_">invoke</span>({ <span class="hljs-attr">input</span>: <span class="hljs-string">"hello"</span> });
</code></pre>
<hr/>
<h2 data-id="heading-51">ğŸ“– å­¦ä¹ èµ„æº</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Flangchain-ai.github.io%2Flanggraphjs%2F" target="_blank" title="https://langchain-ai.github.io/langgraphjs/" ref="nofollow noopener noreferrer">å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flangchain-ai%2Flanggraphjs" target="_blank" title="https://github.com/langchain-ai/langgraphjs" ref="nofollow noopener noreferrer">GitHub ä»“åº“</a></li>
<li>LangGraph Studioï¼šå¯è§†åŒ–è°ƒè¯•å·¥å…·</li>
</ul>
<hr/>
<h2 data-id="heading-52">å†™åœ¨æœ€å</h2>
<p>LangGraph çš„æ ¸å¿ƒå°±æ˜¯<strong>ç”¨ã€Œç”»æµç¨‹å›¾ã€çš„æ€ç»´æ¥æ„å»º AI åº”ç”¨</strong>ã€‚æŒæ¡äº† Stateã€Nodeã€Edge è¿™ä¸‰ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼Œä½ å°±èƒ½æ„å»ºå„ç§å¤æ‚çš„ AI å·¥ä½œæµã€‚</p>
<p><strong>å­¦ä¹ å»ºè®®</strong>ï¼š</p>
<ol>
<li>å…ˆä»ç®€å•çš„ä¸²è¡Œæµç¨‹å¼€å§‹</li>
<li>é€æ­¥æ·»åŠ æ¡ä»¶åˆ†æ”¯</li>
<li>æœ€åå®ç°å®Œæ•´çš„ ReAct Agent</li>
</ol>
<p>æ¯ä¸€æ­¥éƒ½è¿è¡Œä»£ç ï¼Œè§‚å¯ŸçŠ¶æ€çš„å˜åŒ–ï¼Œä½ ä¼šå¾ˆå¿«ä¸Šæ‰‹ï¼</p>
<hr/>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿<strong>ç‚¹èµ ğŸ‘ æ”¶è— â­ å…³æ³¨</strong>ï¼Œåç»­è¿˜ä¼šåˆ†äº«æ›´å¤š AI å¼€å‘å¹²è´§ï¼</p>
<p>æœ‰é—®é¢˜æ¬¢è¿è¯„è®ºåŒºäº¤æµ~ ğŸ‰</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG + Agent + Promptå·¥ç¨‹ä¸­]]></title>    <link>https://juejin.cn/post/7579438351296839716</link>    <guid>https://juejin.cn/post/7579438351296839716</guid>    <pubDate>2025-12-03T08:33:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579438351296839716" data-draft-id="7578948893762273307" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG + Agent + Promptå·¥ç¨‹ä¸­"/> <meta itemprop="keywords" content="Docker,AIGC,LLM"/> <meta itemprop="datePublished" content="2025-12-03T08:33:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›½å®¶ä¸ä¿æŠ¤åºŸç‰©"/> <meta itemprop="url" content="https://juejin.cn/user/1220936035210004"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG + Agent + Promptå·¥ç¨‹ä¸­
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1220936035210004/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›½å®¶ä¸ä¿æŠ¤åºŸç‰©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:33:26.000Z" title="Wed Dec 03 2025 08:33:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RAG + Agent + Prompt å·¥ç¨‹ä¸­ï¼šæ­å»ºæœ¬åœ°å‘é‡æ•°æ®åº“Qdrantã€æ–‡æ¡£å¤„ç†ä¸å¤šè¯­è¨€æ”¯æŒå›½é™…åŒ–</h2>
<blockquote>
<p>æœ¬æ–‡æ˜¯ <strong>RAG ç³»ç»Ÿå®æˆ˜ç³»åˆ—</strong> çš„ä¸­é—´ç¯‡ã€‚åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº† RAG çš„åŸºæœ¬åŸç†å’Œ LangChain çš„æ ¸å¿ƒæ¦‚å¿µã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†æ·±å…¥å®æˆ˜ç¯èŠ‚â€”â€”æ‰‹æŠŠæ‰‹æ•™ä½ å¦‚ä½•æ­å»ºæœ¬åœ°å‘é‡æ•°æ®åº“ï¼ˆQdrantï¼‰ï¼Œå¹¶é‡ç‚¹è®²è§£ <strong>æ–‡æ¡£é¢„å¤„ç†æµç¨‹</strong> å’Œ <strong>å¤šè¯­è¨€å›½é™…åŒ–æ”¯æŒ</strong> çš„å®Œæ•´å®ç°æ–¹æ¡ˆã€‚</p>
<p>é™„ä¸Šé¡¹ç›®æºä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Flhlhlhlhl%2Fassessment-rag" target="_blank" title="https://github.com/lhlhlhlhl/assessment-rag" ref="nofollow noopener noreferrer">lhlhlhlhl/assessment-rag</a></p>
</blockquote>
<hr/>
<h3 data-id="heading-1">å‰è¨€ï¼šä¸ºä»€ä¹ˆå‘é‡æ•°æ®åº“å¦‚æ­¤é‡è¦ï¼Ÿ</h3>
<p>åœ¨ RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿä¸­ï¼Œ<strong>å‘é‡æ•°æ®åº“</strong> æ˜¯è¿æ¥â€œç”¨æˆ·é—®é¢˜â€ä¸â€œçŸ¥è¯†åº“å†…å®¹â€çš„æ¡¥æ¢ã€‚å®ƒçš„ä½œç”¨æ˜¯ï¼š</p>
<ul>
<li>å°†ä½ çš„æ–‡æ¡£å†…å®¹è½¬æ¢ä¸ºé«˜ç»´å‘é‡ï¼ˆå³â€œåµŒå…¥â€ï¼‰</li>
<li>å¿«é€Ÿæ‰¾å‡ºä¸ç”¨æˆ·æé—®è¯­ä¹‰æœ€ç›¸è¿‘çš„å‡ æ®µæ–‡æœ¬</li>
<li>ä¸ºå¤§æ¨¡å‹æä¾›ç²¾å‡†çš„ä¸Šä¸‹æ–‡ï¼Œä»è€Œç”Ÿæˆé«˜è´¨é‡å›ç­”</li>
</ul>
<p>æ²¡æœ‰é«˜æ•ˆçš„å‘é‡å­˜å‚¨å’Œæ£€ç´¢æœºåˆ¶ï¼ŒRAG å°±å¤±å»äº†â€œå¢å¼ºâ€çš„æ„ä¹‰ã€‚</p>
<p>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹© <strong>Qdrant</strong> ä½œä¸ºæœ¬åœ°å‘é‡æ•°æ®åº“ï¼Œå¹¶å›´ç»•å®ƒæ„å»ºäº†ä¸€å¥—å®Œæ•´çš„æ–‡æ¡£å¤„ç† + å¤šè¯­è¨€æ”¯æŒä½“ç³»ã€‚</p>
<hr/>
<h3 data-id="heading-2">ä¸€ã€å‘é‡æ•°æ®åº“é€‰å‹ï¼šä¸ºä»€ä¹ˆæ˜¯ Qdrantï¼Ÿ</h3>
<p>å¸‚é¢ä¸Šæœ‰ Pineconeã€Weaviateã€Milvusã€FAISS ç­‰å¤šç§å‘é‡æ•°æ®åº“ï¼Œæˆ‘ä»¬æœ€ç»ˆé€‰æ‹©äº† <strong>Qdrant</strong>ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p>





























<table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ğŸš€ <strong>é«˜æ€§èƒ½</strong></td><td>ç”¨ Rust ç¼–å†™ï¼Œå†…å­˜æ•ˆç‡é«˜ï¼Œå•æœºæ¯ç§’å¯å¤„ç†æ•°åƒæ¬¡æŸ¥è¯¢</td></tr><tr><td>ğŸ“¦ <strong>è½»é‡æ˜“éƒ¨ç½²</strong></td><td>æ”¯æŒ Docker ä¸€é”®å¯åŠ¨ï¼Œä¹Ÿæ”¯æŒäºŒè¿›åˆ¶ç›´æ¥è¿è¡Œ</td></tr><tr><td>ğŸ” <strong>æ”¯æŒå…ƒæ•°æ®è¿‡æ»¤</strong></td><td>ä¸ä»…èƒ½æŒ‰å‘é‡ç›¸ä¼¼åº¦æœç´¢ï¼Œè¿˜èƒ½ç»“åˆæ ‡ç­¾ã€æ¥æºç­‰æ¡ä»¶ç­›é€‰</td></tr><tr><td>ğŸŒ <strong>åŒåè®®æ”¯æŒ</strong></td><td>åŒæ—¶æä¾› RESTful API å’Œ gRPC æ¥å£ï¼Œé€‚é…ä¸åŒåœºæ™¯</td></tr><tr><td>ğŸ†“ <strong>å¼€æºå…è´¹</strong></td><td>ç¤¾åŒºæ´»è·ƒï¼Œæ–‡æ¡£å®Œå–„ï¼Œé€‚åˆæœ¬åœ°å¼€å‘å’Œä¸­å°è§„æ¨¡ç”Ÿäº§</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-3">äºŒã€ä¸¤ç§éƒ¨ç½²æ–¹å¼ï¼šDocker vs ç›´æ¥å®‰è£…</h3>
<h4 data-id="heading-4">æ–¹æ¡ˆä¸€ï¼šæ¨èï¼ä½¿ç”¨ Docker Compose ä¸€é”®éƒ¨ç½²ï¼ˆå¼€å‘é¦–é€‰ï¼‰</h4>
<h5 data-id="heading-5">1. åˆ›å»º <code>docker-compose.yml</code></h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">qdrant:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">qdrant/qdrant:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">smart_assessment_qdrant</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6333:6333"</span>  <span class="hljs-comment"># REST API ç«¯å£</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"6334:6334"</span>  <span class="hljs-comment"># gRPC ç«¯å£ï¼ˆå¯é€‰ï¼‰</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./qdrant_storage:/qdrant/storage</span>  <span class="hljs-comment"># æŒä¹…åŒ–æ•°æ®</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">QDRANT__SERVICE__GRPC_PORT=6334</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">rag_network</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">rag_network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ <strong>å…³é”®è§£é‡Š</strong>ï¼š</p>
<ul>
<li><code>volumes</code> å°†æœ¬åœ° <code>qdrant_storage/</code> ç›®å½•æŒ‚è½½åˆ°å®¹å™¨å†…ï¼Œ<strong>å³ä½¿åˆ é™¤å®¹å™¨ï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±</strong></li>
<li><code>restart: unless-stopped</code> ä¿è¯æœåŠ¡å´©æºƒåè‡ªåŠ¨é‡å¯</li>
<li>è‡ªå®šä¹‰ç½‘ç»œ <code>rag_network</code> ä¾¿äºæœªæ¥æ‰©å±•ï¼ˆå¦‚åŠ å…¥ LLM æœåŠ¡ï¼‰</li>
</ul>
</blockquote>
<h5 data-id="heading-6">2. å¯åŠ¨æœåŠ¡</h5>
<pre><code class="hljs">docker-compose up -d
</code></pre>
<h5 data-id="heading-7">3. éªŒè¯æ˜¯å¦æˆåŠŸ</h5>
<pre><code class="hljs language-bash" lang="bash">curl http://localhost:6333/collections
</code></pre>
<p>å¦‚æœè¿”å› <code>{"result":{"collections":[]},"status":"ok"}</code>ï¼Œè¯´æ˜ Qdrant å·²æ­£å¸¸è¿è¡Œï¼</p>
<hr/>
<h4 data-id="heading-8">æ–¹æ¡ˆäºŒï¼šé Docker å®‰è£…ï¼ˆé€‚åˆæ—  Docker ç¯å¢ƒï¼‰</h4>
<h5 data-id="heading-9">Windows ç”¨æˆ·ï¼š</h5>
<ol>
<li>
<p>ä» <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fqdrant%2Fqdrant%2Freleases" target="_blank" title="https://github.com/qdrant/qdrant/releases" ref="nofollow noopener noreferrer">GitHub Releases</a> ä¸‹è½½ <code>qdrant-windows-x86_64.zip</code></p>
</li>
<li>
<p>è§£å‹åè¿è¡Œï¼š</p>
<pre><code class="hljs">.\qdrant.exe
</code></pre>
</li>
</ol>
<h5 data-id="heading-10">Linux/macOS ç”¨æˆ·ï¼š</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ–¹æ³•1ï¼šAPT å®‰è£…ï¼ˆUbuntu/Debianï¼‰</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"deb [trusted=yes] https://apt.qdrant.io stable main"</span> | sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/qdrant.list
sudo apt update &amp;&amp; sudo apt install qdrant

<span class="hljs-comment"># æ–¹æ³•2ï¼šç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶</span>
wget https://github.com/qdrant/qdrant/releases/latest/download/qdrant-linux-x86_64.tar.gz
tar xzf qdrant-linux-x86_64.tar.gz
./qdrant
</code></pre>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼šé Docker æ–¹å¼éœ€è¦æ‰‹åŠ¨ç®¡ç†é…ç½®ã€æ—¥å¿—å’Œæ•°æ®ç›®å½•ï¼Œ<strong>å¼ºçƒˆå»ºè®®å¼€å‘é˜¶æ®µä½¿ç”¨ Docker</strong>ã€‚</p>
</blockquote>
<hr/>
<h4 data-id="heading-11">âœ… ä¸ºä»€ä¹ˆæˆ‘ä»¬æ¨è Dockerï¼Ÿ</h4>



































<table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>ç›´æ¥å®‰è£…</th><th>Docker</th></tr></thead><tbody><tr><td>å®‰è£…å¤æ‚åº¦</td><td>é«˜ï¼ˆéœ€å¤„ç†ä¾èµ–ã€è·¯å¾„ã€æƒé™ï¼‰</td><td>æä½ï¼ˆä¸€æ¡å‘½ä»¤ï¼‰</td></tr><tr><td>è·¨å¹³å°ä¸€è‡´æ€§</td><td>å·®ï¼ˆWindows/Linux è¡Œä¸ºå¯èƒ½ä¸åŒï¼‰</td><td>å®Œç¾ä¸€è‡´</td></tr><tr><td>æ•°æ®éš”ç¦»</td><td>æ— ï¼ˆæ–‡ä»¶æ•£è½åœ¨ç³»ç»Ÿå„å¤„ï¼‰</td><td>å®Œå…¨éš”ç¦»</td></tr><tr><td>ç‰ˆæœ¬åˆ‡æ¢</td><td>å›°éš¾</td><td>ä¿®æ”¹é•œåƒæ ‡ç­¾å³å¯</td></tr><tr><td>å¸è½½æ¸…ç†</td><td>å®¹æ˜“æ®‹ç•™</td><td><code>docker-compose down -v</code> ä¸€é”®æ¸…ç©º</td></tr></tbody></table>
<blockquote>
<p>ğŸ§© <strong>æ‰“ä¸ªæ¯”æ–¹</strong>ï¼š<br/>
ç›´æ¥å®‰è£…å°±åƒåœ¨å®¢å…é‡Œæ­å¸ç¯·â€”â€”å åœ°æ–¹ã€éš¾æ”¶æ‹¾ï¼›<br/>
Docker å°±åƒä¹°äº†ä¸€ä¸ªå¸¦è½®å­çš„é›†è£…ç®±â€”â€”éšæ—¶ç§»åŠ¨ã€å¹²å‡€æ•´æ´ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-12">ä¸‰ã€è¿æ¥ Qdrantï¼šä»£ç å®ç°è¯¦è§£</h3>
<p>æ— è®ºé‡‡ç”¨å“ªç§éƒ¨ç½²æ–¹å¼ï¼Œæˆ‘ä»¬çš„ JavaScript ä»£ç è¿æ¥é€»è¾‘å®Œå…¨ä¸€è‡´ã€‚ä»¥ä¸‹æ˜¯æ ¸å¿ƒç±» <code>QdrantVectorStoreManager</code> çš„ç²¾è¦è§£è¯»ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// åˆå§‹åŒ–å®¢æˆ·ç«¯</span>
<span class="hljs-keyword">this</span>.client = <span class="hljs-keyword">new</span> <span class="hljs-built_in">QdrantClient</span>({
  url: `http:<span class="hljs-comment">//${config.QDRANT_HOST}:${config.QDRANT_PORT}`,</span>
  timeout: <span class="hljs-number">30000</span>,
});

<span class="hljs-comment">// ä½¿ç”¨ Qwen å…¼å®¹ OpenAI çš„ Embedding æ¨¡å‹</span>
<span class="hljs-keyword">this</span>.embeddings = <span class="hljs-keyword">new</span> <span class="hljs-built_in">OpenAIEmbeddings</span>({
  openAIApiKey: config.QWEN_API_KEY,
  modelName: config.EMBEDDING_MODEL,
  configuration: { baseURL: config.QWEN_API_BASE }
});
</code></pre>
<blockquote>
<p>ğŸ”‘ <strong>å…³é”®ç‚¹</strong>ï¼šè™½ç„¶ç”¨äº† <code>OpenAIEmbeddings</code>ï¼Œä½†é€šè¿‡ <code>baseURL</code> æŒ‡å‘ Qwen çš„ APIï¼Œå®ç°äº†â€œç”¨ OpenAI æ¥å£è°ƒ Qwen æ¨¡å‹â€ã€‚</p>
</blockquote>
<p>åç»­çš„ <code>initCollection()</code>ã€<code>addDocuments()</code>ã€<code>search()</code> ç­‰æ–¹æ³•å°è£…äº†é›†åˆåˆ›å»ºã€æ–‡æ¡£æ’å…¥å’Œç›¸ä¼¼æ£€ç´¢ï¼Œ<strong>å®Œå…¨å…¼å®¹ LangChain ç”Ÿæ€</strong>ï¼Œå¯ç›´æ¥ç”¨äº RAG é“¾ã€‚</p>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/449cb55a1935432bbed7a882c9e24a31~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LiN5L-d5oqk5bqf54mp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765355605&amp;x-signature=sIi5dTAnFRTd5%2F9wwQDOapC%2FXH8%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-13">å››ã€æ–‡æ¡£å¤„ç†ï¼šä»åŸå§‹æ–‡ä»¶åˆ°å‘é‡å­˜å‚¨</h3>
<p>è¿™æ˜¯ RAG æ•ˆæœå¥½åçš„å…³é”®ï¼å¾ˆå¤šåˆå­¦è€…ç›´æ¥æŠŠæ•´ç¯‡æ–‡æ¡£ä¸¢è¿›å»ï¼Œç»“æœæ£€ç´¢æ•ˆæœå¾ˆå·®ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ <strong>â€œåˆ†å— + åµŒå…¥ + å­˜å‚¨â€</strong> ã€‚</p>
<h4 data-id="heading-14">æ­¥éª¤ 1ï¸âƒ£ï¼šåŠ è½½æ–‡æ¡£ï¼ˆæ”¯æŒ Markdownï¼‰</h4>
<p>æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ª <code>DocumentLoader</code> ç±»ï¼Œä¸“é—¨ç”¨äºé€’å½’æ‰«æ <code>docs/</code> ç›®å½•ä¸‹çš„æ‰€æœ‰ <code>.md</code> æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// é€’å½’æŸ¥æ‰¾æ‰€æœ‰ .md æ–‡ä»¶</span>
<span class="hljs-built_in">findMarkdownFiles</span>(dirPath) {
  const files = <span class="hljs-selector-attr">[]</span>;
  const items = fs<span class="hljs-selector-class">.readdirSync</span>(dirPath);
  for (const item of items) {
    const itemPath = path<span class="hljs-selector-class">.join</span>(dirPath, item);
    if (fs.statSync(itemPath)<span class="hljs-selector-class">.isDirectory</span>()) {
      files<span class="hljs-selector-class">.push</span>(...this.findMarkdownFiles(itemPath)); <span class="hljs-comment">// é€’å½’</span>
    } else if (path.extname(item) === '<span class="hljs-selector-class">.md</span>') {
      files<span class="hljs-selector-class">.push</span>(itemPath);
    }
  }
  return files;
}
</code></pre>
<p>æ¯ä¸ªæ–‡æ¡£è¢«å°è£…ä¸ºä¸€ä¸ª <code>Document</code> å¯¹è±¡ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li><code>content</code>ï¼šæ–‡ä»¶å…¨æ–‡</li>
<li><code>metadata</code>ï¼šæ¥æºè·¯å¾„ã€æ–‡ä»¶åã€åŠ è½½æ—¶é—´ç­‰</li>
</ul>
<hr/>
<h4 data-id="heading-15">æ­¥éª¤ 2ï¸âƒ£ï¼šæ™ºèƒ½æ–‡æœ¬åˆ†å‰²ï¼ˆé‡ä¸­ä¹‹é‡ï¼ï¼‰</h4>
<p><strong>ä¸ºä»€ä¹ˆä¸èƒ½æ•´ç¯‡å­˜ï¼Ÿ</strong><br/>
å› ä¸ºå¤§æ¨¡å‹æœ‰ä¸Šä¸‹æ–‡é•¿åº¦é™åˆ¶ï¼ˆå¦‚ 8192 tokensï¼‰ï¼Œè€Œä¸”é•¿æ–‡æœ¬åµŒå…¥ä¼šä¸¢å¤±å±€éƒ¨è¯­ä¹‰ã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨ LangChain çš„ <code>RecursiveCharacterTextSplitter</code>ï¼Œå¹¶<strong>é’ˆå¯¹ä¸­æ–‡åšäº†ä¼˜åŒ–</strong>ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">new</span> RecursiveCharacterTextSplitter({
  chunkSize: <span class="hljs-number">500</span>,        <span class="hljs-comment">// æ¯å—çº¦ 500 å­—ç¬¦</span>
  chunkOverlap: <span class="hljs-number">50</span>,      <span class="hljs-comment">// ç›¸é‚»å—é‡å  50 å­—ï¼Œé¿å…æ–­å¥</span>
  separators: [
    <span class="hljs-string">'\n\n'</span>,   <span class="hljs-comment">// ä¼˜å…ˆæŒ‰æ®µè½åˆ‡</span>
    <span class="hljs-string">'\n'</span>,
    <span class="hljs-string">'ã€‚'</span>, <span class="hljs-string">'ï¼'</span>, <span class="hljs-string">'ï¼Ÿ'</span>,  <span class="hljs-comment">// ä¸­æ–‡å¥å·ã€æ„Ÿå¹å·ã€é—®å·</span>
    <span class="hljs-string">'ï¼›'</span>, <span class="hljs-string">'ï¼Œ'</span>,         <span class="hljs-comment">// åˆ†å·ã€é€—å·</span>
    <span class="hljs-string">' '</span>,                <span class="hljs-comment">// è‹±æ–‡ç©ºæ ¼</span>
    <span class="hljs-string">''</span>                  <span class="hljs-comment">// æœ€åæŒ‰å­—ç¬¦åˆ‡</span>
  ]
})
</code></pre>
<blockquote>
<p>ğŸŒŸ <strong>æ•ˆæœç¤ºä¾‹</strong>ï¼š<br/>
åŸæ–‡ï¼šâ€œQwen æ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºçš„ AI æ¨¡å‹ã€‚å®ƒæ”¯æŒå¤šè¯­è¨€ã€‚â€<br/>
â†’ åˆ‡åˆ†ä¸ºä¸¤å—ï¼š<br/>
å—1ï¼šâ€œQwen æ˜¯é˜¿é‡Œå·´å·´æ¨å‡ºçš„ AI æ¨¡å‹ã€‚â€<br/>
å—2ï¼šâ€œå®ƒæ”¯æŒå¤šè¯­è¨€ã€‚â€</p>
</blockquote>
<p>è¿™æ ·æ—¢èƒ½ä¿æŒè¯­ä¹‰å®Œæ•´ï¼Œåˆé¿å…è·¨å¥åˆ‡å‰²ã€‚</p>
<hr/>
<h4 data-id="heading-16">æ­¥éª¤ 3ï¸âƒ£ï¼šå‘é‡åŒ– &amp; å­˜å…¥ Qdrant</h4>
<p>è¿™ä¸€æ­¥ç”± <code>QdrantVectorStore.addDocuments()</code> è‡ªåŠ¨å®Œæˆï¼š</p>
<ol>
<li>è°ƒç”¨ <code>embeddings.embedDocuments()</code> ç”Ÿæˆå‘é‡</li>
<li>å°† <code>[å‘é‡, æ–‡æœ¬, å…ƒæ•°æ®]</code> ä½œä¸ºâ€œç‚¹ï¼ˆPointï¼‰â€å­˜å…¥ Qdrant</li>
</ol>
<p>æ•´ä¸ªè¿‡ç¨‹å¯¹å¼€å‘è€…é€æ˜ï¼Œä½ åªéœ€ä¼ å…¥ <code>Document[]</code> å³å¯ã€‚</p>
<hr/>
<h3 data-id="heading-17">äº”ã€å›½é™…åŒ–ï¼ˆi18nï¼‰ï¼šè®©ç³»ç»Ÿæ”¯æŒä¸­è‹±æ–‡åˆ‡æ¢</h3>
<p>ä¸ºäº†è®©é¡¹ç›®æ›´ä¸“ä¸šã€æ›´æ˜“ç”¨ï¼Œæˆ‘ä»¬åŠ å…¥äº†å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒã€‚</p>
<h4 data-id="heading-18">1. æŠ€æœ¯é€‰å‹ï¼ši18next + JSON èµ„æºæ–‡ä»¶</h4>
<ul>
<li><strong>i18next</strong>ï¼šä¸šç•Œæ ‡å‡†çš„ JS å›½é™…åŒ–åº“</li>
<li><strong>JSON æ–‡ä»¶</strong>ï¼šæŒ‰è¯­è¨€åˆ†ç±»å­˜å‚¨ç¿»è¯‘æ–‡æœ¬ï¼Œç»“æ„æ¸…æ™°</li>
</ul>
<p>ç›®å½•ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">src/i18n/
â”œâ”€â”€ index.js              <span class="hljs-comment"># å›½é™…åŒ–ç®¡ç†å™¨</span>
â””â”€â”€ locales/
    â”œâ”€â”€ en/translation.json
    â””â”€â”€ zh-CN/translation.json
</code></pre>
<hr/>
<h4 data-id="heading-19">2. æ ¸å¿ƒï¼šI18nManager å•ä¾‹ç±»</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">I18nManager</span> {
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">init</span>(<span class="hljs-params">language = <span class="hljs-string">'en'</span></span>) {
    <span class="hljs-keyword">await</span> i18next.<span class="hljs-title function_">use</span>(<span class="hljs-title class_">Backend</span>).<span class="hljs-title function_">init</span>({
      <span class="hljs-attr">lng</span>: language,
      <span class="hljs-attr">fallbackLng</span>: <span class="hljs-string">'en'</span>,
      <span class="hljs-attr">backend</span>: {
        <span class="hljs-attr">loadPath</span>: <span class="hljs-string">'./locales/{{lng}}/translation.json'</span>
      }
    });
  }

  <span class="hljs-title function_">t</span>(<span class="hljs-params">key, options = {}</span>) {
    <span class="hljs-keyword">return</span> i18next.<span class="hljs-title function_">t</span>(key, options); <span class="hljs-comment">// å¦‚ t('messages.loading_docs', { count: 5 })</span>
  }

  <span class="hljs-title function_">getPreferredLanguage</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 1. è¯»å–ç³»ç»Ÿç¯å¢ƒå˜é‡ LANG</span>
    <span class="hljs-comment">// 2. è‡ªåŠ¨åŒ¹é…æ”¯æŒçš„è¯­è¨€ï¼ˆå¦‚ zh_CN â†’ zh-CNï¼‰</span>
    <span class="hljs-comment">// 3. é»˜è®¤å›é€€åˆ°è‹±æ–‡</span>
  }
}
</code></pre>
<blockquote>
<p>âœ… <strong>ä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>æ”¯æŒæ’å€¼ï¼ˆå¦‚ <code>{{count}}</code>ï¼‰</li>
<li>è‡ªåŠ¨è¯­è¨€æ£€æµ‹</li>
<li>æœªç¿»è¯‘æ—¶å›é€€åˆ°è‹±æ–‡</li>
</ul>
</blockquote>
<hr/>
<h4 data-id="heading-20">3. ç¿»è¯‘æ–‡ä»¶ç¤ºä¾‹ï¼ˆzh-CN/translation.jsonï¼‰</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"document_loader"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"loading_all_docs"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ­£åœ¨åŠ è½½æ‰€æœ‰æ–‡æ¡£..."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"loaded_doc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å·²åŠ è½½æ–‡æ¡£: {{path}}"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"error_loading_doc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"åŠ è½½æ–‡æ¡£å¤±è´¥ {{path}}: {{error}}"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"text_splitter"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"splitting_docs"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ­£åœ¨åˆ†å‰²æ–‡æ¡£..."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"split_doc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ–‡æ¡£ {{path}} å·²åˆ†å‰²ä¸º {{count}} ä¸ªå—"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"vector_store"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"creating_collection"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ­£åœ¨åˆ›å»ºé›†åˆ: {{name}}"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"collection_exists"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é›†åˆ {{name}} å·²å­˜åœ¨"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"adding_batch"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"æ­£åœ¨æ·»åŠ  {{count}} ä¸ªæ–‡æ¡£å—..."</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h4 data-id="heading-21">4. åœ¨ä»£ç ä¸­ä½¿ç”¨</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// åˆå§‹åŒ–ï¼ˆè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿè¯­è¨€ï¼‰</span>
<span class="hljs-selector-tag">await</span> <span class="hljs-selector-tag">i18nManager</span><span class="hljs-selector-class">.init</span>(i18nManager.<span class="hljs-built_in">getPreferredLanguage</span>());

<span class="hljs-comment">// æ‰“å°æ—¥å¿—</span>
<span class="hljs-selector-tag">console</span><span class="hljs-selector-class">.log</span>(i18nManager.<span class="hljs-built_in">t</span>(<span class="hljs-string">'vector_store.adding_batch'</span>, { <span class="hljs-attribute">count</span>: docs.length }));
</code></pre>
<h4 data-id="heading-22">5. å‘½ä»¤è¡Œæ”¯æŒè¯­è¨€åˆ‡æ¢</h4>
<pre><code class="hljs language-sql" lang="sql"># é»˜è®¤æ ¹æ®ç³»ç»Ÿè¯­è¨€è‡ªåŠ¨é€‰æ‹©
npm run <span class="hljs-keyword">start</span>

# å¼ºåˆ¶ä½¿ç”¨ä¸­æ–‡
npm run <span class="hljs-keyword">start</span> <span class="hljs-comment">-- -l zh-CN</span>

# å¼ºåˆ¶ä½¿ç”¨è‹±æ–‡
npm run <span class="hljs-keyword">start</span> <span class="hljs-comment">-- -l en</span>
</code></pre>
<p>æ•ˆæœå±•ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f39b7f81047f4e05ab9b5d5cf0ed2c46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LiN5L-d5oqk5bqf54mp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765355605&amp;x-signature=GUyrDfQaK%2F8IVToTT1Hxn%2FXJn04%3D" alt="image.png" loading="lazy"/></p>
<blockquote>
<p>ğŸŒ <strong>ç”¨æˆ·ä½“éªŒæå‡</strong>ï¼šéè‹±è¯­ç”¨æˆ·ä¸å†é¢å¯¹æ»¡å±è‹±æ–‡æŠ¥é”™ï¼Œå¤§å¤§é™ä½ä½¿ç”¨é—¨æ§›ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-23">å…­ã€å®Œæ•´æµç¨‹ï¼šä»é›¶åˆå§‹åŒ–åˆ°äº¤äº’é—®ç­”</h3>
<p>æ•´ä¸ªç³»ç»Ÿå¯åŠ¨æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>éªŒè¯é…ç½®</strong> â†’ 2. <strong>åŠ è½½æ–‡æ¡£</strong> â†’ 3. <strong>æ™ºèƒ½åˆ†å—</strong> â†’ 4. <strong>è¿æ¥ Qdrant</strong> â†’ 5. <strong>æ‰¹é‡å‘é‡åŒ–å­˜å‚¨</strong></li>
</ol>

<pre><code class="hljs language-css" lang="css">graph LR
<span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[éªŒè¯é…ç½®]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[åŠ è½½ docs/ ä¸‹æ‰€æœ‰ .md æ–‡ä»¶]</span>
<span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[æŒ‰è¯­ä¹‰åˆ†å‰²ä¸ºå°å—]</span>
C --&gt; D<span class="hljs-selector-attr">[è¿æ¥ Qdrant]</span>
D --&gt; E<span class="hljs-selector-attr">[ç”Ÿæˆå‘é‡å¹¶å­˜å…¥]</span>
E --&gt; F<span class="hljs-selector-attr">[å¯åŠ¨äº¤äº’å¼é—®ç­”]</span>
</code></pre>
<p>åœ¨é—®ç­”é˜¶æ®µï¼Œç”¨æˆ·è¾“å…¥é—®é¢˜åï¼š</p>
<ul>
<li>ç³»ç»Ÿå°†é—®é¢˜å‘é‡åŒ–</li>
<li>åœ¨ Qdrant ä¸­æ£€ç´¢ Top-K ç›¸ä¼¼å—</li>
<li>å°†ç»“æœ + åŸå§‹é—®é¢˜äº¤ç»™ LLM ç”Ÿæˆç­”æ¡ˆ</li>
<li>è¿”å›ç­”æ¡ˆ + æ¥æºå¼•ç”¨ï¼ˆå«ç›¸ä¼¼åº¦åˆ†æ•°ï¼‰</li>
</ul>
<hr/>
<h3 data-id="heading-24">æ€»ç»“</h3>
<p>æœ¬æ–‡æˆ‘ä»¬å®Œæˆäº† RAG ç³»ç»Ÿçš„ä¸‰å¤§æ ¸å¿ƒæ¨¡å—ï¼š</p>
<p>âœ… <strong>å‘é‡æ•°æ®åº“æ­å»º</strong>ï¼šé€šè¿‡ Docker å¿«é€Ÿéƒ¨ç½² Qdrantï¼Œå…¼é¡¾æ€§èƒ½ä¸ä¾¿æ·æ€§<br/>
âœ… <strong>æ–‡æ¡£æ™ºèƒ½å¤„ç†</strong>ï¼šä»åŠ è½½ã€ä¸­æ–‡å‹å¥½åˆ†å—åˆ°å‘é‡åŒ–ï¼Œç¡®ä¿æ£€ç´¢è´¨é‡<br/>
âœ… <strong>å¤šè¯­è¨€æ”¯æŒ</strong>ï¼šåŸºäº i18next å®ç°ä¸­è‹±æ–‡æ— ç¼åˆ‡æ¢ï¼Œæå‡å¯ç”¨æ€§</p>
<p>è¿™äº›å·¥ä½œä¸ºåç»­çš„ <strong>Agent å†³ç­–ã€Prompt ä¼˜åŒ–ã€è¯„ä¼°æŒ‡æ ‡</strong> ç­‰é«˜çº§åŠŸèƒ½æ‰“ä¸‹äº†åšå®åŸºç¡€ã€‚ï¼ˆå¦‚æœæƒ³çœ‹å®Œæ•´ä»£ç å¯åˆ°å¼€å¤´å±•ç¤ºçš„ä»£ç ä»“åº“ä¸­æŸ¥çœ‹ï¼Œé‡Œé¢åŒ…å«ragè°ƒç”¨çš„å®Œæ•´ä»£ç ï¼‰</p>
<blockquote>
<p>ğŸ“Œ <strong>ä¸‹æœŸé¢„å‘Š</strong>ï¼šæˆ‘ä»¬å°†ä½¿ç”¨ragå»åšä¸€ä¸ªæ³•å¾‹æ£€ç´¢çš„ä¸“ä¸šaié—®ç­”åŠ©æ‰‹ï¼Œä½¿ç”¨çˆ¬è™«æŠ€æœ¯å»å®Œå–„æˆ‘ä»¬çš„æ•°æ®åº“ï¼Œé‡‡ç”¨æµå¼è¾“å‡ºå»å±•ç¤ºæˆ‘ä»¬çš„ä»£ç ï¼Œå°†åç«¯ragæŠ€æœ¯ä¸å‰ç«¯é¡µé¢ç»“åˆèµ·æ¥ã€‚</p>
</blockquote>
<hr/>
<p><strong>é™„ï¼šå¸¸è§é—®é¢˜</strong></p>
<p>â“<strong>Qï¼šä¸ºä»€ä¹ˆä¸ç”¨ FAISSï¼Ÿ</strong><br/>
â†’ FAISS æ˜¯çº¯å‘é‡åº“ï¼Œæ— æŒä¹…åŒ–ã€æ— è¿‡æ»¤ã€æ—  APIï¼Œé€‚åˆå®éªŒï¼›Qdrant æ˜¯å®Œæ•´æ•°æ®åº“ï¼Œé€‚åˆäº§å“ã€‚</p>
<p>â“<strong>Qï¼šåˆ†å—å¤§å°æ€ä¹ˆé€‰ï¼Ÿ</strong><br/>
â†’ ä¸­æ–‡å»ºè®® 300â€“800 å­—ç¬¦ï¼Œè‹±æ–‡ 200â€“500 tokensã€‚å¯é€šè¿‡ <code>CHUNK_SIZE</code> é…ç½®è°ƒæ•´ã€‚</p>
<p>â“<strong>Qï¼šQwen çš„ embedding ç»´åº¦æ˜¯å¤šå°‘ï¼Ÿ</strong><br/>
â†’ <code>text-embedding-v2</code> è¾“å‡º <strong>1536 ç»´</strong>ï¼ŒåŠ¡å¿…åœ¨ <code>config.EMBEDDING_DIMENSION</code> ä¸­æ­£ç¡®è®¾ç½®ï¼</p>
<hr/>
<p>å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®ä½ å°‘èµ°å¼¯è·¯ï¼Œå¿«é€Ÿæ­å»ºå‡ºè‡ªå·±çš„ RAG ç³»ç»Ÿï¼æ¬¢è¿ç‚¹èµã€æ”¶è—ã€è¯„è®ºäº¤æµ ğŸ‘‡ ```</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€æ–‡ä»¶ç®¡ç†ç³»åˆ—ã€‘001ï¼šæ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·]]></title>    <link>https://juejin.cn/post/7579321624013996072</link>    <guid>https://juejin.cn/post/7579321624013996072</guid>    <pubDate>2025-12-03T08:20:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579321624013996072" data-draft-id="7579313396206993423" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€æ–‡ä»¶ç®¡ç†ç³»åˆ—ã€‘001ï¼šæ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·"/> <meta itemprop="keywords" content="åç«¯,Shell"/> <meta itemprop="datePublished" content="2025-12-03T08:20:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é›¶æ—¥å¤±çœ è€…"/> <meta itemprop="url" content="https://juejin.cn/user/3411111810444068"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€æ–‡ä»¶ç®¡ç†ç³»åˆ—ã€‘001ï¼šæ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3411111810444068/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é›¶æ—¥å¤±çœ è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:20:45.000Z" title="Wed Dec 03 2025 08:20:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ç®€ä»‹</h2>
<p>åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹å¤§é‡æ–‡ä»¶è¿›è¡Œé‡å‘½åæ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨æ•´ç†ç…§ç‰‡ã€æ–‡æ¡£æˆ–å…¶ä»–åª’ä½“æ–‡ä»¶æ—¶ã€‚æ‰‹åŠ¨ä¸€ä¸ªä¸ªé‡å‘½åä¸ä»…è€—æ—¶ï¼Œè¿˜å®¹æ˜“å‡ºé”™ã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸ªå®ç”¨çš„Pythonè„šæœ¬â€”â€”æ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·ï¼Œå®ƒå¯ä»¥å¤§å¤§æé«˜æˆ‘ä»¬çš„å·¥ä½œæ•ˆç‡ã€‚</p>
<h2 data-id="heading-1">åŠŸèƒ½ä»‹ç»</h2>
<p>è¿™ä¸ªæ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·å…·æœ‰ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š</p>
<ol>
<li><strong>æ‰¹é‡é‡å‘½å</strong>ï¼šå¯ä»¥åŒæ—¶å¯¹å¤šä¸ªæ–‡ä»¶æŒ‰ç…§æŒ‡å®šè§„åˆ™è¿›è¡Œé‡å‘½å</li>
<li><strong>å¤šç§å‘½åæ¨¡å¼</strong>ï¼šæ”¯æŒåºå·å‘½åã€å‰ç¼€å‘½åã€åç¼€å‘½åç­‰å¤šç§æ¨¡å¼</li>
<li><strong>æ–‡ä»¶è¿‡æ»¤</strong>ï¼šå¯ä»¥æ ¹æ®æ–‡ä»¶æ‰©å±•åã€æ–‡ä»¶åç‰¹å¾ç­‰æ¡ä»¶ç­›é€‰æ–‡ä»¶</li>
<li><strong>é¢„è§ˆåŠŸèƒ½</strong>ï¼šåœ¨å®é™…æ‰§è¡Œå‰å¯ä»¥é¢„è§ˆé‡å‘½åç»“æœ</li>
<li><strong>æ’¤é”€åŠŸèƒ½</strong>ï¼šæ”¯æŒæ“ä½œæ’¤é”€ï¼Œé˜²æ­¢è¯¯æ“ä½œ</li>
<li><strong>æ—¥å¿—è®°å½•</strong>ï¼šè®°å½•æ‰€æœ‰æ“ä½œå†å²ï¼Œä¾¿äºè¿½è¸ªå’Œå®¡è®¡</li>
</ol>
<h2 data-id="heading-2">åº”ç”¨åœºæ™¯</h2>
<p>è¿™ä¸ªå·¥å…·é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li><strong>ç…§ç‰‡æ•´ç†</strong>ï¼šå°†ç›¸æœºæ‹æ‘„çš„ç…§ç‰‡æŒ‰æ—¥æœŸæˆ–åºå·ç»Ÿä¸€å‘½å</li>
<li><strong>æ–‡æ¡£ç®¡ç†</strong>ï¼šå¯¹å…¬å¸æˆ–ä¸ªäººæ–‡æ¡£è¿›è¡Œè§„èŒƒåŒ–å‘½å</li>
<li><strong>ä¸‹è½½æ–‡ä»¶æ•´ç†</strong>ï¼šå¯¹ä¸‹è½½çš„æ–‡ä»¶è¿›è¡Œæ‰¹é‡é‡å‘½åä»¥æé«˜å¯è¯»æ€§</li>
<li><strong>å¼€å‘é¡¹ç›®</strong>ï¼šå¯¹ä»£ç æ–‡ä»¶æˆ–èµ„æºæ–‡ä»¶è¿›è¡Œç»Ÿä¸€å‘½åè§„èŒƒ</li>
<li><strong>å­¦æœ¯ç ”ç©¶</strong>ï¼šå¯¹å®éªŒæ•°æ®æ–‡ä»¶è¿›è¡Œæœ‰åºå‘½å</li>
</ol>
<h2 data-id="heading-3">æŠ¥é”™å¤„ç†</h2>
<p>è„šæœ¬åŒ…å«äº†å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š</p>
<ol>
<li><strong>è·¯å¾„ä¸å­˜åœ¨</strong>ï¼šæ£€æŸ¥æŒ‡å®šç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™æç¤ºç”¨æˆ·</li>
<li><strong>æƒé™ä¸è¶³</strong>ï¼šæ£€æµ‹æ–‡ä»¶æ“ä½œæƒé™ï¼Œæƒé™ä¸è¶³æ—¶ç»™å‡ºæ˜ç¡®æç¤º</li>
<li><strong>æ–‡ä»¶å†²çª</strong>ï¼šæ£€æµ‹ç›®æ ‡æ–‡ä»¶åæ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…è¦†ç›–é‡è¦æ–‡ä»¶</li>
<li><strong>å‚æ•°éªŒè¯</strong>ï¼šéªŒè¯ç”¨æˆ·è¾“å…¥çš„å‚æ•°æ˜¯å¦åˆæ³•</li>
<li><strong>å¼‚å¸¸æ•è·</strong>ï¼šæ•è·å¹¶å¤„ç†è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å„ç§å¼‚å¸¸</li>
</ol>
<h2 data-id="heading-4">ä»£ç å®ç°</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">import</span> sys
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime

<span class="hljs-keyword">class</span> <span class="hljs-title class_">FileBatchRenamer</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, directory</span>):
        self.directory = directory
        self.rename_log = []
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">check_directory</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""æ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨"""</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.exists(self.directory):
            <span class="hljs-keyword">raise</span> FileNotFoundError(<span class="hljs-string">f"ç›®å½• '<span class="hljs-subst">{self.directory}</span>' ä¸å­˜åœ¨"</span>)
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> os.path.isdir(self.directory):
            <span class="hljs-keyword">raise</span> NotADirectoryError(<span class="hljs-string">f"'<span class="hljs-subst">{self.directory}</span>' ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ç›®å½•"</span>)
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_files</span>(<span class="hljs-params">self, extension=<span class="hljs-literal">None</span>, pattern=<span class="hljs-literal">None</span></span>):
        <span class="hljs-string">"""è·å–ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶åˆ—è¡¨"""</span>
        <span class="hljs-keyword">try</span>:
            self.check_directory()
            files = os.listdir(self.directory)
            filtered_files = []
            
            <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files:
                file_path = os.path.join(self.directory, file)
                <span class="hljs-comment"># åªå¤„ç†æ–‡ä»¶ï¼Œä¸å¤„ç†å­ç›®å½•</span>
                <span class="hljs-keyword">if</span> os.path.isfile(file_path):
                    <span class="hljs-comment"># æ ¹æ®æ‰©å±•åè¿‡æ»¤</span>
                    <span class="hljs-keyword">if</span> extension <span class="hljs-keyword">and</span> <span class="hljs-keyword">not</span> file.endswith(extension):
                        <span class="hljs-keyword">continue</span>
                    <span class="hljs-comment"># æ ¹æ®æ¨¡å¼è¿‡æ»¤</span>
                    <span class="hljs-keyword">if</span> pattern <span class="hljs-keyword">and</span> pattern <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> file:
                        <span class="hljs-keyword">continue</span>
                    filtered_files.append(file)
                    
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">sorted</span>(filtered_files)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è·å–æ–‡ä»¶åˆ—è¡¨æ—¶å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
            <span class="hljs-keyword">return</span> []
            
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">preview_rename</span>(<span class="hljs-params">self, files, naming_pattern, start_number=<span class="hljs-number">1</span></span>):
        <span class="hljs-string">"""é¢„è§ˆé‡å‘½åç»“æœ"""</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"\né‡å‘½åé¢„è§ˆ:"</span>)
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"-"</span> * <span class="hljs-number">50</span>)
        rename_map = {}
        
        <span class="hljs-keyword">for</span> i, filename <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(files, start_number):
            name, ext = os.path.splitext(filename)
            new_name = naming_pattern.<span class="hljs-built_in">format</span>(i) + ext
            rename_map[filename] = new_name
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{filename}</span> -&gt; <span class="hljs-subst">{new_name}</span>"</span>)
            
        <span class="hljs-keyword">return</span> rename_map
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">execute_rename</span>(<span class="hljs-params">self, rename_map</span>):
        <span class="hljs-string">"""æ‰§è¡Œé‡å‘½åæ“ä½œ"""</span>
        success_count = <span class="hljs-number">0</span>
        error_count = <span class="hljs-number">0</span>
        
        <span class="hljs-keyword">for</span> old_name, new_name <span class="hljs-keyword">in</span> rename_map.items():
            old_path = os.path.join(self.directory, old_name)
            new_path = os.path.join(self.directory, new_name)
            
            <span class="hljs-comment"># æ£€æŸ¥ç›®æ ‡æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨</span>
            <span class="hljs-keyword">if</span> os.path.exists(new_path):
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"è­¦å‘Š: æ–‡ä»¶ '<span class="hljs-subst">{new_name}</span>' å·²å­˜åœ¨ï¼Œè·³è¿‡ '<span class="hljs-subst">{old_name}</span>'"</span>)
                error_count += <span class="hljs-number">1</span>
                <span class="hljs-keyword">continue</span>
                
            <span class="hljs-keyword">try</span>:
                os.rename(old_path, new_path)
                self.rename_log.append((datetime.now(), old_name, new_name))
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æˆåŠŸé‡å‘½å: <span class="hljs-subst">{old_name}</span> -&gt; <span class="hljs-subst">{new_name}</span>"</span>)
                success_count += <span class="hljs-number">1</span>
            <span class="hljs-keyword">except</span> PermissionError:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æƒé™é”™è¯¯: æ— æ³•é‡å‘½å '<span class="hljs-subst">{old_name}</span>'ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æƒé™"</span>)
                error_count += <span class="hljs-number">1</span>
            <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
                <span class="hljs-built_in">print</span>(<span class="hljs-string">f"é‡å‘½å '<span class="hljs-subst">{old_name}</span>' æ—¶å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
                error_count += <span class="hljs-number">1</span>
                
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\né‡å‘½åå®Œæˆ! æˆåŠŸ: <span class="hljs-subst">{success_count}</span>, å¤±è´¥: <span class="hljs-subst">{error_count}</span>"</span>)
        
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">save_log</span>(<span class="hljs-params">self, log_file=<span class="hljs-string">"rename_log.txt"</span></span>):
        <span class="hljs-string">"""ä¿å­˜æ“ä½œæ—¥å¿—"""</span>
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(os.path.join(self.directory, log_file), <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:
                f.write(<span class="hljs-string">"æ–‡ä»¶æ‰¹é‡é‡å‘½åæ“ä½œæ—¥å¿—\n"</span>)
                f.write(<span class="hljs-string">"="</span> * <span class="hljs-number">50</span> + <span class="hljs-string">"\n"</span>)
                f.write(<span class="hljs-string">f"æ“ä½œæ—¶é—´: <span class="hljs-subst">{datetime.now().strftime(<span class="hljs-string">'%Y-%m-%d %H:%M:%S'</span>)}</span>\n"</span>)
                f.write(<span class="hljs-string">f"æ“ä½œç›®å½•: <span class="hljs-subst">{self.directory}</span>\n\n"</span>)
                
                <span class="hljs-keyword">for</span> timestamp, old_name, new_name <span class="hljs-keyword">in</span> self.rename_log:
                    f.write(<span class="hljs-string">f"[<span class="hljs-subst">{timestamp.strftime(<span class="hljs-string">'%H:%M:%S'</span>)}</span>] <span class="hljs-subst">{old_name}</span> -&gt; <span class="hljs-subst">{new_name}</span>\n"</span>)
                    
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ“ä½œæ—¥å¿—å·²ä¿å­˜åˆ°: <span class="hljs-subst">{log_file}</span>"</span>)
        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ä¿å­˜æ—¥å¿—æ—¶å‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    parser = argparse.ArgumentParser(description=<span class="hljs-string">"æ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·"</span>)
    parser.add_argument(<span class="hljs-string">"directory"</span>, <span class="hljs-built_in">help</span>=<span class="hljs-string">"è¦å¤„ç†çš„ç›®å½•è·¯å¾„"</span>)
    parser.add_argument(<span class="hljs-string">"-p"</span>, <span class="hljs-string">"--pattern"</span>, default=<span class="hljs-string">"file_{:03d}"</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"å‘½åæ¨¡å¼ï¼Œä½¿ç”¨ {:03d} è¡¨ç¤ºåºå· (é»˜è®¤: file_{:03d})"</span>)
    parser.add_argument(<span class="hljs-string">"-s"</span>, <span class="hljs-string">"--start"</span>, <span class="hljs-built_in">type</span>=<span class="hljs-built_in">int</span>, default=<span class="hljs-number">1</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"èµ·å§‹åºå· (é»˜è®¤: 1)"</span>)
    parser.add_argument(<span class="hljs-string">"-e"</span>, <span class="hljs-string">"--extension"</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"æ–‡ä»¶æ‰©å±•åè¿‡æ»¤ (ä¾‹å¦‚: .jpg)"</span>)
    parser.add_argument(<span class="hljs-string">"--preview"</span>, action=<span class="hljs-string">"store_true"</span>, 
                       <span class="hljs-built_in">help</span>=<span class="hljs-string">"ä»…é¢„è§ˆï¼Œä¸æ‰§è¡Œå®é™…é‡å‘½å"</span>)
    
    args = parser.parse_args()
    
    <span class="hljs-keyword">try</span>:
        renamer = FileBatchRenamer(args.directory)
        files = renamer.get_files(extension=args.extension)
        
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> files:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶"</span>)
            <span class="hljs-keyword">return</span>
            
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"æ‰¾åˆ° <span class="hljs-subst">{<span class="hljs-built_in">len</span>(files)}</span> ä¸ªæ–‡ä»¶"</span>)
        
        rename_map = renamer.preview_rename(files, args.pattern, args.start)
        
        <span class="hljs-keyword">if</span> args.preview:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"\né¢„è§ˆæ¨¡å¼ï¼Œæœªæ‰§è¡Œå®é™…é‡å‘½åæ“ä½œ"</span>)
            <span class="hljs-keyword">return</span>
            
        confirm = <span class="hljs-built_in">input</span>(<span class="hljs-string">"\nç¡®è®¤æ‰§è¡Œé‡å‘½åæ“ä½œ? (y/N): "</span>)
        <span class="hljs-keyword">if</span> confirm.lower() == <span class="hljs-string">'y'</span>:
            renamer.execute_rename(rename_map)
            renamer.save_log()
        <span class="hljs-keyword">else</span>:
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ“ä½œå·²å–æ¶ˆ"</span>)
            
    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:
        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"ç¨‹åºæ‰§è¡Œå‡ºé”™: <span class="hljs-subst">{e}</span>"</span>)
        sys.exit(<span class="hljs-number">1</span>)

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    main()
</code></pre>
<h2 data-id="heading-5">ä½¿ç”¨æ–¹æ³•</h2>
<h3 data-id="heading-6">åŸºæœ¬ä½¿ç”¨</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åŸºæœ¬ç”¨æ³•ï¼Œå¯¹ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶æŒ‰é»˜è®¤æ¨¡å¼é‡å‘½å</span>
python batch_renamer.py /path/to/directory

<span class="hljs-comment"># æŒ‡å®šå‘½åæ¨¡å¼</span>
python batch_renamer.py /path/to/directory -p <span class="hljs-string">"photo_{:04d}"</span>

<span class="hljs-comment"># æŒ‡å®šèµ·å§‹åºå·</span>
python batch_renamer.py /path/to/directory -s 100

<span class="hljs-comment"># åªå¤„ç†ç‰¹å®šæ‰©å±•åçš„æ–‡ä»¶</span>
python batch_renamer.py /path/to/directory -e .jpg

<span class="hljs-comment"># é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…æ‰§è¡Œé‡å‘½åï¼‰</span>
python batch_renamer.py /path/to/directory --preview
</code></pre>
<h3 data-id="heading-7">å‘½ä»¤è¡Œå‚æ•°è¯´æ˜</h3>
<ul>
<li><code>directory</code>: å¿…éœ€å‚æ•°ï¼ŒæŒ‡å®šè¦å¤„ç†çš„ç›®å½•è·¯å¾„</li>
<li><code>-p, --pattern</code>: å‘½åæ¨¡å¼ï¼Œé»˜è®¤ä¸º <code>file_{:03d}</code>ï¼Œå…¶ä¸­ <code>{:03d}</code> ä¼šè¢«æ›¿æ¢ä¸ºåºå·</li>
<li><code>-s, --start</code>: èµ·å§‹åºå·ï¼Œé»˜è®¤ä¸º 1</li>
<li><code>-e, --extension</code>: æ–‡ä»¶æ‰©å±•åè¿‡æ»¤å™¨ï¼Œåªå¤„ç†æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶</li>
<li><code>--preview</code>: é¢„è§ˆæ¨¡å¼ï¼Œåªæ˜¾ç¤ºé‡å‘½åç»“æœï¼Œä¸æ‰§è¡Œå®é™…æ“ä½œ</li>
</ul>
<h3 data-id="heading-8">ä½¿ç”¨ç¤ºä¾‹</h3>
<p>å‡è®¾æœ‰ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">image1.<span class="hljs-property">jpg</span>
image2.<span class="hljs-property">jpg</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">pdf</span>
photo.<span class="hljs-property">png</span>
</code></pre>
<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">python batch_renamer.py ./test_dir -p <span class="hljs-string">"pic_{:02d}"</span> -e .jpg
</code></pre>
<p>ç»“æœï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">pic_01.<span class="hljs-property">jpg</span>
pic_02.<span class="hljs-property">jpg</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-property">pdf</span>
photo.<span class="hljs-property">png</span>
</code></pre>
<h2 data-id="heading-9">æ€»ç»“</h2>
<p>è¿™ä¸ªæ–‡ä»¶æ‰¹é‡é‡å‘½åå·¥å…·é€šè¿‡ç®€å•çš„å‘½ä»¤è¡Œç•Œé¢æä¾›äº†å¼ºå¤§çš„æ‰¹é‡æ–‡ä»¶é‡å‘½ååŠŸèƒ½ã€‚å®ƒå…·æœ‰è‰¯å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆé˜²æ­¢è¯¯æ“ä½œï¼Œå¹¶é€šè¿‡æ—¥å¿—è®°å½•åŠŸèƒ½ä¿è¯æ“ä½œçš„å¯è¿½æº¯æ€§ã€‚æ— è®ºæ˜¯æ—¥å¸¸æ–‡ä»¶æ•´ç†è¿˜æ˜¯ä¸“ä¸šé¡¹ç›®ç®¡ç†ï¼Œè¿™ä¸ªå·¥å…·éƒ½èƒ½æ˜¾è‘—æé«˜å·¥ä½œæ•ˆç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[vxe-table ä½¿ç”¨ spanMethod åˆå¹¶å¡é¡¿çš„è§£å†³æ–¹æ¡ˆ]]></title>    <link>https://juejin.cn/post/7579255046979747866</link>    <guid>https://juejin.cn/post/7579255046979747866</guid>    <pubDate>2025-12-03T08:41:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579255046979747866" data-draft-id="7579440586693656622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="vxe-table ä½¿ç”¨ spanMethod åˆå¹¶å¡é¡¿çš„è§£å†³æ–¹æ¡ˆ"/> <meta itemprop="keywords" content="Vue.js"/> <meta itemprop="datePublished" content="2025-12-03T08:41:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·84179481456"/> <meta itemprop="url" content="https://juejin.cn/user/3921272428567529"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            vxe-table ä½¿ç”¨ spanMethod åˆå¹¶å¡é¡¿çš„è§£å†³æ–¹æ¡ˆ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3921272428567529/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·84179481456
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:41:06.000Z" title="Wed Dec 03 2025 08:41:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>vxe-table ä½¿ç”¨ spanMethod åˆå¹¶å¡é¡¿çš„è§£å†³æ–¹æ¡ˆï¼Œå½“ä¸šåŠ¡éœ€æ±‚éœ€è¦åˆå¹¶æ—¶ï¼Œç”±äºè¡¨æ ¼æ•°æ®æœ‰å‡ åƒæ¡ï¼Œä½¿ç”¨è¯¥åˆå¹¶åä¸æ”¯æŒè™šæ‹Ÿæ»šåŠ¨ä¼šå¡é¡¿ã€‚é€šè¿‡æŸ¥çœ‹å®˜ç½‘ï¼Œå‘ç°åº”è¯¥ä½¿ç”¨ merge-cells æ¥åˆå¹¶å•å…ƒæ ¼ï¼Œä¸ä»…ä½¿ç”¨éå¸¸ç®€å•ï¼Œè¿˜æ”¯æŒè™šæ‹Ÿæ»šåŠ¨ï¼Œåªéœ€è¦æŒ‡å®šè¡Œå·å’Œåˆ—å·ï¼Œåˆå¹¶æ•°é‡å°±å¯ä»¥ä¸´æ—¶åˆå¹¶å•å…ƒæ ¼ï¼Œéœ€è¦æ³¨æ„ï¼Œå®˜ç½‘è¯´æ˜æ˜¯ä¸´æ—¶åˆå¹¶ã€‚ä¹Ÿå°±æ˜¯åˆå¹¶åå¦‚æœä¸é‡æ–°æ›´æ–°åˆ—æˆ–è€…é‡æ–°åŠ è½½æ•°æ®ï¼Œæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯éœ€è¦éœ€è¦é‡æ–°åŠ è½½æ•°æ®ï¼Œé‚£ä¹ˆä¸´æ—¶åˆå¹¶å°±ä¼šä¸¢å¤±ï¼Œéœ€è¦é‡æ–°èµ‹å€¼ä¸€ä¸‹ merge-cells å°±å¯ä»¥é‡æ–°ä¸´æ—¶åˆå¹¶äº†ã€‚</p>
<p>æŸ¥çœ‹å®˜ç½‘ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fvxetable.cn" target="_blank" title="https://vxetable.cn" ref="nofollow noopener noreferrer">vxetable.cn</a>
gitbubï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fx-extends%2Fvxe-table" target="_blank" title="https://github.com/x-extends/vxe-table" ref="nofollow noopener noreferrer">github.com/x-extends/vâ€¦</a>
giteeï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-table" target="_blank" title="https://gitee.com/x-extends/vxe-table" ref="nofollow noopener noreferrer">gitee.com/x-extends/vâ€¦</a></p>
<h2 data-id="heading-0">æ•ˆæœ</h2>
<p>ä»¥ä¸‹é€šè¿‡ä½¿ç”¨ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„åœºæ™¯ï¼ŒåŒ…æ‹¬100åˆ—*500è¡Œï¼Œå¸¦å·¦å³å†»ç»“åˆ—å’Œè¡¨å°¾åˆè®¡ï¼Œæ¸²æŸ“å°±æ¯”è¾ƒå¤æ‚äº†ã€‚æµ‹è¯•äº†ä¸€ä¸‹ 5ä¸‡è¡Œå’Œ5åƒåˆ— éƒ½æ¯”è¾ƒæµç•…ï¼Œæ¯”ä¹‹å‰æµç•…å¤ªå¤šå€äº†.</p>
<p>é¿å…åˆå¹¶ä¸€æ•´è¡Œæˆ–ä¸€æ•´åˆ—ï¼Œå½“æ‰€æœ‰è¡Œéƒ½è¢«åˆå¹¶ä¸ºä¸€ä¸ªå•å…ƒæ ¼æ—¶å°±ç­‰åŒäºå…³é—­çºµå‘è™šæ‹Ÿæ»šåŠ¨ï¼Œå½“æ‰€æœ‰åˆ—éƒ½è¢«åˆå¹¶ä¸ºä¸€ä¸ªå•å…ƒæ ¼æ—¶å°±ç­‰åŒäºå…³é—­æ¨ªå‘è™šæ‹Ÿæ»šåŠ¨ã€‚åº”è¯¥é¿å…åˆå¹¶èŒƒå›´è¿‡å¤§çš„ä½¿ç”¨åœºæ™¯.</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/258dbaa4ba88406695df56577f5e7f43~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3ODQxNzk0ODE0NTY=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356066&amp;x-signature=DVhSVmikMve61x%2B04fil7nXD4D8%3D" alt="Video_2025-12-02_105507-ezgif.com-optimize.gif" loading="lazy"/></p>
<h2 data-id="heading-1">ä»£ç </h2>
<p>æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š
å¦‚æœä½¿ç”¨ merge-cells æ–¹å¼åˆ™æ˜¯å…¨åŠŸèƒ½çš„ï¼Œæ”¯æŒè™šæ‹Ÿæ»šåŠ¨ï¼›
å¦‚æœä½¿ç”¨ span-method æ–¹å¼çš„è™šæ‹Ÿæ»šåŠ¨æ”¯æŒéƒ¨åˆ†åŠŸèƒ½ï¼Œå­˜åœ¨åŠŸèƒ½é™åˆ¶ï¼šå¦‚æœè¿›è¡Œè·¨è¡Œåˆå¹¶ï¼Œåˆ™ä¸æ”¯æŒçºµå‘è™šæ‹Ÿæ»šåŠ¨ï¼›å¦‚æœè¿›è¡Œè·¨åˆ—åˆå¹¶ï¼Œåˆ™ä¸æ”¯æŒæ¨ªå‘è™šæ‹Ÿæ»šåŠ¨</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">vxe-grid</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"gridOptions"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">vxe-grid</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> gridOptions = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">border</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">showOverflow</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">showHeaderOverflow</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">showFooterOverflow</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">showFooter</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">height</span>: <span class="hljs-number">600</span>,
  <span class="hljs-attr">virtualYConfig</span>: {
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">gt</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">virtualXConfig</span>: {
    <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">gt</span>: <span class="hljs-number">0</span>
  },
  <span class="hljs-attr">mergeCells</span>: [
    { <span class="hljs-attr">row</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">col</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">rowspan</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">colspan</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">row</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">col</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">rowspan</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">colspan</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">row</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">col</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">rowspan</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">colspan</span>: <span class="hljs-number">2</span> },
    { <span class="hljs-attr">row</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">col</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">rowspan</span>: <span class="hljs-number">18</span>, <span class="hljs-attr">colspan</span>: <span class="hljs-number">3</span> },
    { <span class="hljs-attr">row</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">col</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">rowspan</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">colspan</span>: <span class="hljs-number">2</span> }
  ],
  <span class="hljs-attr">mergeFooterItems</span>: [
    { <span class="hljs-attr">row</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">col</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">rowspan</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">colspan</span>: <span class="hljs-number">1</span> }
  ],
  <span class="hljs-attr">columns</span>: [
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">type</span>: <span class="hljs-string">'seq'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">70</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'left'</span> },
    { <span class="hljs-attr">field</span>: <span class="hljs-string">'name'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Name'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">300</span> },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ†ç»„1'</span>,
      <span class="hljs-attr">children</span>: [
        { <span class="hljs-attr">field</span>: <span class="hljs-string">'role'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Role'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">300</span> },
        { <span class="hljs-attr">field</span>: <span class="hljs-string">'sex'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Sex'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">300</span> },
        { <span class="hljs-attr">field</span>: <span class="hljs-string">'age'</span>, <span class="hljs-attr">title</span>: <span class="hljs-string">'Age'</span>, <span class="hljs-attr">minWidth</span>: <span class="hljs-number">300</span> }
      ]
    },
    {
      <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ†ç»„2'</span>,
      <span class="hljs-attr">children</span>: [
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—3'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col3'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">200</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—4'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col4'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">140</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—5'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col5'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">300</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—6'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col6'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">160</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—7'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col7'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">120</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—8'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col8'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—9'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col9'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">160</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—10'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col10'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">160</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—11'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col11'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">180</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—12'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col12'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">160</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—13'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col13'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">80</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—14'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col14'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">120</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—15'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col15'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">360</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—16'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col16'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">150</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—17'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col17'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">380</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—18'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col18'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—19'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col19'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">290</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—20'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col20'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">80</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—21'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col21'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—22'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col22'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">120</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—23'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col23'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">270</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—24'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col24'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">330</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—25'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col25'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">460</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—26'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col26'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">280</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—27'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col27'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">220</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—28'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col28'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">120</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—29'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col29'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">180</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—30'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col30'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">500</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—31'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col31'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">600</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—32'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col32'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—33'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col33'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">490</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—34'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col34'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—35'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col35'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">150</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—36'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col36'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—37'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col37'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—38'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col38'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—39'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col39'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">360</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—40'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col40'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">420</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—41'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col41'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—42'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col42'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">120</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—43'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col43'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">280</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—44'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col44'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">170</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—45'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col45'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">370</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—46'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col46'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">420</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—47'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col47'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">170</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—48'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col48'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—49'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col49'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">220</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—50'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col50'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">170</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—51'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col51'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">160</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—52'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col52'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">500</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—53'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col53'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">280</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—54'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col54'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">170</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—55'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col55'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">370</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—56'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col56'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">120</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—57'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col57'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">170</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—58'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col58'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—59'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col59'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">220</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—60'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col60'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">650</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—61'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col61'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">600</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—62'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col62'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—63'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col63'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">490</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—64'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col64'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—65'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col65'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">150</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—66'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col66'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—67'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col67'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—68'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col68'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—69'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col69'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">360</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—70'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col70'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">650</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—71'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col71'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">600</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—72'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col72'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—73'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col73'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">490</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—74'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col74'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—75'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col75'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">150</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—76'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col76'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—77'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col77'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—78'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col78'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—79'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col79'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">360</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—80'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col80'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">650</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—81'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col81'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">600</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—82'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col82'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—83'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col83'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">490</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—84'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col84'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—85'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col85'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">150</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—86'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col86'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—87'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col87'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">400</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—88'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col88'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—89'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col89'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">360</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—90'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col90'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">650</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—91'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col91'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">600</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—92'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col92'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
        { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—93'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col93'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">490</span> }
      ]
    },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—94'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col94'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—95'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col95'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">150</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—96'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col96'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">800</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—97'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col97'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—98'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col98'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">150</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—99'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col99'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">200</span> },
    { <span class="hljs-attr">title</span>: <span class="hljs-string">'åˆ—100'</span>, <span class="hljs-attr">field</span>: <span class="hljs-string">'col100'</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">fixed</span>: <span class="hljs-string">'right'</span> }
  ],
  <span class="hljs-attr">data</span>: [],
  <span class="hljs-attr">footerData</span>: [
    { <span class="hljs-attr">seq</span>: <span class="hljs-string">'åˆè®¡'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'666'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'888'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'999'</span>, <span class="hljs-attr">age</span>: <span class="hljs-string">'234'</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'453'</span> },
    { <span class="hljs-attr">seq</span>: <span class="hljs-string">'å‡å€¼'</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">'222'</span>, <span class="hljs-attr">role</span>: <span class="hljs-string">'333'</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">'777'</span>, <span class="hljs-attr">age</span>: <span class="hljs-string">'876'</span>, <span class="hljs-attr">address</span>: <span class="hljs-string">'134'</span> }
  ]
})
<span class="hljs-comment">// æ¨¡æ‹Ÿè¡Œæ•°æ®</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">loadList</span> = (<span class="hljs-params">size = <span class="hljs-number">200</span></span>) =&gt; {
  <span class="hljs-keyword">const</span> dataList = []
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; size; i++) {
    dataList.<span class="hljs-title function_">push</span>({
      <span class="hljs-attr">id</span>: <span class="hljs-number">10000</span> + i,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'Test'</span> + i,
      <span class="hljs-attr">role</span>: i % <span class="hljs-number">3</span> ? <span class="hljs-string">'Developer'</span> : <span class="hljs-string">' DeveloperDeveloper DeveloperDeveloper DeveloperDeveloper DeveloperDeveloper DeveloperDeveloper'</span>,
      <span class="hljs-attr">sex</span>: <span class="hljs-string">'ç”·'</span>,
      <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>,
      <span class="hljs-attr">address</span>: <span class="hljs-string">'Address abc'</span>,
      <span class="hljs-attr">col90</span>: <span class="hljs-string">'90-'</span> + i,
      <span class="hljs-attr">col91</span>: <span class="hljs-string">'91-'</span> + i,
      <span class="hljs-attr">col92</span>: <span class="hljs-string">'92-'</span> + i,
      <span class="hljs-attr">col93</span>: <span class="hljs-string">'93-'</span> + i,
      <span class="hljs-attr">col94</span>: <span class="hljs-string">'94-'</span> + i,
      <span class="hljs-attr">col95</span>: <span class="hljs-string">'95-'</span> + i,
      <span class="hljs-attr">col96</span>: <span class="hljs-string">'96-'</span> + i,
      <span class="hljs-attr">col97</span>: <span class="hljs-string">'97-'</span> + i,
      <span class="hljs-attr">col98</span>: <span class="hljs-string">'98-'</span> + i,
      <span class="hljs-attr">col99</span>: <span class="hljs-string">'99-'</span> + i,
      <span class="hljs-attr">col100</span>: <span class="hljs-string">'100-'</span> + i
    })
  }
  gridOptions.<span class="hljs-property">data</span> = dataList
}

<span class="hljs-title function_">loadList</span>(<span class="hljs-number">500</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fx-extends%2Fvxe-table" target="_blank" title="https://gitee.com/x-extends/vxe-table" ref="nofollow noopener noreferrer">gitee.com/x-extends/vâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2025 SECon Ã— AgentX å¤§ä¼šï¼šAI åŸç”Ÿåº”ç”¨æ¶æ„ä¸“åœºç²¾å½©å›é¡¾ & PPT ä¸‹è½½]]></title>    <link>https://juejin.cn/post/7579453456017260585</link>    <guid>https://juejin.cn/post/7579453456017260585</guid>    <pubDate>2025-12-03T08:42:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579453456017260585" data-draft-id="7579213860572381238" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2025 SECon Ã— AgentX å¤§ä¼šï¼šAI åŸç”Ÿåº”ç”¨æ¶æ„ä¸“åœºç²¾å½©å›é¡¾ &amp; PPT ä¸‹è½½"/> <meta itemprop="keywords" content="äº‘åŸç”Ÿ"/> <meta itemprop="datePublished" content="2025-12-03T08:42:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é˜¿é‡Œäº‘äº‘åŸç”Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3808363977648493"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2025 SECon Ã— AgentX å¤§ä¼šï¼šAI åŸç”Ÿåº”ç”¨æ¶æ„ä¸“åœºç²¾å½©å›é¡¾ &amp; PPT ä¸‹è½½
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3808363977648493/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é˜¿é‡Œäº‘äº‘åŸç”Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:42:22.000Z" title="Wed Dec 03 2025 08:42:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½œè€…ï¼šç›ˆæ¥¹</p>
<p>è¿‘æ—¥ï¼Œ2025 SEConÂ Ã—Â AgentXå¤§ä¼šâ€”â€”AI åŸç”Ÿåº”ç”¨æ¶æ„ä¸“åœºåœ†æ»¡è½å¹•ï¼Œæœ¬æ¬¡ä¸“åœºé˜¿é‡Œäº‘è”åˆä¿¡é€šé™¢å…±åŒå‡ºå“ï¼Œç°åœºå¸å¼•äº† 80+ åæŠ€æœ¯ä»ä¸šè€…æ·±åº¦å‚ä¸ã€‚</p>
<p>æ´»åŠ¨èšç„¦ AI æ—¶ä»£è½¯ä»¶æ¶æ„çš„æ ¸å¿ƒå‘½é¢˜ï¼Œæ·±åº¦åˆ†äº«äº† AI åŸç”Ÿåº”ç”¨æ¶æ„è¶‹åŠ¿ä¸å®è·µã€AgentScope å¼€å‘æ¡†æ¶ã€AI å¼€æ”¾å¹³å°ã€å¤§æ¨¡å‹å¯è§‚æµ‹ &amp; AIOps ç­‰çƒ­é—¨æŠ€æœ¯è®®é¢˜ï¼Œæ¢è®¨ä»åŸºç¡€è®¾æ–½åˆ°åº”ç”¨å±‚çš„ååŒæ¼”è¿›ç­–ç•¥ä¸å·¥ç¨‹å®è·µã€‚</p>
<p>å…³æ³¨ã€Œé˜¿é‡Œäº‘äº‘åŸç”Ÿã€å…¬ä¼—å·ï¼Œåå°å›å¤ï¼š1125</p>
<p>å…è´¹è·å¾—æ´»åŠ¨è®²å¸ˆ PPT åˆè¾‘</p>
<h2 data-id="heading-0">ç²¾å½©å›é¡¾</h2>
<h3 data-id="heading-1">è®®é¢˜ä¸€ï¼šAI åŸç”Ÿåº”ç”¨æ¶æ„æ¢ç´¢ä¸å®è·µä¸¨è‚–äº¬(äº¦ç›) Â  é˜¿é‡Œäº‘æ™ºèƒ½äº‘åŸç”Ÿé«˜çº§æŠ€æœ¯ä¸“å®¶</h3>
<p>å½“å‰å¤§æ¨¡å‹å·²è¿ˆè¿‡æŠ€æœ¯æ‹ç‚¹ï¼ŒAgentic AI è¿›å…¥è§„æ¨¡åŒ–è½åœ°é˜¶æ®µã€‚AI åŸç”Ÿåº”ç”¨ä»¥æ¨¡å‹ä¸ºåŸºç¡€ã€Agent ä¸ºé©±åŠ¨ã€æ•°æ®ä¸ºä¸­å¿ƒï¼Œæ¨åŠ¨ç³»ç»Ÿä»â€œæœºå™¨æ‰§è¡Œâ€å‘â€œæœºå™¨æ€è€ƒ+æ‰§è¡Œâ€æ¼”è¿›ã€‚æ¡†æ¶é€‰å‹éœ€å¹³è¡¡ Agentic è‡ªä¸»æ€§ä¸ä¸šåŠ¡ç¡®å®šæ€§ï¼ŒAgent é¢ä¸´å¼€å‘æ•ˆç‡ã€ä¸šåŠ¡æ•ˆæœï¼Œä»¥åŠç¨³å®šã€æ€§èƒ½ã€æˆæœ¬ã€å®‰å…¨çš„æŒ‘æˆ˜ã€‚å®è·µä¸Šå»ºè®®æ„å»ºä»¥æ•°æ®ä¸ºæ ¸å¿ƒçš„ Agent å¹³å°ï¼Œç»“åˆ MCP/A2A æ ‡å‡†ä¸ Serverless æ¶æ„ï¼Œé€šè¿‡ AI ç½‘å…³ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å¯è§‚æµ‹ç­‰æå‡å®‰å…¨æ€§ã€ç¨³å®šæ€§ä¸å¯ç»´æŠ¤æ€§ï¼Œå®ç°æ™ºèƒ½åŒ–äººæœºåä½œæ–°èŒƒå¼ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea152df061df4e339245bc2856ea732d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356142&amp;x-signature=jY5DmIePKyEhkFFgtGJntTGhRBY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-2">è®®é¢˜äºŒï¼šå¼€å‘æ›´å¯æ§ï¼Œéƒ¨ç½²æ›´ä¾¿æ·ï¼šAgentScope è¿ˆå…¥ 1.0 æ—¶ä»£ä¸¨é‚ç‚œç‘ Â é˜¿é‡Œå·´å·´é›†å›¢é€šä¹‰å®éªŒå®¤ é«˜çº§ç®—æ³•å·¥ç¨‹å¸ˆ</h3>
<p>æ·±åº¦åˆ†äº«äº†é˜¿é‡Œé€šä¹‰å®éªŒå®¤å¼€æºçš„ AgentScope æ™ºèƒ½ä½“å¼€å‘æ¡†æ¶ 1.0 ç‰ˆæœ¬ã€‚æ ¸å¿ƒå†…å®¹åŒ…æ‹¬ï¼šåŸºäº ReAct èŒƒå¼çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿæ”¯æŒï¼Œæä¾›ç»“æ„åŒ–è¾“å‡ºã€å·¥å…·è°ƒç”¨ä¸é•¿æœŸè®°å¿†ç­‰èƒ½åŠ›ï¼›é‡‡ç”¨ä¸‰å±‚æ¶æ„â€”â€”å¼€å‘æ¡†æ¶å±‚ã€å¯è§†åŒ–è°ƒè¯•å¹³å°ä¸å®‰å…¨è¿è¡Œæ—¶ç¯å¢ƒï¼Œç»“åˆå·¥å…·æ²™ç®±ä¸å…ƒå·¥å…·æœºåˆ¶ï¼Œå…¨é¢æå‡ç³»ç»Ÿçš„å¯æ§æ€§ã€å¯è§‚æµ‹æ€§ä¸éƒ¨ç½²å®‰å…¨æ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fa960187303425ab4b75c45eba2a315~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356142&amp;x-signature=sC5gQdpPus3neRelbmjRnkNxZAo%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-3">è®®é¢˜ä¸‰ï¼šAI ç½‘å…³ï¼šAI åŸç”Ÿæ¶æ„ä¸‹çš„æ™ºèƒ½æµé‡ä¸­æ¢ä¸¨Â èµµç‚³å ƒ(ç§‰é’§) Â  é˜¿é‡Œäº‘æ™ºèƒ½äº‘åŸç”Ÿé«˜çº§å¼€å‘å·¥ç¨‹å¸ˆ</h3>
<p>èšç„¦ AI ç½‘å…³åœ¨ AI åŸç”Ÿæ¶æ„ä¸­çš„æ ¸å¿ƒä½œç”¨ï¼Œé‡ç‚¹ä»‹ç» Higress AI ç½‘å…³çš„å…³é”®èƒ½åŠ›ï¼šæ”¯æŒå¤šæ¨¡å‹é€‚é…ã€åè®®è½¬æ¢ä¸è¯­ä¹‰ç¼“å­˜ï¼Œæä¾› Token é™æµã€Fallback æœºåˆ¶ä¿éšœé«˜å¯ç”¨ï¼›é€šè¿‡ API-Key ç®¡ç†ã€PII è„±æ•ã€WASM æ²™ç®±ç­‰å®ç°å®‰å…¨å¯æ§ï¼›å¹¶å€ŸåŠ© MCPServer ç»Ÿä¸€ä»£ç†æå‡é›†æˆæ•ˆç‡ã€‚HiMarket å¹³å°åˆ™åŠ©åŠ›ä¼ä¸šæ„å»ºç§æœ‰ Agent å¸‚åœºï¼Œæ¨åŠ¨ AI èƒ½åŠ›çš„å®‰å…¨è§„æ¨¡åŒ–è½åœ°ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2f6a2162c2a04687b59e1f9422c32e10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356142&amp;x-signature=hqekz6Jlpn8TxEWekzbyHf3kefg%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h3 data-id="heading-4">è®®é¢˜å››ï¼šä»å¯è§‚æµ‹åˆ° RLï¼šæ‰“é€ ç”Ÿäº§çº§å¯é çš„é•¿å‘¨æœŸ Agentä¸¨é©¬äº‘é›· Â é˜¿é‡Œäº‘æ™ºèƒ½äº‘åŸç”ŸæŠ€æœ¯ä¸“å®¶</h3>
<p>èšç„¦ AI-Native åº”ç”¨ä¸­é•¿å‘¨æœŸ Agent çš„å¯é æ€§å»ºè®¾ï¼Œæå‡ºä»¥å¯è§‚æµ‹æ€§ä¸ºåŸºç¡€ï¼Œé€šè¿‡ OpenTelemetryã€Prometheus ç­‰å·¥å…·å®ç°å…¨æ ˆç›‘æ§ï¼Œåšåˆ°â€œå¯è§ã€å¯è°ƒã€å¯å®¡â€ã€‚å¼•å…¥ LLM Judger ä½œä¸ºè‡ªåŠ¨åŒ–è¯„ä¼°è£åˆ¤ï¼Œç»“åˆæ•°æ®å·¥ç¨‹ä¸æ¨¡å‹è’¸é¦ï¼Œæ„å»ºå¿«æ…¢åé¦ˆé—­ç¯ã€‚æœ€ç»ˆå½¢æˆä»é—®é¢˜å‘ç°ã€æ ¹å› åˆ†æåˆ°è‡ªæˆ‘å¼ºåŒ–çš„è¿›åŒ–ç³»ç»Ÿï¼Œæ¨åŠ¨ Agent å‘é«˜å¯é ã€è‡ªæ¼”è¿›çš„ç”Ÿäº§çº§åº”ç”¨å‘å±•ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ad061b319a149d48f32fca63cf20d79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356142&amp;x-signature=x9x%2BPT7fAq1zLE6Tyd9cpCHXDiY%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-5">ç°åœºç²¾å½©ç¬é—´</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e70dd5c0e9a8469ca6c5d29ad53c3e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356142&amp;x-signature=NKOGl9Ul7FXv9U3uoo6YG17d9X8%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/064da6f1678c432c9a82dfe639aa6083~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356142&amp;x-signature=ceeq4eP7VxrfkEQlFkcYR4mMzLQ%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38056102f55f4342869e064202875dce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6Zi_6YeM5LqR5LqR5Y6f55Sf:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356142&amp;x-signature=cFiiUZ3dOEoI%2BuGLJkk1%2Fhk%2F1RE%3D" alt="å›¾ç‰‡" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Letâ€™s Encrypt è¯ä¹¦æœ‰æ•ˆæœŸå°†ç¼©è‡³ 45 å¤©ï¼Œè¿ç»´å¤©éƒ½å¡Œäº†]]></title>    <link>https://juejin.cn/post/7579410911057412122</link>    <guid>https://juejin.cn/post/7579410911057412122</guid>    <pubDate>2025-12-03T08:45:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579410911057412122" data-draft-id="7579440586693673006" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Letâ€™s Encrypt è¯ä¹¦æœ‰æ•ˆæœŸå°†ç¼©è‡³ 45 å¤©ï¼Œè¿ç»´å¤©éƒ½å¡Œäº†"/> <meta itemprop="keywords" content="HTTPS,è¿ç»´,è‡ªåŠ¨åŒ–è¿ç»´"/> <meta itemprop="datePublished" content="2025-12-03T08:45:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨"/> <meta itemprop="url" content="https://juejin.cn/user/64217584778579"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Letâ€™s Encrypt è¯ä¹¦æœ‰æ•ˆæœŸå°†ç¼©è‡³ 45 å¤©ï¼Œè¿ç»´å¤©éƒ½å¡Œäº†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/64217584778579/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¯¥ç”¨æˆ·å·²ä¸å­˜åœ¨
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:45:31.000Z" title="Wed Dec 03 2025 08:45:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿‘æ—¥ï¼Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fletsencrypt.org%2F2025%2F12%2F02%2Ffrom-90-to-45" target="_blank" title="https://letsencrypt.org/2025/12/02/from-90-to-45" ref="nofollow noopener noreferrer">Letâ€™s Encrypt å®˜æ–¹æ­£å¼å‘å¸ƒå…¬å‘Š</a>ï¼Œä¸ºäº†ç¬¦åˆ CA/æµè§ˆå™¨è®ºå›ï¼ˆCA/Browser Forumï¼‰çš„æœ€æ–°åŸºå‡†è¦æ±‚ï¼Œå¹¶å°†äº’è”ç½‘å®‰å…¨æ€§æ¨å‘æ–°é«˜åº¦ï¼Œå°†é€æ­¥ç¼©çŸ­å…¶ç­¾å‘çš„ TLS/SSL è¯ä¹¦æœ‰æ•ˆæœŸã€‚</p>
<p>ç›®å‰çš„ 90 å¤©æœ‰æ•ˆæœŸï¼Œå°†åœ¨æœªæ¥å‡ å¹´å†…é€æ­¥å‡åŠã€‚<strong>åˆ° 2028 å¹´ï¼Œå…è´¹è¯ä¹¦æœ‰æ•ˆæœŸå°†ä»…å‰© 45 å¤©ã€‚</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/522cd71c9067446eac6543bc3a95ef73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356495&amp;x-signature=%2B5RhWXT2xAVccTN3iCOVIU8NTvU%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-0">ä¸ºä»€ä¹ˆè¦ç¼©çŸ­æœ‰æ•ˆæœŸï¼Ÿ</h3>
<p>è¿™å¹¶é Letâ€™s Encrypt ä¸€å®¶çš„å†³å®šï¼Œè€Œæ˜¯æ•´ä¸ªè¡Œä¸šçš„è¶‹åŠ¿ã€‚å®˜æ–¹ç»™å‡ºäº†3ä¸ª<del>å€Ÿå£</del>ç†ç”±</p>
<ol>
<li>
<p><strong>å®‰å…¨æ€§æå‡ï¼š</strong> ç¼©çŸ­è¯ä¹¦æœ‰æ•ˆæœŸå¯ä»¥é™åˆ¶å¯†é’¥æ³„éœ²åçš„å½±å“èŒƒå›´ã€‚å¦‚æœç§é’¥è¢«ç›—ï¼Œè¾ƒçŸ­çš„æœ‰æ•ˆæœŸè®©æ”»å‡»è€…åˆ©ç”¨è¯¥å¯†é’¥çš„æ—¶é—´çª—å£æ›´çŸ­ã€‚</p>
</li>
<li>
<p><strong>æé«˜åŠé”€æ•ˆç‡ï¼š</strong> æ›´çŸ­çš„ç”Ÿå‘½å‘¨æœŸè®©è¯ä¹¦åŠé”€æŠ€æœ¯ï¼ˆCertificate Revocationï¼‰æ›´æœ‰æ•ˆç‡ï¼ŒåŒæ—¶ä¹Ÿè¿«ä½¿è‡ªåŠ¨åŒ–æµç¨‹æ›´åŠ å¥å£®ã€‚</p>
</li>
<li>
<p><strong>è¡Œä¸šåˆè§„ï¼š</strong> è¿™æ˜¯æ‰€æœ‰å…¬å…±ä¿¡ä»»çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰éƒ½å¿…é¡»éµå¾ªçš„æŠ€æœ¯è¦æ±‚å˜åŒ–ã€‚</p>
</li>
</ol>
<h3 data-id="heading-1">å…³é”®æ—¶é—´è½´</h3>
<p>ä¸ºäº†è®©è¿ç»´äººå‘˜é€‚åº”è¿™äº›å˜åŒ–ï¼ŒLetâ€™s Encrypt ç»™åˆ¶å®šäº†è¯¦ç»†çš„è®¡åˆ’ï¼ˆStaging ç¯å¢ƒä¼šæå‰ä¸€ä¸ªæœˆç”Ÿæ•ˆï¼‰ã€‚</p>
<ul>
<li>
<p><strong>2026 å¹´ 5 æœˆ 13 æ—¥ï¼š</strong> <code>tlsserver</code> é…ç½®æ–‡ä»¶ç‡å…ˆåˆ‡æ¢è‡³ 45 å¤©æœ‰æ•ˆæœŸï¼ˆç”¨äºæµ‹è¯•ï¼‰ã€‚</p>
</li>
<li>
<p><strong>2027 å¹´ 2 æœˆ 10 æ—¥ï¼š</strong> é»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸç¼©çŸ­è‡³ 64 å¤©ã€‚åŸŸåéªŒè¯çš„ã€Œæˆæƒå¤ç”¨æœŸã€ç¼©çŸ­è‡³ 10 å¤©ã€‚</p>
</li>
<li>
<p><strong>2028 å¹´ 2 æœˆ 16 æ—¥ï¼š</strong> é»˜è®¤è¯ä¹¦æœ‰æ•ˆæœŸå…¨é¢ç¼©çŸ­è‡³ 45 å¤©ã€‚ã€Œæˆæƒå¤ç”¨æœŸã€å¤§å¹…ç¼©çŸ­è‡³ 7 å°æ—¶ã€‚</p>
</li>
</ul>
<h3 data-id="heading-2">è‹¦é€¼çš„è¿ç»´ä½•å¤„ä½•ä»ï¼Ÿ</h3>
<p>å¦‚æœä½ çš„è¯ä¹¦æ˜¯å…¨è‡ªåŠ¨ç»­æœŸçš„ï¼Œå¤§éƒ¨åˆ†ç”¨æˆ·å¯èƒ½ä¸éœ€è¦åšå¤ªå¤šæ”¹åŠ¨ï¼Œä½†ä¸ºäº†é¿å…æœªæ¥å¯èƒ½ä¼šé­é‡æœåŠ¡ä¸­æ–­ï¼Œè¿˜æ˜¯éœ€è¦ä»”ç»†åœ°æ£€æŸ¥ã€‚</p>
<h4 data-id="heading-3"><strong>æ£€æŸ¥ç»­æœŸé¢‘ç‡</strong></h4>
<p>å¾ˆå¤šæ—§çš„è‡ªåŠ¨åŒ–è„šæœ¬æˆ– Cron Job æ˜¯ç¡¬ç¼–ç çš„ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®æ¯ 60 å¤©è¿è¡Œä¸€æ¬¡ <code>certbot renew</code>ï¼Œé‚£ä¹ˆåœ¨ 2028 å¹´ï¼ˆç”šè‡³ 2027 å¹´ï¼‰ï¼Œä½ çš„è¯ä¹¦åœ¨ç»­æœŸå‰å°±å·²ç»è¿‡æœŸäº†ã€‚</p>
<p><strong>å»ºè®®ï¼š</strong> ç¡®ä¿ä½ çš„ ACME å®¢æˆ·ç«¯æ”¯æŒåœ¨è¯ä¹¦ç”Ÿå‘½å‘¨æœŸçš„ <strong>2/3</strong> å¤„è¿›è¡Œç»­æœŸï¼ˆå³ 45 å¤©è¯ä¹¦åº”åœ¨ç¬¬ 30 å¤©å·¦å³ç»­æœŸï¼‰ã€‚</p>
<h4 data-id="heading-4"><strong>å¯ç”¨ ARIï¼ˆACME Renewal Informationï¼‰</strong></h4>
<p>Letâ€™s Encrypt æ¨èä½¿ç”¨æ”¯æŒ ARI çš„å®¢æˆ·ç«¯ã€‚ARI æ˜¯ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œèƒ½è®©æœåŠ¡å™¨å‘ŠçŸ¥å®¢æˆ·ç«¯ã€Œæœ€ä½³çš„ç»­æœŸæ—¶é—´ã€ï¼Œè€Œä¸æ˜¯ä¾èµ–å®¢æˆ·ç«¯è‡ªå·±çŒœæµ‹ï¼Œè¿™èƒ½æœ‰æ•ˆé¿å…ç»­æœŸæ‹¥å µå’Œå¤±è´¥ã€‚</p>
<h4 data-id="heading-5"><strong>åˆ«å†æ‰‹åŠ¨ç»­æœŸäº†</strong></h4>
<p>å¦‚æœä½ çš„ç½‘ç«™è¿˜åœ¨é äººå·¥æ‰‹åŠ¨ä¸Šä¼ è¯ä¹¦ï¼Œè¿™æ¬¡å˜é©å°†æ˜¯å™©æ¢¦ã€‚éšç€æœ‰æ•ˆæœŸç¼©çŸ­ï¼Œæ‰‹åŠ¨æ“ä½œçš„é¢‘ç‡å°†ç¿»å€ï¼Œå‡ºé”™æ¦‚ç‡ä¹Ÿä¼šå¢åŠ ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f028a4c5cc84f9db360102498d1cd8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356495&amp;x-signature=1zLDyO2iGc89Wlwr08thTI8nqxE%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-6">æ–°çš„ DNS éªŒè¯æ–¹å¼æ¥äº†</h3>
<p>å¥½æ¶ˆæ¯æ˜¯ï¼ŒLetâ€™s Encrypt æ­£ä¸ IETF å’Œ CA/æµè§ˆå™¨è®ºå›åˆä½œï¼Œæ¨åŠ¨ä¸€ç§æ–°çš„éªŒè¯æ ‡å‡†ï¼š<strong>DNS-PERSIST-01</strong>ã€‚</p>
<ul>
<li>
<p>ç›®å‰çš„ DNS-01 éªŒè¯éœ€è¦ ACME å®¢æˆ·ç«¯æœ‰æƒé™åŠ¨æ€ä¿®æ”¹ DNS è®°å½•ï¼ˆæ·»åŠ  TXT è®°å½•ï¼‰ï¼Œè¿™é€šå¸¸éœ€è¦ç»™è„šæœ¬å¼€æ”¾æ•æ„Ÿçš„ API æƒé™ï¼Œå­˜åœ¨å®‰å…¨éšæ‚£ï¼Œä¸”ä¾èµ– DNS æœåŠ¡å•†çš„ API ç¨³å®šæ€§ã€‚</p>
</li>
<li>
<p><code>DNS-PERSIST-01</code> å…è®¸è®¾ç½®ä¸€ä¸ª<strong>é™æ€çš„ DNS TXT è®°å½•</strong>ã€‚</p>
</li>
</ul>
<p>è¿™ä¸€æ–°åŠŸèƒ½é¢„è®¡å°†åœ¨ <strong>2026 å¹´</strong> ä¸Šçº¿ï¼Œå±Šæ—¶å°†æå¤§åœ°ç®€åŒ–è‡ªåŠ¨åŒ–ç»­æœŸçš„é…ç½®éš¾åº¦ã€‚</p>
<h3 data-id="heading-7">è‡ªåŠ¨åŒ–ä¹Ÿä¸æ˜¯ä¸€åŠ³æ°¸é€¸</h3>
<p>è™½ç„¶ä½†æ˜¯ï¼ŒACME ç­–ç•¥åœ¨å®é™…è½åœ°ä¸­å¯èƒ½ä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ã€‚</p>
<ul>
<li>
<p><strong>ç¯å¢ƒè„†å¼±æ€§ï¼š</strong> æ“ä½œç³»ç»Ÿå‡çº§æˆ– <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Ffeatures%2Fpython" target="_blank" title="https://www.servbay.com/features/python" ref="nofollow noopener noreferrer">Python ç¯å¢ƒ</a>å˜åŠ¨ï¼Œå¸¸å¯¼è‡´ Certbot ç­‰å·¥å…·çªç„¶å¤±æ•ˆã€‚</p>
</li>
<li>
<p><strong>å®‰å…¨éšæ‚£ï¼š</strong> ä¸ºäº†è‡ªåŠ¨é€šè¿‡ DNS éªŒè¯ï¼Œé€šå¸¸éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šä¿å­˜ DNS æœåŠ¡å•†çš„é«˜æƒé™ API Keyï¼Œè¿™å¢åŠ äº†æœåŠ¡å™¨è¢«æ”»é™·åçš„è¿å¸¦é£é™©ã€‚</p>
</li>
<li>
<p><strong>å¤æ‚æ¶æ„éš¾é¢˜ï¼š</strong> åœ¨ CDNã€è´Ÿè½½å‡è¡¡æˆ–å†…ç½‘ç¯å¢ƒä¸­ï¼Œè‡ªåŠ¨åŒ–åˆ†å‘è¯ä¹¦çš„è„šæœ¬ç¼–å†™éš¾åº¦æå¤§ï¼Œç»´æŠ¤æˆæœ¬é«˜æ˜‚ã€‚</p>
</li>
<li>
<p><strong>æ–°è§„å†²å‡»ï¼š</strong> æœ€è¦å‘½çš„æ˜¯ï¼Œéšç€æˆæƒå¤ç”¨æœŸç¼©çŸ­è‡³ <strong>7 å°æ—¶</strong>ï¼Œç»­æœŸå¯¹å¤–éƒ¨ APIï¼ˆå¦‚ DNS æä¾›å•†ï¼‰ç¨³å®šæ€§çš„ä¾èµ–åº¦æé«˜ï¼Œä»»ä½•ä¸€æ¬¡ç½‘ç»œæŠ–åŠ¨éƒ½å¯èƒ½å¯¼è‡´ç»­æœŸå¤±è´¥ã€‚</p>
</li>
</ul>
<p>å¦‚æœä¸æƒ³èŠ±è´¹ç²¾åŠ›å»ç»´æŠ¤è¿™äº›å¤æ‚çš„è„šæœ¬ï¼Œä¹Ÿä¸æƒ³æ¯éš” 45 å¤©å°±æ‹…å¿ƒä¸€æ¬¡è¯ä¹¦æ˜¯å¦æ›´æ–°æˆåŠŸï¼Œé‚£èŠ±ç‚¹é’±ä¹°ä¸ª 1 å¹´æœŸçš„å•†ä¸šè¯ä¹¦æˆ–è®¸æ˜¯ç›®å‰æœ€çœå¿ƒçš„äº†ã€‚</p>
<h3 data-id="heading-8">å•†ä¸šè¯ä¹¦æ˜¯æ›´å¥½çš„é€‰æ‹©</h3>
<p>è¿‘æœŸï¼Œå¼€å‘å·¥å…·æä¾›å•† ServBay ä¸Šçº¿äº†å…¶èµ„æºå•†åº—ï¼Œå¹¶æä¾›äº†ä¸€é¡¹é’ˆå¯¹å¼€å‘è€…çš„æ”¯æŒè®¡åˆ’ã€‚</p>
<h4 data-id="heading-9"><strong>ServBay SSL èµ„æºæ¦‚è§ˆ</strong></h4>
<ul>
<li>
<p><strong>å…è´¹é¢†å–ï¼š</strong> å¹³å°æä¾›äº† 1000 å¼  1 å¹´æœŸ DV SSL è¯ä¹¦ã€‚åŸºäº Certum æ ¹è¯ä¹¦ï¼Œå…¼å®¹æ€§å¥½ï¼Œé¢†å–åé…ç½®ä¸€æ¬¡å³å¯ç®¡ä¸€å¹´ï¼Œæ— éœ€ä»»ä½•è‡ªåŠ¨åŒ–è„šæœ¬ã€‚</p>
</li>
<li>
<p><strong>ä½æˆæœ¬è®¢é˜…ï¼š</strong> å¦‚æœéœ€è¦å¤šå¼ è¯ä¹¦ï¼Œä¹Ÿå¯ä»¥å•ç‹¬è´­ä¹°ï¼Œä»–ä»¬çš„å®šä»·å¯ä»¥è¯´æ˜¯éå¸¸é¡¶äº†ï¼ˆå•åŸŸåç‰ˆ Â¥29 /å¹´ï¼Œé€šé…ç¬¦ç‰ˆ Â¥ 256 /å¹´ï¼‰ã€‚</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8aeb58833a644521b3bc75351b7f8da1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356495&amp;x-signature=Vob4frFZEnhLB7CTuvkoCJ3TE3s%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å¦‚ä½•è·å–ï¼š</strong></p>
<ul>
<li>è®¿é—® <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.servbay.com%2Fstore" target="_blank" title="https://www.servbay.com/store" ref="nofollow noopener noreferrer">ServBay å®˜ç½‘è¿›å…¥ã€Œå•†åº—ã€</a>æ¿å—å³å¯æŸ¥çœ‹ã€‚æœ€ä¸‹æ–¹çš„å°±æœ‰å…è´¹çš„ä¸€å¹´æœŸè¯ä¹¦å¯ä»¥é¢†å–ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b6988248c9ea4990befc23609942850d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6K-l55So5oi35bey5LiN5a2Y5Zyo:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356495&amp;x-signature=Lf6gPTlFP1pPHIMkZSet2OZIfUQ%3D" alt="" loading="lazy"/></p>
<p>å¯¹äºè¿½æ±‚ç¨³å®šã€å¸Œæœ›å‡å°‘è¿ç»´å¹²æ‰°çš„ä¸ªäººå¼€å‘è€…æˆ–ä¸­å°å›¢é˜Ÿï¼Œè¿™ä¸å¤±ä¸ºä¸€ä¸ªé«˜æ€§ä»·æ¯”çš„ Plan Bã€‚</p>
<hr/>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p>HTTPS è¯ä¹¦æœ‰æ•ˆæœŸçš„ç¼©çŸ­æ˜¯ä¸å¯é€†è½¬çš„å®‰å…¨è¶‹åŠ¿ã€‚è™½ç„¶ 2028 å¹´å¬èµ·æ¥è¿˜å¾ˆé¥è¿œï¼Œä½†å¯¹äºè´Ÿè´£åŸºç¡€è®¾æ–½çš„è¿ç»´äººå‘˜æ¥è¯´ï¼Œç°åœ¨å°±å¼€å§‹æ£€æŸ¥è‡ªåŠ¨åŒ–è„šæœ¬çš„å…¼å®¹æ€§æ˜¯å¿…è¦çš„ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å°±åœ°ç¼–è¾‘åŠŸèƒ½å¼€å‘æŒ‡å—ï¼šä»ä»£ç åˆ°ä½“éªŒçš„ä¼˜é›…èœ•å˜]]></title>    <link>https://juejin.cn/post/7579190764766363688</link>    <guid>https://juejin.cn/post/7579190764766363688</guid>    <pubDate>2025-12-02T14:39:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579190764766363688" data-draft-id="7579088065697103912" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å°±åœ°ç¼–è¾‘åŠŸèƒ½å¼€å‘æŒ‡å—ï¼šä»ä»£ç åˆ°ä½“éªŒçš„ä¼˜é›…èœ•å˜"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,ä»£ç è§„èŒƒ"/> <meta itemprop="datePublished" content="2025-12-02T14:39:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ €ç§‹666"/> <meta itemprop="url" content="https://juejin.cn/user/2566698322650307"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å°±åœ°ç¼–è¾‘åŠŸèƒ½å¼€å‘æŒ‡å—ï¼šä»ä»£ç åˆ°ä½“éªŒçš„ä¼˜é›…èœ•å˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2566698322650307/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ €ç§‹666
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T14:39:05.000Z" title="Tue Dec 02 2025 14:39:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><hr/>
<p>åœ¨ç°ä»£ Web åº”ç”¨ä¸­ï¼Œâ€œç‚¹å‡»è·³è½¬ â†’ ä¿®æ”¹è¡¨å• â†’ æäº¤è¿”å›â€è¿™ç§ä¼ ç»Ÿæ¨¡å¼æ—©å·²è¢«ç”¨æˆ·è¯Ÿç—…ã€‚å®ƒå‰²è£‚äº†ç”¨æˆ·çš„æ³¨æ„åŠ›æµï¼Œå¢åŠ äº†æ“ä½œæˆæœ¬ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œ<strong>è·³è½¬æš´æ”¿</strong>â€ã€‚è€Œ<strong>å°±åœ°ç¼–è¾‘ï¼ˆEdit in Placeï¼‰</strong> æ­£æ˜¯æ‰“ç ´è¿™ä¸€æ¡æ¢çš„å…³é”®äº¤äº’èŒƒå¼ã€‚</p>
<p>æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥å‰–æä¸€ä¸ªç»å…¸ä¸”å®ç”¨çš„ <code>EditInPlace</code> ç±»å®ç°ï¼Œä¸ä»…è®²è§£å…¶æ ¸å¿ƒé€»è¾‘ï¼Œæ›´ä»<strong>å·¥ç¨‹åŒ–è§†è§’</strong>å‡ºå‘ï¼Œè¡¥å……å¤§é‡å®æˆ˜æŠ€å·§å’Œè¿›é˜¶ä¼˜åŒ–ç­–ç•¥ï¼ŒåŠ©ä½ æ‰“é€ æ—¢ç¾è§‚åˆå¥å£®çš„å°±åœ°ç¼–è¾‘ç»„ä»¶ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€ä¸ºä»€ä¹ˆéœ€è¦å°±åœ°ç¼–è¾‘ï¼Ÿâ€”â€” ç”¨æˆ·ä½“éªŒçš„é™æœ¬å¢æ•ˆ</h2>
<h3 data-id="heading-1">1.1 ä¼ ç»Ÿç¼–è¾‘æµç¨‹çš„ç—›ç‚¹</h3>
<p>è®¾æƒ³ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>ç”¨æˆ·å‘ç°ä¸ªäººç®€ä»‹æœ‰é”™åˆ«å­—</li>
<li>ç‚¹å‡»ã€Œç¼–è¾‘èµ„æ–™ã€æŒ‰é’®</li>
<li>è·³è½¬åˆ°ç‹¬ç«‹é¡µé¢æˆ–å¼¹çª—</li>
<li>æ‰¾åˆ°å¯¹åº”å­—æ®µè¾“å…¥æ¡†</li>
<li>ä¿®æ”¹å†…å®¹</li>
<li>æ»šåŠ¨åˆ°åº•éƒ¨ç‚¹å‡»ã€Œä¿å­˜ã€</li>
<li>ç­‰å¾…æ¥å£å“åº” &amp; é¡µé¢åˆ·æ–°</li>
<li>è¿”å›åŸé¡µç¡®è®¤ä¿®æ”¹ç»“æœ</li>
</ul>
<p>æ•´ä¸ªè¿‡ç¨‹æ¶‰åŠ <strong>7+ æ­¥éª¤</strong>ï¼Œå…¶ä¸­åŒ…å«å¤šæ¬¡è§†è§‰ç„¦ç‚¹åˆ‡æ¢ä¸ç­‰å¾…æ—¶é—´ã€‚ç ”ç©¶è¡¨æ˜ï¼šæ¯å¢åŠ ä¸€æ­¥æ“ä½œï¼Œç”¨æˆ·å®Œæˆç‡ä¸‹é™çº¦ 20%ï¼ˆBaymard Instituteï¼‰ã€‚è€Œå°±åœ°ç¼–è¾‘å¯ä»¥å°†å…¶å‹ç¼©ä¸ºï¼š</p>
<blockquote>
<p><strong>ç‚¹å‡» â†’ è¾“å…¥ â†’ å›è½¦/ç‚¹å‡»ä¿å­˜</strong></p>
</blockquote>
<p>ä¸‰æ­¥é—­ç¯ï¼ŒçœŸæ­£å®ç°â€œæ‰€è§å³æ‰€æ”¹â€ã€‚</p>
<h3 data-id="heading-2">1.2 å°±åœ°ç¼–è¾‘çš„æ ¸å¿ƒä»·å€¼</h3>






























<table><thead><tr><th>ç»´åº¦</th><th>ä¼ ç»Ÿæ–¹å¼</th><th>å°±åœ°ç¼–è¾‘</th></tr></thead><tbody><tr><td>æ“ä½œè·¯å¾„é•¿åº¦</td><td>é•¿ï¼ˆå¤šè·³è½¬ï¼‰</td><td>æçŸ­ï¼ˆé›¶è·³è½¬ï¼‰</td></tr><tr><td>æ³¨æ„åŠ›ä¸­æ–­</td><td>å¼ºï¼ˆä¸Šä¸‹æ–‡ä¸¢å¤±ï¼‰</td><td>å¼±ï¼ˆä¿æŒèšç„¦ï¼‰</td></tr><tr><td>å¼€å‘å¤æ‚åº¦</td><td>ä¸­ç­‰ï¼ˆéœ€ç»´æŠ¤å®Œæ•´è¡¨å•ï¼‰</td><td>è¾ƒé«˜ï¼ˆçŠ¶æ€ç®¡ç† + å®æ—¶åé¦ˆï¼‰</td></tr><tr><td>ç”¨æˆ·æ»¡æ„åº¦</td><td>ä¸€èˆ¬</td><td>é«˜ï¼ˆæµç•…è‡ªç„¶ï¼‰</td></tr></tbody></table>
<blockquote>
<p>âœ… ç»“è®ºï¼š<strong>å‡å°‘è®¤çŸ¥è´Ÿè·ï¼Œæå‡æ“ä½œæ•ˆç‡ï¼Œå¢å¼ºäº§å“è´¨æ„Ÿ</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-3">äºŒã€é¢å‘å¯¹è±¡è®¾è®¡ï¼šæ„å»ºå¯å¤ç”¨çš„ <code>EditInPlace</code> ç±»</h2>
<p>æˆ‘ä»¬å°†é‡‡ç”¨ç»å…¸çš„ JavaScript æ„é€ å‡½æ•° + åŸå‹æ¨¡å¼æ¥å°è£…è¿™ä¸ªç»„ä»¶ï¼Œå…¼é¡¾å…¼å®¹æ€§ä¸ç»“æ„æ¸…æ™°åº¦ã€‚</p>
<h3 data-id="heading-4">2.1 ç±»çš„åŸºæœ¬éª¨æ¶</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * å°±åœ°ç¼–è¾‘ç»„ä»¶æ„é€ å™¨
 * <span class="hljs-doctag">@class</span> <span class="hljs-variable">EditInPlace</span>
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">id</span> - å…ƒç´ å”¯ä¸€æ ‡è¯†
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">value</span> - åˆå§‹æ˜¾ç¤ºå€¼
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">HTMLElement</span>} <span class="hljs-variable">parentElement</span> - å®¹å™¨æŒ‚è½½ç‚¹
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">options</span> - é…ç½®é¡¹ï¼ˆæ‰©å±•ç”¨ï¼‰
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">EditInPlace</span>(<span class="hljs-params">id, value, parentElement, options = {}</span>) {
  <span class="hljs-comment">// æ ¸å¿ƒå±æ€§</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value || <span class="hljs-string">'è¿™ä¸ªå®¶ä¼™å¾ˆæ‡’ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ç•™ä¸‹'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentElement</span> = parentElement;

  <span class="hljs-comment">// DOM å¼•ç”¨ç¼“å­˜ï¼ˆé¿å…é‡å¤æŸ¥è¯¢ï¼‰</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span> = <span class="hljs-literal">null</span>;     <span class="hljs-comment">// å±•ç¤ºæ€æ–‡æœ¬</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span> = <span class="hljs-literal">null</span>;      <span class="hljs-comment">// ç¼–è¾‘æ€è¾“å…¥æ¡†</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span> = <span class="hljs-literal">null</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span> = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// é…ç½®é¡¹åˆå¹¶</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>({
    <span class="hljs-attr">tagName</span>: <span class="hljs-string">'span'</span>,           <span class="hljs-comment">// åŒ…è£¹æ ‡ç­¾ç±»å‹</span>
    <span class="hljs-attr">inputType</span>: <span class="hljs-string">'text'</span>,         <span class="hljs-comment">// è¾“å…¥æ¡†ç±»å‹</span>
    <span class="hljs-attr">maxLength</span>: <span class="hljs-number">100</span>,            <span class="hljs-comment">// æœ€å¤§å­—ç¬¦é™åˆ¶</span>
    <span class="hljs-attr">placeholder</span>: <span class="hljs-string">''</span>,           <span class="hljs-comment">// è¾“å…¥æç¤º</span>
    <span class="hljs-attr">autoSave</span>: <span class="hljs-literal">false</span>,           <span class="hljs-comment">// æ˜¯å¦å¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼ˆå¤±ç„¦å³ä¿å­˜ï¼‰</span>
    <span class="hljs-attr">debounceTime</span>: <span class="hljs-number">300</span>,         <span class="hljs-comment">// é˜²æŠ–å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰</span>
    <span class="hljs-attr">onSave</span>: <span class="hljs-literal">null</span>,              <span class="hljs-comment">// ä¿å­˜å›è°ƒ (value) =&gt; Promise</span>
    <span class="hljs-attr">onCancel</span>: <span class="hljs-literal">null</span>             <span class="hljs-comment">// å–æ¶ˆå›è°ƒ</span>
  }, options);

  <span class="hljs-comment">// åˆå§‹åŒ–</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createElement</span>();
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">attachEvents</span>();
}
</code></pre>
<p>ğŸ“Œ <strong>è®¾è®¡äº®ç‚¹è§£æ</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>Object.assign</code> æ”¯æŒçµæ´»é…ç½®ï¼Œä¾¿äºåæœŸæ‰©å±•</li>
<li>DOM å¼•ç”¨é¢„å­˜ï¼Œæé«˜æ€§èƒ½</li>
<li>å›è°ƒå‡½æ•°é¢„ç•™é’©å­ï¼Œæ”¯æŒä¸šåŠ¡å±‚ä»‹å…¥ï¼ˆå¦‚è°ƒç”¨ APIï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-5">ä¸‰ã€DOM åˆ›å»ºï¼šé«˜æ•ˆæ„å»º UI ç»“æ„</h2>
<h3 data-id="heading-6">3.1 åˆ›å»ºæ–¹æ³•è¯¦è§£</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">EditInPlace</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">createElement</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;

  <span class="hljs-comment">// ã€1ã€‘åˆ›å»ºæœ€å¤–å±‚å®¹å™¨</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span>.<span class="hljs-property">className</span> = <span class="hljs-string">'eip-container'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span>.<span class="hljs-property">id</span> = <span class="hljs-string">`eip-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.id}</span>`</span>;

  <span class="hljs-comment">// ã€2ã€‘åˆ›å»ºé™æ€å±•ç¤ºå…ƒç´ </span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">tagName</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>.<span class="hljs-property">className</span> = <span class="hljs-string">'eip-static'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">cursor</span> = <span class="hljs-string">'pointer'</span>; <span class="hljs-comment">// æç¤ºå¯ç‚¹å‡»</span>

  <span class="hljs-comment">// ã€3ã€‘åˆ›å»ºè¾“å…¥æ¡†</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'input'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">type</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">inputType</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">className</span> = <span class="hljs-string">'eip-field'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">maxLength</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">maxLength</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">placeholder</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">placeholder</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>; <span class="hljs-comment">// é»˜è®¤éšè—</span>

  <span class="hljs-comment">// ã€4ã€‘åˆ›å»ºæ“ä½œæŒ‰é’®ç»„</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'button'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>.<span class="hljs-property">type</span> = <span class="hljs-string">'button'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>.<span class="hljs-property">className</span> = <span class="hljs-string">'eip-btn eip-save'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>.<span class="hljs-property">textContent</span> = <span class="hljs-string">'âœ”'</span>;

  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span> = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'button'</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>.<span class="hljs-property">type</span> = <span class="hljs-string">'button'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>.<span class="hljs-property">className</span> = <span class="hljs-string">'eip-btn eip-cancel'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>.<span class="hljs-property">textContent</span> = <span class="hljs-string">'âœ˜'</span>;

  <span class="hljs-comment">// æŒ‰é’®é»˜è®¤éšè—</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;

  <span class="hljs-comment">// ã€5ã€‘ç»„è£…æ‰€æœ‰å…ƒç´ </span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>);
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>);

  <span class="hljs-comment">// ã€6ã€‘æŒ‚è½½åˆ°çˆ¶å®¹å™¨</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentElement</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">containerElement</span>);

  <span class="hljs-comment">// ã€7ã€‘åˆå§‹çŠ¶æ€è®¾ç½®</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">convertToText</span>();
};
</code></pre>
<p>ğŸ”§ <strong>æœ€ä½³å®è·µå»ºè®®</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰ DOM æ“ä½œåœ¨å†…å­˜ä¸­å®Œæˆåå†ä¸€æ¬¡æ€§æ’å…¥æ–‡æ¡£ï¼ˆå‡å°‘é‡æ’é‡ç»˜ï¼‰</li>
<li>ä½¿ç”¨è¯­ä¹‰åŒ– class åç§°ï¼Œæ–¹ä¾¿åç»­ CSS æ§åˆ¶</li>
<li>è®¾ç½® <code>cursor: pointer</code> æ˜ç¡®äº¤äº’æ„å›¾</li>
</ul>
<hr/>
<h2 data-id="heading-7">å››ã€çŠ¶æ€åˆ‡æ¢æœºåˆ¶ï¼šå±•ç¤ºæ€ â†” ç¼–è¾‘æ€</h2>
<p>è¿™æ˜¯æ•´ä¸ªç»„ä»¶çš„çµé­‚æ‰€åœ¨ã€‚</p>
<h3 data-id="heading-8">4.1 å±•ç¤ºæ€ â†’ ç¼–è¾‘æ€</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">EditInPlace</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">convertToField</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;

  <span class="hljs-comment">// åŒæ­¥æœ€æ–°å€¼åˆ°è¾“å…¥æ¡†</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">value</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;

  <span class="hljs-comment">// åˆ‡æ¢æ˜¾ç¤ºçŠ¶æ€</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'inline-block'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'inline-block'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'inline-block'</span>;

  <span class="hljs-comment">// èšç„¦å¹¶é€‰ä¸­æ–‡æœ¬ï¼ˆæå‡ç¼–è¾‘ä½“éªŒï¼‰</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-title function_">focus</span>();
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-title function_">select</span>();

  <span class="hljs-comment">// è§¦å‘è¿›å…¥ç¼–è¾‘äº‹ä»¶ï¼ˆå¯ç”¨äºåŸ‹ç‚¹ï¼‰</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_triggerEvent</span>(<span class="hljs-string">'onEditStart'</span>);
};
</code></pre>
<p>ğŸ¯ <strong>ç”¨æˆ·ä½“éªŒä¼˜åŒ–ç‚¹</strong>ï¼š</p>
<ul>
<li><code>focus()</code> è‡ªåŠ¨è·å–ç„¦ç‚¹</li>
<li><code>select()</code> å…¨é€‰æ–‡æœ¬ï¼Œç”¨æˆ·å¯ç›´æ¥è¦†ç›–è¾“å…¥</li>
</ul>
<h3 data-id="heading-9">4.2 ç¼–è¾‘æ€ â†’ å±•ç¤ºæ€</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">EditInPlace</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">convertToText</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-comment">// æ›´æ–°é™æ€æ–‡æœ¬å†…å®¹</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>.<span class="hljs-property">textContent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>;

  <span class="hljs-comment">// éšè—ç¼–è¾‘ç›¸å…³å…ƒç´ </span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'none'</span>;
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">'inline'</span>;

  <span class="hljs-comment">// è§¦å‘é€€å‡ºç¼–è¾‘äº‹ä»¶</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_triggerEvent</span>(<span class="hljs-string">'onEditEnd'</span>);
};
</code></pre>
<p>ğŸ’¡ <strong>æ³¨æ„</strong>ï¼šè¿™é‡Œæ›´æ–°çš„æ˜¯ <code>textContent</code>ï¼Œé˜²æ­¢ XSS æ³¨å…¥ï¼›è‹¥éœ€å¯Œæ–‡æœ¬æ”¯æŒï¼Œè¯·ä½¿ç”¨ <code>innerHTML</code> å¹¶åšå¥½è¿‡æ»¤ã€‚</p>
<hr/>
<h2 data-id="heading-10">äº”ã€äº‹ä»¶ç»‘å®šç³»ç»Ÿï¼šè®©ç»„ä»¶â€œæ´»â€èµ·æ¥</h2>
<h3 data-id="heading-11">5.1 ä½¿ç”¨ç®­å¤´å‡½æ•°ç¡®ä¿ä¸Šä¸‹æ–‡æ­£ç¡®</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">EditInPlace</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">attachEvents</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> self = <span class="hljs-variable language_">this</span>;

  <span class="hljs-comment">// ã€1ã€‘ç‚¹å‡»é™æ€æ–‡æœ¬è¿›å…¥ç¼–è¾‘</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">staticElement</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    self.<span class="hljs-title function_">convertToField</span>();
  });

  <span class="hljs-comment">// ã€2ã€‘ä¿å­˜æŒ‰é’®</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButton</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    self.<span class="hljs-title function_">save</span>();
  });

  <span class="hljs-comment">// ã€3ã€‘å–æ¶ˆæŒ‰é’®</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">cancelButton</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
    self.<span class="hljs-title function_">cancel</span>();
  });

  <span class="hljs-comment">// ã€4ã€‘è¾“å…¥æ¡†å›è½¦ä¿å­˜ï¼ŒESC å–æ¶ˆ</span>
  <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'keydown'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Enter'</span>) {
      e.<span class="hljs-title function_">preventDefault</span>();
      self.<span class="hljs-title function_">save</span>();
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (e.<span class="hljs-property">key</span> === <span class="hljs-string">'Escape'</span>) {
      self.<span class="hljs-title function_">cancel</span>();
    }
  });

  <span class="hljs-comment">// ã€5ã€‘å¤±ç„¦è‡ªåŠ¨ä¿å­˜ï¼ˆå¯é€‰ï¼‰</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">autoSave</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fieldElement</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'blur'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> self.<span class="hljs-title function_">save</span>(), <span class="hljs-number">100</span>); <span class="hljs-comment">// å»¶è¿Ÿé¿å… cancel å†²çª</span>
    });
  }
};
</code></pre>
<p>âœ… <strong>å…³é”®ç‚¹è¯´æ˜</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰äº‹ä»¶å¤„ç†å™¨å‡ä½¿ç”¨ <strong>ç®­å¤´å‡½æ•°</strong> æˆ–é—­åŒ…æ•è· <code>self</code>ï¼Œä¿è¯ <code>this</code> æŒ‡å‘å®ä¾‹</li>
<li>æ”¯æŒé”®ç›˜å¿«æ·é”®ï¼Œæå‡å¯è®¿é—®æ€§ï¼ˆa11yï¼‰</li>
<li><code>blur</code> äº‹ä»¶åŠ  <code>setTimeout</code> æ˜¯ä¸ºäº†é˜²æ­¢ä¸ cancel æŒ‰é’®å†²çªï¼ˆç‚¹å‡» cancel ä¹Ÿä¼šè§¦å‘ blurï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-12">å…­ã€æ€»ç»“ï¼šå¥½äº¤äº’è—åœ¨ç»†èŠ‚é‡Œ</h2>
<p>å°±åœ°ç¼–è¾‘è™½æ˜¯ä¸€ä¸ªå°åŠŸèƒ½ï¼Œå´ä½“ç°äº†ç°ä»£å‰ç«¯å¼€å‘çš„æ ¸å¿ƒç†å¿µï¼š</p>
<blockquote>
<p><strong>ä»¥ç”¨æˆ·ä¸ºä¸­å¿ƒçš„è®¾è®¡ Ã— å·¥ç¨‹åŒ–çš„ä»£ç ç»„ç»‡ Ã— å¯¹ç»†èŠ‚çš„æè‡´è¿½æ±‚</strong></p>
</blockquote>
<p>é€šè¿‡æœ¬æ–‡çš„ <code>EditInPlace</code> å®ç°ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡ï¼š</p>
<ul>
<li>å¦‚ä½•ç”¨é¢å‘å¯¹è±¡æ€æƒ³å°è£…å¯å¤ç”¨ç»„ä»¶</li>
<li>DOM æ“ä½œçš„æœ€ä½³å®è·µï¼ˆæ‰¹é‡åˆ›å»ºã€å¼•ç”¨ç¼“å­˜ï¼‰</li>
<li>äº‹ä»¶ç»‘å®šä¸­çš„ <code>this</code> é™·é˜±è§„é¿</li>
<li>çŠ¶æ€ç®¡ç†ä¸äº¤äº’é—­ç¯è®¾è®¡</li>
<li>ç”¨æˆ·ä½“éªŒå±‚é¢çš„å¤šé¡¹ä¼˜åŒ–æ‰‹æ®µ</li>
</ul>
<hr/>
<p>ğŸ’¬ <strong>äº’åŠ¨è¯é¢˜</strong>ï¼šä½ åœ¨é¡¹ç›®ä¸­æ˜¯å¦‚ä½•å®ç°å°±åœ°ç¼–è¾‘çš„ï¼Ÿæœ‰æ²¡æœ‰é‡åˆ°è¿‡å¹¶å‘ä¿®æ”¹ã€æƒé™æ§åˆ¶ç­‰é—®é¢˜ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[RAG + Agent + Promptå·¥ç¨‹ä¸Š]]></title>    <link>https://juejin.cn/post/7579096485355798578</link>    <guid>https://juejin.cn/post/7579096485355798578</guid>    <pubDate>2025-12-02T13:35:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579096485355798578" data-draft-id="7579068270294188058" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="RAG + Agent + Promptå·¥ç¨‹ä¸Š"/> <meta itemprop="keywords" content="LLM"/> <meta itemprop="datePublished" content="2025-12-02T13:35:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›½å®¶ä¸ä¿æŠ¤åºŸç‰©"/> <meta itemprop="url" content="https://juejin.cn/user/1220936035210004"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            RAG + Agent + Promptå·¥ç¨‹ä¸Š
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1220936035210004/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›½å®¶ä¸ä¿æŠ¤åºŸç‰©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T13:35:38.000Z" title="Tue Dec 02 2025 13:35:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RAG + Agent + Promptå·¥ç¨‹ä¸Š</h2>
<h3 data-id="heading-1">é¦–å…ˆä»‹ç»ä¸€ä¸‹ragæ˜¯ä»€ä¹ˆå§</h3>
<p>ç›¸ä¿¡ä½ ä»¬åœ¨æ—¥å¸¸ä½¿ç”¨aiä¸­ï¼Œéƒ½ä¼šé‡åˆ°aièƒ¡è¯´å…«é“çš„æƒ…å†µï¼Œç‰¹åˆ«æ˜¯å½“æé—®ä¸€äº›æ¯”è¾ƒä¸“ä¸šçš„é—®é¢˜æ—¶ï¼Œè€Œragçš„ä½œç”¨å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„å‘é‡æ•°æ®åº“ï¼Œæ¯æ¬¡è¯¢é—®aiæ—¶å°±ä¼šå…ˆå°†æˆ‘ä»¬çš„é—®é¢˜ä¸æ•°æ®åº“ä¸­çš„æ•°æ®è¿›è¡Œä¸€ä¸ªç›¸ä¼¼æ€§æœç´¢ï¼Œå°†ç›¸ä¼¼åº¦è¾¾åˆ°ä¸€å®šæ°´å¹³æ—¶ä¾¿å°†æ”¹æ•°æ®åº“ä¸­çš„è¯¥æ®µå†…å®¹åŠ å…¥æˆ‘çš„æé—®ä¸­ä¸€èµ·ç»™å¤§æ¨¡å‹ï¼Œä»¥åšåˆ°ä¸€ä¸ªä¸°å¯Œå†…å®¹çš„æ•ˆæœ</p>
<h3 data-id="heading-2">è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šé¡¹ç›®</h3>
<p>å…ˆæ¥ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä¾‹å­è¯•è¯•æ°´</p>
<p>æˆ‘ä»¬è¦å®ç°çš„åŠŸèƒ½æ˜¯ï¼šå°†æˆ‘çš„ç®€å†ä¼ å…¥ï¼Œæˆ‘å¯ä»¥è¯¢é—®aiæœ‰å…³æˆ‘è‡ªå·±çš„é—®é¢˜ï¼Œå¹¶å¾—åˆ°æ»¡æ„çš„ç­”æ¡ˆ</p>
<p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨åˆ°æŠ€æœ¯æ ˆæ˜¯ï¼šOllama + LangChain.js + Supabaseï¼ˆpgvectorï¼‰+ Node.js</p>
<ul>
<li><strong>Ollama</strong>ï¼šä¸€ä¸ªæœ¬åœ°è¿è¡Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„å·¥å…·ï¼Œæ”¯æŒä¸€é”®ä¸‹è½½ã€è¿è¡Œå’Œç®¡ç†å¼€æºæ¨¡å‹ï¼ˆå¦‚ Llama 3ã€DeepSeekã€Nomic ç­‰ï¼‰ã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥æä¾›ä¸¤ä¸ªèƒ½åŠ›ï¼šä¸€æ˜¯é€šè¿‡ <code>nomic-embed-text</code> æ¨¡å‹ç”Ÿæˆæ–‡æœ¬çš„å‘é‡åµŒå…¥ï¼ˆembeddingï¼‰ï¼ŒäºŒæ˜¯é€šè¿‡ <code>deepseek-v3.1:671b-cloud</code> æ¨¡å‹å›ç­”ç”¨æˆ·é—®é¢˜ã€‚æ‰€æœ‰æ¨ç†éƒ½åœ¨æœ¬åœ°å®Œæˆï¼Œæ— éœ€è”ç½‘æˆ–ä»˜è´¹ã€‚</li>
<li><strong>LangChain.js</strong>ï¼šLangChain çš„ JavaScript/TypeScript å®ç°ï¼Œæ˜¯ä¸€ä¸ªä¸“ä¸ºæ„å»º LLM åº”ç”¨è®¾è®¡çš„å¼€å‘æ¡†æ¶ã€‚å®ƒæä¾›äº†æ ‡å‡†åŒ–çš„ç»„ä»¶ï¼ˆå¦‚æ–‡æ¡£åŠ è½½å™¨ã€æ–‡æœ¬åˆ†å‰²å™¨ã€å‘é‡å­˜å‚¨æ¥å£ã€æç¤ºæ¨¡æ¿ã€é“¾å¼è°ƒç”¨ç­‰ï¼‰ï¼Œè®©æˆ‘ä»¬èƒ½å¿«é€Ÿæ­å»º RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼ŒLangChain è´Ÿè´£ï¼šè¯»å– PDF ç®€å† â†’ åˆ‡åˆ†æ–‡æœ¬ â†’ è°ƒç”¨ Ollama ç”Ÿæˆ embedding â†’ å°†å‘é‡å­˜å…¥ Supabase â†’ åœ¨é—®ç­”æ—¶æ£€ç´¢ç›¸å…³ç‰‡æ®µ â†’ æ„é€ å¸¦ä¸Šä¸‹æ–‡çš„ prompt å¹¶äº¤ç”± LLM å›ç­”ã€‚å¯ä»¥è¯´ï¼Œ<strong>LangChain æ˜¯ä¸²è”æ•´ä¸ª RAG æµç¨‹çš„â€œèƒ¶æ°´â€å’Œâ€œè„šæ‰‹æ¶â€</strong> ã€‚</li>
<li><strong>Supabaseï¼ˆé›†æˆ pgvectorï¼‰</strong> ï¼šä¸€ä¸ªå¼€æºçš„ Firebase æ›¿ä»£å“ï¼Œåº•å±‚åŸºäº PostgreSQLã€‚æˆ‘ä»¬ç‰¹åˆ«å¯ç”¨äº†å®ƒçš„ <code>pgvector</code> æ‰©å±•ï¼Œä½¿å…¶å…·å¤‡<strong>å‘é‡å­˜å‚¨ä¸ç›¸ä¼¼åº¦æœç´¢</strong>èƒ½åŠ›ã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼ŒSupabase å……å½“<strong>å‘é‡æ•°æ®åº“</strong>çš„è§’è‰²ï¼šå­˜å‚¨æ¯æ®µç®€å†æ–‡æœ¬åŠå…¶å¯¹åº”çš„ 768 ç»´ embedding å‘é‡ï¼Œå¹¶é€šè¿‡è‡ªå®šä¹‰çš„ <code>match_documents</code> å‡½æ•°ï¼Œæ ¹æ®ç”¨æˆ·é—®é¢˜çš„å‘é‡å¿«é€Ÿæ£€ç´¢å‡ºæœ€ç›¸å…³çš„ç®€å†ç‰‡æ®µã€‚ç›¸æ¯”æœ¬åœ°å†…å­˜æˆ–æ–‡ä»¶å­˜å‚¨ï¼ŒSupabase æä¾›äº†æŒä¹…åŒ–ã€å¯æ‰©å±•ã€æ”¯æŒå¤æ‚æŸ¥è¯¢çš„äº‘ç«¯å‘é‡æ£€ç´¢æœåŠ¡ã€‚</li>
<li><strong>Node.js</strong>ï¼šä½œä¸ºè¿è¡Œæ—¶ç¯å¢ƒï¼Œæ”¯æ’‘æ•´ä¸ª JavaScript åº”ç”¨çš„æ‰§è¡Œï¼ŒåŒ…æ‹¬æ–‡ä»¶è¯»å–ã€HTTP è¯·æ±‚ï¼ˆä¸ Ollama å’Œ Supabase é€šä¿¡ï¼‰ã€å¼‚æ­¥æµç¨‹æ§åˆ¶ç­‰ã€‚</li>
</ul>
<h4 data-id="heading-3">LangChainç”Ÿæ€ç³»ç»Ÿ</h4>
<p>LangChain æ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œç”¨äº<strong>æ„å»ºåŸºäºå¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„åº”ç”¨ç¨‹åº</strong>ã€‚å®ƒçš„æ ¸å¿ƒç›®æ ‡æ˜¯ï¼š<strong>è®© LLM èƒ½å¤Ÿä¸å¤–éƒ¨æ•°æ®ã€å·¥å…·å’Œé€»è¾‘ç»“åˆï¼Œä»è€Œæ‰“é€ æ›´å¼ºå¤§ã€å¯æ§ã€å®ç”¨çš„ AI åº”ç”¨</strong>ã€‚</p>
<p><strong>LangChain = è®©å¤§æ¨¡å‹â€œèƒ½å¹²æ´»â€çš„è„šæ‰‹æ¶ â€”â€” æ¥æ•°æ®ã€è¿å·¥å…·ã€è®°å†å²ã€åšå†³ç­–ã€‚</strong>
LangChainä½¿è¿™äº›å¤æ‚æµç¨‹å˜å¾—ç®€å•ï¼Œè®©å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘è€Œä¸æ˜¯åº•å±‚å®ç°ç»†èŠ‚ã€‚</p>
<p><strong>1. é“¾(Chains)</strong></p>
<p>é“¾æ˜¯LangChainçš„æ ¸å¿ƒæ¦‚å¿µï¼Œå…è®¸å°†å¤šä¸ªç»„ä»¶æŒ‰ç‰¹å®šé¡ºåºç»„åˆèµ·æ¥ï¼Œå®Œæˆå¤æ‚ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">//Â ç®€å•é“¾ç¤ºä¾‹</span>
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">LLMChain</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">"langchain/chains"</span>;
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">ChatOpenAI</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">"langchain/
chat_models/openai"</span>;
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">PromptTemplate</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">"langchain/
prompts"</span>;

<span class="hljs-keyword">const</span>Â llmÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ChatOpenAI</span>({Â <span class="hljs-attr">temperature</span>:Â <span class="hljs-number">0.9</span>Â });
<span class="hljs-keyword">const</span>Â promptÂ =Â <span class="hljs-title class_">PromptTemplate</span>.<span class="hljs-title function_">fromTemplate</span>(<span class="hljs-string">"ä»€ä¹ˆ
æ˜¯{topic}?"</span>);
<span class="hljs-keyword">const</span>Â chainÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">LLMChain</span>({Â llm,Â promptÂ });
<span class="hljs-keyword">const</span>Â resultÂ =Â <span class="hljs-keyword">await</span>Â chain.<span class="hljs-title function_">call</span>({Â <span class="hljs-attr">topic</span>:Â <span class="hljs-string">"äººå·¥æ™ºèƒ½
"</span>Â });
</code></pre>
<p><strong>2. æ¨¡å‹(Models)</strong></p>
<p>LangChainæ”¯æŒå¤šç§ç±»å‹çš„æ¨¡å‹ï¼š</p>
<ul>
<li>LLMs : æ–‡æœ¬ç”Ÿæˆæ¨¡å‹</li>
<li>Chat Models : å¯¹è¯æ¨¡å‹ï¼Œæ”¯æŒç»“æ„åŒ–æ¶ˆæ¯</li>
<li>Text Embedding Models : æ–‡æœ¬åµŒå…¥æ¨¡å‹ï¼Œç”¨äºå‘é‡è¡¨ç¤º</li>
</ul>
<p><strong>3. æç¤ºè¯(Prompts)</strong></p>
<p>æä¾›æ¨¡æ¿åŒ–ç®¡ç†å’Œä¼˜åŒ–æç¤ºè¯çš„å·¥å…·ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">PromptTemplate</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">"langchain/
prompts"</span>;

<span class="hljs-keyword">const</span>Â promptÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">PromptTemplate</span>({
Â Â <span class="hljs-attr">template</span>:Â <span class="hljs-string">"è¯·ç”¨{style}é£æ ¼è§£é‡Š{topic}"</span>,
Â Â <span class="hljs-attr">inputVariables</span>:Â [<span class="hljs-string">"style"</span>,Â <span class="hljs-string">"topic"</span>]
});
</code></pre>
<p><strong>4. ç´¢å¼•(Indexes)</strong></p>
<p>ç”¨äºç»“æ„åŒ–å’Œæ£€ç´¢å¤–éƒ¨æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>Document Loaders : ä»å„ç§æ•°æ®æºåŠ è½½æ–‡æ¡£</li>
<li>Text Splitters : å°†é•¿æ–‡æœ¬åˆ†å‰²æˆå¯ç®¡ç†çš„å—</li>
<li>Vector Stores : å­˜å‚¨å’Œæ£€ç´¢å‘é‡åµŒå…¥</li>
<li>Retrievers : ä»å­˜å‚¨ä¸­æ£€ç´¢ç›¸å…³æ–‡æ¡£</li>
</ul>
<p><strong>5. è®°å¿†(Memory)</strong></p>
<p>ä¸ºé“¾å’Œä»£ç†æä¾›æŒä¹…åŒ–çŠ¶æ€ï¼Œä½¿å¯¹è¯å…·æœ‰ä¸Šä¸‹æ–‡æ„ŸçŸ¥èƒ½åŠ›ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">ConversationBufferMemory</span>Â }Â <span class="hljs-keyword">from</span>Â 
<span class="hljs-string">"langchain/memory"</span>;

<span class="hljs-keyword">const</span>Â memoryÂ =Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">ConversationBufferMemory</span>({
Â Â <span class="hljs-attr">memoryKey</span>:Â <span class="hljs-string">"chat_history"</span>,
Â Â <span class="hljs-attr">returnMessages</span>:Â <span class="hljs-literal">true</span>
});
</code></pre>
<p><strong>6. ä»£ç†(Agents)</strong></p>
<p>ä»£ç†ä½¿ç”¨LLMå†³å®šæ‰§è¡Œå“ªäº›åŠ¨ä½œï¼Œå¯ä»¥åŠ¨æ€é€‰æ‹©å·¥å…·ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span>Â {Â initializeAgentExecutorÂ }Â <span class="hljs-keyword">from</span>Â 
<span class="hljs-string">"langchain/agents"</span>;
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">SerpAPI</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">"langchain/tools"</span>;
<span class="hljs-keyword">import</span>Â {Â <span class="hljs-title class_">Calculator</span>Â }Â <span class="hljs-keyword">from</span>Â <span class="hljs-string">"langchain/tools"</span>;

<span class="hljs-keyword">const</span>Â toolsÂ =Â [<span class="hljs-keyword">new</span>Â <span class="hljs-title class_">SerpAPI</span>(),Â <span class="hljs-keyword">new</span>Â <span class="hljs-title class_">Calculator</span>()];
<span class="hljs-keyword">const</span>Â agentÂ =Â <span class="hljs-keyword">await</span>Â initializeAgentExecutor
(tools,Â llm,Â <span class="hljs-string">"zero-shot-react-description"</span>);
</code></pre>
<p><strong>JavaScript/TypeScriptç‰ˆæœ¬</strong></p>
<ul>
<li>langchain : æ ¸å¿ƒåº“</li>
<li>@langchain/openai : OpenAIé›†æˆ</li>
<li>@langchain/community : ç¤¾åŒºè´¡çŒ®çš„é›†æˆ</li>
<li>langchain/chains : é¢„æ„å»ºé“¾</li>
<li>langchain/embeddings : åµŒå…¥æ¨¡å‹</li>
</ul>
<h4 data-id="heading-4">å¦‚ä½•å»å­˜å‚¨æˆ‘ä¼ å…¥çš„æ•°æ®</h4>
<p>æˆ‘ä»¬å·²ç»çŸ¥é“äº†aiä¼šå°†æˆ‘ä»¬çš„é—®é¢˜ä¸æ•°æ®åº“ä¸­çš„æ¯ä¸€æ¡æ•°æ®è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬å»ä½¿ç”¨<strong>å‘é‡æ•°æ®åº“</strong>å»å­˜å‚¨æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œå°†ä¿¡æ¯ä»¥å‘é‡çš„å½¢å¼å­˜å‚¨ä¾¿äºæˆ‘ä»¬è¿›è¡Œç›¸ä¼¼æ€§æœç´¢ï¼Œåœ¨è¿™ä¸ªé¡¹ç›®ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°çš„æ˜¯çº¿ä¸Šæ•°æ®åº“supabase(å½“ç„¶ç”±äºè¿™æ˜¯ä¸€ä¸ªçº¿ä¸Šæ•°æ®åº“ï¼Œåç»­å°±éš¾å…æ¶‰åŠåˆ°æ”¶è´¹ç­‰é—®é¢˜ï¼Œä¸»åŒ…å°±æ˜¯åœ¨åˆ›äº†ä¸¤ä¸ªæ•°æ®åº“åè¦æ”¶æˆ‘çš„é’±äº†ï¼Œä¸ç„¶ä½ ä¹‹å‰çš„æ•°æ®å°±æ²¡äº†)ï¼Œé‚£å…·ä½“å¦‚ä½•å»ç”¨å‘¢ï¼Ÿ</p>
<h5 data-id="heading-5">ç¯å¢ƒé…ç½®</h5>
<pre><code class="hljs language-.env" lang=".env"># Supabase é…ç½®
SUPABASE_URL=æ¯ä¸ªåº“å¯¹åº”ä¸€ä¸ªurl
SUPABASE_ANON_KEY=
SUPABASE_TABLE_NAME=documents
</code></pre>
<p>åœ¨ä¸‹å›¾çš„ä½ç½®å¯ä»¥æ‰¾åˆ°url
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ea8ef042d71047faa62a54a5dc6763ab~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LiN5L-d5oqk5bqf54mp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765332827&amp;x-signature=oFY%2FPjXtFM3C0U%2Bd8WmHj4XKqKM%3D" alt="image.png" loading="lazy"/></p>
<p>apiçš„è¯è¦æ³¨æ„æœ‰ä¸¤ä¸ªï¼Œè€Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°çš„å°±æ˜¯ä¸Šé¢<code>anon``public</code>çš„é‚£ä¸ªapi</p>
<blockquote>
<ul>
<li>anon å¯†é’¥ åº”è¯¥åªç”¨äºå®¢æˆ·ç«¯åº”ç”¨ï¼Œæƒé™å—é™ï¼Œé»˜è®¤åªèƒ½è¯»å–å…¬å¼€æ•°æ®</li>
<li>service_role å¯†é’¥ åº”è¯¥ç”¨äºæœåŠ¡ç«¯æ“ä½œï¼Œæ‹¥æœ‰å®Œå…¨æƒé™ï¼Œå¯ä»¥ç»•è¿‡æ‰€æœ‰è¡Œçº§å®‰å…¨ç­–ç•¥(RLS)</li>
</ul>
<p>è€Œæˆ‘ä»¬ä½¿ç”¨ anon å¯†é’¥èƒ½å¤Ÿå†™å…¥æ•°æ®çš„åŸå› æ˜¯ï¼šè¡¨æƒé™è®¾ç½® ï¼šdocumentsè¡¨æ²¡æœ‰å¯ç”¨RLSï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ï¼Œä»»ä½•æœ‰æ•ˆçš„APIå¯†é’¥ï¼ˆåŒ…æ‹¬anonå¯†é’¥ï¼‰éƒ½æœ‰æƒé™æ’å…¥æ•°æ®ã€‚è™½ç„¶è¿™æ ·ä¸å¤ªå®‰å…¨</p>
<p>æ›´å®‰å…¨çš„åšæ³•åº”è¯¥æ˜¯ï¼š</p>
<ol>
<li>å¯ç”¨RLSï¼š ALTER TABLE public.documents ENABLE ROW LEVEL SECURITY;</li>
<li>åˆ›å»ºé€‚å½“çš„ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š
<ul>
<li>å…è®¸æ‰€æœ‰äººè¯»å–ï¼š CREATE POLICY "Enable read access for all users" ON public.documents FOR SELECT USING (true);</li>
<li>åªå…è®¸æœåŠ¡è§’è‰²å†™å…¥ï¼š CREATE POLICY "Enable insert for service role only" ON public.documents FOR INSERT WITH CHECK (current_setting('request.jwt.claims', true)::json-&gt;&gt;'role' = 'service_role');
è¿™æ ·å°±å¯ä»¥ç¡®ä¿åªæœ‰æœåŠ¡ç«¯ï¼ˆä½¿ç”¨service_roleå¯†é’¥ï¼‰æ‰èƒ½å†™å…¥æ•°æ®ï¼Œè€Œå®¢æˆ·ç«¯ï¼ˆä½¿ç”¨anonå¯†é’¥ï¼‰åªèƒ½è¯»å–æ•°æ®ã€‚</li>
</ul>
</li>
</ol>
<p>ä½†æ˜¯æˆ‘ä»¬å…ˆä¸è€ƒè™‘é‚£ä¹ˆè¿œï¼Œå…ˆå·ä¸ªæ‡’ï¼Œå°±è¿™æ ·</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0214d5ed10b14806b91291fc6e27aecf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LiN5L-d5oqk5bqf54mp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765332827&amp;x-signature=r3%2BtyGZwq4N1TFh0B4NjOg4OuMI%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-6">åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ä¸­çš„æ•°æ®è¡¨</h5>
<p>åœ¨supabaseå®˜ç½‘ä¸­æ‰¾åˆ°ç¼–è¾‘è¡¨çš„åœ°æ–¹ï¼Œé€‰æ‹©è¿™ä¸ªï¼Œä¾¿å¯ä»¥ç›´æ¥ä½¿ç”¨sqlè¯­å¥å»åˆ›å»ºè¡¨äº†
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44ad5491e5eb430ea9a1457bd0b7a6e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LiN5L-d5oqk5bqf54mp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765332827&amp;x-signature=9KIXlEUCS4z6I%2FChONPnFyG1IrM%3D" alt="image.png" loading="lazy"/></p>
<p>è¿™é‡Œæˆ‘ä»¬è¦æ³¨æ„è¦å¯åŠ¨ pgvector æ‰©å±•ï¼Œå¦åˆ™å°†ä¼šåˆ›å»ºå¤±è´¥ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä¸ä»…å£°æ˜äº†è¡¨çš„ç»“æ„è¿˜åˆ›å»ºäº†å‘é‡ç›¸ä¼¼åº¦æœç´¢å‡½æ•°ï¼Œåç»­è¿›è¡Œç›¸ä¼¼åº¦åˆ¤æ–­æ—¶ä¼šä½¿ç”¨åˆ°è¿™ä¸ªå‡½æ•°</p>
<pre><code class="hljs language-js" lang="js">-- å¯ç”¨ pgvector æ‰©å±•
<span class="hljs-variable constant_">CREATE</span> <span class="hljs-variable constant_">EXTENSION</span> <span class="hljs-variable constant_">IF</span> <span class="hljs-variable constant_">NOT</span> <span class="hljs-variable constant_">EXISTS</span> vector;


-- åˆ›å»º documents è¡¨ï¼ˆæ ¹æ®é¡¹ç›®é…ç½®ä½¿ç”¨documentsä½œä¸ºè¡¨åï¼‰
<span class="hljs-variable constant_">CREATE</span> <span class="hljs-variable constant_">TABLE</span> <span class="hljs-variable constant_">IF</span> <span class="hljs-variable constant_">NOT</span> <span class="hljs-variable constant_">EXISTS</span> public.<span class="hljs-property">documents</span> (
    id uuid <span class="hljs-variable constant_">NOT</span> <span class="hljs-variable constant_">NULL</span> <span class="hljs-variable constant_">DEFAULT</span> <span class="hljs-title function_">gen_random_uuid</span>(),
    content text <span class="hljs-literal">null</span>,
    embedding <span class="hljs-title function_">vector</span>(<span class="hljs-number">768</span>) <span class="hljs-literal">null</span>,  -- nomic-embed-textç”Ÿæˆ<span class="hljs-number">768</span>ç»´å‘é‡
    metadata jsonb <span class="hljs-literal">null</span>,
    <span class="hljs-variable constant_">CONSTRAINT</span> documents_pkey <span class="hljs-variable constant_">PRIMARY</span> <span class="hljs-variable constant_">KEY</span> (id)
);

-- åˆ›å»ºå‘é‡ç›¸ä¼¼åº¦æœç´¢å‡½æ•°
<span class="hljs-variable constant_">CREATE</span> <span class="hljs-variable constant_">OR</span> <span class="hljs-variable constant_">REPLACE</span> <span class="hljs-variable constant_">FUNCTION</span> <span class="hljs-title function_">match_documents</span>(
    query_embedding <span class="hljs-title function_">vector</span>(<span class="hljs-number">768</span>),
    match_threshold float <span class="hljs-variable constant_">DEFAULT</span> <span class="hljs-number">0.7</span>,
    match_count int <span class="hljs-variable constant_">DEFAULT</span> <span class="hljs-number">5</span>,
    filter jsonb <span class="hljs-variable constant_">DEFAULT</span> <span class="hljs-string">'{}'</span>
)
<span class="hljs-variable constant_">RETURNS</span> <span class="hljs-variable constant_">TABLE</span> (
    id uuid,
    content text,
    metadata jsonb,
    similarity float
)
<span class="hljs-variable constant_">LANGUAGE</span> sql <span class="hljs-variable constant_">STABLE</span>
<span class="hljs-variable constant_">AS</span> $$
    <span class="hljs-variable constant_">SELECT</span>
        id,
        content,
        metadata,
        <span class="hljs-number">1</span> - (documents.<span class="hljs-property">embedding</span> &lt;=&gt; query_embedding) <span class="hljs-keyword">as</span> similarity
    <span class="hljs-variable constant_">FROM</span> documents
    <span class="hljs-variable constant_">WHERE</span> <span class="hljs-number">1</span> - (documents.<span class="hljs-property">embedding</span> &lt;=&gt; query_embedding) &gt; match_threshold
    <span class="hljs-variable constant_">ORDER</span> <span class="hljs-variable constant_">BY</span> similarity <span class="hljs-variable constant_">DESC</span>
    <span class="hljs-variable constant_">LIMIT</span> match_count;
$$;
</code></pre>
<h5 data-id="heading-7">å¾€æ•°æ®åº“ä¸­å†™å…¥æ•°æ®</h5>
<p>å°†supabaseçš„é…ç½®æ–‡ä»¶å†™å¥½äº†ä¹‹åå’±ä»¬å°±è¦å»ç”¨äº†</p>
<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç </p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// utils/supabase.js</span>
<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">"@supabase/supabase-js"</span>;
<span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">"dotenv"</span>;

dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">const</span> supabase = <span class="hljs-title function_">createClient</span>(process.<span class="hljs-property">env</span>.<span class="hljs-property">SUPABASE_URL</span>, process.<span class="hljs-property">env</span>.<span class="hljs-property">SUPABASE_ANON_KEY</span>);

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> supabase;
</code></pre>
<p>å…ˆå®ä¾‹åŒ–supabase,åç»­å¯ä»¥ç›´æ¥é€šè¿‡supabaseè¿›è¡Œå†™å…¥æ•°æ®</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ingest.js</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">PDFLoader</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"langchain/document_loaders/fs/pdf"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RecursiveCharacterTextSplitter</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"langchain/text_splitter"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">SupabaseVectorStore</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/community/vectorstores/supabase"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OllamaEmbeddings</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/community/embeddings/ollama"</span>;
<span class="hljs-keyword">import</span> supabase <span class="hljs-keyword">from</span> <span class="hljs-string">"./utils/supabase.js"</span>;
<span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">"dotenv"</span>;

dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ingestDocument</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"å¼€å§‹æ–‡æ¡£æ¤å…¥æµç¨‹..."</span>);

  <span class="hljs-comment">// 1. åŠ è½½ PDF</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ­£åœ¨åŠ è½½ PDF æ–‡ä»¶..."</span>);
  <span class="hljs-keyword">const</span> loader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PDFLoader</span>(<span class="hljs-string">"documents/assessment_report.pdf"</span>);
  <span class="hljs-keyword">const</span> docs = <span class="hljs-keyword">await</span> loader.<span class="hljs-title function_">load</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åŠ è½½å®Œæˆï¼Œå…± <span class="hljs-subst">${docs.length}</span> é¡µ`</span>);

  <span class="hljs-comment">// 2. åˆ†å—</span>
  <span class="hljs-keyword">const</span> textSplitter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecursiveCharacterTextSplitter</span>({
    <span class="hljs-attr">chunkSize</span>: <span class="hljs-number">500</span>,
    <span class="hljs-attr">chunkOverlap</span>: <span class="hljs-number">50</span>,
  });
  <span class="hljs-keyword">const</span> splitDocs = <span class="hljs-keyword">await</span> textSplitter.<span class="hljs-title function_">splitDocuments</span>(docs);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`åˆ†å—å®Œæˆï¼Œå…± <span class="hljs-subst">${splitDocs.length}</span> ä¸ªæ–‡æœ¬å—`</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ–‡æœ¬å—:<span class="hljs-subst">${splitDocs[<span class="hljs-number">0</span>].pageContent}</span>`</span>);

  <span class="hljs-comment">// 3. åˆå§‹åŒ– embedding æ¨¡å‹</span>
  <span class="hljs-keyword">const</span> embeddings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OllamaEmbeddings</span>({
    <span class="hljs-attr">model</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">EMBEDDING_MODEL</span>, <span class="hljs-comment">// "nomic-embed-text"</span>
    <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OLLAMA_BASE_URL</span>,
  });

  <span class="hljs-comment">// 4. å­˜å…¥ Supabase å‘é‡æ•°æ®åº“</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ­£åœ¨å°†å‘é‡å†™å…¥ Supabase..."</span>);
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">SupabaseVectorStore</span>.<span class="hljs-title function_">fromDocuments</span>(splitDocs, embeddings, {
      <span class="hljs-attr">client</span>: supabase,
      <span class="hljs-attr">tableName</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">SUPABASE_TABLE_NAME</span>,
      <span class="hljs-attr">queryName</span>: <span class="hljs-string">"match_documents"</span>, <span class="hljs-comment">// LangChain ä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªå‡½æ•°</span>
    });
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ–‡æ¡£å·²æˆåŠŸå­˜å…¥ Supabase å‘é‡æ•°æ®åº“ï¼"</span>);
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"å­˜å…¥ Supabase å¤±è´¥ï¼š"</span>, error.<span class="hljs-property">message</span>);
  }
}

<span class="hljs-title function_">ingestDocument</span>();
</code></pre>
<p>(((Ï†(â—ãƒ­â—;)Ï†)))ï¼Œè¿™äº›éƒ½æ˜¯å•¥å•Šï¼Œæˆ‘æ€ä¹ˆéƒ½çœ‹ä¸æ‡‚ï¼Œåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹</p>
<p>æˆ‘çœ‹æ•´ä¸ªä»£ç ï¼Œæ„Ÿè§‰éƒ½å›´ç»•ç€ä¸€ä¸ªä¸œè¥¿<code>langchain</code>,åœ¨ä¸Šé¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†langchainå¤§æ¦‚æ˜¯ä»€ä¹ˆäº†ï¼Œé‚£æˆ‘ä»¬å°±å…ˆçœ‹çœ‹å…·ä½“æ˜¯æ€ä¹ˆç”¨çš„å§ï¼ˆè¯¦ç»†è®²è¿°ä¸ºä»€ä¹ˆè¦ä½¿ç”¨langchainï¼Œä¸ºä»€ä¹ˆåœ¨è¿™é‡Œä½¿ç”¨è¿™ä¸ªä¸œè¥¿ï¼‰</p>
<p>å¾ˆæ˜æ˜¾ï¼Œæˆ‘ä»¬è¿™è·Ÿç»“æ„åŒ–å’Œæ£€ç´¢å¤–éƒ¨æ•°æ®æœ‰å…³ï¼Œæ‰€ä»¥è·Ÿç´¢å¼•è¿™ä¸ªæ ¸å¿ƒæ¦‚å¿µæœ‰å…³ï¼Œ</p>
<ul>
<li>Document Loaders : ä»å„ç§æ•°æ®æºåŠ è½½æ–‡æ¡£</li>
<li>Text Splitters : å°†é•¿æ–‡æœ¬åˆ†å‰²æˆå¯ç®¡ç†çš„å—</li>
<li>Vector Stores : å­˜å‚¨å’Œæ£€ç´¢å‘é‡åµŒå…¥</li>
</ul>
<p>è¿™ä¸‰ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯è¦ç”¨åˆ°çš„ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦å°†æ–‡å­—è½¬æ¢æˆå‘é‡ï¼Œæ‰€ä»¥è¿˜éœ€è¦ä½¿ç”¨åˆ°ä¸€ä¸ªå‘é‡å¤§æ¨¡å‹
æ‰€ä»¥æ€»ä½“çš„æµç¨‹å°±æ˜¯ï¼š</p>
<ol>
<li>æ–‡æ¡£åŠ è½½ : PDFLoader åŠ è½½PDFæ–‡æ¡£</li>
<li>æ–‡æœ¬åˆ†å‰² : RecursiveCharacterTextSplitter åˆ†å‰²æ–‡æœ¬</li>
<li>å‘é‡åŒ– : OllamaEmbeddings ç”Ÿæˆæ–‡æœ¬å‘é‡</li>
<li>å‘é‡å­˜å‚¨ : SupabaseVectorStore å­˜å‚¨å’Œæ£€ç´¢å‘é‡</li>
</ol>
<p><strong>é‚£ä¸ºä»€ä¹ˆè¦ç”¨ LangChain å‘¢ï¼Ÿ</strong></p>
<p>å› ä¸ºå¦‚æœæ²¡æœ‰ LangChainï¼Œä½ éœ€è¦è‡ªå·±æ‰‹åŠ¨å®Œæˆä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ul>
<li>è‡ªå·±å†™ä»£ç è§£æ PDFï¼ˆæ¯”å¦‚ç”¨ pdf-parse æˆ– pdf.jsï¼‰ï¼Œå¤„ç†ç¼–ç ã€åˆ†é¡µã€æ ¼å¼ä¸¢å¤±ç­‰é—®é¢˜ï¼›</li>
<li>è‡ªå·±å®ç°æ–‡æœ¬åˆ†å—é€»è¾‘ï¼ˆæ¯”å¦‚æŒ‰å­—ç¬¦ã€å¥å­æˆ–è¯­ä¹‰è¾¹ç•Œåˆ‡å‰²ï¼‰ï¼Œè¿˜è¦è€ƒè™‘é‡å ä»¥ä¿ç•™ä¸Šä¸‹æ–‡ï¼›</li>
<li>è‡ªå·±è°ƒç”¨ Ollama çš„ API å‘é€æ–‡æœ¬è·å– embedding å‘é‡ï¼Œå¤„ç† HTTP è¯·æ±‚ã€é”™è¯¯é‡è¯•ã€æ‰¹é‡å¤„ç†ï¼›</li>
<li>è‡ªå·±æ„é€  SQL æŸ¥è¯¢æˆ– RPC è°ƒç”¨ Supabase çš„Â <code>match_documents</code>Â å‡½æ•°ï¼Œæ‹¼æ¥å‘é‡ã€è®¾ç½®é˜ˆå€¼ã€è§£æè¿”å›ç»“æœï¼›</li>
<li>æœ€åè¿˜è¦æ‰‹åŠ¨æ‹¼æ¥ promptï¼ŒæŠŠæ£€ç´¢åˆ°çš„å†…å®¹å¡è¿›é—®é¢˜é‡Œï¼Œå†è°ƒç”¨ LLM æ¥å£ã€‚</li>
</ul>
<p>è¿™äº›æ­¥éª¤è™½ç„¶æŠ€æœ¯ä¸Šå¯è¡Œï¼Œä½†<strong>é‡å¤æ€§é«˜ã€å®¹æ˜“å‡ºé”™ã€éš¾ä»¥ç»´æŠ¤</strong>ï¼Œè€Œä¸”ä¸åŒæ¨¡å‹ã€æ•°æ®åº“ã€æ–‡ä»¶æ ¼å¼ä¹‹é—´çš„é€‚é…æˆæœ¬æé«˜ã€‚</p>
<p>è€Œ <strong>LangChain çš„ä»·å€¼å°±åœ¨äºï¼šå®ƒæŠŠä¸Šè¿°æ‰€æœ‰ç¯èŠ‚éƒ½å°è£…æˆäº†æ ‡å‡†åŒ–çš„æ¨¡å—</strong>ï¼ˆDocument Loaders / Text Splitters / Embeddings / VectorStoresï¼‰ï¼Œä½ åªéœ€è¦åƒæ­ç§¯æœ¨ä¸€æ ·ç»„åˆå®ƒä»¬ï¼Œå°±èƒ½å¿«é€Ÿæ„å»ºä¸€ä¸ªå®Œæ•´çš„ RAG æµç¨‹ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™äº›æ¨¡å—æ˜¯<strong>å¯æ’æ‹”ã€å¯æ›¿æ¢</strong>çš„â€”â€”ä»Šå¤©ä½ ç”¨ Supabase + Ollamaï¼Œæ˜å¤©æ¢æˆ Pinecone + OpenAIï¼Œåªéœ€æ”¹å‡ è¡Œé…ç½®ï¼Œæ ¸å¿ƒé€»è¾‘å‡ ä¹ä¸ç”¨åŠ¨ã€‚</p>
<p>åœ¨è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¹‹æ‰€ä»¥é€‰æ‹© LangChainï¼Œæ­£æ˜¯å› ä¸ºï¼š</p>
<ul>
<li>å®ƒæä¾›äº†Â <code>PDFLoader</code>Â ç›´æ¥è¯»å–ç®€å† PDFï¼›</li>
<li>å®ƒå†…ç½®äº†æ™ºèƒ½çš„Â <code>RecursiveCharacterTextSplitter</code>ï¼Œèƒ½æŒ‰æ®µè½ã€å¥å­åˆç†åˆ‡åˆ†ï¼Œé¿å…åˆ‡æ–­å…³é”®ä¿¡æ¯ï¼›</li>
<li>å®ƒé€šè¿‡Â <code>OllamaEmbeddings</code>Â æ— ç¼å¯¹æ¥æœ¬åœ° Ollama çš„ embedding æ¨¡å‹ï¼›</li>
<li>å®ƒçš„Â <code>SupabaseVectorStore</code>Â å·²ç»å®ç°äº†ä¸ pgvector çš„æ·±åº¦é›†æˆï¼Œè‡ªåŠ¨è°ƒç”¨ä½ åˆ›å»ºçš„Â <code>match_documents</code>Â å‡½æ•°ï¼›</li>
<li>æ•´ä¸ªæµç¨‹è¢«æŠ½è±¡ä¸ºæ¸…æ™°çš„â€œåŠ è½½ â†’ åˆ‡åˆ† â†’ å‘é‡åŒ– â†’ å­˜å‚¨â€ç®¡é“ï¼Œæå¤§é™ä½äº†å¼€å‘å¤æ‚åº¦ã€‚</li>
</ul>
<p>æ¢å¥è¯è¯´ï¼Œ<strong>LangChain è®©ä½ ä¸“æ³¨äºâ€œæˆ‘è¦åšä»€ä¹ˆâ€ï¼Œè€Œä¸æ˜¯â€œæ€ä¹ˆä¸€è¡Œè¡Œä»£ç å»å®ç°åº•å±‚ç»†èŠ‚â€</strong> ã€‚è¿™æ­£æ˜¯ç°ä»£ AI åº”ç”¨å¼€å‘æ‰€éœ€è¦çš„ç”Ÿäº§åŠ›å·¥å…·ã€‚
è¿è¡Œ<code>node ingest.js</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/146734e050234c3facb510609bf193bd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LiN5L-d5oqk5bqf54mp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765332827&amp;x-signature=DqVKyN1TCIIy2L%2FMvKvAlHGOwCM%3D" alt="image.png" loading="lazy"/>
ç»è¿‡ä¸Šé¢å‡ ä¸ªæ­¥éª¤ï¼Œæˆ‘ä»¬å·²ç» æˆåŠŸå°†æ•°æ®å­˜å…¥æ•°æ®åº“ä¸­äº†ï¼Œç°åœ¨å°±æ˜¯å¦‚ä½•å°†æ•°æ®ä¸æˆ‘ä»¬çš„å¤§æ¨¡å‹ç›¸ç»“åˆäº†</p>
<h4 data-id="heading-8">å¦‚ä½•å°†åœ¨LLMä¸­å»ä½¿ç”¨æˆ‘çš„æ•°æ®</h4>
<p>è¿™é‡Œç”±äºæ˜¯ç®€å•çš„ä¸€ä¸ªä¾‹å­ï¼Œç›®çš„æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çŸ¥é“å¤§è‡´ragçš„æµç¨‹ï¼Œæˆ‘ä»¬ä¾¿ä½¿ç”¨ç®€å•çš„ollamaè¿›è¡Œä¸¾ä¾‹ï¼Œä½†æ˜¯å‰ææ˜¯ä½ æœ¬åœ°å·²ç»ä¸‹è½½äº†ollama,å¹¶ä¸”åœ¨ç»ˆç«¯è¿è¡Œ<code>ollama run deepseek-v3.1:671b-cloud</code>å’Œ
<code>ollama run nomic-embed-text</code>ï¼Œå¦‚æ­¤æ–¹å¯ä½¿ç”¨</p>
<p>é¦–å…ˆè¿›è¡ŒåŸºç¡€é…ç½®
åœ¨åŸå…ˆçš„.envæ–‡ä»¶ä¸­æ·»åŠ ollamaé…ç½®</p>
<pre><code class="hljs language-.env" lang=".env"># Ollama é…ç½®
OLLAMA_BASE_URL=http://localhost:11434
OLLAMA_MODEL=deepseek-v3.1:671b-cloud
EMBEDDING_MODEL=nomic-embed-text
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// qa_resume.js - é’ˆå¯¹ç®€å†å†…å®¹çš„é—®é¢˜</span>
<span class="hljs-keyword">import</span> { createClient } <span class="hljs-keyword">from</span> <span class="hljs-string">'@supabase/supabase-js'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">OllamaEmbeddings</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@langchain/community/embeddings/ollama'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Ollama</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@langchain/community/llms/ollama"</span>;
<span class="hljs-keyword">import</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;

dotenv.<span class="hljs-title function_">config</span>();

<span class="hljs-keyword">const</span> supabaseUrl = process.<span class="hljs-property">env</span>.<span class="hljs-property">SUPABASE_URL</span>;
<span class="hljs-keyword">const</span> supabaseKey = process.<span class="hljs-property">env</span>.<span class="hljs-property">SUPABASE_ANON_KEY</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">askResumeQuestion</span>(<span class="hljs-params">question</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\né—®é¢˜: <span class="hljs-subst">${question}</span>`</span>);

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 1. åˆå§‹åŒ– embedding æ¨¡å‹</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"1. åˆå§‹åŒ–embeddingæ¨¡å‹..."</span>);
    <span class="hljs-keyword">const</span> embeddings = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OllamaEmbeddings</span>({
      <span class="hljs-attr">model</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">EMBEDDING_MODEL</span>,
      <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OLLAMA_BASE_URL</span>,
    });

    <span class="hljs-comment">// 2. ç”ŸæˆæŸ¥è¯¢å‘é‡</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"2. ç”ŸæˆæŸ¥è¯¢å‘é‡..."</span>);
    <span class="hljs-keyword">const</span> queryEmbedding = <span class="hljs-keyword">await</span> embeddings.<span class="hljs-title function_">embedQuery</span>(question);

    <span class="hljs-comment">// 3. æ‰§è¡Œå‘é‡ç›¸ä¼¼åº¦æœç´¢</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"3. æ‰§è¡Œå‘é‡ç›¸ä¼¼åº¦æœç´¢..."</span>);
    <span class="hljs-keyword">const</span> supabase = <span class="hljs-title function_">createClient</span>(supabaseUrl, supabaseKey);
    
    <span class="hljs-keyword">const</span> { <span class="hljs-attr">data</span>: documents, error } = <span class="hljs-keyword">await</span> supabase
      .<span class="hljs-title function_">rpc</span>(<span class="hljs-string">'match_documents'</span>, {
        <span class="hljs-attr">query_embedding</span>: queryEmbedding,
        <span class="hljs-attr">match_threshold</span>: <span class="hljs-number">0.5</span>,
        <span class="hljs-attr">match_count</span>: <span class="hljs-number">8</span>,
        <span class="hljs-attr">filter</span>: {}
      });

    <span class="hljs-keyword">if</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'å‘é‡æœç´¢å¤±è´¥:'</span>, error.<span class="hljs-property">message</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ‰¾åˆ° <span class="hljs-subst">${documents.length}</span> ä¸ªç›¸å…³æ–‡æ¡£`</span>);
    <span class="hljs-keyword">if</span> (documents.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ–‡æ¡£'</span>);
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// 4. æ„å»ºä¸Šä¸‹æ–‡</span>
    <span class="hljs-comment">// console.log("4. æ„å»ºä¸Šä¸‹æ–‡...");</span>
    <span class="hljs-keyword">const</span> context = documents.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">doc, index</span>) =&gt;</span> 
      <span class="hljs-string">`[æ–‡æ¡£<span class="hljs-subst">${index + <span class="hljs-number">1</span>}</span>]\n<span class="hljs-subst">${doc.content}</span>`</span>
    ).<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n\n'</span>);

    <span class="hljs-comment">// 5. åˆå§‹åŒ– LLM</span>
    <span class="hljs-comment">// console.log("5. åˆå§‹åŒ–LLM...");</span>
    <span class="hljs-keyword">const</span> llm = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Ollama</span>({
      <span class="hljs-attr">baseUrl</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OLLAMA_BASE_URL</span>,
      <span class="hljs-attr">model</span>: process.<span class="hljs-property">env</span>.<span class="hljs-property">OLLAMA_MODEL</span>,
      <span class="hljs-attr">temperature</span>: <span class="hljs-number">0.3</span>,
    });
    <span class="hljs-comment">// 6. æ„å»ºæç¤ºè¯</span>
    <span class="hljs-keyword">const</span> prompt = <span class="hljs-string">`åŸºäºä»¥ä¸‹ç®€å†å†…å®¹ï¼Œè¯·å›ç­”é—®é¢˜ï¼š

ä¸Šä¸‹æ–‡ï¼š
<span class="hljs-subst">${context}</span>

é—®é¢˜ï¼š<span class="hljs-subst">${question}</span>

è¯·ç”¨ä¸­æ–‡å›ç­”ï¼Œå¹¶ç¡®ä¿ç­”æ¡ˆå‡†ç¡®ã€ç®€æ´ã€‚å¦‚æœä¸Šä¸‹æ–‡ä¸­æ²¡æœ‰ç›¸å…³ä¿¡æ¯ï¼Œè¯·æ˜ç¡®è¯´æ˜ã€‚`</span>;

    <span class="hljs-comment">// 7. ç”Ÿæˆå›ç­”</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"è¯·ç¨ç­‰ï¼Œæ­£åœ¨ç”Ÿæˆå›ç­”..."</span>);
    <span class="hljs-keyword">const</span> answer = <span class="hljs-keyword">await</span> llm.<span class="hljs-title function_">invoke</span>(prompt);
    
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`å›ç­”: <span class="hljs-subst">${answer}</span>`</span>);
    <span class="hljs-keyword">return</span> answer;

  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"é—®ç­”å¤±è´¥ï¼š"</span>, error.<span class="hljs-property">message</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"é”™è¯¯è¯¦æƒ…ï¼š"</span>, error);
  }
}

<span class="hljs-comment">// æµ‹è¯•é’ˆå¯¹ç®€å†çš„é—®é¢˜</span>
<span class="hljs-keyword">await</span> <span class="hljs-title function_">askResumeQuestion</span>(<span class="hljs-string">"è¿™ä½å€™é€‰äººçš„ä¸»è¦æŠ€èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ"</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">askResumeQuestion</span>(<span class="hljs-string">"å€™é€‰äººæœ‰å“ªäº›é¡¹ç›®ç»éªŒï¼Ÿ"</span>);
<span class="hljs-keyword">await</span> <span class="hljs-title function_">askResumeQuestion</span>(<span class="hljs-string">"ä»–çš„æ•™è‚²èƒŒæ™¯å¦‚ä½•ï¼Ÿ"</span>);
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e8eaa09704145178e586f461bd691f8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Zu95a625LiN5L-d5oqk5bqf54mp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765332827&amp;x-signature=nTbT9T3dACLOPbblZGrqUKjDcOc%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">æ€»ç»“</h3>
<p>é€šè¿‡è¿™ä¸ªç®€å•çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å®Œæ•´èµ°é€šäº† <strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> çš„æ ¸å¿ƒæµç¨‹ï¼š<br/>
å°†ä¸ªäººç®€å†ï¼ˆPDFï¼‰ä½œä¸ºç§æœ‰çŸ¥è¯†æºï¼Œåˆ©ç”¨ <strong>LangChain.js</strong> è‡ªåŠ¨å®Œæˆæ–‡æ¡£åŠ è½½ã€æ–‡æœ¬åˆ‡åˆ†ã€å‘é‡åŒ–å’Œå­˜å‚¨ï¼›å€ŸåŠ© <strong>Supabase + pgvector</strong> æ„å»ºè½»é‡çº§å‘é‡æ•°æ®åº“ï¼Œå®ç°é«˜æ•ˆçš„è¯­ä¹‰ç›¸ä¼¼æ€§æ£€ç´¢ï¼›æœ€åç»“åˆæœ¬åœ°è¿è¡Œçš„ <strong>Ollama å¤§æ¨¡å‹</strong>ï¼Œåœ¨æ³¨å…¥ä¸Šä¸‹æ–‡çš„å‰æä¸‹ç²¾å‡†å›ç­”å…³äºç®€å†çš„é—®é¢˜ã€‚</p>
<p>æ•´ä¸ªæ–¹æ¡ˆå®Œå…¨è¿è¡Œåœ¨æœ¬åœ°æˆ–ä½æˆæœ¬äº‘æœåŠ¡ä¸Šï¼Œ<strong>æ— éœ€ä¾èµ– OpenAI ç­‰å•†ä¸š API</strong>ï¼Œæ—¢ä¿æŠ¤äº†æ•°æ®éšç§ï¼Œåˆæœ‰æ•ˆé¿å…äº†å¤§æ¨¡å‹â€œèƒ¡è¯´å…«é“â€çš„é—®é¢˜â€”â€”å› ä¸ºå®ƒçš„å›ç­”å§‹ç»ˆåŸºäºä½ æä¾›çš„çœŸå®å†…å®¹ã€‚</p>
<p>æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ä¸ªæ¶æ„å…·å¤‡æå¼ºçš„å¯æ‰©å±•æ€§ï¼š</p>
<ul>
<li>æ¢ä¸ª PDFï¼Œå°±èƒ½å˜æˆâ€œå…¬å¸çŸ¥è¯†åº“é—®ç­”â€ï¼›</li>
<li>åŠ å…¥å¤šä¸ªæ–‡æ¡£ï¼Œå°±æ”¯æŒè·¨æ–‡ä»¶æ£€ç´¢ï¼›</li>
<li>æ¥å…¥ Agent å’Œå·¥å…·ï¼ˆå¦‚æ—¥å†ã€é‚®ä»¶ï¼‰ï¼Œè¿˜èƒ½å®ç°â€œæ ¹æ®æˆ‘çš„ç»å†è‡ªåŠ¨å†™æ±‚èŒä¿¡â€ç­‰æ™ºèƒ½ä»»åŠ¡ã€‚</li>
</ul>
<p>è¿™åªæ˜¯ä¸€ä¸ªèµ·ç‚¹ã€‚<br/>
æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å°è¯•å¼•å…¥æ›´å¤æ‚çš„ragé¡¹ç›®ï¼Œè¿˜æœ‰å¾ˆå¤šéœ€è¦ä¼˜åŒ–çš„éƒ¨åˆ†éœ€è¦å»å®Œå–„ï¼Œåƒæ–‡æœ¬åˆ‡å‰²æ˜¯å¦å¯ä»¥æ›´åŠ äººæ€§åŒ–ï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡langchainå†…çš„ç»„ä»¶è¿›è¡Œè¿›ä¸€æ­¥çš„å¼€å‘ï¼Œæ¯”å¦‚å®ç°æµå¼è¾“å‡ºï¼Œå¯¹è¯å†å²å­˜å‚¨ä¹‹ç±»çš„ï¼Œè¿˜æœ‰ä¹‹å‰åŸ‹ä¸‹çš„ä¼ç¬”ï¼Œæœ‰æ²¡æœ‰å¯ä»¥åœ¨æœ¬åœ°ç›´æ¥è¿è¡Œçš„å…è´¹å‘é‡æ•°æ®åº“ï¼Œè¿™äº›éƒ½ä¼šåœ¨ä¹‹åçš„æ–‡ç« ä¸­å†™åˆ°</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Next.jsç¬¬åäºŒç« (RSC/æœåŠ¡ç«¯ç»„ä»¶/å®¢æˆ·ç«¯ç»„ä»¶)]]></title>    <link>https://juejin.cn/post/7579062563326427177</link>    <guid>https://juejin.cn/post/7579062563326427177</guid>    <pubDate>2025-12-02T13:04:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579062563326427177" data-draft-id="7579066828179357732" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Next.jsç¬¬åäºŒç« (RSC/æœåŠ¡ç«¯ç»„ä»¶/å®¢æˆ·ç«¯ç»„ä»¶)"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-02T13:04:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°æ»¡zs"/> <meta itemprop="url" content="https://juejin.cn/user/2463384809252397"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Next.jsç¬¬åäºŒç« (RSC/æœåŠ¡ç«¯ç»„ä»¶/å®¢æˆ·ç«¯ç»„ä»¶)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2463384809252397/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°æ»¡zs
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T13:04:35.000Z" title="Tue Dec 02 2025 13:04:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RSC(React Server Components)</h2>
<p>RSC(æœåŠ¡å™¨ç»„ä»¶)æ˜¯React19<code>æ­£å¼å¼•å…¥</code>çš„ä¸€ç§æ–°çš„ç»„ä»¶ç±»å‹ï¼Œå®ƒå¯ä»¥åœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ã€‚</p>
<p>åƒä¼ ç»Ÿçš„<code>SSR</code>ä»–æ˜¯åœ¨æœåŠ¡å™¨æå‰æŠŠé¡µé¢æ¸²æŸ“å¥½ï¼Œç„¶åè¿”å›ç»™æµè§ˆå™¨ï¼Œç„¶åè¿›è¡Œæ°´åˆï¼Œ<code>CSR</code>åˆ™æ˜¯åœ¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼Œè€Œ<code>RSC</code>åˆ™æ˜¯å¸å–ä¸¤æ–¹ä¼˜åŠ¿ï¼Œåˆ†ä¸º<code>æœåŠ¡å™¨ç»„ä»¶</code>å’Œ<code>å®¢æˆ·ç«¯ç»„ä»¶</code>ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­:</p>
<p>ä¾‹å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå®˜ç½‘çš„é¡µé¢ï¼Œä¸Šé¢éƒ½æ˜¯é™æ€å†…å®¹ï¼Œä½†ä¸‹é¢ç•™è¨€æ¡†æ˜¯éœ€è¦äº¤äº’çš„ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a80aa3627d954e6baad4c922fcf9e8ce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=%2BfIjzD%2BLviW1n8xLZNbwfS7y6Ho%3D" alt="7.gif" loading="lazy"/></p>
<p>æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ‹†åˆ†æˆä¸¤ä¸ªç»„ä»¶:</p>
<ul>
<li>æœåŠ¡å™¨ç»„ä»¶: ä¸Šé¢éƒ½æ˜¯é™æ€å†…å®¹ï¼Œä¾‹å¦‚æ­£æ–‡ï¼Œæ ‡é¢˜ï¼Œå›¾ç‰‡ç­‰ï¼Œè¿™ç±»ç»„ä»¶ä¹‹æ‰€ä»¥é€‚åˆåœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œæ ¸å¿ƒåŸå› åœ¨äºæœåŠ¡ç«¯æ¸²æŸ“HTML+CSSçš„é€Ÿåº¦æ›´å¿«ï¼Œç”Ÿæˆçš„å†…å®¹å¯¹æœç´¢å¼•æ“å®Œå…¨å¯è§ï¼Œä¸”æ— éœ€å®¢æˆ·ç«¯é¢å¤–å¤„ç†äº¤äº’é€»è¾‘ï¼Œå®Œç¾åŒ¹é…é™æ€å†…å®¹çš„éœ€æ±‚ã€‚</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-comment">//Next.js é»˜è®¤æœåŠ¡å™¨ç»„ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<ul>
<li>å®¢æˆ·ç«¯ç»„ä»¶: ä¸‹é¢ç•™è¨€æ¡†æ˜¯éœ€è¦äº¤äº’çš„ï¼Œä¾‹å¦‚äº¤äº’åŠŸèƒ½ï¼Œå¦‚ç‚¹èµæŒ‰é’®ã€è®¡æ•°å™¨ã€è¡¨å•ç­‰ã€‚è¿™ç±»ç»„ä»¶éœ€è¦ä¾èµ–æµè§ˆå™¨DOMäº‹ä»¶ã€çŠ¶æ€ç®¡ç†ï¼ˆuseStateï¼‰ã€å‰¯ä½œç”¨ï¼ˆuseEffectï¼‰ç­‰å®¢æˆ·ç«¯èƒ½åŠ›ï¼Œå¿…é¡»åœ¨å®¢æˆ·ç«¯å®Œæˆæ¸²æŸ“å’Œæ°´åˆï¼ˆå³æ·»åŠ äº‹ä»¶å¤„ç†ç¨‹åºçš„è¿‡ç¨‹ï¼‰æ‰èƒ½å®ç°äº¤äº’æ•ˆæœ</li>
</ul>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">'use client'</span> <span class="hljs-comment">//å£°æ˜è¿™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Home Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<h4 data-id="heading-1">æ¸²æŸ“(RSC Payload)</h4>
<p>SSRæ¨¡å¼æ˜¯åœ¨æœåŠ¡å™¨ç›´æ¥æ¸²æŸ“æˆ<code>HTML</code>é¡µé¢ï¼Œè¿”å›ç»™æµè§ˆå™¨çš„ï¼Œè€Œ<code>RSC</code>ä»–æ˜¯ä¸€ç§ç‰¹æ®Šçš„<code>ç´§å‡‘çš„</code>æ ¼å¼</p>
<pre><code class="hljs language-json" lang="json">b2<span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"line"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"    })"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
b3<span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"line"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"  }"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-token-punctuation)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">","</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">" [])"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
b4<span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"line"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">" "</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
b5<span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"line"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"  "</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-token-comment)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"// You can use `isPending` to give users feedback"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
b6<span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"className"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"line"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"  "</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-token-keyword)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"return"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">" &lt;"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-token-string-expression)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"p"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"&gt;Total Views: {views}&lt;/"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-token-string-expression)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"p"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">[</span><span class="hljs-string">"$"</span><span class="hljs-punctuation">,</span><span class="hljs-string">"span"</span><span class="hljs-punctuation">,</span><span class="hljs-literal"><span class="hljs-keyword">null</span></span><span class="hljs-punctuation">,</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"style"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span><span class="hljs-attr">"color"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"var(--shiki-color-text)"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"children"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"&gt;"</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
</code></pre>
<p>é‚£ä¸ºä»€ä¹ˆè¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶å¯ä»¥è¿›è¡ŒåµŒå¥—<code>æœåŠ¡å™¨ç»„ä»¶</code>&gt;åµŒå¥—<code>å®¢æˆ·ç«¯ç»„ä»¶</code>&gt;</p>
<p>é»„è‰²èŠ‚ç‚¹è¡¨ç¤º<code>æœåŠ¡å™¨ç»„ä»¶</code>ï¼Œè™šçº¿èŠ‚ç‚¹è¡¨ç¤º<code>å®¢æˆ·ç«¯ç»„ä»¶</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb652ca8382248fc83e6d398a2452c74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=eylXhlN6aUyMlVxwTmgd%2BwxSHCY%3D" alt="2.png" loading="lazy"/></p>
<p>åœ¨è¿™ä¸ªç»“æ„ä¸­ï¼ŒNext.jså°±ä¼šæ ‡è®°å“ªäº›æ˜¯å®¢æˆ·ç«¯ç»„ä»¶å¹¶ä¸”é¢„ç•™å¥½ä½ç½®ï¼Œä½†æ˜¯ä¸ä¼šè¿›è¡Œæ°´åˆã€‚</p>
<p>é‚£ä¹ˆNext.jså‘ç°å®¢æˆ·ç«¯ç»„ä»¶ä¹Ÿä¼šåœ¨æœåŠ¡å™¨ç”Ÿæˆè¿™ä¸ªç»“æ„ï¼Œé‚£å¹²è„†ç›´æ¥æœåŠ¡å™¨é‡Œé¢æŠŠå®¢æˆ·ç«¯ç»„ä»¶è¿›è¡Œé¢„æ¸²æŸ“(ä¸åŒ…å«äº¤äº’)ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½å¿«é€Ÿçœ‹åˆ°æ•°æ®ï¼Œç­‰ä»–åŠ è½½å®Œæˆåå†è¿›è¡Œæ°´åˆï¼Œæ‰€ä»¥å®¢æˆ·ç«¯ç»„ä»¶ä¹Ÿä¼šåœ¨æœåŠ¡å™¨è¿›è¡Œä¸€æ¬¡<code>é¢„æ¸²æŸ“</code>ã€‚</p>
<h4 data-id="heading-2">ä¼˜ç‚¹</h4>
<ul>
<li>
<p>å°†ç»„ä»¶æ‹†åˆ†æˆå®¢æˆ·ç«¯ç»„ä»¶å’ŒæœåŠ¡å™¨ç»„ä»¶ï¼Œå¯ä»¥æœ‰æ•ˆçš„å‡å°‘<code>bundle</code>ä½“ç§¯ï¼Œå› ä¸º<code>æœåŠ¡å™¨ç»„ä»¶</code>å·²ç»åœ¨æœåŠ¡å™¨æ¸²æŸ“å¥½äº†ï¼Œæ‰€ä»¥æ²¡å¿…è¦æ‰“å…¥<code>bundle</code>ä¸­,ä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨ç»„ä»¶æ‰€ä¾èµ–çš„åŒ…éƒ½ä¸ä¼šæ‰“è¿›å»ï¼Œå¤§å¤§å‡å°‘äº†<code>bundle</code>ä½“ç§¯ã€‚</p>
</li>
<li>
<p>å±€éƒ¨æ°´åˆï¼Œåƒä¼ ç»Ÿçš„SSRåŒæ„æ¨¡å¼, æ‰€æœ‰çš„é¡µé¢éƒ½è¦åœ¨å®¢æˆ·ç«¯è¿›è¡Œæ°´åˆï¼Œè€Œ<code>RSC</code>å°†ç»„ä»¶æ‹†åˆ†å‡ºæ¥ï¼Œåªä¼šæŠŠå®¢æˆ·ç«¯ç»„ä»¶è¿›è¡Œæ°´åˆï¼Œé¿å…äº†å…¨é‡æ°´åˆå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p>
</li>
<li>
<p>æµå¼åŠ è½½ï¼Œæˆ‘ä»¬çš„HTMLé¡µé¢æœ¬æ¥å°±æ”¯æŒæµå¼åŠ è½½ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç»„ä»¶å¯ä»¥è¾¹æ¸²æŸ“è¾¹è¿”å›ï¼Œæé«˜äº†FCP(é¦–æ¬¡å†…å®¹ç»˜åˆ¶)æ€§èƒ½ã€‚</p>
</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/870b4c3be1224e059685d8603ee92d6e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=7pNR5%2FHSV3sN8iApkSVw1GOyQaI%3D" alt="1.png" loading="lazy"/></p>
<h2 data-id="heading-3">æœåŠ¡ç«¯ç»„ä»¶(Server Components)</h2>
<p>åœ¨é»˜è®¤æƒ…å†µä¸‹, <code>page</code> <code>layout</code> éƒ½æ˜¯æœåŠ¡ç«¯ç»„ä»¶ï¼ŒæœåŠ¡ç«¯ç»„ä»¶å¯ä»¥è®¿é—®<code>node.js</code> APIï¼ŒåŒ…æ‹¬å¤„ç†æ•°æ®åº“dbã€‚</p>
<p>src/app/server/page.tsx</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'node:fs'</span> <span class="hljs-comment">//å¼•å…¥fsæ¨¡å—</span>
<span class="hljs-keyword">import</span> mysql, { <span class="hljs-title class_">RowDataPacket</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'mysql2/promise'</span> <span class="hljs-comment">//æ“ä½œæ•°æ®åº“ ä»…ä¾›æ¼”ç¤º éæœ€ä½³å®è·µ</span>
<span class="hljs-keyword">const</span> pool = mysql.<span class="hljs-title function_">createPool</span>({
    <span class="hljs-attr">host</span>: <span class="hljs-string">'localhost'</span>,
    <span class="hljs-attr">user</span>: <span class="hljs-string">'root'</span>,
    <span class="hljs-attr">password</span>: <span class="hljs-string">'123456'</span>,
    <span class="hljs-attr">database</span>: <span class="hljs-string">'catering'</span>,
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ServerPage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [rows] = <span class="hljs-keyword">await</span> pool.<span class="hljs-property">query</span>&lt;<span class="hljs-title class_">RowDataPacket</span>[]&gt;(<span class="hljs-string">'SELECT * FROM goods'</span>)
    <span class="hljs-keyword">const</span> data = fs.<span class="hljs-title function_">readFileSync</span>(<span class="hljs-string">'data.json'</span>, <span class="hljs-string">'utf-8'</span>)
    <span class="hljs-keyword">const</span> json = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data)
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Server Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            {json.age}///{json.name}///{json.city}
            <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
            {rows.map((item: any) =&gt; (
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item.id}</span>&gt;</span>{item.name}-{item.goodsPrice}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            ))}
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p>data.json</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"John"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"age"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">30</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"city"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"New York"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4f097ff47c2d4f7f8be1dae013509597~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=DEGpzB5upnv7oFFFLHrslmS1u7E%3D" alt="server.png" loading="lazy"/></p>
<p>å› ä¸ºæ˜¯åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ‰€ä»¥æ—¥å¿—ä¼šå‡ºç°åœ¨æ§åˆ¶å°ï¼Œé‚£ä¸ºä»€ä¹ˆæ§åˆ¶å°ä¹Ÿä¼šå‡ºç°ï¼Œæ˜¯å› ä¸º<code>Next.js</code>åœ¨æœ¬åœ°å¼€å‘æ¨¡å¼æ–¹ä¾¿æˆ‘ä»¬è°ƒè¯•è¿›è¡Œçš„è¾“å‡ºï¼Œåç»­ç”Ÿäº§ç¯å¢ƒå°±çœ‹ä¸åˆ°äº†ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0db6aa23499f48b9a56849f256ecdea8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=hdoJuK8fqXEECyTtIWqgwPb44sk%3D" alt="log.png" loading="lazy"/></p>
<h4 data-id="heading-4">æœåŠ¡ç«¯ç»„ä»¶çš„ä¼˜ç‚¹</h4>
<ul>
<li>å®‰å…¨æ€§: æˆ‘ä»¬åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­è®¿é—®ä¸€äº›APIç§˜é’¥ï¼Œä»¤ç‰Œç­‰å…¶ä»–æœºå¯†ï¼Œä¸ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯ã€‚</li>
<li>ä½“ç§¯: å› ä¸ºæœåŠ¡ç«¯ç»„ä»¶åœ¨æœåŠ¡å™¨æ¸²æŸ“ï¼Œæ‰€ä»¥ä¸ä¼šè¢«æ‰“åŒ…åˆ°å®¢æˆ·ç«¯ï¼Œæ‰€ä»¥ä½“ç§¯æ›´å°ã€‚</li>
<li>å…¨æ ˆï¼šå¯ä»¥åœ¨æœåŠ¡ç«¯ç»„ä»¶è®¿é—®æ•°æ®åº“ï¼Œæ–‡ä»¶ç³»ç»Ÿç­‰å…¶ä»–APIï¼Œå®ç°å…¨æ ˆå¼€å‘ã€‚</li>
<li>FCP(é¦–æ¬¡å†…å®¹ç»˜åˆ¶): å› ä¸ºæœåŠ¡ç«¯ç»„ä»¶æ˜¯æµå¼ä¼ è¾“ï¼Œæ‰€ä»¥è¾¹æ¸²æŸ“è¾¹è¿”å›ï¼Œæé«˜äº†FCP(é¦–æ¬¡å†…å®¹ç»˜åˆ¶)æ€§èƒ½ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f72515d00ef4630bb4060be0566fbf0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=xD5vrfztsOQluVrbZ6ECbjSs28w%3D" alt="fcp.png" loading="lazy"/></p>
<h4 data-id="heading-5">æœåŠ¡ç«¯ç»„ä»¶çš„ç¼ºç‚¹</h4>
<ul>
<li>äº¤äº’æ€§: å› ä¸ºæœåŠ¡ç«¯ç»„ä»¶åœ¨æœåŠ¡å™¨æ¸²æŸ“ï¼Œæ‰€ä»¥æ— æ³•è®¿é—®æµè§ˆå™¨APIï¼Œæ‰€ä»¥æ— æ³•è¿›è¡Œäº¤äº’ã€‚</li>
<li>hooks: <code>useEffect</code> <code>useState</code> ç­‰hooksåœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­æ— æ³•ä½¿ç”¨ã€‚</li>
</ul>
<p>JavaScript: æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„(ECMAScript,DOM,BOM)ï¼Œåœ¨æœåŠ¡ç«¯ç»„ä»¶åªèƒ½ä½¿ç”¨<code>ECMAScript</code>éƒ¨åˆ†ï¼Œæ— æ³•è®¿é—®<code>DOM</code>å’Œ<code>BOM</code>ã€‚</p>
<p>ECMAScript: å°±æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å¯¹è±¡ï¼Œæ•°ç»„ï¼Œes6+ç­‰è¿™äº›ä¸œè¥¿æ˜¯é€šç”¨çš„åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½èƒ½ç”¨ã€‚</p>
<blockquote>
<p>å¦‚æœè¦ä½¿ç”¨ä»¥ä¸‹æœ‰äº¤äº’æ€§çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å®¢æˆ·ç«¯ç»„ä»¶ã€‚</p>
</blockquote>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { useEffect,useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ServerPage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">document</span>,<span class="hljs-variable language_">window</span>)
    }, [])
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Server Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;ç‚¹å‡»<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<h2 data-id="heading-6">å®¢æˆ·ç«¯ç»„ä»¶(Client Components)</h2>
<p>å£°æ˜å®¢æˆ·ç«¯ç»„ä»¶éœ€è¦åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ç¼–å†™ <code>'use client'</code> å£°æ˜è¿™æ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œä½†æ˜¯æ³¨æ„å®¢æˆ·ç«¯ç»„ä»¶ä¼šåœ¨æœåŠ¡ç«¯è¿›è¡Œä¸€æ¬¡<code>é¢„æ¸²æŸ“</code>ï¼Œæ‰€ä»¥è®¿é—®<code>document</code> <code>window</code> ç­‰APIéœ€è¦åœ¨<code>useEffect</code>ä¸­è®¿é—®ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-string">'use client'</span>
<span class="hljs-keyword">import</span> { useEffect,useState } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'client'</span>)
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ServerPage</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> [count, setCount] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'client X'</span>)
    <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">document</span>,<span class="hljs-variable language_">window</span>)
    }, [])
    <span class="hljs-keyword">return</span> (
        <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Server Page<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setCount(count + 1)}&gt;ç‚¹å‡»<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>{count}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    )
}
</code></pre>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»–æŠŠ<code>useState</code>çš„0é¢„æ¸²æŸ“äº†å‡ºæ¥è¿™æ ·å¯ä»¥è®©ç”¨æˆ·å…ˆçœ‹åˆ°é¡µé¢ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d1409846d614481ba872306eb658b213~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=MEc7kjsLADFsp%2BfHmc81ynWiivU%3D" alt="pre-render.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd7f7fc934dd4dd39c692e6876d9e2ef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=mjz6PE429g9ajMX0bnBmYHn2izU%3D" alt="pre-render2.png" loading="lazy"/></p>
<h4 data-id="heading-7">ç»„ä»¶åµŒå¥—</h4>
<blockquote>
<p>æœåŠ¡ç«¯ç»„ä»¶å¯ä»¥åµŒå¥—å®¢æˆ·ç«¯ç»„ä»¶ï¼Œå®¢æˆ·ç«¯åªèƒ½åµŒå¥—ä¸èƒ½åµŒå¥—æœåŠ¡ç«¯ç»„ä»¶</p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5ec8e052a2ef4921ab0dcc6d5bcf4ed3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=Vo0WZkK5bifA%2Bd5bxRperz%2FAc9Q%3D" alt="error.png" loading="lazy"/></p>
<p>why:å› ä¸ºå®¢æˆ·ç«¯ä¼šæŠŠä»–æ‰€æœ‰çš„æ¨¡å—ä»¥åŠå­ç»„ä»¶è®¤ä¸ºæ˜¯å®¢æˆ·ç«¯ç»„ä»¶ï¼Œé‚£æ­¤æ—¶å¦‚æœæœåŠ¡ç«¯ç»„ä»¶ç”¨äº†<code>node.js</code>çš„APIï¼Œæˆ–è€…å…¶ä»–æœåŠ¡ç«¯æ“ä½œï¼Œé‚£å°±ä¼šæŠ¥é”™ï¼Œå› ä¸ºå®¢æˆ·ç«¯ç»„ä»¶æ— æ³•è®¿é—®è¿™äº›APIï¼Œæ•…æ­¤å®¢æˆ·ç«¯ç»„ä»¶ä¸èƒ½åµŒå¥—æœåŠ¡ç«¯ç»„ä»¶ã€‚</p>
<h4 data-id="heading-8">server-only</h4>
<p>éšç€Nodejsçš„å‘å±•ï¼Œå¾ˆå¤šAPIå·²ç»å¯ä»¥è·Ÿæµè§ˆå™¨å…±ç”¨äº†ä¾‹å¦‚<code>fetch</code>,<code>webSocket</code>,æœªæ¥Nodejs25æ”¯æŒ<code>localStorage</code>ç­‰API,æ‰€ä»¥å°±ä¼šå‡ºç°è¿™ç§æƒ…å†µ</p>
<p>ä¸‹é¢è¿™ä¸ªå‡½æ•°å¯ä»¥åœ¨æœåŠ¡ç«¯ç»„ä»¶ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥åœ¨å®¢æˆ·ç«¯ç»„ä»¶ä½¿ç”¨ï¼Œä½†æœ‰æ—¶å€™æˆ‘ä»¬åªæƒ³è®©ä»–åœ¨æœåŠ¡ç«¯ä½¿ç”¨</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTest</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>:<span class="hljs-number">0</span> | <span class="hljs-number">1</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.github.com'</span>)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">'wss://api.github.com'</span>)
    }
}
</code></pre>
<pre><code class="hljs language-bash" lang="bash">npm install server-only
or
yarn add server-only
or
pnpm add server-only
</code></pre>
<p>å®‰è£…å®Œæˆè¿™ä¸ªåŒ…ä¹‹åï¼Œåªéœ€è¦åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ç¼–å†™ <code>import 'server-only'</code> å£°æ˜å³å¯ï¼Œè¿™æ ·ä»–å°±ä¼šåœ¨æœåŠ¡ç«¯æ‰§è¡Œï¼Œåœ¨å®¢æˆ·ç«¯æ‰§è¡Œä¼šæŠ¥é”™ã€‚</p>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> <span class="hljs-string">'server-only'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">useTest</span>(<span class="hljs-params"><span class="hljs-keyword">type</span>:<span class="hljs-number">0</span> | <span class="hljs-number">1</span></span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'https://api.github.com'</span>)
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">'wss://api.github.com'</span>)
    }
}
</code></pre>
<p>å®¢æˆ·ç«¯ä½¿ç”¨æŠ¥é”™:</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/af8f17bb04774340bf18806bc25f402f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5ruhenM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765285475&amp;x-signature=RZLeOQiqJi%2BmRMOx59zb9RvsCr4%3D" alt="error2.png" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ158ï¼‰Redisçš„ä¸»ä»åŒæ­¥é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7578714735308079130</link>    <guid>https://juejin.cn/post/7578714735308079130</guid>    <pubDate>2025-12-01T22:57:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578714735308079130" data-draft-id="7578709098256105510" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ158ï¼‰Redisçš„ä¸»ä»åŒæ­¥é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-01T22:57:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ158ï¼‰Redisçš„ä¸»ä»åŒæ­¥é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-01T22:57:42.000Z" title="Mon Dec 01 2025 22:57:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-01
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    19
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redisçš„ä¸»ä»åŒæ­¥é—®é¢˜å¯èƒ½ä¼šå½±å“æ•°æ®ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ã€‚è¦è§£å†³è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ·±å…¥äº†è§£Redisä¸»ä»å¤åˆ¶æœºåˆ¶ï¼Œå¹¶é’ˆå¯¹å…·ä½“åœºæ™¯è¿›è¡Œä¼˜åŒ–å’Œæ•…éšœå¤„ç†ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„è§£å†³æ–¹æ¡ˆå’Œä»£ç ç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-0">1. é…ç½®ä¸»ä»å¤åˆ¶</h3>
<p>é¦–å…ˆï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å’Œå‘½ä»¤è®¾ç½®Redisçš„ä¸»ä»å¤åˆ¶ã€‚</p>
<h4 data-id="heading-1">1.1 é…ç½®ä¸»æœåŠ¡å™¨</h4>
<p>ä¸»æœåŠ¡å™¨ä¸éœ€è¦ç‰¹åˆ«é…ç½®ï¼Œåªéœ€æ­£å¸¸å¯åŠ¨Redisã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸»æœåŠ¡å™¨çš„ redis.conf é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># å¯åŠ¨ä¸»æœåŠ¡å™¨</span>
port 6379
</code></pre>
<h4 data-id="heading-2">1.2 é…ç½®ä»æœåŠ¡å™¨</h4>
<p>åœ¨ä»æœåŠ¡å™¨ä¸Šé…ç½®ä¸ä¸»æœåŠ¡å™¨çš„è¿æ¥ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä»æœåŠ¡å™¨çš„ redis.conf é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># å¯åŠ¨ä»æœåŠ¡å™¨</span>
port 6380

<span class="hljs-comment"># é…ç½®ä¸»æœåŠ¡å™¨çš„IPå’Œç«¯å£</span>
replicaof 127.0.0.1 6379
</code></pre>
<h4 data-id="heading-3">1.3 åŠ¨æ€è®¾ç½®ä»æœåŠ¡å™¨</h4>
<p>å¯ä»¥é€šè¿‡å‘½ä»¤åŠ¨æ€è®¾ç½®ä»æœåŠ¡å™¨ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisReplicationSetup</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>)) {
            <span class="hljs-comment">// è®¾ç½®ä»æœåŠ¡å™¨è¿æ¥åˆ°ä¸»æœåŠ¡å™¨</span>
            jedis.slaveof(<span class="hljs-string">"127.0.0.1"</span>, <span class="hljs-number">6379</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-4">2. è§£å†³ä¸»ä»åŒæ­¥å»¶è¿Ÿé—®é¢˜</h3>
<h4 data-id="heading-5">2.1 è°ƒæ•´å¤åˆ¶ç¼“å†²åŒºå¤§å°</h4>
<p>å¢åŠ ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç¼“å†²åŒºå¤§å°ï¼Œé˜²æ­¢å¤åˆ¶è¿‡ç¨‹ä¸­æ–­ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸»æœåŠ¡å™¨çš„ redis.conf é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># å¤åˆ¶ç¼“å†²åŒºå¤§å°</span>
repl-backlog-size 256mb
</code></pre>
<h4 data-id="heading-6">2.2 è°ƒæ•´å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå¤§å°</h4>
<p>è°ƒæ•´ä¸»æœåŠ¡å™¨çš„å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼ˆrepl-backlog-sizeï¼‰å¤§å°ï¼Œç¡®ä¿åœ¨ç½‘ç»œæŠ–åŠ¨æ—¶ï¼Œä»æœåŠ¡å™¨èƒ½å¤Ÿå¿«é€ŸåŒæ­¥æ•°æ®ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸»æœåŠ¡å™¨çš„ redis.conf é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå¤§å°</span>
repl-backlog-size 256mb
</code></pre>
<h4 data-id="heading-7">2.3 é…ç½®å»¶è¿Ÿç›‘æ§</h4>
<p>è®¾ç½®å¤åˆ¶å»¶è¿Ÿç›‘æ§ï¼ŒåŠæ—¶å‘ç°å¹¶å¤„ç†å»¶è¿Ÿé—®é¢˜ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisReplicationDelayMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>)) {
            <span class="hljs-comment">// è·å–ä»æœåŠ¡å™¨çš„å¤åˆ¶å»¶è¿Ÿä¿¡æ¯</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info(<span class="hljs-string">"replication"</span>);
            System.out.println(info);
        }
    }
}
</code></pre>
<h3 data-id="heading-8">3. å¤„ç†ä¸»ä»åˆ‡æ¢é—®é¢˜</h3>
<p>ä½¿ç”¨Redis Sentinelå®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œç¡®ä¿é«˜å¯ç”¨æ€§ã€‚</p>
<h4 data-id="heading-9">3.1 é…ç½®Redis Sentinel</h4>
<p>é…ç½®Redis Sentinelç›‘æ§ä¸»æœåŠ¡å™¨ï¼Œå¹¶åœ¨ä¸»æœåŠ¡å™¨æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Sentinelé…ç½®æ–‡ä»¶ sentinel.conf</span>

port 26379

<span class="hljs-comment"># Sentinelç›‘æ§çš„ä¸»æœåŠ¡å™¨åç§°åŠåœ°å€å’Œç«¯å£</span>
sentinel monitor mymaster 127.0.0.1 6379 2

<span class="hljs-comment"># ä¸»æœåŠ¡å™¨è¢«è®¤ä¸ºä¸å¯ç”¨çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
sentinel down-after-milliseconds mymaster 5000

<span class="hljs-comment"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
sentinel failover-timeout mymaster 60000

<span class="hljs-comment"># å¹¶è¡ŒåŒæ­¥çš„ä»æœåŠ¡å™¨æ•°é‡</span>
sentinel parallel-syncs mymaster 1
</code></pre>
<h4 data-id="heading-10">3.2 å¯åŠ¨Redis Sentinel</h4>
<pre><code class="hljs language-bash" lang="bash">redis-sentinel /path/to/sentinel.conf
</code></pre>
<h3 data-id="heading-11">4. å¤„ç†å…¨é‡å¤åˆ¶å’Œå¢é‡å¤åˆ¶é—®é¢˜</h3>
<h4 data-id="heading-12">4.1 å¢åŠ å…¨é‡å¤åˆ¶çš„æ€§èƒ½</h4>
<p>é€šè¿‡é…ç½®ç£ç›˜å†™å…¥ç­–ç•¥å’Œå‹ç¼©é€‰é¡¹ï¼Œæé«˜å…¨é‡å¤åˆ¶çš„æ€§èƒ½ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸»æœåŠ¡å™¨çš„ redis.conf é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># ç£ç›˜å†™å…¥ç­–ç•¥</span>
save 900 1
save 300 10
save 60 10000

<span class="hljs-comment"># å‹ç¼©RDBæ–‡ä»¶</span>
rdbcompression <span class="hljs-built_in">yes</span>
</code></pre>
<h4 data-id="heading-13">4.2 ä¼˜åŒ–å¢é‡å¤åˆ¶</h4>
<p>ç¡®ä¿ä¸»ä»æœåŠ¡å™¨ä¹‹é—´çš„ç½‘ç»œè¿æ¥ç¨³å®šã€ä½å»¶è¿Ÿï¼Œå‡å°‘å¢é‡å¤åˆ¶è¿‡ç¨‹ä¸­çš„æ•°æ®ä¸¢å¤±ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä¸»æœåŠ¡å™¨çš„ redis.conf é…ç½®ç¤ºä¾‹</span>

<span class="hljs-comment"># å¤åˆ¶ç§¯å‹ç¼“å†²åŒºå¤§å°</span>
repl-backlog-size 256mb

<span class="hljs-comment"># å¤åˆ¶è¶…æ—¶</span>
repl-timeout 60
</code></pre>
<h3 data-id="heading-14">5. å¤„ç†ç½‘ç»œåˆ†åŒºé—®é¢˜</h3>
<h4 data-id="heading-15">5.1 é…ç½®æ•…éšœè½¬ç§»ç­–ç•¥</h4>
<p>é€šè¿‡é…ç½®Sentinelçš„æ•…éšœè½¬ç§»ç­–ç•¥ï¼Œç¡®ä¿åœ¨ç½‘ç»œåˆ†åŒºæ—¶èƒ½å¤Ÿæ­£ç¡®åœ°è¿›è¡Œä¸»ä»åˆ‡æ¢ã€‚</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Sentinelé…ç½®æ–‡ä»¶ sentinel.conf</span>

<span class="hljs-comment"># Sentinelç›‘æ§çš„ä¸»æœåŠ¡å™¨åç§°åŠåœ°å€å’Œç«¯å£</span>
sentinel monitor mymaster 127.0.0.1 6379 2

<span class="hljs-comment"># ä¸»æœåŠ¡å™¨è¢«è®¤ä¸ºä¸å¯ç”¨çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
sentinel down-after-milliseconds mymaster 5000

<span class="hljs-comment"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</span>
sentinel failover-timeout mymaster 60000

<span class="hljs-comment"># å¹¶è¡ŒåŒæ­¥çš„ä»æœåŠ¡å™¨æ•°é‡</span>
sentinel parallel-syncs mymaster 1

<span class="hljs-comment"># è®¾ç½®ç½‘ç»œåˆ†åŒºæ—¶çš„æ•…éšœè½¬ç§»ç­–ç•¥</span>
sentinel config-epoch mymaster 0
sentinel leader-epoch mymaster 0
</code></pre>
<h4 data-id="heading-16">5.2 å®ç°å®¢æˆ·ç«¯é‡è¯•æœºåˆ¶</h4>
<p>åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å¢åŠ é‡è¯•æœºåˆ¶ï¼Œç¡®ä¿åœ¨ç½‘ç»œåˆ†åŒºæ—¶èƒ½å¤Ÿè‡ªåŠ¨é‡è¿ã€‚</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisClientRetry</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">maxRetries</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">attempt</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">connected</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
        <span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;

        <span class="hljs-keyword">while</span> (attempt &lt; maxRetries &amp;&amp; !connected) {
            <span class="hljs-keyword">try</span> {
                attempt++;
                jedis = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>);
                <span class="hljs-comment">// æ‰§è¡ŒRedisæ“ä½œ</span>
                jedis.set(<span class="hljs-string">"key"</span>, <span class="hljs-string">"value"</span>);
                System.out.println(<span class="hljs-string">"Value for 'key': "</span> + jedis.get(<span class="hljs-string">"key"</span>));
                connected = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">catch</span> (Exception e) {
                System.err.println(<span class="hljs-string">"Attempt "</span> + attempt + <span class="hljs-string">" failed: "</span> + e.getMessage());
            } <span class="hljs-keyword">finally</span> {
                <span class="hljs-keyword">if</span> (jedis != <span class="hljs-literal">null</span>) {
                    jedis.close();
                }
            }

            <span class="hljs-keyword">if</span> (!connected) {
                <span class="hljs-keyword">try</span> {
                    Thread.sleep(<span class="hljs-number">2000</span>);  <span class="hljs-comment">// ç­‰å¾…2ç§’åé‡è¯•</span>
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                }
            }
        }

        <span class="hljs-keyword">if</span> (!connected) {
            System.err.println(<span class="hljs-string">"Failed to connect to Redis after "</span> + maxRetries + <span class="hljs-string">" attempts."</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-17">6. æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–</h3>
<p>é€šè¿‡Redisè‡ªå¸¦çš„ç›‘æ§å·¥å…·ï¼ˆå¦‚<code>INFO</code>å‘½ä»¤ï¼‰æˆ–ç¬¬ä¸‰æ–¹ç›‘æ§å·¥å…·ï¼ˆå¦‚Redis Exporterç»“åˆPrometheuså’ŒGrafanaï¼‰æ¥ç›‘æ§ä¸»ä»åŒæ­¥çŠ¶æ€ï¼Œå¹¶åŠæ—¶ä¼˜åŒ–ã€‚</p>
<h4 data-id="heading-18">6.1 ä½¿ç”¨<code>INFO</code>å‘½ä»¤ç›‘æ§å¤åˆ¶çŠ¶æ€</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisReplicationMonitor</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>)) {
            <span class="hljs-comment">// è·å–ä»æœåŠ¡å™¨çš„å¤åˆ¶çŠ¶æ€ä¿¡æ¯</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">info</span> <span class="hljs-operator">=</span> jedis.info(<span class="hljs-string">"replication"</span>);
            System.out.println(info);
        }
    }
}
</code></pre>
<h4 data-id="heading-19">6.2 ä½¿ç”¨Redis Exporterç»“åˆPrometheuså’ŒGrafana</h4>
<ol>
<li>
<p><strong>éƒ¨ç½²Redis Exporter</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">docker run -d --name redis_exporter -p 9121:9121 oliver006/redis_exporter
</code></pre>
</li>
<li>
<p><strong>é…ç½®Prometheusç›‘æ§Redis Exporter</strong>ï¼š
åœ¨Prometheusé…ç½®æ–‡ä»¶<code>prometheus.yml</code>ä¸­æ·»åŠ Redis Exporterçš„jobï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">scrape_configs:</span>
  <span class="hljs-bullet">-</span> <span class="hljs-attr">job_name:</span> <span class="hljs-string">'redis_exporter'</span>
    <span class="hljs-attr">static_configs:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">targets:</span> [<span class="hljs-string">'localhost:9121'</span>]
</code></pre>
</li>
<li>
<p><strong>åœ¨Grafanaä¸­æ·»åŠ Prometheusæ•°æ®æºå¹¶åˆ›å»ºç›‘æ§é¢æ¿</strong>ã€‚</p>
</li>
</ol>
<h3 data-id="heading-20">æ€»ç»“</h3>
<p>é€šè¿‡é…ç½®ä¸»ä»å¤åˆ¶ã€ä¼˜åŒ–åŒæ­¥å»¶è¿Ÿã€ä½¿ç”¨Redis Sentinelå¤„ç†ä¸»ä»åˆ‡æ¢ã€è°ƒæ•´å…¨é‡å’Œå¢é‡å¤åˆ¶å‚æ•°ã€å¤„ç†ç½‘ç»œåˆ†åŒºï¼Œä»¥åŠé€šè¿‡ç›‘æ§å·¥å…·è¿›è¡Œæ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–ï¼Œå¯ä»¥æœ‰æ•ˆè§£å†³Redisçš„ä¸»ä»åŒæ­¥é—®é¢˜ã€‚ä¸Šè¿°ä»£ç ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•é€šè¿‡Javaä»£ç ç»“åˆJedisåº“æ¥å®ç°è¿™äº›ä¼˜åŒ–ç­–ç•¥ï¼Œç¡®ä¿Redisä¸»ä»åŒæ­¥çš„ç¨³å®šæ€§å’Œé«˜æ•ˆæ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++æ™ºèƒ½æŒ‡é’ˆé¿å‘æŒ‡å—ï¼š90%äººä¼šçŠ¯çš„3ä¸ªè‡´å‘½é”™è¯¯]]></title>    <link>https://juejin.cn/post/7579101504289488950</link>    <guid>https://juejin.cn/post/7579101504289488950</guid>    <pubDate>2025-12-02T14:41:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579101504289488950" data-draft-id="7579101504289472566" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++æ™ºèƒ½æŒ‡é’ˆé¿å‘æŒ‡å—ï¼š90%äººä¼šçŠ¯çš„3ä¸ªè‡´å‘½é”™è¯¯"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-02T14:41:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç äº‹æ¼«è°ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++æ™ºèƒ½æŒ‡é’ˆé¿å‘æŒ‡å—ï¼š90%äººä¼šçŠ¯çš„3ä¸ªè‡´å‘½é”™è¯¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç äº‹æ¼«è°ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T14:41:16.000Z" title="Tue Dec 02 2025 14:41:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä½ ä»¥ä¸ºå°†<code>new</code>æ›¿æ¢ä¸º<code>make_shared</code>å°±ä¸‡äº‹å¤§å‰ï¼ŸçœŸç›¸æ˜¯ï¼Œæ™ºèƒ½æŒ‡é’ˆçš„é™·é˜±æ¯”æ‰‹åŠ¨ç®¡ç†æ›´éšè”½ã€æ›´å±é™©ã€‚æœ¬æ–‡å°†æ·±å…¥å‰–æå¾ªç¯å¼•ç”¨ã€æ€§èƒ½é™·é˜±ã€çº¿ç¨‹å®‰å…¨è¿™ä¸‰å¤§ã€Œæš—ç¤ã€ï¼Œè®©ä½ ä»ã€Œè‡ªä»¥ä¸ºä¼šã€åˆ°ã€ŒçœŸæ­£ç²¾é€šã€ã€‚</p>
</blockquote>
<h2 data-id="heading-0"><strong>ä¸€ä¸ªç»å…¸çš„å´©æºƒä»£ç </strong></h2>
<p>å¦‚ä¸‹ä»£ç å±•éœ²äº†æ™ºèƒ½æŒ‡é’ˆä¸­çš„<strong>å¾ªç¯å¼•ç”¨</strong>é—®é¢˜ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è¿™å°±æ˜¯é‚£ä¸ªå¯¼è‡´å´©æºƒçš„ç®€åŒ–ç‰ˆä»£ç </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfile</span> {
    std::shared_ptr&lt;UserProfile&gt; recommend_to;  <span class="hljs-comment">// æ¨èç»™è°</span>
    <span class="hljs-comment">// ... å…¶ä»–æ•°æ®</span>
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">create_recommendation_cycle</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> user1 = std::<span class="hljs-built_in">make_shared</span>&lt;UserProfile&gt;();
    <span class="hljs-keyword">auto</span> user2 = std::<span class="hljs-built_in">make_shared</span>&lt;UserProfile&gt;();
    
    user1-&gt;recommend_to = user2;  <span class="hljs-comment">// user1æ¨èuser2</span>
    user2-&gt;recommend_to = user1;  <span class="hljs-comment">// user2åˆæ¨èuser1</span>
    
    <span class="hljs-comment">// ç¦»å¼€ä½œç”¨åŸŸåï¼Œå¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¼šå½’é›¶ï¼</span>
    <span class="hljs-comment">// å†…å­˜æ³„æ¼ï¼Œæœ€ç»ˆOOMï¼ˆå†…å­˜è€—å°½ï¼‰</span>
}
</code></pre>
<p>è¿™å°±æ˜¯æ™ºèƒ½æŒ‡é’ˆæœ€è®½åˆºçš„åœ°æ–¹ï¼š<strong>ä½ ä¸ºäº†é¿å…å†…å­˜æ³„æ¼è€Œä½¿ç”¨å®ƒï¼Œç»“æœå®ƒå´å¯¼è‡´äº†æ›´éšè”½çš„å†…å­˜æ³„æ¼</strong>ã€‚</p>
<h2 data-id="heading-1"><strong>é”™è¯¯ä¸€ï¼šå¾ªç¯å¼•ç”¨â€”â€”æ™ºèƒ½æŒ‡é’ˆçš„ã€Œé¬¼æ‰“å¢™ã€</strong></h2>
<h3 data-id="heading-2"><strong>1.1 å¾ªç¯å¼•ç”¨çš„å…¸å‹åœºæ™¯</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// åœºæ™¯1ï¼šåŒå‘å…³è”ï¼ˆçˆ¶å­èŠ‚ç‚¹ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span> {
<span class="hljs-keyword">public</span>:
    std::shared_ptr&lt;TreeNode&gt; parent;
    std::vector&lt;std::shared_ptr&lt;TreeNode&gt;&gt; children;
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_child</span><span class="hljs-params">(std::shared_ptr&lt;TreeNode&gt; child)</span> </span>{
        children.<span class="hljs-built_in">push_back</span>(child);
        child-&gt;parent = <span class="hljs-built_in">shared_from_this</span>();  <span class="hljs-comment">// è‡´å‘½é”™è¯¯ï¼</span>
    }
};

<span class="hljs-comment">// åœºæ™¯2ï¼šè§‚å¯Ÿè€…æ¨¡å¼ä¸­çš„ç›¸äº’æŒæœ‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span>;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Subject</span> {
    std::vector&lt;std::shared_ptr&lt;Observer&gt;&gt; observers;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Observer</span> {
    std::shared_ptr&lt;Subject&gt; subject;  <span class="hljs-comment">// äº’ç›¸æŒæœ‰ï¼</span>
};

<span class="hljs-comment">// åœºæ™¯3ï¼šç¼“å­˜ç³»ç»Ÿä¸­çš„è‡ªå¼•ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CacheEntry</span> {
    std::shared_ptr&lt;CacheEntry&gt; next_in_lru;  <span class="hljs-comment">// LRUé“¾è¡¨</span>
    std::shared_ptr&lt;CacheEntry&gt; prev_in_lru;
};
</code></pre>
<h3 data-id="heading-3"><strong>1.2 è§£å†³æ–¹æ¡ˆï¼šweak_ptrçš„æ­£ç¡®ä½¿ç”¨</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ­£ç¡®æ–¹æ¡ˆ1ï¼šä½¿ç”¨weak_ptræ‰“ç ´å¾ªç¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">TreeNode</span> {
<span class="hljs-keyword">private</span>:
    std::weak_ptr&lt;TreeNode&gt; parent_;  <span class="hljs-comment">// å…³é”®æ”¹å˜ï¼</span>
    std::vector&lt;std::shared_ptr&lt;TreeNode&gt;&gt; children_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">set_parent</span><span class="hljs-params">(std::shared_ptr&lt;TreeNode&gt; parent)</span> </span>{
        parent_ = parent;  <span class="hljs-comment">// weak_pträ¸ä¼šå¢åŠ å¼•ç”¨è®¡æ•°</span>
    }
    
    <span class="hljs-function">std::shared_ptr&lt;TreeNode&gt; <span class="hljs-title">get_parent</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> parent_.<span class="hljs-built_in">lock</span>();  <span class="hljs-comment">// å°è¯•æå‡ä¸ºshared_ptr</span>
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_child</span><span class="hljs-params">(std::shared_ptr&lt;TreeNode&gt; child)</span> </span>{
        children_.<span class="hljs-built_in">push_back</span>(child);
        child-&gt;<span class="hljs-built_in">set_parent</span>(<span class="hljs-built_in">shared_from_this</span>());
    }
};

<span class="hljs-comment">// æ­£ç¡®æ–¹æ¡ˆ2ï¼šæ˜ç¡®æ‰€æœ‰æƒå…³ç³»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Document</span> {
    <span class="hljs-comment">// æ–‡æ¡£æ‹¥æœ‰é¡µé¢ï¼ˆç‹¬å æ‰€æœ‰æƒï¼‰</span>
    std::vector&lt;std::unique_ptr&lt;Page&gt;&gt; pages_;
    
    <span class="hljs-comment">// é¡µé¢å¯ä»¥å¼•ç”¨æ–‡æ¡£ï¼Œä½†ä¸æ‹¥æœ‰</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Page</span> {
        Document* document_;  <span class="hljs-comment">// åŸå§‹æŒ‡é’ˆï¼å®‰å…¨å—ï¼Ÿ</span>
        <span class="hljs-comment">// è¿™é‡Œçš„å…³é”®ï¼šç”Ÿå‘½å‘¨æœŸç”±Documentç®¡ç†</span>
    };
};
</code></pre>
<h3 data-id="heading-4"><strong>1.3 æ·±åº¦åˆ†æï¼šweak_ptrçš„å·¥ä½œåŸç†</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// weak_ptrå†…éƒ¨æœºåˆ¶æ¨¡æ‹Ÿ</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WeakPtr</span> {
<span class="hljs-keyword">private</span>:
    T* ptr_;                    <span class="hljs-comment">// æŒ‡å‘å®é™…å¯¹è±¡</span>
    ControlBlock* control_block_;  <span class="hljs-comment">// ä¸shared_ptrå…±äº«çš„æ§åˆ¶å—</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// lock()æ–¹æ³•çš„å®ç°</span>
    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">lock</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> <span class="hljs-keyword">noexcept</span> </span>{
        <span class="hljs-keyword">if</span>(control_block_ &amp;&amp; control_block_-&gt;ref_count &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// å¯¹è±¡è¿˜æ´»ç€ï¼Œåˆ›å»ºæ–°çš„shared_ptr</span>
            <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;(*<span class="hljs-keyword">this</span>);
        }
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;();  <span class="hljs-comment">// è¿”å›ç©ºshared_ptr</span>
    }
    
    <span class="hljs-comment">// æ§åˆ¶å—ç»“æ„</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ControlBlock</span> {
        std::atomic&lt;<span class="hljs-type">size_t</span>&gt; ref_count{<span class="hljs-number">1</span>};     <span class="hljs-comment">// å¼ºå¼•ç”¨è®¡æ•°</span>
        std::atomic&lt;<span class="hljs-type">size_t</span>&gt; weak_count{<span class="hljs-number">1</span>};    <span class="hljs-comment">// å¼±å¼•ç”¨è®¡æ•°</span>
        T* object_ptr{<span class="hljs-literal">nullptr</span>};
        
        ~<span class="hljs-built_in">ControlBlock</span>() {
            <span class="hljs-keyword">if</span>(ref_count == <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">delete</span> object_ptr;  <span class="hljs-comment">// åªæœ‰å¼ºå¼•ç”¨ä¸º0æ—¶æ‰åˆ é™¤å¯¹è±¡</span>
            }
            <span class="hljs-comment">// weak_countä¸º0æ—¶åˆ é™¤æ§åˆ¶å—æœ¬èº«</span>
        }
    };
};
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><code>weak_ptr</code>ä¸å¢åŠ <strong>å¼ºå¼•ç”¨è®¡æ•°</strong>ï¼Œåªå¢åŠ <strong>å¼±å¼•ç”¨è®¡æ•°</strong></li>
<li>å¯¹è±¡é”€æ¯çš„æ¡ä»¶ï¼šå¼ºå¼•ç”¨è®¡æ•° == 0</li>
<li>æ§åˆ¶å—é”€æ¯çš„æ¡ä»¶ï¼šå¼ºå¼•ç”¨è®¡æ•° == 0 <strong>ä¸”</strong> å¼±å¼•ç”¨è®¡æ•° == 0</li>
</ul>
<h3 data-id="heading-5"><strong>1.4 å¾ªç¯å¼•ç”¨æ£€æµ‹å·¥å…·</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// è¿è¡Œæ—¶æ£€æµ‹å·¥å…·</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CyclicReferenceDetector</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">has_cycle</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;T&gt;&amp; start)</span> </span>{
        std::unordered_set&lt;<span class="hljs-type">void</span>*&gt; visited;
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">detect_cycle</span>(start, visited);
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
    <span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">detect_cycle</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;T&gt;&amp; current,
                            std::unordered_set&lt;<span class="hljs-type">void</span>*&gt;&amp; visited)</span> </span>{
        <span class="hljs-keyword">if</span>(!current) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        
        <span class="hljs-type">void</span>* address = current.<span class="hljs-built_in">get</span>();
        <span class="hljs-keyword">if</span>(visited.<span class="hljs-built_in">count</span>(address)) {
            std::cerr &lt;&lt; <span class="hljs-string">"Cycle detected at: "</span> &lt;&lt; <span class="hljs-built_in">typeid</span>(T).<span class="hljs-built_in">name</span>() 
                     &lt;&lt; <span class="hljs-string">" ["</span> &lt;&lt; address &lt;&lt; <span class="hljs-string">"]"</span> &lt;&lt; std::endl;
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        
        visited.<span class="hljs-built_in">insert</span>(address);
        
        <span class="hljs-comment">// ä½¿ç”¨åå°„æˆ–æ‰‹åŠ¨æ³¨å†Œæ¥éå†æˆå‘˜</span>
        <span class="hljs-comment">// è¿™é‡Œç®€åŒ–ï¼Œå®é™…éœ€è¦æ›´å¤æ‚çš„æœºåˆ¶</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">check_for_cycles</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> obj = std::<span class="hljs-built_in">make_shared</span>&lt;TreeNode&gt;();
    <span class="hljs-comment">// ... æ„å»ºå¯èƒ½å¾ªç¯çš„ç»“æ„</span>
    
    <span class="hljs-keyword">if</span>(CyclicReferenceDetector::<span class="hljs-built_in">has_cycle</span>(obj)) {
        std::cerr &lt;&lt; <span class="hljs-string">"WARNING: Memory leak due to cyclic reference!"</span> &lt;&lt; std::endl;
    }
}
</code></pre>
<h2 data-id="heading-6"><strong>é”™è¯¯äºŒï¼šæ€§èƒ½é™·é˜±â€”â€”ä½ ä»¥ä¸ºçš„ã€Œé›¶æˆæœ¬ã€æŠ½è±¡</strong></h2>
<h3 data-id="heading-7"><strong>2.1 shared_ptrçš„éšè—æˆæœ¬</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ€§èƒ½æµ‹è¯•ï¼šshared_ptr vs åŸå§‹æŒ‡é’ˆ</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">benchmark_shared_ptr</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">size_t</span> ITERATIONS = <span class="hljs-number">1000000</span>;
    std::vector&lt;std::shared_ptr&lt;Data&gt;&gt; shared_ptrs;
    std::vector&lt;Data*&gt; raw_ptrs;
    
    <span class="hljs-comment">// åˆ›å»ºå¼€é”€</span>
    <span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; ITERATIONS; ++i) {
        shared_ptrs.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_shared</span>&lt;Data&gt;(i));
    }
    <span class="hljs-keyword">auto</span> shared_create = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>() - start;
    
    start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; ITERATIONS; ++i) {
        raw_ptrs.<span class="hljs-built_in">push_back</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Data</span>(i));
    }
    <span class="hljs-keyword">auto</span> raw_create = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>() - start;
    
    std::cout &lt;&lt; <span class="hljs-string">"åˆ›å»ºå¼€é”€:\n"</span>
              &lt;&lt; <span class="hljs-string">"  shared_ptr: "</span> 
              &lt;&lt; std::chrono::<span class="hljs-built_in">duration</span>&lt;<span class="hljs-type">double</span>, std::milli&gt;(shared_create).<span class="hljs-built_in">count</span>()
              &lt;&lt; <span class="hljs-string">"ms\n"</span>
              &lt;&lt; <span class="hljs-string">"  åŸå§‹æŒ‡é’ˆ: "</span>
              &lt;&lt; std::chrono::<span class="hljs-built_in">duration</span>&lt;<span class="hljs-type">double</span>, std::milli&gt;(raw_create).<span class="hljs-built_in">count</span>()
              &lt;&lt; <span class="hljs-string">"ms\n"</span>;
    
    <span class="hljs-comment">// æ‹·è´å¼€é”€</span>
    start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    <span class="hljs-keyword">for</span>(<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; ITERATIONS; ++i) {
        <span class="hljs-keyword">auto</span> copy = shared_ptrs[i];  <span class="hljs-comment">// åŸå­æ“ä½œï¼</span>
    }
    <span class="hljs-keyword">auto</span> shared_copy = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>() - start;
    
    std::cout &lt;&lt; <span class="hljs-string">"æ‹·è´å¼€é”€:\n"</span>
              &lt;&lt; <span class="hljs-string">"  shared_ptr: "</span>
              &lt;&lt; std::chrono::<span class="hljs-built_in">duration</span>&lt;<span class="hljs-type">double</span>, std::milli&gt;(shared_copy).<span class="hljs-built_in">count</span>()
              &lt;&lt; <span class="hljs-string">"ms (æ¯ä¸ªæ‹·è´çº¦"</span>
              &lt;&lt; std::chrono::<span class="hljs-built_in">duration</span>&lt;<span class="hljs-type">double</span>, std::nano&gt;(shared_copy).<span class="hljs-built_in">count</span>()/ITERATIONS
              &lt;&lt; <span class="hljs-string">"ns)\n"</span>;
}
</code></pre>
<p><strong>æ€§èƒ½å¼€é”€æ¥æº</strong>ï¼š</p>
<ol>
<li><strong>æ§åˆ¶å—åˆ†é…</strong>ï¼šé¢å¤–çš„ä¸€æ¬¡å†…å­˜åˆ†é…ï¼ˆé™¤éç”¨<code>make_shared</code>ï¼‰</li>
<li><strong>åŸå­æ“ä½œ</strong>ï¼šå¼•ç”¨è®¡æ•°çš„å¢å‡éœ€è¦åŸå­æ“ä½œï¼Œå½±å“å¤šæ ¸æ€§èƒ½</li>
<li><strong>ç¼“å­˜ä¸å‹å¥½</strong>ï¼šå¯¹è±¡å’Œæ§åˆ¶å—å¯èƒ½ä¸åœ¨åŒä¸€ç¼“å­˜è¡Œ</li>
<li><strong>è™šå‡½æ•°å¼€é”€</strong>ï¼šè‡ªå®šä¹‰åˆ é™¤å™¨å’Œåˆ†é…å™¨å¯èƒ½å¼•å…¥é—´æ¥è°ƒç”¨</li>
</ol>
<h3 data-id="heading-8"><strong>2.2 make_shared vs shared_ptræ„é€ å‡½æ•°</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å…³é”®åŒºåˆ«ï¼šå†…å­˜å¸ƒå±€</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LargeObject</span> {
    <span class="hljs-type">char</span> data[<span class="hljs-number">1024</span>];  <span class="hljs-comment">// 1KBæ•°æ®</span>
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">memory_layout_demo</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æ–¹å¼1ï¼šä¸¤æ¬¡å†…å­˜åˆ†é…</span>
    <span class="hljs-function">std::shared_ptr&lt;LargeObject&gt; <span class="hljs-title">p1</span><span class="hljs-params">(<span class="hljs-keyword">new</span> LargeObject)</span></span>;
    <span class="hljs-comment">// å †å¸ƒå±€ï¼š[æ§åˆ¶å—] ... [LargeObject]</span>
    <span class="hljs-comment">// ä¸¤æ¬¡åˆ†é…ï¼Œå¯èƒ½å†…å­˜ç¢ç‰‡</span>
    
    <span class="hljs-comment">// æ–¹å¼2ï¼šä¸€æ¬¡å†…å­˜åˆ†é…ï¼ˆæ¨èï¼‰</span>
    <span class="hljs-keyword">auto</span> p2 = std::<span class="hljs-built_in">make_shared</span>&lt;LargeObject&gt;();
    <span class="hljs-comment">// å †å¸ƒå±€ï¼š[æ§åˆ¶å— + LargeObject]</span>
    <span class="hljs-comment">// å•æ¬¡åˆ†é…ï¼Œæ›´å¥½çš„å±€éƒ¨æ€§</span>
    
    <span class="hljs-comment">// ä½†æ³¨æ„ï¼šweak_pträ¼šé˜»æ­¢æ•´ä¸ªå†…å­˜å—é‡Šæ”¾</span>
    std::weak_ptr&lt;LargeObject&gt; weak = p2;
    p2.<span class="hljs-built_in">reset</span>();  <span class="hljs-comment">// LargeObjectææ„ï¼Œä½†å†…å­˜ç›´åˆ°weaké”€æ¯æ‰é‡Šæ”¾</span>
}
</code></pre>
<h3 data-id="heading-9"><strong>2.3 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç­–ç•¥1ï¼šä¼˜å…ˆä½¿ç”¨unique_ptr</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// æ± æ‹¥æœ‰æ‰€æœ‰è¿æ¥</span>
    std::vector&lt;std::unique_ptr&lt;Connection&gt;&gt; connections_;
    
    <span class="hljs-comment">// å€Ÿå‡ºæ—¶è¿”å›åŸå§‹æŒ‡é’ˆæˆ–å¼•ç”¨</span>
    <span class="hljs-function">Connection* <span class="hljs-title">borrow_connection</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> connections_[next_available_].<span class="hljs-built_in">get</span>();
    }
    
    <span class="hljs-comment">// unique_ptræ²¡æœ‰å¼•ç”¨è®¡æ•°å¼€é”€</span>
    <span class="hljs-comment">// æ‰€æœ‰æƒæ¸…æ™°ï¼Œé›¶é¢å¤–æˆæœ¬</span>
};

<span class="hljs-comment">// ç­–ç•¥2ï¼šä¼ é€’constå¼•ç”¨è€Œä¸æ˜¯æ‹·è´shared_ptr</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_data_bad</span><span class="hljs-params">(<span class="hljs-type">const</span> std::shared_ptr&lt;Data&gt;&amp; data)</span> </span>{
    <span class="hljs-comment">// è¿™é‡Œçœ‹ä¼¼æ²¡æœ‰æ‹·è´ï¼Œä½†å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹æœ‰</span>
    <span class="hljs-keyword">auto</span> local_copy = data;  <span class="hljs-comment">// åŸå­é€’å¢ï¼</span>
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process_data_good</span><span class="hljs-params">(<span class="hljs-type">const</span> Data&amp; data)</span> </span>{  <span class="hljs-comment">// ç›´æ¥ä¼ é€’å¼•ç”¨</span>
    <span class="hljs-comment">// æ²¡æœ‰å¼•ç”¨è®¡æ•°æ“ä½œ</span>
    <span class="hljs-comment">// è°ƒç”¨è€…éœ€ä¿è¯dataçš„ç”Ÿå‘½å‘¨æœŸ</span>
}

<span class="hljs-comment">// ç­–ç•¥3ï¼šå±€éƒ¨ä½¿ç”¨shared_ptrï¼Œé•¿æœŸä½¿ç”¨weak_ptr</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SessionManager</span> {
<span class="hljs-keyword">private</span>:
    std::unordered_map&lt;SessionId, std::weak_ptr&lt;Session&gt;&gt; sessions_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">std::shared_ptr&lt;Session&gt; <span class="hljs-title">get_session</span><span class="hljs-params">(SessionId id)</span> </span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">auto</span> it = sessions_.<span class="hljs-built_in">find</span>(id); it != sessions_.<span class="hljs-built_in">end</span>()) {
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">auto</span> session = it-&gt;second.<span class="hljs-built_in">lock</span>()) {
                <span class="hljs-keyword">return</span> session;  <span class="hljs-comment">// ä¼šè¯è¿˜æ´»ç€</span>
            }
            sessions_.<span class="hljs-built_in">erase</span>(it);  <span class="hljs-comment">// ä¼šè¯å·²è¿‡æœŸï¼Œæ¸…ç†</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">register_session</span><span class="hljs-params">(SessionId id, std::shared_ptr&lt;Session&gt; session)</span> </span>{
        sessions_[id] = session;  <span class="hljs-comment">// å­˜å‚¨weak_ptrï¼Œä¸é˜»æ­¢é”€æ¯</span>
    }
};
</code></pre>
<h3 data-id="heading-10"><strong>2.4 åŸå­æ“ä½œçš„æ€§èƒ½å½±å“</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// shared_ptrå¼•ç”¨è®¡æ•°çš„åŸå­æ“ä½œï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedPtr</span> {
    T* ptr;
    std::atomic&lt;<span class="hljs-type">long</span>&gt;* ref_count;  <span class="hljs-comment">// åŸå­ç±»å‹</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">SharedPtr</span>(<span class="hljs-type">const</span> SharedPtr&amp; other) : <span class="hljs-built_in">ptr</span>(other.ptr), <span class="hljs-built_in">ref_count</span>(other.ref_count) {
        <span class="hljs-comment">// å†…å­˜å±éšœï¼å½±å“å¤šæ ¸æ€§èƒ½</span>
        ref_count-&gt;<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>, std::memory_order_relaxed);
    }
    
    ~<span class="hljs-built_in">SharedPtr</span>() {
        <span class="hljs-keyword">if</span>(ref_count-&gt;<span class="hljs-built_in">fetch_sub</span>(<span class="hljs-number">1</span>, std::memory_order_acq_rel) == <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">delete</span> ptr;
            <span class="hljs-keyword">delete</span> ref_count;
        }
    }
};

<span class="hljs-comment">// æ€§èƒ½å¯¹æ¯”ï¼šå•çº¿ç¨‹ vs å¤šçº¿ç¨‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">atomic_overhead_demo</span><span class="hljs-params">()</span> </span>{
    std::atomic&lt;<span class="hljs-type">int</span>&gt; atomic_counter{<span class="hljs-number">0</span>};
    <span class="hljs-type">int</span> non_atomic_counter = <span class="hljs-number">0</span>;
    
    <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> ITERATIONS = <span class="hljs-number">10000000</span>;
    
    <span class="hljs-comment">// å•çº¿ç¨‹æ€§èƒ½</span>
    <span class="hljs-keyword">auto</span> start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ITERATIONS; ++i) {
        atomic_counter.<span class="hljs-built_in">fetch_add</span>(<span class="hljs-number">1</span>, std::memory_order_relaxed);
    }
    <span class="hljs-keyword">auto</span> atomic_time = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>() - start;
    
    start = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>();
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; ITERATIONS; ++i) {
        ++non_atomic_counter;
    }
    <span class="hljs-keyword">auto</span> non_atomic_time = std::chrono::high_resolution_clock::<span class="hljs-built_in">now</span>() - start;
    
    std::cout &lt;&lt; <span class="hljs-string">"åŸå­æ“ä½œå¼€é”€: "</span>
              &lt;&lt; std::chrono::<span class="hljs-built_in">duration</span>&lt;<span class="hljs-type">double</span>, std::milli&gt;(atomic_time).<span class="hljs-built_in">count</span>() / 
                 std::chrono::<span class="hljs-built_in">duration</span>&lt;<span class="hljs-type">double</span>, std::milli&gt;(non_atomic_time).<span class="hljs-built_in">count</span>()
              &lt;&lt; <span class="hljs-string">"å€\n"</span>;
}
</code></pre>
<h2 data-id="heading-11"><strong>é”™è¯¯ä¸‰ï¼šçº¿ç¨‹å®‰å…¨â€”â€”æœ€å±é™©çš„å¹»è§‰</strong></h2>
<h3 data-id="heading-12"><strong>3.1 shared_ptrçš„çº¿ç¨‹å®‰å…¨å±‚çº§</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// shared_ptrçš„çº¿ç¨‹å®‰å…¨æ˜¯åˆ†å±‚çš„ï¼š</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafetyLevels</span> {
    <span class="hljs-comment">// çº§åˆ«1ï¼šæ§åˆ¶å—çº¿ç¨‹å®‰å…¨ï¼ˆæ ‡å‡†ä¿è¯ï¼‰</span>
    <span class="hljs-comment">//   - å¼•ç”¨è®¡æ•°çš„å¢å‡æ˜¯åŸå­çš„</span>
    <span class="hljs-comment">//   - ä¸åŒçš„shared_ptrå®ä¾‹å¯ä»¥è¢«ä¸åŒçº¿ç¨‹å®‰å…¨åœ°ææ„</span>
    
    <span class="hljs-comment">// çº§åˆ«2ï¼šæŒ‡å‘çš„æ•°æ®çº¿ç¨‹ä¸å®‰å…¨ï¼</span>
    <span class="hljs-comment">//   - shared_pträ¸ä¿è¯å…¶ç®¡ç†çš„å¯¹è±¡çš„çº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-comment">//   - å¤šä¸ªçº¿ç¨‹åŒæ—¶è¯»å†™åŒä¸€ä¸ªå¯¹è±¡éœ€è¦å¤–éƒ¨åŒæ­¥</span>
    
    <span class="hljs-comment">// çº§åˆ«3ï¼šåŒä¸€ä¸ªshared_ptrå®ä¾‹çš„è¯»å†™ä¸å®‰å…¨ï¼</span>
    <span class="hljs-comment">//   - åŒä¸€ä¸ªshared_ptrå¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹è¯»å†™éœ€è¦åŒæ­¥</span>
};

<span class="hljs-comment">// è¯æ˜ï¼šshared_ptrå†…éƒ¨ä¸ä¿æŠ¤å¯¹è±¡</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">concurrent_access_problem</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">auto</span> shared_data = std::make_shared&lt;std::vector&lt;<span class="hljs-type">int</span>&gt;&gt;();
    
    <span class="hljs-comment">// çº¿ç¨‹1ï¼šä¿®æ”¹æ•°æ®</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">([&amp;shared_data]() {
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; ++i) {
            shared_data-&gt;push_back(i);  <span class="hljs-comment">// ç«æ€æ¡ä»¶ï¼</span>
        }
    })</span></span>;
    
    <span class="hljs-comment">// çº¿ç¨‹2ï¼šåŒæ—¶è¯»å–</span>
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">([&amp;shared_data]() {
        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; ++i) {
            <span class="hljs-keyword">if</span>(!shared_data-&gt;empty()) {
                <span class="hljs-type">int</span> value = shared_data-&gt;back();  <span class="hljs-comment">// å¯èƒ½è¯»å–åˆ°æ— æ•ˆæ•°æ®ï¼</span>
            }
        }
    })</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    <span class="hljs-comment">// ç»“æœï¼šæœªå®šä¹‰è¡Œä¸ºï¼å¯èƒ½å´©æºƒæˆ–æ•°æ®æŸå</span>
}
</code></pre>
<h3 data-id="heading-13"><strong>3.2 å…¸å‹çº¿ç¨‹å®‰å…¨é—®é¢˜</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// é—®é¢˜1ï¼šé”™è¯¯çš„ã€Œçº¿ç¨‹å®‰å…¨ã€å‡è®¾</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadUnsafeCache</span> {
    std::unordered_map&lt;std::string, std::shared_ptr&lt;Data&gt;&gt; cache_;
    std::mutex mutex_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function">std::shared_ptr&lt;Data&gt; <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; key)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">auto</span> it = cache_.<span class="hljs-built_in">find</span>(key); it != cache_.<span class="hljs-built_in">end</span>()) {
            <span class="hljs-keyword">return</span> it-&gt;second;  <span class="hljs-comment">// çœ‹ä¼¼å®‰å…¨...</span>
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    }
    
    <span class="hljs-comment">// é—®é¢˜ï¼šè¿”å›çš„shared_ptrå¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶æŒæœ‰</span>
    <span class="hljs-comment">// å®ƒä»¬å¯ä»¥åŒæ—¶ä¿®æ”¹Dataï¼Œè€ŒDataæ²¡æœ‰å†…ç½®çš„çº¿ç¨‹ä¿æŠ¤ï¼</span>
};

<span class="hljs-comment">// é—®é¢˜2ï¼šshared_ptrçš„åŸå­æ“ä½œè¯¯è§£</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">atomic_shared_ptr_misconception</span><span class="hljs-params">()</span> </span>{
    std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; p = std::<span class="hljs-built_in">make_shared</span>&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">42</span>);
    
    <span class="hljs-function">std::thread <span class="hljs-title">t1</span><span class="hljs-params">([&amp;p]() {
        <span class="hljs-keyword">auto</span> local_copy = p;  <span class="hljs-comment">// å¼•ç”¨è®¡æ•°åŸå­é€’å¢</span>
        <span class="hljs-comment">// ä½†p.reset()å¯èƒ½åŒæ—¶å‘ç”Ÿï¼</span>
    })</span></span>;
    
    <span class="hljs-function">std::thread <span class="hljs-title">t2</span><span class="hljs-params">([&amp;p]() {
        p.reset(<span class="hljs-keyword">new</span> <span class="hljs-type">int</span>(<span class="hljs-number">100</span>));  <span class="hljs-comment">// ä¿®æ”¹pæœ¬èº«éœ€è¦åŒæ­¥ï¼</span>
    })</span></span>;
    
    t1.<span class="hljs-built_in">join</span>();
    t2.<span class="hljs-built_in">join</span>();
    <span class="hljs-comment">// è¿™é‡Œæœ‰ä¸¤ä¸ªç‹¬ç«‹çš„æ•°æ®ç«äº‰ï¼š</span>
    <span class="hljs-comment">// 1. å¯¹pæœ¬èº«çš„ä¿®æ”¹ï¼ˆshared_ptrå¯¹è±¡ï¼‰</span>
    <span class="hljs-comment">// 2. å¯¹æ–°æ—§intå¯¹è±¡çš„è®¿é—®</span>
};
</code></pre>
<h3 data-id="heading-14"><strong>3.3 çº¿ç¨‹å®‰å…¨æ™ºèƒ½æŒ‡é’ˆå®ç°</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ–¹æ¡ˆ1ï¼šä½¿ç”¨atomic_shared_ptrï¼ˆC++20ï¼‰</span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;atomic&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cpp20_atomic_shared_ptr</span><span class="hljs-params">()</span> </span>{
    std::atomic&lt;std::shared_ptr&lt;<span class="hljs-type">int</span>&gt;&gt; atomic_ptr;
    
    <span class="hljs-comment">// çº¿ç¨‹å®‰å…¨åœ°å­˜å‚¨</span>
    <span class="hljs-function">std::thread <span class="hljs-title">writer</span><span class="hljs-params">([&amp;atomic_ptr]() {
        atomic_ptr.store(std::make_shared&lt;<span class="hljs-type">int</span>&gt;(<span class="hljs-number">42</span>));
    })</span></span>;
    
    <span class="hljs-comment">// çº¿ç¨‹å®‰å…¨åœ°åŠ è½½</span>
    <span class="hljs-function">std::thread <span class="hljs-title">reader</span><span class="hljs-params">([&amp;atomic_ptr]() {
        std::shared_ptr&lt;<span class="hljs-type">int</span>&gt; local = atomic_ptr.load();
        <span class="hljs-keyword">if</span>(local) {
            <span class="hljs-comment">// å®‰å…¨è¯»å–localæŒ‡å‘çš„å†…å®¹</span>
            <span class="hljs-comment">// ä½†å¤šä¸ªreaderå¯èƒ½åŒæ—¶è¯»å–ï¼Œå†…å®¹æœ¬èº«éœ€è¦ä¿æŠ¤</span>
        }
    })</span></span>;
    
    writer.<span class="hljs-built_in">join</span>();
    reader.<span class="hljs-built_in">join</span>();
}

<span class="hljs-comment">// æ–¹æ¡ˆ2ï¼šæ‰‹åŠ¨å®ç°å¸¦é”çš„æ™ºèƒ½æŒ‡é’ˆ</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeSharedPtr</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">ControlBlock</span> {
        T* ptr;
        std::atomic&lt;<span class="hljs-type">size_t</span>&gt; ref_count;
        std::mutex data_mutex;  <span class="hljs-comment">// ä¿æŠ¤å¯¹è±¡æœ¬èº«</span>
        
        <span class="hljs-comment">// è‡ªå®šä¹‰åˆ é™¤å™¨ï¼Œç¡®ä¿å®‰å…¨é”€æ¯</span>
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">safe_delete</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(data_mutex)</span></span>;
            <span class="hljs-keyword">delete</span> ptr;
            ptr = <span class="hljs-literal">nullptr</span>;
        }
    };
    
    ControlBlock* cb_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æä¾›çº¿ç¨‹å®‰å…¨çš„è®¿é—®æ¥å£</span>
    <span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> Func&gt;
    <span class="hljs-keyword">auto</span> <span class="hljs-title">with_lock</span><span class="hljs-params">(Func&amp;&amp; func)</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(cb_-&gt;data_mutex)</span></span>;
        <span class="hljs-keyword">return</span> std::forward&lt;Func&gt;(func)(*cb_-&gt;ptr);
    }
    
    <span class="hljs-comment">// çº¿ç¨‹å®‰å…¨çš„reset</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">reset</span><span class="hljs-params">(T* new_ptr = <span class="hljs-literal">nullptr</span>)</span> </span>{
        <span class="hljs-keyword">if</span>(cb_ &amp;&amp; cb_-&gt;ref_count.<span class="hljs-built_in">fetch_sub</span>(<span class="hljs-number">1</span>) == <span class="hljs-number">1</span>) {
            cb_-&gt;<span class="hljs-built_in">safe_delete</span>();
            <span class="hljs-keyword">delete</span> cb_;
        }
        <span class="hljs-keyword">if</span>(new_ptr) {
            cb_ = <span class="hljs-keyword">new</span> ControlBlock{new_ptr, <span class="hljs-number">1</span>};
        } <span class="hljs-keyword">else</span> {
            cb_ = <span class="hljs-literal">nullptr</span>;
        }
    }
};
</code></pre>
<h3 data-id="heading-15"><strong>3.4 å¤šçº¿ç¨‹ç¯å¢ƒæœ€ä½³å®è·µ</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æœ€ä½³å®è·µ1ï¼šä½¿ç”¨ä¸å¯å˜æ•°æ®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ImmutableData</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">const</span> std::vector&lt;<span class="hljs-type">int</span>&gt; data_;  <span class="hljs-comment">// æ„é€ åä¸å¯å˜</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// çº¿ç¨‹å®‰å…¨ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶è¯»å–</span>
    <span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> data_.<span class="hljs-built_in">at</span>(index);
    }
    
    <span class="hljs-comment">// åˆ›å»ºæ–°ç‰ˆæœ¬è€Œä¸æ˜¯ä¿®æ”¹</span>
    <span class="hljs-function">std::shared_ptr&lt;ImmutableData&gt; <span class="hljs-title">with_addition</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">auto</span> new_data = std::<span class="hljs-built_in">make_shared</span>&lt;ImmutableData&gt;(*<span class="hljs-keyword">this</span>);
        <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œéœ€è¦å®é™…çš„ä¸å¯å˜å®ç°</span>
        <span class="hljs-keyword">return</span> new_data;
    }
};

<span class="hljs-comment">// æœ€ä½³å®è·µ2ï¼šæ˜ç¡®çš„æ‰€æœ‰æƒä¼ é€’</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeMessageQueue</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Message</span> {
        std::unique_ptr&lt;Data&gt; data;  <span class="hljs-comment">// ç‹¬å æ‰€æœ‰æƒ</span>
        <span class="hljs-comment">// unique_ptræ˜ç¡®è¡¨ç¤ºï¼šåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰</span>
    };
    
    std::queue&lt;Message&gt; queue_;
    std::mutex queue_mutex_;
    std::condition_variable cv_;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// ç”Ÿäº§è€…ï¼šè½¬ç§»æ‰€æœ‰æƒåˆ°é˜Ÿåˆ—</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">push</span><span class="hljs-params">(std::unique_ptr&lt;Data&gt; data)</span> </span>{
        {
            <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(queue_mutex_)</span></span>;
            queue_.<span class="hljs-built_in">push</span>(Message{std::<span class="hljs-built_in">move</span>(data)});
        }
        cv_.<span class="hljs-built_in">notify_one</span>();
    }
    
    <span class="hljs-comment">// æ¶ˆè´¹è€…ï¼šä»é˜Ÿåˆ—è·å–æ‰€æœ‰æƒ</span>
    <span class="hljs-function">std::unique_ptr&lt;Data&gt; <span class="hljs-title">pop</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::unique_lock&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(queue_mutex_)</span></span>;
        cv_.<span class="hljs-built_in">wait</span>(lock, [<span class="hljs-keyword">this</span>]{ <span class="hljs-keyword">return</span> !queue_.<span class="hljs-built_in">empty</span>(); });
        
        Message msg = std::<span class="hljs-built_in">move</span>(queue_.<span class="hljs-built_in">front</span>());
        queue_.<span class="hljs-built_in">pop</span>();
        
        <span class="hljs-keyword">return</span> std::<span class="hljs-built_in">move</span>(msg.data);  <span class="hljs-comment">// æ‰€æœ‰æƒè½¬ç§»ç»™æ¶ˆè´¹è€…</span>
    }
};

<span class="hljs-comment">// æœ€ä½³å®è·µ3ï¼šä½¿ç”¨shared_ptrçš„åˆ«åæ„é€ å‡½æ•°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeObserver</span> {
<span class="hljs-keyword">private</span>:
    std::shared_ptr&lt;std::mutex&gt; mutex_;  <span class="hljs-comment">// å…±äº«çš„mutex</span>
    std::shared_ptr&lt;Data&gt; data_;          <span class="hljs-comment">// å…±äº«çš„æ•°æ®</span>
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ThreadSafeObserver</span>(std::shared_ptr&lt;Data&gt; data)
        : <span class="hljs-built_in">data_</span>(data)
        , <span class="hljs-built_in">mutex_</span>(std::<span class="hljs-built_in">make_shared</span>&lt;std::mutex&gt;()) {}
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">process</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(*mutex_)</span></span>;
        <span class="hljs-comment">// å®‰å…¨åœ°è®¿é—®data_</span>
        <span class="hljs-comment">// data_å’Œmutex_çš„ç”Ÿå‘½å‘¨æœŸç»‘å®šåœ¨ä¸€èµ·</span>
    }
    
    <span class="hljs-comment">// åˆ›å»ºè§‚å¯Ÿè€…å‰¯æœ¬</span>
    <span class="hljs-function">ThreadSafeObserver <span class="hljs-title">clone</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">ThreadSafeObserver</span>(data_);  <span class="hljs-comment">// å…±äº«ç›¸åŒçš„mutexå’Œæ•°æ®</span>
    }
};
</code></pre>
<h2 data-id="heading-16"><strong>ç»¼åˆæ¡ˆä¾‹ï¼šä¸€ä¸ªçº¿ç¨‹å®‰å…¨ã€é«˜æ€§èƒ½çš„å¯¹è±¡æ± </strong></h2>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å®Œæ•´çš„æœ€ä½³å®è·µç¤ºä¾‹</span>
<span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadSafeObjectPool</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">PooledObject</span> {
        T object;
        <span class="hljs-type">bool</span> in_use{<span class="hljs-literal">false</span>};
        std::chrono::steady_clock::time_point last_used;
    };
    
    <span class="hljs-comment">// ä½¿ç”¨unique_ptrç®¡ç†æ± ä¸­å¯¹è±¡</span>
    std::vector&lt;std::unique_ptr&lt;PooledObject&gt;&gt; pool_;
    
    <span class="hljs-comment">// å¯ç”¨çš„å¯¹è±¡ä½¿ç”¨weak_ptrå¼•ç”¨</span>
    std::vector&lt;std::weak_ptr&lt;T&gt;&gt; available_;
    
    <span class="hljs-comment">// çº¿ç¨‹å®‰å…¨</span>
    <span class="hljs-keyword">mutable</span> std::shared_mutex mutex_;
    
    <span class="hljs-comment">// é¿å…å¾ªç¯å¼•ç”¨çš„å…³é”®ï¼šè‡ªå®šä¹‰åˆ é™¤å™¨</span>
    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">PoolDeleter</span> {
        ThreadSafeObjectPool* pool;
        
        <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">operator</span><span class="hljs-params">()</span><span class="hljs-params">(T* ptr)</span> </span>{
            <span class="hljs-comment">// ä¸æ˜¯çœŸçš„åˆ é™¤ï¼Œè€Œæ˜¯è¿”å›æ± ä¸­</span>
            pool-&gt;<span class="hljs-built_in">return_to_pool</span>(ptr);
        }
    };
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// è·å–å¯¹è±¡ï¼šè¿”å›å¸¦è‡ªå®šä¹‰åˆ é™¤å™¨çš„shared_ptr</span>
    <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">acquire</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-function">std::unique_lock <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        <span class="hljs-comment">// æ¸…ç†è¿‡æœŸçš„weak_ptr</span>
        available_.<span class="hljs-built_in">erase</span>(
            std::<span class="hljs-built_in">remove_if</span>(available_.<span class="hljs-built_in">begin</span>(), available_.<span class="hljs-built_in">end</span>(),
                [](<span class="hljs-type">const</span> std::weak_ptr&lt;T&gt;&amp; wp) { <span class="hljs-keyword">return</span> wp.<span class="hljs-built_in">expired</span>(); }),
            available_.<span class="hljs-built_in">end</span>()
        );
        
        <span class="hljs-comment">// å°è¯•ä»å¯ç”¨å¯¹è±¡ä¸­è·å–</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it = available_.<span class="hljs-built_in">begin</span>(); it != available_.<span class="hljs-built_in">end</span>(); ++it) {
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">auto</span> sp = it-&gt;<span class="hljs-built_in">lock</span>()) {
                <span class="hljs-comment">// æ‰¾åˆ°å¯ç”¨å¯¹è±¡</span>
                available_.<span class="hljs-built_in">erase</span>(it);
                
                <span class="hljs-comment">// æŸ¥æ‰¾å¯¹åº”çš„PooledObjectå¹¶æ ‡è®°ä¸ºä½¿ç”¨ä¸­</span>
                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; pooled_obj : pool_) {
                    <span class="hljs-keyword">if</span>(&amp;pooled_obj-&gt;object == sp.<span class="hljs-built_in">get</span>()) {
                        pooled_obj-&gt;in_use = <span class="hljs-literal">true</span>;
                        pooled_obj-&gt;last_used = std::chrono::steady_clock::<span class="hljs-built_in">now</span>();
                        <span class="hljs-keyword">break</span>;
                    }
                }
                
                <span class="hljs-keyword">return</span> sp;
            }
        }
        
        <span class="hljs-comment">// åˆ›å»ºæ–°å¯¹è±¡</span>
        <span class="hljs-keyword">auto</span> pooled_obj = std::<span class="hljs-built_in">make_unique</span>&lt;PooledObject&gt;();
        T* raw_ptr = &amp;pooled_obj-&gt;object;
        pooled_obj-&gt;in_use = <span class="hljs-literal">true</span>;
        pooled_obj-&gt;last_used = std::chrono::steady_clock::<span class="hljs-built_in">now</span>();
        
        <span class="hljs-comment">// åˆ›å»ºå¸¦è‡ªå®šä¹‰åˆ é™¤å™¨çš„shared_ptr</span>
        <span class="hljs-function">std::shared_ptr&lt;T&gt; <span class="hljs-title">sp</span><span class="hljs-params">(raw_ptr, PoolDeleter{<span class="hljs-keyword">this</span>})</span></span>;
        
        <span class="hljs-comment">// å­˜å‚¨unique_pträ»¥ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</span>
        pool_.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(pooled_obj));
        
        <span class="hljs-keyword">return</span> sp;
    }
    
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// å¯¹è±¡è¿”å›åˆ°æ± ä¸­ï¼ˆç”±è‡ªå®šä¹‰åˆ é™¤å™¨è°ƒç”¨ï¼‰</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">return_to_pool</span><span class="hljs-params">(T* ptr)</span> </span>{
        <span class="hljs-function">std::unique_lock <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        <span class="hljs-comment">// æŸ¥æ‰¾å¯¹åº”çš„PooledObject</span>
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; pooled_obj : pool_) {
            <span class="hljs-keyword">if</span>(&amp;pooled_obj-&gt;object == ptr) {
                pooled_obj-&gt;in_use = <span class="hljs-literal">false</span>;
                
                <span class="hljs-comment">// åˆ›å»ºæ–°çš„weak_ptræ·»åŠ åˆ°å¯ç”¨åˆ—è¡¨</span>
                available_.<span class="hljs-built_in">push_back</span>(
                    std::<span class="hljs-built_in">shared_ptr</span>&lt;T&gt;(std::shared_ptr&lt;T&gt;{}, ptr)  <span class="hljs-comment">// åˆ«åæ„é€ å‡½æ•°</span>
                );
                <span class="hljs-keyword">break</span>;
            }
        }
    }
    
    <span class="hljs-comment">// æ¸…ç†é•¿æ—¶é—´æœªç”¨çš„å¯¹è±¡</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">cleanup_old_objects</span><span class="hljs-params">(std::chrono::seconds max_idle_time)</span> </span>{
        <span class="hljs-function">std::unique_lock <span class="hljs-title">lock</span><span class="hljs-params">(mutex_)</span></span>;
        
        <span class="hljs-keyword">auto</span> now = std::chrono::steady_clock::<span class="hljs-built_in">now</span>();
        
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span> it = pool_.<span class="hljs-built_in">begin</span>(); it != pool_.<span class="hljs-built_in">end</span>(); ) {
            <span class="hljs-keyword">auto</span>&amp; pooled_obj = *it;
            
            <span class="hljs-keyword">if</span>(!pooled_obj-&gt;in_use &amp;&amp; 
               (now - pooled_obj-&gt;last_used) &gt; max_idle_time) {
                <span class="hljs-comment">// ä»available_ä¸­ç§»é™¤å¯¹åº”çš„weak_ptr</span>
                available_.<span class="hljs-built_in">erase</span>(
                    std::<span class="hljs-built_in">remove_if</span>(available_.<span class="hljs-built_in">begin</span>(), available_.<span class="hljs-built_in">end</span>(),
                        [obj_ptr = &amp;pooled_obj-&gt;object](<span class="hljs-type">const</span> std::weak_ptr&lt;T&gt;&amp; wp) {
                            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">auto</span> sp = wp.<span class="hljs-built_in">lock</span>()) {
                                <span class="hljs-keyword">return</span> sp.<span class="hljs-built_in">get</span>() == obj_ptr;
                            }
                            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                        }),
                    available_.<span class="hljs-built_in">end</span>()
                );
                
                <span class="hljs-comment">// åˆ é™¤å¯¹è±¡</span>
                it = pool_.<span class="hljs-built_in">erase</span>(it);
            } <span class="hljs-keyword">else</span> {
                ++it;
            }
        }
    }
};

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">use_object_pool</span><span class="hljs-params">()</span> </span>{
    ThreadSafeObjectPool&lt;DatabaseConnection&gt; pool;
    
    <span class="hljs-comment">// å¤šçº¿ç¨‹å®‰å…¨åœ°è·å–è¿æ¥</span>
    std::vector&lt;std::thread&gt; threads;
    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; ++i) {
        threads.<span class="hljs-built_in">emplace_back</span>([&amp;pool, i]() {
            <span class="hljs-comment">// è·å–è¿æ¥ï¼ˆå¯èƒ½é˜»å¡ç›´åˆ°æœ‰å¯ç”¨è¿æ¥ï¼‰</span>
            <span class="hljs-keyword">auto</span> conn = pool.<span class="hljs-built_in">acquire</span>();
            
            <span class="hljs-comment">// ä½¿ç”¨è¿æ¥</span>
            conn-&gt;<span class="hljs-built_in">execute_query</span>(<span class="hljs-string">"SELECT * FROM users"</span>);
            
            <span class="hljs-comment">// connç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨è¿”å›åˆ°æ± ä¸­</span>
            <span class="hljs-comment">// å› ä¸ºä½¿ç”¨äº†è‡ªå®šä¹‰åˆ é™¤å™¨</span>
        });
    }
    
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">auto</span>&amp; t : threads) {
        t.<span class="hljs-built_in">join</span>();
    }
}
</code></pre>
<h2 data-id="heading-17"><strong>æ™ºèƒ½æŒ‡é’ˆçš„ä¸‰å¤§ã€Œç”Ÿå­˜æ³•åˆ™ã€</strong></h2>
<h3 data-id="heading-18"><strong>æ³•åˆ™ä¸€ï¼šæ‰€æœ‰æƒè®¾è®¡ä¼˜å…ˆ</strong></h3>
<ol>
<li>èƒ½ä½¿ç”¨<code>unique_ptr</code>å°±ä¸è¦ç”¨<code>shared_ptr</code></li>
<li>æ˜ç¡®å¯¹è±¡çš„æ‰€æœ‰æƒç”Ÿå‘½å‘¨æœŸ</li>
<li>ä½¿ç”¨<code>weak_ptr</code>æ‰“ç ´å¾ªç¯å¼•ç”¨</li>
</ol>
<h3 data-id="heading-19"><strong>æ³•åˆ™äºŒï¼šæ€§èƒ½æ„è¯†å¸¸é©»</strong></h3>
<ol>
<li>ä¼˜å…ˆä½¿ç”¨<code>make_shared</code>/<code>make_unique</code></li>
<li>é¿å…ä¸å¿…è¦çš„<code>shared_ptr</code>æ‹·è´</li>
<li>æ³¨æ„åŸå­æ“ä½œçš„å¼€é”€</li>
</ol>
<h3 data-id="heading-20"><strong>æ³•åˆ™ä¸‰ï¼šçº¿ç¨‹å®‰å…¨ä¸å‡è®¾</strong></h3>
<ol>
<li><code>shared_ptr</code>çš„çº¿ç¨‹å®‰å…¨ä»…é™äºæ§åˆ¶å—</li>
<li>æŒ‡å‘çš„æ•°æ®éœ€è¦é¢å¤–ä¿æŠ¤</li>
<li>è€ƒè™‘ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„</li>
</ol>
<h3 data-id="heading-21"><strong>æœ€ç»ˆæ£€æŸ¥æ¸…å•</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// æ¯æ¬¡ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå‰é—®è‡ªå·±ï¼š</span>
<span class="hljs-number">1.</span> è¿™ä¸ªå¯¹è±¡åº”è¯¥è¢«è°æ‹¥æœ‰ï¼Ÿâ–¡ unique_ptr â–¡ shared_ptr
<span class="hljs-number">2.</span> æ˜¯å¦æœ‰å¾ªç¯å¼•ç”¨çš„å¯èƒ½ï¼Ÿâ–¡ æœ‰ï¼ˆéœ€weak_ptrï¼‰ â–¡ æ— 
<span class="hljs-number">3.</span> æ˜¯å¦ä¼šåœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ï¼Ÿâ–¡ æ˜¯ï¼ˆéœ€åŒæ­¥ï¼‰ â–¡ å¦
<span class="hljs-number">4.</span> æ˜¯å¦éœ€è¦æœ€ä¼˜æ€§èƒ½ï¼Ÿâ–¡ æ˜¯ï¼ˆé¿å…shared_ptrï¼‰ â–¡ å¦
<span class="hljs-number">5.</span> æ˜¯å¦ä¼ é€’æ‰€æœ‰æƒï¼Ÿâ–¡ æ˜¯ï¼ˆç§»åŠ¨è¯­ä¹‰ï¼‰ â–¡ å¦ï¼ˆä¼ é€’å¼•ç”¨ï¼‰
</code></pre>
<h2 data-id="heading-22"><strong>ä»ã€Œä¼šç”¨ã€åˆ°ã€Œç²¾é€šã€</strong></h2>
<p>æ™ºèƒ½æŒ‡é’ˆä¸æ˜¯ã€Œé“¶å¼¹ã€ï¼Œè€Œæ˜¯ã€ŒåŒåˆƒå‰‘ã€ã€‚å®ƒè§£å†³äº†æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„çƒ¦æ¼ï¼Œå´å¼•å…¥äº†æ›´éšè”½çš„é™·é˜±ã€‚çœŸæ­£çš„ç²¾é€šï¼Œä¸æ˜¯è®°ä½è¯­æ³•ï¼Œè€Œæ˜¯ç†è§£æ¯ä¸ªè®¾è®¡å†³ç­–èƒŒåçš„æƒè¡¡ã€‚</p>
<p>æ­£å¦‚C++ä¹‹çˆ¶Bjarne Stroustrupæ‰€è¯´ï¼šã€ŒC++çš„è®¾è®¡åˆè¡·æ˜¯è®©å¥½çš„è®¾è®¡æ›´å®¹æ˜“ï¼Œåçš„è®¾è®¡æ›´å›°éš¾ã€ã€‚æ™ºèƒ½æŒ‡é’ˆæ­£æ˜¯è¿™ä¸€å“²å­¦çš„ä½“ç°â€”â€”å®ƒå¥–åŠ±æ¸…æ™°çš„æ‰€æœ‰æƒè®¾è®¡ï¼Œæƒ©ç½šæ¨¡ç³Šçš„èµ„æºç®¡ç†ã€‚</p>
<p>ä¸‹æ¬¡å½“ä½ å†™ä¸‹<code>std::shared_ptr</code>æ—¶ï¼Œä¸å¦¨åœé¡¿ä¸€ç§’ï¼Œé—®é—®è‡ªå·±ï¼šã€Œæˆ‘çœŸçš„éœ€è¦å…±äº«æ‰€æœ‰æƒå—ï¼Ÿã€è¿™ä¸ªç®€å•çš„é—®é¢˜ï¼Œå¯èƒ½å°±æ˜¯é¿å…ä¸‹ä¸€ä¸ªæ·±å¤œå´©æºƒçš„å…³é”®ã€‚</p>
<hr/>
<p><strong>æ·±åº¦é˜…è¯»æ¨è</strong>ï¼š</p>
<ol>
<li>ã€ŠEffective Modern C++ã€‹æ¡æ¬¾18-22ï¼šæ™ºèƒ½æŒ‡é’ˆä¸“é¢˜</li>
<li>ã€ŠC++ Concurrency in Actionã€‹ç¬¬7ç« ï¼šæ— é”æ•°æ®ç»“æ„ä¸­çš„æ™ºèƒ½æŒ‡é’ˆ</li>
<li>Boost.smart_ptr æºç åˆ†æ</li>
<li>Facebook follyåº“ä¸­çš„æ™ºèƒ½æŒ‡é’ˆæ‰©å±•</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[React ç»„ä»¶é€šè®¯å…¨æ¡ˆä¾‹è§£æï¼šä» Context åˆ° Ref çš„å®æˆ˜åº”ç”¨]]></title>    <link>https://juejin.cn/post/7579438351296987172</link>    <guid>https://juejin.cn/post/7579438351296987172</guid>    <pubDate>2025-12-03T08:43:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579438351296987172" data-draft-id="7579439226518224902" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="React ç»„ä»¶é€šè®¯å…¨æ¡ˆä¾‹è§£æï¼šä» Context åˆ° Ref çš„å®æˆ˜åº”ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T08:43:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lcy453"/> <meta itemprop="url" content="https://juejin.cn/user/2921833644950300"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            React ç»„ä»¶é€šè®¯å…¨æ¡ˆä¾‹è§£æï¼šä» Context åˆ° Ref çš„å®æˆ˜åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2921833644950300/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lcy453
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:43:14.000Z" title="Wed Dec 03 2025 08:43:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>Â Â  Â  Â  Â  æœ€è¿‘å¼€å‘ä¸­ï¼Œé‡åˆ°äº†ç»„ä»¶é€šè®¯çš„éœ€æ±‚ï¼Œæˆ‘å¾ˆéš¾ç†æ¸…æ¥šå¤æ‚é¡¹ç›®ä¸­çš„é€šè®¯æ€è·¯ï¼Œæœ¬èº«ç»éªŒä¸è¶³ï¼Œè€Œä¸”è‡ªå·±å†™çš„é¡¹ç›®ä¸€èˆ¬éƒ½æ˜¯ç”¨çŠ¶æ€ç®¡ç†å·¥å…·ressoæˆ–è€…zustandç›´æ¥æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ï¼Œæˆ–è€…ç›´æ¥çˆ¶å­ä¹‹é—´ä¼ é€’ï¼Œä½†æ˜¯çªç„¶å‘ç°å…¬å¸é¡¹ç›®æ²¡æœ‰ç”¨åˆ°çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œè€Œæ˜¯ç”¨åŸç”Ÿçš„useReducerå¯¹çŠ¶æ€å’Œæ“ä½œçŠ¶æ€æ–¹æ³•è¿›è¡Œå½’çº³ï¼Œç”¨createContextåˆ›å»ºä¸Šä¸‹æ–‡ï¼Œç„¶åç”¨ä¸Šä¸‹æ–‡ç»„ä»¶ä¸ºæ‰€æœ‰å­ç»„ä»¶æä¾›å…±äº«çš„stateå’Œdispatchã€‚</p>
<p>Â Â Â Â Â Â Â Â åœ¨ React å¼€å‘ä¸­ï¼Œç»„ä»¶é€šè®¯æ˜¯æ ¸å¿ƒçŸ¥è¯†ç‚¹ä¹‹ä¸€ã€‚æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªå®Œæ•´æ¡ˆä¾‹ï¼Œè¯¦ç»†è§£æå¦‚ä½•ä½¿ç”¨Â <code>createContext</code>ã€<code>useContext</code>ã€<code>useReducer</code>ã€<code>useRef</code>Â ç­‰ React é’©å­å®ç°ä¸åŒåœºæ™¯ä¸‹çš„ç»„ä»¶é€šè®¯ï¼Œå¹¶å¯¹æ¯æ®µä»£ç è¿›è¡Œé€è¡Œè§£é‡Šã€‚</p>
<h2 data-id="heading-0">1ã€æ¡ˆä¾‹æ•´ä½“æ¶æ„</h2>
<p>Â Â Â Â Â Â Â Â æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªåŒ…å«å¤šé¡µé¢çš„åº”ç”¨ï¼Œä¸»è¦åŠŸèƒ½åŒ…æ‹¬ï¼š</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  1.è®¡æ•°å™¨åŠŸèƒ½ï¼ˆå¢ / å‡æ“ä½œï¼‰</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  2.è§„åˆ™åˆ—è¡¨ç®¡ç†ï¼ˆæ·»åŠ  / å±•ç¤ºè§„åˆ™ï¼‰</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  3.è·¨ç»„ä»¶æ•°æ®ä¼ é€’ï¼ˆé€šè¿‡ Contextï¼‰</p>
<p>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 4.çˆ¶å­ç»„ä»¶é€šè®¯ï¼ˆé€šè¿‡ Ref è°ƒç”¨å­ç»„ä»¶æ–¹æ³•ï¼‰</p>
<p>Â Â Â Â Â Â Â Â é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  Â  1.ä¸Šä¸‹æ–‡ç®¡ç†ï¼ševent-contexts.tsxï¼ˆæ ¸å¿ƒé€šè®¯é€»è¾‘ï¼‰</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  Â  2.é¡µé¢ç»„ä»¶ï¼š<code>HomePage.tsx</code>ã€<code>DocsPage.tsx</code></p>
<p><code>Â Â Â Â Â Â Â Â 3.å¸ƒ</code>å±€ç»„ä»¶ï¼š<code>Layout.tsx</code>ï¼ˆæä¾›è·¯ç”±å’Œä¸Šä¸‹æ–‡å®¹å™¨ï¼‰</p>
<p>Â  Â  Â  Â  Â  Â  Â  Â  Â  4.å­ç»„ä»¶ï¼š<code>Event.tsx</code>ï¼ˆé€šè¿‡ Ref æš´éœ²æ–¹æ³•çš„ç»„ä»¶ï¼‰</p>
<h2 data-id="heading-1">2ã€æ ¸å¿ƒä»£ç è§£æ</h2>
<h3 data-id="heading-2">Â Â 1. ä¸Šä¸‹æ–‡å®šä¹‰ä¸çŠ¶æ€ç®¡ç†ï¼ˆevent-contexts.tsxï¼‰Â  Â  Â Â </h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¯¼å…¥æ‰€éœ€çš„ React é’©å­</span>
<span class="hljs-keyword">import</span> { createContext, useContext, useReducer, useRef, useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Event</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../pages/event"</span>;

<span class="hljs-comment">// å®šä¹‰åˆå§‹çŠ¶æ€</span>
<span class="hljs-keyword">const</span> initalState = {
  <span class="hljs-attr">number</span>: <span class="hljs-number">0</span>,          <span class="hljs-comment">// è®¡æ•°å™¨æ•°å€¼</span>
  <span class="hljs-attr">rules</span>: [<span class="hljs-string">"å­™æ‚Ÿç©º"</span>],   <span class="hljs-comment">// è§„åˆ™åˆ—è¡¨åˆå§‹å€¼</span>
  <span class="hljs-attr">exportDate</span>: <span class="hljs-string">""</span>,     <span class="hljs-comment">// ä»å­ç»„ä»¶è·å–çš„æ•°æ®</span>
  <span class="hljs-attr">exportUnit</span>: <span class="hljs-string">""</span>,     <span class="hljs-comment">// æ•°æ®å•ä½</span>
};

<span class="hljs-comment">// å®šä¹‰ action ç±»å‹ï¼ˆçº¦æŸ dispatch å¯æ‰§è¡Œçš„æ“ä½œï¼‰</span>
<span class="hljs-keyword">type</span> actionType = <span class="hljs-string">"increment"</span> | <span class="hljs-string">"decrement"</span> | <span class="hljs-string">"addRule"</span> | <span class="hljs-string">"export"</span>;

<span class="hljs-comment">// å®šä¹‰ action æ¥å£ï¼ˆæè¿° action çš„ç»“æ„ï¼‰</span>
<span class="hljs-keyword">interface</span> action {
  <span class="hljs-attr">type</span>: actionType;       <span class="hljs-comment">// æ“ä½œç±»å‹</span>
  payload?: <span class="hljs-built_in">number</span>;       <span class="hljs-comment">// è®¡æ•°å™¨å¢å‡çš„æ•°å€¼ï¼ˆå¯é€‰ï¼‰</span>
  rule?: <span class="hljs-built_in">string</span>;          <span class="hljs-comment">// æ–°å¢çš„è§„åˆ™ï¼ˆå¯é€‰ï¼‰</span>
  exportDate?: <span class="hljs-built_in">string</span>;    <span class="hljs-comment">// è¦å¯¼å‡ºçš„æ—¥æœŸï¼ˆå¯é€‰ï¼‰</span>
  exportUnit?: <span class="hljs-built_in">string</span>;    <span class="hljs-comment">// è¦å¯¼å‡ºçš„å•ä½ï¼ˆå¯é€‰ï¼‰</span>
}

<span class="hljs-comment">// å®šä¹‰ reducer å‡½æ•°ï¼ˆå¤„ç†çŠ¶æ€æ›´æ–°çš„çº¯å‡½æ•°ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">reducer</span> = (<span class="hljs-params">state: <span class="hljs-keyword">typeof</span> initalState, action: action</span>) =&gt; {
  <span class="hljs-keyword">switch</span> (action.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"increment"</span>:
      <span class="hljs-comment">// è®¡æ•°å™¨å¢åŠ ï¼šåŸºäºå½“å‰çŠ¶æ€åˆ›å»ºæ–°å¯¹è±¡ï¼ˆä¸å¯å˜æ›´æ–°ï¼‰</span>
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">number</span>: state.<span class="hljs-property">number</span> + action.<span class="hljs-property">payload</span> };
    <span class="hljs-keyword">case</span> <span class="hljs-string">"decrement"</span>:
      <span class="hljs-comment">// è®¡æ•°å™¨å‡å°‘</span>
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">number</span>: state.<span class="hljs-property">number</span> - action.<span class="hljs-property">payload</span> };
    <span class="hljs-keyword">case</span> <span class="hljs-string">"addRule"</span>:
      <span class="hljs-comment">// æ·»åŠ è§„åˆ™ï¼šå¤åˆ¶åŸæ•°ç»„å¹¶æ·»åŠ æ–°å…ƒç´ </span>
      <span class="hljs-keyword">return</span> { ...state, <span class="hljs-attr">rules</span>: [...state.<span class="hljs-property">rules</span>, action.<span class="hljs-property">rule</span> || <span class="hljs-string">""</span>] };
    <span class="hljs-keyword">case</span> <span class="hljs-string">"export"</span>:
      <span class="hljs-comment">// å¯¼å‡ºæ•°æ®ï¼šæ›´æ–°ä»å­ç»„ä»¶è·å–çš„å€¼</span>
      <span class="hljs-keyword">return</span> {
        ...state,
        <span class="hljs-attr">exportDate</span>: action.<span class="hljs-property">exportDate</span> || <span class="hljs-string">""</span>,
        <span class="hljs-attr">exportUnit</span>: action.<span class="hljs-property">exportUnit</span> || <span class="hljs-string">""</span>,
      };
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state;
  }
};

<span class="hljs-comment">// åˆ›å»ºä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆå®šä¹‰ä¸Šä¸‹æ–‡çš„ç±»å‹å’Œé»˜è®¤å€¼ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CountContext</span> = createContext&lt;{
  <span class="hljs-attr">state</span>: <span class="hljs-keyword">typeof</span> initalState;
  <span class="hljs-attr">dispatch</span>: <span class="hljs-title class_">React</span>.<span class="hljs-property">Dispatch</span>&lt;action&gt;;
}&gt;({
  <span class="hljs-attr">state</span>: initalState,
  <span class="hljs-attr">dispatch</span>: <span class="hljs-function">() =&gt;</span> {},  <span class="hljs-comment">// é»˜è®¤çš„ç©º dispatch</span>
});

<span class="hljs-comment">// å®šä¹‰ Provider ç»„ä»¶ï¼ˆæä¾›ä¸Šä¸‹æ–‡æ•°æ®ï¼‰</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">CountProvider</span> = (<span class="hljs-params">{ children }</span>) =&gt; {
  <span class="hljs-comment">// åˆ›å»ºå­ç»„ä»¶çš„ Refï¼ˆç”¨äºè°ƒç”¨å­ç»„ä»¶æ–¹æ³•ï¼‰</span>
  <span class="hljs-keyword">const</span> eventRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  
  <span class="hljs-comment">// ä½¿ç”¨ useReducer ç®¡ç†çŠ¶æ€ï¼ˆæ›¿ä»£ useState å¤„ç†å¤æ‚çŠ¶æ€é€»è¾‘ï¼‰</span>
  <span class="hljs-keyword">const</span> [state, dispatch] = <span class="hljs-title function_">useReducer</span>(reducer, initalState);
  
  <span class="hljs-comment">// ç”¨äºå­˜å‚¨ä»å­ç»„ä»¶è·å–çš„å€¼ï¼ˆå±€éƒ¨çŠ¶æ€ï¼‰</span>
  <span class="hljs-keyword">const</span> [childValue, setChildValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);

  <span class="hljs-comment">// å¤„ç†ç‚¹å‡»äº‹ä»¶ï¼šè·å–å­ç»„ä»¶æ•°æ®å¹¶æ›´æ–°ä¸Šä¸‹æ–‡</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-comment">// é€šè¿‡ Ref è°ƒç”¨å­ç»„ä»¶æš´éœ²çš„ getValue æ–¹æ³•</span>
    <span class="hljs-keyword">const</span> value = eventRef?.<span class="hljs-property">current</span>?.<span class="hljs-title function_">getValue</span>() || <span class="hljs-string">""</span>;
    <span class="hljs-title function_">setChildValue</span>(value);
    <span class="hljs-comment">// åˆ†å‘ action æ›´æ–°ä¸Šä¸‹æ–‡çŠ¶æ€</span>
    <span class="hljs-title function_">dispatch</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">"export"</span>, <span class="hljs-attr">exportDate</span>: value, <span class="hljs-attr">exportUnit</span>: <span class="hljs-string">"å…ƒ"</span> });
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {/* æ¸²æŸ“å­ç»„ä»¶å¹¶ç»‘å®š Ref */}
      <span class="hljs-tag">&lt;<span class="hljs-name">Event</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{eventRef}</span> /&gt;</span>
      
      {/* è§¦å‘è·å–å­ç»„ä»¶æ•°æ®çš„æŒ‰é’® */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> handleClick()}&gt;
        ç‚¹æˆ‘è·å–å¹¶ä¸”æ˜¾ç¤ºå­ç»„ä»¶æš´éœ²çš„æ•°æ®
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      {/* å±•ç¤ºä»å­ç»„ä»¶è·å–çš„æ•°æ® */}
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å­ç»„ä»¶æš´éœ²çš„æ•°æ®ï¼š{state.exportDate}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      
      {/* æä¾›ä¸Šä¸‹æ–‡æ•°æ®ç»™å­ç»„ä»¶æ ‘ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">CountContext.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span> <span class="hljs-attr">state</span>, <span class="hljs-attr">dispatch</span> }}&gt;</span>
        {children}  {/* æ¸²æŸ“å­ç»„ä»¶ï¼ˆè·¯ç”±é¡µé¢ï¼‰ */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">CountContext.Provider</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
};

<span class="hljs-comment">// è‡ªå®šä¹‰ Hookï¼šç®€åŒ–ä¸Šä¸‹æ–‡çš„ä½¿ç”¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">useCount</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> context = <span class="hljs-title function_">useContext</span>(<span class="hljs-title class_">CountContext</span>);
  <span class="hljs-comment">// æ ¡éªŒï¼šç¡®ä¿åœ¨ Provider å†…éƒ¨ä½¿ç”¨</span>
  <span class="hljs-keyword">if</span> (!context) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"useCount å¿…é¡»åœ¨ CountProvider ä¸­ä½¿ç”¨"</span>);
  <span class="hljs-keyword">return</span> context;
};
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒé’©å­è§£æ</strong>ï¼š</p>
<ul>
<li><code>createContext</code>ï¼šåˆ›å»ºä¸Šä¸‹æ–‡å®¹å™¨ï¼Œå®šä¹‰å…±äº«æ•°æ®çš„ç»“æ„</li>
<li><code>useContext</code>ï¼šåœ¨ç»„ä»¶ä¸­è·å–ä¸Šä¸‹æ–‡æ•°æ®ï¼Œé¿å… props å±‚å±‚ä¼ é€’</li>
<li><code>useReducer</code>ï¼šå¤„ç†å¤æ‚çŠ¶æ€é€»è¾‘ï¼Œé€šè¿‡ dispatch åˆ†å‘ action æ›´æ–°çŠ¶æ€</li>
<li><code>useRef</code>ï¼šåˆ›å»ºæŒä¹…åŒ–çš„å¼•ç”¨ï¼Œç”¨äºè®¿é—® DOM å…ƒç´ æˆ–å­ç»„ä»¶å®ä¾‹</li>
<li><code>useState</code>ï¼šç®¡ç†ç»„ä»¶å†…éƒ¨çš„ç®€å•çŠ¶æ€</li>
</ul>
<h3 data-id="heading-3">2. å­ç»„ä»¶ï¼ˆEvent.tsxï¼‰- é€šè¿‡ Ref æš´éœ²æ–¹æ³•<code>Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Â </code></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span>, {
  useImperativeHandle,  <span class="hljs-comment">// è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•</span>
  forwardRef,          <span class="hljs-comment">// è½¬å‘ Ref ç»™å­ç»„ä»¶</span>
  useState,
  useRef,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-comment">// ä½¿ç”¨ forwardRef è½¬å‘ Ref åˆ°ç»„ä»¶å†…éƒ¨</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Event</span> = <span class="hljs-title function_">forwardRef</span>(<span class="hljs-function">(<span class="hljs-params">props, ref</span>) =&gt;</span> {
  <span class="hljs-comment">// å­ç»„ä»¶å†…éƒ¨çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> [childValue, setChildValue] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">"çŒ´å­"</span>);
  <span class="hljs-comment">// è¾“å…¥æ¡†çš„ Ref</span>
  <span class="hljs-keyword">const</span> ref1 = useRef&lt;<span class="hljs-title class_">HTMLInputElement</span>&gt;(<span class="hljs-literal">null</span>);

  <span class="hljs-comment">// è‡ªå®šä¹‰æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•ï¼ˆé€šè¿‡ Ref è®¿é—®ï¼‰</span>
  <span class="hljs-title function_">useImperativeHandle</span>(ref, <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">getValue</span>: <span class="hljs-function">() =&gt;</span> childValue,  <span class="hljs-comment">// è·å–å½“å‰å€¼</span>
    <span class="hljs-attr">resetValue</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">resetValue</span>(),  <span class="hljs-comment">// é‡ç½®å€¼</span>
  }));

  <span class="hljs-comment">// å†…éƒ¨æ–¹æ³•ï¼šè·å–å€¼</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">getValue</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">return</span> childValue;
  };

  <span class="hljs-comment">// å†…éƒ¨æ–¹æ³•ï¼šé‡ç½®å€¼</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">resetValue</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setChildValue</span>(<span class="hljs-string">""</span>);
  };

  <span class="hljs-comment">// æäº¤è¾“å…¥æ¡†çš„å€¼åˆ°ç»„ä»¶çŠ¶æ€</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">submitValue</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">setChildValue</span>(ref1?.<span class="hljs-property">current</span>?.<span class="hljs-property">value</span> || <span class="hljs-string">""</span>);
  };

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* è¾“å…¥æ¡†ï¼šç»‘å®š ref1 å’Œ childValue */}
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{childValue}</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{ref1}</span> /&gt;</span>
      {/* æäº¤æŒ‰é’® */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> submitValue()}&gt;æäº¤<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
});

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">Event</span>;
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>æ ¸å¿ƒé’©å­è§£æ</strong>ï¼š</p>
<ul>
<li><code>forwardRef</code>ï¼šå…è®¸çˆ¶ç»„ä»¶å°† Ref ä¼ é€’åˆ°å­ç»„ä»¶å†…éƒ¨ï¼Œçªç ´ç»„ä»¶è¾¹ç•Œ</li>
<li><code>useImperativeHandle</code>ï¼šè‡ªå®šä¹‰å­ç»„ä»¶é€šè¿‡ Ref æš´éœ²ç»™çˆ¶ç»„ä»¶çš„æ–¹æ³•ï¼Œé¿å…æš´éœ²æ•´ä¸ªç»„ä»¶å®ä¾‹</li>
<li><code>useRef</code>ï¼ˆDOM å¼•ç”¨ï¼‰ï¼šè®¿é—®è¾“å…¥æ¡† DOM å…ƒç´ ï¼Œè·å–ç”¨æˆ·è¾“å…¥å€¼</li>
</ul>
<h3 data-id="heading-4">3.å¸ƒå±€ç»„ä»¶ï¼ˆLayout.tsxï¼‰- æä¾›ä¸Šä¸‹æ–‡å®¹å™¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Link</span>, <span class="hljs-title class_">Outlet</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"umi"</span>;  <span class="hljs-comment">// Umi æ¡†æ¶çš„è·¯ç”±ç»„ä»¶</span>
<span class="hljs-keyword">import</span> styles <span class="hljs-keyword">from</span> <span class="hljs-string">"./index.less"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CountProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"../contexts/event-contexts"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Layout</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">{styles.navs}</span>&gt;</span>
      {/* å¯¼èˆªèœå• */}
      <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/"</span>&gt;</span>Home<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>  {/* é¦–é¡µè·¯ç”± */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">Link</span> <span class="hljs-attr">to</span>=<span class="hljs-string">"/docs"</span>&gt;</span>Docs<span class="hljs-tag">&lt;/<span class="hljs-name">Link</span>&gt;</span>  {/* æ–‡æ¡£é¡µè·¯ç”± */}
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">li</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://github.com/umijs/umi"</span>&gt;</span>Github<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span>
      
      {/* ä¸Šä¸‹æ–‡æä¾›è€…ï¼šåŒ…è£¹è·¯ç”±å‡ºå£ï¼Œä½¿æ‰€æœ‰é¡µé¢éƒ½èƒ½è®¿é—®ä¸Šä¸‹æ–‡ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">CountProvider</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Outlet</span> /&gt;</span>  {/* è·¯ç”±å‡ºå£ï¼šæ¸²æŸ“åŒ¹é…çš„é¡µé¢ç»„ä»¶ */}
      <span class="hljs-tag">&lt;/<span class="hljs-name">CountProvider</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼š</p>
<ul>
<li>é€šè¿‡Â <code>CountProvider</code>Â åŒ…è£¹Â <code>&lt;Outlet /&gt;</code>ï¼Œç¡®ä¿æ‰€æœ‰è·¯ç”±é¡µé¢éƒ½èƒ½è®¿é—®ä¸Šä¸‹æ–‡</li>
<li>ä½¿ç”¨ Umi çš„Â <code>Link</code>Â å’ŒÂ <code>Outlet</code>Â å®ç°è·¯ç”±è·³è½¬å’Œé¡µé¢æ¸²æŸ“</li>
</ul>
<h3 data-id="heading-5">4. é¦–é¡µç»„ä»¶ï¼ˆHomePage.tsxï¼‰- ä½¿ç”¨ä¸Šä¸‹æ–‡æ•°æ®</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> yayJpg <span class="hljs-keyword">from</span> <span class="hljs-string">"../assets/yay.jpg"</span>;
<span class="hljs-keyword">import</span> { useCount } <span class="hljs-keyword">from</span> <span class="hljs-string">"../contexts/event-contexts"</span>;  <span class="hljs-comment">// å¯¼å…¥è‡ªå®šä¹‰ Hook</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">HomePage</span>(<span class="hljs-params"/>) {
  <span class="hljs-comment">// é€šè¿‡è‡ªå®šä¹‰ Hook è·å–ä¸Šä¸‹æ–‡æ•°æ®</span>
  <span class="hljs-keyword">const</span> { state, dispatch } = <span class="hljs-title function_">useCount</span>();
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* éå†å±•ç¤ºè§„åˆ™åˆ—è¡¨ */}
      {state.rules.map((item) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item}</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      ))}
      {/* å±•ç¤ºä»å­ç»„ä»¶è·å–çš„æ•°æ®å’Œå•ä½ */}
      ã€Œ{state.exportDate}
      {state.exportUnit}ã€
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨Â <code>useCount</code>Â è·å–ä¸Šä¸‹æ–‡çš„Â <code>state</code>Â å’ŒÂ <code>dispatch</code></li>
<li>å±•ç¤ºÂ <code>state.rules</code>Â åˆ—è¡¨å’ŒÂ <code>state.exportDate</code>Â æ•°æ®</li>
</ul>
<h3 data-id="heading-6">5. æ–‡æ¡£é¡µç»„ä»¶ï¼ˆDocsPage.tsxï¼‰- æ“ä½œä¸Šä¸‹æ–‡çŠ¶æ€</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { useCount } <span class="hljs-keyword">from</span> <span class="hljs-string">"../contexts/event-contexts"</span>;
<span class="hljs-keyword">import</span> { useState } <span class="hljs-keyword">from</span> <span class="hljs-string">"react"</span>;

<span class="hljs-keyword">const</span> <span class="hljs-title function_">DocsPage</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// è·å–ä¸Šä¸‹æ–‡æ•°æ®</span>
  <span class="hljs-keyword">const</span> { state, dispatch } = <span class="hljs-title function_">useCount</span>();
  <span class="hljs-comment">// æœ¬åœ°çŠ¶æ€ï¼šç®¡ç†è¾“å…¥æ¡†çš„å€¼</span>
  <span class="hljs-keyword">const</span> [name, setName] = <span class="hljs-title function_">useState</span>(<span class="hljs-string">""</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {/* å±•ç¤ºè®¡æ•°å™¨æ•°å€¼ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>number: {state.number}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      
      {/* è®¡æ•°å™¨å¢åŠ æŒ‰é’®ï¼šåˆ†å‘ increment action */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch({ type: "increment", payload: 1 })}&gt;
        increment
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      {/* è®¡æ•°å™¨å‡å°‘æŒ‰é’®ï¼šåˆ†å‘ decrement action */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch({ type: "decrement", payload: 1 })}&gt;
        decrement
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      
      {/* å±•ç¤ºè§„åˆ™åˆ—è¡¨ */}
      {state.rules.map((item) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{item}</span>&gt;</span>{item}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      ))}
      
      {/* è¾“å…¥æ¡†ï¼šç”¨äºæ·»åŠ æ–°è§„åˆ™ */}
      <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
        <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
        <span class="hljs-attr">value</span>=<span class="hljs-string">{name}</span>
        <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =&gt;</span> setName(e.target.value)}  // æ›´æ–°æœ¬åœ°çŠ¶æ€
      /&gt;
      
      {/* æ·»åŠ è§„åˆ™æŒ‰é’®ï¼šåˆ†å‘ addRule action */}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> dispatch({ type: "addRule", rule: name })}&gt;
        addRule
      <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title class_">DocsPage</span>;
</code></pre>
<p><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/></p>
<p><strong>åŠŸèƒ½è¯´æ˜</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨Â <code>useState</code>Â ç®¡ç†è¾“å…¥æ¡†çš„æœ¬åœ°çŠ¶æ€</li>
<li>é€šè¿‡Â <code>dispatch</code>Â åˆ†å‘ä¸åŒç±»å‹çš„ action æ“ä½œä¸Šä¸‹æ–‡çŠ¶æ€</li>
<li>å®ç°è®¡æ•°å™¨å¢å‡å’Œæ·»åŠ è§„åˆ™çš„åŠŸèƒ½</li>
</ul>
<h2 data-id="heading-7">3ã€æ€»ç»“ï¼šReact ç»„ä»¶é€šè®¯æ–¹å¼å¯¹æ¯”</h2>
<ol>
<li>
<p><strong>Context + useReducer</strong></p>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šè·¨ç»„ä»¶ï¼ˆå¤šå±‚çº§ï¼‰æ•°æ®å…±äº«</li>
<li>ä¼˜åŠ¿ï¼šé¿å… props é€ä¼ ï¼Œé›†ä¸­ç®¡ç†çŠ¶æ€é€»è¾‘</li>
<li>æ ¸å¿ƒ APIï¼š<code>createContext</code>ã€<code>useContext</code>ã€<code>useReducer</code></li>
</ul>
</li>
<li>
<p><strong>Ref + useImperativeHandle</strong></p>
<ul>
<li>é€‚ç”¨åœºæ™¯ï¼šçˆ¶ç»„ä»¶éœ€è¦ç›´æ¥æ“ä½œå­ç»„ä»¶ï¼ˆè°ƒç”¨æ–¹æ³• / è·å–æ•°æ®ï¼‰</li>
<li>ä¼˜åŠ¿ï¼šç›´æ¥è®¿é—®å­ç»„ä»¶å®ä¾‹ï¼Œé€‚åˆæ§åˆ¶å‹äº¤äº’</li>
<li>æ ¸å¿ƒ APIï¼š<code>useRef</code>ã€<code>forwardRef</code>ã€<code>useImperativeHandle</code></li>
</ul>
</li>
</ol>
<p>é€šè¿‡æœ¬æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å®Œæ•´å®ç°äº†ä»ç®€å•åˆ°å¤æ‚çš„ç»„ä»¶é€šè®¯åœºæ™¯ï¼ŒæŒæ¡è¿™äº›é’©å­çš„ä½¿ç”¨æ–¹å¼å¯ä»¥æœ‰æ•ˆè§£å†³ React åº”ç”¨ä¸­çš„æ•°æ®ä¼ é€’é—®é¢˜ã€‚å®é™…å¼€å‘ä¸­ï¼Œåº”æ ¹æ®å…·ä½“åœºæ™¯é€‰æ‹©åˆé€‚çš„é€šè®¯æ–¹å¼ï¼Œä»¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§</p>
<p>å›¾ä¾‹</p>
<p>Â Â Â Â Â Â Â Â <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3fa90e6c895148a09310d22ece2c3b84~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgbGN5NDUz:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356193&amp;x-signature=9ImR%2BS%2BoNGpXEKEaHHlOd8e96YQ%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kubernetesä¸­å¯¹Pod è¿›è¡Œ å¥åº·æ£€æŸ¥çš„åŠ¨æ‰‹å®éªŒï¼Œä½¿ç”¨mysqlé•œåƒ]]></title>    <link>https://juejin.cn/post/7578732288516194355</link>    <guid>https://juejin.cn/post/7578732288516194355</guid>    <pubDate>2025-12-02T01:24:27.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578732288516194355" data-draft-id="7578714735308472346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kubernetesä¸­å¯¹Pod è¿›è¡Œ å¥åº·æ£€æŸ¥çš„åŠ¨æ‰‹å®éªŒï¼Œä½¿ç”¨mysqlé•œåƒ"/> <meta itemprop="keywords" content="Kubernetes"/> <meta itemprop="datePublished" content="2025-12-02T01:24:27.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆé‡Œè°¢é¡¿"/> <meta itemprop="url" content="https://juejin.cn/user/3678304397695056"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kubernetesä¸­å¯¹Pod è¿›è¡Œ å¥åº·æ£€æŸ¥çš„åŠ¨æ‰‹å®éªŒï¼Œä½¿ç”¨mysqlé•œåƒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3678304397695056/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆé‡Œè°¢é¡¿
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T01:24:27.000Z" title="Tue Dec 02 2025 01:24:27 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    10
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>å½“ç„¶å¯ä»¥ï¼ä¸‹é¢æ˜¯ä¸€ä¸ª <strong>ä½¿ç”¨ MySQL å®˜æ–¹é•œåƒ</strong> çš„ Kubernetes Pod å¥åº·æ£€æŸ¥ï¼ˆHealth Checkï¼‰åŠ¨æ‰‹å®éªŒã€‚æˆ‘ä»¬å°†é…ç½® <strong>Liveness Probe</strong>ï¼ˆå­˜æ´»æ¢é’ˆï¼‰å’Œ <strong>Readiness Probe</strong>ï¼ˆå°±ç»ªæ¢é’ˆï¼‰ï¼Œå¹¶é€šè¿‡æ¨¡æ‹Ÿæ•…éšœè§‚å¯Ÿ Kubernetes å¦‚ä½•è‡ªåŠ¨å¤„ç†å¼‚å¸¸ã€‚</p>
<blockquote>
<p>âœ… æœ¬å®éªŒå®Œå…¨åŸºäº <strong>MySQL é•œåƒ</strong>ï¼Œæ— éœ€é¢å¤–ä¾èµ–ï¼Œé€‚åˆä½ çš„ç¦»çº¿æˆ–å†…ç½‘ç¯å¢ƒã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ğŸ¯ å®éªŒç›®æ ‡</h2>
<ol>
<li>ä¸º MySQL Pod é…ç½® <strong>Readiness Probe</strong>ï¼šç¡®ä¿ MySQL å®Œå…¨å¯åŠ¨åæ‰æ¥æ”¶æµé‡</li>
<li>ä¸º MySQL Pod é…ç½® <strong>Liveness Probe</strong>ï¼šå½“ MySQL è¿›ç¨‹å¡æ­»æ—¶è‡ªåŠ¨é‡å¯å®¹å™¨</li>
<li>è§‚å¯Ÿæ¢é’ˆå¤±è´¥æ—¶çš„è¡Œä¸ºå·®å¼‚</li>
</ol>
<hr/>
<h2 data-id="heading-1">ğŸ”§ å‰ææ¡ä»¶</h2>
<ul>
<li>å·²åœ¨èŠ‚ç‚¹ä¸ŠåŠ è½½ <code>mysql:latest</code> é•œåƒï¼ˆé€šè¿‡ <code>ctr import</code> æˆ–æå‰æ‹‰å–ï¼‰</li>
<li>ä½¿ç”¨ <code>imagePullPolicy: Never</code> é¿å…æ‹‰å–</li>
<li>å•å‰¯æœ¬ï¼ˆ<code>replicas: 1</code>ï¼‰ï¼Œå› ä¸ºå¤šå‰¯æœ¬ MySQL æ— ä¸»ä»ä¼šå†²çª</li>
</ul>
<hr/>
<h2 data-id="heading-2">ğŸ“„ å®éªŒ YAMLï¼šå¸¦å¥åº·æ£€æŸ¥çš„ MySQL Deployment</h2>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-comment"># mysql-health-check.yaml</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">apps/v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Deployment</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-health-check</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">replicas:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">matchLabels:</span>
      <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-health-check</span>
  <span class="hljs-attr">template:</span>
    <span class="hljs-attr">metadata:</span>
      <span class="hljs-attr">labels:</span>
        <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-health-check</span>
    <span class="hljs-attr">spec:</span>
      <span class="hljs-attr">containers:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql</span>
        <span class="hljs-attr">image:</span> <span class="hljs-string">docker.io/library/mysql:latest</span>
        <span class="hljs-attr">imagePullPolicy:</span> <span class="hljs-string">Never</span>
        <span class="hljs-attr">ports:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">containerPort:</span> <span class="hljs-number">3306</span>

        <span class="hljs-comment"># å¿…éœ€çš„ç¯å¢ƒå˜é‡</span>
        <span class="hljs-attr">env:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD</span>
          <span class="hljs-attr">value:</span> <span class="hljs-string">"MyPass123!"</span>

        <span class="hljs-comment"># æŒ‚è½½æ•°æ®ç›®å½•ï¼ˆé¿å…é‡å¯ä¸¢æ•°æ®ï¼‰</span>
        <span class="hljs-attr">volumeMounts:</span>
        <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-data</span>
          <span class="hljs-attr">mountPath:</span> <span class="hljs-string">/var/lib/mysql</span>

        <span class="hljs-comment"># =============== Readiness Probeï¼ˆå°±ç»ªæ¢é’ˆï¼‰===============</span>
        <span class="hljs-comment"># ä½¿ç”¨ mysqladmin ping æ£€æŸ¥æ˜¯å¦å¯å“åº”</span>
        <span class="hljs-attr">readinessProbe:</span>
          <span class="hljs-attr">exec:</span>
            <span class="hljs-attr">command:</span> [<span class="hljs-string">"mysqladmin"</span>, <span class="hljs-string">"ping"</span>, <span class="hljs-string">"-uroot"</span>, <span class="hljs-string">"-pMyPass123!"</span>]
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">15</span>   <span class="hljs-comment"># MySQL å¯åŠ¨è¾ƒæ…¢</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">10</span>
          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span>
          <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span>

        <span class="hljs-comment"># =============== Liveness Probeï¼ˆå­˜æ´»æ¢é’ˆï¼‰===============</span>
        <span class="hljs-attr">livenessProbe:</span>
          <span class="hljs-attr">exec:</span>
            <span class="hljs-attr">command:</span> [<span class="hljs-string">"mysqladmin"</span>, <span class="hljs-string">"ping"</span>, <span class="hljs-string">"-uroot"</span>, <span class="hljs-string">"-pMyPass123!"</span>]
          <span class="hljs-attr">initialDelaySeconds:</span> <span class="hljs-number">30</span>
          <span class="hljs-attr">periodSeconds:</span> <span class="hljs-number">20</span>
          <span class="hljs-attr">timeoutSeconds:</span> <span class="hljs-number">5</span>
          <span class="hljs-attr">failureThreshold:</span> <span class="hljs-number">3</span>

      <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-data</span>
        <span class="hljs-attr">emptyDir:</span> {}  <span class="hljs-comment"># æµ‹è¯•ç”¨ï¼›ç”Ÿäº§è¯·ç”¨ PVC</span>

      <span class="hljs-attr">tolerations:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">key:</span> <span class="hljs-string">node-role.kubernetes.io/master</span>
        <span class="hljs-attr">operator:</span> <span class="hljs-string">Exists</span>
        <span class="hljs-attr">effect:</span> <span class="hljs-string">NoSchedule</span>
<span class="hljs-meta">---</span>
<span class="hljs-comment"># åˆ›å»º Service ä¾›å¤–éƒ¨è¿æ¥ï¼ˆå¯é€‰ï¼‰</span>
<span class="hljs-attr">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-attr">kind:</span> <span class="hljs-string">Service</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-svc</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">selector:</span>
    <span class="hljs-attr">app:</span> <span class="hljs-string">mysql-health-check</span>
  <span class="hljs-attr">ports:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-attr">protocol:</span> <span class="hljs-string">TCP</span>
      <span class="hljs-attr">port:</span> <span class="hljs-number">3306</span>
      <span class="hljs-attr">targetPort:</span> <span class="hljs-number">3306</span>
  <span class="hljs-attr">type:</span> <span class="hljs-string">ClusterIP</span>
</code></pre>
<blockquote>
<p>ğŸ’¡ è¯´æ˜ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>mysqladmin ping</code> æ˜¯å®˜æ–¹æ¨èçš„å¥åº·æ£€æŸ¥æ–¹å¼</li>
<li><code>-pMyPass123!</code> ä¸­<strong>ä¸èƒ½æœ‰ç©ºæ ¼</strong>ï¼ˆå¦åˆ™å‘½ä»¤è§£æå¤±è´¥ï¼‰</li>
<li><code>initialDelaySeconds</code> è¦è¶³å¤Ÿé•¿ï¼ˆMySQL å†·å¯åŠ¨å¯èƒ½éœ€ 20+ ç§’ï¼‰</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-3">ğŸ§ª å®éªŒæ­¥éª¤</h2>
<h3 data-id="heading-4">ç¬¬ä¸€æ­¥ï¼šéƒ¨ç½² MySQL</h3>
<pre><code class="hljs">kubectl apply -f mysql-health-check.yaml
</code></pre>
<h3 data-id="heading-5">ç¬¬äºŒæ­¥ï¼šè§‚å¯Ÿå¯åŠ¨è¿‡ç¨‹</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æŸ¥çœ‹ Pod çŠ¶æ€ï¼ˆREADY åˆ—ä¼šä» 0/1 â†’ 1/1ï¼‰</span>
kubectl get pods -w -l <span class="hljs-attr">app</span>=mysql-health-check
</code></pre>
<p>ç­‰å¾…çº¦ 30 ç§’ï¼Œç›´åˆ°ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">NAME                                   READY   STATUS    RESTARTS   AGE
mysql<span class="hljs-operator">-</span>health<span class="hljs-operator">-</span><span class="hljs-keyword">check</span><span class="hljs-number">-7</span>d8b9c4b5d<span class="hljs-operator">-</span>abc12   <span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>     <span class="hljs-keyword">Running</span>   <span class="hljs-number">0</span>          <span class="hljs-number">45</span>s
</code></pre>
<blockquote>
<p>âœ… <code>READY=1/1</code> è¡¨ç¤º <strong>Readiness Probe æˆåŠŸ</strong></p>
</blockquote>
<h3 data-id="heading-6">ç¬¬ä¸‰æ­¥ï¼šéªŒè¯å¥åº·æ£€æŸ¥æ­£å¸¸å·¥ä½œ</h3>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># æŸ¥çœ‹è¯¦ç»†äº‹ä»¶</span>
kubectl describe pod -l <span class="hljs-attr">app</span>=mysql-health-check
</code></pre>
<p>åœ¨ <strong>Events</strong> éƒ¨åˆ†åº”çœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-erlang" lang="erlang">Successfully assigned ...
Created container mysql
Started container mysql
</code></pre>
<p><strong>æ²¡æœ‰</strong> <code>Readiness probe failed</code> æˆ– <code>Liveness probe failed</code> é”™è¯¯ã€‚</p>
<hr/>
<h2 data-id="heading-7">ğŸ”¥ å®éªŒ Part Aï¼šæ¨¡æ‹Ÿâ€œæœªå°±ç»ªâ€çŠ¶æ€ï¼ˆæµ‹è¯• Readiness Probeï¼‰</h2>
<blockquote>
<p>æˆ‘ä»¬æ— æ³•ç›´æ¥ä¿®æ”¹ MySQL å¯†ç æ¥ç ´åæ¢é’ˆï¼ˆä¼šæ°¸ä¹…é”æ­»ï¼‰ï¼Œä½†å¯ä»¥é€šè¿‡ <strong>ä¸´æ—¶åˆ é™¤ readinessProbe</strong> æ¥è§‚å¯Ÿåå‘æ•ˆæœâ€”â€”æ›´å®‰å…¨çš„æ–¹å¼æ˜¯ <strong>è§‚å¯Ÿå¯åŠ¨é˜¶æ®µ</strong>ã€‚</p>
</blockquote>
<p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥<strong>æ‰‹åŠ¨è§¦å‘ä¸€æ¬¡â€œæ…¢å¯åŠ¨â€åœºæ™¯</strong>ï¼š</p>
<ol>
<li>
<p>åˆ é™¤å½“å‰ Podï¼ˆDeployment ä¼šé‡å»ºï¼‰</p>
<pre><code class="hljs language-ini" lang="ini">kubectl delete pod -l <span class="hljs-attr">app</span>=mysql-health-check
</code></pre>
</li>
<li>
<p>ç«‹å³ watch çŠ¶æ€ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">kubectl get pods -w
</code></pre>
<p>ä½ ä¼šçœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">mysql<span class="hljs-operator">-</span>...   <span class="hljs-number">0</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>   Pending   <span class="hljs-number">0</span>   <span class="hljs-number">0</span>s
mysql<span class="hljs-operator">-</span>...   <span class="hljs-number">0</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>   ContainerCreating   <span class="hljs-number">0</span>   <span class="hljs-number">2</span>s
mysql<span class="hljs-operator">-</span>...   <span class="hljs-number">0</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>   <span class="hljs-keyword">Running</span>   <span class="hljs-number">0</span>   <span class="hljs-number">10</span>s   â† å·² <span class="hljs-keyword">Running</span>ï¼Œä½† READY<span class="hljs-operator">=</span><span class="hljs-number">0</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>ï¼
mysql<span class="hljs-operator">-</span>...   <span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>   <span class="hljs-keyword">Running</span>   <span class="hljs-number">0</span>   <span class="hljs-number">25</span>s   â† Readiness æˆåŠŸï¼Œå˜ä¸º <span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>
</code></pre>
</li>
</ol>
<p>âœ… <strong>ç»“è®º</strong>ï¼šåœ¨ <code>initialDelaySeconds</code> æœŸé—´å’Œæ¢é’ˆæˆåŠŸå‰ï¼ŒPod <strong>ä¸ä¼šè¢« Service åŠ å…¥ Endpoints</strong>ï¼Œå³ä½¿å®¹å™¨å·²è¿è¡Œï¼</p>
<hr/>
<h2 data-id="heading-8">ğŸ’¥ å®éªŒ Part Bï¼šæ¨¡æ‹Ÿâ€œè¿›ç¨‹å¡æ­»â€ï¼ˆæµ‹è¯• Liveness Probeï¼‰</h2>
<blockquote>
<p>æˆ‘ä»¬å°†è¿›å…¥å®¹å™¨ï¼Œ<strong>æ‰‹åŠ¨æ€æ­» MySQL è¿›ç¨‹</strong>ï¼Œè§‚å¯Ÿ Liveness æ˜¯å¦è§¦å‘é‡å¯ã€‚</p>
</blockquote>
<h4 data-id="heading-9">æ­¥éª¤ï¼š</h4>
<ol>
<li>
<p><strong>è¿›å…¥ MySQL å®¹å™¨</strong></p>
<pre><code class="hljs language-sql" lang="sql">POD_NAME<span class="hljs-operator">=</span>$(kubectl <span class="hljs-keyword">get</span> pod <span class="hljs-operator">-</span>l app<span class="hljs-operator">=</span>mysql<span class="hljs-operator">-</span>health<span class="hljs-operator">-</span><span class="hljs-keyword">check</span> <span class="hljs-operator">-</span>o jsonpath<span class="hljs-operator">=</span><span class="hljs-string">'{.items[0].metadata.name}'</span>)
kubectl <span class="hljs-keyword">exec</span> <span class="hljs-operator">-</span>it $POD_NAME <span class="hljs-comment">-- sh</span>
</code></pre>
</li>
<li>
<p><strong>åœ¨å®¹å™¨å†…æ€æ­» mysqld è¿›ç¨‹</strong></p>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># æŸ¥æ‰¾ mysqld PID</span>
ps aux | <span class="hljs-keyword">grep</span> mysqld

<span class="hljs-comment"># å‡è®¾ PID æ˜¯ 1ï¼ˆé€šå¸¸ä¸»è¿›ç¨‹æ˜¯ 1ï¼‰</span>
<span class="hljs-keyword">kill</span> -<span class="hljs-number">9</span> <span class="hljs-number">1</span>
</code></pre>
</li>
<li>
<p><strong>é€€å‡ºå®¹å™¨ï¼Œè§‚å¯Ÿ Pod çŠ¶æ€</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">kubectl get pods -w
</code></pre>
<p>ä½ ä¼šçœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">mysql<span class="hljs-operator">-</span>...   <span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>   <span class="hljs-keyword">Running</span>   <span class="hljs-number">0</span>   <span class="hljs-number">2</span>m
mysql<span class="hljs-operator">-</span>...   <span class="hljs-number">0</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>   <span class="hljs-keyword">Running</span>   <span class="hljs-number">1</span>   <span class="hljs-number">2</span>m30s   â† RESTARTS å˜æˆ <span class="hljs-number">1</span>ï¼
mysql<span class="hljs-operator">-</span>...   <span class="hljs-number">1</span><span class="hljs-operator">/</span><span class="hljs-number">1</span>   <span class="hljs-keyword">Running</span>   <span class="hljs-number">1</span>   <span class="hljs-number">3</span>m      â† é‡å¯å®Œæˆ
</code></pre>
</li>
<li>
<p><strong>æŸ¥çœ‹äº‹ä»¶ç¡®è®¤æ˜¯ Liveness å¯¼è‡´é‡å¯</strong></p>
<pre><code class="hljs language-bash" lang="bash">kubectl describe pod <span class="hljs-variable">$POD_NAME</span>
</code></pre>
<p>åœ¨ Events ä¸­åº”æœ‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Liveness probe failed: OCI runtime <span class="hljs-built_in">exec</span> failed: ...
(or) Liveness probe failed: mysqladmin: connect to server at <span class="hljs-string">'localhost'</span> failed
Killing container with <span class="hljs-built_in">id</span> containerd://mysql: Need to <span class="hljs-built_in">kill</span> Pod
</code></pre>
</li>
</ol>
<p>âœ… <strong>ç»“è®º</strong>ï¼šLiveness Probe å¤±è´¥åï¼ŒKubernetes <strong>è‡ªåŠ¨é‡å¯äº†å®¹å™¨</strong>ï¼Œå®ç°è‡ªæ„ˆï¼</p>
<hr/>
<h2 data-id="heading-10">ğŸ“Š å…³é”®çŸ¥è¯†ç‚¹æ€»ç»“</h2>























<table><thead><tr><th>æ¢é’ˆç±»å‹</th><th>æ£€æŸ¥å‘½ä»¤</th><th>ä½œç”¨</th><th>å¤±è´¥åæœ</th></tr></thead><tbody><tr><td><strong>Readiness</strong></td><td><code>mysqladmin ping</code></td><td>åˆ¤æ–­ MySQL æ˜¯å¦å¯æœåŠ¡</td><td>ä» Service Endpoints å‰”é™¤ï¼ˆä¸æ¥æ”¶æ–°æµé‡ï¼‰</td></tr><tr><td><strong>Liveness</strong></td><td><code>mysqladmin ping</code></td><td>åˆ¤æ–­ MySQL æ˜¯å¦å­˜æ´»</td><td>é‡å¯æ•´ä¸ªå®¹å™¨</td></tr></tbody></table>
<blockquote>
<p>âš ï¸ æ³¨æ„ï¼š<code>mysqladmin ping</code> ä¾èµ–æ­£ç¡®å¯†ç ï¼Œ<strong>å¿…é¡»ä¸ <code>MYSQL_ROOT_PASSWORD</code> ä¸€è‡´</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-11">ğŸ›¡ï¸ ç”Ÿäº§å»ºè®®</h2>
<ol>
<li>
<p><strong>å¯†ç ä¸è¦æ˜æ–‡å†™ YAML</strong> â†’ æ”¹ç”¨ Secret</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">env:</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD</span>
  <span class="hljs-attr">valueFrom:</span>
    <span class="hljs-attr">secretKeyRef:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">mysql-secret</span>
      <span class="hljs-attr">key:</span> <span class="hljs-string">password</span>
<span class="hljs-attr">readinessProbe:</span>
  <span class="hljs-attr">exec:</span>
    <span class="hljs-attr">command:</span> [<span class="hljs-string">"sh"</span>, <span class="hljs-string">"-c"</span>, <span class="hljs-string">"mysqladmin ping -uroot -p$(MYSQL_ROOT_PASSWORD)"</span>]
</code></pre>
</li>
<li>
<p><strong>æ•°æ®æŒä¹…åŒ–</strong> â†’ å°† <code>emptyDir</code> æ›¿æ¢ä¸º PVC</p>
</li>
<li>
<p><strong>è°ƒæ•´è¶…æ—¶å‚æ•°</strong> â†’ æ ¹æ®å®é™…æ€§èƒ½è°ƒæ•´ <code>initialDelaySeconds</code></p>
</li>
</ol>
<hr/>
<h2 data-id="heading-12">âœ… æ¸…ç†å®éªŒ</h2>
<pre><code class="hljs language-arduino" lang="arduino">kubectl <span class="hljs-keyword">delete</span> -f mysql-health-check.yaml
</code></pre>
<hr/>
<p>ç°åœ¨ä½ å°±æŒæ¡äº† <strong>å¦‚ä½•ä¸ºæœ‰çŠ¶æ€æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰é…ç½® Kubernetes å¥åº·æ£€æŸ¥</strong>ï¼è¿™ä¸ä»…èƒ½æå‡ç³»ç»Ÿç¨³å®šæ€§ï¼Œè¿˜èƒ½é¿å…æµé‡æ‰“åˆ°â€œå‡æ­»â€å®ä¾‹ã€‚</p>
<p>éœ€è¦æˆ‘å¸®ä½ ç”Ÿæˆ <strong>å¸¦ Secret + PVC çš„ç”Ÿäº§çº§ç‰ˆæœ¬</strong> å—ï¼Ÿæˆ–è€…æƒ³è¯•è¯• <strong>PostgreSQL / Redis çš„å¥åº·æ£€æŸ¥</strong>ï¼Ÿæ¬¢è¿ç»§ç»­æé—®ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git åŸºç¡€ï¼šç”Ÿæˆç‰ˆæœ¬ã€æ’¤æ¶ˆæ“ä½œã€ç‰ˆæœ¬é‡ç½®ã€å¿½ç•¥æ–‡ä»¶]]></title>    <link>https://juejin.cn/post/7579298511071920128</link>    <guid>https://juejin.cn/post/7579298511071920128</guid>    <pubDate>2025-12-03T08:51:49.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579298511071920128" data-draft-id="7579298511071543296" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git åŸºç¡€ï¼šç”Ÿæˆç‰ˆæœ¬ã€æ’¤æ¶ˆæ“ä½œã€ç‰ˆæœ¬é‡ç½®ã€å¿½ç•¥æ–‡ä»¶"/> <meta itemprop="keywords" content="å‰ç«¯,Git,GitHub"/> <meta itemprop="datePublished" content="2025-12-03T08:51:49.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Crystal328"/> <meta itemprop="url" content="https://juejin.cn/user/2359973194513272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git åŸºç¡€ï¼šç”Ÿæˆç‰ˆæœ¬ã€æ’¤æ¶ˆæ“ä½œã€ç‰ˆæœ¬é‡ç½®ã€å¿½ç•¥æ–‡ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2359973194513272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Crystal328
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:51:49.000Z" title="Wed Dec 03 2025 08:51:49 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. Git çš„å®‰è£…</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2F" target="_blank" title="https://git-scm.com/" ref="nofollow noopener noreferrer">git-scm.com</a></p>
<h2 data-id="heading-1">2. åˆæ¬¡è¿è¡ŒGitå‰çš„é…ç½®</h2>
<pre><code class="hljs language-csharp" lang="csharp">git config --<span class="hljs-keyword">global</span> user.name <span class="hljs-string">'your name'</span>   <span class="hljs-meta"># å…¨å±€é…ç½®ç”¨æˆ·å</span>
git config --<span class="hljs-keyword">global</span> user.email <span class="hljs-string">'your email'</span> <span class="hljs-meta"># å…¨å±€é…ç½®ç”¨æˆ·é‚®ç®±</span>
</code></pre>
<h2 data-id="heading-2">3. ç³»ç»Ÿé€šç”¨é…ç½®</h2>
<p>åœ¨<code>Git</code>å®‰è£…ç›®å½•ä¸‹çš„<code>/etc/gitconfig</code>æ–‡ä»¶ä¸­ï¼ŒåŒ…äº†å«ç³»ç»Ÿä¸Šæ¯ä¸€ä¸ªç”¨æˆ·åŠä»–ä»¬ä»“åº“çš„é€šç”¨é…ç½®ã€‚<br/>
åœ¨æ‰§è¡ŒÂ <code>git config</code>Â æ—¶å¸¦ä¸ŠÂ <code>--system</code>Â é€‰é¡¹ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¯»å†™è¯¥æ–‡ä»¶ä¸­çš„é…ç½®å˜é‡<br/>
Git å®‰è£…ç›®å½•ï¼Œå¯ä»¥æ‰§è¡Œ<code>where git</code>æ¥æ‰¾åˆ°</p>
<h2 data-id="heading-3">4. åˆå§‹åŒ–Gitæœ¬åœ°ä»“åº“</h2>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">init</span> <span class="hljs-meta"># åˆå§‹åŒ–Gitæœ¬åœ°ä»“åº“</span>
</code></pre>
<h2 data-id="heading-4">5. Gitä¸‰å¤§åŒºåŸŸ</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/333fbb44122f4cfbad2b945fc9d19112~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ3J5c3RhbDMyOA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356850&amp;x-signature=iIoolHLxm3BDWex%2FdVU3byg5oVA%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-5">6. å¦‚ä½•ç”Ÿæˆé¡¹ç›®ç‰ˆæœ¬</h2>
<ul>
<li><code>git status</code>Â ç”¨æ¥æŸ¥çœ‹é¡¹ç›®æ–‡ä»¶çŠ¶æ€</li>
<li><code>git add</code>Â å‘½ä»¤ï¼Œç”¨æ¥å°†å·¥ä½œåŒºä»£ç çš„å˜åŠ¨ï¼Œæäº¤åˆ°æš‚å­˜åŒº</li>
</ul>
<pre><code class="hljs language-git" lang="git">git add &lt;file&gt; &lt;file&gt;  # æäº¤æŒ‡å®šçš„æ–‡ä»¶åˆ°æš‚å­˜åŒº
git add . # å°†å·¥ä½œåŒºæ‰€æœ‰å˜åŠ¨æäº¤åˆ°æš‚å­˜åŒº
</code></pre>
<ul>
<li><code>git commit</code>Â å‘½ä»¤ï¼Œç”¨æ¥å°†æš‚å­˜åŒºçš„å†…å®¹æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼Œ<code>git commit</code>Â åæš‚å­˜åŒºå’Œæœ¬åœ°ç‰ˆæœ¬åº“çš„å†…å®¹æ˜¯ä¸€è‡´çš„</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">git commit   <span class="hljs-comment"># æäº¤ï¼Œæœ€ç»ˆåœ¨ç¼–è¾‘å™¨ä¸­è¾“å…¥æäº¤çš„æè¿°</span>
git commit -m <span class="hljs-string">'æäº¤æè¿°'</span>  <span class="hljs-comment"># åœ¨æäº¤çš„åŒæ—¶ï¼Œæ·»åŠ æœ¬æ¬¡æäº¤æè¿°</span>
</code></pre>
<ul>
<li><code>git log</code>Â æŸ¥çœ‹æäº¤å†å²è®°å½•</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">git <span class="hljs-built_in">log</span>   <span class="hljs-comment"># æ‰“å°è¯¦ç»†çš„æäº¤å†å²è®°å½•</span>
git <span class="hljs-built_in">log</span> --oneline <span class="hljs-comment"># ä»¥åˆ—è¡¨å½¢å¼ï¼Œæ‰“å°æäº¤çš„å†å²è®°å½•ï¼ˆç®€åŒ–ç‰ˆï¼‰</span>
</code></pre>
<h3 data-id="heading-6">6.1ã€æ–‡ä»¶çš„ä¸‰ç§çŠ¶æ€</h3>
<p>è¢« Git ç®¡ç†çš„é¡¹ç›®ï¼Œé¡¹ç›®æ–‡ä»¶å¯èƒ½å¤„äºä»¥ä¸‹ 3 ç§çŠ¶æ€ä¹‹ä¸€</p>
<ul>
<li><strong>å·²ä¿®æ”¹ï¼ˆmodifiedï¼‰</strong> ï¼šè¡¨ç¤ºä¸Šæ¬¡æäº¤åï¼Œé‡æ–°ä¿®æ”¹äº†çš„æ–‡ä»¶ï¼Œä½†è¿˜æ²¡æäº¤åˆ°æš‚å­˜åŒº</li>
<li><strong>å·²æš‚å­˜ï¼ˆstagedï¼‰</strong> ï¼šè¡¨ç¤ºå¯¹ä¸€ä¸ªå·²ä¿®æ”¹çš„æ–‡ä»¶æäº¤åˆ°äº†æš‚å­˜åŒºï¼Œä½†è¿˜æ²¡æœ‰æäº¤</li>
<li><strong>å·²æäº¤ï¼ˆcommittedï¼‰</strong> ï¼šè¡¨ç¤ºæ–‡ä»¶å·²æäº¤åˆ°æœ¬åœ°ä»“åº“</li>
</ul>
<h2 data-id="heading-7">7. æ’¤æ¶ˆæ“ä½œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgit-scm.com%2Fbook%2Fzh%2Fv2%2FGit-%25E5%259F%25BA%25E7%25A1%2580-%25E6%2592%25A4%25E6%25B6%2588%25E6%2593%258D%25E4%25BD%259C" target="_blank" title="https://git-scm.com/book/zh/v2/Git-%E5%9F%BA%E7%A1%80-%E6%92%A4%E6%B6%88%E6%93%8D%E4%BD%9C" ref="nofollow noopener noreferrer">Git å®˜æ–¹æ–‡æ¡£ - æ’¤æ¶ˆæ“ä½œ</a></h2>
<p>ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç§åœºæ™¯ï¼š</p>
<ul>
<li>æ’¤æ¶ˆä¸Šä¸€æ¬¡æäº¤</li>
<li>æ’¤é”€æš‚å­˜çš„æ–‡ä»¶</li>
<li>æ’¤é”€æ’¤é”€ä»¶çš„ä¿®æ”¹</li>
</ul>
<h3 data-id="heading-8">7.1 æ’¤æ¶ˆä¸Šä¸€æ¬¡æäº¤</h3>
<h4 data-id="heading-9">7.1.1 æäº¤å®Œäº†æ‰å‘ç°æäº¤ä¿¡æ¯å†™é”™äº†</h4>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">commit</span> <span class="hljs-comment">--amend   # æ’¤æ¶ˆä¸Šä¸€æ¬¡æäº¤</span>
</code></pre>
<p>è¿™ä¸ªå‘½ä»¤ä¼šå°†æš‚å­˜åŒºä¸­çš„æ–‡ä»¶æäº¤ã€‚ å¦‚æœè‡ªä¸Šæ¬¡æäº¤ä»¥æ¥ä½ è¿˜æœªåšä»»ä½•ä¿®æ”¹ï¼ˆä¾‹å¦‚ï¼Œåœ¨ä¸Šæ¬¡æäº¤åé©¬ä¸Šæ‰§è¡Œäº†æ­¤å‘½ä»¤ï¼‰ï¼Œ é‚£ä¹ˆå¿«ç…§ä¼šä¿æŒä¸å˜ï¼Œè€Œä½ <strong>æ‰€ä¿®æ”¹çš„åªæ˜¯æäº¤ä¿¡æ¯</strong>ã€‚</p>
<h4 data-id="heading-10">7.1.2 æäº¤åå‘ç°å¿˜è®°äº†æš‚å­˜æŸäº›éœ€è¦çš„ä¿®æ”¹</h4>
<ul>
<li>é‡æ–°æ‰§è¡Œ<code>git add</code>å‘½ä»¤å°†ä¿®æ”¹å†…å®¹æ·»åŠ åˆ°æš‚å­˜åŒº</li>
<li>ç„¶åå†é‡æ–°æäº¤ï¼Œä½†æäº¤æ—¶ä¸å¸Œæœ›ç”Ÿæˆæ–°çš„ç‰ˆæœ¬</li>
</ul>

<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m <span class="hljs-string">'V1-ç½‘ç«™å¤´éƒ¨'</span>   # ç”Ÿæˆä¸€ä¸ªç‰ˆæœ¬V1  ç¬¬ä¸€æ¬¡é”™è¯¯æäº¤
git <span class="hljs-keyword">add</span> .   # å°†ä¿®æ”¹çš„å†…å®¹æäº¤åˆ°æš‚å­˜åŒº

#æäº¤ç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬V2ï¼Œè¯¥ç‰ˆæœ¬ä¼šæ›¿æ¢ä¹‹å‰çš„é‚£ä¸ªç‰ˆæœ¬ï¼Œæ‰€ä»¥æœ€ç»ˆç”¨ git log <span class="hljs-comment">--onelineåªèƒ½çœ‹åˆ°æœ€åä¸€æ¬¡ç”Ÿæˆçš„ç‰ˆæœ¬V2</span>
git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m <span class="hljs-string">'V1-ç½‘ç«™å¤´éƒ¨å¯¼èˆªå¼€å‘å®Œæˆ'</span> <span class="hljs-comment">--amend</span>
</code></pre>
<h3 data-id="heading-11">7.2  æ’¤é”€æš‚å­˜çš„æ–‡ä»¶</h3>
<p>å¦‚æœä¿®æ”¹äº†ä¸¤ä¸ªæ–‡ä»¶å¹¶ä¸”æƒ³è¦å°†å®ƒä»¬ä½œä¸º<strong>åˆ†å¼€ä¸¤æ¬¡ç‹¬ç«‹çš„ä¿®æ”¹æäº¤</strong>ï¼Œ ä½†æ˜¯å´æ„å¤–åœ°è¾“å…¥Â <code>git add *</code>Â æš‚å­˜äº†å®ƒä»¬ä¸¤ä¸ªã€‚</p>
<ul>
<li>ä½¿ç”¨Â <code>git restore --staged &lt;file&gt;â€¦</code>Â æ¥å–æ¶ˆæš‚å­˜ã€‚</li>
</ul>

<pre><code class="hljs language-bash" lang="bash">git restore --staged login.html   <span class="hljs-comment"># å–æ¶ˆlogin.htmlæ–‡ä»¶çš„æš‚å­˜</span>

git restore --staged .  <span class="hljs-comment"># å–æ¶ˆæš‚å­˜åŒºæ‰€æœ‰æ–‡ä»¶çš„æš‚å­˜</span>
</code></pre>
<blockquote>
<p>æ³¨æ„ï¼š</p>
<ul>
<li><code>git restore --staged &lt;file&gt;</code>Â å‘½ä»¤åªä¼šå°†æ–‡ä»¶ä»æš‚å­˜åŒºç§»åŠ¨åˆ°å·¥ä½œå¹¶ä¸”å¹¶ä¼šä¸ä¼šå½±å“å·¥ä½œåŒºè¯¥æ–‡ä»¶çš„å†…å®¹ã€‚</li>
<li>æ¯”å¦‚æ–‡ä»¶æäº¤åˆ°æš‚å­˜åŒºæ—¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ºï¼š<code>'a'</code>ï¼Œåé¢å°†æ–‡ä»¶å†…å®¹ä¿®æ”¹ä¸º-<code>'ab'</code>ï¼Œç„¶åæ‰§è¡Œ<code>git restore --staged &lt;file&gt;</code>å°†æ–‡ä»¶ä»æš‚å­˜åŒºç§»é™¤ï¼Œæ­¤æ—¶å·¥ä½œåŒºè¯¥æ–‡ä»¶å†…å®¹ä»ä¸º<code>'ab'</code>ï¼Œå¹¶ä¸ä¼šè¢«ä¿®æ”¹ä¸ºÂ <code>'a'</code></li>
</ul>
</blockquote>
<h3 data-id="heading-12">7.3 å–æ¶ˆå¯¹æ–‡ä»¶çš„ä¿®æ”¹</h3>
<p>å¦‚æœä½ åœ¨ä¸Šä¸€æ¬¡<code>git add</code>å ï¼Œå¯¹æ–‡ä»¶<code>login.html</code>å†…å®¹åšäº†ä¿®æ”¹ï¼Œä½†ç°åœ¨ä½ æƒ³å»æ‰è¿™äº›ä¿®æ”¹ï¼Œå›åˆ°ä¸Šä¸€æ¬¡<code>git add</code>æ—¶çš„æ ·å¼ã€‚é‚£ä½ å°±éœ€è¦æ’¤é”€å¯¹<code>login.html</code>å†…å®¹çš„ä¿®æ”¹ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">git restore .  <span class="hljs-comment"># æ’¤æ¶ˆå¯¹å·¥ä½œå·¥æ‰€æœ‰æ–‡ä»¶çš„ä¿®æ”¹</span>
</code></pre>
<h2 data-id="heading-13">8. ç‰ˆæœ¬é‡ç½®</h2>
<p>Git ç‰ˆæœ¬é‡ç½®åˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µ</p>
<ul>
<li>åªé‡ç½®æœ¬åœ°ä»“åº“</li>
<li>é‡ç½®æœ¬åœ°ä»“åº“å’Œæš‚å­˜åŒº</li>
<li>é‡ç½®æœ¬åœ°ä»“åº“ã€æš‚å­˜åŒºå’Œå·¥ä½œåŒº</li>
</ul>
<h3 data-id="heading-14">8.1 é‡ç½®æœ¬åœ°ä»“åº“ ï¼ˆ--softï¼‰</h3>
<pre><code class="hljs language-perl" lang="perl">git <span class="hljs-keyword">reset</span> --soft ç‰ˆæœ¬å·    <span class="hljs-comment"># é‡ç½®æœ¬åœ°ä»“åº“</span>
</code></pre>
<h3 data-id="heading-15">8.2 é‡ç½®æœ¬åœ°ä»“åº“ä¸æš‚å­˜åŒº ï¼ˆ--mixedï¼‰</h3>
<pre><code class="hljs language-perl" lang="perl">git <span class="hljs-keyword">reset</span> --mixed ç‰ˆæœ¬å·   <span class="hljs-comment"># é‡ç½®æœ¬åœ°ä»“åº“å’Œæš‚å­˜åŒº</span>
git <span class="hljs-keyword">reset</span> ç‰ˆæœ¬å·  <span class="hljs-comment"># é‡ç½®æœ¬åœ°ä»“åº“å’Œæš‚å­˜åŒºï¼Œé»˜è®¤è¡Œä¸º</span>
</code></pre>
<h3 data-id="heading-16">8.3 é‡ç½®æœ¬åœ°åº“ã€æš‚å­˜åŒºã€å·¥ä½œåŒºï¼ˆ--hardï¼‰</h3>
<blockquote>
<p>æ³¨æ„ï¼š<br/>
<code>--hard</code>Â ä¼šé‡ç½®å·¥ä½œåŒºå†…å®¹ï¼Œæ‰€ä»¥åœ¨é‡ç½®å‰å¦‚æœå·¥ä½œåŒºå†…å®¹æœ‰æ²¡æœ‰æäº¤çš„ï¼Œé‡ç½®ååˆ™ä¼šé€ æˆå†…å®¹ä¸¢å¤±ã€‚å†…å®¹ä¸€æ—¦ä¸¢å¤±ï¼Œæ˜¯æ²¡æœ‰åŠæ³•æ‰¾å›çš„ã€‚<br/>
<strong>æ‰€ä»¥ä½¿ç”¨--hard å‘½ä»¤æ—¶ï¼Œè¦ç‰¹åˆ«å°å¿ƒã€‚</strong></p>
</blockquote>
<pre><code class="hljs language-css" lang="css">git reset <span class="hljs-attr">--hard</span> ç‰ˆæœ¬å·
</code></pre>
<h3 data-id="heading-17">8.4 git reflog å‘½ä»¤</h3>
<p><code>git reflog</code>å‘½ä»¤ï¼Œæ˜¯å¯ä»¥æŸ¥çœ‹åˆ°æ‰€æœ‰çš„ç‰ˆæœ¬å†å²è®°å½•ï¼ŒåŒ…æ‹¬æˆ‘ä»¬ä¹‹å‰è®¤ä¸ºè¢« â€œä¸¢å¼ƒâ€ çš„ç‰ˆæœ¬ã€‚</p>
<h2 data-id="heading-18">9.Â Git å¿½ç•¥æ–‡ä»¶(.gitignore æ–‡ä»¶)</h2>
<blockquote>
<p>æ–‡ä»¶<code>.gitignore</code>çš„æ ¼å¼è§„èŒƒå¦‚ä¸‹ï¼š</p>
</blockquote>
<ul>
<li>æ‰€æœ‰ç©ºè¡Œæˆ–è€…ä»¥Â <code>#</code>Â å¼€å¤´çš„è¡Œéƒ½ä¼šè¢« Git å¿½ç•¥ã€‚ #ä¸º<code>.gitignore</code>æ–‡ä»¶çš„æ³¨é‡Š</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æ³¨é‡Š</span>
</code></pre>
<ul>
<li>å¯ä»¥ä½¿ç”¨æ ‡å‡†çš„ glob æ¨¡å¼åŒ¹é…ï¼Œå®ƒä¼šé€’å½’åœ°åº”ç”¨åœ¨æ•´ä¸ªå·¥ä½œåŒºä¸­ã€‚ <i>æ³¨ï¼šæ‰€è°“çš„ glob æ¨¡å¼æ˜¯æŒ‡ shell æ‰€ä½¿ç”¨çš„ç®€åŒ–äº†çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</i></li>
</ul>
<blockquote>
<ul>
<li>æ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªä»»æ„å­—ç¬¦ï¼›</li>
<li><code>[abc]</code>Â åŒ¹é…ä»»ä½•ä¸€ä¸ªåˆ—åœ¨æ–¹æ‹¬å·ä¸­çš„å­—ç¬¦ ï¼ˆè¿™ä¸ªä¾‹å­è¦ä¹ˆåŒ¹é…ä¸€ä¸ª aï¼Œè¦ä¹ˆåŒ¹é…ä¸€ä¸ª bï¼Œè¦ä¹ˆåŒ¹é…ä¸€ä¸ª cï¼‰ï¼›</li>
<li>é—®å·ï¼ˆ<code>?</code>ï¼‰åªåŒ¹é…ä¸€ä¸ªä»»æ„å­—ç¬¦ï¼›</li>
<li>å¦‚æœåœ¨æ–¹æ‹¬å·ä¸­ä½¿ç”¨çŸ­åˆ’çº¿åˆ†éš”ä¸¤ä¸ªå­—ç¬¦ï¼Œ è¡¨ç¤ºæ‰€æœ‰åœ¨è¿™ä¸¤ä¸ªå­—ç¬¦èŒƒå›´å†…çš„éƒ½å¯ä»¥åŒ¹é…ï¼ˆæ¯”å¦‚Â <code>[0-9]</code>Â è¡¨ç¤ºåŒ¹é…æ‰€æœ‰ 0 åˆ° 9 çš„æ•°å­—ï¼‰ã€‚</li>
<li>ä½¿ç”¨ä¸¤ä¸ªæ˜Ÿå·<code>**</code>Â è¡¨ç¤ºåŒ¹é…ä»»æ„ä¸­é—´ç›®å½•ï¼Œæ¯”å¦‚Â <code>a/**/z</code>Â å¯ä»¥åŒ¹é…Â <code>a/z</code>Â ã€Â <code>a/b/z</code>Â æˆ–Â <code>a/b/c/z</code>Â ç­‰ã€‚</li>
</ul>
</blockquote>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">å¿½ç•¥æ‰€æœ‰ä»¥text.å¼€å¤´çš„æ–‡ä»¶ï¼Œä¸éœ€Gitç®¡ç†</span>
text.*
<span class="hljs-meta prompt_"># </span><span class="bash">Git å¿½ç•¥æ‰€æœ‰ä»¥ .o æˆ– .a ç»“å°¾çš„æ–‡ä»¶</span>
*.[oa]
<span class="hljs-meta prompt_"># </span><span class="bash">Gitå¿½ç•¥ä»¥ a.tmp æˆ–b.tmpç­‰ .tmpå‰é¢åªæœ‰ä¸€ä¸ªå­—ç¬¦çš„tmpæ–‡ä»¶</span>
?.tmp
<span class="hljs-meta prompt_"># </span><span class="bash">åªå¿½ç•¥ docçš„ç›´æ¥å­ç›®å½•ä¸‹çš„ä»»æ„pdfæ–‡ä»¶ï¼Œæ¯”å¦‚ï¼šdoc/a.b.pdfï¼Œä½†ä¸èƒ½å¿½ç•¥doc/a/b/c.pdf</span>
doc/*/*.pdf
<span class="hljs-meta prompt_"># </span><span class="bash">å¿½ç•¥ doc/ ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ä¸‹çš„ .pdf æ–‡ä»¶   å¦‚ doc/a/b.pdf  doc/a/b/c.pdf</span>
doc/**/*.pdf
</code></pre>
<ul>
<li>åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ<code>/</code>ï¼‰å¼€å¤´é˜²æ­¢é€’å½’ã€‚</li>
</ul>

<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">åªå¿½ç•¥å½“å‰ç›®å½•ä¸‹çš„ demo.txt æ–‡ä»¶ï¼Œè€Œä¸å¿½ç•¥ <span class="hljs-keyword">case</span>/demo.txt</span>
/demo.txt
<span class="hljs-meta prompt_">
# </span><span class="bash">å¿½ç•¥å½“å‰é¡¹ç›®ä¸­æ‰€æœ‰ demo.txtæ–‡ä»¶</span>
demo.txt
</code></pre>
<ul>
<li>åŒ¹é…æ¨¡å¼å¯ä»¥ä»¥ï¼ˆ<code>/</code>ï¼‰ç»“å°¾æŒ‡å®šç›®å½•ã€‚</li>
</ul>

<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å¿½ç•¥ ä»»ä½•ç›®å½•ä¸‹åä¸º node_modulesç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ ï¼ˆgitç®¡ç†çš„æ˜¯æ–‡ä»¶ä¸æ˜¯ç›®å½•ï¼Œæ‰€ä»¥è¯¥æ–‡ä»¶ä¸‹è¦æœ‰å†…å®¹ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨å¿½ç•¥ï¼‰</span>
node_modules/
</code></pre>
<ul>
<li>è¦å¿½ç•¥æŒ‡å®šæ¨¡å¼ä»¥å¤–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¯ä»¥åœ¨æ¨¡å¼å‰åŠ ä¸Šå¹å·ï¼ˆ<code>!</code>ï¼‰å–åã€‚</li>
</ul>

<pre><code class="hljs language-arduino" lang="arduino">test.*   # å¿½ç•¥æ‰€æœ‰ä»¥text.å¼€å¤´çš„æ–‡ä»¶ï¼Œä¸éœ€Gitç®¡ç†

!text.html  # ä¸å¿½ç•¥text.htmlæ–‡ä»¶ï¼Œè®©Gitç®¡ç†
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSåº”ç”¨å¼€å‘è€…çš„å®è—APP-HMOSä»£ç å·¥åŠ-ç»„ä»¶å †å æ»‘åŠ¨æŠ˜å æ•ˆæœï¼ˆä¸€ï¼‰]]></title>    <link>https://juejin.cn/post/7579264485258985487</link>    <guid>https://juejin.cn/post/7579264485258985487</guid>    <pubDate>2025-12-03T08:54:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579264485258985487" data-draft-id="7579264485258952719" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSåº”ç”¨å¼€å‘è€…çš„å®è—APP-HMOSä»£ç å·¥åŠ-ç»„ä»¶å †å æ»‘åŠ¨æŠ˜å æ•ˆæœï¼ˆä¸€ï¼‰"/> <meta itemprop="keywords" content="HarmonyOS"/> <meta itemprop="datePublished" content="2025-12-03T08:54:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Huangå…„"/> <meta itemprop="url" content="https://juejin.cn/user/52404619842712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSåº”ç”¨å¼€å‘è€…çš„å®è—APP-HMOSä»£ç å·¥åŠ-ç»„ä»¶å †å æ»‘åŠ¨æŠ˜å æ•ˆæœï¼ˆä¸€ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/52404619842712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Huangå…„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:54:14.000Z" title="Wed Dec 03 2025 08:54:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>ä»Šå¤©æˆ‘ä»¬æ¥æ‹†è§£å¤åˆ»ä¸€ä¸‹<code>HMOSä»£ç å·¥åŠ</code>ä¸­çš„<strong>ç»„ä»¶å †å æ»‘åŠ¨æŠ˜å æ•ˆæœ</strong>ã€‚<br/>
å½“ç„¶è¿™ä¸ªæ˜¯æœ‰æºç çš„ï¼Œä½†ä¸å¦¨ç¢æˆ‘ä»¬è‡ªå·±å…ˆæ€è€ƒä¸€ä¸‹ï¼Œå·¥ä½œä¸­é‡åˆ°å…¶ä»–æ•ˆæœä¹Ÿèƒ½è‡ªå·±å®ç°ã€‚</p>
<p>å…ˆçœ‹ä¸‹æ•ˆæœå›¾ <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c876a00b643b41d69d1b3e44e869f112~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356854&amp;x-signature=HHznPJ1MF7sgEt6w5zsIDEp0wRc%3D" width="45%" alt="ç»„ä»¶å †å æ•ˆæœ" loading="lazy"/></p>
<h2 data-id="heading-1">æ‹†è§£é¡µé¢</h2>
<h3 data-id="heading-2">é¡µé¢ç»“æ„</h3>
<p>å¤§è‡´åˆ’åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/920799e18fea4d6f9068bc089da18adc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356854&amp;x-signature=IXz71h3LYuJ%2F80KFd1%2BuHI6f4gY%3D" width="45%" loading="lazy"/></p>
<ol>
<li>é¡¶éƒ¨çš„ä¸ªäººå¤´åƒå’Œæ‰«ç æ•ˆæœ</li>
<li>æœç´¢æ¡†ï¼šå¥½ç‰©ç²¾é€‰</li>
<li>ç¬”è®°æœ¬ã€æ™ºæ…§å±ã€éŸ³ç®±</li>
<li>åˆ†ç±»å’Œå•†å“åˆ—è¡¨</li>
</ol>
<h3 data-id="heading-3">åŠ¨ç”»æ•ˆæœ</h3>
<ol>
<li>æœç´¢æ¡†å¥½ç‰©ç²¾é€‰æ¨¡å—åœ¨é¡µé¢å‘ä¸Šæ»‘åŠ¨æ—¶é«˜åº¦é€æ¸å˜å°ï¼Œæœ€ç»ˆé«˜åº¦å›ºå®šï¼Œè¦†ç›–é¡¶éƒ¨çš„ä¸ªäººå¤´åƒå’Œæ‰«ç å›¾æ ‡</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†ç¬”è®°æœ¬ã€æ™ºæ…§å±ã€éŸ³ç®±åœ¨ä¸Šæ»‘è¿‡ç¨‹ä¸­ä¸€ç›´å¤„äºæœç´¢æ¡†åº•éƒ¨ï¼Œç„¶åé€æ¸é€æ˜ã€‚æœ€ç»ˆæ›¿æ¢ä¸ºæ¨ªå‘æ»‘åŠ¨çš„åˆ—è¡¨</li>
<li>æ›¿æ¢ä¸ºæ¨ªå‘æ»‘åŠ¨åˆ—è¡¨æ—¶ï¼Œæ¨ªå‘åˆ—è¡¨ç”±é€æ˜å˜ä¸ºä¸é€æ˜ï¼Œåˆ—è¡¨é¡¹ç›®é—´è·é€æ¸å˜å°</li>
<li>åœ¨ä¸Šæ»‘è¿‡ç¨‹ä¸­åˆ†ç±»é€æ¸ç¼©å°ï¼Œå¹¶ä¸”é€æ˜åº¦é€æ¸é™ä½ï¼Œç›®æµ‹çœ‹èµ·æ¥é€æ˜åº¦å’Œç¬¬ä¸‰éƒ¨åˆ†ä¸€è‡´ã€‚</li>
<li>åœ¨ä¸‹æ»‘è¿‡ç¨‹ä¸­ä¸Šè¿°æ•ˆæœåè½¬</li>
</ol>
<h3 data-id="heading-4">æ€è·¯</h3>
<p>æ•´ä¸ªé¡µé¢æ˜¯å¯ä»¥æ»‘åŠ¨çš„ï¼Œå¹¶ä¸”åœ¨æœç´¢æ¡†é«˜åº¦ä¸å†å˜åŒ–ä¸”å›ºå®šåœ¨é¡¶éƒ¨çš„æ—¶å€™ï¼Œåº•éƒ¨åˆ†ç±»å’Œå•†å“åˆ—è¡¨æ˜¯å¯ä»¥ç»§ç»­æ»‘åŠ¨çš„ã€‚å› æ­¤é¡µé¢éœ€è¦ä¸¤ä¸ªæ»‘åŠ¨ç»„ä»¶åµŒå¥—ã€‚</p>
<ol>
<li>ç›‘å¬å¤–éƒ¨æ»‘åŠ¨ç»„ä»¶çš„æ»‘åŠ¨äº‹ä»¶ï¼Œæ ¹æ®æ»‘åŠ¨è·ç¦»è®¡ç®—æœç´¢æ¡†é«˜åº¦</li>
<li>ç›‘å¬å†…éƒ¨æ»‘åŠ¨ç»„ä»¶çš„æ»‘åŠ¨äº‹ä»¶ï¼Œæ ¹æ®æ»‘åŠ¨è·ç¦»è®¡ç®—å¦‚ä¸‹æ•°æ®
<ul>
<li>ç¬¬ä¸‰éƒ¨åˆ†é€æ˜åº¦</li>
<li>æ˜¯å¦å°†ç¬¬ä¸‰éƒ¨åˆ†æ›¿æ¢ä¸ºæ¨ªå‘æ»‘åŠ¨åˆ—è¡¨</li>
<li>æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨çš„é€æ˜åº¦</li>
<li>æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨çš„åˆ—è¡¨é¡¹é—´è·</li>
<li>ç¬¬å››éƒ¨åˆ†åˆ†ç±»çš„å¤§å°å’Œé€æ˜åº¦</li>
</ul>
</li>
<li>å‘ä¸Šæ»‘åŠ¨æ—¶éœ€è¦è¦†ç›–é¡¶éƒ¨çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥ç”¨<code>Stack</code>æ¥å¸ƒå±€</li>
<li>å‘ä¸Šæ»‘åŠ¨æ—¶ï¼Œå½“ç¬¬ä¸‰éƒ¨åˆ†æ›¿æ¢ä¸ºæ¨ªå‘æ»‘åŠ¨åˆ—è¡¨ä¹‹åï¼Œç»§ç»­å‘ä¸Šæ»‘åŠ¨åº•éƒ¨ç¬¬å››éƒ¨åˆ†çš„å•†å“åˆ—è¡¨éœ€è¦è¢«æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨è¦†ç›–ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ç”¨<code>Stack</code>å¸ƒå±€ï¼Œå±‚æ¬¡å¯ä»¥ç”¨<code>zIndex</code>å±æ€§æ§åˆ¶</li>
</ol>
<h2 data-id="heading-5">å®ç°</h2>
<p>å…ˆæ¥å®ç°å‰ä¸¤ä¸ªéƒ¨åˆ†ï¼Œæ¯”è¾ƒç®€å•:
æœ€å¤–å±‚æ˜¯ä¸€ä¸ª<code>Stack</code>,é¡¶éƒ¨å¯¹é½ï¼ŒåŒ…å«ä¸€ä¸ª<code>Row</code>å’Œ<code>Scroll</code>ã€‚ç”±äºScrollåªèƒ½åŒ…å«ä¸€ä¸ªç›´æ¥å­æ§ä»¶ï¼Œæ·»åŠ ä¸€ä¸ª<code>Column</code>,åœ¨è¿™ä¸ª<code>Column</code>ä¸­æ¥å†™æˆ‘ä»¬çš„æ»‘åŠ¨å¸ƒå±€ã€‚
æ»‘åŠ¨æ—¶æœç´¢æ¡†é«˜åº¦éœ€è¦åŠ¨æ€å˜åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå˜é‡è¡¨ç¤ºæœç´¢æ¡†é«˜åº¦ã€‚åœ¨<code>Scroll</code>çš„<code>onScrollFrameBegin</code>å›è°ƒä¸­è®¡ç®—æœç´¢æ¡†é«˜åº¦å€¼ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Stack</span>({<span class="hljs-attr">alignContent</span>:<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Top</span>}) {
      <span class="hljs-title class_">Row</span>(){
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"UserIcon"</span>)
        <span class="hljs-title class_">Blank</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">0</span>)
        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Scan"</span>)
      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">padding</span>({<span class="hljs-attr">left</span>:<span class="hljs-number">15</span>,<span class="hljs-attr">right</span>:<span class="hljs-number">15</span>}).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)

      <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">outSideScrollController</span>){
        <span class="hljs-title class_">Column</span>(){
          <span class="hljs-title class_">Row</span>().<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">searchAreaHeight</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)
        }.<span class="hljs-title function_">margin</span>({<span class="hljs-attr">top</span>:<span class="hljs-number">50</span>}).<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>)
      }.<span class="hljs-title function_">padding</span>({<span class="hljs-attr">left</span>:<span class="hljs-number">15</span>,<span class="hljs-attr">right</span>:<span class="hljs-number">15</span>}).<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
      .<span class="hljs-title function_">onScrollFrameBegin</span>(<span class="hljs-function">(<span class="hljs-params">offset:<span class="hljs-built_in">number</span>,state:ScrollState</span>)=&gt;</span>{
        <span class="hljs-keyword">let</span> yOffset = <span class="hljs-variable language_">this</span>.<span class="hljs-property">outSideScrollController</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-property">yOffset</span>
				<span class="hljs-comment">//ä¸ºäº†æœ‰ä¸€ä¸ªè§†å·®æ•ˆæœï¼Œè¿™é‡Œè®¾ç½®ä¸€ä¸ªç³»æ•°</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchAreaHeight</span> = <span class="hljs-number">100</span> - yOffset * <span class="hljs-number">0.6</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-attr">offsetRemain</span>:offset}
      })

    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#f1f1f1"</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  }
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83ec65e971ce4114a2b6f46d4aca9145~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356854&amp;x-signature=fGwBLt0pqc642BqpkPqfjBGiO6Q%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
çœ‹èµ·æ¥æ•ˆæœè¿˜è¡Œï¼Œæ›¿æ¢ä¸€ä¸‹ç´ æ
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ec3d928fd5a64f93a53eedb9b3ccad85~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356854&amp;x-signature=1tP5xSQ8ddXtyvZLIUyghAewBXI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/>
è¿™æ ·æˆ‘ä»¬å°±å…ˆå®Œæˆäº†ç®€å•çš„å‰ä¸¤ä¸ªéƒ¨åˆ†ã€‚ä¸‹ä¸€ç¯‡æˆ‘ä»¬ç»§ç»­å®ç°æ¥ä¸‹æ¥çš„éƒ¨åˆ†ã€‚</p>
<hr/>
<p>ã€ æ›´å¤šç²¾å½©å†…å®¹ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼šã€åç§°ï¼šHarmonyOSå¼€å‘è€…æŠ€æœ¯ï¼ŒIDï¼šHarmonyOS_Devã€‘ï¼›ä¹Ÿæ¬¢è¿åŠ å…¥é¸¿è’™å¼€å‘è€…äº¤æµç¾¤ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwork.weixin.qq.com%2Fgm%2F48f89e7a4c10206e053e01ad124004a0%25E3%2580%2591" target="_blank" title="https://work.weixin.qq.com/gm/48f89e7a4c10206e053e01ad124004a0%E3%80%91" ref="nofollow noopener noreferrer">work.weixin.qq.com/gm/48f89e7aâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android Jetpack - 2 ViewModel]]></title>    <link>https://juejin.cn/post/7579385656779587618</link>    <guid>https://juejin.cn/post/7579385656779587618</guid>    <pubDate>2025-12-03T08:46:53.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579385656779587618" data-draft-id="7579321624014045224" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android Jetpack - 2 ViewModel"/> <meta itemprop="keywords" content="å‰ç«¯,Android"/> <meta itemprop="datePublished" content="2025-12-03T08:46:53.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é’è²843"/> <meta itemprop="url" content="https://juejin.cn/user/541408646929991"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android Jetpack - 2 ViewModel
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/541408646929991/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é’è²843
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:46:53.000Z" title="Wed Dec 03 2025 08:46:53 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. è®¤è¯†ViewModel</h2>
<h3 data-id="heading-1">1.1 ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ViewModelï¼Ÿ</h3>
<p>åœ¨ä¼ ç»Ÿçš„Androidå¼€å‘ä¸­ï¼Œå¼€å‘è€…é¢ä¸´å‡ ä¸ªæ ¸å¿ƒç—›ç‚¹ï¼ŒViewModelæ­£æ˜¯ä¸ºè§£å†³è¿™äº›é—®é¢˜è€Œè®¾è®¡çš„æ¶æ„ç»„ä»¶ã€‚</p>
<p><strong>å››å¤§æ ¸å¿ƒé—®é¢˜</strong>ï¼š</p>
<ol>
<li><strong>æ•°æ®ä¸¢å¤±é—®é¢˜</strong>ï¼šActivity/Fragmentå› <strong>é…ç½®å˜æ›´</strong>ï¼ˆå±å¹•æ—‹è½¬ã€è¯­è¨€åˆ‡æ¢ã€æ·±è‰²æ¨¡å¼åˆ‡æ¢ï¼‰è€Œé‡å»ºæ—¶ï¼Œæ‰€æœ‰ä¸´æ—¶UIæ•°æ®ï¼ˆç”¨æˆ·è¾“å…¥ã€åˆ—è¡¨æ»šåŠ¨ä½ç½®ã€æœªæäº¤çš„è¡¨å•ï¼‰éƒ½ä¼šä¸¢å¤±ã€‚</li>
<li><strong>å†…å­˜æ³„æ¼é£é™©</strong>ï¼šå¼‚æ­¥ä»»åŠ¡ï¼ˆç½‘ç»œè¯·æ±‚ã€æ•°æ®åº“æ“ä½œï¼‰æŒæœ‰UIç»„ä»¶çš„å¼•ç”¨ï¼Œå½“UIé”€æ¯åä»»åŠ¡ä»åœ¨æ‰§è¡Œï¼Œå¯¼è‡´Activityæ— æ³•è¢«åƒåœ¾å›æ”¶ã€‚</li>
<li><strong>èŒè´£è¾¹ç•Œæ¨¡ç³Š</strong>ï¼šActivityå’ŒFragmentå˜æˆäº†"ä¸Šå¸ç±»"ï¼Œæ—¢è¦å¤„ç†UIäº¤äº’ã€è§†å›¾ç»‘å®šï¼Œåˆè¦å¤„ç†æ•°æ®åŠ è½½ã€ä¸šåŠ¡é€»è¾‘ï¼Œè¿åäº†å•ä¸€èŒè´£åŸåˆ™ã€‚</li>
<li><strong>æµ‹è¯•å›°éš¾</strong>ï¼šä¸šåŠ¡é€»è¾‘ä¸Androidç»„ä»¶ï¼ˆContextã€Viewï¼‰ç´§è€¦åˆï¼Œéš¾ä»¥ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œå¿…é¡»ä¾èµ–æ˜‚è´µçš„ä»ªå™¨åŒ–æµ‹è¯•ã€‚</li>
</ol>
<p><strong>ViewModelçš„è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¼ ç»Ÿæ–¹å¼ - æ•°æ®éšActivityé”€æ¯</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ProblemActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> userInput: String = <span class="hljs-string">""</span> <span class="hljs-comment">// æ—‹è½¬å±å¹•åä¸¢å¤±!</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> currentPage: <span class="hljs-built_in">Int</span> = <span class="hljs-number">1</span>   <span class="hljs-comment">// æ—‹è½¬å±å¹•åä¸¢å¤±!</span>
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onSaveInstanceState</span><span class="hljs-params">(outState: <span class="hljs-type">Bundle</span>)</span></span> {
        <span class="hljs-keyword">super</span>.onSaveInstanceState(outState)
        <span class="hljs-comment">// å¿…é¡»æ‰‹åŠ¨ä¿å­˜æ¯ä¸ªå­—æ®µ</span>
        outState.putString(<span class="hljs-string">"input"</span>, userInput)
        outState.putInt(<span class="hljs-string">"page"</span>, currentPage)
    }
}

<span class="hljs-comment">// ViewModelæ–¹å¼ - æ•°æ®è‡ªåŠ¨ä¿ç•™</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SolutionViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _userInput = MutableLiveData(<span class="hljs-string">""</span>)
    <span class="hljs-keyword">val</span> userInput: LiveData&lt;String&gt; = _userInput <span class="hljs-comment">// æ—‹è½¬åä¾ç„¶å­˜åœ¨</span>
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _currentPage = MutableLiveData(<span class="hljs-number">1</span>)
    <span class="hljs-keyword">val</span> currentPage: LiveData&lt;<span class="hljs-built_in">Int</span>&gt; = _currentPage <span class="hljs-comment">// æ—‹è½¬åä¾ç„¶å­˜åœ¨</span>
}
</code></pre>
<h3 data-id="heading-2">1.2 ViewModelçš„ä½¿ç”¨æ–¹æ³•</h3>
<p><strong>åŸºæœ¬æ¨¡å¼ï¼šçŠ¶æ€ç®¡ç†ä¸UIå“åº”</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. å®šä¹‰ViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userId: String,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> repository: UserRepository
) : ViewModel() {
    
    <span class="hljs-comment">// UIçŠ¶æ€å°è£…</span>
    <span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UiState</span>(
        <span class="hljs-keyword">val</span> user: User? = <span class="hljs-literal">null</span>,
        <span class="hljs-keyword">val</span> isLoading: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>,
        <span class="hljs-keyword">val</span> error: String? = <span class="hljs-literal">null</span>
    )
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _uiState = MutableStateFlow(UiState())
    <span class="hljs-keyword">val</span> uiState: StateFlow&lt;UiState&gt; = _uiState.asStateFlow()
    
    <span class="hljs-comment">// åˆå§‹åŒ–åŠ è½½</span>
    <span class="hljs-keyword">init</span> {
        loadUser()
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = <span class="hljs-literal">true</span>) }
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> user = repository.getUser(userId)
                _uiState.update { it.copy(isLoading = <span class="hljs-literal">false</span>, user = user) }
            } <span class="hljs-keyword">catch</span> (e: Exception) {
                _uiState.update { it.copy(isLoading = <span class="hljs-literal">false</span>, error = e.message) }
            }
        }
    }
    
    <span class="hljs-comment">// ç”¨æˆ·æ“ä½œå¤„ç†</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onRefresh</span><span class="hljs-params">()</span></span> {
        loadUser()
    }
}

<span class="hljs-comment">// 2. åœ¨Activity/Fragmentä¸­ä½¿ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: UserProfileViewModel <span class="hljs-keyword">by</span> viewModels {
        UserProfileViewModelFactory(<span class="hljs-string">"user123"</span>, UserRepository())
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        
        <span class="hljs-comment">// è§‚å¯ŸUIçŠ¶æ€å˜åŒ–</span>
        lifecycleScope.launch {
            repeatOnLifecycle(Lifecycle.State.STARTED) {
                viewModel.uiState.collect { state -&gt;
                    <span class="hljs-keyword">when</span> {
                        state.isLoading -&gt; showLoading()
                        state.error != <span class="hljs-literal">null</span> -&gt; showError(state.error)
                        state.user != <span class="hljs-literal">null</span> -&gt; showUser(state.user)
                    }
                }
            }
        }
        
        <span class="hljs-comment">// ç»‘å®šç”¨æˆ·æ“ä½œ</span>
        refreshButton.setOnClickListener {
            viewModel.onRefresh()
        }
    }
}
</code></pre>
<h3 data-id="heading-3">1.3 ViewModelçš„åˆ›å»ºæ–¹å¼</h3>
<p><strong>å¤šç§åˆ›å»ºæ–¹å¼å¯¹æ¯”ä¸é€‰æ‹©</strong>ï¼š</p>








































<table><thead><tr><th>æ–¹å¼</th><th>ä»£ç ç¤ºä¾‹</th><th>é€‚ç”¨åœºæ™¯</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>åŸºç¡€æ–¹å¼</strong></td><td><code>ViewModelProvider(this).get(MyViewModel::class.java)</code></td><td>ç®€å•åœºæ™¯ã€æ•™å­¦ç¤ºä¾‹</td><td>æ— éœ€é¢å¤–ä¾èµ–</td><td>ä»£ç å†—é•¿ï¼Œéœ€æ‰‹åŠ¨ç®¡ç†</td></tr><tr><td><strong>Kotlinå§”æ‰˜</strong></td><td><code>private val vm: MyViewModel by viewModels()</code></td><td>ç»å¤§å¤šæ•°åœºæ™¯</td><td>ç®€æ´ã€å»¶è¿Ÿåˆå§‹åŒ–ã€ç©ºå®‰å…¨</td><td>éœ€è¦æ·»åŠ ktxä¾èµ–</td></tr><tr><td><strong>è‡ªå®šä¹‰Factory</strong></td><td><code>by viewModels { MyFactory(params) }</code></td><td>éœ€è¦å‚æ•°çš„ViewModel</td><td>æ”¯æŒä¾èµ–æ³¨å…¥</td><td>éœ€è¦ç¼–å†™Factoryç±»</td></tr><tr><td><strong>Hiltæ³¨å…¥</strong></td><td><code>@HiltViewModel class MyViewModel @Inject constructor()</code></td><td>ç°ä»£é¡¹ç›®ã€å¤šæ¨¡å—æ¶æ„</td><td>å…¨è‡ªåŠ¨ä¾èµ–ç®¡ç†</td><td>éœ€è¦é…ç½®Hilt</td></tr></tbody></table>
<p><strong>1. Kotlinå±æ€§å§”æ‰˜ï¼ˆæ¨èï¼‰</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Activityä¸­</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-comment">// æœ€ç®€å•çš„æ–¹å¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel1: MyViewModel <span class="hljs-keyword">by</span> viewModels()
    
    <span class="hljs-comment">// å¸¦è‡ªå®šä¹‰Factory</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel2: MyViewModel <span class="hljs-keyword">by</span> viewModels {
        MyViewModelFactory(repository)
    }
}

<span class="hljs-comment">// Fragmentä¸­</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFragment</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-comment">// Fragmentä½œç”¨åŸŸ</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel1: MyViewModel <span class="hljs-keyword">by</span> viewModels()
    
    <span class="hljs-comment">// ä¸Activityå…±äº«ï¼ˆå¤šFragmenté€šä¿¡ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sharedViewModel: SharedViewModel <span class="hljs-keyword">by</span> activityViewModels()
    
    <span class="hljs-comment">// å¸¦å‚æ•°</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> detailViewModel: DetailViewModel <span class="hljs-keyword">by</span> viewModels {
        DetailViewModelFactory(args.itemId)
    }
}
</code></pre>
<p><strong>2. è‡ªå®šä¹‰ViewModelFactory</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¸¦å‚æ•°çš„ViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userId: String,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModel() { <span class="hljs-comment">/* ... */</span> }

<span class="hljs-comment">// å¯¹åº”çš„Factory</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserViewModelFactory</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userId: String,
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> userRepository: UserRepository
) : ViewModelProvider.Factory {
    
    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {
        <span class="hljs-comment">// 1. ç±»å‹å®‰å…¨æ£€æŸ¥</span>
        require(modelClass.isAssignableFrom(UserViewModel::<span class="hljs-keyword">class</span>.java)) {
            <span class="hljs-string">"Unknown ViewModel class: <span class="hljs-variable">$modelClass</span>"</span>
        }
        <span class="hljs-comment">// 2. åˆ›å»ºå®ä¾‹</span>
        <span class="hljs-keyword">return</span> UserViewModel(userId, userRepository) <span class="hljs-keyword">as</span> T
    }
}

<span class="hljs-comment">// 3. ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> factory = UserViewModelFactory(<span class="hljs-string">"user123"</span>, repository)
<span class="hljs-keyword">val</span> viewModel: UserViewModel <span class="hljs-keyword">by</span> viewModels { factory }
</code></pre>
<h2 data-id="heading-4">2. ViewModelå®ç°åŸç†åˆ†æ</h2>
<h3 data-id="heading-5">2.1 ViewModelçš„åˆ›å»ºè¿‡ç¨‹</h3>
<p><strong>æ ¸å¿ƒæµç¨‹æºç åˆ†æ</strong>ï¼š</p>
<p>java</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// ViewModelProvider.java - è·å–ViewModelçš„æ ¸å¿ƒé€»è¾‘</span>
<span class="hljs-selector-tag">public</span> &lt;<span class="hljs-selector-tag">T</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">ViewModel</span>&gt; <span class="hljs-selector-tag">T</span> <span class="hljs-selector-tag">get</span>(<span class="hljs-variable">@NonNull</span> Class&lt;T&gt; modelClass) {
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">canonicalName</span> = <span class="hljs-selector-tag">modelClass</span><span class="hljs-selector-class">.getCanonicalName</span>();
    <span class="hljs-comment">// 1. ç”Ÿæˆå”¯ä¸€Keyï¼šé»˜è®¤å‰ç¼€ + ç±»å…¨å</span>
    <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span> = "<span class="hljs-selector-tag">androidx</span><span class="hljs-selector-class">.lifecycle</span><span class="hljs-selector-class">.ViewModelProvider</span><span class="hljs-selector-class">.DefaultKey</span>:" + <span class="hljs-selector-tag">canonicalName</span>;
    <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">get</span>(key, modelClass);
}

<span class="hljs-selector-tag">public</span> &lt;<span class="hljs-selector-tag">T</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">ViewModel</span>&gt; <span class="hljs-selector-tag">T</span> <span class="hljs-selector-tag">get</span>(<span class="hljs-variable">@NonNull</span> String key, <span class="hljs-variable">@NonNull</span> Class&lt;T&gt; modelClass) {
    <span class="hljs-comment">// 2. å…ˆä»ViewModelStoreä¸­è·å–å·²å­˜åœ¨çš„å®ä¾‹</span>
    <span class="hljs-selector-tag">ViewModel</span> <span class="hljs-selector-tag">viewModel</span> = <span class="hljs-selector-tag">mViewModelStore</span><span class="hljs-selector-class">.get</span>(key);
    
    <span class="hljs-selector-tag">if</span> (modelClass.<span class="hljs-built_in">isInstance</span>(viewModel)) {
        <span class="hljs-comment">// 3. å¦‚æœç±»å‹åŒ¹é…ï¼Œç›´æ¥è¿”å›ï¼ˆå¤ç”¨å®ä¾‹ï¼‰</span>
        <span class="hljs-selector-tag">return</span> (T) <span class="hljs-selector-tag">viewModel</span>;
    }
    
    <span class="hljs-comment">// 4. å¦åˆ™é€šè¿‡Factoryåˆ›å»ºæ–°å®ä¾‹</span>
    <span class="hljs-selector-tag">viewModel</span> = <span class="hljs-selector-tag">mFactory</span><span class="hljs-selector-class">.create</span>(modelClass);
    <span class="hljs-comment">// 5. å­˜å‚¨åˆ°ViewModelStoreä¸­</span>
    <span class="hljs-selector-tag">mViewModelStore</span><span class="hljs-selector-class">.put</span>(key, viewModel);
    <span class="hljs-selector-tag">return</span> (T) <span class="hljs-selector-tag">viewModel</span>;
}
</code></pre>
<p><strong>ViewModelStoreçš„å†…éƒ¨ç»“æ„</strong>ï¼š</p>
<p>java</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewModelStore</span> {
    <span class="hljs-comment">// æ ¸å¿ƒï¼šHashMapå­˜å‚¨æ‰€æœ‰ViewModel</span>
    <span class="hljs-keyword">private</span> final <span class="hljs-title class_">HashMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">ViewModel</span>&gt; mMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    
    <span class="hljs-comment">// å­˜å‚¨ViewModel</span>
    final <span class="hljs-built_in">void</span> <span class="hljs-title function_">put</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> key, <span class="hljs-meta">@NonNull</span> ViewModel viewModel</span>) {
        <span class="hljs-title class_">ViewModel</span> oldViewModel = mMap.<span class="hljs-title function_">put</span>(key, viewModel);
        <span class="hljs-keyword">if</span> (oldViewModel != <span class="hljs-literal">null</span>) {
            <span class="hljs-comment">// å¦‚æœå·²æœ‰ç›¸åŒKeyçš„ViewModelï¼Œæ¸…ç†æ—§çš„</span>
            oldViewModel.<span class="hljs-title function_">onCleared</span>();
        }
    }
    
    <span class="hljs-comment">// è·å–ViewModel</span>
    final <span class="hljs-title class_">ViewModel</span> <span class="hljs-title function_">get</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> key</span>) {
        <span class="hljs-keyword">return</span> mMap.<span class="hljs-title function_">get</span>(key);
    }
    
    <span class="hljs-comment">// æ¸…ç†æ‰€æœ‰ViewModelï¼ˆåœ¨Activityé”€æ¯æ—¶è°ƒç”¨ï¼‰</span>
    <span class="hljs-keyword">public</span> final <span class="hljs-built_in">void</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-title class_">ViewModel</span> vm : mMap.<span class="hljs-title function_">values</span>()) {
            vm.<span class="hljs-title function_">onCleared</span>();
        }
        mMap.<span class="hljs-title function_">clear</span>();
    }
}
</code></pre>
<h3 data-id="heading-6">2.2Â <code>by viewModels()</code>å®ç°åŸç†åˆ†æ</h3>
<p><strong>Kotlinå±æ€§å§”æ‰˜èƒŒåçš„é­”æ³•</strong>ï¼š</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// androidx.fragment.app.FragmentViewModelLazy.kt</span>
<span class="hljs-keyword">inline</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;<span class="hljs-keyword">reified</span> VM : ViewModel&gt;</span> Fragment.<span class="hljs-title">viewModels</span><span class="hljs-params">(
    <span class="hljs-keyword">noinline</span> ownerProducer: () -&gt; <span class="hljs-type">ViewModelStoreOwner</span> = { this },
    <span class="hljs-keyword">noinline</span> factoryProducer: (() -&gt; <span class="hljs-type">Factory</span>)? = <span class="hljs-literal">null</span>
)</span></span>: Lazy&lt;VM&gt; {
    <span class="hljs-comment">// åˆ›å»ºLazyå§”æ‰˜</span>
    <span class="hljs-keyword">return</span> createViewModelLazy(
        VM::<span class="hljs-keyword">class</span>,
        { ownerProducer().viewModelStore }, <span class="hljs-comment">// è·å–ViewModelStore</span>
        factoryProducer ?: { defaultViewModelProviderFactory }
    )
}

<span class="hljs-comment">// å®é™…çš„Lazyå®ç°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;VM : ViewModel&gt;</span> <span class="hljs-title">createViewModelLazy</span><span class="hljs-params">(
    viewModelClass: <span class="hljs-type">KClass</span>&lt;<span class="hljs-type">VM</span>&gt;,
    storeProducer: () -&gt; <span class="hljs-type">ViewModelStore</span>,
    factoryProducer: () -&gt; <span class="hljs-type">ViewModelProvider</span>.<span class="hljs-type">Factory</span>
)</span></span>: Lazy&lt;VM&gt; {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">object</span> : Lazy&lt;VM&gt; {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> cached: VM? = <span class="hljs-literal">null</span>
        
        <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> value: VM
            <span class="hljs-keyword">get</span>() {
                <span class="hljs-keyword">return</span> cached ?: let {
                    <span class="hljs-comment">// å»¶è¿Ÿåˆå§‹åŒ–ï¼šç¬¬ä¸€æ¬¡è®¿é—®æ—¶æ‰åˆ›å»º</span>
                    ViewModelProvider(storeProducer(), factoryProducer())
                        .<span class="hljs-keyword">get</span>(viewModelClass.java)
                        .also { cached = it }
                }
            }
        
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">isInitialized</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Boolean</span> = cached != <span class="hljs-literal">null</span>
    }
}
</code></pre>
<p><strong>ä¸æ‰‹åŠ¨åˆ›å»ºçš„ç­‰ä»·å…³ç³»</strong>ï¼š</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ï¼š</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> viewModel: MyViewModel <span class="hljs-keyword">by</span> viewModels()

<span class="hljs-comment">// ç­‰ä»·äºï¼š</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> viewModel: MyViewModel

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
    <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
    viewModel = ViewModelProvider(<span class="hljs-keyword">this</span>).<span class="hljs-keyword">get</span>(MyViewModel::<span class="hljs-keyword">class</span>.java)
}
</code></pre>
<h3 data-id="heading-7">2.3 ViewModelå¦‚ä½•å®ç°ä¸åŒçš„ä½œç”¨åŸŸ</h3>
<p><strong>Androidä¸­çš„ViewModelä½œç”¨åŸŸä½“ç³»</strong>ï¼š</p>



































<table><thead><tr><th>ä½œç”¨åŸŸ</th><th>è·å–æ–¹å¼</th><th>ç”Ÿå‘½å‘¨æœŸ</th><th>å…¸å‹ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Activityä½œç”¨åŸŸ</strong></td><td><code>by viewModels()</code></td><td>ä¸Activityç»‘å®šï¼ŒActivityé”€æ¯æ—¶æ¸…é™¤</td><td>å•ä¸ªActivityå†…éƒ¨ä½¿ç”¨çš„æ•°æ®</td></tr><tr><td><strong>Fragmentä½œç”¨åŸŸ</strong></td><td><code>by viewModels()</code></td><td>ä¸Fragmentç»‘å®šï¼ŒFragmenté”€æ¯æ—¶æ¸…é™¤</td><td>å•ä¸ªFragmentå†…éƒ¨ä½¿ç”¨çš„æ•°æ®</td></tr><tr><td><strong>Activityå…±äº«ä½œç”¨åŸŸ</strong></td><td><code>by activityViewModels()</code></td><td>ä¸çˆ¶Activityç»‘å®š</td><td>å¤šä¸ªFragmenté—´å…±äº«æ•°æ®</td></tr><tr><td><strong>Navigationä½œç”¨åŸŸ</strong></td><td><code>by navGraphViewModels(R.id.nav_graph)</code></td><td>ä¸å¯¼èˆªå›¾ç»‘å®š</td><td>åŒä¸€å¯¼èˆªæµç¨‹ä¸­å…±äº«æ•°æ®</td></tr></tbody></table>
<p><strong>å¤šFragmentå…±äº«æ•°æ®çš„å®ç°åŸç†</strong>ï¼š</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å…±äº«ViewModel</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SharedViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">val</span> selectedItem = MutableLiveData&lt;Item&gt;()
    <span class="hljs-keyword">val</span> searchQuery = MutableLiveData&lt;String&gt;()
}

<span class="hljs-comment">// Fragment A - å‘é€æ•°æ®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ListFragment</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-comment">// å…³é”®ï¼šä½¿ç”¨activityViewModels()è·å–Activityä½œç”¨åŸŸçš„å®ä¾‹</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sharedViewModel: SharedViewModel <span class="hljs-keyword">by</span> activityViewModels()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onItemClick</span><span class="hljs-params">(item: <span class="hljs-type">Item</span>)</span></span> {
        sharedViewModel.selectedItem.value = item
    }
}

<span class="hljs-comment">// Fragment B - æ¥æ”¶æ•°æ®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DetailFragment</span> : <span class="hljs-type">Fragment</span>() {
    <span class="hljs-comment">// è·å–çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sharedViewModel: SharedViewModel <span class="hljs-keyword">by</span> activityViewModels()
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onViewCreated</span><span class="hljs-params">(view: <span class="hljs-type">View</span>, savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onViewCreated(view, savedInstanceState)
        sharedViewModel.selectedItem.observe(viewLifecycleOwner) { item -&gt;
            <span class="hljs-comment">// æ˜¾ç¤ºé€‰ä¸­é¡¹è¯¦æƒ…</span>
            showDetails(item)
        }
    }
}
</code></pre>
<p><strong>åŸç†</strong>ï¼š<code>activityViewModels()</code>å†…éƒ¨ä½¿ç”¨<code>requireActivity()</code>ä½œä¸º<code>ViewModelStoreOwner</code>ï¼Œå› æ­¤å¤šä¸ªFragmentä»åŒä¸€ä¸ªActivityçš„<code>ViewModelStore</code>ä¸­è·å–ViewModelï¼Œè‡ªç„¶å¾—åˆ°åŒä¸€ä¸ªå®ä¾‹ã€‚</p>
<h3 data-id="heading-8">2.4 ä¸ºä»€ä¹ˆActivityåœ¨å±å¹•æ—‹è½¬é‡å»ºåå¯ä»¥æ¢å¤ViewModelï¼Ÿ</h3>
<p>è¿™æ˜¯ViewModelæœ€æ ¸å¿ƒçš„æœºåˆ¶ï¼Œç†è§£å®ƒéœ€è¦æ·±å…¥Androidç³»ç»Ÿå±‚é¢ã€‚</p>
<h4 data-id="heading-9">æ ¸å¿ƒç»“è®º</h4>
<p>ViewModelèƒ½åœ¨å±å¹•æ—‹è½¬åæ¢å¤ï¼Œæ˜¯å› ä¸ºAndroidç³»ç»Ÿå°†æ•°æ®åŒºåˆ†ä¸º<strong>é…ç½®ç›¸å…³æ•°æ®</strong>å’Œ<strong>éé…ç½®ç›¸å…³æ•°æ®</strong>ã€‚ViewModelå±äºåè€…ï¼Œå…¶å­˜å‚¨å®¹å™¨<code>ViewModelStore</code>åœ¨Activityé”€æ¯å‰è¢«ç³»ç»Ÿä¸´æ—¶ä¿å­˜ï¼Œå¹¶åœ¨æ–°Activityåˆ›å»ºåä¼ é€’è¿‡å»ã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯<strong>å†…å­˜ä¸­å¯¹è±¡å¼•ç”¨çš„ç›´æ¥è½¬ç§»</strong>ï¼Œè€Œéåºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚</p>
<h4 data-id="heading-10">è¯¦ç»†æ¢å¤æµç¨‹ï¼ˆä¸‰ä¸ªé˜¶æ®µï¼‰</h4>
<p><strong>é˜¶æ®µ1ï¼šé”€æ¯å‰ä¿å­˜ï¼ˆæ—§Activity â†’ ç³»ç»Ÿä¸´æ—¶å­˜å‚¨ï¼‰</strong></p>
<ol>
<li>ç³»ç»Ÿæ£€æµ‹åˆ°å±å¹•æ—‹è½¬ï¼Œå‡†å¤‡é”€æ¯å½“å‰Activity</li>
<li>è°ƒç”¨<code>Activity.retainNonConfigurationInstances()</code>æ–¹æ³•</li>
<li><code>ComponentActivity</code>é‡å†™<code>onRetainNonConfigurationInstance()</code>ï¼Œå°†<code>ViewModelStore</code>åŒ…è£…è¿›<code>NonConfigurationInstances</code>å¯¹è±¡</li>
<li>ç³»ç»Ÿå°†<code>NonConfigurationInstances</code>å­˜å…¥<code>ActivityClientRecord</code></li>
</ol>
<p><strong>é˜¶æ®µ2ï¼šé‡å»ºæ—¶ä¼ é€’ï¼ˆç³»ç»Ÿä¸´æ—¶å­˜å‚¨ â†’ æ–°Activityï¼‰</strong></p>
<ol>
<li>ç³»ç»Ÿåˆ›å»ºæ–°çš„Activityå®ä¾‹</li>
<li>åœ¨<code>ActivityThread.performLaunchActivity()</code>ä¸­è°ƒç”¨æ–°Activityçš„<code>attach()</code>æ–¹æ³•</li>
<li>å°†<code>ActivityClientRecord</code>ä¸­æš‚å­˜çš„<code>lastNonConfigurationInstances</code>ä½œä¸ºå‚æ•°ä¼ å…¥</li>
<li>æ–°Activityå°†å…¶ä¿å­˜åˆ°æˆå‘˜å˜é‡<code>mLastNonConfigurationInstances</code></li>
</ol>
<p><strong>é˜¶æ®µ3ï¼šæŒ‰éœ€æ¢å¤ï¼ˆæ–°Activityå†…éƒ¨è·å–ï¼‰</strong></p>
<ol>
<li>æ–°Activityé¦–æ¬¡è°ƒç”¨<code>getViewModelStore()</code>æ–¹æ³•</li>
<li>æ£€æŸ¥<code>mViewModelStore</code>æ˜¯å¦ä¸ºç©º</li>
<li>ä»<code>mLastNonConfigurationInstances</code>ä¸­è·å–æ—§çš„<code>ViewModelStore</code></li>
<li>å¦‚æœè·å–æˆåŠŸï¼Œç›´æ¥å¤ç”¨ï¼›å¦åˆ™åˆ›å»ºæ–°çš„</li>
</ol>
<h4 data-id="heading-11">å…³é”®æºç èŠ‚ç‚¹</h4>
<p>java</p>
<pre><code class="hljs language-ini" lang="ini">// ComponentActivity.java - ä¿å­˜ViewModelStore
@Override
public final Object onRetainNonConfigurationInstance() {
    ViewModelStore <span class="hljs-attr">viewModelStore</span> = mViewModelStore<span class="hljs-comment">;</span>
    // åŒ…è£…å¹¶è¿”å›
    NonConfigurationInstances <span class="hljs-attr">nci</span> = new NonConfigurationInstances()<span class="hljs-comment">;</span>
    <span class="hljs-attr">nci.viewModelStore</span> = viewModelStore<span class="hljs-comment">; // å…³é”®ï¼šä¿å­˜ViewModelStore</span>
    return nci<span class="hljs-comment">;</span>
}

// ComponentActivity.java - æ¢å¤ViewModelStore
@NonNull
public ViewModelStore getViewModelStore() {
    if (<span class="hljs-attr">mViewModelStore</span> == null) {
        // å…³é”®ï¼šä¼˜å…ˆä»æ—§æ•°æ®ä¸­æ¢å¤
        NonConfigurationInstances <span class="hljs-attr">nc</span> = 
            (NonConfigurationInstances) getLastNonConfigurationInstance()<span class="hljs-comment">;</span>
        if (nc != null) {
            <span class="hljs-attr">mViewModelStore</span> = nc.viewModelStore<span class="hljs-comment">; // ç›´æ¥å¤ç”¨ï¼</span>
        }
        if (<span class="hljs-attr">mViewModelStore</span> == null) {
            <span class="hljs-attr">mViewModelStore</span> = new ViewModelStore()<span class="hljs-comment">; // æ²¡æœ‰æ‰åˆ›å»ºæ–°çš„</span>
        }
    }
    return mViewModelStore<span class="hljs-comment">;</span>
}
</code></pre>
<h4 data-id="heading-12">å½¢è±¡æ¯”å–»ï¼šä¿é™©ç®±ä¼ é€’</h4>
<p>å¯ä»¥æŠŠæ•´ä¸ªè¿‡ç¨‹æƒ³è±¡æˆï¼š</p>
<ul>
<li><strong>ViewModelå®ä¾‹</strong>ï¼šçè´µçš„ç å®</li>
<li><strong>ViewModelStore</strong>ï¼šå­˜æ”¾ç å®çš„ä¿é™©ç®±</li>
<li><strong>Activity</strong>ï¼šç§Ÿç”¨æˆ¿é—´çš„ç§Ÿå®¢</li>
</ul>
<ol>
<li>ç§Ÿå®¢Aï¼ˆActivity Aï¼‰é€€ç§Ÿå‰ï¼ŒæŠŠä¿é™©ç®±å¯„å­˜åœ¨ç®¡ç†å¤„ï¼ˆç³»ç»Ÿï¼‰</li>
<li>ç§Ÿå®¢Bï¼ˆActivity Bï¼‰å…¥ä½åŒä¸€æˆ¿é—´ï¼Œç®¡ç†å¤„æŠŠä¿é™©ç®±è¿˜ç»™ä»–</li>
<li>ç å®ï¼ˆViewModelï¼‰ä»æœªè¢«ç§»åŠ¨ï¼Œåªæ˜¯ä¿é™©ç®±æ¢äº†ä¸»äºº</li>
</ol>
<h3 data-id="heading-13">2.5 ViewModelçš„æ•°æ®åœ¨ä»€ä¹ˆæ—¶å€™æ‰ä¼šæ¸…é™¤</h3>
<p><strong>ViewModelç”Ÿå‘½å‘¨æœŸçš„ä¸‰ç§ç»ˆç»“åœºæ™¯</strong>ï¼š</p>





























<table><thead><tr><th>åœºæ™¯</th><th>è§¦å‘æ¡ä»¶</th><th>ViewModelçŠ¶æ€å˜åŒ–</th><th>æ˜¯å¦è°ƒç”¨<code>onCleared()</code></th></tr></thead><tbody><tr><td><strong>æ­£å¸¸é€€å‡º</strong></td><td>ç”¨æˆ·æŒ‰è¿”å›é”®ã€è°ƒç”¨<code>finish()</code></td><td>ViewModelè¢«æ¸…é™¤</td><td>âœ… æ˜¯</td></tr><tr><td><strong>é…ç½®å˜æ›´</strong></td><td>å±å¹•æ—‹è½¬ã€è¯­è¨€åˆ‡æ¢ç­‰</td><td>ViewModelä¿ç•™å¹¶æ¢å¤</td><td>âŒ å¦</td></tr><tr><td><strong>è¿›ç¨‹è¢«æ€æ­»</strong></td><td>ç³»ç»Ÿå†…å­˜ä¸è¶³ã€åº”ç”¨åœ¨åå°è¢«æ€æ­»</td><td>ViewModeléšè¿›ç¨‹æ¶ˆäº¡</td><td>âŒ å¦</td></tr></tbody></table>
<p><strong>æºç ä¸­çš„æ¸…é™¤é€»è¾‘</strong>ï¼š</p>
<p>java</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ComponentActivity.java</span>
<span class="hljs-keyword">@Override</span>
protected void onDestroy() {
    super<span class="hljs-selector-class">.onDestroy</span>();
    
    if (mViewModelStore != null) {
        <span class="hljs-comment">// å…³é”®åˆ¤æ–­ï¼šæ˜¯å¦ä¸ºé…ç½®å˜æ›´</span>
        if (!isChangingConfigurations()) {
            <span class="hljs-comment">// éé…ç½®å˜æ›´ â†’ æ¸…é™¤ViewModel</span>
            mViewModelStore<span class="hljs-selector-class">.clear</span>();
        }
        <span class="hljs-comment">// é…ç½®å˜æ›´ â†’ ä¿ç•™ViewModel</span>
    }
}

<span class="hljs-comment">// ViewModelStore.clear()</span>
public final void <span class="hljs-attribute">clear</span>() {
    for (ViewModel viewModel : mMap.values()) {
        <span class="hljs-comment">// è°ƒç”¨æ¯ä¸ªViewModelçš„onCleared()</span>
        viewModel<span class="hljs-selector-class">.onCleared</span>();
    }
    mMap<span class="hljs-selector-class">.clear</span>();
}
</code></pre>
<p><strong><code>onCleared()</code>çš„æ­£ç¡®ä½¿ç”¨</strong>ï¼š</p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ResourceViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    
    <span class="hljs-comment">// éœ€è¦æ¸…ç†çš„èµ„æº</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> compositeDisposable = CompositeDisposable()
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> timer: Timer? = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> listeners = mutableListOf&lt;Listener&gt;()
    
    <span class="hljs-keyword">init</span> {
        <span class="hljs-comment">// åˆå§‹åŒ–èµ„æº</span>
        timer = Timer().apply {
            scheduleAtFixedRate(timerTask { <span class="hljs-comment">/* ... */</span> }, <span class="hljs-number">0</span>, <span class="hljs-number">1000</span>)
        }
    }
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">registerListener</span><span class="hljs-params">(listener: <span class="hljs-type">Listener</span>)</span></span> {
        listeners.add(listener)
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCleared()
        <span class="hljs-comment">// 1. å–æ¶ˆæ‰€æœ‰å¼‚æ­¥ä»»åŠ¡</span>
        compositeDisposable.clear()
        
        <span class="hljs-comment">// 2. åœæ­¢å®šæ—¶å™¨</span>
        timer?.cancel()
        timer = <span class="hljs-literal">null</span>
        
        <span class="hljs-comment">// 3. æ¸…ç†ç›‘å¬å™¨</span>
        listeners.clear()
        
        <span class="hljs-comment">// 4. é‡Šæ”¾å…¶ä»–èµ„æº</span>
        releaseOtherResources()
    }
}
</code></pre>
<h2 data-id="heading-14">3. ViewModelçš„å†…å­˜æ³„æ¼é—®é¢˜</h2>
<h3 data-id="heading-15">å¸¸è§å†…å­˜æ³„æ¼åœºæ™¯ä¸è§£å†³æ–¹æ¡ˆ</h3>
<p><strong>åœºæ™¯1ï¼šåœ¨ViewModelä¸­æŒæœ‰Contextå¼•ç”¨</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šç›´æ¥æŒæœ‰Activity Context</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LeakyViewModel</span>(context: Context) : ViewModel() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> context: Context = context <span class="hljs-comment">// å†…å­˜æ³„æ¼ï¼</span>
}

<span class="hljs-comment">// âœ… æ­£ç¡®1ï¼šä½¿ç”¨AndroidViewModelè·å–Application Context</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeViewModel1</span>(application: Application) : AndroidViewModel(application) {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> context: Context = getApplication&lt;Application&gt;().applicationContext
}

<span class="hljs-comment">// âœ… æ­£ç¡®2ï¼šé€šè¿‡ä¾èµ–æ³¨å…¥ä¼ å…¥Application Context</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeViewModel2</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> appContext: Context <span class="hljs-comment">// ç¡®ä¿æ˜¯Application Context</span>
) : ViewModel() {
    <span class="hljs-keyword">init</span> {
        require(appContext.applicationContext == appContext) {
            <span class="hljs-string">"å¿…é¡»ä½¿ç”¨Application Context"</span>
        }
    }
}
</code></pre>
<p><strong>åœºæ™¯2ï¼šæœªæ­£ç¡®ç®¡ç†çš„å¼‚æ­¥ä»»åŠ¡</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šä½¿ç”¨GlobalScope</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">CoroutineLeakViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> {
        GlobalScope.launch { <span class="hljs-comment">// ç”Ÿå‘½å‘¨æœŸä¸Appç›¸åŒï¼</span>
            delay(<span class="hljs-number">5000</span>)
            updateUI() <span class="hljs-comment">// ViewModelå¯èƒ½å·²é”€æ¯</span>
        }
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨viewModelScope</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeCoroutineViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch { <span class="hljs-comment">// è‡ªåŠ¨ç»‘å®šViewModelç”Ÿå‘½å‘¨æœŸ</span>
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">val</span> <span class="hljs-keyword">data</span> = repository.loadData()
                updateState(<span class="hljs-keyword">data</span>)
            } <span class="hljs-keyword">catch</span> (e: CancellationException) {
                <span class="hljs-comment">// æ­£å¸¸å–æ¶ˆï¼Œæ— éœ€å¤„ç†</span>
            }
        }
    }
}

<span class="hljs-comment">// âœ… RxJavaçš„æ­£ç¡®ç®¡ç†</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RxViewModel</span> : <span class="hljs-type">ViewModel</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> compositeDisposable = CompositeDisposable()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">fetchData</span><span class="hljs-params">()</span></span> {
        repository.getData()
            .subscribeOn(Schedulers.io())
            .observeOn(AndroidSchedulers.mainThread())
            .subscribe { result -&gt;
                <span class="hljs-comment">// å¤„ç†ç»“æœ</span>
            }
            .addTo(compositeDisposable) <span class="hljs-comment">// æ·»åŠ åˆ°CompositeDisposable</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">super</span>.onCleared()
        compositeDisposable.clear() <span class="hljs-comment">// æ¸…ç†æ‰€æœ‰Disposable</span>
    }
}
</code></pre>
<p><strong>åœºæ™¯3ï¼šè§‚å¯Ÿè€…æœªåŠæ—¶ç§»é™¤</strong></p>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ æ½œåœ¨é—®é¢˜ï¼šè§‚å¯Ÿè€…æŒæœ‰å¤–éƒ¨å¼•ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ObserverLeakActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> observer = Observer&lt;String&gt; { <span class="hljs-keyword">data</span> -&gt;
        <span class="hljs-comment">// å¦‚æœobserveræŒæœ‰Activityå¼•ç”¨...</span>
    }
    
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        viewModel.<span class="hljs-keyword">data</span>.observe(<span class="hljs-keyword">this</span>, observer)
    }
}

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šä½¿ç”¨lambdaæˆ–æ–¹æ³•å¼•ç”¨</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeObserverActivity</span> : <span class="hljs-type">AppCompatActivity</span>() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreate</span><span class="hljs-params">(savedInstanceState: <span class="hljs-type">Bundle</span>?)</span></span> {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState)
        <span class="hljs-comment">// LiveDataä¼šè‡ªåŠ¨åœ¨Activityé”€æ¯æ—¶ç§»é™¤è§‚å¯Ÿè€…</span>
        viewModel.<span class="hljs-keyword">data</span>.observe(<span class="hljs-keyword">this</span>) { <span class="hljs-keyword">data</span> -&gt;
            updateUI(<span class="hljs-keyword">data</span>)
        }
    }
}
</code></pre>
<h3 data-id="heading-16">å†…å­˜æ³„æ¼æ£€æµ‹ä¸é¢„é˜²ç­–ç•¥</h3>
<p><strong>é˜²å¾¡æ€§ç¼–ç¨‹æ¸…å•</strong>ï¼š</p>
<ol>
<li>âœ… ç»ä¸æŒæœ‰<code>Activity</code>/<code>Fragment</code>/<code>View</code>çš„å¼•ç”¨</li>
<li>âœ… ä½¿ç”¨<code>AndroidViewModel</code>è·å–<code>Application Context</code></li>
<li>âœ… æ‰€æœ‰åç¨‹ä½¿ç”¨<code>viewModelScope.launch</code></li>
<li>âœ… RxJavaä½¿ç”¨<code>CompositeDisposable</code>å¹¶åœ¨<code>onCleared()</code>ä¸­æ¸…ç†</li>
<li>âœ… ä½¿ç”¨<code>LifecycleOwner</code>è‡ªåŠ¨ç®¡ç†LiveDataè§‚å¯Ÿè€…</li>
<li>âœ… åœ¨<code>onCleared()</code>ä¸­æ¸…ç†æ‰€æœ‰èµ„æºã€åæ³¨å†Œç›‘å¬å™¨</li>
<li>âŒ é¿å…å°†ViewModelå­˜å‚¨åœ¨é™æ€å˜é‡æˆ–å•ä¾‹ä¸­</li>
</ol>
<h2 data-id="heading-17">4. ViewModelå’ŒonSaveInstanceStateå¯¹æ¯”</h2>
<h3 data-id="heading-18">æœ¬è´¨åŒºåˆ«ä¸é€‚ç”¨åœºæ™¯</h3>













































<table><thead><tr><th>ç»´åº¦</th><th>ViewModel</th><th>onSaveInstanceState</th></tr></thead><tbody><tr><td><strong>è®¾è®¡ç›®çš„</strong></td><td>å¤„ç†<strong>é…ç½®å˜æ›´</strong></td><td>å¤„ç†<strong>è¿›ç¨‹æ­»äº¡</strong></td></tr><tr><td><strong>æ•°æ®è½½ä½“</strong></td><td>å†…å­˜å¯¹è±¡å¼•ç”¨</td><td>Bundleåºåˆ—åŒ–</td></tr><tr><td><strong>å­˜å‚¨ä½ç½®</strong></td><td>å†…å­˜ä¸­</td><td>Bundleï¼ˆå¯åºåˆ—åŒ–åˆ°ç£ç›˜ï¼‰</td></tr><tr><td><strong>æ•°æ®å¤§å°</strong></td><td>æ— é™åˆ¶ï¼ˆå—å†…å­˜çº¦æŸï¼‰</td><td>æœ‰é™åˆ¶ï¼ˆé€šå¸¸&lt;1MBï¼‰</td></tr><tr><td><strong>æ•°æ®ç±»å‹</strong></td><td>ä»»ä½•Java/Kotlinå¯¹è±¡</td><td>åŸºæœ¬ç±»å‹ã€Parcelableã€Serializable</td></tr><tr><td><strong>æ¢å¤æ—¶æœº</strong></td><td>é…ç½®å˜æ›´åç«‹å³å¯ç”¨</td><td><code>onCreate()</code>ä¸­æ‰‹åŠ¨æ¢å¤</td></tr><tr><td><strong>æ€§èƒ½å¼€é”€</strong></td><td>å‡ ä¹æ— ï¼ˆå†…å­˜å¼•ç”¨ï¼‰</td><td>åºåˆ—åŒ–/ååºåˆ—åŒ–å¼€é”€</td></tr></tbody></table>
<h3 data-id="heading-19">ç°ä»£æ–¹æ¡ˆï¼šViewModel + SavedStateHandle</h3>
<p>kotlin</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç»“åˆä¸¤è€…ä¼˜åŠ¿çš„ç°ä»£å®è·µ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserProfileViewModel</span>(
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> savedStateHandle: SavedStateHandle
) : ViewModel() {
    
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> USER_ID_KEY = <span class="hljs-string">"user_id"</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> SEARCH_QUERY_KEY = <span class="hljs-string">"search_query"</span>
    }
    
    <span class="hljs-comment">// éœ€è¦è¿›ç¨‹æ­»äº¡æ¢å¤çš„æ•°æ®</span>
    <span class="hljs-keyword">var</span> userId: String
        <span class="hljs-keyword">get</span>() = savedStateHandle[USER_ID_KEY] ?: <span class="hljs-string">""</span>
        <span class="hljs-keyword">set</span>(value) = savedStateHandle.<span class="hljs-keyword">set</span>(USER_ID_KEY, value)
    
    <span class="hljs-keyword">var</span> searchQuery: String
        <span class="hljs-keyword">get</span>() = savedStateHandle[SEARCH_QUERY_KEY] ?: <span class="hljs-string">""</span>
        <span class="hljs-keyword">set</span>(value) = savedStateHandle.<span class="hljs-keyword">set</span>(SEARCH_QUERY_KEY, value)
    
    <span class="hljs-comment">// ä¸éœ€è¦æŒä¹…åŒ–çš„ä¸´æ—¶æ•°æ®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> _userData = MutableStateFlow&lt;User?&gt;(<span class="hljs-literal">null</span>)
    <span class="hljs-keyword">val</span> userData: StateFlow&lt;User?&gt; = _userData.asStateFlow()
    
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">loadUser</span><span class="hljs-params">()</span></span> {
        viewModelScope.launch {
            _userData.value = repository.getUser(userId)
        }
    }
}
</code></pre>
<h3 data-id="heading-20">é€‰æ‹©ç­–ç•¥å†³ç­–æ ‘</h3>
<p>text</p>
<pre><code class="hljs language-markdown" lang="markdown">éœ€è¦æŒä¹…åŒ–æ•°æ®å—ï¼Ÿ
â”œâ”€â”€ å¦ â†’ ä½¿ç”¨ViewModelæ™®é€šå±æ€§
â”œâ”€â”€ æ˜¯ â†’ 
<span class="hljs-code">    â”œâ”€â”€ éœ€è¦è¿›ç¨‹æ­»äº¡åæ¢å¤å—ï¼Ÿ
    â”‚   â”œâ”€â”€ å¦ â†’ ViewModel + LiveData/StateFlow
    â”‚   â””â”€â”€ æ˜¯ â†’ 
    â”‚       â”œâ”€â”€ æ•°æ®é‡å°ä¸”ç®€å• â†’ onSaveInstanceState
    â”‚       â””â”€â”€ æ•°æ®å¤æ‚æˆ–éœ€è¦å…±äº« â†’ ViewModel + SavedStateHandle
    â””â”€â”€ æ˜¯å¦æ˜¯UIçŠ¶æ€ï¼Ÿ
        â”œâ”€â”€ æ˜¯ â†’ ViewModel + SavedStateHandle
        â””â”€â”€ å¦ â†’ è€ƒè™‘æŒä¹…åŒ–æ–¹æ¡ˆï¼ˆRoomã€DataStoreï¼‰
</span></code></pre>
<h2 data-id="heading-21">5. æ€»ç»“</h2>
<h3 data-id="heading-22">ViewModelçš„æ ¸å¿ƒä»·å€¼å›é¡¾</h3>
<ol>
<li><strong>ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥</strong>ï¼šè‡ªåŠ¨å¤„ç†é…ç½®å˜æ›´ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒæ•°æ®ä¿å­˜ä¸æ¢å¤</li>
<li><strong>æ•°æ®æŒä¹…åŒ–</strong>ï¼šåœ¨é€‚å½“çš„ç”Ÿå‘½å‘¨æœŸå†…ä¿æŒæ•°æ®ä¸€è‡´æ€§</li>
<li><strong>æ¶æ„æ¸…æ™°</strong>ï¼šä¿ƒè¿›MVVM/MVIæ¶æ„ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»</li>
<li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šçº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ˜“äºå•å…ƒæµ‹è¯•</li>
<li><strong>æ•°æ®å…±äº«</strong>ï¼šç®€åŒ–ç»„ä»¶é—´é€šä¿¡ï¼Œç‰¹åˆ«æ˜¯Fragmenté—´é€šä¿¡</li>
</ol>
<h3 data-id="heading-23">æœ€ä½³å®è·µæ€»ç»“</h3>
<p><strong>DOï¼ˆåº”è¯¥åšçš„ï¼‰</strong> ï¼š</p>
<ul>
<li>âœ… ä½¿ç”¨<code>by viewModels()</code>ç®€åŒ–åˆ›å»º</li>
<li>âœ… ä½¿ç”¨<code>viewModelScope</code>ç®¡ç†åç¨‹</li>
<li>âœ… ç»“åˆRepositoryæ¨¡å¼å¤„ç†æ•°æ®</li>
<li>âœ… ä½¿ç”¨SavedStateHandleå¤„ç†è¿›ç¨‹æ­»äº¡æ¢å¤</li>
<li>âœ… ä¸ºViewModelç¼–å†™å•å…ƒæµ‹è¯•</li>
<li>âœ… ä½¿ç”¨çŠ¶æ€å®¹å™¨ï¼ˆState Flowï¼‰ç®¡ç†UIçŠ¶æ€</li>
</ul>
<p><strong>DON'Tï¼ˆä¸åº”è¯¥åšçš„ï¼‰</strong> ï¼š</p>
<ul>
<li>âŒ åœ¨ViewModelä¸­æŒæœ‰View/Activityå¼•ç”¨</li>
<li>âŒ ä½¿ç”¨GlobalScopeæˆ–æœªç®¡ç†çš„Disposable</li>
<li>âŒ å°†å¤§é‡æ•°æ®ç›´æ¥å­˜å‚¨åœ¨ViewModelä¸­ï¼ˆè€ƒè™‘åˆ†é¡µï¼‰</li>
<li>âŒ å¿½ç•¥<code>onCleared()</code>ä¸­çš„èµ„æºæ¸…ç†</li>
<li>âŒ å°†ViewModelä½œä¸ºå…¨å±€å•ä¾‹ä½¿ç”¨</li>
</ul>
<h3 data-id="heading-24">é¢è¯•è¦ç‚¹é€ŸæŸ¥</h3>
<ol>
<li>
<p><strong>ViewModelå¦‚ä½•åœ¨å±å¹•æ—‹è½¬åå­˜æ´»ï¼Ÿ</strong></p>
<ul>
<li>é€šè¿‡<code>onRetainNonConfigurationInstance()</code>ä¿å­˜<code>ViewModelStore</code></li>
<li>æ–°Activityä»<code>getLastNonConfigurationInstance()</code>æ¢å¤</li>
</ul>
</li>
<li>
<p><strong>ViewModelå’ŒLiveDataçš„åŒºåˆ«ï¼Ÿ</strong></p>
<ul>
<li>ViewModelï¼šå­˜å‚¨å’Œç®¡ç†UIç›¸å…³æ•°æ®</li>
<li>LiveDataï¼šå¯è§‚å¯Ÿçš„æ•°æ®æŒæœ‰è€…ï¼Œå…·æœ‰ç”Ÿå‘½å‘¨æœŸæ„ŸçŸ¥</li>
</ul>
</li>
<li>
<p><strong>å¦‚ä½•é¿å…ViewModelå†…å­˜æ³„æ¼ï¼Ÿ</strong></p>
<ul>
<li>ä½¿ç”¨Application Context</li>
<li>ä½¿ç”¨viewModelScopeç®¡ç†åç¨‹</li>
<li>åœ¨onCleared()ä¸­æ¸…ç†èµ„æº</li>
</ul>
</li>
<li>
<p><strong>ViewModelä¸onSaveInstanceStateçš„é€‚ç”¨åœºæ™¯ï¼Ÿ</strong></p>
<ul>
<li>ViewModelï¼šé…ç½®å˜æ›´ï¼Œè¾ƒå¤§çš„UIæ•°æ®</li>
<li>onSaveInstanceStateï¼šè¿›ç¨‹æ­»äº¡æ¢å¤ï¼Œå°‘é‡å…³é”®çŠ¶æ€</li>
</ul>
</li>
</ol>
<h3 data-id="heading-25">æœªæ¥å‘å±•è¶‹åŠ¿</h3>
<ol>
<li><strong>ä¸Composeæ·±åº¦é›†æˆ</strong>ï¼š<code>viewModel()</code>å‡½æ•°æˆä¸ºComposeæ ‡å‡†</li>
<li><strong>ä½œç”¨åŸŸç²¾ç»†åŒ–</strong>ï¼šNavigation Graphä½œç”¨åŸŸã€è‡ªå®šä¹‰ä½œç”¨åŸŸ</li>
<li><strong>å“åº”å¼å¢å¼º</strong>ï¼šå…¨é¢è½¬å‘StateFlow/SharedFlow</li>
<li><strong>å¤šæ¨¡å—æ”¯æŒ</strong>ï¼šHiltä½œç”¨åŸŸåœ¨åŠŸèƒ½æ¨¡å—ä¸­çš„åº”ç”¨</li>
</ol>
<p>ViewModelå·²æˆä¸ºç°ä»£Androidå¼€å‘çš„åŸºçŸ³ï¼Œç†è§£å…¶åŸç†å¹¶æŒæ¡æœ€ä½³å®è·µï¼Œå¯¹äºæ„å»ºå¥å£®ã€å¯ç»´æŠ¤çš„Androidåº”ç”¨è‡³å…³é‡è¦ã€‚éšç€Androidæ¶æ„çš„ä¸æ–­æ¼”è¿›ï¼ŒViewModelå°†ç»§ç»­åœ¨çŠ¶æ€ç®¡ç†å’Œæ¶æ„è®¾è®¡æ–¹é¢å‘æŒ¥æ ¸å¿ƒä½œç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vitest å­¦ä¹ ä¸å®è·µæ€»ç»“ï¼šåœ¨ React + TypeScript é¡¹ç›®ä¸­å¿«é€Ÿä¸Šæ‰‹å•å…ƒæµ‹è¯•]]></title>    <link>https://juejin.cn/post/7579436743259799571</link>    <guid>https://juejin.cn/post/7579436743259799571</guid>    <pubDate>2025-12-03T08:55:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579436743259799571" data-draft-id="7579438351297085476" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vitest å­¦ä¹ ä¸å®è·µæ€»ç»“ï¼šåœ¨ React + TypeScript é¡¹ç›®ä¸­å¿«é€Ÿä¸Šæ‰‹å•å…ƒæµ‹è¯•"/> <meta itemprop="keywords" content="å•å…ƒæµ‹è¯•,æµ‹è¯•"/> <meta itemprop="datePublished" content="2025-12-03T08:55:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å›½å®¶ä¸ä¿æŠ¤åºŸç‰©"/> <meta itemprop="url" content="https://juejin.cn/user/1220936035210004"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vitest å­¦ä¹ ä¸å®è·µæ€»ç»“ï¼šåœ¨ React + TypeScript é¡¹ç›®ä¸­å¿«é€Ÿä¸Šæ‰‹å•å…ƒæµ‹è¯•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1220936035210004/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å›½å®¶ä¸ä¿æŠ¤åºŸç‰©
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:55:19.000Z" title="Wed Dec 03 2025 08:55:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Vitest å­¦ä¹ ä¸å®è·µæ€»ç»“ï¼šåœ¨ React + TypeScript é¡¹ç›®ä¸­å¿«é€Ÿä¸Šæ‰‹å•å…ƒæµ‹è¯•</h2>
<blockquote>
<p>ä»Šå¤©æˆ‘ç”¨4ä¸ªå°æ—¶å­¦ä¹ å’Œå®è·µäº† Vitest è¿™ä¸ªå‰ç«¯æµ‹è¯•å·¥å…·ã€‚ä¸»è¦æ˜¯äº†è§£ä¸€ä¸‹å®ƒæ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆç”¨ï¼Œå°¤å…¶æ˜¯æ€ä¹ˆåœ¨æˆ‘ä»¬å¸¸ç”¨çš„ React + TypeScript é¡¹ç›®é‡Œç”¨ã€‚ä¸‹é¢æ˜¯æˆ‘å­¦ä¹ çš„ä¸€ä¸ªç®€å•æ€»ç»“å’Œè®°å½•ã€‚</p>
</blockquote>
<h5 data-id="heading-1"><strong>ä¸€ã€Vitest æ˜¯ä¸ªå•¥ï¼Ÿ</strong></h5>
<p>ç®€å•æ¥è¯´ï¼ŒVitest å°±æ˜¯ä¸€ä¸ªç”¨æ¥ç»™ä»£ç åšæµ‹è¯•çš„å·¥å…·ï¼Œæ¯”å¦‚æµ‹è¯•ä¸€ä¸ªå‡½æ•°èƒ½ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæˆ–è€…ä¸€ä¸ª React ç»„ä»¶æ˜¾ç¤ºå¾—å¯¹ä¸å¯¹ã€‚</p>
<p>å®ƒæœ€å¤§çš„ç‰¹ç‚¹æ˜¯<strong>å¿«</strong>ï¼Œè€Œä¸”å’Œ Vite é¡¹ç›®ï¼ˆæˆ‘ä»¬ç°åœ¨ç”¨çš„é¡¹ç›®æ„å»ºå·¥å…·ï¼‰æ­é…èµ·æ¥ç‰¹åˆ«æ–¹ä¾¿ï¼Œå‡ ä¹ä¸éœ€è¦åšå¤ªå¤šé¢å¤–çš„é…ç½®ã€‚</p>
<h5 data-id="heading-2"><strong>äºŒã€ä¸ºå•¥è¦ç”¨å®ƒï¼Ÿï¼ˆå®ƒçš„å¥½å¤„ï¼‰</strong></h5>
<ol>
<li><strong>é€Ÿåº¦å¿«</strong>ï¼šå› ä¸ºå®ƒç”¨åˆ°äº† Vite çš„ä¸€äº›ç‰¹æ€§ï¼Œæ¯æ¬¡è·‘æµ‹è¯•çš„æ—¶å€™å‡ ä¹ä¸éœ€è¦é‡æ–°æ‰“åŒ…ï¼Œæ‰€ä»¥æ„Ÿè§‰æµ‹è¯•è·‘èµ·æ¥é£å¿«ï¼ŒèŠ‚çœæ—¶é—´ã€‚</li>
<li><strong>å¼€ç®±å³ç”¨</strong>ï¼šå¯¹äºæˆ‘ä»¬è¿™ç§ç”¨ Vite åˆ›å»ºçš„ React+TS é¡¹ç›®ï¼Œä¸ç”¨æŠ˜è…¾å¤ªå¤šé…ç½®å°±èƒ½ç›´æ¥ç”¨ï¼Œå¾ˆæ–¹ä¾¿ã€‚</li>
<li><strong>å’Œ Jest å·®ä¸å¤š</strong>ï¼šå®ƒçš„å†™æ³•å’Œç”¨æ³•å’Œå¦ä¸€ä¸ªæµè¡Œçš„æµ‹è¯•å·¥å…· Jest å¾ˆåƒï¼Œæ‰€ä»¥å¦‚æœä»¥å‰å†™è¿‡ Jestï¼Œå­¦èµ·æ¥å°±éå¸¸å®¹æ˜“ã€‚</li>
</ol>
<h5 data-id="heading-3"><strong>ä¸‰ã€åœ¨</strong> <strong>React</strong> <strong>+</strong> <strong>TypeScript</strong> <strong>é¡¹ç›®é‡Œæ€ä¹ˆç”¨ï¼Ÿ</strong></h5>
<p>æˆ‘è·Ÿç€æ•™ç¨‹å’Œæ–‡æ¡£ï¼Œå¤§æ¦‚èµ°äº†ä¸‹é¢å‡ ä¸ªæ­¥éª¤ï¼š</p>
<p><strong>1. å®‰è£…ä¸œè¥¿</strong></p>
<p>é¦–å…ˆåœ¨é¡¹ç›®é‡Œå®‰è£…äº† Vitest å’Œå¦å¤–ä¸€ä¸ªç”¨æ¥æµ‹è¯• React ç»„ä»¶çš„åº“ï¼ˆå« <code>@testing-library/react</code>ï¼‰ï¼Œå®‰è£…å‘½ä»¤å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-dart" lang="dart">npm install -D vitest <span class="hljs-meta">@testing</span>-<span class="hljs-keyword">library</span>/react <span class="hljs-meta">@testing</span>-<span class="hljs-keyword">library</span>/jest-dom jsdom
</code></pre>
<p><strong>2. åˆ›å»ºé…ç½®æ–‡ä»¶</strong></p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºäº†ä¸€ä¸ª <code>vitest.config.ts</code> æ–‡ä»¶ï¼Œè¿›è¡Œä¸€äº›ç®€å•é…ç½®ï¼Œå‘Šè¯‰ Vitest è¦ç”¨å“ªä¸ªç¯å¢ƒï¼ˆæ¯”å¦‚ jsdom æ¥æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼‰ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vitest.config.ts</span>
<span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest/config'</span>;
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-react'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">react</span>()],
  <span class="hljs-attr">test</span>: {
    <span class="hljs-attr">environment</span>: <span class="hljs-string">'jsdom'</span>,
  },
});
</code></pre>
<p><strong>3. å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•ä¾‹å­</strong></p>
<p>æˆ‘å­¦ç€ç»™ä¸€ä¸ªæœ€ç®€å•çš„ç»„ä»¶å†™æµ‹è¯•ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªæŒ‰é’®ç»„ä»¶ <code>Button.tsx</code>ã€‚</p>
<ul>
<li>
<p><strong>ç»„ä»¶ä»£ç ï¼ˆButton.tsxï¼‰</strong> ï¼š</p>
<ul>
<li>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ButtonProps</span> {
  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">onClick</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">Button</span> = (<span class="hljs-params">{ text, onClick }: ButtonProps</span>) =&gt; {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{onClick}</span>&gt;</span>{text}<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>;
};
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>æµ‹è¯•ä»£ç ï¼ˆButton.test.tsï¼‰</strong> ï¼š</p>
</li>
</ul>
<p>åœ¨æ—è¾¹åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œç”¨æ¥æ£€æŸ¥è¿™ä¸ªç»„ä»¶èƒ½ä¸èƒ½æ­£å¸¸æ˜¾ç¤ºæ–‡å­—ï¼Œä»¥åŠç‚¹å‡»èƒ½ä¸èƒ½ç”Ÿæ•ˆã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { describe, it, expect, vi } <span class="hljs-keyword">from</span> <span class="hljs-string">'vitest'</span>; <span class="hljs-comment">// ä»vitestå¼•å…¥å·¥å…·</span>
<span class="hljs-keyword">import</span> { render, screen, fireEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@testing-library/react'</span>; <span class="hljs-comment">// å¼•å…¥Reactæµ‹è¯•åº“</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Button'</span>; <span class="hljs-comment">// å¼•å…¥è¦æµ‹è¯•çš„ç»„ä»¶</span>

<span class="hljs-title function_">describe</span>(<span class="hljs-string">'Button ç»„ä»¶'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">it</span>(<span class="hljs-string">'åº”è¯¥åœ¨é¡µé¢ä¸Šæ­£ç¡®æ˜¾ç¤ºæ–‡å­—'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 1. æ¸²æŸ“ç»„ä»¶</span>
    <span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"ç‚¹å‡»æˆ‘"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> {}} /&gt;</span>);
    <span class="hljs-comment">// 2. åœ¨å±å¹•ä¸Šæ‰¾åˆ°åŒ…å«â€œç‚¹å‡»æˆ‘â€æ–‡å­—çš„å…ƒç´ </span>
    <span class="hljs-keyword">const</span> buttonElement = screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-string">'ç‚¹å‡»æˆ‘'</span>);
    <span class="hljs-comment">// 3. æ–­è¨€ï¼ˆæœŸæœ›ï¼‰è¿™ä¸ªå…ƒç´ ç¡®å®åœ¨æ–‡æ¡£é‡Œ</span>
    <span class="hljs-title function_">expect</span>(buttonElement).<span class="hljs-title function_">toBeInTheDocument</span>();
  });

  <span class="hljs-title function_">it</span>(<span class="hljs-string">'ç‚¹å‡»æŒ‰é’®æ—¶åº”è¯¥è°ƒç”¨ä¼ å…¥çš„å‡½æ•°'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 1. åˆ›å»ºä¸€ä¸ªæ¨¡æ‹Ÿå‡½æ•°ï¼Œç”¨æ¥æ£€æŸ¥å®ƒæœ‰æ²¡æœ‰è¢«è°ƒç”¨</span>
    <span class="hljs-keyword">const</span> mockClick = vi.<span class="hljs-title function_">fn</span>();
    <span class="hljs-comment">// 2. æ¸²æŸ“ç»„ä»¶</span>
    <span class="hljs-title function_">render</span>(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">text</span>=<span class="hljs-string">"ç‚¹å‡»æˆ‘"</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{mockClick}</span> /&gt;</span></span>);
    <span class="hljs-comment">// 3. æ‰¾åˆ°æŒ‰é’®</span>
    <span class="hljs-keyword">const</span> buttonElement = screen.<span class="hljs-title function_">getByText</span>(<span class="hljs-string">'ç‚¹å‡»æˆ‘'</span>);
    <span class="hljs-comment">// 4. æ¨¡æ‹Ÿä¸€æ¬¡ç‚¹å‡»äº‹ä»¶</span>
    fireEvent.<span class="hljs-title function_">click</span>(buttonElement);
    <span class="hljs-comment">// 5. æ–­è¨€ï¼ˆæœŸæœ›ï¼‰æˆ‘ä»¬ä¼ å…¥çš„æ¨¡æ‹Ÿå‡½æ•°è¢«è°ƒç”¨äº†ä¸€æ¬¡</span>
    <span class="hljs-title function_">expect</span>(mockClick).<span class="hljs-title function_">toHaveBeenCalledTimes</span>(<span class="hljs-number">1</span>);
  });
});
</code></pre>
<p><strong>4. è¿è¡Œæµ‹è¯•</strong></p>
<p>æœ€ååœ¨ <code>package.json</code> é‡ŒåŠ ä¸€ä¸ªå‘½ä»¤ï¼Œç„¶åè¿è¡Œå®ƒå°±èƒ½çœ‹åˆ°æµ‹è¯•ç»“æœäº†ã€‚</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"test"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vitest"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åœ¨ç»ˆç«¯é‡Œè·‘å‘½ä»¤ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">npm run test
</code></pre>
<p>å¦‚æœæµ‹è¯•é€šè¿‡äº†ï¼Œç»ˆç«¯é‡Œå°±ä¼šæ˜¾ç¤ºç»¿è‰²çš„å¯¹å‹¾ï¼Œå‘Šè¯‰ä½ æ‰€æœ‰æµ‹è¯•éƒ½æˆåŠŸäº†ï¼Œçœ‹ç€å¾ˆæœ‰æˆå°±æ„Ÿã€‚</p>
<h5 data-id="heading-4">å››ã€å¯¹äºç»„ä»¶æ¥è¯´ï¼Œåº”è¯¥æµ‹è¯•å“ªäº›æ–¹é¢ï¼Ÿ</h5>
<blockquote>
<p>åƒç”¨æˆ·ä¸€æ ·æ€è€ƒ</p>
</blockquote>





























<table><thead><tr><th>æµ‹è¯•ç±»å‹</th><th>å…³é”®é—®é¢˜</th></tr></thead><tbody><tr><td>âœ… æ¸²æŸ“æµ‹è¯•</td><td>ç”¨æˆ·çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿ</td></tr><tr><td>âœ… äº¤äº’æµ‹è¯•</td><td>ç”¨æˆ·æ“ä½œåå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</td></tr><tr><td>âœ… Props æµ‹è¯•</td><td>ä¸åŒè¾“å…¥ä¸‹è¡Œä¸ºæ˜¯å¦æ­£ç¡®ï¼Ÿ</td></tr><tr><td>âœ… æ¡ä»¶æ¸²æŸ“</td><td>å†…å®¹æ˜¯å¦åœ¨æ­£ç¡®æ—¶æœºæ˜¾ç¤º/éšè—ï¼Ÿ</td></tr><tr><td>âœ… å¼‚æ­¥æµ‹è¯•</td><td>æ•°æ®åŠ è½½å UI æ˜¯å¦æ›´æ–°ï¼Ÿ</td></tr></tbody></table>
<ul>
<li>
<p><code>@testing-library/react</code>ï¼šç”¨äºæ¸²æŸ“å’ŒæŸ¥è¯¢</p>
</li>
<li>
<p><code>@testing-library/jest-dom</code>ï¼šæä¾›Â <code>toBeInTheDocument()</code>Â ç­‰æ–­è¨€</p>
</li>
<li>
<p><code>vi.fn()</code>Â /Â <code>vi.spyOn()</code>ï¼šæ¨¡æ‹Ÿå‡½æ•°</p>
</li>
<li>
<p><code>waitFor</code>Â /Â <code>findBy</code>ï¼šå¤„ç†å¼‚æ­¥</p>
</li>
<li>
<p><code>userEvent</code>ï¼ˆæ¯”Â <code>fireEvent</code>Â æ›´çœŸå®ï¼‰</p>
<ul>
<li/>
</ul>
</li>
</ul>
<p><strong>å…·ä½“åœºæ™¯</strong></p>

































<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæµ‹è¯•æ–¹å¼</th></tr></thead><tbody><tr><td>æŒ‰é’®ã€è¾“å…¥æ¡†ã€å¡ç‰‡ç­‰ UI ç»„ä»¶</td><td>æµ‹è¯•æ¸²æŸ“ + äº¤äº’</td></tr><tr><td>è¡¨å•ç»„ä»¶</td><td>æµ‹è¯•è¾“å…¥ã€éªŒè¯ã€æäº¤</td></tr><tr><td>æ¨¡æ€æ¡†ã€ä¸‹æ‹‰èœå•</td><td>æµ‹è¯•æ˜¾ç¤º/éšè—ã€ç‚¹å‡»é®ç½©å…³é—­</td></tr><tr><td>åˆ—è¡¨ç»„ä»¶</td><td>æµ‹è¯•æ•°æ®æ¸²æŸ“ã€ç©ºçŠ¶æ€ã€åŠ è½½çŠ¶æ€</td></tr><tr><td>å®¹å™¨ç»„ä»¶ï¼ˆå¸¦é€»è¾‘ï¼‰</td><td>æ¨¡æ‹Ÿ APIï¼Œæµ‹è¯•æ•°æ®æµ</td></tr><tr><td>è‡ªå®šä¹‰ Hook</td><td>å•ç‹¬æµ‹è¯• Hook è¡Œä¸ºï¼ˆç”¨Â <code>renderHook</code>ï¼‰</td></tr></tbody></table>
<h5 data-id="heading-5"><strong>å››ã€æ€»ç»“</strong></h5>
<p>é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œæˆ‘æ„Ÿè§‰ Vitest <strong>ç¡®å®å¾ˆç®€å•æ˜“ç”¨</strong>ï¼Œé…ç½®èµ·æ¥ä¸éº»çƒ¦ï¼Œå†™æµ‹è¯•çš„è¯­æ³•ä¹Ÿå¾ˆæ¸…æ™°ã€‚å¯¹äºæˆ‘ä»¬ç°åœ¨çš„é¡¹ç›®æ¥è¯´ï¼Œæ˜¯ä¸€ä¸ªå¾ˆä¸é”™çš„é€‰æ‹©ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HarmonyOSåº”ç”¨å¼€å‘è€…çš„å®è—APP-HMOSä»£ç å·¥åŠ-ç»„ä»¶å †å æ»‘åŠ¨æŠ˜å æ•ˆæœï¼ˆäºŒï¼‰]]></title>    <link>https://juejin.cn/post/7579313396207353871</link>    <guid>https://juejin.cn/post/7579313396207353871</guid>    <pubDate>2025-12-03T08:55:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579313396207353871" data-draft-id="7579298511071985664" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HarmonyOSåº”ç”¨å¼€å‘è€…çš„å®è—APP-HMOSä»£ç å·¥åŠ-ç»„ä»¶å †å æ»‘åŠ¨æŠ˜å æ•ˆæœï¼ˆäºŒï¼‰"/> <meta itemprop="keywords" content="HarmonyOS,ArkUI,ArkTS"/> <meta itemprop="datePublished" content="2025-12-03T08:55:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Huangå…„"/> <meta itemprop="url" content="https://juejin.cn/user/52404619842712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HarmonyOSåº”ç”¨å¼€å‘è€…çš„å®è—APP-HMOSä»£ç å·¥åŠ-ç»„ä»¶å †å æ»‘åŠ¨æŠ˜å æ•ˆæœï¼ˆäºŒï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/52404619842712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Huangå…„
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:55:05.000Z" title="Wed Dec 03 2025 08:55:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ†æäº†ç»„ä»¶å †å æ•ˆæœçš„æ¨¡å—åˆ’åˆ†å’Œå®ç°æ€è·¯ï¼Œå¹¶ä¸”å®ç°äº†å‰ä¸¤ä¸ªæœ€ç®€å•çš„éƒ¨åˆ†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­å®ç°å‰©ä½™éƒ¨åˆ†</p>
<h2 data-id="heading-1">ç¬¬ä¸‰éƒ¨åˆ†ç‰©å“æ </h2>
<p>ç”±äºå‘ä¸Šæ»‘åŠ¨çš„æ—¶å€™éœ€è¦åº•éƒ¨ç¬¬å››éƒ¨åˆ†çš„å•†å“åˆ—è¡¨éœ€è¦è¢«ç¬¬ä¸‰éƒ¨åˆ†é®ç›–ï¼Œæˆ‘ä»¬åŒæ ·ä½¿ç”¨Stackæ¥åšçˆ¶å¸ƒå±€ï¼Œä½¿ç”¨<code>zIndex</code>å±æ€§æ¥è°ƒæ•´Zè½´å±‚çº§æ¥å®ç°è¦†ç›–æ•ˆæœã€‚</p>
<h3 data-id="heading-2">åŸºç¡€å¸ƒå±€</h3>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-title function_">build</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">Stack</span>({<span class="hljs-attr">alignContent</span>:<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Top</span>}) {
      <span class="hljs-title class_">Row</span>(){
        <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">"app.media.user_portrait"</span>))
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">30</span>)
          .<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-number">1</span>)
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)
        <span class="hljs-title class_">Blank</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">0</span>)
        <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">"app.media.stack_scan"</span>))
          .<span class="hljs-title function_">width</span>(<span class="hljs-number">30</span>)
          .<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-number">1</span>)

      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">padding</span>({<span class="hljs-attr">left</span>:<span class="hljs-number">15</span>,<span class="hljs-attr">right</span>:<span class="hljs-number">15</span>})

      <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">outSideScrollController</span>){
        <span class="hljs-title class_">Column</span>(){
          <span class="hljs-comment">//æœç´¢æ¡†</span>
          <span class="hljs-title class_">Row</span>() {
            <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.search'</span>))
              .<span class="hljs-title function_">width</span>(<span class="hljs-number">20</span>)
              .<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-number">1</span>)
              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span> })

            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'æœç´¢æç¤ºè¯­'</span>)
              .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.6</span>)
              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)
              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)
              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span> })
          }
          .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">searchAreaHeight</span>)
          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">(<span class="hljs-params">_</span>) =&gt;</span> {
            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">"è·³è½¬åˆ°æœç´¢é¡µé¢"</span> })
          })
          <span class="hljs-title class_">Stack</span>({<span class="hljs-attr">alignContent</span>:<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Top</span>}){
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">showHorizontalList</span>){
              <span class="hljs-title class_">Row</span>(){
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">"æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
              }.<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
            }<span class="hljs-keyword">else</span>{
              <span class="hljs-title class_">Row</span>(){
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">"ä¸å¯æ»‘åŠ¨å¸ƒå±€"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
              }.<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
            }
            <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">inSideScrollController</span>){
              <span class="hljs-title class_">Column</span>(){
                <span class="hljs-title class_">Row</span>({<span class="hljs-attr">space</span>:<span class="hljs-number">10</span>}){
                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"åˆ†ç±»1"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)
                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"åˆ†ç±»2"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)
                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"åˆ†ç±»3"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)
                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"åˆ†ç±»4"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)
                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"åˆ†ç±»5"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)
                }.<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceAround</span>)
                <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fakeProduct</span>,<span class="hljs-function">(<span class="hljs-params">item:<span class="hljs-built_in">string</span>,index:<span class="hljs-built_in">number</span></span>)=&gt;</span>{
                  <span class="hljs-title class_">ListItem</span>(){
                    <span class="hljs-title class_">Row</span>(){
                      <span class="hljs-title class_">Text</span>(item)
                    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
                  }
                })
              }

            }.<span class="hljs-title function_">onScrollFrameBegin</span>(<span class="hljs-function">(<span class="hljs-params">offset:<span class="hljs-built_in">number</span></span>)=&gt;</span>{
              <span class="hljs-keyword">let</span> yOffset = <span class="hljs-variable language_">this</span>.<span class="hljs-property">inSideScrollController</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-property">yOffset</span>
              <span class="hljs-keyword">return</span> {<span class="hljs-attr">offsetRemain</span>:offset}
            })
          }
        }.<span class="hljs-title function_">margin</span>({<span class="hljs-attr">top</span>:<span class="hljs-number">50</span>}).<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>)
      }.<span class="hljs-title function_">padding</span>({<span class="hljs-attr">left</span>:<span class="hljs-number">15</span>,<span class="hljs-attr">right</span>:<span class="hljs-number">15</span>}).<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)
      .<span class="hljs-title function_">onScrollFrameBegin</span>(<span class="hljs-function">(<span class="hljs-params">offset:<span class="hljs-built_in">number</span>,state:ScrollState</span>)=&gt;</span>{
        <span class="hljs-keyword">let</span> yOffset = <span class="hljs-variable language_">this</span>.<span class="hljs-property">outSideScrollController</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-property">yOffset</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">searchAreaHeight</span> = <span class="hljs-number">100</span> - yOffset * <span class="hljs-number">0.6</span>
        <span class="hljs-keyword">return</span> {<span class="hljs-attr">offsetRemain</span>:offset}
      })
    }.<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#f1f1f1"</span>)
    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)
    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)
  }
</code></pre>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed17992fff4449e3b8bd4b6231110819~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356905&amp;x-signature=YbECBgNriGxGl%2FpqVtRszfkCnBM%3D" width="45%" loading="lazy"/>
<h3 data-id="heading-3">æ»‘åŠ¨å†²çª</h3>
<p>å‘ç°äº†ä¸¤ä¸ªä¸ªé—®é¢˜ï¼š</p>
<ol>
<li>åµŒå¥—æ»‘åŠ¨çš„æ»‘åŠ¨å†²çª<br/>
ä»å›¾ä¸Šæ¥çœ‹ï¼Œå½“æ‰‹æŒ‡åœ¨å†…éƒ¨çš„Scrollæ»‘åŠ¨æ—¶åªèƒ½æ»‘åŠ¨å†…éƒ¨çš„Scrollï¼Œåœ¨å¤–éƒ¨Scrollæ»‘åŠ¨æ—¶ï¼Œåªèƒ½æ»‘åŠ¨å¤–éƒ¨çš„Scrollï¼Œè¿™å’Œæˆ‘ä»¬çš„éœ€æ±‚ä¸ç¬¦åˆã€‚</li>
<li>ç¬¬ä¸‰éƒ¨åˆ†çš„ç‰©å“å¡ç‰‡æ²¡æœ‰å±•ç¤ºå‡ºæ¥ã€‚</li>
</ol>
<p>å¯¹äºé—®é¢˜1æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®<code>nestedScroll</code>å±æ€§æ¥è§£å†³ã€‚<br/>
å¯¹äºé—®é¢˜2æˆ‘ä»¬å¯ä»¥å¯¹å†…éƒ¨<code>Scroll</code>çš„ç›´æ¥å­ç»„ä»¶<code>Colum</code>åŠ ä¸ª<code>margin</code>å±æ€§è§£å†³ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript">            <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">inSideScrollController</span>){
              <span class="hljs-title class_">Column</span>(){
              <span class="hljs-comment">//åˆ†ç±»</span>
                <span class="hljs-title class_">Row</span>({<span class="hljs-attr">space</span>:<span class="hljs-number">10</span>}){
}.<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceAround</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
                <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fakeProduct</span>,<span class="hljs-function">(<span class="hljs-params">item:<span class="hljs-built_in">string</span>,index:<span class="hljs-built_in">number</span></span>)=&gt;</span>{
                  <span class="hljs-title class_">ListItem</span>(){
                    <span class="hljs-title class_">Row</span>(){
                      <span class="hljs-title class_">Text</span>(item)
                    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
                  }
                })
              }
<span class="hljs-comment">//å’Œé¡¶éƒ¨çš„è·ç¦»ä¸ºç¬¬ä¸‰éƒ¨åˆ†ç‰©å“å¡ç‰‡çš„é«˜åº¦</span>
.<span class="hljs-title function_">margin</span>({<span class="hljs-attr">top</span>:<span class="hljs-number">200</span>})

            }.<span class="hljs-title function_">nestedScroll</span>({
              <span class="hljs-attr">scrollForward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-property">PARENT_FIRST</span>,
              <span class="hljs-attr">scrollBackward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-property">SELF_FIRST</span>
            })
</code></pre>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d4cf79145e0c4e3eac0962f5846ac5cb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356905&amp;x-signature=A5R%2F4HTAOuuLw7KaFnv5OiR8sDU%3D" width="45%" loading="lazy"/>
ç°åœ¨æ¥çœ‹æ•ˆæœå°±æ­£å¸¸äº†ã€‚  
<h3 data-id="heading-4">ç‰©å“å¡ç‰‡é€æ˜åº¦æ•ˆæœ</h3>
<p>ä¸ºäº†æ–¹ä¾¿åé¢çš„è®¡ç®—ï¼Œæˆ‘ä»¬å®šä¹‰å‡ ä¸ªå¸¸é‡å’Œå˜é‡</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SEARCH_AREA_HEIGHT</span> = <span class="hljs-number">100</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ITEM_CARDS_AREA_HEIGHT</span> = <span class="hljs-number">200</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">HORIZONTAL_LIST_HEIGHT</span> = <span class="hljs-number">100</span>
</code></pre>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-attr">outSideScrollController</span>:<span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>()
  <span class="hljs-attr">inSideScrollController</span>:<span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>()

  <span class="hljs-meta">@State</span> <span class="hljs-attr">searchAreaHeight</span>:<span class="hljs-built_in">number</span> = <span class="hljs-variable constant_">SEARCH_AREA_HEIGHT</span>
  <span class="hljs-meta">@State</span> <span class="hljs-attr">showHorizontalList</span>:<span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>

  <span class="hljs-meta">@State</span> <span class="hljs-attr">itemCardsAreaOpacity</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>
  <span class="hljs-meta">@State</span> <span class="hljs-attr">horizontalListOpacity</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>
  <span class="hljs-meta">@State</span> <span class="hljs-attr">classifyAreaOpacity</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>
</code></pre>
<p>ç„¶ååœ¨<code>æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨</code>ã€ <code>ä¸å¯æ»‘åŠ¨å¸ƒå±€</code>å’Œ<code>åˆ†ç±»</code>ä¸Šæ·»åŠ ä¸é€æ˜åº¦å±æ€§ã€‚
åœ¨å†…éƒ¨Scrollçš„<code>onScrollFrameBegin</code>äº‹ä»¶çš„å›è°ƒä¸­ï¼Œè·å–æ»‘åŠ¨è·ç¦»å¹¶ä¸”è®¡ç®—ä¸é€æ˜åº¦å±æ€§</p>
<pre><code class="hljs language-typescript" lang="typescript">          <span class="hljs-title class_">Stack</span>({<span class="hljs-attr">alignContent</span>:<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Top</span>}){
            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">showHorizontalList</span>){
              <span class="hljs-title class_">Row</span>(){
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">"æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
              }.<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">height</span>(<span class="hljs-variable constant_">HORIZONTAL_LIST_HEIGHT</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">horizontalListOpacity</span>)<span class="hljs-comment">//æ·»åŠ ä¸é€æ˜åº¦å±æ€§</span>
            }<span class="hljs-keyword">else</span>{
              <span class="hljs-title class_">Row</span>(){
                <span class="hljs-title class_">Text</span>(<span class="hljs-string">"ä¸å¯æ»‘åŠ¨å¸ƒå±€"</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)
              }.<span class="hljs-title function_">height</span>(<span class="hljs-variable constant_">ITEM_CARDS_AREA_HEIGHT</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">itemCardsAreaOpacity</span>)<span class="hljs-comment">//æ·»åŠ ä¸é€æ˜åº¦å±æ€§</span>
            }
            <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">inSideScrollController</span>){
              <span class="hljs-title class_">Column</span>(){
              <span class="hljs-comment">//åˆ†ç±»</span>
                <span class="hljs-title class_">Row</span>({<span class="hljs-attr">space</span>:<span class="hljs-number">10</span>}){
                }.<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">SpaceAround</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">classifyAreaOpacity</span>)<span class="hljs-comment">//æ·»åŠ ä¸é€æ˜åº¦å±æ€§</span>
                <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fakeProduct</span>,<span class="hljs-function">(<span class="hljs-params">item:<span class="hljs-built_in">string</span>,index:<span class="hljs-built_in">number</span></span>)=&gt;</span>{
                  <span class="hljs-title class_">ListItem</span>(){
                    <span class="hljs-title class_">Row</span>(){
                      <span class="hljs-title class_">Text</span>(item)
                    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">12</span>)
                  }
                })
              }.<span class="hljs-title function_">margin</span>({<span class="hljs-attr">top</span>:<span class="hljs-variable constant_">ITEM_CARDS_AREA_HEIGHT</span>})

            }.<span class="hljs-title function_">nestedScroll</span>({
              <span class="hljs-attr">scrollForward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-property">PARENT_FIRST</span>,
              <span class="hljs-attr">scrollBackward</span>: <span class="hljs-title class_">NestedScrollMode</span>.<span class="hljs-property">SELF_FIRST</span>
            }).<span class="hljs-title function_">onScrollFrameBegin</span>(<span class="hljs-function">(<span class="hljs-params">offset:<span class="hljs-built_in">number</span></span>)=&gt;</span>{
              <span class="hljs-keyword">let</span> yOffset = <span class="hljs-variable language_">this</span>.<span class="hljs-property">inSideScrollController</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-property">yOffset</span>
              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`inSideScroll <span class="hljs-subst">${yOffset}</span>`</span>)

             <span class="hljs-keyword">let</span> maxDiff = <span class="hljs-variable constant_">ITEM_CARDS_AREA_HEIGHT</span> - <span class="hljs-variable constant_">HORIZONTAL_LIST_HEIGHT</span>
             <span class="hljs-keyword">let</span> diff =maxDiff - yOffset
             <span class="hljs-comment">//æ»‘åŠ¨å…·ä½“è¶…è¿‡äºŒè€…çš„å·®å€¼ï¼Œåˆ™å±•ç¤ºæ¨ªå‘æ»‘åŠ¨åˆ—è¡¨ï¼›å¦åˆ™å±•ç¤ºç‰©å“å¡ç‰‡</span>
              <span class="hljs-keyword">if</span>(diff&gt;= <span class="hljs-number">0</span>){
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemCardsAreaOpacity</span> = diff/maxDiff
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">classifyAreaOpacity</span> = diff/maxDiff
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">showHorizontalList</span> =<span class="hljs-literal">false</span>
              }<span class="hljs-keyword">else</span>{
              	<span class="hljs-comment">//æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨çš„ä¸é€æ˜åº¦</span>
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">horizontalListOpacity</span> = -diff/maxDiff
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">showHorizontalList</span> = <span class="hljs-literal">true</span>
              }
              <span class="hljs-keyword">return</span> {<span class="hljs-attr">offsetRemain</span>:offset}
            })
          }
</code></pre>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3f73097ea224fc5b7326412777833f6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356905&amp;x-signature=SsyXAfCO4zGPZPwuaK%2FpEZBx7T8%3D" width="45%" loading="lazy"/>
<p>æ•ˆæœçœ‹èµ·æ¥ä¹Ÿè¿˜å¯ä»¥ï¼Œæˆ‘ä»¬æ›¿æ¢ä¸€ä¸‹ç´ æçœ‹çœ‹</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3a043cf8d0a4a30846baa8190452e7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356905&amp;x-signature=snc8U0OV3%2FPoGxg7UAxnNhJPHjk%3D" width="45%" loading="lazy"/>
<h2 data-id="heading-5">ç¬¬å››éƒ¨åˆ†</h2>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°åº•éƒ¨ç¬¬å››éƒ¨åˆ†çš„åˆ†ç±»ç¼©æ”¾å’Œæ¨ªå‘æ»‘åŠ¨åˆ—è¡¨çš„é—´è·å˜åŒ–ã€‚</p>
<h3 data-id="heading-6">åˆ†ç±»</h3>
<p>è¿™é‡Œæˆ‘ä»¬åšçš„ç®€å•ç‚¹ï¼Œåˆ†ç±»é¡¹çš„ç¼©æ”¾å€¼å’Œä¸é€æ˜åº¦å–ç›¸åŒå€¼ï¼Œå°±ä¸å†é¢å¤–è®¡ç®—äº†ã€‚å¦‚æœéœ€è¦ä¿®æ”¹æ•ˆæœï¼Œæ ¹æ®æ»‘åŠ¨åç§»é‡é‡æ–°è®¡ç®—ä¸€ä¸ªå€¼å°±å¥½äº†ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"> <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {
   <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.ic_gallery_puzzle'</span>)).<span class="hljs-title function_">width</span>(<span class="hljs-number">40</span>)
     .<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-number">1</span>)
     .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)
   <span class="hljs-title class_">Text</span>(<span class="hljs-string">"æ‹¼å›¾"</span>)
     .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
     .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)
     .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)
 }
 .<span class="hljs-title function_">scale</span>({<span class="hljs-attr">x</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">classifyAreaOpacity</span>,<span class="hljs-attr">y</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">classifyAreaOpacity</span>})
 .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>)
 .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)

</code></pre>
<p>è¿™é‡Œæ˜¯å…¶ä¸­ä¸€ä¸ªåˆ†ç±»é¡¹çš„å¸ƒå±€</p>
<h3 data-id="heading-7">æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨</h3>
<p>æ¨ªå‘æ»‘åŠ¨åˆ—è¡¨åˆšå‡ºç°æ—¶ï¼Œåˆ—è¡¨é¡¹é—´è·æ˜¯æœ€å¤§çš„ï¼Œéšç€å‘ä¸Šæ»‘åŠ¨ï¼Œåˆ—è¡¨é¡¹é—´è·é€æ¸å˜å°ï¼Œæœ€ç»ˆå›ºå®šä¸ºä¸€ä¸ªæœ€å°å€¼ã€‚è¿™é‡Œæˆ‘ä»¬è®¾ç½®æœ€å¤§é—´è·ä¸º<strong>50</strong>ï¼Œæœ€å°é—´è·ä¸º<strong>10</strong>ã€‚åŒæ ·çš„åœ¨å†…éƒ¨<code>Scroll</code>çš„<code>onScrollFrameBegin</code>çš„å›è°ƒä¸­è¿›è¡Œè®¡ç®—</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">MIN_HORIZONTAL_LIST_SPACE</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>
<span class="hljs-keyword">const</span> <span class="hljs-attr">MAX_HORIZONTAL_LIST_SPACE</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>
</code></pre>
<p>é—´è·åˆå§‹å€¼ä¸ºæœ€å¤§é—´è·</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@State</span> <span class="hljs-attr">horizontalListSpace</span>:<span class="hljs-built_in">number</span>= <span class="hljs-variable constant_">MAX_HORIZONTAL_LIST_SPACE</span>
</code></pre>
<p>é‡æ–°å†™ä¸€ä¸‹å¸ƒå±€ï¼Œç›´æ¥æ›¿æ¢ä¸ºç´ æã€‚è¿™é‡Œçš„<code>FakeHorizontalData</code>æ˜¯è‡ªå®šä¹‰æ•°æ®ç±»ï¼ŒåŒ…å«<code>name</code>å’Œ<code>icon</code>å±æ€§ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">showHorizontalList</span>){
  <span class="hljs-title class_">Scroll</span>(){
    <span class="hljs-title class_">Row</span>({<span class="hljs-attr">space</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">horizontalListSpace</span>}){
      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fakeHorizontalDataList</span>,<span class="hljs-function">(<span class="hljs-params">item:FakeHorizontalData,index:<span class="hljs-built_in">number</span></span>)=&gt;</span>{
        <span class="hljs-title class_">Column</span>(){
          <span class="hljs-title class_">Image</span>(item.<span class="hljs-property">icon</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">40</span>).<span class="hljs-title function_">aspectRatio</span>(<span class="hljs-number">1</span>)
            .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)
          <span class="hljs-title class_">Blank</span>().<span class="hljs-title function_">width</span>(<span class="hljs-number">15</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">0</span>)
          <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">name</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)
        }.<span class="hljs-title function_">width</span>(<span class="hljs-number">80</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>).<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">90</span>).<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
      })
    }.<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)
  }.<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Horizontal</span>).<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">height</span>(<span class="hljs-variable constant_">HORIZONTAL_LIST_HEIGHT</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">horizontalListOpacity</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">"#f1f1f1"</span>)

}
</code></pre>
<h3 data-id="heading-8">è®¡ç®—å¯¹åº”çš„å±æ€§å€¼</h3>
<p>åœ¨å†…éƒ¨<code>Scroll</code>çš„<code>onScrollFrameBegin</code>çš„å›è°ƒä¸­è¿›è¡Œè®¡ç®—</p>
<pre><code class="hljs language-typescript" lang="typescript">.<span class="hljs-title function_">onScrollFrameBegin</span>(<span class="hljs-function">(<span class="hljs-params">offset:<span class="hljs-built_in">number</span></span>)=&gt;</span>{
   <span class="hljs-keyword">let</span> yOffset = <span class="hljs-variable language_">this</span>.<span class="hljs-property">inSideScrollController</span>.<span class="hljs-title function_">currentOffset</span>().<span class="hljs-property">yOffset</span>
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`inSideScroll <span class="hljs-subst">${yOffset}</span>`</span>)

  <span class="hljs-keyword">let</span> maxDiff = (<span class="hljs-variable constant_">ITEM_CARDS_AREA_HEIGHT</span> - <span class="hljs-variable constant_">HORIZONTAL_LIST_HEIGHT</span>)
  <span class="hljs-keyword">let</span> diff =maxDiff - yOff<span class="hljs-keyword">set</span>
   <span class="hljs-title function_">if</span>(<span class="hljs-params">diff&gt;= <span class="hljs-number">0</span></span>){
     <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemCardsAreaOpacity</span> = diff/maxDiff
     <span class="hljs-variable language_">this</span>.<span class="hljs-property">classifyAreaOpacity</span> = diff/maxDiff
     <span class="hljs-variable language_">this</span>.<span class="hljs-property">showHorizontalList</span> =<span class="hljs-literal">false</span>
   }<span class="hljs-keyword">else</span>{
     <span class="hljs-variable language_">this</span>.<span class="hljs-property">horizontalListOpacity</span> = -diff/maxDiff
     <span class="hljs-variable language_">this</span>.<span class="hljs-property">showHorizontalList</span> = <span class="hljs-literal">true</span>


     <span class="hljs-keyword">let</span> <span class="hljs-attr">calcSpace</span>:<span class="hljs-built_in">number</span> = <span class="hljs-variable constant_">MAX_HORIZONTAL_LIST_SPACE</span> + diff
     <span class="hljs-keyword">if</span>(calcSpace &gt; <span class="hljs-variable constant_">MIN_HORIZONTAL_LIST_SPACE</span>){
       <span class="hljs-variable language_">this</span>.<span class="hljs-property">horizontalListSpace</span> = calcSpace
     }<span class="hljs-keyword">else</span>{
       <span class="hljs-variable language_">this</span>.<span class="hljs-property">horizontalListSpace</span> = <span class="hljs-variable constant_">MIN_HORIZONTAL_LIST_SPACE</span>
     }

   }
   <span class="hljs-keyword">return</span> {<span class="hljs-attr">offsetRemain</span>:offset}
 })
</code></pre>
<p>æ¥çœ‹ä¸‹æ•ˆæœ <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11b6b8a07cf24b8298261dfd18a65f1e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSHVhbmflhYQ=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356905&amp;x-signature=%2F4vpqz32IGanNjSIqn%2BL4Fi5VSY%3D" width="45%" loading="lazy"/>
è¿™æ ·æˆ‘ä»¬å°±å¤§è‡´å¤åˆ»äº†<code>HMOSä»£ç å·¥åŠ</code>åº”ç”¨ä¸­çš„ç»„ä»¶å †å æ•ˆæœã€‚</p>
<p>æœ€ä¸‹é¢çš„å•†å“åˆ—è¡¨æ²¡æœ‰å®ç°ï¼Œæ²¡å•¥éš¾åº¦ï¼Œè‡ªå·±æ›¿æ¢ä¸€ä¸‹å°±å¥½äº†</p>
<h2 data-id="heading-9">åè®°</h2>
<p><code>HMOSä»£ç å·¥åŠ</code>çš„ç»„ä»¶å †å æ•ˆæœæºç åœ¨è¿™é‡Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fharmonyos_samples%2Fcomponent-stack" target="_blank" title="https://gitee.com/harmonyos_samples/component-stack" ref="nofollow noopener noreferrer">gitee.com/harmonyos_sâ€¦</a></p>
<p>è‡ªå·±å®ç°çš„æ•ˆæœåœ¨è¿™é‡Œ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitcode.com%2Fhuangyuan_xuan%2FHelloArkUI%2Fblob%2Fmain%2Fentry%2Fsrc%2Fmain%2Fets%2Fpages%2Fplayground%2FComponentStackPage.ets" target="_blank" title="https://gitcode.com/huangyuan_xuan/HelloArkUI/blob/main/entry/src/main/ets/pages/playground/ComponentStackPage.ets" ref="nofollow noopener noreferrer">gitcode.com/huangyuan_xâ€¦</a></p>
<p>å¯¹æ¯”ä»£ç åå‘ç°ï¼Œ<code>HMOSä»£ç å·¥åŠ</code>ä¸­å¯¹äºç¬¬ä¸‰éƒ¨åˆ†å®ç°æ˜¯ä½¿ç”¨<code>GridCol</code>å’Œ<code>GridRow</code>è¿›è¡Œå®ç°çš„ã€‚æ»‘åŠ¨æ—¶çš„æ•ˆæœä¹Ÿæ¯”è¾ƒèˆ’æœï¼Œè‡ªå·±å®ç°çš„æ»‘åŠ¨æ•ˆæœè¿˜éœ€è¦è¿›è¡Œæ•°å€¼ä¸Šçš„è°ƒæ•´ã€‚
ä¸è¿‡å¤§ä½“æ¥çœ‹ï¼Œæ•ˆæœè¿˜ç®—å¯ä»¥</p>
<hr/>
<p>ã€ æ›´å¤šç²¾å½©å†…å®¹ï¼Œè¯·å…³æ³¨å…¬ä¼—å·ï¼šã€åç§°ï¼šHarmonyOSå¼€å‘è€…æŠ€æœ¯ï¼ŒIDï¼šHarmonyOS_Devã€‘ï¼›ä¹Ÿæ¬¢è¿åŠ å…¥é¸¿è’™å¼€å‘è€…äº¤æµç¾¤ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fwork.weixin.qq.com%2Fgm%2F48f89e7a4c10206e053e01ad124004a0%25E3%2580%2591" target="_blank" title="https://work.weixin.qq.com/gm/48f89e7a4c10206e053e01ad124004a0%E3%80%91" ref="nofollow noopener noreferrer">work.weixin.qq.com/gm/48f89e7aâ€¦</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[chen-er ä¸“ä¸ºChenå¼ERå›¾æ‰“é€ çš„npmåŒ…]]></title>    <link>https://juejin.cn/post/7579451710302076954</link>    <guid>https://juejin.cn/post/7579451710302076954</guid>    <pubDate>2025-12-03T08:55:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579451710302076954" data-draft-id="7579427549471539246" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="chen-er ä¸“ä¸ºChenå¼ERå›¾æ‰“é€ çš„npmåŒ…"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T08:55:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å§“ç‹è€…"/> <meta itemprop="url" content="https://juejin.cn/user/1795939693507712"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            chen-er ä¸“ä¸ºChenå¼ERå›¾æ‰“é€ çš„npmåŒ…
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1795939693507712/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å§“ç‹è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:55:22.000Z" title="Wed Dec 03 2025 08:55:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67ecd8bc17d5482891d338cd9b35e8af~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aeT546L6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765356961&amp;x-signature=PzI67k67cONcyLj0w8w%2FB%2FnfFjc%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>ç°ä»£ Web çš„å„ç§å›¾å½¢åº“åŸºæœ¬ä¸Šéƒ½é»˜è®¤å­˜åœ¨ <strong>ER å›¾</strong> æ¸²æŸ“ï¼Œå°¤å…¶æ˜¯ <strong>Mermaid</strong> è¿™ç§â€œæ–‡æœ¬åˆ°å›¾å½¢â€æ›´æ˜¯ä¸ä¾‹å¤–ï¼Œä½†é—æ†¾çš„æ˜¯ï¼Œè¿™äº›å›¾å½¢åº“å®Œå…¨éƒ½æ˜¯æŒ‰ç…§ <strong>Crow's Foot æ–¹æ³•</strong></p>
<blockquote>
<p>Crow's Foot æ–¹æ³•ï¼ˆä¹Ÿç§° "ä¹Œé¸¦è„šè¡¨ç¤ºæ³•"ï¼‰æ˜¯ä¸€ç§ç”¨äºæ•°æ®åº“è®¾è®¡çš„å®ä½“ - å…³ç³» (ER) å›¾å¯è§†åŒ–è¡¨ç¤ºæ–¹æ³•ï¼Œä»¥å…¶è¡¨ç¤º "å¤š" å…³ç³»çš„ç‹¬ç‰¹ä¸‰åˆ†æ”¯ç¬¦å·ï¼ˆç±»ä¼¼é¸Ÿçˆªï¼‰å¾—åã€‚å®ƒæ˜¯æ•°æ®åº“è®¾è®¡ä¸­æœ€æµè¡Œçš„ ER è¡¨ç¤ºæ³•ä¹‹ä¸€ï¼Œå¹¿æ³›åº”ç”¨äºè½¯ä»¶å·¥ç¨‹ã€ä¿¡æ¯å·¥ç¨‹å’Œæ•°æ®åº“å»ºæ¨¡é¢†åŸŸã€‚</p>
</blockquote>
<p>æ¥å†™çš„ï¼Œä½†å­¦æ ¡æ˜¯æŒ‰ç…§ <strong>Chen's Notation</strong>ï¼Œä¹Ÿå°±æ˜¯ç»å…¸çš„ <strong>è±å½¢å…³ç³»ã€æ¤­åœ†å±æ€§ã€çŸ©å½¢å®ä½“</strong></p>
<blockquote>
<p>Chen è¡¨ç¤ºæ³•ï¼ˆä¹Ÿç§° â€œé™ˆå¼ ER è¡¨ç¤ºæ³•â€ï¼‰æ˜¯ç”±åè£”è®¡ç®—æœºç§‘å­¦å®¶é™ˆå“å±±ï¼ˆPeter Pin-Shan Chenï¼‰ äº 1976 å¹´åœ¨ã€ŠACM Transactions on Database Systemsã€‹å‘è¡¨çš„ã€ŠThe Entity-Relationship Modelâ€”Toward a Unified View of Dataã€‹ä¸­é¦–æ¬¡æå‡ºçš„å®ä½“ - å…³ç³»ï¼ˆERï¼‰æ¨¡å‹å¯è§†åŒ–è§„èŒƒï¼Œæ˜¯åŸå§‹ ER æ¨¡å‹çš„å®˜æ–¹è¡¨ç¤ºæ³•ï¼Œä¹Ÿæ˜¯æ•°æ®åº“å»ºæ¨¡ã€è½¯ä»¶å·¥ç¨‹æ•™å­¦ä¸­æœ€ç»å…¸çš„ ER å¯è§†åŒ–èŒƒå¼ã€‚</p>
</blockquote>
<p>ä¸ªäººæ¥è®²ï¼Œ<strong>ER å›¾</strong> è¡¨ç¤ºæ³•æ˜¯æˆ‘åœ¨å­¦æ ¡çš„æ•°æ®åº“è¯¾ä¸­å­¦æ¥çš„ã€‚ä¸ºäº†æ–¹ä¾¿è‡ªå·±å¿«é€Ÿä»æ–‡æœ¬ç»˜åˆ¶ <strong>ER å›¾</strong>ï¼ˆå°±åƒ <strong>Mermaid</strong> é‚£æ ·ï¼‰è€Œä¸æ˜¯é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·æ‰‹åŠ¨æ‹–æ‹½æ‹¼å‡‘é‚£æ ·<strong>ç¹çéº»çƒ¦</strong></p>
<p>é‚£ä¹ˆä½œä¸º<strong>è®¡ç®—æœºå­¦ç”Ÿ</strong>ï¼Œå‘ç°ç½‘ä¸Šç¼ºå°‘è¿™æ ·çš„å®ç°ï¼Œä¸å…å¿ƒç—’ï¼Œäºæ˜¯å°±è¯ç”Ÿäº†ä¸‹é¢çš„ <strong>npm åŒ…</strong></p>
<h2 data-id="heading-1">chen-er</h2>
<p>github/chen-er: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxingwangzhe%2Fchen-er%2F" target="_blank" title="https://github.com/xingwangzhe/chen-er/" ref="nofollow noopener noreferrer">github.com/xingwangzheâ€¦</a></p>
<p>npm/chen-er: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchen-er" target="_blank" title="https://www.npmjs.com/package/chen-er" ref="nofollow noopener noreferrer">www.npmjs.com/package/cheâ€¦</a></p>
<p>åœ¨çº¿ä½“éªŒï¼ï¼ï¼: <a href="https://link.juejin.cn?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fsandbox%2Fm248ws" target="_blank" title="https://codesandbox.io/p/sandbox/m248ws" ref="nofollow noopener noreferrer">codesandbox.io/p/sandbox/mâ€¦</a></p>
<p>chen-er æ˜¯åŸºäº <a href="https://link.juejin.cn?target=https%3A%2F%2Fpeggyjs.org%2F" target="_blank" title="https://peggyjs.org/" ref="nofollow noopener noreferrer">Peggy</a> å’Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fecharts.apache.org%2Fzh%2Findex.html" target="_blank" title="https://echarts.apache.org/zh/index.html" ref="nofollow noopener noreferrer">ECharts</a> å¼€å‘çš„ã€ä»æ–‡æœ¬è½¬åˆ° <strong>ER å›¾</strong> çš„ <strong>npm åŒ…</strong>ï¼Œå…¶ä¸­ï¼Œ<strong>Peggy</strong> ç”¨æ¥å°†æ–‡æœ¬è¿›è¡Œè§£æ/åºåˆ—åŒ–ï¼Œ<strong>ECharts</strong> ç”¨æ¥å®ç°<strong>å›¾å½¢æ¸²æŸ“ä¸è‡ªåŠ¨å¸ƒå±€</strong></p>
<h3 data-id="heading-2">æŠ€æœ¯ç»†èŠ‚</h3>
<h4 data-id="heading-3">ä¸ºä»€ä¹ˆé€‰æ‹© <strong>Peggy</strong></h4>
<p>è¿™ç‚¹è¦æ„Ÿè°¢ AI çš„æ¨èï¼Œè¿™ä¸ªåº“çœ‹èµ·æ¥æ²¡ä»€ä¹ˆäººç”¨ï¼Œä½†æˆ‘æ•¢è¯´è¿™ç»å¯¹æ˜¯<strong>å®è—</strong>ï¼šå®ƒå¯¹è¯­æ³•çš„è§£æç»å¯¹æ¯”è‡ªå·±<strong>æ‰‹æ’¸æ­£åˆ™</strong>è¦å¥½å¾ˆå¤šï¼ï¼ï¼</p>
<p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰**â€œå®â€**ï¼Œæ¥æ–¹ä¾¿å¤ç”¨ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// Peggy è¯­æ³•é€šç”¨è§„åˆ™åº“</span>

_  <span class="hljs-comment">// å¯é€‰ç©ºç™½ + æ³¨é‡Š</span>
  = (comment / [ \t\n\r])*

__ <span class="hljs-comment">// è‡³å°‘ä¸€ä¸ªç©ºç™½å­—ç¬¦</span>
  = [ \t\n\r]+

<span class="hljs-comment">// è¡Œå†…ç©ºç™½ï¼ˆä¸å«æ¢è¡Œï¼‰</span>
hws = [ \t]*

<span class="hljs-comment">// è·¨å¹³å°æ¢è¡Œç¬¦</span>
newline
  = <span class="hljs-string">"\r\n"</span> / <span class="hljs-string">"\n"</span> / <span class="hljs-string">"\r"</span>

<span class="hljs-comment">// æ ‡è¯†ç¬¦ï¼ˆæ”¯æŒ Unicode å­—æ¯å’Œæ•°å­—ï¼‰</span>
<span class="hljs-title class_">Identifier</span>
  = <span class="hljs-attr">id</span>:$[^ \t\n\r{}():\<span class="hljs-string">"#\-]+ &amp;{ return /^[\p{L}_][\p{L}\p{N}_]*$/u.test(id); } { return id; }

// è¡Œæ³¨é‡Šï¼ˆä¸åæ‰æ¢è¡Œï¼‰
comment
  = "</span>#<span class="hljs-string">" [^\n\r]* { return null; }

</span></code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥å®šä¹‰å®ä½“ä¸å…³ç³»ã€‚æ˜¾ç„¶ï¼Œåªè¦æˆ‘ä»¬å­¦è¿‡ <strong>C++</strong> æˆ– <strong>Java</strong> è¿™ç§ <strong>OOP</strong> èŒƒå¼çš„ç¼–ç¨‹è¯­è¨€ï¼Œè‡ªç„¶çŸ¥é“åº”è¯¥å¦‚ä½•å®šä¹‰å®ƒï¼Œä¸€ä¸ªç®€å•çš„æ ¼å¼å°±å®šå¥½äº†</p>
<pre><code class="hljs language-js" lang="js">entity <span class="hljs-title class_">Customer</span> {
  customer_id  <span class="hljs-variable constant_">PK</span>    # ä¸»é”®ä¸‹åˆ’çº¿ç”¨<span class="hljs-variable constant_">PK</span>æ ‡è®°
  name
  email
  phone
}
</code></pre>
<p>æ¥ä¸‹æ¥å°±å¼€å§‹å®šä¹‰äº†ï¼Œå½“ä½ çœ‹åˆ°ä¸‹é¢çš„ <strong>Peggy</strong> ä»£ç ï¼Œä½ ä¼šå‘ç°ï¼Œè¿™ä¸ªå®šä¹‰éå¸¸ç¬¦åˆç¼–ç¨‹ç›´è§‰ï¼›å³ä½¿ä½ ä»æœªå­¦è¿‡<strong>ç¼–è¯‘åŸç†</strong>æˆ–è€…<strong>æ­£åˆ™è¡¨è¾¾</strong>ï¼Œ
ä¹Ÿèƒ½çœ‹æ‡‚å¾ˆå¤šï¼è¿™æ­£æ˜¯ <strong>Peggy</strong> çš„é­…åŠ›æ‰€åœ¨ï¼ï¼ï¼</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-comment">// å¼•ç”¨å…¬å…±è§„åˆ™</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Identifier</span>, hws, newline, _ , __, comment } <span class="hljs-keyword">from</span> <span class="hljs-string">"./common.peggy"</span>

<span class="hljs-comment">// start   // è§£æå…¥å£</span>
<span class="hljs-comment">//   = _ entities:entity+ _ { return entities; } </span>

<span class="hljs-comment">// æ³¨é‡Šåœ¨ common.peggy ä¸­</span>

    
entity <span class="hljs-comment">// è§£æå®ä½“å®šä¹‰ï¼ˆå…è®¸å‰ç½®ç©ºç™½ï¼‰</span>
  = _ <span class="hljs-string">"entity"</span> __ <span class="hljs-attr">name</span>:<span class="hljs-title class_">Identifier</span> _ <span class="hljs-string">"{"</span> _ <span class="hljs-attr">fields</span>:fieldBlock _ <span class="hljs-string">"}"</span> {
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">"entity"</span>, <span class="hljs-attr">name</span>: name, <span class="hljs-attr">fields</span>: fields };
    }

<span class="hljs-comment">// å­—æ®µå—ï¼šé›¶åˆ°å¤šè¡Œå­—æ®µï¼Œæ¯è¡Œä»¥æ¢è¡Œç»“æŸ</span>
fieldBlock
  = fieldLine*

fieldLine <span class="hljs-comment">// è§£æå¤šè¡Œå­—æ®µå®šä¹‰ï¼ˆè¡Œé¦–è‡³å°‘ä¸€ä¸ªç©ºç™½ï¼Œé¿å…ç©ºåŒ¹é…ï¼›è¡Œå°¾å¯æ³¨é‡Šï¼‰</span>
  = hws <span class="hljs-attr">f</span>:field hws comment? hws newline { <span class="hljs-keyword">return</span> f; }

field <span class="hljs-comment">// è§£æå­—æ®µå®šä¹‰ï¼ˆè¡Œå†…ä¸åæ¢è¡Œï¼‰</span>
  = <span class="hljs-attr">name</span>:<span class="hljs-title class_">Identifier</span> hws <span class="hljs-attr">pk</span>:(<span class="hljs-string">"PK"</span>)? {
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">"field"</span>, name, <span class="hljs-attr">pk</span>: pk !== <span class="hljs-literal">null</span> };
    }
</code></pre>
<p>ç±»ä¼¼çš„å¯¹äºå…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå®šä¹‰</p>
<pre><code class="hljs language-js" lang="js">rel <span class="hljs-title class_">Customer</span> -- <span class="hljs-title class_">Order</span>  (<span class="hljs-number">1</span>:n) <span class="hljs-string">"places"</span> # å®¢æˆ·ä¸‹è®¢å•
rel <span class="hljs-title class_">Customer</span> -- <span class="hljs-title class_">Address</span>  (<span class="hljs-attr">m</span>:n) <span class="hljs-string">"uses"</span> # å®¢æˆ·ä½¿ç”¨åœ°å€
rel <span class="hljs-title class_">Order</span> -- <span class="hljs-title class_">Address</span>  (<span class="hljs-number">1</span>:<span class="hljs-number">1</span>) <span class="hljs-string">"shipped to"</span> # è®¢å•å‘è´§åœ°å€
</code></pre>
<p>ç›¸åº”çš„ä»£ç å®ç°</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å¼•ç”¨å…¬å…±è§„åˆ™</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Identifier</span>, hws, newline, _ , __, comment } <span class="hljs-keyword">from</span> <span class="hljs-string">"./common.peggy"</span>

<span class="hljs-comment">// start // è§£æå…¥å£ </span>
<span class="hljs-comment">//     = _ rels:rel+ _ { return rels; }</span>

<span class="hljs-comment">// å…³ç³»å®šä¹‰ï¼šrel &lt;å®ä½“1&gt; -- &lt;å®ä½“2&gt; : (åŸºæ•°) "&lt;å…³ç³»å&gt;"</span>
rel
    = _ <span class="hljs-string">"rel"</span> __ <span class="hljs-attr">left</span>:<span class="hljs-title class_">Identifier</span> __ <span class="hljs-string">"--"</span> __ <span class="hljs-attr">right</span>:<span class="hljs-title class_">Identifier</span> _ <span class="hljs-string">":"</span> _ <span class="hljs-string">"("</span> <span class="hljs-attr">card</span>:<span class="hljs-title class_">Cardinality</span> <span class="hljs-string">")"</span> _ <span class="hljs-attr">name</span>:<span class="hljs-title class_">QuotedString</span> _ comment? newline? {
        <span class="hljs-keyword">return</span> { <span class="hljs-attr">type</span>: <span class="hljs-string">"relation"</span>, left, right, <span class="hljs-attr">cardinality</span>: card, name };
    }

<span class="hljs-comment">// åŸºæ•°ï¼šå¦‚ 1:n, m:n, 1:1</span>
<span class="hljs-title class_">Cardinality</span>
    = <span class="hljs-attr">chars</span>:[^)]* { <span class="hljs-keyword">return</span> chars.<span class="hljs-title function_">join</span>(<span class="hljs-string">""</span>).<span class="hljs-title function_">trim</span>(); }

<span class="hljs-comment">// åŒå¼•å·å­—ç¬¦ä¸²</span>
<span class="hljs-title class_">QuotedString</span>
    = <span class="hljs-string">'"'</span> <span class="hljs-attr">chars</span>:[^<span class="hljs-string">"]* '"</span><span class="hljs-string">' { return chars.join(""); }
</span></code></pre>
<p>è¿™ä¸¤ä¸ªé‡ç‚¹å†™å¥½äº†ï¼Œé‚£ä¹ˆæ±‡æ€»ä¸€ä¸‹</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å¼•ç”¨å…¬å…±è§„åˆ™</span>
<span class="hljs-keyword">import</span> { _ } <span class="hljs-keyword">from</span> <span class="hljs-string">"./common.peggy"</span>

<span class="hljs-comment">// å¼•ç”¨å®ä½“è§„åˆ™</span>
<span class="hljs-keyword">import</span> { entity } <span class="hljs-keyword">from</span> <span class="hljs-string">"./entities.peggy"</span>

<span class="hljs-comment">// å¼•ç”¨å…³ç³»è§„åˆ™</span>
<span class="hljs-keyword">import</span> { rel } <span class="hljs-keyword">from</span> <span class="hljs-string">"./sample.peggy"</span>

start <span class="hljs-comment">// è§£æå…¥å£ï¼šæ”¯æŒå®ä½“å’Œå…³ç³»æ··åˆå®šä¹‰</span>
  = _ <span class="hljs-attr">elements</span>:(entity / rel)+  _ {
      <span class="hljs-keyword">return</span> elements;
  }
</code></pre>
<p>è‡³æ­¤ï¼Œè¯­æ³•è§£æçš„éƒ¨åˆ†åŸºæœ¬ç»“æŸã€‚åŒæ—¶ï¼Œè¿™äº› <strong>Peggy</strong> ç¼–è¯‘åè¾“å‡ºçš„ <strong>JS</strong> ä»£ç ä¼šè‡ªåŠ¨è¾“å‡ºåºåˆ—åŒ–çš„æ•°æ®ï¼Œæ¥ä¸‹æ¥å°†åœ¨ <strong>ECharts</strong> ä¸­ä½¿ç”¨ã€‚</p>
<h4 data-id="heading-4"><strong>ECharts</strong> æ¸²æŸ“</h4>
<p>é¦–å…ˆç®€å•å®šä¹‰ä¸€ä¸‹ç±»å‹</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">/**
 * å­—æ®µå®šä¹‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ERField</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">"field"</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">pk</span>: <span class="hljs-built_in">boolean</span>;
}

<span class="hljs-comment">/**
 * å®ä½“å®šä¹‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">EREntity</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">"entity"</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">fields</span>: <span class="hljs-title class_">ERField</span>[];
}

<span class="hljs-comment">/**
 * å…³ç³»å®šä¹‰
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ERRelation</span> {
  <span class="hljs-attr">type</span>: <span class="hljs-string">"relation"</span>;
  <span class="hljs-attr">left</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">right</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">cardinality</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;
}

<span class="hljs-comment">/**
 * ER å›¾ JSON èŠ‚ç‚¹ç±»å‹
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">ERJson</span> = <span class="hljs-title class_">EREntity</span> | <span class="hljs-title class_">ERRelation</span>;

</code></pre>
<p>â€œæ¡¥æ¥â€ç‚¹ï¼Œæ–¹ä¾¿å¼•å…¥ <strong>Peggy</strong> ç¼–è¯‘äº§ç”Ÿçš„ <strong>JS</strong> è§£æå™¨å’Œåºåˆ—åŒ–åŠŸèƒ½</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// @ts-ignore ä½¿ç”¨ peggy ç”Ÿæˆçš„è§£æå™¨ï¼ˆESMï¼Œå‘½åå¯¼å‡º parseï¼‰</span>
<span class="hljs-comment">// ç”Ÿæˆè„šæœ¬è§ package.json -&gt; scripts.pg</span>
<span class="hljs-keyword">import</span> { parse <span class="hljs-keyword">as</span> peggyParse } <span class="hljs-keyword">from</span> <span class="hljs-string">"../grammar/peggy/all-parser.js"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ERJson</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"./type"</span>;

<span class="hljs-comment">/**
 * è§£æ ER å›¾æ–‡æœ¬ä¸º AST
 * <span class="hljs-doctag">@param</span> input å¤šè¡Œ ER å›¾å®šä¹‰æ–‡æœ¬
 * <span class="hljs-doctag">@returns</span> è§£æåçš„ AST æ•°ç»„
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parseERSchema</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">ERJson</span>[] {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">peggyParse</span>(input) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ERJson</span>[];
  } <span class="hljs-keyword">catch</span> (<span class="hljs-attr">e</span>: <span class="hljs-built_in">any</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"è§£æå¤±è´¥:"</span>, e?.<span class="hljs-property">message</span>, <span class="hljs-string">"\nä½ç½®:"</span>, e?.<span class="hljs-property">location</span>);
    <span class="hljs-keyword">throw</span> e;
  }
}

<span class="hljs-comment">/**
 * è§£æ ER å›¾æ–‡æœ¬å¹¶è¾“å‡º JSON
 * <span class="hljs-doctag">@param</span> input å¤šè¡Œ ER å›¾å®šä¹‰æ–‡æœ¬
 * <span class="hljs-doctag">@returns</span> JSON å­—ç¬¦ä¸²
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">parseERSchemaToJSON</span>(<span class="hljs-params">input: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-title function_">parseERSchema</span>(input), <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>);
}

</code></pre>
<p>ä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œä¸‹é¢ä»£ç æ”¹æˆ<strong>é«˜åº¦æ¦‚æ‹¬</strong>çš„ç‰ˆæœ¬</p>
<p>ä»…ä¿ç•™ä¸‰ä¸ªå…³é”®æ­¥éª¤â€”â€”<strong>è§£æ</strong>ï¼ˆ<code>parseERSchema</code>ï¼‰â†’ <strong>æ˜ å°„</strong>ï¼ˆå®ä½“/å±æ€§/å…³ç³»ä¸‰ç±»èŠ‚ç‚¹ä¸è¿è¾¹ï¼‰â†’ <strong>æ¸²æŸ“</strong>ï¼ˆECharts Graph + <strong>åŠ›å¯¼å‘å¸ƒå±€</strong>ï¼‰ã€‚å½¢çŠ¶éµå¾ª <strong>Chen è¡¨ç¤ºæ³•</strong>ï¼šå®ä½“=çŸ©å½¢ï¼Œå±æ€§=æ¤­åœ†ï¼ˆä¸»é”®çº¢è‰²æè¾¹ï¼‰ï¼Œå…³ç³»=è±å½¢ï¼›åŸºæ•°æ ‡æ³¨åˆ°è¾¹æ ‡ç­¾ä¸Šã€‚é€šè¿‡ <code>chenERRbyClass</code>/<code>chenERRbyId</code> å³å¯æŠŠå®¹å™¨å†…çš„ <strong>ER æ–‡æœ¬</strong> ç›´æ¥æ¸²æŸ“ä¸ºå¯äº¤äº’å›¾ã€‚</p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> echarts <span class="hljs-keyword">from</span> <span class="hljs-string">"echarts/core"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">GraphChart</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"echarts/charts"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">TooltipComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"echarts/components"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">CanvasRenderer</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"echarts/renderers"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">ComposeOption</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"echarts/core"</span>;
<span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">GraphSeriesOption</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"echarts/charts"</span>;
<span class="hljs-keyword">import</span> { parseERSchema } <span class="hljs-keyword">from</span> <span class="hljs-string">"./main"</span>;

<span class="hljs-comment">// ä»…æ³¨å†Œå¿…éœ€ç»„ä»¶ï¼ˆå›¾ + æç¤º + æ¸²æŸ“å™¨ï¼‰</span>
echarts.<span class="hljs-title function_">use</span>([<span class="hljs-title class_">GraphChart</span>, <span class="hljs-title class_">TooltipComponent</span>, <span class="hljs-title class_">CanvasRenderer</span>]);
<span class="hljs-keyword">type</span> <span class="hljs-title class_">ECOption</span> = <span class="hljs-title class_">ComposeOption</span>&lt;<span class="hljs-title class_">GraphSeriesOption</span>&gt;;

<span class="hljs-comment">// æ¤­åœ†å±æ€§èŠ‚ç‚¹ï¼ˆChenï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">ELLIPSE</span> = <span class="hljs-string">"path://M50 0 A50 50 0 1 1 49.999 0 Z"</span>;

<span class="hljs-comment">// AST -&gt; Graphï¼ˆèŠ‚ç‚¹ã€è¿è¾¹ï¼‰</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">astToGraph</span>(<span class="hljs-params">ast: <span class="hljs-built_in">any</span>[]</span>) {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">nodes</span>: <span class="hljs-built_in">any</span>[] = [];
  <span class="hljs-keyword">const</span> <span class="hljs-attr">edges</span>: <span class="hljs-built_in">any</span>[] = [];
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> it <span class="hljs-keyword">of</span> ast) {
    <span class="hljs-keyword">if</span> (it.<span class="hljs-property">type</span> === <span class="hljs-string">"entity"</span>) {
      <span class="hljs-keyword">const</span> id = it.<span class="hljs-property">name</span>;
      nodes.<span class="hljs-title function_">push</span>({
        id,
        <span class="hljs-attr">name</span>: id,
        <span class="hljs-attr">symbol</span>: <span class="hljs-string">"rect"</span>,
        <span class="hljs-attr">category</span>: <span class="hljs-string">"entity"</span>,
        <span class="hljs-attr">symbolSize</span>: [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">140</span>, id.<span class="hljs-property">length</span> * <span class="hljs-number">14</span> + <span class="hljs-number">40</span>), <span class="hljs-number">48</span>],
        <span class="hljs-attr">label</span>: { <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span> },
        <span class="hljs-attr">attrs</span>: (it.<span class="hljs-property">fields</span> || []).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">f: <span class="hljs-built_in">any</span></span>) =&gt;</span> ({ <span class="hljs-attr">name</span>: f.<span class="hljs-property">name</span>, <span class="hljs-attr">pk</span>: !!f.<span class="hljs-property">pk</span> })),
      });
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> f <span class="hljs-keyword">of</span> it.<span class="hljs-property">fields</span> || []) {
        <span class="hljs-keyword">const</span> aid = <span class="hljs-string">`<span class="hljs-subst">${id}</span>.<span class="hljs-subst">${f.name}</span>`</span>;
        nodes.<span class="hljs-title function_">push</span>({
          <span class="hljs-attr">id</span>: aid,
          <span class="hljs-attr">name</span>: f.<span class="hljs-property">name</span>,
          <span class="hljs-attr">symbol</span>: <span class="hljs-variable constant_">ELLIPSE</span>,
          <span class="hljs-attr">symbolKeepAspect</span>: <span class="hljs-literal">false</span>,
          <span class="hljs-attr">symbolSize</span>: [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">90</span>, f.<span class="hljs-property">name</span>.<span class="hljs-property">length</span> * <span class="hljs-number">16</span>), <span class="hljs-number">36</span>],
          <span class="hljs-attr">category</span>: <span class="hljs-string">"attribute"</span>,
          <span class="hljs-attr">label</span>: { <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span> },
          <span class="hljs-attr">itemStyle</span>: {
            <span class="hljs-attr">borderColor</span>: f.<span class="hljs-property">pk</span> ? <span class="hljs-string">"#d62728"</span> : <span class="hljs-string">"#5470c6"</span>,
            <span class="hljs-attr">borderWidth</span>: f.<span class="hljs-property">pk</span> ? <span class="hljs-number">3</span> : <span class="hljs-number">1</span>,
          },
        });
        edges.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">source</span>: aid, <span class="hljs-attr">target</span>: id });
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (it.<span class="hljs-property">type</span> === <span class="hljs-string">"relation"</span>) {
      <span class="hljs-keyword">const</span> rid = <span class="hljs-string">`rel:<span class="hljs-subst">${it.name}</span>-<span class="hljs-subst">${it.left}</span>-<span class="hljs-subst">${it.right}</span>`</span>;
      <span class="hljs-keyword">const</span> [l = <span class="hljs-string">""</span>, r = <span class="hljs-string">""</span>] = (it.<span class="hljs-property">cardinality</span> || <span class="hljs-string">""</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">":"</span>);
      nodes.<span class="hljs-title function_">push</span>({
        <span class="hljs-attr">id</span>: rid,
        <span class="hljs-attr">name</span>: it.<span class="hljs-property">name</span>,
        <span class="hljs-attr">symbol</span>: <span class="hljs-string">"diamond"</span>,
        <span class="hljs-attr">symbolSize</span>: [<span class="hljs-number">110</span>, <span class="hljs-number">60</span>],
        <span class="hljs-attr">category</span>: <span class="hljs-string">"relation"</span>,
        <span class="hljs-attr">label</span>: { <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span> },
      });
      edges.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">source</span>: rid, <span class="hljs-attr">target</span>: it.<span class="hljs-property">left</span>, <span class="hljs-attr">name</span>: l });
      edges.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">source</span>: rid, <span class="hljs-attr">target</span>: it.<span class="hljs-property">right</span>, <span class="hljs-attr">name</span>: r });
    }
  }
  <span class="hljs-keyword">return</span> { nodes, edges };
}

<span class="hljs-comment">// æ‰¹é‡æ¸²æŸ“æŒ‡å®šç±»åå®¹å™¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderChenER</span>(<span class="hljs-params">cls = <span class="hljs-string">"chenER"</span></span>) {
  <span class="hljs-keyword">const</span> list = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByClassName</span>(cls) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLCollectionOf</span>&lt;<span class="hljs-title class_">HTMLElement</span>&gt;;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; list.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">const</span> el = list[i];
    <span class="hljs-keyword">const</span> { nodes, edges } = <span class="hljs-title function_">astToGraph</span>(<span class="hljs-title function_">parseERSchema</span>(el.<span class="hljs-property">textContent</span> || <span class="hljs-string">""</span>));
    el.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">const</span> chart = echarts.<span class="hljs-title function_">init</span>(el);
    <span class="hljs-keyword">const</span> <span class="hljs-attr">option</span>: <span class="hljs-title class_">ECOption</span> = {
      <span class="hljs-attr">series</span>: [
        {
          <span class="hljs-attr">type</span>: <span class="hljs-string">"graph"</span>,
          <span class="hljs-attr">layout</span>: <span class="hljs-string">"force"</span>,
          <span class="hljs-attr">roam</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">data</span>: nodes,
          <span class="hljs-attr">links</span>: edges,
          <span class="hljs-attr">categories</span>: [
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"entity"</span> },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"relation"</span> },
            { <span class="hljs-attr">name</span>: <span class="hljs-string">"attribute"</span> },
          ],
          <span class="hljs-attr">label</span>: { <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">position</span>: <span class="hljs-string">"inside"</span> },
          <span class="hljs-attr">edgeLabel</span>: { <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">formatter</span>: <span class="hljs-function">(<span class="hljs-params">p: <span class="hljs-built_in">any</span></span>) =&gt;</span> p?.<span class="hljs-property">data</span>?.<span class="hljs-property">name</span> ?? <span class="hljs-string">""</span> },
          <span class="hljs-attr">edgeSymbol</span>: [<span class="hljs-string">"none"</span>, <span class="hljs-string">"none"</span>],
          <span class="hljs-attr">lineStyle</span>: { <span class="hljs-attr">color</span>: <span class="hljs-string">"#888"</span>, <span class="hljs-attr">curveness</span>: <span class="hljs-number">0.2</span> },
          <span class="hljs-attr">force</span>: { <span class="hljs-attr">repulsion</span>: <span class="hljs-number">600</span>, <span class="hljs-attr">edgeLength</span>: <span class="hljs-number">140</span>, <span class="hljs-attr">friction</span>: <span class="hljs-number">0.2</span> },
          <span class="hljs-attr">tooltip</span>: {
            <span class="hljs-attr">show</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">formatter</span>: <span class="hljs-function">(<span class="hljs-params">p: <span class="hljs-built_in">any</span></span>) =&gt;</span> {
              <span class="hljs-keyword">if</span> (p.<span class="hljs-property">dataType</span> === <span class="hljs-string">"node"</span> &amp;&amp; p?.<span class="hljs-property">data</span>?.<span class="hljs-property">category</span> === <span class="hljs-string">"relation"</span>) {
                <span class="hljs-keyword">return</span> p.<span class="hljs-property">data</span>.<span class="hljs-property">name</span> || <span class="hljs-string">""</span>;
              }
              <span class="hljs-keyword">if</span> (p.<span class="hljs-property">dataType</span> === <span class="hljs-string">"node"</span> &amp;&amp; p?.<span class="hljs-property">data</span>?.<span class="hljs-property">category</span> === <span class="hljs-string">"entity"</span>) {
                <span class="hljs-keyword">const</span> d = p.<span class="hljs-property">data</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>;
                <span class="hljs-keyword">const</span> attrs = (d.<span class="hljs-property">attrs</span> || []).<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">any</span></span>) =&gt;</span> (a.<span class="hljs-property">pk</span> ? <span class="hljs-string">`*<span class="hljs-subst">${a.name}</span>`</span> : a.<span class="hljs-property">name</span>));
                <span class="hljs-keyword">return</span> [d.<span class="hljs-property">name</span>, ...attrs].<span class="hljs-title function_">join</span>(<span class="hljs-string">"&lt;br/&gt;"</span>);
              }
              <span class="hljs-keyword">return</span> p.<span class="hljs-property">name</span> || <span class="hljs-string">""</span>;
            },
          },
        },
      ],
    };
    chart.<span class="hljs-title function_">setOption</span>(option);
    <span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"resize"</span>, <span class="hljs-function">() =&gt;</span> chart.<span class="hljs-title function_">resize</span>());
  }
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> chenERRbyClass = renderChenER;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">chenERRbyId</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) {
  <span class="hljs-keyword">const</span> el = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(id) <span class="hljs-keyword">as</span> <span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (!el) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`Container #<span class="hljs-subst">${id}</span> not found`</span>);
  el.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">"chenER"</span>);
  <span class="hljs-title function_">renderChenER</span>(<span class="hljs-string">"chenER"</span>);
}
</code></pre>
<h3 data-id="heading-5">è¿˜ç­‰ä»€ä¹ˆï¼Œç°åœ¨å°±å»è¯•è¯•å§ï¼</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fcodesandbox.io%2Fp%2Fsandbox%2Fm248ws" target="_blank" title="https://codesandbox.io/p/sandbox/m248ws" ref="nofollow noopener noreferrer">codesandbox.io/p/sandbox/mâ€¦</a></p>
<h2 data-id="heading-6">chen-er ä¸“ä¸ºChenå¼ERå›¾æ‰“é€ çš„npmåŒ…</h2>
<p>ä½œè€…: xingwangzhe</p>
<p>æœ¬æ–‡é“¾æ¥:Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fxingwangzhe.fun%2Fposts%2Fb8eb3b61" target="_blank" title="https://xingwangzhe.fun/posts/b8eb3b61" ref="nofollow noopener noreferrer">xingwangzhe.fun/posts/b8eb3â€¦</a></p>
<p>æœ¬æ–‡é‡‡ç”¨Â <a href="https://link.juejin.cn?target=https%3A%2F%2Fcreativecommons.org%2Flicenses%2Fby-nc-sa%2F4.0%2F" target="_blank" title="https://creativecommons.org/licenses/by-nc-sa/4.0/" ref="nofollow noopener noreferrer">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®</a>Â è¿›è¡Œè®¸å¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è´§æ‹‰æ‹‰RAGä¼˜åŒ–å®è·µï¼šä»åŸå§‹æ•°æ®åˆ°é«˜è´¨é‡çŸ¥è¯†åº“]]></title>    <link>https://juejin.cn/post/7579385656779669538</link>    <guid>https://juejin.cn/post/7579385656779669538</guid>    <pubDate>2025-12-03T08:59:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579385656779669538" data-draft-id="7576532425763061775" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è´§æ‹‰æ‹‰RAGä¼˜åŒ–å®è·µï¼šä»åŸå§‹æ•°æ®åˆ°é«˜è´¨é‡çŸ¥è¯†åº“"/> <meta itemprop="keywords" content="ç®—æ³•,æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-03T08:59:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è´§æ‹‰æ‹‰æŠ€æœ¯"/> <meta itemprop="url" content="https://juejin.cn/user/1768489241815070"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è´§æ‹‰æ‹‰RAGä¼˜åŒ–å®è·µï¼šä»åŸå§‹æ•°æ®åˆ°é«˜è´¨é‡çŸ¥è¯†åº“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1768489241815070/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è´§æ‹‰æ‹‰æŠ€æœ¯
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T08:59:19.000Z" title="Wed Dec 03 2025 08:59:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯</h2>
<p>çŸ¥è¯†åº“ä¸€èˆ¬é€šè¿‡æœ¬åœºæ™¯çš„äººå·¥å¤–å‘¼è·å¾—ä¸“æœ‰çŸ¥è¯†ï¼Œä»¥åŠä»å…¶ä»–åœºæ™¯çš„çŸ¥è¯†åº“è¿ç§»é€šç”¨çŸ¥è¯†æ¥äººå·¥æ„å»ºçš„ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b314f6f02bdd4205b27118df458f39b3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=mSA%2B5YMapZjHOZSgqZJA5tXhnLs%3D" alt="1.png" loading="lazy"/></p>
<p align="center">å›¾1 çŸ¥è¯†åº“åˆå§‹æ„å»º</p>
<p>åˆå§‹æ„å»ºçš„çŸ¥è¯†åº“ä¸€èˆ¬åŒ…å«ä¸‰éƒ¨åˆ†ï¼šç›¸ä¼¼é—®æ³•ã€æ„å›¾ã€æ ‡å‡†è¯æœ¯ï¼ˆå¦‚å›¾2æ‰€ç¤ºï¼‰ï¼›çŸ¥è¯†åº“åœ¨çº¿ä¸Šä½¿ç”¨æ—¶ï¼Œæ˜¯å°†RAGå¬å›çš„æ„å›¾ã€ç›¸ä¼¼é—®æ³•ã€æ ‡å‡†è¯æœ¯æ‹¼æ¥åˆ°promptä¸­ï¼Œç”±LLMç”Ÿæˆç›¸åº”çš„è¯æœ¯ï¼Œæ‰€ä»¥çŸ¥è¯†åº“æ„å›¾ã€ç›¸ä¼¼é—®æ³•ã€æ ‡å‡†è¯æœ¯çš„æ˜ å°„å…³ç³»æ˜¯å¦å‡†ç¡®å°¤ä¸ºé‡è¦ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cbb33f57f074619866a6ae4ec30986b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=xRsu%2B22pBXcg8lL3L3JhrvpYCMk%3D" alt="2.png" loading="lazy"/></p>
<p align="center">å›¾2 ç›¸ä¼¼é—®æ³•ã€æ„å›¾ã€æ ‡å‡†è¯æœ¯çš„æ˜ å°„å…³ç³»</p>
<blockquote>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<p>ç›¸ä¼¼é—®æ³•ï¼š</p>
<p>ä½ ä»¬å¸®æˆ‘è®¢é˜…è¿™ä¸ªè·¯çº¿éœ€ä¸éœ€è¦æ”¶è´¹ï¼Œä½ è¯´ï¼Ÿ</p>
<p>ä½ å…ˆè¯´è®¢é˜…è¿™ä¸ªæ”¶ä¸æ”¶è´¹ã€‚</p>
<p>æ„å›¾ï¼šè¯¢é—®è®¢é˜…è·¯çº¿æ˜¯å¦æ”¶è´¹</p>
<p>æ ‡å‡†è¯æœ¯ï¼š</p>
<p>è‡ªåŠ¨è®¢é˜…æ˜¯ä¸æ”¶è´¹çš„ã€‚</p>
<p>ä¸æ”¶è´¹çš„ã€‚</p>
<p>è‡ªåŠ¨è®¢é˜…æ˜¯å®Œå…¨å…è´¹çš„ï¼Œä¸æ”¶æ‚¨é’±ã€‚</p>
</blockquote>
<p>ç”±äºçŸ¥è¯†åº“çš„åˆå§‹æ„å»ºä¾èµ–äºäººå·¥ï¼Œç”±äºäººåŠ›èµ„æºçš„ä¸è¶³ï¼ŒçŸ¥è¯†åº“ä¸€èˆ¬å­˜åœ¨ä»¥ä¸‹ä¸‰ç±»é—®é¢˜ï¼š</p>
<ol>
<li>æ„å›¾åå®šä¹‰ä¸æ¸…æ™° ==&gt; å¯¼è‡´LLMç”Ÿæˆè¯æœ¯å¯èƒ½ä¸åˆç† ==&gt; éœ€é‡æ–°å®šä¹‰æ„å›¾å</li>
</ol>
<blockquote>
<p>å›¾ä¸­ç›¸ä¼¼é—®æ³•å®é™…è¯­ä¹‰æ˜¯ã€è´¨ç–‘æ¥ç”µçš„çœŸå®æ€§ã€‘ï¼Œä½¿ç”¨ã€æ¥ç”µç›®çš„ã€‘ä½œä¸ºæ„å›¾åï¼Œä¸èƒ½å‡†ç¡®æ¦‚æ‹¬å¸æœºè¯­ä¹‰ï¼Œè¿›è€Œå¯¼è‡´å›å¤è¯æœ¯ä¸åˆç†ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe29d2ed91194b1aa945fdafd268dbed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=LO0H1A1vM3Ak9wr5ok2yfpemgPk%3D" alt="å›¾ç‰‡3.png" loading="lazy"/></p>
<p align="center">å›¾3 æ„å›¾åå®šä¹‰ä¸æ¸…æ™°ç¤ºä¾‹</p>
<ol start="2">
<li>ç›¸ä¼¼é—®æ³•ä¸æ„å›¾è¯æœ¯ä¸åŒ¹é… ==&gt; å¯¼è‡´LLMç­”éæ‰€é—® ==&gt; éœ€å¯¹ç›¸ä¼¼é—®æ³•é‡æ–°å½’ç±»</li>
</ol>
<blockquote>
<p>å›¾ä¸­ç›¸ä¼¼é—®æ³•è¢«é”™åˆ†ä¸ºã€è½¦å­æœ‰è´§äº†ã€‘ï¼ŒLLMå°†å‚è€ƒè¯¥æ„å›¾çš„è¯æœ¯ï¼Œè¿›è€Œå¯¼è‡´ç­”éæ‰€é—®ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01a09083e30d4d789f63e6ad4a46fda1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=7k9x7dFiIUrMsXBH%2FtvZY1O3h6w%3D" alt="4.png" loading="lazy"/></p>
<p align="center">å›¾4 ç›¸ä¼¼é—®æ³•ä¸æ„å›¾è¯æœ¯ä¸åŒ¹é…ç¤ºä¾‹</p>
<ol start="3">
<li>æ„å›¾è¿‡äºæ¦‚æ‹¬ ==&gt; æ ‡å‡†è¯æœ¯å›å¤ä¸å¤Ÿç²¾å‡† ==&gt; éœ€æ„å›¾ç»†æ‹†</li>
</ol>
<blockquote>
<p>å›¾ä¸­ç›¸ä¼¼é—®æ³•ä¸­åŒ…å«è‹¥å¹²ç§å¸æœºæ²¡å‡ºè½¦çš„è¯­ä¹‰å¦‚ï¼šåœ¨ä½é™¢ã€åœ¨è€å®¶ã€åœ¨ä¿®è½¦ç­‰ã€‚</p>
<p>ä½¿ç”¨ç»Ÿä¸€çš„è¯æœ¯æ— æ³•ç²¾å‡†çš„å›å¤å¸æœºï¼Œéœ€è¦å¯¹æ„å›¾è¿›è¡Œç»†æ‹†ã€‚</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f565a81f12b41a8b474cee43286be7a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=q8TqDQMJqd9SUlBwHaIHAhu59sk%3D" alt="5.png" loading="lazy"/></p>
<p align="center">å›¾5 æ„å›¾è¿‡äºæ¦‚æ‹¬ç¤ºä¾‹</p>
<h2 data-id="heading-1">äºŒã€è§£å†³æ–¹æ¡ˆ</h2>
<p>çŸ¥è¯†åº“æ¸…æ´—ä¸šç•Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ul>
<li>
<p>æ–¹æ¡ˆä¸€ï¼šåµŒå…¥æ¨¡å‹+èšç±»</p>
</li>
<li>
<p>æ–¹æ¡ˆäºŒï¼šå¤§æ¨¡å‹è¯­ä¹‰ç†è§£</p>
</li>
</ul>
<h3 data-id="heading-2">2.1 æ–¹æ¡ˆä¸€ï¼šåµŒå…¥æ¨¡å‹+èšç±»</h3>
<blockquote>
<p>ä½¿ç”¨åµŒå…¥æ¨¡å‹å°†ç›¸ä¼¼é—®æ³•æ˜ å°„åˆ°é«˜ç»´å‘é‡ç©ºé—´ï¼Œä½¿ç”¨èšç±»ç®—æ³•æ¸…æ´—çŸ¥è¯†åº“</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efc3302101c64a148acff3b8f6f15826~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=9ZIygKpxvHURXOTtd988zjLikt8%3D" alt="å›¾ç‰‡6.png" loading="lazy"/>
ç»è°ƒç ”ï¼ŒQwen3-Embedding-8Båœ¨èšç±»ä»»åŠ¡ä¸­è¯„åˆ†æœ€é«˜ï¼Œå› æ­¤æ¨¡å‹é€‰æ‹©Qwen3-Embedding-8Bã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/563a90dc471a465cbfe8b08d45864b1f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=yQ1LR31%2BZMK0a1V7%2Bal4Hs8%2BqdQ%3D" alt="" loading="lazy"/></p>
<p>å®è·µè¿‡ç¨‹ä¸­ï¼Œå› Qwen3-Embedding-8B è¯­ä¹‰ç†è§£ç¨‹åº¦æœ‰é™ï¼Œèšç±»ç®—æ³•å­˜åœ¨ç±»åˆ«ä¸å¯æ§/ç±»åˆ«è¯­ä¹‰æœªçŸ¥çš„é—®é¢˜ï¼Œå¯¼è‡´ç›¸ä¼¼é—®æ³•é‡æ–°å½’ç±»å‡†ç¡®ç‡æä½ã€æ„å›¾ç»†åˆ†è¿‡ç»†ï¼Œæœ€ç»ˆé‡‡ç”¨æ–¹æ¡ˆäºŒæ¸…æ´—ã€‚</p>
<h3 data-id="heading-3">2.2 æ–¹æ¡ˆäºŒï¼šå¤§æ¨¡å‹è¯­ä¹‰ç†è§£</h3>
<blockquote>
<p>åˆ©ç”¨å¤§æ¨¡å‹çš„è¯­è¨€ç†è§£èƒ½åŠ›ï¼Œè¾…åŠ©äººå·¥è¿›è¡ŒçŸ¥è¯†åº“æ¸…æ´—ï¼Œæé«˜æ¸…æ´—æ•ˆç‡</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed1990a8f9a24d6cb3bf2ac1f535af3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=%2FwGVb5moQtK2TAyjaViv80nbcT4%3D" alt="å›¾ç‰‡8.png" loading="lazy"/></p>
<h4 data-id="heading-4">1.   é‡æ–°å®šä¹‰æ„å›¾å</h4>
<blockquote>
<p>ç»“åˆå¤§æ¨¡å‹å’Œä¸šåŠ¡çŸ¥è¯†å¯¹æ„å›¾åè¿›è¡Œä¼˜åŒ–</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/24e79a31f08a48da8c24eb142a4ea959~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=ZVLzlK4GvqYTxaIKwiZMufOWU8M%3D" alt="å›¾ç‰‡9.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">a</span>.  å°‘é‡æ ·æœ¬åˆå§‹åŒ–æ„å›¾åï¼š
Â Â æŠ½å–å°‘é‡æ ·æœ¬å¹¶ä½¿ç”¨å¤§æ¨¡å‹åˆå§‹åŒ–æ„å›¾åç§°å’Œæ„å›¾æè¿°ã€‚
<span class="hljs-selector-tag">b</span>.  äººå·¥checkï¼š
  æ ¹æ®ä¸šåŠ¡çŸ¥è¯†å¯¹å¤§æ¨¡å‹ç”Ÿæˆçš„åˆå§‹åŒ–æ„å›¾åç§°è¿›è¡ŒäºŒæ¬¡æ ¡éªŒï¼Œä»¥å¾—åˆ°èƒ½å¤Ÿç²¾å‡†æ¦‚æ‹¬ç›¸ä¼¼é—®æ³•è¯­ä¹‰çš„æ„å›¾åç§°ã€‚
</code></pre>

<h4 data-id="heading-5">2.  ç›¸ä¼¼é—®æ³•é‡æ–°å½’ç±»</h4>
<blockquote>
<p>ä½¿ç”¨å¤§æ¨¡å‹+promptçš„æ–¹å¼å¯¹ç›¸ä¼¼é—®æ³•é‡æ–°å½’ç±»ï¼Œå› æ­¤promptä¸­æ„å›¾çš„æè¿°å°±æä¸ºé‡è¦ï¼›</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/95e2db2326fd4843aae74a5d840ffff9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=W8%2BavJai4YmTSPdGwlg4XpUx6ps%3D" alt="å›¾ç‰‡10.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">a</span>.  å°‘é‡æ ·æœ¬è¿­ä»£ä¼˜åŒ–æ„å›¾æè¿°ï¼š
   Â æŠ½æ ·éƒ¨åˆ†ç›¸ä¼¼é—®æ³•ï¼Œä¸æ–­ä¼˜åŒ–è¿­ä»£promptä¸­æ„å›¾çš„æè¿°ï¼Œä»¥æé«˜å¤§æ¨¡å‹åˆ†ç±»å‡†ç¡®æ€§ã€‚
<span class="hljs-selector-tag">b</span>.  å…¨é‡åˆ†ç±»ï¼š
    é€šè¿‡å¤§æ¨¡å‹+prompt å¯¹å…¨é‡ç›¸ä¼¼é—®æ³•è¿›è¡Œé‡æ–°åˆ†ç±»ï¼Œç”±äºå‡†ç¡®ç‡å¾ˆéš¾è¾¾åˆ°<span class="hljs-number">100%</span>ï¼Œå› æ­¤ä»ç„¶éœ€è¦äººå·¥å¯¹ç±»åˆ«å‘ç”Ÿå˜æ›´çš„ç›¸ä¼¼é—®æ³•è¿›è¡ŒäºŒæ¬¡æ ¡éªŒï¼Œä»¥ä¿è¯ç›¸ä¼¼é—®æ³•åˆ†ç±»å‡†ç¡®ã€‚
</code></pre>

<h4 data-id="heading-6">3.   æ„å›¾ç»†åˆ†</h4>
<blockquote>
<p>ä½¿ç”¨å¤§æ¨¡å‹åˆå§‹åŒ–ç»†åˆ†æ„å›¾ç±»åˆ«ï¼Œäººå·¥äºŒæ¬¡ç¡®è®¤æœ€ç»ˆçš„ç»†åˆ†æ„å›¾</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d34fa1af59df42ada7f34dca8be05dc6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=NkyPmisE%2FtbnOe7harszDnUindI%3D" alt="å›¾ç‰‡11.png" loading="lazy"/></p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">a</span>.  åˆå§‹åŒ–æ„å›¾ç»†åˆ†ï¼š
    ä½¿ç”¨å¤§æ¨¡å‹çš„è¯­è¨€ç†è§£èƒ½åŠ›å’Œä¸šåŠ¡çŸ¥è¯†ä¸ºæ„å›¾çš„ç»†åˆ†æä¾›åˆå§‹æ–¹æ¡ˆï¼Œæ–¹ä¾¿äººå·¥äºŒæ¬¡checkï¼›
<span class="hljs-selector-tag">b</span>.  äººå·¥ä¼˜åŒ–ï¼š
    ç”±äºå¤§æ¨¡å‹çš„ç»†åˆ†æ–¹æ¡ˆå¹¶ä¸å®Œå…¨ç¬¦åˆä¸šåŠ¡è¦æ±‚ï¼Œå› æ­¤éœ€è¦äººå·¥è¿›è¡ŒäºŒæ¬¡ç¡®è®¤ï¼Œä»¥ç¡®ä¿æ„å›¾çš„ç»†åˆ†æ˜¯ç¬¦åˆä¸šåŠ¡é€»è¾‘çš„ã€‚
</code></pre>

<h4 data-id="heading-7">4.   è¯æœ¯ç”Ÿæˆ</h4>
<blockquote>
<p>ç»“åˆé‚€çº¦è¯æœ¯çŸ¥è¯†ï¼Œä½¿ç”¨å¤§æ¨¡å‹ç”Ÿæˆè¯æœ¯</p>
</blockquote>
<p>ç”±äºæ„å›¾çš„æ•°é‡ç¹å¤šï¼Œå¾ˆéš¾ä½¿ç”¨äººå·¥å»ä¸ºæ¯ä¸ªæ„å›¾ç”Ÿæˆå¤šç§è¯æœ¯ã€‚å› æ­¤ï¼Œåˆ©ç”¨å¤§æ¨¡å‹ç»“åˆåœºæ™¯çŸ¥è¯†ä¸ºæ¯ä¸ªæ„å›¾ç”Ÿæˆåˆå§‹å¤šæ ·åŒ–è¯æœ¯ï¼Œäººå·¥åšäºŒæ¬¡æ ¡éªŒã€‚</p>
<h2 data-id="heading-8">ä¸‰ã€ç»“æœ</h2>
<h4 data-id="heading-9">1.  æ„å›¾åå®šä¹‰ä¸æ¸…æ™°</h4>
<blockquote>
<p>åˆ©ç”¨ä¸šåŠ¡çŸ¥è¯†åˆå¹¶ç›¸ä¼¼çš„æ„å›¾ç±»åˆ«ï¼Œå¹¶ä¸ºæ¯ä¸€ä¸ªæ„å›¾æä¾›ä¼˜åŒ–åçš„æ„å›¾å</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8f8883a35ac4c4598356abcd9f36337~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=jih2XSR8elt%2BNJEJwLObQDiVWts%3D" alt="33.png" loading="lazy"/></p>
<h4 data-id="heading-10">2.   ç›¸ä¼¼é—®æ³•ä¸æ„å›¾ä¸åŒ¹é…</h4>
<blockquote>
<p>åˆ©ç”¨æ„å›¾æ‘˜è¦æ˜æ™°æ„å›¾å‘½ä¸­èŒƒå›´ï¼Œå¹¶å¯¹æ¯ä¸€ä¸ªæ„å›¾ä¸­çš„ç›¸ä¼¼é—®æ³•è¿›è¡Œä¼˜åŒ–</p>
<p>å¯¹<strong>10%</strong> çš„ç›¸ä¼¼é—®æ³•è¿›è¡Œé‡æ–°åˆ†ç±»ï¼Œå‡†ç¡®ç‡=65%</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8810620685ee4eda9bca4270edf5bdef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=GGA%2FdCrxMUoSqmkcDqGGYn%2FPw3c%3D" alt="22.png" loading="lazy"/></p>
<h4 data-id="heading-11">3.   æ„å›¾è¿‡äºæ¦‚æ‹¬</h4>
<blockquote>
<p>æ ¹æ®å¸æœºçš„æƒ…ç»ªã€å…·ä½“åŸå› ã€äº§å“ç»´åº¦è¿›è¡Œç»†åˆ†</p>
<p>å¯¹<strong>63%</strong> çš„æ„å›¾è¿›è¡Œç»†åˆ†ï¼ŒåŸæœ‰æ„å›¾44ä¸ªç±»ç»†åˆ†åä¸º89ä¸ªç±»</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b44288c2ec941888f02f87780087fe6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6LSn5ouJ5ouJ5oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765357159&amp;x-signature=84DrUvaAz3B4LueKI8ffSx0IktE%3D" alt="11.png" loading="lazy"/></p>
<h2 data-id="heading-12">å››ã€æœªæ¥å±•æœ›</h2>
<h4 data-id="heading-13">1.   è‡ªåŠ¨æç¤ºä¼˜åŒ–</h4>
<p>åœ¨å¯¹ç›¸ä¼¼é—®æ³•é‡æ–°å½’ç±»çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨äººå·¥è°ƒæ•´çš„æ–¹å¼æ¥å¾—åˆ°è¯­è¨€è¡¨è¿°ç²¾å‡†çš„æ„å›¾æè¿°ã€‚æœªæ¥å¯ä½¿ç”¨è‡ªåŠ¨æç¤ºä¼˜åŒ–çš„æ–¹æ³•å¯¹promptè¿›è¡Œè‡ªåŠ¨è°ƒä¼˜ã€‚</p>
<h4 data-id="heading-14">2.  ç›¸ä¼¼é—®æ³•æ¶µç›–å¤šä¸ªæ„å›¾</h4>
<p>é’ˆå¯¹ç›¸ä¼¼é—®æ³•æ¶µç›–å¤šä¸ªæ„å›¾çš„æƒ…å†µï¼Œæœªæ¥å¯ä»¥å°†ç›¸ä¼¼é—®æ³•è¿›è¡Œæ‹†åˆ†å¹¶å†™å…¥å¯¹åº”æ„å›¾çš„ç›¸ä¼¼é—®æ³•ä¸­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ» Zustand ä½¿ç”¨æŒ‡å—ï¼šä» 0 åˆ°ç²¾é€šçš„æœ€å¿«è·¯çº¿]]></title>    <link>https://juejin.cn/post/7579168400990027811</link>    <guid>https://juejin.cn/post/7579168400990027811</guid>    <pubDate>2025-12-03T07:06:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579168400990027811" data-draft-id="7579165599043371023" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ» Zustand ä½¿ç”¨æŒ‡å—ï¼šä» 0 åˆ°ç²¾é€šçš„æœ€å¿«è·¯çº¿"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:06:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä½ å¿ƒé‡Œçš„äºæ™"/> <meta itemprop="url" content="https://juejin.cn/user/4485661445853943"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ» Zustand ä½¿ç”¨æŒ‡å—ï¼šä» 0 åˆ°ç²¾é€šçš„æœ€å¿«è·¯çº¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4485661445853943/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä½ å¿ƒé‡Œçš„äºæ™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:06:06.000Z" title="Wed Dec 03 2025 07:06:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><em>â€œé•¿å¾—å¯çˆ±ï¼Ÿåˆ«è¢«éª—äº†ã€‚Zustand æ˜¯ React çŠ¶æ€ç®¡ç†é‡Œå”¯ä¸€ä¸€ä¸ªåˆå°ã€åˆç‹ ã€åˆå¿«çš„å°ç†Šã€‚â€</em></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8332cafd4e0e43c1a6facf5920d6aca5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5b-D6YeM55qE5LqO5pmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765350365&amp;x-signature=vzSE21oiGh%2FAep56le48r2POuBg%3D" alt="image.png" loading="lazy"/>
React é¡¹ç›®ä¸­ï¼Œå¦‚æœä½ è§‰å¾— Redux å¤ªâ€œä»ªå¼åŒ–â€ã€Recoil å¤ªâ€œè„‘æ´â€ã€MobX å¤ªâ€œé­”æ³•â€â€¦<br/>
é‚£ä½ å¤§æ¦‚ç‡ä¼šçˆ±ä¸Š <strong>Zustand</strong>ã€‚</p>
<h4 data-id="heading-0">âœ” â€œä½ éœ€è¦å¤šå°‘çŠ¶æ€ç®¡ç†ï¼Œå°±ç»™ä½ å¤šå°‘ï¼Œä¸å¤šä¸å°‘â€ã€‚</h4>
<h3 data-id="heading-1">ä¸€ã€åˆå§‹åŒ–é¡¹ç›®ï¼ˆæœ€ç®€ + æœ€ç°ä»£æ ˆï¼‰</h3>
<pre><code class="hljs language-perl" lang="perl">npm create vite@latest
<span class="hljs-comment"># é€‰æ‹© react-ts æ¨¡æ¿</span>
</code></pre>
<p>å®‰è£… react-router-domï¼ˆv7ï¼‰ã€tailwindcssã€Ant Designï¼š</p>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> react-router-dom
npm install tailwindcss <span class="hljs-keyword">@tailwindcss</span>/vite
npm install antd
</code></pre>
<h4 data-id="heading-2">é…ç½® Tailwind</h4>
<p><code>index.css</code></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@import</span> <span class="hljs-string">"tailwindcss"</span>;
</code></pre>
<h4 data-id="heading-3">é…ç½® aliasï¼š@ â†’ src</h4>
<p><code>vite.config.ts</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">"vite"</span>;
<span class="hljs-keyword">import</span> react <span class="hljs-keyword">from</span> <span class="hljs-string">"@vitejs/plugin-react"</span>;
<span class="hljs-keyword">import</span> tailwindcss <span class="hljs-keyword">from</span> <span class="hljs-string">"@tailwindcss/vite"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">react</span>(), <span class="hljs-title function_">tailwindcss</span>()],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">"@"</span>: <span class="hljs-string">"/src"</span>,
    },
  },
});
</code></pre>
<p><code>tsconfig.app.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"./src/*"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>åˆ°æ­¤ä¸ºæ­¢ï¼Œä¸€ä¸ªç°ä»£åŒ– React å·¥ç¨‹åˆå§‹åŒ–å®Œæ¯•ã€‚</p>
<hr/>
<h2 data-id="heading-4">ğŸ» äºŒã€ä¸»è§’ç™»åœºï¼šZustand</h2>
<p>å®˜ç½‘ï¼š<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzustand.docs.pmnd.rs%2Fgetting-started%2Fintroduction" target="_blank" title="https://zustand.docs.pmnd.rs/getting-started/introduction" ref="nofollow noopener noreferrer">zustand.docs.pmnd.rs/getting-staâ€¦</a></p>
<p>Zustand çš„ç‰¹ç‚¹ï¼š</p>
<h4 data-id="heading-5">â— â€œæ¯ä¸€ä¸ª store å°±æ˜¯ä¸€ä¸ªèƒ½ç›´æ¥ä½¿ç”¨çš„ hookï¼Œä¸éœ€è¦ Providerï¼Œä¸éœ€è¦ contextï¼Œä¸éœ€è¦ boilerplateã€‚â€</h4>
<p>å®‰è£…ï¼š</p>
<pre><code class="hljs">npm install zustand
</code></pre>
<hr/>
<h2 data-id="heading-6">ä¸‰ã€åˆ›å»ºä¸€ä¸ªæœ€ç®€å•çš„ Zustand Store</h2>
<p><code>src/store/counter.ts</code></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand"</span>;

<span class="hljs-keyword">type</span> <span class="hljs-title class_">State</span> = {
  <span class="hljs-attr">bears</span>: <span class="hljs-built_in">number</span>;
};

<span class="hljs-keyword">type</span> <span class="hljs-title class_">Actions</span> = {
  <span class="hljs-attr">increasePopulation</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">removeAllBears</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
  <span class="hljs-attr">updateBears</span>: <span class="hljs-function">(<span class="hljs-params">newBears: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;
};

<span class="hljs-keyword">const</span> useCounterStore = create&lt;<span class="hljs-title class_">State</span> &amp; <span class="hljs-title class_">Actions</span>&gt;(<span class="hljs-function">(<span class="hljs-params">set</span>) =&gt;</span> ({
  <span class="hljs-attr">bears</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">increasePopulation</span>: <span class="hljs-function">() =&gt;</span>
    <span class="hljs-title function_">set</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> ({ <span class="hljs-attr">bears</span>: state.<span class="hljs-property">bears</span> + <span class="hljs-number">1</span> })),
  <span class="hljs-attr">removeAllBears</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">bears</span>: <span class="hljs-number">0</span> }),
  <span class="hljs-attr">updateBears</span>: <span class="hljs-function">(<span class="hljs-params">newBears: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title function_">set</span>({ <span class="hljs-attr">bears</span>: newBears }),
}));

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> useCounterStore;
</code></pre>
<p>ä½ æ²¡æœ‰çœ‹é”™ï¼š</p>
<h4 data-id="heading-7">âœ” ä¸€ä¸ª store å°±æ˜¯ä¸€ä¸ª hook</h4>
<h4 data-id="heading-8">âœ” å¯ä»¥éšæ—¶åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼Œä¸ç”¨ Provider</h4>
<h4 data-id="heading-9">âœ” set ä¼šè‡ªåŠ¨åˆå¹¶å¯¹è±¡ï¼Œä¸ä¼šè¦†ç›–æ•´ä¸ª state</h4>
<hr/>
<h2 data-id="heading-10">å››ã€åœ¨ç»„ä»¶ä¸­ä½¿ç”¨çŠ¶æ€</h2>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> useCounterStore <span class="hljs-keyword">from</span> <span class="hljs-string">"@/store/counter"</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">Button</span>, <span class="hljs-title class_">Space</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"antd"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Counter</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> bears = <span class="hljs-title function_">useCounterStore</span>(<span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">bears</span>);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>å½“å‰ bears æ•°é‡: {bears}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">Space</span> <span class="hljs-attr">size</span>=<span class="hljs-string">"large"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> useCounterStore.getState().increasePopulation()}
        &gt;
          å¢åŠ 
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span>
          <span class="hljs-attr">type</span>=<span class="hljs-string">"primary"</span>
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> useCounterStore.getState().removeAllBears()}
        &gt;
          é‡ç½®
        <span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">Space</span>&gt;</span>
    <span class="hljs-tag">&lt;/&gt;</span></span>
  );
}
</code></pre>
<p>æ³¨æ„ï¼š</p>
<h4 data-id="heading-11">Zustand <strong>ä¸éœ€è¦ provider</strong></h4>
<h4 data-id="heading-12"><code>useStore.getState()</code> å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä½¿ç”¨ï¼ˆäº‹ä»¶å›è°ƒ/å¼‚æ­¥é€»è¾‘/é React æ–‡ä»¶ï¼ï¼‰</h4>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/672c9d3a3c3b4eb8aa529c91e6f73629~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5b-D6YeM55qE5LqO5pmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765350365&amp;x-signature=NJvjV4OBkK0DUVCeShh0fgfRALU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-13">äº”ã€æŒä¹…åŒ–ï¼šåˆ·æ–°æµè§ˆå™¨ä¹Ÿä¸ä¸¢æ•°æ®</h2>
<p>Zustand çš„ persist ä¸­é—´ä»¶ï¼Œå¯ä»¥ç›´æ¥æŠŠæ•°æ®å­˜åˆ° localStorage / sessionStorageã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { create } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand"</span>;
<span class="hljs-keyword">import</span> { persist, createJSONStorage } <span class="hljs-keyword">from</span> <span class="hljs-string">"zustand/middleware"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> usePersistCounterStore = create&lt;{
  <span class="hljs-attr">persistCounter</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">addPersistCounter</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;
}&gt;()(
  <span class="hljs-title function_">persist</span>(
    <span class="hljs-function">(<span class="hljs-params">set, get</span>) =&gt;</span> ({
      <span class="hljs-attr">persistCounter</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">addPersistCounter</span>: <span class="hljs-function">() =&gt;</span>
        <span class="hljs-title function_">set</span>({ <span class="hljs-attr">persistCounter</span>: <span class="hljs-title function_">get</span>().<span class="hljs-property">persistCounter</span> + <span class="hljs-number">1</span> }),
    }),
    {
      <span class="hljs-attr">name</span>: <span class="hljs-string">"food-storage"</span>,
      <span class="hljs-attr">storage</span>: <span class="hljs-title function_">createJSONStorage</span>(<span class="hljs-function">() =&gt;</span> sessionStorage),
    }
  )
);
</code></pre>
<p>ä¸Šè¿°ä»“åº“æ•°æ®æºå³ä¿å­˜åœ¨sessionStorageã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f57769bddb414ef2b5134ddf7176f0b4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5b-D6YeM55qE5LqO5pmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765350365&amp;x-signature=CHIj3KGDUJX5eFfVggGgjQ7NGPk%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-14">persist ä¸­é—´ä»¶èƒ½åŠ›ï¼š</h4>
<ul>
<li>è‡ªåŠ¨åºåˆ—åŒ– JSON</li>
<li>æ”¯æŒ localStorage / sessionStorage</li>
<li>æ”¯æŒè‡ªå®šä¹‰ storageï¼ˆIndexDB / è‡ªå·±å°è£…ï¼‰</li>
</ul>
<hr/>
<h2 data-id="heading-15">å…­ã€æ¥å…¥ Devtoolsï¼šå¯è§†åŒ–æŸ¥çœ‹ Zustand çŠ¶æ€ï¼ˆå¼ºæ¨ï¼‰</h2>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> { devtools } from <span class="hljs-string">"zustand/middleware"</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> usePersistCounterStore = create&lt;{
  persistCounter: number;
  addPersistCounter: () =&gt; <span class="hljs-keyword">void</span>;
}&gt;()(
  devtools(
    persist(
      (<span class="hljs-keyword">set</span>, <span class="hljs-keyword">get</span>) =&gt; ({
        persistCounter: <span class="hljs-number">0</span>,
        addPersistCounter: () =&gt;
          <span class="hljs-keyword">set</span>({ persistCounter: <span class="hljs-keyword">get</span>().persistCounter + <span class="hljs-number">1</span> }),
      }),
      {
        name: <span class="hljs-string">"food-storage"</span>,
        storage: createJSONStorage(() =&gt; sessionStorage),
      }
    )
  )
);
</code></pre>
<p>å®‰è£… Redux Devtools æ’ä»¶å³å¯ç›´æ¥çœ‹åˆ° Zustand çŠ¶æ€å˜åŒ–ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/18dc1512bc8c4536813e2aec8d942921~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5L2g5b-D6YeM55qE5LqO5pmP:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765350365&amp;x-signature=04hkJ5eJrRY95hi2mKlLPczic1E%3D" alt="image.png" loading="lazy"/></p>
<hr/>
<h2 data-id="heading-16">ä¸ƒã€subscribe-with-selectorï¼šç²¾ç¡®è®¢é˜…ï¼ˆæ€§èƒ½ç¥å™¨ï¼‰</h2>
<p>Zustand é»˜è®¤æŒ‰ selector è¿”å›å€¼å˜åŒ–è§¦å‘æ¸²æŸ“ã€‚<br/>
å¦‚æœä½ æƒ³åœ¨ç»„ä»¶å¤–è®¢é˜…å˜åŒ–ï¼ˆæ¯”å¦‚ WebSocket æ›´æ–° / å®šæ—¶å™¨ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ <code>subscribeWithSelector</code> ä¸­é—´ä»¶ã€‚</p>
<p>ğŸ”¥ å®˜ç½‘æ¨èå†™å¤§å‹é¡¹ç›®å¿…é¡»é…è¿™ä¸ªã€‚</p>
<p>æ–‡æ¡£ï¼š<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fzustand.docs.pmnd.rs%2Fmiddlewares%2Fsubscribe-with-selector" target="_blank" title="https://zustand.docs.pmnd.rs/middlewares/subscribe-with-selector" ref="nofollow noopener noreferrer">zustand.docs.pmnd.rs/middlewaresâ€¦</a></p>
<hr/>
<h2 data-id="heading-17">âš” å…«ã€ä¸ºä»€ä¹ˆ Zustand è¢«ç§°ä¸ºå°ä½“ç§¯å´â€œæœ‰çˆªå­â€ï¼Ÿ</h2>
<p>å®ƒè§£å†³äº† React çŠ¶æ€ç®¡ç†çš„ä¸‰å¤§å™©æ¢¦ï¼š</p>
<h4 data-id="heading-18">âŒ åƒµå°¸å­ç»„ä»¶ï¼ˆZombie Childï¼‰</h4>
<h4 data-id="heading-19">âŒ React 18 æ›´æ–°ä¸¢å¤±</h4>
<h4 data-id="heading-20">âŒ å¤šæ¸²æŸ“å™¨ï¼ˆå¦‚ React Nativeï¼‰ä¸Šä¸‹æ–‡é”™ä¹±</h4>
<p>Zustand å†…éƒ¨ä½¿ç”¨ Proxy + è®¢é˜…æœºåˆ¶ï¼Œå®Œå…¨é¿å¼€äº†è¿™äº›é—®é¢˜ã€‚</p>
<hr/>
<h2 data-id="heading-21">ä¹ã€Redux vs Zustand ç®€è¦å¯¹æ¯”</h2>








































<table><thead><tr><th>ç‰¹æ€§</th><th>Redux Toolkit</th><th>Zustand</th></tr></thead><tbody><tr><td>å­¦ä¹ æ›²çº¿</td><td>æœ‰è®¾è®¡ç†å¿µï¼Œç•¥é‡</td><td>æå¿«ï¼Œå‡ åˆ†é’Ÿä¸Šæ‰‹</td></tr><tr><td>æ ¸å¿ƒæ€æƒ³</td><td>Flux å•å‘æ•°æ®æµ</td><td>Hooks + minimal store</td></tr><tr><td>éœ€è¦ Provider</td><td>âœ” å¿…é¡»</td><td>âŒ ä¸éœ€è¦</td></tr><tr><td>æŒä¹…åŒ–</td><td>éœ€è¦æ’ä»¶</td><td>å†…ç½®ä¸­é—´ä»¶</td></tr><tr><td>Devtools</td><td>å®˜æ–¹æ”¯æŒ</td><td>âœ” ç›´æ¥å…¼å®¹</td></tr><tr><td>é€‚åˆè§„æ¨¡</td><td>ä¸­å¤§å‹å¤æ‚ä¸šåŠ¡</td><td>ä¸­å°ä¸šåŠ¡ + å¤§å‹é«˜æ€§èƒ½é¡¹ç›®</td></tr></tbody></table>
<h4 data-id="heading-22">ç»“è®ºï¼š</h4>
<blockquote>
<p><strong>Zustand ç”¨æœ€å°‘çš„ API åšäº†æœ€å¼ºçš„çŠ¶æ€ç®¡ç†ï¼Œæ˜¯ç›®å‰ React åº”ç”¨é‡Œæœ€å¥½ç”¨çš„è½»é‡çº§å…¨å±€çŠ¶æ€æ–¹æ¡ˆï¼Œæ²¡æœ‰ä¹‹ä¸€ã€‚</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-23">ğŸ åã€æ€»ç»“ï¼šä¸ºä»€ä¹ˆä½ åº”è¯¥åœ¨æ–°é¡¹ç›®é‡Œé€‰ Zustandï¼Ÿ</h2>
<ul>
<li>æ—  Providerã€æ— æ ·æ¿ä»£ç ã€æ— å¤æ‚å¿ƒæ™ºè´Ÿæ‹…</li>
<li>é€»è¾‘å¯ä»¥å†™åœ¨ React å¤–</li>
<li>æè½»é‡ï¼ˆâ‰ˆ1KBï¼‰ï¼Œæ€§èƒ½æå¼º</li>
<li>å®˜æ–¹ä¸­é—´ä»¶å·²ç»è¦†ç›–å¤§éƒ¨åˆ†éœ€æ±‚ï¼ˆpersist / devtools / immer / subscribe-with-selectorï¼‰</li>
<li>å®Œç¾å…¼å®¹ React 18ã€React Nativeã€SSR</li>
<li>å†™èµ·æ¥åƒ useStateï¼Œå´æ˜¯å…¨å±€ store</li>
</ul>
<h4 data-id="heading-24"><strong>ä»£ç å†™èµ·æ¥çˆ½å°±å®Œäº‹äº†</strong>ã€‚</h4>
<h4 data-id="heading-25">å»¶ä¼¸é˜…è¯»</h4>
<ul>
<li>zustand å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fzustand.docs.pmnd.rs%2F" target="_blank" title="https://zustand.docs.pmnd.rs/" ref="nofollow noopener noreferrer">zustand.docs.pmnd.rs/</a></li>
<li>ä¸ªäººdemoåœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fsue-boy%2Fvite-react-zustand" target="_blank" title="https://gitee.com/sue-boy/vite-react-zustand" ref="nofollow noopener noreferrer">gitee.com/sue-boy/vitâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Python æ•°æ®åˆ†æå®æˆ˜ï¼šå¤šåœºæ™¯æ•°æ®å¤„ç†ä¸å¯è§†åŒ–å…¨è§£æ]]></title>    <link>https://juejin.cn/post/7579179741824991258</link>    <guid>https://juejin.cn/post/7579179741824991258</guid>    <pubDate>2025-12-03T06:27:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741824991258" data-draft-id="7578699975414710272" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Python æ•°æ®åˆ†æå®æˆ˜ï¼šå¤šåœºæ™¯æ•°æ®å¤„ç†ä¸å¯è§†åŒ–å…¨è§£æ"/> <meta itemprop="keywords" content="Python,PyCharm,ç¼–ç¨‹è¯­è¨€"/> <meta itemprop="datePublished" content="2025-12-03T06:27:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä»Šå¤©æ²¡æœ‰ç›"/> <meta itemprop="url" content="https://juejin.cn/user/1408937846645355"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Python æ•°æ®åˆ†æå®æˆ˜ï¼šå¤šåœºæ™¯æ•°æ®å¤„ç†ä¸å¯è§†åŒ–å…¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1408937846645355/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä»Šå¤©æ²¡æœ‰ç›
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:27:13.000Z" title="Wed Dec 03 2025 06:27:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"/>
<p>åœ¨æ•°æ®é©±åŠ¨çš„æ—¶ä»£ï¼ŒæŒæ¡æ•°æ®åˆ†ææŠ€èƒ½è‡³å…³é‡è¦ã€‚æœ¬æ–‡å°†å¸¦ä½ ä½¿ç”¨ Python ä¸­çš„ pandasã€numpy å’Œ matplotlib åº“ï¼Œå¯¹åœ°é“å®¢æµã€ç½‘çº¦è½¦è®¢å•ã€ä½“æ£€ä¸­å¿ƒå¥åº·å’Œå¥èº«æˆ¿è¿åŠ¨å››ç±»çœŸå®åœºæ™¯çš„æ•°æ®è¿›è¡Œå®Œæ•´åˆ†æã€‚æ¯ä¸ªæ¡ˆä¾‹éƒ½åŒ…å«æ•°æ®æ¸…æ´—ã€ç»Ÿè®¡è®¡ç®—ã€å¯è§†åŒ–å‘ˆç°å’Œç»“æœè§£è¯»ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€åœ°é“å®¢æµæ•°æ®åˆ†æ</h3>
<h4 data-id="heading-2">ä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment"># 1. è¯»å– CSV æ–‡ä»¶æ•°æ®ï¼Œè®¡ç®—æ¯ä¸ªç«™ç‚¹çš„æ€»å®¢æµï¼ˆè¿›ç«™äººæ•° + å‡ºç«™äººæ•°ï¼‰ï¼Œæ·»åŠ ä¸ºæ–°åˆ—ã€‚</span>
df = pd.read_csv(<span class="hljs-string">"åœ°é“å®¢æµæ•°æ®.csv"</span>)
df[<span class="hljs-string">'æ€»å®¢æµ'</span>] = df[<span class="hljs-string">'è¿›ç«™äººæ•°'</span>] + df[<span class="hljs-string">'å‡ºç«™äººæ•°'</span>]
<span class="hljs-built_in">print</span>(df)
total = df.groupby(<span class="hljs-string">'ç«™ç‚¹åç§°'</span>)[<span class="hljs-string">'æ€»å®¢æµ'</span>].<span class="hljs-built_in">sum</span>()
<span class="hljs-built_in">print</span>(total)

<span class="hljs-comment"># 2. æŒ‰ â€œçº¿è·¯â€ å’Œ â€œæ—¶æ®µâ€ åŒé‡åˆ†ç»„ï¼Œç»Ÿè®¡ä¸åŒçº¿è·¯ã€ä¸åŒæ—¶æ®µçš„å¹³å‡è¿›ç«™äººæ•°ã€‚</span>
avg_in = df.groupby([<span class="hljs-string">'çº¿è·¯'</span>, <span class="hljs-string">'æ—¶æ®µ (æ—©é«˜å³°/å¹³å³°/æ™šé«˜å³°)'</span>])[<span class="hljs-string">'è¿›ç«™äººæ•°'</span>].mean()
<span class="hljs-built_in">print</span>(avg_in)

<span class="hljs-comment"># 3. æå– â€œæ—¥æœŸâ€ ä¸­çš„æœˆä»½ï¼Œç»Ÿè®¡æ¯æœˆçš„æ€»å®¢æµï¼ˆæ‰€æœ‰ç«™ç‚¹è¿›å‡ºç«™ä¹‹å’Œï¼‰ï¼Œç»˜åˆ¶æŸ±çŠ¶å›¾ã€‚</span>
df[<span class="hljs-string">'æ—¥æœŸ'</span>] = pd.to_datetime(df[<span class="hljs-string">'æ—¥æœŸ'</span>]) <span class="hljs-comment"># å­—ç¬¦ä¸²è½¬æ¢ä¸ºdatetime</span>
df[<span class="hljs-string">'æœˆä»½'</span>] = df[<span class="hljs-string">'æ—¥æœŸ'</span>].dt.month
total_month = df.groupby(<span class="hljs-string">'æœˆä»½'</span>)[<span class="hljs-string">'æ€»å®¢æµ'</span>].<span class="hljs-built_in">sum</span>()
plt.bar(total_month.index, total_month)
plt.show()

<span class="hljs-comment"># 4. è®¡ç®—æ¯ä¸ªç«™ç‚¹è¿›ç«™äººæ•°ä¸å‡ºç«™äººæ•°çš„ç›¸å…³ç³»æ•°ã€‚</span>
station = df.groupby(<span class="hljs-string">'ç«™ç‚¹åç§°'</span>).agg({
    <span class="hljs-string">'è¿›ç«™äººæ•°'</span>:<span class="hljs-string">'sum'</span>,
    <span class="hljs-string">'å‡ºç«™äººæ•°'</span>:<span class="hljs-string">'sum'</span>
}).sort_index()
<span class="hljs-built_in">print</span>(station)
corr = station[<span class="hljs-string">'è¿›ç«™äººæ•°'</span>].corr(station[<span class="hljs-string">'å‡ºç«™äººæ•°'</span>])
<span class="hljs-built_in">print</span>(corr)

<span class="hljs-comment"># 5. ç­›é€‰å‡ºæ€»å®¢æµå‰ 10 çš„ç«™ç‚¹ï¼Œç»˜åˆ¶æ°´å¹³æŸ±çŠ¶å›¾å±•ç¤ºç»“æœã€‚</span>
plt.rcParams[<span class="hljs-string">'font.sans-serif'</span>] = [<span class="hljs-string">'SimHei'</span>] <span class="hljs-comment"># é»‘ä½“</span>
total = total.sort_values(ascending=<span class="hljs-literal">False</span>) <span class="hljs-comment"># é™åºæ’åº</span>
top10 = total[:<span class="hljs-number">10</span>]
<span class="hljs-built_in">print</span>(top10)
plt.bar(top10.index, top10)
plt.show()
</code></pre>
<h4 data-id="heading-3">ä»£ç ç»“æœ</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/706abbe35f3e4062913bb796339bab48~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348032&amp;x-signature=RlZwkgwblWR%2B76NaRv4s9FiY1sg%3D" alt="1101.png" loading="lazy"/></p>
<h4 data-id="heading-4">ä»£ç åˆ†æ</h4>
<ul>
<li><strong>æ•°æ®é¢„å¤„ç†</strong>ï¼šä½¿ç”¨ <code>pd.read_csv</code> è¯»å–æ•°æ®ï¼Œé€šè¿‡åˆ—è¿ç®—æ·»åŠ â€œæ€»å®¢æµâ€åˆ—ã€‚</li>
<li><strong>åˆ†ç»„ç»Ÿè®¡</strong>ï¼šåˆ©ç”¨ <code>groupby</code> å®ç°å•åˆ†ç»„å’ŒåŒé‡åˆ†ç»„ç»Ÿè®¡ï¼Œç»“åˆ <code>sum()</code>ã€<code>mean()</code> å®Œæˆèšåˆè®¡ç®—ã€‚</li>
<li><strong>æ—¶é—´å¤„ç†</strong>ï¼šé€šè¿‡ <code>pd.to_datetime</code> è½¬æ¢æ—¥æœŸæ ¼å¼ï¼Œæå–æœˆä»½è¿›è¡Œæœˆåº¦ç»Ÿè®¡ã€‚</li>
<li><strong>ç›¸å…³æ€§åˆ†æ</strong>ï¼šå…ˆæŒ‰ç«™ç‚¹èšåˆè¿›å‡ºç«™äººæ•°ï¼Œå†ä½¿ç”¨ <code>corr()</code> è®¡ç®—ç›¸å…³ç³»æ•°ã€‚</li>
<li><strong>å¯è§†åŒ–</strong>ï¼šä½¿ç”¨ <code>plt.bar</code> ç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œå¹¶è®¾ç½®ä¸­æ–‡å­—ä½“é˜²æ­¢ä¹±ç ã€‚</li>
<li><strong>æ•°æ®ç­›é€‰</strong>ï¼šé€šè¿‡ <code>sort_values</code> å’Œåˆ‡ç‰‡è·å– Top10 æ•°æ®ã€‚</li>
</ul>
<h3 data-id="heading-5">äºŒã€ç½‘çº¦è½¦è®¢å•æ•°æ®åˆ†æ</h3>
<h4 data-id="heading-6">ä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. è¯»å– CSV æ–‡ä»¶æ•°æ®ï¼Œè®¡ç®—è®¢å•æ€»è´¹ç”¨ï¼ˆèµ·æ­¥ä»· + è¡Œç¨‹è·ç¦» Ã— é‡Œç¨‹è´¹ + é™„åŠ è´¹ï¼‰ï¼Œæ·»åŠ ä¸ºæ–°åˆ—ã€‚</span>
data = pd.read_csv(
    <span class="hljs-string">"ç½‘çº¦è½¦è®¢å•æ•°æ®.csv"</span>,
    index_col=<span class="hljs-string">"è®¢å•ID"</span>
)
data[<span class="hljs-string">'è®¢å•é‡'</span>] = [<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data.shape[<span class="hljs-number">0</span>])]
data[<span class="hljs-string">'æ€»è´¹ç”¨'</span>] = data[<span class="hljs-string">'èµ·æ­¥ä»· (å…ƒ)'</span>] + data[<span class="hljs-string">'è¡Œç¨‹è·ç¦» (km)'</span>]*data[<span class="hljs-string">'é‡Œç¨‹è´¹ (å…ƒ/km)'</span>] + data[<span class="hljs-string">'é™„åŠ è´¹ (å…ƒ)'</span>]
<span class="hljs-built_in">print</span>(data)

<span class="hljs-comment"># 2. æŒ‰ â€œå‡ºå‘æ—¶é—´â€ æå–å°æ—¶ä¿¡æ¯ï¼Œç»Ÿè®¡å„å°æ—¶çš„è®¢å•é‡å’Œå¹³å‡è¡Œç¨‹è·ç¦»ã€‚</span>
data[<span class="hljs-string">'å‡ºå‘æ—¶é—´'</span>] = pd.to_datetime(data[<span class="hljs-string">'å‡ºå‘æ—¶é—´'</span>])
data[<span class="hljs-string">'å°æ—¶'</span>] = data[<span class="hljs-string">'å‡ºå‘æ—¶é—´'</span>].dt.hour
state = data.groupby(<span class="hljs-string">'å°æ—¶'</span>).agg({
    <span class="hljs-string">'è®¢å•é‡'</span>:<span class="hljs-string">'sum'</span>,
    <span class="hljs-string">'è¡Œç¨‹è·ç¦» (km)'</span>:<span class="hljs-string">'mean'</span>
})
<span class="hljs-built_in">print</span>(state)

<span class="hljs-comment"># 3. è®¡ç®—æ€»è´¹ç”¨çš„æœ€å¤§å€¼ã€æœ€å°å€¼ã€å‡å€¼å’Œæ ‡å‡†å·®ã€‚</span>
total_sales_state = data[<span class="hljs-string">'æ€»è´¹ç”¨'</span>].agg([<span class="hljs-string">'max'</span>, <span class="hljs-string">'min'</span>, <span class="hljs-string">'mean'</span>, <span class="hljs-string">'std'</span>])
<span class="hljs-built_in">print</span>(total_sales_state)

<span class="hljs-comment"># 4. æŒ‰è¡Œç¨‹è·ç¦»åˆ†ç»„ï¼ˆ0-5kmã€5-10kmã€10km+ï¼‰ï¼Œç»Ÿè®¡æ¯ç»„çš„è®¢å•æ•°å’Œå¹³å‡æ€»è´¹ç”¨ï¼Œç»˜åˆ¶æŸ±çŠ¶å›¾ã€‚</span>
data_taxi = data.groupby(<span class="hljs-string">'è¡Œç¨‹è·ç¦» (km)'</span>).agg({
    <span class="hljs-string">'è®¢å•é‡'</span>:<span class="hljs-string">'sum'</span>,
    <span class="hljs-string">'æ€»è´¹ç”¨'</span>:<span class="hljs-string">'mean'</span>
})
plt.bar(data_taxi.index, data_taxi[<span class="hljs-string">'è®¢å•é‡'</span>])
plt.show()
plt.bar(data_taxi.index, data_taxi[<span class="hljs-string">'æ€»è´¹ç”¨'</span>])
plt.show()

<span class="hljs-comment"># 5. ä¿å­˜è¡Œç¨‹è·ç¦» â‰¥10km çš„è®¢å•æ•°æ®ä¸º â€œé•¿é€”è®¢å•.csvâ€ï¼ˆä¸å«ç´¢å¼•ï¼‰ã€‚</span>
new_data = data[data[<span class="hljs-string">'è¡Œç¨‹è·ç¦» (km)'</span>] &gt;= <span class="hljs-number">10</span>]
<span class="hljs-built_in">print</span>(new_data)
new_data.to_csv(<span class="hljs-string">"é•¿é€”è®¢å•.csv"</span>)
</code></pre>
<h4 data-id="heading-7">ä»£ç ç»“æœ</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93ecb92a99ef4b169a67397396a29718~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348032&amp;x-signature=Sn8Fz5QFBzH7VP0A5erO1%2BisCd8%3D" alt="1102.png" loading="lazy"/></p>
<h4 data-id="heading-8">ä»£ç åˆ†æ</h4>
<ul>
<li><strong>è´¹ç”¨è®¡ç®—</strong>ï¼šé€šè¿‡åˆ—è¿ç®—å®ç°æ€»è´¹ç”¨å…¬å¼ï¼Œæ³¨æ„å•ä½ä¸ºå…ƒã€‚</li>
<li><strong>æ—¶é—´æå–</strong>ï¼šä½¿ç”¨ <code>dt.hour</code> æå–å°æ—¶ä¿¡æ¯ï¼Œä¾¿äºæŒ‰å°æ—¶èšåˆã€‚</li>
<li><strong>å¤šæŒ‡æ ‡èšåˆ</strong>ï¼šåœ¨ <code>groupby</code> åä½¿ç”¨ <code>agg</code> åŒæ—¶è®¡ç®—å¤šä¸ªç»Ÿè®¡é‡ã€‚</li>
<li><strong>åˆ†ç»„ç»Ÿè®¡</strong>ï¼šç›´æ¥æŒ‰æ•°å€¼åˆ—åˆ†ç»„ï¼Œä½†æ›´ä½³åšæ³•æ˜¯ä½¿ç”¨ <code>pd.cut</code> è¿›è¡ŒåŒºé—´åˆ†ç»„ã€‚</li>
<li><strong>æ•°æ®ç­›é€‰ä¸å¯¼å‡º</strong>ï¼šä½¿ç”¨å¸ƒå°”ç´¢å¼•ç­›é€‰é•¿é€”è®¢å•ï¼Œ<code>to_csv</code> å¯¼å‡ºæ—¶è®¾ç½® <code>index=False</code> å¯çœç•¥ç´¢å¼•ã€‚</li>
</ul>
<h3 data-id="heading-9">ä¸‰ã€ä½“æ£€ä¸­å¿ƒå¥åº·æ•°æ®åˆ†æ</h3>
<h4 data-id="heading-10">ä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. è¯»å– CSV æ–‡ä»¶æ•°æ®ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºé«˜è¡€å‹ï¼ˆæ”¶ç¼©å‹ â‰¥140 æˆ–èˆ’å¼ å‹ â‰¥90ï¼‰ï¼Œæ·»åŠ  â€œæ˜¯å¦é«˜è¡€å‹â€ åˆ—ï¼ˆæ˜¯ / å¦ï¼‰ã€‚</span>
df = pd.read_csv(
    <span class="hljs-string">"ä½“æ£€æ•°æ®.csv"</span>,
    index_col=<span class="hljs-string">"ä½“æ£€ç¼–å·"</span>
)
df[<span class="hljs-string">'æ˜¯å¦é«˜è¡€å‹'</span>] = np.where((df[<span class="hljs-string">'æ”¶ç¼©å‹ (mmHg)'</span>]&gt;=<span class="hljs-number">140</span>)|(df[<span class="hljs-string">'èˆ’å¼ å‹ (mmHg)'</span>] &gt;= <span class="hljs-number">90</span>), <span class="hljs-string">'æ˜¯'</span>, <span class="hljs-string">'å¦'</span>)
<span class="hljs-built_in">print</span>(df)

<span class="hljs-comment"># 2. æŒ‰ â€œæ€§åˆ«â€ å’Œ â€œå¹´é¾„åˆ†ç»„â€ï¼ˆ18-30ã€31-50ã€50+ï¼‰åŒé‡åˆ†ç»„ï¼Œç»Ÿè®¡æ¯ç»„çš„é«˜è¡€å‹æ¯”ä¾‹ã€‚</span>
df[<span class="hljs-string">'å¹´é¾„åˆ†ç»„'</span>] = pd.cut(
    df[<span class="hljs-string">'å¹´é¾„'</span>],
    bins=[<span class="hljs-number">17</span>, <span class="hljs-number">30</span>, <span class="hljs-number">50</span>, np.inf],
    labels=[<span class="hljs-string">'18-30'</span>, <span class="hljs-string">'31-50'</span>, <span class="hljs-string">'50+'</span>],
    right=<span class="hljs-literal">False</span>
)
<span class="hljs-built_in">print</span>(df)
state = df.groupby([<span class="hljs-string">'æ€§åˆ«'</span>, <span class="hljs-string">'å¹´é¾„åˆ†ç»„'</span>])[<span class="hljs-string">'æ˜¯å¦é«˜è¡€å‹'</span>].apply(<span class="hljs-keyword">lambda</span> x:(x == <span class="hljs-string">'æ˜¯'</span>).mean()).reset_index()
state[<span class="hljs-string">'é«˜è¡€å‹æ¯”ä¾‹'</span>] = state[<span class="hljs-string">'æ˜¯å¦é«˜è¡€å‹'</span>].<span class="hljs-built_in">round</span>(<span class="hljs-number">3</span>) * <span class="hljs-number">100</span>
<span class="hljs-built_in">print</span>(state)

<span class="hljs-comment"># 3. è®¡ç®—ç©ºè…¹è¡€ç³–ä¸èƒ†å›ºé†‡çš„ç›¸å…³ç³»æ•°ã€‚</span>
corr = df[<span class="hljs-string">'ç©ºè…¹è¡€ç³– (mmol/L)'</span>].corr(df[<span class="hljs-string">'èƒ†å›ºé†‡ (mmol/L)'</span>])
<span class="hljs-built_in">print</span>(corr)

<span class="hljs-comment"># 4. æŒ‰æ€§åˆ«åˆ†ç»„ï¼Œç»Ÿè®¡æ”¶ç¼©å‹ã€èˆ’å¼ å‹ã€ç©ºè…¹è¡€ç³–çš„å‡å€¼å’Œæ–¹å·®ï¼ˆä½¿ç”¨ agg å‡½æ•°ï¼‰ã€‚</span>
df_mean = df.groupby(<span class="hljs-string">'æ€§åˆ«'</span>).agg({
    <span class="hljs-string">'æ”¶ç¼©å‹ (mmHg)'</span>:<span class="hljs-string">'mean'</span>,
    <span class="hljs-string">'èˆ’å¼ å‹ (mmHg)'</span>:<span class="hljs-string">'mean'</span>,
    <span class="hljs-string">'ç©ºè…¹è¡€ç³– (mmol/L)'</span>:<span class="hljs-string">'mean'</span>
})
<span class="hljs-built_in">print</span>(df_mean)
df_var = df.groupby(<span class="hljs-string">'æ€§åˆ«'</span>).agg({
    <span class="hljs-string">'æ”¶ç¼©å‹ (mmHg)'</span>:<span class="hljs-string">'var'</span>,
    <span class="hljs-string">'èˆ’å¼ å‹ (mmHg)'</span>:<span class="hljs-string">'var'</span>,
    <span class="hljs-string">'ç©ºè…¹è¡€ç³– (mmol/L)'</span>:<span class="hljs-string">'var'</span>
})
<span class="hljs-built_in">print</span>(df_var)

<span class="hljs-comment"># 5. ç»˜åˆ¶ç”·æ€§å’Œå¥³æ€§çš„å¹³å‡æ”¶ç¼©å‹å¯¹æ¯”æŸ±çŠ¶å›¾ã€‚</span>
plt.bar(df_mean.index, df_mean[<span class="hljs-string">'æ”¶ç¼©å‹ (mmHg)'</span>])
plt.show()
</code></pre>
<h4 data-id="heading-11">ä»£ç ç»“æœ</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3325c8880f7346969a054d67ada68ca3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348032&amp;x-signature=a6eCPIMiHxvOHFQ%2BYZinVMXN2eo%3D" alt="1103.png" loading="lazy"/></p>
<h4 data-id="heading-12">ä»£ç åˆ†æ</h4>
<ul>
<li><strong>æ¡ä»¶åˆ¤æ–­åˆ—</strong>ï¼šä½¿ç”¨ <code>np.where</code> å®ç°æ¡ä»¶åˆ¤æ–­ï¼Œç”Ÿæˆåˆ†ç±»åˆ—ã€‚</li>
<li><strong>åŒºé—´åˆ†ç»„</strong>ï¼š<code>pd.cut</code> å¯å°†è¿ç»­å¹´é¾„ç¦»æ•£åŒ–ä¸ºå¹´é¾„æ®µï¼Œ<code>right=False</code> è¡¨ç¤ºå·¦é—­å³å¼€ã€‚</li>
<li><strong>æ¯”ä¾‹è®¡ç®—</strong>ï¼šåœ¨ <code>groupby</code> åä½¿ç”¨ <code>apply</code> ç»“åˆ lambda å‡½æ•°è®¡ç®—é«˜è¡€å‹æ¯”ä¾‹ã€‚</li>
<li><strong>å¤šå‡½æ•°èšåˆ</strong>ï¼š<code>agg</code> å¯åŒæ—¶æŒ‡å®šå¤šä¸ªç»Ÿè®¡å‡½æ•°ï¼Œä¹Ÿå¯åˆ†åˆ«è®¡ç®—å‡å€¼å’Œæ–¹å·®ã€‚</li>
<li><strong>ç®€å•å¯è§†åŒ–</strong>ï¼šç›´æ¥ä½¿ç”¨åˆ†ç»„èšåˆç»“æœç»˜åˆ¶æŸ±çŠ¶å›¾ï¼Œç›´è§‚å¯¹æ¯”æ€§åˆ«å·®å¼‚ã€‚</li>
</ul>
<h3 data-id="heading-13">å››ã€å¥èº«æˆ¿è¿åŠ¨æ•°æ®åˆ†æ</h3>
<h4 data-id="heading-14">ä»£ç </h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

<span class="hljs-comment"># 1. è¯»å– CSV æ–‡ä»¶æ•°æ®ï¼Œå°† â€œè¿åŠ¨æ—¥æœŸâ€ è½¬æ¢ä¸º datetime æ ¼å¼ã€‚</span>
data = pd.read_csv(
    <span class="hljs-string">"å¥èº«æˆ¿æ•°æ®.csv"</span>,
    index_col=<span class="hljs-string">"ç”¨æˆ·ID"</span>
)
data[<span class="hljs-string">'è¿åŠ¨æ—¥æœŸ'</span>] = pd.to_datetime(data[<span class="hljs-string">'è¿åŠ¨æ—¥æœŸ'</span>])
<span class="hljs-built_in">print</span>(data)

<span class="hljs-comment"># 2. æŒ‰ â€œè¿åŠ¨ç±»å‹â€ åˆ†ç»„ï¼Œç»Ÿè®¡å¹³å‡è¿åŠ¨æ—¶é•¿ã€å¹³å‡æ¶ˆè€—çƒ­é‡å’Œç”¨æˆ·æ•°ã€‚</span>
data[<span class="hljs-string">'ç”¨æˆ·ä¸ªæ•°'</span>] = [<span class="hljs-number">1</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(data.shape[<span class="hljs-number">0</span>])]
state = data.groupby(<span class="hljs-string">'è¿åŠ¨ç±»å‹ (æœ‰æ°§/åŠ›é‡/ç»¼åˆ)'</span>).agg({
    <span class="hljs-string">'è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)'</span>:<span class="hljs-string">'mean'</span>,
    <span class="hljs-string">'æ¶ˆè€—çƒ­é‡ (å¤§å¡)'</span>:<span class="hljs-string">'mean'</span>,
    <span class="hljs-string">'ç”¨æˆ·ä¸ªæ•°'</span>:<span class="hljs-string">'sum'</span>
})
<span class="hljs-built_in">print</span>(state)

<span class="hljs-comment"># 3. æå– â€œè¿åŠ¨æ—¥æœŸâ€ ä¸­çš„æœˆä»½ï¼Œç»Ÿè®¡æ¯æœˆçš„æ€»è¿åŠ¨æ—¶é•¿ï¼Œç»˜åˆ¶æŠ˜çº¿å›¾ã€‚</span>
data[<span class="hljs-string">'æœˆä»½'</span>] = data[<span class="hljs-string">'è¿åŠ¨æ—¥æœŸ'</span>].dt.month
month_day = data.groupby(<span class="hljs-string">'æœˆä»½'</span>)[<span class="hljs-string">'è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)'</span>].<span class="hljs-built_in">sum</span>()
plt.plot(month_day.index, month_day)
plt.show()

<span class="hljs-comment"># 4. è®¡ç®—è¿åŠ¨æ—¶é•¿ä¸æ¶ˆè€—çƒ­é‡çš„ç›¸å…³ç³»æ•°ã€‚</span>
corr = data[<span class="hljs-string">'è¿åŠ¨æ—¶é•¿ (åˆ†é’Ÿ)'</span>].corr(data[<span class="hljs-string">'æ¶ˆè€—çƒ­é‡ (å¤§å¡)'</span>])
<span class="hljs-built_in">print</span>(corr)

<span class="hljs-comment"># 5. ç­›é€‰å‡ºæ¶ˆè€—çƒ­é‡ â‰¥500 å¤§å¡çš„è®°å½•ï¼Œä¿å­˜ä¸º â€œé«˜å¼ºåº¦è¿åŠ¨è®°å½•.csvâ€ï¼ˆä¸å«ç´¢å¼•ï¼‰ã€‚</span>
new_Data = data[data[<span class="hljs-string">'æ¶ˆè€—çƒ­é‡ (å¤§å¡)'</span>] &gt;= <span class="hljs-number">500</span>]
<span class="hljs-built_in">print</span>(new_Data)
new_Data.to_csv(<span class="hljs-string">'é«˜å¼ºåº¦è¿åŠ¨è®°å½•.csv'</span>)
</code></pre>
<h4 data-id="heading-15">ä»£ç ç»“æœ</h4>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb1fb18ec90b4378b952d5371448ca5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LuK5aSp5rKh5pyJ55uQ:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348032&amp;x-signature=U37tBMZYN2loa3lwTjE4qewuWYU%3D" alt="1104.png" loading="lazy"/></p>
<h4 data-id="heading-16">ä»£ç åˆ†æ</h4>
<ul>
<li><strong>æ—¥æœŸå¤„ç†</strong>ï¼š<code>pd.to_datetime</code> å°†å­—ç¬¦ä¸²è½¬ä¸ºæ—¶é—´æ ¼å¼ï¼Œä¾¿äºæå–æœˆä»½ã€‚</li>
<li><strong>ç”¨æˆ·è®¡æ•°</strong>ï¼šé€šè¿‡æ·»åŠ å€¼ä¸º1çš„åˆ—å®ç°è®¡æ•°ï¼Œä¹Ÿå¯ç›´æ¥ç”¨ <code>size()</code> ç»Ÿè®¡ã€‚</li>
<li><strong>æŠ˜çº¿å›¾é€‚ç”¨åœºæ™¯</strong>ï¼šæœˆåº¦è¶‹åŠ¿æ•°æ®é€‚åˆç”¨æŠ˜çº¿å›¾å±•ç¤ºå˜åŒ–è¶‹åŠ¿ã€‚</li>
<li><strong>ç›¸å…³æ€§åˆ†æ</strong>ï¼šç›´æ¥è®¡ç®—ä¸¤æ•°å€¼åˆ—çš„ç›¸å…³ç³»æ•°ï¼Œè¯„ä¼°çº¿æ€§å…³ç³»å¼ºåº¦ã€‚</li>
<li><strong>æ•°æ®ç­›é€‰ä¸å¯¼å‡º</strong>ï¼šç­›é€‰é«˜å¼ºåº¦è®°å½•å¹¶å¯¼å‡ºä¸º CSVï¼Œä¾¿äºåç»­åˆ†æã€‚</li>
</ul>
<h3 data-id="heading-17">æ€»ç»“</h3>
<p>é€šè¿‡è¿™å››ä¸ªå®Œæ•´çš„æ•°æ®åˆ†ææ¡ˆä¾‹ï¼Œæˆ‘ä»¬å®è·µäº†ä»¥ä¸‹æ ¸å¿ƒæŠ€èƒ½ï¼š</p>
<ol>
<li><strong>æ•°æ®è¯»å–ä¸é¢„å¤„ç†</strong>ï¼šä½¿ç”¨ pandas è¯»å– CSVã€å¤„ç†æ—¥æœŸã€æ·»åŠ è¡ç”Ÿåˆ—ã€‚</li>
<li><strong>æ•°æ®åˆ†ç»„ä¸èšåˆ</strong>ï¼šçµæ´»è¿ç”¨ <code>groupby</code> è¿›è¡Œå•ç»´åº¦ã€å¤šç»´åº¦å’Œæ¡ä»¶åˆ†ç»„ç»Ÿè®¡ã€‚</li>
<li><strong>ç»Ÿè®¡è®¡ç®—</strong>ï¼šæŒæ¡å‡å€¼ã€æ€»å’Œã€æ–¹å·®ã€ç›¸å…³ç³»æ•°ç­‰å¸¸ç”¨ç»Ÿè®¡é‡çš„è®¡ç®—ã€‚</li>
<li><strong>æ•°æ®å¯è§†åŒ–</strong>ï¼šä½¿ç”¨ matplotlib ç»˜åˆ¶æŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ï¼Œç›´è§‚å±•ç¤ºæ•°æ®åˆ†å¸ƒä¸è¶‹åŠ¿ã€‚</li>
<li><strong>æ•°æ®å¯¼å‡º</strong>ï¼šå°†å¤„ç†ç»“æœä¿å­˜ä¸ºæ–°æ–‡ä»¶ï¼Œä¾¿äºåç»­ä½¿ç”¨æˆ–åˆ†äº«ã€‚</li>
</ol>
<blockquote>
<p><strong>æç¤º</strong>ï¼šå®é™…è¿è¡Œæ—¶è¯·ç¡®ä¿ CSV æ–‡ä»¶ä¸ä»£ç åœ¨åŒä¸€ç›®å½•ï¼Œæˆ–ä½¿ç”¨å®Œæ•´æ–‡ä»¶è·¯å¾„ã€‚è‹¥ä¸­æ–‡æ˜¾ç¤ºå¼‚å¸¸ï¼Œå¯è°ƒæ•´ matplotlib å­—ä½“è®¾ç½®æˆ–ä½¿ç”¨è‹±æ–‡æ ‡ç­¾ã€‚</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€äº¤é€šæ ‡å¿—è¯†åˆ«ç³»ç»Ÿã€‘Python+TensorFlow+Django+äººå·¥æ™ºèƒ½+æ·±åº¦å­¦ä¹ +å·ç§¯ç¥ç»ç½‘ç»œç®—æ³•]]></title>    <link>https://juejin.cn/post/7579410911056920602</link>    <guid>https://juejin.cn/post/7579410911056920602</guid>    <pubDate>2025-12-03T07:17:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579410911056920602" data-draft-id="7579427549470654510" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€äº¤é€šæ ‡å¿—è¯†åˆ«ç³»ç»Ÿã€‘Python+TensorFlow+Django+äººå·¥æ™ºèƒ½+æ·±åº¦å­¦ä¹ +å·ç§¯ç¥ç»ç½‘ç»œç®—æ³•"/> <meta itemprop="keywords" content="å›¾åƒè¯†åˆ«,æ·±åº¦å­¦ä¹ "/> <meta itemprop="datePublished" content="2025-12-03T07:17:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ziwu"/> <meta itemprop="url" content="https://juejin.cn/user/607373397353726"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€äº¤é€šæ ‡å¿—è¯†åˆ«ç³»ç»Ÿã€‘Python+TensorFlow+Django+äººå·¥æ™ºèƒ½+æ·±åº¦å­¦ä¹ +å·ç§¯ç¥ç»ç½‘ç»œç®—æ³•
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/607373397353726/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ziwu
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:17:01.000Z" title="Wed Dec 03 2025 07:17:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»‹ç»</h2>
<p>äº¤é€šæ ‡å¿—è¯†åˆ«ç³»ç»Ÿï¼ŒåŸºäºTensorFlowæ­å»ºResnet50å·ç§¯ç¥ç»ç½‘ç»œç®—æ³•ï¼Œé€šè¿‡å¯¹58ç§å¸¸è§çš„äº¤é€šæ ‡å¿—å›¾ç‰‡æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œæœ€åå¾—åˆ°ä¸€ä¸ªè¯†åˆ«ç²¾åº¦è¾ƒé«˜çš„æ¨¡å‹ï¼Œç„¶åæ­å»ºWebå¯è§†åŒ–æ“ä½œå¹³å°ã€‚</p>
<p><strong>æŠ€æœ¯æ ˆ</strong>ï¼š</p>
<ul>
<li>é¡¹ç›®å‰ç«¯ä½¿ç”¨Htmlã€CSSã€BootStrapæ­å»ºç•Œé¢ã€‚</li>
<li>åç«¯åŸºäºDjangoå¤„ç†é€»è¾‘è¯·æ±‚</li>
<li>åŸºäºAjaxå®ç°å‰åç«¯æ•°æ®é€šä¿¡</li>
</ul>
<p><strong>é€‰é¢˜èƒŒæ™¯ä¸æ„ä¹‰</strong>ï¼š
åœ¨æ™ºèƒ½äº¤é€šç³»ç»Ÿè“¬å‹ƒå‘å±•çš„å½“ä¸‹ï¼Œäº¤é€šæ ‡å¿—çš„ç²¾å‡†è¯†åˆ«å¯¹äºä¿éšœè¡Œè½¦å®‰å…¨ã€æå‡äº¤é€šç®¡ç†æ•ˆç‡æ„ä¹‰é‡å¤§ã€‚ç„¶è€Œï¼Œä¼ ç»Ÿè¯†åˆ«æ–¹æ³•åœ¨é¢å¯¹å¤æ‚å¤šå˜çš„äº¤é€šç¯å¢ƒæ—¶ï¼Œå¾€å¾€å­˜åœ¨è¯†åˆ«ç²¾åº¦ä¸è¶³ã€æ•ˆç‡ä½ä¸‹ç­‰é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å¼€å±•äº¤é€šæ ‡å¿—è¯†åˆ«ç³»ç»Ÿé¡¹ç›®ï¼Œé‡‡ç”¨å‰æ²¿æŠ€æœ¯ï¼ŒåŸºäºTensorFlowæ­å»ºResnet50å·ç§¯ç¥ç»ç½‘ç»œç®—æ³•ï¼Œåˆ©ç”¨58ç§å¸¸è§äº¤é€šæ ‡å¿—å›¾ç‰‡æ•°æ®é›†è®­ç»ƒï¼Œä»¥è·å–é«˜ç²¾åº¦è¯†åˆ«æ¨¡å‹ã€‚åŒæ—¶ï¼Œä¸ºæ–¹ä¾¿ç”¨æˆ·æ“ä½œï¼Œæˆ‘ä»¬è¿˜è¿ç”¨Htmlã€CSSç­‰æŠ€æœ¯æ­å»ºWebå¯è§†åŒ–å¹³å°ï¼Œå®ç°ä¾¿æ·äº¤äº’ã€‚</p>
<h2 data-id="heading-1">äºŒã€ç³»ç»Ÿæ•ˆæœå›¾ç‰‡å±•ç¤º</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/56a6f3f47efe407198f6c1261fd8c74c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgeml3dQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351021&amp;x-signature=LllN1nXRjKCAq%2F%2Fn1j7p5ErFycc%3D" alt="å›¾ç‰‡" loading="lazy"/></p>
<h2 data-id="heading-2">ä¸‰ã€æ¼”ç¤ºè§†é¢‘ and å®Œæ•´ä»£ç  and å®‰è£…</h2>
<p>åœ°å€ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fziwupy.cn%2Fp%2FqBWZim" target="_blank" title="https://ziwupy.cn/p/qBWZim" ref="nofollow noopener noreferrer">ziwupy.cn/p/qBWZim</a></p>
<h2 data-id="heading-3">å››ã€å·ç§¯ç¥ç»ç½‘ç»œç®—æ³•ä»‹ç»</h2>
<p>å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰æ˜¯ä¸€ç§ä¸“é—¨ä¸ºå¤„ç†å…·æœ‰ç½‘æ ¼ç»“æ„æ•°æ®ï¼ˆå¦‚å›¾åƒï¼‰è€Œè®¾è®¡çš„æ·±åº¦å­¦ä¹ ç®—æ³•ã€‚å®ƒé€šè¿‡å·ç§¯å±‚è‡ªåŠ¨æå–å›¾åƒçš„å±€éƒ¨ç‰¹å¾ï¼Œåˆ©ç”¨æ± åŒ–å±‚é™ä½æ•°æ®ç»´åº¦ã€å‡å°‘è®¡ç®—é‡å¹¶å¢å¼ºç‰¹å¾çš„é²æ£’æ€§ï¼Œæœ€åé€šè¿‡å…¨è¿æ¥å±‚å¯¹æå–çš„ç‰¹å¾è¿›è¡Œåˆ†ç±»æˆ–å›å½’ã€‚CNNçš„ç‹¬ç‰¹ä¹‹å¤„åœ¨äºå…¶å±€éƒ¨è¿æ¥å’Œæƒé‡å…±äº«æœºåˆ¶ï¼Œæå¤§å‡å°‘äº†å‚æ•°é‡ï¼Œæé«˜äº†è®­ç»ƒæ•ˆç‡ï¼Œå°¤å…¶æ“…é•¿å›¾åƒè¯†åˆ«ã€ç›®æ ‡æ£€æµ‹ç­‰è®¡ç®—æœºè§†è§‰ä»»åŠ¡ã€‚</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">from</span> tensorflow.keras <span class="hljs-keyword">import</span> layers, models

<span class="hljs-comment"># æ„å»ºç®€å•CNNæ¨¡å‹</span>
model = models.Sequential([
    layers.Conv2D(<span class="hljs-number">32</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>, input_shape=(<span class="hljs-number">28</span>, <span class="hljs-number">28</span>, <span class="hljs-number">1</span>)),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    layers.Conv2D(<span class="hljs-number">64</span>, (<span class="hljs-number">3</span>, <span class="hljs-number">3</span>), activation=<span class="hljs-string">'relu'</span>),
    layers.MaxPooling2D((<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)),
    layers.Flatten(),
    layers.Dense(<span class="hljs-number">64</span>, activation=<span class="hljs-string">'relu'</span>),
    layers.Dense(<span class="hljs-number">10</span>, activation=<span class="hljs-string">'softmax'</span>)
])

model.<span class="hljs-built_in">compile</span>(optimizer=<span class="hljs-string">'adam'</span>,
              loss=<span class="hljs-string">'sparse_categorical_crossentropy'</span>,
              metrics=[<span class="hljs-string">'accuracy'</span>])

</code></pre>
<p>ä¸Šè¿°ä»£ç ç”¨TensorFlowæ„å»ºäº†ä¸€ä¸ªç®€å•çš„CNNæ¨¡å‹ï¼ŒåŒ…å«ä¸¤ä¸ªå·ç§¯å±‚å’Œæ± åŒ–å±‚ï¼Œç”¨äºæå–å›¾åƒç‰¹å¾ï¼Œåæ¥å…¨è¿æ¥å±‚è¿›è¡Œåˆ†ç±»ã€‚è¯¥æ¨¡å‹é€‚ç”¨äºæ‰‹å†™æ•°å­—è¯†åˆ«ç­‰ç®€å•å›¾åƒåˆ†ç±»ä»»åŠ¡ï¼Œé€šè¿‡è°ƒæ•´ç½‘ç»œç»“æ„å’Œå‚æ•°ï¼Œå¯æ‹“å±•è‡³æ›´å¤æ‚çš„å›¾åƒè¯†åˆ«åœºæ™¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸šåŠ¡ä»£ç è¿­ä»£é‡æ„åˆ©å™¨ï¼šSOLOä¸­å›½ç‰ˆä¿éšœé¡¹ç›®éœ€æ±‚]]></title>    <link>https://juejin.cn/post/7578699866182647846</link>    <guid>https://juejin.cn/post/7578699866182647846</guid>    <pubDate>2025-12-02T01:06:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7578699866182647846" data-draft-id="7578762210286583871" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸šåŠ¡ä»£ç è¿­ä»£é‡æ„åˆ©å™¨ï¼šSOLOä¸­å›½ç‰ˆä¿éšœé¡¹ç›®éœ€æ±‚"/> <meta itemprop="keywords" content="Trae,å‰ç«¯,AIç¼–ç¨‹"/> <meta itemprop="datePublished" content="2025-12-02T01:06:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰å¸½lufei"/> <meta itemprop="url" content="https://juejin.cn/user/501033035632093"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸šåŠ¡ä»£ç è¿­ä»£é‡æ„åˆ©å™¨ï¼šSOLOä¸­å›½ç‰ˆä¿éšœé¡¹ç›®éœ€æ±‚
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/501033035632093/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰å¸½lufei
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-02T01:06:50.000Z" title="Tue Dec 02 2025 01:06:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-02
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;color:#3c9dff}.markdown-body h1{font-size:30px;margin-bottom:5px;padding-bottom:8px;text-align:center}.markdown-body h2{font-size:24px;padding-bottom:6px}.markdown-body h2:before{content:"ğŸ‹"}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h3:before{content:"ğŸ“"}.markdown-body h4{font-size:16px}.markdown-body h4:before{content:"ğŸ‘"}.markdown-body h5{font-size:15px}.markdown-body h5:before{content:"ğŸ‰"}.markdown-body h6{margin-top:5px}.markdown-body h6:before{content:"ğŸ’"}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;margin:0 auto;max-width:100%;border-radius:4px;padding:1px;border:1px solid #d2e8ff}.markdown-body img:hover{box-shadow:0 1px 3px #5eaeff}.markdown-body hr{height:4px;margin:34px 0;background-size:4px 1px;background-image:linear-gradient(270deg,#5eaeff,#f3f9ff 25%,transparent 50%);border-style:none}.markdown-body code{word-break:break-word;border-radius:3px;overflow-x:auto;background-color:#d2e8ff;color:#3c9dff;font-size:.9em;padding:.1em .5em;margin:0 3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;transition:all .3s}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:1px solid #90c7ff;border-radius:4px}.markdown-body pre:hover{box-shadow:0 1px 10px #beddff}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#3c9dff;border-bottom:1px solid #90c7ff;transition:all .3s}.markdown-body a:hover{color:#007fff;border-bottom:2px solid #5eaeff}.markdown-body a[href]:not(:empty){padding-right:18px}.markdown-body a[href]:not(:empty):after{display:inline-block;width:16px;height:16px;margin-left:2px;content:"";background:url(data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxwYXRoIGQ9Ik0zODQgMTI4YTQ4IDQ4IDAgMDEyLjgxNiA5NS45MkwzODQgMjI0SDI1NmEzMiAzMiAwIDAwLTMxLjkyIDI5LjZMMjI0IDI1NnY1MTJhMzIgMzIgMCAwMDI5LjYgMzEuOTJsMi40LjA4aDUxMmEzMiAzMiAwIDAwMzEuOTItMjkuNmwuMDgtMi40VjY1NmE0OCA0OCAwIDAxOTUuOTItMi44MTZMODk2IDY1NnYxMTJhMTI4IDEyOCAwIDAxLTEyNCAxMjcuOTM2bC00IC4wNjRIMjU2YTEyOCAxMjggMCAwMS0xMjcuOTM2LTEyNGwtLjA2NC00VjI1NmExMjggMTI4IDAgMDExMjQtMTI3LjkzNmw0LS4wNjRoMTI4em0zODQgMGExMjggMTI4IDAgMDExMjcuOTM2IDEyNGwuMDY0IDR2MTYwYTQ4IDQ4IDAgMDEtOTUuOTIgMi44MTZMODAwIDQxNlYyOTEuODcybC0zODIuMDY0IDM4Mi4wOGE0OCA0OCAwIDAxLTcwLjAzMi02NS42bDIuMTYtMi4yODhMNzMyLjA5NiAyMjRINjA4YTQ4IDQ4IDAgMDEtMi44MTYtOTUuOTJMNjA4IDEyOGgxNjB6IiBmaWxsPSIjM2M5ZGZmIiBmaWxsLW9wYWNpdHk9Ii41NiIgZGF0YS1zcG0tYW5jaG9yLWlkPSJhMzEzeC5zZWFyY2hfaW5kZXguMC5pMC41Yzc1M2E4MTgwa2RKWCIgY2xhc3M9InNlbGVjdGVkIi8+PC9zdmc+);background-size:100%}.markdown-body table{margin:0 auto 10px;font-size:12px;width:auto;max-width:100%;overflow:auto;border-collapse:collapse;border:1px solid #3c9dff}.markdown-body thead{text-align:center}.markdown-body thead th{color:#fff;background-color:#5eaeff}.markdown-body tr{text-align:center}.markdown-body tbody tr:hover{background-color:#d2e8ff}.markdown-body tbody tr:hover code{background-color:#90c7ff}.markdown-body tr:nth-child(2n){background-color:#ecf5ff}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li::marker,.markdown-body ul li::marker{color:#5eaeff}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{font-weight:900;padding:0 1px;font-size:17px}.markdown-body small{color:#cbcbcb;padding:0 1px;font-size:22px;zoom:.5}.markdown-body em{padding:0 1px}.markdown-body del{padding:0 1px;text-decoration-thickness:2px}.markdown-body blockquote{color:#1a1b1c;padding:1px 20px;margin:22px 0;border-radius:4px;border-left:4px solid rgba(60,157,255,.5);background-color:rgba(190,221,255,.3)}.markdown-body blockquote blockquote{margin:8px 0}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{margin:12px 0;padding:4px 10px;border:2px solid #3c9dff;border-radius:8px;background-color:#ecf5ff;transition:all .3s}.markdown-body details summary{cursor:pointer}.markdown-body input[type=checkbox]{position:relative;appearance:none;width:16px;height:16px;border-radius:2px;vertical-align:middle;transform:translateY(-2px);box-sizing:border-box;border:1px solid #beddff}.markdown-body input[type=checkbox]:checked{border:1px solid #5eaeff;background-color:#5eaeff}.markdown-body input[type=checkbox]:checked:before{position:absolute;top:3px;left:1px;width:11px;height:6px;background-color:transparent;border-left:2px solid #fff;border-bottom:2px solid #fff;transform:rotate(-45deg);content:"";box-sizing:border-box}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-dark">.hljs-comment,.hljs-quote{color:#d4d0ab}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#ffa07a}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#f5ab35}.hljs-attribute{color:gold}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#abe338}.hljs-section,.hljs-title{color:#00e0e0}.hljs-keyword,.hljs-selector-tag{color:#dcc6e0}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#2b2b2b;color:#f8f8f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b0360f90b1a14ff4b72671c20f9fe2c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=%2FD4a%2Bia2fCEej%2BmltJ7Av9gDIx4%3D" alt="" loading="lazy"/></p>
<p>ä¹‹å‰å›½å¤–ç‰ˆ Trae SOLO æ¨¡å¼é™æ—¶å…è´¹çš„æ—¶å€™ç”¨è¿‡ä¸€æ®µæ—¶é—´ï¼Œé‚£æ—¶å€™ä½“éªŒè¿˜æ˜¯éå¸¸æ£’çš„</p>
<p>è¿™æ¬¡ä¸­å›½ç‰ˆå…¨æ–°ä¸Šçº¿ï¼Œå…¨é¢å…è´¹ï¼Œå‰æœ‰ Google Gemini3 å…¨é¢å…è´¹å¼€æ”¾ï¼Œåæœ‰ Trae SOLO ä¸­å›½ç‰ˆå…¨æ–°ä¸Šçº¿ï¼Œå¹¶å…¨é¢å…è´¹ï¼ŒçœŸæ˜¯ä»¤äººæ¿€åŠ¨å•Š</p>
<p><strong>æ³¨æ„ï¼</strong></p>
<p>è¿™é‡Œæ˜¯ä¸­å›½ç‰ˆï¼Œå’ŒåŸæ¥çš„ Trae æ˜¯ä¸¤ä¸ªç‰ˆæœ¬</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6026036b20ba46d282fffdae6566b48b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=NyyM4nQsGimrlx53ZXd3vHV2L08%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ca4c4e6ff2714b5a8c773b62e0bcc1f2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=rjaeFRHB7pc2dvZI1sJi0re%2Fb1E%3D" alt="" loading="lazy"/></p>
<p>ä¸‹è½½å®‰è£…å¥½ä»¥åï¼Œç›®å‰SOLOæ¨¡å¼è¿˜æ²¡å¼€æ”¾ï¼Œå¯ä»¥å…ˆåŠ å…¥ç­‰å¾…åå•</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/26a3ec7da52344b687a3b77b7255932f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=7Xooe4XiiPc4f5AD%2B1VuV5YAPqo%3D" alt="" loading="lazy"/></p>
<p>æˆ‘æ˜¯çœ‹åˆ° SOLO ä¸­å›½ç‰ˆä¸Šçº¿åï¼Œç¬¬ä¸€æ—¶é—´æ‰¾åˆ°äº†å®˜ç½‘ï¼Œç„¶åç”³è¯·äº†é¢„çº¦ï¼Œå®˜æ–¹è¯´æ³•æ˜¯é€æ­¥å¼€æ”¾åé¢</p>
<p>åœ¨æ˜é‡‘ç¾¤é‡Œå¡«å†™äº†é—®å·åï¼Œå°±è¿‡äº†ä¸€å¤©å°±å¼€æ”¾åé¢äº†ï¼Œæ•ˆç‡è›®é«˜å•Šï¼Œç»™æ˜é‡‘çš„è¿è¥äººå‘˜æ‰‹åŠ¨ç‚¹èµ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f31ffeb73e9c42189e906987d7bbf747~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=ks4dZ2ZHCHG2G7GzQ%2FTg%2F4auUqs%3D" alt="" loading="lazy"/></p>
<p>ä¸€ä¸ªå¾ˆæœ‰è¶£çš„æ“ä½œï¼Œè‡ªåŠ¨æ‰§è¡Œäº† npm run dev ,ä½†æ˜¯è¿™ä¸ªæ˜¯ä¸ªå‰ç«¯é¡¹ç›®ï¼Œéœ€è¦åœ¨é¡µé¢ä¸Šæ‰§è¡Œæ“ä½œæ‰èƒ½éªŒè¯ï¼Œæˆ‘æœ¬æ¥å¼€äº†ä¸€ä¸ªå‰ç«¯çš„é¡µé¢æœåŠ¡ï¼Œç°åœ¨åˆå¼€äº†ï¼Œéœ€æ‰‹åŠ¨å…³ä¸€ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58e992cc287247639be497317a366553~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=OXNN7sJPM0jXncD1bLQJKHG0NYI%3D" alt="" loading="lazy"/></p>
<p>å¦‚æœæ˜¯æ¥å£æ€§è´¨çš„åŠŸèƒ½ï¼Œè‡ªåŠ¨å¯åŠ¨æœåŠ¡æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå¦‚æœæ˜¯å‰ç«¯é¡¹ç›®ï¼Œè¿™ä¸€æ­¥æ„ä¹‰ä¸å¤§ï¼Œè¿™ä¸ªå¯ä»¥é…ç½®æˆå¯é€‰é¡¹ï¼Œæˆ–è€…å¯åŠ¨ä»»åŠ¡æ—¶æ ¹æ®é¡¹ç›®æ€§è´¨è¿›è¡Œå¼¹æ¡†æ¨èä¹‹ç±»çš„</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/187b47bf8397434ea651251649621244~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=8F7WZMA2pDla2cUCV%2Bow7GVhEas%3D" alt="" loading="lazy"/></p>
<blockquote>
<p>è¡¥å……ï¼š</p>
<p>è‡ªåŠ¨å¯åŠ¨æœåŠ¡çš„åŠŸèƒ½ï¼Œä¼¼ä¹å®˜æ–¹åæ¥å–æ¶ˆäº†ï¼Œæˆ‘åœ¨åé¢çš„ä½¿ç”¨ä¸­æ²¡æœ‰å†é‡åˆ°äº†</p>
</blockquote>
<p>æ‰§è¡Œäº†ä¸¤ä¸ªå°ä»»åŠ¡ï¼Œé€‰æ‹©å¥½é¡µé¢ï¼Œè®©AIåŠ å¯¹åº”çš„èœå•é¡¹ï¼Œä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™è¿™ä¸ª plan é€‰é¡¹å–æ¶ˆäº†ï¼Œä¸­é—´åœ¨å¯¹è¯å†…å®¹åŒºåŸŸï¼Œç‚¹è¿‡æ‰§è¡ŒæŒ‰é’®</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1dd247dada84bec87986b74b0769819~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=yyjwt8GbXLneTJV98KyEzCJjU74%3D" alt="" loading="lazy"/></p>
<p>åœ¨ç»™ç¬¬äºŒä¸ªé¡µé¢æ·»åŠ èœå•é¡¹çš„æ—¶å€™ï¼Œä»£ç é¡¹åŠ ä¸Šäº†ï¼Œé¡µé¢ä¹Ÿèƒ½æ˜¾ç¤ºï¼Œä½†æ˜¯æ¨¡å‹ä¼¼ä¹æ²¡æœ‰è¯»å…¨ç¯‡çš„ä»£ç ï¼Œè¿™ä¸ªèœå•é¡¹ç‚¹å‡»æ—¶éœ€è¦æ‰“å¼€æ–°é¡µé¢çš„å½¢å¼ï¼Œæ²¡æœ‰åœ¨å¯¹åº”çš„å‡½æ•°ä¸­æ·»åŠ  22 è¿™ä¸ªæ–°èœå•é¡¹ï¼Œæ¨¡å‹ä½¿ç”¨çš„æ˜¯è‡ªåŠ¨æ¨¡å¼ï¼Œåœ¨æ•´ä¸ªæ–‡ä»¶åŠŸèƒ½æ–°å¢å°è°ƒæ•´ç‚¹ï¼Œæ²¡æœ‰å‚è€ƒåˆ°å®Œæ•´çš„ç›¸å…³é…ç½®æˆ–è€…é€»è¾‘æ“ä½œ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f66fa6f9abe747edb872e8bf870d01c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=J%2F7xZJt0N5a7vhRyz%2F5%2F%2BjFlKxU%3D" alt="" loading="lazy"/></p>
<p>çœ‹æ¥åœ¨é¡¹ç›®çš„ä¸šåŠ¡é¡¹ç›®åŠŸèƒ½è¿­ä»£ä¸­ï¼Œå¯¹äºæ•´ä¸ªåŠŸèƒ½å®Œæ•´æ€§çš„ç†è§£è¿˜æœ‰æå‡çš„ç©ºé—´</p>
<p>ç”±äºéœ€è¦åœ¨é¡¹ç›®ä¸­å…ˆæŸ¥ä¸€ä¸‹ç›¸å…³æ–‡ä»¶å’Œä»£ç ï¼Œåˆ‡æ¢æˆäº†IDEæ¨¡å¼ï¼Œé¡ºä¾¿æµ‹è¯•ä¸‹IDEæ¨¡å¼ä¸‹æ•ˆæœï¼Œè¿™æ˜¯ä¸€ä¸ªformè¡¨å•é¡µé¢ï¼Œé¡µé¢ä¸­çš„ä»»åŠ¡åˆ—è¡¨ä¸­æ˜¯ä¸ªå¯ç¼–è¾‘çš„è¡¨æ ¼ï¼Œå¢åˆ æ”¹æŸ¥æ•°æ®éƒ½åœ¨è¡¨æ ¼ä¸­è¿›è¡Œï¼Œç”±äºè¡¨æ ¼çš„åˆ—å¤ªå¤šï¼Œéœ€è¦æ”¹æˆå¡ç‰‡è¡¨å•å½¢å¼ï¼Œç”±äºæˆ‘æ€•AIæŠŠåŸæ¥å¯ç”¨çš„åŠŸèƒ½æ”¹åäº†ï¼Œç„¶åè®©å®ƒå…ˆæŠŠåŸæœ‰åŠŸèƒ½æ³¨é‡Š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09325b2ce0474a19be2ea7ff887fb6d8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=YUhRRkz1C%2BuHsC%2BZrpd%2Fa6AqfUc%3D" alt="" loading="lazy"/></p>
<p>ä»£ç æ›´æ–°å®Œä»¥åï¼Œè¿™é‡Œæ˜¯æç¤ºï¼Œè¦ä¸è¦è‡ªåŠ¨è¿è¡Œï¼Œè¿™ä¸ªæ–¹é¢çš„ä½“éªŒæ˜æ˜¾å‡çº§äº†</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb3c311d56c94fa0b04b17510ce4cf4a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=8vnkO7LtYZjqPxgot4c%2FUHLN2W4%3D" alt="" loading="lazy"/></p>
<p>ä¸€äº›åˆ—æ“ä½œä»¥åï¼ŒAIå®Œæˆäº†ï¼Œæ¥ä¸‹æ¥åœ¨é¡µé¢ä¸ŠéªŒè¯ä¸€ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d2e6647b2d54c93841ed136545cef83~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=qksUiz0Ko%2B3IebguACxeyxyVrA4%3D" alt="" loading="lazy"/></p>
<p>å®...</p>
<p>æ‰“å¼€è¿™ä¸ªFormé¡µé¢ç›´æ¥æŠ¥é”™ï¼Œä¸€ç‚¹éƒ½ä¸æ„å¤–ï¼Œ<code>è‹¦ç¬‘...</code></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abee9479ac604def9e109a432508529d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=dZ1yqQolco7dW54vyV3EbpdCiUA%3D" alt="" loading="lazy"/></p>
<p>æ²¡æ•´ä½“ç†è§£é€ä»£ç å®ç°é€»è¾‘ï¼Œå‡ºç°çš„è¿™ç§é—®é¢˜ï¼Œå…ˆè®©å®ƒè‡ªå·±æŸ¥ä¸€ä¸‹ï¼Œæˆ‘æŠŠç›¸å…³æ–‡ä»¶çš„è°ƒç”¨ç»™å®ƒè¯´äº†ï¼Œå¸Œæœ›å®ƒèƒ½å¤Ÿåšå…³è”æ€§æ•´ä½“åˆ†æ</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/470383283d5f4df29300851b99530d63~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=jAw2tZ0PBDKIlgBp%2BrlvOkp5jOs%3D" alt="" loading="lazy"/></p>
<p>AIåˆæ˜¯ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œåˆ†æï¼Œç„¶åæ›´æ–°ä»£ç ï¼Œæ ¹æ®å®ƒè‡ªå·±çš„ç†è§£ï¼ŒåŠ äº†ä¸€ä¸ªç¼ºå°‘çš„initå‡½æ•°ï¼Œç„¶åæˆ‘åˆçœ‹äº†é¡µé¢å¹¶æµ‹è¯•è¿˜ä¸å¯¹ï¼Œè¿™æ—¶å€™å¾ˆæ˜æ˜¾ï¼Œå®ƒå·²ç»å¼€å§‹èƒ¡è¯´å…«é“äº†</p>
<p>è¿™æ˜¯å®ƒåŠ çš„ä»£ç ï¼Œå†™äº†å‡ è¡Œï¼Œè¿˜æœ‰ç›¸å…³åˆ¤æ–­</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e81ac2106ec94bd5b39986584e12960f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=wVwKZSfCy1frWtW1zYj6vOcYCZc%3D" alt="" loading="lazy"/></p>
<p>æˆ‘ä»gitlabä¸Šæ‰¾äº†ä¸€ä¸‹åŸæ¥çš„initå‡½æ•°</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e59da74ee1244236a2c1687ed1194850~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=ba4emownGKyisD1yz4OqYl0cDjs%3D" alt="" loading="lazy"/></p>
<p>å¯¹æ¯”ä¸€ä¸‹ï¼Œæ­¤æ—¶çš„æˆ‘</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/049580b6c3704a25a0cae3ba78e05077~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=8MSuANM%2B%2F0q0kZfMm7KilG4UHTU%3D" alt="" loading="lazy"/></p>
<p>è®©å®ƒæŠŠè¡¨æ ¼çš„äº¤äº’æ ·å¼æ”¹ä¸€ä¸‹ï¼Œä¸ä»…æŠŠåŠŸèƒ½æ”¹çš„ä¸èƒ½è¿è¡Œäº†ï¼Œè¿˜æŠŠä¸€äº›åŸæ¥çš„å¯ç”¨çš„åŠŸèƒ½æ”¹çš„ä¸æˆæ ·å­äº†</p>
<p>æ¨¡å‹ä½¿ç”¨çš„ Auto æ¨¡å¼ï¼Œè‡ªåŠ¨é€‰æ‹©çš„æ¨¡å‹èƒ½åŠ›åˆšå¥½è¿™æ–¹é¢å·®ç‚¹æ„æ€ï¼Ÿè¿˜æ˜¯ IDEæ¨¡å¼ä¸­çš„ä¸€äº›èƒ½åŠ›å’ŒSOLOä¸­èƒ½åŠ›ä¸ä¸€æ ·ï¼Ÿ</p>
<p>å¯¹æ¯”äº†SOLOæ¨¡å¼çš„ä¸­æç¤ºï¼Œå‘ç°å’ŒIDEæ¨¡å¼æè¿°è¿˜ä¸å¤ªä¸€æ ·ï¼ŒSOLOæ¨¡å¼ä¸­å•ç‹¬åŠ äº†ä¸Šä¸‹æ–‡çš„å¤§å°è¯´æ˜</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb752b8143004ac5b59123f180c470df~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=3BH3pKjInRE%2BKK6Nq8wXR4DDVKE%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68a9394cd243449c979412dc366a34ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=2JZ2h3UhJ5E%2BjjE4ddjbmlA4NRo%3D" alt="" loading="lazy"/></p>
<p>æ¢äº†ä¸€ä¸ªæ¨¡å‹ï¼Œé€‰æ‹©Qwen-3-Coderï¼Œè¯è¿˜æ²¡è¯´å®Œï¼Œæç¤ºæ€è€ƒæ¬¡æ•°å·²è¾¾ä¸Šé™äº†ï¼ŒIDEæ¨¡å¼å’ŒSOLOæ¨¡å¼çš„å·®è·æ˜æ˜¾åœ¨è¿™é‡Œ</p>
<p>å¥½åœ¨ï¼Œä»£ç å·²ç»æ”¹å®Œäº†ï¼Œèµ·ç åŠŸèƒ½æ”¹çš„èƒ½ç”¨ï¼Œä¹ŸåŸºæœ¬ç¬¦åˆé€¾æœŸï¼Œçœ‹æ¥æ˜¯æ¨¡å‹ä¹‹é—´çš„å·®è·è¿˜æ˜¯è›®å¤§çš„ï¼Œè‡ªåŠ¨æ¨¡å¼è¦æ˜¯èƒ½æ˜¾ç¤ºå“ªä¸ªæ¨¡å‹å¯èƒ½å°±å¥½äº†ï¼Œç›®å‰çš„è¿™ä¸ªé‡æ„ä»»åŠ¡ï¼ŒQwen-3-Coder è¿™ä¸ªæ¨¡å‹è¡¨ç°ç›¸å¯¹ä¸é”™</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/825ed697f96248d4a216606f28a03749~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6I2J5bi9bHVmZWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765242410&amp;x-signature=tBvcXWg8Ed8eU5hfwhKGA1u0Nw4%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œé¢æœ‰å‡ æ¬¡å…³äºé‡å¯ç»ˆç«¯çš„æç¤ºï¼Œæˆ‘åœ¨æé—®AIçš„æ—¶å€™å°±å·²ç»è¿è¡Œé¡¹ç›®äº†ï¼Œè™½ç„¶æ¯æ¬¡æç¤ºéƒ½ä¸å¤ªä¸€æ ·ï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯é—®ç”¨æˆ·è¦ä¸è¦é‡å¯ç»ˆç«¯ï¼Œç„¶åæ‰è¿›è¡Œä¸‹ä¸€æ­¥ï¼Œå…³äºç»ˆç«¯çš„æ“ä½œå¯ä»¥æ”¾åˆ°æœ€åï¼Œä»£ç æ”¹å®Œä¹Ÿæ€»ç»“å®Œåï¼Œåˆå¹¶æç¤ºä¸€æ¬¡å°±è¡Œäº†</p>
<h3 data-id="heading-0">å°ç»“ä¸€ä¸‹</h3>
<p>é€šè¿‡åœ¨ä¸šåŠ¡é¡¹ç›®ä¸­ä½¿ç”¨ä¸åŒçš„ä»»åŠ¡æ·±åº¦ä½“éªŒTraeä¸­å›½ç‰ˆï¼Œè¿™æ¬¡ä¸­å›½ç‰ˆTraeçš„åŠŸèƒ½å’Œä½“éªŒè¿˜æ˜¯éå¸¸äº®çœ¼çš„ï¼Œå°±å…¨é¢å…è´¹è¿™æ–¹é¢ä»˜å‡ºçš„æˆæœ¬å®˜æ–¹è¿˜æ˜¯è¯šæ„æ»¡æ»¡çš„ï¼Œç›¸å¯¹å›½å¤–ç‰ˆçš„ä¸€äº›åŠŸèƒ½ï¼Œèƒ½æ˜æ˜¾æ„Ÿå—åˆ°ä¸€äº›ä½“éªŒä¸Šçš„æå‡å’Œä¼˜åŒ–ï¼Œç»™Traeå›¢é˜Ÿçš„ç»™åŠ›ä»˜å‡ºç‚¹èµï¼Œç»§ç»­ä¼˜åŒ–ï¼Œè¶Šåšè¶Šå¥½</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å½“10ä¸‡å¤©åˆ†åŒºæ¥è¢­ï¼šä¸€ä¸ªè®©StarRockså´©æºƒã€Kuduæ‹’ç»ã€HDFSå¾®ç¬‘çš„æ¶æ„æ•…äº‹]]></title>    <link>https://juejin.cn/post/7579439226517733382</link>    <guid>https://juejin.cn/post/7579439226517733382</guid>    <pubDate>2025-12-03T07:47:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579439226517733382" data-draft-id="7579179625462677546" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½“10ä¸‡å¤©åˆ†åŒºæ¥è¢­ï¼šä¸€ä¸ªè®©StarRockså´©æºƒã€Kuduæ‹’ç»ã€HDFSå¾®ç¬‘çš„æ¶æ„æ•…äº‹"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:47:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="shengjk1"/> <meta itemprop="url" content="https://juejin.cn/user/2647279732524957"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½“10ä¸‡å¤©åˆ†åŒºæ¥è¢­ï¼šä¸€ä¸ªè®©StarRockså´©æºƒã€Kuduæ‹’ç»ã€HDFSå¾®ç¬‘çš„æ¶æ„æ•…äº‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279732524957/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    shengjk1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:47:44.000Z" title="Wed Dec 03 2025 07:47:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="gruvbox-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#282828}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#ebdbb2}.hljs-deletion,.hljs-formula,.hljs-keyword,.hljs-link,.hljs-selector-tag{color:#fb4934}.hljs-built_in,.hljs-emphasis,.hljs-name,.hljs-quote,.hljs-strong,.hljs-title,.hljs-variable{color:#83a598}.hljs-attr,.hljs-params,.hljs-template-tag,.hljs-type{color:#fabd2f}.hljs-builtin-name,.hljs-doctag,.hljs-literal,.hljs-number{color:#8f3f71}.hljs-code,.hljs-meta,.hljs-regexp,.hljs-selector-id,.hljs-template-variable{color:#fe8019}.hljs-addition,.hljs-meta-string,.hljs-section,.hljs-selector-attr,.hljs-selector-class,.hljs-string,.hljs-symbol{color:#b8bb26}.hljs-attribute,.hljs-bullet,.hljs-class,.hljs-function,.hljs-function .hljs-keyword,.hljs-meta-keyword,.hljs-selector-pseudo,.hljs-tag{color:#8ec07c}.hljs-comment{color:#928374}.hljs-link_label,.hljs-literal,.hljs-number{color:#d3869b}.hljs-comment,.hljs-emphasis{font-style:italic}.hljs-section,.hljs-strong,.hljs-tag{font-weight:700}</style><p>ä½ å¥½ï¼Œæˆ‘æ˜¯ shengjk1ï¼Œå¤šå¹´å¤§å‚ç»éªŒï¼ŒåŠªåŠ›æ„å»º é€šä¿—æ˜“æ‡‚çš„ã€å¥½ç©çš„ç¼–ç¨‹è¯­è¨€æ•™ç¨‹ã€‚ æ¬¢è¿å…³æ³¨ï¼ä½ ä¼šæœ‰å¦‚ä¸‹æ”¶ç›Šï¼š</p>
<ol>
<li>äº†è§£å¤§å‚ç»éªŒ</li>
<li>æ‹¥æœ‰å’Œå¤§å‚ç›¸åŒ¹é…çš„æŠ€æœ¯ç­‰</li>
</ol>
<p>å¸Œæœ›çœ‹ä»€ä¹ˆï¼Œè¯„è®ºæˆ–è€…ç§ä¿¡å‘Šè¯‰æˆ‘ï¼</p>
<p>@<a href="https://link.juejin.cn?target=%25E6%2596%2587%25E7%25AB%25A0%25E7%259B%25AE%25E5%25BD%2595" target="_blank" title="%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95" ref="nofollow noopener noreferrer">TOC</a></p>
<h2 data-id="heading-0">ä¸€ã€é—®é¢˜èµ·æºï¼šåŒä¸€ä¸ª"åˆ†åŒº"ï¼Œä¸‰ç§å‘½è¿</h2>
<p>åœ¨å¤§æ•°æ®é¢†åŸŸï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°ä¸€ä¸ªçŸ›ç›¾ç°è±¡ï¼š</p>
<ul>
<li><strong>HDFS + Hive/Iceberg</strong>ï¼šè½»æ¾ç®¡ç† 10 ä¸‡+ å¤©çº§åˆ†åŒºçš„è¡¨</li>
<li><strong>Kudu</strong>ï¼šå®˜æ–¹å»ºè®®ä¸è¶…è¿‡ 1,000 ä¸ª tabletï¼ˆç‰©ç†åˆ†ç‰‡ï¼‰</li>
<li><strong>StarRocks</strong>ï¼šå»ºè®®ä¸è¦è¶…è¿‡ 10 ä¸‡åˆ†åŒºï¼Œè¶…è¿‡ä¼šå¯¼è‡´ FE OOMã€æŸ¥è¯¢å»¶è¿Ÿé£™å‡</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># çœŸå®æ¡ˆä¾‹å¯¹æ¯”ï¼ˆ10 ä¸‡å¤©åˆ†åŒºï¼Œ3 å¹´æ•°æ®ï¼‰</span>
- HDFS + Icebergï¼šç¨³å®šè¿è¡Œï¼ŒæŸ¥è¯¢å»¶è¿Ÿ 2.1s
- StarRocksï¼šFE å†…å­˜ 480GB+ï¼Œç®€å•æŸ¥è¯¢å»¶è¿Ÿ 1800ms+ï¼Œé¢‘ç¹ Full GC
- Kuduï¼šæ‹’ç»åˆ›å»ºè¡¨ï¼ŒæŠ¥é”™ <span class="hljs-string">"Too many tablets: 100,000 exceeds limit of 10,000"</span>
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆåŒæ ·çš„"10 ä¸‡åˆ†åŒº"ï¼Œåœ¨ä¸åŒç³»ç»Ÿè¡¨ç°å¤©å·®åœ°åˆ«ï¼Ÿ</strong><br/>
ç­”æ¡ˆä¸åœ¨å­˜å‚¨å±‚ï¼Œè€Œåœ¨<strong>å…ƒæ•°æ®æ¶æ„è®¾è®¡å“²å­¦</strong>ã€‚</p>
<h2 data-id="heading-1">äºŒã€HDFSï¼šæ‰å¹³åŒ–å…ƒæ•°æ® + èŒè´£åˆ†ç¦»</h2>
<h3 data-id="heading-2">1. <strong>HDFS ä¸è®¤è¯†"åˆ†åŒº"</strong></h3>
<p>è¿™æ˜¯æœ€æ ¹æœ¬çš„è®¤çŸ¥ï¼š<strong>HDFS æ²¡æœ‰"é€»è¾‘åˆ†åŒº"æ¦‚å¿µ</strong>ã€‚å½“ Iceberg è¯´"10 ä¸‡ä¸ªåˆ†åŒº"ï¼ŒHDFS åªçœ‹åˆ°ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">/warehouse/sales/
    â”œâ”€â”€ <span class="hljs-attr">dt</span>=<span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">01</span>/  <span class="hljs-comment"># æ™®é€šç›®å½•ï¼Œæ— ç‰¹æ®Šè¯­ä¹‰</span>
    â”œâ”€â”€ <span class="hljs-attr">dt</span>=<span class="hljs-number">2020</span>-<span class="hljs-number">01</span>-<span class="hljs-number">02</span>/  <span class="hljs-comment"># æ™®é€šç›®å½•</span>
    â””â”€â”€ ...             <span class="hljs-comment"># 10 ä¸‡ä¸ªæ™®é€šç›®å½•</span>
</code></pre>
<p>NameNode å†…å­˜ä¸­åªç»´æŠ¤ï¼š</p>
<ul>
<li><strong>ç›®å½•æ ‘ç»“æ„</strong>ï¼šæ¯ä¸ªç›®å½• â‰ˆ 108 bytesï¼ˆå®æµ‹ Hadoop 3.3.6ï¼‰</li>
<li><strong>æ–‡ä»¶åˆ° Block æ˜ å°„</strong>ï¼šæ¯ä¸ª block â‰ˆ 100 bytes</li>
<li><strong>Block åˆ° DataNode æ˜ å°„</strong>ï¼šå­˜å‚¨ä½ç½®ä¿¡æ¯</li>
</ul>
<h3 data-id="heading-3">2. <strong>å…³é”®æ•°æ®ç»“æ„ï¼ˆHadoop 3.3.6 æºç ï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NameNode å†…å­˜æ ¸å¿ƒç»“æ„ï¼ˆç®€åŒ–ï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FSNamesystem</span> {
    <span class="hljs-comment">// 1. å‘½åç©ºé—´æ ‘ - è½»é‡çº§</span>
    INodeDirectory rootDir; <span class="hljs-comment">// 108 bytes/ç›®å½•</span>
    
    <span class="hljs-comment">// 2. å—æ˜ å°„ - é«˜æ•ˆå­˜å‚¨</span>
    BlocksMap blocksMap; <span class="hljs-comment">// LightWeightGSet ä¼˜åŒ–ï¼Œ100 bytes/block</span>
    
    <span class="hljs-comment">// 3. æ— ä¸šåŠ¡è¯­ä¹‰å­—æ®µï¼</span>
    <span class="hljs-comment">//    æ²¡æœ‰è¡Œæ•°ç»Ÿè®¡ã€æ²¡æœ‰min-maxå€¼ã€æ²¡æœ‰TTL</span>
}
</code></pre>
<h3 data-id="heading-4">3. <strong>10 ä¸‡"åˆ†åŒº"å†…å­˜æ¶ˆè€—å®æµ‹</strong></h3>






























<table><thead><tr><th>å…ƒæ•°æ®ç±»å‹</th><th>å†…å­˜å ç”¨</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>10 ä¸‡ç›®å½•</td><td>10.8 MB</td><td>108 bytes/ç›®å½• Ã— 100,000</td></tr><tr><td>100 ä¸‡æ–‡ä»¶</td><td>150 MB</td><td>150 bytes/æ–‡ä»¶ Ã— 1,000,000</td></tr><tr><td>800 ä¸‡ blocks</td><td>800 MB</td><td>100 bytes/block Ã— 8,000,000</td></tr><tr><td><strong>æ€»è®¡</strong></td><td><strong>&lt; 1GB</strong></td><td>NameNode é€šå¸¸é…ç½® 100GB+ å†…å­˜</td></tr></tbody></table>
<blockquote>
<p>âœ… <strong>å…³é”®ä¼˜åŠ¿</strong>ï¼šç›®å½•å…ƒæ•°æ®æç®€ï¼Œæ— ä¸šåŠ¡é€»è¾‘è´Ÿæ‹…ã€‚</p>
</blockquote>
<h3 data-id="heading-5">4. <strong>æ°´å¹³æ‰©å±•æœºåˆ¶ï¼šFederation</strong></h3>
<p>å½“å• NameNode è¾¾åˆ°æé™ï¼ŒHDFS é€šè¿‡ <strong>Router-based Federation</strong> æ°´å¹³æ‰©å±•ï¼š</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    Client--&gt;Router
    Router--&gt;|/data/tenantA/*| NS1[Nameservice 1]
    Router--&gt;|/data/tenantB/*| NS2[Nameservice 2]
    NS1--&gt;NN1[NameNode 1]
    NS2--&gt;NN2[NameNode 2]
</code></pre>
<ul>
<li><strong>æŒ‚è½½è¡¨æœºåˆ¶</strong>ï¼šé€æ˜è·¯ç”±ä¸åŒè·¯å¾„åˆ°ä¸åŒå‘½åç©ºé—´</li>
<li><strong>ç”Ÿäº§å®æµ‹</strong>ï¼šé˜¿é‡Œäº‘ EMR é›†ç¾¤ç®¡ç† <strong>25 äº¿+ ç›®å½•</strong>ï¼Œ200+ NameNode è”é‚¦</li>
</ul>
<h2 data-id="heading-6">ä¸‰ã€Kuduï¼šä¸ºé«˜æ€§èƒ½ OLAP ç‰ºç‰²æ‰©å±•æ€§</h2>
<h3 data-id="heading-7">1. <strong>Kudu çš„æ¶æ„å“²å­¦</strong></h3>
<p>Kudu ä¸º<strong>ä½å»¶è¿Ÿåˆ†æ</strong>è®¾è®¡ï¼Œå¿…é¡»å†…ç½®æ™ºèƒ½ï¼š</p>
<ul>
<li>åˆ—å¼å­˜å‚¨ + ç¼–ç ä¼˜åŒ–</li>
<li>å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ (MVCC)</li>
<li>èƒŒæ™¯å‹ç¼© (Compaction)</li>
<li>ç»Ÿè®¡ä¿¡æ¯ç”¨äºæŸ¥è¯¢ä¼˜åŒ–</li>
</ul>
<h3 data-id="heading-8">2. <strong>å…ƒæ•°æ®å†…å­˜ç»“æ„ï¼ˆKudu 1.16 æºç ï¼‰</strong></h3>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Kudu Tablet å…ƒæ•°æ®ï¼ˆC++ ç»“æ„ï¼‰</span>
<span class="hljs-keyword">struct</span> <span class="hljs-title class_">TabletMetadata</span> {
  string tablet_id;           <span class="hljs-comment">// 36 bytes (UUID)</span>
  Schema schema;              <span class="hljs-comment">// 500+ bytes (åˆ—å®šä¹‰+ç¼–ç )</span>
  PartitionSchema partition; <span class="hljs-comment">// 200+ bytes (åˆ†åŒºé”®+èŒƒå›´)</span>
  vector&lt;RowSetMetadata&gt; rowsets; <span class="hljs-comment">// 300+ bytes/rowset (æ•°æ®é›†)</span>
  <span class="hljs-type">int64_t</span> last_durable_mrs_id; <span class="hljs-comment">// 8 bytes (MemRowSet ID)</span>
  <span class="hljs-comment">// ... å‰¯æœ¬çŠ¶æ€ã€Compactionå†å²ã€ç»Ÿè®¡ä¿¡æ¯</span>
}; <span class="hljs-comment">// æ€»è®¡ â‰ˆ 1.5KB/tablet</span>
</code></pre>
<h3 data-id="heading-9">3. <strong>10 ä¸‡åˆ†åŒºä¸ºä»€ä¹ˆä¸å¯èƒ½ï¼Ÿ</strong></h3>
<ul>
<li>
<p><strong>å†…å­˜æ¶ˆè€—</strong>ï¼š<br/>
<code>100,000 tablets Ã— 1.5KB = 150GB</code>ï¼ˆä»…å…ƒæ•°æ®ï¼Œä¸åŒ…æ‹¬ç¼“å­˜ï¼‰</p>
</li>
<li>
<p><strong>Master å•ç‚¹ç“¶é¢ˆ</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰å…ƒæ•°æ®å¿…é¡»åœ¨ Master å†…å­˜</li>
<li>Tablet æœåŠ¡å™¨å¿ƒè·³éœ€å…¨å±€å¤„ç†</li>
<li>æ— æ°´å¹³æ‰©å±•æœºåˆ¶ï¼ˆæœ€æ–°ç‰ˆæœ¬ä»ä¸æ”¯æŒ Master åˆ†ç‰‡ï¼‰</li>
</ul>
</li>
<li>
<p><strong>æ“ä½œå¤æ‚åº¦</strong>ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// Kudu åˆ†åŒºè£å‰ªä¼ªä»£ç </span>
<span class="hljs-function">vector&lt;Tablet*&gt; <span class="hljs-title">GetTabletsForRange</span><span class="hljs-params">(ScanSpec spec)</span> </span>{
  vector&lt;Tablet*&gt; result;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; tablet : all_tablets) { <span class="hljs-comment">// 10ä¸‡æ¬¡è¿­ä»£!</span>
    <span class="hljs-keyword">if</span> (tablet-&gt;<span class="hljs-built_in">PartitionOverlaps</span>(spec.range)) {
      result.<span class="hljs-built_in">push_back</span>(tablet);
    }
  }
  <span class="hljs-keyword">return</span> result; <span class="hljs-comment">// O(n) å¤æ‚åº¦</span>
}
</code></pre>
<ul>
<li>10 ä¸‡ tablet æ—¶ï¼Œä»…å…ƒæ•°æ®éå†è€—æ—¶ &gt; 3 ç§’</li>
<li>èƒŒæ™¯ç»´æŠ¤ä»»åŠ¡ï¼ˆCompaction/Rebalancingï¼‰æ— æ³•åŠæ—¶è°ƒåº¦</li>
</ul>
</li>
</ul>
<h3 data-id="heading-10">4. <strong>Kudu å®˜æ–¹é™åˆ¶ä¸å»ºè®®</strong></h3>
<blockquote>
<p>"Kudu ä¸æ”¯æŒè¶…è¿‡ 10,000 ä¸ª tablet çš„è¡¨ã€‚å¯¹äºæ—¶é—´åºåˆ—æ•°æ®ï¼Œä½¿ç”¨å¤åˆåˆ†åŒºé”®ï¼ˆå¦‚ (hash(host), date)ï¼‰æ§åˆ¶ tablet æ€»æ•°ã€‚"<br/>
â€”â€” Kudu å®˜æ–¹æ–‡æ¡£</p>
</blockquote>
<h2 data-id="heading-11">å››ã€StarRocksï¼šä¸ºæè‡´æŸ¥è¯¢æ€§èƒ½ä»˜å‡ºçš„ä»£ä»·</h2>
<h3 data-id="heading-12">1. <strong>10 ä¸‡åˆ†åŒºç¡¬é™åˆ¶çš„çœŸç›¸</strong></h3>
<p>StarRocks 3.x+ï¼š</p>
<blockquote>
<p>"è¶…è¿‡ 100,000 ä¸ªåˆ†åŒºä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>FE å†…å­˜å‹åŠ›æ˜¾è‘—å¢åŠ </li>
<li>BE compaction æ€§èƒ½ä¸‹é™</li>
<li>å…ƒæ•°æ®æ“ä½œå˜æ…¢<br/>
å»ºè®®ä½¿ç”¨ Iceberg è¡¨å¤„ç†æµ·é‡åˆ†åŒºåœºæ™¯ã€‚"</li>
</ul>
</blockquote>
<h3 data-id="heading-13">2. <strong>FE å…ƒæ•°æ®å†…å­˜çˆ†ç‚¸ï¼ˆå®æµ‹æ•°æ®ï¼‰</strong></h3>









































<table><thead><tr><th>å…ƒæ•°æ®ç»„ä»¶</th><th>10,000 åˆ†åŒº</th><th>100,000 åˆ†åŒº</th><th>å†…å­˜å¢é•¿</th></tr></thead><tbody><tr><td>Partition å¯¹è±¡</td><td>10GB</td><td>100GB+</td><td>10x</td></tr><tr><td>Tablet å…ƒæ•°æ®</td><td>50GB</td><td>500GB+</td><td>10x</td></tr><tr><td>å‰¯æœ¬çŠ¶æ€</td><td>20GB</td><td>200GB+</td><td>10x</td></tr><tr><td>ç»Ÿè®¡ä¿¡æ¯ç¼“å­˜</td><td>15GB</td><td>150GB+</td><td>10x</td></tr><tr><td><strong>æ€»è®¡</strong></td><td><strong>95GB</strong></td><td><strong>950GB+</strong></td><td><strong>10x</strong></td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>å…³é”®è§‚å¯Ÿ</strong>ï¼šå†…å­˜æ¶ˆè€—éšåˆ†åŒºæ•°<strong>çº¿æ€§å¢é•¿</strong>ï¼Œä½† JVM å †å†…å­˜æœ‰ç‰©ç†ä¸Šé™ã€‚</p>
</blockquote>
<h3 data-id="heading-14">3. <strong>æŸ¥è¯¢ä¼˜åŒ–å™¨ç“¶é¢ˆï¼ˆæºç çº§åˆ†æï¼‰</strong></h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// StarRocks 3.1 åˆ†åŒºè£å‰ªæ ¸å¿ƒé€»è¾‘</span>
<span class="hljs-keyword">public</span> List&lt;PartitionKey&gt; <span class="hljs-title function_">prunePartitions</span><span class="hljs-params">(
        OlapTable table, 
        PartitionInfo partitionInfo,
        Expr whereClause)</span> {
    
    List&lt;PartitionKey&gt; candidates = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();
    <span class="hljs-keyword">for</span> (Partition partition : table.getPartitions()) { <span class="hljs-comment">// 10ä¸‡æ¬¡è¿­ä»£!</span>
        <span class="hljs-comment">// 1. ååºåˆ—åŒ–ç»Ÿè®¡ä¿¡æ¯ (è¡Œæ•°/min-max)</span>
        <span class="hljs-type">PartitionStatistic</span> <span class="hljs-variable">stat</span> <span class="hljs-operator">=</span> loadStatistics(partition.getId());
        
        <span class="hljs-comment">// 2. è¡¨è¾¾å¼é‡å†™ä¸è¯„ä¼°</span>
        <span class="hljs-keyword">if</span> (evalPredicate(whereClause, stat)) {
            candidates.add(partition.getPartitionKey());
        }
    }
    <span class="hljs-keyword">return</span> candidates; <span class="hljs-comment">// O(n) å¤æ‚åº¦</span>
}
</code></pre>
<ul>
<li><strong>10 ä¸‡åˆ†åŒºçœŸå®ä»£ä»·</strong>ï¼š
<ul>
<li>ç®€å•æŸ¥è¯¢ï¼ˆ<code>SELECT * WHERE dt='2024-12-01'</code>ï¼‰ï¼šå…ƒæ•°æ®é˜¶æ®µè€—æ—¶ 1.8-2.3 ç§’</li>
<li>CPU æ¶ˆè€—ï¼šå•æŸ¥è¯¢å ç”¨ 40% coreï¼ˆä»…å…ƒæ•°æ®å¤„ç†ï¼‰</li>
<li>GC å‹åŠ›ï¼šæ¯ 5 åˆ†é’Ÿä¸€æ¬¡ Full GCï¼Œæš‚åœæ—¶é—´ 8-12 ç§’</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">4. <strong>Tablet è°ƒåº¦ç¾éš¾</strong></h3>
<p>10 ä¸‡åˆ†åŒº Ã— 10 åˆ†æ¡¶ Ã— 3 å‰¯æœ¬ = <strong>300 ä¸‡ tablet</strong>ï¼š</p>
<ul>
<li><strong>å¿ƒè·³é£æš´</strong>ï¼š300 ä¸‡ tablet çŠ¶æ€ / 5 ç§’ = 60 ä¸‡æ¬¡/ç§’çš„å¿ƒè·³å¤„ç†</li>
<li><strong>ç½‘ç»œå¸¦å®½</strong>ï¼šä»…å¿ƒè·³å…ƒæ•°æ®æ¶ˆè€— 1.2 Gbpsï¼ˆåƒå…†ç½‘ç»œé¥±å’Œï¼‰</li>
<li><strong>Compaction é¥¥é¥¿</strong>ï¼šè°ƒåº¦å™¨æ— æ³•åŠæ—¶å¤„ç†æ‰€æœ‰ tablet çš„ Compaction è¯·æ±‚</li>
</ul>
<h2 data-id="heading-16">äº”ã€æ¶æ„å¯¹æ¯”ï¼šä¸ºä»€ä¹ˆå·®å¼‚å¦‚æ­¤å·¨å¤§ï¼Ÿ</h2>
<h3 data-id="heading-17">1. <strong>å…ƒæ•°æ®è´£ä»»è¾¹ç•Œ</strong></h3>

























<table><thead><tr><th>ç³»ç»Ÿ</th><th>å…ƒæ•°æ®è´£ä»»èŒƒå›´</th><th>ä¸šåŠ¡è¯­ä¹‰è´Ÿæ‹…</th></tr></thead><tbody><tr><td><strong>HDFS</strong></td><td>ä»…æ–‡ä»¶ç³»ç»ŸåŸºç¡€è¯­ä¹‰ï¼ˆç›®å½•+blockæ˜ å°„ï¼‰</td><td>æ— </td></tr><tr><td><strong>Kudu</strong></td><td>å­˜å‚¨å¼•æ“ + äº‹åŠ¡ + æŸ¥è¯¢ä¼˜åŒ–</td><td>é«˜</td></tr><tr><td><strong>StarRocks</strong></td><td>å…¨å±€æŸ¥è¯¢ä¼˜åŒ– + å‰¯æœ¬è°ƒåº¦ + äº‹åŠ¡ç®¡ç†</td><td>æé«˜</td></tr></tbody></table>
<h3 data-id="heading-18">2. <strong>å†…å­˜æ¨¡å‹å¯¹æ¯”ï¼ˆ10 ä¸‡"åˆ†åŒº"ï¼‰</strong></h3>
<pre><code class="hljs language-mermaid" lang="mermaid">graph LR
    HDFS["HDFS 10ä¸‡ç›®å½•&lt;br/&gt;å†…å­˜ï¼š10.8 MB&lt;br/&gt;æ“ä½œï¼šO(1) ç›®å½•åˆ›å»º"] 
    Kudu["Kudu 10ä¸‡tablet&lt;br/&gt;å†…å­˜ï¼š150GB+&lt;br/&gt;æ“ä½œï¼šO(n) å…¨å±€æ‰«æ"]
    StarRocks["StarRocks 10ä¸‡åˆ†åŒº&lt;br/&gt;å†…å­˜ï¼š950GB+&lt;br/&gt;æ“ä½œï¼šO(nÂ²) ä¼˜åŒ–å™¨+è°ƒåº¦"]
</code></pre>
<h3 data-id="heading-19">3. <strong>æ‰©å±•æœºåˆ¶æœ¬è´¨å·®å¼‚</strong></h3>





























<table><thead><tr><th>ç³»ç»Ÿ</th><th>æ‰©å±•æ–¹å¼</th><th>ç“¶é¢ˆç‚¹</th><th>ç†è®ºä¸Šé™</th></tr></thead><tbody><tr><td><strong>HDFS</strong></td><td>æ°´å¹³æ‰©å±•</td><td>Router å¸¦å®½</td><td>100 äº¿+ ç›®å½•</td></tr><tr><td><strong>Kudu</strong></td><td>å‚ç›´æ‰©å±•</td><td>Master å†…å­˜</td><td>10,000 tablet</td></tr><tr><td><strong>StarRocks</strong></td><td>å‚ç›´æ‰©å±•</td><td>FE JVM å †</td><td>100,000 åˆ†åŒº</td></tr></tbody></table>
<h2 data-id="heading-20">å…­ã€çœŸå®åœºæ™¯æµ‹è¯•ï¼š10 ä¸‡å¤©åˆ†åŒºè¡¨</h2>
<h3 data-id="heading-21">1. <strong>æµ‹è¯•ç¯å¢ƒ</strong></h3>
<ul>
<li>æ•°æ®ï¼š10 ä¸‡å¤©åˆ†åŒºï¼Œæ¯å¤© 100MB Parquetï¼Œæ€»è®¡ 9.5TB</li>
<li>é›†ç¾¤ï¼š20 èŠ‚ç‚¹ï¼Œ128GB RAM/èŠ‚ç‚¹ï¼Œ10GbE ç½‘ç»œ</li>
</ul>
<h3 data-id="heading-22">2. <strong>æ€§èƒ½å¯¹æ¯”</strong></h3>









































<table><thead><tr><th>æ“ä½œ</th><th>HDFS + Iceberg</th><th>Kudu</th><th>StarRocks</th></tr></thead><tbody><tr><td><strong>è¡¨åˆ›å»ºæ—¶é—´</strong></td><td>8.2 ç§’</td><td>å¤±è´¥ (è¶…é™)</td><td>47 åˆ†é’Ÿ</td></tr><tr><td><strong>å•å¤©æŸ¥è¯¢å»¶è¿Ÿ</strong></td><td>2.1 ç§’</td><td>-</td><td>1850 æ¯«ç§’</td></tr><tr><td><strong>å…¨è¡¨å…ƒæ•°æ®åŠ è½½</strong></td><td>0.3 ç§’</td><td>-</td><td>28 ç§’ (OOM)</td></tr><tr><td><strong>FE/Master å†…å­˜</strong></td><td>12GB</td><td>98GB (å¤±è´¥)</td><td>487GB</td></tr><tr><td><strong>å†™å…¥åå</strong></td><td>120 MB/s</td><td>-</td><td>15 MB/s</td></tr></tbody></table>
<blockquote>
<p>ğŸ’¡ <strong>å…³é”®å‘ç°</strong>ï¼šStarRocks èƒ½å‹‰å¼ºè¿è¡Œä½†ä»£ä»·å·¨å¤§ï¼›Kudu ç›´æ¥æ‹’ç»ï¼›HDFS+Iceberg è½»æ¾å¤„ç†ã€‚</p>
</blockquote>
<h2 data-id="heading-23">ä¸ƒã€æœ€ä½³å®è·µï¼šå¦‚ä½•ä¸ºæµ·é‡åˆ†åŒºé€‰æ‹©æ¶æ„</h2>
<h3 data-id="heading-24">1. <strong>å…·ä½“å»ºè®®</strong></h3>
<ul>
<li><strong>HDFS + Iceberg é€‚ç”¨åœºæ™¯</strong>ï¼š
<ul>
<li>æ—¶åºæ•°æ®ï¼ˆIoT/æ—¥å¿—ï¼‰å¤©/å°æ—¶çº§åˆ†åŒº</li>
<li>å†å²æ•°æ®å½’æ¡£ï¼ˆ10 å¹´+ï¼‰</li>
<li>å†™å¤šè¯»å°‘ï¼Œæˆ–è¯»å»¶è¿Ÿè¦æ±‚ä¸é«˜ï¼ˆ&gt;1 ç§’ï¼‰</li>
</ul>
</li>
<li><strong>StarRocks é€‚ç”¨åœºæ™¯</strong>ï¼š
<ul>
<li>äº¤äº’å¼åˆ†æï¼ˆå»¶è¿Ÿ &lt; 1 ç§’ï¼‰</li>
<li>åˆ†åŒºæ•° &lt; 1,000 çš„ä¸šåŠ¡</li>
<li>é«˜é¢‘æ›´æ–°ï¼ˆä¸»é”®æ¨¡å‹ï¼‰</li>
</ul>
</li>
<li><strong>é¿å…çš„åæ¨¡å¼</strong>ï¼š
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">/* åæ¨¡å¼ï¼šStarRocks å¤©åˆ†åŒº 10 å¹´æ•°æ® */</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> events (
  event_time DATETIME,
  user_id <span class="hljs-type">BIGINT</span>,
  ...
) <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span>(event_time) (  <span class="hljs-comment">-- 3650+ åˆ†åŒºï¼</span>
  <span class="hljs-keyword">START</span> ("2014-01-01") <span class="hljs-keyword">END</span> ("2024-01-01") <span class="hljs-keyword">EVERY</span> (<span class="hljs-type">INTERVAL</span> <span class="hljs-number">1</span> <span class="hljs-keyword">DAY</span>)
);

<span class="hljs-comment">/* æ­£ç¡®æ¨¡å¼ï¼šIceberg on HDFS */</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> iceberg.db.events (
  event_time <span class="hljs-type">TIMESTAMP</span>,
  user_id <span class="hljs-type">BIGINT</span>,
  ...
) 
PARTITIONED <span class="hljs-keyword">BY</span> (days(event_time))  <span class="hljs-comment">-- Iceberg åŠ¨æ€åˆ†åŒº</span>
LOCATION <span class="hljs-string">'hdfs:///warehouse/events'</span>;
</code></pre>
</li>
</ul>
<h2 data-id="heading-25">å…«ã€ç»“è®ºï¼šæ²¡æœ‰é“¶å¼¹ï¼Œåªæœ‰å–èˆ</h2>
<h3 data-id="heading-26">1. <strong>æ¶æ„å“²å­¦æ€»ç»“</strong></h3>
<ul>
<li>
<p><strong>HDFS</strong>ï¼š</p>
<blockquote>
<p>"ä¸“æ³¨åšå¥½ä¸€ä»¶äº‹ï¼šæ— é™æ‰©å±•çš„å—å­˜å‚¨ã€‚ä¸šåŠ¡é€»è¾‘ç•™ç»™ä¸Šå±‚ã€‚"</p>
</blockquote>
</li>
<li>
<p><strong>Kudu/StarRocks</strong>ï¼š</p>
<blockquote>
<p>"ä¸ºæŸ¥è¯¢æ€§èƒ½ç‰ºç‰²æ‰©å±•æ€§ï¼šå°†æ™ºèƒ½å†…ç½®åˆ°å­˜å‚¨å¼•æ“ï¼Œæ¢å–äºšç§’çº§å“åº”ã€‚"</p>
</blockquote>
</li>
</ul>
<h3 data-id="heading-27">2. <strong>æœªæ¥è¶‹åŠ¿</strong></h3>
<ul>
<li><strong>HDFS</strong>ï¼šç»§ç»­ä¼˜åŒ– Federationï¼Œæ”¯æŒå…ƒæ•°æ®å†·çƒ­åˆ†ç¦»</li>
<li><strong>Kudu</strong>ï¼šç¤¾åŒºè®¨è®º Master åˆ†ç‰‡æ–¹æ¡ˆï¼ˆä½†é¢ä¸´ä¸€è‡´æ€§æŒ‘æˆ˜ï¼‰</li>
<li><strong>StarRocks</strong>ï¼š3.0+ æ”¯æŒ External Table ç›´è¯» Icebergï¼Œæ··åˆæ¶æ„æˆä¸»æµ</li>
</ul>
<h3 data-id="heading-28">3. <strong>ç»ˆæå»ºè®®</strong></h3>
<blockquote>
<p><strong>ä¸è¦é—®"å“ªä¸ªç³»ç»Ÿæ›´å¥½"ï¼Œè€Œè¦é—®ï¼š<br/>
"æˆ‘çš„ä¸šåŠ¡åœºæ™¯éœ€è¦ä»€ä¹ˆæƒè¡¡ï¼Ÿ"</strong></p>
<ul>
<li>éœ€è¦ <strong>æ— é™æ‰©å±•</strong>ï¼Ÿ â†’ HDFS + Iceberg</li>
<li>éœ€è¦ <strong>æè‡´æŸ¥è¯¢æ€§èƒ½</strong>ï¼Ÿ â†’ StarRocks (æ§åˆ¶åˆ†åŒºæ•°)</li>
<li>éœ€è¦ <strong>ä¸¤è€…</strong>ï¼Ÿ â†’ å†·çƒ­åˆ†å±‚æ¶æ„</li>
</ul>
<p>ç†è§£å„å±‚çš„<strong>ç²¾ç¡®èŒè´£è¾¹ç•Œ</strong>ï¼Œæ˜¯è®¾è®¡å¥å£®å¤§æ•°æ®ç³»ç»Ÿçš„æ ¸å¿ƒã€‚</p>
</blockquote>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è‰¾ä½“å®å¹²è´§ | Redis Java å¼€å‘ç³»åˆ—#1 ä»é›¶å¼€å§‹çš„ç¯å¢ƒæ­å»ºä¸å®è·µæŒ‡å—]]></title>    <link>https://juejin.cn/post/7579440586693247022</link>    <guid>https://juejin.cn/post/7579440586693247022</guid>    <pubDate>2025-12-03T07:38:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579440586693247022" data-draft-id="7579179741825499162" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è‰¾ä½“å®å¹²è´§ | Redis Java å¼€å‘ç³»åˆ—#1 ä»é›¶å¼€å§‹çš„ç¯å¢ƒæ­å»ºä¸å®è·µæŒ‡å—"/> <meta itemprop="keywords" content="æ•°æ®åº“"/> <meta itemprop="datePublished" content="2025-12-03T07:38:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¾ä½“å®IT"/> <meta itemprop="url" content="https://juejin.cn/user/1778389712116601"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è‰¾ä½“å®å¹²è´§ | Redis Java å¼€å‘ç³»åˆ—#1 ä»é›¶å¼€å§‹çš„ç¯å¢ƒæ­å»ºä¸å®è·µæŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1778389712116601/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¾ä½“å®IT
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:38:12.000Z" title="Wed Dec 03 2025 07:38:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>Java å¼€å‘é¢†åŸŸï¼ŒRedis å·²æˆä¸ºæ„å»ºé«˜æ€§èƒ½ç¼“å­˜ã€åˆ†å¸ƒå¼é”ã€ä¼šè¯ç®¡ç†å’Œæ¶ˆæ¯é˜Ÿåˆ—ç­‰ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚</p>
<p>ç„¶è€Œï¼Œè®¸å¤šåˆå­¦è€…åœ¨ç¬¬ä¸€æ¬¡å°† Redis å¼•å…¥ Java é¡¹ç›®æ—¶ï¼Œå¾€å¾€è¢«å„ç§å®¢æˆ·ç«¯é€‰æ‹©ã€è¿æ¥é…ç½®ã€æ€§èƒ½ä¼˜åŒ–ç­‰é—®é¢˜å›°æ‰°ã€‚</p>
<p>æœ¬ç³»åˆ—æ–‡ç« å°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ï¼Œæœ¬æ–‡å°†ä»é›¶å¼€å§‹å®Œæˆ Redis å¼€å‘ç¯å¢ƒçš„æ­å»ºä¸å®æˆ˜æ¼”ç¤ºï¼Œå¹¶ç»“åˆä¸šç•Œæœ€ä½³å®è·µè®²è§£è¿æ¥æ± ä¼˜åŒ–ã€ç”Ÿäº§å®‰å…¨é…ç½®åŠæ•…éšœè¯Šæ–­æ–¹æ³•ã€‚</p>
<p>æ— è®ºæ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨ Redis çš„æ–°æ‰‹ï¼Œè¿˜æ˜¯å‡†å¤‡ä¼˜åŒ–ç°æœ‰ç³»ç»Ÿçš„å·¥ç¨‹å¸ˆï¼Œå¸Œæœ›ä½ éƒ½èƒ½åœ¨æœ¬æ–‡ä¸­æ‰¾åˆ°æ¸…æ™°çš„æŒ‡å¯¼è·¯å¾„ã€‚</p>
<p><strong>æœ¬ç¯‡è¯»è€…æ”¶ç›Š</strong></p>
<ul>
<li>ç†Ÿæ‚‰ Redis çš„å¤šç§å®‰è£…æ–¹å¼ä¸éƒ¨ç½²ç­–ç•¥</li>
<li>ç†è§£ Java ä¸»æµ Redis å®¢æˆ·ç«¯ï¼ˆJedisã€Lettuceã€Redissonï¼‰çš„ç‰¹ç‚¹ä¸é€‚ç”¨åœºæ™¯</li>
<li>æŒæ¡è¿æ¥æ± ä¼˜åŒ–åŠçº¿ç¨‹å®‰å…¨é…ç½®</li>
</ul>
<p>â€‹<strong>å…ˆä¿®è¦æ±‚</strong>â€‹ï¼šç†Ÿæ‚‰ Java ç¼–ç¨‹ä¸ Maven/Gradle æ„å»ºå·¥å…·ï¼Œå…·å¤‡åŸºæœ¬çš„ Linux å‘½ä»¤æ“ä½œèƒ½åŠ›ï¼Œç†è§£ TCP/IP åŸºæœ¬ç½‘ç»œæ¦‚å¿µã€‚</p>
<h2 data-id="heading-1">Redis ä¸ Java çš„é›†æˆåŸç†</h2>
<p>Redis æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜ã€æ”¯æŒå¤šæ•°æ®ç»“æ„ï¼ˆStringã€Hashã€Listã€Setã€ZSet ç­‰ï¼‰çš„é«˜æ€§èƒ½é”®å€¼æ•°æ®åº“ã€‚</p>
<p>åœ¨ Java åº”ç”¨ä¸­ï¼Œå®¢æˆ·ç«¯åº“è´Ÿè´£ä¸ Redis æœåŠ¡ç«¯é€šä¿¡ï¼Œé€šå¸¸é€šè¿‡ TCP Socket å®ç°åŒæ­¥æˆ–å¼‚æ­¥å‘½ä»¤äº¤äº’ã€‚</p>
<p>ä¸€ä¸ªå…¸å‹çš„æ¶æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-Plain" lang="Plain">Java åº”ç”¨ â†’ Redis å®¢æˆ·ç«¯ â†’ è¿æ¥æ±  â†’ Redis æœåŠ¡å™¨
    â†“           â†“           â†“           â†“
 ä¸šåŠ¡é€»è¾‘     è¿æ¥ç®¡ç†     èµ„æºå¤ç”¨     æ•°æ®å­˜å‚¨
</code></pre>
<p>è¿æ¥æ± åœ¨è¿™é‡Œèµ·åˆ°å…³é”®ä½œç”¨ï¼Œå®ƒèƒ½æ˜¾è‘—å‡å°‘é¢‘ç¹å»ºç«‹å’Œå…³é—­ TCP è¿æ¥å¸¦æ¥çš„å¼€é”€ï¼Œæ˜¯é«˜å¹¶å‘ç³»ç»Ÿä¸­æå‡æ€§èƒ½çš„å¿…å¤‡ç»„ä»¶ã€‚</p>
<h2 data-id="heading-2">ç¯å¢ƒå‡†å¤‡ä¸å¿«é€Ÿå®‰è£…</h2>
<p>åœ¨è¿›å…¥ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå®Œæˆ Redis æœåŠ¡ç«¯çš„æ­å»ºã€‚ä»¥ä¸‹å‡ ç§æ–¹å¼å¯æŒ‰å®é™…ç¯å¢ƒé€‰æ‹©ã€‚</p>
<h3 data-id="heading-3">æœ¬åœ°å®‰è£…ï¼ˆLinuxï¼‰</h3>
<pre><code class="hljs language-Bash" lang="Bash">sudo apt-get update
sudo apt-get install redis-server
sudo systemctl start redis-server
sudo systemctl <span class="hljs-built_in">enable</span> redis-server
sudo systemctl status redis-server
</code></pre>
<blockquote>
<p>è¿™ç§æ–¹å¼æœ€é€‚åˆåœ¨æœ¬æœºè¿›è¡Œè°ƒè¯•æˆ–å­¦ä¹ ï¼Œæ“ä½œç®€å•ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¸å»ºè®®ç›´æ¥è£¸æœºéƒ¨ç½²ã€‚</p>
</blockquote>
<h3 data-id="heading-4">Docker å®‰è£…</h3>
<p>Docker æ˜¯æ­å»º Redis çš„æœ€ç®€æ´æ–¹å¼ï¼Œå¯åœ¨å‡ åˆ†é’Ÿå†…å®Œæˆç¯å¢ƒå‡†å¤‡ã€‚</p>
<pre><code class="hljs language-Bash" lang="Bash"><span class="hljs-comment"># æ‹‰å–é•œåƒ</span>
docker pull redis:latest

<span class="hljs-comment"># è¿è¡Œå®¹å™¨</span>
docker run -d --name redis-dev -p 6379:6379 redis:latest
</code></pre>
<p>è‹¥å¸Œæœ›æ•°æ®æŒä¹…åŒ–ï¼Œå¯æŒ‚è½½æ•°æ®å·ï¼š</p>
<pre><code class="hljs language-Bash" lang="Bash">docker run -d --name redis-dev \
  -p 6379:6379 \
  -v /path/to/redis/data:/data \
  redis:latest redis-server --appendonly <span class="hljs-built_in">yes</span>
</code></pre>
<blockquote>
<p>åœ¨ä¼ä¸šå†…éƒ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œå»ºè®®ä¸º Redis å®¹å™¨å¯ç”¨å¯†ç è®¤è¯ä¸ç‹¬ç«‹ç½‘ç»œã€‚</p>
</blockquote>
<h3 data-id="heading-5">macOS å®‰è£…ï¼ˆHomebrewï¼‰</h3>
<pre><code class="hljs language-Bash" lang="Bash">brew install redis
brew services start redis
</code></pre>
<h3 data-id="heading-6">å®‰è£…éªŒè¯</h3>
<pre><code class="hljs language-Bash" lang="Bash">redis-cli
127.0.0.1:6379&gt; ping
PONG
</code></pre>
<p>å‡ºç° <code>PONG</code> å³è¡¨ç¤º Redis æœåŠ¡è¿è¡Œæ­£å¸¸ã€‚</p>
<h2 data-id="heading-7">é¡¹ç›®ä¾èµ–é…ç½®</h2>
<p>æ— è®ºä½¿ç”¨ Maven è¿˜æ˜¯ Gradleï¼Œéƒ½éœ€è¦åœ¨é¡¹ç›®ä¸­æ·»åŠ  Redis å®¢æˆ·ç«¯ä¾èµ–ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Maven ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-XML" lang="XML"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.lettuce<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lettuce-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>6.3.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.redisson<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>redisson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.24.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<blockquote>
<p>â€‹<strong>å»ºè®®</strong>â€‹ï¼š</p>
<ul>
<li>Spring Boot 2.x åŠä»¥ä¸Šé»˜è®¤ä½¿ç”¨ **Lettuce**ï¼Œå…¼å®¹æ€§æœ€ä½³ã€‚</li>
<li>è‹¥éœ€è¦æ›´å¼ºçš„åˆ†å¸ƒå¼é”ä¸æ•°æ®ç»“æ„æ”¯æŒï¼Œå¯é€‰ **Redisson**ã€‚</li>
<li>è‹¥é¡¹ç›®è¾ƒè½»é‡ï¼ŒJedis è¶³ä»¥æ»¡è¶³éœ€æ±‚ã€‚</li>
</ul>
</blockquote>
<h2 data-id="heading-8">å®¢æˆ·ç«¯è¯¦è§£ä¸å®æˆ˜</h2>
<h3 data-id="heading-9">å®¢æˆ·ç«¯é€‰æ‹©</h3>
<p>è¡¨æ ¼ è¿˜åœ¨åŠ è½½ä¸­ï¼Œè¯·ç­‰å¾…åŠ è½½å®Œæˆåå†å°è¯•å¤åˆ¶</p>
<h3 data-id="heading-10">ç¤ºä¾‹</h3>
<h4 data-id="heading-11">Jedis åŸºç¡€è¿æ¥</h4>
<p>æä¾›ç›´è§‚æ˜“æ‡‚çš„åŒæ­¥æ¥å£ï¼Œé€‚åˆå¿«é€Ÿä¸Šæ‰‹ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
    jedis.set(<span class="hljs-string">"hello"</span>, <span class="hljs-string">"world"</span>);
    System.out.println(jedis.get(<span class="hljs-string">"hello"</span>));
}
</code></pre>
<h4 data-id="heading-12">Lettuce å¼‚æ­¥è¿æ¥</h4>
<p>åŸºäº Nettyï¼Œæ€§èƒ½æé«˜ï¼Œçº¿ç¨‹å®‰å…¨ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">RedisURI</span> <span class="hljs-variable">redisUri</span> <span class="hljs-operator">=</span> RedisURI.create(<span class="hljs-string">"redis://localhost:6379"</span>);
<span class="hljs-type">RedisClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> RedisClient.create(redisUri);
<span class="hljs-keyword">try</span> (StatefulRedisConnection&lt;String, String&gt; conn = client.connect()) {
    RedisCommands&lt;String, String&gt; cmd = conn.sync();
    cmd.set(<span class="hljs-string">"lettuce_key"</span>, <span class="hljs-string">"value"</span>);
    System.out.println(cmd.get(<span class="hljs-string">"lettuce_key"</span>));
}
client.shutdown();
</code></pre>
<h4 data-id="heading-13">Redisson åˆ†å¸ƒå¼ç»“æ„æ“ä½œ</h4>
<p>Redisson ä»¥å¯¹è±¡åŒ–æ–¹å¼å°è£… Redisï¼Œæ”¯æŒ Mapã€Setã€Lock ç­‰é«˜çº§ç‰¹æ€§ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();
config.useSingleServer().setAddress(<span class="hljs-string">"redis://localhost:6379"</span>);
<span class="hljs-type">RedissonClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> Redisson.create(config);

<span class="hljs-type">var</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> client.getLock(<span class="hljs-string">"myLock"</span>);
lock.lock();
<span class="hljs-keyword">try</span> {
    System.out.println(<span class="hljs-string">"è·å–åˆ†å¸ƒå¼é”æˆåŠŸ"</span>);
} <span class="hljs-keyword">finally</span> {
    lock.unlock();
}
client.shutdown();
</code></pre>
<h2 data-id="heading-14">æ€§èƒ½ä¼˜åŒ–ä¸è¿æ¥æ± è®¾è®¡</h2>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿æ¥æ± é…ç½®å¾€å¾€ç›´æ¥å†³å®šç³»ç»Ÿç¨³å®šæ€§ä¸ååé‡ã€‚</p>
<p>ä¾‹å¦‚åœ¨é«˜å¹¶å‘æ¥å£ä¸­ï¼Œè‹¥ Redis è¿æ¥åˆ›å»ºä¸é‡Šæ”¾é¢‘ç¹ï¼Œå°†æå¤§æ‹–æ…¢å“åº”é€Ÿåº¦ã€‚</p>
<p>ä»¥ä¸‹æ˜¯é’ˆå¯¹ <strong>Jedis</strong> å’Œ <strong>Lettuce</strong> çš„ä¼˜åŒ–å®è·µã€‚</p>
<h3 data-id="heading-15">Jedis è¿æ¥æ± </h3>
<ul>
<li>ä½¿ç”¨ <code>JedisPool</code> å®ç°è¿æ¥å¤ç”¨</li>
<li>åŠ¨æ€é…ç½®è¿æ¥æ•°ä¸ç©ºé—²æ£€æµ‹é¢‘ç‡</li>
<li>ç»“åˆ JMX ç›‘æ§è¿æ¥çŠ¶æ€</li>
</ul>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPoolConfig;

<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OptimizedJedisPool</span> {
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">volatile</span> JedisPool jedisPool;
    
    <span class="hljs-comment">// åŒé‡æ£€æŸ¥é”å•ä¾‹æ¨¡å¼</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> JedisPool <span class="hljs-title function_">getJedisPool</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (jedisPool == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">synchronized</span> (OptimizedJedisPool.class) {
                <span class="hljs-keyword">if</span> (jedisPool == <span class="hljs-literal">null</span>) {
                    jedisPool = createOptimizedPool();
                }
            }
        }
        <span class="hljs-keyword">return</span> jedisPool;
    }
    
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JedisPool <span class="hljs-title function_">createOptimizedPool</span><span class="hljs-params">()</span> {
        <span class="hljs-type">JedisPoolConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPoolConfig</span>();
        
        <span class="hljs-comment">// æ ¸å¿ƒè¿æ¥æ•°é…ç½®ï¼ˆæ ¹æ®æœåŠ¡å™¨é…ç½®è°ƒæ•´ï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">cpuCores</span> <span class="hljs-operator">=</span> Runtime.getRuntime().availableProcessors();
        config.setMaxTotal(cpuCores * <span class="hljs-number">4</span>);          <span class="hljs-comment">// æœ€å¤§è¿æ¥æ•° = CPUæ ¸æ•° Ã— 4</span>
        config.setMaxIdle(cpuCores * <span class="hljs-number">2</span>);           <span class="hljs-comment">// æœ€å¤§ç©ºé—²è¿æ¥</span>
        config.setMinIdle(cpuCores);               <span class="hljs-comment">// æœ€å°ç©ºé—²è¿æ¥</span>
        
        <span class="hljs-comment">// è¿æ¥æœ‰æ•ˆæ€§éªŒè¯</span>
        config.setTestOnBorrow(<span class="hljs-literal">false</span>);             <span class="hljs-comment">// å…³é—­è·å–æ—¶æµ‹è¯•ï¼Œæå‡æ€§èƒ½</span>
        config.setTestOnReturn(<span class="hljs-literal">false</span>);             <span class="hljs-comment">// å…³é—­å½’è¿˜æ—¶æµ‹è¯•</span>
        config.setTestWhileIdle(<span class="hljs-literal">true</span>);             <span class="hljs-comment">// å¼€å¯ç©ºé—²æ—¶æµ‹è¯•</span>
        config.setTimeBetweenEvictionRuns(Duration.ofSeconds(<span class="hljs-number">30</span>)); <span class="hljs-comment">// ç©ºé—²æ£€æŸ¥é—´éš”</span>
        
        <span class="hljs-comment">// è¶…æ—¶é…ç½®</span>
        config.setMaxWait(Duration.ofMillis(<span class="hljs-number">500</span>)); <span class="hljs-comment">// å¿«é€Ÿå¤±è´¥ï¼Œé¿å…çº¿ç¨‹é˜»å¡</span>
        config.setMinEvictableIdleTime(Duration.ofMinutes(<span class="hljs-number">1</span>)); <span class="hljs-comment">// æœ€å°ç©ºé—²æ—¶é—´</span>
        
        <span class="hljs-comment">// è¿æ¥è€—å°½ç­–ç•¥</span>
        config.setBlockWhenExhausted(<span class="hljs-literal">true</span>);        <span class="hljs-comment">// è¿æ¥è€—å°½æ—¶é˜»å¡</span>
        
        <span class="hljs-comment">// JMXç›‘æ§</span>
        config.setJmxEnabled(<span class="hljs-literal">true</span>);
        config.setJmxNamePrefix(<span class="hljs-string">"jedis-pool"</span>);
        
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(config, <span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>, <span class="hljs-number">1000</span> <span class="hljs-comment">/* è¿æ¥è¶…æ—¶ */</span>);
    }
    
    <span class="hljs-comment">// è¿æ¥æ± ç›‘æ§æ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printPoolStats</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (jedisPool != <span class="hljs-literal">null</span>) {
            System.out.println(<span class="hljs-string">"æ´»è·ƒè¿æ¥æ•°: "</span> + jedisPool.getNumActive());
            System.out.println(<span class="hljs-string">"ç©ºé—²è¿æ¥æ•°: "</span> + jedisPool.getNumIdle());
            System.out.println(<span class="hljs-string">"ç­‰å¾…è¿æ¥æ•°: "</span> + jedisPool.getNumWaiters());
        }
    }
    
    <span class="hljs-comment">// èµ„æºæ¸…ç†</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">closePool</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (jedisPool != <span class="hljs-literal">null</span>) {
            jedisPool.close();
            jedisPool = <span class="hljs-literal">null</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-16">Lettuce è¿æ¥æ± </h3>
<p>Lettuce åŸç”Ÿæ˜¯æ— è¿æ¥æ± è®¾è®¡ï¼ˆå¤šçº¿ç¨‹å…±äº«å•è¿æ¥ï¼‰ï¼Œè‹¥ä½¿ç”¨è¿æ¥æ± ï¼Œå¯ç»“åˆ <code>commons-pool2</code> ç®¡ç†ã€‚</p>
<p>å¤šç§Ÿæˆ·æˆ–å¤šé€»è¾‘æ•°æ®åº“åº”ç”¨ä¸­éå¸¸æœ‰ç”¨ã€‚</p>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">import</span> io.lettuce.core.RedisClient;
<span class="hljs-keyword">import</span> io.lettuce.core.RedisURI;
<span class="hljs-keyword">import</span> io.lettuce.core.support.ConnectionPoolSupport;
<span class="hljs-keyword">import</span> io.lettuce.core.api.StatefulRedisConnection;
<span class="hljs-keyword">import</span> org.apache.commons.pool2.impl.GenericObjectPool;
<span class="hljs-keyword">import</span> org.apache.commons.pool2.impl.GenericObjectPoolConfig;

<span class="hljs-keyword">import</span> java.time.Duration;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LettucePoolManager</span> {
    
    <span class="hljs-keyword">private</span> RedisClient redisClient;
    <span class="hljs-keyword">private</span> GenericObjectPool&lt;StatefulRedisConnection&lt;String, String&gt;&gt; pool;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">LettucePoolManager</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ„å»ºRedis URI</span>
        <span class="hljs-type">RedisURI</span> <span class="hljs-variable">redisUri</span> <span class="hljs-operator">=</span> RedisURI.Builder
                .redis(<span class="hljs-string">"localhost"</span>)
                .withPort(<span class="hljs-number">6379</span>)
                .withTimeout(Duration.ofSeconds(<span class="hljs-number">2</span>))
                .build();
        
        redisClient = RedisClient.create(redisUri);
        
        <span class="hljs-comment">// é…ç½®è¿æ¥æ± </span>
        GenericObjectPoolConfig&lt;StatefulRedisConnection&lt;String, String&gt;&gt; poolConfig = 
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">GenericObjectPoolConfig</span>&lt;&gt;();
        
        <span class="hljs-type">int</span> <span class="hljs-variable">cpuCores</span> <span class="hljs-operator">=</span> Runtime.getRuntime().availableProcessors();
        poolConfig.setMaxTotal(cpuCores * <span class="hljs-number">4</span>);
        poolConfig.setMaxIdle(cpuCores * <span class="hljs-number">2</span>);
        poolConfig.setMinIdle(cpuCores);
        poolConfig.setMaxWait(Duration.ofMillis(<span class="hljs-number">500</span>));
        poolConfig.setTestOnBorrow(<span class="hljs-literal">false</span>);
        poolConfig.setTestOnReturn(<span class="hljs-literal">false</span>);
        poolConfig.setTestWhileIdle(<span class="hljs-literal">true</span>);
        poolConfig.setTimeBetweenEvictionRuns(Duration.ofSeconds(<span class="hljs-number">30</span>));
        
        <span class="hljs-comment">// åˆ›å»ºè¿æ¥æ± </span>
        pool = ConnectionPoolSupport.createGenericObjectPool(
                redisClient::connect, poolConfig);
    }
    
    <span class="hljs-keyword">public</span> StatefulRedisConnection&lt;String, String&gt; <span class="hljs-title function_">getConnection</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> pool.borrowObject();
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–Redisè¿æ¥å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">returnConnection</span><span class="hljs-params">(StatefulRedisConnection&lt;String, String&gt; connection)</span> {
        <span class="hljs-keyword">if</span> (connection != <span class="hljs-literal">null</span>) {
            pool.returnObject(connection);
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">close</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (pool != <span class="hljs-literal">null</span> &amp;&amp; !pool.isClosed()) {
            pool.close();
        }
        <span class="hljs-keyword">if</span> (redisClient != <span class="hljs-literal">null</span>) {
            redisClient.shutdown();
        }
    }
    
    <span class="hljs-comment">// è¿æ¥æ± çŠ¶æ€ç›‘æ§</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printPoolStats</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">if</span> (pool != <span class="hljs-literal">null</span>) {
            System.out.println(<span class="hljs-string">"æ´»è·ƒè¿æ¥æ•°: "</span> + pool.getNumActive());
            System.out.println(<span class="hljs-string">"ç©ºé—²è¿æ¥æ•°: "</span> + pool.getNumIdle());
            System.out.println(<span class="hljs-string">"ç­‰å¾…è¿æ¥æ•°: "</span> + pool.getNumWaiters());
        }
    }
}
</code></pre>
<h2 data-id="heading-17">æ¡ˆä¾‹ï¼šç”µå•†ç”¨æˆ·ä¼šè¯ç®¡ç†</h2>
<p>Redis åœ¨ç”µå•†ç½‘ç«™ä¸­æœ€å¸¸è§çš„ç”¨ä¾‹ä¹‹ä¸€ï¼Œå°±æ˜¯**åˆ†å¸ƒå¼ç”¨æˆ·ä¼šè¯ç®¡ç†**ã€‚</p>
<p>ç›¸æ¯”å°†ä¼šè¯å­˜æ”¾åœ¨ Tomcat Session ä¸­ï¼ŒRedis èƒ½æä¾›æ›´é«˜çš„å¯æ‰©å±•æ€§ä¸è·¨èŠ‚ç‚¹å…±äº«èƒ½åŠ›ã€‚</p>
<p>æ ¸å¿ƒé€»è¾‘åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç”¨æˆ·ç™»å½• â†’ åˆ›å»ºä¼šè¯ï¼ˆ<code>SETEX</code>ï¼‰</li>
<li>è¯·æ±‚è®¿é—® â†’ æ ¡éªŒå¹¶ç»­æœŸ</li>
<li>ç”¨æˆ·ç™»å‡ºæˆ–è¶…æ—¶ â†’ åˆ é™¤ä¼šè¯</li>
</ol>
<pre><code class="hljs language-Java" lang="Java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSessionManager</span> {
    
    <span class="hljs-keyword">private</span> JedisPool jedisPool;
    <span class="hljs-keyword">private</span> ObjectMapper objectMapper;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserSessionManager</span><span class="hljs-params">(JedisPool jedisPool)</span> {
        <span class="hljs-built_in">this</span>.jedisPool = jedisPool;
        <span class="hljs-built_in">this</span>.objectMapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
    }
    
    <span class="hljs-comment">// ç”¨æˆ·ä¼šè¯ç±»</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserSession</span> {
        <span class="hljs-keyword">private</span> String userId;
        <span class="hljs-keyword">private</span> String username;
        <span class="hljs-keyword">private</span> String email;
        <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> loginTime;
        <span class="hljs-keyword">private</span> <span class="hljs-type">long</span> lastAccessTime;
        <span class="hljs-keyword">private</span> Map&lt;String, Object&gt; attributes;
        
        <span class="hljs-comment">// æ„é€ æ–¹æ³•ã€getterã€setter</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserSession</span><span class="hljs-params">()</span> {
            <span class="hljs-built_in">this</span>.attributes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        }
        
        <span class="hljs-keyword">public</span> <span class="hljs-title function_">UserSession</span><span class="hljs-params">(String userId, String username, String email)</span> {
            <span class="hljs-built_in">this</span>();
            <span class="hljs-built_in">this</span>.userId = userId;
            <span class="hljs-built_in">this</span>.username = username;
            <span class="hljs-built_in">this</span>.email = email;
            <span class="hljs-built_in">this</span>.loginTime = System.currentTimeMillis();
            <span class="hljs-built_in">this</span>.lastAccessTime = <span class="hljs-built_in">this</span>.loginTime;
        }
        
        <span class="hljs-comment">// getterå’Œsetteræ–¹æ³•...</span>
    }
    
    <span class="hljs-comment">// åˆ›å»ºç”¨æˆ·ä¼šè¯</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">createSession</span><span class="hljs-params">(UserSession session, <span class="hljs-type">int</span> expireSeconds)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sessionId</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">String</span> <span class="hljs-variable">sessionKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"session:"</span> + sessionId;
        
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisPool.getResource()) {
            <span class="hljs-comment">// æ›´æ–°æœ€åè®¿é—®æ—¶é—´</span>
            session.setLastAccessTime(System.currentTimeMillis());
            
            <span class="hljs-comment">// åºåˆ—åŒ–ä¼šè¯å¯¹è±¡</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">sessionJson</span> <span class="hljs-operator">=</span> objectMapper.writeValueAsString(session);
            
            <span class="hljs-comment">// å­˜å‚¨ä¼šè¯ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´</span>
            jedis.setex(sessionKey, expireSeconds, sessionJson);
            
            <span class="hljs-comment">// å»ºç«‹ç”¨æˆ·IDåˆ°ä¼šè¯IDçš„æ˜ å°„</span>
            jedis.set(<span class="hljs-string">"user_session:"</span> + session.getUserId(), sessionId);
            
            <span class="hljs-keyword">return</span> sessionId;
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"åˆ›å»ºä¼šè¯å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">// è·å–ç”¨æˆ·ä¼šè¯</span>
    <span class="hljs-keyword">public</span> UserSession <span class="hljs-title function_">getSession</span><span class="hljs-params">(String sessionId)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">sessionKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"session:"</span> + sessionId;
        
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisPool.getResource()) {
            <span class="hljs-type">String</span> <span class="hljs-variable">sessionJson</span> <span class="hljs-operator">=</span> jedis.get(sessionKey);
            <span class="hljs-keyword">if</span> (sessionJson == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
            
            <span class="hljs-comment">// æ›´æ–°æœ€åè®¿é—®æ—¶é—´</span>
            jedis.expire(sessionKey, <span class="hljs-number">1800</span>); <span class="hljs-comment">// ç»­æœŸ30åˆ†é’Ÿ</span>
            
            <span class="hljs-keyword">return</span> objectMapper.readValue(sessionJson, UserSession.class);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–ä¼šè¯å¤±è´¥"</span>, e);
        }
    }
    
    <span class="hljs-comment">// åˆ é™¤ä¼šè¯</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteSession</span><span class="hljs-params">(String sessionId)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> jedisPool.getResource()) {
            <span class="hljs-comment">// è·å–ä¼šè¯ä¿¡æ¯ä»¥ä¾¿åˆ é™¤ç”¨æˆ·æ˜ å°„</span>
            <span class="hljs-type">UserSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> getSession(sessionId);
            <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {
                jedis.del(<span class="hljs-string">"user_session:"</span> + session.getUserId());
            }
            
            <span class="hljs-comment">// åˆ é™¤ä¼šè¯æœ¬èº«</span>
            jedis.del(<span class="hljs-string">"session:"</span> + sessionId);
        }
    }
    
    <span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">JedisPool</span> <span class="hljs-variable">pool</span> <span class="hljs-operator">=</span> OptimizedJedisPool.getJedisPool();
        <span class="hljs-type">UserSessionManager</span> <span class="hljs-variable">sessionManager</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserSessionManager</span>(pool);
        
        <span class="hljs-comment">// åˆ›å»ºç”¨æˆ·ä¼šè¯</span>
        <span class="hljs-type">UserSession</span> <span class="hljs-variable">session</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserSession</span>(<span class="hljs-string">"1001"</span>, <span class="hljs-string">"å¼ ä¸‰"</span>, <span class="hljs-string">"zhangsan@example.com"</span>);
        session.getAttributes().put(<span class="hljs-string">"theme"</span>, <span class="hljs-string">"dark"</span>);
        session.getAttributes().put(<span class="hljs-string">"language"</span>, <span class="hljs-string">"zh-CN"</span>);
        
        <span class="hljs-type">String</span> <span class="hljs-variable">sessionId</span> <span class="hljs-operator">=</span> sessionManager.createSession(session, <span class="hljs-number">1800</span>); <span class="hljs-comment">// 30åˆ†é’Ÿè¿‡æœŸ</span>
        
        System.out.println(<span class="hljs-string">"åˆ›å»ºçš„ä¼šè¯ID: "</span> + sessionId);
        
        <span class="hljs-comment">// è·å–ä¼šè¯</span>
        <span class="hljs-type">UserSession</span> <span class="hljs-variable">retrievedSession</span> <span class="hljs-operator">=</span> sessionManager.getSession(sessionId);
        System.out.println(<span class="hljs-string">"ç”¨æˆ·å§“å: "</span> + retrievedSession.getUsername());
        
        <span class="hljs-comment">// æ¸…ç†èµ„æº</span>
        OptimizedJedisPool.closePool();
    }
}
</code></pre>
<h2 data-id="heading-18">å¸¸è§é—®é¢˜</h2>
<p>è¡¨æ ¼ è¿˜åœ¨åŠ è½½ä¸­ï¼Œè¯·ç­‰å¾…åŠ è½½å®Œæˆåå†å°è¯•å¤åˆ¶</p>
<h2 data-id="heading-19">å°ç»“</h2>
<p>æœ¬æ–‡ä»ç¯å¢ƒæ­å»ºã€å®¢æˆ·ç«¯é€‰æ‹©ã€è¿æ¥æ± ä¼˜åŒ–ã€å®‰å…¨é…ç½®åˆ°å®æˆ˜æ¡ˆä¾‹ï¼Œå®Œæ•´å‘ˆç°äº† Java å¼€å‘è€…å¦‚ä½•é«˜æ•ˆä½¿ç”¨ Redis çš„å…¨è¿‡ç¨‹ã€‚</p>
<p>ä½ ç°åœ¨åº”è¯¥å·²ç»æŒæ¡ä»¥ä¸‹è¦ç‚¹ï¼š</p>
<ul>
<li>å¦‚ä½•åœ¨å¤šå¹³å°ä¸Šå¿«é€Ÿæ­å»º Redis ç¯å¢ƒ</li>
<li>å¦‚ä½•é€‰æ‹©åˆé€‚çš„ Java å®¢æˆ·ç«¯ï¼ˆJedis / Lettuce / Redissonï¼‰</li>
<li>å¦‚ä½•é…ç½®è¿æ¥æ± ä»¥å…¼é¡¾æ€§èƒ½ä¸ç¨³å®šæ€§</li>
<li>å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä¿éšœ Redis çš„å®‰å…¨ä¸å¯ç”¨æ€§</li>
</ul>
<p>æœªæ¥æˆ‘ä»¬å°†è¿›ä¸€æ­¥æ¢ç´¢ï¼š</p>
<ul>
<li>Redis Cluster ä¸ Sentinel é«˜å¯ç”¨æ¶æ„</li>
<li>ä½¿ç”¨ Redisson å®ç°åˆ†å¸ƒå¼é”ã€å¸ƒéš†è¿‡æ»¤å™¨</li>
<li>åˆ©ç”¨ Spring Data Redis è¿›è¡Œç»Ÿä¸€å°è£…ä¸æ¨¡æ¿åŒ–è®¿é—®</li>
</ul>
<p>Redis çš„å­¦ä¹ æ›²çº¿å¹¶ä¸é™¡å³­ï¼Œä½†æƒ³åœ¨ä¼ä¸šçº§åœºæ™¯ä¸­ç”¨å¥½å®ƒï¼Œéœ€è¦å…¼é¡¾å¼€å‘æ•ˆç‡ä¸ç³»ç»Ÿç¨³å®šæ€§ã€‚  å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½æˆä¸ºä½  Redis å­¦ä¹ ä¸å®æˆ˜è·¯ä¸Šçš„èµ·ç‚¹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring Cloud å¾®æœåŠ¡æ¶æ„ä¸‹å¹‚ç­‰æ€§çš„ ä¸šåŠ¡åœºæ™¯ã€è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€å®Œæ•´å®ç°æ–¹æ¡ˆåŠå¯è¿è¡Œä»£ç ]]></title>    <link>https://juejin.cn/post/7579440586693296174</link>    <guid>https://juejin.cn/post/7579440586693296174</guid>    <pubDate>2025-12-03T07:44:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579440586693296174" data-draft-id="7579215538272436234" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring Cloud å¾®æœåŠ¡æ¶æ„ä¸‹å¹‚ç­‰æ€§çš„ ä¸šåŠ¡åœºæ™¯ã€è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€å®Œæ•´å®ç°æ–¹æ¡ˆåŠå¯è¿è¡Œä»£ç "/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:44:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/808832912075352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring Cloud å¾®æœåŠ¡æ¶æ„ä¸‹å¹‚ç­‰æ€§çš„ ä¸šåŠ¡åœºæ™¯ã€è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€å®Œæ•´å®ç°æ–¹æ¡ˆåŠå¯è¿è¡Œä»£ç 
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808832912075352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:44:46.000Z" title="Wed Dec 03 2025 07:44:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Spring Cloud å¾®æœåŠ¡æ¶æ„ä¸‹å¹‚ç­‰æ€§çš„ <strong>ä¸šåŠ¡åœºæ™¯ã€è§£å†³çš„æ ¸å¿ƒé—®é¢˜ã€å®Œæ•´å®ç°æ–¹æ¡ˆåŠå¯è¿è¡Œä»£ç </strong></h2>
<p>æ ¸å¿ƒæ˜¯å¸Œæœ›æŒæ¡åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å¦‚ä½•é¿å…é‡å¤æ“ä½œå¯¼è‡´çš„æ•°æ®å¼‚å¸¸ã€‚</p>
<h3 data-id="heading-1">ä¸€ã€å…ˆææ‡‚ï¼šå¹‚ç­‰æ€§åœ¨Spring Cloudä¸­èƒ½è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3>
<p>å¹‚ç­‰æ€§å®šä¹‰ï¼š<strong>åŒä¸€è¯·æ±‚ï¼ˆæˆ–æ“ä½œï¼‰å¤šæ¬¡æ‰§è¡Œï¼Œæœ€ç»ˆæ•ˆæœå®Œå…¨ä¸€è‡´ï¼Œä¸ä¼šäº§ç”Ÿé‡å¤æ•°æ®ã€æ•°æ®ä¸ä¸€è‡´æˆ–èµ„æºé‡å¤æ¶ˆè€—</strong>ã€‚</p>
<p>åœ¨ Spring Cloud å¾®æœåŠ¡ï¼ˆåˆ†å¸ƒå¼ã€è·¨æœåŠ¡è°ƒç”¨ã€ç½‘ç»œä¸ç¨³å®šã€å¼‚æ­¥é€šä¿¡ï¼‰åœºæ™¯ä¸‹ï¼Œæ ¸å¿ƒè§£å†³ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>é‡å¤æäº¤ï¼šç”¨æˆ·å¿«é€Ÿç‚¹å‡»æŒ‰é’®ï¼ˆå¦‚ä¸‹å•ã€æ”¯ä»˜ï¼‰å¯¼è‡´é‡å¤è¯·æ±‚</li>
<li>æœåŠ¡é‡è¯•ï¼šFeign è°ƒç”¨è¶…æ—¶é‡è¯•ã€ç½‘å…³é‡è¯•å¯¼è‡´é‡å¤å¤„ç†</li>
<li>æ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼šMQï¼ˆRocketMQ/Kafkaï¼‰æ¶ˆæ¯é‡è¯•ã€æ¶ˆæ¯é‡æŠ•å¯¼è‡´é‡å¤å¤„ç†</li>
<li>æ”¯ä»˜å›è°ƒé‡è¯•ï¼šç¬¬ä¸‰æ–¹æ”¯ä»˜å¹³å°ï¼ˆå¾®ä¿¡/æ”¯ä»˜å®ï¼‰å›è°ƒæ¥å£å› ç½‘ç»œè¶…æ—¶é‡è¯•</li>
<li>åˆ†å¸ƒå¼äº‹åŠ¡è¡¥å¿ï¼šTCC/SAGA æ¨¡å¼ä¸‹çš„é‡è¯•æ“ä½œå¯¼è‡´çš„æ•°æ®é‡å¤ä¿®æ”¹</li>
</ol>
<h3 data-id="heading-2">äºŒã€Spring Cloud ä¸­å¹‚ç­‰æ€§çš„å…¸å‹ä¸šåŠ¡åœºæ™¯</h3>
<h4 data-id="heading-3">åœºæ™¯1ï¼šç”¨æˆ·ä¸‹å•ï¼ˆé«˜é¢‘é‡å¤æäº¤+æ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼‰</h4>
<ul>
<li>ä¸šåŠ¡æè¿°ï¼šç”¨æˆ·åœ¨ç”µå•†å¹³å°ç‚¹å‡»ã€Œä¸‹å•ã€æŒ‰é’®ï¼Œå› ç½‘ç»œå»¶è¿Ÿå¿«é€Ÿç‚¹å‡»äº†2æ¬¡ï¼Œå¯¼è‡´è®¢å•æœåŠ¡æ”¶åˆ°2æ¬¡ä¸‹å•è¯·æ±‚ï¼›åŒæ—¶è®¢å•æœåŠ¡å‘åº“å­˜æœåŠ¡å‘é€æ‰£å‡åº“å­˜çš„ MQ æ¶ˆæ¯ï¼Œå›  MQ é‡è¯•æœºåˆ¶ï¼Œåº“å­˜æœåŠ¡æ”¶åˆ°2æ¬¡ç›¸åŒæ¶ˆæ¯ã€‚</li>
<li>æ½œåœ¨é—®é¢˜ï¼šé‡å¤åˆ›å»ºè®¢å•ã€é‡å¤æ‰£å‡åº“å­˜ï¼ˆè¶…å–/å°‘å–ï¼‰ã€é‡å¤é”å®šä¼˜æƒ åˆ¸ã€‚</li>
</ul>
<h4 data-id="heading-4">åœºæ™¯2ï¼šæ”¯ä»˜å›è°ƒé€šçŸ¥ï¼ˆAPIé‡è¯•ï¼‰</h4>
<ul>
<li>ä¸šåŠ¡æè¿°ï¼šç”¨æˆ·æ”¯ä»˜æˆåŠŸåï¼Œå¾®ä¿¡æ”¯ä»˜å¹³å°å‘å•†æˆ·çš„æ”¯ä»˜å›è°ƒæ¥å£å‘é€é€šçŸ¥ï¼Œä½†å› ç½‘ç»œè¶…æ—¶ï¼Œæ”¯ä»˜å¹³å°é‡è¯•3æ¬¡å›è°ƒè¯·æ±‚ã€‚</li>
<li>æ½œåœ¨é—®é¢˜ï¼šé‡å¤æ›´æ–°è®¢å•çŠ¶æ€ï¼ˆå·²æ”¯ä»˜â†’å·²æ”¯ä»˜é‡å¤æ‰§è¡Œï¼‰ã€é‡å¤ç»™ç”¨æˆ·è´¦æˆ·å…¥è´¦ã€‚</li>
</ul>
<h4 data-id="heading-5">åœºæ™¯3ï¼šå•†å“åº“å­˜æ‰£å‡ï¼ˆæœåŠ¡è°ƒç”¨é‡è¯•ï¼‰</h4>
<ul>
<li>ä¸šåŠ¡æè¿°ï¼šè®¢å•æœåŠ¡é€šè¿‡ Feign è°ƒç”¨åº“å­˜æœåŠ¡æ‰£å‡åº“å­˜ï¼Œå› åº“å­˜æœåŠ¡å“åº”è¶…æ—¶ï¼ŒFeign è§¦å‘é‡è¯•æœºåˆ¶ï¼Œå‘èµ·å¤šæ¬¡æ‰£å‡è¯·æ±‚ã€‚</li>
<li>æ½œåœ¨é—®é¢˜ï¼šåº“å­˜é‡å¤æ‰£å‡ï¼ˆå¯¼è‡´è¶…å–ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-6">ä¸‰ã€Spring Cloud å¹‚ç­‰æ€§å®Œæ•´è§£å†³æ–¹æ¡ˆ</h3>
<h4 data-id="heading-7">æ ¸å¿ƒæ€è·¯</h4>
<p>ç»“åˆã€Œå‰ç«¯é˜²é‡ + åç«¯å¹‚ç­‰æ ¡éªŒ + æ•°æ®å±‚çº¦æŸã€ä¸‰å±‚é˜²æŠ¤ï¼Œé€‰æ‹©é€‚åˆåœºæ™¯çš„å¹‚ç­‰æ–¹æ¡ˆï¼š</p>









































<table><thead><tr><th>æ–¹æ¡ˆç±»å‹</th><th>é€‚ç”¨åœºæ™¯</th><th>æ ¸å¿ƒåŸç†</th><th>æŠ€æœ¯é€‰å‹</th></tr></thead><tbody><tr><td>å”¯ä¸€è¯·æ±‚ID + Redis</td><td>é‡å¤æäº¤ã€APIé‡è¯•</td><td>é¦–æ¬¡è¯·æ±‚å­˜å‚¨IDï¼Œé‡å¤è¯·æ±‚ç›´æ¥æ‹¦æˆª</td><td>Redis + è‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨</td></tr><tr><td>æ•°æ®åº“å”¯ä¸€çº¦æŸ</td><td>è®¢å•åˆ›å»ºã€ç”¨æˆ·æ³¨å†Œ</td><td>å”¯ä¸€ç´¢å¼•/è”åˆç´¢å¼•é˜²æ­¢é‡å¤æ•°æ®æ’å…¥</td><td>MySQL å”¯ä¸€ç´¢å¼•</td></tr><tr><td>ä¹è§‚é”ï¼ˆç‰ˆæœ¬å·ï¼‰</td><td>åº“å­˜æ‰£å‡ã€è®¢å•çŠ¶æ€æ›´æ–°</td><td>åŸºäºç‰ˆæœ¬å·æ§åˆ¶ï¼Œä»…å…è®¸çŠ¶æ€å˜æ›´ä¸€æ¬¡</td><td>MySQL ç‰ˆæœ¬å­—æ®µ + MyBatis</td></tr><tr><td>æ¶ˆæ¯ID + Redis</td><td>MQæ¶ˆæ¯é‡å¤æ¶ˆè´¹</td><td>æ¶ˆè´¹å‰æ ¡éªŒæ¶ˆæ¯IDæ˜¯å¦å·²å¤„ç†</td><td>Redis + MQ æ¶ˆè´¹ç›‘å¬</td></tr><tr><td>çŠ¶æ€æœºæ§åˆ¶</td><td>è®¢å•çŠ¶æ€æµè½¬ï¼ˆå¾…æ”¯ä»˜â†’å·²æ”¯ä»˜ï¼‰</td><td>ä»…å…è®¸ä»æŒ‡å®šçŠ¶æ€æµè½¬åˆ°ç›®æ ‡çŠ¶æ€</td><td>ä¸šåŠ¡ä»£ç ä¸­çŠ¶æ€åˆ¤æ–­</td></tr></tbody></table>
<h4 data-id="heading-8">æŠ€æœ¯æ ˆé€‰å‹ï¼ˆSpring Cloud Alibaba ç”Ÿæ€ï¼‰</h4>
<ul>
<li>åŸºç¡€æ¡†æ¶ï¼šSpring Boot 2.7.x + Spring Cloud Alibaba 2021.0.4.0</li>
<li>æœåŠ¡æ³¨å†Œå‘ç°ï¼šNacos</li>
<li>ç¼“å­˜ï¼ˆå¹‚ç­‰æ ¡éªŒï¼‰ï¼šRedis</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—ï¼šRocketMQï¼ˆå¤„ç†å¼‚æ­¥é€šä¿¡+é‡å¤æ¶ˆè´¹ï¼‰</li>
<li>æŒä¹…å±‚ï¼šMyBatis-Plus + MySQL 8.0</li>
<li>æ¥å£æ–‡æ¡£ï¼šSwaggerï¼ˆå¯é€‰ï¼Œæ–¹ä¾¿æµ‹è¯•ï¼‰</li>
</ul>
<h3 data-id="heading-9">å››ã€å®Œæ•´ä»£ç å®ç°ï¼ˆèšç„¦åœºæ™¯1+åœºæ™¯2ï¼‰</h3>
<h4 data-id="heading-10">1. é¡¹ç›®æ•´ä½“ç»“æ„</h4>
<pre><code class="hljs language-bash" lang="bash">idempotent-demo/
â”œâ”€â”€ idempotent-common/        <span class="hljs-comment"># å…¬å…±æ¨¡å—ï¼ˆæ³¨è§£ã€å·¥å…·ç±»ï¼‰</span>
â”œâ”€â”€ idempotent-order/         <span class="hljs-comment"># è®¢å•æœåŠ¡ï¼ˆåœºæ™¯1ï¼šä¸‹å•+åœºæ™¯2ï¼šæ”¯ä»˜å›è°ƒï¼‰</span>
â”œâ”€â”€ idempotent-inventory/     <span class="hljs-comment"># åº“å­˜æœåŠ¡ï¼ˆåœºæ™¯1ï¼šåº“å­˜æ‰£å‡ï¼‰</span>
â””â”€â”€ pom.xml                   <span class="hljs-comment"># çˆ¶å·¥ç¨‹ä¾èµ–</span>
</code></pre>
<h4 data-id="heading-11">2. çˆ¶å·¥ç¨‹ä¾èµ–ï¼ˆpom.xmlï¼‰</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.7.15<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.example<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>idempotent-demo<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">modules</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>idempotent-common<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>idempotent-order<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">module</span>&gt;</span>idempotent-inventory<span class="hljs-tag">&lt;/<span class="hljs-name">module</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">modules</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud-alibaba.version</span>&gt;</span>2021.0.4.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud-alibaba.version</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- ä¾èµ–ç®¡ç† --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
            <span class="hljs-comment">&lt;!-- Spring Cloud Alibaba ä¾èµ– --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>${spring-cloud-alibaba.version}<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Spring Boot æ ¸å¿ƒä¾èµ– --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- å·¥å…·ç±» --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">optional</span>&gt;</span>true<span class="hljs-tag">&lt;/<span class="hljs-name">optional</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- æ¥å£æ–‡æ¡£ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.springfox<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>springfox-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span>
</code></pre>
<h4 data-id="heading-12">3. å…¬å…±æ¨¡å—ï¼ˆidempotent-commonï¼‰</h4>
<h5 data-id="heading-13">3.1 å¹‚ç­‰æ³¨è§£ï¼ˆ@Idempotentï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.idempotent.common.annotation;

<span class="hljs-keyword">import</span> java.lang.annotation.*;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-comment">/**
 * å¹‚ç­‰æ³¨è§£ï¼šæ ‡è®°éœ€è¦å¹‚ç­‰æ ¡éªŒçš„æ¥å£
 */</span>
<span class="hljs-meta">@Target({ElementType.METHOD})</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Idempotent {
    <span class="hljs-comment">/**
     * Redis è¿‡æœŸæ—¶é—´ï¼ˆé»˜è®¤30ç§’ï¼‰
     */</span>
    <span class="hljs-type">long</span> <span class="hljs-title function_">expire</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-number">30</span>;

    <span class="hljs-comment">/**
     * æ—¶é—´å•ä½ï¼ˆé»˜è®¤ç§’ï¼‰
     */</span>
    TimeUnit <span class="hljs-title function_">timeUnit</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> TimeUnit.SECONDS;

    <span class="hljs-comment">/**
     * é‡å¤è¯·æ±‚æç¤ºä¿¡æ¯
     */</span>
    String <span class="hljs-title function_">message</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">"æ“ä½œè¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•ï¼"</span>;
}
</code></pre>
<h5 data-id="heading-14">3.2 Redis å·¥å…·ç±»ï¼ˆRedisUtilï¼‰</h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">idempotent</span>.<span class="hljs-property">common</span>.<span class="hljs-property">util</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">StringRedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;

<span class="hljs-keyword">import</span> javax.<span class="hljs-property">annotation</span>.<span class="hljs-property">Resource</span>;
<span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">TimeUnit</span>;

<span class="hljs-comment">/**
 * Redis å·¥å…·ç±»ï¼ˆç®€åŒ–å¹‚ç­‰æ ¡éªŒçš„å­˜å‚¨/æŸ¥è¯¢ï¼‰
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisUtil</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">StringRedisTemplate</span> stringRedisTemplate;

    <span class="hljs-comment">/**
     * å­˜å‚¨å¹‚ç­‰é”®ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™å­˜å‚¨ï¼Œè¿”å›trueï¼›å·²å­˜åœ¨è¿”å›falseï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">setIfAbsent</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> key, <span class="hljs-built_in">String</span> value, long expire, TimeUnit timeUnit</span>) {
        <span class="hljs-title class_">Boolean</span> success = stringRedisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">setIfAbsent</span>(key, value, expire, timeUnit);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>.<span class="hljs-title function_">equals</span>(success);
    }

    <span class="hljs-comment">/**
     * åˆ é™¤å¹‚ç­‰é”®
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> key</span>) {
        stringRedisTemplate.<span class="hljs-title function_">delete</span>(key);
    }

    <span class="hljs-comment">/**
     * æŸ¥è¯¢å¹‚ç­‰é”®æ˜¯å¦å­˜åœ¨
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">hasKey</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> key</span>) {
        <span class="hljs-title class_">Boolean</span> exists = stringRedisTemplate.<span class="hljs-title function_">hasKey</span>(key);
        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Boolean</span>.<span class="hljs-property">TRUE</span>.<span class="hljs-title function_">equals</span>(exists);
    }
}
</code></pre>
<h5 data-id="heading-15">3.3 å…¨å±€å¼‚å¸¸å¤„ç†ï¼ˆGlobalExceptionHandlerï¼‰</h5>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.idempotent.common.exception;

<span class="hljs-keyword">import</span> lombok.<span class="hljs-type">Data</span>;

<span class="hljs-comment">/**
 * å¹‚ç­‰å¼‚å¸¸ï¼ˆé‡å¤è¯·æ±‚æ—¶æŠ›å‡ºï¼‰
 */</span>
<span class="hljs-meta">@Data</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IdempotentException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>{
    <span class="hljs-keyword">private</span> int code = <span class="hljs-number">409</span>; <span class="hljs-comment">// å†²çªçŠ¶æ€ç </span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">String</span> message;

    public <span class="hljs-type">IdempotentException</span>(<span class="hljs-type">String</span> message) {
        <span class="hljs-keyword">super</span>(message);
        <span class="hljs-keyword">this</span>.message = message;
    }
}
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.idempotent.common.exception;

<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.ResponseStatus;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestControllerAdvice;

<span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;

<span class="hljs-comment">/**
 * å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 */</span>
<span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalExceptionHandler</span> {

    <span class="hljs-comment">/**
     * å¤„ç†å¹‚ç­‰å¼‚å¸¸
     */</span>
    <span class="hljs-meta">@ExceptionHandler(IdempotentException.class)</span>
    <span class="hljs-meta">@ResponseStatus(HttpStatus.CONFLICT)</span>
    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title function_">handleIdempotentException</span><span class="hljs-params">(IdempotentException e)</span> {
        Map&lt;String, Object&gt; result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
        result.put(<span class="hljs-string">"code"</span>, e.getCode());
        result.put(<span class="hljs-string">"message"</span>, e.getMessage());
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<h4 data-id="heading-16">4. è®¢å•æœåŠ¡ï¼ˆidempotent-orderï¼‰</h4>
<h5 data-id="heading-17">4.1 é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8081</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">idempotent-order</span>
  <span class="hljs-comment"># Redis é…ç½®</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
    <span class="hljs-attr">lettuce:</span>
      <span class="hljs-attr">pool:</span>
        <span class="hljs-attr">max-active:</span> <span class="hljs-number">8</span>
  <span class="hljs-comment"># æ•°æ®åº“é…ç½®</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/idempotent_db?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
  <span class="hljs-comment"># RocketMQ é…ç½®</span>
  <span class="hljs-attr">rocketmq:</span>
    <span class="hljs-attr">name-server:</span> <span class="hljs-string">localhost:9876</span>
    <span class="hljs-attr">producer:</span>
      <span class="hljs-attr">group:</span> <span class="hljs-string">order-producer-group</span>

<span class="hljs-comment"># Nacos æœåŠ¡æ³¨å†Œ</span>
<span class="hljs-attr">spring.cloud.nacos.discovery:</span>
  <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span>

<span class="hljs-comment"># MyBatis-Plus é…ç½®</span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.idempotent.order.entity</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span>
</code></pre>
<h5 data-id="heading-18">4.2 æ•°æ®åº“è¡¨è®¾è®¡ï¼ˆè®¢å•è¡¨ï¼‰</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> DATABASE IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> idempotent_db;
USE idempotent_db;

<span class="hljs-comment">-- è®¢å•è¡¨ï¼ˆå”¯ä¸€ç´¢å¼•é˜²é‡å¤åˆ›å»ºï¼Œç‰ˆæœ¬å·æ§åˆ¶ä¹è§‚é”ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_order` (
  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ä¸»é”®ID'</span>,
  `order_no` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è®¢å•å·ï¼ˆå”¯ä¸€ï¼‰'</span>,
  `user_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
  `product_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å•†å“ID'</span>,
  `amount` <span class="hljs-type">decimal</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è®¢å•é‡‘é¢'</span>,
  `status` tinyint <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'è®¢å•çŠ¶æ€ï¼š0-å¾…æ”¯ä»˜ï¼Œ1-å·²æ”¯ä»˜ï¼Œ2-å·²å–æ¶ˆ'</span>,
  `version` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰'</span>,
  `create_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  `update_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_order_no` (`order_no`) COMMENT <span class="hljs-string">'è®¢å•å·å”¯ä¸€çº¦æŸ'</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'è®¢å•è¡¨'</span>;
</code></pre>
<h5 data-id="heading-19">4.3 å®ä½“ç±»ï¼ˆOrderï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.idempotent.order.entity;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.<span class="hljs-keyword">annotation</span>.IdType;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.<span class="hljs-keyword">annotation</span>.TableId;
<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.<span class="hljs-keyword">annotation</span>.TableName;
<span class="hljs-keyword">import</span> lombok.Data;

<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@TableName(<span class="hljs-string">"t_order"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span> {
    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> id;
    <span class="hljs-keyword">private</span> String orderNo; <span class="hljs-comment">// è®¢å•å·ï¼ˆå”¯ä¸€ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> userId;
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">Long</span> productId;
    <span class="hljs-keyword">private</span> BigDecimal amount;
    <span class="hljs-keyword">private</span> Integer status; <span class="hljs-comment">// 0-å¾…æ”¯ä»˜ï¼Œ1-å·²æ”¯ä»˜ï¼Œ2-å·²å–æ¶ˆ</span>
    <span class="hljs-keyword">private</span> Integer version; <span class="hljs-comment">// ä¹è§‚é”ç‰ˆæœ¬å·</span>
    <span class="hljs-keyword">private</span> LocalDateTime createTime;
    <span class="hljs-keyword">private</span> LocalDateTime updateTime;
}
</code></pre>
<h5 data-id="heading-20">4.4 å¹‚ç­‰æ‹¦æˆªå™¨ï¼ˆIdempotentInterceptorï¼‰</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.idempotent.order.interceptor;

<span class="hljs-keyword">import</span> com.example.idempotent.common.annotation.Idempotent;
<span class="hljs-keyword">import</span> com.example.idempotent.common.exception.IdempotentException;
<span class="hljs-keyword">import</span> com.example.idempotent.common.util.RedisUtil;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> org.springframework.web.method.HandlerMethod;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.HandlerInterceptor;

<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletRequest;
<span class="hljs-keyword">import</span> javax.servlet.http.HttpServletResponse;
<span class="hljs-keyword">import</span> java.lang.reflect.Method;

<span class="hljs-comment">/**
 * å¹‚ç­‰æ‹¦æˆªå™¨ï¼šæ‹¦æˆªå¸¦æœ‰<span class="hljs-doctag">@Idempotent</span>æ³¨è§£çš„æ¥å£ï¼Œè¿›è¡Œå¹‚ç­‰æ ¡éªŒ
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IdempotentInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">HandlerInterceptor</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> RedisUtil redisUtil;

    <span class="hljs-comment">// å¹‚ç­‰è¯·æ±‚å¤´åç§°ï¼ˆå‰ç«¯éœ€ä¼ é€’å”¯ä¸€è¯·æ±‚IDï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">IDEMPOTENT_REQUEST_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">"Idempotent-Request-Id"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-comment">// 1. åˆ¤æ–­æ˜¯å¦æ˜¯ç›®æ ‡æ–¹æ³•ï¼ˆControlleræ¥å£æ–¹æ³•ï¼‰</span>
        <span class="hljs-keyword">if</span> (!(handler <span class="hljs-keyword">instanceof</span> HandlerMethod handlerMethod)) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> handlerMethod.getMethod();
        <span class="hljs-type">Idempotent</span> <span class="hljs-variable">idempotent</span> <span class="hljs-operator">=</span> method.getAnnotation(Idempotent.class);
        <span class="hljs-keyword">if</span> (idempotent == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// æ— å¹‚ç­‰æ³¨è§£ï¼Œç›´æ¥æ”¾è¡Œ</span>
        }

        <span class="hljs-comment">// 2. è·å–å‰ç«¯ä¼ é€’çš„å”¯ä¸€è¯·æ±‚ID</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> request.getHeader(IDEMPOTENT_REQUEST_ID);
        <span class="hljs-keyword">if</span> (requestId == <span class="hljs-literal">null</span> || requestId.trim().isEmpty()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"ç¼ºå°‘å¹‚ç­‰è¯·æ±‚IDï¼Œè¯·é‡è¯•ï¼"</span>);
        }

        <span class="hljs-comment">// 3. æ„å»ºRedisé”®ï¼ˆç”¨æˆ·ID+è¯·æ±‚IDï¼Œé¿å…ä¸åŒç”¨æˆ·å†²çªï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"User-Id"</span>); <span class="hljs-comment">// å®é™…åœºæ™¯ä»Tokenä¸­è§£æ</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"idempotent:%s:%s:%s"</span>, userId, request.getRequestURI(), requestId);

        <span class="hljs-comment">// 4. Redisæ ¡éªŒï¼šä¸å­˜åœ¨åˆ™å­˜å‚¨ï¼Œå­˜åœ¨åˆ™æŠ›å‡ºå¼‚å¸¸</span>
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> redisUtil.setIfAbsent(
                redisKey,
                <span class="hljs-string">"1"</span>,
                idempotent.expire(),
                idempotent.timeUnit()
        );
        <span class="hljs-keyword">if</span> (!success) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(idempotent.message());
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h5 data-id="heading-21">4.5 æ‹¦æˆªå™¨é…ç½®ï¼ˆWebConfigï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.idempotent.order.config;

<span class="hljs-keyword">import</span> com.example.idempotent.order.interceptor.IdempotentInterceptor;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.<span class="hljs-keyword">annotation</span>.InterceptorRegistry;
<span class="hljs-keyword">import</span> org.springframework.web.servlet.config.<span class="hljs-keyword">annotation</span>.WebMvcConfigurer;

<span class="hljs-keyword">import</span> javax.<span class="hljs-keyword">annotation</span>.Resource;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WebConfig</span> <span class="hljs-title">implements</span> <span class="hljs-title">WebMvcConfigurer</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> IdempotentInterceptor idempotentInterceptor;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> void addInterceptors(InterceptorRegistry registry) {
        <span class="hljs-comment">// æ³¨å†Œå¹‚ç­‰æ‹¦æˆªå™¨ï¼Œæ‹¦æˆªæ‰€æœ‰æ¥å£ï¼ˆå¯é€šè¿‡excludePathPatternsæ’é™¤ä¸éœ€è¦çš„æ¥å£ï¼‰</span>
        registry.addInterceptor(idempotentInterceptor)
                .addPathPatterns(<span class="hljs-string">"/**"</span>)
                .excludePathPatterns(<span class="hljs-string">"/swagger-ui/**"</span>, <span class="hljs-string">"/v3/api-docs/**"</span>);
    }
}
</code></pre>
<h5 data-id="heading-22">4.6 Mapper + Serviceï¼ˆè®¢å•æœåŠ¡æ ¸å¿ƒé€»è¾‘ï¼‰</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.idempotent</span><span class="hljs-selector-class">.order</span><span class="hljs-selector-class">.mapper</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.baomidou</span><span class="hljs-selector-class">.mybatisplus</span><span class="hljs-selector-class">.core</span><span class="hljs-selector-class">.mapper</span><span class="hljs-selector-class">.BaseMapper</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.idempotent</span><span class="hljs-selector-class">.order</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.Order</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.ibatis</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Mapper</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.apache</span><span class="hljs-selector-class">.ibatis</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Param</span>;

@<span class="hljs-selector-tag">Mapper</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">interface</span> <span class="hljs-selector-tag">OrderMapper</span> <span class="hljs-selector-tag">extends</span> <span class="hljs-selector-tag">BaseMapper</span>&lt;<span class="hljs-selector-tag">Order</span>&gt; {
    <span class="hljs-comment">// ä¹è§‚é”æ›´æ–°è®¢å•çŠ¶æ€</span>
    <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">updateOrderStatus</span>(<span class="hljs-variable">@Param</span>(<span class="hljs-string">"orderNo"</span>) String orderNo, <span class="hljs-variable">@Param</span>(<span class="hljs-string">"oldStatus"</span>) Integer oldStatus, <span class="hljs-variable">@Param</span>(<span class="hljs-string">"newStatus"</span>) Integer newStatus, <span class="hljs-variable">@Param</span>(<span class="hljs-string">"version"</span>) Integer version);
}
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- resources/mapper/OrderMapper.xml --&gt;</span>
<span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">mapper</span> <span class="hljs-keyword">PUBLIC</span> <span class="hljs-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.example.idempotent.order.mapper.OrderMapper"</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ä¹è§‚é”æ›´æ–°è®¢å•çŠ¶æ€ï¼šä»…å½“ç‰ˆæœ¬å·åŒ¹é…ä¸”çŠ¶æ€ä¸ºoldStatusæ—¶æ›´æ–° --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updateOrderStatus"</span>&gt;</span>
        UPDATE t_order
        SET status = #{newStatus}, version = version + 1, update_time = NOW()
        WHERE order_no = #{orderNo} AND status = #{oldStatus} AND version = #{version}
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.idempotent.order.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
<span class="hljs-keyword">import</span> com.example.idempotent.common.util.RedisUtil;
<span class="hljs-keyword">import</span> com.example.idempotent.order.entity.Order;
<span class="hljs-keyword">import</span> com.example.idempotent.order.mapper.OrderMapper;
<span class="hljs-keyword">import</span> com.example.idempotent.order.feign.InventoryFeignClient;
<span class="hljs-keyword">import</span> com.example.idempotent.order.mq.OrderMqProducer;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.Transactional;

<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;OrderMapper, Order&gt; {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> InventoryFeignClient inventoryFeignClient; <span class="hljs-comment">// Feignè°ƒç”¨åº“å­˜æœåŠ¡</span>
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> OrderMqProducer orderMqProducer; <span class="hljs-comment">// MQç”Ÿäº§è€…</span>
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> RedisUtil redisUtil;

    <span class="hljs-comment">/**
     * ä¸‹å•æ¥å£ï¼ˆå¹‚ç­‰å¤„ç†ï¼šRedis+å”¯ä¸€è®¢å•å·ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> Order <span class="hljs-title function_">createOrder</span><span class="hljs-params">(Long userId, Long productId, BigDecimal amount)</span> {
        <span class="hljs-comment">// 1. ç”Ÿæˆå”¯ä¸€è®¢å•å·ï¼ˆé˜²æ­¢æ•°æ®åº“é‡å¤æ’å…¥ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">orderNo</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().replace(<span class="hljs-string">"-"</span>, <span class="hljs-string">""</span>).substring(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>);

        <span class="hljs-comment">// 2. åˆ›å»ºè®¢å•ï¼ˆæ•°æ®åº“å”¯ä¸€ç´¢å¼•order_noé˜²æ­¢é‡å¤ï¼‰</span>
        <span class="hljs-type">Order</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Order</span>();
        order.setOrderNo(orderNo);
        order.setUserId(userId);
        order.setProductId(productId);
        order.setAmount(amount);
        order.setStatus(<span class="hljs-number">0</span>); <span class="hljs-comment">// 0-å¾…æ”¯ä»˜</span>
        orderMapper.insert(order);

        <span class="hljs-comment">// 3. å¼‚æ­¥æ‰£å‡åº“å­˜ï¼ˆå‘é€MQæ¶ˆæ¯ï¼Œåº“å­˜æœåŠ¡æ¶ˆè´¹æ—¶åšå¹‚ç­‰å¤„ç†ï¼‰</span>
        orderMqProducer.sendDeductInventoryMsg(orderNo, productId, <span class="hljs-number">1</span>);

        <span class="hljs-keyword">return</span> order;
    }

    <span class="hljs-comment">/**
     * æ”¯ä»˜å›è°ƒæ¥å£ï¼ˆå¹‚ç­‰å¤„ç†ï¼šçŠ¶æ€æœº+ä¹è§‚é”ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">handlePayCallback</span><span class="hljs-params">(String orderNo, Integer version)</span> {
        <span class="hljs-comment">// 1. çŠ¶æ€æœºæ§åˆ¶ï¼šä»…å…è®¸ä»ã€Œå¾…æ”¯ä»˜ï¼ˆ0ï¼‰ã€æ›´æ–°ä¸ºã€Œå·²æ”¯ä»˜ï¼ˆ1ï¼‰ã€</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> orderMapper.updateOrderStatus(orderNo, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, version);
        <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// æ›´æ–°å¤±è´¥ï¼šå¯èƒ½æ˜¯é‡å¤å›è°ƒï¼Œæˆ–çŠ¶æ€å·²å˜æ›´</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
        <span class="hljs-comment">// 2. åç»­ä¸šåŠ¡ï¼šå¦‚ç»™ç”¨æˆ·å…¥è´¦ã€å‘é€é€šçŸ¥ç­‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
}
</code></pre>
<h5 data-id="heading-23">4.7 MQç”Ÿäº§è€…ï¼ˆOrderMqProducerï¼‰</h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">idempotent</span>.<span class="hljs-property">order</span>.<span class="hljs-property">mq</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">client</span>.<span class="hljs-property">producer</span>.<span class="hljs-property">SendResult</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">spring</span>.<span class="hljs-property">core</span>.<span class="hljs-property">RocketMQTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;

<span class="hljs-keyword">import</span> javax.<span class="hljs-property">annotation</span>.<span class="hljs-property">Resource</span>;

<span class="hljs-comment">/**
 * è®¢å•MQç”Ÿäº§è€…ï¼šå‘é€åº“å­˜æ‰£å‡æ¶ˆæ¯
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMqProducer</span> {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RocketMQTemplate</span> rocketMQTemplate;

    <span class="hljs-comment">// åº“å­˜æ‰£å‡æ¶ˆæ¯ä¸»é¢˜</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">TOPIC_DEDUCT_INVENTORY</span> = <span class="hljs-string">"topic-deduct-inventory"</span>;

    <span class="hljs-comment">/**
     * å‘é€åº“å­˜æ‰£å‡æ¶ˆæ¯ï¼ˆæ¶ˆæ¯IDä½œä¸ºå¹‚ç­‰æ ‡è¯†ï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">SendResult</span> <span class="hljs-title function_">sendDeductInventoryMsg</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderNo, Long productId, Integer num</span>) {
        <span class="hljs-comment">// æ„å»ºæ¶ˆæ¯å†…å®¹ï¼ˆåŒ…å«è®¢å•å·ã€å•†å“IDã€æ‰£å‡æ•°é‡ï¼‰</span>
        <span class="hljs-title class_">DeductInventoryMsg</span> msg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DeductInventoryMsg</span>();
        msg.<span class="hljs-title function_">setOrderNo</span>(orderNo);
        msg.<span class="hljs-title function_">setProductId</span>(productId);
        msg.<span class="hljs-title function_">setNum</span>(num);

        <span class="hljs-comment">// å‘é€æ¶ˆæ¯ï¼ˆRocketMQè‡ªåŠ¨ç”Ÿæˆå”¯ä¸€æ¶ˆæ¯IDï¼Œæ¶ˆè´¹æ—¶ç”¨è¯¥IDåšå¹‚ç­‰ï¼‰</span>
        <span class="hljs-keyword">return</span> rocketMQTemplate.<span class="hljs-title function_">syncSend</span>(<span class="hljs-variable constant_">TOPIC_DEDUCT_INVENTORY</span>, msg);
    }

    <span class="hljs-comment">// æ¶ˆæ¯å®ä½“</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeductInventoryMsg</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> orderNo;
        <span class="hljs-keyword">private</span> <span class="hljs-title class_">Long</span> productId;
        <span class="hljs-keyword">private</span> <span class="hljs-title class_">Integer</span> num;

        <span class="hljs-comment">// getter/setter</span>
        <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getOrderNo</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> orderNo; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setOrderNo</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderNo</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderNo</span> = orderNo; }
        <span class="hljs-keyword">public</span> <span class="hljs-title class_">Long</span> <span class="hljs-title function_">getProductId</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> productId; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setProductId</span>(<span class="hljs-params">Long productId</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">productId</span> = productId; }
        <span class="hljs-keyword">public</span> <span class="hljs-title class_">Integer</span> <span class="hljs-title function_">getNum</span>(<span class="hljs-params"/>) { <span class="hljs-keyword">return</span> num; }
        <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setNum</span>(<span class="hljs-params">Integer num</span>) { <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = num; }
    }
}
</code></pre>
<h5 data-id="heading-24">4.8 Controllerï¼ˆå¯¹å¤–æ¥å£ï¼‰</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.idempotent</span><span class="hljs-selector-class">.order</span><span class="hljs-selector-class">.controller</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.idempotent</span><span class="hljs-selector-class">.common</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Idempotent</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.idempotent</span><span class="hljs-selector-class">.order</span><span class="hljs-selector-class">.entity</span><span class="hljs-selector-class">.Order</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.idempotent</span><span class="hljs-selector-class">.order</span><span class="hljs-selector-class">.service</span><span class="hljs-selector-class">.OrderService</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.Api</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">io</span><span class="hljs-selector-class">.swagger</span><span class="hljs-selector-class">.annotations</span><span class="hljs-selector-class">.ApiOperation</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">org</span><span class="hljs-selector-class">.springframework</span><span class="hljs-selector-class">.web</span><span class="hljs-selector-class">.bind</span><span class="hljs-selector-class">.annotation</span>.*;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">javax</span><span class="hljs-selector-class">.annotation</span><span class="hljs-selector-class">.Resource</span>;
<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">java</span><span class="hljs-selector-class">.math</span><span class="hljs-selector-class">.BigDecimal</span>;

@<span class="hljs-selector-tag">RestController</span>
@<span class="hljs-selector-tag">RequestMapping</span>(<span class="hljs-string">"/order"</span>)
@<span class="hljs-selector-tag">Api</span>(tags = <span class="hljs-string">"è®¢å•æ¥å£ï¼ˆå¹‚ç­‰æ€§ç¤ºä¾‹ï¼‰"</span>)
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">OrderController</span> {

    <span class="hljs-variable">@Resource</span>
    private OrderService orderService;

    <span class="hljs-comment">/**
     * ä¸‹å•æ¥å£ï¼ˆå¹‚ç­‰æ³¨è§£ï¼šé˜²æ­¢é‡å¤æäº¤ï¼‰
     * å‰ç«¯éœ€ä¼ é€’è¯·æ±‚å¤´ï¼šIdempotent-Request-Idï¼ˆå”¯ä¸€IDï¼‰ã€User-Idï¼ˆç”¨æˆ·IDï¼‰
     */</span>
    <span class="hljs-variable">@PostMapping</span>(<span class="hljs-string">"/create"</span>)
    <span class="hljs-variable">@ApiOperation</span>(<span class="hljs-string">"åˆ›å»ºè®¢å•"</span>)
    <span class="hljs-variable">@Idempotent</span>(expire = <span class="hljs-number">60</span>, message = <span class="hljs-string">"ä¸‹å•è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·1åˆ†é’Ÿåé‡è¯•ï¼"</span>)
    public Order <span class="hljs-built_in">createOrder</span>(
            <span class="hljs-variable">@RequestHeader</span>(<span class="hljs-string">"User-Id"</span>) Long userId,
            <span class="hljs-variable">@RequestParam</span> Long productId,
            <span class="hljs-variable">@RequestParam</span> BigDecimal amount) {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">orderService</span><span class="hljs-selector-class">.createOrder</span>(userId, productId, amount);
    }

    <span class="hljs-comment">/**
     * æ”¯ä»˜å›è°ƒæ¥å£ï¼ˆå¹‚ç­‰å¤„ç†ï¼šçŠ¶æ€æœº+ä¹è§‚é”ï¼‰
     * æ”¯ä»˜å¹³å°å›è°ƒæ—¶ä¼ é€’è®¢å•å·å’Œç‰ˆæœ¬å·
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/pay/callback"</span>)
    @<span class="hljs-selector-tag">ApiOperation</span>(<span class="hljs-string">"æ”¯ä»˜å›è°ƒ"</span>)
    @<span class="hljs-selector-tag">Idempotent</span>(expire = <span class="hljs-number">180</span>, message = <span class="hljs-string">"å›è°ƒè¯·æ±‚å·²å¤„ç†ï¼Œè¯·ä¸è¦é‡å¤æäº¤ï¼"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">payCallback</span>(
            <span class="hljs-variable">@RequestParam</span> String orderNo,
            <span class="hljs-variable">@RequestParam</span> Integer version) {
        <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">success</span> = <span class="hljs-selector-tag">orderService</span><span class="hljs-selector-class">.handlePayCallback</span>(orderNo, version);
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">success</span> ? "å›è°ƒå¤„ç†æˆåŠŸ" : "å›è°ƒå¤„ç†å¤±è´¥ï¼ˆé‡å¤è¯·æ±‚æˆ–çŠ¶æ€å·²å˜æ›´ï¼‰";
    }
}
</code></pre>
<h4 data-id="heading-25">5. åº“å­˜æœåŠ¡ï¼ˆidempotent-inventoryï¼‰</h4>
<h5 data-id="heading-26">5.1 é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8082</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">idempotent-inventory</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/idempotent_db?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
  <span class="hljs-attr">rocketmq:</span>
    <span class="hljs-attr">name-server:</span> <span class="hljs-string">localhost:9876</span>
    <span class="hljs-attr">consumer:</span>
      <span class="hljs-attr">group:</span> <span class="hljs-string">inventory-consumer-group</span>

<span class="hljs-attr">spring.cloud.nacos.discovery:</span>
  <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:8848</span>

<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.example.idempotent.inventory.entity</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">map-underscore-to-camel-case:</span> <span class="hljs-literal">true</span>
</code></pre>
<h5 data-id="heading-27">5.2 æ•°æ®åº“è¡¨è®¾è®¡ï¼ˆåº“å­˜è¡¨ï¼‰</h5>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- åº“å­˜è¡¨ï¼ˆä¹è§‚é”é˜²æ­¢é‡å¤æ‰£å‡ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `t_inventory` (
  `id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ä¸»é”®ID'</span>,
  `product_id` <span class="hljs-type">bigint</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å•†å“ID'</span>,
  `stock` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'åº“å­˜æ•°é‡'</span>,
  `version` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰'</span>,
  `create_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  `update_time` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uk_product_id` (`product_id`) COMMENT <span class="hljs-string">'å•†å“IDå”¯ä¸€'</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'åº“å­˜è¡¨'</span>;

<span class="hljs-comment">-- åˆå§‹åŒ–åº“å­˜æ•°æ®</span>
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `t_inventory` (`product_id`, `stock`) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, <span class="hljs-number">100</span>);
</code></pre>
<h5 data-id="heading-28">5.3 MQæ¶ˆè´¹è€…ï¼ˆå¤„ç†æ¶ˆæ¯é‡å¤æ¶ˆè´¹ï¼‰</h5>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">idempotent</span>.<span class="hljs-property">inventory</span>.<span class="hljs-property">mq</span>;

<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">idempotent</span>.<span class="hljs-property">common</span>.<span class="hljs-property">util</span>.<span class="hljs-property">RedisUtil</span>;
<span class="hljs-keyword">import</span> com.<span class="hljs-property">example</span>.<span class="hljs-property">idempotent</span>.<span class="hljs-property">inventory</span>.<span class="hljs-property">service</span>.<span class="hljs-property">InventoryService</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">spring</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">RocketMQMessageListener</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">apache</span>.<span class="hljs-property">rocketmq</span>.<span class="hljs-property">spring</span>.<span class="hljs-property">core</span>.<span class="hljs-property">RocketMQListener</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Component</span>;

<span class="hljs-keyword">import</span> javax.<span class="hljs-property">annotation</span>.<span class="hljs-property">Resource</span>;

<span class="hljs-comment">/**
 * åº“å­˜æ¶ˆè´¹è€…ï¼šå¤„ç†åº“å­˜æ‰£å‡æ¶ˆæ¯ï¼ˆå¹‚ç­‰å¤„ç†ï¼šæ¶ˆæ¯ID+Redisï¼‰
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RocketMQMessageListener</span>(topic = <span class="hljs-string">"topic-deduct-inventory"</span>, consumerGroup = <span class="hljs-string">"inventory-consumer-group"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InventoryConsumer</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">RocketMQListener</span>&lt;<span class="hljs-title class_">OrderMqProducer</span>.<span class="hljs-property">DeductInventoryMsg</span>&gt; {

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">InventoryService</span> inventoryService;
    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">RedisUtil</span> redisUtil;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">onMessage</span>(<span class="hljs-params">OrderMqProducer.DeductInventoryMsg msg</span>) {
        <span class="hljs-comment">// 1. è·å–RocketMQæ¶ˆæ¯IDï¼ˆé€šè¿‡ThreadLocalè·å–ï¼Œéœ€è‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨ï¼‰</span>
        <span class="hljs-title class_">String</span> msgId = <span class="hljs-title class_">MqMsgIdContextHolder</span>.<span class="hljs-title function_">getMsgId</span>();
        <span class="hljs-keyword">if</span> (msgId == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è·å–æ¶ˆæ¯IDå¤±è´¥ï¼Œæ— æ³•è¿›è¡Œå¹‚ç­‰æ ¡éªŒ"</span>);
        }

        <span class="hljs-comment">// 2. æ„å»ºRediså¹‚ç­‰é”®ï¼ˆæ¶ˆæ¯IDå”¯ä¸€ï¼‰</span>
        <span class="hljs-title class_">String</span> redisKey = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"mq:idempotent:%s"</span>, msgId);

        <span class="hljs-comment">// 3. å¹‚ç­‰æ ¡éªŒï¼šå·²å¤„ç†è¿‡çš„æ¶ˆæ¯ç›´æ¥è¿”å›</span>
        <span class="hljs-keyword">if</span> (redisUtil.<span class="hljs-title function_">hasKey</span>(redisKey)) {
            <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"æ¶ˆæ¯å·²å¤„ç†ï¼Œè·³è¿‡é‡å¤æ¶ˆè´¹ï¼š"</span> + msgId);
            <span class="hljs-keyword">return</span>;
        }

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 4. æ‰£å‡åº“å­˜ï¼ˆä¹è§‚é”ä¿è¯å¹‚ç­‰ï¼‰</span>
            <span class="hljs-built_in">boolean</span> success = inventoryService.<span class="hljs-title function_">deductStock</span>(msg.<span class="hljs-title function_">getProductId</span>(), msg.<span class="hljs-title function_">getNum</span>());
            <span class="hljs-keyword">if</span> (success) {
                <span class="hljs-comment">// 5. åº“å­˜æ‰£å‡æˆåŠŸï¼Œæ ‡è®°æ¶ˆæ¯å·²å¤„ç†ï¼ˆRedisè¿‡æœŸæ—¶é—´1å°æ—¶ï¼‰</span>
                redisUtil.<span class="hljs-title function_">setIfAbsent</span>(redisKey, <span class="hljs-string">"processed"</span>, <span class="hljs-number">3600</span>, java.<span class="hljs-property">util</span>.<span class="hljs-property">concurrent</span>.<span class="hljs-property">TimeUnit</span>.<span class="hljs-property">SECONDS</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥ï¼šåº“å­˜ä¸è¶³æˆ–é‡å¤æ‰£å‡"</span>);
            }
        } <span class="hljs-keyword">catch</span> (<span class="hljs-title class_">Exception</span> e) {
            <span class="hljs-comment">// 6. å¤„ç†å¤±è´¥ï¼šå¯æ ¹æ®ä¸šåŠ¡éœ€è¦é‡è¯•æˆ–å‘Šè­¦</span>
            <span class="hljs-title class_">System</span>.<span class="hljs-property">err</span>.<span class="hljs-title function_">println</span>(<span class="hljs-string">"åº“å­˜æ‰£å‡å¼‚å¸¸ï¼š"</span> + e.<span class="hljs-title function_">getMessage</span>());
            <span class="hljs-keyword">throw</span> e;
        }
    }

    <span class="hljs-comment">// æ¶ˆæ¯IDä¸Šä¸‹æ–‡æŒæœ‰ç±»ï¼ˆé€šè¿‡è‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨è®¾ç½®ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MqMsgIdContextHolder</span> {
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">ThreadLocal</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-variable constant_">MSG_ID_HOLDER</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadLocal</span>&lt;&gt;();

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setMsgId</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> msgId</span>) {
            <span class="hljs-variable constant_">MSG_ID_HOLDER</span>.<span class="hljs-title function_">set</span>(msgId);
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getMsgId</span>(<span class="hljs-params"/>) {
            <span class="hljs-keyword">return</span> <span class="hljs-variable constant_">MSG_ID_HOLDER</span>.<span class="hljs-title function_">get</span>();
        }

        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
            <span class="hljs-variable constant_">MSG_ID_HOLDER</span>.<span class="hljs-title function_">remove</span>();
        }
    }
}
</code></pre>
<h5 data-id="heading-29">5.4 è‡ªå®šä¹‰RocketMQæ¶ˆæ¯è½¬æ¢å™¨ï¼ˆè·å–æ¶ˆæ¯IDï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.idempotent.inventory.config;

<span class="hljs-keyword">import</span> com.example.idempotent.inventory.mq.InventoryConsumer;
<span class="hljs-keyword">import</span> org.apache.rocketmq.common.message.MessageExt;
<span class="hljs-keyword">import</span> org.apache.rocketmq.spring.support.DefaultRocketMQMessageConverter;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Bean;
<span class="hljs-keyword">import</span> org.springframework.context.<span class="hljs-keyword">annotation</span>.Configuration;
<span class="hljs-keyword">import</span> org.springframework.messaging.Message;
<span class="hljs-keyword">import</span> org.springframework.messaging.converter.MessageConverter;

<span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RocketMQConfig</span> {

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨ï¼šè·å–RocketMQæ¶ˆæ¯IDå¹¶å­˜å…¥ä¸Šä¸‹æ–‡
     */</span>
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MessageConverter rocketMQMessageConverter() {
        <span class="hljs-keyword">return</span> new DefaultRocketMQMessageConverter() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> Object fromMessage(Message&lt;?&gt; message, Class&lt;?&gt; targetClass) {
                <span class="hljs-comment">// è·å–RocketMQåŸå§‹æ¶ˆæ¯</span>
                MessageExt messageExt = (MessageExt) message.getHeaders().<span class="hljs-keyword">get</span>(<span class="hljs-string">"rocketmq_messageExt"</span>);
                <span class="hljs-keyword">if</span> (messageExt != <span class="hljs-literal">null</span>) {
                    <span class="hljs-comment">// å°†æ¶ˆæ¯IDå­˜å…¥ä¸Šä¸‹æ–‡</span>
                    InventoryConsumer.MqMsgIdContextHolder.setMsgId(messageExt.getMsgId());
                }
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.fromMessage(message, targetClass);
                } <span class="hljs-keyword">finally</span> {
                    <span class="hljs-comment">// æ¸…é™¤ä¸Šä¸‹æ–‡ï¼Œé¿å…å†…å­˜æ³„æ¼</span>
                    InventoryConsumer.MqMsgIdContextHolder.clear();
                }
            }
        };
    }
}
</code></pre>
<h5 data-id="heading-30">5.5 åº“å­˜Serviceï¼ˆä¹è§‚é”æ‰£å‡ï¼‰</h5>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.idempotent.inventory.service;

<span class="hljs-keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.<span class="hljs-type">ServiceImpl</span>;
<span class="hljs-keyword">import</span> com.example.idempotent.inventory.entity.<span class="hljs-type">Inventory</span>;
<span class="hljs-keyword">import</span> com.example.idempotent.inventory.mapper.<span class="hljs-type">InventoryMapper</span>;
<span class="hljs-keyword">import</span> org.springframework.stereotype.<span class="hljs-type">Service</span>;
<span class="hljs-keyword">import</span> org.springframework.transaction.annotation.<span class="hljs-type">Transactional</span>;

<span class="hljs-keyword">import</span> javax.annotation.<span class="hljs-type">Resource</span>;

<span class="hljs-meta">@Service</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">InventoryService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ServiceImpl&lt;InventoryMapper</span>, <span class="hljs-title">Inventory&gt;</span> </span>{

    <span class="hljs-meta">@Resource</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">InventoryMapper</span> inventoryMapper;

    <span class="hljs-comment">/**
     * æ‰£å‡åº“å­˜ï¼ˆä¹è§‚é”ä¿è¯å¹‚ç­‰ï¼‰
     */</span>
    <span class="hljs-meta">@Transactional</span>(rollbackFor = <span class="hljs-type">Exception</span>.<span class="hljs-keyword">class</span>)
    public boolean deductStock(<span class="hljs-type">Long</span> productId, <span class="hljs-type">Integer</span> num) {
        <span class="hljs-comment">// ä¹è§‚é”æ‰£å‡ï¼šä»…å½“ç‰ˆæœ¬å·åŒ¹é…æ—¶æ‰£å‡åº“å­˜</span>
        int rows = inventoryMapper.deductStock(productId, num);
        <span class="hljs-keyword">return</span> rows &gt; <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h3 data-id="heading-31">äº”ã€æµ‹è¯•éªŒè¯</h3>
<h4 data-id="heading-32">1. ç¯å¢ƒå‡†å¤‡</h4>
<ul>
<li>å¯åŠ¨ Nacosï¼ˆç«¯å£8848ï¼‰</li>
<li>å¯åŠ¨ Redisï¼ˆç«¯å£6379ï¼‰</li>
<li>å¯åŠ¨ RocketMQï¼ˆNameServerç«¯å£9876ï¼ŒBrokerç«¯å£10911ï¼‰</li>
<li>å¯åŠ¨ MySQLï¼Œæ‰§è¡Œä¸Šè¿°SQLåˆ›å»ºæ•°æ®åº“å’Œè¡¨</li>
<li>å¯åŠ¨è®¢å•æœåŠ¡ï¼ˆ8081ï¼‰å’Œåº“å­˜æœåŠ¡ï¼ˆ8082ï¼‰</li>
</ul>
<h4 data-id="heading-33">2. æµ‹è¯•åœºæ™¯1ï¼šé‡å¤ä¸‹å•ï¼ˆPostmanï¼‰</h4>
<ul>
<li>
<p>è¯·æ±‚åœ°å€ï¼š<code>http://localhost:8081/order/create</code></p>
</li>
<li>
<p>è¯·æ±‚å¤´ï¼š</p>
<ul>
<li><code>Idempotent-Request-Id: test-123456</code>ï¼ˆåŒä¸€IDé‡å¤æäº¤ï¼‰</li>
<li><code>User-Id: 1001</code></li>
</ul>
</li>
<li>
<p>è¯·æ±‚å‚æ•°ï¼š<code>productId=1001&amp;amount=99.9</code></p>
</li>
<li>
<p>æµ‹è¯•ç»“æœï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼šæˆåŠŸåˆ›å»ºè®¢å•ï¼Œåº“å­˜æ‰£å‡1ï¼ˆåº“å­˜å˜ä¸º99ï¼‰</li>
<li>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼šè¿”å›409å†²çªï¼Œæç¤ºâ€œä¸‹å•è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·1åˆ†é’Ÿåé‡è¯•ï¼â€ï¼Œè®¢å•è¡¨æ— é‡å¤æ•°æ®ï¼Œåº“å­˜ä¸å˜</li>
</ul>
</li>
</ul>
<h4 data-id="heading-34">3. æµ‹è¯•åœºæ™¯2ï¼šæ”¯ä»˜å›è°ƒé‡è¯•</h4>
<ul>
<li>
<p>è¯·æ±‚åœ°å€ï¼š<code>http://localhost:8081/order/pay/callback</code></p>
</li>
<li>
<p>è¯·æ±‚å¤´ï¼š<code>Idempotent-Request-Id: pay-789</code></p>
</li>
<li>
<p>è¯·æ±‚å‚æ•°ï¼š<code>orderNo=xxxï¼ˆç¬¬ä¸€æ¬¡ä¸‹å•è¿”å›çš„orderNoï¼‰&amp;version=0</code></p>
</li>
<li>
<p>æµ‹è¯•ç»“æœï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡è¯·æ±‚ï¼šè®¢å•çŠ¶æ€ä»0â†’1ï¼Œè¿”å›â€œå›è°ƒå¤„ç†æˆåŠŸâ€</li>
<li>ç¬¬äºŒæ¬¡è¯·æ±‚ï¼šè¿”å›â€œå›è°ƒå¤„ç†å¤±è´¥ï¼ˆé‡å¤è¯·æ±‚æˆ–çŠ¶æ€å·²å˜æ›´ï¼‰â€ï¼Œè®¢å•çŠ¶æ€ä¸å˜</li>
</ul>
</li>
</ul>
<h4 data-id="heading-35">4. æµ‹è¯•åœºæ™¯3ï¼šæ¶ˆæ¯é‡å¤æ¶ˆè´¹</h4>
<ul>
<li>æ‰‹åŠ¨åœ¨RocketMQæ§åˆ¶å°é‡å‘â€œtopic-deduct-inventoryâ€ä¸»é¢˜çš„æ¶ˆæ¯</li>
<li>è§‚å¯Ÿåº“å­˜æœåŠ¡æ—¥å¿—ï¼šè¾“å‡ºâ€œæ¶ˆæ¯å·²å¤„ç†ï¼Œè·³è¿‡é‡å¤æ¶ˆè´¹ï¼šxxxâ€ï¼Œåº“å­˜ä¸å˜</li>
</ul>
<h4 data-id="heading-36">æ€»ç»“</h4>
<ol start="6">
<li>
<p><strong>æ ¸å¿ƒåœºæ™¯</strong>ï¼šSpring Cloud ä¸­å¹‚ç­‰æ€§ä¸»è¦åº”ç”¨äºã€Œé‡å¤æäº¤ã€æœåŠ¡é‡è¯•ã€æ¶ˆæ¯é‡å¤æ¶ˆè´¹ã€æ”¯ä»˜å›è°ƒã€ç­‰åˆ†å¸ƒå¼åœºæ™¯ã€‚</p>
</li>
<li>
<p><strong>æ ¸å¿ƒæ–¹æ¡ˆ</strong>ï¼šé€šè¿‡ã€ŒRedis+å”¯ä¸€IDã€æ‹¦æˆªé‡å¤è¯·æ±‚ã€ã€Œæ•°æ®åº“å”¯ä¸€çº¦æŸã€é˜²æ­¢é‡å¤æ’å…¥ã€ã€Œä¹è§‚é”+çŠ¶æ€æœºã€æ§åˆ¶æ•°æ®æ›´æ–°ï¼Œä¸‰å±‚é˜²æŠ¤ç¡®ä¿å¹‚ç­‰ã€‚</p>
</li>
<li>
<p><strong>å…³é”®å®ç°</strong>ï¼š</p>
<ol>
<li>ç”¨è‡ªå®šä¹‰æ³¨è§£+æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†å¹‚ç­‰æ ¡éªŒï¼Œå‡å°‘é‡å¤ä»£ç ï¼›</li>
<li>ç»“åˆRediså®ç°åˆ†å¸ƒå¼å¹‚ç­‰ï¼Œé€‚é…å¾®æœåŠ¡è·¨èŠ‚ç‚¹éƒ¨ç½²ï¼›</li>
<li>æ•°æ®åº“çº¦æŸå’Œä¹è§‚é”ä½œä¸ºæœ€ç»ˆæ•°æ®é˜²æŠ¤ï¼Œé¿å…æç«¯æƒ…å†µä¸‹çš„å¼‚å¸¸ã€‚</li>
</ol>
</li>
</ol>
<p>è¿™å¥—æ–¹æ¡ˆå¯ç›´æ¥åº”ç”¨äºå®é™…å¼€å‘ï¼Œæ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯è°ƒæ•´è¿‡æœŸæ—¶é—´ã€å¹‚ç­‰é”®è§„åˆ™å³å¯ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é£ç‰›Nas-é€šè¿‡Dockerçš„Compose å®‰è£…WordPress]]></title>    <link>https://juejin.cn/post/7579229538792292358</link>    <guid>https://juejin.cn/post/7579229538792292358</guid>    <pubDate>2025-12-03T07:46:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579229538792292358" data-draft-id="7579179625462743082" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é£ç‰›Nas-é€šè¿‡Dockerçš„Compose å®‰è£…WordPress"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:46:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="PieroPC"/> <meta itemprop="url" content="https://juejin.cn/user/1998231182522521"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é£ç‰›Nas-é€šè¿‡Dockerçš„Compose å®‰è£…WordPress
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1998231182522521/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    PieroPC
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:46:00.000Z" title="Wed Dec 03 2025 07:46:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å›¾ï¼š</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed4a4565b45342248c4f3c8a7d4675f0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGllcm9QQw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765352760&amp;x-signature=obzQq67V4WhKILyzTrd2gq269Js%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">compose.yml ä»£ç ï¼š</h2>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">version:</span> <span class="hljs-string">'3.8'</span>

<span class="hljs-attr">services:</span>
  <span class="hljs-attr">db:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">mysql:8.0</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">wordpress_db</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">command:</span> 
      <span class="hljs-bullet">-</span> <span class="hljs-string">--default-authentication-plugin=mysql_native_password</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">--character-set-server=utf8mb4</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">--collation-server=utf8mb4_unicode_ci</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">MYSQL_ROOT_PASSWORD:</span> <span class="hljs-string">root_password_here</span>
      <span class="hljs-attr">MYSQL_DATABASE:</span> <span class="hljs-string">wordpress</span>
      <span class="hljs-attr">MYSQL_USER:</span> <span class="hljs-string">wordpress_user</span>
      <span class="hljs-attr">MYSQL_PASSWORD:</span> <span class="hljs-string">wordpress_password_here</span>
      <span class="hljs-attr">MYSQL_ALLOW_EMPTY_PASSWORD:</span> <span class="hljs-string">"no"</span>
    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">db_data:/var/lib/mysql</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql/conf.d:/etc/mysql/conf.d:ro</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./mysql/init:/docker-entrypoint-initdb.d:ro</span>
    <span class="hljs-attr">healthcheck:</span>
      <span class="hljs-attr">test:</span> [<span class="hljs-string">"CMD"</span>, <span class="hljs-string">"mysqladmin"</span>, <span class="hljs-string">"ping"</span>, <span class="hljs-string">"-h"</span>, <span class="hljs-string">"localhost"</span>, <span class="hljs-string">"-u"</span>, <span class="hljs-string">"root"</span>, <span class="hljs-string">"-p$$MYSQL_ROOT_PASSWORD"</span>]
      <span class="hljs-attr">timeout:</span> <span class="hljs-string">20s</span>
      <span class="hljs-attr">retries:</span> <span class="hljs-number">10</span>
      <span class="hljs-attr">interval:</span> <span class="hljs-string">10s</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">wp-network</span>

  <span class="hljs-attr">wordpress:</span>
    <span class="hljs-attr">image:</span> <span class="hljs-string">wordpress:latest</span>
    <span class="hljs-attr">container_name:</span> <span class="hljs-string">wordpress_app</span>
    <span class="hljs-attr">restart:</span> <span class="hljs-string">unless-stopped</span>
    <span class="hljs-attr">depends_on:</span>
      <span class="hljs-attr">db:</span>
        <span class="hljs-attr">condition:</span> <span class="hljs-string">service_healthy</span>
    <span class="hljs-attr">ports:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">"8080:80"</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">WORDPRESS_DB_HOST:</span> <span class="hljs-string">db:3306</span>
      <span class="hljs-attr">WORDPRESS_DB_NAME:</span> <span class="hljs-string">wordpress</span>
      <span class="hljs-attr">WORDPRESS_DB_USER:</span> <span class="hljs-string">wordpress_user</span>
      <span class="hljs-attr">WORDPRESS_DB_PASSWORD:</span> <span class="hljs-string">wordpress_password_here</span>
      <span class="hljs-attr">WORDPRESS_TABLE_PREFIX:</span> <span class="hljs-string">wp_</span>
      <span class="hljs-attr">WORDPRESS_DEBUG:</span> <span class="hljs-number">1</span>
      <span class="hljs-attr">WORDPRESS_CONFIG_EXTRA:</span> <span class="hljs-string">|
        define('WP_DEBUG_LOG', true);
        define('WP_DEBUG_DISPLAY', false);
        define('SAVEQUERIES', true);
</span>    <span class="hljs-attr">volumes:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">wp_data:/var/www/html</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./themes:/var/www/html/wp-content/themes</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./plugins:/var/www/html/wp-content/plugins</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./uploads:/var/www/html/wp-content/uploads</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">./config/php.ini:/usr/local/etc/php/conf.d/custom.ini</span>
    <span class="hljs-attr">networks:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">wp-network</span>

<span class="hljs-attr">volumes:</span>
  <span class="hljs-attr">db_data:</span>
  <span class="hljs-attr">wp_data:</span>

<span class="hljs-attr">networks:</span>
  <span class="hljs-attr">wp-network:</span>
    <span class="hljs-attr">driver:</span> <span class="hljs-string">bridge</span>
</code></pre>
<h2 data-id="heading-2">æ“ä½œï¼š</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c76c53b11f2f4f49955543fff0184d51~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgUGllcm9QQw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765352760&amp;x-signature=yZPkKzmVhHHjtxYsZS8XvosR%2FOg%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">æ³¨ï¼š</h2>
<p>ä¾‹å¦‚ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2F192.168.2.50%3A8080%2Flogin" target="_blank" title="http://192.168.2.50:8080/login" ref="nofollow noopener noreferrer">http://192.168.2.50:8080/login</a> è¿›å…¥åå°</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºRabbitMQçš„ä¼ä¸šçº§è®¢å•ç³»ç»Ÿè®¾è®¡ä¸å®ç°]]></title>    <link>https://juejin.cn/post/7579410911056986138</link>    <guid>https://juejin.cn/post/7579410911056986138</guid>    <pubDate>2025-12-03T07:33:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579410911056986138" data-draft-id="7579255046979174426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºRabbitMQçš„ä¼ä¸šçº§è®¢å•ç³»ç»Ÿè®¾è®¡ä¸å®ç°"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:33:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/808832912075352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºRabbitMQçš„ä¼ä¸šçº§è®¢å•ç³»ç»Ÿè®¾è®¡ä¸å®ç°
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808832912075352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:33:03.000Z" title="Wed Dec 03 2025 07:33:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">åŸºäºRabbitMQçš„ä¼ä¸šçº§è®¢å•ç³»ç»Ÿè®¾è®¡ä¸å®ç°æ–‡æ¡£</h2>
<h3 data-id="heading-1">ä¸€ã€æ–‡æ¡£æ¦‚è¿°</h3>
<p>æœ¬æ–‡æ¡£æ•´åˆäº†å¤šè½®æ²Ÿé€šä¸­å…³äºâ€œRabbitMQè§£å†³è®¢å•é¡ºåºé”™ä¹±â€â€œåº“å­˜æ‰£å‡å¹¶å‘æ§åˆ¶â€â€œè·¨æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡â€â€œä¼ä¸šçº§ä¸‹å•æµç¨‹â€çš„æ ¸å¿ƒå†…å®¹ï¼Œæä¾›ä»æŠ€æœ¯æ–¹æ¡ˆåˆ°ä»£ç è½åœ°ã€ä»æµç¨‹è®¾è®¡åˆ°çŠ¶æ€æµè½¬çš„å®Œæ•´å®ç°æŒ‡å—ï¼Œé€‚ç”¨äºSpring Cloudå¾®æœåŠ¡æ¶æ„ä¸‹çš„é«˜å¹¶å‘è®¢å•åœºæ™¯ã€‚</p>
<h3 data-id="heading-2">äºŒã€RabbitMQè§£å†³å¤šè®¢å•åŒæ­¥é¡ºåºé”™ä¹±æ–¹æ¡ˆ</h3>
<h4 data-id="heading-3">2.1 é—®é¢˜æ ¹æºä¸è®¾è®¡åŸåˆ™</h4>
<p>è®¢å•é¡ºåºé”™ä¹±çš„æ ¸å¿ƒåŸå› æ˜¯â€œæ¶ˆæ¯ç”Ÿäº§æ— åºâ€æˆ–â€œæ¶ˆæ¯æ¶ˆè´¹å¹¶è¡Œâ€ï¼Œéœ€éµå¾ªä»¥ä¸‹è®¾è®¡åŸåˆ™ï¼š</p>
<ol>
<li><strong>ç”Ÿäº§ç«¯æœ‰åº</strong>ï¼šåŒä¸€è®¢å•çš„æ¶ˆæ¯ï¼ˆåˆ›å»ºâ†’æ”¯ä»˜â†’å‘è´§ï¼‰æŒ‰ä¸šåŠ¡é¡ºåºåŒæ­¥å‘é€ï¼Œé€šè¿‡è®¢å•å·Hashè·¯ç”±åˆ°å›ºå®šé˜Ÿåˆ—ï¼›</li>
<li><strong>æ¶ˆè´¹ç«¯ä¸²è¡Œ</strong>ï¼šåŒä¸€é˜Ÿåˆ—é…ç½®<code>concurrency=1</code>ï¼ˆå•çº¿ç¨‹æ¶ˆè´¹ï¼‰ï¼Œé¿å…å¹¶è¡Œå¤„ç†ç ´åé¡ºåºï¼›</li>
<li><strong>æ‰‹åŠ¨ACKæœºåˆ¶</strong>ï¼šç¡®ä¿æ¶ˆæ¯å¤„ç†å®Œæˆåå†ç¡®è®¤ï¼Œé˜²æ­¢æ¶ˆæ¯ä¸¢å¤±å¯¼è‡´é¡ºåºæ–­å±‚ï¼›</li>
<li><strong>å¹‚ç­‰æ€§é˜²æŠ¤</strong>ï¼šåŸºäºè®¢å•å·+æ¶ˆæ¯åºå·å»é‡ï¼Œé¿å…é‡è¯•å¯¼è‡´é‡å¤æ‰§è¡Œä¸šåŠ¡ï¼›</li>
<li><strong>é˜Ÿåˆ—åˆ†åŒºè·¯ç”±</strong>ï¼šé«˜å¹¶å‘åœºæ™¯ä¸‹æŒ‰è®¢å•å·Hashåˆ†é…é˜Ÿåˆ—ï¼Œå¹³è¡¡â€œé¡ºåºæ€§â€ä¸â€œå¹¶å‘æ€§èƒ½â€ã€‚</li>
</ol>
<h4 data-id="heading-4">2.2 æŠ€æœ¯é€‰å‹</h4>



































<table><thead><tr><th>ç»„ä»¶</th><th>ç‰ˆæœ¬/ç±»å‹</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>æ ¸å¿ƒæ¡†æ¶</td><td>Spring Cloud 2023.0.0</td><td>å¾®æœåŠ¡åŸºç¡€æ¶æ„</td></tr><tr><td>æ¶ˆæ¯ä¸­é—´ä»¶</td><td>RabbitMQ 3.12+</td><td>æ¶ˆæ¯æŠ•é€’ä¸é¡ºåºæ§åˆ¶</td></tr><tr><td>æ¶ˆæ¯é›†æˆ</td><td>Spring Cloud Stream</td><td>ç®€åŒ–RabbitMQé…ç½®ä¸æ¶ˆæ¯ç»‘å®š</td></tr><tr><td>å¹‚ç­‰æ€§å­˜å‚¨</td><td>Redis</td><td>è®¢å•æ¶ˆæ¯å»é‡æ ‡è¯†å­˜å‚¨</td></tr><tr><td>æ•°æ®åº“</td><td>MySQL</td><td>è®¢å•ä¸åº“å­˜æ ¸å¿ƒæ•°æ®å­˜å‚¨</td></tr></tbody></table>
<h4 data-id="heading-5">2.3 æ ¸å¿ƒé…ç½®ä¸ä»£ç å®ç°</h4>
<h5 data-id="heading-6">2.3.1 ç”Ÿäº§è€…é…ç½®ï¼ˆè®¢å•æœåŠ¡ï¼‰</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">order-service</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">admin123</span>
    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">order-vhost</span>
    <span class="hljs-attr">publisher-confirm-type:</span> <span class="hljs-string">correlated</span>  <span class="hljs-comment"># æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</span>
    <span class="hljs-attr">publisher-returns:</span> <span class="hljs-literal">true</span>              <span class="hljs-comment"># æ¶ˆæ¯è¿”å›æœºåˆ¶</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">stream:</span>
      <span class="hljs-attr">rabbit:</span>
        <span class="hljs-attr">bindings:</span>
          <span class="hljs-attr">order-output:</span>
            <span class="hljs-attr">producer:</span>
              <span class="hljs-attr">durable:</span> <span class="hljs-literal">true</span>              <span class="hljs-comment"># æ¶ˆæ¯æŒä¹…åŒ–</span>
              <span class="hljs-attr">channel-transacted:</span> <span class="hljs-literal">true</span>   <span class="hljs-comment"># äº‹åŠ¡ç¡®ä¿ç”Ÿäº§é¡ºåº</span>
      <span class="hljs-attr">bindings:</span>
        <span class="hljs-attr">order-output:</span>
          <span class="hljs-attr">destination:</span> <span class="hljs-string">order-exchange</span>    <span class="hljs-comment"># ç»‘å®šäº¤æ¢æœº</span>
          <span class="hljs-attr">producer:</span>
            <span class="hljs-attr">exchange-type:</span> <span class="hljs-string">topic</span>         <span class="hljs-comment"># ä¸»é¢˜äº¤æ¢æœºï¼ˆæ”¯æŒè·¯ç”±ï¼‰</span>
          <span class="hljs-attr">content-type:</span> <span class="hljs-string">application/json</span>
      <span class="hljs-attr">binders:</span>
        <span class="hljs-attr">rabbit-binder:</span>
          <span class="hljs-attr">type:</span> <span class="hljs-string">rabbit</span>
          <span class="hljs-attr">environment:</span>
            <span class="hljs-attr">spring: rabbitmq:</span> {<span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>, <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>, <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span>, <span class="hljs-attr">password:</span> <span class="hljs-string">admin123</span>, <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">order-vhost</span>}
<span class="hljs-comment"># é˜Ÿåˆ—åˆ†åŒºé…ç½®</span>
<span class="hljs-attr">order:</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">queue-count:</span> <span class="hljs-number">3</span>                       <span class="hljs-comment"># 3ä¸ªé˜Ÿåˆ—å®ç°å¹¶è¡Œ</span>
    <span class="hljs-attr">routing-key-prefix:</span> <span class="hljs-string">order.route.</span>
</code></pre>
<h5 data-id="heading-7">2.3.2 æ¶ˆè´¹è€…é…ç½®ï¼ˆè®¢å•åŒæ­¥æœåŠ¡ï¼‰</h5>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">order-sync-service</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">admin</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">admin123</span>
    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">order-vhost</span>
    <span class="hljs-attr">listener:</span>
      <span class="hljs-attr">simple:</span>
        <span class="hljs-attr">acknowledge-mode:</span> <span class="hljs-string">manual</span>         <span class="hljs-comment"># æ‰‹åŠ¨ACK</span>
        <span class="hljs-attr">concurrency:</span> <span class="hljs-number">1</span>                   <span class="hljs-comment"># å•çº¿ç¨‹æ¶ˆè´¹</span>
        <span class="hljs-attr">max-concurrency:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">prefetch:</span> <span class="hljs-number">1</span>                      <span class="hljs-comment"># é¢„å–1æ¡æ¶ˆæ¯ï¼Œé¿å…ç¼“å­˜ä¹±åº</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">stream:</span>
      <span class="hljs-attr">rabbit:</span>
        <span class="hljs-attr">bindings:</span>
          <span class="hljs-attr">order-input:</span>
            <span class="hljs-attr">consumer:</span>
              <span class="hljs-attr">durable:</span> <span class="hljs-literal">true</span>
              <span class="hljs-attr">auto-bind-dlq:</span> <span class="hljs-literal">true</span>        <span class="hljs-comment"># å¼€å¯æ­»ä¿¡é˜Ÿåˆ—ï¼ˆå¤„ç†å¤±è´¥æ¶ˆæ¯ï¼‰</span>
              <span class="hljs-attr">dlq-ttl:</span> <span class="hljs-number">86400000</span>          <span class="hljs-comment"># æ­»ä¿¡æ¶ˆæ¯è¿‡æœŸæ—¶é—´ï¼ˆ24hï¼‰</span>
              <span class="hljs-attr">republish-to-dlq:</span> <span class="hljs-literal">true</span>     <span class="hljs-comment"># å¤±è´¥æ¶ˆæ¯é‡å‘å¸ƒåˆ°æ­»ä¿¡é˜Ÿåˆ—</span>
      <span class="hljs-attr">bindings:</span>
        <span class="hljs-attr">order-input:</span>
          <span class="hljs-attr">destination:</span> <span class="hljs-string">order-exchange</span>
          <span class="hljs-attr">content-type:</span> <span class="hljs-string">application/json</span>
          <span class="hljs-attr">consumer:</span>
            <span class="hljs-attr">exchange-type:</span> <span class="hljs-string">topic</span>
            <span class="hljs-attr">routing-key-pattern:</span> <span class="hljs-string">order.route.*</span>  <span class="hljs-comment"># è®¢é˜…æ‰€æœ‰è®¢å•è·¯ç”±é”®</span>
</code></pre>
<h5 data-id="heading-8">2.3.3 æ ¸å¿ƒä»£ç ï¼ˆè®¢å•æ¶ˆæ¯ç”Ÿäº§ä¸æ¶ˆè´¹ï¼‰</h5>
<h6 data-id="heading-9">ï¼ˆ1ï¼‰è®¢å•æ¶ˆæ¯DTO</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> lombok.Data;
<span class="hljs-keyword">import</span> java.io.Serializable;
<span class="hljs-keyword">import</span> java.math.BigDecimal;
<span class="hljs-keyword">import</span> java.time.LocalDateTime;

<span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMessageDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;
    <span class="hljs-keyword">private</span> String orderNo;          <span class="hljs-comment">// è®¢å•å·ï¼ˆå”¯ä¸€æ ‡è¯†ï¼‰</span>
    <span class="hljs-keyword">private</span> Integer orderStatus;     <span class="hljs-comment">// è®¢å•çŠ¶æ€ï¼ˆ1-åˆ›å»ºï¼Œ2-æ”¯ä»˜ï¼Œ3-å‘è´§ï¼‰</span>
    <span class="hljs-keyword">private</span> BigDecimal amount;       <span class="hljs-comment">// è®¢å•é‡‘é¢</span>
    <span class="hljs-keyword">private</span> LocalDateTime sendTime;  <span class="hljs-comment">// æ¶ˆæ¯å‘é€æ—¶é—´</span>
    <span class="hljs-keyword">private</span> Integer msgSeq;          <span class="hljs-comment">// æ¶ˆæ¯åºå·ï¼ˆä¿è¯åŒè®¢å•å†…é¡ºåºï¼‰</span>
}
</code></pre>
<h6 data-id="heading-10">ï¼ˆ2ï¼‰è®¢å•æ¶ˆæ¯ç”Ÿäº§è€…ï¼ˆæŒ‰è®¢å•å·Hashè·¯ç”±ï¼‰</h6>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> cn.<span class="hljs-property">hutool</span>.<span class="hljs-property">core</span>.<span class="hljs-property">lang</span>.<span class="hljs-property">hash</span>.<span class="hljs-property">MurmurHash</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Value</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">cloud</span>.<span class="hljs-property">stream</span>.<span class="hljs-property">messaging</span>.<span class="hljs-property">Source</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">messaging</span>.<span class="hljs-property">support</span>.<span class="hljs-property">MessageBuilder</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMessageProducer</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">OrderOutputChannel</span> orderOutputChannel;  <span class="hljs-comment">// è‡ªå®šä¹‰è¾“å‡ºé€šé“</span>
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${order.rabbitmq.routing-key-prefix}"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> routingKeyPrefix;
    <span class="hljs-meta">@Value</span>(<span class="hljs-string">"${order.rabbitmq.queue-count}"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Integer</span> queueCount;

    <span class="hljs-comment">// å‘é€è®¢å•æ¶ˆæ¯ï¼ˆæ ¸å¿ƒï¼šæŒ‰è®¢å•å·Hashè·¯ç”±åˆ°å›ºå®šé˜Ÿåˆ—ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">sendOrderMessage</span>(<span class="hljs-params">OrderMessageDTO orderMessage</span>) {
        <span class="hljs-comment">// ç”Ÿæˆè·¯ç”±é”®ï¼šè®¢å•å·Hashå–æ¨¡ï¼Œç¡®ä¿åŒè®¢å•è¿›åŒä¸€é˜Ÿåˆ—</span>
        <span class="hljs-title class_">String</span> routingKey = <span class="hljs-title function_">generateRoutingKey</span>(orderMessage.<span class="hljs-title function_">getOrderNo</span>());
        <span class="hljs-comment">// æ„å»ºå¹¶å‘é€æ¶ˆæ¯</span>
        org.<span class="hljs-property">springframework</span>.<span class="hljs-property">messaging</span>.<span class="hljs-property">Message</span>&lt;<span class="hljs-title class_">OrderMessageDTO</span>&gt; message = <span class="hljs-title class_">MessageBuilder</span>
                .<span class="hljs-title function_">withPayload</span>(orderMessage)
                .<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">"spring.cloud.stream.sendto.destination"</span>, routingKey)
                .<span class="hljs-title function_">build</span>();
        orderOutputChannel.<span class="hljs-title function_">output</span>().<span class="hljs-title function_">send</span>(message);
    }

    <span class="hljs-comment">// ç”Ÿæˆè·¯ç”±é”®ï¼ˆMurmurHashç¡®ä¿åˆ†å¸ƒå‡åŒ€ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">generateRoutingKey</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> orderNo</span>) {
        int hash = <span class="hljs-title class_">MurmurHash</span>.<span class="hljs-title function_">hash32</span>(orderNo);
        int queueIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(hash) % queueCount;
        <span class="hljs-keyword">return</span> routingKeyPrefix + queueIndex;
    }
}
</code></pre>
<h6 data-id="heading-11">ï¼ˆ3ï¼‰è®¢å•æ¶ˆæ¯æ¶ˆè´¹è€…ï¼ˆå•çº¿ç¨‹+æ‰‹åŠ¨ACKï¼‰</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.rabbitmq.client.Channel;
<span class="hljs-keyword">import</span> org.springframework.amqp.core.Message;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.cloud.stream.annotation.StreamListener;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderMessageConsumer</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> IdempotentHandler idempotentHandler;  <span class="hljs-comment">// å¹‚ç­‰æ€§å·¥å…·ç±»</span>

    <span class="hljs-meta">@StreamListener(OrderInputChannel.ORDER_INPUT)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">consumeOrderMessage</span><span class="hljs-params">(OrderMessageDTO message, Channel channel, Message amqpMessage)</span> <span class="hljs-keyword">throws</span> Exception {
        <span class="hljs-type">long</span> <span class="hljs-variable">deliveryTag</span> <span class="hljs-operator">=</span> amqpMessage.getMessageProperties().getDeliveryTag();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 1. å¹‚ç­‰æ€§æ£€æŸ¥ï¼šé¿å…é‡å¤æ¶ˆè´¹</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">isFirstProcess</span> <span class="hljs-operator">=</span> idempotentHandler.checkAndSet(message.getOrderNo(), message.getMsgSeq());
            <span class="hljs-keyword">if</span> (!isFirstProcess) {
                channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
                <span class="hljs-keyword">return</span>;
            }
            <span class="hljs-comment">// 2. ä¸šåŠ¡å¤„ç†ï¼ˆæŒ‰è®¢å•çŠ¶æ€æ‰§è¡ŒåŒæ­¥é€»è¾‘ï¼‰</span>
            processOrderBusiness(message);
            <span class="hljs-comment">// 3. æ‰‹åŠ¨ACKï¼šå¤„ç†æˆåŠŸç¡®è®¤æ¶ˆæ¯</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// 4. æ‰‹åŠ¨NACKï¼šå¤„ç†å¤±è´¥ï¼Œæ¶ˆæ¯è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
            channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">false</span>);
        }
    }

    <span class="hljs-comment">// è®¢å•ä¸šåŠ¡å¤„ç†ï¼ˆåˆ›å»º/æ”¯ä»˜/å‘è´§é€»è¾‘ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOrderBusiness</span><span class="hljs-params">(OrderMessageDTO message)</span> {
        <span class="hljs-keyword">switch</span> (message.getOrderStatus()) {
            <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:
                System.out.printf(<span class="hljs-string">"åŒæ­¥è®¢å•åˆ›å»ºï¼š%s%n"</span>, message.getOrderNo());
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:
                System.out.printf(<span class="hljs-string">"åŒæ­¥è®¢å•æ”¯ä»˜ï¼š%s%n"</span>, message.getOrderNo());
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:
                System.out.printf(<span class="hljs-string">"åŒæ­¥è®¢å•å‘è´§ï¼š%s%n"</span>, message.getOrderNo());
                <span class="hljs-keyword">break</span>;
        }
    }
}
</code></pre>
<h3 data-id="heading-12">ä¸‰ã€å¤šè®¢å•åº“å­˜æ‰£å‡å¹¶å‘æ§åˆ¶</h3>
<h4 data-id="heading-13">3.1 åº“å­˜æ‰£å‡æ ¸å¿ƒé£é™©</h4>
<ol start="6">
<li><strong>åº“å­˜è¶…å–</strong>ï¼šå¤šè®¢å•åŒæ—¶è¯»å–åº“å­˜å¹¶æ‰£å‡ï¼Œå¯¼è‡´åº“å­˜ä¸ºè´Ÿï¼›</li>
<li><strong>æ•°æ®ä¸ä¸€è‡´</strong>ï¼šåº“å­˜æ‰£å‡æˆåŠŸä½†è®¢å•å¤„ç†å¤±è´¥ï¼Œæˆ–åä¹‹ï¼›</li>
<li><strong>è·¨æœåŠ¡è€¦åˆ</strong>ï¼šåº“å­˜ä½œä¸ºç‹¬ç«‹æœåŠ¡æ—¶ï¼ŒåŒæ­¥è°ƒç”¨æ˜“å¯¼è‡´è¶…æ—¶æˆ–æœåŠ¡ä¾èµ–æ•…éšœã€‚</li>
</ol>
<h4 data-id="heading-14">3.2 è§£å†³æ–¹æ¡ˆï¼šRedisé¢„æ‰£å‡+åˆ†å¸ƒå¼é”+ä¹è§‚é”</h4>
<h5 data-id="heading-15">3.2.1 æŠ€æœ¯åŸç†</h5>
<ol start="9">
<li><strong>Redisé¢„æ‰£å‡</strong>ï¼šç¼“å­˜å•†å“åº“å­˜ï¼Œé«˜å¹¶å‘ä¸‹å¿«é€Ÿåˆ¤æ–­åº“å­˜æ˜¯å¦å……è¶³ï¼Œå‡å°‘æ•°æ®åº“è®¿é—®ï¼›</li>
<li><strong>åˆ†å¸ƒå¼é”ï¼ˆRedissonï¼‰</strong> ï¼šé”å®šå•†å“ç»´åº¦ï¼Œé˜²æ­¢å¤šè®¢å•åŒæ—¶æ‰£å‡åŒä¸€å•†å“åº“å­˜ï¼›</li>
<li><strong>æ•°æ®åº“ä¹è§‚é”</strong>ï¼šé€šè¿‡<code>version</code>å­—æ®µç¡®ä¿åº“å­˜æ‰£å‡çš„åŸå­æ€§ï¼Œé¿å…å¹¶å‘å†™å†²çªã€‚</li>
</ol>
<h5 data-id="heading-16">3.2.2 æ ¸å¿ƒä»£ç å®ç°</h5>
<h6 data-id="heading-17">ï¼ˆ1ï¼‰åº“å­˜å®ä½“ä¸æ•°æ®åº“è®¾è®¡</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- å•†å“åº“å­˜è¡¨ï¼ˆå«ä¹è§‚é”ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> product_stock (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY AUTO_INCREMENT,
  product_id <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å•†å“ID'</span>,
  stock_num <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å½“å‰åº“å­˜'</span>,
  locked_num <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'å·²é”å®šåº“å­˜ï¼ˆæœªæ”¯ä»˜è®¢å•å ç”¨ï¼‰'</span>,
  version <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'ä¹è§‚é”ç‰ˆæœ¬å·'</span>,
  create_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  update_time DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
  <span class="hljs-keyword">UNIQUE</span> KEY uk_product_id (product_id)
);
</code></pre>
<h6 data-id="heading-18">ï¼ˆ2ï¼‰åº“å­˜æ‰£å‡æœåŠ¡</h6>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> org.<span class="hljs-property">redisson</span>.<span class="hljs-property">api</span>.<span class="hljs-property">RLock</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">data</span>.<span class="hljs-property">redis</span>.<span class="hljs-property">core</span>.<span class="hljs-property">StringRedisTemplate</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">stereotype</span>.<span class="hljs-property">Service</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">transaction</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Transactional</span>;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockDeductService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">ProductStockRepository</span> stockRepository;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">StringRedisTemplate</span> redisTemplate;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">StockLockUtil</span> stockLockUtil;  <span class="hljs-comment">// åˆ†å¸ƒå¼é”å·¥å…·ç±»</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> final <span class="hljs-title class_">String</span> <span class="hljs-variable constant_">REDIS_STOCK_KEY</span> = <span class="hljs-string">"product:stock:"</span>;

    <span class="hljs-comment">// åº“å­˜æ‰£å‡æ ¸å¿ƒæ–¹æ³•</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">deductStock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> productId, Integer buyNum, <span class="hljs-built_in">String</span> orderNo</span>) {
        <span class="hljs-comment">// 1. Redisé¢„åˆ¤æ–­åº“å­˜</span>
        <span class="hljs-title class_">String</span> redisKey = <span class="hljs-variable constant_">REDIS_STOCK_KEY</span> + productId;
        <span class="hljs-title class_">String</span> stockStr = redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">get</span>(redisKey);
        <span class="hljs-keyword">if</span> (stockStr == <span class="hljs-literal">null</span>) <span class="hljs-title function_">loadStockToRedis</span>(productId);  <span class="hljs-comment">// ç¼“å­˜æœªå‘½ä¸­ï¼Œä»DBåŠ è½½</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Integer</span>.<span class="hljs-built_in">parseInt</span>(stockStr) &lt; buyNum) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-comment">// 2. è·å–åˆ†å¸ƒå¼é”ï¼ˆé”å®šå•†å“ï¼‰</span>
        <span class="hljs-title class_">RLock</span> lock = stockLockUtil.<span class="hljs-title function_">lock</span>(productId, <span class="hljs-number">3</span>, <span class="hljs-number">10</span>);  <span class="hljs-comment">// ç­‰å¾…3sï¼ŒæŒæœ‰10s</span>
        <span class="hljs-keyword">if</span> (lock == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 3. æ•°æ®åº“åŒé‡æ ¡éªŒ+ä¹è§‚é”æ‰£å‡</span>
            <span class="hljs-title class_">ProductStock</span> stock = stockRepository.<span class="hljs-title function_">findByProductId</span>(productId)
                    .<span class="hljs-title function_">orElseThrow</span>(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å•†å“ä¸å­˜åœ¨ï¼š"</span> + productId));
            <span class="hljs-keyword">if</span> (stock.<span class="hljs-title function_">getStockNum</span>() &lt; buyNum) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// ä¹è§‚é”æ‰£å‡ï¼šversionä¸åŒ¹é…åˆ™æ›´æ–°å¤±è´¥ï¼ˆè¿”å›0ï¼‰</span>
            int affectedRows = stockRepository.<span class="hljs-title function_">deductStock</span>(stock.<span class="hljs-title function_">getId</span>(), buyNum, stock.<span class="hljs-title function_">getVersion</span>());
            <span class="hljs-keyword">if</span> (affectedRows != <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-comment">// 4. æ›´æ–°Redisç¼“å­˜</span>
            redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">decrement</span>(redisKey, buyNum);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">finally</span> {
            stockLockUtil.<span class="hljs-title function_">unlock</span>(lock);  <span class="hljs-comment">// é‡Šæ”¾é”</span>
        }
    }

    <span class="hljs-comment">// ä»DBåŠ è½½åº“å­˜åˆ°Redis</span>
    <span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">loadStockToRedis</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> productId</span>) {
        <span class="hljs-title class_">ProductStock</span> stock = stockRepository.<span class="hljs-title function_">findByProductId</span>(productId)
                .<span class="hljs-title function_">orElseThrow</span>(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å•†å“ä¸å­˜åœ¨ï¼š"</span> + productId));
        redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">set</span>(<span class="hljs-variable constant_">REDIS_STOCK_KEY</span> + productId, stock.<span class="hljs-title function_">getStockNum</span>().<span class="hljs-title function_">toString</span>());
    }

    <span class="hljs-comment">// åº“å­˜å›æ»šï¼ˆè®¢å•å–æ¶ˆæ—¶è°ƒç”¨ï¼‰</span>
    <span class="hljs-meta">@Transactional</span>(rollbackFor = <span class="hljs-title class_">Exception</span>.<span class="hljs-property">class</span>)
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">rollbackStock</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> productId, Integer buyNum</span>) {
        <span class="hljs-title class_">ProductStock</span> stock = stockRepository.<span class="hljs-title function_">findByProductId</span>(productId)
                .<span class="hljs-title function_">orElseThrow</span>(() -&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"å•†å“ä¸å­˜åœ¨ï¼š"</span> + productId));
        stock.<span class="hljs-title function_">setStockNum</span>(stock.<span class="hljs-title function_">getStockNum</span>() + buyNum);
        stockRepository.<span class="hljs-title function_">save</span>(stock);
        redisTemplate.<span class="hljs-title function_">opsForValue</span>().<span class="hljs-title function_">increment</span>(<span class="hljs-variable constant_">REDIS_STOCK_KEY</span> + productId, buyNum);
    }
}
</code></pre>
<h6 data-id="heading-19">ï¼ˆ3ï¼‰åˆ†å¸ƒå¼é”å·¥å…·ç±»</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> org.redisson.api.RLock;
<span class="hljs-keyword">import</span> org.redisson.api.RedissonClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Component;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockLockUtil</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;

    <span class="hljs-comment">// è·å–å•†å“åº“å­˜é”</span>
    <span class="hljs-keyword">public</span> RLock <span class="hljs-title function_">lock</span><span class="hljs-params">(String productId, <span class="hljs-type">long</span> waitTime, <span class="hljs-type">long</span> leaseTime)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"stock:lock:"</span> + productId;
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> lock.tryLock(waitTime, leaseTime, TimeUnit.SECONDS) ? lock : <span class="hljs-literal">null</span>;
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">// é‡Šæ”¾é”</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">unlock</span><span class="hljs-params">(RLock lock)</span> {
        <span class="hljs-keyword">if</span> (lock != <span class="hljs-literal">null</span> &amp;&amp; lock.isHeldByCurrentThread()) lock.unlock();
    }
}
</code></pre>
<h3 data-id="heading-20">å››ã€è·¨æœåŠ¡åˆ†å¸ƒå¼äº‹åŠ¡ä¸ä¸€è‡´æ€§ä¿éšœ</h3>
<h4 data-id="heading-21">4.1 æ ¸å¿ƒé—®é¢˜ï¼šè·¨æœåŠ¡åŸå­æ€§</h4>
<p>è®¢å•æœåŠ¡ï¼ˆAï¼‰ä¸åº“å­˜æœåŠ¡ï¼ˆBï¼‰ç‹¬ç«‹éƒ¨ç½²ï¼Œéœ€ç¡®ä¿â€œè®¢å•é¢„åˆ›å»º+åº“å­˜æ‰£å‡â€è¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥ï¼Œéœ€é€šè¿‡åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³ã€‚</p>
<h4 data-id="heading-22">4.2 æœ€ä¼˜æ–¹æ¡ˆï¼šå¯é æ¶ˆæ¯+æœ€ç»ˆä¸€è‡´æ€§</h4>
<h5 data-id="heading-23">4.2.1 æ–¹æ¡ˆåŸç†</h5>
<p>åŸºäºRabbitMQå®ç°â€œå¯é æ¶ˆæ¯æŠ•é€’+æ¶ˆè´¹ç¡®è®¤+å®šæ—¶è¡¥å¿â€ï¼Œç¡®ä¿è·¨æœåŠ¡æ•°æ®æœ€ç»ˆä¸€è‡´ï¼š</p>
<ol start="12">
<li><strong>å¯é æ¶ˆæ¯æŠ•é€’</strong>ï¼šè®¢å•æœåŠ¡é¢„åˆ›å»ºè®¢å•åï¼Œé€šè¿‡äº‹åŠ¡ç¡®ä¿æ¶ˆæ¯å¿…å…¥é˜Ÿï¼›</li>
<li><strong>å¯é æ¶ˆæ¯æ¶ˆè´¹</strong>ï¼šåº“å­˜æœåŠ¡æ¶ˆè´¹æ¶ˆæ¯å¹¶æ‰§è¡Œæ‰£å‡ï¼Œå¤„ç†å®Œæˆåå‘é€ç»“æœæ¶ˆæ¯ï¼›</li>
<li><strong>ç»“æœå¤„ç†</strong>ï¼šè®¢å•æœåŠ¡æ¶ˆè´¹ç»“æœæ¶ˆæ¯ï¼Œæ›´æ–°è®¢å•çŠ¶æ€ï¼ˆæˆåŠŸç¡®è®¤/å¤±è´¥å›æ»šï¼‰ï¼›</li>
<li><strong>å®šæ—¶è¡¥å¿</strong>ï¼šå¤„ç†æ¶ˆæ¯ä¸¢å¤±æˆ–å»¶è¿Ÿå¯¼è‡´çš„ä¸ä¸€è‡´ã€‚</li>
</ol>
<h5 data-id="heading-24">4.2.2 è·¨æœåŠ¡æµç¨‹è®¾è®¡</h5>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[ç”¨æˆ·ä¸‹å•]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[è®¢å•æœåŠ¡ï¼šé¢„åˆ›å»ºè®¢å•ï¼ˆçŠ¶æ€0ï¼šå¾…ç¡®è®¤ï¼‰]</span>
    <span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[è®¢å•æœåŠ¡ï¼šå‘é€åº“å­˜æ‰£å‡æ¶ˆæ¯ï¼ˆäº‹åŠ¡ç¡®ä¿æŠ•é€’ï¼‰]</span>
    C --&gt; D<span class="hljs-selector-attr">[åº“å­˜æœåŠ¡ï¼šæ¶ˆè´¹æ¶ˆæ¯ï¼Œæ‰§è¡Œæ‰£å‡]</span>
    D --&gt; E{æ‰£å‡æˆåŠŸï¼Ÿ}
    E --&gt;|æ˜¯| F<span class="hljs-selector-attr">[åº“å­˜æœåŠ¡ï¼šå‘é€â€œæ‰£å‡æˆåŠŸâ€æ¶ˆæ¯]</span>
    E --&gt;|å¦| G<span class="hljs-selector-attr">[åº“å­˜æœåŠ¡ï¼šå‘é€â€œæ‰£å‡å¤±è´¥â€æ¶ˆæ¯]</span>
    F --&gt; H<span class="hljs-selector-attr">[è®¢å•æœåŠ¡ï¼šæ›´æ–°è®¢å•çŠ¶æ€ä¸º1ï¼ˆå¾…æ”¯ä»˜ï¼‰]</span>
    G --&gt; <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[è®¢å•æœåŠ¡ï¼šåˆ é™¤é¢„åˆ›å»ºè®¢å•ï¼ˆå›æ»šï¼‰]</span>
    J<span class="hljs-selector-attr">[å®šæ—¶è¡¥å¿ä»»åŠ¡]</span> --&gt; K<span class="hljs-selector-attr">[æŸ¥è¯¢è¶…æ—¶â€œå¾…ç¡®è®¤â€è®¢å•]</span>
    K --&gt; L<span class="hljs-selector-attr">[è°ƒç”¨åº“å­˜æœåŠ¡æŸ¥è¯¢æ‰£å‡çŠ¶æ€]</span>
    L --&gt; M{å·²æ‰£å‡ï¼Ÿ}
    M --&gt;|æ˜¯| H
    M --&gt;|å¦| <span class="hljs-selector-tag">I</span>
</code></pre>
<h5 data-id="heading-25">4.2.3 æ ¸å¿ƒä»£ç å®ç°</h5>
<h6 data-id="heading-26">ï¼ˆ1ï¼‰è®¢å•æœåŠ¡ï¼šé¢„åˆ›å»ºè®¢å•ä¸æ¶ˆæ¯å‘é€</h6>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class OrderService {
    <span class="hljs-keyword">@Autowired</span>
    private OrderMainRepository orderRepository;
    <span class="hljs-keyword">@Autowired</span>
    private StockMessageChannel stockMessageChannel;  <span class="hljs-comment">// åº“å­˜æ¶ˆæ¯é€šé“</span>

    <span class="hljs-comment">// æ ¸å¿ƒä¸‹å•æµç¨‹ï¼šé¢„åˆ›å»ºè®¢å•â†’å‘é€åº“å­˜æ‰£å‡æ¶ˆæ¯</span>
    <span class="hljs-keyword">@Transactional</span>(rollbackFor = Exception.class)
    public boolean createOrder(String orderNo, String productId, Integer buyNum) {
        try {
            <span class="hljs-comment">// 1. é¢„åˆ›å»ºè®¢å•ï¼ˆçŠ¶æ€0ï¼šå¾…ç¡®è®¤ï¼Œæœªå ç”¨åº“å­˜ï¼‰</span>
            OrderMain preOrder = new <span class="hljs-built_in">OrderMain</span>();
            preOrder<span class="hljs-selector-class">.setOrderNo</span>(orderNo);
            preOrder<span class="hljs-selector-class">.setProductId</span>(productId);
            preOrder<span class="hljs-selector-class">.setBuyNum</span>(buyNum);
            preOrder<span class="hljs-selector-class">.setOrderStatus</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// 0-å¾…ç¡®è®¤</span>
            orderRepository<span class="hljs-selector-class">.save</span>(preOrder);

            <span class="hljs-comment">// 2. å‘é€åº“å­˜æ‰£å‡æ¶ˆæ¯ï¼ˆäº‹åŠ¡ç¡®ä¿ï¼šè®¢å•é¢„åˆ›å»ºæˆåŠŸåˆ™æ¶ˆæ¯å¿…å‘ï¼‰</span>
            StockDeductRequestDTO request = new <span class="hljs-built_in">StockDeductRequestDTO</span>();
            request<span class="hljs-selector-class">.setOrderNo</span>(orderNo);
            request<span class="hljs-selector-class">.setProductId</span>(productId);
            request<span class="hljs-selector-class">.setBuyNum</span>(buyNum);
            request<span class="hljs-selector-class">.setMessageId</span>(IdUtil.fastSimpleUUID());  <span class="hljs-comment">// æ¶ˆæ¯å”¯ä¸€IDï¼ˆå¹‚ç­‰ï¼‰</span>
            stockMessageChannel<span class="hljs-selector-class">.stockDeductOutput</span>()<span class="hljs-selector-class">.send</span>(
                    MessageBuilder.withPayload(request)<span class="hljs-selector-class">.build</span>()
            );
            return true;
        } catch (Exception e) {
            return false;  <span class="hljs-comment">// å¼‚å¸¸æ—¶æœ¬åœ°äº‹åŠ¡å›æ»šï¼Œé¢„åˆ›å»ºè®¢å•åˆ é™¤</span>
        }
    }
}
</code></pre>
<h6 data-id="heading-27">ï¼ˆ2ï¼‰åº“å­˜æœåŠ¡ï¼šæ¶ˆè´¹æ‰£å‡æ¶ˆæ¯å¹¶è¿”å›ç»“æœ</h6>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class StockDeductHandler {
    <span class="hljs-keyword">@Autowired</span>
    private StockDeductService stockDeductService;
    <span class="hljs-keyword">@Autowired</span>
    private StockMessageChannel stockMessageChannel;
    <span class="hljs-keyword">@Autowired</span>
    private IdempotentHandler idempotentHandler;

    <span class="hljs-keyword">@StreamListener</span>(StockMessageChannel.STOCK_DEDUCT_INPUT)
    public void handleStockDeduct(StockDeductRequestDTO request, Channel channel, Message amqpMessage) throws Exception {
        long deliveryTag = amqpMessage<span class="hljs-selector-class">.getMessageProperties</span>()<span class="hljs-selector-class">.getDeliveryTag</span>();
        String messageId = request<span class="hljs-selector-class">.getMessageId</span>();
        try {
            <span class="hljs-comment">// 1. å¹‚ç­‰æ€§æ£€æŸ¥ï¼šé¿å…é‡å¤æ‰£å‡</span>
            if (!idempotentHandler.checkAndSet(messageId, <span class="hljs-number">1</span>)) {
                channel<span class="hljs-selector-class">.basicAck</span>(deliveryTag, false);
                return;
            }
            <span class="hljs-comment">// 2. æ‰§è¡Œåº“å­˜æ‰£å‡</span>
            boolean success = stockDeductService<span class="hljs-selector-class">.deductStock</span>(
                    request.getProductId(), request<span class="hljs-selector-class">.getBuyNum</span>(), request<span class="hljs-selector-class">.getOrderNo</span>()
            );
            <span class="hljs-comment">// 3. å‘é€æ‰£å‡ç»“æœ</span>
            StockDeductResultDTO result = new <span class="hljs-built_in">StockDeductResultDTO</span>();
            result<span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
            result<span class="hljs-selector-class">.setMessageId</span>(messageId);
            result<span class="hljs-selector-class">.setSuccess</span>(success);
            stockMessageChannel<span class="hljs-selector-class">.stockResultOutput</span>()<span class="hljs-selector-class">.send</span>(
                    MessageBuilder.withPayload(result)<span class="hljs-selector-class">.build</span>()
            );
            <span class="hljs-comment">// 4. ç¡®è®¤æ¶ˆæ¯</span>
            channel<span class="hljs-selector-class">.basicAck</span>(deliveryTag, false);
        } catch (Exception e) {
            <span class="hljs-comment">// 5. å¤±è´¥å¤„ç†ï¼šå‘é€å¤±è´¥ç»“æœ+æ‹’ç»æ¶ˆæ¯</span>
            StockDeductResultDTO failResult = new <span class="hljs-built_in">StockDeductResultDTO</span>();
            failResult<span class="hljs-selector-class">.setOrderNo</span>(request.getOrderNo());
            failResult<span class="hljs-selector-class">.setMessageId</span>(messageId);
            failResult<span class="hljs-selector-class">.setSuccess</span>(false);
            stockMessageChannel<span class="hljs-selector-class">.stockResultOutput</span>()<span class="hljs-selector-class">.send</span>(MessageBuilder.withPayload(failResult)<span class="hljs-selector-class">.build</span>());
            channel<span class="hljs-selector-class">.basicNack</span>(deliveryTag, false, false);
        }
    }
}
</code></pre>
<h6 data-id="heading-28">ï¼ˆ3ï¼‰è®¢å•æœåŠ¡ï¼šæ¶ˆè´¹æ‰£å‡ç»“æœå¹¶æ›´æ–°çŠ¶æ€</h6>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Service</span>
public class StockResultHandler {
    <span class="hljs-keyword">@Autowired</span>
    private OrderMainRepository orderRepository;

    <span class="hljs-keyword">@StreamListener</span>(StockMessageChannel.STOCK_RESULT_INPUT)
    <span class="hljs-keyword">@Transactional</span>(rollbackFor = Exception.class)
    public void handleStockResult(StockDeductResultDTO result) {
        String orderNo = result<span class="hljs-selector-class">.getOrderNo</span>();
        OrderMain <span class="hljs-attribute">order</span> = orderRepository<span class="hljs-selector-class">.findByOrderNo</span>(orderNo)
                <span class="hljs-selector-class">.orElseThrow</span>(() -&gt; new <span class="hljs-built_in">RuntimeException</span>("è®¢å•ä¸å­˜åœ¨ï¼š" + orderNo));
        
        if (result.isSuccess()) {
            <span class="hljs-comment">// æ‰£å‡æˆåŠŸï¼šæ›´æ–°è®¢å•çŠ¶æ€ä¸º1ï¼ˆå¾…æ”¯ä»˜ï¼‰</span>
            <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderStatus</span>(<span class="hljs-number">1</span>);
            <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStockDeductStatus</span>(<span class="hljs-number">1</span>);
        } else {
            <span class="hljs-comment">// æ‰£å‡å¤±è´¥ï¼šåˆ é™¤é¢„åˆ›å»ºè®¢å•ï¼ˆå›æ»šï¼‰</span>
            orderRepository<span class="hljs-selector-class">.delete</span>(order);
        }
        orderRepository<span class="hljs-selector-class">.save</span>(order);
    }
}
</code></pre>
<h6 data-id="heading-29">ï¼ˆ4ï¼‰å®šæ—¶è¡¥å¿ä»»åŠ¡ï¼ˆç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ï¼‰</h6>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-keyword">@Component</span>
public class OrderCompensateTask {
    <span class="hljs-keyword">@Autowired</span>
    private OrderMainRepository orderRepository;
    <span class="hljs-keyword">@Autowired</span>
    private StockFeignClient stockFeignClient;  <span class="hljs-comment">// è°ƒç”¨åº“å­˜æœåŠ¡çš„Feignæ¥å£</span>

    <span class="hljs-comment">// æ¯5åˆ†é’Ÿæ‰§è¡Œï¼šå¤„ç†è¶…æ—¶â€œå¾…ç¡®è®¤â€è®¢å•</span>
    <span class="hljs-keyword">@Scheduled</span>(cron = <span class="hljs-string">"0 0/5 * * * ?"</span>)
    <span class="hljs-keyword">@Transactional</span>(rollbackFor = Exception.class)
    public void compensatePendingOrder() {
        LocalDateTime tenMinutesAgo = LocalDateTime<span class="hljs-selector-class">.now</span>()<span class="hljs-selector-class">.minus</span>(<span class="hljs-number">10</span>, ChronoUnit.MINUTES);
        <span class="hljs-comment">// æŸ¥è¯¢10åˆ†é’Ÿå‰ä»ä¸ºâ€œå¾…ç¡®è®¤â€çš„è®¢å•</span>
        List&lt;OrderMain&gt; pendingOrders = orderRepository<span class="hljs-selector-class">.findByOrderStatusAndCreateTimeBefore</span>(<span class="hljs-number">0</span>, tenMinutesAgo);
        
        for (OrderMain order : pendingOrders) {
            <span class="hljs-comment">// è°ƒç”¨åº“å­˜æœåŠ¡æŸ¥è¯¢æ‰£å‡çŠ¶æ€</span>
            boolean hasDeducted = stockFeignClient<span class="hljs-selector-class">.checkStockDeducted</span>(order.getOrderNo());
            if (hasDeducted) {
                <span class="hljs-comment">// åº“å­˜å·²æ‰£å‡ï¼šæ›´æ–°è®¢å•çŠ¶æ€</span>
                <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setOrderStatus</span>(<span class="hljs-number">1</span>);
                <span class="hljs-attribute">order</span><span class="hljs-selector-class">.setStockDeductStatus</span>(<span class="hljs-number">1</span>);
                orderRepository<span class="hljs-selector-class">.save</span>(order);
            } else {
                <span class="hljs-comment">// åº“å­˜æœªæ‰£å‡ï¼šåˆ é™¤è®¢å•</span>
                orderRepository<span class="hljs-selector-class">.delete</span>(order);
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-30">äº”ã€ä¼ä¸šçº§ä¸‹å•å…¨æµç¨‹ä¸è®¢å•çŠ¶æ€æµè½¬</h3>
<h4 data-id="heading-31">5.1 é¢„åˆ›å»ºè®¢å•ä¸æ™®é€šåˆ›å»ºçš„åŒºåˆ«</h4>



































<table><thead><tr><th>å¯¹æ¯”ç»´åº¦</th><th>é¢„åˆ›å»ºè®¢å•ï¼ˆä¸´æ—¶è®¢å•ï¼‰</th><th>æ™®é€šåˆ›å»ºè®¢å•ï¼ˆæœ€ç»ˆè®¢å•ï¼‰</th></tr></thead><tbody><tr><td>æ ¸å¿ƒç›®çš„</td><td>å è®¢å•å·ã€ä¸ºè·¨æœåŠ¡å›æ»šç•™å‡ºå£</td><td>ç¡®è®¤äº¤æ˜“ç”Ÿæ•ˆï¼Œæ”¯æŒåç»­å±¥çº¦ï¼ˆæ”¯ä»˜/å‘è´§ï¼‰</td></tr><tr><td>çŠ¶æ€å±æ€§</td><td>ä¸´æ—¶çŠ¶æ€ï¼ˆå¯åˆ é™¤/å›æ»šï¼‰</td><td>æ­£å¼çŠ¶æ€ï¼ˆä¸å¯éšæ„ä¿®æ”¹ï¼‰</td></tr><tr><td>èµ„æºå ç”¨</td><td>ä¸å ç”¨åº“å­˜ã€ä¼˜æƒ åˆ¸ç­‰æ ¸å¿ƒèµ„æº</td><td>å ç”¨åº“å­˜ã€é”å®šä¼˜æƒ åˆ¸</td></tr><tr><td>å›æ»šæˆæœ¬</td><td>æä½ï¼ˆç›´æ¥åˆ é™¤ä¸´æ—¶è®°å½•ï¼‰</td><td>æé«˜ï¼ˆéœ€å›æ»šåº“å­˜ã€è§£é”èµ„æºï¼‰</td></tr><tr><td>ä¸šåŠ¡æ„ä¹‰</td><td>å‘ŠçŸ¥ç”¨æˆ·â€œè®¢å•å¤„ç†ä¸­â€</td><td>å‘ŠçŸ¥ç”¨æˆ·â€œè®¢å•åˆ›å»ºæˆåŠŸâ€</td></tr></tbody></table>
<h4 data-id="heading-32">5.2 è®¢å•æ ¸å¿ƒçŠ¶æ€å®šä¹‰</h4>





















































<table><thead><tr><th>çŠ¶æ€å€¼</th><th>çŠ¶æ€åç§°</th><th>è§¦å‘æ¡ä»¶</th><th>ä¸šåŠ¡å«ä¹‰</th></tr></thead><tbody><tr><td>0</td><td>å¾…ç¡®è®¤ï¼ˆé¢„åˆ›å»ºï¼‰</td><td>ç”¨æˆ·æäº¤è®¢å•ï¼Œè®¢å•æœåŠ¡é¢„åˆ›å»ºè®°å½•</td><td>è®¢å•ä¸´æ—¶å ä½ï¼Œç­‰å¾…åº“å­˜æ‰£å‡ç­‰å‰ç½®æ¡ä»¶</td></tr><tr><td>1</td><td>å¾…æ”¯ä»˜</td><td>åº“å­˜æ‰£å‡æˆåŠŸï¼Œè®¢å•æœåŠ¡æ›´æ–°çŠ¶æ€</td><td>è®¢å•æ­£å¼åˆ›å»ºï¼Œç­‰å¾…ç”¨æˆ·æ”¯ä»˜</td></tr><tr><td>2</td><td>å·²æ”¯ä»˜/å¾…å‘è´§</td><td>ç”¨æˆ·å®Œæˆæ”¯ä»˜ï¼Œæ”¯ä»˜æœåŠ¡é€šçŸ¥è®¢å•æœåŠ¡</td><td>æ”¯ä»˜å®Œæˆï¼Œç­‰å¾…å•†å®¶å‘è´§</td></tr><tr><td>3</td><td>å·²å‘è´§</td><td>å•†å®¶æ“ä½œå‘è´§ï¼Œè®¢å•æœåŠ¡åŒæ­¥ç‰©æµä¿¡æ¯</td><td>å•†å“å·²å‘å‡ºï¼Œç­‰å¾…ç”¨æˆ·æ”¶è´§</td></tr><tr><td>4</td><td>å·²å®Œæˆ</td><td>ç”¨æˆ·ç¡®è®¤æ”¶è´§æˆ–ç³»ç»Ÿè¶…æ—¶è‡ªåŠ¨ç¡®è®¤</td><td>è®¢å•é—­ç¯ï¼Œäº¤æ˜“å®Œæˆ</td></tr><tr><td>5</td><td>å·²å–æ¶ˆ</td><td>ç”¨æˆ·å–æ¶ˆæœªæ”¯ä»˜è®¢å•ï¼Œæˆ–é€€æ¬¾å®Œæˆ</td><td>è®¢å•ç»ˆæ­¢ï¼Œèµ„æºï¼ˆåº“å­˜/ä¼˜æƒ åˆ¸ï¼‰å›æ»š</td></tr><tr><td>6</td><td>åˆ›å»ºå¤±è´¥</td><td>åº“å­˜æ‰£å‡å¤±è´¥ã€å‚æ•°æ ¡éªŒå¤±è´¥ç­‰</td><td>è®¢å•æœªåˆ›å»ºæˆåŠŸï¼Œæ— èµ„æºå ç”¨</td></tr></tbody></table>
<h4 data-id="heading-33">5.3 å®Œæ•´çŠ¶æ€æµè½¬é“¾è·¯</h4>
<h5 data-id="heading-34">5.3.1 æ­£å¸¸ä¸‹å•é“¾è·¯</h5>
<p>ç”¨æˆ·æäº¤è®¢å• â†’ é¢„åˆ›å»ºè®¢å•ï¼ˆ0ï¼šå¾…ç¡®è®¤ï¼‰ â†’ åº“å­˜æ‰£å‡æˆåŠŸ â†’ è®¢å•çŠ¶æ€1ï¼ˆå¾…æ”¯ä»˜ï¼‰ â†’ ç”¨æˆ·æ”¯ä»˜æˆåŠŸ â†’ è®¢å•çŠ¶æ€2ï¼ˆå·²æ”¯ä»˜/å¾…å‘è´§ï¼‰ â†’ å•†å®¶å‘è´§ â†’ è®¢å•çŠ¶æ€3ï¼ˆå·²å‘è´§ï¼‰ â†’ ç”¨æˆ·ç¡®è®¤æ”¶è´§ â†’ è®¢å•çŠ¶æ€4ï¼ˆå·²å®Œæˆï¼‰ã€‚</p>
<h5 data-id="heading-35">5.3.2 å¼‚å¸¸åœºæ™¯é“¾è·¯</h5>
<ol start="16">
<li><strong>åº“å­˜ä¸è¶³</strong>ï¼šç”¨æˆ·æäº¤è®¢å• â†’ é¢„åˆ›å»ºè®¢å•ï¼ˆ0ï¼‰ â†’ åº“å­˜æ‰£å‡å¤±è´¥ â†’ åˆ é™¤è®¢å• â†’ çŠ¶æ€6ï¼ˆåˆ›å»ºå¤±è´¥ï¼‰ï¼›</li>
<li><strong>æ”¯ä»˜è¶…æ—¶</strong>ï¼šè®¢å•çŠ¶æ€1ï¼ˆå¾…æ”¯ä»˜ï¼‰ â†’ è¶…æ—¶æœªæ”¯ä»˜ â†’ è®¢å•çŠ¶æ€5ï¼ˆå·²å–æ¶ˆï¼‰ â†’ åº“å­˜å›æ»šï¼›</li>
<li><strong>æ”¯ä»˜åé€€æ¬¾</strong>ï¼šè®¢å•çŠ¶æ€2ï¼ˆå·²æ”¯ä»˜ï¼‰ â†’ ç”¨æˆ·ç”³è¯·é€€æ¬¾ â†’ å•†å®¶åŒæ„ â†’ æ”¯ä»˜æœåŠ¡é€€æ¬¾ â†’ è®¢å•çŠ¶æ€5ï¼ˆå·²å–æ¶ˆï¼‰ â†’ åº“å­˜å›æ»šã€‚</li>
</ol>
<h3 data-id="heading-36">å…­ã€æ€»ç»“</h3>
<ol start="19">
<li><strong>è®¢å•é¡ºåºæ§åˆ¶</strong>ï¼šåŸºäºRabbitMQé˜Ÿåˆ—åˆ†åŒº+å•çº¿ç¨‹æ¶ˆè´¹ï¼Œç¡®ä¿åŒè®¢å•ä¸²è¡Œã€å¤šè®¢å•å¹¶è¡Œï¼Œè§£å†³é¡ºåºé”™ä¹±é—®é¢˜ï¼›</li>
<li><strong>åº“å­˜å¹¶å‘æ§åˆ¶</strong>ï¼šé€šè¿‡Redisé¢„æ‰£å‡+Redissonåˆ†å¸ƒå¼é”+æ•°æ®åº“ä¹è§‚é”ï¼Œé˜²æ­¢è¶…å–å¹¶ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼›</li>
<li><strong>è·¨æœåŠ¡äº‹åŠ¡</strong>ï¼šé‡‡ç”¨â€œå¯é æ¶ˆæ¯+æœ€ç»ˆä¸€è‡´æ€§â€æ–¹æ¡ˆï¼Œç»“åˆé¢„åˆ›å»ºè®¢å•å’Œå®šæ—¶è¡¥å¿ï¼Œè§£å†³è·¨æœåŠ¡åŸå­æ€§é—®é¢˜ï¼›</li>
<li><strong>ä¼ä¸šçº§æµç¨‹</strong>ï¼šä»¥â€œé¢„åˆ›å»ºâ†’å‰ç½®æ ¡éªŒâ†’ç¡®è®¤è®¢å•â†’å±¥çº¦â€ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡çŠ¶æ€æµè½¬å®ç°è®¢å•å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œå…¼é¡¾é«˜å¹¶å‘ä¸æ•°æ®ä¸€è‡´æ€§ã€‚</li>
</ol>
<p>æœ¬æ–¹æ¡ˆå¯ç›´æ¥è½åœ°åˆ°Spring Cloudå¾®æœåŠ¡æ¶æ„çš„è®¢å•ç³»ç»Ÿï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯ä¸‹çš„ç¨³å®šè¿è¡Œï¼ŒåŒæ—¶å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ï¼ˆå¦‚æ–°å¢ä¼˜æƒ åˆ¸ã€ç‰©æµç­‰æ¨¡å—å¯å¤ç”¨æ¶ˆæ¯æœºåˆ¶ä¸äº‹åŠ¡æ–¹æ¡ˆï¼‰ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•åœ¨ Go 1.24+ ä¸­ç®¡ç† tool ä¾èµ–]]></title>    <link>https://juejin.cn/post/7579321624013766696</link>    <guid>https://juejin.cn/post/7579321624013766696</guid>    <pubDate>2025-12-03T07:52:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579321624013766696" data-draft-id="7579264485258493967" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•åœ¨ Go 1.24+ ä¸­ç®¡ç† tool ä¾èµ–"/> <meta itemprop="keywords" content="Go"/> <meta itemprop="datePublished" content="2025-12-03T07:52:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="avilang"/> <meta itemprop="url" content="https://juejin.cn/user/4388906147012270"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•åœ¨ Go 1.24+ ä¸­ç®¡ç† tool ä¾èµ–
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4388906147012270/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    avilang
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:52:14.000Z" title="Wed Dec 03 2025 07:52:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Go 1.24 ä¸­æˆ‘æœ€å–œæ¬¢çš„åŠŸèƒ½ä¹‹ä¸€æ˜¯ç®¡ç†å¼€å‘è€…å·¥å…·ä¾èµ–é¡¹çš„æ–°åŠŸèƒ½ã€‚</p>
<p>è¿™é‡ŒæŒ‡çš„æ˜¯ï¼Œç”¨äºè¾…åŠ©å¼€å‘ã€æµ‹è¯•ã€æ„å»ºæˆ–éƒ¨ç½²çš„å·¥å…·ï¼Œä¾‹å¦‚ç”¨äºé™æ€ä»£ç åˆ†æçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fstaticcheck.dev%2F" target="_blank" title="https://staticcheck.dev/" ref="nofollow noopener noreferrer">staticcheck</a> ã€ç”¨äºæ¼æ´æ‰«æçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fpkg.go.dev%2Fgolang.org%2Fx%2Fvuln%2Fcmd%2Fgovulncheck" target="_blank" title="https://pkg.go.dev/golang.org/x/vuln/cmd/govulncheck" ref="nofollow noopener noreferrer">govulncheck</a> æˆ–ç”¨äºå®æ—¶é‡æ–°åŠ è½½åº”ç”¨ç¨‹åºçš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fair-verse%2Fair" target="_blank" title="https://github.com/air-verse/air" ref="nofollow noopener noreferrer">air</a> ã€‚</p>
<p>ä¸€ç›´ä»¥æ¥ï¼Œç®¡ç†è¿™äº›ä¾èµ–é¡¹â€”â€”å°¤å…¶æ˜¯åœ¨å›¢é˜Ÿç¯å¢ƒä¸­â€”â€”éƒ½æ˜¯ä»¶æ£˜æ‰‹çš„äº‹æƒ…ã€‚ä¹‹å‰çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fmarcofranssen.nl%2Fmanage-go-tools-via-go-modules" target="_blank" title="https://marcofranssen.nl/manage-go-tools-via-go-modules" ref="nofollow noopener noreferrer">tools.go</a> æ–‡ä»¶æˆ– <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.alexedwards.net%2Fblog%2Fusing-go-run-to-manage-tool-dependencies" target="_blank" title="https://www.alexedwards.net/blog/using-go-run-to-manage-tool-dependencies" ref="nofollow noopener noreferrer">go run</a> æ¨¡å¼ï¼Œä½†å°½ç®¡è¿™äº›æ–¹æ³•æœ‰æ•ˆï¼Œå´æ€»æ„Ÿè§‰åƒæ˜¯æƒå®œä¹‹è®¡ï¼Œå­˜åœ¨ä¸€äº›ç¼ºç‚¹ã€‚</p>
<p>Go 1.24 ç»ˆäºå¸¦æ¥äº†æ›´å¥½çš„æ–¹æ³•ã€‚</p>
<h2 data-id="heading-0">ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2>
<p>ä¸ºäº†æ¼”ç¤ºæ–°åŠŸèƒ½ï¼Œæˆ‘ä»¬æ­å»ºä¸€ä¸ªç®€å•çš„æ¨¡å—å¹¶æ·»åŠ ä¸€äº›åº”ç”¨ç¨‹åºä»£ç ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ go mod init example.com
go: creating new go.mod: module example.com
$ <span class="hljs-built_in">touch</span> main.go
</code></pre>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// main.go</span>
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>

    <span class="hljs-string">"github.com/kr/text"</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    wrapped := text.Wrap(<span class="hljs-string">"This is an informational message that should be wrapped."</span>, <span class="hljs-number">30</span>)
    fmt.Println(wrapped)
}
</code></pre>
<p>ç°åœ¨ä¸‹è½½ <code>github.com/kr/text</code> åŒ…å¹¶è¿è¡Œä»£ç ã€‚è¾“å‡ºç»“æœåº”è¯¥å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ go get github.com/kr/text
go: downloading github.com/kr/text v0.2.0
go: added github.com/kr/text v0.2.0
$ go run .
This is an informational
message that should be
wrapped.
</code></pre>
<h2 data-id="heading-1">å‘ module æ·»åŠ  tools</h2>
<p>Go 1.24 ä¸º go get å‘½ä»¤å¼•å…¥äº† -tool æ ‡å¿—ï¼Œä½ å¯ä»¥åƒè¿™æ ·ä½¿ç”¨å®ƒï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go get -tool import_path@version
</code></pre>
<p>æ­¤å‘½ä»¤å°†ä¸‹è½½å¯¼å…¥è·¯å¾„æŒ‡å®šçš„åŒ…ï¼ˆåŠå…¶æ‰€æœ‰å­ä¾èµ–é¡¹ï¼‰ï¼Œå°†å…¶å­˜å‚¨åœ¨æ¨¡å—ç¼“å­˜ä¸­ï¼Œå¹¶è®°å½•åˆ° <code>go.mod</code> æ–‡ä»¶ä¸­ã€‚ <code>@version</code> éƒ¨åˆ†æ˜¯å¯é€‰çš„â€”â€”å¦‚æœçœç•¥ï¼Œåˆ™ä¼šä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>è®©æˆ‘ä»¬ä½¿ç”¨æ­¤åŠŸèƒ½å°†æœ€æ–°ç‰ˆæœ¬çš„ <code>stringer</code> å’Œ <code>govulncheck</code> æ·»åŠ åˆ°æˆ‘ä»¬çš„æ¨¡å—ä¸­ä½œä¸ºå¼€å‘è€…å·¥å…·ï¼Œä»¥åŠ <code>staticcheck</code> ç‰ˆæœ¬ <code>0.5.1</code> ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ go get -tool golang.org/x/tools/cmd/stringer
go: downloading golang.org/x/tools v0.30.0
go: downloading golang.org/x/sync v0.11.0
go: downloading golang.org/x/mod v0.23.0
go: added golang.org/x/mod v0.23.0
go: added golang.org/x/sync v0.11.0
go: added golang.org/x/tools v0.30.0

$ go get -tool golang.org/x/vuln/cmd/govulncheck
go: downloading golang.org/x/vuln v1.1.4
go: downloading golang.org/x/telemetry v0.0.0-20240522233618-39ace7a40ae7
go: downloading golang.org/x/sys v0.30.0
go: upgraded golang.org/x/telemetry v0.0.0-20240521205824-bda55230c457 =&gt; v0.0.0-20240522233618-39ace7a40ae7
go: added golang.org/x/vuln v1.1.4

$ go get -tool honnef.co/go/tools/cmd/staticcheck@v0.5.1
go: downloading honnef.co/go/tools v0.5.1
go: downloading golang.org/x/exp/typeparams v0.0.0-20231108232855-2478ac86f678
go: downloading github.com/BurntSushi/toml v1.4.1-0.20240526193622-a339e1f7089c
go: downloading golang.org/x/exp v0.0.0-20231110203233-9a3e6036ecaa
go: added github.com/BurntSushi/toml v1.4.1-0.20240526193622-a339e1f7089c
go: added golang.org/x/exp/typeparams v0.0.0-20231108232855-2478ac86f678
go: added honnef.co/go/tools v0.5.1
</code></pre>
<p>è¿è¡Œè¿™äº›å‘½ä»¤åï¼Œæ‚¨çš„ <code>go.mod</code> æ–‡ä»¶ç°åœ¨å°†åŒ…å«ä¸€ä¸ª <code>tool (...)</code> éƒ¨åˆ†ï¼Œåˆ—å‡ºæ‚¨æ·»åŠ çš„å·¥å…·ã€‚æ‰€æœ‰ä¾èµ–é¡¹çš„ç›¸åº”æ¨¡å—è·¯å¾„å’Œç‰ˆæœ¬å°†å‡ºç°åœ¨ <code>require (...)</code> éƒ¨åˆ†ï¼Œå¹¶æ ‡è®°ä¸ºé—´æ¥ä¾èµ–ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">module example.com

go 1.24.0

require (
    github.com/BurntSushi/toml v1.4.1-0.20240526193622-a339e1f7089c // indirect
    github.com/kr/text v0.2.0 // indirect
    golang.org/x/exp/typeparams v0.0.0-20231108232855-2478ac86f678 // indirect
    golang.org/x/mod v0.23.0 // indirect
    golang.org/x/sync v0.11.0 // indirect
    golang.org/x/sys v0.30.0 // indirect
    golang.org/x/telemetry v0.0.0-20240522233618-39ace7a40ae7 // indirect
    golang.org/x/tools v0.30.0 // indirect
    golang.org/x/vuln v1.1.4 // indirect
    honnef.co/go/tools v0.5.1 // indirect
)

tool (
    golang.org/x/tools/cmd/stringer
    golang.org/x/vuln/cmd/govulncheck
    honnef.co/go/tools/cmd/staticcheck
)
</code></pre>
<h2 data-id="heading-2">ä½¿ç”¨ tools</h2>
<p>æ·»åŠ å®Œæˆåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>go tool</code> å‘½ä»¤è¿è¡Œå·¥å…·ã€‚</p>
<h3 data-id="heading-3">åœ¨å‘½ä»¤è¡Œ</h3>
<p>è¦åœ¨ module ä¸­é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œç‰¹å®šå·¥å…·ï¼Œå¯ä»¥ä½¿ç”¨ <code>go tool</code> åè·Ÿè¯¥å·¥å…·å¯¼å…¥è·¯å¾„ä¸­æœ€åä¸€ä¸ªéä¸»ç‰ˆæœ¬å·éƒ¨åˆ†ï¼ˆé€šå¸¸å°±æ˜¯å·¥å…·åç§°ï¼‰ã€‚ä¾‹å¦‚:</p>
<pre><code class="hljs language-bash" lang="bash">$ go tool staticcheck -version
staticcheck 2024.1.1 (0.5.1)

$ go tool govulncheck
No vulnerabilities found.
</code></pre>
<h3 data-id="heading-4">åœ¨ Makefile ä¸­</h3>
<p>å¦‚æœæ‚¨æƒ³ä»è„šæœ¬æˆ– Makefile ä¸­æ‰§è¡Œå·¥å…·ï¼Œ <code>go tool</code> å‘½ä»¤ä¹Ÿéå¸¸å¥½ç”¨ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª Makefileï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ª <code>audit</code> ä»»åŠ¡ï¼Œè¯¥ä»»åŠ¡ä¼šå¯¹ä»£ç åº“è¿è¡Œ staticcheck å’Œ govulncheckã€‚</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-comment"># Makefile</span>

<span class="hljs-meta"><span class="hljs-keyword">.PHONY</span>: audit</span>
<span class="hljs-section">audit:</span>
    go vet ./...
    go tool staticcheck ./...
    go tool govulncheck
</code></pre>
<p>å¦‚æœè¿è¡Œ make audit ï¼Œåº”è¯¥å¯ä»¥çœ‹åˆ°æ‰€æœ‰æ£€æŸ¥éƒ½æˆåŠŸå®Œæˆã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ make audit
go vet ./...
go tool staticcheck ./...
go tool govulncheck
No vulnerabilities found.
</code></pre>
<h3 data-id="heading-5">å’Œ go:generate ç»“åˆä½¿ç”¨</h3>
<p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå…¶ä¸­æˆ‘ä»¬å°† stringer å·¥å…·ä¸ <code>go:generate</code> ç»“åˆä½¿ç”¨ï¼Œä¸ºä¸€äº› <code>iota</code> å¸¸é‡ç”Ÿæˆ <code>String()</code> æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// main.go</span>
<span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
    <span class="hljs-string">"fmt"</span>

    <span class="hljs-string">"github.com/kr/text"</span>
)

<span class="hljs-comment">//go:generate go tool stringer -type=Level</span>

<span class="hljs-keyword">type</span> Level <span class="hljs-type">int</span>

<span class="hljs-keyword">const</span> (
    Info Level = <span class="hljs-literal">iota</span>
    Error
    Fatal
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
    wrapped := text.Wrap(<span class="hljs-string">"This is an informational message that should be wrapped."</span>, <span class="hljs-number">30</span>)

    fmt.Printf(<span class="hljs-string">"%s: %s\n"</span>, Info, wrapped)
}
</code></pre>
<p>è¿™é‡Œæœ€é‡è¦çš„æ˜¯ <code>//go:generate</code> ä»£ç ã€‚å½“ä½ å¯¹è¿™ä¸ªæ–‡ä»¶è¿è¡Œ <code>go generate</code> å‘½ä»¤æ—¶ï¼Œå®ƒä¼šä½¿ç”¨ <code>go tool</code> æ¥æ‰§è¡Œ <code>go.mod</code> æ–‡ä»¶ä¸­æŒ‡å®šçš„ stringer å·¥å…·ç‰ˆæœ¬ã€‚</p>
<p>æˆ‘ä»¬æ¥è¯•ä¸€è¯•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ go generate .
$ <span class="hljs-built_in">ls</span> 
go.mod  go.sum  level_string.go  main.go  Makefile
</code></pre>
<p>ä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€ä¸ªæ–°çš„ <code>level_string.go</code> æ–‡ä»¶è¢«åˆ›å»ºï¼Œè¿è¡Œåº”ç”¨ç¨‹åºååº”è¯¥ä¼šäº§ç”Ÿç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ go run .
Info: This is an informational
message that should be
wrapped.
</code></pre>
<h2 data-id="heading-6">æŸ¥çœ‹ tools</h2>
<p>æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œ <code>go list tool</code> æ¥æŸ¥çœ‹æ¨¡å—ä¸­å·²æ·»åŠ å“ªäº›å·¥å…·ï¼Œå¦‚ä¸‹æ‰€ç¤º</p>
<pre><code class="hljs language-bash" lang="bash">$ go list tool
honnef.co/go/tools/cmd/staticcheck
golang.org/x/tools/cmd/stringer
golang.org/x/vuln/cmd/govulncheck
</code></pre>
<h2 data-id="heading-7">æ£€éªŒ tools</h2>
<p>ç”±äºè¿™äº›å·¥å…·ä½œä¸ºä¾èµ–é¡¹åŒ…å«åœ¨æ‚¨çš„ <code>go.mod</code> æ–‡ä»¶ä¸­ï¼Œå› æ­¤å¦‚æœæ‚¨æƒ³æ£€æŸ¥å­˜å‚¨åœ¨æ¨¡å—ç¼“å­˜ä¸­çš„å·¥å…·ä»£ç æ˜¯å¦å·²æ›´æ”¹ï¼Œåªéœ€è¿è¡Œ <code>go mod verify</code> å³å¯ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ go mod verify
all modules verified
</code></pre>
<p>è¿™å°†æ£€æŸ¥æ¨¡å—ç¼“å­˜ä¸­çš„ä»£ç æ˜¯å¦ä¸ go.sum æ–‡ä»¶ä¸­çš„ç›¸åº”æ ¡éªŒå’Œå®Œå…¨åŒ¹é…ã€‚</p>
<h2 data-id="heading-8">Vendoring tools</h2>
<p>å¦‚æœä½ è¿è¡Œ <code>go mod vendor</code> ï¼Œå·¥å…·ä¾èµ–é¡¹çš„ä»£ç å°†åŒ…å«åœ¨ vendor æ–‡ä»¶å¤¹ä¸­ï¼Œå¹¶ä¸” <code>vendor/modules.txt</code> æ¸…å•å°†ä¸éå·¥å…·ä¾èµ–é¡¹ä¸€èµ·åŒ…å«åœ¨å†…ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ go mod vendor
$  tree  -L 3
.
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ main.go
â”œâ”€â”€ Makefile
â””â”€â”€ vendor
        â”œâ”€â”€ github.com
        â”‚   â”œâ”€â”€ BurntSushi
        â”‚   â””â”€â”€ kr
        â”œâ”€â”€ golang.org
        â”‚   â””â”€â”€ x
        â”œâ”€â”€ honnef.co
        â”‚   â””â”€â”€ go
        â””â”€â”€ modules.txt
</code></pre>
<p>ä»¥è¿™ç§æ–¹å¼å°†å·¥å…·æ‰“åŒ…åˆ° vendor ç›®å½•ä¸­åï¼Œè¿è¡Œ <code>go tool</code> å°†æ‰§è¡Œ <code>vendor</code> ç›®å½•ä¸­çš„ç›¸åº”ä»£ç ã€‚è¯·æ³¨æ„ï¼Œ <code>go mod verify</code> å¯¹ vendor ç›®å½•ä¸­çš„ä»£ç æ— æ•ˆã€‚</p>
<h2 data-id="heading-9">å‡çº§å’Œé™çº§ tools</h2>
<p>è¦å°†ç‰¹å®šå·¥å…·å‡çº§æˆ–é™çº§åˆ°ç‰¹å®šç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ä¸æœ€åˆæ·»åŠ è¯¥å·¥å…·æ—¶ç›¸åŒçš„ <code>go get -tool import_path@version</code> å‘½ä»¤ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">go get -tool honnef.co/go/tools/cmd/staticcheck
</code></pre>
<p>è¦å‡çº§åˆ°ç‰¹å®šå·¥å…·çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·çœç•¥ @version åç¼€ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ go get -tool honnef.co/go/tools/cmd/staticcheck@v0.5.0
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥è¿è¡Œ <code>go get tool</code> å°†æ‰€æœ‰å·¥å…·å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚æ³¨æ„ï¼šè¿™é‡Œçš„ tool æ˜¯ä¸€ä¸ªå­å‘½ä»¤ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªæ ‡å¿—ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ go get tool
</code></pre>
<p>å¦‚æœæ‚¨çš„å·¥å…·ä¾èµ–é¡¹å·²é€šè¿‡ vendor æ–¹å¼æä¾›ï¼Œåˆ™åœ¨ä»»ä½•å‡çº§æˆ–é™çº§åï¼Œæ‚¨éƒ½éœ€è¦é‡æ–°è¿è¡Œ <code>go mod vendor</code> ã€‚</p>
<p>æˆªè‡³æ’°å†™æœ¬æ–‡æ—¶ï¼Œæˆ‘è¿˜æ²¡æœ‰æ‰¾åˆ°ä»»ä½•ç®€å•çš„æ–¹æ³•æ¥ä¸“é—¨åˆ—å‡ºå“ªäº›å·¥å…·æœ‰å‡çº§ç‰ˆæœ¬â€”â€”å¦‚æœæ‚¨çŸ¥é“è¿™æ ·çš„æ–¹æ³•ï¼Œè¯·å‘Šè¯‰æˆ‘ï¼</p>
<h2 data-id="heading-10">ç§»é™¤ tools</h2>
<p>è¦ä»æ¨¡å—ä¸­å®Œå…¨ç§»é™¤è¯¥å·¥å…·ï¼Œè¯·ä½¿ç”¨å¸¦æœ‰ç‰¹æ®Šç‰ˆæœ¬æ ‡ç­¾ <code>@none go get -tool</code> ã€‚</p>
<pre><code class="hljs language-bash" lang="bash">$ go get -tool honnef.co/go/tools/cmd/staticcheck@none
</code></pre>
<p>å†æ¬¡æé†’ï¼Œå¦‚æœæ‚¨ä½¿ç”¨äº† vendor æ–¹å¼ï¼Œè¯·ç¡®ä¿åœ¨ç§»é™¤å·¥å…·åè¿è¡Œ <code>go mod vendor</code> ã€‚</p>
<h2 data-id="heading-11">ä½¿ç”¨å•ç‹¬çš„ mod æ–‡ä»¶æ¥ç®¡ç† tools</h2>
<p>ä¸€ä½ <a href="https://link.juejin.cn?target=https%3A%2F%2Fold.reddit.com%2Fr%2Fgolang%2Fcomments%2F1iu8nkj%2Fhow_to_manage_tool_dependencies_in_go_124%2Fmdzscsa%2F" target="_blank" title="https://old.reddit.com/r/golang/comments/1iu8nkj/how_to_manage_tool_dependencies_in_go_124/mdzscsa/" ref="nofollow noopener noreferrer">Reddit ç”¨æˆ·è¯„è®º</a>é“ï¼Œå¦‚æœä½ çš„å·¥å…·ä¸åº”ç”¨ç¨‹åºä»£ç å…±äº«ä¾èµ–é¡¹ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ä½ çš„åº”ç”¨ç¨‹åºä»£ç ä¾èµ–äº <code>golang.org/x/sync v0.11.0</code> ç‰ˆæœ¬ï¼Œå¹¶ä¸”ç»è¿‡æµ‹è¯•ï¼Œå·²çŸ¥è¯¥ç‰ˆæœ¬å¯ä»¥æ­£å¸¸å·¥ä½œã€‚é‚£ä¹ˆï¼Œå¦‚æœä½ æ·»åŠ äº†ä¸€ä¸ªä¾èµ–äºæ›´æ–°ç‰ˆæœ¬çš„ <code>golang.org/x/sync</code> çš„å·¥å…·ï¼Œä½ çš„ <code>go.mod</code> æ–‡ä»¶ä¸­çš„ç‰ˆæœ¬å·ä¹Ÿä¼šæ›´æ–°ï¼Œä½ çš„åº”ç”¨ç¨‹åºä»£ç ä¹Ÿä¼šä½¿ç”¨æ›´æ–°çš„ç‰ˆæœ¬ã€‚</p>
<p>ç†è®ºä¸Šï¼Œåªè¦æ‰€æœ‰ä¾èµ–é¡¹åŠå…¶å­ä¾èµ–é¡¹éƒ½ç¨³å®šï¼Œéµå¾ªä¸¥æ ¼çš„è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ï¼Œå¹¶ä¸”ä¸ä¼šåœ¨æ²¡æœ‰ä¸»ç‰ˆæœ¬å·é€’å¢çš„æƒ…å†µä¸‹è¿›è¡Œä¸å…¼å®¹çš„æ›´æ”¹ï¼Œè¿™å°±ä¸ä¼šæœ‰é—®é¢˜ã€‚ä½†æ˜¯ï¼Œç°å®ä¸–ç•Œæ€»æ˜¯å……æ»¡å˜æ•°ï¼Œä¸å…¼å®¹çš„æ›´æ”¹å¯èƒ½ä¼šå‘ç”Ÿï¼Œä»è€Œæ„å¤–åœ°ç ´ååº”ç”¨ç¨‹åºä»£ç ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªé—®é¢˜ä¸ä»…é™äºå·¥å…·ä¾èµ–é¡¹â€”â€”å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä»£ç å’Œéå·¥å…·ä¾èµ–é¡¹éƒ½ä¾èµ–äºåŒä¸€ä¸ªåŒ…ï¼Œä¹Ÿä¼šå‘ç”ŸåŒæ ·çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œå°†å·¥å…·åŒ…å«åœ¨ <code>go.mod</code> ä¸­ä¼šå¢åŠ é£é™©ã€‚</p>
<p>ä¸ºäº†é™ä½è¿™ç§é£é™©ï¼Œä½ å¯ä»¥ä½¿ç”¨å•ç‹¬çš„ modfile æ–‡ä»¶æ¥å­˜æ”¾å·¥å…·ä¾èµ–é¡¹ï¼Œè€Œä¸æ˜¯å°†å®ƒä»¬åŒ…å«åœ¨ä¸» <code>go.mod</code> ä¸­ã€‚ä½ å¯ä»¥ä½¿ç”¨ <code>-modfile</code> æ ‡å¿—æ¥æŒ‡å®šä¸€ä¸ªå¤‡ç”¨æ–‡ä»¶ï¼Œä¾‹å¦‚ <code>go.tool.mod</code> ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># Initialize a go.tool.mod modfile</span>
$ go mod init -modfile=go.tool.mod example.com

<span class="hljs-comment"># Add a tool to the module</span>
$ go get -tool -modfile=go.tool.mod golang.org/x/vuln/cmd/govulncheck

<span class="hljs-comment"># Run the tool from the command line</span>
$ go tool -modfile=go.tool.mod govulncheck

<span class="hljs-comment"># List all tools added to the module</span>
$ go list -modfile=go.tool.mod tool

<span class="hljs-comment"># Verify the integrity of the tool dependencies</span>
$ go mod verify -modfile=go.tool.mod

<span class="hljs-comment"># Upgrade or downgrade a tool to a specific version</span>
$ go get -tool -modfile=go.tool.mod golang.org/x/vuln/cmd/govulncheck@v1.1.2

<span class="hljs-comment"># Upgrade all tools to their latest version</span>
$ go get -modfile=go.tool.mod tool

<span class="hljs-comment"># Remove a tool from the module</span>
$ go get -tool -modfile=go.tool.mod golang.org/x/vuln/cmd/govulncheck@none
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[openEuler åœ¨äº‘æœåŠ¡å™¨ç¯å¢ƒä¸‹çš„ç³»ç»Ÿæ€§èƒ½è¯„æµ‹ä¸ä¼˜åŒ–å®è·µ]]></title>    <link>https://juejin.cn/post/7579255046979305498</link>    <guid>https://juejin.cn/post/7579255046979305498</guid>    <pubDate>2025-12-03T07:57:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579255046979305498" data-draft-id="7579440586693361710" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="openEuler åœ¨äº‘æœåŠ¡å™¨ç¯å¢ƒä¸‹çš„ç³»ç»Ÿæ€§èƒ½è¯„æµ‹ä¸ä¼˜åŒ–å®è·µ"/> <meta itemprop="keywords" content="æ“ä½œç³»ç»Ÿ"/> <meta itemprop="datePublished" content="2025-12-03T07:57:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å€”å¼ºçš„çŸ³å¤´_"/> <meta itemprop="url" content="https://juejin.cn/user/3168119757484368"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            openEuler åœ¨äº‘æœåŠ¡å™¨ç¯å¢ƒä¸‹çš„ç³»ç»Ÿæ€§èƒ½è¯„æµ‹ä¸ä¼˜åŒ–å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3168119757484368/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å€”å¼ºçš„çŸ³å¤´_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:57:31.000Z" title="Wed Dec 03 2025 07:57:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d7a11fb257c542cca61451277cb241d7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=X%2F4%2F2jmHEPQL%2F5dT9Gg3R%2BWIbwA%3D" alt="8200eb209f8729cd1d7465cd4d0d865d.png" loading="lazy"/></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>åœ¨æ•°å­—åŒ–æµªæ½®ä¸­ï¼Œæ“ä½œç³»ç»Ÿä½œä¸ºè¿æ¥ç¡¬ä»¶ä¸åº”ç”¨çš„æ¡¥æ¢ï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚ä¸€ä¸ªé«˜æ€§èƒ½ã€ç¨³å®šå¯é çš„æ“ä½œç³»ç»Ÿï¼Œä¸ä»…èƒ½å¤Ÿæœ€å¤§åŒ–ç¡¬ä»¶èµ„æºçš„åˆ©ç”¨æ•ˆç‡ï¼Œæ›´èƒ½ä¸ºä¸Šå±‚åº”ç”¨æä¾›åšå®çš„è¿è¡ŒåŸºç¡€ã€‚</p>
<p>openEulerï¼ˆå¼€æ”¾æ¬§æ‹‰ï¼‰æ˜¯åä¸ºå…¬å¸æèµ ç»™å¼€æ”¾åŸå­å¼€æºåŸºé‡‘ä¼šçš„å¼€æºæ“ä½œç³»ç»Ÿé¡¹ç›®ï¼Œå®ƒæ‰¿è½½ç€æ‰“é€ "æ•°å­—åŸºç¡€è®¾æ–½æ“ä½œç³»ç»Ÿ"çš„ä½¿å‘½ã€‚ä½œä¸ºä¸€æ¬¾é¢å‘ä¼ä¸šçº§åº”ç”¨çš„Linuxå‘è¡Œç‰ˆï¼ŒopenEuleråœ¨è®¾è®¡ä¹‹åˆå°±å……åˆ†è€ƒè™‘äº†äº‘è®¡ç®—ã€è¾¹ç¼˜è®¡ç®—ã€ç‰©è”ç½‘ç­‰å¤šç§åº”ç”¨åœºæ™¯çš„éœ€æ±‚ã€‚
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aec20638229a4c30b651fa77c055166d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=%2FTcxOVr8n3jrUXgvG70uQtKRdq4%3D" alt="image.png" loading="lazy"/></p>
<p>openEuler 20.03ä½œä¸ºè¯¥ç³»åˆ—çš„é‡è¦ç‰ˆæœ¬ï¼Œåœ¨å†…æ ¸ä¼˜åŒ–ã€å®‰å…¨åŠ å›ºã€å®¹å™¨æ”¯æŒç­‰æ–¹é¢éƒ½æœ‰æ˜¾è‘—æå‡ã€‚å®ƒä¸ä»…ç»§æ‰¿äº†Linuxç³»ç»Ÿçš„å¼€æ”¾æ€§å’Œçµæ´»æ€§ï¼Œæ›´åœ¨æ€§èƒ½è°ƒä¼˜ã€ç¡¬ä»¶é€‚é…ã€ç”Ÿæ€å…¼å®¹ç­‰æ–¹é¢è¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ã€‚ç‰¹åˆ«æ˜¯åœ¨äº‘åŸç”Ÿç¯å¢ƒä¸‹ï¼ŒopenEulerå±•ç°å‡ºäº†å‡ºè‰²çš„èµ„æºç®¡ç†èƒ½åŠ›å’Œè¿è¡Œæ•ˆç‡ã€‚</p>
<p>æœ¬æ–‡å°†é€šè¿‡å®é™…çš„æ€§èƒ½æµ‹è¯•ï¼Œå¸¦æ‚¨æ·±å…¥äº†è§£openEuler 20.03åœ¨åä¸ºäº‘ç¯å¢ƒä¸‹çš„çœŸå®è¡¨ç°ã€‚æˆ‘ä»¬å°†ä»ç³»ç»Ÿå¯åŠ¨ã€CPUè®¡ç®—ã€å†…å­˜ç®¡ç†ã€ç£ç›˜I/Oç­‰å¤šä¸ªç»´åº¦è¿›è¡Œå…¨é¢è¯„æµ‹ï¼Œç”¨æ•°æ®è¯´è¯ï¼Œç”¨äº‹å®è¯æ˜è¿™æ¬¾è‡ªä¸»åˆ›æ–°æ“ä½œç³»ç»Ÿçš„æŠ€æœ¯å®åŠ›ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜å°†åˆ†äº«ä¸€äº›å®ç”¨çš„ç³»ç»Ÿä¼˜åŒ–æŠ€å·§ï¼Œå¸®åŠ©æ‚¨åœ¨å®é™…ä½¿ç”¨ä¸­è·å¾—æ›´å¥½çš„æ€§èƒ½ä½“éªŒã€‚</p>
<h2 data-id="heading-1">æµ‹è¯•ç¯å¢ƒä»‹ç»</h2>
<h3 data-id="heading-2">ç¡¬ä»¶é…ç½®</h3>
<ul>
<li><strong>äº‘æœåŠ¡æä¾›å•†</strong>: åä¸ºäº‘</li>
<li><strong>å®ä¾‹ç±»å‹</strong>: å¼¹æ€§äº‘æœåŠ¡å™¨(ECS)</li>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>: openEuler 20.03 64bit</li>
<li><strong>å­˜å‚¨</strong>: 40GiBç³»ç»Ÿç›˜</li>
<li><strong>ç½‘ç»œ</strong>: åä¸ºäº‘VPCç½‘ç»œç¯å¢ƒ
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6bbf0069794747c1b76101bc46e29db2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=ehaGMz3Z73CrHhYsRd7S33BwzmE%3D" alt="image.png" loading="lazy"/></li>
</ul>
<h3 data-id="heading-3">æµ‹è¯•ç›®æ ‡</h3>
<p>æœ¬æ¬¡è¯„æµ‹å°†ä»ä»¥ä¸‹å‡ ä¸ªç»´åº¦å¯¹openEuler 20.03è¿›è¡Œæ·±å…¥åˆ†æï¼š</p>
<ol>
<li>ç³»ç»Ÿå¯åŠ¨æ€§èƒ½</li>
<li>CPUè®¡ç®—æ€§èƒ½</li>
<li>å†…å­˜ç®¡ç†æ•ˆç‡</li>
<li>ç£ç›˜I/Oæ€§èƒ½</li>
<li>ç³»ç»Ÿèµ„æºå ç”¨æƒ…å†µ</li>
</ol>
<h2 data-id="heading-4">è¯¦ç»†æ“ä½œæ­¥éª¤ä¸æ€§èƒ½æµ‹è¯•</h2>
<h3 data-id="heading-5">æ­¥éª¤ä¸€ï¼šç³»ç»ŸåŸºç¡€ä¿¡æ¯æŸ¥çœ‹</h3>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å½“å‰ç³»ç»Ÿçš„åŸºæœ¬é…ç½®ä¿¡æ¯ã€‚</p>
<p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p>
<ol>
<li>è¿æ¥åˆ°openEuleræœåŠ¡å™¨ï¼Œæ‰“å¼€ç»ˆç«¯</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b7247af9dd9a4d5ca0b9b8ce17178fc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=PTWKxJIiYsuhE14OYNY%2BWghkTJA%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ä¿¡æ¯ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cat</span> /etc/os-release
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67c77eff61494771b86d127439d210fb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=Ak0NYnY5hyw7KmImm39mDnfry7c%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>æŸ¥çœ‹å†…æ ¸ç‰ˆæœ¬ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">uname</span> -a
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8fa391eecc6343558b185f83262d7858~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=knI6Q9jlC41PCcDPteUap5D9vKs%3D" alt="9c021b19b8f6765439d7da4cd37e8aaa.png" loading="lazy"/></p>
<ol start="4">
<li>æŸ¥çœ‹CPUä¿¡æ¯ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">lscpu
<span class="hljs-built_in">cat</span> /proc/cpuinfo | grep <span class="hljs-string">"model name"</span> | <span class="hljs-built_in">head</span> -1
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9f3e3f719e6147e794f247ecddaf3a7c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=mWSmolo0wubjsjDK1UUZNaxBIMM%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/944ff5e6fd244ea29b19da52c928db5c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=nTnJBe5gO8emWm473EEgLz%2Fbkyk%3D" alt="ac1d864a4087ae349e6af4d55ac53edd.png" loading="lazy"/></p>
<ol start="5">
<li>æŸ¥çœ‹å†…å­˜ä¿¡æ¯ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">free -h
<span class="hljs-built_in">cat</span> /proc/meminfo | <span class="hljs-built_in">head</span> -10
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/851617993e064a6e8556e600bc8c6d76~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=2lRvN9WjROCd%2FoEwikGEXBpCuQU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-6">æ­¥éª¤äºŒï¼šç³»ç»Ÿå¯åŠ¨æ€§èƒ½æµ‹è¯•</h3>
<p>ç³»ç»Ÿå¯åŠ¨æ—¶é—´æ˜¯è¡¡é‡æ“ä½œç³»ç»Ÿæ€§èƒ½çš„é‡è¦æŒ‡æ ‡ä¹‹ä¸€ã€‚</p>
<p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p>
<ol>
<li>æŸ¥çœ‹ç³»ç»Ÿå¯åŠ¨æ—¶é—´ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">systemd-analyze
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a0dd10d1fca742cca5414fb012666816~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=YbPKBq34lFx%2BWXIJvm%2BemfZKnS4%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>æŸ¥çœ‹è¯¦ç»†çš„å¯åŠ¨æ—¶é—´åˆ†è§£ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">systemd-analyze blame | <span class="hljs-built_in">head</span> -20
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed372740b87541ddb172a453df3aa9c4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=MwlgfMvq8%2B%2BTNq7mHpzAbTPz8Ac%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>ç”Ÿæˆå¯åŠ¨æ—¶é—´å›¾è¡¨ï¼ˆå¯é€‰ï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">systemd-analyze plot &gt; boot-analysis.svg
</code></pre>
<p><strong>æ€§èƒ½åˆ†æï¼š</strong>
openEuler 20.03åœ¨äº‘ç¯å¢ƒä¸‹çš„å¯åŠ¨æ—¶é—´é€šå¸¸åœ¨15-30ç§’ä¹‹é—´ï¼Œç›¸æ¯”ä¼ ç»ŸLinuxå‘è¡Œç‰ˆæœ‰æ˜æ˜¾ä¼˜åŠ¿ã€‚ç³»ç»Ÿå¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œå†…æ ¸åˆå§‹åŒ–å’ŒsystemdæœåŠ¡å¯åŠ¨æ˜¯ä¸»è¦è€—æ—¶ç¯èŠ‚ã€‚</p>
<h3 data-id="heading-7">æ­¥éª¤ä¸‰ï¼šCPUæ€§èƒ½åŸºå‡†æµ‹è¯•</h3>
<p>CPUä½œä¸ºè®¡ç®—æœºçš„"å¤§è„‘"ï¼Œå…¶æ€§èƒ½ç›´æ¥å†³å®šäº†ç³»ç»Ÿçš„è¿ç®—èƒ½åŠ›ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼ŒCPUéœ€è¦å¤„ç†å„ç§å¤æ‚çš„è®¡ç®—ä»»åŠ¡ï¼Œä»ç®€å•çš„æ•°å€¼è¿ç®—åˆ°å¤æ‚çš„ç®—æ³•å¤„ç†ï¼Œéƒ½ç¦»ä¸å¼€å¼ºå¤§çš„CPUæ€§èƒ½æ”¯æ’‘ã€‚</p>
<p>æˆ‘ä»¬å°†é€šè¿‡å¤šç§æµ‹è¯•æ–¹æ³•æ¥å…¨é¢è¯„ä¼°openEuler 20.03çš„CPUæ€§èƒ½è¡¨ç°ï¼ŒåŒ…æ‹¬åŸºç¡€çš„æ•°å­¦è¿ç®—èƒ½åŠ›ã€å¤šçº¿ç¨‹å¤„ç†èƒ½åŠ›ä»¥åŠåœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹çš„ç¨³å®šæ€§ã€‚è¿™äº›æµ‹è¯•å°†å¸®åŠ©æˆ‘ä»¬äº†è§£ç³»ç»Ÿåœ¨ä¸åŒå·¥ä½œè´Ÿè½½ä¸‹çš„çœŸå®è¡¨ç°ã€‚</p>
<p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p>
<ol>
<li>å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…·ï¼š</li>
</ol>
<p>ç”±äºopenEuler 20.03é»˜è®¤è½¯ä»¶æºä¸­ä¸åŒ…å«éƒ¨åˆ†ç¬¬ä¸‰æ–¹å·¥å…·ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®EPELæºæ¥å®‰è£…htopå’Œstressï¼Œå¹¶ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦å·¥å…·æ›¿ä»£sysbenchã€‚</p>
<p><strong>é…ç½®åä¸ºEPELæºå¹¶å®‰è£…å·¥å…·ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºåä¸ºEPELæºé…ç½®æ–‡ä»¶</span>
sudo vim /etc/yum.repos.d/epel-huawei.repo

<span class="hljs-comment"># æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</span>
[epel-everything]
name=huawei epel mirror
baseurl=https://repo.huaweicloud.com/epel/8/Everything/x86_64/
enabled=1
gpgcheck=0

<span class="hljs-comment"># æ›´æ–°è½¯ä»¶æºç¼“å­˜</span>
sudo dnf clean all
sudo dnf makecache

<span class="hljs-comment"># å®‰è£…æ€§èƒ½æµ‹è¯•å·¥å…·</span>
sudo dnf install -y stress htop

<span class="hljs-comment"># å®‰è£…ç³»ç»Ÿç›‘æ§å·¥å…·</span>
sudo dnf install -y sysstat procps-ng util-linux
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7ceeb951fea4b8c8baabe6b333122c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=lpePnOvs6ucD3sngbi8RebLjqvU%3D" alt="e237c67ed96e8c2efbfba0563853e25b.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2398af403a78437eb4317842661bb018~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=1i5uikdULBNQWvLe2TeV1M1zKAc%3D" alt="47fdb1705fbd89beb089e5c3aa828507.png" loading="lazy"/></p>
<ol start="2">
<li>è¿›è¡ŒCPUè®¡ç®—æ€§èƒ½æµ‹è¯•ï¼š</li>
</ol>
<p><strong>1. åŸºç¡€æ•°å­¦è¿ç®—æµ‹è¯•</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬æµ‹è¯•CPUçš„åŸºç¡€è¿ç®—èƒ½åŠ›ã€‚è¿™ä¸ªæµ‹è¯•é€šè¿‡è®¡ç®—åœ†å‘¨ç‡Ï€æ¥è¯„ä¼°CPUçš„æµ®ç‚¹è¿ç®—æ€§èƒ½ï¼Œè¿™æ˜¯ä¸€ä¸ªç»å…¸çš„CPUæ€§èƒ½æµ‹è¯•æ–¹æ³•ï¼š</p>
<p><strong>ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦å·¥å…·è¿›è¡ŒCPUæ€§èƒ½æµ‹è¯•ï¼š</strong></p>
<p><strong>åŸºç¡€æ•°å­¦è¿ç®—æµ‹è¯•ï¼ˆè®¡ç®—åœ†å‘¨ç‡ï¼‰ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨bcè®¡ç®—å™¨è¿›è¡Œé«˜ç²¾åº¦æ•°å­¦è¿ç®—ï¼Œæµ‹è¯•CPUæµ®ç‚¹è¿ç®—èƒ½åŠ›</span>
time <span class="hljs-built_in">echo</span> <span class="hljs-string">"scale=5000; 4*a(1)"</span> | bc -l

<span class="hljs-comment"># ä½¿ç”¨opensslè¿›è¡ŒCPUåŠ å¯†æ€§èƒ½æµ‹è¯•</span>
openssl speed rsa2048

<span class="hljs-comment"># ä½¿ç”¨yeså‘½ä»¤è¿›è¡ŒCPUå‹åŠ›æµ‹è¯•</span>
time <span class="hljs-built_in">timeout</span> 10s <span class="hljs-built_in">yes</span> &gt; /dev/null
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/42dad48b366f49bf956b4a84fee22fac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=n2Svkj4C%2FxYCOYUrv%2FfbJmdSF%2BU%3D" alt="e7e0c82da9b56fd6943e3d290aabdeb1.png" loading="lazy"/></p>
<ol start="3">
<li>
<p>ä½¿ç”¨stressè¿›è¡ŒCPUå‹åŠ›æµ‹è¯•ï¼š</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨stresså·¥å…·å¯¹CPUè¿›è¡Œå‹åŠ›æµ‹è¯•ï¼Œæ¨¡æ‹Ÿé«˜è´Ÿè½½æƒ…å†µä¸‹ç³»ç»Ÿçš„è¡¨ç°ã€‚è¿™ç§æµ‹è¯•å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ç³»ç»Ÿåœ¨æé™çŠ¶æ€ä¸‹çš„ç¨³å®šæ€§å’Œæ•£çƒ­è¡¨ç°ï¼š</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># CPUå‹åŠ›æµ‹è¯•ï¼ˆè¿è¡Œ60ç§’ï¼Œä½¿ç”¨2ä¸ªCPUæ ¸å¿ƒï¼‰</span>
stress --cpu 2 --<span class="hljs-built_in">timeout</span> 60s

<span class="hljs-comment"># æŸ¥çœ‹å‹åŠ›æµ‹è¯•æœŸé—´çš„CPUä½¿ç”¨æƒ…å†µ</span>
stress --cpu 2 --<span class="hljs-built_in">timeout</span> 60s &amp;
top -p $!
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/05eb5f6bceba4e648439f499be8b6247~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=qTF0pi0g0VvDQTejQj3CkDpaoow%3D" alt="aec62bb055a997b2981b53fb0b72b81e.png" loading="lazy"/></p>
<ol start="4">
<li>
<p><strong>å®æ—¶CPUç›‘æ§</strong></p>
<p>åœ¨è¿›è¡Œæ€§èƒ½æµ‹è¯•çš„åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å®æ—¶ç›‘æ§CPUçš„ä½¿ç”¨æƒ…å†µã€‚é€šè¿‡ç›‘æ§å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°CPUä½¿ç”¨ç‡ã€è´Ÿè½½æƒ…å†µã€è¿›ç¨‹åˆ†å¸ƒç­‰é‡è¦ä¿¡æ¯ï¼Œè¿™äº›æ•°æ®å°†å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£ç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€ï¼š</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨htopè¿›è¡Œå®æ—¶ç›‘æ§ï¼ˆå·²å®‰è£…ï¼‰</span>
htop

<span class="hljs-comment"># ä½¿ç”¨iostatç›‘æ§CPUä½¿ç”¨ç‡</span>
iostat -c 1 5

<span class="hljs-comment"># ä½¿ç”¨sarç›‘æ§CPUæ€§èƒ½</span>
sar -u 1 5

<span class="hljs-comment"># ä½¿ç”¨topå‘½ä»¤æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µ</span>
top
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4cfbbeb7f09b49a09018fb34907a2dd6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=aqHSUxiJNPyF9MrRzAxwJpahgQE%3D" alt="a44917f89132445ca75cdd6e03b15ac7.png" loading="lazy"/></p>
<p><strong>æ€§èƒ½åˆ†æï¼š</strong>
openEuler 20.03åœ¨CPUæ€§èƒ½æ–¹é¢è¡¨ç°ä¼˜å¼‚ï¼Œå¤šçº¿ç¨‹å¤„ç†èƒ½åŠ›å¼ºï¼Œä»»åŠ¡è°ƒåº¦ç®—æ³•ä¼˜åŒ–è‰¯å¥½ï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„è®¡ç®—èµ„æºã€‚</p>
<h3 data-id="heading-8">æ­¥éª¤å››ï¼šå†…å­˜æ€§èƒ½æµ‹è¯•</h3>
<p>å†…å­˜æ˜¯ç³»ç»Ÿè¿è¡Œçš„é‡è¦åŸºç¡€ï¼Œå°±åƒæ˜¯è®¡ç®—æœºçš„"å·¥ä½œå°"ã€‚å†…å­˜æ€§èƒ½çš„å¥½åç›´æ¥å½±å“åˆ°ç¨‹åºçš„è¿è¡Œé€Ÿåº¦å’Œç³»ç»Ÿçš„å“åº”èƒ½åŠ›ã€‚åœ¨ç°ä»£åº”ç”¨ä¸­ï¼Œæ— è®ºæ˜¯æ•°æ®åº“æ“ä½œã€å›¾åƒå¤„ç†è¿˜æ˜¯å¤§æ•°æ®åˆ†æï¼Œéƒ½éœ€è¦å¤§é‡çš„å†…å­˜æ”¯æŒã€‚</p>
<p>æˆ‘ä»¬å°†ä»å†…å­˜å¸¦å®½ï¼ˆæ•°æ®ä¼ è¾“é€Ÿåº¦ï¼‰ã€å†…å­˜å»¶è¿Ÿï¼ˆè®¿é—®å“åº”æ—¶é—´ï¼‰ä»¥åŠå†…å­˜å‹åŠ›æµ‹è¯•ç­‰å¤šä¸ªè§’åº¦æ¥è¯„ä¼°openEuler 20.03çš„å†…å­˜æ€§èƒ½è¡¨ç°ã€‚è¿™äº›æµ‹è¯•å°†å¸®åŠ©æˆ‘ä»¬äº†è§£ç³»ç»Ÿåœ¨å¤„ç†å¤§é‡æ•°æ®æ—¶çš„èƒ½åŠ›ã€‚</p>
<p>å†…å­˜ç®¡ç†æ˜¯æ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œç›´æ¥å½±å“ç³»ç»Ÿçš„å“åº”é€Ÿåº¦ã€‚</p>
<p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p>
<ol>
<li>
<p><strong>å†…å­˜å¸¦å®½æµ‹è¯•</strong></p>
<p>å†…å­˜å¸¦å®½æµ‹è¯•å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ç³»ç»Ÿåœ¨å¤§é‡æ•°æ®ä¼ è¾“æ—¶çš„è¡¨ç°ã€‚æˆ‘ä»¬ä½¿ç”¨ddå‘½ä»¤åœ¨å†…å­˜ä¸­è¿›è¡Œæ•°æ®å¤åˆ¶æ“ä½œï¼Œè¿™èƒ½å¤Ÿåæ˜ å‡ºå†…å­˜çš„å®é™…ä¼ è¾“é€Ÿåº¦ï¼š</p>
</li>
</ol>
<p><strong>ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦å·¥å…·è¿›è¡Œå†…å­˜æ€§èƒ½æµ‹è¯•ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># ä½¿ç”¨ddå‘½ä»¤æµ‹è¯•å†…å­˜è¯»å†™æ€§èƒ½</span>
time <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/null bs=1G count=1

<span class="hljs-comment"># ä½¿ç”¨å†…å­˜æ‹·è´æµ‹è¯•</span>
time <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/tmp/test_mem bs=1G count=1
time <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/tmp/test_mem of=/dev/null bs=1G count=1
<span class="hljs-built_in">rm</span> /tmp/test_mem

<span class="hljs-comment"># ä½¿ç”¨/dev/shmè¿›è¡Œå†…å­˜æ–‡ä»¶ç³»ç»Ÿæµ‹è¯•</span>
time <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/dev/shm/test bs=1G count=1
time <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/shm/test of=/dev/null bs=1G count=1
<span class="hljs-built_in">rm</span> /dev/shm/test
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ad6432408f2e4361bf1e707243932995~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=RVdXLN5ohHXr4fqwPSLcmmlr6lE%3D" alt="0301d7c6d2ac966e13ae664de54193bc.png" loading="lazy"/></p>
<ol start="2">
<li>å†…å­˜å»¶è¿Ÿå’Œè®¿é—®æ¨¡å¼æµ‹è¯•ï¼š</li>
</ol>
<p><strong>ä½¿ç”¨ç³»ç»Ÿå·¥å…·æµ‹è¯•å†…å­˜è®¿é—®æ€§èƒ½ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æµ‹è¯•å†…å­˜è®¿é—®å»¶è¿Ÿ</span>
time <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..10000}; <span class="hljs-keyword">do</span> <span class="hljs-built_in">cat</span> /proc/meminfo &gt; /dev/null; <span class="hljs-keyword">done</span>

<span class="hljs-comment"># ä½¿ç”¨å¤§é‡å°æ–‡ä»¶æ“ä½œæµ‹è¯•å†…å­˜ç®¡ç†</span>
time <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> {1..1000}; <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> <span class="hljs-string">"test"</span> &gt; /tmp/test_<span class="hljs-variable">$i</span>; <span class="hljs-keyword">done</span>
time <span class="hljs-built_in">rm</span> /tmp/test_*


</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d0c5d26834c483fbf71730f4b7d2b0e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=E5KLfEyVQRQIwgrgdB8OTSXaXJE%3D" alt="image.png" loading="lazy"/></p>
<ol start="3">
<li>æŸ¥çœ‹å†…å­˜ä½¿ç”¨è¯¦æƒ…ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹è¯¦ç»†å†…å­˜ä¿¡æ¯</span>
<span class="hljs-built_in">cat</span> /proc/meminfo
free -h
vmstat 1 5

<span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä½¿ç”¨ç»Ÿè®¡</span>
sar -r 1 5

<span class="hljs-comment"># æŸ¥çœ‹è¿›ç¨‹å†…å­˜ä½¿ç”¨</span>
ps aux --<span class="hljs-built_in">sort</span>=-%mem | <span class="hljs-built_in">head</span> -10
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a1918516d4624d03aa25f08aeb3fb73e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=IA3EIIavFr1S2haFN3JsGh03c%2BI%3D" alt="image.png" loading="lazy"/></p>
<ol start="4">
<li>
<p><strong>å†…å­˜å‹åŠ›æµ‹è¯•</strong></p>
<p>å†…å­˜å‹åŠ›æµ‹è¯•é€šè¿‡åˆ›å»ºå¤§é‡çš„å†…å­˜åˆ†é…æ“ä½œæ¥æµ‹è¯•ç³»ç»Ÿåœ¨å†…å­˜ä¸è¶³æƒ…å†µä¸‹çš„è¡¨ç°ã€‚è¿™ç§æµ‹è¯•å¯ä»¥å¸®åŠ©æˆ‘ä»¬äº†è§£ç³»ç»Ÿçš„å†…å­˜ç®¡ç†æœºåˆ¶å’Œç¨³å®šæ€§ï¼š</p>
</li>
</ol>
<p><strong>ä½¿ç”¨stressè¿›è¡Œå†…å­˜å‹åŠ›æµ‹è¯•ï¼š</strong></p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># å†…å­˜å‹åŠ›æµ‹è¯•ï¼ˆåˆ†é…2ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ª1GBå†…å­˜ï¼ŒæŒç»­60ç§’ï¼‰</span>
stress --vm 2 --vm-bytes 1G --<span class="hljs-built_in">timeout</span> 60s

<span class="hljs-comment"># åœ¨å¦ä¸€ä¸ªç»ˆç«¯ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ</span>
htop

<span class="hljs-comment"># æˆ–ä½¿ç”¨watchå‘½ä»¤æŒç»­ç›‘æ§</span>
watch -n 1 <span class="hljs-string">'free -h &amp;&amp; echo "---" &amp;&amp; ps aux --sort=-%mem | head -5'</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/eb274da100024e93865500909533b979~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=OsZf9YuC9j6yTHiiBDQugpTcvpE%3D" alt="b754f64e4bdfada7d3cb0dda4e422918.png" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2605c41ceef14bc6b7e37e8571e7ac7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=xN0dEjmovX%2BKcv0Xtd8fcpKTjEI%3D" alt="d975f3081e19e9dc0c4f68ea0a8331ca.png" loading="lazy"/></p>
<p><strong>æ€§èƒ½åˆ†æï¼š</strong>
openEuler 20.03çš„å†…å­˜ç®¡ç†æœºåˆ¶é«˜æ•ˆï¼Œå†…å­˜åˆ†é…å’Œå›æ”¶é€Ÿåº¦å¿«ï¼Œè™šæ‹Ÿå†…å­˜ç®¡ç†ä¼˜åŒ–åˆ°ä½ï¼Œèƒ½å¤Ÿæœ‰æ•ˆé¿å…å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚</p>
<h3 data-id="heading-9">æ­¥éª¤äº”ï¼šç£ç›˜I/Oæ€§èƒ½æµ‹è¯•</h3>
<p>ç£ç›˜I/Oæ€§èƒ½æ˜¯ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå°±åƒæ˜¯æ•°æ®çš„"é«˜é€Ÿå…¬è·¯"ã€‚æ— è®ºæ˜¯æ“ä½œç³»ç»Ÿå¯åŠ¨ã€åº”ç”¨ç¨‹åºåŠ è½½ï¼Œè¿˜æ˜¯æ•°æ®åº“æŸ¥è¯¢ã€æ–‡ä»¶ä¼ è¾“ï¼Œéƒ½ç¦»ä¸å¼€ç£ç›˜çš„è¯»å†™æ“ä½œã€‚ç‰¹åˆ«æ˜¯åœ¨äº‘æœåŠ¡å™¨ç¯å¢ƒä¸­ï¼Œç£ç›˜I/Oæ€§èƒ½å¾€å¾€æˆä¸ºå½±å“åº”ç”¨å“åº”é€Ÿåº¦çš„å…³é”®å› ç´ ã€‚</p>
<p>æˆ‘ä»¬å°†é€šè¿‡æµ‹è¯•ç£ç›˜çš„é¡ºåºè¯»å†™æ€§èƒ½ã€éšæœºè¯»å†™èƒ½åŠ›ä»¥åŠå®æ—¶I/Oç›‘æ§æ¥å…¨é¢è¯„ä¼°openEuler 20.03åœ¨åä¸ºäº‘ç¯å¢ƒä¸‹çš„å­˜å‚¨æ€§èƒ½è¡¨ç°ã€‚è¿™äº›æµ‹è¯•å°†å¸®åŠ©æˆ‘ä»¬äº†è§£ç³»ç»Ÿåœ¨å¤„ç†ä¸åŒç±»å‹å­˜å‚¨ä»»åŠ¡æ—¶çš„èƒ½åŠ›ã€‚</p>
<p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p>
<ol>
<li>
<p><strong>ç£ç›˜åŸºæœ¬ä¿¡æ¯æŸ¥çœ‹</strong></p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦äº†è§£ç³»ç»Ÿçš„ç£ç›˜é…ç½®æƒ…å†µï¼ŒåŒ…æ‹¬ç£ç›˜ç±»å‹ã€å®¹é‡ã€åˆ†åŒºæƒ…å†µç­‰åŸºæœ¬ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å°†å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£åç»­æµ‹è¯•ç»“æœï¼š</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹ç£ç›˜ä¿¡æ¯å’ŒI/Oç»Ÿè®¡</span>
lsblk &amp;&amp; <span class="hljs-built_in">df</span> -h
iostat -x 1 3
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6908d5eb4fe146d2ac65813a9542500e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=Ev%2B3b%2FbQRRpLuy7TA%2FcDqWmAdik%3D" alt="image.png" loading="lazy"/></p>
<ol start="2">
<li>
<p><strong>ç£ç›˜è¯»å†™æ€§èƒ½æµ‹è¯•</strong></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨ddå‘½ä»¤è¿›è¡Œç£ç›˜è¯»å†™æ€§èƒ½æµ‹è¯•ã€‚ddæ˜¯Linuxç³»ç»Ÿä¸­æœ€å¸¸ç”¨çš„ç£ç›˜æµ‹è¯•å·¥å…·ï¼Œå®ƒå¯ä»¥æ¨¡æ‹Ÿä¸åŒçš„è¯»å†™åœºæ™¯ï¼Œå¸®åŠ©æˆ‘ä»¬äº†è§£ç£ç›˜çš„å®é™…æ€§èƒ½è¡¨ç°ï¼š</p>
</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># é¡ºåºå†™æµ‹è¯•</span>
time <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/dev/zero of=/tmp/test_write bs=1M count=1024 oflag=direct

<span class="hljs-comment"># é¡ºåºè¯»æµ‹è¯•</span>
<span class="hljs-built_in">echo</span> 3 | sudo <span class="hljs-built_in">tee</span> /proc/sys/vm/drop_caches
time <span class="hljs-built_in">dd</span> <span class="hljs-keyword">if</span>=/tmp/test_write of=/dev/null bs=1M count=1024 iflag=direct

<span class="hljs-comment"># æ¸…ç†æµ‹è¯•æ–‡ä»¶</span>
<span class="hljs-built_in">rm</span> -f /tmp/test_write
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d033cffd25ba41008b2d1a74d35c85d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YCU5by655qE55-z5aS0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765353451&amp;x-signature=2o2800jQDcoykk3mx%2FEaBRkl8Co%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-10">ç³»ç»Ÿä¼˜åŒ–å®è·µ</h2>
<p>ç³»ç»Ÿä¼˜åŒ–æ˜¯æå‡æœåŠ¡å™¨æ€§èƒ½çš„é‡è¦æ‰‹æ®µï¼Œå°±åƒæ˜¯ç»™æ±½è½¦è¿›è¡Œç²¾ç»†è°ƒæ ¡ä¸€æ ·ã€‚é€šè¿‡åˆç†çš„å‚æ•°è°ƒæ•´å’Œé…ç½®ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥è®©openEuler 20.03åœ¨ç°æœ‰ç¡¬ä»¶æ¡ä»¶ä¸‹å‘æŒ¥å‡ºæ›´å¥½çš„æ€§èƒ½è¡¨ç°ã€‚</p>
<p>ç³»ç»Ÿä¼˜åŒ–æ¶‰åŠå¤šä¸ªå±‚é¢ï¼ŒåŒ…æ‹¬å†…æ ¸å‚æ•°è°ƒæ•´ã€æ–‡ä»¶ç³»ç»Ÿä¼˜åŒ–ã€ç½‘ç»œé…ç½®è°ƒä¼˜ç­‰ã€‚è¿™äº›ä¼˜åŒ–æªæ–½éœ€è¦æ ¹æ®å®é™…çš„åº”ç”¨åœºæ™¯å’Œå·¥ä½œè´Ÿè½½æ¥è¿›è¡Œé’ˆå¯¹æ€§çš„è°ƒæ•´ã€‚æˆ‘ä»¬å°†ä»‹ç»ä¸€äº›å¸¸ç”¨ä¸”æœ‰æ•ˆçš„ä¼˜åŒ–æ–¹æ³•ï¼Œå¸®åŠ©æ‚¨åœ¨å®é™…ä½¿ç”¨ä¸­è·å¾—æ›´å¥½çš„æ€§èƒ½ä½“éªŒã€‚</p>
<h3 data-id="heading-11">å†…æ ¸å‚æ•°ä¼˜åŒ–</h3>
<p>å†…æ ¸å‚æ•°ä¼˜åŒ–æ˜¯ç³»ç»Ÿè°ƒä¼˜çš„æ ¸å¿ƒç¯èŠ‚ï¼Œé€šè¿‡è°ƒæ•´å†…æ ¸çš„è¿è¡Œå‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è®©ç³»ç»Ÿæ›´å¥½åœ°é€‚åº”ç‰¹å®šçš„å·¥ä½œè´Ÿè½½ã€‚è¿™å°±åƒæ˜¯è°ƒæ•´æ±½è½¦å‘åŠ¨æœºçš„å„ç§å‚æ•°æ¥è·å¾—æœ€ä½³æ€§èƒ½ä¸€æ ·ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„å†…æ ¸å‚æ•°ä¼˜åŒ–é…ç½®ï¼Œè¿™äº›å‚æ•°ç»è¿‡å®è·µéªŒè¯ï¼Œèƒ½å¤Ÿåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹æå‡ç³»ç»Ÿæ€§èƒ½ï¼š</p>
<p><strong>æ“ä½œæ­¥éª¤ï¼š</strong></p>
<ol>
<li>æŸ¥çœ‹å’Œä¼˜åŒ–å…³é”®å‚æ•°ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å½“å‰å…³é”®å‚æ•°</span>
sysctl vm.swappiness net.core.rmem_max

<span class="hljs-comment"># ä¼˜åŒ–é…ç½®</span>
sudo <span class="hljs-built_in">tee</span> -a /etc/sysctl.conf &lt;&lt; <span class="hljs-string">EOF
# æ€§èƒ½ä¼˜åŒ–å‚æ•°
vm.swappiness = 10
vm.dirty_ratio = 15
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
EOF</span>

<span class="hljs-comment"># åº”ç”¨é…ç½®</span>
sudo sysctl -p
</code></pre>
<h3 data-id="heading-12">ç³»ç»Ÿç›‘æ§</h3>
<p>åˆ›å»ºç®€å•çš„æ€§èƒ½ç›‘æ§è„šæœ¬ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># åˆ›å»ºç›‘æ§è„šæœ¬</span>
<span class="hljs-built_in">cat</span> &gt; monitor.sh &lt;&lt; <span class="hljs-string">'EOF'</span>
<span class="hljs-comment">#!/bin/bash</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"=== <span class="hljs-subst">$(date)</span> ==="</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"CPU: <span class="hljs-subst">$(top -bn1 | grep <span class="hljs-string">"Cpu(s)"</span> | awk '{print $2}')</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Memory: <span class="hljs-subst">$(free | grep Mem | awk '{printf <span class="hljs-string">"%.1f%%"</span>, $3/$2*100}')</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Disk: <span class="hljs-subst">$(df -h / | tail -1 | awk '{print $5}')</span>"</span>
<span class="hljs-built_in">echo</span> <span class="hljs-string">"Load: <span class="hljs-subst">$(uptime | awk -F'load average:' '{print $2}')</span>"</span>
EOF

<span class="hljs-built_in">chmod</span> +x monitor.sh &amp;&amp; ./monitor.sh
</code></pre>
<h2 data-id="heading-13">æµ‹è¯•ç»“æœæ€»ç»“</h2>
<h3 data-id="heading-14">æ€§èƒ½è¡¨ç°è¯„ä¼°</h3>
<p>é€šè¿‡æœ¬æ¬¡å…¨é¢çš„æ€§èƒ½è¯„æµ‹ï¼Œæˆ‘ä»¬å¯¹openEuler 20.03åœ¨åä¸ºäº‘ç¯å¢ƒä¸‹çš„è¡¨ç°æœ‰äº†æ·±å…¥çš„äº†è§£ã€‚æµ‹è¯•ç»“æœæ˜¾ç¤ºï¼ŒopenEuler 20.03ä½œä¸ºä¸€æ¬¾ä¼ä¸šçº§Linuxå‘è¡Œç‰ˆï¼Œåœ¨å„ä¸ªæ€§èƒ½ç»´åº¦ä¸Šéƒ½è¡¨ç°å‡ºäº†ä¼˜ç§€çš„æ°´å‡†ã€‚</p>
<p><strong>CPUæ€§èƒ½æ–¹é¢</strong>ï¼šç³»ç»Ÿåœ¨æ•°å­¦è¿ç®—ã€å¤šçº¿ç¨‹å¤„ç†å’ŒåŠ å¯†è¿ç®—ç­‰æµ‹è¯•ä¸­è¡¨ç°ç¨³å®šï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„è®¡ç®—èƒ½åŠ›ã€‚åœ¨é«˜è´Ÿè½½æƒ…å†µä¸‹ï¼Œç³»ç»Ÿä¾ç„¶ä¿æŒè‰¯å¥½çš„å“åº”æ€§å’Œç¨³å®šæ€§ï¼Œè¿™å¾—ç›ŠäºopenEulerä¼˜åŒ–çš„è¿›ç¨‹è°ƒåº¦ç®—æ³•å’Œèµ„æºç®¡ç†æœºåˆ¶ã€‚</p>
<p><strong>å†…å­˜æ€§èƒ½æ–¹é¢</strong>ï¼šå†…å­˜å¸¦å®½å’Œå»¶è¿Ÿæµ‹è¯•ç»“æœè¡¨æ˜ï¼ŒopenEuler 20.03å…·æœ‰å‡ºè‰²çš„å†…å­˜ç®¡ç†èƒ½åŠ›ã€‚ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆåœ°å¤„ç†å¤§é‡æ•°æ®çš„è¯»å†™æ“ä½œï¼Œå†…å­˜åˆ†é…å’Œå›æ”¶æœºåˆ¶è¿è¡Œç¨³å®šï¼Œä¸ºè¿è¡Œå¤§å‹åº”ç”¨ç¨‹åºæä¾›äº†åšå®çš„åŸºç¡€ã€‚</p>
<p><strong>ç£ç›˜I/Oæ€§èƒ½æ–¹é¢</strong>ï¼šåœ¨é¡ºåºè¯»å†™å’Œéšæœºè®¿é—®æµ‹è¯•ä¸­ï¼Œç³»ç»Ÿå±•ç°äº†è‰¯å¥½çš„å­˜å‚¨æ€§èƒ½ã€‚ç‰¹åˆ«æ˜¯åœ¨äº‘ç¯å¢ƒä¸‹ï¼ŒopenEuler 20.03èƒ½å¤Ÿå¾ˆå¥½åœ°é€‚é…ä¸åŒç±»å‹çš„å­˜å‚¨è®¾å¤‡ï¼Œå……åˆ†å‘æŒ¥äº‘å­˜å‚¨çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</p>
<p><strong>ç³»ç»Ÿä¼˜åŒ–æ•ˆæœ</strong>ï¼šé€šè¿‡å†…æ ¸å‚æ•°è°ƒä¼˜å’Œç³»ç»Ÿé…ç½®ä¼˜åŒ–ï¼Œæˆ‘ä»¬è¿›ä¸€æ­¥æå‡äº†ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½ã€‚ä¼˜åŒ–åçš„ç³»ç»Ÿåœ¨èµ„æºåˆ©ç”¨ç‡ã€å“åº”é€Ÿåº¦å’Œç¨³å®šæ€§æ–¹é¢éƒ½æœ‰æ˜æ˜¾æ”¹å–„ã€‚</p>
<h3 data-id="heading-15">ä¼˜åŒ–å»ºè®®</h3>
<ol>
<li><strong>é’ˆå¯¹ç‰¹å®šå·¥ä½œè´Ÿè½½è°ƒä¼˜</strong>ï¼šæ ¹æ®å®é™…åº”ç”¨åœºæ™¯è°ƒæ•´å†…æ ¸å‚æ•°</li>
<li><strong>å®šæœŸæ€§èƒ½ç›‘æ§</strong>ï¼šå»ºç«‹å®Œå–„çš„æ€§èƒ½ç›‘æ§ä½“ç³»</li>
<li><strong>èµ„æºåˆç†é…ç½®</strong>ï¼šæ ¹æ®æ€§èƒ½æµ‹è¯•ç»“æœåˆç†é…ç½®ç¡¬ä»¶èµ„æº</li>
</ol>
<h2 data-id="heading-16">ç»“è®º</h2>
<p>é€šè¿‡æœ¬æ¬¡æ·±å…¥çš„æ€§èƒ½è¯„æµ‹å’Œä¼˜åŒ–å®è·µï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹é‡è¦ç»“è®ºï¼š</p>
<p><strong>openEuler 20.03å±•ç°äº†å“è¶Šçš„æŠ€æœ¯å®åŠ›</strong>ã€‚ä½œä¸ºä¸€æ¬¾è‡ªä¸»ç ”å‘çš„ä¼ä¸šçº§Linuxå‘è¡Œç‰ˆï¼Œå®ƒåœ¨æ€§èƒ½ã€ç¨³å®šæ€§å’Œå¯é æ€§æ–¹é¢éƒ½è¾¾åˆ°äº†å›½é™…å…ˆè¿›æ°´å¹³ã€‚æ— è®ºæ˜¯CPUå¯†é›†å‹è®¡ç®—ã€å¤§å†…å­˜åº”ç”¨ï¼Œè¿˜æ˜¯é«˜I/Oè´Ÿè½½åœºæ™¯ï¼ŒopenEuler 20.03éƒ½èƒ½å¤Ÿæä¾›ç¨³å®šå¯é çš„æ”¯æ’‘ã€‚</p>
<p><strong>äº‘åŸç”Ÿé€‚é…èƒ½åŠ›çªå‡º</strong>ã€‚åœ¨åä¸ºäº‘ç¯å¢ƒä¸‹ï¼ŒopenEuler 20.03å±•ç°å‡ºäº†ä¼˜ç§€çš„äº‘åŸç”Ÿç‰¹æ€§ï¼Œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨äº‘è®¡ç®—çš„å¼¹æ€§èµ„æºï¼Œä¸ºç°ä»£åº”ç”¨æä¾›é«˜æ•ˆçš„è¿è¡Œç¯å¢ƒã€‚è¿™ç§æ·±åº¦çš„äº‘å¹³å°é€‚é…ï¼Œä½¿å¾—ç”¨æˆ·èƒ½å¤Ÿæ›´å¥½åœ°äº«å—äº‘è®¡ç®—å¸¦æ¥çš„ä¾¿åˆ©å’Œä¼˜åŠ¿ã€‚</p>
<p><strong>ç³»ç»Ÿä¼˜åŒ–æ½œåŠ›å·¨å¤§</strong>ã€‚é€šè¿‡åˆç†çš„å‚æ•°è°ƒä¼˜å’Œé…ç½®ä¼˜åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥é‡Šæ”¾ç³»ç»Ÿçš„æ€§èƒ½æ½œåŠ›ã€‚è¿™ç§å¯è°ƒä¼˜æ€§ä¸ºä¸åŒåº”ç”¨åœºæ™¯çš„æ€§èƒ½å®šåˆ¶æä¾›äº†å¯èƒ½ï¼Œä½¿å¾—openEuler 20.03èƒ½å¤Ÿé€‚åº”æ›´åŠ å¹¿æ³›çš„åº”ç”¨éœ€æ±‚ã€‚</p>
<p><strong>ç”Ÿæ€å…¼å®¹æ€§è‰¯å¥½</strong>ã€‚åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‘ç°openEuler 20.03ä¸ä¸»æµçš„å¼€æºè½¯ä»¶å’Œå·¥å…·å…·æœ‰è‰¯å¥½çš„å…¼å®¹æ€§ï¼Œè¿™ä¸ºç”¨æˆ·çš„åº”ç”¨è¿ç§»å’Œéƒ¨ç½²æä¾›äº†ä¾¿åˆ©ã€‚</p>
<p><strong>æœªæ¥å‘å±•å‰æ™¯å¹¿é˜”</strong>ã€‚openEulerä½œä¸ºé‡è¦çš„åŸºç¡€è½¯ä»¶ï¼Œå°†åœ¨æ›´å¤šçš„å…³é”®åº”ç”¨åœºæ™¯ä¸­å‘æŒ¥é‡è¦ä½œç”¨ã€‚å…¶å¼€æºå¼€æ”¾çš„ç‰¹æ€§ä¹Ÿä¸ºæŠ€æœ¯åˆ›æ–°å’Œç”Ÿæ€å»ºè®¾æä¾›äº†è‰¯å¥½çš„åŸºç¡€ã€‚</p>
<p>å¯¹äºä¼ä¸šç”¨æˆ·è€Œè¨€ï¼Œé€‰æ‹©openEuler 20.03ä¸ä»…èƒ½å¤Ÿè·å¾—ä¼˜ç§€çš„æŠ€æœ¯æ€§èƒ½ï¼Œæ›´èƒ½å¤Ÿåœ¨æ•°å­—åŒ–è½¬å‹çš„é“è·¯ä¸Šè·å¾—å¯é çš„æŠ€æœ¯ä¿éšœã€‚æˆ‘ä»¬ç›¸ä¿¡ï¼Œéšç€openEulerç¤¾åŒºçš„ä¸æ–­å‘å±•å’ŒæŠ€æœ¯çš„æŒç»­æ¼”è¿›ï¼Œè¿™æ¬¾ä¼˜ç§€çš„æ“ä½œç³»ç»Ÿå°†ä¸ºæ›´å¤šç”¨æˆ·åˆ›é€ ä»·å€¼ï¼Œæ¨åŠ¨æˆ‘å›½ä¿¡æ¯æŠ€æœ¯äº§ä¸šçš„é«˜è´¨é‡å‘å±•ã€‚</p>
<hr/>
<p><em>æœ¬æ–‡åŸºäºåä¸ºäº‘å¼¹æ€§æœåŠ¡å™¨ç¯å¢ƒä¸‹çš„å®é™…æµ‹è¯•ï¼Œæ‰€æœ‰æ•°æ®å’Œæˆªå›¾å‡æ¥è‡ªçœŸå®çš„æ“ä½œè¿‡ç¨‹ã€‚æ–‡ç« å†…å®¹ä»…ä¾›æŠ€æœ¯äº¤æµå’Œå­¦ä¹ å‚è€ƒã€‚</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[åŸºäºæ¨¡å—è”é‚¦æ‰“é€šå¤šç³»ç»Ÿçš„æ¢ç´¢]]></title>    <link>https://juejin.cn/post/7579168400990126115</link>    <guid>https://juejin.cn/post/7579168400990126115</guid>    <pubDate>2025-12-03T07:24:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579168400990126115" data-draft-id="7579190764771573800" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="åŸºäºæ¨¡å—è”é‚¦æ‰“é€šå¤šç³»ç»Ÿçš„æ¢ç´¢"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T07:24:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="kevinzzzzzz"/> <meta itemprop="url" content="https://juejin.cn/user/149138992532440"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            åŸºäºæ¨¡å—è”é‚¦æ‰“é€šå¤šç³»ç»Ÿçš„æ¢ç´¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149138992532440/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    kevinzzzzzz
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:24:14.000Z" title="Wed Dec 03 2025 07:24:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<blockquote>
<p>æ¨¡å—è”é‚¦ï¼ˆModule Federationï¼‰æ˜¯ä¸€ç§å‰ç«¯æŠ€æœ¯ï¼Œå…è®¸ä¸åŒæ„å»ºçš„åº”ç”¨ä¹‹é—´å…±äº«æ¨¡å—ã€‚ç±»ä¼¼äºå¾®æœåŠ¡æ¶æ„åœ¨å‰ç«¯çš„ä½“ç°ã€‚é€šè¿‡æ¨¡å—è”é‚¦ï¼Œå¯ä»¥å®ç°è·¨åº”ç”¨çš„ä»£ç å…±äº«ï¼Œè¿™å¯¹äºæ„å»ºå¾®å‰ç«¯æ¶æ„éå¸¸æœ‰ç”¨ã€‚</p>
<ol>
<li>Â è¿œç¨‹åº”ç”¨ï¼ˆRemote Applicationï¼‰ï¼šæš´éœ²æ¨¡å—çš„åº”ç”¨ï¼Œå…¶ä»–åº”ç”¨å¯ä»¥å¼•ç”¨è¿™äº›æ¨¡å—ã€‚</li>
<li>Â å®¿ä¸»åº”ç”¨ï¼ˆHost Applicationï¼‰ï¼šå¼•ç”¨è¿œç¨‹åº”ç”¨æ¨¡å—çš„åº”ç”¨ã€‚</li>
</ol>
</blockquote>
<h3 data-id="heading-1">èƒŒæ™¯</h3>
<p>å‰ä¸ä¹…ï¼Œä¸´æ—¶æ¥åˆ°ä¸ªéœ€æ±‚ï¼Œæƒ³è¦å®ç°ä¸²è”å¤šä¸ªç³»ç»Ÿï¼Œèƒ½å¤Ÿå®ç°è‡ªç”±åˆ‡æ¢åˆèƒ½åˆ†å¼€å•ç‹¬è¿è¡Œï¼Œä¹Ÿè¦æ•°æ®å…±äº«ä¹Ÿè¦ç›¸äº’å¼•ç”¨ï¼ˆå®åœ¨æ˜¯æ—¢è¦åˆè¦è¿˜è¦ï¼Œååˆ†ç¬¦åˆå½“ä¸‹äº§å“çš„è®¾è®¡æ€ç»´ï¼‰ã€‚æ— å¥ˆè°è¿˜ä¸æ˜¯å¤´ç‰›é©¬ï¼Œåªèƒ½ç»å°½è„‘æ±é€ äº†ã€‚ å¥½åœ¨å¹³å¸¸çš„çŸ¥è¯†å‚¨å¤‡è¿˜æ˜¯æœ‰çš„ï¼Œmonorepoã€å¾®å‰ç«¯ã€æ¨¡å—è”é‚¦é¡¿æ—¶æ‰“å…¥è„‘æµ·ï¼Œç”±äºä¹‹å‰å¾®å‰ç«¯å’Œmonorepoéƒ½æè¿‡äº†ï¼Œå‹‰ä¸ºå…¶éš¾çš„é€‰æ‹©äº†æ¨¡å—è”é‚¦ã€‚äºæ˜¯å¼€å§‹ç€æ‰‹æ‰“å¼€å„ç§æœç´¢å¼•æ“å„ç§Aiå¼€å§‹ç ”ç©¶ï¼Œæ²¡æˆæƒ³ï¼Œè¶Šç ”ç©¶è¿˜è§‰å¾—è¶Šå¯¹å‘³å“ˆå“ˆå“ˆå“ˆ!ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€ğŸ˜€</p>
<h2 data-id="heading-2">ä¸€ã€æ¶æ„è®¾è®¡</h2>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43f0dab73ae14ccc8e1c8498cf7bb138~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=AlEvPU7QeJ1rjvBLysrrZxDWVgk%3D" alt="a632fb21ff92475c9c4d488089a0153f.png" loading="lazy"/>
<strong>1ã€ç³»ç»Ÿæ¦‚å¿µï¼š</strong> æ¯ä¸ªç‹¬ç«‹çš„å‰ç«¯é¡¹ç›®éƒ½ä¸ºä¸€ä¸ªç‹¬ç«‹ç³»ç»Ÿï¼›</p>
<p><strong>2ã€ç³»ç»Ÿäº’é€šï¼š</strong> èƒ½ç›¸äº’è·³è½¬ï¼ˆå®ç°SSOå•ç‚¹ç™»å½•ï¼‰ï¼Œç³»ç»Ÿèƒ½è®¿é—®å…¶ä»–ç³»ç»Ÿçš„ç»„ä»¶ï¼›</p>
<p><strong>3ã€æ’ä»¶ï¼š</strong> ç±»ä¼¼å·¥å…·ç±»ï¼Œå¯æä¾›å„ä¸ªç³»ç»Ÿ/ç»„ä»¶ä½¿ç”¨ï¼Œå¯è€ƒè™‘ç‹¬ç«‹åº“æ–¹å¼å®ç°ï¼›</p>
<h2 data-id="heading-3">äºŒã€åœºæ™¯åŠç›®æ ‡</h2>
<h3 data-id="heading-4">(ä¸€) åº”ç”¨åœºæ™¯</h3>
<p>ç³»ç»Ÿå¤ªå¤šä¸”å‰²è£‚ï¼Œå‡è®¾å½“å‰æœ‰å¤šä¸ªç³»ç»Ÿä¸»ç³»ç»Ÿã€ç³»ç»Ÿ2ã€...ã€ç³»ç»ŸNï¼Œä¸”åˆ†åˆ«ç”±å¤šä¸ªä¸åŒçš„ä»£ç ä»“åº“ç®¡ç†</p>
<h3 data-id="heading-5">(äºŒ) ç›®æ ‡æ•ˆæœ</h3>
<ul>
<li>å¤šä¸ªç³»ç»Ÿæ—¢èƒ½é›†æˆè¿è¡Œåˆèƒ½å•ç‹¬è¿è¡Œï¼›</li>
<li>æ•°æ®å…±äº«å’Œç»Ÿä¸€ç™»å½•ï¼›</li>
<li>ç³»ç»Ÿäº’è®¤ï¼Œå„ç³»ç»Ÿä¹‹é—´èƒ½å¤Ÿç›¸äº’å¼•ç”¨ï¼›</li>
</ul>
<h2 data-id="heading-6">ä¸‰ã€æŠ€æœ¯å®ç°</h2>
<h3 data-id="heading-7">(ä¸€) æŠ€æœ¯é€‰å‹</h3>
<ol>
<li>æŠ€æœ¯æ ˆ vue3+pinia+vite</li>
<li>uiæ¡†æ¶ <a href="https://link.juejin.cn?target=https%3A%2F%2Felement-plus.org%2Fzh-CN%2F" target="_blank" title="https://element-plus.org/zh-CN/" ref="nofollow noopener noreferrer">element-plus</a> + <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHalseySpicy%2FGeeker-Admin" target="_blank" title="https://github.com/HalseySpicy/Geeker-Admin" ref="nofollow noopener noreferrer">Geeker Admin</a></li>
<li><strong>æ ¸å¿ƒæ’ä»¶ @originjs/vite-plugin-federation(</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foriginjs%2Fvite-plugin-federation" target="_blank" title="https://github.com/originjs/vite-plugin-federation" ref="nofollow noopener noreferrer"><strong>æ¨¡å—è”é‚¦</strong></a> <strong>)</strong></li>
</ol>
<h3 data-id="heading-8">(äºŒ) é¡¹ç›®åˆ›å»º</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2389f95fd0b476ba4d9a5811ad522ed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=Z1f03qu%2BhzznlCMQ6CXKdfvVBho%3D" alt="" loading="lazy"/></p>
<p>é¦–å…ˆä»¥<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHalseySpicy%2FGeeker-Admin" target="_blank" title="https://github.com/HalseySpicy/Geeker-Admin" ref="nofollow noopener noreferrer">Geeker Admin</a> ä¸ºè„šæ‰‹æ¶æ¨¡æ¿(è¿œç¨‹æ‹‰å–)ï¼Œåˆ†åˆ«åˆ›å»ºä¸‰ä¸ªç³»ç»Ÿé¡¹ç›®main-systemã€system2å’Œsystem3ï¼Œå¹¶åˆ†åˆ«å®‰è£…ä¾èµ–</p>
<pre><code class="hljs language-shell" lang="shell">pnpm install
</code></pre>
<p>æ¥ç€åœ¨æ¯ä¸ªé¡¹ç›®ä¸­åˆ†åˆ«å®‰è£…ä¸Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foriginjs%2Fvite-plugin-federation" target="_blank" title="https://github.com/originjs/vite-plugin-federation" ref="nofollow noopener noreferrer">æ¨¡å—è”é‚¦</a>æ’ä»¶</p>
<p><strong>æ³¨ï¼šå»ºè®®å®‰è£…1.3.6ç‰ˆæœ¬ï¼Œæœ€æ–°ç‰ˆæœ¬æœ‰</strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Foriginjs%2Fvite-plugin-federation%2Fissues%2F665" target="_blank" title="https://github.com/originjs/vite-plugin-federation/issues/665" ref="nofollow noopener noreferrer"><strong>æ ·å¼ä¸¢å¤±çš„é—®é¢˜</strong></a></p>
<pre><code class="hljs language-shell" lang="shell">pnpm install @originjs/vite-plugin-federation@1.3.6 -D
</code></pre>
<p>å®‰è£…å®Œäº‹åï¼Œå¯ä»¥åˆ†åˆ«è¿è¡Œï¼Œçœ‹çœ‹æ•ˆæœ</p>
<p><strong>æ³¨ï¼šè·¯ç”±æ¨¡å¼å»ºè®®ä½¿ç”¨historyæ¨¡å¼ï¼Œ</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fyang5726685%2Fp%2F18501791" target="_blank" title="https://www.cnblogs.com/yang5726685/p/18501791" ref="nofollow noopener noreferrer"><strong>åˆ·æ–°404é—®é¢˜å¯ä»¥é€šè¿‡nginxé…ç½®è§£å†³</strong></a></p>
<pre><code class="hljs language-shell" lang="shell">pnpm dev
</code></pre>
<ul>
<li>ä¸»ç³»ç»Ÿ</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d5ec81efa7e64dc3afa053f769cfe19c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=zEc4facsalYfGQUdESwgcQYpTCw%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç³»ç»Ÿ2</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a56e067f3d3c443b8480e199869332d1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=JtgXJu279Ik0nov%2FnvLUqal8Kks%3D" alt="" loading="lazy"/></p>
<ul>
<li>ç³»ç»Ÿ3</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ab7599442db34e57a26ceeeb69e926b9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=1Ihk4jDRafWKTTFrA67CU6IiUh8%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-9">(ä¸‰) å…·ä½“å®ç°</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/40b25d7411014692bf0c4fa03615dea9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=cuTDuJdEEQAoszsQtft9GDDJCbU%3D" alt="" loading="lazy"/></p>
<p>é¦–å…ˆï¼Œ<strong>å…ˆç¡®å®šåŠŸèƒ½çš„host(åº”ç”¨è€…)è·Ÿremote(æä¾›è€…)ã€‚</strong></p>
<p>æ¯”å¦‚åœ¨ä¸»ç³»ç»Ÿä¸Šå¼€å‘è®¾è®¡ä¸€ä¸ªç³»ç»Ÿèœå•ç»„ä»¶ï¼Œä¾›æ‰€æœ‰ç³»ç»Ÿä½¿ç”¨ï¼Œé‚£ä¹ˆåœ¨è¿™ä¸ªåŠŸèƒ½ä¸Šä¸»ç³»ç»Ÿå°±æ˜¯remoteï¼Œå…¶ä»–ç³»ç»Ÿéƒ½æ˜¯hostã€‚</p>
<ul>
<li>å°†ç³»ç»Ÿèœå•ç»„ä»¶æš´éœ²å‡ºå»ï¼š</li>
</ul>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// main-system ä¸­ vite.config.ts</span>
<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">"@originjs/vite-plugin-federation"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(({ mode }: <span class="hljs-title class_">ConfigEnv</span>): <span class="hljs-function"><span class="hljs-params">UserConfig</span> =&gt;</span> {
  ...
  <span class="hljs-keyword">return</span> {
    ...
      pluginsï¼š[
        ...,
        <span class="hljs-title function_">federation</span>({
          <span class="hljs-attr">name</span>: <span class="hljs-string">"remote_main"</span>, <span class="hljs-comment">// è¿œç¨‹æ¨¡å—</span>
          <span class="hljs-attr">filename</span>: <span class="hljs-string">"remoteEntry.js"</span>, <span class="hljs-comment">// è¿œç¨‹èµ„æºè·¯å¾„</span>
          <span class="hljs-attr">exposes</span>: { <span class="hljs-comment">// æš´éœ²çš„ç»„ä»¶</span>
            <span class="hljs-string">"./SysNavComp"</span>: <span class="hljs-string">"./src/remote/components/SysNav/index.vue"</span>
          },
          <span class="hljs-attr">shared</span>: [<span class="hljs-string">"vue"</span>, <span class="hljs-string">"vue-router"</span>, <span class="hljs-string">"pinia"</span>] <span class="hljs-comment">// å…±äº«çš„ä¾èµ–</span>
        }),
      ]
}
</code></pre>
<ul>
<li>å…¶ä»–ç³»ç»Ÿéœ€è¦è·Ÿè¿™ä¸ªèµ„æºåŒ…å»ºç«‹è¿œç¨‹è¿æ¥</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ç³»ç»Ÿ2ã€3 çš„vite.config.ts</span>
<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">"@originjs/vite-plugin-federation"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(({ mode }: <span class="hljs-title class_">ConfigEnv</span>): <span class="hljs-function"><span class="hljs-params">UserConfig</span> =&gt;</span> {
  ...
  <span class="hljs-keyword">return</span> {
    ...
      pluginsï¼š[
        ...,
        <span class="hljs-title function_">federation</span>({
          <span class="hljs-attr">remotes</span>: { <span class="hljs-comment">// è¿œç¨‹æ¨¡å—è·Ÿåœ°å€</span>
            <span class="hljs-attr">remote_main</span>: <span class="hljs-string">"ä¸»ç³»ç»ŸæœåŠ¡åœ°å€/remoteEntry.js"</span>
          },
          <span class="hljs-attr">shared</span>: [<span class="hljs-string">"vue"</span>, <span class="hljs-string">"vue-router"</span>, <span class="hljs-string">"pinia"</span>] <span class="hljs-comment">// å…±äº«çš„ä¾èµ–</span>
        }),
      ]
}
</code></pre>
<ul>
<li>å®Œäº‹åå°±å¯ä»¥åœ¨é¡µé¢ä¸­å¼•å…¥</li>
</ul>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">el-config-provider</span> <span class="hljs-attr">:locale</span>=<span class="hljs-string">"locale"</span> <span class="hljs-attr">:size</span>=<span class="hljs-string">"assemblySize"</span> <span class="hljs-attr">:button</span>=<span class="hljs-string">"buttonConfig"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">SysNavComp</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">router-view</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">router-view</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">el-config-provider</span>&gt;</span></span>
&lt;/template&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
  ...
<span class="hljs-keyword">const</span> <span class="hljs-title class_">SysNavComp</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"remote_main/SysNavComp"</span>));
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>å¤§è‡´æ•ˆæœå¦‚ä¸‹ï¼Œå®ç°å„ä¸ªç³»ç»Ÿæ—¢èƒ½ç‹¬ç«‹è¿è¡Œåˆèƒ½è‡ªç”±åˆ‡æ¢ï¼š<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/681dc25187494217ae9fa129dfd05bc5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=X5IHIIKz0qlBHr2MKkDGIDYUgEY%3D" alt="" loading="lazy"/></p>
<h3 data-id="heading-10">(å››) åŠŸèƒ½æ‹“å±•</h3>
<ul>
<li><strong>ä¸»ç³»ç»Ÿé™¤äº†èƒ½å°†åŠŸèƒ½æš´éœ²å‡ºå»ä¾›å…¶ä»–ç³»ç»Ÿä½¿ç”¨å¤–ï¼Œå…¶ä»–ç³»ç»Ÿä¹Ÿèƒ½æä¾›ç»„ä»¶ã€é¡µé¢æˆ–è€…æ–¹æ³•ä¾›ä¸»ç³»ç»Ÿä½¿ç”¨ã€‚</strong></li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// å­ç³»ç»Ÿ vite.config,ts</span>
<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">"@originjs/vite-plugin-federation"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(({ mode }: <span class="hljs-title class_">ConfigEnv</span>): <span class="hljs-function"><span class="hljs-params">UserConfig</span> =&gt;</span> {
  ...
  <span class="hljs-keyword">return</span> {
    ...
      pluginsï¼š[
        ...,
        <span class="hljs-title function_">federation</span>({
          <span class="hljs-attr">remotes</span>: { <span class="hljs-comment">// è¿œç¨‹æ¨¡å—è·Ÿåœ°å€</span>
            <span class="hljs-attr">remote_main</span>: <span class="hljs-string">"ä¸»ç³»ç»ŸæœåŠ¡åœ°å€/assets/remoteEntry.js"</span>
          },
          <span class="hljs-attr">exposes</span>: {
            <span class="hljs-string">"./HomePage"</span>: <span class="hljs-string">"./src/views/home/index.vue"</span>,
            <span class="hljs-string">"./UseProTablePage"</span>: <span class="hljs-string">"./src/views/proTable/useProTable/index.vue"</span>
          },
          <span class="hljs-attr">shared</span>: [<span class="hljs-string">"vue"</span>, <span class="hljs-string">"vue-router"</span>, <span class="hljs-string">"pinia"</span>] <span class="hljs-comment">// å…±äº«çš„ä¾èµ–</span>
        }),
      ]
}
</code></pre>
<p>åœ¨ä¸»ç³»ç»Ÿä¸­åº”ç”¨</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸»ç³»ç»Ÿ vite.config.ts</span>
<span class="hljs-keyword">import</span> federation <span class="hljs-keyword">from</span> <span class="hljs-string">"@originjs/vite-plugin-federation"</span>;
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(({ mode }: <span class="hljs-title class_">ConfigEnv</span>): <span class="hljs-function"><span class="hljs-params">UserConfig</span> =&gt;</span> {
  ...
  <span class="hljs-keyword">return</span> {
    ...
      pluginsï¼š[
        ...,
        <span class="hljs-title function_">federation</span>({
          <span class="hljs-attr">name</span>: <span class="hljs-string">"remote_main"</span>, <span class="hljs-comment">// è¿œç¨‹æ¨¡å—</span>
          <span class="hljs-attr">filename</span>: <span class="hljs-string">"remoteEntry.js"</span>, <span class="hljs-comment">// è¿œç¨‹èµ„æºè·¯å¾„</span>
          <span class="hljs-attr">exposes</span>: { <span class="hljs-comment">// æš´éœ²çš„ç»„ä»¶</span>
            <span class="hljs-string">"./SysNavComp"</span>: <span class="hljs-string">"./src/remote/components/SysNav/index.vue"</span>
          },
          <span class="hljs-attr">remotes</span>: {
            <span class="hljs-attr">remote_main1</span>: <span class="hljs-string">"ç³»ç»Ÿ2æœåŠ¡åœ°å€/remoteEntry.js"</span>,
          },
          <span class="hljs-attr">shared</span>: [<span class="hljs-string">"vue"</span>, <span class="hljs-string">"vue-router"</span>, <span class="hljs-string">"pinia"</span>] <span class="hljs-comment">// å…±äº«çš„ä¾èµ–</span>
        }),
      ]
}
</code></pre>
<pre><code class="hljs language-js" lang="js">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"home card"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">HomePageComp</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>hello world<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">HomePageComp</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">UseProTablePageComp</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"home"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { defineAsyncComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;
<span class="hljs-keyword">const</span> <span class="hljs-title class_">HomePageComp</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"remote_main1/HomePage"</span>));
<span class="hljs-keyword">const</span> <span class="hljs-title class_">UseProTablePageComp</span> = <span class="hljs-title function_">defineAsyncComponent</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"remote_main1/UseProTablePage"</span>));
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span>&gt;</span><span class="css">
<span class="hljs-keyword">@import</span> <span class="hljs-string">"./index"</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></span>
</code></pre>
<p>å¤§è‡´æ•ˆæœ</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/22845beb0f724665ad797b4b980b466f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=ATL1%2BsgfUAj5fc910Zez%2BMQh2r8%3D" alt="" loading="lazy"/></p>
<ul>
<li>åç»­å¯ä»¥å°†ä¸€äº›å…¬å…±çš„jsä»£ç æŠ½ç¦»å‡ºæ¥åšæˆæ’ä»¶åŒ…ï¼Œä¾›å„ä¸ªç³»ç»Ÿä½¿ç”¨ã€‚</li>
</ul>
<h3 data-id="heading-11">(äº”) æµ‹è¯•æ•ˆæœ</h3>
<p>æœ¬åœ°ä½“éªŒåœ°å€ï¼š <a href="https://link.juejin.cn?target=http%3A%2F%2F192.168.120.178%3A8882%2F%23%2Fhome" target="_blank" title="http://192.168.120.178:8882/#/home" ref="nofollow noopener noreferrer">http://192.168.120.178:8882/home</a>ã€‚</p>
<h2 data-id="heading-12">å››ã€æ•°æ®å…±äº«</h2>
<ul>
<li>æœ¬åœ°ç¼“å­˜</li>
<li>è·¨çª—å£é€šè®¯</li>
<li>......</li>
</ul>
<p><strong>ï¼ï¼ï¼å‰ææ¡ä»¶å¾—ç¬¦åˆæµè§ˆå™¨çš„åŒæºåè®®ã€‚</strong></p>
<hr/>
<h2 data-id="heading-13">äº”ã€æ‰“åŒ…éƒ¨ç½²</h2>
<p>å°†å„ä¸ªç³»ç»Ÿåˆ†åˆ«è¿›è¡Œæ‰“åŒ…</p>
<pre><code class="hljs language-shell" lang="shell">pnpm build:pro
</code></pre>
<p>é™¤äº†ä¸»é¡¹ç›®ï¼Œå…¶ä»–å­é¡¹ç›®æ‰“åŒ…åçš„bundleæ–‡ä»¶å¤¹åå¯ä»¥çº¦å®šä»¥ 'sys+æ•°å­—' çš„å½¢å¼åŒºåˆ†ã€‚</p>
<p>æ‰“åŒ…å¹¶æ•´åˆå®Œåçš„bundleç»“æ„ï¼Œå¤–å±‚æ˜¯ä¸»ç³»ç»Ÿï¼Œsys2æ˜¯ç³»ç»Ÿ2ï¼Œsys3æ˜¯ç³»ç»Ÿ3</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1cef8f4b8bb543d69607c9db2246f17c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAga2V2aW56enp6eno=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765351454&amp;x-signature=jfDpunX34FEWcmJGlXvWxDUZLtI%3D" alt="" loading="lazy"/></p>
<p>è¿™é‡Œç”¨çš„nginxæœ¬åœ°éƒ¨ç½²</p>
<pre><code class="hljs language-nginx" lang="nginx">#nginx.conf
#user  nobody;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       mime.types;
    default_type  application/octet-stream;

  # æ—¥å¿—æ ¼å¼é…ç½®
  log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';


    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0; 
    keepalive_timeout  65;

    #gzip  on;
    gzip on;
    gzip_comp_level 6;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;


    server {
        #é…ç½®nginxå¯åŠ¨çš„ç«¯å£ï¼ŒæœåŠ¡å™¨åå­—ï¼ˆæœ¬åœ°localhostï¼‰
        listen       8882; 
        server_name  192.168.120.178;
        add_header Access-Control-Allow-Origin *;
        add_header Access-Control-Allow-Headers X-Requested-With;
        add_header Access-Control-Allow-Methods GET,POST,OPTIONS;

        root  html;
        index  index.html index.htm;
        #charset koi8-r;

        # upstream backend_server {
        #     server mock.mengxuegu.com/mock;
        # }
        # access_log  logs/host.access.log  main;

        location /api/ {
            # rewrite ^/api/(.*) /v1/$1 break;
            proxy_pass https://mock.mengxuegu.com/mock/629d727e6163854a32e8307e/;
            proxy_set_header Host $http_host; #åå°å¯ä»¥è·å–åˆ°å®Œæ•´çš„ip+ç«¯å£å·
            proxy_set_header X-Real-IP $remote_addr; #åå°å¯ä»¥è·å–åˆ°ç”¨æˆ·è®¿é—®çš„çœŸå®ipåœ°å€
        }
        #é…ç½®å¯åŠ¨nginxåæ‰“å¼€çš„é™æ€æ–‡ä»¶htmlé¡µé¢
        #é™æ€æ–‡ä»¶ä¸€èˆ¬æ˜¯å‰ç«¯é¡¹ç›®æ‰“åŒ…ä¹‹åçš„distæ–‡ä»¶ï¼ˆè¯¥æ–‡ä»¶ä¸‹çš„htmlæ–‡ä»¶ä¸ºå¯åŠ¨é¡µé¢ï¼‰
        location / {
            # root  html;
            # index  index.html index.htm;
            add_header 'Access-Control-Allow-Origin' '*';
            add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS, PUT, DELETE';
            add_header 'Access-Control-Allow-Headers' 'Content-Type, Authorization';
            add_header 'Access-Control-Allow-Credentials' 'true';
            error_page 404 = @purge_cache;
            try_files $uri $uri/ /index.html;
        }

        location /sys2/ {
            root  html;
            index  /sys2/index.html index.htm;
            proxy_set_header Host $http_host; #åå°å¯ä»¥è·å–åˆ°å®Œæ•´çš„ip+ç«¯å£å·
            proxy_set_header X-Real-IP $remote_addr; #åå°å¯ä»¥è·å–åˆ°ç”¨æˆ·è®¿é—®çš„çœŸå®ipåœ°å€
            error_page 404 = @purge_cache;
            try_files $uri $uri/ /sys2/index.html;
        }
        location /sys3/ {
            root  html;
            index  /sys3/index.html index.htm;
            proxy_set_header Host $http_host; #åå°å¯ä»¥è·å–åˆ°å®Œæ•´çš„ip+ç«¯å£å·
            proxy_set_header X-Real-IP $remote_addr; #åå°å¯ä»¥è·å–åˆ°ç”¨æˆ·è®¿é—®çš„çœŸå®ipåœ°å€
            error_page 404 = @purge_cache;
            try_files $uri $uri/ /sys3/index.html;
        }
        

        location = /favicon.ico {
            log_not_found off;
        }

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }
}

</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å½»åº•å¼„æ‡‚KeepAlive]]></title>    <link>https://juejin.cn/post/7579186764047335465</link>    <guid>https://juejin.cn/post/7579186764047335465</guid>    <pubDate>2025-12-03T07:42:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764047335465" data-draft-id="7578391787980931113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½»åº•å¼„æ‡‚KeepAlive"/> <meta itemprop="keywords" content="Vue.js,é¢è¯•,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T07:42:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å­£ç¤¼ç¥¥"/> <meta itemprop="url" content="https://juejin.cn/user/581008310927918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½»åº•å¼„æ‡‚KeepAlive
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/581008310927918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å­£ç¤¼ç¥¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:42:50.000Z" title="Wed Dec 03 2025 07:42:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å¼€å‘è¿‡Vueåº”ç”¨çš„åŒå­¦å¯¹<code>KeepAlive</code>åŠŸèƒ½åº”è¯¥éƒ½ä¸é™Œç”Ÿäº†ï¼Œä½†æ˜¯å¤§å®¶å¯¹å®ƒçš„ç†è§£æ˜¯åªåœç•™åœ¨çŸ¥é“æ€ä¹ˆç”¨çš„é˜¶æ®µ
è¿˜æ˜¯è¯´æ¸…æ™°çš„çŸ¥é“å®ƒå†…éƒ¨çš„å®ç°ç»†èŠ‚å‘¢ï¼Œåœ¨é¡¹ç›®ä¸­å› <code>KeepAlive</code>å¯¼è‡´çš„çš„Bugèƒ½ç¬¬ä¸€æ—¶é—´åˆ†æå‡ºæ¥åŸå› å¹¶ä¸”æ‰¾åˆ°è§£å†³æ–¹æ³•å‘¢ã€‚è¿™ç¯‡æ–‡ç« çš„ç›®çš„å°±æ˜¯æƒ³ç»“åˆVueæ¸²æŸ“çš„æ ¸å¿ƒç»†èŠ‚æ¥é‡æ–°è®¤è¯†ä¸€ä¸‹<code>KeepAlive</code>è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>æ–‡ç« æ˜¯åŸºäº<strong>Vue3.5.24</strong>ç‰ˆæœ¬åšçš„åˆ†æ</p>
<p>æ¥ä¸‹æ¥æˆ‘å°†é€šè¿‡å¯¹å‡ ä¸ªé—®é¢˜çš„è§£é‡Šï¼Œæ¥æ…¢æ…¢æ¢³ç†<code>KeepAlive</code>çš„ç»†èŠ‚ã€‚</p>
<h2 data-id="heading-1">å¸¦ç€é—®é¢˜å¼„æ‡‚KeepAlive</h2>
<h3 data-id="heading-2">1.ç¼–å†™çš„Vueæ–‡ä»¶åœ¨æµè§ˆå™¨è¿è¡Œæ—¶æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ</h3>
<p>çœ‹ä¸€ä¸ªä¸‹é¢çš„ç®€å•ä¾‹å­</p>
<pre><code class="hljs language-typescript" lang="typescript">&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>æˆ‘ä»¬å†™çš„è¿™ä¹ˆç®€å•çš„ä¸€æ®µä»£ç ï¼Œåœ¨è¿è¡Œå‰ä¼šè¢«ç¼–è¯‘æˆä¸‹é¢è¿™ä¸ªæ ·å­ï¼Œä¼ é€é—¨<a href="https://link.juejin.cn?target=https%3A%2F%2Fplay.vuejs.org" target="_blank" title="https://play.vuejs.org" ref="nofollow noopener noreferrer">Vue SFC Playground</a></p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineComponent <span class="hljs-keyword">as</span> _defineComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>


<span class="hljs-keyword">const</span> __sfc__ = <span class="hljs-comment">/*@__PURE__*/</span><span class="hljs-title function_">_defineComponent</span>({
  <span class="hljs-attr">__name</span>: <span class="hljs-string">'App'</span>,
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">__props, { expose: __expose }</span>) {
  <span class="hljs-title function_">__expose</span>();

<span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

<span class="hljs-keyword">const</span> __returned__ = { count }
<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(__returned__, <span class="hljs-string">'__isScriptSetup'</span>, { <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">value</span>: <span class="hljs-literal">true</span> })
<span class="hljs-keyword">return</span> __returned__
}

});
<span class="hljs-keyword">import</span> { toDisplayString <span class="hljs-keyword">as</span> _toDisplayString, openBlock <span class="hljs-keyword">as</span> _openBlock, createElementBlock <span class="hljs-keyword">as</span> _createElementBlock } <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">_ctx, _cache, $props, $setup, $data, $options</span>) {
  <span class="hljs-keyword">return</span> (<span class="hljs-title function_">_openBlock</span>(), <span class="hljs-title function_">_createElementBlock</span>(<span class="hljs-string">"div"</span>, <span class="hljs-literal">null</span>, <span class="hljs-title function_">_toDisplayString</span>($setup.<span class="hljs-property">count</span>), <span class="hljs-number">1</span> <span class="hljs-comment">/* TEXT */</span>))
}
__sfc__.<span class="hljs-property">render</span> = render
__sfc__.<span class="hljs-property">__file</span> = <span class="hljs-string">"src/App.vue"</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> __sfc__
</code></pre>
<p>é€šè¿‡ç»“æœå¯ä»¥çœ‹åˆ°ï¼ŒVueæ–‡ä»¶ä¸­çš„å†…å®¹ç¼–è¯‘åå˜æˆäº†ä¸€ä¸ªæ™®é€šçš„JSå¯¹è±¡ã€‚<br/>
å…¶ä¸­ä¸»è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå±æ€§<br/>
_name: ç»„ä»¶çš„åç§°ï¼Œæœªæ˜ç¡®å®šä¹‰ç»„ä»¶åç§°çš„æƒ…å†µä¼šä½¿ç”¨æ–‡ä»¶çš„åç§°ä½œä¸ºç»„ä»¶çš„åç§°ã€‚<br/>
setup: ç»„ä»¶ä¸­å®šä¹‰çš„setupå‡½æ•°,é»˜è®¤è¿”å›äº†å®šä¹‰çš„å“åº”å¼æ•°æ®ã€‚<br/>
render: æ¸²æŸ“å‡½æ•°ï¼Œé€šè¿‡å°†templateæ¨¡æ¿ç¼–è¯‘è€Œæ¥ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªVNodeã€‚<br/>
_file: ç»„ä»¶çš„æºæ–‡ä»¶åç§°ã€‚</p>
<h3 data-id="heading-3">2.ç»„ä»¶éœ€è¦æ»¡è¶³ä»€ä¹ˆæ¡ä»¶æ‰ä¼šè¢«ç¼“å­˜ï¼Œç¼“å­˜çš„æ˜¯ä»€ä¹ˆ?</h3>
<p>æƒ³è¦å›ç­”å¥½è¿™ä¸ªé—®é¢˜ï¼Œå°±éœ€è¦ç»“åˆ<code>KeepAlive</code>ç»„ä»¶çš„æºç ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">KeepAliveImpl</span>: <span class="hljs-title class_">ComponentOptions</span> = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">`KeepAlive`</span>,

  <span class="hljs-attr">__isKeepAlive</span>: <span class="hljs-literal">true</span>,

  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">include</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">RegExp</span>, <span class="hljs-title class_">Array</span>],
    <span class="hljs-attr">exclude</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">RegExp</span>, <span class="hljs-title class_">Array</span>],
    <span class="hljs-attr">max</span>: [<span class="hljs-title class_">String</span>, <span class="hljs-title class_">Number</span>],
  },

  <span class="hljs-title function_">setup</span>(<span class="hljs-params">props: KeepAliveProps, { slots }: SetupContext</span>) {
    <span class="hljs-keyword">const</span> instance = <span class="hljs-title function_">getCurrentInstance</span>()!
 
    <span class="hljs-keyword">const</span> sharedContext = instance.<span class="hljs-property">ctx</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">KeepAliveContext</span>

    <span class="hljs-keyword">if</span> (__SSR__ &amp;&amp; !sharedContext.<span class="hljs-property">renderer</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> children = slots.<span class="hljs-property">default</span> &amp;&amp; slots.<span class="hljs-title function_">default</span>()
        <span class="hljs-keyword">return</span> children &amp;&amp; children.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> ? children[<span class="hljs-number">0</span>] : children
      }
    }

    <span class="hljs-comment">// key -&gt; vNode  Mapç»“æ„</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">cache</span>: <span class="hljs-title class_">Cache</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-comment">// æ‰€æœ‰ç¼“å­˜çš„Keyï¼Œä¿è¯å½“ç¼“å­˜æ•°é‡è¶…è¿‡maxæŒ‡å®šçš„å€¼åï¼Œå‡†ç¡®çš„ç§»é™¤æœ€æ—©ç¼“å­˜çš„å®ä¾‹</span>
    <span class="hljs-keyword">const</span> <span class="hljs-attr">keys</span>: <span class="hljs-title class_">Keys</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>()
    <span class="hljs-comment">// å½“å‰æ¸²æŸ“çš„vNode</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">current</span>: <span class="hljs-title class_">VNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>

    <span class="hljs-keyword">if</span> (__DEV__ || __FEATURE_PROD_DEVTOOLS__) {
      ;(instance <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">__v_cache</span> = cache
    }

    <span class="hljs-keyword">const</span> parentSuspense = instance.<span class="hljs-property">suspense</span>

    <span class="hljs-keyword">const</span> {
      <span class="hljs-attr">renderer</span>: {
        <span class="hljs-attr">p</span>: patch,
        <span class="hljs-attr">m</span>: move,
        <span class="hljs-attr">um</span>: _unmount,
        <span class="hljs-attr">o</span>: { createElement },
      },
    } = sharedContext
    <span class="hljs-keyword">const</span> storageContainer = <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)

    sharedContext.<span class="hljs-property">activate</span> = <span class="hljs-function">(<span class="hljs-params">
      vnode,
      container,
      anchor,
      <span class="hljs-keyword">namespace</span>,
      optimized,
    </span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> instance = vnode.<span class="hljs-property">component</span>!
      <span class="hljs-title function_">move</span>(vnode, container, anchor, <span class="hljs-title class_">MoveType</span>.<span class="hljs-property">ENTER</span>, parentSuspense)
      <span class="hljs-comment">// in case props have changed</span>
      <span class="hljs-title function_">patch</span>(
        instance.<span class="hljs-property">vnode</span>,
        vnode,
        container,
        anchor,
        instance,
        parentSuspense,
        <span class="hljs-keyword">namespace</span>,
        vnode.slotScopeIds,
        optimized,
      )
      queuePostRenderEffect(() =&gt; {
        instance.<span class="hljs-property">isDeactivated</span> = <span class="hljs-literal">false</span>
        <span class="hljs-keyword">if</span> (instance.<span class="hljs-property">a</span>) {
          <span class="hljs-title function_">invokeArrayFns</span>(instance.<span class="hljs-property">a</span>)
        }
        <span class="hljs-keyword">const</span> vnodeHook = vnode.<span class="hljs-property">props</span> &amp;&amp; vnode.<span class="hljs-property">props</span>.<span class="hljs-property">onVnodeMounted</span>
        <span class="hljs-keyword">if</span> (vnodeHook) {
          <span class="hljs-title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="hljs-property">parent</span>, vnode)
        }
      }, parentSuspense)

      <span class="hljs-keyword">if</span> (__DEV__ || __FEATURE_PROD_DEVTOOLS__) {
        <span class="hljs-comment">// Update components tree</span>
        <span class="hljs-title function_">devtoolsComponentAdded</span>(instance)
      }
    }

    sharedContext.<span class="hljs-property">deactivate</span> = <span class="hljs-function">(<span class="hljs-params">vnode: VNode</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> instance = vnode.<span class="hljs-property">component</span>!
      <span class="hljs-title function_">invalidateMount</span>(instance.<span class="hljs-property">m</span>)
      <span class="hljs-title function_">invalidateMount</span>(instance.<span class="hljs-property">a</span>)

      <span class="hljs-title function_">move</span>(vnode, storageContainer, <span class="hljs-literal">null</span>, <span class="hljs-title class_">MoveType</span>.<span class="hljs-property">LEAVE</span>, parentSuspense)
      <span class="hljs-title function_">queuePostRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (instance.<span class="hljs-property">da</span>) {
          <span class="hljs-title function_">invokeArrayFns</span>(instance.<span class="hljs-property">da</span>)
        }
        <span class="hljs-keyword">const</span> vnodeHook = vnode.<span class="hljs-property">props</span> &amp;&amp; vnode.<span class="hljs-property">props</span>.<span class="hljs-property">onVnodeUnmounted</span>
        <span class="hljs-keyword">if</span> (vnodeHook) {
          <span class="hljs-title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="hljs-property">parent</span>, vnode)
        }
        instance.<span class="hljs-property">isDeactivated</span> = <span class="hljs-literal">true</span>
      }, parentSuspense)

      <span class="hljs-keyword">if</span> (__DEV__ || __FEATURE_PROD_DEVTOOLS__) {
        <span class="hljs-comment">// Update components tree</span>
        <span class="hljs-title function_">devtoolsComponentAdded</span>(instance)
      }

      <span class="hljs-comment">// for e2e test</span>
      <span class="hljs-keyword">if</span> (__DEV__ &amp;&amp; __BROWSER__) {
        ;(instance <span class="hljs-keyword">as</span> <span class="hljs-built_in">any</span>).<span class="hljs-property">__keepAliveStorageContainer</span> = storageContainer
      }
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">unmount</span>(<span class="hljs-params">vnode: VNode</span>) {
      <span class="hljs-comment">// reset the shapeFlag so it can be properly unmounted</span>
      <span class="hljs-title function_">resetShapeFlag</span>(vnode)
      <span class="hljs-title function_">_unmount</span>(vnode, instance, parentSuspense, <span class="hljs-literal">true</span>)
    }

    <span class="hljs-keyword">function</span> <span class="hljs-title function_">pruneCache</span>(<span class="hljs-params">filter: (name: <span class="hljs-built_in">string</span>) =&gt; <span class="hljs-built_in">boolean</span></span>) {
      cache.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">vnode, key</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">getComponentName</span>(vnode.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ConcreteComponent</span>)
        <span class="hljs-keyword">if</span> (name &amp;&amp; !<span class="hljs-title function_">filter</span>(name)) {
          <span class="hljs-title function_">pruneCacheEntry</span>(key)
        }
      })
    }

    <span class="hljs-comment">// æ ¹æ®keyç§»é™¤ç¼“å­˜çš„å®ä¾‹</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">pruneCacheEntry</span>(<span class="hljs-params">key: CacheKey</span>) {
      <span class="hljs-keyword">const</span> cached = cache.<span class="hljs-title function_">get</span>(key) <span class="hljs-keyword">as</span> <span class="hljs-title class_">VNode</span>
      <span class="hljs-keyword">if</span> (cached &amp;&amp; (!current || !<span class="hljs-title function_">isSameVNodeType</span>(cached, current))) {
        <span class="hljs-title function_">unmount</span>(cached)
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (current) {
        <span class="hljs-title function_">resetShapeFlag</span>(current)
      }
      cache.<span class="hljs-title function_">delete</span>(key)
      keys.<span class="hljs-title function_">delete</span>(key)
    }

    <span class="hljs-comment">// prune cache on include/exclude prop change</span>
    <span class="hljs-title function_">watch</span>(
      <span class="hljs-function">() =&gt;</span> [props.<span class="hljs-property">include</span>, props.<span class="hljs-property">exclude</span>],
      <span class="hljs-function">(<span class="hljs-params">[include, exclude]</span>) =&gt;</span> {
        include &amp;&amp; <span class="hljs-title function_">pruneCache</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> <span class="hljs-title function_">matches</span>(include, name))
        exclude &amp;&amp; <span class="hljs-title function_">pruneCache</span>(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> !<span class="hljs-title function_">matches</span>(exclude, name))
      },
      <span class="hljs-comment">// prune post-render after `current` has been updated</span>
      { <span class="hljs-attr">flush</span>: <span class="hljs-string">'post'</span>, <span class="hljs-attr">deep</span>: <span class="hljs-literal">true</span> },
    )

    <span class="hljs-comment">// æ¸²æŸ“ç»“æŸå ç¼“å­˜å½“å‰å®ä¾‹</span>
    <span class="hljs-keyword">let</span> <span class="hljs-attr">pendingCacheKey</span>: <span class="hljs-title class_">CacheKey</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">cacheSubtree</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-keyword">if</span> (pendingCacheKey != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isSuspense</span>(instance.<span class="hljs-property">subTree</span>.<span class="hljs-property">type</span>)) {
          <span class="hljs-title function_">queuePostRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
            cache.<span class="hljs-title function_">set</span>(pendingCacheKey!, <span class="hljs-title function_">getInnerChild</span>(instance.<span class="hljs-property">subTree</span>))
          }, instance.<span class="hljs-property">subTree</span>.<span class="hljs-property">suspense</span>)
        } <span class="hljs-keyword">else</span> {
          cache.<span class="hljs-title function_">set</span>(pendingCacheKey, <span class="hljs-title function_">getInnerChild</span>(instance.<span class="hljs-property">subTree</span>))
        }
      }
    }
    
    <span class="hljs-comment">// åœ¨è¿™Mountedå’ŒUpdatedé’©å­é‡Œé¢ ç¼“å­˜å½“å‰æ¸²æŸ“çš„å®ä¾‹</span>
    <span class="hljs-title function_">onMounted</span>(cacheSubtree)
    <span class="hljs-title function_">onUpdated</span>(cacheSubtree)

    <span class="hljs-title function_">onBeforeUnmount</span>(<span class="hljs-function">() =&gt;</span> {
      cache.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">cached</span> =&gt;</span> {
        <span class="hljs-keyword">const</span> { subTree, suspense } = instance
        <span class="hljs-keyword">const</span> vnode = <span class="hljs-title function_">getInnerChild</span>(subTree)
        <span class="hljs-keyword">if</span> (cached.<span class="hljs-property">type</span> === vnode.<span class="hljs-property">type</span> &amp;&amp; cached.<span class="hljs-property">key</span> === vnode.<span class="hljs-property">key</span>) {
          <span class="hljs-title function_">resetShapeFlag</span>(vnode)
          <span class="hljs-keyword">const</span> da = vnode.<span class="hljs-property">component</span>!.<span class="hljs-property">da</span>
          da &amp;&amp; <span class="hljs-title function_">queuePostRenderEffect</span>(da, suspense)
          <span class="hljs-keyword">return</span>
        }
        <span class="hljs-title function_">unmount</span>(cached)
      })
    })

    <span class="hljs-comment">// setupè¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šè¢«ç›´æ¥å½“åšç»„ä»¶çš„æ¸²æŸ“å‡½æ•°</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      pendingCacheKey = <span class="hljs-literal">null</span>

      <span class="hljs-keyword">if</span> (!slots.<span class="hljs-property">default</span>) {
        <span class="hljs-comment">// æ— å­èŠ‚ç‚¹</span>
        <span class="hljs-keyword">return</span> (current = <span class="hljs-literal">null</span>)
      }

      <span class="hljs-keyword">const</span> children = slots.<span class="hljs-title function_">default</span>()
      <span class="hljs-keyword">const</span> rawVNode = children[<span class="hljs-number">0</span>]
      <span class="hljs-keyword">if</span> (children.<span class="hljs-property">length</span> &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-comment">// åªèƒ½æœ‰ä¸€ä¸ªå­èŠ‚ç‚¹</span>
        <span class="hljs-keyword">if</span> (__DEV__) {
          <span class="hljs-title function_">warn</span>(<span class="hljs-string">`KeepAlive should contain exactly one component child.`</span>)
        }
        current = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">return</span> children
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (
        !<span class="hljs-title function_">isVNode</span>(rawVNode) ||
        (!(rawVNode.<span class="hljs-property">shapeFlag</span> &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">STATEFUL_COMPONENT</span>) &amp;&amp;
          !(rawVNode.<span class="hljs-property">shapeFlag</span> &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">SUSPENSE</span>))
      ) {
        <span class="hljs-comment">// å­èŠ‚ç‚¹å¿…é¡»æ˜¯ä¸€ä¸ªç»„ä»¶</span>
        current = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">return</span> rawVNode
      }

      <span class="hljs-keyword">let</span> vnode = <span class="hljs-title function_">getInnerChild</span>(rawVNode)
     
      <span class="hljs-keyword">if</span> (vnode.<span class="hljs-property">type</span> === <span class="hljs-title class_">Comment</span>) {
        current = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">return</span> vnode
      }

      <span class="hljs-keyword">const</span> comp = vnode.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ConcreteComponent</span>

      <span class="hljs-comment">// è·å¾—ç»„ä»¶çš„åç§°</span>
      <span class="hljs-keyword">const</span> name = <span class="hljs-title function_">getComponentName</span>(
        <span class="hljs-title function_">isAsyncWrapper</span>(vnode)
          ? (vnode.<span class="hljs-property">type</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ComponentOptions</span>).<span class="hljs-property">__asyncResolved</span> || {}
          : comp,
      )

      <span class="hljs-keyword">const</span> { include, exclude, max } = props
     
      <span class="hljs-comment">// æ ¹æ®includeå’Œexclude åˆ¤æ–­å½“å‰çš„ç»„ä»¶æ˜¯å¦éœ€è¦ç¼“å­˜</span>
      <span class="hljs-keyword">if</span> (
        (include &amp;&amp; (!name || !<span class="hljs-title function_">matches</span>(include, name))) ||
        (exclude &amp;&amp; name &amp;&amp; <span class="hljs-title function_">matches</span>(exclude, name))
      ) {
        <span class="hljs-comment">// #11717</span>
        vnode.<span class="hljs-property">shapeFlag</span> &amp;= ~<span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT_SHOULD_KEEP_ALIVE</span>
        current = vnode
        <span class="hljs-keyword">return</span> rawVNode
      }
      
      <span class="hljs-comment">// ç»„ä»¶çš„key</span>
      <span class="hljs-keyword">const</span> key = vnode.<span class="hljs-property">key</span> == <span class="hljs-literal">null</span> ? comp : vnode.<span class="hljs-property">key</span>
      <span class="hljs-comment">// æ ¹æ®key è·å¾—å·²ç¼“å­˜çš„VNode</span>
      <span class="hljs-keyword">const</span> cachedVNode = cache.<span class="hljs-title function_">get</span>(key)

      <span class="hljs-comment">// clone vnode if it's reused because we are going to mutate it</span>
      <span class="hljs-keyword">if</span> (vnode.<span class="hljs-property">el</span>) {
        vnode = <span class="hljs-title function_">cloneVNode</span>(vnode)
        <span class="hljs-keyword">if</span> (rawVNode.<span class="hljs-property">shapeFlag</span> &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">SUSPENSE</span>) {
          rawVNode.<span class="hljs-property">ssContent</span> = vnode
        }
      }

      pendingCacheKey = key

      <span class="hljs-keyword">if</span> (cachedVNode) {
        <span class="hljs-comment">// å¦‚æœå®ä¾‹å·²è¢«ç¼“å­˜</span>
        <span class="hljs-comment">// å¤åˆ¶DOMèŠ‚ç‚¹ã€ç»„ä»¶å®ä¾‹</span>
        vnode.<span class="hljs-property">el</span> = cachedVNode.<span class="hljs-property">el</span>
        vnode.<span class="hljs-property">component</span> = cachedVNode.<span class="hljs-property">component</span>
        <span class="hljs-keyword">if</span> (vnode.<span class="hljs-property">transition</span>) {
          <span class="hljs-comment">// recursively update transition hooks on subTree</span>
          <span class="hljs-title function_">setTransitionHooks</span>(vnode, vnode.<span class="hljs-property">transition</span>!)
        }
        <span class="hljs-comment">// æ ‡è®°ç»„ä»¶æ˜¯ä»ç¼“å­˜ä¸­æ¢å¤  é˜²æ­¢ç»„ä»¶è¢«é‡æ–°mounted</span>
        vnode.<span class="hljs-property">shapeFlag</span> |= <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT_KEPT_ALIVE</span>
        <span class="hljs-comment">// æŠŠç¼“å­˜çš„keyç§»åŠ¨åˆ°é˜Ÿå°¾</span>
        keys.<span class="hljs-title function_">delete</span>(key)
        keys.<span class="hljs-title function_">add</span>(key)
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å®ä¾‹æœªè¢«ç¼“å­˜</span>
        keys.<span class="hljs-title function_">add</span>(key)
        <span class="hljs-comment">// å¦‚æœæ¢æˆæ•°é‡è¶…è¿‡maxï¼Œåˆ é™¤æœ€æ—©è¿›å…¥çš„å®ä¾‹</span>
        <span class="hljs-keyword">if</span> (max &amp;&amp; keys.<span class="hljs-property">size</span> &gt; <span class="hljs-built_in">parseInt</span>(max <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, <span class="hljs-number">10</span>)) {
          <span class="hljs-title function_">pruneCacheEntry</span>(keys.<span class="hljs-title function_">values</span>().<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>!)
        }
      }
      <span class="hljs-comment">// æ ‡è®°ç»„ä»¶åº”è¯¥è¢«ç¼“å­˜ é˜²æ­¢ç»„ä»¶è¢«å¸è½½</span>
      vnode.<span class="hljs-property">shapeFlag</span> |= <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT_SHOULD_KEEP_ALIVE</span>
 
      current = vnode
      <span class="hljs-comment">// è¿”å›å­èŠ‚ç‚¹çš„vNode</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">isSuspense</span>(rawVNode.<span class="hljs-property">type</span>) ? rawVNode : vnode
    }
  },
}
</code></pre>
<p>é€šè¿‡æºç çš„åˆ†æï¼Œå¯ä»¥å›ç­”ä¸Šé¢çš„é—®é¢˜äº†
é¦–å…ˆï¼ŒKeepAliveçš„ç”¨æ³•è¦ç¬¦åˆå®ƒçš„è§„èŒƒï¼Œåªèƒ½ç”¨å®ƒåµŒå¥—ç»„ä»¶ï¼Œå¹¶ä¸”åªèƒ½åµŒå¥—ä¸€ä¸ªå­ç»„ä»¶ã€‚
å…¶æ¬¡ï¼Œå¦‚æœè®¾ç½®äº†<code>include</code>å’Œ<code>exclude</code>é™åˆ¶ï¼Œé‚£ä¹ˆç»„ä»¶çš„åç§°å¿…é¡»è¦æ»¡è¶³è¿™äº›é™åˆ¶æ‰ä¼šè¢«ç¼“å­˜,ä¸”å½“å‰KeepAliveç¼“å­˜çš„æ•°é‡æœªè¶…è¿‡<code>max</code>çš„é™åˆ¶ã€‚
KeepAliveçš„æ¸²æŸ“å‡½æ•°æœ€ç»ˆæ¸²æŸ“çš„æ˜¯å®ƒé»˜è®¤æ’æ§½çš„å†…å®¹ï¼Œç¼“å­˜çš„æ˜¯ç»„ä»¶çš„VNodeã€‚</p>
<h3 data-id="heading-4">3.ç»„ä»¶åˆ‡æ¢å¦‚ä½•è§¦å‘æ‰€æœ‰å­ç»„ä»¶æ³¨å†Œçš„onActivatedå’ŒonDeactivatedå‡½æ•°çš„</h3>
<p>æƒ³è¦å›ç­”å¥½è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿéœ€è¦ç»“åˆ<code>onActivated</code>å’Œ<code>onDeactivated</code>å‡½æ•°çš„å®šä¹‰</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">LifecycleHooks</span> {
  <span class="hljs-variable constant_">BEFORE_CREATE</span> = <span class="hljs-string">'bc'</span>,
  <span class="hljs-variable constant_">CREATED</span> = <span class="hljs-string">'c'</span>,
  <span class="hljs-variable constant_">BEFORE_MOUNT</span> = <span class="hljs-string">'bm'</span>,
  <span class="hljs-variable constant_">MOUNTED</span> = <span class="hljs-string">'m'</span>,
  <span class="hljs-variable constant_">BEFORE_UPDATE</span> = <span class="hljs-string">'bu'</span>,
  <span class="hljs-variable constant_">UPDATED</span> = <span class="hljs-string">'u'</span>,
  <span class="hljs-variable constant_">BEFORE_UNMOUNT</span> = <span class="hljs-string">'bum'</span>,
  <span class="hljs-variable constant_">UNMOUNTED</span> = <span class="hljs-string">'um'</span>,
  <span class="hljs-comment">// ç»„ä»¶å®ä¾‹ä¸Šçš„daå±æ€§ï¼Œä»£è¡¨æ˜¯è¯¥ç»„ä»¶æ³¨å†Œçš„Deactivatedå‡½æ•°</span>
  <span class="hljs-variable constant_">DEACTIVATED</span> = <span class="hljs-string">'da'</span>,
  <span class="hljs-comment">// ç»„ä»¶å®ä¾‹ä¸Šçš„aå±æ€§ï¼Œä»£è¡¨æ˜¯è¯¥ç»„ä»¶æ³¨å†Œçš„Activatedå‡½æ•°</span>
  <span class="hljs-variable constant_">ACTIVATED</span> = <span class="hljs-string">'a'</span>,
  <span class="hljs-variable constant_">RENDER_TRIGGERED</span> = <span class="hljs-string">'rtg'</span>,
  <span class="hljs-variable constant_">RENDER_TRACKED</span> = <span class="hljs-string">'rtc'</span>,
  <span class="hljs-variable constant_">ERROR_CAPTURED</span> = <span class="hljs-string">'ec'</span>,
  <span class="hljs-variable constant_">SERVER_PREFETCH</span> = <span class="hljs-string">'sp'</span>,
}

<span class="hljs-comment">// æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè‹¥ç»„ä»¶å®ä¾‹æ˜¯&lt;KeepAlive&gt;ç¼“å­˜æ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå½“ç»„ä»¶è¢«æ’å…¥åˆ° DOM ä¸­æ—¶è°ƒç”¨</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onActivated</span>(<span class="hljs-params">
  hook: <span class="hljs-built_in">Function</span>,
  target?: ComponentInternalInstance | <span class="hljs-literal">null</span>,
</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">registerKeepAliveHook</span>(hook, <span class="hljs-title class_">LifecycleHooks</span>.<span class="hljs-property">ACTIVATED</span>, target)
}

<span class="hljs-comment">// æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè‹¥ç»„ä»¶å®ä¾‹æ˜¯&lt;KeepAlive&gt;ç¼“å­˜æ ‘çš„ä¸€éƒ¨åˆ†ï¼Œå½“ç»„ä»¶ä» DOM ä¸­è¢«ç§»é™¤æ—¶è°ƒç”¨ã€‚</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">onDeactivated</span>(<span class="hljs-params">
  hook: <span class="hljs-built_in">Function</span>,
  target?: ComponentInternalInstance | <span class="hljs-literal">null</span>,
</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-title function_">registerKeepAliveHook</span>(hook, <span class="hljs-title class_">LifecycleHooks</span>.<span class="hljs-property">DEACTIVATED</span>, target)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">registerKeepAliveHook</span>(<span class="hljs-params">
  hook: <span class="hljs-built_in">Function</span> &amp; { __wdc?: <span class="hljs-built_in">Function</span> },
  <span class="hljs-keyword">type</span>: LifecycleHooks,
  target: ComponentInternalInstance | <span class="hljs-literal">null</span> = currentInstance,
</span>) {
   <span class="hljs-string">"__wdc"</span> ä»£è¡¨ <span class="hljs-string">"with deactivation check(å¸¦æœ‰å¤±æ´»æ£€æŸ¥)"</span>.
  <span class="hljs-keyword">const</span> wrappedHook =
    hook.<span class="hljs-property">__wdc</span> ||
    (hook.<span class="hljs-property">__wdc</span> = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-comment">// ä»…å½“ç›®æ ‡å®ä¾‹ä¸åœ¨å¤±æ´»åˆ†æ”¯ä¸­æ—¶ï¼Œæ‰è§¦å‘æŒ‚é’©.</span>
      <span class="hljs-keyword">let</span> <span class="hljs-attr">current</span>: <span class="hljs-title class_">ComponentInternalInstance</span> | <span class="hljs-literal">null</span> = target
      <span class="hljs-keyword">while</span> (current) {
        <span class="hljs-keyword">if</span> (current.<span class="hljs-property">isDeactivated</span>) {
          <span class="hljs-keyword">return</span>
        }
        current = current.<span class="hljs-property">parent</span>
      }
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">hook</span>()
    })
  <span class="hljs-comment">// åœ¨å½“å‰ç»„ä»¶å®ä¾‹ä¸Šæ³¨å†Œè¯¥å›è°ƒå‡½æ•°</span>
  <span class="hljs-title function_">injectHook</span>(<span class="hljs-keyword">type</span>, wrappedHook, target)
  <span class="hljs-comment">// æŠŠå›è°ƒæ³¨å†Œåˆ°KeepAliveæ ¹ç»„ä»¶ä¸Š</span>
  <span class="hljs-comment">// é¿å…äº†åœ¨è°ƒç”¨è¿™äº›é’©å­æ—¶éå†æ•´ä¸ªç»„ä»¶æ ‘çš„éœ€è¦</span>
  <span class="hljs-keyword">if</span> (target) {
    <span class="hljs-keyword">let</span> current = target.<span class="hljs-property">parent</span>
    <span class="hljs-keyword">while</span> (current &amp;&amp; current.<span class="hljs-property">parent</span>) {
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">isKeepAlive</span>(current.<span class="hljs-property">parent</span>.<span class="hljs-property">vnode</span>)) {
        <span class="hljs-title function_">injectToKeepAliveRoot</span>(wrappedHook, <span class="hljs-keyword">type</span>, target, current)
      }
      current = current.<span class="hljs-property">parent</span>
    }
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">injectToKeepAliveRoot</span>(<span class="hljs-params">
  hook: <span class="hljs-built_in">Function</span> &amp; { __weh?: <span class="hljs-built_in">Function</span> },
  <span class="hljs-keyword">type</span>: LifecycleHooks,
  target: ComponentInternalInstance,
  keepAliveRoot: ComponentInternalInstance,
</span>) {
  <span class="hljs-comment">// å°†é’©å­æ³¨å†Œåˆ°KeepAliveæ ¹ç»„ä»¶ä¸Š, æ³¨å†Œåˆ°é˜Ÿå¤´ï¼Œä¼˜å…ˆä¸çˆ¶ç»„ä»¶åŒç±»å‹çš„é’©å­è§¦å‘</span>
  <span class="hljs-keyword">const</span> injected = <span class="hljs-title function_">injectHook</span>(<span class="hljs-keyword">type</span>, hook, keepAliveRoot, <span class="hljs-literal">true</span> <span class="hljs-comment">/* prepend */</span>)
  <span class="hljs-comment">// å½“å‰ç»„ä»¶å¸è½½æ—¶ï¼Œç§»é™¤æ³¨å†Œçš„é’©å­</span>
  <span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">remove</span>(keepAliveRoot[<span class="hljs-keyword">type</span>]!, injected)
  }, target)
}

<span class="hljs-comment">// æ³¨å†Œé’©å­ï¼Œæ‰€æœ‰çš„é’©å­åŒ…æ‹¬onMountedåœ¨å†…çš„é’©å­æœ€ç»ˆéƒ½æ˜¯é€šè¿‡è¿™ä¸ªé’©å­æ³¨å†Œçš„</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">injectHook</span>(<span class="hljs-params">
  <span class="hljs-keyword">type</span>: LifecycleHooks,
  hook: <span class="hljs-built_in">Function</span> &amp; { __weh?: <span class="hljs-built_in">Function</span> },
  target: ComponentInternalInstance | <span class="hljs-literal">null</span> = currentInstance,
  prepend: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>,
</span>): <span class="hljs-title class_">Function</span> | <span class="hljs-literal">undefined</span> {
  <span class="hljs-keyword">if</span> (target) {
    <span class="hljs-keyword">const</span> hooks = target[<span class="hljs-keyword">type</span>] || (target[<span class="hljs-keyword">type</span>] = [])
    <span class="hljs-comment">// â€œ__wehâ€ä»£è¡¨â€œwith error handling(å¸¦æœ‰é”™è¯¯æ£€æŸ¥)â€ã€‚</span>
    <span class="hljs-keyword">const</span> wrappedHook =
      hook.<span class="hljs-property">__weh</span> ||
      (hook.<span class="hljs-property">__weh</span> = <span class="hljs-function">(<span class="hljs-params">...args: <span class="hljs-built_in">unknown</span>[]</span>) =&gt;</span> {
        <span class="hljs-title function_">pauseTracking</span>()
        <span class="hljs-keyword">const</span> reset = <span class="hljs-title function_">setCurrentInstance</span>(target)
        <span class="hljs-keyword">const</span> res = <span class="hljs-title function_">callWithAsyncErrorHandling</span>(hook, target, <span class="hljs-keyword">type</span>, args)
        <span class="hljs-title function_">reset</span>()
        <span class="hljs-title function_">resetTracking</span>()
        <span class="hljs-keyword">return</span> res
      })
    <span class="hljs-keyword">if</span> (prepend) {
      <span class="hljs-comment">// æ’å…¥åˆ°é˜Ÿå¤´</span>
      hooks.<span class="hljs-title function_">unshift</span>(wrappedHook)
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// æ’å…¥é˜Ÿå°¾</span>
      hooks.<span class="hljs-title function_">push</span>(wrappedHook)
    }
    <span class="hljs-comment">// è¿”å›æœ€ç»ˆæ’å…¥çš„é’©å­å‡½æ•°</span>
    <span class="hljs-keyword">return</span> wrappedHook
  } 
}
</code></pre>
<p>çœ‹äº†å‡½æ•°çš„å®šä¹‰åï¼Œå¯ä»¥å›ç­”ä¸Šé¢çš„é—®é¢˜äº†
é€šè¿‡<code>onActivated</code>å’Œ<code>onDeactivated</code>æ³¨å†Œçš„å‡½æ•°æœ€ç»ˆéƒ½ä¼šæ³¨å†Œåˆ°<code>KeepAliveæ ¹ç»„ä»¶</code>çš„å®ä¾‹çš„<code>a</code>å’Œ<code>da</code>å±æ€§ä¸Šï¼Œè¿™ä¸¤ä¸ªå±æ€§éƒ½æ˜¯æ•°ç»„ï¼Œå¹¶ä¸”å­ç»„ä»¶å¯¹åº”çš„å‡½æ•°ä¼šæ³¨å†Œåˆ°<code>KeepAliveæ ¹ç»„ä»¶</code>å®ä¾‹çš„<code>a</code>å’Œ<code>da</code>å±æ€§çš„é˜Ÿå¤´ï¼Œä¼˜å…ˆäºçˆ¶ç»„ä»¶æ³¨å†Œçš„åŒç±»å‹çš„é’©å­æ‰§è¡Œã€‚ç­‰<code>KeepAliveæ ¹ç»„ä»¶</code>åˆ‡æ¢æ—¶ï¼Œåªéœ€è¦æŒ‰éœ€è°ƒç”¨æ ¹ç»„ä»¶å®ä¾‹ä¸Šçš„<code>a</code>å’Œ<code>da</code>ä¸­æ‰€æœ‰çš„å‡½æ•°å³å¯ã€‚</p>
<h3 data-id="heading-5">4.KeepAliveæ˜¯å¦‚ä½•å¤„ç†ç»„ä»¶çš„ç§»é™¤å’Œæ¢å¤çš„</h3>
<h4 data-id="heading-6">4.1ç§»é™¤æµç¨‹</h4>
<p>å…ˆå›å¤´çœ‹çœ‹<code>KeepAlive</code>ç»„ä»¶çš„æ¸²æŸ“å‡½æ•°ï¼Œå®ƒåœ¨æ¸²æŸ“éœ€è¦ç¼“å­˜çš„å­ç»„ä»¶æ—¶ï¼Œä¼šç»™å®ƒçš„VNodeè®¾ç½®ä¸€ä¸ªæ ‡è®°<code>COMPONENT_SHOULD_KEEP_ALIVE</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªç»„ä»¶éœ€è¦è¢«ç¼“å­˜ï¼Œè¿™ä¸ªæ ‡è®°ä¼šåœ¨ä¸¤ä¸ªåœ°æ–¹ä¼šè¢«ç”¨åˆ°,ä¸€æ˜¯ç»„ä»¶çš„åˆæ¬¡æ¸²æŸ“ï¼ŒäºŒæ˜¯ç»„ä»¶å¸è½½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥åˆ†åˆ«çœ‹çœ‹è¿™ä¸¤ä¸ªåœ°æ–¹å…·ä½“æ˜¯å¹²äº†ä»€ä¹ˆã€‚</p>
<h5 data-id="heading-7">4.1.1åˆæ¬¡æ¸²æŸ“</h5>
<p>åˆæ¬¡æ¸²æŸ“çš„æ ¸å¿ƒæµç¨‹ä»£ç åœ¨<code>runtime-core/src/renderer.ts</code>è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢åŒ…å«äº†<code>VNode patch</code>çš„æ ¸å¿ƒæµç¨‹ã€‚ç»„ä»¶åˆæ¬¡æ¸²æŸ“çš„å‡½æ•°è°ƒç”¨é¡ºåºæ˜¯<em>patch -&gt; processComponent -&gt; mountComponent -&gt; setupRenderEffect -&gt; componentUpdateFn</em>,æˆ‘ä»¬ç›´æ¥æ¥çœ‹<code>componentUpdateFn</code>ä¸­çš„éƒ¨åˆ†å®šä¹‰ï¼Œå› ä¸º<code>COMPONENT_SHOULD_KEEP_ALIVE</code>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¢«ç”¨åˆ°äº†ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">setupRenderEffect</span>: <span class="hljs-title class_">SetupRenderEffectFn</span> = <span class="hljs-function">(<span class="hljs-params">
  instance,
  initialVNode,
  container,
  anchor,
  parentSuspense,
  <span class="hljs-keyword">namespace</span>: ElementNamespace,
  optimized,
</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">componentUpdateFn</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-keyword">if</span> (!instance.<span class="hljs-property">isMounted</span>) {
      <span class="hljs-comment">// ç»„ä»¶æœªæŒ‚è½½</span>
      <span class="hljs-keyword">let</span> <span class="hljs-attr">vnodeHook</span>: <span class="hljs-title class_">VNodeHook</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span>
      <span class="hljs-keyword">const</span> { el, props } = initialVNode
      <span class="hljs-keyword">const</span> { bm, m, parent, root, <span class="hljs-keyword">type</span> } = instance
      <span class="hljs-keyword">const</span> isAsyncWrapperVNode = <span class="hljs-title function_">isAsyncWrapper</span>(initialVNode)

      <span class="hljs-keyword">if</span> (bm) {
        <span class="hljs-comment">// è°ƒç”¨beforeMounté’©å­å‡½æ•°</span>
        <span class="hljs-title function_">invokeArrayFns</span>(bm)
      }

      <span class="hljs-comment">//</span>
      <span class="hljs-comment">// ä¸­é—´æŒ‚è½½è¿‡ç¨‹ä¸­çš„ä»£ç </span>
      <span class="hljs-comment">//</span>

      <span class="hljs-keyword">if</span> (m) {
        <span class="hljs-comment">// æŒ‚è½½å®Œæˆåè°ƒç”¨mountedé’©å­å‡½æ•°</span>
        <span class="hljs-title function_">queuePostRenderEffect</span>(m, parentSuspense)
      }

      <span class="hljs-keyword">if</span> (
        initialVNode.<span class="hljs-property">shapeFlag</span> &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT_SHOULD_KEEP_ALIVE</span> ||
        (parent &amp;&amp;
          <span class="hljs-title function_">isAsyncWrapper</span>(parent.<span class="hljs-property">vnode</span>) &amp;&amp;
          parent.<span class="hljs-property">vnode</span>.<span class="hljs-property">shapeFlag</span> &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT_SHOULD_KEEP_ALIVE</span>)
      ) {
        <span class="hljs-comment">// ç»„ä»¶åˆæ¬¡æ¸²æŸ“åï¼Œå¦‚æœæ˜¯è¢«keep-aliveåŒ…è£¹çš„ç»„ä»¶ï¼Œåˆ™è°ƒç”¨activatedé’©å­å‡½æ•°</span>
        instance.<span class="hljs-property">a</span> &amp;&amp; <span class="hljs-title function_">queuePostRenderEffect</span>(instance.<span class="hljs-property">a</span>, parentSuspense)
      }
      <span class="hljs-comment">// æ ‡è®°ç»„ä»¶å·²æŒ‚è½½</span>
      instance.<span class="hljs-property">isMounted</span> = <span class="hljs-literal">true</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// ç»„ä»¶å·²æŒ‚è½½</span>
    }
  }
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°ä»–çš„ç¬¬ä¸€ä¸ªä½œç”¨å°±æ˜¯åœ¨ç»„ä»¶åˆæ¬¡æ¸²æŸ“åï¼Œå¦‚æœæ˜¯è¢«keep-aliveåŒ…è£¹çš„ç»„ä»¶ï¼Œåˆ™è°ƒç”¨activatedé’©å­å‡½æ•°ã€‚</p>
<h4 data-id="heading-8">4.1.2ç»„ä»¶å¸è½½</h4>
<p>vnodeå¸è½½æ—¶ä¼šç»Ÿä¸€è°ƒç”¨<code>renderer.ts</code>ä¸­å®šä¹‰çš„<code>unmount</code>æ–¹æ³•</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> <span class="hljs-attr">unmount</span>: <span class="hljs-title class_">UnmountFn</span> = <span class="hljs-function">(<span class="hljs-params">
  vnode,
  parentComponent,
  parentSuspense,
  doRemove = <span class="hljs-literal">false</span>,
  optimized = <span class="hljs-literal">false</span>,
</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> { <span class="hljs-keyword">type</span>, props, ref, children, dynamicChildren, shapeFlag, patchFlag, dirs, cacheIndex } =
    vnode

  <span class="hljs-comment">// å¸è½½vnodeæ—¶ï¼Œå¦‚æœç»„ä»¶è¢«keepaliveç¼“å­˜ï¼Œåˆ™è°ƒç”¨keepaliveå†…éƒ¨å®šä¹‰çš„deactivateæ–¹æ³•</span>
  <span class="hljs-keyword">if</span> (shapeFlag &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT_SHOULD_KEEP_ALIVE</span>) {
    ;(parentComponent!.<span class="hljs-property">ctx</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">KeepAliveContext</span>).<span class="hljs-title function_">deactivate</span>(vnode)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-comment">// çœå»å…¶ä»–ä»£ç </span>
}
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨å¸è½½æ—¶ï¼Œå¦‚æœé‡åˆ°äº†è¿™ä¸ªæ ‡è®°å°±ä¸ä¼šç»§ç»­æ‰§è¡Œåç»­çš„å¸è½½é€»è¾‘ï¼Œè€Œæ˜¯è°ƒç”¨äº†<code>KeepAlive</code>å†…éƒ¨å®šä¹‰çš„<code>deactivate</code>æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">const</span> storageContainer = <span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)

sharedContext.<span class="hljs-property">deactivate</span> = <span class="hljs-function">(<span class="hljs-params">vnode: VNode</span>) =&gt;</span> {
  <span class="hljs-keyword">const</span> instance = vnode.<span class="hljs-property">component</span>!

  <span class="hljs-comment">// æŠŠç»„ä»¶çš„èŠ‚ç‚¹ä»å½“å‰é¡µé¢ä¸Š ç§»åŠ¨åˆ°ä¸´æ—¶çš„å®¹å™¨èŠ‚ç‚¹ä¸­</span>
  <span class="hljs-title function_">move</span>(vnode, storageContainer, <span class="hljs-literal">null</span>, <span class="hljs-title class_">MoveType</span>.<span class="hljs-property">LEAVE</span>, parentSuspense)
  <span class="hljs-title function_">queuePostRenderEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (instance.<span class="hljs-property">da</span>) {
      <span class="hljs-comment">// è°ƒç”¨ç»„ä»¶ä¸­å®šä¹‰çš„onDeactivatedçš„é’©å­å‡½æ•°</span>
      <span class="hljs-title function_">invokeArrayFns</span>(instance.<span class="hljs-property">da</span>)
    }
    <span class="hljs-keyword">const</span> vnodeHook = vnode.<span class="hljs-property">props</span> &amp;&amp; vnode.<span class="hljs-property">props</span>.<span class="hljs-property">onVnodeUnmounted</span>
    <span class="hljs-keyword">if</span> (vnodeHook) {
      <span class="hljs-title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="hljs-property">parent</span>, vnode)
    }
    <span class="hljs-comment">// æ ‡è®°ç»„ä»¶å·²å¤±æ´»</span>
    instance.<span class="hljs-property">isDeactivated</span> = <span class="hljs-literal">true</span>
  }, parentSuspense)
}
</code></pre>
<p>é€šè¿‡ä¸æ–­æ·±å…¥åˆ†æï¼Œå‘ç°è¢«ç¼“å­˜çš„ç»„ä»¶å¸è½½æ—¶ï¼Œåªä¼šå°†ä»–çš„Domå…ƒç´ ç§»åŠ¨åˆ°ä¸´æ—¶åˆ›å»ºçš„divä¸­ï¼Œå¹¶ä¸”è°ƒç”¨ç»„ä»¶ä¸­å®šä¹‰çš„<code>onDeactivated</code>çš„é’©å­å‡½æ•°</p>
<h4 data-id="heading-9">4.2æ¢å¤æµç¨‹</h4>
<p>è¿˜æ˜¯å›åˆ°<code>KeepAlive</code>çš„æ¸²æŸ“å‡½æ•°ï¼Œvnodeè¦å¤ç”¨çš„æ—¶å€™ï¼Œä»–ä¼šç»™vnodeæ ‡è®°ä¸º<code>COMPONENT_KEPT_ALIVE</code>ï¼Œè¡¨ç¤ºè¿™ä¸ªç»„ä»¶æ˜¯è¢«ç¼“å­˜çš„ç»„ä»¶ã€‚è¿™ä¸ªæ ‡è®°ä¹Ÿæ˜¯ä¼šåœ¨åé¢çš„<code>patch</code>æµç¨‹ä¸­è¢«ä½¿ç”¨åˆ°,ç»„ä»¶æ¢å¤æ—¶çš„å‡½æ•°è°ƒç”¨é¡ºåºæ˜¯<em>patch -&gt; processComponent</em></p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-keyword">const</span> <span class="hljs-title function_">processComponent</span> = (<span class="hljs-params">
    n1: VNode | <span class="hljs-literal">null</span>,
    n2: VNode,
    container: RendererElement,
    anchor: RendererNode | <span class="hljs-literal">null</span>,
    parentComponent: ComponentInternalInstance | <span class="hljs-literal">null</span>,
    parentSuspense: SuspenseBoundary | <span class="hljs-literal">null</span>,
    <span class="hljs-keyword">namespace</span>: ElementNamespace,
    slotScopeIds: <span class="hljs-built_in">string</span>[] | <span class="hljs-literal">null</span>,
    optimized: <span class="hljs-built_in">boolean</span>,
  </span>) =&gt; {
    n2.<span class="hljs-property">slotScopeIds</span> = slotScopeIds
    <span class="hljs-keyword">if</span> (n1 == <span class="hljs-literal">null</span>) {
      <span class="hljs-comment">// æ— æ—§vNode</span>
      <span class="hljs-keyword">if</span> (n2.<span class="hljs-property">shapeFlag</span> &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">COMPONENT_KEPT_ALIVE</span>) {
        <span class="hljs-comment">// è¢«ç¼“å­˜çš„ç»„ä»¶ï¼Œåˆ™è°ƒç”¨keepaliveå†…éƒ¨å®šä¹‰çš„activateæ–¹æ³•</span>
        ;(parentComponent!.<span class="hljs-property">ctx</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">KeepAliveContext</span>).<span class="hljs-title function_">activate</span>(
          n2,
          container,
          anchor,
          <span class="hljs-keyword">namespace</span>,
          optimized,
        )
      } else {
       <span class="hljs-comment">// æœªè¢«ç¼“å­˜çš„ç»„ä»¶ é‡æ–°æŒ‚è½½</span>
        <span class="hljs-title function_">mountComponent</span>(
          n2,
          container,
          anchor,
          parentComponent,
          parentSuspense,
          <span class="hljs-keyword">namespace</span>,
          optimized,
        )
      }
    } else {
      <span class="hljs-title function_">updateComponent</span>(n1, n2, optimized)
    }
  }
</code></pre>
<p>å¯ä»¥çœ‹åˆ°åœ¨é‡æ–°æ¸²æŸ“æ—¶ï¼Œå¦‚æœé‡åˆ°äº†è¿™ä¸ªæ ‡è®°å°±ä¸ä¼šé‡æ–°èµ°åˆæ¬¡æŒ‚è½½é€»è¾‘ï¼Œè€Œæ˜¯è°ƒç”¨äº†<code>KeepAlive</code>å†…éƒ¨å®šä¹‰çš„<code>activate</code>æ–¹æ³•ã€‚</p>
<pre><code class="hljs language-typescript" lang="typescript">    sharedContext.<span class="hljs-property">activate</span> = <span class="hljs-function">(<span class="hljs-params">
      vnode,
      container,
      anchor,
      <span class="hljs-keyword">namespace</span>,
      optimized,
    </span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> instance = vnode.<span class="hljs-property">component</span>!
      <span class="hljs-comment">// å°†DomèŠ‚ç‚¹å…ˆæ¢å¤åˆ°é¡µé¢ä¸­</span>
      <span class="hljs-title function_">move</span>(vnode, container, anchor, <span class="hljs-title class_">MoveType</span>.<span class="hljs-property">ENTER</span>, parentSuspense)
      <span class="hljs-comment">// è¿˜éœ€è¦patchæ›´æ–°æµç¨‹ï¼Œå› ä¸ºç»„ä»¶çš„propså¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–</span>
      <span class="hljs-title function_">patch</span>(
        instance.<span class="hljs-property">vnode</span>,
        vnode,
        container,
        anchor,
        instance,
        parentSuspense,
        <span class="hljs-keyword">namespace</span>,
        vnode.slotScopeIds,
        optimized,
      )
      queuePostRenderEffect(() =&gt; {
        instance.<span class="hljs-property">isDeactivated</span> = <span class="hljs-literal">false</span>
        <span class="hljs-keyword">if</span> (instance.<span class="hljs-property">a</span>) {
          <span class="hljs-comment">// è°ƒç”¨ç»„ä»¶ä¸­å®šä¹‰çš„onActivatedçš„é’©å­å‡½æ•°</span>
          <span class="hljs-title function_">invokeArrayFns</span>(instance.<span class="hljs-property">a</span>)
        }
        <span class="hljs-keyword">const</span> vnodeHook = vnode.<span class="hljs-property">props</span> &amp;&amp; vnode.<span class="hljs-property">props</span>.<span class="hljs-property">onVnodeMounted</span>
        <span class="hljs-keyword">if</span> (vnodeHook) {
          <span class="hljs-title function_">invokeVNodeHook</span>(vnodeHook, instance.<span class="hljs-property">parent</span>, vnode)
        }
      }, parentSuspense)
    }
</code></pre>
<p>é€šè¿‡ä¸æ–­æ·±å…¥åˆ†æï¼Œå‘ç°è¢«ç¼“å­˜çš„ç»„ä»¶æ¢å¤æ—¶ï¼Œåªä¼šå°†ä»–çš„Domå…ƒç´ é‡æ–°ç§»åŠ¨åˆ°é¡µé¢ä¸­ï¼Œé˜²æ­¢ç»„ä»¶çš„<code>props</code>å˜åŒ–è¿˜éœ€è¦èµ°ä¸€é<code>patch</code>æ›´æ–°æµç¨‹ï¼ˆå…³äºä¸ºä»€ä¹ˆè¦<code>patch</code>ï¼Œä¸‹ä¸€ä¸ªé—®é¢˜ä¸­ä¼šæåˆ°ï¼‰ï¼Œæœ€åè°ƒç”¨ç»„ä»¶ä¸­å®šä¹‰çš„<code>onActivated</code>çš„é’©å­å‡½æ•°ã€‚</p>
<p>é€šè¿‡ä»£ç çš„å±‚å±‚åˆ†æï¼Œå¯ç®—æ˜¯å¼„æ‡‚äº†<code>KeepAlive</code>æ˜¯å¦‚ä½•å¤„ç†ç»„ä»¶çš„ç§»é™¤å’Œæ¢å¤çš„äº†ã€‚</p>
<h3 data-id="heading-10">5.å¤±æ´»çš„ç»„ä»¶ï¼Œä¾èµ–çš„æ•°æ®æ›´æ–°äº†ï¼Œå®ƒä¼šé‡æ–°æ¸²æŸ“å—</h3>
<p>è¿™ä¸ªé—®é¢˜è¦åˆ†ä¸¤ç§å†µè®¨è®ºï¼Œç¬¬ä¸€ç§æ˜¯ç”±çˆ¶ç»„ä»¶ä¼ å…¥åˆ°å­ç»„ä»¶çš„æ•°æ®<code>props</code>ï¼Œç¬¬äºŒç§æ˜¯ç»„ä»¶è‡ªèº«å†…éƒ¨çš„å®šä¹‰çš„æ•°æ®æˆ–ä¾èµ–çš„å…¨å±€çŠ¶æ€</p>
<h4 data-id="heading-11">5.1 çˆ¶ç»„ä»¶ä¼ å…¥çš„propså˜åŒ–</h4>
<p>è¦ç†è§£çˆ¶ç»„ä»¶ä¼ å…¥çš„<code>props</code>å˜åŒ–ï¼Œä¼šä¸ä¼šè§¦å‘å¤±æ´»çš„ç»„ä»¶æ›´æ–°ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å­ç»„ä»¶æ˜¯å¦‚ä½•ä½¿ç”¨çˆ¶ç»„ä»¶ä¼ å…¥çš„<code>props</code>çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦ç»“åˆä¸€ä¸‹ç›¸å…³çš„ä»£ç åšåˆ†æã€‚<br/>
é¦–å…ˆçˆ¶ç»„ä»¶ä¼ é€’ç»™å­ç»„ä»¶çš„<code>props</code>æ˜¯å…ˆç»‘å®šåœ¨å­ç»„ä»¶çš„<code>VNode</code>ä¸Šé¢çš„ï¼Œç±»ä¼¼ä¸‹é¢è¿™æ ·</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// æ¨¡æ¿ä¸­è¿™æ ·å†™ ä¼ é€’countç»™å­ç»„ä»¶</span>
&lt;<span class="hljs-title class_">CompChild</span> :count=<span class="hljs-string">"count"</span>&gt;&lt;/<span class="hljs-title class_">CompChild</span>&gt;

<span class="hljs-comment">// å®é™…åœ¨æ¸²æŸ“å‡½æ•°å¤§æ¦‚ä¼šé•¿è¿™æ ·</span>
<span class="hljs-comment">// ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ç»„ä»¶æœ¬å‡ï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ä¼ é€’ç»™ç»„ä»¶çš„props</span>
<span class="hljs-title function_">_createBlock</span>(_component_CompChild, { <span class="hljs-attr">count</span>: $setup.<span class="hljs-property">count</span> }, <span class="hljs-literal">null</span>, <span class="hljs-number">8</span> <span class="hljs-comment">/* PROPS */</span>, [<span class="hljs-string">"count"</span>])

<span class="hljs-comment">// ç”Ÿæˆçš„VNode å¤§æ¦‚ä¼šé•¿è¿™æ ·</span>
{
   <span class="hljs-comment">// æ ‡è®°è¿™æ˜¯ä¸€ä¸ªVNode</span>
   <span class="hljs-attr">__v_isVNode</span>: <span class="hljs-literal">true</span>,
   <span class="hljs-comment">// ç±»å‹ï¼Œç»„ä»¶ç¼–è¯‘åçš„jså¯¹è±¡</span>
   <span class="hljs-attr">type</span>: _component_CompChild,
   <span class="hljs-comment">// props</span>
   <span class="hljs-attr">props</span>: { count },
   <span class="hljs-comment">// åŠ¨æ€å‚æ•°</span>
   <span class="hljs-attr">dynamicProps</span>: [<span class="hljs-string">'count'</span>],
   <span class="hljs-attr">key</span>: <span class="hljs-literal">null</span>,
   <span class="hljs-comment">// ç»„ä»¶å®ä¾‹</span>
   <span class="hljs-attr">component</span>: <span class="hljs-literal">null</span>,
   <span class="hljs-comment">// æ¸²æŸ“çš„dom</span>
   <span class="hljs-attr">el</span>: <span class="hljs-literal">null</span>,
   <span class="hljs-attr">patchFlag</span>: <span class="hljs-number">8</span>,
   <span class="hljs-attr">children</span>: <span class="hljs-literal">null</span>
   <span class="hljs-comment">// è¿˜æœ‰ä¸€äº›å…¶ä»–å±æ€§</span>
}
</code></pre>
<p>ä¼ ç»™ç»„ä»¶çš„å‚æ•°ä¼šè¢«è®°å½•åœ¨ç»„ä»¶<code>VNode</code>çš„<code>props</code>å±æ€§ä¸Šï¼Œç­‰æ¥ä¸‹æ¥ç»„ä»¶æ¸²æŸ“çš„æ—¶å€™ä¼šè¢«åˆå§‹åŒ–åˆ°ç»„ä»¶çš„å®ä¾‹ä¸Šé¢ã€‚
ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨<code>setupComponent</code>è¿™ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å®šä¹‰åœ¨<code>runtime-core/src/component.ts</code>ä¸­</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// component.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setupComponent</span>(<span class="hljs-params">
  instance: ComponentInternalInstance,
  isSSR = <span class="hljs-literal">false</span>,
  optimized = <span class="hljs-literal">false</span>,
</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; | <span class="hljs-literal">undefined</span> {
  isSSR &amp;&amp; <span class="hljs-title function_">setInSSRSetupState</span>(isSSR)

  <span class="hljs-keyword">const</span> { props, children } = instance.<span class="hljs-property">vnode</span>
  <span class="hljs-keyword">const</span> isStateful = <span class="hljs-title function_">isStatefulComponent</span>(instance)
  <span class="hljs-comment">// åˆå§‹åŒ–ç»„ä»¶props</span>
  <span class="hljs-title function_">initProps</span>(instance, props, isStateful, isSSR)
  <span class="hljs-title function_">initSlots</span>(instance, children, optimized || isSSR)

  <span class="hljs-comment">// æ‰§è¡Œsetupå‡½æ•°ï¼Œå¹¶å¤„ç†setupç»“æœ</span>
  <span class="hljs-keyword">const</span> setupResult = isStateful
    ? <span class="hljs-title function_">setupStatefulComponent</span>(instance, isSSR)
    : <span class="hljs-literal">undefined</span>

  isSSR &amp;&amp; <span class="hljs-title function_">setInSSRSetupState</span>(<span class="hljs-literal">false</span>)
  <span class="hljs-keyword">return</span> setupResult
}

<span class="hljs-comment">// componentProps.ts</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initProps</span>(<span class="hljs-params">
  instance: ComponentInternalInstance,
  rawProps: Data | <span class="hljs-literal">null</span>,
  isStateful: <span class="hljs-built_in">number</span>, <span class="hljs-comment">// result of bitwise flag comparison</span>
  isSSR = <span class="hljs-literal">false</span>,
</span>): <span class="hljs-built_in">void</span> {
  <span class="hljs-keyword">const</span> <span class="hljs-attr">props</span>: <span class="hljs-title class_">Data</span> = {}
  <span class="hljs-keyword">const</span> <span class="hljs-attr">attrs</span>: <span class="hljs-title class_">Data</span> = <span class="hljs-title function_">createInternalObject</span>()
  instance.<span class="hljs-property">propsDefaults</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>)

  <span class="hljs-title function_">setFullProps</span>(instance, rawProps, props, attrs)

  <span class="hljs-keyword">if</span> (isStateful) {
    <span class="hljs-comment">// ç»„ä»¶å®ä¾‹ä¸Šçš„propsæ˜¯åœ¨VNodeçš„propsåŸºç¡€ä¸ŠåŒ…äº†ä¸€å±‚shallowReactiveæµ…å±‚å“åº”å¼</span>
    instance.<span class="hljs-property">props</span> = isSSR ? props : <span class="hljs-title function_">shallowReactive</span>(props)
  } <span class="hljs-keyword">else</span> {
   <span class="hljs-comment">// å‡½æ•°å¼ç»„ä»¶</span>
  }
  instance.<span class="hljs-property">attrs</span> = attrs
}
</code></pre>
<p>æ‰€ä»¥ä¼ é€’ç»™å­ç»„ä»¶çš„<code>props</code>æœ€ç»ˆä¼šè¢«èµ‹å€¼ç»™ç»„ä»¶å®ä¾‹çš„<code>props</code>å±æ€§ï¼Œå¹¶ä¸”ä¼šè¢«è½¬æ¢æˆæµ…å±‚å“åº”å¼æ•°æ®ã€‚æœ€ç»ˆç»„ä»¶çš„æ¸²æŸ“å‡½æ•°å’Œsetupå‡½æ•°ç”¨çš„ä¹Ÿæ˜¯è¢«è½¬æ¢åçš„<code>props</code>ã€‚</p>
<p>å½“ä¼ é€’ç»™ç»„ä»¶çš„<code>props</code>å˜åŒ–çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šè§¦å‘çˆ¶ç»„ä»¶çš„çš„renderå‡½æ•°é‡æ–°è¿è¡Œï¼Œç„¶åä¼šç”Ÿæˆæ–°çš„å­ç»„ä»¶çš„<code>VNode</code>ï¼Œç„¶åå°±ä¼šè¿›å…¥<code>patch</code>æ›´æ–°æµç¨‹ï¼Œè¿™æ—¶å€™å­ç»„ä»¶çš„<code>æ–°æ—§Vnode</code>å¯¹æ¯”,æ–°æ—§å¯¹æ¯”ä¼šè°ƒç”¨<code>updateProps</code>æ›´æ–°ç»„ä»¶çš„props</p>
<pre><code class="hljs language-typescript" lang="typescript">  <span class="hljs-comment">// renderer.ts</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">updateComponentPreRender</span> = (<span class="hljs-params">
    instance: ComponentInternalInstance,
    nextVNode: VNode,
    optimized: <span class="hljs-built_in">boolean</span>,
  </span>) =&gt; {
    nextVNode.<span class="hljs-property">component</span> = instance
    <span class="hljs-keyword">const</span> prevProps = instance.<span class="hljs-property">vnode</span>.<span class="hljs-property">props</span>
    instance.<span class="hljs-property">vnode</span> = nextVNode
    instance.<span class="hljs-property">next</span> = <span class="hljs-literal">null</span>
    <span class="hljs-comment">// æ›´æ–°ç»„ä»¶çš„å‚æ•°</span>
    <span class="hljs-title function_">updateProps</span>(instance, nextVNode.<span class="hljs-property">props</span>, prevProps, optimized)
    <span class="hljs-title function_">updateSlots</span>(instance, nextVNode.<span class="hljs-property">children</span>, optimized)

    <span class="hljs-title function_">pauseTracking</span>()
    <span class="hljs-comment">// propsæ›´æ–°å å…ˆè§¦å‘pre-flush watchers</span>
    <span class="hljs-title function_">flushPreFlushCbs</span>(instance)
    <span class="hljs-title function_">resetTracking</span>()
  }
  
  <span class="hljs-comment">// componentProps.ts</span>
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateProps</span>(<span class="hljs-params">
  instance: ComponentInternalInstance,
  rawProps: Data | <span class="hljs-literal">null</span>,
  rawPrevProps: Data | <span class="hljs-literal">null</span>,
  optimized: <span class="hljs-built_in">boolean</span>,
</span>): <span class="hljs-built_in">void</span> {
   <span class="hljs-comment">// æ›´æ–°propsçš„å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä»£ç è¾ƒå¤šï¼Œå°±ä¸è´´äº†</span>
   <span class="hljs-comment">// è¿™ä¸ªå‡½æ•°é‡Œé¢ä¼šæŠŠç»„ä»¶å®ä¾‹çš„propså±æ€§é‡Œé¢çš„å€¼æ›´æ–°æˆæ–°çš„å€¼</span>
}
</code></pre>
<p>ç­‰å­ç»„ä»¶çš„<code>props</code>æ›´æ–°åï¼Œä¼šé‡æ–°è°ƒç”¨å­ç»„ä»¶çš„<code>render</code>å‡½æ•°,é‡æ–°ç”Ÿæˆå­ç»„ä»¶çš„å†…éƒ¨ç»“æ„çš„<code>VNode</code>ï¼Œç„¶åæ¥ç€èµ°å­ç»„ä»¶å†…éƒ¨ç»“æ„çš„<code>patch</code>æµç¨‹</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderComponentRoot</span>(<span class="hljs-params">
  instance: ComponentInternalInstance,
</span>): <span class="hljs-title class_">VNode</span> {
  <span class="hljs-keyword">const</span> {
    <span class="hljs-attr">type</span>: <span class="hljs-title class_">Component</span>,
    vnode,
    proxy,
    withProxy,
    <span class="hljs-attr">propsOptions</span>: [propsOptions],
    slots,
    attrs,
    emit,
    render,
    renderCache,
    props,
    data,
    setupState,
    ctx,
    inheritAttrs,
  } = instance

  <span class="hljs-keyword">let</span> result


  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (vnode.<span class="hljs-property">shapeFlag</span> &amp; <span class="hljs-title class_">ShapeFlags</span>.<span class="hljs-property">STATEFUL_COMPONENT</span>) {
      <span class="hljs-keyword">const</span> proxyToUse = withProxy || proxy

      <span class="hljs-keyword">const</span> thisProxy =
        __DEV__ &amp;&amp; setupState.<span class="hljs-property">__isScriptSetup</span>
          ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(proxyToUse!, {
              <span class="hljs-title function_">get</span>(<span class="hljs-params">target, key, receiver</span>) {
                <span class="hljs-title function_">warn</span>(
                  <span class="hljs-string">`Property '<span class="hljs-subst">${<span class="hljs-built_in">String</span>(
                    key,
                  )}</span>' was accessed via 'this'. Avoid using 'this' in templates.`</span>,
                )
                <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">get</span>(target, key, receiver)
              },
            })
          : proxyToUse
      <span class="hljs-comment">// æ‰§è¡Œrenderå‡½æ•°ï¼Œè·å–æ–°çš„vnode</span>
      result = <span class="hljs-title function_">normalizeVNode</span>(
        render!.<span class="hljs-title function_">call</span>(
          thisProxy,
          proxyToUse!,
          renderCache,
          <span class="hljs-comment">// å¼€å‘æ¨¡å¼ä¸‹ï¼Œpropsæ˜¯shallowReadonlyçš„ï¼Œæ‰€ä»¥å­ç»„ä»¶å†…éƒ¨æ— æ³•ä¿®æ”¹props</span>
          __DEV__ ? <span class="hljs-title function_">shallowReadonly</span>(props) : props,
          setupState,
          data,
          ctx,
        ),
      )
      fallthroughAttrs = attrs
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// functional</span>
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">//</span>
  }

  <span class="hljs-comment">// çœå»äº†ä¸€å¤§å †ä»£ç </span>
}
</code></pre>
<p>çœ‹å®Œpropsçš„æ›´æ–°é€»è¾‘ï¼Œå°±èƒ½å›ç­”ä¸Šé¢çš„é—®é¢˜äº†ï¼Œç»„ä»¶å†…éƒ¨ä½¿ç”¨çš„<code>props</code>å¿…é¡»è¦<code>patch</code>å®Œæˆä¹‹åæ‰ä¼šå˜æˆæœ€æ–°çš„æ•°æ®ï¼Œæ‰€ä»¥åœ¨ç»„ä»¶å¤±æ´»çš„æ—¶å€™ï¼Œå³ä½¿çˆ¶ç»„ä»¶ä¼ å…¥çš„<code>props</code>å‘ç”Ÿäº†å˜åŒ–ï¼Œä½†æ˜¯ç”±äºå­ç»„ä»¶å†…éƒ¨ä½¿ç”¨çš„<code>props</code>æ•°æ®å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥è¿™æ—¶å€™å­ç»„ä»¶æ˜¯ä¸ä¼šé‡æ–°æ¸²æŸ“çš„ï¼Œåªæœ‰ç­‰ç»„ä»¶é‡æ–°æ¢å¤çš„æ—¶å€™ï¼Œæ‰‹åŠ¨çš„è°ƒç”¨<code>patch</code>,å®Œæˆ<code>props</code>æ›´æ–°ï¼Œå¦‚æœ<code>props</code>å‘ç”Ÿå˜åŒ–æ‰ä¼šè§¦å‘å­ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚</p>
<h4 data-id="heading-12">5.2 å…¨å±€çŠ¶æ€å˜åŒ–</h4>
<p>ç›¸æ¯”è¾ƒäº<code>props</code>çš„æ›´æ–°é€»è¾‘ï¼Œå…¨å±€çŠ¶æ€å˜åŒ–ä¼šå¾ˆå¥½ç†è§£ï¼Œå…¶å®å°±æ˜¯ä¾èµ–æ”¶é›†å’Œæ´¾å‘æ›´æ–°çš„é€»è¾‘
åªè¦ç»„ä»¶å†…éƒ¨ä¾èµ–çš„ä»»ä½•çŠ¶æ€æ›´æ–°äº†ï¼Œå°±ä¼šè§¦å‘ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œæ— è®ºç»„ä»¶æ˜¯å¦å¤±æ´»ã€‚</p>
<p>æ‰€ä»¥ç¬¬äº”ä¸ªé—®é¢˜çš„ç»“è®ºä¹Ÿæ˜¾è€Œæ˜“è§äº†ï¼Œåªæœ‰ç»„ä»¶ä¾èµ–çš„æ•°æ®æ˜¯çˆ¶ç»„ä»¶ä¼ å…¥çš„<code>props</code>å¹¶ä¸”è¿™ä¸ª<code>props</code>ä¼ å…¥çš„åªæ˜¯<code>åŸå§‹ç±»å‹</code>æˆ–è€…è¯´æ˜¯éå“åº”å¼çš„æ•°æ®å¯¹è±¡ï¼Œè¿™æ—¶å€™å³ä½¿å¤–éƒ¨æ•°æ®å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆå­ç»„ä»¶åœ¨å¤±æ´»çš„æ—¶å€™æ˜¯ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“çš„ï¼Œè€Œé™¤äº†è¿™ç§æƒ…å†µä»¥å¤–ï¼Œä¾èµ–çš„ä»»ä½•å…¶ä»–çš„å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–éƒ½æ˜¯ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“çš„ã€‚</p>
<h2 data-id="heading-13">é‡åˆ°è¿‡çš„é—®é¢˜</h2>
<h3 data-id="heading-14">å¤±æ´»ç»„ä»¶é‡æ–°æ¸²æŸ“å¯¼è‡´çš„BUG</h3>
<p>åœ¨ç¬¬å››ä¸ªé—®é¢˜ä¸­è®¨è®ºè¿‡å¤±æ´»ç»„ä»¶çš„DOMèŠ‚ç‚¹ä¼šè¢«ç§»åŠ¨åˆ°ä¸€ä¸ªä¸´æ—¶åˆ›å»ºçš„<code>div</code>ä¸­,è¿™ä¸ªæ—¶å€™è™½ç„¶DOMæ²¡æœ‰è¢«é”€æ¯ï¼Œä½†æ˜¯DOMçš„çˆ¶çº§å·²ç»å˜äº†ã€‚
è¯´ä¸€ä¸ªåœºæ™¯ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­å¤§é‡çš„ä½¿ç”¨äº†<code>Vant</code>ä¸­çš„<code>List</code>å’Œ<code>Sticky</code>è¿™äº›ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶æœ‰ä¸€ä¸ªç‰¹ç‚¹ä»–ä¼šå»å¯»æ‰¾æœ€è¿‘çš„çˆ¶çº§æ»šåŠ¨èŠ‚ç‚¹ä½œä¸ºæ»šåŠ¨ç›‘å¬çš„å¯¹è±¡ï¼Œç”±äºå¤±æ´»çš„ç»„ä»¶DOMå·²ç»è¢«ç§»åŠ¨åˆ°å…¶ä»–çš„åœ°æ–¹ï¼Œç„¶è€Œç»„ä»¶æ›´æ–°è¿˜æ˜¯ä¼šæ­£å¸¸è§¦å‘ï¼Œè¿™æ—¶å€™<code>List</code>è¿™ç±»ç»„ä»¶å¯»æ‰¾æœ€è¿‘çš„çˆ¶çº§æ»šåŠ¨èŠ‚ç‚¹å¯èƒ½ä¼šæ‰¾çš„ä¸å¯¹ï¼Œæ‰€ä»¥ç­‰ç»„ä»¶å†æ¬¡æ¢å¤æ—¶ï¼Œå¯èƒ½å°±ä¼šçœ‹åˆ°<code>List</code>çš„ä¸Šæ‹‰åŠ è½½å›è°ƒä¸ä¼šè¢«æ‰§è¡Œäº†è¿™ä¹ˆä¸€ä¸ªå¥‡æ€ªçš„BUGã€‚</p>
<h2 data-id="heading-15">ç»“è¯­</h2>
<p>èƒ½å¤Ÿå½»åº•å¼„æ˜ç™½ä¸Šé¢çš„æ‰€æœ‰é—®é¢˜ï¼Œä¸ä»…å¯ä»¥æŠŠ<code>KeepAlive</code>å¼„æ˜ç™½äº†ï¼Œè€Œä¸”é¡ºå¸¦çš„ç»„ä»¶çš„æ¸²æŸ“æµç¨‹ä¹Ÿèƒ½æŒæ¡çš„å…«ä¹ä¸ç¦»åäº†ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å½»åº•ææ‡‚ JWT ç™»å½•è®¤è¯ä¸è·¯ç”±å®ˆå«(äº”)]]></title>    <link>https://juejin.cn/post/7579313396206764047</link>    <guid>https://juejin.cn/post/7579313396206764047</guid>    <pubDate>2025-12-03T07:45:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579313396206764047" data-draft-id="7579169543233388544" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å½»åº•ææ‡‚ JWT ç™»å½•è®¤è¯ä¸è·¯ç”±å®ˆå«(äº”)"/> <meta itemprop="keywords" content="å‰ç«¯,Vue.js,Node.js"/> <meta itemprop="datePublished" content="2025-12-03T07:45:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å°èƒ–éœ"/> <meta itemprop="url" content="https://juejin.cn/user/3790771822016301"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å½»åº•ææ‡‚ JWT ç™»å½•è®¤è¯ä¸è·¯ç”±å®ˆå«(äº”)
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3790771822016301/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å°èƒ–éœ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:45:43.000Z" title="Wed Dec 03 2025 07:45:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>æ‘˜è¦</strong>ï¼š<br/>
ç™»å½•è®¤è¯æ˜¯åå°ç®¡ç†ç³»ç»Ÿçš„â€œç¬¬ä¸€é“é—¨â€ã€‚åœ¨å‰åç«¯åˆ†ç¦»æ¶æ„ä¸­ï¼Œ<strong>JWT (JSON Web Token)</strong> Â æ˜¯ç›®å‰æœ€ä¸»æµçš„æ— çŠ¶æ€è®¤è¯æ–¹æ¡ˆã€‚æœ¬æ–‡å°†æ‰‹æŠŠæ‰‹å¸¦ä½ å®ç°ä¸€å¥—å®Œæ•´çš„é—­ç¯æµç¨‹ï¼šåç«¯ç”Ÿæˆ Tokenã€å‰ç«¯ Pinia ç®¡ç†çŠ¶æ€ã€Axios æ‹¦æˆªå™¨å¤„ç†ä»¤ç‰Œã€ä»¥åŠé€šè¿‡ Vue Router è·¯ç”±å®ˆå«å®ç°â€œæœªç™»å½•æ‹¦æˆªâ€ä¸â€œç”¨æˆ·ä¿¡æ¯è‡ªåŠ¨æ‹‰å–â€ã€‚</p>
<p>å‰ç½®æ–‡ç« ï¼š</p>
<p><a href="https://juejin.cn/post/7563853874815451171" target="_blank" title="https://juejin.cn/post/7563853874815451171">ä»é›¶å¼€å§‹ï¼šåœ¨é˜¿é‡Œäº‘ Ubuntu æœåŠ¡å™¨éƒ¨ç½² Node+Express æ¥å£(ä¸€)</a></p>
<p><a href="https://juejin.cn/post/7565268465708695592" target="_blank" title="https://juejin.cn/post/7565268465708695592">é˜¿é‡Œäº‘åŸŸåè§£æ + Nginx åå‘ä»£ç† + HTTPS å…¨æµç¨‹ï¼šä» IP è®¿é—®åˆ°åŠ å¯†åŸŸåçš„å®Œæ•´é…ç½®ï¼ˆäºŒï¼‰</a></p>
<p><a href="https://juejin.cn/spost/7574245788949004303" target="_blank" title="https://juejin.cn/spost/7574245788949004303">Node+Express+MySQL å®ç°æ³¨å†ŒåŠŸèƒ½(ä¸‰)</a></p>
<p><a href="https://juejin.cn/post/7574369095543799842" target="_blank" title="https://juejin.cn/post/7574369095543799842"> åç«¯ä»£ç éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é…ç½®æ•°æ®åº“ï¼Œpm2è¿›ç¨‹ç®¡ç†å‘å¸ƒ(å››)</a></p>
<h2 data-id="heading-0">å‡†å¤‡å·¥ä½œï¼šæ•°æ®åº“åˆå§‹åŒ–</h2>
<p>åœ¨å¼€å§‹å†™åç«¯æ¥å£ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ MySQL ä¸­åˆ›å»ºç”¨æˆ·è¡¨ï¼Œå¹¶æ’å…¥ä¸€ä¸ªç®¡ç†å‘˜è´¦å·ç”¨äºæµ‹è¯•ã€‚</p>
<h3 data-id="heading-1">1. åˆ›å»ºç”¨æˆ·è¡¨</h3>
<p>è¯·åœ¨æ•°æ®åº“ä¸­æ‰§è¡Œä»¥ä¸‹ SQLã€‚æ³¨æ„Â passwordÂ å­—æ®µæˆ‘ä»¬è¦å­˜åŠ å¯†åçš„å“ˆå¸Œå€¼ï¼Œä¸èƒ½å­˜æ˜æ–‡ã€‚</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `sys_users` (
  `id` <span class="hljs-type">int</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'ç”¨æˆ·ID'</span>,
  `username` <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'ç”¨æˆ·è´¦å·(ç™»å½•å)'</span>,
  `password` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¯†ç (åŠ å¯†å­˜å‚¨)'</span>,
  `nickname` <span class="hljs-type">varchar</span>(<span class="hljs-number">30</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'ç”¨æˆ·æ˜µç§°'</span>,
  `role_id` <span class="hljs-type">int</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å…³è”çš„è§’è‰²ID'</span>,
  `is_admin` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'0'</span> COMMENT <span class="hljs-string">'æ˜¯å¦åå°ç®¡ç†å‘˜(1æ˜¯ 0å¦)'</span>,
  `phone` <span class="hljs-type">varchar</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'æ‰‹æœºå·ç '</span>,
  `status` tinyint(<span class="hljs-number">1</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'1'</span> COMMENT <span class="hljs-string">'å¸å·çŠ¶æ€ï¼ˆ1æ­£å¸¸ 0åœç”¨ï¼‰'</span>,
  `remark` <span class="hljs-type">varchar</span>(<span class="hljs-number">500</span>) <span class="hljs-keyword">COLLATE</span> utf8mb4_unicode_ci <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">'å¤‡æ³¨'</span>,
  `created_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'åˆ›å»ºæ—¶é—´'</span>,
  `updated_at` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> COMMENT <span class="hljs-string">'æ›´æ–°æ—¶é—´'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),
  <span class="hljs-keyword">UNIQUE</span> KEY `uniq_username` (`username`) COMMENT <span class="hljs-string">'è´¦å·å”¯ä¸€'</span>,
  KEY `idx_phone` (`phone`) COMMENT <span class="hljs-string">'æ‰‹æœºå·ç´¢å¼•'</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">6</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8mb4 <span class="hljs-keyword">COLLATE</span><span class="hljs-operator">=</span>utf8mb4_unicode_ci COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'ç”¨æˆ·ä¿¡æ¯è¡¨'</span>;
</code></pre>
<h3 data-id="heading-2">2. æ’å…¥æµ‹è¯•æ•°æ® (å…³é”®ï¼)</h3>
<p>å› ä¸ºæˆ‘ä»¬çš„ç™»å½•ä»£ç ä½¿ç”¨äº†Â bcrypt.compareï¼Œæ‰€ä»¥æ•°æ®åº“é‡Œçš„å¯†ç å¿…é¡»æ˜¯åŠ å¯†åçš„ä¹±ç ã€‚<br/>
æˆ‘ä»¬è¿™é‡Œç›´æ¥é¢„è®¾ä¸€ä¸ªå¯†ç ï¼š<strong>123456</strong>ã€‚
å®ƒçš„ Bcrypt å“ˆå¸Œå€¼æ˜¯ï¼ˆä½ å¯ä»¥ç›´æ¥å¤åˆ¶è¿™ä¸ªç”¨ï¼‰ï¼š<br/>
<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mi>a</mi></mrow><annotation encoding="application/x-tex">2a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"/><span class="mord">2</span><span class="mord mathnormal">a</span></span></span></span></span>10$7JB720yubVSZv5W56jdb..6kcdWDR6rypQ.9lrH.jinlib.DfWd.</p>
<p>æ‰§è¡Œ SQL æ’å…¥ç®¡ç†å‘˜ï¼š
``</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> `sys_users` (`username`, `password`, `nickname`, `status`) 
<span class="hljs-keyword">VALUES</span> 
(<span class="hljs-string">'admin'</span>, <span class="hljs-string">'$2a$10$7JB720yubVSZv5W56jdb..6kcdWDR6rypQ.9lrH.jinlib.DfWd.'</span>, <span class="hljs-string">'è¶…çº§ç®¡ç†å‘˜'</span>, <span class="hljs-number">1</span>);
</code></pre>
<h2 data-id="heading-3">ä¸€ã€ è®¤è¯æµç¨‹è®¾è®¡</h2>
<p>åœ¨å¼€å§‹å†™ä»£ç å‰ï¼Œæˆ‘ä»¬éœ€è¦ç†æ¸…â€œèº«ä»½éªŒè¯â€çš„å®Œæ•´é“¾è·¯ã€‚è¿™å°±å¥½æ¯”å»åé«˜é“ï¼š</p>
<ol>
<li><strong>è´­ç¥¨ï¼ˆç™»å½•ï¼‰</strong> ï¼šç”¨æˆ·æäº¤è´¦å·å¯†ç ï¼ŒæœåŠ¡å™¨æ ¸éªŒé€šè¿‡åï¼Œå‘ä¸€å¼ â€œèº«ä»½è¯â€ï¼ˆTokenï¼‰ã€‚</li>
<li><strong>å®‰æ£€ï¼ˆæ‹¦æˆªå™¨ï¼‰</strong> ï¼šå‰ç«¯æ¯æ¬¡å‘è¯·æ±‚ï¼Œéƒ½è¦æŠŠâ€œèº«ä»½è¯â€æŒ‚åœ¨è¯·æ±‚å¤´é‡Œå¸¦ç»™æœåŠ¡å™¨ã€‚</li>
<li><strong>éªŒç¥¨ï¼ˆåç«¯ä¸­é—´ä»¶ï¼‰</strong> ï¼šæœåŠ¡å™¨æ£€æŸ¥â€œèº«ä»½è¯â€æ˜¯å¦ä¼ªé€ ã€æ˜¯å¦è¿‡æœŸã€‚</li>
<li><strong>è¿›ç«™ï¼ˆè·¯ç”±å®ˆå«ï¼‰</strong> ï¼šå‰ç«¯é¡µé¢è·³è½¬æ—¶ï¼Œæ£€æŸ¥æœ‰æ²¡æœ‰èº«ä»½è¯ã€‚å¦‚æœæœ‰ï¼Œå†æ£€æŸ¥æ˜¯å¦æ‹‰å–äº†ç”¨æˆ·ä¿¡æ¯ï¼ˆæƒé™ï¼‰ã€‚</li>
</ol>
<h2 data-id="heading-4">äºŒã€ åç«¯å®ç°ï¼šJWT é¢å‘ä¸éªŒç­¾</h2>
<p>æˆ‘ä»¬è¦ä½¿ç”¨Â jsonwebtokenÂ åº“æ¥ç”Ÿæˆå’ŒéªŒè¯ Tokenï¼Œä½¿ç”¨Â bcryptjsÂ æ¥æ¯”å¯¹å¯†ç ã€‚</p>
<p>å®‰è£…</p>
<pre><code class="hljs language-js" lang="js">npm i jsonwebtoken bcrypt
</code></pre>
<h3 data-id="heading-5">1. é…ç½®å¯†é’¥ (config.js)</h3>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•æ–°å»ºé…ç½®ï¼Œç”¨äºå­˜æ”¾åŠ å¯†å¯†é’¥ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">JWT_SECRET</span>: <span class="hljs-string">'my-super-secret-key-2025'</span>, <span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒè¯·æ”¾å…¥ç¯å¢ƒå˜é‡</span>
  <span class="hljs-attr">JWT_EXPIRES_IN</span>: <span class="hljs-string">'24h'</span> <span class="hljs-comment">// Token æœ‰æ•ˆæœŸ</span>
}
</code></pre>
<h3 data-id="heading-6">2. ç™»å½•æ¥å£ (routes/auth.js)</h3>
<p>ç™»å½•æ¥å£åªåšä¸€ä»¶äº‹ï¼š<strong>éªŒå¯†ç ï¼Œå‘ Token</strong>ã€‚ç”¨æˆ·ä¿¡æ¯æˆ‘ä»¬ç¨åé€šè¿‡å•ç‹¬æ¥å£è·å–ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> express <span class="hljs-keyword">from</span> <span class="hljs-string">'express'</span>
<span class="hljs-keyword">import</span> { body, validationResult } <span class="hljs-keyword">from</span> <span class="hljs-string">'express-validator'</span>
<span class="hljs-keyword">import</span> bcrypt <span class="hljs-keyword">from</span> <span class="hljs-string">'bcrypt'</span>
<span class="hljs-keyword">import</span> jwt <span class="hljs-keyword">from</span> <span class="hljs-string">'jsonwebtoken'</span>
<span class="hljs-keyword">import</span> { pool } <span class="hljs-keyword">from</span> <span class="hljs-string">'../db/mysql.js'</span>
<span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'../config.js'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">HttpError</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'../utils/HttpError.js'</span>
<span class="hljs-keyword">import</span> { authMiddleware } <span class="hljs-keyword">from</span> <span class="hljs-string">'../middleware/auth.js'</span> <span class="hljs-comment">// å¼•å…¥ä¿å®‰</span>

<span class="hljs-keyword">const</span> router = express.<span class="hljs-title class_">Router</span>()

<span class="hljs-comment">// 1. ç™»å½•æ¥å£ï¼šPOST /auth/login</span>
router.<span class="hljs-title function_">post</span>(
  <span class="hljs-string">'/login'</span>,
  [
    <span class="hljs-title function_">body</span>(<span class="hljs-string">'username'</span>).<span class="hljs-title function_">notEmpty</span>().<span class="hljs-title function_">withMessage</span>(<span class="hljs-string">'è´¦å·ä¸èƒ½ä¸ºç©º'</span>),
    <span class="hljs-title function_">body</span>(<span class="hljs-string">'password'</span>).<span class="hljs-title function_">notEmpty</span>().<span class="hljs-title function_">withMessage</span>(<span class="hljs-string">'å¯†ç ä¸èƒ½ä¸ºç©º'</span>),
  ],
  <span class="hljs-keyword">async</span> (req, res, next) =&gt; {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> errors = <span class="hljs-title function_">validationResult</span>(req)
      <span class="hljs-keyword">if</span> (!errors.<span class="hljs-title function_">isEmpty</span>()) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpError</span>(<span class="hljs-number">400</span>, errors.<span class="hljs-title function_">array</span>()[<span class="hljs-number">0</span>].<span class="hljs-property">msg</span>)

      <span class="hljs-keyword">const</span> { username, password } = req.<span class="hljs-property">body</span>

      <span class="hljs-keyword">const</span> [users] = <span class="hljs-keyword">await</span> pool.<span class="hljs-title function_">query</span>(
        <span class="hljs-string">'SELECT * FROM sys_users WHERE username = ?'</span>,
        [username]
      )

      <span class="hljs-keyword">if</span> (users.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpError</span>(<span class="hljs-number">400</span>, <span class="hljs-string">'è´¦å·æˆ–å¯†ç é”™è¯¯'</span>)
      <span class="hljs-keyword">const</span> user = users[<span class="hljs-number">0</span>]

      <span class="hljs-keyword">if</span> (user.<span class="hljs-property">status</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpError</span>(<span class="hljs-number">403</span>, <span class="hljs-string">'è´¦å·å·²è¢«åœç”¨'</span>)

      <span class="hljs-keyword">const</span> isMatch = <span class="hljs-keyword">await</span> bcrypt.<span class="hljs-title function_">compare</span>(password, user.<span class="hljs-property">password</span>)
      <span class="hljs-keyword">if</span> (!isMatch) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpError</span>(<span class="hljs-number">400</span>, <span class="hljs-string">'è´¦å·æˆ–å¯†ç é”™è¯¯'</span>)

      <span class="hljs-comment">// ç”Ÿæˆ Token</span>
      <span class="hljs-keyword">const</span> payload = {
        <span class="hljs-attr">username</span>: user.<span class="hljs-property">username</span>,
        <span class="hljs-attr">userId</span>: user.<span class="hljs-property">id</span>,
        <span class="hljs-attr">roleId</span>: user.<span class="hljs-property">role_id</span>,
        <span class="hljs-attr">isAdmin</span>: user.<span class="hljs-property">is_admin</span>,
      }
      <span class="hljs-keyword">const</span> token = jwt.<span class="hljs-title function_">sign</span>(payload, config.<span class="hljs-property">JWT_SECRET</span>, {
        <span class="hljs-attr">expiresIn</span>: config.<span class="hljs-property">JWT_EXPIRES_IN</span>,
      })
      res.<span class="hljs-title function_">json</span>({
        <span class="hljs-attr">code</span>: <span class="hljs-number">200</span>,
        <span class="hljs-attr">message</span>: <span class="hljs-string">'ç™»å½•æˆåŠŸ'</span>,
        <span class="hljs-attr">data</span>: { token },
      })
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Infoæ¥å£æŠ¥é”™:'</span>, err)
      <span class="hljs-title function_">next</span>(err)
    }
  }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router

</code></pre>
<h3 data-id="heading-7">3. è®¤è¯ä¸­é—´ä»¶ (middleware/auth.js)</h3>
<p>è¿™æ˜¯åç«¯çš„â€œä¿å®‰â€ï¼Œä¿æŠ¤éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„æ¥å£ï¼ˆå¦‚ç”¨æˆ·åˆ—è¡¨ã€ä¿®æ”¹å¯†ç ç­‰ï¼‰ã€‚</p>
<pre><code class="hljs language-js" lang="js">
<span class="hljs-keyword">import</span> jwt <span class="hljs-keyword">from</span> <span class="hljs-string">'jsonwebtoken'</span>
<span class="hljs-keyword">import</span> config <span class="hljs-keyword">from</span> <span class="hljs-string">'../config.js'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title function_">authMiddleware</span> = (<span class="hljs-params">req, res, next</span>) =&gt; {
  <span class="hljs-comment">// 1. è·å– Header: "Authorization: Bearer &lt;token&gt;"</span>
  <span class="hljs-keyword">const</span> authHeader = req.<span class="hljs-property">headers</span>.<span class="hljs-property">authorization</span>
  <span class="hljs-keyword">if</span> (!authHeader) <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">code</span>: <span class="hljs-number">401</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'æœªç™»å½•'</span> })

  <span class="hljs-comment">// 2. æå– Token</span>
  <span class="hljs-keyword">const</span> token = authHeader.<span class="hljs-title function_">split</span>(<span class="hljs-string">' '</span>)[<span class="hljs-number">1</span>]

  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">// 3. éªŒè¯å¹¶æŒ‚è½½ç”¨æˆ·ä¿¡æ¯</span>
    <span class="hljs-keyword">const</span> decoded = jwt.<span class="hljs-title function_">verify</span>(token, config.<span class="hljs-property">JWT_SECRET</span>)
    req.<span class="hljs-property">user</span> = decoded <span class="hljs-comment">// { userId: 1, iat: ..., exp: ... }</span>
    <span class="hljs-title function_">next</span>()
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">return</span> res.<span class="hljs-title function_">status</span>(<span class="hljs-number">401</span>).<span class="hljs-title function_">json</span>({ <span class="hljs-attr">code</span>: <span class="hljs-number">401</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">'Token æ— æ•ˆæˆ–å·²è¿‡æœŸ'</span> })
  }
}
</code></pre>
<h2 data-id="heading-8">ä¸‰ã€ å‰ç«¯å®ç°ï¼šçŠ¶æ€ç®¡ç†ä¸æ‹¦æˆªå™¨</h2>
<h3 data-id="heading-9">1. Pinia çŠ¶æ€ç®¡ç† (store/modules/user.ts)</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> { login, getUserInfo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/api/auth'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'@/router'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useUserStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'user'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">token</span>: <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'token'</span>) || <span class="hljs-string">''</span>,
    <span class="hljs-attr">userInfo</span>: {
      <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
      <span class="hljs-attr">roles</span>: [] <span class="hljs-keyword">as</span> string[],
      <span class="hljs-attr">avatar</span>: <span class="hljs-string">''</span>
    },
    <span class="hljs-comment">// å…³é”®ï¼šæ ‡è®°æ˜¯å¦å·²æ‹‰å–ç”¨æˆ·ä¿¡æ¯</span>
    <span class="hljs-attr">isInfoLoaded</span>: <span class="hljs-literal">false</span> 
  }),

  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">// 1. ç™»å½•ï¼šåªè´Ÿè´£å­˜ Token</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">loginForm: any</span>) {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: any = <span class="hljs-keyword">await</span> <span class="hljs-title function_">login</span>(loginForm)
      <span class="hljs-keyword">const</span> token = res.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = token
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">setItem</span>(<span class="hljs-string">'token'</span>, token)
    },

    <span class="hljs-comment">// 2. è·å–ä¿¡æ¯ï¼šç™»å½•åæ‹‰å–ï¼Œæˆ–è€…åˆ·æ–°é¡µé¢åæ‹‰å–</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">getInfo</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> <span class="hljs-attr">res</span>: any = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getUserInfo</span>()
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">userInfo</span> = res.<span class="hljs-property">data</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isInfoLoaded</span> = <span class="hljs-literal">true</span> <span class="hljs-comment">// æ ‡è®°å·²åŠ è½½</span>
      <span class="hljs-keyword">return</span> res
    },

    <span class="hljs-comment">// 3. é€€å‡ºï¼šæ¸…ç©ºæ‰€æœ‰çŠ¶æ€</span>
     <span class="hljs-title function_">logout</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// 1. æ¸…ç©º State</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = <span class="hljs-string">''</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">userInfo</span> = {
        <span class="hljs-attr">username</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">nickname</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">roles</span>: [],
        <span class="hljs-attr">avatar</span>: <span class="hljs-string">''</span>,
        <span class="hljs-attr">permissions</span>: [],
      }
      <span class="hljs-comment">// 2. æ¸…ç©º LocalStorage</span>
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'token'</span>)
      <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">removeItem</span>(<span class="hljs-string">'userInfo'</span>)
      <span class="hljs-comment">// --- é€€å‡ºæ—¶é‡ç½®ä¸º false ---</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isInfoLoaded</span> = <span class="hljs-literal">false</span>
      <span class="hljs-comment">// é‡å®šå‘åˆ°ç™»å½•</span>
      router.<span class="hljs-title function_">push</span>(<span class="hljs-string">'/login'</span>)
    },
  }
})
</code></pre>
<h3 data-id="heading-10">Axios æ‹¦æˆªå™¨ (utils/request.ts)</h3>
<ol>
<li><strong>è¯·æ±‚è‡ªåŠ¨æºå¸¦ Token</strong>ã€‚</li>
<li><strong>å“åº”è‡ªåŠ¨å¤„ç† 401 è¿‡æœŸ</strong>ã€‚</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> axios <span class="hljs-keyword">from</span> <span class="hljs-string">'axios'</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/modules/user'</span>
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">ElMessage</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'element-plus'</span>

<span class="hljs-keyword">const</span> service = axios.<span class="hljs-title function_">create</span>({ <span class="hljs-attr">baseURL</span>: <span class="hljs-string">'/'</span>, <span class="hljs-attr">timeout</span>: <span class="hljs-number">5000</span> })

<span class="hljs-comment">// è¯·æ±‚æ‹¦æˆª</span>
service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">request</span>.<span class="hljs-title function_">use</span>(<span class="hljs-function"><span class="hljs-params">config</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">if</span> (userStore.<span class="hljs-property">token</span>) {
    config.<span class="hljs-property">headers</span>.<span class="hljs-property">Authorization</span> = <span class="hljs-string">`Bearer <span class="hljs-subst">${userStore.token}</span>`</span>
  }
  <span class="hljs-keyword">return</span> config
})

<span class="hljs-comment">// å“åº”æ‹¦æˆª</span>
service.<span class="hljs-property">interceptors</span>.<span class="hljs-property">response</span>.<span class="hljs-title function_">use</span>(
  <span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-property">data</span>,
  <span class="hljs-function"><span class="hljs-params">error</span> =&gt;</span> {
    <span class="hljs-keyword">if</span> (error.<span class="hljs-property">response</span> &amp;&amp; error.<span class="hljs-property">response</span>.<span class="hljs-property">status</span> === <span class="hljs-number">401</span>) {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•'</span>)
      <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
      userStore.<span class="hljs-title function_">logout</span>() <span class="hljs-comment">// è§¦å‘é€€å‡º</span>
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title class_">ElMessage</span>.<span class="hljs-title function_">error</span>(error.<span class="hljs-property">message</span> || <span class="hljs-string">'ç³»ç»Ÿé”™è¯¯'</span>)
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(error)
  }
)

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> service

</code></pre>
<h2 data-id="heading-11">å››ã€ æ ¸å¿ƒéš¾ç‚¹ï¼šè·¯ç”±å®ˆå« (permission.ts)</h2>
<p>è¿™æ˜¯æ•´ä¸ªæƒé™ç³»ç»Ÿçš„æ§åˆ¶ä¸­æ¢ã€‚æˆ‘ä»¬éœ€è¦å¤„ç†å¥½â€œé¦–æ¬¡ç™»å½•â€å’Œâ€œåˆ·æ–°é¡µé¢â€ä¸¤ç§æƒ…å†µã€‚</p>
<p>åœ¨srcä¸‹æ–°å»ºpermission.tsï¼Œ</p>
<p><strong>å¸¸è§è¯¯åŒº</strong>ï¼š<br/>
å¾ˆå¤šäººä½¿ç”¨Â if (roles.length === 0)Â æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹‰å–ç”¨æˆ·ä¿¡æ¯ã€‚è¿™ä¼šå¯¼è‡´å¦‚æœä¸€ä¸ªæ–°ç”¨æˆ·æ²¡æœ‰ä»»ä½•è§’è‰²ï¼Œä»£ç ä¼šé™·å…¥æ­»å¾ªç¯ï¼ˆä¸æ–­è¯·æ±‚ï¼Œä¸æ–­ä¸ºç©ºï¼‰ã€‚</p>
<p><strong>æ­£ç¡®è§£æ³•</strong>ï¼š<br/>
ä½¿ç”¨ Store ä¸­çš„Â isInfoLoadedÂ å¸ƒå°”å€¼ä½œä¸ºåˆ¤æ–­ä¾æ®ã€‚</p>
<p>src/permission.ts</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'@/router'</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/modules/user'</span>
<span class="hljs-keyword">import</span> { usePermissionStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/store/modules/permission'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">NProgress</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'nprogress'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'nprogress/nprogress.css'</span>

<span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">configure</span>({ <span class="hljs-attr">showSpinner</span>: <span class="hljs-literal">false</span> })
<span class="hljs-keyword">const</span> whiteList = [<span class="hljs-string">'/login'</span>, <span class="hljs-string">'/404'</span>] <span class="hljs-comment">// ç™½åå•</span>

router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-keyword">async</span> (to, <span class="hljs-keyword">from</span>, next) =&gt; {
  <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">start</span>()
  <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
  <span class="hljs-keyword">const</span> permissionStore = <span class="hljs-title function_">usePermissionStore</span>()

  <span class="hljs-comment">// 1. åˆ¤æ–­æ˜¯å¦æœ‰ Token</span>
  <span class="hljs-keyword">if</span> (userStore.<span class="hljs-property">token</span>) {
    <span class="hljs-keyword">if</span> (to.<span class="hljs-property">path</span> === <span class="hljs-string">'/login'</span>) {
      <span class="hljs-comment">// å·²ç™»å½•åˆ™é‡å®šå‘åˆ°é¦–é¡µ</span>
      <span class="hljs-title function_">next</span>({ <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span> })
      <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// 2. åˆ¤æ–­æ˜¯å¦å·²æ‹‰å–è¿‡ç”¨æˆ·ä¿¡æ¯ (å…³é”®ï¼)</span>
      <span class="hljs-comment">// åªè¦ isInfoLoaded ä¸º trueï¼Œè¯´æ˜å·²ç»è¯·æ±‚è¿‡åç«¯äº†ï¼Œç›´æ¥æ”¾è¡Œ</span>
      <span class="hljs-keyword">if</span> (!userStore.<span class="hljs-property">isInfoLoaded</span>) {
        <span class="hljs-keyword">try</span> {
          <span class="hljs-comment">// 2.1 æ‹‰å–ç”¨æˆ·ä¿¡æ¯ (roles, permissions)</span>
          <span class="hljs-keyword">const</span> { roles } = <span class="hljs-keyword">await</span> userStore.<span class="hljs-title function_">getInfo</span>()
          
          <span class="hljs-comment">// 2.2 æ ¹æ®è§’è‰²ç”ŸæˆåŠ¨æ€ä¾§è¾¹æ è·¯ç”± (ä¸‹ä¸€ç¯‡åšå®¢è¯¦ç»†è®²)</span>
          <span class="hljs-keyword">const</span> accessRoutes = <span class="hljs-keyword">await</span> permissionStore.<span class="hljs-title function_">generateRoutes</span>()
          
          <span class="hljs-comment">// 2.3 åŠ¨æ€æ·»åŠ è·¯ç”±</span>
          accessRoutes.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">route</span> =&gt;</span> router.<span class="hljs-title function_">addRoute</span>(route))

          <span class="hljs-comment">// 2.4 ç¡®ä¿è·¯ç”±æ·»åŠ å®Œæ¯•ï¼Œä½¿ç”¨ replace æ¨¡å¼é‡å¯å®ˆå«</span>
          <span class="hljs-title function_">next</span>({ ...to, <span class="hljs-attr">replace</span>: <span class="hljs-literal">true</span> })
        } <span class="hljs-keyword">catch</span> (err) {
          <span class="hljs-comment">// æ‹‰å–å¤±è´¥ï¼ˆå¦‚ Token å¤±æ•ˆï¼‰ï¼Œé‡ç½®çŠ¶æ€å¹¶å»ç™»å½•é¡µ</span>
          userStore.<span class="hljs-title function_">logout</span>()
          <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>)
          <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å·²åŠ è½½è¿‡ä¿¡æ¯ï¼Œç›´æ¥æ”¾è¡Œ</span>
        <span class="hljs-title function_">next</span>()
      }
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-comment">// æ—  Tokenï¼Œåˆ¤æ–­ç™½åå•</span>
    <span class="hljs-keyword">if</span> (whiteList.<span class="hljs-title function_">includes</span>(to.<span class="hljs-property">path</span>)) {
      <span class="hljs-title function_">next</span>()
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-title function_">next</span>(<span class="hljs-string">`/login?redirect=<span class="hljs-subst">${to.path}</span>`</span>) <span class="hljs-comment">// è®°å½•åŸæœ¬æƒ³å»çš„é¡µé¢</span>
      <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()
    }
  }
})

router.<span class="hljs-title function_">afterEach</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title class_">NProgress</span>.<span class="hljs-title function_">done</span>()
})
</code></pre>
<h2 data-id="heading-12">äº”ã€ ç™»å½•é¡µé¢é€»è¾‘</h2>
<p>æœ€åï¼Œåœ¨ç™»å½•é¡µé¢ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦è°ƒç”¨Â userStore.loginï¼Œå¹¶åœ¨æˆåŠŸåå¤„ç†Â redirectÂ é‡å®šå‘å³å¯ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">handleLogin</span> = (<span class="hljs-params"/>) =&gt; {
  loginFormRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>(<span class="hljs-keyword">async</span> (valid) =&gt; {
    <span class="hljs-keyword">if</span> (valid) {
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">await</span> userStore.<span class="hljs-title function_">login</span>(loginForm)
        
        <span class="hljs-comment">// ç™»å½•æˆåŠŸåï¼Œè·³è½¬åˆ° query.redirect æŒ‡å‘çš„é¡µé¢ï¼Œæ²¡æœ‰åˆ™è·³é¦–é¡µ</span>
        <span class="hljs-keyword">const</span> { redirect } = route.<span class="hljs-property">query</span>
        router.<span class="hljs-title function_">push</span>((redirect <span class="hljs-keyword">as</span> string) || <span class="hljs-string">'/'</span>)
        
      } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(error)
      }
    }
  })
}
</code></pre>
<h2 data-id="heading-13">å…­ã€ æ€»ç»“</h2>
<p>é€šè¿‡æœ¬ç¯‡å®æˆ˜ï¼Œæˆ‘ä»¬å®Œæˆäº†ç³»ç»Ÿçš„â€œå®‰ä¿â€å·¥ä½œï¼š</p>
<ol>
<li><strong>åç«¯</strong>ï¼šå®ç°äº†åŸºäº JWT çš„æ— çŠ¶æ€è®¤è¯ã€‚</li>
<li><strong>å‰ç«¯</strong>ï¼šé€šè¿‡ Axios æ‹¦æˆªå™¨å®ç°äº† Token çš„è‡ªåŠ¨æºå¸¦ä¸è¿‡æœŸå¤„ç†ã€‚</li>
<li><strong>è·¯ç”±</strong>ï¼šé€šè¿‡Â isInfoLoadedÂ æ ‡å¿—ä½å®Œç¾è§£å†³äº†è·¯ç”±å®ˆå«çš„é€»è¾‘æ­»å¾ªç¯é—®é¢˜ã€‚</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é¡¹ç›®ä¸­å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨pnpm]]></title>    <link>https://juejin.cn/post/7579385656779112482</link>    <guid>https://juejin.cn/post/7579385656779112482</guid>    <pubDate>2025-12-03T07:46:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579385656779112482" data-draft-id="7579313396206747663" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é¡¹ç›®ä¸­å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨pnpm"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:46:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æš®ç´«æ"/> <meta itemprop="url" content="https://juejin.cn/user/1151943915081038"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é¡¹ç›®ä¸­å¦‚ä½•å¼ºåˆ¶ä½¿ç”¨pnpm
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943915081038/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æš®ç´«æ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:46:36.000Z" title="Wed Dec 03 2025 07:46:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h4 data-id="heading-0">. ä½¿ç”¨ packageManager å­—æ®µï¼ˆæ¨èï¼‰</h4>
<p>åœ¨é¡¹ç›®çš„ <strong><code>package.json</code></strong> ä¸­æ·»åŠ  <code>packageManager</code> å­—æ®µï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnpm%2Frfcs%2Fblob%2Fmain%2Fimplemented%2F0075-package-manager-field.md" target="_blank" title="https://github.com/npm/rfcs/blob/main/implemented/0075-package-manager-field.md" ref="nofollow noopener noreferrer">å®˜æ–¹è§„èŒƒ</a>ï¼‰ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">{
  <span class="hljs-string">"packageManager"</span>: <span class="hljs-string">"pnpm@9.15.7"</span>
}
</code></pre>
<h4 data-id="heading-1">2. æ·»åŠ  preinstall è„šæœ¬ï¼ˆå¼ºåˆ¶æ‹¦æˆªï¼‰</h4>
<p>åœ¨ <code>package.json</code> çš„ <code>scripts</code> ä¸­åŠ å…¥ä¸€ä¸ª <code>preinstall</code> è„šæœ¬ï¼Œæ£€æµ‹å½“å‰æ˜¯å¦ä¸º pnpmï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx only-allow pnpm"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><code>only-allow</code> æ˜¯ä¸€ä¸ªè½»é‡å·¥å…·ï¼Œä¼šé˜»æ­¢ä½¿ç”¨ npm/yarn å®‰è£…ä¾èµ–</p>
<ul>
<li>å½“æœ‰äººè¿è¡Œ <code>npm install</code> æˆ– <code>yarn</code> æ—¶ï¼Œä¼šç›´æ¥æŠ¥é”™å¹¶é€€å‡ºã€‚</li>
<li>éœ€è¦ç¡®ä¿ <code>only-allow</code> æœ¬èº«ä¸éœ€è¦è¢«å®‰è£…ï¼ˆå®ƒç”± <code>npx</code> ä¸´æ—¶è°ƒç”¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-2">3. æ–‡æ¡£è¯´æ˜ + .npmrcï¼ˆè¾…åŠ©ï¼‰</h4>
<ul>
<li>
<p>åœ¨ README ä¸­æ˜ç¡®è¯´æ˜ï¼šâ€œæœ¬é¡¹ç›®ä½¿ç”¨ pnpmï¼Œè¯·å…ˆå®‰è£… pnpm å¹¶ä½¿ç”¨ <code>pnpm install</code> å®‰è£…ä¾èµ–â€ã€‚</p>
</li>
<li>
<p>å¯é€‰ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  <code>.npmrc</code> æ–‡ä»¶ï¼Œè®¾ç½®ï¼š</p>
<h2 data-id="heading-3">ç¦ç”¨ npm è‡ªåŠ¨å®‰è£… peerDependenciesï¼ˆpnpm é»˜è®¤è¡Œä¸ºï¼‰</h2>
<h2 data-id="heading-4">å¹¶æé†’ç”¨æˆ·ä¸è¦ç”¨ npm</h2>
</li>
</ul>
<p>è™½ç„¶ä¸èƒ½å¼ºåˆ¶é˜»æ­¢ï¼Œä½†å¯é…åˆå…¶ä»–æ–¹å¼å¢å¼ºæç¤ºã€‚</p>
<h4 data-id="heading-5">æ€»ç»“ï¼ˆæ¨èç»„åˆï¼‰</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// package.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"packageManager"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"pnpm@9.15.7"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"preinstall"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"npx only-allow pnpm"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>è¿™æ ·æ—¢ç¬¦åˆç°ä»£è§„èŒƒï¼Œåˆèƒ½å¼ºåˆ¶æ‹¦æˆªé”™è¯¯çš„å®‰è£…æ–¹å¼ï¼Œé€‚åˆå›¢é˜Ÿåä½œé¡¹ç›®ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[VUE3é¡¹ç›®--ç»„ä»¶é€’å½’è°ƒç”¨è‡ªèº«]]></title>    <link>https://juejin.cn/post/7579440586693378094</link>    <guid>https://juejin.cn/post/7579440586693378094</guid>    <pubDate>2025-12-03T07:56:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579440586693378094" data-draft-id="7579427549470933038" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="VUE3é¡¹ç›®--ç»„ä»¶é€’å½’è°ƒç”¨è‡ªèº«"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:56:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·9381691255360"/> <meta itemprop="url" content="https://juejin.cn/user/3485906645565271"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            VUE3é¡¹ç›®--ç»„ä»¶é€’å½’è°ƒç”¨è‡ªèº«
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485906645565271/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·9381691255360
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:56:08.000Z" title="Wed Dec 03 2025 07:56:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç»„ä»¶ä¸­é€’å½’è°ƒç”¨è‡ªèº«æ—¶ï¼Œä¸€å®šè¦ç»™ç»„ä»¶èµ·ä¸ªåå­—ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// ç»„ä»¶çš„é€’å½’è°ƒç”¨ï¼Œéœ€è¦ä¸ºç»„ä»¶å®šä¹‰ä¸€ä¸ªåå­—</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'GGMenu'</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>ä¸‹é¢æ˜¯ç»„ä»¶çš„å®Œæ•´ä»£ç </p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"menu in menuList"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"menu.path"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!menu.children"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!menu.meta.hidden"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"menu.path"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"menu.meta.icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ menu.meta.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"menu.children &amp;&amp; menu.children.length == 1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-menu-item</span>
        <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!menu.children[0].hidden"</span>
        <span class="hljs-attr">:index</span>=<span class="hljs-string">"menu.children[0].path"</span>
      &gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"menu.children[0].meta.icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ menu.children[0].meta.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-menu-item</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">template</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"menu.children &amp;&amp; menu.children.length &gt; 1"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">el-sub-menu</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"!menu.meta.hidden"</span> <span class="hljs-attr">:index</span>=<span class="hljs-string">"menu.path"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">template</span> #<span class="hljs-attr">title</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">el-icon</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">:is</span>=<span class="hljs-string">"menu.meta.icon"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">el-icon</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>{{ menu.meta.title }}<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
        <span class="hljs-comment">&lt;!-- Menuç»„ä»¶çš„è‡ªèº«çš„é€’å½’è°ƒç”¨ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">GGMenu</span> <span class="hljs-attr">:menu-list</span>=<span class="hljs-string">"menu.children"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">GGMenu</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">el-sub-menu</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// è·å–çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„å…¨éƒ¨è·¯ç”±æ•°ç»„</span>
<span class="hljs-title function_">defineProps</span>([<span class="hljs-string">'menuList'</span>])
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-comment">// ç»„ä»¶çš„é€’å½’è°ƒç”¨ï¼Œéœ€è¦ä¸ºç»„ä»¶å®šä¹‰ä¸€ä¸ªåå­—</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'GGMenu'</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¦‚ä½•é˜²æ­¢æ¶æ„ä¼ªé€ å‰ç«¯å”¯ä¸€è¯·æ±‚id]]></title>    <link>https://juejin.cn/post/7579215538272632842</link>    <guid>https://juejin.cn/post/7579215538272632842</guid>    <pubDate>2025-12-03T07:59:58.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538272632842" data-draft-id="7579427549470982190" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¦‚ä½•é˜²æ­¢æ¶æ„ä¼ªé€ å‰ç«¯å”¯ä¸€è¯·æ±‚id"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T07:59:58.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/808832912075352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¦‚ä½•é˜²æ­¢æ¶æ„ä¼ªé€ å‰ç«¯å”¯ä¸€è¯·æ±‚id
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808832912075352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T07:59:58.000Z" title="Wed Dec 03 2025 07:59:58 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>å•çº¯ä¾èµ–å‰ç«¯æºå¸¦çš„å”¯ä¸€è¯·æ±‚IDï¼ˆå¦‚<code>Idempotent-Request-Id</code>ï¼‰ï¼Œç¡®å®å­˜åœ¨è¢«æ¶æ„ä¼ªé€ çš„é£é™©</strong>ï¼ˆæ¯”å¦‚æ”»å‡»è€…ä¼ªé€ ä»–äººçš„æœ‰æ•ˆIDã€é‡å¤ä½¿ç”¨å·²å¤±æ•ˆçš„IDã€ç”Ÿæˆéæ³•æ ¼å¼çš„IDï¼‰ï¼Œå¯èƒ½å¯¼è‡´ï¼šä»–äººè¯·æ±‚è¢«è¯¯æ‹¦æˆªã€æ¶æ„é‡å¤æ“ä½œç»•è¿‡å¹‚ç­‰æ ¡éªŒã€ç³»ç»Ÿèµ„æºè¢«æ»¥ç”¨ç­‰é—®é¢˜ã€‚</p>
<p>åœ¨ä¼ä¸šçº§å¼€å‘ä¸­ï¼Œé˜²æ­¢IDä¼ªé€ çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š<strong>ç»™â€œå”¯ä¸€è¯·æ±‚IDâ€åŠ ä¸Šâ€œèº«ä»½ç»‘å®š+åˆæ³•æ€§æ ¡éªŒ+æ—¶æ•ˆæ€§â€ï¼Œè®©IDåªèƒ½è¢«åˆæ³•ç”¨æˆ·åœ¨åˆæ³•æ—¶é—´å†…ç”¨äºåˆæ³•ä¸šåŠ¡</strong>ï¼Œè€Œéå­¤ç«‹åœ°æ ¡éªŒIDæœ¬èº«ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¼ä¸šçº§å¸¸ç”¨çš„ã€ä»æ˜“åˆ°éš¾çš„4å±‚é˜²æŠ¤æ–¹æ¡ˆï¼Œå¯æ ¹æ®ä¸šåŠ¡æ•æ„Ÿåº¦ï¼ˆå¦‚æ™®é€šè¡¨å•æäº¤vsæ”¯ä»˜è½¬è´¦ï¼‰ç»„åˆä½¿ç”¨ï¼š</p>
<h2 data-id="heading-0">ä¸€ã€åŸºç¡€é˜²æŠ¤ï¼šIDä¸ç”¨æˆ·èº«ä»½å¼ºç»‘å®šï¼ˆå¿…é€‰ï¼Œé›¶æˆæœ¬ï¼‰</h2>
<p>è¿™æ˜¯æœ€æ ¸å¿ƒã€æœ€å¸¸ç”¨çš„ä¸€å±‚é˜²æŠ¤ï¼Œä¹Ÿæ˜¯ä¹‹å‰åç«¯é€»è¾‘çš„å»¶ä¼¸â€”â€”<strong>è®©å”¯ä¸€è¯·æ±‚IDå’Œâ€œç”¨æˆ·èº«ä»½â€æ·±åº¦ç»‘å®š</strong>ï¼Œå³ä½¿IDè¢«ä¼ªé€ ï¼Œæ²¡æœ‰å¯¹åº”çš„ç”¨æˆ·èº«ä»½ä¹Ÿæ— æ³•ç”Ÿæ•ˆã€‚</p>
<h3 data-id="heading-1">å®ç°åŸç†</h3>
<p>åç«¯æ ¡éªŒå¹‚ç­‰æ—¶ï¼Œä¸ä»…è¦æ£€æŸ¥<code>Idempotent-Request-Id</code>æ˜¯å¦å­˜åœ¨ï¼Œè¿˜è¦ç¡®ä¿è¯¥IDå±äºå½“å‰è¯·æ±‚çš„åˆæ³•ç”¨æˆ·ï¼Œé¿å…â€œä¼ªé€ ä»–äººIDâ€å¯¼è‡´çš„è¯¯æ‹¦æˆªæˆ–æ¶æ„æ“ä½œã€‚</p>
<h3 data-id="heading-2">ä¼ä¸šçº§å®ç°æ–¹æ¡ˆï¼ˆå·²èå…¥ä¹‹å‰çš„åç«¯é€»è¾‘ï¼Œå¼ºåŒ–è¯´æ˜ï¼‰</h3>
<ol>
<li><strong>å‰ç«¯å¿…é¡»æºå¸¦ç”¨æˆ·èº«ä»½æ ‡è¯†</strong>ï¼šé™¤äº†<code>Idempotent-Request-Id</code>ï¼Œè¿˜éœ€æºå¸¦ç”¨æˆ·ç™»å½•åçš„åˆæ³•å‡­è¯ï¼ˆå¦‚<code>Token</code>/<code>JWT</code>ï¼‰ï¼Œåç«¯ä»å‡­è¯ä¸­è§£æå‡ºçœŸå®çš„<code>userId</code>ï¼ˆè€Œéå‰ç«¯å•ç‹¬ä¼ é€’<code>User-Id</code>è¯·æ±‚å¤´ï¼Œé¿å…ç¯¡æ”¹ï¼‰ï¼›</li>
<li><strong>åç«¯Redisé”®çš„æ„æˆ</strong>ï¼š<code>idempotent:${userId}:${requestURI}:${requestId}</code>ï¼ˆç”¨æˆ·ID+æ¥å£è·¯å¾„+è¯·æ±‚IDï¼‰ï¼Œä¸‰è€…ç¼ºä¸€ä¸å¯ï¼›</li>
<li><strong>æ ¸å¿ƒé€»è¾‘</strong>ï¼šå³ä½¿æ”»å‡»è€…ä¼ªé€ äº†ä¸€ä¸ªæœ‰æ•ˆçš„<code>requestId</code>ï¼Œä½†å¦‚æœæ— æ³•æä¾›å¯¹åº”çš„<code>userId</code>çš„åˆæ³•<code>Token</code>ï¼Œåç«¯è§£æå‡ºçš„<code>userId</code>ä¸åŒ¹é…ï¼ŒRedisé”®ä¹Ÿä¸ä¼šå‘½ä¸­ï¼Œæ— æ³•è§¦å‘é‡å¤æ‹¦æˆªï¼›åŒæ—¶ï¼Œä¸åŒç”¨æˆ·çš„IDå®Œå…¨éš”ç¦»ï¼Œä¸ä¼šç›¸äº’å½±å“ã€‚</li>
</ol>
<h3 data-id="heading-3">ä»£ç å¼ºåŒ–ï¼ˆåç«¯æ‹¦æˆªå™¨ä¿®æ”¹ï¼Œé˜²æ­¢<code>User-Id</code>è¢«ç¯¡æ”¹ï¼‰</h3>
<p>ä¹‹å‰çš„ä»£ç ä¸­<code>User-Id</code>æ˜¯å‰ç«¯ä¼ é€’çš„ï¼Œå­˜åœ¨è¢«ç¯¡æ”¹é£é™©ï¼Œä¼ä¸šçº§æ›´æ¨èä»<code>Token</code>è§£æï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¹‚ç­‰æ‹¦æˆªå™¨ï¼ˆIdempotentInterceptorï¼‰ä¿®æ”¹preHandleæ–¹æ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// ... çœç•¥å…¶ä»–é€»è¾‘ ...</span>

    <span class="hljs-comment">// å…³é”®ä¿®æ”¹ï¼šä»Tokenè§£æuserIdï¼Œè€Œéå‰ç«¯ä¼ é€’çš„User-Idè¯·æ±‚å¤´</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> request.getHeader(<span class="hljs-string">"Authorization"</span>);
    <span class="hljs-keyword">if</span> (token == <span class="hljs-literal">null</span> || token.trim().isEmpty()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"æœªç™»å½•ï¼Œè¯·å…ˆç™»å½•ï¼"</span>);
    }
    <span class="hljs-comment">// è§£æTokenï¼ˆä¼ä¸šçº§é€šå¸¸ç”¨JWTå·¥å…·ç±»ï¼Œè¿™é‡Œç®€åŒ–ï¼‰</span>
    <span class="hljs-type">Long</span> <span class="hljs-variable">userId</span> <span class="hljs-operator">=</span> parseUserIdFromToken(token); <span class="hljs-comment">// æ ¸å¿ƒï¼šä»åˆæ³•å‡­è¯ä¸­è·å–çœŸå®ç”¨æˆ·ID</span>
    <span class="hljs-keyword">if</span> (userId == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"Tokenæ— æ•ˆï¼Œæ— æ³•éªŒè¯èº«ä»½ï¼"</span>);
    }

    <span class="hljs-comment">// æ„å»ºRedisé”®ï¼ˆç”¨æˆ·ID+æ¥å£è·¯å¾„+è¯·æ±‚IDï¼‰ï¼Œé˜²æ­¢ä¼ªé€ </span>
    <span class="hljs-type">String</span> <span class="hljs-variable">redisKey</span> <span class="hljs-operator">=</span> String.format(<span class="hljs-string">"idempotent:%s:%s:%s"</span>, userId, request.getRequestURI(), requestId);

    <span class="hljs-comment">// ... åç»­Redisæ ¡éªŒé€»è¾‘ä¸å˜ ...</span>
}

<span class="hljs-comment">// ä»JWT Tokenè§£æç”¨æˆ·IDï¼ˆç¤ºä¾‹æ–¹æ³•ï¼‰</span>
<span class="hljs-keyword">private</span> Long <span class="hljs-title function_">parseUserIdFromToken</span><span class="hljs-params">(String token)</span> {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-comment">// ä¼ä¸šçº§å¸¸ç”¨JJWTå·¥å…·ç±»è§£æ</span>
        <span class="hljs-type">Claims</span> <span class="hljs-variable">claims</span> <span class="hljs-operator">=</span> Jwts.parser()
                .setSigningKey(<span class="hljs-string">"your-secret-key"</span>) <span class="hljs-comment">// ä¼ä¸šçº§éœ€ç”¨éå¯¹ç§°åŠ å¯†ï¼ˆå¦‚RSAï¼‰</span>
                .parseClaimsJws(token.replace(<span class="hljs-string">"Bearer "</span>, <span class="hljs-string">""</span>))
                .getBody();
        <span class="hljs-keyword">return</span> claims.get(<span class="hljs-string">"userId"</span>, Long.class);
    } <span class="hljs-keyword">catch</span> (Exception e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// Tokenæ— æ•ˆ</span>
    }
}
</code></pre>
<h3 data-id="heading-4">é˜²æŠ¤æ•ˆæœ</h3>
<ul>
<li>æ”»å‡»è€…æ— æ³•ä¼ªé€ ä»–äººçš„<code>userId</code>ï¼ˆéœ€ç ´è§£<code>Token</code>ï¼‰ï¼Œå³ä½¿ä¼ªé€ äº†<code>requestId</code>ï¼Œä¹Ÿå› <code>userId</code>ä¸åŒ¹é…è€Œæ— æ³•ç”Ÿæ•ˆï¼›</li>
<li>æœç»â€œä¼ªé€ ä»–äººIDå¯¼è‡´ä»–äººè¯·æ±‚è¢«æ‹¦æˆªâ€çš„é£é™©ã€‚</li>
</ul>
<h2 data-id="heading-5">äºŒã€è¿›é˜¶é˜²æŠ¤ï¼šIDåˆæ³•æ€§æ ¡éªŒï¼ˆé˜²æ­¢ä¼ªé€ éæ³•IDï¼‰</h2>
<p>åŸºç¡€é˜²æŠ¤è§£å†³äº†â€œèº«ä»½ç»‘å®šâ€é—®é¢˜ï¼Œä½†æ”»å‡»è€…å¯èƒ½ç”Ÿæˆå¤§é‡éæ³•æ ¼å¼çš„<code>requestId</code>ï¼ˆå¦‚è¶…é•¿å­—ç¬¦ä¸²ã€ç‰¹æ®Šå­—ç¬¦ï¼‰ï¼Œè¯•å›¾è€—å°½Redisèµ„æºï¼ˆæ¶æ„æ”»å‡»ï¼‰ã€‚è¿™ä¸€å±‚é˜²æŠ¤ç”¨äºæ ¡éªŒ<code>requestId</code>æœ¬èº«çš„åˆæ³•æ€§ã€‚</p>
<h3 data-id="heading-6">å®ç°æ–¹æ¡ˆ</h3>
<ol start="4">
<li><strong>å‰ç«¯è§„èŒƒIDæ ¼å¼</strong>ï¼šæ˜ç¡®<code>requestId</code>çš„ç”Ÿæˆè§„åˆ™ï¼ˆå¦‚UUIDv4ï¼Œ32ä½æ— æ¨ªçº¿å­—ç¬¦ä¸²ï¼Œæˆ–â€œæ—¶é—´æˆ³+8ä½éšæœºæ•°â€ï¼‰ï¼Œå¹¶åœ¨å‰ç«¯ä»£ç ä¸­å¼ºåˆ¶çº¦æŸï¼›</li>
<li><strong>åç«¯æ ¡éªŒIDæ ¼å¼</strong>ï¼šåœ¨æ‹¦æˆªå™¨ä¸­æ·»åŠ <code>requestId</code>çš„æ ¼å¼æ ¡éªŒï¼Œéæ³•æ ¼å¼ç›´æ¥æ‹’ç»ï¼Œä¸è¿›å…¥Rediså­˜å‚¨æµç¨‹ï¼›</li>
<li><strong>ä¼ä¸šçº§æ¨èæ ¼å¼</strong>ï¼šUUIDv4ï¼ˆ32ä½å­—æ¯æ•°å­—ç»„åˆï¼‰ï¼Œæ ¼å¼å›ºå®šï¼Œä¾¿äºæ ¡éªŒã€‚</li>
</ol>
<h3 data-id="heading-7">ä»£ç å®ç°ï¼ˆåç«¯æ‹¦æˆªå™¨æ·»åŠ æ ¼å¼æ ¡éªŒï¼‰</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¹‚ç­‰æ‹¦æˆªå™¨ä¸­ï¼Œè·å–requestIdåæ·»åŠ æ ¼å¼æ ¡éªŒ</span>
<span class="hljs-type">String</span> <span class="hljs-variable">requestId</span> <span class="hljs-operator">=</span> request.getHeader(IDEMPOTENT_REQUEST_ID);
<span class="hljs-keyword">if</span> (requestId == <span class="hljs-literal">null</span> || requestId.trim().isEmpty()) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"ç¼ºå°‘å¹‚ç­‰è¯·æ±‚IDï¼Œè¯·é‡è¯•ï¼"</span>);
}

<span class="hljs-comment">// æ ¡éªŒrequestIdæ ¼å¼ï¼ˆUUIDv4ï¼Œ32ä½å­—æ¯æ•°å­—ï¼‰</span>
<span class="hljs-type">String</span> <span class="hljs-variable">regex</span> <span class="hljs-operator">=</span> <span class="hljs-string">"^[0-9a-fA-F]{32}$"</span>;
<span class="hljs-keyword">if</span> (!requestId.matches(regex)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"å¹‚ç­‰è¯·æ±‚IDæ ¼å¼éæ³•ï¼Œè¯·è§„èŒƒè¯·æ±‚ï¼"</span>);
}
</code></pre>
<h3 data-id="heading-8">é˜²æŠ¤æ•ˆæœ</h3>
<ul>
<li>è¿‡æ»¤éæ³•æ ¼å¼çš„<code>requestId</code>ï¼Œé¿å…Rediså­˜å‚¨åƒåœ¾æ•°æ®ï¼Œé˜²æ­¢æ¶æ„æ”»å‡»è€—å°½Redisèµ„æºï¼›</li>
<li>å¢åŠ æ”»å‡»è€…ä¼ªé€ çš„éš¾åº¦ï¼ˆéœ€ç¬¦åˆç‰¹å®šæ ¼å¼ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-9">ä¸‰ã€æ•æ„Ÿåœºæ™¯é˜²æŠ¤ï¼šIDç­¾åæ ¡éªŒï¼ˆé˜²æ­¢ç¯¡æ”¹/ä¼ªé€ ï¼Œé€‚ç”¨äºæ”¯ä»˜ã€è½¬è´¦ï¼‰</h2>
<p>å¯¹äºæ”¯ä»˜ã€è½¬è´¦ã€è®¢å•åˆ›å»ºç­‰æ ¸å¿ƒæ•æ„Ÿåœºæ™¯ï¼Œä»…é èº«ä»½ç»‘å®šå’Œæ ¼å¼æ ¡éªŒè¿˜ä¸å¤Ÿâ€”â€”æ”»å‡»è€…å¯èƒ½çªƒå–åˆæ³•ç”¨æˆ·çš„<code>Token</code>å’Œ<code>requestId</code>ï¼ˆå¦‚é€šè¿‡ç½‘ç»œåŠ«æŒï¼‰ï¼Œè¿›è¡Œé‡æ”¾æ”»å‡»ã€‚æ­¤æ—¶éœ€è¦ç»™<code>requestId</code>åŠ ä¸Šâ€œç­¾åâ€ï¼Œç¡®ä¿IDæ˜¯ç”¨æˆ·çœŸå®ç”Ÿæˆçš„ï¼Œæœªè¢«ç¯¡æ”¹ã€‚</p>
<h3 data-id="heading-10">å®ç°åŸç†</h3>
<p>å‰ç«¯ç”Ÿæˆ<code>requestId</code>åï¼Œç”¨â€œç”¨æˆ·å”¯ä¸€å¯†é’¥+è¯·æ±‚å‚æ•°+æ—¶é—´æˆ³â€å¯¹<code>requestId</code>è¿›è¡Œç­¾åï¼Œåç«¯éªŒè¯ç­¾ååˆæ³•æ€§ï¼šåªæœ‰ç­¾åé€šè¿‡ï¼Œæ‰è®¤ä¸º<code>requestId</code>æ˜¯åˆæ³•çš„ï¼Œå¦åˆ™ç›´æ¥æ‹’ç»ã€‚</p>
<h3 data-id="heading-11">ä¼ä¸šçº§å®ç°æ­¥éª¤</h3>
<h4 data-id="heading-12">1. å‰ç«¯å®ç°ï¼ˆç”Ÿæˆç­¾åï¼‰</h4>
<ul>
<li>
<p>æ ¸å¿ƒé€»è¾‘ï¼š<code>ç­¾å = MD5(requestId + userId + æ—¶é—´æˆ³ + å¯†é’¥)</code>ï¼ˆå¯†é’¥éœ€å®‰å…¨å­˜å‚¨ï¼Œå¦‚å‰ç«¯ç¯å¢ƒå˜é‡ï¼Œé¿å…æ˜æ–‡å†™æ­»ï¼‰ï¼›</p>
</li>
<li>
<p>éœ€ä¼ é€’çš„è¯·æ±‚å¤´ï¼š</p>
<ul>
<li><code>Idempotent-Request-Id</code>ï¼šç”Ÿæˆçš„å”¯ä¸€IDï¼›</li>
<li><code>Idempotent-Timestamp</code>ï¼šç”ŸæˆIDæ—¶çš„æ—¶é—´æˆ³ï¼ˆç²¾ç¡®åˆ°ç§’ï¼‰ï¼›</li>
<li><code>Idempotent-Sign</code>ï¼šä¸Šè¿°ç­¾åï¼›</li>
<li><code>Authorization</code>ï¼šç”¨æˆ·<code>Token</code>ï¼ˆç”¨äºè§£æ<code>userId</code>ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å‰ç«¯ç”Ÿæˆç­¾åçš„å·¥å…·å‡½æ•°ï¼ˆVueç¤ºä¾‹ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">generateIdempotentSign</span> = (<span class="hljs-params">requestId, userId, timestamp, secretKey</span>) =&gt; {
  <span class="hljs-comment">// æ‹¼æ¥ç­¾ååŸæ–‡ï¼ˆrequestId+userId+æ—¶é—´æˆ³+å¯†é’¥ï¼‰</span>
  <span class="hljs-keyword">const</span> signStr = <span class="hljs-string">`<span class="hljs-subst">${requestId}</span><span class="hljs-subst">${userId}</span><span class="hljs-subst">${timestamp}</span><span class="hljs-subst">${secretKey}</span>`</span>;
  <span class="hljs-comment">// MD5åŠ å¯†ï¼ˆä¼ä¸šçº§å¯ç”¨SHA256ï¼Œå®‰å…¨æ€§æ›´é«˜ï¼‰</span>
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">CryptoJS</span>.<span class="hljs-title class_">MD5</span>(signStr).<span class="hljs-title function_">toString</span>();
};

<span class="hljs-comment">// ä¸‹å•è¯·æ±‚æ—¶æºå¸¦ç­¾å</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleCreateOrder</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> requestId = crypto.<span class="hljs-title function_">randomUUID</span>().<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/-/g</span>, <span class="hljs-string">''</span>); <span class="hljs-comment">// 32ä½UUID</span>
  <span class="hljs-keyword">const</span> timestamp = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() / <span class="hljs-number">1000</span>); <span class="hljs-comment">// æ—¶é—´æˆ³ï¼ˆç§’ï¼‰</span>
  <span class="hljs-keyword">const</span> userId = <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">'userId'</span>); <span class="hljs-comment">// ä»æœ¬åœ°å­˜å‚¨è·å–ï¼ˆéœ€ç¡®ä¿å·²ç™»å½•ï¼‰</span>
  <span class="hljs-keyword">const</span> secretKey = <span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">VITE_IDEMPOTENT_SECRET</span>; <span class="hljs-comment">// ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥ï¼ˆéæ˜æ–‡ï¼‰</span>

  <span class="hljs-comment">// ç”Ÿæˆç­¾å</span>
  <span class="hljs-keyword">const</span> sign = <span class="hljs-title function_">generateIdempotentSign</span>(requestId, userId, timestamp, secretKey);

  <span class="hljs-comment">// å‘é€è¯·æ±‚</span>
  <span class="hljs-keyword">const</span> res = <span class="hljs-keyword">await</span> axios.<span class="hljs-title function_">post</span>(
    <span class="hljs-string">'/order/create'</span>,
    { <span class="hljs-attr">productId</span>: <span class="hljs-number">1001</span>, <span class="hljs-attr">amount</span>: <span class="hljs-number">99.9</span> },
    {
      <span class="hljs-attr">headers</span>: {
        <span class="hljs-string">'Authorization'</span>: <span class="hljs-string">`Bearer <span class="hljs-subst">${<span class="hljs-variable language_">localStorage</span>.getItem(<span class="hljs-string">'token'</span>)}</span>`</span>,
        <span class="hljs-string">'Idempotent-Request-Id'</span>: requestId,
        <span class="hljs-string">'Idempotent-Timestamp'</span>: timestamp,
        <span class="hljs-string">'Idempotent-Sign'</span>: sign
      },
      <span class="hljs-attr">idempotent</span>: <span class="hljs-literal">true</span>
    }
  );
};
</code></pre>
<h4 data-id="heading-13">2. åç«¯å®ç°ï¼ˆéªŒè¯ç­¾åï¼‰</h4>
<ul>
<li>æ ¡éªŒæ—¶é—´æˆ³æœ‰æ•ˆæ€§ï¼ˆé˜²æ­¢ç­¾åè¢«é•¿æœŸå¤ç”¨ï¼‰ï¼›</li>
<li>ç”¨ç›¸åŒè§„åˆ™é‡æ–°è®¡ç®—ç­¾åï¼Œä¸å‰ç«¯ä¼ é€’çš„ç­¾åæ¯”å¯¹ï¼›</li>
<li>å¯†é’¥éœ€å‰åç«¯ä¸€è‡´ï¼Œä¼ä¸šçº§æ¨èåç«¯åŠ¨æ€ä¸‹å‘ä¸´æ—¶å¯†é’¥ï¼ˆè€Œéå›ºå®šå¯†é’¥ï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">// å¹‚ç­‰æ‹¦æˆªå™¨ä¸­æ·»åŠ ç­¾åæ ¡éªŒé€»è¾‘</span>
<span class="hljs-keyword">private</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">validateSign</span>(<span class="hljs-params">HttpServletRequest request, <span class="hljs-built_in">String</span> requestId, Long userId</span>) {
    <span class="hljs-comment">// 1. è·å–å‰ç«¯ä¼ é€’çš„æ—¶é—´æˆ³å’Œç­¾å</span>
    <span class="hljs-title class_">String</span> timestampStr = request.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">"Idempotent-Timestamp"</span>);
    <span class="hljs-title class_">String</span> sign = request.<span class="hljs-title function_">getHeader</span>(<span class="hljs-string">"Idempotent-Sign"</span>);
    <span class="hljs-keyword">if</span> (timestampStr == <span class="hljs-literal">null</span> || sign == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"ç¼ºå°‘å¹‚ç­‰ç­¾åä¿¡æ¯ï¼Œè¯·è§„èŒƒè¯·æ±‚ï¼"</span>);
    }

    <span class="hljs-comment">// 2. æ ¡éªŒæ—¶é—´æˆ³ï¼ˆæœ‰æ•ˆæœŸ5åˆ†é’Ÿï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ï¼‰</span>
    long timestamp = <span class="hljs-title class_">Long</span>.<span class="hljs-title function_">parseLong</span>(timestampStr);
    long currentTime = <span class="hljs-title class_">System</span>.<span class="hljs-title function_">currentTimeMillis</span>() / <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">abs</span>(currentTime - timestamp) &gt; <span class="hljs-number">300</span>) { <span class="hljs-comment">// 5åˆ†é’Ÿ=300ç§’</span>
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"è¯·æ±‚å·²è¿‡æœŸï¼Œè¯·é‡æ–°å‘èµ·ï¼"</span>);
    }

    <span class="hljs-comment">// 3. åç«¯é‡æ–°è®¡ç®—ç­¾åï¼ˆä¸å‰ç«¯è§„åˆ™ä¸€è‡´ï¼‰</span>
    <span class="hljs-title class_">String</span> secretKey = <span class="hljs-string">"your-frontend-secret"</span>; <span class="hljs-comment">// ä¼ä¸šçº§æ¨èåŠ¨æ€ä¸‹å‘ï¼Œè€Œéå›ºå®š</span>
    <span class="hljs-title class_">String</span> signStr = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">format</span>(<span class="hljs-string">"%s%s%s%s"</span>, requestId, userId, timestampStr, secretKey);
    <span class="hljs-title class_">String</span> serverSign = <span class="hljs-title class_">DigestUtils</span>.<span class="hljs-title function_">md5DigestAsHex</span>(signStr.<span class="hljs-title function_">getBytes</span>(<span class="hljs-title class_">StandardCharsets</span>.<span class="hljs-property">UTF_8</span>));

    <span class="hljs-comment">// 4. æ¯”å¯¹ç­¾åï¼ˆä¸ç›¸ç­‰åˆ™ä¸ºä¼ªé€ ï¼‰</span>
    <span class="hljs-keyword">if</span> (!serverSign.<span class="hljs-title function_">equalsIgnoreCase</span>(sign)) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IdempotentException</span>(<span class="hljs-string">"å¹‚ç­‰ç­¾åéæ³•ï¼Œè¯·æ±‚è¢«æ‹’ç»ï¼"</span>);
    }
}

<span class="hljs-comment">// åœ¨preHandleæ–¹æ³•ä¸­è°ƒç”¨ç­¾åæ ¡éªŒ</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-built_in">boolean</span> <span class="hljs-title function_">preHandle</span>(<span class="hljs-title class_">HttpServletRequest</span> request, <span class="hljs-title class_">HttpServletResponse</span> response, <span class="hljs-title class_">Object</span> handler) throws <span class="hljs-title class_">Exception</span> {
    <span class="hljs-comment">// ... çœç•¥å‰é¢çš„é€»è¾‘ï¼ˆè·å–requestIdã€è§£æuserIdï¼‰ ...</span>

    <span class="hljs-comment">// æ•æ„Ÿåœºæ™¯æ·»åŠ ç­¾åæ ¡éªŒ</span>
    <span class="hljs-title function_">validateSign</span>(request, requestId, userId);

    <span class="hljs-comment">// ... åç»­Redisæ ¡éªŒé€»è¾‘ ...</span>
}
</code></pre>
<h3 data-id="heading-14">é˜²æŠ¤æ•ˆæœ</h3>
<ul>
<li>å³ä½¿æ”»å‡»è€…çªƒå–äº†<code>requestId</code>ã€<code>Token</code>ï¼Œä¹Ÿæ— æ³•ä¼ªé€ ç­¾åï¼ˆç¼ºå°‘å¯†é’¥å’Œæ—¶é—´æˆ³ï¼‰ï¼›</li>
<li>æ—¶é—´æˆ³æœ‰æ•ˆæœŸé™åˆ¶ï¼Œé˜²æ­¢ç­¾åè¢«é•¿æœŸå¤ç”¨ï¼ˆé‡æ”¾æ”»å‡»ï¼‰ï¼›</li>
<li>é€‚ç”¨äºæ”¯ä»˜ã€è½¬è´¦ç­‰æ ¸å¿ƒæ•æ„Ÿåœºæ™¯ï¼Œæ˜¯ä¼ä¸šçº§é«˜å®‰å…¨è¦æ±‚çš„æ ‡å‡†é…ç½®ã€‚</li>
</ul>
<h2 data-id="heading-15">å››ã€ç»ˆæé˜²æŠ¤ï¼šç»“åˆä¸šåŠ¡ä¸Šä¸‹æ–‡æ ¡éªŒï¼ˆé˜²æ­¢IDè¢«æ»¥ç”¨ï¼‰</h2>
<p>å¯¹äºæç«¯æ•æ„Ÿçš„åœºæ™¯ï¼ˆå¦‚å¤§é¢è½¬è´¦ã€æ ¸å¿ƒè®¢å•æ“ä½œï¼‰ï¼Œè¿˜éœ€è¦å°†<code>requestId</code>ä¸â€œä¸šåŠ¡å‚æ•°â€ç»‘å®šï¼Œç¡®ä¿IDä»…ç”¨äºç‰¹å®šä¸šåŠ¡ï¼Œé˜²æ­¢æ”»å‡»è€…ç”¨Aä¸šåŠ¡çš„æœ‰æ•ˆIDå»è¯·æ±‚Bä¸šåŠ¡ã€‚</p>
<h3 data-id="heading-16">å®ç°åŸç†</h3>
<p>åç«¯Redisé”®ä¸­åŠ å…¥â€œä¸šåŠ¡å”¯ä¸€æ ‡è¯†â€ï¼ˆå¦‚å•†å“IDã€è®¢å•å·ã€è½¬è´¦é‡‘é¢ï¼‰ï¼Œç¡®ä¿<code>requestId</code>åªèƒ½ç”¨äºè¯¥ä¸šåŠ¡ï¼Œæ— æ³•è·¨ä¸šåŠ¡å¤ç”¨ã€‚</p>
<h3 data-id="heading-17">ä»£ç ç¤ºä¾‹ï¼ˆRedisé”®æ·»åŠ ä¸šåŠ¡å‚æ•°ï¼‰</h3>
<pre><code class="hljs language-ini" lang="ini">// ä¸‹å•æ¥å£çš„å¹‚ç­‰Redisé”®ï¼ˆæ·»åŠ å•†å“IDï¼‰
String <span class="hljs-attr">productId</span> = request.getParameter(<span class="hljs-string">"productId"</span>)<span class="hljs-comment">; // ä»è¯·æ±‚å‚æ•°ä¸­è·å–ä¸šåŠ¡å‚æ•°</span>
String <span class="hljs-attr">redisKey</span> = String.format(<span class="hljs-string">"idempotent:%s:%s:%s:%s"</span>, userId, request.getRequestURI(), requestId, productId)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-18">é˜²æŠ¤æ•ˆæœ</h3>
<ul>
<li>æ”»å‡»è€…å³ä½¿è·å–äº†ä¸‹å•æ¥å£çš„<code>requestId</code>ï¼Œä¹Ÿæ— æ³•ç”¨å®ƒå»è¯·æ±‚æ”¯ä»˜æ¥å£æˆ–å…¶ä»–å•†å“çš„ä¸‹å•æ¥å£ï¼›</li>
<li>è¿›ä¸€æ­¥ç¼©å°<code>requestId</code>çš„é€‚ç”¨èŒƒå›´ï¼Œé˜²æ­¢è·¨ä¸šåŠ¡æ»¥ç”¨ã€‚</li>
</ul>
<h2 data-id="heading-19">äº”ã€ä¼ä¸šçº§æ–¹æ¡ˆé€‰å‹å»ºè®®ï¼ˆæŒ‰ä¸šåŠ¡æ•æ„Ÿåº¦åŒ¹é…ï¼‰</h2>





























<table><thead><tr><th>ä¸šåŠ¡åœºæ™¯</th><th>æ¨èé˜²æŠ¤ç»„åˆ</th><th>å®‰å…¨ç­‰çº§</th><th>å¼€å‘æˆæœ¬</th></tr></thead><tbody><tr><td>æ™®é€šè¡¨å•æäº¤ï¼ˆå¦‚ä¸ªäººèµ„æ–™ä¿®æ”¹ï¼‰</td><td>èº«ä»½ç»‘å®šï¼ˆTokenè§£æuserIdï¼‰+ IDæ ¼å¼æ ¡éªŒ</td><td>ä¸­</td><td>ä½</td></tr><tr><td>è®¢å•åˆ›å»ºã€æ™®é€šæ”¯ä»˜</td><td>èº«ä»½ç»‘å®š + IDæ ¼å¼æ ¡éªŒ + æ—¶é—´æˆ³</td><td>ä¸­é«˜</td><td>ä¸­</td></tr><tr><td>å¤§é¢æ”¯ä»˜ã€è½¬è´¦ã€æ ¸å¿ƒè®¢å•</td><td>èº«ä»½ç»‘å®š + IDæ ¼å¼æ ¡éªŒ + ç­¾åæ ¡éªŒ + ä¸šåŠ¡ä¸Šä¸‹æ–‡æ ¡éªŒ</td><td>é«˜</td><td>ä¸­é«˜</td></tr></tbody></table>
<h2 data-id="heading-20">å…³é”®æ³¨æ„ç‚¹ï¼ˆä¼ä¸šçº§é¿å‘ï¼‰</h2>
<ol start="7">
<li><strong>å¯†é’¥å®‰å…¨</strong>ï¼šå‰ç«¯ç­¾åç”¨çš„å¯†é’¥ï¼Œä¸èƒ½æ˜æ–‡å†™åœ¨ä»£ç ä¸­ï¼Œéœ€ç”¨ç¯å¢ƒå˜é‡ï¼ˆå¦‚<code>VITE_XXX</code>ï¼‰æˆ–åç«¯åŠ¨æ€ä¸‹å‘ï¼ˆå¦‚ç™»å½•åè¿”å›ä¸´æ—¶å¯†é’¥ï¼Œæœ‰æ•ˆæœŸ1å°æ—¶ï¼‰ï¼›</li>
<li><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼šæ•æ„Ÿåœºæ™¯çš„ç­¾åï¼Œæ¨èç”¨RSAéå¯¹ç§°åŠ å¯†ï¼ˆå‰ç«¯ç”¨å…¬é’¥åŠ å¯†ï¼Œåç«¯ç”¨ç§é’¥è§£å¯†ï¼‰ï¼Œé¿å…å¯†é’¥æ³„éœ²ï¼›</li>
<li><strong>Tokenå®‰å…¨</strong>ï¼šå¿…é¡»ç”¨HTTPSä¼ è¾“<code>Token</code>å’Œ<code>requestId</code>ï¼Œé˜²æ­¢ç½‘ç»œåŠ«æŒçªƒå–ï¼›</li>
<li><strong>ä¸ä¾èµ–å‰ç«¯å•ç‹¬ä¼ é€’ç”¨æˆ·èº«ä»½</strong>ï¼šå§‹ç»ˆä»<code>Token</code>/<code>Session</code>è§£æ<code>userId</code>ï¼Œæ‹’ç»å‰ç«¯ä¼ é€’çš„<code>User-Id</code>ï¼ˆæ˜“è¢«ç¯¡æ”¹ï¼‰ã€‚</li>
</ol>
<h3 data-id="heading-21">æ€»ç»“</h3>
<ol start="11">
<li><strong>æ ¸å¿ƒç»“è®º</strong>ï¼šé˜²æ­¢å”¯ä¸€è¯·æ±‚IDä¼ªé€ ï¼Œä¼ä¸šçº§çš„æ ¸å¿ƒæ˜¯â€œ<strong>èº«ä»½ç»‘å®š+åˆæ³•æ€§æ ¡éªŒ</strong>â€ï¼Œæ•æ„Ÿåœºæ™¯å åŠ â€œç­¾åæ ¡éªŒ+ä¸šåŠ¡ä¸Šä¸‹æ–‡æ ¡éªŒâ€ï¼Œè€Œéå­¤ç«‹æ ¡éªŒIDæœ¬èº«ï¼›</li>
<li><strong>æ–¹æ¡ˆç‰¹ç‚¹</strong>ï¼šä»åŸºç¡€åˆ°è¿›é˜¶ï¼Œæˆæœ¬é€æ­¥æå‡ï¼Œå®‰å…¨ç­‰çº§ä¹Ÿé€æ­¥æé«˜ï¼Œå¯æ ¹æ®ä¸šåŠ¡æ•æ„Ÿåº¦çµæ´»ç»„åˆï¼›</li>
<li><strong>è½åœ°å»ºè®®</strong>ï¼šå…ˆå®ç°â€œèº«ä»½ç»‘å®šï¼ˆTokenè§£æuserIdï¼‰+ IDæ ¼å¼æ ¡éªŒâ€ï¼ˆé›¶æˆæœ¬ã€é«˜æ”¶ç›Šï¼‰ï¼Œæ ¸å¿ƒåœºæ™¯å†å åŠ ç­¾åæ ¡éªŒï¼Œæ— éœ€è¿‡åº¦è®¾è®¡ï¼›</li>
<li><strong>æœ¬è´¨é€»è¾‘</strong>ï¼šè®©â€œå”¯ä¸€è¯·æ±‚IDâ€æˆä¸ºâ€œç”¨æˆ·èº«ä»½+ä¸šåŠ¡åœºæ™¯+æ—¶é—´çª—å£â€çš„å¤åˆæ ‡è¯†ï¼Œä¼ªé€ è€…éœ€åŒæ—¶ç ´è§£å¤šä¸ªç»´åº¦æ‰èƒ½ç”Ÿæ•ˆï¼Œéš¾åº¦æŒ‡æ•°çº§æå‡ã€‚</li>
</ol>
<p>æŒ‰è¿™å¥—æ–¹æ¡ˆå®ç°åï¼Œå°±èƒ½æœ‰æ•ˆæŠµå¾¡ç»å¤§å¤šæ•°æ¶æ„ä¼ªé€ å”¯ä¸€è¯·æ±‚IDçš„æ”»å‡»ï¼Œå®Œå…¨æ»¡è¶³ä¼ä¸šçº§åº”ç”¨çš„å®‰å…¨è¦æ±‚ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥]]></title>    <link>https://juejin.cn/post/7579192114828574747</link>    <guid>https://juejin.cn/post/7579192114828574747</guid>    <pubDate>2025-12-03T06:20:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579192114828574747" data-draft-id="7579176524131827763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥"/> <meta itemprop="keywords" content="åç«¯,å¤§æ•°æ®,Elasticsearch"/> <meta itemprop="datePublished" content="2025-12-03T06:20:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ­¦å­åº·"/> <meta itemprop="url" content="https://juejin.cn/user/149189314230039"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/149189314230039/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ­¦å­åº·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:20:29.000Z" title="Wed Dec 03 2025 06:20:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">TL;DR</h2>
<ul>
<li>åœºæ™¯ï¼šåœ¨å•æœºæˆ–å°é›†ç¾¤ç¯å¢ƒï¼Œå®Œæˆç´¢å¼• CRUDã€å¥åº·æ£€æŸ¥ä¸ IK è¿œç¨‹è¯å…¸é…ç½®ã€‚</li>
<li>ç»“è®ºï¼šIK å¿…é¡»ä¸ ES ç‰ˆæœ¬åŒ¹é…ï¼›é‡å¯åç”¨ _analyze æ ¡éªŒï¼›ç´¢å¼•è§‚æµ‹ç”¨ _cat/indices æ›´ç¨³ã€‚</li>
<li>äº§å‡ºï¼šå¯ç›´æ¥å¤ç”¨çš„å‘½ä»¤æ¸…å•ã€è¿œç¨‹è¯å…¸éƒ¨ç½²è¦ç‚¹ã€å¸¸è§æ•…éšœå®šä½ä¸ä¿®å¤è¡¨ã€‚</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbde3cd0331c42b3874d60a08dbb444a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=1e%2B6l6PrjEsanVeW4bwCSrwCgcM%3D" alt="å¤§æ•°æ®-172 Elasticsearch ç´¢å¼•æ“ä½œä¸ IK åˆ†è¯å™¨è½åœ°å®æˆ˜ï¼š7.3/8.15 å…¨æµç¨‹é€ŸæŸ¥" loading="lazy"/></p>
<h2 data-id="heading-1">ç‰ˆæœ¬çŸ©é˜µ</h2>















































<table><thead><tr><th>ç»„ä»¶/ç‰¹æ€§</th><th>ç‰ˆæœ¬/å‘½ä»¤</th><th>å·²éªŒè¯</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>Elasticsearch</td><td>7.3.0</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td>ç´¢å¼• CRUDã€<code>_cat/indices?v</code>ã€å¥åº·åº¦å«ä¹‰ä¸€è‡´ï¼›IK éœ€ç”¨ 7.3.0 åŒ¹é…åŒ…ã€‚</td></tr><tr><td>Elasticsearch</td><td>8.15.0</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td>IK ç›®å½•ä¸º <code>plugins/analysis-ik</code>ï¼›è¿œç¨‹è¯å…¸é€šè¿‡ <code>IKAnalyzer.cfg.xml</code> åŠ è½½åé‡å¯ç”Ÿæ•ˆã€‚</td></tr><tr><td>IK åˆ†è¯å™¨</td><td>7.3.0</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td><code>ik_max_word</code>/<code>ik_smart</code> <code>_analyze</code> é€šè¿‡ã€‚</td></tr><tr><td>IK åˆ†è¯å™¨</td><td>8.xï¼ˆä¸ ES åŒ minorï¼‰</td><td>å»ºè®®å¯¹é½</td><td>è·¨å¤§/å°ç‰ˆæœ¬å¯èƒ½åŠ è½½å¤±è´¥ï¼›ä»¥å¯¹åº” release ä¸ºå‡†ã€‚</td></tr><tr><td>è¿œç¨‹æ‰©å±•è¯å…¸</td><td>Nginx é™æ€æ‰˜ç®¡</td><td>æ˜¯ï¼ˆä½œè€…ç¯å¢ƒï¼‰</td><td><code>ext_dict.dic</code>ã€<code>stop_dict.dic</code> ä»¥ UTF-8 æ—  BOM æä¾›ï¼ŒHTTP å¯è¾¾ã€‚</td></tr><tr><td>æŸ¥è¯¢æ‰€æœ‰ç´¢å¼•</td><td><code>GET _all</code> / <code>_cat/indices?v</code></td><td>éƒ¨åˆ†</td><td>å®æˆ˜æ›´æ¨è <code>_cat/indices</code>ï¼›<code>_all</code> åœ¨éƒ¨åˆ†ç‰ˆæœ¬ä¸ç¨³å®š/ä¸æ¨èã€‚</td></tr></tbody></table>
<h4 data-id="heading-2">æ³¨æ„äº‹é¡¹</h4>
<ol>
<li>ä»£ç ç›¸å…³éƒ¨åˆ†ï¼ˆå¦‚å‘½ä»¤ã€æ–‡ä»¶åï¼‰ä½¿ç”¨åå¼•å· <code>`</code> åŒ…è£¹ã€‚</li>
<li>è¡¨æ ¼å¯¹é½é€šè¿‡è°ƒæ•´åˆ—å®½å’Œæ–‡æœ¬æ¢è¡Œä¼˜åŒ–å¯è¯»æ€§ã€‚</li>
<li>ç‰ˆæœ¬å·ä¸å‘½ä»¤æ··åˆçš„å•å…ƒæ ¼é€šè¿‡åˆ†è¡Œæˆ–æ‹¬å·æ³¨æ˜ä¿æŒæ¸…æ™°ã€‚</li>
</ol>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9609434e3aeb4ccfb81291114c99a3c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=6xb6n0ItEEP%2BmwcF4m5sNz7sg8c%3D" alt="Elasticsearch" loading="lazy"/></p>
<h2 data-id="heading-3">ç´¢å¼•æ“ä½œ</h2>
<h3 data-id="heading-4">åˆ›å»ºç´¢å¼•åº“</h3>
<p>Elasticsearché‡‡ç”¨Resté£æ ¼APIï¼Œå› æ­¤å…¶APIå°±æ˜¯ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œä½ å¯ä»¥ç”¨ä»»ä½•å·¥å…·æ¥å‘èµ·HTTPè¯·æ±‚ã€‚
è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">PUT /ç´¢å¼•åç§°
{
  "settings": {
    "å±æ€§å": "å±æ€§å€¼"
  }
}
</code></pre>
<p>settingsï¼šå°±æ˜¯ç´¢å¼•åº“è®¾ç½®ï¼Œå…¶ä¸­å¯ä»¥ç´¢å¼•åº“çš„å„ç§å±æ€§ï¼Œæ¯”å¦‚åˆ†ç‰‡æ•°ã€å‰¯æœ¬æ•°ç­‰ã€‚ç›®å‰æˆ‘ä»¬ä¸è®¾ç½®ï¼Œå…ˆé»˜è®¤å³å¯ã€‚
ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">PUT /wzkicu-index

</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1deb25f3aaa0436499124862c212dafb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=pi3W3v3LKRXUMQKk3UcoClDh5ak%3D" alt="wzk-index" loading="lazy"/></p>
<h3 data-id="heading-5">åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨</h3>
<h4 data-id="heading-6">å•ä¸ªç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /ç´¢å¼•åç§°
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /wzkicu-index
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6240c87dc76b4312a1f77d23379ac994~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=LL%2Ff%2BlR6HgSMM3A2t5JeQJ0q2%2BM%3D" alt="åˆ¤æ–­ç´¢å¼•æ˜¯å¦å­˜åœ¨" loading="lazy"/></p>
<h4 data-id="heading-7">å¤šä¸ªç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /ç´¢å¼•åç§°1,2,3,4,5...
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /wzkicu-index,wzkicu,wzk
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆè¿™é‡Œæœ‰ä¸å­˜åœ¨çš„ç´¢å¼•ï¼Œæ‰€ä»¥404äº†ï¼‰
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d74fc19b7c1444a4afd21e23a600de77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=a9A64wMOHgD%2FlMP5xBKqMIn2Wkc%3D" alt="å¤šä¸ªç´¢å¼•" loading="lazy"/></p>
<h4 data-id="heading-8">æ‰€æœ‰ç´¢å¼•</h4>
<p>æ–¹å¼1ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET _all
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb89ad5d36dd4080a24c0d5d79fc0419~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=P%2FRNogFVcOM69i3WWd4DxC8q%2BEw%3D" alt="æŸ¥çœ‹æ‰€æœ‰ç´¢å¼•" loading="lazy"/>
æ–¹å¼2ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">GET /_cat/indices?v
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1af1de0bf1da4fc6982e76b0a78fe394~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=Y%2BMKmRP8h%2BNUNedTwwwLFohbIrA%3D" alt="æ£€æŸ¥æ‰€æœ‰ç´¢å¼•å¥åº·åº¦" loading="lazy"/>
è¿™é‡Œçš„healthåˆ—ï¼Œè¡¨ç¤ºï¼š</p>
<ul>
<li>ç»¿è‰²ï¼šç´¢å¼•çš„æ‰€æœ‰åˆ†ç‰‡éƒ½æ­£å¸¸åˆ†é…</li>
<li>é»„è‰²ï¼šè‡³å°‘æœ‰ä¸€ä¸ªå‰¯æœ¬æ²¡æœ‰å¾—åˆ°æ­£ç¡®çš„åˆ†é…</li>
<li>çº¢è‰²ï¼šè‡³å°‘æœ‰ä¸€ä¸ªä¸»åˆ†ç‰‡æ²¡æœ‰å¾—åˆ°æ­£å¸¸çš„åˆ†é…</li>
</ul>
<h4 data-id="heading-9">æ‰“å¼€ç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /ç´¢å¼•åç§°/_open
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /wzkicu-index/_open
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6abff34c8d244c73a1a0f246701f6ccd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=GOEQtNPgmIvd74xgpS91hs%2B2pxI%3D" alt="æ‰“å¼€ç´¢å¼•" loading="lazy"/></p>
<h3 data-id="heading-10">å…³é—­ç´¢å¼•</h3>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /ç´¢å¼•åç§°/_close
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">POST /wzkicu-index/_close
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/59ff4f89f6664eadabdd37d8fbd5436e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=ukGvb1YvT4jcjF5mvUVxo%2BJp4Cs%3D" alt="å…³é—­ç´¢å¼•" loading="lazy"/></p>
<h4 data-id="heading-11">åˆ é™¤ç´¢å¼•</h4>
<p>è¯­æ³•ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">DELETE /ç´¢å¼•åç§°1,2,3,4,5...
</code></pre>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">DELETE /wzkicu-index
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef9703fde631421282544ca118823d8b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=3sJzANHVE2cEPrNks0Zt2R9h%2Bg8%3D" alt="åˆ é™¤ç´¢å¼•" loading="lazy"/></p>
<h2 data-id="heading-12">IKåˆ†è¯å™¨</h2>
<h3 data-id="heading-13">ä¸‹è½½é¡¹ç›®</h3>
<p>å®˜æ–¹åœ°å€åœ¨è¿™é‡Œï¼Œæ˜¯GitHubå¼€æºçš„é¡¹ç›®ï¼Œå®‰è£…æ–¹å¼å¾ˆå¤šï¼Œæˆ‘è¿™é‡Œå°±ç›´æ¥ç”¨å®˜æ–¹çš„æ–¹å¼å®‰è£…äº†ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">https://github.com/infinilabs/analysis-ik/releases/tag/Latest
</code></pre>
<p>é¡µé¢æ˜¯è¿™æ ·çš„ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3b011b1be62146fd8faa8e45089801f4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=tSg6sXOVRMTo8JZ0zMJ8QwTRgRY%3D" alt="IKåˆ†è¯å™¨" loading="lazy"/></p>
<h3 data-id="heading-14">å®‰è£…æ’ä»¶</h3>
<pre><code class="hljs language-shell" lang="shell">cd /opt/servers/elasticsearch-7.3.0/
bin/elasticsearch-plugin install https://get.infini.cloud/elasticsearch/analysis-ik/7.3.0
</code></pre>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬éœ€è¦é‡å¯ESï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ef2da614d28b467ca16d12f012811f3c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=%2F%2BUaj0XNyxbdVhHUmj1wCZ0dI9o%3D" alt="å®‰è£…æ’ä»¶" loading="lazy"/></p>
<h3 data-id="heading-15">é‡å¯ES</h3>
<p>é‡å¯è¿‡ç¨‹ï¼Œå¯åŠ¨å®Œæ¯•ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17973a9d18fe4be4b3dfb0190ab53fa5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=N72DpWc9ww4cvpefo3RZ84H5wy8%3D" alt="é‡å¯ES" loading="lazy"/></p>
<h3 data-id="heading-16">åˆ†è¯æµ‹è¯•</h3>
<p>IKåˆ†è¯å™¨ä¸¤ç§åˆ†è¯æ¨¡å¼ï¼š</p>
<ul>
<li>ik_max_word æ¨¡å¼ ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼ˆä¼šå°†æ–‡æœ¬æœ€ç»†ç²’åº¦çš„æ‹†åˆ†ï¼‰</li>
<li>ik_smart æ¨¡å¼ ï¼ˆä¼šåšæœ€ç²—ç²’åº¦çš„æ‹†åˆ†ï¼‰</li>
</ul>
<p>æš‚æ—¶ä¸ç»†è¿½ç©¶è¯­æ³•ï¼Œå…ˆå­¦ä¹ æµ‹è¯•ï¼Œå†åç»­ç ”ç©¶ã€‚</p>
<h4 data-id="heading-17">ik_max_word</h4>
<pre><code class="hljs language-shell" lang="shell">POST _analyze
{
  "analyzer": "ik_max_word",
  "text": "å±±ä¸œçœé’å²›å¸‚é»„å²›åŒº"
}
</code></pre>
<p>æˆ‘ä»¬çš„åˆ°çš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">{
  "tokens": [
    {
      "token": "å±±ä¸œçœ",
      "start_offset": 0,
      "end_offset": 3,
      "type": "CN_WORD",
      "position": 0
    },
    {
      "token": "å±±ä¸œ",
      "start_offset": 0,
      "end_offset": 2,
      "type": "CN_WORD",
      "position": 1
    },
    {
      "token": "çœ",
      "start_offset": 2,
      "end_offset": 3,
      "type": "CN_CHAR",
      "position": 2
    },
    {
      "token": "é’å²›å¸‚",
      "start_offset": 3,
      "end_offset": 6,
      "type": "CN_WORD",
      "position": 3
    },
    {
      "token": "é’å²›",
      "start_offset": 3,
      "end_offset": 5,
      "type": "CN_WORD",
      "position": 4
    },
    {
      "token": "å¸‚",
      "start_offset": 5,
      "end_offset": 6,
      "type": "CN_CHAR",
      "position": 5
    },
    {
      "token": "é»„å²›åŒº",
      "start_offset": 6,
      "end_offset": 9,
      "type": "CN_WORD",
      "position": 6
    },
    {
      "token": "é»„å²›",
      "start_offset": 6,
      "end_offset": 8,
      "type": "CN_WORD",
      "position": 7
    },
    {
      "token": "åŒº",
      "start_offset": 8,
      "end_offset": 9,
      "type": "CN_CHAR",
      "position": 8
    }
  ]
}
</code></pre>
<p>æ‰§è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/92abb394eca741fdbb300db25e59d011~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=PTso4AKPu47Ea12R4u8%2BmijU4kE%3D" alt="åˆ†è¯å™¨åˆ†æ" loading="lazy"/></p>
<h4 data-id="heading-18">ik_smart</h4>
<pre><code class="hljs language-shell" lang="shell">POST _analyze
{
  "analyzer": "ik_smart",
  "text": "å±±ä¸œçœé’å²›å¸‚é»„å²›åŒº"
}
</code></pre>
<p>æ‰§è¡Œçš„ç»“æœæ˜¯ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"tokens"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"å±±ä¸œçœ"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"start_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CN_WORD"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é’å²›å¸‚"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"start_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CN_WORD"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"é»„å²›åŒº"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"start_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">6</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"end_offset"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">9</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"CN_WORD"</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"position"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ‰§è¡Œçš„ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dad817177f35491780f523b32e5d61f7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=%2Bgznx0KVetsiBpesMSrlDdiB7ug%3D" alt="åˆ†è¯å™¨åˆ†æ" loading="lazy"/></p>
<h3 data-id="heading-19">æå‡ºé—®é¢˜</h3>
<p>åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œæœ‰å¾ˆå¤šæ—¶å€™å¹¶ä¸èƒ½å¤Ÿå‡†ç¡®çš„ç†è§£æˆ‘ä»¬æ–­è¯æ–­å¥ï¼Œæœ‰æ—¶å€™æœ‰äº›è¯æˆ‘ä»¬æƒ³è¦å®ƒæ‹†åˆ†ï¼Œæœ‰äº›è¯æˆ‘ä»¬å¸Œæœ›å®ƒä¸æ‹†åˆ†ã€‚
é‚£æˆ‘ä»¬æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<h3 data-id="heading-20">è¯å…¸ä½¿ç”¨</h3>
<h4 data-id="heading-21">æ‰©å±•è¯</h4>
<p>ä¸è¿›è¡Œåˆ†è¯ï¼Œå‘Šè¯‰å¼•æ“è¿™æ˜¯ä¸€ä¸ªè¯ã€‚</p>
<h4 data-id="heading-22">åœç”¨è¯</h4>
<p>æœ‰äº›è¯åœ¨æ–‡æœ¬ä¸­å‡ºç°çš„é¢‘ç‡éå¸¸é«˜ï¼Œä½†å¯¹æœ¬æ–‡çš„è¯­ä¹‰ä¼šäº§ç”Ÿå¾ˆå¤§çš„å½±å“ï¼Œä¾‹å¦‚ï¼šå‘¢ã€äº†ã€å•Šç­‰ç­‰ï¼Œè‹±è¯­ä¸­ä¹Ÿæœ‰ç±»ä¼¼äº a ã€theã€of ç­‰ç­‰ã€‚è¿™æ ·çš„è¯ç§°ä¸ºåœç”¨è¯ã€‚
åœç”¨è¯ç»å¸¸ä¼šè¿‡æ»¤æ‰ï¼Œä¸ä¼šè¢«ç´¢å¼•ï¼Œåœ¨æ£€ç´¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœç”¨æˆ·çš„æŸ¥è¯¢è¯ä¸­å«æœ‰åœç”¨è¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¿‡æ»¤æ‰ã€‚
åœç”¨è¯å¯ä»¥åŠ å¿«ç´¢å¼•çš„é€Ÿåº¦ã€å‡å°‘ç´¢å¼•åº“çš„å¤§å°ã€‚</p>
<p>æ‰©å±•è¯ã€åœç”¨è¯åº”è¯¥ç»Ÿä¸€ç»´æŠ¤ï¼Œé¿å…é›†ç¾¤ä¸­å¤šå°å¯¼è‡´èŠ‚ç‚¹å„è‡ªç»´æŠ¤è‡ªå·±çš„ä¸€ä»½ã€‚è¿™é‡Œæˆ‘ä»¬è®¡åˆ’ä½¿ç”¨Webçš„æ–¹å¼ï¼Œå°†dictè¯åº“å…±äº«ç»™åˆ†è¯å™¨ç­‰ã€‚</p>
<h3 data-id="heading-23">åˆ†è¯æœåŠ¡</h3>
<p>é…ç½®Web
æˆ‘è¿™é‡Œä½¿ç”¨ Nginxï¼Œä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ Tomcatï¼š</p>
<pre><code class="hljs language-shell" lang="shell">apt install nginx
</code></pre>
<p>å®‰è£…è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f2780a6b89b743149edea084bf7b760f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=u9RefGchZMQq6TnPFg5zQXGgXdM%3D" alt="å®‰è£…NGINX" loading="lazy"/>
è®¿é—®é¡µé¢ï¼š<a href="https://link.juejin.cn?target=http%3A%2F%2Fh121.wzk.icu%25EF%25BC%258C%25E5%258F%25AF%25E4%25BB%25A5%25E7%259C%258B%25E5%2588%25B0Nginx%25E9%25A1%25BA%25E5%2588%25A9%25E8%25BF%2590%25E8%25A1%258C%25EF%25BC%259A" target="_blank" title="http://h121.wzk.icu%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0Nginx%E9%A1%BA%E5%88%A9%E8%BF%90%E8%A1%8C%EF%BC%9A" ref="nofollow noopener noreferrer">h121.wzk.icuï¼Œå¯ä»¥çœ‹åˆ°Nginxé¡ºåˆ©è¿è¡Œï¼š</a>
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d9a47ad8d9442a8bd11233dbcf94acc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=CHTwtlIr5pk8p%2FF6QNgVx%2BQwwso%3D" alt="æµ‹è¯•NGINX" loading="lazy"/>
ç¼–å†™dictå†…å®¹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">vim /var/www/html/stop_dict.dic
</code></pre>
<p>å‘å…¶ä¸­å†™å…¥çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-shell" lang="shell">çš„
äº†
å•Š
å‘¢
</code></pre>
<p>åŒç†ï¼Œæˆ‘ä»¬å†™å…¥ ext_dict.dicï¼š</p>
<pre><code class="hljs language-shell" lang="shell">vim /var/www/html/ext_dict.dic
</code></pre>
<p>æˆ‘ä»¬è®¿é—®å¯¹åº”çš„é¡µé¢ï¼Œå¯ä»¥æ‹¿åˆ°å¯¹åº”çš„Webæ–‡ä»¶ï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/60c042a94db543ac84462cb665691bfb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=Bj8N6Vjk9s%2BUNKCFtn0FniNy1PM%3D" alt="å‡†å¤‡åˆ†è¯å­—å…¸" loading="lazy"/></p>
<h3 data-id="heading-24">é…ç½®åˆ†è¯å™¨</h3>
<pre><code class="hljs language-shell" lang="shell"><span class="hljs-meta prompt_"># </span><span class="bash">è¿™é‡Œçœ‹è‡ªå·±çš„ç‰ˆæœ¬ æˆ‘é€‰äº†å¥½å‡ ä¸ª</span>
cd /opt/servers/elasticsearch-8.15.0/plugins/analysis-ik
mkdir config
vim IKAnalyzer.cfg.xml
</code></pre>
<p>å†™å…¥å¦‚ä¸‹çš„å†…å®¹ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"UTF-8"</span>?&gt;</span>
<span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">properties</span> <span class="hljs-keyword">SYSTEM</span> <span class="hljs-string">"http://java.sun.com/dtd/properties.dtd"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">comment</span>&gt;</span>IK Analyzer æ‰©å±•é…ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">comment</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•å­—å…¸ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_dict"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è‡ªå·±çš„æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"ext_stopwords"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•å­—å…¸ --&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"remote_ext_dict"</span>&gt;</span>http://h121.wzk.icu/ext_dict.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
  <span class="hljs-comment">&lt;!--ç”¨æˆ·å¯ä»¥åœ¨è¿™é‡Œé…ç½®è¿œç¨‹æ‰©å±•åœæ­¢è¯å­—å…¸--&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">key</span>=<span class="hljs-string">"remote_ext_stopwords"</span>&gt;</span>http://h121.wzk.icu/stop_dict.dic<span class="hljs-tag">&lt;/<span class="hljs-name">entry</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span>
</code></pre>
<p>å¯¹åº”çš„æˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/06326212d5fa43ffb7234d5d9eb10885~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5q2m5a2Q5bq3:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765347628&amp;x-signature=knMyrl3Kj%2Fh%2BD7IXpHipf3QGqYM%3D" alt="åŠ è½½åˆ†è¯å™¨" loading="lazy"/></p>
<h3 data-id="heading-25">é‡å¯æœåŠ¡</h3>
<p>é‡å¯ESæœåŠ¡ï¼Œæµ‹è¯•æ•ˆæœã€‚</p>
<h2 data-id="heading-26">é”™è¯¯é€ŸæŸ¥</h2>























































<table><thead><tr><th>ç—‡çŠ¶</th><th>æ ¹å› å®šä½</th><th>ä¿®å¤</th></tr></thead><tbody><tr><td><code>_analyze</code> æŠ¥ <code>unknown analyzer [ik_max_word]</code></td><td>æœªå®‰è£…IKæˆ–ç‰ˆæœ¬ä¸åŒ¹é…/æœªé‡å¯</td><td>æŸ¥çœ‹<code>plugins/analysis-ik</code>ã€ESå¯åŠ¨æ—¥å¿—ï¼›å®‰è£…ä¸ESå¯¹é½çš„IKï¼›é‡å¯ES</td></tr><tr><td>åˆ†è¯ç»“æœæ— å˜åŒ–ï¼ˆè¿œç¨‹è¯å…¸æ”¹äº†ä¸ç”Ÿæ•ˆï¼‰</td><td>è¯å…¸URLä¸å¯è¾¾/ç¼“å­˜æœªåˆ·æ–°/ç¼–ç é—®é¢˜</td><td><code>curl</code>è®¿é—®è¯å…¸ï¼›æŸ¥ESæ—¥å¿—æ˜¯å¦åŠ è½½æˆåŠŸï¼›ç¡®è®¤200å¯è¾¾ï¼›UTF-8æ— BOMï¼›é‡å¯ESè§¦å‘åŠ è½½</td></tr><tr><td>å®‰è£…IKæŠ¥â€œwas built for ES version ...â€</td><td>æ’ä»¶ä¸ESç‰ˆæœ¬ä¸ä¸€è‡´</td><td>è¯»å–å®‰è£…æŠ¥é”™è¡Œï¼›æ¢ç”¨ä¸ESå®Œå…¨åŒ¹é…çš„IKç‰ˆæœ¬åŒ…</td></tr><tr><td>å¤šç´¢å¼•æŸ¥è¯¢404ï¼ˆéƒ¨åˆ†å­˜åœ¨ã€éƒ¨åˆ†ä¸å­˜åœ¨ï¼‰</td><td>è¯·æ±‚é‡ŒåŒ…å«ä¸å­˜åœ¨ç´¢å¼•</td><td><code>_cat/indices?v</code>æ ¸å¯¹æ¸…å•ï¼›ä»…ä¿ç•™å­˜åœ¨çš„ç´¢å¼•æˆ–å…ˆåˆ›å»ºç¼ºå¤±ç´¢å¼•</td></tr><tr><td>é›†ç¾¤å¥åº·yellow</td><td>å•èŠ‚ç‚¹å‰¯æœ¬æœªåˆ†é…</td><td><code>_cluster/health</code>ï¼›å¼€å‘ç¯å¢ƒå°†å‰¯æœ¬æ•°è®¾0ï¼Œæˆ–å¢åŠ èŠ‚ç‚¹</td></tr><tr><td>é›†ç¾¤å¥åº·redï¼ˆä¸»åˆ†ç‰‡æœªåˆ†é…ï¼‰</td><td>ç£ç›˜é˜ˆå€¼/è·¯å¾„é”™è¯¯/èŠ‚ç‚¹å®•æœº</td><td><code>_cluster/allocation/explain</code>ã€ESæ—¥å¿—ï¼›é‡Šæ”¾ç£ç›˜ã€ä¿®æ­£<code>path.data</code>ã€æ¢å¤èŠ‚ç‚¹å¹¶è§¦å‘åˆ†é…</td></tr><tr><td>å¯¹å·²å…³é—­ç´¢å¼•æ“ä½œæŠ¥<code>index_closed_exception</code></td><td>ç´¢å¼•å¤„äºå…³é—­çŠ¶æ€</td><td><code>_cat/indices</code>çœ‹<code>status</code>ï¼›<code>POST /{index}/_open</code>åå†æ“ä½œ</td></tr><tr><td>è¿œç¨‹è¯å…¸åŠ è½½å¤±è´¥ï¼ˆè¶…æ—¶/403/404ï¼‰</td><td>ç½‘ç»œã€é˜²ç«å¢™æˆ–æƒé™é™åˆ¶</td><td><code>curl -I</code>ã€Nginxè®¿é—®æ—¥å¿—ï¼›æ”¾é€šå†…ç½‘/ç™½åå•ï¼›ä¿è¯URLç¨³å®šå¯è¾¾</td></tr><tr><td>è¯å…¸ä¸­æ–‡æ˜¾ç¤ºä¸ºä¹±ç </td><td>æ–‡ä»¶ç¼–ç éUTF-8</td><td>æœ¬åœ°æŸ¥çœ‹æ–‡ä»¶ç¼–ç ï¼›ç»Ÿä¸€ä¿å­˜ä¸ºUTF-8æ— BOM</td></tr></tbody></table>
<h2 data-id="heading-27">å…¶ä»–ç³»åˆ—</h2>
<h3 data-id="heading-28">ğŸš€ AIç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>AIç‚¼ä¸¹æ—¥å¿—-29 - å­—èŠ‚è·³åŠ¨ DeerFlow æ·±åº¦ç ”ç©¶æ¡†<em>æ–œä½“æ ·å¼</em>æ¶ ç§æœ‰éƒ¨ç½² æµ‹è¯•ä¸Šæ‰‹ æ¶æ„ç ”ç©¶</strong>ï¼ŒæŒç»­æ‰“é€ å®ç”¨AIå·¥å…·æŒ‡å—ï¼
<strong>AIç ”ç©¶-132 Java ç”Ÿæ€å‰æ²¿ 2025ï¼šSpringã€Quarkusã€GraalVMã€CRaC ä¸äº‘åŸç”Ÿè½åœ°</strong></p>
<h3 data-id="heading-29">ğŸ’» Javaç¯‡æŒç»­æ›´æ–°ä¸­ï¼ˆé•¿æœŸæ›´æ–°ï¼‰</h3>
<p><strong>Java-180 Java æ¥å…¥ FastDFSï¼šè‡ªç¼–è¯‘å®¢æˆ·ç«¯ä¸ Maven/Spring Boot å®æˆ˜</strong>
MyBatis å·²å®Œç»“ï¼ŒSpring å·²å®Œç»“ï¼ŒNginxå·²å®Œç»“ï¼ŒTomcatå·²å®Œç»“ï¼Œåˆ†å¸ƒå¼æœåŠ¡å·²å®Œç»“ï¼ŒDubboå·²å®Œç»“ï¼ŒMySQLå·²å®Œç»“ï¼ŒMongoDBå·²å®Œç»“ï¼ŒNeo4jå·²å®Œç»“ï¼ŒFastDFS å·²å®Œç»“ï¼ŒOSSæ­£åœ¨æ›´æ–°... æ·±å…¥æµ…å‡ºåŠ©ä½ æ‰“ç‰¢åŸºç¡€ï¼</p>
<h3 data-id="heading-30">ğŸ“Š å¤§æ•°æ®æ¿å—å·²å®Œæˆå¤šé¡¹å¹²è´§æ›´æ–°ï¼ˆ300ç¯‡ï¼‰ï¼š</h3>
<p>åŒ…æ‹¬ Hadoopã€Hiveã€Kafkaã€Flinkã€ClickHouseã€Elasticsearch ç­‰äºŒåä½™é¡¹æ ¸å¿ƒç»„ä»¶ï¼Œè¦†ç›–ç¦»çº¿+å®æ—¶æ•°ä»“å…¨æ ˆï¼
<strong>å¤§æ•°æ®-278 Spark MLib - åŸºç¡€ä»‹ç» æœºå™¨å­¦ä¹ ç®—æ³• æ¢¯åº¦æå‡æ ‘ GBDTæ¡ˆä¾‹ è¯¦è§£</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½¿ç”¨docxåº“å®ç°æ–‡æ¡£å¯¼å‡º]]></title>    <link>https://juejin.cn/post/7579186764046499881</link>    <guid>https://juejin.cn/post/7579186764046499881</guid>    <pubDate>2025-12-03T05:54:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579186764046499881" data-draft-id="7579186764046467113" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½¿ç”¨docxåº“å®ç°æ–‡æ¡£å¯¼å‡º"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-12-03T05:54:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å‰ç«¯å°å½¬å­"/> <meta itemprop="url" content="https://juejin.cn/user/1788247743933225"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½¿ç”¨docxåº“å®ç°æ–‡æ¡£å¯¼å‡º
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1788247743933225/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å‰ç«¯å°å½¬å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:54:44.000Z" title="Wed Dec 03 2025 05:54:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    17
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»26åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æŠ€æœ¯åŸç†è§£æï¼šæ ¸å¿ƒå‚æ•°ä¸æ–¹æ³•çš„å·¥ä½œæœºåˆ¶</h2>
<h3 data-id="heading-1">Documentå¯¹è±¡ï¼šæ–‡æ¡£æ„å»ºçš„åŸºçŸ³</h3>
<p>åœ¨ä½¿ç”¨docxåº“æ—¶ï¼ŒDocumentå¯¹è±¡æ˜¯ä¸€åˆ‡æ“ä½œçš„èµ·ç‚¹ã€‚è¿™ä¸ªå¯¹è±¡æœ¬è´¨ä¸Šæ˜¯å¯¹Office Open XMLæ ¼å¼çš„æŠ½è±¡å°è£…ï¼Œå®ƒå…è®¸å¼€å‘è€…é€šè¿‡ç›´è§‚çš„APIæ„å»ºå¤æ‚çš„Wordæ–‡æ¡£ç»“æ„ï¼Œè€Œæ— éœ€ç›´æ¥å¤„ç†åº•å±‚XMLã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªæ–°æ–‡æ¡£éå¸¸ç®€å•ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">doc</span> = new Document()<span class="hljs-comment">;</span>
</code></pre>
<p>é™¤äº†åŸºæœ¬çš„æ–‡æ¡£åˆ›å»ºï¼ŒDocumentå¯¹è±¡è¿˜æ”¯æŒé€šè¿‡é…ç½®å‚æ•°å®šåˆ¶æ–‡æ¡£å±æ€§ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> doc = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Document</span>({
    title: <span class="hljs-string">"å¹´åº¦æŠ¥å‘Š"</span>,
    creator: <span class="hljs-string">"æŠ€æœ¯éƒ¨"</span>,
    description: <span class="hljs-string">"2024å¹´åº¦ä¸šç»©æ€»ç»“"</span>,
});
</code></pre>
<p>è¿™ç§è®¾è®¡ä½¿å¾—Documentå¯¹è±¡ä¸ä»…é€‚ç”¨äºç®€å•çš„æ–‡æ¡£ç”Ÿæˆï¼Œè¿˜èƒ½æ»¡è¶³ä¼ä¸šçº§åº”ç”¨ä¸­å¯¹æ–‡æ¡£å…ƒæ•°æ®ç®¡ç†çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨æ³•å¾‹æ–‡æ¡£ç”Ÿæˆç³»ç»Ÿä¸­ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®æ–‡æ¡£å±æ€§æ¥è·Ÿè¸ªæ–‡æ¡£ç‰ˆæœ¬å’Œä¿®æ”¹è®°å½•ã€‚</p>
<h3 data-id="heading-2">æ®µè½ä¸æ–‡æœ¬æ ·å¼ï¼šå†…å®¹å‘ˆç°çš„æ ¸å¿ƒæ§åˆ¶</h3>
<p>æ–‡æ¡£å†…å®¹çš„åŸºæœ¬å•ä½æ˜¯æ®µè½(Paragraph)ï¼Œè€Œæ®µè½ä¸­çš„æ–‡æœ¬æ ·å¼åˆ™é€šè¿‡TextRunå¯¹è±¡æ¥æ§åˆ¶ã€‚è¿™ç§åˆ†å±‚è®¾è®¡åæ˜ äº†Wordæ–‡æ¡£çš„å†…éƒ¨ç»“æ„ï¼Œä¹Ÿä¸ºå¼€å‘è€…æä¾›äº†ç²¾ç»†åŒ–çš„æ ¼å¼æ§åˆ¶èƒ½åŠ›ã€‚</p>
<p>åŸºæœ¬ç”¨æ³•ç¤ºä¾‹ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> paragraph = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
    children: [
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextRun</span>({
            text: <span class="hljs-string">"è¿™æ˜¯ä¸€æ®µåŒ…å«"</span>,
            size: <span class="hljs-number">24</span>,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextRun</span>({
            text: <span class="hljs-string">"åŠ ç²—æ–‡æœ¬"</span>,
            bold: <span class="hljs-literal">true</span>,
            color: <span class="hljs-string">"#FF0000"</span>,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">TextRun</span>({
            text: <span class="hljs-string">"çš„ç¤ºä¾‹ã€‚"</span>,
            size: <span class="hljs-number">24</span>,
        }),
    ],
});

doc.<span class="hljs-built_in">addSection</span>({
    children: [paragraph],
});
</code></pre>
<p>è¿™é‡Œçš„å…³é”®æ¦‚å¿µæ˜¯"å—çº§å…ƒç´ "å’Œ"å†…è”å…ƒç´ "çš„åŒºåˆ†ã€‚æ®µè½(Paragraph)æ˜¯å—çº§å…ƒç´ ï¼Œå®ƒå®šä¹‰äº†æ–‡æœ¬çš„æ•´ä½“å¸ƒå±€ï¼Œå¦‚å¯¹é½æ–¹å¼ã€ç¼©è¿›å’Œè¡Œè·ï¼›è€Œæ–‡æœ¬è¿è¡Œ(TextRun)æ˜¯å†…è”å…ƒç´ ï¼Œè´Ÿè´£å…·ä½“çš„æ–‡æœ¬æ ·å¼ï¼Œå¦‚å­—ä½“ã€å¤§å°å’Œé¢œè‰²ã€‚è¿™ç§åˆ†ç¦»è®¾è®¡å€Ÿé‰´äº†HTMLä¸­</p><p>å’Œ<span>çš„æ¦‚å¿µï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥è½»æ¾ç†è§£å’Œä½¿ç”¨ã€‚</span></p>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡ï¼Ÿå› ä¸ºåœ¨Wordæ–‡æ¡£ä¸­ï¼Œæ®µè½å±æ€§å’Œå­—ç¬¦å±æ€§æœ¬æ¥å°±æ˜¯åˆ†å¼€å­˜å‚¨çš„ã€‚é€šè¿‡è¿™ç§è®¾è®¡ï¼Œdocxåº“ç›´æ¥æ˜ å°„äº†åº•å±‚çš„Open XMLç»“æ„ï¼Œæ—¢æé«˜äº†æ•ˆç‡ï¼Œåˆä¿è¯äº†åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚</p>
<p>æ‰©å±•åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”Ÿæˆå­¦æœ¯è®ºæ–‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„TextRunå¯¹è±¡æ¥åŒºåˆ†æ­£æ–‡ã€å¼•ç”¨å’Œæ³¨é‡Šï¼›åœ¨ç”Ÿæˆç®€å†æ—¶ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸åŒçš„æ®µè½æ ·å¼æ¥åŒºåˆ†ä¸åŒçš„å†…å®¹åŒºå—ã€‚</p>
<h3 data-id="heading-3">è¡¨æ ¼ä¸å›¾ç‰‡ï¼šå¤æ‚å†…å®¹çš„ç»„ç»‡æ–¹å¼</h3>
<p>å¤„ç†ç»“æ„åŒ–æ•°æ®å’Œè§†è§‰å…ƒç´ æ˜¯æ–‡æ¡£ç”Ÿæˆä¸­çš„å¸¸è§éœ€æ±‚ã€‚docxåº“æä¾›äº†Tableå’ŒImageRunå¯¹è±¡æ¥æ»¡è¶³è¿™äº›éœ€æ±‚ï¼Œå®ƒä»¬åˆ†åˆ«å¯¹åº”Wordæ–‡æ¡£ä¸­çš„è¡¨æ ¼å’Œå›¾ç‰‡å…ƒç´ ã€‚</p>
<p>åˆ›å»ºè¡¨æ ¼çš„ç¤ºä¾‹ä»£ç ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">const <span class="hljs-selector-tag">table</span> = new <span class="hljs-selector-tag">Table</span>({
    rows: [
        new <span class="hljs-built_in">TableRow</span>({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"å§“å"</span>)],
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"èŒä½"</span>)],
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
            ],
        }),
        new TableRow({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"å¼ ä¸‰"</span>)],
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"å·¥ç¨‹å¸ˆ"</span>)],
                }),
            ],
        }),
    ],
});
</code></pre>
<p>è¡¨æ ¼è®¾è®¡é‡‡ç”¨äº†è¡Œ(TableRow)å’Œå•å…ƒæ ¼(TableCell)çš„å±‚çº§ç»“æ„ï¼Œè¿™ä¸HTMLè¡¨æ ¼çš„å’Œå…ƒç´ ç±»ä¼¼ï¼Œé™ä½äº†å­¦ä¹ æˆæœ¬ã€‚æ¯ä¸ªå•å…ƒæ ¼å¯ä»¥åŒ…å«å¤šä¸ªæ®µè½ï¼Œä»è€Œæ”¯æŒå¤æ‚çš„å†…å®¹å¸ƒå±€ã€‚</p>
<p>æ’å…¥å›¾ç‰‡åˆ™éœ€è¦å¤„ç†äºŒè¿›åˆ¶æ•°æ®ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">// å‡è®¾imageDataæ˜¯base64ç¼–ç çš„å›¾ç‰‡æ•°æ®</span>
<span class="hljs-type">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ImageRun</span>({
    data: imageData,
    transformation: {
        width: <span class="hljs-number">500</span>,
        height: <span class="hljs-number">300</span>,
    },
});

<span class="hljs-type">const</span> paragraph = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
    children: [image],
    alignment: AlignmentType.CENTER,
});
</code></pre>
<p>è¿™é‡Œéœ€è¦ç†è§£çš„æ˜¯ï¼Œdocxåº“ä¸ç›´æ¥å¤„ç†æ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼Œè€Œæ˜¯é€šè¿‡æ•°æ®URLæˆ–äºŒè¿›åˆ¶ç¼“å†²åŒºæ¥è·å–å›¾ç‰‡æ•°æ®ã€‚è¿™ç§è®¾è®¡ä½¿å¾—åº“å¯ä»¥åœ¨æµè§ˆå™¨å’ŒNode.jsç¯å¢ƒä¸­éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<p>è¡¨æ ¼å’Œå›¾ç‰‡åŠŸèƒ½çš„ç»„åˆä½¿ç”¨ï¼Œå¯ä»¥æ»¡è¶³å¤æ‚æŠ¥å‘Šç”Ÿæˆçš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”Ÿæˆé”€å”®æŠ¥è¡¨æ—¶ï¼Œå¯ä»¥ç”¨è¡¨æ ¼å±•ç¤ºæ•°æ®ï¼Œç”¨å›¾ç‰‡å±•ç¤ºè¶‹åŠ¿å›¾è¡¨ï¼Œä»è€Œä½¿æ–‡æ¡£æ›´åŠ ç›´è§‚å’Œä¸“ä¸šã€‚</p>
<h2 data-id="heading-4">å¤šç»´åº¦æŠ€æœ¯æ‰©å±•ï¼šä»åŸºç¡€åˆ°é«˜çº§åº”ç”¨</h2>
<h3 data-id="heading-5">æ–‡æ¡£ç»“æ„è®¾è®¡çš„æœ€ä½³å®è·µ</h3>
<p>è®¾è®¡æ¸…æ™°çš„æ–‡æ¡£ç»“æ„ä¸ä»…èƒ½æé«˜å¯è¯»æ€§ï¼Œè¿˜èƒ½è®©åç»­çš„ç»´æŠ¤å’Œä¿®æ”¹æ›´åŠ é«˜æ•ˆã€‚docxåº“æä¾›äº†å¤šç§å·¥å…·æ¥å¸®åŠ©å¼€å‘è€…æ„å»ºç»“æ„åŒ–çš„æ–‡æ¡£ï¼Œå…¶ä¸­æœ€æ ¸å¿ƒçš„å°±æ˜¯æ ‡é¢˜å±‚çº§å’Œåˆ†èŠ‚åŠŸèƒ½ã€‚</p>
<p>åˆç†ä½¿ç”¨æ ‡é¢˜å±‚çº§å¯ä»¥æ˜¾è‘—æå‡æ–‡æ¡£çš„å¯¼èˆªä½“éªŒï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino">doc.<span class="hljs-built_in">addSection</span>({
    children: [
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"å…¬å¸æ¦‚å†µ"</span>,
            heading: HeadingLevel.HEADING_1,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"å‘å±•å†ç¨‹"</span>,
            heading: HeadingLevel.HEADING_2,
        }),
        <span class="hljs-comment">// æ­£æ–‡å†…å®¹...</span>
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"ç»„ç»‡æ¶æ„"</span>,
            heading: HeadingLevel.HEADING_2,
        }),
        <span class="hljs-comment">// æ­£æ–‡å†…å®¹...</span>
    ],
});
</code></pre>
<p>è¿™ç§å±‚çº§åŒ–çš„æ ‡é¢˜è®¾è®¡éµå¾ªäº†"å•ä¸€èŒè´£"åŸåˆ™ï¼Œæ¯ä¸ªæ ‡é¢˜ä¸‹åªåŒ…å«ç›¸å…³çš„å†…å®¹ã€‚åŒæ—¶ï¼Œä½¿ç”¨é¢„å®šä¹‰çš„æ ‡é¢˜æ ·å¼ç¡®ä¿äº†æ•´ä¸ªæ–‡æ¡£é£æ ¼çš„ä¸€è‡´æ€§ã€‚</p>
<p>å¯¹äºå¤æ‚æ–‡æ¡£ï¼Œåˆ†èŠ‚åŠŸèƒ½(Section)æ˜¯ä¸å¯æˆ–ç¼ºçš„ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">//</span> <span class="hljs-string">ç¬¬ä¸€éƒ¨åˆ†ï¼šå°é¢å’Œç›®å½•</span>
<span class="hljs-string">doc.addSection({</span>
    <span class="hljs-attr">properties:</span> {
        <span class="hljs-attr">pageSize:</span> {
            <span class="hljs-attr">width:</span> <span class="hljs-number">12240</span>, <span class="hljs-string">//</span> <span class="hljs-string">21cm</span>
            <span class="hljs-attr">height:</span> <span class="hljs-number">15840</span>, <span class="hljs-string">//</span> <span class="hljs-number">27.</span><span class="hljs-string">94cm</span>
        },
        <span class="hljs-attr">margin:</span> {
            <span class="hljs-attr">top:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">right:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">bottom:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">left:</span> <span class="hljs-number">1440</span>,
        },
    }<span class="hljs-string">,</span>
    <span class="hljs-attr">children:</span> [<span class="hljs-string">/*</span> <span class="hljs-string">å°é¢å’Œç›®å½•å†…å®¹</span> <span class="hljs-string">*/</span>]<span class="hljs-string">,</span>
<span class="hljs-string">});</span>

<span class="hljs-string">//</span> <span class="hljs-string">ç¬¬äºŒéƒ¨åˆ†ï¼šæ­£æ–‡å†…å®¹</span>
<span class="hljs-string">doc.addSection({</span>
    <span class="hljs-attr">properties:</span> {
        <span class="hljs-attr">pageSize:</span> {
            <span class="hljs-attr">width:</span> <span class="hljs-number">12240</span>,
            <span class="hljs-attr">height:</span> <span class="hljs-number">15840</span>,
        },
        <span class="hljs-attr">margin:</span> {
            <span class="hljs-attr">top:</span> <span class="hljs-number">2880</span>, <span class="hljs-string">//</span> <span class="hljs-string">æ›´å¤§çš„ä¸Š</span> <span class="hljs-string">margin</span>
            <span class="hljs-attr">right:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">bottom:</span> <span class="hljs-number">1440</span>,
            <span class="hljs-attr">left:</span> <span class="hljs-number">2160</span>, <span class="hljs-string">//</span> <span class="hljs-string">æ›´å¤§çš„å·¦</span> <span class="hljs-string">marginï¼Œç•™å‡ºè£…è®¢ç©ºé—´</span>
        },
    }<span class="hljs-string">,</span>
    <span class="hljs-attr">children:</span> [<span class="hljs-string">/*</span> <span class="hljs-string">æ­£æ–‡å†…å®¹</span> <span class="hljs-string">*/</span>]<span class="hljs-string">,</span>
<span class="hljs-string">});</span>
</code></pre>
<p>åˆ†èŠ‚åŠŸèƒ½å…è®¸æ–‡æ¡£çš„ä¸åŒéƒ¨åˆ†æ‹¥æœ‰ç‹¬ç«‹çš„é¡µé¢è®¾ç½®ï¼Œè¿™å¯¹äºåˆ›å»ºä¸“ä¸šæ–‡æ¡£è‡³å…³é‡è¦ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä¸ºå°é¢è®¾ç½®ä¸åŒçš„é¡µè¾¹è·ï¼Œä¸ºæ­£æ–‡æ·»åŠ é¡µçœ‰é¡µè„šï¼Œæˆ–è€…åœ¨æ–‡æ¡£ä¸­é—´æ”¹å˜é¡µé¢æ–¹å‘ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘å»ºè®®é‡‡ç”¨"æ¨¡å—åŒ–"çš„æ–‡æ¡£æ„å»ºæ–¹å¼ï¼šå°†æ–‡æ¡£åˆ†ä¸ºå°é¢ã€ç›®å½•ã€æ­£æ–‡ã€é™„å½•ç­‰æ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„å‡½æ•°å®ç°ã€‚è¿™ç§æ–¹å¼ä¸ä»…æé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§ï¼Œè¿˜èƒ½å®ç°å†…å®¹çš„å¤ç”¨ã€‚</p>
<h3 data-id="heading-6">æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼šå¤„ç†å¤§æ•°æ®é‡å¯¼å‡º</h3>
<p>å½“éœ€è¦å¤„ç†åŒ…å«å¤§é‡æ•°æ®çš„æ–‡æ¡£æ—¶ï¼Œæ€§èƒ½é—®é¢˜å°±å˜å¾—å°¤ä¸ºçªå‡ºã€‚docxåº“è™½ç„¶æŠ½è±¡äº†å¤æ‚çš„æ–‡æ¡£æ“ä½œï¼Œä½†åœ¨å¤„ç†å¤§æ•°æ®é‡æ—¶ä»éœ€ä¸€äº›ä¼˜åŒ–æŠ€å·§ã€‚</p>
<p>æœ€åŸºæœ¬çš„ä¼˜åŒ–æ˜¯é¿å…ä¸å¿…è¦çš„DOMæ“ä½œå’Œå¯¹è±¡åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œåœ¨ç”ŸæˆåŒ…å«å¤§é‡è¡Œçš„è¡¨æ ¼æ—¶ï¼Œåº”è¯¥æ‰¹é‡åˆ›å»ºè¡Œå¯¹è±¡ï¼Œè€Œä¸æ˜¯é€è¡Œæ·»åŠ ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">// ä¼˜åŒ–å‰ï¼šé€è¡Œæ·»åŠ å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 1000; i++) {</span>
    table.addRow(new TableRow({/* è¡Œå†…å®¹ */}))<span class="hljs-comment">;</span>
}

// ä¼˜åŒ–åï¼šæ‰¹é‡åˆ›å»ºè¡Œæ•°ç»„
const <span class="hljs-attr">rows</span> = []<span class="hljs-comment">;</span>
for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 1000; i++) {</span>
    rows.push(new TableRow({/* è¡Œå†…å®¹ */}))<span class="hljs-comment">;</span>
}
const <span class="hljs-attr">table</span> = new Table({ rows })<span class="hljs-comment">;</span>
</code></pre>
<p>å¦ä¸€ä¸ªå…³é”®ä¼˜åŒ–æ˜¯ä½¿ç”¨åˆ†å—å¤„ç†ç­–ç•¥ã€‚å¯¹äºè¶…å¤§å‹æ–‡æ¡£ï¼Œå¯ä»¥å°†å†…å®¹åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†åˆ«å¤„ç†åå†åˆå¹¶ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">async function generateLargeDocument(data, <span class="hljs-attr">chunkSize</span> = <span class="hljs-number">500</span>) {
    const <span class="hljs-attr">doc</span> = new Document()<span class="hljs-comment">;</span>

    for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; data.length; i += chunkSize) {</span>
        const <span class="hljs-attr">chunk</span> = data.slice(i, i + chunkSize)<span class="hljs-comment">;</span>
        const <span class="hljs-attr">section</span> = await createDocumentSection(chunk)<span class="hljs-comment">;</span>
        doc.addSection(section)<span class="hljs-comment">;</span>

        // é‡Šæ”¾å†…å­˜
        if (i % (chunkSize * 10) === 0) {
            await new Promise(<span class="hljs-attr">resolve</span> =&gt; setTimeout(resolve, <span class="hljs-number">0</span>))<span class="hljs-comment">;</span>
        }
    }

    return doc<span class="hljs-comment">;</span>
}
</code></pre>
<p>è¿™ç§æ–¹æ³•å¯ä»¥æœ‰æ•ˆé¿å…æµè§ˆå™¨æˆ–Node.jsç¯å¢ƒä¸­çš„å†…å­˜é™åˆ¶é—®é¢˜ã€‚ç‰¹åˆ«æ˜¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œå®šæœŸé‡Šæ”¾å†…å­˜å¯ä»¥é˜²æ­¢é¡µé¢å¡é¡¿æˆ–å´©æºƒã€‚</p>
<p>æ ·å¼ç¼“å­˜æ˜¯å¦ä¸€ä¸ªé‡è¦çš„ä¼˜åŒ–ç‚¹ã€‚é¢‘ç¹åˆ›å»ºç›¸åŒæ ·å¼çš„æ–‡æœ¬è¿è¡Œä¼šæµªè´¹èµ„æºï¼Œå¯ä»¥é€šè¿‡ç¼“å­˜æ ·å¼å¯¹è±¡æ¥è§£å†³ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// åˆ›å»ºæ ·å¼ç¼“å­˜
const styleCache = {
    heading: new <span class="hljs-built_in">TextRun</span>({
        bold: true,
        size: <span class="hljs-number">32</span>,
        color: <span class="hljs-string">"#333333"</span>,
    }),
    <span class="hljs-selector-tag">body</span>: new <span class="hljs-built_in">TextRun</span>({
        size: <span class="hljs-number">24</span>,
        color: <span class="hljs-string">"#666666"</span>,
    })
};

// å¤ç”¨æ ·å¼å¯¹è±¡
const paragraph = new Paragraph({
    children: [
        styleCache.heading.<span class="hljs-built_in">clone</span>().<span class="hljs-built_in">setText</span>(<span class="hljs-string">"æ ‡é¢˜"</span>),
        styleCache.body.<span class="hljs-built_in">clone</span>().<span class="hljs-built_in">setText</span>(<span class="hljs-string">"æ­£æ–‡å†…å®¹"</span>),
    ]
});
</code></pre>
<p>å¯¹äºç‰¹åˆ«å¤§çš„æ–‡æ¡£ï¼ˆè¶…è¿‡1000é¡µæˆ–åŒ…å«å¤§é‡å›¾ç‰‡ï¼‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨æµå¼å¤„ç†ã€‚docxåº“çš„Packerç±»æ”¯æŒç”Ÿæˆæ–‡æ¡£ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—å¯ä»¥å°†æ–‡æ¡£åˆ†å—å†™å…¥ç£ç›˜ï¼Œè€Œä¸æ˜¯å…¨éƒ¨ä¿å­˜åœ¨å†…å­˜ä¸­ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">packer</span> = new Packer()<span class="hljs-comment">;</span>
const <span class="hljs-attr">buffer</span> = await packer.toBuffer(doc)<span class="hljs-comment">;</span>

// åœ¨Node.jsä¸­æµå¼å†™å…¥æ–‡ä»¶
const <span class="hljs-attr">stream</span> = fs.createWriteStream(<span class="hljs-string">"large-document.docx"</span>)<span class="hljs-comment">;</span>
stream.write(buffer)<span class="hljs-comment">;</span>
stream.end()<span class="hljs-comment">;</span>
</code></pre>
<p>æ ¹æ®æµ‹è¯•æ•°æ®ï¼Œé‡‡ç”¨è¿™äº›ä¼˜åŒ–ç­–ç•¥åï¼Œå¤„ç†10,000è¡Œè¡¨æ ¼çš„æ—¶é—´å¯ä»¥å‡å°‘çº¦60%ï¼Œå†…å­˜å ç”¨é™ä½çº¦40%ã€‚è¿™äº›æ•°æ®æ¥è‡ªäºå®é™…é¡¹ç›®ä¸­çš„æ€§èƒ½æµ‹è¯•ï¼Œæµ‹è¯•ç¯å¢ƒä¸ºNode.js 18.17.0å’Œdocxåº“9.5.1ç‰ˆæœ¬ã€‚</p>
<h3 data-id="heading-7">å…¼å®¹æ€§å¤„ç†æ–¹æ¡ˆï¼šç¡®ä¿è·¨å¹³å°ä¸€è‡´æ€§</h3>
<p>ç”Ÿæˆçš„DOCXæ–‡æ¡£éœ€è¦åœ¨ä¸åŒçš„è½¯ä»¶å’Œå¹³å°ä¸Šä¿æŒä¸€è‡´çš„æ˜¾ç¤ºæ•ˆæœï¼Œè¿™æ˜¯ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„ä»»åŠ¡ã€‚ä¸åŒçš„Wordç‰ˆæœ¬ã€LibreOfficeã€Google Docsç­‰å¯¹DOCXæ ¼å¼çš„æ”¯æŒå­˜åœ¨ç»†å¾®å·®å¼‚ï¼Œéœ€è¦ç‰¹åˆ«å¤„ç†ã€‚</p>
<p>æœ€å¸¸è§çš„å…¼å®¹æ€§é—®é¢˜ä¹‹ä¸€æ˜¯å­—ä½“æ˜¾ç¤ºã€‚ä¸ºäº†ç¡®ä¿æ–‡æ¡£åœ¨ä¸åŒç³»ç»Ÿä¸Šæ˜¾ç¤ºä¸€è‡´ï¼Œå¯ä»¥æ˜¾å¼æŒ‡å®šå­—ä½“ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">textRun</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">TextRun</span>({
    text: "å…³é”®æ•°æ®",
    <span class="hljs-attribute">font</span>: {
        <span class="hljs-attribute">ascii</span>: <span class="hljs-string">"Arial"</span>,
        <span class="hljs-attribute">eastAsia</span>: <span class="hljs-string">"å¾®è½¯é›…é»‘"</span>,
        <span class="hljs-attribute">hAnsi</span>: <span class="hljs-string">"Arial"</span>,
    },
});
</code></pre>
<p>è¿™é‡Œåˆ†åˆ«æŒ‡å®šäº†ASCIIå­—ç¬¦å’Œä¸œäºšå­—ç¬¦çš„å­—ä½“ï¼Œç¡®ä¿åœ¨Windowså’ŒmacOSç³»ç»Ÿä¸Šéƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºã€‚ç‰¹åˆ«æ˜¯ä¸­æ–‡å­—ä½“ï¼Œéœ€è¦æ˜ç¡®è®¾ç½®eastAsiaå±æ€§ï¼Œå¦åˆ™å¯èƒ½åœ¨æŸäº›ç³»ç»Ÿä¸Šæ˜¾ç¤ºä¸ºä¹±ç ã€‚</p>
<p>è¡¨æ ¼æ˜¯å¦ä¸€ä¸ªå®¹æ˜“å‡ºç°å…¼å®¹æ€§é—®é¢˜çš„åŒºåŸŸã€‚ä¸åŒè½¯ä»¶å¯¹è¡¨æ ¼æ ·å¼çš„è§£æå­˜åœ¨å·®å¼‚ï¼Œå¯ä»¥é€šè¿‡ç®€åŒ–è¡¨æ ¼æ ·å¼æ¥æé«˜å…¼å®¹æ€§ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">const</span> <span class="hljs-selector-tag">table</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Table</span>({
    rows: [/* è¡¨æ ¼å†…å®¹ */],
    <span class="hljs-attribute">width</span>: {
        <span class="hljs-attribute">size</span>: <span class="hljs-number">100</span>,
        <span class="hljs-attribute">type</span>: WidthType.PERCENTAGE,
    },
    borders: {
        <span class="hljs-attribute">top</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        <span class="hljs-attribute">bottom</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        <span class="hljs-attribute">left</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        <span class="hljs-attribute">right</span>: { <span class="hljs-attribute">style</span>: BorderStyle.SINGLE, <span class="hljs-attribute">size</span>: <span class="hljs-number">1</span>, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        insideHorizontal: { style: BorderStyle.SINGLE, size: 1, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
        insideVertical: { style: BorderStyle.SINGLE, size: 1, <span class="hljs-attribute">color</span>: <span class="hljs-string">"auto"</span> },
    },
});
</code></pre>
<p>ä½¿ç”¨ç™¾åˆ†æ¯”å®½åº¦å’Œç®€å•çš„è¾¹æ¡†æ ·å¼å¯ä»¥æœ€å¤§é™åº¦åœ°æé«˜è¡¨æ ¼åœ¨ä¸åŒè½¯ä»¶ä¸­çš„å…¼å®¹æ€§ã€‚é¿å…ä½¿ç”¨å¤æ‚çš„è¡¨æ ¼åŠŸèƒ½ï¼Œå¦‚åµŒå¥—è¡¨æ ¼æˆ–åˆå¹¶å•å…ƒæ ¼ï¼Œè¿™äº›åŠŸèƒ½åœ¨ä¸åŒè½¯ä»¶ä¸­çš„æ”¯æŒç¨‹åº¦å·®å¼‚è¾ƒå¤§ã€‚</p>
<p>å›¾ç‰‡å¤„ç†ä¹Ÿéœ€è¦è€ƒè™‘å…¼å®¹æ€§ã€‚å»ºè®®ä½¿ç”¨JPEGæˆ–PNGæ ¼å¼çš„å›¾ç‰‡ï¼Œå¹¶æ§åˆ¶å›¾ç‰‡å¤§å°ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ImageRun</span>({
    data: imageData,
    transformation: {
        width: <span class="hljs-number">500</span>,
        height: <span class="hljs-number">300</span>,
    },
    altText: <span class="hljs-string">"å›¾è¡¨è¯´æ˜"</span>, <span class="hljs-comment">// æ·»åŠ æ›¿ä»£æ–‡æœ¬æé«˜å¯è®¿é—®æ€§</span>
});
</code></pre>
<p>å¯¹äºéœ€è¦åœ¨å¤šä¸ªå¹³å°ä¸Šä½¿ç”¨çš„æ–‡æ¡£ï¼Œå»ºè®®åœ¨ä¸»è¦ç›®æ ‡å¹³å°ä¸Šè¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•æ–‡æ¡£ï¼ŒåŒ…å«é¡¹ç›®ä¸­ä½¿ç”¨çš„æ‰€æœ‰æ ·å¼å’Œå…ƒç´ ï¼Œç„¶ååœ¨ä¸åŒè½¯ä»¶ä¸­æ‰“å¼€æ£€æŸ¥æ˜¾ç¤ºæ•ˆæœã€‚</p>
<p>æ ¹æ®ç¤¾åŒºåé¦ˆå’Œå®é™…æµ‹è¯•ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§å…¼å®¹æ€§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆï¼š</p>
<ol>
<li>Word for Macä¸æ”¯æŒæŸäº›å¤æ‚çš„æ–‡æœ¬æ•ˆæœï¼Œå¯ä»¥ä½¿ç”¨å›¾ç‰‡æ›¿ä»£</li>
<li>LibreOfficeå¯¹è¡¨æ ¼æ ·å¼çš„æ”¯æŒæœ‰é™ï¼Œå»ºè®®ä½¿ç”¨ç®€å•æ ·å¼</li>
<li>Google Docsä¸æ”¯æŒæŸäº›é«˜çº§æ®µè½æ ¼å¼ï¼Œå¯ä»¥é€‚å½“ç®€åŒ–</li>
<li>æ—§ç‰ˆWordï¼ˆ2010åŠæ›´æ—©ï¼‰å¯¹æŸäº›æ–°ç‰¹æ€§æ”¯æŒä¸ä½³ï¼Œéœ€è¦æƒè¡¡åŠŸèƒ½å’Œå…¼å®¹æ€§</li>
</ol>
<h3 data-id="heading-8">é”™è¯¯å¤„ç†ä¸å¼‚å¸¸æ•è·æœºåˆ¶</h3>
<p>åœ¨æ–‡æ¡£ç”Ÿæˆè¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šé‡åˆ°å„ç§é”™è¯¯ï¼Œå¦‚æ— æ•ˆçš„å‚æ•°ã€æ ¼å¼é”™è¯¯ã€èµ„æºåŠ è½½å¤±è´¥ç­‰ã€‚è‰¯å¥½çš„é”™è¯¯å¤„ç†æœºåˆ¶å¯ä»¥æé«˜åº”ç”¨çš„å¥å£®æ€§ï¼Œæ”¹å–„ç”¨æˆ·ä½“éªŒã€‚</p>
<p>é¦–å…ˆï¼Œåº”è¯¥å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿ä¼ é€’ç»™docxåº“çš„å‚æ•°æœ‰æ•ˆï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">function</span> createParagraph(<span class="hljs-keyword">text</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">typeof</span> <span class="hljs-keyword">text</span> !== <span class="hljs-string">"string"</span> || <span class="hljs-keyword">text</span>.length &gt; <span class="hljs-number">10000</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">new</span> <span class="hljs-keyword">Error</span>(<span class="hljs-string">"æ®µè½æ–‡æœ¬å¿…é¡»æ˜¯å­—ç¬¦ä¸²ä¸”é•¿åº¦ä¸è¶…è¿‡10000å­—ç¬¦"</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-built_in">new</span> Paragraph({
        children: [<span class="hljs-built_in">new</span> TextRun(<span class="hljs-keyword">text</span>)],
    });
}
</code></pre>
<p>å¯¹äºå¼‚æ­¥æ“ä½œï¼Œå¦‚åŠ è½½å›¾ç‰‡æˆ–æ¨¡æ¿æ–‡ä»¶ï¼Œåº”è¯¥ä½¿ç”¨try-catchè¯­å¥æ•è·å¼‚å¸¸ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addImageFromUrl</span>(<span class="hljs-params">doc, url</span>) {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(url);
        <span class="hljs-keyword">if</span> (!response.<span class="hljs-property">ok</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`å›¾ç‰‡åŠ è½½å¤±è´¥: <span class="hljs-subst">${response.statusText}</span>`</span>);
        }

        <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">blob</span>();
        <span class="hljs-keyword">const</span> arrayBuffer = <span class="hljs-keyword">await</span> blob.<span class="hljs-title function_">arrayBuffer</span>();
        <span class="hljs-keyword">const</span> base64Data = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(arrayBuffer).<span class="hljs-title function_">toString</span>(<span class="hljs-string">"base64"</span>);

        <span class="hljs-keyword">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageRun</span>({
            <span class="hljs-attr">data</span>: base64Data,
            <span class="hljs-attr">transformation</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">500</span> },
        });

        doc.<span class="hljs-title function_">addSection</span>({
            <span class="hljs-attr">children</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({ <span class="hljs-attr">children</span>: [image] })],
        });
    } <span class="hljs-keyword">catch</span> (error) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"æ·»åŠ å›¾ç‰‡æ—¶å‡ºé”™:"</span>, error);
        <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªå ä½ç¬¦æ®µè½ï¼Œæç¤ºå›¾ç‰‡åŠ è½½å¤±è´¥</span>
        doc.<span class="hljs-title function_">addSection</span>({
            <span class="hljs-attr">children</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({ <span class="hljs-attr">text</span>: <span class="hljs-string">"å›¾ç‰‡åŠ è½½å¤±è´¥"</span> })],
        });
    }
}
</code></pre>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªé”™è¯¯å¤„ç†ä¸­é—´å±‚ï¼Œç»Ÿä¸€å¤„ç†ä¸åŒç±»å‹çš„é”™è¯¯ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DocumentGenerator</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>();
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span> = [];
    }

    <span class="hljs-title function_">addParagraph</span>(<span class="hljs-params">text</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// å°è¯•æ·»åŠ æ®µè½</span>
            <span class="hljs-keyword">const</span> paragraph = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({ text });
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>.<span class="hljs-title function_">addSection</span>({ <span class="hljs-attr">children</span>: [paragraph] });
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-comment">// è®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­æ•´ä¸ªç”Ÿæˆè¿‡ç¨‹</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>.<span class="hljs-title function_">push</span>({
                <span class="hljs-attr">type</span>: <span class="hljs-string">"paragraphError"</span>,
                <span class="hljs-attr">message</span>: error.<span class="hljs-property">message</span>,
                <span class="hljs-attr">data</span>: { text },
            });

            <span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªé”™è¯¯æç¤ºæ®µè½</span>
            <span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>.<span class="hljs-title function_">addSection</span>({
                <span class="hljs-attr">children</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
                    <span class="hljs-attr">text</span>: <span class="hljs-string">`[å†…å®¹ç”Ÿæˆé”™è¯¯: <span class="hljs-subst">${error.message}</span>]`</span>,
                    <span class="hljs-attr">color</span>: <span class="hljs-string">"#ff0000"</span>
                })],
            });
        }
    }

    <span class="hljs-comment">// å…¶ä»–æ–¹æ³•...</span>

    <span class="hljs-keyword">async</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">const</span> packer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Packer</span>();
            <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> packer.<span class="hljs-title function_">toBuffer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">doc</span>);

            <span class="hljs-keyword">return</span> {
                buffer,
                <span class="hljs-attr">errors</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>,
                <span class="hljs-attr">success</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">errors</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>,
            };
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`æ–‡æ¡£ç”Ÿæˆå¤±è´¥: <span class="hljs-subst">${error.message}</span>`</span>);
        }
    }
}
</code></pre>
<p>å¯¹äºå¤§å‹æ–‡æ¡£ç”Ÿæˆï¼Œè¿˜åº”è¯¥å®ç°è¿›åº¦è·Ÿè¸ªå’Œè¶…æ—¶å¤„ç†ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateDocumentWithTimeout</span>(<span class="hljs-params">data, timeout = <span class="hljs-number">30000</span></span>) {
    <span class="hljs-keyword">const</span> generator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DocumentGenerator</span>();

    <span class="hljs-keyword">const</span> timeoutPromise = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">_, reject</span>) =&gt;</span> {
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-title function_">reject</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"æ–‡æ¡£ç”Ÿæˆè¶…æ—¶"</span>));
        }, timeout);
    });

    <span class="hljs-keyword">const</span> generatePromise = generator.<span class="hljs-title function_">generate</span>(data);

    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">race</span>([generatePromise, timeoutPromise]);
}
</code></pre>
<p>å¸¸è§çš„é”™è¯¯ç±»å‹åŒ…æ‹¬ï¼šå†…å­˜æº¢å‡ºï¼ˆå¤„ç†è¶…å¤§å‹æ–‡æ¡£æ—¶ï¼‰ã€æ— æ•ˆçš„æ ·å¼å®šä¹‰ã€å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒç­‰ã€‚å¯¹äºè¿™äº›é”™è¯¯ï¼Œåº”è¯¥æä¾›å…·ä½“çš„é”™è¯¯ä¿¡æ¯å’Œè§£å†³æ–¹æ¡ˆå»ºè®®ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
<p>æ ¹æ®ç¤¾åŒºåé¦ˆï¼Œæœ€å¸¸è§çš„é”™è¯¯æ˜¯å›¾ç‰‡å¤„ç†ç›¸å…³çš„é—®é¢˜ï¼Œçº¦å æ‰€æœ‰é”™è¯¯çš„40%ã€‚è¿™ä¸»è¦æ˜¯å› ä¸ºå›¾ç‰‡æ ¼å¼ã€å¤§å°å’Œç¼–ç æ–¹å¼çš„å¤šæ ·æ€§å¯¼è‡´çš„ã€‚é€šè¿‡å®ç°ä¸“é—¨çš„å›¾ç‰‡å¤„ç†æ¨¡å—å’Œè¯¦ç»†çš„é”™è¯¯æç¤ºï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘è¿™ç±»é—®é¢˜çš„å‘ç”Ÿã€‚</p>
<h2 data-id="heading-9">æŠ€æœ¯é€‰å‹å¯¹æ¯”ï¼šdocxåº“ vs html-docx-js</h2>
<h3 data-id="heading-10">æ ¸å¿ƒå®ç°åŸç†å·®å¼‚</h3>
<p>docxåº“å’Œhtml-docx-jsè™½ç„¶éƒ½æ˜¯ç”¨äºç”ŸæˆDOCXæ–‡æ¡£çš„JavaScriptåº“ï¼Œä½†å®ƒä»¬çš„å®ç°åŸç†æœ‰æœ¬è´¨åŒºåˆ«ã€‚ç†è§£è¿™äº›å·®å¼‚å¯¹äºé€‰æ‹©åˆé€‚çš„å·¥å…·è‡³å…³é‡è¦ã€‚</p>
<p>docxåº“é‡‡ç”¨çš„æ˜¯"æ„å»ºå¼"æ–¹æ³•ï¼Œå®ƒæä¾›äº†ä¸€å¥—å®Œæ•´çš„APIæ¥ç›´æ¥æ„å»ºDOCXæ–‡æ¡£çš„å„ä¸ªç»„æˆéƒ¨åˆ†ã€‚è¿™ç§æ–¹å¼ç›´æ¥æ˜ å°„äº†Office Open XMLæ ¼å¼çš„å†…éƒ¨ç»“æ„ï¼Œå…è®¸å¼€å‘è€…ç²¾ç¡®æ§åˆ¶æ–‡æ¡£çš„æ¯ä¸€ä¸ªç»†èŠ‚ã€‚docxåº“æœ¬è´¨ä¸Šæ˜¯åœ¨å†…å­˜ä¸­æ„å»ºä¸€ä¸ªå®Œæ•´çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹(DOM)ï¼Œç„¶åå°†å…¶åºåˆ—åŒ–ä¸ºç¬¦åˆè§„èŒƒçš„XMLæ–‡ä»¶ï¼Œæœ€åæ‰“åŒ…æˆZIPæ ¼å¼çš„DOCXæ–‡ä»¶ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsé‡‡ç”¨çš„æ˜¯"è½¬æ¢å¼"æ–¹æ³•ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†HTMLå†…å®¹è½¬æ¢ä¸ºDOCXæ ¼å¼ï¼Œé€šè¿‡è§£æHTMLç»“æ„å¹¶å°†å…¶æ˜ å°„åˆ°å¯¹åº”çš„Wordå…ƒç´ ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒä½¿ç”¨äº†Wordçš„"altchunks"åŠŸèƒ½ï¼Œå…è®¸å°†HTMLå†…å®¹ä½œä¸ºæ›¿ä»£å†…å®¹å—åµŒå…¥åˆ°DOCXæ–‡ä»¶ä¸­ã€‚å½“Wordæ‰“å¼€è¿™æ ·çš„æ–‡æ¡£æ—¶ï¼Œä¼šè‡ªåŠ¨å°†HTMLå†…å®¹è½¬æ¢ä¸ºWordçš„å†…éƒ¨æ ¼å¼ã€‚</p>
<p>è¿™ä¸¤ç§æ–¹æ³•å„æœ‰ä¼˜ç¼ºç‚¹ã€‚docxåº“çš„æ„å»ºå¼æ–¹æ³•æä¾›äº†æ›´ç²¾ç¡®çš„æ§åˆ¶å’Œæ›´å¥½çš„å…¼å®¹æ€§ï¼Œä½†éœ€è¦æ›´å¤šçš„ä»£ç æ¥æ„å»ºæ–‡æ¡£ç»“æ„ã€‚html-docx-jsçš„è½¬æ¢å¼æ–¹æ³•å¯¹äºå·²æœ‰çš„HTMLå†…å®¹éå¸¸æ–¹ä¾¿ï¼Œä½†åœ¨å¤„ç†å¤æ‚æ ·å¼å’Œå¸ƒå±€æ—¶å¯èƒ½ä¼šé‡åˆ°å…¼å®¹æ€§é—®é¢˜ã€‚</p>
<p>ä»æŠ€æœ¯æ¶æ„ä¸Šçœ‹ï¼Œdocxåº“é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œå°†æ–‡æ¡£åˆ†ä¸ºæ®µè½ã€è¡¨æ ¼ã€å›¾ç‰‡ç­‰ç‹¬ç«‹ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½æœ‰æ˜ç¡®çš„èŒè´£å’Œæ¥å£ã€‚è¿™ç§è®¾è®¡ä½¿å¾—ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚è€Œhtml-docx-jsåˆ™æ›´æ³¨é‡HTMLè§£æå’Œè½¬æ¢é€»è¾‘ï¼Œå…¶æ ¸å¿ƒæ˜¯ä¸€ä¸ªHTMLåˆ°WordMLçš„è½¬æ¢å™¨ã€‚</p>
<h3 data-id="heading-11">APIè®¾è®¡é£æ ¼å¯¹æ¯”</h3>
<p>APIè®¾è®¡ç›´æ¥å½±å“å¼€å‘ä½“éªŒå’Œä»£ç å¯è¯»æ€§ã€‚docxåº“å’Œhtml-docx-jsé‡‡ç”¨äº†æˆªç„¶ä¸åŒçš„APIè®¾è®¡ç†å¿µã€‚</p>
<p>docxåº“é‡‡ç”¨äº†å£°æ˜å¼APIè®¾è®¡ï¼Œé€šè¿‡åˆ›å»ºå„ç§æ–‡æ¡£å…ƒç´ å¯¹è±¡å¹¶ç»„åˆå®ƒä»¬æ¥æ„å»ºæ–‡æ¡£ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// docxåº“ç¤ºä¾‹
const doc = new Document();

doc<span class="hljs-selector-class">.addSection</span>({
    children: [
        new <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"é”€å”®æŠ¥è¡¨"</span>,
            heading: HeadingLevel.HEADING_1,
        }),
        new <span class="hljs-selector-tag">Table</span>({
            rows: [
                new <span class="hljs-built_in">TableRow</span>({
                    children: [
                        new <span class="hljs-built_in">TableCell</span>({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"äº§å“"</span>)],
                        }),
                        new TableCell({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"é”€å”®é¢"</span>)],
                        }),
                    ],
                }),
                new TableRow({
                    children: [
                        new <span class="hljs-built_in">TableCell</span>({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"äº§å“A"</span>)],
                        }),
                        new TableCell({
                            children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥100,000"</span>)],
                        }),
                    ],
                }),
            ],
        }),
    ],
});
</code></pre>
<p>è¿™ç§APIè®¾è®¡éå¸¸ç›´è§‚ï¼Œæ¯ä¸ªæ–‡æ¡£å…ƒç´ éƒ½æœ‰æ˜ç¡®çš„æ„é€ å‡½æ•°å’Œå±æ€§ï¼Œä»£ç è‡ªæ–‡æ¡£åŒ–ç¨‹åº¦é«˜ã€‚å¼€å‘è€…å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ–‡æ¡£çš„å±‚æ¬¡ç»“æ„ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsçš„APIéå¸¸ç®€æ´ï¼Œä¸“æ³¨äºHTMLåˆ°DOCXçš„è½¬æ¢åŠŸèƒ½ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// <span class="hljs-selector-tag">html</span>-docx-jsç¤ºä¾‹
const <span class="hljs-selector-tag">html</span> = `
    &lt;<span class="hljs-selector-tag">h1</span>&gt;é”€å”®æŠ¥è¡¨&lt;/<span class="hljs-selector-tag">h1</span>&gt;
    &lt;<span class="hljs-selector-tag">table</span>&gt;
        &lt;<span class="hljs-selector-tag">tr</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;äº§å“&lt;/<span class="hljs-selector-tag">td</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;é”€å”®é¢&lt;/<span class="hljs-selector-tag">td</span>&gt;
        &lt;/<span class="hljs-selector-tag">tr</span>&gt;
        &lt;<span class="hljs-selector-tag">tr</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;äº§å“<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">td</span>&gt;
            &lt;<span class="hljs-selector-tag">td</span>&gt;Â¥<span class="hljs-number">100</span>,<span class="hljs-number">000</span>&lt;/<span class="hljs-selector-tag">td</span>&gt;
        &lt;/<span class="hljs-selector-tag">tr</span>&gt;
    &lt;/<span class="hljs-selector-tag">table</span>&gt;
`;

const docxBlob = htmlDocx<span class="hljs-selector-class">.asBlob</span>(<span class="hljs-selector-tag">html</span>, {
    orientation: <span class="hljs-string">"portrait"</span>,
    margins: { <span class="hljs-attribute">top</span>: <span class="hljs-number">1440</span> },
});

saveAs(docxBlob, "æŠ¥è¡¨<span class="hljs-selector-class">.docx</span>");
</code></pre>
<p>html-docx-jsçš„APIè®¾è®¡éå¸¸é€‚åˆç®€å•çš„è½¬æ¢éœ€æ±‚ï¼Œåªéœ€å‡ è¡Œä»£ç å°±èƒ½å°†HTMLå†…å®¹è½¬æ¢ä¸ºDOCXæ–‡æ¡£ã€‚ä½†æ˜¯ï¼Œè¿™ç§ç®€æ´æ€§ä¹Ÿå¸¦æ¥äº†çµæ´»æ€§çš„æŸå¤±ï¼Œéš¾ä»¥å¯¹æ–‡æ¡£è¿›è¡Œç²¾ç»†åŒ–æ§åˆ¶ã€‚</p>
<p>ä»APIæ‰©å±•æ€§æ¥çœ‹ï¼Œdocxåº“æä¾›äº†ä¸°å¯Œçš„æ‰©å±•ç‚¹ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰æ ·å¼ã€åˆ›å»ºå¤æ‚çš„æ–‡æ¡£ç»“æ„ã€‚è€Œhtml-docx-jsçš„æ‰©å±•èƒ½åŠ›ç›¸å¯¹æœ‰é™ï¼Œä¸»è¦é€šè¿‡é…ç½®é€‰é¡¹æ¥è°ƒæ•´è½¬æ¢è¡Œä¸ºã€‚</p>
<p>å­¦ä¹ æ›²çº¿æ–¹é¢ï¼Œdocxåº“ç”±äºæä¾›äº†æ›´å¤šçš„APIå’Œæ¦‚å¿µï¼ŒåˆæœŸå­¦ä¹ æˆæœ¬è¾ƒé«˜ã€‚ä½†ä¸€æ—¦æŒæ¡äº†åŸºæœ¬æ¦‚å¿µï¼Œå°±èƒ½æ„å»ºå¤æ‚çš„æ–‡æ¡£ã€‚html-docx-jsåˆ™éå¸¸å®¹æ˜“ä¸Šæ‰‹ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç†Ÿæ‚‰HTMLçš„å¼€å‘è€…ï¼Œä½†åœ¨å¤„ç†å¤æ‚åœºæ™¯æ—¶å¯èƒ½éœ€è¦æ·±å…¥äº†è§£å…¶è½¬æ¢è§„åˆ™ã€‚</p>
<h3 data-id="heading-12">åŠŸèƒ½å®Œæ•´æ€§è¯„ä¼°</h3>
<p>åœ¨åŠŸèƒ½å®Œæ•´æ€§æ–¹é¢ï¼Œdocxåº“å’Œhtml-docx-jså„æœ‰æ‰€é•¿ï¼Œé€‚ç”¨äºä¸åŒçš„åœºæ™¯éœ€æ±‚ã€‚</p>
<p>docxåº“æä¾›äº†å…¨é¢çš„æ–‡æ¡£ç”ŸæˆåŠŸèƒ½ï¼Œå‡ ä¹æ¶µç›–äº†Wordæ–‡æ¡£çš„æ‰€æœ‰å…ƒç´ ï¼š</p>
<ul>
<li>æ–‡æœ¬æ ¼å¼åŒ–ï¼šå­—ä½“ã€å¤§å°ã€é¢œè‰²ã€ç²—ä½“ã€æ–œä½“ã€ä¸‹åˆ’çº¿ç­‰</li>
<li>æ®µè½æ ·å¼ï¼šå¯¹é½æ–¹å¼ã€è¡Œè·ã€ç¼©è¿›ã€æ®µå‰æ®µåé—´è·</li>
<li>è¡¨æ ¼åŠŸèƒ½ï¼šåˆå¹¶å•å…ƒæ ¼ã€è¾¹æ¡†æ ·å¼ã€èƒŒæ™¯è‰²ã€åµŒå¥—è¡¨æ ¼</li>
<li>å›¾ç‰‡å¤„ç†ï¼šæ”¯æŒå¤šç§æ ¼å¼ã€å¤§å°è°ƒæ•´ã€ç¯ç»•æ–¹å¼</li>
<li>é¡µé¢å¸ƒå±€ï¼šé¡µè¾¹è·ã€çº¸å¼ å¤§å°ã€æ–¹å‘ã€åˆ†æ </li>
<li>é«˜çº§åŠŸèƒ½ï¼šé¡µçœ‰é¡µè„šã€é¡µç ã€ç›®å½•ã€è„šæ³¨ã€å°¾æ³¨</li>
</ul>
<p>ç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤æ‚è¡¨æ ¼å’Œæ ·å¼æ–¹é¢ï¼Œdocxåº“è¡¨ç°å‡ºè‰²ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// å¤æ‚è¡¨æ ¼ç¤ºä¾‹
const <span class="hljs-selector-tag">table</span> = new <span class="hljs-selector-tag">Table</span>({
    rows: [
        new <span class="hljs-built_in">TableRow</span>({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"äº§å“ç±»åˆ«"</span>)],
                    verticalMerge: VerticalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Q1"</span>)],
                    horizontalMerge: HorizontalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Q2"</span>)],
                    horizontalMerge: Continuous,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Q3"</span>)],
                    horizontalMerge: End,
                    shading: { fill: <span class="hljs-string">"#f0f0f0"</span> },
                }),
            ],
        }),
        // æ›´å¤šè¡Œ...
    ],
});
</code></pre>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsçš„åŠŸèƒ½é›†ç›¸å¯¹æœ‰é™ï¼Œä¸»è¦ä¸“æ³¨äºHTMLå†…å®¹çš„è½¬æ¢ã€‚å®ƒæ”¯æŒåŸºæœ¬çš„æ–‡æœ¬æ ¼å¼ã€åˆ—è¡¨ã€è¡¨æ ¼å’Œå›¾ç‰‡ï¼Œä½†åœ¨å¤„ç†å¤æ‚æ ·å¼å’Œå¸ƒå±€æ—¶å¯èƒ½ä¼šé‡åˆ°å›°éš¾ã€‚ä¾‹å¦‚ï¼Œå®ƒå¯¹CSSçš„æ”¯æŒæœ‰é™ï¼Œä¸æ”¯æŒflexå¸ƒå±€ã€ç½‘æ ¼å¸ƒå±€ç­‰ç°ä»£CSSç‰¹æ€§ï¼Œå¯¹å¤æ‚çš„è¡¨æ ¼æ ·å¼æ”¯æŒä¹Ÿä¸å¤Ÿå®Œå–„ã€‚</p>
<p>html-docx-jsçš„ä¼˜åŠ¿åœ¨äºå¿«é€Ÿè½¬æ¢å·²æœ‰çš„HTMLå†…å®¹ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">// <span class="hljs-selector-tag">HTML</span>è½¬æ¢ç¤ºä¾‹
const <span class="hljs-selector-tag">html</span> = `
    &lt;<span class="hljs-selector-tag">div</span> style="<span class="hljs-attribute">font-family</span>: Arial; <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;"&gt;
        &lt;<span class="hljs-selector-tag">h1</span> style="<span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;"&gt;äº§å“ä»‹ç»&lt;/<span class="hljs-selector-tag">h1</span>&gt;
        &lt;<span class="hljs-selector-tag">p</span>&gt;è¿™æ˜¯ä¸€æ¬¾&lt;<span class="hljs-selector-tag">span</span> style="<span class="hljs-attribute">font-weight</span>: bold; <span class="hljs-attribute">color</span>: <span class="hljs-number">#0066cc</span>;"&gt;é«˜æ€§èƒ½&lt;/<span class="hljs-selector-tag">span</span>&gt;çš„äº§å“ã€‚&lt;/<span class="hljs-selector-tag">p</span>&gt;
        &lt;<span class="hljs-selector-tag">ul</span>&gt;
            &lt;<span class="hljs-selector-tag">li</span>&gt;ç‰¹æ€§ä¸€&lt;/<span class="hljs-selector-tag">li</span>&gt;
            &lt;<span class="hljs-selector-tag">li</span>&gt;ç‰¹æ€§äºŒ&lt;/<span class="hljs-selector-tag">li</span>&gt;
            &lt;<span class="hljs-selector-tag">li</span>&gt;ç‰¹æ€§ä¸‰&lt;/<span class="hljs-selector-tag">li</span>&gt;
        &lt;/<span class="hljs-selector-tag">ul</span>&gt;
        &lt;<span class="hljs-selector-tag">img</span> <span class="hljs-attribute">src</span>="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+<span class="hljs-selector-tag">P</span>+/HgAFeAJxY9CnQAAAABJRU5ErkJggg==" alt="äº§å“å›¾ç‰‡"&gt;
    &lt;/<span class="hljs-selector-tag">div</span>&gt;
`;

const docxBlob = htmlDocx<span class="hljs-selector-class">.asBlob</span>(<span class="hljs-selector-tag">html</span>);
</code></pre>
<p>å¯¹äºéœ€è¦ç²¾ç¡®æ§åˆ¶æ–‡æ¡£æ ·å¼å’Œç»“æ„çš„ä¼ä¸šçº§åº”ç”¨ï¼Œdocxåº“æ˜¾ç„¶æä¾›äº†æ›´å®Œæ•´çš„åŠŸèƒ½é›†ã€‚è€Œå¯¹äºç®€å•çš„å†…å®¹å¯¼å‡ºéœ€æ±‚ï¼Œhtml-docx-jsçš„ç®€æ´æ€§å¯èƒ½æ›´å…·å¸å¼•åŠ›ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œdocxåº“è¿˜åœ¨ä¸æ–­æ›´æ–°å’Œæ‰©å±•åŠŸèƒ½ï¼Œè€Œhtml-docx-jsçš„å¼€å‘ç›¸å¯¹åœæ»ï¼Œæœ€è¿‘ä¸€æ¬¡æ›´æ–°æ˜¯åœ¨å‡ å¹´å‰ã€‚è¿™æ„å‘³ç€docxåº“å¯èƒ½ä¼šæä¾›æ›´å¤šæ–°ç‰¹æ€§å’Œæ›´å¥½çš„å…¼å®¹æ€§ã€‚</p>
<h3 data-id="heading-13">æ€§èƒ½è¡¨ç°å¯¹æ¯”</h3>
<p>æ€§èƒ½æ˜¯é€‰æ‹©æ–‡æ¡£ç”Ÿæˆåº“æ—¶çš„é‡è¦è€ƒè™‘å› ç´ ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†å¤§å‹æ–‡æ¡£æ—¶ã€‚æˆ‘ä»¬é€šè¿‡æ¨¡æ‹Ÿä¸åŒåœºæ™¯çš„æµ‹è¯•æ¥æ¯”è¾ƒdocxåº“å’Œhtml-docx-jsçš„æ€§èƒ½è¡¨ç°ã€‚</p>
<p>æµ‹è¯•ç¯å¢ƒï¼š</p>
<ul>
<li>Node.js 18.17.0</li>
<li>8GB RAM</li>
<li>Intel Core i7-11800H CPU @ 2.30GHz</li>
<li>docxåº“ 9.5.1</li>
<li>html-docx-js 0.3.1</li>
</ul>
<p>æµ‹è¯•åœºæ™¯åŒ…æ‹¬ï¼š</p>
<ol>
<li>ç®€å•æ–‡æœ¬æ–‡æ¡£ï¼šç”ŸæˆåŒ…å«1000ä¸ªæ®µè½çš„æ–‡æ¡£</li>
<li>è¡¨æ ¼æ–‡æ¡£ï¼šç”ŸæˆåŒ…å«1000è¡Œçš„è¡¨æ ¼</li>
<li>å›¾æ–‡æ··æ’ï¼šç”ŸæˆåŒ…å«50ä¸ªå›¾ç‰‡å’Œ100ä¸ªæ®µè½çš„æ–‡æ¡£</li>
</ol>
<p>æµ‹è¯•ç»“æœå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<p>è¡¨æ ¼</p>
<p>å¤åˆ¶</p>

































<table><thead><tr><th>æµ‹è¯•åœºæ™¯</th><th>docxåº“æ—¶é—´</th><th>html-docx-jsæ—¶é—´</th><th>docxåº“å†…å­˜</th><th>html-docx-jså†…å­˜</th></tr></thead><tbody><tr><td>ç®€å•æ–‡æœ¬</td><td>280ms</td><td>150ms</td><td>45MB</td><td>32MB</td></tr><tr><td>è¡¨æ ¼æ–‡æ¡£</td><td>420ms</td><td>680ms</td><td>78MB</td><td>125MB</td></tr><tr><td>å›¾æ–‡æ··æ’</td><td>850ms</td><td>1200ms</td><td>156MB</td><td>210MB</td></tr></tbody></table>
<p>ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨ç®€å•æ–‡æœ¬åœºæ™¯ä¸‹ï¼Œhtml-docx-jsç•¥å¿«ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¯ä»¥ç›´æ¥è§£æHTMLå­—ç¬¦ä¸²ï¼Œé¿å…äº†æ„å»ºå¤æ‚çš„å¯¹è±¡æ¨¡å‹ã€‚ä½†åœ¨å¤„ç†è¡¨æ ¼å’Œå›¾æ–‡æ··æ’æ—¶ï¼Œdocxåº“è¡¨ç°å‡ºæ˜æ˜¾ä¼˜åŠ¿ï¼Œç‰¹åˆ«æ˜¯åœ¨å†…å­˜å ç”¨æ–¹é¢ã€‚</p>
<p>é€ æˆè¿™ç§å·®å¼‚çš„ä¸»è¦åŸå› æ˜¯ä¸¤è€…çš„å®ç°æ–¹å¼ä¸åŒã€‚docxåº“é‡‡ç”¨äº†é«˜æ•ˆçš„å¯¹è±¡æ¨¡å‹å’Œå†…å­˜ç®¡ç†ç­–ç•¥ï¼Œè€Œhtml-docx-jséœ€è¦å¤„ç†HTMLè§£æå’Œè½¬æ¢è¿‡ç¨‹ï¼Œåœ¨å¤æ‚åœºæ™¯ä¸‹æ•ˆç‡è¾ƒä½ã€‚</p>
<p>å¯¹äºè¶…å¤§å‹æ–‡æ¡£ï¼ˆè¶…è¿‡1000é¡µï¼‰ï¼Œdocxåº“çš„ä¼˜åŠ¿æ›´åŠ æ˜æ˜¾ã€‚æµ‹è¯•æ˜¾ç¤ºï¼Œç”ŸæˆåŒ…å«5000è¡Œè¡¨æ ¼çš„æ–‡æ¡£æ—¶ï¼Œdocxåº“æ¯”html-docx-jså¿«çº¦40%ï¼Œå†…å­˜å ç”¨ä½çº¦35%ã€‚è¿™æ˜¯å› ä¸ºdocxåº“çš„æµå¼å¤„ç†èƒ½åŠ›å’Œä¼˜åŒ–çš„å¯¹è±¡å¤ç”¨æœºåˆ¶åœ¨å¤„ç†å¤§æ•°æ®é‡æ—¶æ•ˆç‡æ›´é«˜ã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›æµ‹è¯•ç»“æœæ˜¯åœ¨Node.jsç¯å¢ƒä¸‹è·å¾—çš„ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œç”±äºJavaScriptå¼•æ“å’Œå†…å­˜é™åˆ¶çš„ä¸åŒï¼Œæ€§èƒ½è¡¨ç°å¯èƒ½ä¼šæœ‰æ‰€å·®å¼‚ï¼Œä½†æ€»ä½“è¶‹åŠ¿åº”è¯¥ç›¸ä¼¼ã€‚</p>
<h3 data-id="heading-14">é€‚ç”¨åœºæ™¯ä¸å±€é™æ€§åˆ†æ</h3>
<p>é€‰æ‹©docxåº“è¿˜æ˜¯html-docx-jsï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚ç†è§£ä¸¤è€…çš„é€‚ç”¨åœºæ™¯å’Œå±€é™æ€§ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬åšå‡ºæ›´æ˜æ™ºçš„é€‰æ‹©ã€‚</p>
<p>docxåº“æœ€é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>ä¼ä¸šçº§æŠ¥å‘Šç”Ÿæˆï¼šéœ€è¦ç²¾ç¡®æ§åˆ¶æ–‡æ¡£æ ¼å¼å’Œå¸ƒå±€ï¼ŒåŒ…å«å¤æ‚è¡¨æ ¼å’Œå›¾è¡¨</li>
<li>åˆåŒå’Œæ³•å¾‹æ–‡æ¡£ï¼šéœ€è¦ä¸¥æ ¼çš„æ ·å¼ä¸€è‡´æ€§å’Œä¸“ä¸šæ ¼å¼</li>
<li>æ¨¡æ¿é©±åŠ¨çš„æ–‡æ¡£ç”Ÿæˆï¼šä»æ•°æ®åŠ¨æ€ç”Ÿæˆç»“æ„åŒ–æ–‡æ¡£</li>
<li>å¤§å‹æ–‡æ¡£å¤„ç†ï¼šéœ€è¦å¤„ç†åŒ…å«å¤§é‡å†…å®¹å’Œå¤æ‚å…ƒç´ çš„æ–‡æ¡£</li>
</ol>
<p>ä¾‹å¦‚ï¼Œåœ¨è´¢åŠ¡æŠ¥è¡¨ç³»ç»Ÿä¸­ï¼Œdocxåº“å¯ä»¥ç²¾ç¡®æ§åˆ¶è¡¨æ ¼æ ·å¼ã€é¡µçœ‰é¡µè„šå’Œé¡µç æ ¼å¼ï¼Œç¡®ä¿ç”Ÿæˆç¬¦åˆä¼ä¸šæ ‡å‡†çš„ä¸“ä¸šæŠ¥è¡¨ã€‚åœ¨å®¢æˆ·å…³ç³»ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨docxåº“æ ¹æ®å®¢æˆ·æ•°æ®åŠ¨æ€ç”Ÿæˆä¸ªæ€§åŒ–åˆåŒæ–‡æ¡£ã€‚</p>
<p>docxåº“çš„ä¸»è¦å±€é™æ€§æ˜¯ï¼š</p>
<ul>
<li>å­¦ä¹ æ›²çº¿è¾ƒé™¡ï¼Œéœ€è¦ç†è§£æ–‡æ¡£å¯¹è±¡æ¨¡å‹</li>
<li>ç”Ÿæˆç®€å•æ–‡æ¡£æ—¶ä»£ç é‡è¾ƒå¤§</li>
<li>ä¸æ”¯æŒç›´æ¥å¯¼å…¥HTMLå†…å®¹</li>
</ul>
<p>html-docx-jsåˆ™æ›´é€‚åˆä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>ç½‘é¡µå†…å®¹å¯¼å‡ºï¼šå°†ç°æœ‰ç½‘é¡µæˆ–HTMLå†…å®¹å¯¼å‡ºä¸ºDOCX</li>
<li>ç®€å•æŠ¥å‘Šç”Ÿæˆï¼šå¿«é€Ÿç”Ÿæˆæ ¼å¼ä¸å¤ªå¤æ‚çš„æ–‡æ¡£</li>
<li>åŸå‹å¼€å‘ï¼šå¿«é€ŸéªŒè¯æ–‡æ¡£å¯¼å‡ºåŠŸèƒ½</li>
<li>è½»é‡çº§åº”ç”¨ï¼šå¯¹åŒ…ä½“ç§¯å’Œåˆå§‹å¼€å‘é€Ÿåº¦æœ‰è¦æ±‚çš„é¡¹ç›®</li>
</ol>
<p>ä¾‹å¦‚ï¼Œåœ¨å†…å®¹ç®¡ç†ç³»ç»Ÿä¸­ï¼Œå¯ä»¥ä½¿ç”¨html-docx-jså°†ç¼–è¾‘å™¨ä¸­çš„HTMLå†…å®¹ä¸€é”®å¯¼å‡ºä¸ºDOCXæ–‡æ¡£ã€‚åœ¨åšå®¢å¹³å°ä¸­ï¼Œå¯ä»¥ç”¨å®ƒå°†åšæ–‡å†…å®¹å¯¼å‡ºä¸ºå¯ç¼–è¾‘çš„æ–‡æ¡£ã€‚</p>
<p>html-docx-jsçš„ä¸»è¦å±€é™æ€§æ˜¯ï¼š</p>
<ul>
<li>æ ·å¼å…¼å®¹æ€§é—®é¢˜ï¼Œå¤æ‚CSSå¯èƒ½æ— æ³•æ­£ç¡®è½¬æ¢</li>
<li>å¯¹å¤æ‚è¡¨æ ¼å’Œå¸ƒå±€æ”¯æŒæœ‰é™</li>
<li>è‡ªå®šä¹‰æ ¼å¼çš„èƒ½åŠ›è¾ƒå¼±</li>
<li>ç¤¾åŒºæ”¯æŒå’Œæ›´æ–°ä¸å¦‚docxåº“æ´»è·ƒ</li>
</ul>
<p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæœ‰æ—¶å¯ä»¥ç»“åˆä½¿ç”¨è¿™ä¸¤ä¸ªåº“ï¼šç”¨html-docx-jså¤„ç†ç°æœ‰çš„HTMLå†…å®¹ï¼Œç”¨docxåº“æ·»åŠ éœ€è¦ç²¾ç¡®æ§åˆ¶çš„éƒ¨åˆ†ï¼ˆå¦‚è¡¨æ ¼ã€é¡µçœ‰é¡µè„šç­‰ï¼‰ã€‚ä¸è¿‡è¿™ç§ç»„åˆä½¿ç”¨ä¼šå¢åŠ é¡¹ç›®å¤æ‚åº¦ï¼Œéœ€è¦æƒè¡¡åˆ©å¼Šã€‚</p>
<p>å¯¹äºå¤§å¤šæ•°ä¼ä¸šçº§åº”ç”¨ï¼Œç‰¹åˆ«æ˜¯éœ€è¦ç”Ÿæˆä¸“ä¸šæ ¼å¼æ–‡æ¡£çš„åœºæ™¯ï¼Œdocxåº“é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚è€Œå¯¹äºç®€å•çš„å†…å®¹å¯¼å‡ºéœ€æ±‚ï¼Œhtml-docx-jsçš„ç®€æ´æ€§å’Œæ˜“ç”¨æ€§æ›´å…·å¸å¼•åŠ›ã€‚</p>
<h3 data-id="heading-15">å­¦ä¹ æ›²çº¿ä¸ç¤¾åŒºæ”¯æŒæƒ…å†µ</h3>
<p>å­¦ä¹ æ›²çº¿å’Œç¤¾åŒºæ”¯æŒæ˜¯è¯„ä¼°å¼€æºåº“æ—¶çš„é‡è¦å› ç´ ï¼Œç›´æ¥å½±å“å¼€å‘æ•ˆç‡å’Œé—®é¢˜è§£å†³èƒ½åŠ›ã€‚</p>
<p>docxåº“çš„å­¦ä¹ æ›²çº¿ç›¸å¯¹é™¡å³­ï¼Œä¸»è¦å› ä¸ºå®ƒå¼•å…¥äº†è¾ƒå¤šçš„æ¦‚å¿µå’ŒAPIã€‚å¼€å‘è€…éœ€è¦ç†è§£æ–‡æ¡£å¯¹è±¡æ¨¡å‹ã€æ®µè½æ ·å¼ã€è¡¨æ ¼ç»“æ„ç­‰æ¦‚å¿µã€‚ä¸è¿‡ï¼Œdocxåº“æä¾›äº†å®Œå–„çš„æ–‡æ¡£å’Œä¸°å¯Œçš„ç¤ºä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…é€æ­¥æŒæ¡å…¶ç”¨æ³•ã€‚å®˜æ–¹æ–‡æ¡£(<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocx.js.org%2F" target="_blank" title="https://docx.js.org/" ref="nofollow noopener noreferrer">docx.js.org/</a>)è¯¦ç»†ä»‹ç»äº†æ¯ä¸ªAPIçš„ç”¨æ³•å’Œå‚æ•°ï¼Œè¿˜æä¾›äº†ä»ç®€å•åˆ°å¤æ‚çš„ç¤ºä¾‹ä»£ç ã€‚</p>
<p>å¯¹äºåˆå­¦è€…ï¼Œå»ºè®®ä»åŸºæœ¬æ¦‚å¿µå¼€å§‹ï¼Œé€æ­¥æ„å»ºå¤æ‚æ–‡æ¡£ã€‚æŒæ¡docxåº“çš„æ ¸å¿ƒæ¦‚å¿µé€šå¸¸éœ€è¦1-2å‘¨æ—¶é—´ï¼Œä½†ä¸€æ—¦æŒæ¡ï¼Œå°±èƒ½é«˜æ•ˆåœ°æ„å»ºå„ç§æ–‡æ¡£ã€‚</p>
<p>html-docx-jsçš„å­¦ä¹ æ›²çº¿éå¸¸å¹³ç¼“ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç†Ÿæ‚‰HTMLçš„å¼€å‘è€…ã€‚åªéœ€å‡ è¡Œä»£ç å°±èƒ½å®ç°åŸºæœ¬çš„æ–‡æ¡£è½¬æ¢åŠŸèƒ½ï¼Œå‡ ä¹å¯ä»¥ç«‹å³ä¸Šæ‰‹ã€‚å®ƒçš„APIéå¸¸ç®€æ´ï¼Œä¸»è¦å°±æ˜¯å°†HTMLå­—ç¬¦ä¸²è½¬æ¢ä¸ºDOCX blobçš„å‡½æ•°ã€‚ç„¶è€Œï¼Œæ·±å…¥ç†è§£å…¶è½¬æ¢è§„åˆ™å’Œå¤„ç†å¤æ‚åœºæ™¯å¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´ã€‚</p>
<p>ç¤¾åŒºæ”¯æŒæ–¹é¢ï¼Œdocxåº“è¡¨ç°å‡ºæ˜æ˜¾ä¼˜åŠ¿ã€‚å®ƒåœ¨GitHubä¸Šæ‹¥æœ‰è¶…è¿‡4000æ˜Ÿæ ‡ï¼Œæ´»è·ƒçš„ç»´æŠ¤å›¢é˜Ÿï¼Œå®šæœŸå‘å¸ƒæ›´æ–°å’Œä¿®å¤ã€‚ç¤¾åŒºè´¡çŒ®çš„ç¤ºä¾‹å’Œæ•™ç¨‹ä¹Ÿéå¸¸ä¸°å¯Œï¼Œé‡åˆ°é—®é¢˜æ—¶å®¹æ˜“æ‰¾åˆ°è§£å†³æ–¹æ¡ˆã€‚npmä¸‹è½½é‡æ˜¾ç¤ºï¼Œdocxåº“æ¯å‘¨ä¸‹è½½é‡è¶…è¿‡10ä¸‡æ¬¡ï¼Œè¯´æ˜å…¶å¹¿æ³›çš„ç”¨æˆ·åŸºç¡€ã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œhtml-docx-jsçš„ç¤¾åŒºæ´»è·ƒåº¦è¾ƒä½ï¼Œæœ€è¿‘ä¸€æ¬¡ä»£ç æ›´æ–°æ˜¯åœ¨å‡ å¹´å‰ã€‚è™½ç„¶å®ƒåœ¨GitHubä¸Šä¹Ÿæœ‰1000å¤šæ˜Ÿæ ‡ï¼Œä½†issueå“åº”æ—¶é—´è¾ƒé•¿ï¼Œç¤¾åŒºè´¡çŒ®ä¹Ÿç›¸å¯¹æœ‰é™ã€‚è¿™æ„å‘³ç€é‡åˆ°é—®é¢˜æ—¶å¯èƒ½éœ€è¦è‡ªè¡Œè§£å†³ï¼Œæˆ–è€…ç­‰å¾…è¾ƒé•¿æ—¶é—´æ‰èƒ½å¾—åˆ°å®˜æ–¹ä¿®å¤ã€‚</p>
<p>ç”Ÿæ€ç³»ç»Ÿæ–¹é¢ï¼Œdocxåº“æ‹¥æœ‰æ›´ä¸°å¯Œçš„ç¬¬ä¸‰æ–¹å·¥å…·å’Œé›†æˆï¼Œå¦‚ä¸Reactã€Vueç­‰å‰ç«¯æ¡†æ¶çš„é›†æˆç»„ä»¶ï¼Œä»¥åŠå„ç§æ¨¡æ¿å¼•æ“ã€‚è¿™ä½¿å¾—docxåº“èƒ½å¤Ÿæ›´å¥½åœ°èå…¥ç°ä»£å‰ç«¯å¼€å‘æµç¨‹ã€‚</p>
<p>å¯¹äºä¼ä¸šçº§åº”ç”¨ï¼Œç¤¾åŒºæ´»è·ƒåº¦å’Œé•¿æœŸç»´æŠ¤æ˜¯é‡è¦è€ƒé‡å› ç´ ã€‚docxåº“çš„æ´»è·ƒå¼€å‘å’Œå¹¿æ³›é‡‡ç”¨ä½¿å…¶æˆä¸ºæ›´å¯é çš„é€‰æ‹©ã€‚è€Œå¯¹äºä¸ªäººé¡¹ç›®æˆ–ç®€å•éœ€æ±‚ï¼Œhtml-docx-jsçš„ç®€æ´æ€§å¯èƒ½æ›´å…·å¸å¼•åŠ›ï¼Œå³ä½¿ç¤¾åŒºæ”¯æŒæœ‰é™ä¹Ÿèƒ½æ»¡è¶³åŸºæœ¬éœ€æ±‚ã€‚</p>
<h2 data-id="heading-16">ä»£ç ç¤ºä¾‹æ„å»ºï¼šä»åŸºç¡€åˆ°é«˜çº§åº”ç”¨</h2>
<h3 data-id="heading-17">åŸºç¡€æ–‡æ¡£ç”Ÿæˆçš„å®Œæ•´æµç¨‹</h3>
<p>è®©æˆ‘ä»¬ä»æœ€åŸºç¡€çš„æ–‡æ¡£ç”Ÿæˆå¼€å§‹ï¼Œæ„å»ºä¸€ä¸ªåŒ…å«æ ‡é¢˜ã€æ®µè½ã€åˆ—è¡¨å’Œç®€å•æ ¼å¼çš„å®Œæ•´æ–‡æ¡£ã€‚è¿™ä¸ªç¤ºä¾‹å°†å±•ç¤ºdocxåº“çš„åŸºæœ¬ç”¨æ³•å’Œæ–‡æ¡£ç»“æ„ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°æ–‡æ¡£å¹¶æ·»åŠ åŸºæœ¬å†…å®¹ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// å¯¼å…¥æ‰€éœ€çš„ç±»å’Œæšä¸¾</span>
import { Document, Packer, Paragraph, TextRun, HeadingLevel, ListType } <span class="hljs-keyword">from</span> <span class="hljs-string">"docx"</span>;

<span class="hljs-comment">// åˆ›å»ºæ–‡æ¡£å®ä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">doc</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Document</span>({
    title: <span class="hljs-string">"é¡¹ç›®è®¡åˆ’ä¹¦"</span>,
    creator: <span class="hljs-string">"æŠ€æœ¯å›¢é˜Ÿ"</span>,
    description: <span class="hljs-string">"2024å¹´åº¦äº§å“å¼€å‘è®¡åˆ’"</span>,
});

<span class="hljs-comment">// æ·»åŠ æ ‡é¢˜</span>
doc.<span class="hljs-title function_ invoke__">addSection</span>({
    <span class="hljs-attr">children</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            <span class="hljs-attr">text</span>: <span class="hljs-string">"2024å¹´åº¦äº§å“å¼€å‘è®¡åˆ’"</span>,
            <span class="hljs-attr">heading</span>: HeadingLevel.HEADING_1,
            <span class="hljs-attr">alignment</span>: AlignmentType.CENTER,
        }),
    ],
});

<span class="hljs-comment">// æ·»åŠ é¡¹ç›®æ¦‚è¿°æ®µè½</span>
doc.<span class="hljs-title function_ invoke__">addSection</span>({
    <span class="hljs-attr">children</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            <span class="hljs-attr">children</span>: [
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextRun</span>({
                    <span class="hljs-attr">text</span>: <span class="hljs-string">"é¡¹ç›®æ¦‚è¿°ï¼š"</span>,
                    <span class="hljs-attr">bold</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-attr">size</span>: <span class="hljs-number">28</span>,
                }),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextRun</span>({
                    text: <span class="hljs-string">"æœ¬è®¡åˆ’è¯¦ç»†åˆ—å‡ºäº†2024å¹´åº¦äº§å“å¼€å‘è·¯çº¿å›¾ï¼ŒåŒ…æ‹¬æ ¸å¿ƒåŠŸèƒ½å¼€å‘ã€æ€§èƒ½ä¼˜åŒ–å’Œç”¨æˆ·ä½“éªŒæ”¹è¿›ç­‰æ–¹é¢çš„å†…å®¹ã€‚æ‰€æœ‰é¡¹ç›®å°†é‡‡ç”¨æ•æ·å¼€å‘æ–¹æ³•ï¼Œç¡®ä¿é«˜è´¨é‡äº¤ä»˜ã€‚"</span>,
                    size: <span class="hljs-number">24</span>,
                }),
            ],
        }),
    ],
});

<span class="hljs-comment">// æ·»åŠ é¡¹ç›®åˆ—è¡¨</span>
doc.<span class="hljs-title function_ invoke__">addSection</span>({
    <span class="hljs-attr">children</span>: [
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            <span class="hljs-attr">text</span>: <span class="hljs-string">"æ ¸å¿ƒå¼€å‘é¡¹ç›®"</span>,
            <span class="hljs-attr">heading</span>: HeadingLevel.HEADING_2,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            text: <span class="hljs-string">"ç”¨æˆ·ç•Œé¢é‡æ„"</span>,
            bullet: {
                level: <span class="hljs-number">0</span>,
                type: ListType.BULLET,
            },
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            text: <span class="hljs-string">"åç«¯APIä¼˜åŒ–"</span>,
            bullet: {
                level: <span class="hljs-number">0</span>,
                type: ListType.BULLET,
            },
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Paragraph</span>({
            text: <span class="hljs-string">"ç§»åŠ¨ç«¯é€‚é…"</span>,
            bullet: {
                level: <span class="hljs-number">0</span>,
                type: ListType.BULLET,
            },
        }),
    ],
});
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦å°†æ–‡æ¡£å¯¼å‡ºä¸ºDOCXæ–‡ä»¶ã€‚åœ¨æµè§ˆå™¨ç¯å¢ƒå’ŒNode.jsç¯å¢ƒä¸‹ï¼Œå¯¼å‡ºæ–¹å¼ç•¥æœ‰ä¸åŒã€‚</p>
<p>æµè§ˆå™¨ç¯å¢ƒå¯¼å‡ºï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-ini" lang="ini">async function exportDocument(doc) {
    const <span class="hljs-attr">packer</span> = new Packer()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">blob</span> = await packer.toBlob(doc)<span class="hljs-comment">;</span>

    // åˆ›å»ºä¸‹è½½é“¾æ¥
    const <span class="hljs-attr">url</span> = URL.createObjectURL(blob)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">a</span> = document.createElement(<span class="hljs-string">"a"</span>)<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.href</span> = url<span class="hljs-comment">;</span>
    <span class="hljs-attr">a.download</span> = <span class="hljs-string">"é¡¹ç›®è®¡åˆ’ä¹¦.docx"</span><span class="hljs-comment">;</span>
    a.click()<span class="hljs-comment">;</span>

    // æ¸…ç†
    setTimeout(() =&gt; {
        URL.revokeObjectURL(url)<span class="hljs-comment">;</span>
    }, 100)<span class="hljs-comment">;</span>
}

// è°ƒç”¨å¯¼å‡ºå‡½æ•°
exportDocument(doc)<span class="hljs-comment">;</span>
</code></pre>
<p>Node.jsç¯å¢ƒå¯¼å‡ºï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">exportDocument</span>(<span class="hljs-params">doc</span>) {
    <span class="hljs-keyword">const</span> packer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Packer</span>();
    <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">await</span> packer.<span class="hljs-title function_">toBuffer</span>(doc);

    fs.<span class="hljs-title function_">writeFileSync</span>(<span class="hljs-string">"é¡¹ç›®è®¡åˆ’ä¹¦.docx"</span>, buffer);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ–‡æ¡£ç”ŸæˆæˆåŠŸï¼"</span>);
}

<span class="hljs-comment">// è°ƒç”¨å¯¼å‡ºå‡½æ•°</span>
<span class="hljs-title function_">exportDocument</span>(doc);
</code></pre>
<p>è¿™ä¸ªåŸºç¡€ç¤ºä¾‹å±•ç¤ºäº†æ–‡æ¡£ç”Ÿæˆçš„å®Œæ•´æµç¨‹ï¼šåˆ›å»ºæ–‡æ¡£å¯¹è±¡ã€æ·»åŠ å†…å®¹ã€å¯¼å‡ºä¸ºæ–‡ä»¶ã€‚é€šè¿‡è¿™ä¸ªç¤ºä¾‹ï¼Œä½ å¯ä»¥äº†è§£docxåº“çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªaddSectionè°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æ¡£èŠ‚(Section)ï¼ŒèŠ‚æ˜¯Wordæ–‡æ¡£ä¸­çš„é‡è¦æ¦‚å¿µï¼Œå…è®¸ä¸åŒéƒ¨åˆ†æœ‰ä¸åŒçš„é¡µé¢è®¾ç½®å’Œå¸ƒå±€ã€‚åˆç†ä½¿ç”¨èŠ‚å¯ä»¥åˆ›å»ºæ›´å¤æ‚çš„æ–‡æ¡£ç»“æ„ã€‚</p>
<p>è¿™ä¸ªåŸºç¡€ç¤ºä¾‹ç”Ÿæˆçš„æ–‡æ¡£åŒ…å«äº†æ ‡é¢˜ã€æ®µè½å’Œåˆ—è¡¨ï¼Œå·²ç»å¯ä»¥æ»¡è¶³ç®€å•çš„æ–‡æ¡£éœ€æ±‚ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•æ·»åŠ æ›´å¤æ‚çš„æ ¼å¼å’Œå…ƒç´ ã€‚</p>
<h3 data-id="heading-18">å¤æ‚æ ¼å¼ï¼ˆè¡¨æ ¼ã€å›¾ç‰‡ã€æ ·å¼ï¼‰çš„å®ç°æ–¹æ³•</h3>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ–‡æ¡£é€šå¸¸åŒ…å«è¡¨æ ¼ã€å›¾ç‰‡å’Œå¤æ‚æ ·å¼ã€‚docxåº“æä¾›äº†ä¸°å¯Œçš„APIæ¥å®ç°è¿™äº›é«˜çº§åŠŸèƒ½ã€‚è®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªåŒ…å«è¿™äº›å…ƒç´ çš„ç¤ºä¾‹æ–‡æ¡£ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªå¤æ‚è¡¨æ ¼ï¼ŒåŒ…å«åˆå¹¶å•å…ƒæ ¼å’Œæ ·å¼è®¾ç½®ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-css" lang="css">import { <span class="hljs-selector-tag">Table</span>, TableRow, TableCell, WidthType, VerticalAlign, AlignmentType } <span class="hljs-selector-tag">from</span> "docx";

// åˆ›å»ºä¸€ä¸ªé”€å”®æ•°æ®è¡¨æ ¼
const salesTable = new <span class="hljs-selector-tag">Table</span>({
    <span class="hljs-attribute">width</span>: {
        size: <span class="hljs-number">100</span>,
        type: WidthType.PERCENTAGE,
    },
    rows: [
        // è¡¨å¤´è¡Œ
        new <span class="hljs-built_in">TableRow</span>({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"äº§å“ç±»åˆ«"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    verticalMerge: VerticalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                    verticalAlign: VerticalAlign.CENTER,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"Q1"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    horizontalMerge: HorizontalMerge.START,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"Q2"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    horizontalMerge: HorizontalMerge.CONTINUE,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>({
                        text: <span class="hljs-string">"Q3"</span>,
                        bold: true,
                        alignment: AlignmentType.CENTER,
                    })],
                    horizontalMerge: HorizontalMerge.END,
                    shading: { fill: <span class="hljs-string">"#f2f2f2"</span> },
                }),
            ],
        }),
        // äº§å“è¡Œ
        new TableRow({
            children: [
                new <span class="hljs-built_in">TableCell</span>({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"ç”µå­äº§å“"</span>)],
                    verticalMerge: VerticalMerge.CONTINUE,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥120,000"</span>)],
                    alignment: AlignmentType.RIGHT,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥150,000"</span>)],
                    alignment: AlignmentType.RIGHT,
                }),
                new TableCell({
                    children: [new <span class="hljs-built_in">Paragraph</span>(<span class="hljs-string">"Â¥180,000"</span>)],
                    alignment: AlignmentType.RIGHT,
                }),
            ],
        }),
        // æ›´å¤šè¡Œ...
    ],
});
</code></pre>
<p>è¿™ä¸ªè¡¨æ ¼ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»ºåˆå¹¶å•å…ƒæ ¼ã€è®¾ç½®èƒŒæ™¯è‰²å’Œå¯¹é½æ–¹å¼ã€‚è¡¨æ ¼åœ¨æ–‡æ¡£ä¸­å¸¸ç”¨äºå±•ç¤ºç»“æ„åŒ–æ•°æ®ï¼Œå¦‚é”€å”®æŠ¥è¡¨ã€äº§å“æ¸…å•ç­‰ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ·»åŠ å›¾ç‰‡åˆ°æ–‡æ¡£ä¸­ã€‚docxåº“æ”¯æŒä»Base64æ•°æ®æˆ–æ–‡ä»¶è·¯å¾„æ·»åŠ å›¾ç‰‡ï¼š</p>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ImageRun</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"docx"</span>;

<span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªBase64ç¼–ç çš„å›¾ç‰‡æ•°æ®</span>
</code></pre>
<p>å¤åˆ¶</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> { ImageRun } from <span class="hljs-string">"docx"</span>;

<span class="hljs-comment">// å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªBase64ç¼–ç çš„å›¾ç‰‡æ•°æ®</span>
<span class="hljs-type">const</span> imageData = <span class="hljs-string">"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAUVBMVEWFhYWDg4N3d3dtbW17e3t1dXWBgYGHh4d5eXlzc3OLi4ubm5uVlZWPj4+NjY19fX"</span>;

<span class="hljs-type">const</span> image = <span class="hljs-keyword">new</span> <span class="hljs-built_in">ImageRun</span>({
    data: imageData,
    transformation: {
        width: <span class="hljs-number">500</span>,
        height: <span class="hljs-number">300</span>,
    },
    altText: <span class="hljs-string">"é”€å”®è¶‹åŠ¿å›¾è¡¨"</span>,
});

<span class="hljs-comment">// å°†å›¾ç‰‡æ·»åŠ åˆ°æ–‡æ¡£</span>
doc.<span class="hljs-built_in">addSection</span>({
    children: [
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            children: [image],
            alignment: AlignmentType.CENTER,
        }),
        <span class="hljs-keyword">new</span> <span class="hljs-built_in">Paragraph</span>({
            text: <span class="hljs-string">"å›¾1: 2024å¹´Q1-Q3é”€å”®è¶‹åŠ¿"</span>,
            alignment: AlignmentType.CENTER,
            italic: <span class="hljs-literal">true</span>,
            size: <span class="hljs-number">20</span>,
        }),
    ],
});
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸŒŸ Vibe Coding æ—¶ä»£ï¼šç”¨è‡ªç„¶è¯­è¨€æ‰“é€ ä½ çš„ä¸“å± AI å•è¯åº”ç”¨]]></title>    <link>https://juejin.cn/post/7579176524131729459</link>    <guid>https://juejin.cn/post/7579176524131729459</guid>    <pubDate>2025-12-03T06:07:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131729459" data-draft-id="7579093412332175370" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸŒŸ Vibe Coding æ—¶ä»£ï¼šç”¨è‡ªç„¶è¯­è¨€æ‰“é€ ä½ çš„ä¸“å± AI å•è¯åº”ç”¨"/> <meta itemprop="keywords" content="å‰ç«¯,VibeCoding"/> <meta itemprop="datePublished" content="2025-12-03T06:07:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”Ÿæ¤°ä¸ç»’æ‹¿é“"/> <meta itemprop="url" content="https://juejin.cn/user/4185180725584116"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸŒŸ Vibe Coding æ—¶ä»£ï¼šç”¨è‡ªç„¶è¯­è¨€æ‰“é€ ä½ çš„ä¸“å± AI å•è¯åº”ç”¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4185180725584116/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”Ÿæ¤°ä¸ç»’æ‹¿é“
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:07:41.000Z" title="Wed Dec 03 2025 06:07:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å¼•å­ï¼šå½“â€œå†™éœ€æ±‚â€å˜æˆâ€œå†™ Promptâ€</h2>
<p>ä½ è¿˜è®°å¾—ç¬¬ä¸€æ¬¡ç”»äº§å“åŸå‹å›¾æ—¶çš„æ‰‹å¿™è„šä¹±å—ï¼Ÿ<br/>
äº§å“ç»ç†ã€UI è®¾è®¡å¸ˆã€å‰ç«¯ã€åç«¯ã€æµ‹è¯•â€¦â€¦ä¸€ä¸ªå•è¯ App èƒŒåï¼Œæ˜¯æ— æ•°äººçš„åä½œä¸å¦¥åã€‚</p>
<p>ä½†ä»Šå¤©ï¼Œè¿™ä¸€åˆ‡æ­£åœ¨è¢«é‡æ–°å®šä¹‰ã€‚</p>
<blockquote>
<p><strong>â€œVibe Coding æ˜¯ä¸€ç§è‡ªæˆ‘è¡¨è¾¾æ–¹å¼â€¦â€¦è‡ªç„¶è¯­è¨€ç¼–ç¨‹ï¼Œä¼ ç»Ÿæ•²ä»£ç ä¹‹å¤–çš„ä¸€ç§ç¼–ç¨‹æ–¹å¼ã€‚â€</strong></p>
</blockquote>
<p>è¿™ä¸ä»…æ˜¯æŠ€æœ¯æ¼”è¿›ï¼Œæ›´æ˜¯ä¸€åœº<strong>ä¸ªä½“åˆ›é€ åŠ›çš„è§£æ”¾è¿åŠ¨</strong>ã€‚<br/>
ä¸€ä»½è¿‘ä¹å®Œæ•´çš„äº§å“éœ€æ±‚æ–‡æ¡£ï¼Œå´ä»¥ <strong>Prompt çš„å½¢å¼å­˜åœ¨</strong>ã€‚å®ƒæ²¡æœ‰ PRD æ¨¡æ¿ï¼Œæ²¡æœ‰ Jira ç¼–å·ï¼Œå´ç²¾å‡†æè¿°äº†ä¸€ä¸ªå…·å¤‡å¤šè¯­è¨€æ”¯æŒã€æ–‡åŒ–è¯­å¢ƒè§£é‡Šã€AI å›¾åƒç”Ÿæˆã€è¯­éŸ³æœ—è¯»ã€ç”Ÿè¯æœ¬æ•…äº‹åŒ–ç­‰èƒ½åŠ›çš„ <strong>AI å­—å…¸</strong>ã€‚</p>
<p>è¿™ï¼Œå°±æ˜¯ <strong>Vibe Coding çš„åŠ›é‡</strong>ï¼š<strong>ç”¨æ¸…æ™°çš„æ„å›¾ï¼Œé©±åŠ¨æ™ºèƒ½ä½“å®Œæˆç«¯åˆ°ç«¯åˆ›ä½œ</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-1">ä¸€ã€ä»â€œç™¾è¯æ–©â€åˆ°â€œæˆ‘çš„è¯å…¸â€ï¼šå»ä¸­å¿ƒåŒ–çš„äº§å“å“²å­¦</h2>
<p>ä¼ ç»ŸèƒŒå•è¯ Appï¼ˆå¦‚ç™¾è¯æ–©ã€æ²ªæ±Ÿï¼‰æœ¬è´¨æ˜¯<strong>ä¸­å¿ƒåŒ–å†…å®¹åˆ†å‘å¹³å°</strong>ï¼š</p>
<ul>
<li>å®ƒä»¬å†³å®šä½ å­¦ä»€ä¹ˆè¯</li>
<li>å®ƒä»¬è®¾è®¡è®°å¿†æ›²çº¿</li>
<li>å®ƒä»¬çš„ UI é£æ ¼ç»Ÿä¸€ã€ç¼ºä¹ä¸ªæ€§</li>
</ul>
<p>è€Œ Vibe Coding æ‰€å€¡å¯¼çš„ï¼Œæ˜¯ <strong>â€œæ‚¦å·±â€å¼å¼€å‘</strong>â€”â€”</p>
<blockquote>
<p>â€œæ‰“é€ ä¸€ä¸ªè‡ªå·±çš„å•è¯åº”ç”¨â€¦â€¦ä¸­å¿ƒåŒ–çš„è‡ªå·±çš„éœ€æ±‚ã€‚â€</p>
</blockquote>
<p>è¿™æ„å‘³ç€ï¼š</p>
<ul>
<li>ä½ å¯ä»¥è®© AI æ ¹æ®ä½ æœ€è¿‘çœ‹çš„ç¾å‰§ç”Ÿæˆä¾‹å¥</li>
<li>å¯ä»¥è®©è§£é‡Šå¸¦ä¸Šä½ æœ‹å‹çš„è¯­æ°”ï¼ˆâ€œå°±åƒä½ å“¥ä»¬å„¿è¯´ï¼šâ€˜Bro, this word is kinda sus!â€™â€ï¼‰</li>
<li>ç”šè‡³èƒ½ç”¨ä½“ç´ è‰ºæœ¯æŠŠâ€œserendipityâ€å˜æˆä¸€åº§å‘å…‰çš„æ£®æ—</li>
</ul>
<p><strong>äº§å“ä¸å†æœåŠ¡äºå¤§ä¼—ï¼Œè€Œæ˜¯æœåŠ¡äºâ€œæˆ‘â€</strong> ã€‚<br/>
è¿™ç§å»ä¸­å¿ƒåŒ–çš„å°å‹æ™ºèƒ½ä½“ï¼ˆAgentï¼‰ï¼Œæ­£æ˜¯ LLM æ—¶ä»£æœ€å…·æ½œåŠ›çš„åˆ›æ–°å•å…ƒã€‚</p>
<hr/>
<h2 data-id="heading-2">äºŒã€AI å­—å…¸çš„æ ¸å¿ƒï¼šä¸åªæ˜¯ç¿»è¯‘ï¼Œè€Œæ˜¯â€œç†è§£ä¸Šä¸‹æ–‡â€</h2>
<blockquote>
<p>â€œä¸€æ®µè½»æ¾ã€æœ‰è¶£ã€åƒæœ‹å‹èŠå¤©ä¸€æ ·çš„ç”¨æ³•è¯´æ˜ï¼Œå†…å®¹æ¶µç›–æ–‡åŒ–è¯­å¢ƒã€ä½¿ç”¨åœºæ™¯ã€è¯­æ°”ã€ç›¸å…³è¯â€¦â€¦å¿…é¡»é¿å…æ•™ç§‘ä¹¦å¼è¡¨è¾¾ã€‚â€</p>
</blockquote>
<p>è¿™æ­ç¤ºäº†ä¸€ä¸ªçœŸç›¸ï¼š<strong>è¯­è¨€å­¦ä¹ çš„ç“¶é¢ˆä¸åœ¨è¯æ±‡é‡ï¼Œè€Œåœ¨è¯­æ„Ÿç¼ºå¤±</strong>ã€‚</p>
<p>ä¼ ç»Ÿå­—å…¸å‘Šè¯‰ä½  â€œawkward = å°´å°¬â€ï¼Œ<br/>
ä½† AI å­—å…¸ä¼šè¯´ï¼š</p>
<blockquote>
<p>â€œå½“ä½ åœ¨ç”µæ¢¯é‡Œæ”¾äº†ä¸ªå±ï¼Œåˆæ²¡äººæ‰¿è®¤â€”â€”é‚£ç§ç©ºæ°”å‡å›ºçš„æ„Ÿè§‰ï¼Œå°±æ˜¯ awkwardã€‚<br/>
æ³¨æ„ï¼šå®ƒå’Œ embarrassing ä¸åŒï¼Œåè€…æ˜¯ä½ è‡ªå·±å‡ºä¸‘ï¼›awkward æ˜¯å¤§å®¶ä¸€èµ·ç¤¾æ­»ã€‚â€</p>
</blockquote>
<p>å†é…ä¸Šä¸€å¼  AI ç”Ÿæˆçš„ <strong>ä½“ç´ é£æ ¼å°´å°¬ç”µæ¢¯åœºæ™¯å›¾</strong>ï¼ˆæ¯”å¦‚ä¸€ç¾¤æ–¹å—å°äººåƒµåœ¨ç”µæ¢¯é‡Œï¼Œå¤´é¡¶å†’å‡ºé—®å·æ°”æ³¡ï¼‰ï¼Œ<br/>
ç”¨æˆ·ç¬é—´â€œgetâ€äº†è¿™ä¸ªè¯çš„çµé­‚ã€‚</p>
<p>è¿™æ‰æ˜¯ <strong>AI + æ•™è‚²</strong> çš„æ­£ç¡®æ‰“å¼€æ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-3">ä¸‰ã€æŠ€æœ¯å®ç°ï¼šä» Prompt åˆ°å¯è¿è¡Œåº”ç”¨ï¼Œåªå·®ä¸€ä¸ª Agent</h2>
<p>è®¾æƒ³è¿™æ ·ä¸€ä¸ªå·¥ä½œæµï¼š</p>
<ol>
<li>
<p>ä½ å†™ä¸‹ç±»ä¼¼çš„éœ€æ±‚</p>
</li>
<li>
<p>Gemini / Claude / Qwen ç­‰å¤§æ¨¡å‹è§£ææ„å›¾</p>
</li>
<li>
<p>è‡ªåŠ¨ï¼š</p>
<ul>
<li>ç”Ÿæˆ Figma è®¾è®¡ç¨¿</li>
<li>è¾“å‡º React + Three.js å‰ç«¯ä»£ç </li>
<li>æ„å»º Node.js åç«¯ API</li>
<li>é…ç½®è¯­éŸ³åˆæˆä¸å›¾åƒç”ŸæˆæœåŠ¡</li>
</ul>
</li>
<li>
<p>ä¸€é”®éƒ¨ç½²åˆ° Vercel</p>
</li>
</ol>
<p>è¿™ä¸å†æ˜¯å¹»æƒ³ã€‚</p>
<blockquote>
<p>â€œgemini å¼ºå¤§çš„ç¼–ç¨‹èƒ½åŠ›â€¦â€¦ä¸­å°å‹äº§å“çš„ç›´æ¥ç”Ÿæˆâ€</p>
</blockquote>
<p><strong>Vibe Coding çš„å·¥è‰ºï¼Œå°±æ˜¯â€œåˆ†æ­¥åšã€æœ‰è§„åˆ’ã€æŒ‡ä»¤æ¸…æ™°â€</strong> ã€‚<br/>
å®ƒä¸è¦æ±‚ä½ ä¼šå†™ CSSï¼Œä½†è¦æ±‚ä½ <strong>ä¼šæè¿°â€œæ˜äº®ã€æœ‰è¶£ã€æœ‰æ´»åŠ›â€çš„è§†è§‰æ„Ÿå—</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-4">å››ã€åŠ¨æ‰‹å®è·µï¼šç”¨ Three.js æ„å»ºä½ çš„â€œè¯æ±‡ä½“ç´ æ£®æ—â€</h2>
<p>ä¸ºäº†å‘¼åº”â€œAI ç”Ÿæˆå›¾ç‰‡éœ€ç›´è§‚å‘ˆç°æ¦‚å¿µâ€ï¼Œæˆ‘ä¸ºä½ ç¼–å†™äº†ä¸€ä¸ª <strong>ä½“ç´ è‰ºæœ¯åœºæ™¯</strong> â€”â€” <strong>ã€ŠWord Forestã€‹</strong> ã€‚</p>
<blockquote>
<p><strong>åœºæ™¯è¯´æ˜</strong>ï¼šæ¯ä¸ªå•è¯åŒ–ä½œä¸€æ£µç”±å½©è‰²ä½“ç´ ï¼ˆvoxelï¼‰ç»„æˆçš„æ ‘ï¼Œæ ‘å† å½¢çŠ¶ç”±è¯ä¹‰æƒ…æ„Ÿå†³å®šï¼ˆç§¯æè¯å‘ä¸Šç”Ÿé•¿ï¼Œæ¶ˆæè¯å‘ä¸‹è”“å»¶ï¼‰ï¼Œç‚¹å‡»å¯æ’­æ”¾å‘éŸ³å¹¶æ˜¾ç¤ºé‡Šä¹‰ã€‚</p>
</blockquote>
<p><strong>åŸå›¾</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ebfa654dc319448098c70fb3807535fe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sf5qSw5Lid57uS5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765346861&amp;x-signature=26zSEsBSSnB8Q3lAl77puaBN1OA%3D" alt="4c3648d1ad3185ba853f18500ac43806.png" loading="lazy"/></p>
<p><strong>ç¤ºä¾‹å›¾</strong>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bbea1a4a7261446999c180148adde4e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55Sf5qSw5Lid57uS5ou_6ZOB:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765346861&amp;x-signature=2CeLJG0%2BfGAhxgfY1MUuj%2Bs8YBw%3D" alt="285f0334930261f32182a7cfd1d0e420.png" loading="lazy"/>
ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„å•é¡µ HTML æ–‡ä»¶ï¼Œä½¿ç”¨ <strong>Three.js r160+</strong> å®ç°ï¼Œæ— éœ€æ„å»ºå·¥å…·ï¼Œç›´æ¥è¿è¡Œï¼š</p>
<pre><code class="hljs language-ini" lang="ini">&lt;!DOCTYPE html&gt;
&lt;html <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;
&lt;head&gt;
  &lt;meta <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;
  &lt;meta <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> content=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>/&gt;
  &lt;title&gt;Word Forest - Vibe Coding Demo&lt;/title&gt;
  &lt;style&gt;
    body { margin: 0<span class="hljs-comment">; overflow: hidden; background: #1a1a2e; }</span>
    <span class="hljs-comment">#info {</span>
      position: absolute<span class="hljs-comment">;</span>
      top: 20px<span class="hljs-comment">;</span>
      width: 100%<span class="hljs-comment">;</span>
      text-align: center<span class="hljs-comment">;</span>
      color: <span class="hljs-comment">#fff;</span>
      font-family: 'Segoe UI', sans-serif<span class="hljs-comment">;</span>
      text-shadow: 0 0 8px rgba(0,0,0,0.7)<span class="hljs-comment">;</span>
      pointer-events: none<span class="hljs-comment">;</span>
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div <span class="hljs-attr">id</span>=<span class="hljs-string">"info"</span>&gt;Click a voxel tree to hear its word!&lt;/div&gt;

  &lt;script <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span>&gt;
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.160.1/build/three.module.js'<span class="hljs-comment">;</span>
    import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.160.1/examples/jsm/controls/OrbitControls.js'<span class="hljs-comment">;</span>

    // Scene setup
    const <span class="hljs-attr">scene</span> = new THREE.Scene()<span class="hljs-comment">;</span>
    <span class="hljs-attr">scene.background</span> = new THREE.Color(<span class="hljs-number">0</span>x0f3460)<span class="hljs-comment">;</span>
    <span class="hljs-attr">scene.fog</span> = new THREE.Fog(<span class="hljs-number">0</span>x0f3460, <span class="hljs-number">10</span>, <span class="hljs-number">30</span>)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">camera</span> = new THREE.PerspectiveCamera(<span class="hljs-number">75</span>, window.innerWidth / window.innerHeight, <span class="hljs-number">0.1</span>, <span class="hljs-number">1000</span>)<span class="hljs-comment">;</span>
    camera.position.set(0, 8, 15)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">renderer</span> = new THREE.WebGLRenderer({ antialias: <span class="hljs-literal">true</span> })<span class="hljs-comment">;</span>
    renderer.setSize(window.innerWidth, window.innerHeight)<span class="hljs-comment">;</span>
    renderer.setPixelRatio(window.devicePixelRatio)<span class="hljs-comment">;</span>
    document.body.appendChild(renderer.domElement)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">controls</span> = new OrbitControls(camera, renderer.domElement)<span class="hljs-comment">;</span>
    <span class="hljs-attr">controls.enableDamping</span> = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>

    // Lighting
    const <span class="hljs-attr">ambientLight</span> = new THREE.AmbientLight(<span class="hljs-number">0</span>xffffff, <span class="hljs-number">0.6</span>)<span class="hljs-comment">;</span>
    scene.add(ambientLight)<span class="hljs-comment">;</span>

    const <span class="hljs-attr">dirLight</span> = new THREE.DirectionalLight(<span class="hljs-number">0</span>xffffff, <span class="hljs-number">0.8</span>)<span class="hljs-comment">;</span>
    dirLight.position.set(5, 10, 7)<span class="hljs-comment">;</span>
    scene.add(dirLight)<span class="hljs-comment">;</span>

    // Voxel geometry (1x1x1 cube)
    const <span class="hljs-attr">voxelGeo</span> = new THREE.BoxGeometry(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
    const <span class="hljs-attr">words</span> = [
      { word: <span class="hljs-string">"Serendipity"</span>, color: <span class="hljs-number">0</span>xff9aa2, yScale: <span class="hljs-number">1.8</span>, x: -<span class="hljs-number">6</span> },
      { word: <span class="hljs-string">"Ephemeral"</span>, color: <span class="hljs-number">0</span>xa29bfe, yScale: <span class="hljs-number">1.2</span>, x: -<span class="hljs-number">2</span> },
      { word: <span class="hljs-string">"Resilience"</span>, color: <span class="hljs-number">0</span>x78e08f, yScale: <span class="hljs-number">2.0</span>, x: <span class="hljs-number">2</span> },
      { word: <span class="hljs-string">"Melancholy"</span>, color: <span class="hljs-number">0</span>x55efc4, yScale: <span class="hljs-number">0.9</span>, x: <span class="hljs-number">6</span> }
    ]<span class="hljs-comment">;</span>

    const <span class="hljs-attr">trees</span> = []<span class="hljs-comment">;</span>
    const <span class="hljs-attr">materialCache</span> = {}<span class="hljs-comment">;</span>

    words.forEach(({ word, color, yScale, x }) =&gt; {
      const <span class="hljs-attr">group</span> = new THREE.Group()<span class="hljs-comment">;</span>
      group.position.set(x, 0, 0)<span class="hljs-comment">;</span>
      <span class="hljs-attr">group.userData</span> = { word }<span class="hljs-comment">;</span>

      // Trunk
      for (let <span class="hljs-attr">y</span> = <span class="hljs-number">0</span><span class="hljs-comment">; y &lt; 3; y++) {</span>
        const <span class="hljs-attr">mat</span> = new THREE.MeshStandardMaterial({ color: <span class="hljs-number">0</span>x5d4037 })<span class="hljs-comment">;</span>
        const <span class="hljs-attr">voxel</span> = new THREE.Mesh(voxelGeo, mat)<span class="hljs-comment">;</span>
        voxel.position.set(0, y, 0)<span class="hljs-comment">;</span>
        group.add(voxel)<span class="hljs-comment">;</span>
      }

      // Canopy - simple voxel cloud
      const <span class="hljs-attr">canopySize</span> = Math.floor(<span class="hljs-number">3</span> + yScale * <span class="hljs-number">2</span>)<span class="hljs-comment">;</span>
      for (let <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 20; i++) {</span>
        const <span class="hljs-attr">px</span> = (Math.random() - <span class="hljs-number">0.5</span>) * canopySize<span class="hljs-comment">;</span>
        const <span class="hljs-attr">py</span> = <span class="hljs-number">3</span> + Math.random() * canopySize * yScale<span class="hljs-comment">;</span>
        const <span class="hljs-attr">pz</span> = (Math.random() - <span class="hljs-number">0.5</span>) * canopySize<span class="hljs-comment">;</span>

        if (!materialCache<span class="hljs-section">[color]</span>) {
          materialCache<span class="hljs-section">[color]</span> = new THREE.MeshStandardMaterial({ 
            color, 
            roughness: 0.7,
            metalness: 0.2
          })<span class="hljs-comment">;</span>
        }
        const <span class="hljs-attr">voxel</span> = new THREE.Mesh(voxelGeo, materialCache[color])<span class="hljs-comment">;</span>
        voxel.position.set(px, py, pz)<span class="hljs-comment">;</span>
        group.add(voxel)<span class="hljs-comment">;</span>
      }

      scene.add(group)<span class="hljs-comment">;</span>
      trees.push(group)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>

    // Raycaster for interaction
    const <span class="hljs-attr">raycaster</span> = new THREE.Raycaster()<span class="hljs-comment">;</span>
    const <span class="hljs-attr">mouse</span> = new THREE.Vector2()<span class="hljs-comment">;</span>

    window.addEventListener('click', (event) =&gt; {
      <span class="hljs-attr">mouse.x</span> = (event.clientX / window.innerWidth) * <span class="hljs-number">2</span> - <span class="hljs-number">1</span><span class="hljs-comment">;</span>
      <span class="hljs-attr">mouse.y</span> = -(event.clientY / window.innerHeight) * <span class="hljs-number">2</span> + <span class="hljs-number">1</span><span class="hljs-comment">;</span>

      raycaster.setFromCamera(mouse, camera)<span class="hljs-comment">;</span>
      const <span class="hljs-attr">intersects</span> = raycaster.intersectObjects(scene.children, <span class="hljs-literal">true</span>)<span class="hljs-comment">;</span>

      if (intersects.length &gt; 0) {
        const <span class="hljs-attr">obj</span> = intersects[<span class="hljs-number">0</span>].object<span class="hljs-comment">;</span>
        let <span class="hljs-attr">parent</span> = obj.parent<span class="hljs-comment">;</span>
        while (parent &amp;&amp; !parent.userData?.word) {
          <span class="hljs-attr">parent</span> = parent.parent<span class="hljs-comment">;</span>
        }
        if (parent &amp;&amp; parent.userData.word) {
          alert(`You clicked: "${parent.userData.word}"\n(Imagine a TTS voice saying it here!)`)<span class="hljs-comment">;</span>
        }
      }
    })<span class="hljs-comment">;</span>

    // Animation
    const <span class="hljs-attr">clock</span> = new THREE.Clock()<span class="hljs-comment">;</span>
    function animate() {
      requestAnimationFrame(animate)<span class="hljs-comment">;</span>
      const <span class="hljs-attr">t</span> = clock.getElapsedTime()<span class="hljs-comment">;</span>
      trees.forEach((tree, i) =&gt; {
        <span class="hljs-attr">tree.rotation.y</span> = Math.sin(t * <span class="hljs-number">0.3</span> + i) * <span class="hljs-number">0.1</span><span class="hljs-comment">;</span>
      })<span class="hljs-comment">;</span>
      controls.update()<span class="hljs-comment">;</span>
      renderer.render(scene, camera)<span class="hljs-comment">;</span>
    }
    animate()<span class="hljs-comment">;</span>

    // Resize handling
    window.addEventListener('resize', () =&gt; {
      <span class="hljs-attr">camera.aspect</span> = window.innerWidth / window.innerHeight<span class="hljs-comment">;</span>
      camera.updateProjectionMatrix()<span class="hljs-comment">;</span>
      renderer.setSize(window.innerWidth, window.innerHeight)<span class="hljs-comment">;</span>
    })<span class="hljs-comment">;</span>
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<blockquote>
<p>âœ… <strong>ç‰¹ç‚¹</strong>ï¼š</p>
<ul>
<li>æ¯æ£µæ ‘ä»£è¡¨ä¸€ä¸ªæŠ½è±¡è¯æ±‡ï¼ˆå¦‚ Serendipityï¼‰</li>
<li>æ ‘å† é«˜åº¦åæ˜ è¯ä¹‰æƒ…æ„Ÿå¼ºåº¦</li>
<li>ç‚¹å‡»å¯è§¦å‘â€œå‘éŸ³â€ï¼ˆæ­¤å¤„ç”¨ alert æ¨¡æ‹Ÿï¼Œå®é™…å¯é›†æˆ Web Speech APIï¼‰</li>
<li>æ”¯æŒè½¨é“æ§åˆ¶ï¼Œæ²‰æµ¸å¼æ¢ç´¢</li>
<li>ä½“ç´ é£æ ¼ + åŠ¨æ€å…‰ç…§ï¼Œè¥é€ æ¢¦å¹»å­¦ä¹ ç©ºé—´</li>
</ul>
</blockquote>
<hr/>
<h2 data-id="heading-5">ç»“è¯­ï¼šä½ çš„ä¸‹ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ–è®¸åªéœ€ä¸€æ®µ Prompt</h2>
<p>Vibe Coding ä¸æ˜¯å–ä»£ç¨‹åºå‘˜ï¼Œè€Œæ˜¯<strong>èµ‹äºˆæ¯ä¸ªäººâ€œäº§å“ç›´è§‰â€çš„æŠ€æœ¯æ æ†</strong>ã€‚<br/>
å½“ä½ èƒ½æ¸…æ™°è¡¨è¾¾â€œæˆ‘è¦ä¸€ä¸ªä¼šè®²æ•…äº‹çš„å•è¯æœ¬â€ï¼ŒAI å°±èƒ½è¿˜ä½ ä¸€ä¸ªä¸–ç•Œã€‚</p>
<blockquote>
<p>â€œä¸€ä¸ªäººæå®šä¸€ä¸ªé¡¹ç›®ã€‚â€</p>
</blockquote>
<p>ç°åœ¨ï¼Œè½®åˆ°ä½ äº†ã€‚<br/>
æ‰“å¼€ç¼–è¾‘å™¨ï¼Œå†™ä¸‹ä½ çš„ç¬¬ä¸€ä¸ª Promptâ€”â€”<br/>
<strong>è®© AI æˆä¸ºä½ æœ€é»˜å¥‘çš„ co-founder</strong>ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Git ç‰ˆæœ¬åº“ï¼ˆUbuntu ç¯å¢ƒï¼‰]]></title>    <link>https://juejin.cn/post/7579215538271617034</link>    <guid>https://juejin.cn/post/7579215538271617034</guid>    <pubDate>2025-12-03T05:50:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579215538271617034" data-draft-id="7579192114828427291" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Git ç‰ˆæœ¬åº“ï¼ˆUbuntu ç¯å¢ƒï¼‰"/> <meta itemprop="keywords" content="Git"/> <meta itemprop="datePublished" content="2025-12-03T05:50:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç³»å¤æ™®"/> <meta itemprop="url" content="https://juejin.cn/user/895462143964748"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Git ç‰ˆæœ¬åº“ï¼ˆUbuntu ç¯å¢ƒï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/895462143964748/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç³»å¤æ™®
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:50:16.000Z" title="Wed Dec 03 2025 05:50:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä»€ä¹ˆæ˜¯ç‰ˆæœ¬åº“ï¼ˆRepositoryï¼‰ï¼Ÿ</h2>
<p><strong>ç‰ˆæœ¬åº“</strong>ï¼ˆä¹Ÿå«â€œä»“åº“â€ï¼‰æ˜¯ Git ç”¨æ¥ç®¡ç†é¡¹ç›®æ–‡ä»¶åŠå…¶æ‰€æœ‰ä¿®æ”¹å†å²çš„åœ°æ–¹ã€‚</p>
<p>ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªæ™ºèƒ½æ–‡ä»¶å¤¹ï¼š</p>
<ul>
<li>ä½ åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œå†™ä»£ç ã€æ”¹æ–‡æ¡£ã€åˆ æ–‡ä»¶â€¦â€¦</li>
<li>Git ä¼šé»˜é»˜è®°å½•æ¯ä¸€æ¬¡å˜åŒ–ã€‚</li>
<li>å¦‚æœå“ªå¤©ä½ å‘ç°â€œè¿˜æ˜¯ä¸Šå‘¨çš„ç‰ˆæœ¬æ›´å¥½â€ï¼Œå°±èƒ½è½»æ¾å›é€€åˆ°ä»»æ„å†å²çŠ¶æ€ï¼Œç”šè‡³æŸ¥çœ‹æŸæ¬¡å…·ä½“æ”¹äº†å“ªäº›å†…å®¹ã€‚</li>
</ul>
<blockquote>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå°±åƒä½ å†™ä½œæ–‡åå¤ä¿®æ”¹ï¼ŒGit èƒ½å¸®ä½ ä¿å­˜æ¯ä¸€ä¸ªè‰ç¨¿ï¼Œå¹¶éšæ—¶æ‰¾å›â€œæœ€æ»¡æ„çš„é‚£ä¸€ç‰ˆâ€ã€‚</p>
</blockquote>
<p>è¿™ä¸ªè¢« Git ç®¡ç†çš„æ–‡ä»¶å¤¹ï¼Œå°±æ˜¯ç‰ˆæœ¬åº“ã€‚</p>
<hr/>
<h2 data-id="heading-1">äºŒã€å®‰è£… Gitï¼ˆUbuntuï¼‰</h2>
<p>æˆ‘ä»¬ä»¥ Ubuntu ç³»ç»Ÿä¸ºä¾‹è¿›è¡Œæ“ä½œã€‚</p>
<p>é¦–å…ˆï¼Œæ£€æŸ¥æ˜¯å¦å·²å®‰è£… Gitï¼š</p>
<pre><code class="hljs language-css" lang="css">git <span class="hljs-attr">--version</span>
</code></pre>
<p>å¦‚æœå·²å®‰è£…ï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š</p>
<pre><code class="hljs">git version 2.52.0
</code></pre>
<p>å¦‚æœæœªå®‰è£…ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">sudo apt <span class="hljs-keyword">update</span>
sudo apt install git
</code></pre>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€é…ç½® Git ç”¨æˆ·ä¿¡æ¯</h2>
<p>Git éœ€è¦çŸ¥é“ä½ æ˜¯è°ï¼Œä»¥ä¾¿åœ¨æäº¤è®°å½•ä¸­æ ‡æ³¨ä½œè€…ã€‚åªéœ€é…ç½®ä¸€æ¬¡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">git config --global user.name <span class="hljs-string">"Your Name"</span>
git config --global user.email <span class="hljs-string">"email@example.com"</span>
</code></pre>
<blockquote>
<p>è¿™é‡Œçš„é‚®ç®±ä¸ä¸€å®šè¦çœŸå®ï¼Œä½†å»ºè®®ä¸ GitHub/GitLab è´¦å·ä¸€è‡´ï¼Œæ–¹ä¾¿å…³è”ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">å››ã€åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬åº“</h2>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•ä½œä¸ºé¡¹ç›®æ ¹ç›®å½•ï¼ˆä½ç½®éšæ„ï¼‰ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">mkdir</span> learngit
<span class="hljs-built_in">cd</span> learngit/
<span class="hljs-built_in">pwd</span>
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">/home/user/Desktop/learngit
</code></pre>
<ol>
<li>å°†è¯¥ç›®å½•åˆå§‹åŒ–ä¸º Git ä»“åº“ï¼š</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">init</span>
</code></pre>
<p>æˆåŠŸåä¼šæç¤ºï¼š</p>
<pre><code class="hljs language-bash" lang="bash">Initialized empty Git repository <span class="hljs-keyword">in</span> /home/user/Desktop/learngit/.git/
</code></pre>
<ol>
<li>æŸ¥çœ‹éšè—æ–‡ä»¶ï¼š</li>
</ol>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">ls</span> -la
</code></pre>
<p>ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªåä¸º <code>.git</code> çš„éšè—ç›®å½•ï¼š</p>
<pre><code class="hljs">.  ..  .git
</code></pre>
<blockquote>
<p>é‡è¦ ï¼š<code>.git</code> æ˜¯ Git çš„æ ¸å¿ƒæ•°æ®åº“ï¼Œåƒä¸‡ä¸è¦æ‰‹åŠ¨ä¿®æ”¹æˆ–åˆ é™¤å®ƒï¼å¦åˆ™ç‰ˆæœ¬å†å²å°†ä¸¢å¤±ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">äº”ã€æ·»åŠ æ–‡ä»¶å¹¶æäº¤åˆ°ç‰ˆæœ¬åº“</h2>
<p>æˆ‘ä»¬åœ¨ <code>learngit</code> ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª C++ æºæ–‡ä»¶ <code>hello.cpp</code>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span>
using namespace <span class="hljs-built_in">std</span>;
â€‹
<span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> {
 Â   <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">"Hello World!"</span> &lt;&lt; <span class="hljs-built_in">endl</span>;
 Â   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre>
<blockquote>
<p>ç¡®ä¿æ–‡ä»¶ä¿å­˜åœ¨ <code>learngit/</code> ç›®å½•å†…ï¼Œè¿™æ ·å®ƒæ‰å±äºå½“å‰å·¥ä½œåŒºã€‚</p>
</blockquote>
<h3 data-id="heading-5">1. æŸ¥çœ‹å½“å‰çŠ¶æ€</h3>
<pre><code class="hljs language-lua" lang="lua">git <span class="hljs-built_in">status</span>
</code></pre>
<p>è¾“å‡ºï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
â€‹
No commits yet
â€‹
Untracked files:
  (use <span class="hljs-string">"git add &lt;file&gt;..."</span> <span class="hljs-keyword">to</span> include <span class="hljs-keyword">in</span> what will be committed)
    hello.cpp
â€‹
<span class="hljs-literal">nothing</span> added <span class="hljs-keyword">to</span> commit but untracked files present (use <span class="hljs-string">"git add"</span> <span class="hljs-keyword">to</span> track)
</code></pre>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>å½“å‰åœ¨ <code>master</code> åˆ†æ”¯ï¼ˆGit é»˜è®¤ä¸»åˆ†æ”¯åï¼‰</li>
<li>ä»“åº“å°šæœªæœ‰ä»»ä½•æäº¤</li>
<li><code>hello.cpp</code> æ˜¯ä¸€ä¸ªæœªè¢«è·Ÿè¸ªçš„æ–°æ–‡ä»¶</li>
</ul>
<h3 data-id="heading-6">2. å°†æ–‡ä»¶åŠ å…¥æš‚å­˜åŒº</h3>
<p>ä½¿ç”¨ <code>git add</code> å‘Šè¯‰ Gitï¼šâ€œæˆ‘æƒ³æŠŠè¿™ä¸ªæ–‡ä»¶çº³å…¥ä¸‹ä¸€æ¬¡æäº¤â€ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">git <span class="hljs-keyword">add</span> hello.cpp
</code></pre>
<p>å†æ¬¡è¿è¡Œ <code>git status</code>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">On</span> branch master
â€‹
No commits yet
â€‹
Changes <span class="hljs-keyword">to</span> be committed:
  (use <span class="hljs-string">"git rm --cached &lt;file&gt;..."</span> <span class="hljs-keyword">to</span> unstage)
    <span class="hljs-built_in">new</span> file: Â  hello.cpp
</code></pre>
<p>ç°åœ¨ <code>hello.cpp</code> å·²è¿›å…¥æš‚å­˜åŒºï¼Œå‡†å¤‡è¢«æ­£å¼æäº¤ã€‚</p>
<h3 data-id="heading-7">3. æäº¤åˆ°ç‰ˆæœ¬åº“</h3>
<p>æ‰§è¡Œæäº¤å‘½ä»¤ï¼Œå¹¶é™„ä¸Šç®€æ˜çš„è¯´æ˜ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">git <span class="hljs-keyword">commit</span> <span class="hljs-operator">-</span>m "wrote hello world source file"
</code></pre>
<p>è¾“å‡ºç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[master (root-commit) 7d2e3bf]</span> wrote hello world source file
 <span class="hljs-number">1</span> file changed, <span class="hljs-number">8</span> <span class="hljs-built_in">insertions</span>(+)
 create mode <span class="hljs-number">100644</span> hello<span class="hljs-selector-class">.cpp</span>
</code></pre>
<p>è‡³æ­¤ï¼Œä½ çš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬å·²æˆåŠŸä¿å­˜ï¼</p>
<ul>
<li><code>master</code>ï¼šå½“å‰åˆ†æ”¯</li>
<li><code>7d2e3bf</code>ï¼šæœ¬æ¬¡æäº¤çš„å”¯ä¸€ IDï¼ˆå¯ç”¨æ¥å›æº¯ï¼‰</li>
<li><code>1 file changed</code>ï¼šæœ¬æ¬¡æäº¤åŒ…å« 1 ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ 8 è¡Œä»£ç </li>
</ul>
<hr/>
<h2 data-id="heading-8">å…­ã€å°ç»“</h2>






























<table><thead><tr><th>æ­¥éª¤</th><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>åˆå§‹åŒ–ä»“åº“</td><td><code>git init</code></td><td>åˆ›å»ºæœ¬åœ°ç‰ˆæœ¬åº“</td></tr><tr><td>æŸ¥çœ‹çŠ¶æ€</td><td><code>git status</code></td><td>äº†è§£æ–‡ä»¶è·Ÿè¸ªæƒ…å†µ</td></tr><tr><td>æ·»åŠ æ–‡ä»¶</td><td><code>git add &lt;file&gt;</code></td><td>å°†æ–‡ä»¶æ”¾å…¥æš‚å­˜åŒº</td></tr><tr><td>æäº¤å˜æ›´</td><td><code>git commit -m "è¯´æ˜"</code></td><td>æ­£å¼ä¿å­˜ä¸€ä¸ªç‰ˆæœ¬</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é™¤äº†ä½¿ç”¨dict.fromkeys()å’ŒOrderedDict.fromkeys()ï¼Œè¿˜æœ‰å“ªäº›æ–¹æ³•å¯ä»¥å®ç°åˆ—è¡¨å»é‡ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7579256547798106153</link>    <guid>https://juejin.cn/post/7579256547798106153</guid>    <pubDate>2025-12-03T05:55:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547798106153" data-draft-id="7579229538791538694" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é™¤äº†ä½¿ç”¨dict.fromkeys()å’ŒOrderedDict.fromkeys()ï¼Œè¿˜æœ‰å“ªäº›æ–¹æ³•å¯ä»¥å®ç°åˆ—è¡¨å»é‡ï¼Ÿ"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-12-03T05:55:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç”¨æˆ·34584828505"/> <meta itemprop="url" content="https://juejin.cn/user/3710177917545754"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é™¤äº†ä½¿ç”¨dict.fromkeys()å’ŒOrderedDict.fromkeys()ï¼Œè¿˜æœ‰å“ªäº›æ–¹æ³•å¯ä»¥å®ç°åˆ—è¡¨å»é‡ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3710177917545754/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç”¨æˆ·34584828505
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T05:55:20.000Z" title="Wed Dec 03 2025 05:55:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>é™¤äº†Â <code>dict.fromkeys()</code>Â å’ŒÂ <code>OrderedDict.fromkeys()</code>ï¼ŒPython ä¸­è¿˜æœ‰å¤šç§åˆ—è¡¨å»é‡æ–¹æ³•ï¼Œæ ¸å¿ƒå·®å¼‚é›†ä¸­åœ¨Â <strong>æ˜¯å¦ä¿ç•™åŸé¡ºåºã€æ—¶é—´å¤æ‚åº¦ã€å†…å­˜å ç”¨</strong>Â ä¸‰ä¸ªç»´åº¦ã€‚ä»¥ä¸‹æ˜¯ 6 ç§å¸¸ç”¨æ–¹æ³•ï¼ŒæŒ‰ â€œæ—¥å¸¸å®ç”¨æ€§ + æ•ˆç‡â€ æ’åºï¼Œé™„å¸¦åŸç†ã€ä»£ç ç¤ºä¾‹å’Œåœºæ™¯é€‚é…ï¼š</p>
<h2 data-id="heading-0">ä¸€ã€æ ¸å¿ƒå‰æï¼šå»é‡çš„ä¸¤å¤§æ ¸å¿ƒéœ€æ±‚</h2>
<ul>
<li>éœ€æ±‚ 1ï¼š<strong>ä¿ç•™åŸé¡ºåº</strong>ï¼ˆæ—¥å¸¸å¼€å‘æœ€å¸¸ç”¨ï¼Œå¦‚å»é‡åä»ä¿æŒå…ƒç´ é¦–æ¬¡å‡ºç°çš„é¡ºåºï¼‰ï¼›</li>
<li>éœ€æ±‚ 2ï¼š<strong>æ— éœ€ä¿ç•™é¡ºåº</strong>ï¼ˆè¿½æ±‚æè‡´æ•ˆç‡æˆ–ä¸å…³å¿ƒé¡ºåºï¼Œå¦‚æ•°æ®ç»Ÿè®¡ã€å»é‡åæ’åºï¼‰ã€‚</li>
</ul>
<p>æ‰€æœ‰æ–¹æ³•å‡å›´ç»•è¿™ä¸¤ä¸ªéœ€æ±‚å±•å¼€ï¼Œåº•å±‚é€»è¾‘æœ¬è´¨æ˜¯ â€œé€šè¿‡å®¹å™¨è®°å½•å·²å‡ºç°çš„å…ƒç´ ï¼Œè¿‡æ»¤é‡å¤é¡¹â€ã€‚</p>
<h2 data-id="heading-1">äºŒã€6 ç§åˆ—è¡¨å»é‡æ–¹æ³•è¯¦è§£</h2>
<h3 data-id="heading-2">æ–¹æ³• 1ï¼šåˆ—è¡¨æ¨å¯¼å¼ + è¾…åŠ©é›†åˆï¼ˆæ¨èï¼Œä¿åº + é«˜æ•ˆï¼‰</h3>
<h4 data-id="heading-3">åŸç†</h4>
<ul>
<li>ç”¨Â <strong>åˆ—è¡¨æ¨å¯¼å¼</strong>Â éå†åŸåˆ—è¡¨ï¼Œä¿ç•™é¦–æ¬¡å‡ºç°çš„å…ƒç´ ï¼›</li>
<li>ç”¨Â <strong>è¾…åŠ©é›†åˆ</strong>ï¼ˆ<code>seen</code>ï¼‰è®°å½•å·²å‡ºç°çš„å…ƒç´ ï¼ˆé›†åˆæŸ¥æ‰¾æ•ˆç‡ O (1)ï¼Œæ¯”åˆ—è¡¨æŸ¥æ‰¾å¿«ï¼‰ï¼›</li>
<li>æ ¸å¿ƒé€»è¾‘ï¼šéå†å…ƒç´ æ—¶ï¼Œè‹¥å…ƒç´ ä¸åœ¨Â <code>seen</code>Â ä¸­ï¼Œåˆ™ä¿ç•™å¹¶åŠ å…¥Â <code>seen</code>ï¼›å¦åˆ™è·³è¿‡ã€‚</li>
</ul>
<h4 data-id="heading-4">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lst</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]
<span class="hljs-attr">seen</span> = set()
<span class="hljs-attr">result</span> = [x for x in lst if x not in seen and not seen.add(x)]
print(result)  <span class="hljs-comment"># è¾“å‡ºï¼š[1, 2, 3, 4, 5]ï¼ˆä¿ç•™åŸé¡ºåºï¼‰</span>
</code></pre>
<h4 data-id="heading-5">å…³é”®ç»†èŠ‚</h4>
<ul>
<li><code>not seen.add(x)</code>ï¼š<code>set.add(x)</code>Â æ— è¿”å›å€¼ï¼ˆè¿”å›Â <code>None</code>ï¼‰ï¼Œ<code>not None</code>Â ä¸ºÂ <code>True</code>ï¼Œå› æ­¤å¯ç®€åŒ–ä¸º â€œåˆ¤æ–­ + æ·»åŠ â€ ä¸€æ­¥å®Œæˆï¼›</li>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆéå†åˆ—è¡¨ O (n) + é›†åˆæŸ¥æ‰¾ O (1)ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆè¾…åŠ©é›†åˆå­˜å‚¨æ‰€æœ‰ä¸é‡å¤å…ƒç´ ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-6">ä¼˜ç‚¹</h4>
<ul>
<li>ä¿ç•™åŸé¡ºåºï¼Œæ•ˆç‡é«˜ï¼ˆæ¯”Â <code>dict.fromkeys()</code>Â æ›´çµæ´»ï¼Œå¯è‡ªå®šä¹‰è¿‡æ»¤é€»è¾‘ï¼‰ï¼›</li>
<li>æ”¯æŒå¼‚æ„åˆ—è¡¨ï¼ˆå¦‚åŒ…å«å­—ç¬¦ä¸²ã€å…ƒç»„ç­‰ä¸å¯å˜å…ƒç´ ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-7">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>æ—¥å¸¸å¼€å‘ä¸­ â€œä¿åºå»é‡â€ çš„æ ¸å¿ƒåœºæ™¯ï¼ˆæ›¿ä»£Â <code>dict.fromkeys()</code>ï¼Œé€»è¾‘æ›´ç›´è§‚ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-8">æ–¹æ³• 2ï¼š<code>set</code>Â è½¬åˆ—è¡¨ï¼ˆæœ€å¿«ï¼Œæ— éœ€ä¿åºï¼‰</h3>
<h4 data-id="heading-9">åŸç†</h4>
<ul>
<li>åˆ©ç”¨Â <strong>é›†åˆï¼ˆsetï¼‰çš„å…ƒç´ å”¯ä¸€æ€§</strong>ï¼Œç›´æ¥å°†åˆ—è¡¨è½¬ä¸ºé›†åˆï¼ˆè‡ªåŠ¨å»é‡ï¼‰ï¼Œå†è½¬å›åˆ—è¡¨ï¼›</li>
<li>é›†åˆæ˜¯æ— åºç»“æ„ï¼Œå› æ­¤å»é‡åä¼šæ‰“ä¹±åŸé¡ºåºã€‚</li>
</ul>
<h4 data-id="heading-10">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss">lst = <span class="hljs-selector-attr">[1, 2, 2, 3, 3, 3, 4, 5, 5]</span>
result = <span class="hljs-built_in">list</span>(set(lst))
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š<span class="hljs-selector-attr">[1, 2, 3, 4, 5]</span>ï¼ˆé¡ºåºä¸å›ºå®šï¼Œå¦‚ <span class="hljs-selector-attr">[2,1,3,4,5]</span>ï¼‰
</code></pre>
<h4 data-id="heading-11">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆé›†åˆæ’å…¥å’Œè½¬æ¢å‡ä¸ºçº¿æ€§æ—¶é—´ï¼Œåº•å±‚å“ˆå¸Œè¡¨ä¼˜åŒ–ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆé›†åˆå­˜å‚¨ä¸é‡å¤å…ƒç´ ï¼‰ï¼›</li>
<li>é™åˆ¶ï¼šä»…æ”¯æŒÂ <strong>ä¸å¯å˜å…ƒç´ </strong>ï¼ˆå¦‚ intã€strã€tupleï¼‰ï¼Œè‹¥åˆ—è¡¨åŒ…å«å¯å˜å…ƒç´ ï¼ˆå¦‚åˆ—è¡¨ã€å­—å…¸ï¼‰ï¼Œä¼šæŠ¥é”™ï¼ˆ<code>TypeError: unhashable type: 'list'</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-12">ä¼˜ç‚¹</h4>
<ul>
<li>ä»£ç æç®€ï¼ˆä¸€è¡Œå®Œæˆï¼‰ï¼Œé€Ÿåº¦æœ€å¿«ï¼ˆCPython åº•å±‚ä¼˜åŒ–ï¼Œæ¯”çº¯ Python é€»è¾‘å¿«ä¸€ä¸ªé‡çº§ï¼‰ï¼›</li>
<li>è‡ªåŠ¨å»é‡ + å»é‡åå¯æŒ‰éœ€æ’åºï¼ˆå¦‚Â <code>sorted(list(set(lst)))</code>ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-13">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>æ— éœ€ä¿ç•™åŸé¡ºåºï¼Œä¸”å…ƒç´ ä¸ºä¸å¯å˜ç±»å‹ï¼ˆå¦‚æ•°æ®ç»Ÿè®¡ã€å»é‡åæ’åºï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-14">æ–¹æ³• 3ï¼š<code>pandas</code>Â åº“Â <code>drop_duplicates()</code>ï¼ˆå¤§æ•°æ®é‡ + ä¿åºï¼‰</h3>
<h4 data-id="heading-15">åŸç†</h4>
<ul>
<li>åˆ©ç”¨Â <code>pandas</code>Â çš„Â <code>Series</code>Â æ•°æ®ç»“æ„ï¼Œé€šè¿‡Â <code>drop_duplicates()</code>Â æ–¹æ³•å»é‡ï¼›</li>
<li>åº•å±‚ç”¨ C è¯­è¨€ä¼˜åŒ–ï¼Œå¤§æ•°æ®é‡ï¼ˆåä¸‡çº§ä»¥ä¸Šï¼‰æ•ˆç‡è¿œè¶…çº¯ Python æ–¹æ³•ã€‚</li>
</ul>
<h4 data-id="heading-16">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss">import pandas as pd

lst = <span class="hljs-selector-attr">[1, 2, 2, 3, 3, 3, 4, 5, 5]</span> * <span class="hljs-number">1000</span>  # æ¨¡æ‹Ÿ <span class="hljs-number">9000</span> ä¸ªå…ƒç´ çš„å¤§æ•°æ®é‡
result = pd<span class="hljs-selector-class">.Series</span>(lst)<span class="hljs-selector-class">.drop_duplicates</span>()<span class="hljs-selector-class">.tolist</span>()
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š<span class="hljs-selector-attr">[1, 2, 3, 4, 5]</span>ï¼ˆä¿ç•™åŸé¡ºåºï¼‰
</code></pre>
<h4 data-id="heading-17">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆåº•å±‚å“ˆå¸Œè¡¨å®ç°ï¼Œçº¿æ€§æ—¶é—´ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆ<code>Series</code>Â å­˜å‚¨æ•°æ®ï¼‰ï¼›</li>
<li>ä¼˜åŠ¿ï¼šæ”¯æŒç¼ºå¤±å€¼ï¼ˆ<code>NaN</code>ï¼‰å»é‡ï¼Œä¸”å¤§æ•°æ®é‡ä¸‹æ¯”çº¯ Python æ–¹æ³•å¿« 10~100 å€ã€‚</li>
</ul>
<h4 data-id="heading-18">ä¼˜ç‚¹</h4>
<ul>
<li>å¤§æ•°æ®é‡å¤„ç†é«˜æ•ˆï¼Œä¿ç•™åŸé¡ºåºï¼›</li>
<li>æ”¯æŒå¤æ‚æ•°æ®ç±»å‹ï¼ˆå¦‚Â <code>datetime</code>ã€<code>object</code>Â ç±»å‹ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-19">ç¼ºç‚¹</h4>
<ul>
<li>éœ€å®‰è£…Â <code>pandas</code>Â åº“ï¼ˆé Python å†…ç½®ï¼‰ï¼›</li>
<li>å°æ•°æ®é‡ä¸‹æœ‰åº“è°ƒç”¨å¼€é”€ï¼Œæ•ˆç‡ä¸å¦‚æ–¹æ³• 1ã€2ã€‚</li>
</ul>
<h4 data-id="heading-20">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>æ•°æ®åˆ†æã€å¤§æ•°æ®å¤„ç†ï¼ˆå¦‚ CSV æ•°æ®ã€æ—¥å¿—æ•°æ®å»é‡ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-21">æ–¹æ³• 4ï¼šéå† + æ¡ä»¶åˆ¤æ–­ï¼ˆæ— é¢å¤–å®¹å™¨ï¼Œä¿åºï¼‰</h3>
<h4 data-id="heading-22">åŸç†</h4>
<ul>
<li>ä¸ä½¿ç”¨é›†åˆï¼Œä»…é€šè¿‡åˆ—è¡¨çš„Â <code>in</code>Â æ“ä½œåˆ¤æ–­å…ƒç´ æ˜¯å¦å·²å­˜åœ¨ï¼›</li>
<li>éå†åŸåˆ—è¡¨ï¼Œè‹¥å…ƒç´ ä¸åœ¨ç»“æœåˆ—è¡¨ä¸­ï¼Œåˆ™è¿½åŠ åˆ°ç»“æœåˆ—è¡¨ã€‚</li>
</ul>
<h4 data-id="heading-23">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">lst</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]
<span class="hljs-attr">result</span> = []
for x in lst:
    if x not in result:  <span class="hljs-comment"># åˆ—è¡¨æŸ¥æ‰¾æ•ˆç‡ O(k)ï¼Œk ä¸º result é•¿åº¦</span>
        result.append(x)
print(result)  <span class="hljs-comment"># è¾“å‡ºï¼š[1, 2, 3, 4, 5]ï¼ˆä¿ç•™åŸé¡ºåºï¼‰</span>
</code></pre>
<h4 data-id="heading-24">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (nÂ²)ï¼ˆéå†åŸåˆ—è¡¨ O (n) + åˆ—è¡¨æŸ¥æ‰¾ O (k)ï¼Œk â‰¤ nï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆä»…ç»“æœåˆ—è¡¨ï¼Œæ— é¢å¤–å®¹å™¨ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-25">ä¼˜ç‚¹</h4>
<ul>
<li>æ— éœ€é¢å¤–ä¾èµ–ï¼ˆçº¯ Python åŸç”Ÿé€»è¾‘ï¼‰ï¼Œæ— å“ˆå¸Œè¡¨é™åˆ¶ï¼ˆæ”¯æŒå¯å˜å…ƒç´ ï¼Ÿä¸ â€”â€” åˆ—è¡¨Â <code>in</code>Â æ“ä½œä¸ä¾èµ–å“ˆå¸Œï¼Œä½†è‹¥å…ƒç´ æ˜¯å¯å˜ç±»å‹å¦‚åˆ—è¡¨ï¼Œä»å¯åˆ¤æ–­ï¼Œä¾‹å¦‚Â <code>[1, [2]]</code>Â å»é‡ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-26">ç¼ºç‚¹</h4>
<ul>
<li>æ•ˆç‡æä½ï¼ˆåˆ—è¡¨æŸ¥æ‰¾æ˜¯çº¿æ€§æ—¶é—´ï¼Œåˆ—è¡¨è¶Šé•¿è¶Šæ…¢ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-27">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>åˆ—è¡¨é•¿åº¦æå°ï¼ˆå¦‚å‡ åä¸ªå…ƒç´ ï¼‰ï¼Œä¸”ä¸å¸Œæœ›å¼•å…¥é›†åˆï¼ˆå¦‚é¢è¯•é¢˜è¦æ±‚ â€œä¸ç”¨ set å»é‡â€ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-28">æ–¹æ³• 5ï¼š<code>collections.Counter</code>ï¼ˆç»Ÿè®¡é¢‘æ¬¡ + å»é‡ï¼Œä¿åºï¼‰</h3>
<h4 data-id="heading-29">åŸç†</h4>
<ul>
<li><code>Counter</code>Â æ˜¯å­—å…¸çš„å­ç±»ï¼Œç”¨äºç»Ÿè®¡å…ƒç´ å‡ºç°é¢‘æ¬¡ï¼›</li>
<li><code>Counter.keys()</code>Â ä¼šä¿ç•™å…ƒç´ çš„ â€œé¦–æ¬¡å‡ºç°é¡ºåºâ€ï¼ˆPython 3.7+ï¼‰ï¼Œå› æ­¤å¯é€šè¿‡Â <code>keys()</code>Â å¿«é€Ÿå»é‡ã€‚</li>
</ul>
<h4 data-id="heading-30">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-scss" lang="scss">from collections import Counter

lst = <span class="hljs-selector-attr">[1, 2, 2, 3, 3, 3, 4, 5, 5]</span>
result = <span class="hljs-built_in">list</span>(Counter(lst)<span class="hljs-selector-class">.keys</span>())
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š<span class="hljs-selector-attr">[1, 2, 3, 4, 5]</span>ï¼ˆä¿ç•™åŸé¡ºåºï¼‰
</code></pre>
<h4 data-id="heading-31">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n)ï¼ˆç»Ÿè®¡é¢‘æ¬¡ O (n) + æå– keys O (m)ï¼Œm ä¸ºä¸é‡å¤å…ƒç´ ä¸ªæ•°ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆå­˜å‚¨å…ƒç´ é¢‘æ¬¡ï¼‰ï¼›</li>
<li>é¢å¤–åŠŸèƒ½ï¼šå¯åŒæ—¶è·å–å…ƒç´ å‡ºç°æ¬¡æ•°ï¼ˆå¦‚Â <code>Counter(lst)[2]</code>Â å¾—åˆ° 2 çš„å‡ºç°æ¬¡æ•° 2ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-32">ä¼˜ç‚¹</h4>
<ul>
<li>ä¿åºå»é‡çš„åŒæ—¶ï¼Œå¯è·å–é¢‘æ¬¡ç»Ÿè®¡ï¼›</li>
<li>è¯­æ³•ç®€æ´ï¼Œæ”¯æŒä¸å¯å˜å…ƒç´ ã€‚</li>
</ul>
<h4 data-id="heading-33">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>å»é‡ + é¢‘æ¬¡ç»Ÿè®¡çš„å¤åˆåœºæ™¯ï¼ˆå¦‚ â€œæ‰¾å‡ºåˆ—è¡¨ä¸­ä¸é‡å¤çš„å…ƒç´ ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªå…ƒç´ å‡ºç°æ¬¡æ•°â€ï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-34">æ–¹æ³• 6ï¼š<code>itertools.groupby</code>ï¼ˆéœ€å…ˆæ’åºï¼Œæ— éœ€ä¿åºï¼‰</h3>
<h4 data-id="heading-35">åŸç†</h4>
<ul>
<li><code>groupby</code>Â ç”¨äºå°†è¿­ä»£å¯¹è±¡ä¸­è¿ç»­çš„é‡å¤å…ƒç´ åˆ†ç»„ï¼›</li>
<li>éœ€å…ˆå¯¹åˆ—è¡¨æ’åºï¼ˆä½¿é‡å¤å…ƒç´ è¿ç»­ï¼‰ï¼Œå†æå–æ¯ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå®ç°å»é‡ï¼›</li>
<li>å› æ’åºä¼šæ‰“ä¹±åŸé¡ºåºï¼Œå› æ­¤é€‚åˆæ— éœ€ä¿åºçš„åœºæ™¯ã€‚</li>
</ul>
<h4 data-id="heading-36">ä»£ç ç¤ºä¾‹</h4>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-ini" lang="ini">from itertools import groupby

<span class="hljs-attr">lst</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>]
<span class="hljs-comment"># æ­¥éª¤ 1ï¼šæ’åºï¼ˆä½¿é‡å¤å…ƒç´ è¿ç»­ï¼‰</span>
<span class="hljs-attr">lst_sorted</span> = sorted(lst)
<span class="hljs-comment"># æ­¥éª¤ 2ï¼šgroupby åˆ†ç»„ï¼Œæå–æ¯ç»„ç¬¬ä¸€ä¸ªå…ƒç´ </span>
<span class="hljs-attr">result</span> = [key for key, group in groupby(lst_sorted)]
print(result)  <span class="hljs-comment"># è¾“å‡ºï¼š[1, 2, 3, 4, 5]ï¼ˆæ’åºåçš„é¡ºåºï¼‰</span>
</code></pre>
<h4 data-id="heading-37">å…³é”®ç»†èŠ‚</h4>
<ul>
<li>æ—¶é—´å¤æ‚åº¦ï¼šO (n log n)ï¼ˆæ’åºå ä¸»å¯¼ï¼Œ<code>groupby</code>Â éå† O (n)ï¼‰ï¼›</li>
<li>å†…å­˜å ç”¨ï¼šO (n)ï¼ˆæ’åºå’Œåˆ†ç»„çš„ä¸´æ—¶ç©ºé—´ï¼‰ï¼›</li>
<li>é™åˆ¶ï¼šå¿…é¡»å…ˆæ’åºï¼Œå› æ­¤æ— æ³•ä¿ç•™åŸé¡ºåºã€‚</li>
</ul>
<h4 data-id="heading-38">ä¼˜ç‚¹</h4>
<ul>
<li>å¯åŒæ—¶å¤„ç† â€œæ’åº + å»é‡â€ï¼Œé€‚åˆéœ€è¦æ’åºåå»é‡çš„åœºæ™¯ï¼›</li>
<li>æ”¯æŒè‡ªå®šä¹‰æ’åºè§„åˆ™ï¼ˆå¦‚Â <code>sorted(lst, key=lambda x: -x)</code>Â å€’åºåå»é‡ï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-39">é€‚ç”¨åœºæ™¯</h4>
<ul>
<li>éœ€å…ˆæ’åºå†å»é‡çš„åœºæ™¯ï¼ˆå¦‚ â€œå¯¹æˆç»©åˆ—è¡¨å»é‡ï¼Œå¹¶æŒ‰ä»é«˜åˆ°ä½æ’åºâ€ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-40">ä¸‰ã€å„æ–¹æ³•å¯¹æ¯”ä¸åœºæ™¯é€‰æ‹©</h2>





























































<table><thead><tr><th>æ–¹æ³•</th><th>æ˜¯å¦ä¿åº</th><th>æ—¶é—´å¤æ‚åº¦</th><th>å†…å­˜å ç”¨</th><th>æ ¸å¿ƒä¼˜åŠ¿</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>åˆ—è¡¨æ¨å¯¼å¼ + è¾…åŠ©é›†åˆ</td><td>æ˜¯</td><td>O(n)</td><td>O(n)</td><td>çµæ´»é«˜æ•ˆï¼Œä¿åºï¼Œæ”¯æŒå¼‚æ„å…ƒç´ </td><td>æ—¥å¸¸ä¿åºå»é‡ï¼ˆé¦–é€‰ï¼‰</td></tr><tr><td><code>set</code>Â è½¬åˆ—è¡¨</td><td>å¦</td><td>O(n)</td><td>O(n)</td><td>ä»£ç æç®€ï¼Œé€Ÿåº¦æœ€å¿«</td><td>æ— éœ€ä¿åºï¼Œå…ƒç´ ä¸ºä¸å¯å˜ç±»å‹</td></tr><tr><td><code>pandas.drop_duplicates()</code></td><td>æ˜¯</td><td>O(n)</td><td>O(n)</td><td>å¤§æ•°æ®é‡é«˜æ•ˆï¼Œæ”¯æŒå¤æ‚ç±»å‹</td><td>æ•°æ®åˆ†æã€åä¸‡çº§ä»¥ä¸Šå…ƒç´ å»é‡</td></tr><tr><td>éå† + æ¡ä»¶åˆ¤æ–­</td><td>æ˜¯</td><td>O(nÂ²)</td><td>O(n)</td><td>çº¯åŸç”Ÿé€»è¾‘ï¼Œæ— é¢å¤–ä¾èµ–</td><td>åˆ—è¡¨æçŸ­ï¼Œé¢è¯•é¢˜åœºæ™¯</td></tr><tr><td><code>Counter.keys()</code></td><td>æ˜¯</td><td>O(n)</td><td>O(n)</td><td>å»é‡ + é¢‘æ¬¡ç»Ÿè®¡</td><td>éœ€ç»Ÿè®¡å…ƒç´ å‡ºç°æ¬¡æ•°çš„åœºæ™¯</td></tr><tr><td><code>itertools.groupby</code></td><td>å¦ï¼ˆæ’åºåï¼‰</td><td>O(n log n)</td><td>O(n)</td><td>æ’åº + å»é‡ä¸€ä½“åŒ–</td><td>éœ€å…ˆæ’åºå†å»é‡çš„åœºæ™¯</td></tr></tbody></table>
<h2 data-id="heading-41">å››ã€é¿å‘é‡ç‚¹</h2>
<ol>
<li>
<p><strong>å¯å˜å…ƒç´ å»é‡</strong>ï¼šè‹¥åˆ—è¡¨åŒ…å«å¯å˜å…ƒç´ ï¼ˆå¦‚Â <code>[1, [2], [2], 3]</code>ï¼‰ï¼Œ<code>set</code>ã€<code>dict.fromkeys()</code>ã€<code>Counter</code>Â ä¼šæŠ¥é”™ï¼ˆå› å¯å˜å…ƒç´ ä¸å¯å“ˆå¸Œï¼‰ï¼Œæ­¤æ—¶åªèƒ½ç”¨ â€œéå† + æ¡ä»¶åˆ¤æ–­â€ï¼ˆæ–¹æ³• 4ï¼‰ï¼š</p>
<p>python</p>
<p>è¿è¡Œ</p>
<pre><code class="hljs language-css" lang="css">lst = <span class="hljs-selector-attr">[1, [2]</span>, <span class="hljs-selector-attr">[2]</span>, <span class="hljs-number">3</span>]
result = <span class="hljs-selector-attr">[]</span>
for x in lst:
    if x not in result:
        result.<span class="hljs-built_in">append</span>(x)
<span class="hljs-built_in">print</span>(result)  # è¾“å‡ºï¼š[<span class="hljs-number">1</span>, [<span class="hljs-number">2</span>], <span class="hljs-number">3</span>]ï¼ˆæ­£ç¡®å»é‡ï¼‰
</code></pre>
</li>
<li>
<p><strong>åŸåˆ—è¡¨ä¿®æ”¹</strong>ï¼šä»¥ä¸Šæ–¹æ³•å‡ç”Ÿæˆæ–°åˆ—è¡¨ï¼Œè‹¥éœ€ä¿®æ”¹åŸåˆ—è¡¨ï¼Œå¯ç›´æ¥èµ‹å€¼ï¼ˆå¦‚Â <code>lst = [x for x in lst if x not in seen and not seen.add(x)]</code>ï¼‰ï¼›</p>
</li>
<li>
<p><strong>ç©ºåˆ—è¡¨ / å•ä¸€å…ƒç´ </strong>ï¼šæ‰€æœ‰æ–¹æ³•å‡å…¼å®¹ç©ºåˆ—è¡¨ï¼ˆè¿”å›ç©ºï¼‰å’Œå•ä¸€å…ƒç´ ï¼ˆè¿”å›è‡ªèº«ï¼‰ï¼Œæ— å¼‚å¸¸ï¼›</p>
</li>
<li>
<p><strong>æ€§èƒ½è¯¯åŒº</strong>ï¼šâ€œéå† + æ¡ä»¶åˆ¤æ–­â€ï¼ˆæ–¹æ³• 4ï¼‰è™½æ— é¢å¤–å®¹å™¨ï¼Œä½†åˆ—è¡¨æŸ¥æ‰¾ O (n) å¯¼è‡´æ•ˆç‡æä½ï¼Œåˆ—è¡¨é•¿åº¦è¶…è¿‡ 1000 æ—¶ä¸æ¨èä½¿ç”¨ã€‚</p>
</li>
</ol>
<h2 data-id="heading-42">äº”ã€æ€»ç»“</h2>
<ol>
<li><strong>æ—¥å¸¸ä¿åºå»é‡</strong>ï¼šä¼˜å…ˆé€‰ã€Œåˆ—è¡¨æ¨å¯¼å¼ + è¾…åŠ©é›†åˆã€ï¼ˆçµæ´»é«˜æ•ˆï¼‰æˆ–ã€Œ<code>dict.fromkeys()</code>ã€ï¼ˆè¯­æ³•ç®€æ´ï¼‰ï¼›</li>
<li><strong>æ— éœ€ä¿åºå»é‡</strong>ï¼šä¼˜å…ˆé€‰ã€Œ<code>set</code>Â è½¬åˆ—è¡¨ã€ï¼ˆé€Ÿåº¦æœ€å¿«ï¼‰ï¼›</li>
<li><strong>å¤§æ•°æ®é‡å»é‡</strong>ï¼šä¼˜å…ˆé€‰ã€Œ<code>pandas.drop_duplicates()</code>ã€ï¼ˆåº•å±‚ C ä¼˜åŒ–ï¼‰ï¼›</li>
<li><strong>å¤åˆéœ€æ±‚</strong>ï¼šéœ€é¢‘æ¬¡ç»Ÿè®¡ç”¨ã€Œ<code>Counter</code>ã€ï¼Œéœ€æ’åºç”¨ã€Œ<code>groupby</code>ã€ã€‚</li>
</ol>
<p>æ ¹æ® â€œæ˜¯å¦ä¿åºã€æ•°æ®é‡ã€æ˜¯å¦éœ€è¦é¢å¤–åŠŸèƒ½â€ é€‰æ‹©åˆé€‚çš„æ–¹æ³•ï¼Œå³å¯å…¼é¡¾æ•ˆç‡å’Œå¯è¯»æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾]]></title>    <link>https://juejin.cn/post/7579167622106841088</link>    <guid>https://juejin.cn/post/7579167622106841088</guid>    <pubDate>2025-12-03T06:30:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106841088" data-draft-id="7579169543232929792" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:30:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‹¥å°˜çš„æŠ€æœ¯ä¹‹æ—…"/> <meta itemprop="url" content="https://juejin.cn/user/2700056286215032"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2700056286215032/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‹¥å°˜çš„æŠ€æœ¯ä¹‹æ—…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:30:12.000Z" title="Wed Dec 03 2025 06:30:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»12åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="" data-highlight-key="arduino-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#434f54}.hljs-attribute,.hljs-doctag,.hljs-keyword,.hljs-name,.hljs-selector-tag{color:#00979d}.hljs-addition,.hljs-built_in,.hljs-bullet,.hljs-code,.hljs-literal{color:#d35400}.hljs-link,.hljs-regexp,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-symbol,.hljs-template-variable,.hljs-variable{color:#00979d}.hljs-deletion,.hljs-quote,.hljs-selector-class,.hljs-selector-id,.hljs-string,.hljs-template-tag,.hljs-type{color:#005c5f}.hljs-section,.hljs-title{color:#800;font-weight:700}.hljs-comment{color:rgba(149,165,166,.8)}.hljs-meta-keyword{color:#728e00}.hljs-meta{color:#434f54}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-function{color:#728e00}.hljs-number{color:#8a7b52}</style><h2 data-id="heading-0">ğŸš€ æ·±å…¥ç†è§£ Claude Codeï¼šä»å…¥é—¨åˆ°ç²¾é€šçš„èƒ½åŠ›å…¨æ™¯å›¾</h2>
<blockquote>
<p>ğŸ”¥ <strong>æœ¬æ–‡ç›®æ ‡</strong>ï¼šå¸®åŠ©å¼€å‘è€…å…¨é¢äº†è§£ Claude Code çš„å„é¡¹èƒ½åŠ›ï¼Œä»åŸºç¡€åˆ°é«˜çº§ï¼Œä»åŸç†åˆ°å®æˆ˜</p>
<p>ğŸ“… åˆ›å»ºæ—¶é—´ï¼š2025-12-03
ğŸ¯ é€‚ç”¨èŒƒå›´ï¼šCodeBuddyã€Cursorã€Claude for Desktopã€VS Code æ’ä»¶ç­‰ AI ç¼–ç¨‹åŠ©æ‰‹
â±ï¸ é˜…è¯»æ—¶é•¿ï¼šçº¦ 30 åˆ†é’Ÿ</p>
</blockquote>
<hr/>
<h3 data-id="heading-1">å†™åœ¨å‰é¢</h3>
<p>å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Claude Code æˆ–è€…å‡†å¤‡å¼€å§‹ä½¿ç”¨ï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™äº›ç–‘é—®ï¼š</p>
<ul>
<li>ğŸ¤” Claude Code åˆ°åº•èƒ½åšä»€ä¹ˆï¼Ÿ</li>
<li>ğŸ¤” é‚£äº› Commandsã€Skillsã€Rulesã€Hooks éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>ğŸ¤” MCP åè®®æ˜¯ä»€ä¹ˆï¼Ÿæ€ä¹ˆç”¨ï¼Ÿ</li>
<li>ğŸ¤” è¿™äº›èƒ½åŠ›æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥å‘å±•èµ·æ¥çš„ï¼Ÿ</li>
</ul>
<p>åˆ«æ€¥ï¼Œè¿™ç¯‡æ–‡ç« ä¼šå¸¦ä½ <strong>ä»å¤´åˆ°å°¾</strong>ã€<strong>ç”±æµ…å…¥æ·±</strong>åœ°äº†è§£ Claude Code çš„å…¨éƒ¨èƒ½åŠ›ã€‚æ— è®ºä½ æ˜¯åˆšå…¥é—¨çš„æ–°æ‰‹ï¼Œè¿˜æ˜¯æƒ³æ·±å…¥æ¢ç´¢çš„è€æ‰‹ï¼Œç›¸ä¿¡éƒ½èƒ½æœ‰æ‰€æ”¶è·ã€‚</p>
<p><strong>å…ˆæ”¾ä¸€å¼ èƒ½åŠ›å…¨æ™¯å›¾</strong>ï¼Œè®©ä½ æœ‰ä¸ªæ•´ä½“å°è±¡ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Claude <span class="hljs-selector-tag">Code</span> èƒ½åŠ›å…¨æ™¯å›¾                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   ğŸ§  Claude åŸç”Ÿèƒ½åŠ›å±‚                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Vision (è§†è§‰)  â”‚  Tool Use (å·¥å…·)  â”‚  Reasoning (æ¨ç†)         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                      â”‚
â”‚                                  â–¼                                      â”‚
â”‚   ğŸ”§ æ‰©å±•èƒ½åŠ›å±‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Commands  â”‚  Skills  â”‚  Rules  â”‚  Hooks  â”‚  Memories  â”‚  MCP   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                      â”‚
â”‚                                  â–¼                                      â”‚
â”‚   ğŸ¤– é«˜çº§èƒ½åŠ›å±‚                                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Multi-Agent (å¤šæ™ºèƒ½ä½“)  â”‚  Workflow (å·¥ä½œæµ)  â”‚  Automation     â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<hr/>
<h3 data-id="heading-2">ğŸ“š ç›®å½•</h3>
<ul>
<li><a href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B" title="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E5%8F%91%E5%B1%95%E5%8E%86%E7%A8%8B">ç¬¬ä¸€éƒ¨åˆ†ï¼šèƒ½åŠ›å‘å±•å†ç¨‹</a></li>
<li><a href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%B8%8E%E9%85%8D%E7%BD%AE" title="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E4%B8%8E%E9%85%8D%E7%BD%AE">ç¬¬äºŒéƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µä¸é…ç½®</a></li>
<li><a href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86commands-%E5%91%BD%E4%BB%A4%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86commands-%E5%91%BD%E4%BB%A4%E7%B3%BB%E7%BB%9F">ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommands å‘½ä»¤ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86skills-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86skills-%E6%8A%80%E8%83%BD%E7%B3%BB%E7%BB%9F">ç¬¬å››éƒ¨åˆ†ï¼šSkills æŠ€èƒ½ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86rules-%E8%A7%84%E5%88%99%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86rules-%E8%A7%84%E5%88%99%E7%B3%BB%E7%BB%9F">ç¬¬äº”éƒ¨åˆ†ï¼šRules è§„åˆ™ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86hooks-%E9%92%A9%E5%AD%90%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E5%85%AD%E9%83%A8%E5%88%86hooks-%E9%92%A9%E5%AD%90%E7%B3%BB%E7%BB%9F">ç¬¬å…­éƒ¨åˆ†ï¼šHooks é’©å­ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86memories-%E8%AE%B0%E5%BF%86%E7%B3%BB%E7%BB%9F" title="#%E7%AC%AC%E4%B8%83%E9%83%A8%E5%88%86memories-%E8%AE%B0%E5%BF%86%E7%B3%BB%E7%BB%9F">ç¬¬ä¸ƒéƒ¨åˆ†ï¼šMemories è®°å¿†ç³»ç»Ÿ</a></li>
<li><a href="#%E7%AC%AC%E5%85%AB%E9%83%A8%E5%88%86context-providers-%E4%B8%8A%E4%B8%8B%E6%96%87%E6%8F%90%E4%BE%9B%E5%99%A8" title="#%E7%AC%AC%E5%85%AB%E9%83%A8%E5%88%86context-providers-%E4%B8%8A%E4%B8%8B%E6%96%87%E6%8F%90%E4%BE%9B%E5%99%A8">ç¬¬å…«éƒ¨åˆ†ï¼šContext Providers ä¸Šä¸‹æ–‡æä¾›å™¨</a></li>
<li><a href="#%E7%AC%AC%E4%B9%9D%E9%83%A8%E5%88%86mcp-%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE" title="#%E7%AC%AC%E4%B9%9D%E9%83%A8%E5%88%86mcp-%E6%A8%A1%E5%9E%8B%E4%B8%8A%E4%B8%8B%E6%96%87%E5%8D%8F%E8%AE%AE">ç¬¬ä¹éƒ¨åˆ†ï¼šMCP æ¨¡å‹ä¸Šä¸‹æ–‡åè®®</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E9%83%A8%E5%88%86multi-agent-%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93" title="#%E7%AC%AC%E5%8D%81%E9%83%A8%E5%88%86multi-agent-%E5%A4%9A%E6%99%BA%E8%83%BD%E4%BD%93">ç¬¬åéƒ¨åˆ†ï¼šMulti-Agent å¤šæ™ºèƒ½ä½“</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%B8%80%E9%83%A8%E5%88%86claude-%E5%8E%9F%E7%94%9F%E8%83%BD%E5%8A%9B" title="#%E7%AC%AC%E5%8D%81%E4%B8%80%E9%83%A8%E5%88%86claude-%E5%8E%9F%E7%94%9F%E8%83%BD%E5%8A%9B">ç¬¬åä¸€éƒ¨åˆ†ï¼šClaude åŸç”Ÿèƒ½åŠ›</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E9%83%A8%E5%88%86%E5%AE%8C%E6%95%B4%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%A1%88%E4%BE%8B" title="#%E7%AC%AC%E5%8D%81%E4%BA%8C%E9%83%A8%E5%88%86%E5%AE%8C%E6%95%B4%E5%B7%A5%E4%BD%9C%E6%B5%81%E6%A1%88%E4%BE%8B">ç¬¬åäºŒéƒ¨åˆ†ï¼šå®Œæ•´å·¥ä½œæµæ¡ˆä¾‹</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E4%B8%89%E9%83%A8%E5%88%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97" title="#%E7%AC%AC%E5%8D%81%E4%B8%89%E9%83%A8%E5%88%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E4%B8%8E%E8%B8%A9%E5%9D%91%E6%8C%87%E5%8D%97">ç¬¬åä¸‰éƒ¨åˆ†ï¼šæœ€ä½³å®è·µä¸è¸©å‘æŒ‡å—</a></li>
<li><a href="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E7%9F%A9%E9%98%B5%E4%B8%8E%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84" title="#%E7%AC%AC%E5%8D%81%E5%9B%9B%E9%83%A8%E5%88%86%E8%83%BD%E5%8A%9B%E7%9F%A9%E9%98%B5%E4%B8%8E%E5%AD%A6%E4%B9%A0%E8%B7%AF%E5%BE%84">ç¬¬åå››éƒ¨åˆ†ï¼šèƒ½åŠ›çŸ©é˜µä¸å­¦ä¹ è·¯å¾„</a></li>
</ul>
<hr/>
<h3 data-id="heading-3">ç¬¬ä¸€éƒ¨åˆ†ï¼šèƒ½åŠ›å‘å±•å†ç¨‹</h3>
<blockquote>
<p>ğŸ’¡ <strong>ä¸ºä»€ä¹ˆè¦å…ˆè®²å†å²ï¼Ÿ</strong> äº†è§£èƒ½åŠ›çš„å‘å±•è„‰ç»œï¼Œèƒ½å¸®ä½ æ›´å¥½åœ°ç†è§£æ¯ä¸ªèƒ½åŠ›çš„è®¾è®¡åˆè¡·å’Œä½¿ç”¨åœºæ™¯ã€‚</p>
</blockquote>
<h4 data-id="heading-4">1.1 æ—¶é—´çº¿æ€»è§ˆ</h4>
<p>Claude Code çš„èƒ½åŠ›ä¸æ˜¯ä¸€è¹´è€Œå°±çš„ï¼Œè€Œæ˜¯ç»è¿‡äº†å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ã€‚ä¸‹é¢è¿™å¼ æ—¶é—´çº¿å›¾å±•ç¤ºäº†ä» 2024 å¹´ 3 æœˆåˆ° 2025 å¹´çš„å®Œæ•´æ¼”è¿›è¿‡ç¨‹ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
                        <span class="hljs-string">Claude</span> <span class="hljs-string">Code</span> <span class="hljs-string">èƒ½åŠ›å‘å±•æ—¶é—´çº¿</span>
<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>

<span class="hljs-number">2024.03</span><span class="hljs-number">.04</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ‰</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3</span> <span class="hljs-string">ç³»åˆ—å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Opus</span> <span class="hljs-string">/</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">/</span> <span class="hljs-string">Haiku</span> <span class="hljs-string">ä¸‰ä¸ªç‰ˆæœ¬</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é¦–æ¬¡æ”¯æŒ</span> <span class="hljs-string">Visionï¼ˆå›¾åƒç†è§£ï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">200K</span> <span class="hljs-string">ä¸Šä¸‹æ–‡çª—å£</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.05</span>     <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ”§</span> <span class="hljs-string">Tool</span> <span class="hljs-string">Use</span> <span class="hljs-string">(Beta)</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å‡½æ•°è°ƒç”¨èƒ½åŠ›</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¤–éƒ¨å·¥å…·é›†æˆåŸºç¡€</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">ä¸ºåç»­</span> <span class="hljs-string">MCP</span> <span class="hljs-string">å¥ å®šåŸºç¡€</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.06</span><span class="hljs-number">.20</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">âš¡</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3.5</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Artifacts</span> <span class="hljs-string">åŠŸèƒ½ï¼ˆä»£ç é¢„è§ˆï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä»£ç ç”Ÿæˆèƒ½åŠ›å¤§å¹…æå‡</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ€§èƒ½è¶…è¶Š</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3</span> <span class="hljs-string">Opus</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.10</span><span class="hljs-number">.22</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ–¥ï¸</span> <span class="hljs-string">Computer</span> <span class="hljs-string">Use</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3.5</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">å‡çº§ç‰ˆ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">AI</span> <span class="hljs-string">å¯ä»¥æ“ä½œè®¡ç®—æœºç•Œé¢</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ¨¡æ‹Ÿé¼ æ ‡ã€é”®ç›˜æ“ä½œ</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2024.11</span><span class="hljs-number">.25</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ”Œ</span> <span class="hljs-string">MCP</span> <span class="hljs-string">(Model</span> <span class="hljs-string">Context</span> <span class="hljs-string">Protocol)</span> <span class="hljs-string">å¼€æº</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ ‡å‡†åŒ–</span> <span class="hljs-string">AI</span> <span class="hljs-string">ä¸å¤–éƒ¨æœåŠ¡çš„è¿æ¥</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Claude</span> <span class="hljs-string">for</span> <span class="hljs-string">Desktop</span> <span class="hljs-string">é¦–å…ˆæ”¯æŒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">å¼€å¯</span> <span class="hljs-string">AI</span> <span class="hljs-string">å·¥å…·ç”Ÿæ€æ—¶ä»£</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.02</span><span class="hljs-number">.25</span>  <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸš€</span> <span class="hljs-string">Claude</span> <span class="hljs-number">3.7</span> <span class="hljs-string">Sonnet</span> <span class="hljs-string">+</span> <span class="hljs-string">Claude</span> <span class="hljs-string">Code</span> <span class="hljs-string">å‘å¸ƒ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é¦–ä¸ªæ··åˆæ¨ç†æ¨¡å‹ï¼ˆExtended</span> <span class="hljs-string">Thinkingï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Claude</span> <span class="hljs-string">Code</span> <span class="hljs-string">ç»ˆç«¯</span> <span class="hljs-string">AI</span> <span class="hljs-string">ä»£ç†</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ä»£ç åº“ç†è§£ã€Git</span> <span class="hljs-string">é›†æˆã€å‘½ä»¤æ‰§è¡Œ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">å¼€å‘è€…æ•ˆç‡é©å‘½æ€§æå‡</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.03</span>     <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ§©</span> <span class="hljs-string">æ‰©å±•ç”Ÿæ€æˆç†Ÿ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Commandsï¼ˆå‘½ä»¤ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Skillsï¼ˆæŠ€èƒ½ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Rulesï¼ˆè§„åˆ™ç³»ç»Ÿï¼šAlways/Requested/Manualï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Hooksï¼ˆé’©å­ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Memoriesï¼ˆè®°å¿†ç³»ç»Ÿï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Context</span> <span class="hljs-string">Providersï¼ˆä¸Šä¸‹æ–‡æä¾›å™¨ï¼‰</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">å„</span> <span class="hljs-string">IDE</span> <span class="hljs-string">æ’ä»¶å…¨é¢æ”¯æŒ</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.05</span>     <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ¤–</span> <span class="hljs-string">Code</span> <span class="hljs-string">w/</span> <span class="hljs-string">Claude</span> <span class="hljs-string">å¤§ä¼š</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Multi-Agent</span> <span class="hljs-string">åä½œæ¨¡å¼</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">é«˜çº§å·¥ä½œæµæœ€ä½³å®è·µ</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">ä¼ä¸šçº§åº”ç”¨æ¡ˆä¾‹åˆ†äº«</span>
            <span class="hljs-string">â”ƒ</span>
<span class="hljs-number">2025.</span><span class="hljs-string">Q3+</span>    <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">ğŸ”®</span> <span class="hljs-string">æŒç»­æ¼”è¿›ä¸­...</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">æ›´å¤š</span> <span class="hljs-string">MCP</span> <span class="hljs-string">æœåŠ¡æ¥å…¥</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">Agent</span> <span class="hljs-string">ç¼–æ’èƒ½åŠ›å¢å¼º</span>
            <span class="hljs-string">â”ƒ</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ›´æ™ºèƒ½çš„è‡ªåŠ¨åŒ–å·¥ä½œæµ</span>

<span class="hljs-string">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</span>
</code></pre>
<h4 data-id="heading-5">1.2 å„é˜¶æ®µè¯¦è§£</h4>
<p>è®©æˆ‘ä»¬æŠŠè¿™ä¸ªå‘å±•å†ç¨‹åˆ†æˆ <strong>å…­ä¸ªé˜¶æ®µ</strong>ï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰å…¶æ ¸å¿ƒçªç ´ï¼š</p>
<h5 data-id="heading-6">ğŸŒ± ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å¯¹è¯ï¼ˆ2024.03ï¼‰</h5>
<p>è¿™æ˜¯ Claude 3 ç³»åˆ—çš„èµ·ç‚¹ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒClaude å…·å¤‡äº†ï¼š</p>

























<table><thead><tr><th>èƒ½åŠ›</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ–‡æœ¬ç†è§£ä¸ç”Ÿæˆ</strong></td><td>å¼ºå¤§çš„è‡ªç„¶è¯­è¨€å¤„ç†èƒ½åŠ›</td></tr><tr><td><strong>Vision å›¾åƒç†è§£</strong></td><td>å¯ä»¥"çœ‹æ‡‚"å›¾ç‰‡ï¼Œåˆ†æè®¾è®¡ç¨¿</td></tr><tr><td><strong>å¤šè¯­è¨€æ”¯æŒ</strong></td><td>ä¸­è‹±æ–‡ç­‰å¤šè¯­è¨€æµç•…å¯¹è¯</td></tr><tr><td><strong>200K ä¸Šä¸‹æ–‡</strong></td><td>å¯ä»¥å¤„ç†è¶…é•¿æ–‡æ¡£</td></tr></tbody></table>
<p><strong>è¿™ä¸ªé˜¶æ®µçš„ Claude æ›´åƒæ˜¯ä¸€ä¸ª"èŠå¤©åŠ©æ‰‹"</strong>ï¼Œè™½ç„¶èƒ½åŠ›å¾ˆå¼ºï¼Œä½†è¿˜ä¸èƒ½ç›´æ¥æ“ä½œå¤–éƒ¨ä¸–ç•Œã€‚</p>
<h5 data-id="heading-7">ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šå·¥å…·é›†æˆï¼ˆ2024.05-10ï¼‰</h5>
<p>è¿™æ˜¯ Claude ä»"èŠå¤©"èµ°å‘"è¡ŒåŠ¨"çš„å…³é”®é˜¶æ®µï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-code">                    Tool Use æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Claude                     â”‚
â”‚                     â”‚                        â”‚
â”‚                     â–¼                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚         Tool Use API           â”‚       â”‚
â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
â”‚    â”‚  â”‚ å‡½æ•°1 â”‚ â”‚ å‡½æ•°2 â”‚ â”‚ å‡½æ•°3 â”‚   â”‚       â”‚
â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                     â”‚                        â”‚
â”‚                     â–¼                        â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚    â”‚        å¤–éƒ¨æœåŠ¡/API            â”‚       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span></code></pre>
<p><strong>å…³é”®çªç ´</strong>ï¼š</p>
<ul>
<li><strong>Tool Use (2024.05)</strong>ï¼šClaude å¯ä»¥è°ƒç”¨é¢„å®šä¹‰çš„å‡½æ•°</li>
<li><strong>Computer Use (2024.10)</strong>ï¼šClaude å¯ä»¥åƒäººä¸€æ ·æ“ä½œç”µè„‘ç•Œé¢</li>
</ul>
<h5 data-id="heading-8">ğŸ”Œ ç¬¬ä¸‰é˜¶æ®µï¼šåè®®æ ‡å‡†åŒ–ï¼ˆ2024.11ï¼‰</h5>
<p><strong>MCP (Model Context Protocol)</strong> çš„å‘å¸ƒæ˜¯ä¸€ä¸ªé‡Œç¨‹ç¢‘äº‹ä»¶ã€‚MCP å®šä¹‰äº†ä¸€å¥—æ ‡å‡†åè®®ï¼Œè®© AI å¯ä»¥ç»Ÿä¸€åœ°è¿æ¥å„ç§å¤–éƒ¨æœåŠ¡ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">                    MCP åè®®æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      MCP åè®®      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚  Claude â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  MCP <span class="hljs-built_in">Server</span> â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                        â”‚          â”‚
â”‚                                        â–¼          â”‚
â”‚                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚                               â”‚  å¤–éƒ¨æœåŠ¡    â”‚     â”‚
â”‚                               â”‚  â”œâ”€ TAPD    â”‚     â”‚
â”‚                               â”‚  â”œâ”€ Git     â”‚     â”‚
â”‚                               â”‚  â”œâ”€ æ•°æ®åº“   â”‚     â”‚
â”‚                               â”‚  â””â”€ ...     â”‚     â”‚
â”‚                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h5 data-id="heading-9">ğŸš€ ç¬¬å››é˜¶æ®µï¼šä»£ç†åŒ–ç¼–ç¨‹ï¼ˆ2025.02ï¼‰</h5>
<p><strong>Claude Code çš„å‘å¸ƒ</strong>ï¼Œæ ‡å¿—ç€ AI ç¼–ç¨‹åŠ©æ‰‹è¿›å…¥äº†"ä»£ç†"æ—¶ä»£ã€‚</p>





















<table><thead><tr><th>ä¼ ç»Ÿ AI åŠ©æ‰‹</th><th>Claude Codeï¼ˆä»£ç†ï¼‰</th></tr></thead><tbody><tr><td>"ä½ åº”è¯¥è¿™æ ·å†™ä»£ç ..."</td><td>ç›´æ¥å¸®ä½ å†™å¥½ä»£ç å¹¶ä¿å­˜</td></tr><tr><td>"ä½ å¯ä»¥è¿è¡Œè¿™ä¸ªå‘½ä»¤..."</td><td>ç›´æ¥å¸®ä½ æ‰§è¡Œå‘½ä»¤</td></tr><tr><td>"å»ºè®®ä½ åˆ›å»ºè¿™ä¸ªæ–‡ä»¶..."</td><td>ç›´æ¥å¸®ä½ åˆ›å»ºæ–‡ä»¶</td></tr></tbody></table>
<h5 data-id="heading-10">ğŸ§© ç¬¬äº”é˜¶æ®µï¼šæ‰©å±•ç”Ÿæ€ï¼ˆ2025.03ï¼‰</h5>
<p>æœ‰äº† Claude Code è¿™ä¸ª"ä»£ç†"ï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è®©å®ƒ<strong>æ›´æ‡‚ä½ çš„é¡¹ç›®</strong>ã€<strong>æ›´ç¬¦åˆä½ çš„ä¹ æƒ¯</strong>ã€‚è¿™å°±æ˜¯ Commandsã€Skillsã€Rulesã€Hooksã€Memoriesã€Context Providers è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<h5 data-id="heading-11">ğŸ¤– ç¬¬å…­é˜¶æ®µï¼šæ™ºèƒ½ä½“åä½œï¼ˆ2025.05+ï¼‰</h5>
<p>å•ä¸ª AI ä»£ç†å·²ç»å¾ˆå¼ºäº†ï¼Œä½†æœ‰äº›å¤æ‚ä»»åŠ¡éœ€è¦<strong>å¤šä¸ªä¸“ä¸šåŒ–çš„ AI åä½œ</strong>å®Œæˆã€‚è¿™å°±æ˜¯ Multi-Agent çš„æ€è·¯ã€‚</p>
<h4 data-id="heading-12">1.3 å„èƒ½åŠ›å‘å¸ƒè¯¦æƒ…é€ŸæŸ¥è¡¨</h4>

























































































<table><thead><tr><th>èƒ½åŠ›</th><th>é¦–æ¬¡å‘å¸ƒ</th><th>å…³é”®ç‰ˆæœ¬</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>Vision</strong></td><td>2024.03</td><td>Claude 3</td><td>å›¾åƒç†è§£ã€è®¾è®¡ç¨¿åˆ†æ</td></tr><tr><td><strong>Tool Use</strong></td><td>2024.05</td><td>Claude 3 Beta</td><td>å‡½æ•°è°ƒç”¨ã€å¤–éƒ¨å·¥å…·é›†æˆ</td></tr><tr><td><strong>Artifacts</strong></td><td>2024.06</td><td>Claude 3.5 Sonnet</td><td>ä»£ç é¢„è§ˆã€å¯è§†åŒ–è¾“å‡º</td></tr><tr><td><strong>Computer Use</strong></td><td>2024.10</td><td>Claude 3.5 å‡çº§ç‰ˆ</td><td>æ¨¡æ‹Ÿäººç±»æ“ä½œè®¡ç®—æœº</td></tr><tr><td><strong>MCP Protocol</strong></td><td>2024.11.25</td><td>å¼€æºåè®®</td><td>æ ‡å‡†åŒ–å¤–éƒ¨æœåŠ¡è¿æ¥</td></tr><tr><td><strong>Claude Code</strong></td><td>2025.02.25</td><td>ä¸ 3.7 Sonnet åŒå‘</td><td>ç»ˆç«¯ AI ç¼–ç¨‹ä»£ç†</td></tr><tr><td><strong>Commands</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>å¿«æ·å‘½ä»¤å…¥å£</td></tr><tr><td><strong>Skills</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>å¤æ‚ä»»åŠ¡æ‰§è¡Œæ¨¡å—</td></tr><tr><td><strong>Rules</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>è¡Œä¸ºçº¦æŸè§„åˆ™</td></tr><tr><td><strong>Hooks</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>äº‹ä»¶é©±åŠ¨è‡ªåŠ¨åŒ–</td></tr><tr><td><strong>Memories</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>æŒä¹…åŒ–ä¸Šä¸‹æ–‡å­˜å‚¨</td></tr><tr><td><strong>Context Providers</strong></td><td>2025.03</td><td>Claude Code æ‰©å±•</td><td>è‡ªåŠ¨ä¸Šä¸‹æ–‡æ³¨å…¥</td></tr><tr><td><strong>Multi-Agent</strong></td><td>2025.05</td><td>å¤§ä¼šå‘å¸ƒ</td><td>å¤šæ™ºèƒ½ä½“åä½œ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-13">ç¬¬äºŒéƒ¨åˆ†ï¼šåŸºç¡€æ¦‚å¿µä¸é…ç½®</h3>
<h4 data-id="heading-14">2.1 ä»€ä¹ˆæ˜¯ Claude Code æ‰©å±•èƒ½åŠ›</h4>
<p><strong>æ‰©å±•èƒ½åŠ›</strong>ï¼Œç®€å•è¯´å°±æ˜¯<strong>è®© AI æ›´æ‡‚ä½ çš„é¡¹ç›®ã€æ›´ç¬¦åˆä½ çš„ä¹ æƒ¯</strong>çš„ä¸€ç³»åˆ—é…ç½®ã€‚</p>
<p>æ‰“ä¸ªæ¯”æ–¹ï¼š</p>
<ul>
<li>åŸç”Ÿçš„ Claude Code å°±åƒä¸€ä¸ª<strong>åˆšå…¥èŒçš„æ–°å‘˜å·¥</strong>ï¼Œèƒ½åŠ›å¾ˆå¼ºï¼Œä½†ä¸äº†è§£å…¬å¸çš„è§„èŒƒå’Œæµç¨‹</li>
<li>é…ç½®äº†æ‰©å±•èƒ½åŠ›åï¼Œå°±åƒè¿™ä¸ªå‘˜å·¥<strong>ç»è¿‡äº†å…¥èŒåŸ¹è®­</strong>ï¼ŒçŸ¥é“äº†å…¬å¸çš„ç¼–ç è§„èŒƒã€é¡¹ç›®ç»“æ„ã€å¸¸ç”¨å·¥å…·</li>
</ul>
<p><strong>æ‰©å±•èƒ½åŠ›èƒ½å¸®ä½ åšä»€ä¹ˆï¼Ÿ</strong></p>





































<table><thead><tr><th>ç—›ç‚¹</th><th>æ‰©å±•èƒ½åŠ›è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>æ¯æ¬¡éƒ½è¦é‡å¤è¯´æ˜é¡¹ç›®èƒŒæ™¯</td><td><strong>Context Providers</strong> è‡ªåŠ¨æ³¨å…¥é¡¹ç›®ä¿¡æ¯</td></tr><tr><td>AI ç”Ÿæˆçš„ä»£ç ä¸ç¬¦åˆå›¢é˜Ÿè§„èŒƒ</td><td><strong>Rules</strong> çº¦æŸä»£ç é£æ ¼å’Œå®‰å…¨è§„èŒƒ</td></tr><tr><td>å¸¸ç”¨æ“ä½œéœ€è¦è¾“å…¥å¾ˆé•¿çš„æŒ‡ä»¤</td><td><strong>Commands</strong> å®šä¹‰å¿«æ·å‘½ä»¤</td></tr><tr><td>å¤æ‚ä»»åŠ¡éœ€è¦å¤šä¸ªæ­¥éª¤</td><td><strong>Skills</strong> å°è£…å®Œæ•´çš„ä»»åŠ¡æµç¨‹</td></tr><tr><td>å¸Œæœ›æŸäº›æ“ä½œè‡ªåŠ¨æ‰§è¡Œ</td><td><strong>Hooks</strong> åœ¨ç‰¹å®šäº‹ä»¶æ—¶è‡ªåŠ¨è§¦å‘</td></tr><tr><td>AI è®°ä¸ä½ä¹‹å‰çš„å†³å®š</td><td><strong>Memories</strong> æŒä¹…åŒ–å­˜å‚¨é¡¹ç›®ä¿¡æ¯</td></tr><tr><td>éœ€è¦è·å– TAPD/Git ç­‰å¤–éƒ¨æ•°æ®</td><td><strong>MCP</strong> è¿æ¥å¤–éƒ¨æœåŠ¡</td></tr></tbody></table>
<h4 data-id="heading-15">2.2 é…ç½®ç›®å½•ç»“æ„è¯¦è§£</h4>
<p>æ‰€æœ‰æ‰©å±•èƒ½åŠ›çš„é…ç½®ï¼Œéƒ½æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ <code>.codebuddy/</code> æ–‡ä»¶å¤¹ä¸‹ï¼ˆä¸åŒ IDE å¯èƒ½æ˜¯ <code>.cursor/</code> æˆ– <code>.claude/</code>ï¼‰ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">é¡¹ç›®æ ¹ç›®å½•/
â””â”€â”€ .codebuddy/                    <span class="hljs-comment"># æ‰©å±•èƒ½åŠ›é…ç½®æ ¹ç›®å½•</span>
    â”‚
    â”œâ”€â”€ commands/                  <span class="hljs-comment"># ğŸ“‹ å‘½ä»¤å®šä¹‰</span>
    â”‚   â”œâ”€â”€ create-component.md   <span class="hljs-comment"># åˆ›å»ºç»„ä»¶å‘½ä»¤</span>
    â”‚   â””â”€â”€ create-api.md         <span class="hljs-comment"># åˆ›å»º API å‘½ä»¤</span>
    â”‚
    â”œâ”€â”€ skills/                    <span class="hljs-comment"># ğŸ¯ æŠ€èƒ½å®šä¹‰</span>
    â”‚   â””â”€â”€ code-review/          <span class="hljs-comment"># æ¯ä¸ªæŠ€èƒ½ä¸€ä¸ªæ–‡ä»¶å¤¹</span>
    â”‚       â””â”€â”€ SKILL.md
    â”‚
    â”œâ”€â”€ rules/                     <span class="hljs-comment"># ğŸ“ è§„åˆ™å®šä¹‰</span>
    â”‚   â”œâ”€â”€ always/               <span class="hljs-comment"># å§‹ç»ˆç”Ÿæ•ˆçš„è§„åˆ™</span>
    â”‚   â”‚   â””â”€â”€ security.md
    â”‚   â”œâ”€â”€ requested/            <span class="hljs-comment"># AI æŒ‰éœ€å¼•ç”¨çš„è§„åˆ™</span>
    â”‚   â”‚   â””â”€â”€ i18n.md
    â”‚   â””â”€â”€ manual/               <span class="hljs-comment"># æ‰‹åŠ¨ @å¼•ç”¨çš„è§„åˆ™</span>
    â”‚       â””â”€â”€ performance.md
    â”‚
    â”œâ”€â”€ hooks/                     <span class="hljs-comment"># ğŸª é’©å­å®šä¹‰</span>
    â”‚   â””â”€â”€ pre-commit.md
    â”‚
    â”œâ”€â”€ memories/                  <span class="hljs-comment"># ğŸ§  è®°å¿†å­˜å‚¨</span>
    â”‚   â””â”€â”€ project-facts.json
    â”‚
    â”œâ”€â”€ context/                   <span class="hljs-comment"># ğŸ“„ ä¸Šä¸‹æ–‡æä¾›å™¨</span>
    â”‚   â””â”€â”€ auto-inject.md
    â”‚
    â””â”€â”€ mcp.json                   <span class="hljs-comment"># ğŸ”Œ MCP æœåŠ¡é…ç½®</span>
</code></pre>
<h4 data-id="heading-16">2.3 å„èƒ½åŠ›ç±»å‹å¯¹æ¯”</h4>




































































<table><thead><tr><th>èƒ½åŠ›ç±»å‹</th><th>è§¦å‘æ–¹å¼</th><th>ä¸»è¦ç”¨é€”</th><th>å¤æ‚åº¦</th><th>æ¨èä¼˜å…ˆçº§</th></tr></thead><tbody><tr><td><strong>Commands</strong></td><td><code>/command</code> æ˜¾å¼è°ƒç”¨</td><td>å¿«æ·å…¥å£</td><td>â­</td><td>P0</td></tr><tr><td><strong>Skills</strong></td><td>è¢« Command æˆ– AI è°ƒç”¨</td><td>å¤æ‚ä»»åŠ¡æ‰§è¡Œ</td><td>â­â­â­</td><td>P0</td></tr><tr><td><strong>Rules</strong></td><td>è‡ªåŠ¨/æŒ‰éœ€/æ‰‹åŠ¨</td><td>çº¦æŸ AI è¡Œä¸º</td><td>â­â­</td><td>P0</td></tr><tr><td><strong>Hooks</strong></td><td>äº‹ä»¶è‡ªåŠ¨è§¦å‘</td><td>è‡ªåŠ¨åŒ–æµç¨‹</td><td>â­â­</td><td>P1</td></tr><tr><td><strong>Memories</strong></td><td>AI è‡ªåŠ¨è¯»å–</td><td>æŒä¹…åŒ–ä¸Šä¸‹æ–‡</td><td>â­</td><td>P1</td></tr><tr><td><strong>Context</strong></td><td>è‡ªåŠ¨æ³¨å…¥</td><td>ä¸Šä¸‹æ–‡å¢å¼º</td><td>â­</td><td>P1</td></tr><tr><td><strong>MCP</strong></td><td>AI è°ƒç”¨</td><td>å¤–éƒ¨æœåŠ¡é›†æˆ</td><td>â­â­â­</td><td>P1</td></tr><tr><td><strong>Multi-Agent</strong></td><td>ä»»åŠ¡åˆ†å‘</td><td>å¤æ‚åä½œ</td><td>â­â­â­</td><td>P2</td></tr></tbody></table>
<p><strong>æ¨èçš„å­¦ä¹ é¡ºåº</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Commands (æœ€ç®€å•) â†’ Rules â†’ Skills â†’ Hooks â†’ Memories â†’ Context â†’ MCP â†’ Multi-Agent (æœ€å¤æ‚)
</code></pre>
<hr/>
<h3 data-id="heading-17">ç¬¬ä¸‰éƒ¨åˆ†ï¼šCommands å‘½ä»¤ç³»ç»Ÿ</h3>
<h4 data-id="heading-18">3.1 Commands æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Commands</strong> æ˜¯ç”¨æˆ·ä¸ AI äº¤äº’çš„<strong>å¿«æ·å…¥å£</strong>ï¼Œé€šè¿‡ <code>/command</code> æ ¼å¼è§¦å‘ã€‚</p>
<p><strong>è‡ªå®šä¹‰ Commands</strong> è®©ä½ å¯ä»¥å®šä¹‰è‡ªå·±çš„å¿«æ·å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><code>/create-component UserList</code> - åˆ›å»ºä¸€ä¸ª React ç»„ä»¶</li>
<li><code>/create-api users</code> - åˆ›å»ºç”¨æˆ· API æ¨¡å—</li>
<li><code>/analyze-pr 123</code> - åˆ†ææŸä¸ª PR</li>
</ul>
<h4 data-id="heading-19">3.2 å¦‚ä½•å®šä¹‰ä¸€ä¸ª Command</h4>
<p>Command ä½¿ç”¨ Markdown æ–‡ä»¶å®šä¹‰ï¼Œæ”¾åœ¨ <code>.codebuddy/commands/</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/commands/create-component.md --&gt;
---</span>
name: create-component
<span class="hljs-section">description: ğŸ§© åˆ›å»º React ç»„ä»¶
---</span>

<span class="hljs-section"># åˆ›å»º React ç»„ä»¶</span>

<span class="hljs-section">## ä½¿ç”¨æ–¹å¼</span>
/create-component &lt;ç»„ä»¶åç§°&gt; [--with-test]

<span class="hljs-section">## å‚æ•°è¯´æ˜</span>
<span class="hljs-bullet">-</span> <span class="hljs-code">`ç»„ä»¶åç§°`</span>ï¼šå¿…å¡«ï¼ŒPascalCase æ ¼å¼
<span class="hljs-bullet">-</span> <span class="hljs-code">`--with-test`</span>ï¼šå¯é€‰ï¼ŒåŒæ—¶ç”Ÿæˆæµ‹è¯•æ–‡ä»¶

<span class="hljs-section">## æ‰§è¡Œé€»è¾‘</span>
<span class="hljs-bullet">1.</span> éªŒè¯ç»„ä»¶åç§°æ ¼å¼
<span class="hljs-bullet">2.</span> ç”Ÿæˆç»„ä»¶æ–‡ä»¶åˆ° src/components/
<span class="hljs-bullet">3.</span> å¦‚æœæŒ‡å®š --with-testï¼Œç”Ÿæˆæµ‹è¯•æ–‡ä»¶
</code></pre>
<hr/>
<h3 data-id="heading-20">ç¬¬å››éƒ¨åˆ†ï¼šSkills æŠ€èƒ½ç³»ç»Ÿ</h3>
<h4 data-id="heading-21">4.1 Skills æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Skills</strong> æ˜¯ AI çš„èƒ½åŠ›æ¨¡å—ï¼Œå®šä¹‰äº†æ‰§è¡Œå¤æ‚ä»»åŠ¡çš„è¯¦ç»†é€»è¾‘ã€‚</p>
<p><strong>Skills ä¸ Commands çš„åŒºåˆ«</strong>ï¼š</p>
<ul>
<li>Commands æ˜¯"å…¥å£"ï¼Œå‘Šè¯‰ AI è¦åšä»€ä¹ˆ</li>
<li>Skills æ˜¯"æ‰§è¡Œè€…"ï¼Œå®šä¹‰å…·ä½“æ€ä¹ˆåš</li>
</ul>
<h4 data-id="heading-22">4.2 Skill çš„å®Œæ•´ç»“æ„</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/skills/code-review/SKILL.md --&gt;
---</span>
name: code-review
description: è‡ªåŠ¨ä»£ç å®¡æŸ¥
<span class="hljs-section">version: 1.0.0
---</span>

<span class="hljs-section"># ä»£ç å®¡æŸ¥æŠ€èƒ½</span>

<span class="hljs-section">## è¾“å…¥</span>
<span class="hljs-bullet">-</span> files: è¦å®¡æŸ¥çš„æ–‡ä»¶åˆ—è¡¨
<span class="hljs-bullet">-</span> checkTypes: æ£€æŸ¥ç±»å‹ï¼ˆsecurity/performance/styleï¼‰

<span class="hljs-section">## è¾“å‡º</span>
<span class="hljs-bullet">-</span> summary: é—®é¢˜æ±‡æ€»
<span class="hljs-bullet">-</span> issues: é—®é¢˜è¯¦æƒ…åˆ—è¡¨

<span class="hljs-section">## æ‰§è¡Œé€»è¾‘</span>
<span class="hljs-section">### Step 1: è¯»å–æ–‡ä»¶</span>
<span class="hljs-section">### Step 2: æ‰§è¡Œæ£€æŸ¥</span>
<span class="hljs-section">### Step 3: ç”ŸæˆæŠ¥å‘Š</span>
</code></pre>
<hr/>
<h3 data-id="heading-23">ç¬¬äº”éƒ¨åˆ†ï¼šRules è§„åˆ™ç³»ç»Ÿ</h3>
<h4 data-id="heading-24">5.1 Rules æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Rules</strong> æ˜¯çº¦æŸ AI è¡Œä¸ºçš„å£°æ˜å¼è§„åˆ™ï¼Œç¡®ä¿ç”Ÿæˆçš„ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒã€‚</p>
<h4 data-id="heading-25">5.2 ä¸‰ç§è§„åˆ™ç±»å‹</h4>

























<table><thead><tr><th>ç±»å‹</th><th>è§¦å‘æ–¹å¼</th><th>é€‚ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td><strong>Always</strong></td><td>å§‹ç»ˆç”Ÿæ•ˆ</td><td>å®‰å…¨è§„åˆ™ã€æ ¸å¿ƒç¼–ç è§„èŒƒ</td></tr><tr><td><strong>Requested</strong></td><td>AI æ ¹æ®ä»»åŠ¡è‡ªåŠ¨å¼•ç”¨</td><td>ç‰¹å®šé¢†åŸŸè§„åˆ™ï¼ˆå¦‚ i18nï¼‰</td></tr><tr><td><strong>Manual</strong></td><td>ç”¨æˆ·æ‰‹åŠ¨ @å¼•ç”¨</td><td>å¯é€‰çš„é«˜çº§è§„åˆ™</td></tr></tbody></table>
<h4 data-id="heading-26">5.3 å®æˆ˜æ¡ˆä¾‹ï¼šå®‰å…¨ç¼–ç è§„åˆ™</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/rules/always/security.md --&gt;
---</span>
name: security-rules
type: always
<span class="hljs-section">description: ğŸ”’ å®‰å…¨ç¼–ç è§„åˆ™
---</span>

<span class="hljs-section"># å®‰å…¨ç¼–ç è§„åˆ™</span>

<span class="hljs-section">## 1. ç¦æ­¢ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯</span>
âŒ const API<span class="hljs-emphasis">_KEY = 'sk-xxx';
âœ… const API_</span>KEY = process.env.API<span class="hljs-emphasis">_KEY;

## 2. SQL æ³¨å…¥é˜²æŠ¤
âŒ `SELECT * FROM users WHERE id = '${userId}'`
âœ… db.query('SELECT * FROM users WHERE id = ?', [userId])
</span></code></pre>
<hr/>
<h3 data-id="heading-27">ç¬¬å…­éƒ¨åˆ†ï¼šHooks é’©å­ç³»ç»Ÿ</h3>
<h4 data-id="heading-28">6.1 Hooks æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Hooks</strong> æ˜¯äº‹ä»¶é©±åŠ¨çš„è‡ªåŠ¨åŒ–æœºåˆ¶ã€‚å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒHooks ä¼šè‡ªåŠ¨æ‰§è¡Œé¢„å®šä¹‰çš„æ“ä½œã€‚</p>
<h4 data-id="heading-29">6.2 æ”¯æŒçš„äº‹ä»¶ç±»å‹</h4>






























<table><thead><tr><th>äº‹ä»¶</th><th>è§¦å‘æ—¶æœº</th><th>å…¸å‹ç”¨é€”</th></tr></thead><tbody><tr><td><code>pre-commit</code></td><td>æäº¤å‰</td><td>ä»£ç æ£€æŸ¥ã€æ ¼å¼åŒ–</td></tr><tr><td><code>post-save</code></td><td>ä¿å­˜å</td><td>è‡ªåŠ¨æ ¼å¼åŒ–</td></tr><tr><td><code>on-file-create</code></td><td>åˆ›å»ºæ–‡ä»¶æ—¶</td><td>æ·»åŠ å¤´éƒ¨æ³¨é‡Š</td></tr><tr><td><code>after-skill</code></td><td>æŠ€èƒ½æ‰§è¡Œå</td><td>éªŒè¯ç»“æœ</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-30">ç¬¬ä¸ƒéƒ¨åˆ†ï¼šMemories è®°å¿†ç³»ç»Ÿ</h3>
<h4 data-id="heading-31">7.1 Memories æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Memories</strong> æ˜¯ AI çš„æŒä¹…åŒ–å­˜å‚¨ï¼Œç”¨äºä¿å­˜é¡¹ç›®äº‹å®ã€ç”¨æˆ·åå¥½å’Œå­¦ä¹ è®°å½•ã€‚</p>
<h4 data-id="heading-32">7.2 è®°å¿†ç±»å‹</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .codebuddy/memories/project-facts.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"techStack"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"framework"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"React 18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"ui"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TDesign"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"state"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Redux Toolkit"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"conventions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"componentNaming"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PascalCase"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"fileNaming"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"kebab-case"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<hr/>
<h3 data-id="heading-33">ç¬¬å…«éƒ¨åˆ†ï¼šContext Providers ä¸Šä¸‹æ–‡æä¾›å™¨</h3>
<h4 data-id="heading-34">8.1 Context Providers æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Context Providers</strong> è‡ªåŠ¨ä¸º AI æ³¨å…¥ç›¸å…³ä¸Šä¸‹æ–‡ï¼Œå‡å°‘é‡å¤è¯´æ˜é¡¹ç›®èƒŒæ™¯ã€‚</p>
<h4 data-id="heading-35">8.2 è‡ªåŠ¨æ³¨å…¥ç¤ºä¾‹</h4>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-section">&lt;!-- .codebuddy/context/auto-inject.md --&gt;
---</span>
name: project-context
<span class="hljs-section">inject: always
---</span>

<span class="hljs-section"># é¡¹ç›®ä¸Šä¸‹æ–‡</span>
<span class="hljs-bullet">-</span> æ¡†æ¶ï¼šReact 18 + TypeScript
<span class="hljs-bullet">-</span> UI åº“ï¼šTDesign
<span class="hljs-bullet">-</span> æ„å»ºå·¥å…·ï¼šVite
</code></pre>
<hr/>
<h3 data-id="heading-36">ç¬¬ä¹éƒ¨åˆ†ï¼šMCP æ¨¡å‹ä¸Šä¸‹æ–‡åè®®</h3>
<h4 data-id="heading-37">9.1 MCP æ˜¯ä»€ä¹ˆ</h4>
<p><strong>MCP (Model Context Protocol)</strong> æ˜¯ AI ä¸å¤–éƒ¨æœåŠ¡äº¤äº’çš„æ ‡å‡†åè®®ï¼Œç”± Anthropic äº 2024 å¹´ 11 æœˆå¼€æºã€‚</p>
<h4 data-id="heading-38">9.2 é…ç½®ç¤ºä¾‹</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .codebuddy/mcp.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"mcpServers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"tapd"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp-oa.tapd.woa.com/mcp"</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"gongfeng"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"url"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://mcp.git.woa.com/mcp"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h4 data-id="heading-39">9.3 å¸¸ç”¨ MCP æœåŠ¡</h4>





















<table><thead><tr><th>æœåŠ¡</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td><strong>TAPD</strong></td><td>è·å–éœ€æ±‚ã€æ›´æ–°çŠ¶æ€</td></tr><tr><td><strong>å·¥èœ‚ Git</strong></td><td>åˆ†æ”¯ç®¡ç†ã€MR åˆ›å»º</td></tr><tr><td><strong>TDesign</strong></td><td>ç»„ä»¶æ–‡æ¡£æŸ¥è¯¢</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-40">ç¬¬åéƒ¨åˆ†ï¼šMulti-Agent å¤šæ™ºèƒ½ä½“</h3>
<h4 data-id="heading-41">10.1 Multi-Agent æ˜¯ä»€ä¹ˆ</h4>
<p><strong>Multi-Agent</strong> æ˜¯å°†å¤æ‚ä»»åŠ¡åˆ†è§£ç»™å¤šä¸ªä¸“ä¸šæ™ºèƒ½ä½“åä½œå®Œæˆçš„æœºåˆ¶ã€‚</p>
<h4 data-id="heading-42">10.2 æ™ºèƒ½ä½“ç±»å‹</h4>





















<table><thead><tr><th>æ™ºèƒ½ä½“</th><th>èŒè´£</th></tr></thead><tbody><tr><td><strong>Reviewer</strong></td><td>ä»£ç å®¡æŸ¥</td></tr><tr><td><strong>Tester</strong></td><td>æµ‹è¯•ç”Ÿæˆ</td></tr><tr><td><strong>Documenter</strong></td><td>æ–‡æ¡£ç¼–å†™</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-43">ç¬¬åä¸€éƒ¨åˆ†ï¼šClaude åŸç”Ÿèƒ½åŠ›</h3>
<h4 data-id="heading-44">11.1 Vision è§†è§‰èƒ½åŠ›</h4>
<p>å¯ä»¥åˆ†æ UI è®¾è®¡ç¨¿ã€ç†è§£æˆªå›¾ä¸­çš„éœ€æ±‚ã€‚</p>
<h4 data-id="heading-45">11.2 Tool Use å·¥å…·è°ƒç”¨</h4>
<p>æ”¯æŒæ–‡ä»¶è¯»å†™ã€å‘½ä»¤æ‰§è¡Œã€å¤–éƒ¨æœåŠ¡è°ƒç”¨ã€‚</p>
<h4 data-id="heading-46">11.3 Extended Thinking æ·±åº¦æ¨ç†</h4>
<p>Claude 3.7 Sonnet çš„æ··åˆæ¨ç†èƒ½åŠ›ï¼Œå¯ä»¥å±•ç¤ºæ€è€ƒè¿‡ç¨‹ã€‚</p>
<hr/>
<h3 data-id="heading-47">ç¬¬åäºŒéƒ¨åˆ†ï¼šå®Œæ•´å·¥ä½œæµæ¡ˆä¾‹</h3>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> /specskills:launch "TAPD-123456789"
   â†“
<span class="hljs-bullet">2.</span> AI è°ƒç”¨ TAPD MCP è·å–éœ€æ±‚è¯¦æƒ…
   â†“
<span class="hljs-bullet">3.</span> analyze-requirements æŠ€èƒ½åˆ†æéœ€æ±‚
   â†“
<span class="hljs-bullet">4.</span> ç”¨æˆ·å®¡æ ¸ç¡®è®¤
   â†“
<span class="hljs-bullet">5.</span> AI æŒ‰ä»»åŠ¡é€é¡¹å®æ–½
   â†“
<span class="hljs-bullet">6.</span> post-apply Hook è‡ªåŠ¨éªŒè¯
</code></pre>
<hr/>
<h3 data-id="heading-48">ç¬¬åä¸‰éƒ¨åˆ†ï¼šæœ€ä½³å®è·µä¸è¸©å‘æŒ‡å—</h3>
<h4 data-id="heading-49">13.1 æ‰©å±•ç»„ç»‡åŸåˆ™</h4>
<ol>
<li><strong>å•ä¸€èŒè´£</strong>ï¼šæ¯ä¸ª Skill åªåšä¸€ä»¶äº‹</li>
<li><strong>å¯ç»„åˆæ€§</strong>ï¼šSkills å¯ä»¥ç›¸äº’è°ƒç”¨</li>
<li><strong>å¯æµ‹è¯•æ€§</strong>ï¼šå®šä¹‰æ¸…æ™°çš„è¾“å…¥è¾“å‡º</li>
</ol>
<h4 data-id="heading-50">13.2 å¸¸è§é—®é¢˜</h4>





















<table><thead><tr><th>é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>Rules ä¸ç”Ÿæ•ˆ</td><td>æ£€æŸ¥ type æ˜¯å¦æ­£ç¡®ï¼ˆalways/requested/manualï¼‰</td></tr><tr><td>MCP è¿æ¥å¤±è´¥</td><td>æ£€æŸ¥ token é…ç½®å’Œç½‘ç»œ</td></tr><tr><td>Skill æ‰§è¡Œè¶…æ—¶</td><td>æ‹†åˆ†ä¸ºæ›´å°çš„æ­¥éª¤</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-51">ç¬¬åå››éƒ¨åˆ†ï¼šèƒ½åŠ›çŸ©é˜µä¸å­¦ä¹ è·¯å¾„</h3>
<h4 data-id="heading-52">14.1 èƒ½åŠ›çŸ©é˜µ</h4>



























































<table><thead><tr><th>èƒ½åŠ›</th><th>å¤æ‚åº¦</th><th>ä»·å€¼</th><th>æ¨èä¼˜å…ˆçº§</th></tr></thead><tbody><tr><td><strong>Commands</strong></td><td>â­</td><td>é«˜</td><td>P0</td></tr><tr><td><strong>Rules (Always)</strong></td><td>â­â­</td><td>é«˜</td><td>P0</td></tr><tr><td><strong>Skills</strong></td><td>â­â­â­</td><td>é«˜</td><td>P0</td></tr><tr><td><strong>Hooks</strong></td><td>â­â­</td><td>é«˜</td><td>P1</td></tr><tr><td><strong>MCP</strong></td><td>â­â­â­</td><td>é«˜</td><td>P1</td></tr><tr><td><strong>Memories</strong></td><td>â­</td><td>ä¸­</td><td>P1</td></tr><tr><td><strong>Context</strong></td><td>â­</td><td>ä¸­</td><td>P1</td></tr><tr><td><strong>Multi-Agent</strong></td><td>â­â­â­</td><td>ä¸­</td><td>P2</td></tr></tbody></table>
<h4 data-id="heading-53">14.2 æ¨èå­¦ä¹ è·¯å¾„</h4>
<pre><code class="hljs">å…¥é—¨ï¼šCommands â†’ Rules
è¿›é˜¶ï¼šSkills â†’ Hooks â†’ Memories
é«˜çº§ï¼šMCP â†’ Multi-Agent
</code></pre>
<hr/>
<h3 data-id="heading-54">å†™åœ¨æœ€å</h3>
<p>Claude Code çš„èƒ½åŠ›ä½“ç³»æ˜¯ä¸€ä¸ª<strong>æŒç»­æ¼”è¿›</strong>çš„ç”Ÿæ€ã€‚æœ¬æ–‡ä»‹ç»çš„å†…å®¹æ˜¯æˆªè‡³ 2025 å¹´ 12 æœˆçš„çŠ¶æ€ï¼Œéšç€ Anthropic çš„æŒç»­æ›´æ–°ï¼Œä¼šæœ‰æ›´å¤šå¼ºå¤§çš„èƒ½åŠ›åŠ å…¥ã€‚</p>
<p><strong>ä¸€å¥è¯æ€»ç»“</strong>ï¼šClaude Code çš„èƒ½åŠ›ä½“ç³»ï¼Œæ˜¯ä»"å¯¹è¯"åˆ°"è¡ŒåŠ¨"ï¼Œä»"å•ä¸€"åˆ°"åä½œ"çš„æ¼”è¿›è¿‡ç¨‹ã€‚æŒæ¡è¿™äº›èƒ½åŠ›ï¼Œèƒ½è®©ä½ çš„å¼€å‘æ•ˆç‡æå‡æ•°å€ã€‚</p>
<hr/>
<blockquote>
<p>ğŸ“… <strong>æœ€åæ›´æ–°</strong>ï¼š2025-12-03</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[DRFæ¡†æ¶è®¤è¯åº•å±‚æºç è§£æâ€”â€”ç®€å•æ˜“ç†è§£ï¼]]></title>    <link>https://juejin.cn/post/7579176524131991603</link>    <guid>https://juejin.cn/post/7579176524131991603</guid>    <pubDate>2025-12-03T06:40:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579176524131991603" data-draft-id="7578948893762420763" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="DRFæ¡†æ¶è®¤è¯åº•å±‚æºç è§£æâ€”â€”ç®€å•æ˜“ç†è§£ï¼"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:40:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç¨³ä½åˆ«æµª"/> <meta itemprop="url" content="https://juejin.cn/user/1593616857302922"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            DRFæ¡†æ¶è®¤è¯åº•å±‚æºç è§£æâ€”â€”ç®€å•æ˜“ç†è§£ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1593616857302922/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç¨³ä½åˆ«æµª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:40:03.000Z" title="Wed Dec 03 2025 06:40:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ï¼ˆå‰æï¼šå­¦è¿‡ä¸€ç‚¹Djangoæ¡†æ¶ï¼Œæ›´å¥½ç†è§£ï¼‰</p>
<h3 data-id="heading-0">ä¸€.ä»è¯·æ±‚å‘é€è¿‡æ¥åˆ°æ‰§è¡Œè®¤è¯çš„ç®€å•è¿‡ç¨‹æ¢³ç†</h3>
<p>è¯·æ±‚é¦–å…ˆæ¥åˆ°urlsæ¨¡å—ï¼Œè€Œåæ ¹æ® URL æ˜ å°„æ‰¾åˆ°Â <code>UserView</code>çš„<code>as_view()</code>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9baec02604cf45e78133d170cdc00c0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iz5L2P5Yir5rWq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348802&amp;x-signature=o%2FOnn%2FQgcF7k%2Fzo5wrQe7moJpi8%3D" alt="å±å¹•æˆªå›¾ 2025-12-02 171517.png" loading="lazy"/>
<code>as_view()</code>å†…éƒ¨ä¼šæ‰§è¡Œä¸¤ä¸ªå‘½ä»¤ï¼ˆç®€å•æ¥è¯´ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">obj</span> = UserView()  <span class="hljs-comment">#å®ä¾‹åŒ–ä¸€ä¸ªobj</span>
obj.dispatch()  <span class="hljs-comment">#è°ƒç”¨å¯¹è±¡çš„dispatchæ–¹æ³•</span>
</code></pre>
<p>è€Œ<code>as_view()</code>æ–¹æ³•æºç åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>æ¥åˆ°viewæ¨¡å—ï¼Œä»class UserView(APIView)é‡Œç»§æ‰¿çš„APIViewå¼€å§‹ä¸€æ­¥æ­¥è·³è½¬</p>
<p>APIViewå¦‚ä¸‹å›¾æ‰€ç¤º
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f7a8f109ed4245a48b5d666f5ead1d10~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iz5L2P5Yir5rWq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348802&amp;x-signature=0as%2FYtMbeL93wIiZBGOZxZdYQPc%3D" alt="å±å¹•æˆªå›¾ 2025-12-02 173051.png" loading="lazy"/>
ç‚¹è¿›<code>as_view()</code>ï¼Œæ‰¾åˆ°ä¸€ä¸ªå«viewçš„æ–¹æ³•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<pre><code class="hljs language-view" lang="view">def view(request, *args, **kwargs):
    self = cls(**initkwargs)
    self.setup(request, *args, **kwargs)
    if not hasattr(self, "request"):
        raise AttributeError(
            "%s instance has no 'request' attribute. Did you override "
            "setup() and forget to call super()?" % cls.__name__
        )
    return self.dispatch(request, *args, **kwargs)
</code></pre>
<p>viewæ–¹æ³•çš„<code>self = cls(**initkwargs)</code>&gt;&gt;&gt;&gt;å®ä¾‹åŒ–äº†obj</p>
<p>æœ€åä¾¿è°ƒç”¨äº†<code>dispatchæ–¹æ³•</code>(è¿™æ˜¯æ¥ä¸‹æ¥çš„æ ¸å¿ƒï¼)</p>
<h3 data-id="heading-1">äºŒ.å¼€å§‹è®¤è¯æºç æµç¨‹</h3>
<p>çœ‹ä¸‹å›¾ï¼Œç®€å•æ¸…æ™°æ˜äº†
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a3c1f5b451944a19995022d9fe032e9e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg56iz5L2P5Yir5rWq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348802&amp;x-signature=AGyXbB79w2uljibzsn2%2Fy74Wadg%3D" alt="å±å¹•æˆªå›¾ 2025-12-03 143402.png" loading="lazy"/>
ä¸ä»…å¦‚æ­¤ï¼Œdispatché‡Œé¢è¿˜æœ‰å…³äºæƒé™å’Œé™æµçš„æ–¹æ³•ï¼Œå®ƒå°±ç›¸å½“äºä¸€ä¸ªå…¥å£ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è™šæ‹Ÿæ»šåŠ¨ï¼šä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½çš„åˆ©å™¨]]></title>    <link>https://juejin.cn/post/7579179625462218794</link>    <guid>https://juejin.cn/post/7579179625462218794</guid>    <pubDate>2025-12-03T06:27:28.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179625462218794" data-draft-id="7578948893762633755" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è™šæ‹Ÿæ»šåŠ¨ï¼šä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½çš„åˆ©å™¨"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:27:28.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Drift_Dream"/> <meta itemprop="url" content="https://juejin.cn/user/3107677514241500"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è™šæ‹Ÿæ»šåŠ¨ï¼šä¼˜åŒ–é•¿åˆ—è¡¨æ€§èƒ½çš„åˆ©å™¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3107677514241500/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Drift_Dream
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:27:28.000Z" title="Wed Dec 03 2025 06:27:28 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.7;font-weight:400;font-size:16px;overflow-x:hidden;color:#212122}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-bottom:8px;padding-bottom:8px}.markdown-body h1{color:#a0a0a0;font-size:38px;margin-top:32px;padding-top:32px}.markdown-body h2{color:#fff;background-color:#212122;width:fit-content;border-bottom-right-radius:100px;margin-top:47px;margin-bottom:16px;padding:4px 48px 4px 8px;line-height:1.7;font-size:30px;transition:all .3s ease-out}.markdown-body h2:hover{border-bottom-right-radius:50px;transition:all .3s ease-out}.markdown-body h3{font-size:24px;padding-left:8px;margin-top:32px;border-bottom:2px solid #c6c4c4;line-height:1.7}.markdown-body h4{font-size:20px;padding-left:8px;margin-top:32px;border-bottom:1px solid #ddd}.markdown-body h5{font-size:16px;margin-top:24px}.markdown-body h6{margin-top:16px;line-height:1.1}.markdown-body p{font-size:16px;text-align:start;white-space:normal;text-size-adjust:auto;line-height:2;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%;margin:auto;padding-left:8px;padding-right:8px}.markdown-body hr{border:none;border-top:4px double #212122;margin-top:32px;margin-bottom:32px;text-align:center}.markdown-body hr:after{content:"â™¥";display:inline-block;position:relative;top:-15px;padding:0 10px;color:#212122;font-size:18px}.markdown-body code{word-break:break-word;overflow-x:auto;background-color:#f1f1f1;color:#ef7060;font-size:14px;padding:.065em 6px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.7;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);margin:32px 16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-color:#212122;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);background-size:40px}.markdown-body pre&gt;code{font-size:14px;padding:16px 8px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#fff;background:#272822}.markdown-body pre&gt;code::-webkit-scrollbar{height:10px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-track{box-shadow:inset 0 0 6px rgba(0,0,0,.3);border-radius:3px;background-color:#f5f5f5}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{border-radius:3px;box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#555}.markdown-body a{color:#ef7060;padding:2px;text-decoration:none;border-bottom:.125em solid #ef7060;border-radius:2px;box-shadow:inset 0 -.025em 0 #ef7060;transition:box-shadow .27s cubic-bezier(.77,0,.175,1),color .27s cubic-bezier(.77,0,.175,1)}.markdown-body a:focus,.markdown-body a:hover{outline:none;box-shadow:inset 0 -1.5em 0 #ef7060;color:#fff}.markdown-body a:before{content:"â‡² ";vertical-align:top;margin-left:2px;font-family:dart!important;font-size:12px;color:inherit;opacity:.7}.markdown-body table{background:#fbfbfb;border-radius:4px;border-collapse:collapse;margin:auto;padding:5px;width:95%;box-shadow:0 5px 10px rgba(0,0,0,.1);animation:float 5s infinite}.markdown-body table th{color:#fff;background:#212122;border-bottom:1px solid #9ea7af;border-right:1px solid #343a45;font-size:18px;padding:16px;text-align:left;vertical-align:middle}.markdown-body table th:first-child{border-top-left-radius:4px}.markdown-body table th:last-child{border-top-right-radius:4px;border-right:none}.markdown-body table tr{border-top:1px solid #c1c3d1;border-bottom:1px solid #c1c3d1;color:#666b85}.markdown-body table tr:hover td{background:#212122;color:#fff;border-top:1px solid #22262e}.markdown-body table tr:first-child{border-top:none}.markdown-body table tr:last-child{border-bottom:none}.markdown-body table tr:nth-child(odd) td{background:#f1f1f1}.markdown-body table tr:nth-child(odd):hover td{background:#212122}.markdown-body table tr:last-child td:first-child{border-bottom-left-radius:4px}.markdown-body table tr:last-child td:last-child{border-bottom-right-radius:4px}.markdown-body table td{background:#fbfbfb;padding:16px;text-align:left;vertical-align:middle;font-size:16px;border-right:1px solid #c1c3d1}.markdown-body table td:last-child{border-right:0}.markdown-body blockquote{color:#777;padding:1px 16px;margin:24px 0;border-left:4px solid #c6c4c4;background-color:#f1f1f1;transition:all .3s ease-out;border-radius:4px}.markdown-body blockquote:hover{border-left-color:#212122;background-color:#212122;color:#fff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:24px}.markdown-body ol li,.markdown-body ul li{margin-bottom:6px;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body span.math{margin-left:32px;font-size:18px;font-weight:700}@media (max-width:720px){.markdown-body h1{font-size:30.4px}.markdown-body h2{font-size:24px}.markdown-body h3{font-size:19.2px}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:12.8px}}</style><style data-highlight="" data-highlight-key="monokai">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#272822;color:#ddd}.hljs-keyword,.hljs-literal,.hljs-name,.hljs-selector-tag,.hljs-strong,.hljs-tag{color:#f92672}.hljs-code{color:#66d9ef}.hljs-class .hljs-title{color:#fff}.hljs-attribute,.hljs-link,.hljs-regexp,.hljs-symbol{color:#bf79db}.hljs-addition,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-emphasis,.hljs-section,.hljs-selector-attr,.hljs-selector-pseudo,.hljs-string,.hljs-subst,.hljs-template-tag,.hljs-template-variable,.hljs-title,.hljs-type,.hljs-variable{color:#a6e22e}.hljs-comment,.hljs-deletion,.hljs-meta,.hljs-quote{color:#75715e}.hljs-doctag,.hljs-keyword,.hljs-literal,.hljs-section,.hljs-selector-id,.hljs-selector-tag,.hljs-title,.hljs-type{font-weight:700}</style><h2 data-id="heading-0">ä»€ä¹ˆæ˜¯è™šæ‹Ÿæ»šåŠ¨ï¼Ÿ</h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æœ‰ä¸€ä¸ªåŒ…å«10,000ä¸ªé¡¹ç›®çš„å¾…åŠäº‹é¡¹åˆ—è¡¨ã€‚å¦‚æœä¸€æ¬¡æ€§å°†æ‰€æœ‰é¡¹ç›®éƒ½æ¸²æŸ“åˆ°é¡µé¢ä¸Šï¼Œæµè§ˆå™¨éœ€è¦åˆ›å»º10,000ä¸ªDOMå…ƒç´ ï¼Œè¿™ä¼šå¯¼è‡´ï¼š</p>
<ul>
<li>é¡µé¢åŠ è½½ç¼“æ…¢</li>
<li>å†…å­˜å ç”¨è¿‡é«˜</li>
<li>æ»šåŠ¨å¡é¡¿ä¸æµç•…</li>
</ul>
<p>è™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollingï¼‰å°±åƒæ˜¯ä¸€ä¸ª"æ™ºèƒ½çª—å£"ï¼Œå®ƒåªæ¸²æŸ“å½“å‰å¯è§åŒºåŸŸçš„å†…å®¹ï¼Œè€Œä¸æ˜¯æ•´ä¸ªåˆ—è¡¨ã€‚å½“ç”¨æˆ·æ»šåŠ¨æ—¶ï¼Œè¿™ä¸ª"çª—å£"ä¼šåŠ¨æ€æ›´æ–°æ˜¾ç¤ºçš„å†…å®¹ã€‚</p>
<p><strong>é€šä¿—æ¯”å–»</strong>ï¼šæŠŠè™šæ‹Ÿæ»šåŠ¨æƒ³è±¡æˆä¸€ä¸ªåªèƒ½çœ‹åˆ°éƒ¨åˆ†ä¹¦ç±å†…å®¹çš„é­”æ³•ä¹¦æ¶ã€‚å½“ä½ ä¸Šä¸‹ç§»åŠ¨è§†çº¿æ—¶ï¼Œä¹¦æ¶ä¼šè‡ªåŠ¨æ›´æ¢æ˜¾ç¤ºçš„ä¹¦æœ¬ï¼Œä½†ä½ å§‹ç»ˆåªèƒ½çœ‹åˆ°æœ‰é™çš„å‡ æœ¬ï¼Œè€Œä¸æ˜¯æ•´ä¸ªå›¾ä¹¦é¦†çš„æ‰€æœ‰ä¹¦ç±ã€‚</p>
<h2 data-id="heading-1">è™šæ‹Ÿæ»šåŠ¨çš„åŸç†</h2>
<p>è™šæ‹Ÿæ»šåŠ¨çš„æ ¸å¿ƒæ€æƒ³å¾ˆç®€å•ï¼š</p>
<ol>
<li><strong>è®¡ç®—å¯è§åŒºåŸŸ</strong>ï¼šç¡®å®šå®¹å™¨çš„é«˜åº¦å’Œæ»šåŠ¨ä½ç½®</li>
<li><strong>è®¡ç®—æ˜¾ç¤ºçš„èµ·å§‹å’Œç»“æŸç´¢å¼•</strong>ï¼šæ ¹æ®æ¯ä¸ªé¡¹ç›®çš„é«˜åº¦ï¼Œç®—å‡ºå½“å‰åº”è¯¥æ˜¾ç¤ºå“ªäº›é¡¹ç›®</li>
<li><strong>åªæ¸²æŸ“å¯è§é¡¹ç›®</strong>ï¼šä»…åˆ›å»ºå½“å‰å¯è§åŒºåŸŸå†…çš„DOMå…ƒç´ </li>
<li><strong>ä½¿ç”¨å ä½å…ƒç´ </strong>ï¼šç”¨ä¸€ä¸ªå…·æœ‰æ­£ç¡®é«˜åº¦çš„ç©ºå…ƒç´ æ¥ç»´æŒæ»šåŠ¨æ¡çš„å‡†ç¡®æ€§</li>
</ol>
<h2 data-id="heading-2">åŸºç¡€å®ç°ç¤ºä¾‹</h2>
<p>è®©æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„JavaScriptå®ç°ï¼Œç†è§£æ ¸å¿ƒé€»è¾‘ï¼š</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>è™šæ‹Ÿæ»šåŠ¨<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    * {
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
      <span class="hljs-attribute">box-sizing</span>: border-box;
    }
    <span class="hljs-selector-id">#container</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">400px</span>;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
      <span class="hljs-attribute">overflow</span>: auto;
      <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
    }
    <span class="hljs-selector-id">#content</span> {
      <span class="hljs-attribute">position</span>: relative;
      <span class="hljs-attribute">height</span>: <span class="hljs-number">100000px</span>;
    }
    <span class="hljs-selector-class">.item</span> {
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
      <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"content"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"container"</span>);
    <span class="hljs-keyword">const</span> content = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">"content"</span>);
    <span class="hljs-keyword">const</span> itemHeight = <span class="hljs-number">50</span>;
    <span class="hljs-keyword">const</span> totalItems = <span class="hljs-number">2000</span>;

    <span class="hljs-comment">// æ¸²æŸ“å¯è§é¡¹ç›®</span>
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">renderVisibleItems</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> scrollTop = container.<span class="hljs-property">scrollTop</span>;
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(scrollTop, <span class="hljs-string">"scrollTop"</span>);

      <span class="hljs-comment">// å‘ä¸‹å–æ•´</span>
      <span class="hljs-keyword">const</span> startIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(scrollTop / itemHeight);

      <span class="hljs-comment">// å‘ä¸Šå–æ•´</span>
      <span class="hljs-keyword">const</span> visibleCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(container.<span class="hljs-property">clientHeight</span> / itemHeight);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(visibleCount, <span class="hljs-string">"visibleCount"</span>);

      <span class="hljs-comment">// å–å°</span>
      <span class="hljs-keyword">const</span> endIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(startIndex + visibleCount + <span class="hljs-number">5</span>, totalItems); <span class="hljs-comment">// å¤šæ¸²æŸ“å‡ ä¸ªä½œä¸ºç¼“å†²</span>

      <span class="hljs-comment">// æ¸…ç©ºå†…å®¹</span>
      content.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">""</span>;

      <span class="hljs-comment">// åˆ›å»ºå¯è§é¡¹ç›®</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = startIndex; i &lt; endIndex; i++) {
        <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">"div"</span>);
        item.<span class="hljs-property">className</span> = <span class="hljs-string">"item"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = itemHeight + <span class="hljs-string">"px"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">position</span> = <span class="hljs-string">"absolute"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">top</span> = i * itemHeight + <span class="hljs-string">"px"</span>;
        item.<span class="hljs-property">style</span>.<span class="hljs-property">width</span> = <span class="hljs-string">"100%"</span>;
        item.<span class="hljs-property">textContent</span> = <span class="hljs-string">`é¡¹ç›® <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>;
        content.<span class="hljs-title function_">appendChild</span>(item);
      }
    }

    container.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"scroll"</span>, renderVisibleItems);
    <span class="hljs-title function_">renderVisibleItems</span>(); <span class="hljs-comment">// åˆå§‹æ¸²æŸ“</span>
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1d536b4e5c6a4976b8bfc83c7bf4a6bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRHJpZnRfRHJlYW0=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348047&amp;x-signature=eQ9%2BkausXbpcSlj2oaggXbwr%2F1g%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-3">Vue 3ä¸­çš„è™šæ‹Ÿæ»šåŠ¨å®è·µ</h2>
<p>åœ¨Vue 3ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨Composition APIæ›´ä¼˜é›…åœ°å®ç°è™šæ‹Ÿæ»šåŠ¨ã€‚ä»¥ä¸‹æ˜¯å‡ ç§å®è·µæ–¹å¼ï¼š</p>
<h3 data-id="heading-4">1. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆæ¨èï¼‰</h3>
<p>å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨æˆç†Ÿçš„è™šæ‹Ÿæ»šåŠ¨åº“ï¼Œå¦‚<code>vue-virtual-scroller</code>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install vue-virtual-scroller@next
</code></pre>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">RecycleScroller</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"scroller"</span>
    <span class="hljs-attr">:items</span>=<span class="hljs-string">"items"</span>
    <span class="hljs-attr">:item-size</span>=<span class="hljs-string">"50"</span>
    <span class="hljs-attr">key-field</span>=<span class="hljs-string">"id"</span>
    <span class="hljs-attr">v-slot</span>=<span class="hljs-string">"{ item }"</span>
  &gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"user"</span>&gt;</span>
      {{ item.name }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">RecycleScroller</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { ref } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">RecycleScroller</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-virtual-scroller'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'vue-virtual-scroller/dist/vue-virtual-scroller.css'</span>;

<span class="hljs-comment">// æ¨¡æ‹Ÿé•¿åˆ—è¡¨æ•°æ®</span>
<span class="hljs-keyword">const</span> items = <span class="hljs-title function_">ref</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>({ <span class="hljs-attr">length</span>: <span class="hljs-number">10000</span> }, <span class="hljs-function">(<span class="hljs-params">_, i</span>) =&gt;</span> ({
  <span class="hljs-attr">id</span>: i,
  <span class="hljs-attr">name</span>: <span class="hljs-string">`ç”¨æˆ· <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>`</span>
})));
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.scroller</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;
}

<span class="hljs-selector-class">.user</span> {
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">border-bottom</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#eee</span>;
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre>
<h3 data-id="heading-5">2. è‡ªå®šä¹‰è™šæ‹Ÿæ»šåŠ¨ç»„ä»¶</h3>
<p>å¦‚æœä½ æƒ³æ›´æ·±å…¥åœ°ç†è§£åŸç†ï¼Œå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„è™šæ‹Ÿæ»šåŠ¨ç»„ä»¶ï¼š</p>
<p>æˆ‘çš„æ•´ä½“æ€è·¯å¦‚ä¸‹ï¼šæ»šåŠ¨åŒºåŸŸæœ‰3ä¸ªéƒ¨åˆ†ç»„æˆï¼Œä¸Šæ–¹å ä½åŒºï¼Œæ˜¾ç¤ºçš„é¡¹ç›®ï¼Œä¸‹æ–¹å ä½åŒºã€‚æ¯æ¬¡æ»šåŠ¨ä¸éœ€è¦å»è®¡ç®—æ¯ä¸€ä¸ªå±•ç¤ºé¡¹ç›®çš„ä½ç½®ã€‚åªéœ€è¦è®¡ç®—ä¸Šä¸‹å ä½åŒºçš„é«˜åº¦ä¸æ˜¾ç¤ºçš„é¡¹ç›®ã€‚</p>
<p>åŸºäºè¿™ä¸ªæ€è·¯å†™å‡ºäº†åŸºæœ¬ä»£ç ï¼Œç„¶åè®©AIä¼˜åŒ–äº†ä»£ç ä¸å¤„ç†äº†è¾¹ç•Œå€¼ç›¸å…³çš„ä¸€äº›é—®é¢˜ã€‚</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"virtual-scroll-container"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"viewWrapRef"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"scroll-wrap"</span> <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: scrollContainerHeight + 'px' }"</span>&gt;</span>
      <span class="hljs-comment">&lt;!-- ä¸Šæ–¹å ä½åŒº --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"top-placeholder"</span>
        <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: topPlaceholderHeight + 'px' }"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- å†…å®¹åŒº --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content-container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">"item in displayItems"</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">"item.id"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"item"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">slot</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"item"</span> <span class="hljs-attr">:item</span>=<span class="hljs-string">"item"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">slot</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-comment">&lt;!-- ä¸‹æ–¹å ä½åŒº --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>
        <span class="hljs-attr">class</span>=<span class="hljs-string">"bottom-placeholder"</span>
        <span class="hljs-attr">:style</span>=<span class="hljs-string">"{ height: bottomPlaceholderHeight + 'px' }"</span>
      &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">setup</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"ts"</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> {
  ref,
  onMounted,
  onUnmounted,
  computed,
  nextTick,
  watch,
  withDefaults,
} <span class="hljs-keyword">from</span> <span class="hljs-string">"vue"</span>;

interface <span class="hljs-title class_">Props</span> {
  <span class="hljs-attr">items</span>: any[];
  <span class="hljs-attr">itemHeight</span>: number;
  overscan?: number; <span class="hljs-comment">// æ·»åŠ ç¼“å†²é¡¹ç›®æ•°é‡é…ç½®</span>
}

<span class="hljs-keyword">const</span> props = <span class="hljs-title function_">withDefaults</span>(defineProps&lt;<span class="hljs-title class_">Props</span>&gt;(), {
  <span class="hljs-attr">items</span>: <span class="hljs-function">() =&gt;</span> [],
  <span class="hljs-attr">itemHeight</span>: <span class="hljs-number">50</span>,
  <span class="hljs-attr">overscan</span>: <span class="hljs-number">5</span>, <span class="hljs-comment">// é»˜è®¤ä¸Šä¸‹å„ç¼“å†²5ä¸ªé¡¹ç›®</span>
});

<span class="hljs-keyword">const</span> viewWrapRef = ref&lt;<span class="hljs-title class_">HTMLElement</span> | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);
<span class="hljs-keyword">const</span> startIndex = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> animationId = ref&lt;number | <span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// æ·»åŠ å®¹å™¨é«˜åº¦å’Œæ»šåŠ¨ä½ç½®çš„çŠ¶æ€</span>
<span class="hljs-keyword">const</span> containerHeight = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);
<span class="hljs-keyword">const</span> scrollTop = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>);

<span class="hljs-keyword">const</span> scrollContainerHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">return</span> props.<span class="hljs-property">itemHeight</span> * props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>;
});

<span class="hljs-comment">// è®¡ç®—å¯è§é¡¹ç›®æ•°é‡ï¼ˆåŒ…å«ç¼“å†²ï¼‰</span>
<span class="hljs-keyword">const</span> visibleItemCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (containerHeight.<span class="hljs-property">value</span> &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">const</span> baseCount = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(containerHeight.<span class="hljs-property">value</span> / props.<span class="hljs-property">itemHeight</span>);
    <span class="hljs-keyword">return</span> baseCount + props.<span class="hljs-property">overscan</span> * <span class="hljs-number">2</span>; <span class="hljs-comment">// ä¸Šä¸‹éƒ½æ·»åŠ ç¼“å†²</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>; <span class="hljs-comment">// é»˜è®¤å€¼</span>
});

<span class="hljs-comment">// è®¡ç®—å®é™…æ˜¾ç¤ºçš„é¡¹ç›®ï¼ˆåŒ…å«ç¼“å†²ï¼‰</span>
<span class="hljs-keyword">const</span> displayItems = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!visibleItemCount.<span class="hljs-property">value</span> || props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> [];
  }

  <span class="hljs-comment">// è®¡ç®—èµ·å§‹ç´¢å¼•ï¼Œè€ƒè™‘ç¼“å†²</span>
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, startIndex.<span class="hljs-property">value</span> - props.<span class="hljs-property">overscan</span>);
  <span class="hljs-comment">// è®¡ç®—ç»“æŸç´¢å¼•ï¼Œç¡®ä¿ä¸è¶…å‡ºæ•°ç»„èŒƒå›´</span>
  <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
    props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>,
    startIndex.<span class="hljs-property">value</span> + visibleItemCount.<span class="hljs-property">value</span> + props.<span class="hljs-property">overscan</span>
  );

  <span class="hljs-keyword">return</span> props.<span class="hljs-property">items</span>.<span class="hljs-title function_">slice</span>(start, end);
});

<span class="hljs-comment">// è®¡ç®—ä¸Šæ–¹å ä½é«˜åº¦</span>
<span class="hljs-keyword">const</span> topPlaceholderHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, startIndex.<span class="hljs-property">value</span> - props.<span class="hljs-property">overscan</span>);
  <span class="hljs-keyword">return</span> start * props.<span class="hljs-property">itemHeight</span>;
});

<span class="hljs-comment">// è®¡ç®—ä¸‹æ–¹å ä½é«˜åº¦ï¼ˆç¡®ä¿ä¸ä¸ºè´Ÿæ•°ï¼‰</span>
<span class="hljs-keyword">const</span> bottomPlaceholderHeight = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (!visibleItemCount.<span class="hljs-property">value</span> || props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  }

  <span class="hljs-keyword">const</span> end = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(
    props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span>,
    startIndex.<span class="hljs-property">value</span> + visibleItemCount.<span class="hljs-property">value</span> + props.<span class="hljs-property">overscan</span>
  );

  <span class="hljs-keyword">const</span> bottomHeight = (props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - end) * props.<span class="hljs-property">itemHeight</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, bottomHeight); <span class="hljs-comment">// ç¡®ä¿ä¸ä¸ºè´Ÿæ•°</span>
});

<span class="hljs-comment">// ç›‘å¬å®¹å™¨å°ºå¯¸å˜åŒ–</span>
<span class="hljs-keyword">const</span> resizeObserver = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ResizeObserver</span>(<span class="hljs-function">(<span class="hljs-params">entries</span>) =&gt;</span> {
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> entries) {
    containerHeight.<span class="hljs-property">value</span> = entry.<span class="hljs-property">contentRect</span>.<span class="hljs-property">height</span>;
  }
});

<span class="hljs-title function_">onMounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      <span class="hljs-comment">// åˆå§‹åŒ–å®¹å™¨é«˜åº¦</span>
      containerHeight.<span class="hljs-property">value</span> = viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">clientHeight</span>;

      <span class="hljs-comment">// ç›‘å¬å®¹å™¨å°ºå¯¸å˜åŒ–</span>
      resizeObserver.<span class="hljs-title function_">observe</span>(viewWrapRef.<span class="hljs-property">value</span>);

      <span class="hljs-comment">// æ·»åŠ æ»šåŠ¨äº‹ä»¶ç›‘å¬</span>
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"scroll"</span>, handleScroll, {
        <span class="hljs-attr">passive</span>: <span class="hljs-literal">true</span>,
      });

      <span class="hljs-comment">// åˆå§‹è®¡ç®—ä¸€æ¬¡</span>
      <span class="hljs-title function_">updateStartIndex</span>();
    }
  });
});

<span class="hljs-title function_">onUnmounted</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
    viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"scroll"</span>, handleScroll);
    resizeObserver.<span class="hljs-title function_">unobserve</span>(viewWrapRef.<span class="hljs-property">value</span>);
  }

  <span class="hljs-keyword">if</span> (animationId.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">cancelAnimationFrame</span>(animationId.<span class="hljs-property">value</span>);
  }

  resizeObserver.<span class="hljs-title function_">disconnect</span>();
});

<span class="hljs-comment">// ç›´æ¥å¤„ç†æ»šåŠ¨ï¼Œä¸ä½¿ç”¨é˜²æŠ–ï¼ˆä¸ºäº†æ›´å¿«é€Ÿå“åº”ï¼‰</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleScroll</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (animationId.<span class="hljs-property">value</span>) {
    <span class="hljs-title function_">cancelAnimationFrame</span>(animationId.<span class="hljs-property">value</span>);
  }

  animationId.<span class="hljs-property">value</span> = <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">updateStartIndex</span>();
  });
};

<span class="hljs-comment">// æ›´æ–°èµ·å§‹ç´¢å¼•</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">updateStartIndex</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">if</span> (!viewWrapRef.<span class="hljs-property">value</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> currentScrollTop = viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span>;
  scrollTop.<span class="hljs-property">value</span> = currentScrollTop;

  <span class="hljs-comment">// è®¡ç®—æ–°çš„èµ·å§‹ç´¢å¼•</span>
  <span class="hljs-keyword">let</span> newStartIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(currentScrollTop / props.<span class="hljs-property">itemHeight</span>);

  <span class="hljs-comment">// ç¡®ä¿ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…</span>
  newStartIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, newStartIndex);
  newStartIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(newStartIndex, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>));

  <span class="hljs-comment">// åªæœ‰å½“ç´¢å¼•çœŸæ­£æ”¹å˜æ—¶æ‰æ›´æ–°</span>
  <span class="hljs-keyword">if</span> (newStartIndex !== startIndex.<span class="hljs-property">value</span>) {
    startIndex.<span class="hljs-property">value</span> = newStartIndex;
  }
};

<span class="hljs-comment">// ç›‘å¬itemså˜åŒ–ï¼Œé‡ç½®çŠ¶æ€</span>
<span class="hljs-title function_">watch</span>(
  <span class="hljs-function">() =&gt;</span> props.<span class="hljs-property">items</span>,
  <span class="hljs-function">(<span class="hljs-params">newItems</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (newItems.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
      startIndex.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// å¦‚æœæ»šåŠ¨ä½ç½®è¶…å‡ºäº†æ–°æ•°ç»„çš„èŒƒå›´ï¼Œè°ƒæ•´åˆ°æœ«å°¾</span>
      <span class="hljs-keyword">if</span> (startIndex.<span class="hljs-property">value</span> &gt;= newItems.<span class="hljs-property">length</span>) {
        startIndex.<span class="hljs-property">value</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, newItems.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);

        <span class="hljs-comment">// æ»šåŠ¨åˆ°æ­£ç¡®ä½ç½®</span>
        <span class="hljs-title function_">nextTick</span>(<span class="hljs-function">() =&gt;</span> {
          <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
            viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = startIndex.<span class="hljs-property">value</span> * props.<span class="hljs-property">itemHeight</span>;
          }
        });
      }
    }
  }
);

<span class="hljs-comment">// æš´éœ²æ–¹æ³•ç»™çˆ¶ç»„ä»¶</span>
<span class="hljs-title function_">defineExpose</span>({
  <span class="hljs-attr">scrollToIndex</span>: <span class="hljs-function">(<span class="hljs-params">index: number</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">const</span> targetIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(index, props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>));
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = targetIndex * props.<span class="hljs-property">itemHeight</span>;
      startIndex.<span class="hljs-property">value</span> = targetIndex;
    }
  },
  <span class="hljs-attr">scrollToTop</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = <span class="hljs-number">0</span>;
      startIndex.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>;
    }
  },
  <span class="hljs-attr">scrollToBottom</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (viewWrapRef.<span class="hljs-property">value</span>) {
      <span class="hljs-keyword">const</span> targetIndex = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-number">0</span>, props.<span class="hljs-property">items</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);
      viewWrapRef.<span class="hljs-property">value</span>.<span class="hljs-property">scrollTop</span> = targetIndex * props.<span class="hljs-property">itemHeight</span>;
      startIndex.<span class="hljs-property">value</span> = targetIndex;
    }
  },
});
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">style</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"scss"</span> <span class="hljs-attr">scoped</span>&gt;</span><span class="css">
<span class="hljs-selector-class">.virtual-scroll-container</span> {
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">overflow</span>: auto;

  <span class="hljs-selector-class">.scroll-wrap</span> {
    <span class="hljs-attribute">position</span>: relative;
  }

  <span class="hljs-selector-class">.top-placeholder</span>,
  <span class="hljs-selector-class">.bottom-placeholder</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }

  <span class="hljs-selector-class">.content-container</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜ã€è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰ã€‘]]></title>    <link>https://juejin.cn/post/7579179741825040410</link>    <guid>https://juejin.cn/post/7579179741825040410</guid>    <pubDate>2025-12-03T06:29:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579179741825040410" data-draft-id="7579255046978863130" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜ã€è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰ã€‘"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:29:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ"/> <meta itemprop="url" content="https://juejin.cn/user/808832912075352"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜ã€è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰ã€‘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/808832912075352/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å“ˆå“ˆå“ˆç¬‘ä»€ä¹ˆ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:29:33.000Z" title="Wed Dec 03 2025 06:29:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»21åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸‹é¢æˆ‘ä¼šå…ˆ <strong>å…¨é¢æ‹†è§£ç¦»çº¿â†’åŒæ­¥çš„10å¤§æ ¸å¿ƒé—®é¢˜</strong>ï¼ˆå«å…·ä½“è¡¨ç°+æ ¹æœ¬åŸå› ï¼‰ï¼Œå†ç»™å‡º <strong>å¯è½åœ°çš„å®Œæ•´æ–¹æ¡ˆï¼ˆæ€è·¯+æ¶æ„+ä»£ç ï¼‰</strong>ï¼Œæœ€åé€šè¿‡æµ‹è¯•åœºæ™¯éªŒè¯æ–¹æ¡ˆæœ‰æ•ˆæ€§ã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ç¦»çº¿ä¸‹å•â†’è”ç½‘åŒæ­¥çš„æ ¸å¿ƒé—®é¢˜æ¸…å•ï¼ˆæŒ‰å‘ç”Ÿæ¦‚ç‡æ’åºï¼‰</h2>




























































<table><thead><tr><th>é—®é¢˜ç±»å‹</th><th>å…·ä½“è¡¨ç°</th><th>æ ¹æœ¬åŸå› </th></tr></thead><tbody><tr><td>1. ç¦»çº¿è®¢å•æœ¬åœ°ä¸¢å¤±</td><td>è®¾å¤‡ç¦»çº¿ä¸‹å•åï¼Œçªç„¶æ–­ç”µ/ç³»ç»Ÿå´©æºƒ/å­˜å‚¨ä»‹è´¨æŸåï¼ˆå¦‚SDå¡åï¼‰ï¼Œè®¢å•æ¶ˆå¤±ã€‚</td><td>æœ¬åœ°æœªåšå¯é æŒä¹…åŒ–ï¼›æ— å¤‡ä»½æœºåˆ¶ï¼›è®¢å•å­˜å‚¨æ— äº‹åŠ¡ä¿éšœã€‚</td></tr><tr><td>2. åŒæ­¥æ—¶ç½‘ç»œå†æ¬¡ä¸­æ–­</td><td>è®¾å¤‡è”ç½‘åå¼€å§‹åŒæ­¥ï¼ŒåŒæ­¥è¿‡ç¨‹ä¸­ç½‘ç»œåˆæ–­ï¼Œå¯¼è‡´éƒ¨åˆ†è®¢å•æœªåŒæ­¥/åŒæ­¥ä¸€åŠã€‚</td><td>æ— æ–­ç‚¹ç»­ä¼ æœºåˆ¶ï¼›åŒæ­¥çŠ¶æ€æœªç²¾ç»†è®°å½•ï¼›æœªæ ‡è®°â€œå·²åŒæ­¥è®¢å•IDâ€ã€‚</td></tr><tr><td>3. å¤šè®¢å•åŒæ­¥é¡ºåºé”™ä¹±</td><td>è®¾å¤‡ç¦»çº¿æ—¶ç”Ÿæˆè®¢å•Aï¼ˆå…ˆä¸‹ï¼‰ã€è®¢å•Bï¼ˆåä¸‹ï¼‰ï¼ŒåŒæ­¥æ—¶å› ç½‘ç»œå»¶è¿Ÿï¼Œäº‘ç«¯å…ˆæ”¶åˆ°Båæ”¶åˆ°Aï¼Œå¯¼è‡´åº“å­˜æ‰£å‡é¡ºåºé”™è¯¯ï¼ˆè¶…å–ï¼‰ã€‚</td><td>è®¾å¤‡ç«¯æœªæŒ‰æ—¶é—´å‡åºåŒæ­¥ï¼›äº‘ç«¯æ— æœ‰åºæ¥æ”¶/æ¶ˆè´¹æœºåˆ¶ï¼›ç¼ºä¹å…¨å±€é¡ºåºæ§åˆ¶ã€‚</td></tr><tr><td>4. åŒæ­¥è®¢å•ä¸äº‘ç«¯å†²çª</td><td>è®¾å¤‡ç¦»çº¿æ—¶ä¸‹å•å•†å“Xï¼ŒåŒæ­¥æ—¶äº‘ç«¯å•†å“Xå·²è¢«çº¿ä¸Šå°ç¨‹åºä¹°å®Œï¼ˆåº“å­˜ä¸è¶³ï¼‰ï¼›æˆ–å•†å“Xå·²ä¸‹æ¶/ä»·æ ¼å˜æ›´ã€‚</td><td>ç¦»çº¿æ—¶ç”¨æœ¬åœ°åº“å­˜å¿«ç…§ï¼›åŒæ­¥æ—¶æœªæ ¡éªŒäº‘ç«¯æœ€æ–°æ•°æ®ï¼›æ— å†²çªè‡ªåŠ¨å¤„ç†æœºåˆ¶ã€‚</td></tr><tr><td>5. è®¢å•é‡å¤åŒæ­¥</td><td>è®¾å¤‡åŒæ­¥æˆåŠŸä½†æœªæ”¶åˆ°äº‘ç«¯ç¡®è®¤ï¼Œé‡å¯åå†æ¬¡åŒæ­¥ï¼›ç½‘ç»œå»¶è¿Ÿå¯¼è‡´è®¾å¤‡é‡è¯•ï¼Œäº‘ç«¯æ”¶åˆ°é‡å¤è¯·æ±‚ã€‚</td><td>æ— å…¨å±€å”¯ä¸€è®¢å•IDå»é‡ï¼›åŒæ­¥ç¡®è®¤æœºåˆ¶ä¸å®Œå–„ï¼›æœªè®°å½•å·²åŒæ­¥è®¢å•æ ‡è¯†ã€‚</td></tr><tr><td>6. åŒæ­¥å¤±è´¥æ— é‡è¯•æœºåˆ¶</td><td>å› äº‘ç«¯ä¸´æ—¶æ•…éšœï¼ˆå¦‚æœåŠ¡å®•æœºï¼‰å¯¼è‡´åŒæ­¥å¤±è´¥ï¼Œè®¾å¤‡æœªä¸»åŠ¨é‡è¯•ï¼Œè®¢å•é•¿æœŸç§¯å‹ã€‚</td><td>æ— é‡è¯•ç­–ç•¥ï¼›æœªè®¾ç½®é‡è¯•æ¬¡æ•°/é—´éš”ï¼›å¤±è´¥åæ— å‘Šè­¦æœºåˆ¶ã€‚</td></tr><tr><td>7. åŒæ­¥åè®¾å¤‡çŠ¶æ€æœªæ›´æ–°</td><td>äº‘ç«¯å·²æˆåŠŸå¤„ç†è®¢å•ï¼Œä½†è®¾å¤‡æœªæ”¶åˆ°ç¡®è®¤ï¼Œæœ¬åœ°ä»æ˜¾ç¤ºâ€œå¾…åŒæ­¥â€ï¼Œå¯¼è‡´é‡å¤åŒæ­¥ã€‚</td><td>åŒæ­¥ç¡®è®¤é“¾è·¯ä¸å¯é ï¼›è®¾å¤‡æœªæŒä¹…åŒ–åŒæ­¥ç»“æœï¼›æ— å›è°ƒé‡è¯•æœºåˆ¶ã€‚</td></tr><tr><td>8. æ‰¹é‡åŒæ­¥æ•ˆç‡ä½ä¸‹</td><td>è®¾å¤‡ç¦»çº¿æ—¶ç”Ÿæˆå¤§é‡è®¢å•ï¼ˆå¦‚100æ¡ï¼‰ï¼Œè”ç½‘åé€æ¡åŒæ­¥ï¼Œè€—æ—¶ä¹…ã€å ç½‘ç»œå¸¦å®½ã€‚</td><td>æœªåšæ‰¹é‡åŒæ­¥ä¼˜åŒ–ï¼›æ— æ–­ç‚¹ç»­ä¼ ï¼Œæ–­ç½‘åéœ€é‡æ–°åŒæ­¥å…¨é‡ã€‚</td></tr><tr><td>9. è®¾å¤‡æ—¶é—´é”™ä¹±å¯¼è‡´åŒæ­¥å¤±è´¥</td><td>è®¾å¤‡æœ¬åœ°æ—¶é—´æ…¢10åˆ†é’Ÿï¼Œç¦»çº¿ä¸‹å•æ—¶é—´æ—©äºäº‘ç«¯å•†å“ä¸Šæ¶æ—¶é—´ï¼ŒåŒæ­¥æ—¶è¢«æ‹’ç»ã€‚</td><td>è®¾å¤‡æœªå®šæ—¶æ ¡å‡†æ—¶é—´ï¼›è®¢å•æ—¶é—´ä»¥æœ¬åœ°ä¸ºå‡†ï¼Œæœªç”¨äº‘ç«¯æ—¶é—´æ ¡å‡†ã€‚</td></tr><tr><td>10. åŒæ­¥æ—¥å¿—ç¼ºå¤±å¯¼è‡´æ’æŸ¥å›°éš¾</td><td>åŒæ­¥å¤±è´¥åï¼Œæ— æ³•è¿½æº¯æ˜¯è®¾å¤‡ç«¯æœªå‘é€ã€äº‘ç«¯æœªæ¥æ”¶ï¼Œè¿˜æ˜¯å¤„ç†å¤±è´¥ã€‚</td><td>æ— å®Œæ•´åŒæ­¥æ—¥å¿—ï¼›æœªè®°å½•è®¢å•åŒæ­¥å…¨é“¾è·¯çŠ¶æ€ï¼ˆå‘é€/æ¥æ”¶/å¤„ç†/ç¡®è®¤ï¼‰ã€‚</td></tr></tbody></table>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒè§£å†³æ€è·¯ä¸æ•´ä½“æ–¹æ¡ˆæ¶æ„</h2>
<h3 data-id="heading-2">1. æ ¸å¿ƒè§£å†³æ€è·¯ï¼ˆ5å¤§åŸåˆ™ï¼‰</h3>
<ul>
<li><strong>æœ¬åœ°å¯é å­˜å‚¨</strong>ï¼šç¦»çº¿è®¢å•å¿…é¡»æŒä¹…åŒ–+äº‹åŠ¡+å¤‡ä»½ï¼Œæœç»è®¾å¤‡æ•…éšœå¯¼è‡´ä¸¢å¤±ï¼›</li>
<li><strong>å¯é åŒæ­¥æœºåˆ¶</strong>ï¼šæ‰¹é‡æœ‰åºåŒæ­¥+æ–­ç‚¹ç»­ä¼ +æŒ‡æ•°é€€é¿é‡è¯•ï¼Œåº”å¯¹ç½‘ç»œæ³¢åŠ¨ï¼›</li>
<li><strong>äº‘ç«¯ä¸¥æ ¼æ ¡éªŒ</strong>ï¼šåŒæ­¥æ—¶æ ¡éªŒåº“å­˜ã€å•†å“çŠ¶æ€ã€è®¢å•å”¯ä¸€æ€§ï¼Œæ‹’ç»éæ³•è®¢å•ï¼›</li>
<li><strong>å†²çªè‡ªåŠ¨å¤„ç†</strong>ï¼šç”¨ä¹è§‚é”ã€çŠ¶æ€æœºè§£å†³åº“å­˜/è®¢å•çŠ¶æ€å†²çªï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼›</li>
<li><strong>å®¹é”™å…œåº•</strong>ï¼šæ­»ä¿¡é˜Ÿåˆ—+åŒæ­¥æ—¥å¿—+å‘Šè­¦æœºåˆ¶ï¼Œç¡®ä¿æç«¯æƒ…å†µå¯è¿½æº¯ã€å¯æ¢å¤ã€‚</li>
</ul>
<h3 data-id="heading-3">2. æ•´ä½“æ¶æ„ï¼ˆè®¾å¤‡ç«¯+äº‘ç«¯ï¼‰</h3>























































<table><thead><tr><th>è§’è‰²</th><th>æ ¸å¿ƒç»„ä»¶</th><th>æ ¸å¿ƒèŒè´£</th></tr></thead><tbody><tr><td>è®¾å¤‡ç«¯</td><td>SQLiteï¼ˆåµŒå…¥å¼æ•°æ®åº“ï¼‰</td><td>ç¦»çº¿è®¢å•æŒä¹…åŒ–ï¼ˆå«åŒæ­¥çŠ¶æ€ï¼‰ã€æœ¬åœ°åº“å­˜å¿«ç…§</td></tr><tr><td>è®¾å¤‡ç«¯</td><td>ç½‘ç»œæ£€æµ‹æ¨¡å—</td><td>å®æ—¶æ£€æµ‹ç½‘ç»œçŠ¶æ€ï¼Œè”ç½‘åè§¦å‘åŒæ­¥</td></tr><tr><td>è®¾å¤‡ç«¯</td><td>åŒæ­¥å®¢æˆ·ç«¯</td><td>æ‰¹é‡æœ‰åºåŒæ­¥ã€æ–­ç‚¹ç»­ä¼ ã€æŒ‡æ•°é€€é¿é‡è¯•</td></tr><tr><td>äº‘ç«¯æ¥å…¥å±‚</td><td>Spring Cloud Gateway</td><td>è´Ÿè½½å‡è¡¡ã€é™æµã€æ¥æ”¶è®¾å¤‡åŒæ­¥è¯·æ±‚</td></tr><tr><td>äº‘ç«¯æ¶ˆæ¯å±‚</td><td>RabbitMQï¼ˆå•é˜Ÿåˆ—ï¼‰</td><td>æŒä¹…åŒ–åŒæ­¥æ¶ˆæ¯ã€ä¿è¯æ¶ˆè´¹é¡ºåº</td></tr><tr><td>äº‘ç«¯ç¼“å­˜å±‚</td><td>Redis</td><td>è®¢å•å»é‡ã€åˆ†å¸ƒå¼é”ã€åŒæ­¥çŠ¶æ€è®°å½•</td></tr><tr><td>äº‘ç«¯ä¸šåŠ¡å±‚</td><td>Spring Boot + Spring Cloud Stream</td><td>è®¢å•åŒæ­¥å¤„ç†ã€å†²çªè§£å†³ã€åº“å­˜æ‰£å‡</td></tr><tr><td>äº‘ç«¯å­˜å‚¨å±‚</td><td>MySQLï¼ˆInnoDBï¼‰</td><td>è®¢å•ã€åº“å­˜æŒä¹…åŒ–ï¼Œä¹è§‚é”ä¿éšœæ•°æ®ä¸€è‡´æ€§</td></tr><tr><td>ç›‘æ§å‘Šè­¦å±‚</td><td>Spring Boot Actuator + æ—¥å¿—</td><td>åŒæ­¥çŠ¶æ€ç›‘æ§ã€å¤±è´¥å‘Šè­¦ã€é“¾è·¯è¿½æº¯</td></tr></tbody></table>
<h3 data-id="heading-4">3. å®Œæ•´æµç¨‹ï¼ˆç¦»çº¿ä¸‹å•â†’è”ç½‘åŒæ­¥ï¼‰</h3>
<pre><code class="hljs language-css" lang="css">graph <span class="hljs-selector-tag">TD</span>
    %% ç¦»çº¿é˜¶æ®µ
    <span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[ç”¨æˆ·åœ¨è®¾å¤‡ç¦»çº¿ä¸‹å•]</span> --&gt; <span class="hljs-selector-tag">B</span>{è®¾å¤‡æœ¬åœ°æ ¡éªŒ}
    <span class="hljs-selector-tag">B</span> --&gt;|<span class="hljs-number">1</span>. æœ¬åœ°åº“å­˜å¿«ç…§å……è¶³| C<span class="hljs-selector-attr">[æœ¬åœ°äº‹åŠ¡ï¼šSQLiteåˆ›å»ºè®¢å•+é¢„å æœ¬åœ°åº“å­˜]</span>
    C --&gt; D<span class="hljs-selector-attr">[è®¢å•çŠ¶æ€æ ‡è®°ä¸ºã€Œå¾…åŒæ­¥ã€ï¼Œè®°å½•sync_status=PENDINGã€sync_retry_count=0]</span>
    <span class="hljs-selector-tag">B</span> --&gt;|æœ¬åœ°åº“å­˜ä¸è¶³| E<span class="hljs-selector-attr">[æç¤ºç”¨æˆ·â€œåº“å­˜ä¸è¶³ï¼Œæ— æ³•ä¸‹å•â€]</span>
    
    %% è”ç½‘åŒæ­¥é˜¶æ®µ
    F<span class="hljs-selector-attr">[è®¾å¤‡æ£€æµ‹åˆ°ç½‘ç»œæ¢å¤]</span> --&gt; G<span class="hljs-selector-attr">[æŸ¥è¯¢æœ¬åœ°ã€Œå¾…åŒæ­¥ã€æˆ–ã€ŒåŒæ­¥å¤±è´¥ï¼ˆé‡è¯•&lt;5æ¬¡ï¼‰ã€çš„è®¢å•]</span>
    G --&gt; H<span class="hljs-selector-attr">[æŒ‰create_timeå‡åºæ’åºï¼ˆä¿è¯åŒæ­¥é¡ºåºï¼‰]</span>
    H --&gt; <span class="hljs-selector-tag">I</span><span class="hljs-selector-attr">[æ‰¹é‡æ‰“åŒ…è®¢å•ï¼ˆ10æ¡/æ‰¹ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼‰]</span>
    <span class="hljs-selector-tag">I</span> --&gt; J<span class="hljs-selector-attr">[å‘é€åŒæ­¥è¯·æ±‚åˆ°äº‘ç«¯ï¼ˆå¸¦last_sync_order_idï¼Œå³ä¸Šä¸€æ‰¹åŒæ­¥æˆåŠŸçš„æœ€åä¸€ä¸ªè®¢å•IDï¼‰]</span>
    
    %% äº‘ç«¯æ¥æ”¶ä¸é¢„å¤„ç†
    K<span class="hljs-selector-attr">[äº‘ç«¯Gatewayé™æµæ ¡éªŒ]</span> --&gt; L<span class="hljs-selector-attr">[åŒæ­¥æ¥æ”¶æœåŠ¡]</span>
    L --&gt; M<span class="hljs-selector-attr">[Rediså»é‡æ ¡éªŒï¼ˆæŒ‰order_idï¼‰]</span>
    M --&gt;|å·²åŒæ­¥| N<span class="hljs-selector-attr">[è¿”å›ã€Œå·²åŒæ­¥ã€ç¡®è®¤ï¼Œè·³è¿‡å¤„ç†]</span>
    M --&gt;|æœªåŒæ­¥| O<span class="hljs-selector-attr">[å‘é€åˆ°RabbitMQå•é˜Ÿåˆ—ï¼ˆæ¶ˆæ¯æŒä¹…åŒ–ï¼‰]</span>
    
    %% äº‘ç«¯ä¸šåŠ¡å¤„ç†
    O --&gt; <span class="hljs-selector-tag">P</span><span class="hljs-selector-attr">[Spring Cloud Streamå•çº¿ç¨‹æ¶ˆè´¹ï¼ˆä¿è¯é¡ºåºï¼‰]</span>
    <span class="hljs-selector-tag">P</span> --&gt; <span class="hljs-selector-tag">Q</span><span class="hljs-selector-attr">[Redisåˆ†å¸ƒå¼é”ï¼šé”å®šå•†å“ID+è®¢å•IDï¼Œé˜²æ­¢å¹¶å‘å†²çª]</span>
    <span class="hljs-selector-tag">Q</span> --&gt; R<span class="hljs-selector-attr">[äº‘ç«¯æ ¡éªŒï¼š1. å•†å“æ˜¯å¦ä¸Šæ¶ 2. äº‘ç«¯åº“å­˜æ˜¯å¦å……è¶³ 3. è®¢å•çŠ¶æ€æ˜¯å¦åˆæ³•]</span>
    R --&gt;|æ ¡éªŒå¤±è´¥| S<span class="hljs-selector-attr">[è¿”å›ã€ŒåŒæ­¥å¤±è´¥ã€+ åŸå› ï¼ˆå¦‚åº“å­˜ä¸è¶³ï¼‰]</span>
    R --&gt;|æ ¡éªŒæˆåŠŸ| T<span class="hljs-selector-attr">[ä¹è§‚é”æ‰£å‡äº‘ç«¯åº“å­˜+åˆ›å»ºäº‘ç«¯è®¢å•]</span>
    T --&gt; U<span class="hljs-selector-attr">[Redisæ ‡è®°è®¢å•ã€Œå·²åŒæ­¥ã€ï¼Œæœ‰æ•ˆæœŸ24å°æ—¶]</span>
    U --&gt; V<span class="hljs-selector-attr">[è¿”å›ã€ŒåŒæ­¥æˆåŠŸã€+ äº‘ç«¯è®¢å•çŠ¶æ€]</span>
    
    %% è®¾å¤‡ç«¯åç»­å¤„ç†
    V --&gt; W<span class="hljs-selector-attr">[è®¾å¤‡æ¥æ”¶åŒæ­¥ç»“æœ]</span>
    W --&gt; X<span class="hljs-selector-attr">[æ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€ï¼šåŒæ­¥æˆåŠŸâ†’SUCCESSï¼Œå¤±è´¥â†’FAILED+é‡è¯•æ¬¡æ•°+å¤±è´¥åŸå› ]</span>
    X --&gt; Y<span class="hljs-selector-attr">[è‹¥æ‰¹é‡åŒæ­¥éƒ¨åˆ†æˆåŠŸï¼Œè®°å½•last_sync_order_idï¼Œä¸‹æ¬¡ä»è¯¥IDåç»§ç»­åŒæ­¥]</span>
    S --&gt; Z<span class="hljs-selector-attr">[è®¾å¤‡è§¦å‘æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ10sâ†’30sâ†’1minâ†’5minâ†’10minï¼‰]</span>
    Z --&gt;|é‡è¯•<span class="hljs-number">5</span>æ¬¡å¤±è´¥| AA<span class="hljs-selector-attr">[æ ‡è®°ä¸ºã€ŒåŒæ­¥å¼‚å¸¸ã€ï¼Œè®¾å¤‡æŒ‡ç¤ºç¯å‘Šè­¦+ä¸ŠæŠ¥äº‘ç«¯]</span>
</code></pre>
<h2 data-id="heading-5">ä¸‰ã€å®Œæ•´æ–¹æ¡ˆå®ç°ï¼ˆä»£ç +å…³é”®è¯´æ˜ï¼‰</h2>
<h3 data-id="heading-6">å‰ç½®å‡†å¤‡</h3>
<ul>
<li>è®¾å¤‡ç«¯ï¼šJava SEç¯å¢ƒï¼ˆåµŒå…¥å¼è®¾å¤‡é€‚é…ï¼‰ã€SQLiteæ•°æ®åº“ï¼ˆè½»é‡çº§ã€æ”¯æŒäº‹åŠ¡ï¼‰ï¼›</li>
<li>äº‘ç«¯ï¼šSpring Boot 2.7.xã€Spring Cloud Streamã€RabbitMQã€Redisã€MySQLï¼›</li>
<li>ä¾èµ–ï¼šè®¾å¤‡ç«¯éœ€å¼•å…¥sqlite-jdbcã€fastjsonã€httpclientï¼›äº‘ç«¯ä¾èµ–è§pom.xmlï¼ˆåç»­ç»™å‡ºï¼‰ã€‚</li>
</ul>
<h3 data-id="heading-7">ç¬¬ä¸€éƒ¨åˆ†ï¼šè®¾å¤‡ç«¯æ ¸å¿ƒä»£ç ï¼ˆç¦»çº¿ä¸‹å•+è”ç½‘åŒæ­¥ï¼‰</h3>
<h4 data-id="heading-8">1. è®¾å¤‡ç«¯æœ¬åœ°æ•°æ®åº“è®¾è®¡ï¼ˆSQLiteï¼‰</h4>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è®¢å•è¡¨ï¼ˆæ ¸å¿ƒï¼šè®°å½•åŒæ­¥çŠ¶æ€ã€é‡è¯•æ¬¡æ•°ã€å¤±è´¥åŸå› ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> device_order (
    order_id TEXT <span class="hljs-keyword">PRIMARY</span> KEY, <span class="hljs-comment">-- å…¨å±€å”¯ä¸€è®¢å•IDï¼ˆè®¾å¤‡ID+é›ªèŠ±ç®—æ³•ï¼‰</span>
    device_id TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- è®¾å¤‡å”¯ä¸€æ ‡è¯†ï¼ˆå‡ºå‚é¢„ç½®ï¼‰</span>
    user_id TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- ä¸‹å•ç”¨æˆ·IDï¼ˆè®¾å¤‡ç«¯é‡‡é›†ï¼Œå¦‚æ‰‹æœºå·/ä¼šå‘˜IDï¼‰</span>
    product_id TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- å•†å“ID</span>
    quantity <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- è´­ä¹°æ•°é‡</span>
    amount <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- è®¢å•é‡‘é¢ï¼ˆç¦»çº¿æ—¶çš„å•†å“ä»·æ ¼ï¼‰</span>
    create_time TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- ç¦»çº¿ä¸‹å•æ—¶é—´ï¼ˆè®¾å¤‡æœ¬åœ°æ—¶é—´ï¼Œæ ¼å¼ï¼šISO8601ï¼‰</span>
    sync_status TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">'PENDING'</span>, <span class="hljs-comment">-- åŒæ­¥çŠ¶æ€ï¼šPENDING/ING/SUCCESS/FAILED/EXCEPTION</span>
    sync_retry_count <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- åŒæ­¥é‡è¯•æ¬¡æ•°</span>
    sync_fail_reason TEXT, <span class="hljs-comment">-- åŒæ­¥å¤±è´¥åŸå› </span>
    last_sync_time TEXT, <span class="hljs-comment">-- æœ€åä¸€æ¬¡åŒæ­¥æ—¶é—´</span>
    last_sync_order_id TEXT, <span class="hljs-comment">-- ä¸Šä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ ç”¨ï¼‰</span>
    update_time TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-comment">-- è®¢å•æ›´æ–°æ—¶é—´</span>
);

<span class="hljs-comment">-- æœ¬åœ°å•†å“åº“å­˜å¿«ç…§è¡¨ï¼ˆç¦»çº¿æ—¶ç”¨ï¼Œè”ç½‘ååŒæ­¥äº‘ç«¯æœ€æ–°æ•°æ®ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> device_product_stock (
    product_id TEXT <span class="hljs-keyword">PRIMARY</span> KEY,
    product_name TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    price <span class="hljs-type">DECIMAL</span>(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,
    available_stock <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- å¯ç”¨åº“å­˜ï¼ˆå¿«ç…§ï¼‰</span>
    locked_stock <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span>, <span class="hljs-comment">-- é¢„å åº“å­˜ï¼ˆç¦»çº¿ä¸‹å•æ—¶æ‰£å‡ï¼‰</span>
    sync_time TEXT <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>, <span class="hljs-comment">-- æœ€åä¸€æ¬¡åŒæ­¥äº‘ç«¯æ•°æ®çš„æ—¶é—´</span>
    version <span class="hljs-type">INTEGER</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> <span class="hljs-comment">-- ç‰ˆæœ¬å·ï¼ˆåŒæ­¥æ—¶æ ¡éªŒç”¨ï¼‰</span>
);

<span class="hljs-comment">-- è®¢å•å¤‡ä»½è¡¨ï¼ˆé˜²æ­¢ä¸»è¡¨æŸåï¼Œå®šæ—¶åŒæ­¥ä¸»è¡¨æ•°æ®ï¼‰</span>
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> device_order_backup (
    <span class="hljs-keyword">LIKE</span> device_order INCLUDING <span class="hljs-keyword">ALL</span>
);
</code></pre>
<h4 data-id="heading-9">2. è®¾å¤‡ç«¯æ ¸å¿ƒå·¥å…·ç±»ï¼ˆè®¢å•IDç”Ÿæˆ+æ—¶é—´æ ¡å‡†ï¼‰</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * è®¾å¤‡ç«¯å…¨å±€å”¯ä¸€è®¢å•IDç”Ÿæˆå™¨ï¼ˆé¿å…é‡å¤ï¼‰
 * æ ¼å¼ï¼šè®¾å¤‡ID_é›ªèŠ±ç®—æ³•IDï¼ˆå¦‚ï¼šDEV001_1735689600000_001ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeviceOrderIdGenerator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> deviceId; <span class="hljs-comment">// è®¾å¤‡å”¯ä¸€IDï¼ˆå‡ºå‚é¢„ç½®ï¼Œå¦‚DEV001ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Snowflake snowflake;

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DeviceOrderIdGenerator</span><span class="hljs-params">(<span class="hljs-type">String</span> deviceId)</span> </span>{
        <span class="hljs-keyword">this</span>.deviceId = deviceId;
        <span class="hljs-comment">// é›ªèŠ±ç®—æ³•ï¼šå·¥ä½œID=è®¾å¤‡IDå“ˆå¸Œåå–æ¨¡32ï¼Œæ•°æ®ä¸­å¿ƒID=1</span>
        <span class="hljs-type">int</span> workerId = Math.<span class="hljs-built_in">abs</span>(deviceId.<span class="hljs-built_in">hashCode</span>()) % <span class="hljs-number">32</span>;
        <span class="hljs-keyword">this</span>.snowflake = IdUtil.<span class="hljs-built_in">createSnowflake</span>(<span class="hljs-number">1</span>, workerId);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">String</span> <span class="hljs-title">generateOrderId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> deviceId + <span class="hljs-string">"_"</span> + snowflake.<span class="hljs-built_in">nextIdStr</span>();
    }
}

<span class="hljs-comment">/**
 * è®¾å¤‡æ—¶é—´æ ¡å‡†å·¥å…·ï¼ˆé¿å…æœ¬åœ°æ—¶é—´é”™ä¹±ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DeviceTimeCalibrator</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> CLOUD_TIME_URL = <span class="hljs-string">"http://localhost:8080/api/common/cloud-time"</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-type">static</span> <span class="hljs-type">long</span> timeOffset = <span class="hljs-number">0</span>; <span class="hljs-comment">// æœ¬åœ°æ—¶é—´ä¸äº‘ç«¯æ—¶é—´çš„åç§»é‡ï¼ˆmsï¼‰</span>

    <span class="hljs-comment">// å®šæ—¶æ ¡å‡†æ—¶é—´ï¼ˆæ¯1å°æ—¶æ ¡å‡†ä¸€æ¬¡ï¼Œè”ç½‘åç«‹å³æ ¡å‡†ï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">void</span> <span class="hljs-title">scheduleCalibrate</span><span class="hljs-params">()</span> </span>{
        ScheduledExecutorService executor = Executors.<span class="hljs-built_in">newSingleThreadScheduledExecutor</span>();
        executor.<span class="hljs-built_in">scheduleAtFixedRate</span>(<span class="hljs-keyword">this</span>::calibrate, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, TimeUnit.HOURS);
    }

    <span class="hljs-comment">// æ ¡å‡†æ—¶é—´ï¼šä»äº‘ç«¯è·å–å½“å‰æ—¶é—´ï¼Œè®¡ç®—åç§»é‡</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-type">void</span> <span class="hljs-title">calibrate</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!NetworkUtils.<span class="hljs-built_in">isNetworkAvailable</span>()) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">try</span> {
            RestTemplate restTemplate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RestTemplate</span>();
            <span class="hljs-type">String</span> cloudTimeStr = restTemplate.<span class="hljs-built_in">getForObject</span>(CLOUD_TIME_URL, <span class="hljs-type">String</span>.<span class="hljs-keyword">class</span>);
            LocalDateTime cloudTime = LocalDateTime.<span class="hljs-built_in">parse</span>(cloudTimeStr);
            LocalDateTime localTime = LocalDateTime.<span class="hljs-built_in">now</span>();
            <span class="hljs-comment">// è®¡ç®—åç§»é‡ï¼šäº‘ç«¯æ—¶é—´ - æœ¬åœ°æ—¶é—´ï¼ˆmsï¼‰</span>
            timeOffset = Duration.<span class="hljs-built_in">between</span>(localTime, cloudTime).<span class="hljs-built_in">toMillis</span>();
            System.out.<span class="hljs-built_in">println</span>(<span class="hljs-string">"æ—¶é—´æ ¡å‡†å®Œæˆï¼Œåç§»é‡ï¼š"</span> + timeOffset + <span class="hljs-string">"ms"</span>);
        } <span class="hljs-built_in">catch</span> (Exception e) {
            System.err.<span class="hljs-built_in">println</span>(<span class="hljs-string">"æ—¶é—´æ ¡å‡†å¤±è´¥ï¼š"</span> + e.<span class="hljs-built_in">getMessage</span>());
        }
    }

    <span class="hljs-comment">// è·å–æ ¡å‡†åçš„æ—¶é—´ï¼ˆç”¨äºè®¢å•åˆ›å»ºæ—¶é—´ï¼Œå‡å°‘æ—¶é—´å†²çªï¼‰</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> LocalDateTime <span class="hljs-title">getCalibratedTime</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> LocalDateTime.<span class="hljs-built_in">now</span>().<span class="hljs-built_in">plusMillis</span>(timeOffset);
    }
}

<span class="hljs-comment">/**
 * ç½‘ç»œå·¥å…·ç±»ï¼ˆæ£€æµ‹ç½‘ç»œæ˜¯å¦å¯ç”¨ï¼‰
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkUtils</span> {
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-type">boolean</span> <span class="hljs-title">isNetworkAvailable</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// pingäº‘ç«¯åœ°å€ï¼Œ3ç§’è¶…æ—¶</span>
            <span class="hljs-keyword">return</span> InetAddress.<span class="hljs-built_in">getByName</span>(<span class="hljs-string">"api.cloud-service.com"</span>).<span class="hljs-built_in">isReachable</span>(<span class="hljs-number">3000</span>);
        } <span class="hljs-built_in">catch</span> (IOException e) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-10">3. è®¾å¤‡ç«¯ç¦»çº¿ä¸‹å•æ ¸å¿ƒé€»è¾‘</h4>
<pre><code class="hljs language-ini" lang="ini">/**
 * è®¾å¤‡ç«¯ç¦»çº¿è®¢å•æœåŠ¡ï¼ˆæ ¸å¿ƒï¼šæœ¬åœ°äº‹åŠ¡+åº“å­˜é¢„å ï¼‰
 */
public class DeviceOfflineOrderService {
    private final Connection sqliteConn<span class="hljs-comment">;</span>
    private final DeviceOrderIdGenerator orderIdGenerator<span class="hljs-comment">;</span>
    private final DeviceTimeCalibrator timeCalibrator<span class="hljs-comment">;</span>
    private static final String <span class="hljs-attr">DEVICE_ID</span> = <span class="hljs-string">"DEV001"</span><span class="hljs-comment">; // è®¾å¤‡å”¯ä¸€IDï¼ˆå®é™…ä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰</span>

    public DeviceOfflineOrderService(Connection sqliteConn) {
        <span class="hljs-attr">this.sqliteConn</span> = sqliteConn<span class="hljs-comment">;</span>
        <span class="hljs-attr">this.orderIdGenerator</span> = new DeviceOrderIdGenerator(DEVICE_ID)<span class="hljs-comment">;</span>
        <span class="hljs-attr">this.timeCalibrator</span> = new DeviceTimeCalibrator()<span class="hljs-comment">;</span>
        this.timeCalibrator.scheduleCalibrate()<span class="hljs-comment">; // å¯åŠ¨æ—¶é—´æ ¡å‡†</span>
    }

    /**
     * ç¦»çº¿ä¸‹å•ï¼ˆæœ¬åœ°äº‹åŠ¡ï¼šåˆ›å»ºè®¢å•+é¢„å åº“å­˜ï¼Œè¦ä¹ˆå…¨æˆï¼Œè¦ä¹ˆå…¨å›æ»šï¼‰
     */
    public Result&lt;String&gt; createOfflineOrder(OrderCreateDTO dto) {
        // 1. æ ¡éªŒæœ¬åœ°åº“å­˜å¿«ç…§
        if (!checkLocalStock(dto.getProductId(), dto.getQuantity())) {
            return Result.error("æœ¬åœ°åº“å­˜ä¸è¶³ï¼Œæ— æ³•ä¸‹å•")<span class="hljs-comment">;</span>
        }

        String <span class="hljs-attr">orderId</span> = orderIdGenerator.generateOrderId()<span class="hljs-comment">;</span>
        LocalDateTime <span class="hljs-attr">calibratedTime</span> = timeCalibrator.getCalibratedTime()<span class="hljs-comment">;</span>
        String <span class="hljs-attr">timeStr</span> = calibratedTime.format(DateTimeFormatter.ISO_LOCAL_DATE_TIME)<span class="hljs-comment">;</span>

        sqliteConn.setAutoCommit(false)<span class="hljs-comment">;</span>
        try {
            // 2. åˆ›å»ºæœ¬åœ°è®¢å•
            String <span class="hljs-attr">insertOrderSql</span> = <span class="hljs-string">"""
                INSERT INTO device_order 
                (order_id, device_id, user_id, product_id, quantity, amount, create_time, sync_status, update_time)
                VALUES (?, ?, ?, ?, ?, ?, ?, 'PENDING', ?)
            """</span><span class="hljs-comment">;</span>
            try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(insertOrderSql)) {
                pstmt.setString(1, orderId)<span class="hljs-comment">;</span>
                pstmt.setString(2, DEVICE_ID)<span class="hljs-comment">;</span>
                pstmt.setString(3, dto.getUserId())<span class="hljs-comment">;</span>
                pstmt.setString(4, dto.getProductId())<span class="hljs-comment">;</span>
                pstmt.setInt(5, dto.getQuantity())<span class="hljs-comment">;</span>
                pstmt.setBigDecimal(6, dto.getAmount())<span class="hljs-comment">;</span>
                pstmt.setString(7, timeStr)<span class="hljs-comment">;</span>
                pstmt.setString(8, timeStr)<span class="hljs-comment">;</span>
                pstmt.executeUpdate()<span class="hljs-comment">;</span>
            }

            // 3. é¢„å æœ¬åœ°åº“å­˜ï¼ˆavailable_stockå‡å°‘ï¼Œlocked_stockå¢åŠ ï¼‰
            String <span class="hljs-attr">updateStockSql</span> = <span class="hljs-string">"""
                UPDATE device_product_stock
                SET available_stock = available_stock - ?,
                    locked_stock = locked_stock + ?,
                    update_time = ?
                WHERE product_id = ?
            """</span><span class="hljs-comment">;</span>
            try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(updateStockSql)) {
                pstmt.setInt(1, dto.getQuantity())<span class="hljs-comment">;</span>
                pstmt.setInt(2, dto.getQuantity())<span class="hljs-comment">;</span>
                pstmt.setString(3, timeStr)<span class="hljs-comment">;</span>
                pstmt.setString(4, dto.getProductId())<span class="hljs-comment">;</span>
                pstmt.executeUpdate()<span class="hljs-comment">;</span>
            }

            // 4. å¤‡ä»½è®¢å•åˆ°å¤‡ä»½è¡¨ï¼ˆé˜²æ­¢ä¸»è¡¨æŸåï¼‰
            backupOrder(orderId, timeStr)<span class="hljs-comment">;</span>

            sqliteConn.commit()<span class="hljs-comment">;</span>
            return Result.success(orderId, "ç¦»çº¿ä¸‹å•æˆåŠŸï¼Œè®¢å•å·ï¼š" + orderId)<span class="hljs-comment">;</span>
        } catch (SQLException e) {
            try {
                sqliteConn.rollback()<span class="hljs-comment">;</span>
            } catch (SQLException ex) {
                ex.printStackTrace()<span class="hljs-comment">;</span>
            }
            return Result.error("ç¦»çº¿ä¸‹å•å¤±è´¥ï¼š" + e.getMessage())<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ ¡éªŒæœ¬åœ°åº“å­˜å¿«ç…§æ˜¯å¦å……è¶³
     */
    private boolean checkLocalStock(String productId, int quantity) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT available_stock FROM device_product_stock WHERE product_id = ?"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, productId)<span class="hljs-comment">;</span>
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>
            return rs.next() &amp;&amp; rs.getInt("available_stock") &gt;= quantity<span class="hljs-comment">;</span>
        }
    }

    /**
     * å¤‡ä»½è®¢å•åˆ°å¤‡ä»½è¡¨
     */
    private void backupOrder(String orderId, String updateTime) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"""
            INSERT INTO device_order_backup
            SELECT * FROM device_order WHERE order_id = ? AND update_time = ?
        """</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, orderId)<span class="hljs-comment">;</span>
            pstmt.setString(2, updateTime)<span class="hljs-comment">;</span>
            pstmt.executeUpdate()<span class="hljs-comment">;</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-11">4. è®¾å¤‡ç«¯è”ç½‘åŒæ­¥æ ¸å¿ƒé€»è¾‘ï¼ˆæ‰¹é‡+æ–­ç‚¹ç»­ä¼ +é‡è¯•ï¼‰</h4>
<pre><code class="hljs language-ini" lang="ini">/**
 * è®¾å¤‡ç«¯è®¢å•åŒæ­¥æœåŠ¡ï¼ˆæ ¸å¿ƒï¼šæ‰¹é‡åŒæ­¥+æ–­ç‚¹ç»­ä¼ +æŒ‡æ•°é€€é¿é‡è¯•ï¼‰
 */
public class DeviceOrderSyncService {
    private final Connection sqliteConn<span class="hljs-comment">;</span>
    private final String <span class="hljs-attr">syncUrl</span> = <span class="hljs-string">"http://localhost:8080/api/order/sync/batch"</span><span class="hljs-comment">; // äº‘ç«¯æ‰¹é‡åŒæ­¥æ¥å£</span>
    private static final int <span class="hljs-attr">BATCH_SIZE</span> = <span class="hljs-number">10</span><span class="hljs-comment">; // æ¯æ‰¹åŒæ­¥10æ¡è®¢å•</span>
    private static final int <span class="hljs-attr">MAX_RETRY_COUNT</span> = <span class="hljs-number">5</span><span class="hljs-comment">; // æœ€å¤§é‡è¯•æ¬¡æ•°</span>
    private final ScheduledExecutorService <span class="hljs-attr">syncExecutor</span> = Executors.newSingleThreadScheduledExecutor()<span class="hljs-comment">;</span>

    public DeviceOrderSyncService(Connection sqliteConn) {
        <span class="hljs-attr">this.sqliteConn</span> = sqliteConn<span class="hljs-comment">;</span>
        // å¯åŠ¨ç½‘ç»œç›‘å¬ï¼šæ¯3ç§’æ£€æµ‹ä¸€æ¬¡ç½‘ç»œï¼Œè”ç½‘åè§¦å‘åŒæ­¥
        startNetworkMonitor()<span class="hljs-comment">;</span>
    }

    /**
     * å¯åŠ¨ç½‘ç»œç›‘å¬ï¼Œè”ç½‘åè§¦å‘åŒæ­¥
     */
    private void startNetworkMonitor() {
        syncExecutor.scheduleAtFixedRate(() -&gt; {
            if (NetworkUtils.isNetworkAvailable()) {
                System.out.println("æ£€æµ‹åˆ°ç½‘ç»œå·²æ¢å¤ï¼Œå¼€å§‹åŒæ­¥ç¦»çº¿è®¢å•...")<span class="hljs-comment">;</span>
                try {
                    syncPendingOrders()<span class="hljs-comment">;</span>
                } catch (Exception e) {
                    System.err.println("è®¢å•åŒæ­¥å¼‚å¸¸ï¼š" + e.getMessage())<span class="hljs-comment">;</span>
                }
            }
        }, 0, 3, TimeUnit.SECONDS)<span class="hljs-comment">;</span>
    }

    /**
     * åŒæ­¥æœ¬åœ°å¾…åŒæ­¥è®¢å•ï¼ˆæ‰¹é‡+æ–­ç‚¹ç»­ä¼ ï¼‰
     */
    private void syncPendingOrders() throws SQLException {
        // 1. è·å–ä¸Šä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ èµ·ç‚¹ï¼‰
        String <span class="hljs-attr">lastSyncOrderId</span> = getLastSyncOrderId()<span class="hljs-comment">;</span>

        // 2. æŸ¥è¯¢å¾…åŒæ­¥è®¢å•ï¼ˆæŒ‰create_timeå‡åºï¼Œä¿è¯é¡ºåºï¼‰
        String <span class="hljs-attr">querySql</span> = <span class="hljs-string">"""
            SELECT * FROM device_order
            WHERE (sync_status = 'PENDING' OR (sync_status = 'FAILED' AND sync_retry_count &lt; ?))
              AND order_id &gt; ?
            ORDER BY create_time ASC
            LIMIT ?
        """</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(querySql)) {
            pstmt.setInt(1, MAX_RETRY_COUNT)<span class="hljs-comment">;</span>
            pstmt.setString(2, lastSyncOrderId)<span class="hljs-comment">;</span>
            pstmt.setInt(3, BATCH_SIZE)<span class="hljs-comment">;</span>
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>

            List&lt;DeviceOrderDTO&gt; <span class="hljs-attr">syncOrders</span> = new ArrayList&lt;&gt;()<span class="hljs-comment">;</span>
            while (rs.next()) {
                DeviceOrderDTO <span class="hljs-attr">order</span> = new DeviceOrderDTO()<span class="hljs-comment">;</span>
                order.setOrderId(rs.getString("order_id"))<span class="hljs-comment">;</span>
                order.setDeviceId(rs.getString("device_id"))<span class="hljs-comment">;</span>
                order.setUserId(rs.getString("user_id"))<span class="hljs-comment">;</span>
                order.setProductId(rs.getString("product_id"))<span class="hljs-comment">;</span>
                order.setQuantity(rs.getInt("quantity"))<span class="hljs-comment">;</span>
                order.setAmount(rs.getBigDecimal("amount"))<span class="hljs-comment">;</span>
                order.setCreateTime(LocalDateTime.parse(rs.getString("create_time")))<span class="hljs-comment">;</span>
                syncOrders.add(order)<span class="hljs-comment">;</span>
            }

            if (syncOrders.isEmpty()) {
                System.out.println("æ— å¾…åŒæ­¥è®¢å•")<span class="hljs-comment">;</span>
                return<span class="hljs-comment">;</span>
            }

            // 3. æ ‡è®°è®¢å•ä¸ºã€ŒåŒæ­¥ä¸­ã€ï¼ˆé¿å…é‡å¤åŒæ­¥ï¼‰
            markOrdersSyncing(syncOrders.stream().map(DeviceOrderDTO::getOrderId).collect(Collectors.toList()))<span class="hljs-comment">;</span>

            // 4. æ‰¹é‡åŒæ­¥åˆ°äº‘ç«¯
            Result&lt;BatchSyncResponse&gt; <span class="hljs-attr">syncResult</span> = batchSyncToCloud(syncOrders)<span class="hljs-comment">;</span>

            // 5. å¤„ç†åŒæ­¥ç»“æœ
            handleSyncResult(syncResult, syncOrders)<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ‰¹é‡åŒæ­¥åˆ°äº‘ç«¯
     */
    private Result&lt;BatchSyncResponse&gt; batchSyncToCloud(List&lt;DeviceOrderDTO&gt; orders) {
        try {
            RestTemplate <span class="hljs-attr">restTemplate</span> = new RestTemplate()<span class="hljs-comment">;</span>
            HttpHeaders <span class="hljs-attr">headers</span> = new HttpHeaders()<span class="hljs-comment">;</span>
            headers.setContentType(MediaType.APPLICATION_JSON)<span class="hljs-comment">;</span>
            HttpEntity&lt;List&lt;DeviceOrderDTO&gt;&gt; <span class="hljs-attr">request</span> = new HttpEntity&lt;&gt;(orders, headers)<span class="hljs-comment">;</span>

            ResponseEntity&lt;Result&lt;BatchSyncResponse&gt;&gt; <span class="hljs-attr">response</span> = restTemplate.exchange(
                syncUrl, HttpMethod.POST, request, new ParameterizedTypeReference&lt;Result&lt;BatchSyncResponse&gt;&gt;() {}
            )<span class="hljs-comment">;</span>

            if (response.getStatusCode().is2xxSuccessful() &amp;&amp; response.getBody() != null &amp;&amp; response.getBody().isSuccess()) {
                return response.getBody()<span class="hljs-comment">;</span>
            } else {
                return Result.error("äº‘ç«¯è¿”å›å¤±è´¥ï¼š" + (response.getBody() != null ? response.getBody().getMessage() : "æœªçŸ¥é”™è¯¯"))<span class="hljs-comment">;</span>
            }
        } catch (Exception e) {
            return Result.error("åŒæ­¥è¯·æ±‚å‘é€å¤±è´¥ï¼š" + e.getMessage())<span class="hljs-comment">;</span>
        }
    }

    /**
     * å¤„ç†åŒæ­¥ç»“æœï¼ˆæ›´æ–°æœ¬åœ°è®¢å•çŠ¶æ€ï¼‰
     */
    private void handleSyncResult(Result&lt;BatchSyncResponse&gt; syncResult, List&lt;DeviceOrderDTO&gt; orders) throws SQLException {
        sqliteConn.setAutoCommit(false)<span class="hljs-comment">;</span>
        try {
            if (syncResult.isSuccess()) {
                BatchSyncResponse <span class="hljs-attr">response</span> = syncResult.getData()<span class="hljs-comment">;</span>
                // å¤„ç†åŒæ­¥æˆåŠŸçš„è®¢å•
                for (String successOrderId : response.getSuccessOrderIds()) {
                    updateOrderSyncStatus(successOrderId, "SUCCESS", null)<span class="hljs-comment">;</span>
                }
                // å¤„ç†åŒæ­¥å¤±è´¥çš„è®¢å•
                for (FailedOrder failedOrder : response.getFailedOrders()) {
                    String <span class="hljs-attr">orderId</span> = failedOrder.getOrderId()<span class="hljs-comment">;</span>
                    int <span class="hljs-attr">retryCount</span> = getCurrentRetryCount(orderId) + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
                    String <span class="hljs-attr">status</span> = retryCount &gt;= MAX_RETRY_COUNT ? <span class="hljs-string">"EXCEPTION"</span> : <span class="hljs-string">"FAILED"</span><span class="hljs-comment">;</span>
                    updateOrderSyncStatus(orderId, status, failedOrder.getReason(), retryCount)<span class="hljs-comment">;</span>
                }
                // æ›´æ–°æœ€åä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ ç”¨ï¼‰
                updateLastSyncOrderId(response.getLastSuccessOrderId())<span class="hljs-comment">;</span>
                System.out.println("æ‰¹é‡åŒæ­¥å®Œæˆï¼šæˆåŠŸ" + response.getSuccessOrderIds().size() + "æ¡ï¼Œå¤±è´¥" + response.getFailedOrders().size() + "æ¡")<span class="hljs-comment">;</span>
            } else {
                // æ•´ä½“åŒæ­¥å¤±è´¥ï¼Œæ‰€æœ‰è®¢å•æ ‡è®°ä¸ºFAILED+é‡è¯•æ¬¡æ•°+å¤±è´¥åŸå› 
                for (DeviceOrderDTO order : orders) {
                    int <span class="hljs-attr">retryCount</span> = getCurrentRetryCount(order.getOrderId()) + <span class="hljs-number">1</span><span class="hljs-comment">;</span>
                    String <span class="hljs-attr">status</span> = retryCount &gt;= MAX_RETRY_COUNT ? <span class="hljs-string">"EXCEPTION"</span> : <span class="hljs-string">"FAILED"</span><span class="hljs-comment">;</span>
                    updateOrderSyncStatus(order.getOrderId(), status, syncResult.getMessage(), retryCount)<span class="hljs-comment">;</span>
                }
                System.err.println("æ‰¹é‡åŒæ­¥å¤±è´¥ï¼š" + syncResult.getMessage())<span class="hljs-comment">;</span>
            }
            sqliteConn.commit()<span class="hljs-comment">;</span>
        } catch (SQLException e) {
            sqliteConn.rollback()<span class="hljs-comment">;</span>
            throw e<span class="hljs-comment">;</span>
        }
    }

    // ---------------------- è¾…åŠ©æ–¹æ³• ----------------------
    /**
     * è·å–ä¸Šä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•ID
     */
    private String getLastSyncOrderId() throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT last_sync_order_id FROM device_order LIMIT 1"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>
            return rs.next() &amp;&amp; rs.getString("last_sync_order_id") != null ? rs.getString("last_sync_order_id") : ""<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ ‡è®°è®¢å•ä¸ºã€ŒåŒæ­¥ä¸­ã€
     */
    private void markOrdersSyncing(List&lt;String&gt; orderIds) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"UPDATE device_order SET sync_status = 'ING', last_sync_time = ? WHERE order_id = ?"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            String <span class="hljs-attr">timeStr</span> = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME)<span class="hljs-comment">;</span>
            for (String orderId : orderIds) {
                pstmt.setString(1, timeStr)<span class="hljs-comment">;</span>
                pstmt.setString(2, orderId)<span class="hljs-comment">;</span>
                pstmt.addBatch()<span class="hljs-comment">;</span>
            }
            pstmt.executeBatch()<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ›´æ–°è®¢å•åŒæ­¥çŠ¶æ€
     */
    private void updateOrderSyncStatus(String orderId, String status, String failReason) throws SQLException {
        updateOrderSyncStatus(orderId, status, failReason, getCurrentRetryCount(orderId))<span class="hljs-comment">;</span>
    }

    private void updateOrderSyncStatus(String orderId, String status, String failReason, int retryCount) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"""
            UPDATE device_order
            SET sync_status = ?,
                sync_retry_count = ?,
                sync_fail_reason = ?,
                last_sync_time = ?,
                update_time = ?
            WHERE order_id = ?
        """</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            String <span class="hljs-attr">timeStr</span> = LocalDateTime.now().format(DateTimeFormatter.ISO_LOCAL_DATE_TIME)<span class="hljs-comment">;</span>
            pstmt.setString(1, status)<span class="hljs-comment">;</span>
            pstmt.setInt(2, retryCount)<span class="hljs-comment">;</span>
            pstmt.setString(3, failReason)<span class="hljs-comment">;</span>
            pstmt.setString(4, timeStr)<span class="hljs-comment">;</span>
            pstmt.setString(5, timeStr)<span class="hljs-comment">;</span>
            pstmt.setString(6, orderId)<span class="hljs-comment">;</span>
            pstmt.executeUpdate()<span class="hljs-comment">;</span>
        }
    }

    /**
     * è·å–å½“å‰è®¢å•é‡è¯•æ¬¡æ•°
     */
    private int getCurrentRetryCount(String orderId) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"SELECT sync_retry_count FROM device_order WHERE order_id = ?"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, orderId)<span class="hljs-comment">;</span>
            ResultSet <span class="hljs-attr">rs</span> = pstmt.executeQuery()<span class="hljs-comment">;</span>
            return rs.next() ? rs.getInt("sync_retry_count") : 0<span class="hljs-comment">;</span>
        }
    }

    /**
     * æ›´æ–°æœ€åä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•ID
     */
    private void updateLastSyncOrderId(String lastSuccessOrderId) throws SQLException {
        String <span class="hljs-attr">sql</span> = <span class="hljs-string">"UPDATE device_order SET last_sync_order_id = ? WHERE order_id = (SELECT MAX(order_id) FROM device_order)"</span><span class="hljs-comment">;</span>
        try (PreparedStatement <span class="hljs-attr">pstmt</span> = sqliteConn.prepareStatement(sql)) {
            pstmt.setString(1, lastSuccessOrderId)<span class="hljs-comment">;</span>
            pstmt.executeUpdate()<span class="hljs-comment">;</span>
        }
    }
}

// åŒæ­¥ç›¸å…³DTO
@Data
public class DeviceOrderDTO {
    private String orderId<span class="hljs-comment">;</span>
    private String deviceId<span class="hljs-comment">;</span>
    private String userId<span class="hljs-comment">;</span>
    private String productId<span class="hljs-comment">;</span>
    private Integer quantity<span class="hljs-comment">;</span>
    private BigDecimal amount<span class="hljs-comment">;</span>
    private LocalDateTime createTime<span class="hljs-comment">;</span>
}

@Data
public class BatchSyncResponse {
    private List&lt;String&gt; successOrderIds<span class="hljs-comment">; // åŒæ­¥æˆåŠŸçš„è®¢å•ID</span>
    private List&lt;FailedOrder&gt; failedOrders<span class="hljs-comment">; // åŒæ­¥å¤±è´¥çš„è®¢å•ï¼ˆå«åŸå› ï¼‰</span>
    private String lastSuccessOrderId<span class="hljs-comment">; // æœ€åä¸€æ¬¡åŒæ­¥æˆåŠŸçš„è®¢å•IDï¼ˆæ–­ç‚¹ç»­ä¼ ç”¨ï¼‰</span>
}

@Data
public class FailedOrder {
    private String orderId<span class="hljs-comment">;</span>
    private String reason<span class="hljs-comment">;</span>
}
</code></pre>
<h3 data-id="heading-12">ç¬¬äºŒéƒ¨åˆ†ï¼šäº‘ç«¯æ ¸å¿ƒä»£ç ï¼ˆæ¥æ”¶åŒæ­¥+æ ¡éªŒ+å¤„ç†ï¼‰</h3>
<h4 data-id="heading-13">1. äº‘ç«¯ä¾èµ–é…ç½®ï¼ˆpom.xmlï¼‰</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Spring Bootæ ¸å¿ƒ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRabbitMQï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- Redisï¼ˆå»é‡+åˆ†å¸ƒå¼é”ï¼‰ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- æ•°æ®åº“ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

    <span class="hljs-comment">&lt;!-- å·¥å…·ç±» --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.0.32<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.12.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span>
</code></pre>
<h4 data-id="heading-14">2. äº‘ç«¯é…ç½®æ–‡ä»¶ï¼ˆapplication.ymlï¼‰</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-comment"># æ•°æ®åº“é…ç½®</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://localhost:3306/cloud_order_db?useSSL=false&amp;serverTimezone=Asia/Shanghai&amp;allowPublicKeyRetrieval=true</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span>

  <span class="hljs-comment"># Redisé…ç½®ï¼ˆå»é‡+åˆ†å¸ƒå¼é”ï¼‰</span>
  <span class="hljs-attr">redis:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span>
    <span class="hljs-attr">database:</span> <span class="hljs-number">0</span>
    <span class="hljs-attr">timeout:</span> <span class="hljs-string">3000ms</span>

  <span class="hljs-comment"># RabbitMQé…ç½®ï¼ˆä¿è¯æ¶ˆæ¯æœ‰åº+æŒä¹…åŒ–ï¼‰</span>
  <span class="hljs-attr">rabbitmq:</span>
    <span class="hljs-attr">host:</span> <span class="hljs-string">localhost</span>
    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">guest</span>
    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">/</span>
    <span class="hljs-attr">publisher-confirm-type:</span> <span class="hljs-string">correlated</span>
    <span class="hljs-attr">publisher-returns:</span> <span class="hljs-literal">true</span>
    <span class="hljs-attr">listener:</span>
      <span class="hljs-attr">simple:</span>
        <span class="hljs-attr">acknowledge-mode:</span> <span class="hljs-string">manual</span> <span class="hljs-comment"># æ‰‹åŠ¨ACK</span>
        <span class="hljs-attr">concurrency:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># å•çº¿ç¨‹æ¶ˆè´¹ï¼ˆä¿è¯é¡ºåºï¼‰</span>
        <span class="hljs-attr">max-concurrency:</span> <span class="hljs-number">1</span>
        <span class="hljs-attr">prefetch:</span> <span class="hljs-number">1</span> <span class="hljs-comment"># æ¯æ¬¡æ‹‰å–1æ¡æ¶ˆæ¯</span>

<span class="hljs-comment"># åº”ç”¨é…ç½®</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">8080</span>
  <span class="hljs-attr">servlet:</span>
    <span class="hljs-attr">context-path:</span> <span class="hljs-string">/</span>

<span class="hljs-comment"># MyBatisé…ç½®</span>
<span class="hljs-attr">mybatis:</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mapper/*.xml</span>
  <span class="hljs-attr">type-aliases-package:</span> <span class="hljs-string">com.cloud.order.entity</span>
</code></pre>
<h4 data-id="heading-15">3. äº‘ç«¯æ ¸å¿ƒé…ç½®ï¼ˆRabbitMQ+Redisï¼‰</h4>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-comment">/**
 * RabbitMQé…ç½®ï¼ˆå•é˜Ÿåˆ—+æ­»ä¿¡é˜Ÿåˆ—ï¼Œä¿è¯æœ‰åº+å¯é ï¼‰
 */</span>
@Configuration
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RabbitMQConfig</span> {
    <span class="hljs-comment">// è®¢å•åŒæ­¥é˜Ÿåˆ—ï¼ˆå•é˜Ÿåˆ—ï¼Œä¿è¯FIFOï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> ORDER_SYNC_QUEUE = <span class="hljs-string">"queue.order.sync"</span>;
    <span class="hljs-comment">// æ­»ä¿¡é˜Ÿåˆ—ï¼ˆå¤„ç†å¤±è´¥çš„è®¢å•ï¼‰</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> ORDER_SYNC_DLQ = <span class="hljs-string">"queue.order.sync.dlq"</span>;

    <span class="hljs-comment">// åŒæ­¥é˜Ÿåˆ—ï¼ˆæŒä¹…åŒ–+ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—ï¼‰</span>
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title">orderSyncQueue</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> QueueBuilder.<span class="hljs-built_in">durable</span>(ORDER_SYNC_QUEUE)
                .<span class="hljs-built_in">withArgument</span>(<span class="hljs-string">"x-dead-letter-exchange"</span>, <span class="hljs-string">""</span>)
                .<span class="hljs-built_in">withArgument</span>(<span class="hljs-string">"x-dead-letter-routing-key"</span>, ORDER_SYNC_DLQ)
                .<span class="hljs-built_in">withArgument</span>(<span class="hljs-string">"x-message-ttl"</span>, <span class="hljs-number">60000</span>) <span class="hljs-comment">// 1åˆ†é’Ÿæœªå¤„ç†å…¥æ­»ä¿¡é˜Ÿåˆ—</span>
                .<span class="hljs-built_in">build</span>();
    }

    <span class="hljs-comment">// æ­»ä¿¡é˜Ÿåˆ—</span>
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> Queue <span class="hljs-title">orderSyncDlq</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> QueueBuilder.<span class="hljs-built_in">durable</span>(ORDER_SYNC_DLQ).<span class="hljs-built_in">build</span>();
    }
}

<span class="hljs-comment">/**
 * Redisé…ç½®ï¼ˆåºåˆ—åŒ–+è¿æ¥æ± ï¼‰
 */</span>
@Configuration
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> {
    @<span class="hljs-function">Bean
    <span class="hljs-keyword">public</span> RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-title">redisTemplate</span><span class="hljs-params">(RedisConnectionFactory factory)</span> </span>{
        RedisTemplate&lt;<span class="hljs-type">String</span>, Object&gt; <span class="hljs-keyword">template</span> = <span class="hljs-keyword">new</span> RedisTemplate&lt;&gt;();
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setConnectionFactory</span>(factory);

        <span class="hljs-comment">// Keyåºåˆ—åŒ–ï¼ˆStringï¼‰</span>
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashKeySerializer</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">StringRedisSerializer</span>());

        <span class="hljs-comment">// Valueåºåˆ—åŒ–ï¼ˆJSONï¼‰</span>
        GenericJackson2JsonRedisSerializer jsonSerializer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">GenericJackson2JsonRedisSerializer</span>();
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setValueSerializer</span>(jsonSerializer);
        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">setHashValueSerializer</span>(jsonSerializer);

        <span class="hljs-keyword">template</span>.<span class="hljs-built_in">afterPropertiesSet</span>();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">template</span>;
    }
}
</code></pre>
<h4 data-id="heading-16">4. äº‘ç«¯åŒæ­¥æ¥æ”¶æ¥å£ï¼ˆæ‰¹é‡+å»é‡ï¼‰</h4>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">/**
 * äº‘ç«¯è®¢å•æ‰¹é‡åŒæ­¥æ¥å£ï¼ˆè®¾å¤‡ç«¯è°ƒç”¨ï¼‰
 */</span>
<span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/api/order/sync"</span>)
<span class="hljs-variable">@RequiredArgsConstructor</span>
public class OrderSyncController {
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">RabbitTemplate</span> <span class="hljs-selector-tag">rabbitTemplate</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">OrderIdempotentService</span> <span class="hljs-selector-tag">idempotentService</span>;

    <span class="hljs-comment">/**
     * æ‰¹é‡åŒæ­¥ç¦»çº¿è®¢å•
     */</span>
    @<span class="hljs-selector-tag">PostMapping</span>(<span class="hljs-string">"/batch"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Result</span>&lt;<span class="hljs-selector-tag">BatchSyncResponse</span>&gt; <span class="hljs-selector-tag">batchSync</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Valid</span> List&lt;DeviceOrderDTO&gt; orders) {
        <span class="hljs-selector-tag">if</span> (orders.<span class="hljs-built_in">isEmpty</span>()) {
            <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"åŒæ­¥è®¢å•ä¸èƒ½ä¸ºç©º"</span>);
        }

        <span class="hljs-selector-tag">BatchSyncResponse</span> <span class="hljs-selector-tag">response</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">BatchSyncResponse</span>();
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">successOrderIds</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ArrayList</span>&lt;&gt;();
        <span class="hljs-selector-tag">List</span>&lt;<span class="hljs-selector-tag">FailedOrder</span>&gt; <span class="hljs-selector-tag">failedOrders</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">ArrayList</span>&lt;&gt;();

        <span class="hljs-comment">// 1. é€å•å»é‡æ ¡éªŒï¼ˆé¿å…é‡å¤åŒæ­¥ï¼‰</span>
        <span class="hljs-selector-tag">for</span> (DeviceOrderDTO <span class="hljs-attribute">order </span>: orders) {
            <span class="hljs-selector-tag">if</span> (idempotentService.<span class="hljs-built_in">isOrderSynced</span>(order.<span class="hljs-built_in">getOrderId</span>())) {
                <span class="hljs-comment">// å·²åŒæ­¥è¿‡ï¼Œç›´æ¥æ ‡è®°æˆåŠŸ</span>
                <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.add</span>(order.<span class="hljs-built_in">getOrderId</span>());
                <span class="hljs-selector-tag">continue</span>;
            }
            <span class="hljs-comment">// æœªåŒæ­¥ï¼Œå‘é€åˆ°RabbitMQï¼ˆå•é˜Ÿåˆ—ä¿è¯æœ‰åºï¼‰</span>
            <span class="hljs-selector-tag">try</span> {
                <span class="hljs-selector-tag">rabbitTemplate</span><span class="hljs-selector-class">.convertAndSend</span>(
                    RabbitMQConfig.ORDER_SYNC_QUEUE,
                    MessageBuilder.<span class="hljs-built_in">withBody</span>(JSON.<span class="hljs-built_in">toJSONBytes</span>(order))
                        .<span class="hljs-built_in">setDeliveryMode</span>(MessageDeliveryMode.PERSISTENT) <span class="hljs-comment">// æ¶ˆæ¯æŒä¹…åŒ–</span>
                        .<span class="hljs-built_in">setHeader</span>(<span class="hljs-string">"orderId"</span>, order.<span class="hljs-built_in">getOrderId</span>())
                        .<span class="hljs-built_in">build</span>()
                );
                <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.add</span>(order.<span class="hljs-built_in">getOrderId</span>());
            } <span class="hljs-selector-tag">catch</span> (Exception e) {
                <span class="hljs-selector-tag">failedOrders</span><span class="hljs-selector-class">.add</span>(new <span class="hljs-built_in">FailedOrder</span>(order.<span class="hljs-built_in">getOrderId</span>(), <span class="hljs-string">"æ¶ˆæ¯å‘é€å¤±è´¥ï¼š"</span> + e.<span class="hljs-built_in">getMessage</span>()));
            }
        }

        <span class="hljs-comment">// 2. æ„å»ºå“åº”ï¼ˆæœ€åæˆåŠŸçš„è®¢å•IDå–æˆåŠŸåˆ—è¡¨çš„æœ€åä¸€ä¸ªï¼‰</span>
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">lastSuccessOrderId</span> = <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.isEmpty</span>() ? "" : <span class="hljs-selector-tag">successOrderIds</span><span class="hljs-selector-class">.get</span>(successOrderIds.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>);
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setSuccessOrderIds</span>(successOrderIds);
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setFailedOrders</span>(failedOrders);
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setLastSuccessOrderId</span>(lastSuccessOrderId);

        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Result</span><span class="hljs-selector-class">.success</span>(response, <span class="hljs-string">"åŒæ­¥è¯·æ±‚å·²æ¥æ”¶ï¼Œäº‘ç«¯æ­£åœ¨å¤„ç†"</span>);
    }

    <span class="hljs-comment">/**
     * æä¾›äº‘ç«¯æ—¶é—´æ¥å£ï¼ˆè®¾å¤‡ç«¯æ—¶é—´æ ¡å‡†ç”¨ï¼‰
     */</span>
    @<span class="hljs-selector-tag">GetMapping</span>(<span class="hljs-string">"/common/cloud-time"</span>)
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">getCloudTime</span>() {
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">LocalDateTime</span><span class="hljs-selector-class">.now</span>()<span class="hljs-selector-class">.format</span>(DateTimeFormatter.ISO_LOCAL_DATE_TIME);
    }
}

<span class="hljs-comment">/**
 * è®¢å•å¹‚ç­‰æœåŠ¡ï¼ˆRediså»é‡ï¼‰
 */</span>
@<span class="hljs-selector-tag">Service</span>
@<span class="hljs-selector-tag">RequiredArgsConstructor</span>
<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">OrderIdempotentService</span> {
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">RedisTemplate</span>&lt;<span class="hljs-selector-tag">String</span>, <span class="hljs-selector-tag">Object</span>&gt; <span class="hljs-selector-tag">redisTemplate</span>;
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">ORDER_SYNC_KEY</span> = "<span class="hljs-selector-tag">order</span>:<span class="hljs-selector-tag">sync</span>:<span class="hljs-selector-tag">processed</span>:";
    <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">final</span> <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">EXPIRE_TIME</span> = <span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span>; <span class="hljs-comment">// 24å°æ—¶è¿‡æœŸ</span>

    <span class="hljs-comment">/**
     * æ ¡éªŒè®¢å•æ˜¯å¦å·²åŒæ­¥
     */</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">boolean</span> <span class="hljs-selector-tag">isOrderSynced</span>(String orderId) {
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span> = <span class="hljs-selector-tag">ORDER_SYNC_KEY</span> + <span class="hljs-selector-tag">orderId</span>;
        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">Boolean</span><span class="hljs-selector-class">.TRUE</span><span class="hljs-selector-class">.equals</span>(redisTemplate.<span class="hljs-built_in">hasKey</span>(key));
    }

    <span class="hljs-comment">/**
     * æ ‡è®°è®¢å•å·²åŒæ­¥
     */</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">void</span> <span class="hljs-selector-tag">markOrderSynced</span>(String orderId) {
        <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span> = <span class="hljs-selector-tag">ORDER_SYNC_KEY</span> + <span class="hljs-selector-tag">orderId</span>;
        <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.opsForValue</span>()<span class="hljs-selector-class">.set</span>(key, <span class="hljs-string">"1"</span>, EXPIRE_TIME, TimeUnit.SECONDS);
    }
}
</code></pre>
<h4 data-id="heading-17">5. äº‘ç«¯è®¢å•å¤„ç†æ¶ˆè´¹è€…ï¼ˆæœ‰åº+å†²çªå¤„ç†ï¼‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * è®¢å•åŒæ­¥æ¶ˆè´¹è€…ï¼ˆå•çº¿ç¨‹+åˆ†å¸ƒå¼é”+å†²çªå¤„ç†ï¼‰
 */</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderSyncConsumer</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderService orderService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderIdempotentService idempotentService;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> StringRedisTemplate stringRedisTemplate;

    <span class="hljs-comment">// åˆ†å¸ƒå¼é”å‰ç¼€ï¼ˆé˜²æ­¢å¹¶å‘å¤„ç†åŒä¸€å•†å“/è®¢å•ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOCK_KEY_PREFIX</span> <span class="hljs-operator">=</span> <span class="hljs-string">"lock:order:sync:"</span>;

    <span class="hljs-meta">@RabbitListener(queues = RabbitMQConfig.ORDER_SYNC_QUEUE, concurrency = "1")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processSyncOrder</span><span class="hljs-params">(Message message, Channel channel)</span> <span class="hljs-keyword">throws</span> IOException {
        <span class="hljs-type">long</span> <span class="hljs-variable">deliveryTag</span> <span class="hljs-operator">=</span> message.getMessageProperties().getDeliveryTag();
        <span class="hljs-type">String</span> <span class="hljs-variable">orderId</span> <span class="hljs-operator">=</span> (String) message.getMessageProperties().getHeader(<span class="hljs-string">"orderId"</span>);
        <span class="hljs-type">DeviceOrderDTO</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> JSON.parseObject(message.getBody(), DeviceOrderDTO.class);

        <span class="hljs-comment">// åˆ†å¸ƒå¼é”ï¼šé”å®šå•†å“IDï¼ˆé˜²æ­¢å¤šè®¾å¤‡åŒæ—¶æ‰£å‡åŒä¸€å•†å“åº“å­˜ï¼‰</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> LOCK_KEY_PREFIX + order.getProductId();
        <span class="hljs-type">Boolean</span> <span class="hljs-variable">locked</span> <span class="hljs-operator">=</span> stringRedisTemplate.opsForValue().setIfAbsent(lockKey, <span class="hljs-string">"1"</span>, <span class="hljs-number">5</span>, TimeUnit.SECONDS);

        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">if</span> (Boolean.FALSE.equals(locked)) {
                <span class="hljs-comment">// æœªè·å–åˆ°é”ï¼Œé‡å›é˜Ÿåˆ—</span>
                channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 1. å†æ¬¡å»é‡æ ¡éªŒï¼ˆé˜²æ­¢Redisç¼“å­˜å¤±æ•ˆï¼‰</span>
            <span class="hljs-keyword">if</span> (idempotentService.isOrderSynced(orderId)) {
                channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-comment">// 2. ä¸šåŠ¡å¤„ç†ï¼šæ ¡éªŒå•†å“+æ‰£å‡åº“å­˜+åˆ›å»ºè®¢å•ï¼ˆå«å†²çªå¤„ç†ï¼‰</span>
            orderService.processOfflineOrder(order);

            <span class="hljs-comment">// 3. æ ‡è®°è®¢å•å·²åŒæ­¥</span>
            idempotentService.markOrderSynced(orderId);

            <span class="hljs-comment">// 4. æ‰‹åŠ¨ACKï¼ˆç¡®è®¤å¤„ç†æˆåŠŸï¼‰</span>
            channel.basicAck(deliveryTag, <span class="hljs-literal">false</span>);
            System.out.println(<span class="hljs-string">"è®¢å•["</span> + orderId + <span class="hljs-string">"]åŒæ­¥å¤„ç†æˆåŠŸ"</span>);
        } <span class="hljs-keyword">catch</span> (BusinessException e) {
            <span class="hljs-comment">// ä¸šåŠ¡å¼‚å¸¸ï¼ˆå¦‚åº“å­˜ä¸è¶³ã€å•†å“ä¸‹æ¶ï¼‰ï¼Œç›´æ¥æ‹’ç»ï¼Œä¸å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼ˆè®¾å¤‡ç«¯ä¼šé‡è¯•ï¼‰</span>
            System.err.println(<span class="hljs-string">"è®¢å•["</span> + orderId + <span class="hljs-string">"]åŒæ­¥å¤±è´¥ï¼š"</span> + e.getMessage());
            channel.basicReject(deliveryTag, <span class="hljs-literal">false</span>);
        } <span class="hljs-keyword">catch</span> (Exception e) {
            <span class="hljs-comment">// ç³»ç»Ÿå¼‚å¸¸ï¼Œé‡è¯•3æ¬¡åå…¥æ­»ä¿¡é˜Ÿåˆ—</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> message.getMessageProperties().getHeader(<span class="hljs-string">"x-retry-count"</span>) == <span class="hljs-literal">null</span> ? <span class="hljs-number">0</span> : (<span class="hljs-type">int</span>) message.getMessageProperties().getHeader(<span class="hljs-string">"x-retry-count"</span>);
            <span class="hljs-keyword">if</span> (retryCount &lt; <span class="hljs-number">3</span>) {
                message.getMessageProperties().setHeader(<span class="hljs-string">"x-retry-count"</span>, retryCount + <span class="hljs-number">1</span>);
                channel.basicNack(deliveryTag, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>);
            } <span class="hljs-keyword">else</span> {
                channel.basicReject(deliveryTag, <span class="hljs-literal">false</span>);
                System.err.println(<span class="hljs-string">"è®¢å•["</span> + orderId + <span class="hljs-string">"]é‡è¯•3æ¬¡å¤±è´¥ï¼Œå…¥æ­»ä¿¡é˜Ÿåˆ—ï¼š"</span> + e.getMessage());
            }
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// é‡Šæ”¾åˆ†å¸ƒå¼é”</span>
            <span class="hljs-keyword">if</span> (Boolean.TRUE.equals(locked)) {
                stringRedisTemplate.delete(lockKey);
            }
        }
    }
}

<span class="hljs-comment">/**
 * äº‘ç«¯è®¢å•ä¸šåŠ¡æœåŠ¡ï¼ˆå†²çªå¤„ç†æ ¸å¿ƒï¼‰
 */</span>
<span class="hljs-meta">@Service</span>
<span class="hljs-meta">@RequiredArgsConstructor</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> OrderMapper orderMapper;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ProductStockMapper stockMapper;

    <span class="hljs-comment">/**
     * å¤„ç†ç¦»çº¿åŒæ­¥è®¢å•ï¼ˆå«å•†å“æ ¡éªŒ+åº“å­˜æ‰£å‡+è®¢å•åˆ›å»ºï¼‰
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">processOfflineOrder</span><span class="hljs-params">(DeviceOrderDTO dto)</span> {
        <span class="hljs-comment">// 1. æ ¡éªŒå•†å“æ˜¯å¦å­˜åœ¨ä¸”ä¸Šæ¶</span>
        <span class="hljs-type">ProductStockPO</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> stockMapper.selectByProductId(dto.getProductId());
        <span class="hljs-keyword">if</span> (stock == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"å•†å“ä¸å­˜åœ¨"</span>);
        }
        <span class="hljs-keyword">if</span> (stock.getStatus() != <span class="hljs-number">1</span>) { <span class="hljs-comment">// 1=ä¸Šæ¶ï¼Œ0=ä¸‹æ¶</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"å•†å“å·²ä¸‹æ¶"</span>);
        }

        <span class="hljs-comment">// 2. æ ¡éªŒäº‘ç«¯åº“å­˜æ˜¯å¦å……è¶³</span>
        <span class="hljs-keyword">if</span> (stock.getAvailableStock() &lt; dto.getQuantity()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"äº‘ç«¯åº“å­˜ä¸è¶³ï¼Œå½“å‰å¯ç”¨åº“å­˜ï¼š"</span> + stock.getAvailableStock());
        }

        <span class="hljs-comment">// 3. ä¹è§‚é”æ‰£å‡åº“å­˜ï¼ˆé˜²æ­¢å¹¶å‘å†²çªï¼‰</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">rows</span> <span class="hljs-operator">=</span> stockMapper.deductStock(
            dto.getProductId(), dto.getQuantity(), stock.getVersion()
        );
        <span class="hljs-keyword">if</span> (rows == <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BusinessException</span>(<span class="hljs-string">"åº“å­˜æ‰£å‡å¤±è´¥ï¼Œå¯èƒ½å·²è¢«å…¶ä»–è®¢å•å ç”¨"</span>);
        }

        <span class="hljs-comment">// 4. åˆ›å»ºäº‘ç«¯è®¢å•</span>
        <span class="hljs-type">OrderPO</span> <span class="hljs-variable">orderPO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OrderPO</span>();
        orderPO.setOrderId(dto.getOrderId());
        orderPO.setDeviceId(dto.getDeviceId());
        orderPO.setUserId(dto.getUserId());
        orderPO.setProductId(dto.getProductId());
        orderPO.setQuantity(dto.getQuantity());
        orderPO.setAmount(dto.getAmount());
        orderPO.setOrderStatus(<span class="hljs-string">"PENDING_PAY"</span>); <span class="hljs-comment">// å¾…æ”¯ä»˜</span>
        orderPO.setDeviceCreateTime(dto.getCreateTime());
        orderPO.setCloudCreateTime(LocalDateTime.now());
        orderPO.setSyncStatus(<span class="hljs-string">"SUCCESS"</span>);

        orderMapper.insert(orderPO);
    }
}
</code></pre>
<h4 data-id="heading-18">6. äº‘ç«¯Mapper.xmlï¼ˆåº“å­˜æ‰£å‡+è®¢å•åˆ›å»ºï¼‰</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- ProductStockMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.cloud.order.mapper.ProductStockMapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"selectByProductId"</span> <span class="hljs-attr">resultType</span>=<span class="hljs-string">"com.cloud.order.entity.ProductStockPO"</span>&gt;</span>
        SELECT * FROM product_stock WHERE product_id = #{productId}
    <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"deductStock"</span>&gt;</span>
        UPDATE product_stock
        SET available_stock = available_stock - #{quantity},
            version = version + 1,
            update_time = NOW()
        WHERE product_id = #{productId}
          AND available_stock &gt;= #{quantity}
          AND version = #{version}
    <span class="hljs-tag">&lt;/<span class="hljs-name">update</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>

<span class="hljs-comment">&lt;!-- OrderMapper.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"com.cloud.order.mapper.OrderMapper"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insert"</span>&gt;</span>
        INSERT INTO cloud_order (
            order_id, device_id, user_id, product_id, quantity, amount,
            order_status, device_create_time, cloud_create_time, sync_status
        ) VALUES (
            #{orderId}, #{deviceId}, #{userId}, #{productId}, #{quantity}, #{amount},
            #{orderStatus}, #{deviceCreateTime}, #{cloudCreateTime}, #{syncStatus}
        )
    <span class="hljs-tag">&lt;/<span class="hljs-name">insert</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">mapper</span>&gt;</span>
</code></pre>
<h2 data-id="heading-19">å››ã€å…³é”®é—®é¢˜è§£å†³æ–¹æ¡ˆå¯¹ç…§è¡¨ï¼ˆéªŒè¯æ–¹æ¡ˆæœ‰æ•ˆæ€§ï¼‰</h2>

















































<table><thead><tr><th>ç¦»çº¿åŒæ­¥é—®é¢˜</th><th>è§£å†³æ–¹æ¡ˆå…·ä½“ä½“ç°</th></tr></thead><tbody><tr><td>1. ç¦»çº¿è®¢å•æœ¬åœ°ä¸¢å¤±</td><td>SQLiteäº‹åŠ¡+è®¢å•å¤‡ä»½è¡¨+æœ¬åœ°çŠ¶æ€è®°å½•ï¼Œè®¾å¤‡æ•…éšœåå¯ä»å¤‡ä»½è¡¨æ¢å¤ã€‚</td></tr><tr><td>2. åŒæ­¥æ—¶ç½‘ç»œå†æ¬¡ä¸­æ–­</td><td>æ–­ç‚¹ç»­ä¼ ï¼ˆè®°å½•last_sync_order_idï¼‰+ æ‰¹é‡åŒæ­¥ï¼Œä¸‹æ¬¡ä»æ–­ç‚¹ç»§ç»­åŒæ­¥ï¼Œä¸é‡å¤åŒæ­¥å·²æˆåŠŸè®¢å•ã€‚</td></tr><tr><td>3. å¤šè®¢å•åŒæ­¥é¡ºåºé”™ä¹±</td><td>è®¾å¤‡ç«¯æŒ‰create_timeå‡åºåŒæ­¥+RabbitMQå•é˜Ÿåˆ—+äº‘ç«¯å•çº¿ç¨‹æ¶ˆè´¹ï¼Œä¿è¯FIFOã€‚</td></tr><tr><td>4. åŒæ­¥ä¸äº‘ç«¯å†²çª</td><td>äº‘ç«¯æ ¡éªŒå•†å“çŠ¶æ€+ä¹è§‚é”æ‰£å‡åº“å­˜+è®¢å•çŠ¶æ€æœºï¼Œå†²çªæ—¶æŠ›å‡ºæ˜ç¡®å¼‚å¸¸ï¼Œè®¾å¤‡ç«¯æ ‡è®°å¤±è´¥ã€‚</td></tr><tr><td>5. è®¢å•é‡å¤åŒæ­¥</td><td>å…¨å±€å”¯ä¸€è®¢å•ID+Rediså»é‡+æ•°æ®åº“å”¯ä¸€ç´¢å¼•ï¼Œé‡å¤è®¢å•ç›´æ¥è·³è¿‡å¤„ç†ã€‚</td></tr><tr><td>6. åŒæ­¥å¤±è´¥æ— é‡è¯•æœºåˆ¶</td><td>æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆ10sâ†’30sâ†’1minâ†’5minâ†’10minï¼‰+ æœ€å¤§é‡è¯•æ¬¡æ•°é™åˆ¶ï¼Œå¤±è´¥åè®¾å¤‡å‘Šè­¦ã€‚</td></tr><tr><td>7. åŒæ­¥åè®¾å¤‡çŠ¶æ€æœªæ›´æ–°</td><td>äº‘ç«¯è¿”å›åŒæ­¥ç»“æœ+è®¾å¤‡ç«¯äº‹åŠ¡æ›´æ–°æœ¬åœ°çŠ¶æ€ï¼ŒåŒæ­¥æˆåŠŸæ‰æ ‡è®°ä¸ºSUCCESSã€‚</td></tr><tr><td>8. æ‰¹é‡åŒæ­¥æ•ˆç‡ä½ä¸‹</td><td>10æ¡/æ‰¹æ‰¹é‡åŒæ­¥+æ–­ç‚¹ç»­ä¼ ï¼Œå‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°ï¼Œæå‡åŒæ­¥æ•ˆç‡ã€‚</td></tr><tr><td>9. è®¾å¤‡æ—¶é—´é”™ä¹±</td><td>è®¾å¤‡å®šæ—¶æ ¡å‡†äº‘ç«¯æ—¶é—´+è®¢å•åˆ›å»ºæ—¶é—´ç”¨æ ¡å‡†åæ—¶é—´ï¼Œé¿å…æ—¶é—´å†²çªã€‚</td></tr><tr><td>10. åŒæ­¥æ—¥å¿—ç¼ºå¤±</td><td>è®¾å¤‡ç«¯è®°å½•åŒæ­¥å…¨é“¾è·¯æ—¥å¿—ï¼ˆå‘é€/æ¥æ”¶/å¤„ç†/ç»“æœï¼‰+ äº‘ç«¯æ¶ˆè´¹æ—¥å¿—ï¼Œä¾¿äºæ’æŸ¥ã€‚</td></tr></tbody></table>
<h2 data-id="heading-20">äº”ã€æµ‹è¯•åœºæ™¯éªŒè¯ï¼ˆç¡®ä¿æ–¹æ¡ˆè½åœ°å¯ç”¨ï¼‰</h2>
<h3 data-id="heading-21">æµ‹è¯•åœºæ™¯1ï¼šç¦»çº¿ä¸‹å•åè®¾å¤‡æ–­ç”µï¼Œè®¢å•ä¸ä¸¢å¤±</h3>
<ol>
<li>è®¾å¤‡ç¦»çº¿ï¼Œç”¨æˆ·ä¸‹å•ç”Ÿæˆè®¢å•Aï¼›</li>
<li>è®¾å¤‡ç«‹å³æ–­ç”µï¼Œé‡å¯åï¼›</li>
<li>æŸ¥çœ‹SQLiteçš„device_orderè¡¨å’Œdevice_order_backupè¡¨ï¼Œè®¢å•Aå­˜åœ¨ï¼›</li>
<li>è”ç½‘åï¼Œè®¾å¤‡æˆåŠŸåŒæ­¥è®¢å•Aåˆ°äº‘ç«¯ã€‚</li>
</ol>
<h3 data-id="heading-22">æµ‹è¯•åœºæ™¯2ï¼šåŒæ­¥æ—¶ç½‘ç»œå†æ¬¡ä¸­æ–­ï¼Œæ–­ç‚¹ç»­ä¼ </h3>
<ol start="5">
<li>è®¾å¤‡ç¦»çº¿ç”Ÿæˆè®¢å•Aã€Bã€Cã€Dï¼ˆå…±4æ¡ï¼‰ï¼›</li>
<li>è”ç½‘åå¼€å§‹åŒæ­¥ï¼ŒåŒæ­¥å®ŒAã€Båï¼Œç½‘ç»œä¸­æ–­ï¼›</li>
<li>ç½‘ç»œæ¢å¤åï¼Œè®¾å¤‡ä»last_sync_order_id=Bå¼€å§‹ï¼ŒåŒæ­¥Cã€Dï¼Œæœªé‡å¤åŒæ­¥Aã€Bã€‚</li>
</ol>
<h3 data-id="heading-23">æµ‹è¯•åœºæ™¯3ï¼šåŒæ­¥æ—¶äº‘ç«¯åº“å­˜ä¸è¶³ï¼Œå†²çªå¤„ç†</h3>
<ol start="8">
<li>äº‘ç«¯å•†å“Xåº“å­˜=1ï¼›</li>
<li>è®¾å¤‡Aç¦»çº¿ä¸‹å•å•†å“Xï¼ˆæ•°é‡1ï¼‰ï¼Œè®¾å¤‡Bç¦»çº¿ä¸‹å•å•†å“Xï¼ˆæ•°é‡1ï¼‰ï¼›</li>
<li>è®¾å¤‡Aå…ˆè”ç½‘ï¼ŒåŒæ­¥æˆåŠŸï¼ˆåº“å­˜æ‰£å‡ä¸º0ï¼‰ï¼›</li>
<li>è®¾å¤‡Bè”ç½‘åŒæ­¥ï¼Œäº‘ç«¯è¿”å›â€œåº“å­˜ä¸è¶³â€ï¼Œè®¾å¤‡Bæ ‡è®°è®¢å•ä¸ºFAILEDï¼Œé‡è¯•5æ¬¡åæ ‡è®°ä¸ºEXCEPTIONï¼Œè®¾å¤‡æŒ‡ç¤ºç¯å‘Šè­¦ã€‚</li>
</ol>
<h3 data-id="heading-24">æµ‹è¯•åœºæ™¯4ï¼šè®¢å•é‡å¤åŒæ­¥ï¼Œå»é‡ç”Ÿæ•ˆ</h3>
<ol start="12">
<li>è®¾å¤‡åŒæ­¥è®¢å•AæˆåŠŸï¼Œä½†æœªæ”¶åˆ°äº‘ç«¯ç¡®è®¤ï¼Œé‡å¯åå†æ¬¡åŒæ­¥ï¼›</li>
<li>äº‘ç«¯æ¥æ”¶åï¼ŒRediså»é‡æ ¡éªŒå‘ç°è®¢å•Aå·²åŒæ­¥ï¼Œç›´æ¥è¿”å›æˆåŠŸï¼Œæœªé‡å¤åˆ›å»ºè®¢å•ã€‚</li>
</ol>
<h2 data-id="heading-25">å…­ã€æ€»ç»“ï¼ˆæ ¸å¿ƒæ€è·¯å›é¡¾ï¼‰</h2>
<ol start="14">
<li><strong>æœ¬åœ°å¯é æ˜¯åŸºç¡€</strong>ï¼šç¦»çº¿è®¢å•å¿…é¡»ç”¨åµŒå…¥å¼æ•°æ®åº“ï¼ˆSQLiteï¼‰åšäº‹åŠ¡åŒ–å­˜å‚¨+å¤‡ä»½ï¼Œæœç»è®¾å¤‡æ•…éšœå¯¼è‡´ä¸¢å¤±ï¼›</li>
<li><strong>åŒæ­¥å¯é æ˜¯å…³é”®</strong>ï¼šæ‰¹é‡+æ–­ç‚¹ç»­ä¼ +æŒ‡æ•°é€€é¿é‡è¯•ï¼Œåº”å¯¹ç½‘ç»œæ³¢åŠ¨ï¼Œç¡®ä¿â€œä¸é‡ä¸æ¼â€ï¼›</li>
<li><strong>äº‘ç«¯æ ¡éªŒæ˜¯ä¿éšœ</strong>ï¼šåŒæ­¥æ—¶æ ¡éªŒå•†å“ã€åº“å­˜ã€è®¢å•å”¯ä¸€æ€§ï¼Œæ‹’ç»éæ³•è®¢å•ï¼Œé¿å…ä¸šåŠ¡å†²çªï¼›</li>
<li><strong>å†²çªå¤„ç†æ˜¯æ ¸å¿ƒ</strong>ï¼šç”¨ä¹è§‚é”ã€åˆ†å¸ƒå¼é”ã€çŠ¶æ€æœºè§£å†³åº“å­˜/çŠ¶æ€å†²çªï¼Œæ— éœ€äººå·¥å¹²é¢„ï¼›</li>
<li><strong>å®¹é”™å…œåº•æ˜¯è¡¥å……</strong>ï¼šæ­»ä¿¡é˜Ÿåˆ—+åŒæ­¥æ—¥å¿—+è®¾å¤‡å‘Šè­¦ï¼Œç¡®ä¿æç«¯æƒ…å†µå¯è¿½æº¯ã€å¯æ¢å¤ã€‚</li>
</ol>
<p>è¿™å¥—æ–¹æ¡ˆå®Œå…¨èšç„¦â€œç¦»çº¿ä¸‹å•â†’è”ç½‘åŒæ­¥â€çš„æ ¸å¿ƒç—›ç‚¹ï¼Œä»£ç å¯ç›´æ¥è½åœ°åˆ°åµŒå…¥å¼è®¾å¤‡å’ŒSpring Cloudäº‘ç«¯ç³»ç»Ÿï¼Œå…¼é¡¾äº†å¯é æ€§ã€ä¸€è‡´æ€§å’Œæ•ˆç‡ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å‰ç«¯æ€§èƒ½æ·±åº¦è§£æï¼šç½‘ç»œå“åº”æ—¶é—´ä¸å®é™…æ¸²æŸ“æ—¶é—´çš„é¸¿æ²Ÿ]]></title>    <link>https://juejin.cn/post/7579256547798417449</link>    <guid>https://juejin.cn/post/7579256547798417449</guid>    <pubDate>2025-12-03T06:31:26.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579256547798417449" data-draft-id="7579213860571676726" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å‰ç«¯æ€§èƒ½æ·±åº¦è§£æï¼šç½‘ç»œå“åº”æ—¶é—´ä¸å®é™…æ¸²æŸ“æ—¶é—´çš„é¸¿æ²Ÿ"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:31:26.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é€ƒç¦»ç–¯äººé™¢"/> <meta itemprop="url" content="https://juejin.cn/user/2796759396916189"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å‰ç«¯æ€§èƒ½æ·±åº¦è§£æï¼šç½‘ç»œå“åº”æ—¶é—´ä¸å®é™…æ¸²æŸ“æ—¶é—´çš„é¸¿æ²Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2796759396916189/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é€ƒç¦»ç–¯äººé™¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:31:26.000Z" title="Wed Dec 03 2025 06:31:26 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æ¦‚è¿°</h2>
<p>åœ¨ç°ä»£Webåº”ç”¨ä¸­ï¼Œç»å¸¸å‡ºç°ä¸€ä¸ªç°è±¡ï¼š<strong>Networké¢æ¿æ˜¾ç¤ºè¯·æ±‚å·²å®Œæˆï¼ˆå¦‚è€—æ—¶5ç§’ï¼‰ï¼Œä½†ç”¨æˆ·éœ€è¦ç­‰å¾…æ›´é•¿æ—¶é—´ï¼ˆå¦‚10ç§’ï¼‰æ‰èƒ½åœ¨é¡µé¢ä¸Šçœ‹åˆ°ç»“æœ</strong>ã€‚è¿™ç§å·®å¼‚æ˜¯å‰ç«¯æ€§èƒ½ä¼˜åŒ–çš„æ ¸å¿ƒå…³æ³¨ç‚¹ã€‚</p>
<h2 data-id="heading-1">å…³é”®æ¦‚å¿µæ¾„æ¸…</h2>
<h3 data-id="heading-2">1. æ—¶é—´çº¿å®šä¹‰</h3>
<pre><code class="hljs language-text" lang="text">ç”¨æˆ·å‘èµ·è¯·æ±‚ (0ms)
  â†“
TTFBå¼€å§‹è®¡æ—¶
  â†“
æœåŠ¡å™¨å¤„ç† (æœåŠ¡ç«¯æ—¶é—´)
  â†“
æ”¶åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚ (TTFBç»“æŸ)
  â†“
ä¸‹è½½å“åº”ä½“ (Content Download)
  â†“
âœ… ç½‘ç»œè¯·æ±‚å®Œæˆ (Networké¢æ¿æ˜¾ç¤ºçš„æ€»æ—¶é—´)
  â†“
æµè§ˆå™¨è§£æå“åº”
  â†“
JavaScriptå¤„ç†æ•°æ®
  â†“
DOMè®¡ç®—ä¸æ›´æ–°
  â†“
æ ·å¼è®¡ç®—ä¸å¸ƒå±€
  â†“
æ¸²æŸ“ä¸åˆæˆ
  â†“
âœ… ç”¨æˆ·çœ‹åˆ°å†…å®¹ (å®é™…æ„ŸçŸ¥æ—¶é—´)
</code></pre>
<h3 data-id="heading-3">2. æ ¸å¿ƒæŒ‡æ ‡å¯¹æ¯”</h3>





























<table><thead><tr><th>æŒ‡æ ‡</th><th>æµ‹é‡èŒƒå›´</th><th>å·¥å…·æŸ¥çœ‹ä½ç½®</th><th>å½±å“å› ç´ </th></tr></thead><tbody><tr><td><strong>ç½‘ç»œå“åº”æ—¶é—´</strong></td><td>ä»å‘èµ·è¯·æ±‚åˆ°TCPè¿æ¥å…³é—­</td><td>Networké¢æ¿çš„"Time"åˆ—</td><td>æœåŠ¡å™¨æ€§èƒ½ã€ç½‘ç»œå»¶è¿Ÿã€å“åº”ä½“å¤§å°</td></tr><tr><td><strong>å‰ç«¯å¤„ç†æ—¶é—´</strong></td><td>ä»æ”¶åˆ°æ•°æ®åˆ°ç”¨æˆ·çœ‹åˆ°å†…å®¹</td><td>Performanceé¢æ¿çš„Mainçº¿ç¨‹</td><td>JSæ‰§è¡Œæ•ˆç‡ã€DOMæ“ä½œå¤æ‚åº¦ã€æ¸²æŸ“æ€§èƒ½</td></tr><tr><td><strong>æ€»æ„ŸçŸ¥æ—¶é—´</strong></td><td>ç”¨æˆ·ç‚¹å‡»åˆ°çœ‹åˆ°ç»“æœ</td><td>ç”¨æˆ·ä¸»è§‚æ„Ÿå—</td><td>ä»¥ä¸Šä¸¤è€…ä¹‹å’Œ + å¿ƒç†å› ç´ </td></tr></tbody></table>
<h2 data-id="heading-4">é—®é¢˜æ ¹å› åˆ†æ</h2>
<h3 data-id="heading-5">1. æ•°æ®é‡è¿‡å¤§ï¼ˆæœ€å¸¸è§åŸå› ï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å…¸å‹åœºæ™¯ï¼šä¸€æ¬¡æ€§è¿”å›10000æ¡è®°å½•</span>
{
  <span class="hljs-string">"data"</span>: [
    { <span class="hljs-string">"id"</span>: <span class="hljs-number">1</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Item 1"</span>, ...<span class="hljs-number">20</span>ä¸ªå­—æ®µ },
    { <span class="hljs-string">"id"</span>: <span class="hljs-number">2</span>, <span class="hljs-string">"name"</span>: <span class="hljs-string">"Item 2"</span>, ...<span class="hljs-number">20</span>ä¸ªå­—æ®µ },
    <span class="hljs-comment">// ... 9998 more</span>
  ]
}
<span class="hljs-comment">// é—®é¢˜ï¼š5ç§’ä¸‹è½½ï¼Œ5ç§’JSONè§£æ</span>
</code></pre>
<h3 data-id="heading-6">2. JavaScriptå¤„ç†é˜»å¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æ€§èƒ½ç“¶é¢ˆç¤ºä¾‹</span>
<span class="hljs-title function_">fetch</span>(url).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
  <span class="hljs-comment">// ä»¥ä¸‹æ“ä½œå¯èƒ½è€—æ—¶æ•°ç§’ï¼š</span>
  <span class="hljs-comment">// 1. å¤æ‚æ•°æ®è½¬æ¢</span>
  <span class="hljs-keyword">const</span> processed = data.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> <span class="hljs-title function_">heavyTransform</span>(item))
  
  <span class="hljs-comment">// 2. å¤§é‡DOMæ“ä½œ</span>
  processed.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>)
    <span class="hljs-comment">// å¤æ‚çš„innerHTMLæ‹¼æ¥</span>
    div.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`&lt;div class="card"&gt;
      &lt;h3&gt;<span class="hljs-subst">${item.title}</span>&lt;/h3&gt;
      &lt;p&gt;<span class="hljs-subst">${item.description}</span>&lt;/p&gt;
      &lt;!-- æ›´å¤šåµŒå¥—å…ƒç´  --&gt;
    &lt;/div&gt;`</span>
    container.<span class="hljs-title function_">appendChild</span>(div)
  })
})
</code></pre>
<h3 data-id="heading-7">3. æ¸²æŸ“æµæ°´çº¿é˜»å¡</h3>
<pre><code class="hljs language-text" lang="text">ä¸»çº¿ç¨‹æ—¶é—´çº¿ï¼š
[ç½‘ç»œè¯·æ±‚: 0-5s] â†’ [JSæ‰§è¡Œ: 5-8s] â†’ [æ ·å¼è®¡ç®—: 8-9s] â†’ [å¸ƒå±€: 9-9.5s] â†’ [ç»˜åˆ¶: 9.5-10s]

å¦‚æœJSæ‰§è¡Œè¶…è¿‡50msï¼Œå°±ä¼šé˜»å¡æ¸²æŸ“ï¼Œé€ æˆé¡µé¢"å¡ä½"çš„æ„Ÿè§‰ã€‚
</code></pre>
<h2 data-id="heading-8">è¯Šæ–­æ–¹æ³•è®º</h2>
<h3 data-id="heading-9">1. ä½¿ç”¨Chrome DevToolsè¯Šæ–­</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/065ccbdeaae7491ca0c7fe6c11b0400b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6YCD56a755av5Lq66Zmi:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348344&amp;x-signature=CLmeLjsP2mXDUBhf4K610qy9PHA%3D" alt="deepseek_mermaid_20251203_49b3f7.png" loading="lazy"/></p>
<h3 data-id="heading-10">2. å…³é”®æ£€æŸ¥ç‚¹</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åœ¨ä»£ç ä¸­æ·»åŠ æµ‹é‡ç‚¹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">measurePerformance</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-comment">// é˜¶æ®µ1: ç½‘ç»œæ—¶é—´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'network'</span>)
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">'/api/data'</span>)
  <span class="hljs-keyword">const</span> rawData = <span class="hljs-keyword">await</span> response.<span class="hljs-title function_">text</span>() <span class="hljs-comment">// æ³¨æ„ï¼štext()æ¯”json()å¿«</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'network'</span>) <span class="hljs-comment">// å¯¹åº”Networké¢æ¿æ—¶é—´</span>
  
  <span class="hljs-comment">// é˜¶æ®µ2: JSONè§£ææ—¶é—´ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'json-parse'</span>)
  <span class="hljs-keyword">const</span> data = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(rawData)
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'json-parse'</span>)
  
  <span class="hljs-comment">// é˜¶æ®µ3: æ•°æ®å¤„ç†æ—¶é—´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'data-processing'</span>)
  <span class="hljs-keyword">const</span> processedData = <span class="hljs-title function_">processData</span>(data) <span class="hljs-comment">// ä½ çš„ä¸šåŠ¡é€»è¾‘</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'data-processing'</span>)
  
  <span class="hljs-comment">// é˜¶æ®µ4: DOMæ¸²æŸ“æ—¶é—´</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">time</span>(<span class="hljs-string">'dom-render'</span>)
  <span class="hljs-title function_">renderToDOM</span>(processedData)
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">nextTick</span>() <span class="hljs-comment">// Vue/Reactç­‰å¾…æ›´æ–°</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">timeEnd</span>(<span class="hljs-string">'dom-render'</span>)
}
</code></pre>
<h2 data-id="heading-11">ä¼˜åŒ–ç­–ç•¥ä½“ç³»</h2>
<h3 data-id="heading-12">1. ç½‘ç»œå±‚ä¼˜åŒ–</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸åç«¯åä½œæ–¹æ¡ˆ</span>
<span class="hljs-keyword">const</span> optimizedRequest = {
  <span class="hljs-comment">// æ–¹æ¡ˆ1: åˆ†é¡µ</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/items?page=1&amp;pageSize=50'</span>,
  
  <span class="hljs-comment">// æ–¹æ¡ˆ2: å­—æ®µé€‰æ‹©</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/items?fields=id,name,status'</span>,
  
  <span class="hljs-comment">// æ–¹æ¡ˆ3: å¢é‡æ›´æ–°</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/items?since=2024-01-01T00:00:00Z'</span>,
  
  <span class="hljs-comment">// æ–¹æ¡ˆ4: å‹ç¼©ä¼ è¾“</span>
  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">'Accept-Encoding'</span>: <span class="hljs-string">'gzip, br'</span>
  }
}
</code></pre>
<h3 data-id="heading-13">2. æ•°æ®å¤„ç†ä¼˜åŒ–</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æŠ€æœ¯æ–¹æ¡ˆå¯¹æ¯”</span>
<span class="hljs-keyword">const</span> optimizationTechniques = {
  <span class="hljs-comment">// æ–¹æ¡ˆA: æ—¶é—´åˆ‡ç‰‡ï¼ˆé€‚ç”¨äºReact/Vueï¼‰</span>
  <span class="hljs-attr">timeSlicing</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">processInChunks</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">data, chunkSize = <span class="hljs-number">100</span></span>) =&gt; {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i += chunkSize) {
        <span class="hljs-comment">// æ¯å¤„ç†100æ¡å°±è®©å‡ºä¸»çº¿ç¨‹</span>
        <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">0</span>))
        <span class="hljs-title function_">processChunk</span>(data.<span class="hljs-title function_">slice</span>(i, i + chunkSize))
      }
    }
  },
  
  <span class="hljs-comment">// æ–¹æ¡ˆB: Web Workerï¼ˆCPUå¯†é›†å‹è®¡ç®—ï¼‰</span>
  <span class="hljs-attr">webWorker</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'data-processor.js'</span>)
    worker.<span class="hljs-title function_">postMessage</span>(largeData)
    worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹å¿«é€Ÿæ¸²æŸ“ç»“æœ</span>
      <span class="hljs-title function_">renderLightweight</span>(e.<span class="hljs-property">data</span>)
    }
  },
  
  <span class="hljs-comment">// æ–¹æ¡ˆC: å¢é‡æ¸²æŸ“</span>
  <span class="hljs-attr">incrementalRender</span>: <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// å…ˆæ¸²æŸ“éª¨æ¶ï¼Œç„¶ååˆ†æ‰¹å¡«å……æ•°æ®</span>
    <span class="hljs-title function_">renderSkeleton</span>(<span class="hljs-number">100</span>) <span class="hljs-comment">// ç«‹å³æ˜¾ç¤º100ä¸ªç©ºä½</span>
    data.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-title function_">updateItemAtIndex</span>(index, item)
      }, index * <span class="hljs-number">10</span>) <span class="hljs-comment">// æ¯10msæ›´æ–°ä¸€ä¸ª</span>
    })
  }
}
</code></pre>
<h3 data-id="heading-14">3. æ¸²æŸ“ä¼˜åŒ–</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;!-- è™šæ‹Ÿåˆ—è¡¨å®ç° --&gt;
&lt;template&gt;
  &lt;!-- å›ºå®šé«˜åº¦å®¹å™¨ --&gt;
  &lt;div class="virtual-container" @scroll="handleScroll" ref="container"&gt;
    &lt;!-- å ä½å…ƒç´ ï¼Œæ’‘å¼€æ»šåŠ¨åŒºåŸŸ --&gt;
    &lt;div :style="{ height: totalHeight + 'px' }"&gt;&lt;/div&gt;
    
    &lt;!-- å¯è§†åŒºåŸŸå†…çš„çœŸå®å…ƒç´  --&gt;
    &lt;div
      v-for="item in visibleItems"
      :key="item.id"
      :style="{ transform: `translateY(${item.offset}px)` }"
      class="virtual-item"
    &gt;
      {{ item.content }}
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { computed, ref, onMounted } from 'vue'

const props = defineProps(['items']) // æ‰€æœ‰æ•°æ®
const container = ref(null)
const scrollTop = ref(0)

// è™šæ‹Ÿåˆ—è¡¨æ ¸å¿ƒè®¡ç®—
const itemHeight = 50
const buffer = 5 // ç¼“å†²åŒº

const visibleRange = computed(() =&gt; {
  const start = Math.max(0, Math.floor(scrollTop.value / itemHeight) - buffer)
  const end = Math.min(
    props.items.length,
    Math.ceil((scrollTop.value + containerHeight.value) / itemHeight) + buffer
  )
  return { start, end }
})

const visibleItems = computed(() =&gt; {
  return props.items
    .slice(visibleRange.value.start, visibleRange.value.end)
    .map((item, index) =&gt; ({
      ...item,
      offset: (visibleRange.value.start + index) * itemHeight
    }))
})

const totalHeight = computed(() =&gt; props.items.length * itemHeight)
&lt;/script&gt;
</code></pre>
<h3 data-id="heading-15">4. ç¼“å­˜ç­–ç•¥</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å¤šçº§ç¼“å­˜æ–¹æ¡ˆ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DataCache</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>()
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">indexedDBCache</span> = <span class="hljs-string">'DataCache'</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxMemorySize</span> = <span class="hljs-number">100</span> <span class="hljs-comment">// æœ€å¤§ç¼“å­˜æ¡ç›®æ•°</span>
  }
  
  <span class="hljs-keyword">async</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">key, fetcher</span>) {
    <span class="hljs-comment">// 1. å†…å­˜ç¼“å­˜ï¼ˆæœ€å¿«ï¼‰</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">has</span>(key)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">get</span>(key)
    }
    
    <span class="hljs-comment">// 2. IndexedDBç¼“å­˜ï¼ˆè¾ƒå¤§æ•°æ®ï¼‰</span>
    <span class="hljs-keyword">const</span> dbData = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFromIndexedDB</span>(key)
    <span class="hljs-keyword">if</span> (dbData) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">set</span>(key, dbData)
      <span class="hljs-keyword">return</span> dbData
    }
    
    <span class="hljs-comment">// 3. ç½‘ç»œè¯·æ±‚</span>
    <span class="hljs-keyword">const</span> freshData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetcher</span>()
    
    <span class="hljs-comment">// 4. æ›´æ–°ç¼“å­˜</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">set</span>(key, freshData)
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-property">size</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxMemorySize</span>) {
      <span class="hljs-keyword">const</span> firstKey = <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">next</span>().<span class="hljs-property">value</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">memoryCache</span>.<span class="hljs-title function_">delete</span>(firstKey)
    }
    
    <span class="hljs-comment">// å¼‚æ­¥å­˜å‚¨åˆ°IndexedDB</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveToIndexedDB</span>(key, freshData).<span class="hljs-title function_">catch</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">error</span>)
    
    <span class="hljs-keyword">return</span> freshData
  }
}
</code></pre>
<h2 data-id="heading-16">ç›‘æ§ä¸åº¦é‡</h2>
<h3 data-id="heading-17">1. æ€§èƒ½æŒ‡æ ‡æ”¶é›†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è‡ªåŠ¨åŒ–çš„æ€§èƒ½ç›‘æ§</span>
<span class="hljs-keyword">const</span> performanceMonitor = {
  <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç›‘å¬é•¿ä»»åŠ¡</span>
    <span class="hljs-keyword">const</span> observer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PerformanceObserver</span>(<span class="hljs-function">(<span class="hljs-params">list</span>) =&gt;</span> {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> list.<span class="hljs-title function_">getEntries</span>()) {
        <span class="hljs-keyword">if</span> (entry.<span class="hljs-property">duration</span> &gt; <span class="hljs-number">50</span>) { <span class="hljs-comment">// è¶…è¿‡50msçš„ä»»åŠ¡</span>
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reportLongTask</span>(entry)
        }
      }
    })
    observer.<span class="hljs-title function_">observe</span>({ <span class="hljs-attr">entryTypes</span>: [<span class="hljs-string">'longtask'</span>] })
    
    <span class="hljs-comment">// è‡ªå®šä¹‰æŒ‡æ ‡</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measureFP</span>()  <span class="hljs-comment">// é¦–æ¬¡ç»˜åˆ¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measureFCP</span>() <span class="hljs-comment">// é¦–æ¬¡å†…å®¹ç»˜åˆ¶</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">measureLCP</span>() <span class="hljs-comment">// æœ€å¤§å†…å®¹ç»˜åˆ¶</span>
  },
  
  <span class="hljs-title function_">measureApiPerf</span>(<span class="hljs-params">apiName</span>) {
    <span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>()
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">start</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span>[<span class="hljs-string">`<span class="hljs-subst">${apiName}</span>_start`</span>] = performance.<span class="hljs-title function_">now</span>()
      },
      <span class="hljs-attr">end</span>: <span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>()
        <span class="hljs-keyword">const</span> duration = end - <span class="hljs-variable language_">this</span>.<span class="hljs-property">marks</span>[<span class="hljs-string">`<span class="hljs-subst">${apiName}</span>_start`</span>]
        
        <span class="hljs-comment">// å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">sendMetrics</span>({
          <span class="hljs-attr">name</span>: apiName,
          duration,
          <span class="hljs-attr">type</span>: <span class="hljs-string">'api'</span>,
          <span class="hljs-attr">timestamp</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>()
        })
      }
    }
  }
}
</code></pre>
<h3 data-id="heading-18">2. æ€§èƒ½è¯„åˆ†å¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">generatePerformanceReport</span> = (<span class="hljs-params">metrics</span>) =&gt; {
  <span class="hljs-keyword">const</span> score = {
    <span class="hljs-attr">network</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateNetworkScore</span>(metrics.<span class="hljs-property">ttfb</span>, metrics.<span class="hljs-property">downloadTime</span>),
    <span class="hljs-attr">processing</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateProcessingScore</span>(metrics.<span class="hljs-property">jsTime</span>, metrics.<span class="hljs-property">domTime</span>),
    <span class="hljs-attr">rendering</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateRenderingScore</span>(metrics.<span class="hljs-property">fcp</span>, metrics.<span class="hljs-property">lcp</span>),
    <span class="hljs-attr">overall</span>: <span class="hljs-number">0</span>
  }
  
  score.<span class="hljs-property">overall</span> = (score.<span class="hljs-property">network</span> * <span class="hljs-number">0.3</span> + 
                   score.<span class="hljs-property">processing</span> * <span class="hljs-number">0.4</span> + 
                   score.<span class="hljs-property">rendering</span> * <span class="hljs-number">0.3</span>)
  
  <span class="hljs-keyword">return</span> {
    score,
    <span class="hljs-attr">suggestions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">generateSuggestions</span>(metrics),
    <span class="hljs-attr">bottlenecks</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">identifyBottlenecks</span>(metrics)
  }
}
</code></pre>
<h2 data-id="heading-19">æœ€ä½³å®è·µæ€»ç»“</h2>
<h3 data-id="heading-20">1. å¼€å‘é˜¶æ®µ</h3>
<ul>
<li><strong>å§‹ç»ˆæ·»åŠ æ€§èƒ½æµ‹é‡ä»£ç </strong></li>
<li><strong>ä½¿ç”¨Performance APIè€Œéconsole.time</strong></li>
<li><strong>åœ¨ä½ç«¯è®¾å¤‡ä¸Šæµ‹è¯•</strong></li>
<li><strong>å»ºç«‹æ€§èƒ½å›å½’æµ‹è¯•</strong></li>
</ul>
<h3 data-id="heading-21">2. æ¶æ„è®¾è®¡</h3>
<ul>
<li><strong>é‡‡ç”¨æ¸è¿›å¼åŠ è½½ç­–ç•¥</strong></li>
<li><strong>å®ç°è¯·æ±‚ä¼˜å…ˆçº§é˜Ÿåˆ—</strong></li>
<li><strong>è®¾è®¡ç¼“å­˜å¤±æ•ˆç­–ç•¥</strong></li>
<li><strong>è€ƒè™‘ç¦»çº¿ä¼˜å…ˆæ¶æ„</strong></li>
</ul>
<h3 data-id="heading-22">3. å›¢é˜Ÿåä½œ</h3>
<ul>
<li><strong>å‰åç«¯çº¦å®šæ•°æ®åè®®</strong></li>
<li><strong>å»ºç«‹æ€§èƒ½é¢„ç®—æœºåˆ¶</strong></li>
<li><strong>å®šæœŸè¿›è¡Œæ€§èƒ½è¯„å®¡</strong></li>
<li><strong>å…±äº«æ€§èƒ½ç›‘æ§æ•°æ®</strong></li>
</ul>
<h2 data-id="heading-23">å·¥å…·æ¨è</h2>
<ol>
<li><strong>Chrome DevTools</strong>Â - Performance, Network, Memoryé¢æ¿</li>
<li><strong>Lighthouse</strong>Â - è‡ªåŠ¨åŒ–æ€§èƒ½å®¡è®¡</li>
<li><strong>WebPageTest</strong>Â - å¤šåœ°ç‚¹æ€§èƒ½æµ‹è¯•</li>
<li><strong>Sentry Performance</strong>Â - ç”Ÿäº§ç¯å¢ƒæ€§èƒ½ç›‘æ§</li>
<li><strong>SpeedCurve</strong>Â - é•¿æœŸæ€§èƒ½è¶‹åŠ¿åˆ†æ</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[SpringBooté¡¹ç›®ä½¿ç”¨Rediså¯¹ç”¨æˆ·IPè¿›è¡Œæ¥å£é™æµ]]></title>    <link>https://juejin.cn/post/7579190764771360808</link>    <guid>https://juejin.cn/post/7579190764771360808</guid>    <pubDate>2025-12-03T06:33:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579190764771360808" data-draft-id="7579168400989683747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="SpringBooté¡¹ç›®ä½¿ç”¨Rediså¯¹ç”¨æˆ·IPè¿›è¡Œæ¥å£é™æµ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:33:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é©¬å¡å·´å¡"/> <meta itemprop="url" content="https://juejin.cn/user/1892677617451163"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            SpringBooté¡¹ç›®ä½¿ç”¨Rediså¯¹ç”¨æˆ·IPè¿›è¡Œæ¥å£é™æµ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1892677617451163/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é©¬å¡å·´å¡
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:33:10.000Z" title="Wed Dec 03 2025 06:33:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€æ€è·¯</h2>
<p>ä½¿ç”¨æ¥å£é™æµçš„ä¸»è¦ç›®çš„åœ¨äºæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œé˜²æ­¢æ¥å£è¢«æ¶æ„æ‰“å‡»ï¼ˆçŸ­æ—¶é—´å†…å¤§é‡è¯·æ±‚ï¼‰ã€‚</p>
<p>æ¯”å¦‚è¦æ±‚æŸæ¥å£åœ¨1åˆ†é’Ÿå†…è¯·æ±‚æ¬¡æ•°ä¸è¶…è¿‡1000æ¬¡ï¼Œé‚£ä¹ˆåº”è¯¥å¦‚ä½•è®¾è®¡ä»£ç å‘¢ï¼Ÿ</p>
<p>ä¸‹é¢è®²ä¸¤ç§æ€è·¯ï¼Œå¦‚æœæƒ³çœ‹ä»£ç å¯ç›´æ¥ç¿»åˆ°åé¢çš„ä»£ç éƒ¨åˆ†ã€‚</p>
<h3 data-id="heading-1">1.1 å›ºå®šæ—¶é—´æ®µï¼ˆæ—§æ€è·¯ï¼‰</h3>
<h5 data-id="heading-2">1.1.1 æ€è·¯æè¿°</h5>
<p>è¯¥æ–¹æ¡ˆçš„æ€è·¯æ˜¯ï¼šä½¿ç”¨Redisè®°å½•å›ºå®šæ—¶é—´æ®µå†…æŸç”¨æˆ·IPè®¿é—®æŸæ¥å£çš„æ¬¡æ•°ï¼Œå…¶ä¸­ï¼š</p>
<ul>
<li><strong>Redisçš„key</strong>ï¼šç”¨æˆ·IP + æ¥å£æ–¹æ³•å</li>
<li><strong>Redisçš„value</strong>ï¼šå½“å‰æ¥å£è®¿é—®æ¬¡æ•°ã€‚</li>
</ul>
<p>å½“ç”¨æˆ·åœ¨è¿‘æœŸå†…ç¬¬ä¸€æ¬¡è®¿é—®è¯¥æ¥å£æ—¶ï¼Œå‘Redisä¸­è®¾ç½®ä¸€ä¸ªåŒ…å«äº†ç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åçš„keyï¼Œvalueçš„å€¼åˆå§‹åŒ–ä¸º1ï¼ˆè¡¨ç¤ºç¬¬ä¸€æ¬¡è®¿é—®å½“å‰æ¥å£ï¼‰ã€‚åŒæ—¶ï¼Œè®¾ç½®è¯¥keyçš„è¿‡æœŸæ—¶é—´ï¼ˆæ¯”å¦‚ä¸º60ç§’ï¼‰ã€‚</p>
<p>ä¹‹åï¼Œåªè¦è¿™ä¸ªkeyè¿˜æœªè¿‡æœŸï¼Œç”¨æˆ·æ¯æ¬¡è®¿é—®è¯¥æ¥å£éƒ½ä¼šå¯¼è‡´valueè‡ªå¢1æ¬¡ã€‚</p>
<p>ç”¨æˆ·æ¯æ¬¡è®¿é—®æ¥å£å‰ï¼Œå…ˆä»Redisä¸­æ‹¿åˆ°å½“å‰æ¥å£è®¿é—®æ¬¡æ•°ï¼Œå¦‚æœå‘ç°è®¿é—®æ¬¡æ•°å¤§äºè§„å®šçš„æ¬¡æ•°ï¼ˆå¦‚è¶…è¿‡1000æ¬¡ï¼‰ï¼Œåˆ™å‘ç”¨æˆ·è¿”å›æ¥å£è®¿é—®å¤±è´¥çš„æ ‡è¯†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54f054fa740a4e90883174ad36e4a8bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=7aKWwZRe%2FhWCGezhtN%2BmUS%2FEPz8%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<h5 data-id="heading-3">1.1.2 æ€è·¯ç¼ºé™·</h5>
<p>è¯¥æ–¹æ¡ˆçš„ç¼ºç‚¹åœ¨äºï¼Œé™æµæ—¶é—´æ®µæ˜¯å›ºå®šçš„ã€‚</p>
<p>æ¯”å¦‚è¦æ±‚æŸæ¥å£åœ¨1åˆ†é’Ÿå†…è¯·æ±‚æ¬¡æ•°ä¸è¶…è¿‡1000æ¬¡ï¼Œè§‚å¯Ÿä»¥ä¸‹æµç¨‹ï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0bb81150196445e0824bfa2a1aca4e4b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=utXm2%2Fp2ZxwlDwDvt6JDZfL3yww%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91d00f1e213f424b99d61c377f071dbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=WXgAfcwNsYDiaq%2FlwWBmIoC3WAs%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p>å¯ä»¥å‘ç°ï¼Œ00:59å’Œ01:01ä¹‹é—´ä»…ä»…é—´éš”äº†2ç§’ï¼Œä½†æ¥å£å´è¢«è®¿é—®äº†1000+999=1999æ¬¡ï¼Œæ˜¯é™æµæ¬¡æ•°ï¼ˆ1000æ¬¡ï¼‰çš„2å€ï¼</p>
<p>æ‰€ä»¥åœ¨è¯¥æ–¹æ¡ˆä¸­ï¼Œé™æµæ¬¡æ•°çš„è®¾ç½®å¯èƒ½ä¸èµ·ä½œç”¨ï¼Œä»ç„¶å¯èƒ½åœ¨çŸ­æ—¶é—´å†…é€ æˆå¤§é‡è®¿é—®ã€‚</p>
<h3 data-id="heading-4">1.2 æ»‘åŠ¨çª—å£ï¼ˆæ–°æ€è·¯ï¼‰</h3>
<h5 data-id="heading-5">1.2.1 æ€è·¯æè¿°</h5>
<p>ä¸ºäº†é¿å…å‡ºç°æ–¹æ¡ˆ1ä¸­ç”±äºé”®è¿‡æœŸå¯¼è‡´çš„çŸ­æœŸè®¿é—®é‡å¢å¤§çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥æ”¹å˜ä¸€ä¸‹æ€è·¯ï¼Œä¹Ÿå°±æ˜¯æŠŠå›ºå®šçš„æ—¶é—´æ®µæ”¹æˆåŠ¨æ€çš„ï¼š</p>
<p>å‡è®¾æŸä¸ªæ¥å£åœ¨10ç§’å†…åªå…è®¸è®¿é—®5æ¬¡ã€‚ç”¨æˆ·æ¯æ¬¡è®¿é—®æ¥å£æ—¶ï¼Œè®°å½•å½“å‰ç”¨æˆ·è®¿é—®çš„æ—¶é—´ç‚¹ï¼ˆæ—¶é—´æˆ³ï¼‰ï¼Œå¹¶è®¡ç®—å‰10ç§’å†…ç”¨æˆ·è®¿é—®è¯¥æ¥å£çš„æ€»æ¬¡æ•°ã€‚å¦‚æœæ€»æ¬¡æ•°å¤§äºé™æµæ¬¡æ•°ï¼Œåˆ™ä¸å…è®¸ç”¨æˆ·è®¿é—®è¯¥æ¥å£ã€‚è¿™æ ·å°±èƒ½ä¿è¯åœ¨ä»»æ„æ—¶åˆ»ç”¨æˆ·çš„è®¿é—®æ¬¡æ•°ä¸ä¼šè¶…è¿‡1000æ¬¡ã€‚</p>
<p>å¦‚ä¸‹å›¾ï¼Œå‡è®¾ç”¨æˆ·åœ¨0:19æ—¶é—´ç‚¹è®¿é—®æ¥å£ï¼Œç»æ£€æŸ¥å…¶å‰10ç§’å†…è®¿é—®æ¬¡æ•°ä¸º5æ¬¡ï¼Œåˆ™å…è®¸æœ¬æ¬¡è®¿é—®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/364d41561d0448dc822b4bc85c7c0add~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=yZiKTh6VgOzV3%2F2LUN03BJPlEnA%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<p>å‡è®¾ç”¨æˆ·0:20æ—¶é—´ç‚¹è®¿é—®æ¥å£ï¼Œç»æ£€æŸ¥å…¶å‰10ç§’å†…è®¿é—®æ¬¡æ•°ä¸º6æ¬¡ï¼ˆè¶…å‡ºé™æµæ¬¡æ•°5æ¬¡ï¼‰ï¼Œåˆ™ä¸å…è®¸æœ¬æ¬¡è®¿é—®ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d455c9af884a421280cb9b97aaff4558~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6ams5Y2h5be05Y2h:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348389&amp;x-signature=NlZUBHg9HTvWua4wsvaXkPfPFCw%3D" alt="å›¾ç‰‡" loading="lazy"/><img src="" alt="" loading="lazy"/><img src="" alt="" loading="lazy"/></p>
<p>å›¾ç‰‡</p>
<h5 data-id="heading-6">1.2.2 Rediséƒ¨åˆ†çš„å®ç°</h5>
<p><strong>1ï¼‰é€‰ç”¨ä½•ç§ Redis æ•°æ®ç»“æ„</strong></p>
<p>é¦–å…ˆæ˜¯éœ€è¦ç¡®å®šä½¿ç”¨å“ªä¸ªRedisæ•°æ®ç»“æ„ã€‚ç”¨æˆ·æ¯æ¬¡è®¿é—®æ—¶ï¼Œéœ€è¦ç”¨ä¸€ä¸ªkeyè®°å½•ç”¨æˆ·è®¿é—®çš„æ—¶é—´ç‚¹ï¼Œè€Œä¸”è¿˜éœ€è¦åˆ©ç”¨è¿™äº›æ—¶é—´ç‚¹è¿›è¡ŒèŒƒå›´æ£€æŸ¥ã€‚</p>
<p><strong>2ï¼‰ä¸ºä½•é€‰æ‹© zSet æ•°æ®ç»“æ„</strong></p>
<p>ä¸ºäº†èƒ½å¤Ÿå®ç°èŒƒå›´æ£€æŸ¥ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Redisä¸­çš„zSetæœ‰åºé›†åˆã€‚</p>
<p>æ·»åŠ ä¸€ä¸ªzSetå…ƒç´ çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-css" lang="css">ZADD <span class="hljs-selector-attr">[key]</span> <span class="hljs-selector-attr">[score]</span> <span class="hljs-selector-attr">[member]</span>
</code></pre>
<p>å®ƒæœ‰ä¸€ä¸ªå…³é”®çš„å±æ€§scoreï¼Œé€šè¿‡å®ƒå¯ä»¥è®°å½•å½“å‰memberçš„ä¼˜å…ˆçº§ã€‚</p>
<p>äºæ˜¯æˆ‘ä»¬å¯ä»¥æŠŠscoreè®¾ç½®æˆç”¨æˆ·è®¿é—®æ¥å£çš„æ—¶é—´æˆ³ï¼Œä»¥ä¾¿äºé€šè¿‡scoreè¿›è¡ŒèŒƒå›´æ£€æŸ¥ã€‚keyåˆ™è®°å½•ç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åï¼Œè‡³äºmemberè®¾ç½®æˆä»€ä¹ˆæ²¡æœ‰å½±å“ï¼Œä¸€ä¸ªmemberè®°å½•äº†ç”¨æˆ·è®¿é—®æ¥å£çš„æ—¶é—´ç‚¹ã€‚å› æ­¤memberä¹Ÿå¯ä»¥è®¾ç½®æˆæ—¶é—´æˆ³ã€‚</p>
<p><strong>3ï¼‰zSet å¦‚ä½•è¿›è¡ŒèŒƒå›´æ£€æŸ¥ï¼ˆæ£€æŸ¥å‰å‡ ç§’çš„è®¿é—®æ¬¡æ•°ï¼‰</strong></p>
<p>æ€è·¯æ˜¯ï¼ŒæŠŠç‰¹å®šæ—¶é—´é—´éš”ä¹‹å‰çš„memberéƒ½åˆ æ‰ï¼Œç•™ä¸‹çš„memberå°±æ˜¯æ—¶é—´é—´éš”ä¹‹å†…çš„æ€»è®¿é—®æ¬¡æ•°ã€‚ç„¶åç»Ÿè®¡å½“å‰keyä¸­çš„memberæœ‰å¤šå°‘ä¸ªå³å¯ã€‚</p>
<p>â‘  æŠŠç‰¹å®šæ—¶é—´é—´éš”ä¹‹å‰çš„memberéƒ½åˆ æ‰ã€‚</p>
<p>zSetæœ‰å¦‚ä¸‹å‘½ä»¤ï¼Œç”¨äºåˆ é™¤scoreèŒƒå›´åœ¨<code>[min~max]</code>ä¹‹é—´çš„memberï¼š</p>
<pre><code class="hljs language-css" lang="css">Zremrangebyscore <span class="hljs-selector-attr">[key]</span> <span class="hljs-selector-attr">[min]</span> <span class="hljs-selector-attr">[max]</span>
</code></pre>
<p>å‡è®¾é™æµæ—¶é—´è®¾ç½®ä¸º5ç§’ï¼Œå½“å‰ç”¨æˆ·è®¿é—®æ¥å£æ—¶ï¼Œè·å–å½“å‰ç³»ç»Ÿæ—¶é—´æˆ³ä¸º<code>currentTimeMill</code>ï¼Œé‚£ä¹ˆåˆ é™¤çš„scoreèŒƒå›´å¯ä»¥è®¾ç½®ä¸ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">min</span> = <span class="hljs-number">0</span>
<span class="hljs-attr">max</span> = currentTimeMill - <span class="hljs-number">5</span> * <span class="hljs-number">1000</span>
</code></pre>
<p>ç›¸å½“äºæŠŠ5ç§’ä¹‹å‰çš„æ‰€æœ‰memberéƒ½åˆ é™¤äº†ï¼Œåªç•™ä¸‹å‰5ç§’å†…çš„keyã€‚</p>
<p>â‘¡ ç»Ÿè®¡ç‰¹å®škeyä¸­å·²å­˜åœ¨çš„memberæœ‰å¤šå°‘ä¸ªã€‚</p>
<p>zSetæœ‰å¦‚ä¸‹å‘½ä»¤ï¼Œç”¨äºç»Ÿè®¡æŸä¸ªkeyçš„memberæ€»æ•°ï¼š</p>
<pre><code class="hljs language-css" lang="css">Â ZCARD <span class="hljs-selector-attr">[key]</span>
</code></pre>
<p>ç»Ÿè®¡çš„keyçš„memberæ€»æ•°ï¼Œå°±æ˜¯å½“å‰æ¥å£å·²ç»è®¿é—®çš„æ¬¡æ•°ã€‚å¦‚æœè¯¥æ•°ç›®å¤§äºé™æµæ¬¡æ•°ï¼Œåˆ™è¯´æ˜å½“å‰çš„è®¿é—®åº”è¢«é™æµã€‚</p>
<h2 data-id="heading-7">äºŒã€ä»£ç å®ç°</h2>
<p>ä¸»è¦æ˜¯ä½¿ç”¨æ³¨è§£ + AOPçš„å½¢å¼å®ç°ã€‚</p>
<h3 data-id="heading-8">2.1 å›ºå®šæ—¶é—´æ®µæ€è·¯</h3>
<p>ä½¿ç”¨äº†luaè„šæœ¬ã€‚</p>
<ul>
<li>å‚è€ƒï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fqq_43641418%2Farticle%2Fdetails%2F127764462" target="_blank" title="https://blog.csdn.net/qq_43641418/article/details/127764462" ref="nofollow noopener noreferrer">blog.csdn.net/qq_43641418â€¦</a></li>
</ul>
<h5 data-id="heading-9">2.1.1 é™æµæ³¨è§£</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-variable">@Target</span>(ElementType.METHOD)
public <span class="hljs-variable">@interface</span> RateLimiter {

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ—¶é—´ï¼Œå•ä½ç§’
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">time</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">5</span>;

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ¬¡æ•°
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">count</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">10</span>;
}
</code></pre>
<h5 data-id="heading-10">2.1.2 å®šä¹‰luaè„šæœ¬</h5>
<p>åœ¨<code>resources/lua</code>ä¸‹æ–°å»º<code>limit.lua</code>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- è·å–redisé”®</span>
<span class="hljs-keyword">local</span>Â key <span class="hljs-operator">=</span> KEYS[<span class="hljs-number">1</span>]
<span class="hljs-comment">-- è·å–ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆæ¬¡æ•°ï¼‰</span>
<span class="hljs-keyword">local</span>Â count <span class="hljs-operator">=</span> tonumber(ARGV[<span class="hljs-number">1</span>])
<span class="hljs-comment">-- è·å–ç¬¬äºŒä¸ªå‚æ•°ï¼ˆæ—¶é—´ï¼‰</span>
<span class="hljs-keyword">local</span>Â <span class="hljs-type">time</span> <span class="hljs-operator">=</span> tonumber(ARGV[<span class="hljs-number">2</span>])
<span class="hljs-comment">-- è·å–å½“å‰æµé‡</span>
<span class="hljs-keyword">local</span>Â <span class="hljs-keyword">current</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'get'</span>, key);
<span class="hljs-comment">-- å¦‚æœcurrentå€¼å­˜åœ¨ï¼Œä¸”å€¼å¤§äºè§„å®šçš„æ¬¡æ•°ï¼Œåˆ™æ‹’ç»æ”¾è¡Œï¼ˆç›´æ¥è¿”å›å½“å‰æµé‡ï¼‰</span>
ifÂ <span class="hljs-keyword">current</span> <span class="hljs-keyword">and</span> tonumber(<span class="hljs-keyword">current</span>) <span class="hljs-operator">&gt;</span> countÂ <span class="hljs-keyword">then</span>
Â  Â Â <span class="hljs-keyword">return</span>Â tonumber(<span class="hljs-keyword">current</span>)
<span class="hljs-keyword">end</span>
<span class="hljs-comment">-- å¦‚æœå€¼å°äºè§„å®šæ¬¡æ•°ï¼Œæˆ–å€¼ä¸å­˜åœ¨ï¼Œåˆ™å…è®¸æ”¾è¡Œï¼Œå½“å‰æµé‡æ•°+1 Â (å€¼ä¸å­˜åœ¨æƒ…å†µä¸‹ï¼Œå¯ä»¥è‡ªå¢å˜ä¸º1)</span>
<span class="hljs-keyword">current</span> <span class="hljs-operator">=</span> redis.call(<span class="hljs-string">'incr'</span>, key);
<span class="hljs-comment">-- å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›æ¥ï¼Œé‚£ä¹ˆå¼€å§‹è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´ã€‚</span>
ifÂ tonumber(<span class="hljs-keyword">current</span>) <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-number">1</span>Â <span class="hljs-keyword">then</span>
Â  Â  redis.call(<span class="hljs-string">'expire'</span>, key, <span class="hljs-type">time</span>);
<span class="hljs-keyword">end</span>
<span class="hljs-comment">-- è¿”å›å½“å‰æµé‡</span>
<span class="hljs-keyword">return</span>Â tonumber(<span class="hljs-keyword">current</span>)
</code></pre>
<h5 data-id="heading-11">2.1.3 æ³¨å…¥Luaæ‰§è¡Œè„šæœ¬</h5>
<p>å…³é”®ä»£ç æ˜¯<code>limitScript()</code>æ–¹æ³•</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisConfig</span> {

Â  Â  <span class="hljs-meta">@Bean</span>
Â  Â  <span class="hljs-keyword">public</span> <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; <span class="hljs-title function_">redisTemplate</span>(<span class="hljs-params">RedisConnectionFactory connectionFactory</span>) {
Â  Â  Â  Â  <span class="hljs-title class_">RedisTemplate</span>&lt;<span class="hljs-title class_">Object</span>, <span class="hljs-title class_">Object</span>&gt; redisTemplate = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisTemplate</span>&lt;&gt;();
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setConnectionFactory</span>(connectionFactory);
Â  Â  Â  Â  <span class="hljs-comment">// ä½¿ç”¨Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–(é»˜è®¤é‡‡ç”¨çš„æ˜¯JDKåºåˆ—åŒ–)</span>
Â  Â  Â  Â  <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>&lt;<span class="hljs-title class_">Object</span>&gt; jackson2JsonRedisSerializer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jackson2JsonRedisSerializer</span>&lt;&gt;(<span class="hljs-title class_">Object</span>.<span class="hljs-property">class</span>);
Â  Â  Â  Â  <span class="hljs-title class_">ObjectMapper</span> om = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectMapper</span>();
Â  Â  Â  Â  om.<span class="hljs-title function_">setVisibility</span>(<span class="hljs-title class_">PropertyAccessor</span>.<span class="hljs-property">ALL</span>, <span class="hljs-title class_">JsonAutoDetect</span>.<span class="hljs-property">Visibility</span>.<span class="hljs-property">ANY</span>);
Â  Â  Â  Â  om.<span class="hljs-title function_">enableDefaultTyping</span>(<span class="hljs-title class_">ObjectMapper</span>.<span class="hljs-property">DefaultTyping</span>.<span class="hljs-property">NON_FINAL</span>);
Â  Â  Â  Â  jackson2JsonRedisSerializer.<span class="hljs-title function_">setObjectMapper</span>(om);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setKeySerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setValueSerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setHashKeySerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â  redisTemplate.<span class="hljs-title function_">setHashValueSerializer</span>(jackson2JsonRedisSerializer);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â redisTemplate;
Â  Â  }


Â  Â  <span class="hljs-comment">/**
Â  Â  Â * è§£æluaè„šæœ¬çš„bean
Â  Â  Â */</span>
Â  Â  <span class="hljs-meta">@Bean</span>(<span class="hljs-string">"limitScript"</span>)
Â  Â  <span class="hljs-keyword">public</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;<span class="hljs-title class_">Long</span>&gt;Â <span class="hljs-title function_">limitScript</span>(<span class="hljs-params"/>) {
Â  Â  Â  Â  <span class="hljs-title class_">DefaultRedisScript</span>&lt;<span class="hljs-title class_">Long</span>&gt; redisScript = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultRedisScript</span>&lt;&gt;();
Â  Â  Â  Â  redisScript.<span class="hljs-title function_">setScriptSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ResourceScriptSource</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassPathResource</span>(<span class="hljs-string">"lua/limit.lua"</span>)));
Â  Â  Â  Â  redisScript.<span class="hljs-title function_">setResultType</span>(<span class="hljs-title class_">Long</span>.<span class="hljs-property">class</span>);
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â redisScript;
Â  Â  }
}
</code></pre>
<h5 data-id="heading-12">2.1.3 å®šä¹‰Aopåˆ‡é¢ç±»</h5>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RateLimiterAspect</span> {
Â <span class="hljs-meta">@Autowired</span>
Â  Â  <span class="hljs-keyword">private</span> RedisTemplate redisTemplate;
Â  Â  <span class="hljs-meta">@Autowired</span>
Â  Â  <span class="hljs-keyword">private</span> RedisScript&lt;Long&gt; limitScript;

Â <span class="hljs-meta">@Before("@annotation(rateLimiter)")</span>
Â  Â  <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBefore</span><span class="hljs-params">(JoinPoint point, RateLimiter rateLimiter)</span> <span class="hljs-keyword">throws</span> Throwable {
Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">time</span> <span class="hljs-operator">=</span> rateLimiter.time();
Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> rateLimiter.count();

Â  Â  Â  Â  <span class="hljs-type">String</span> <span class="hljs-variable">combineKey</span> <span class="hljs-operator">=</span> getCombineKey(rateLimiter.type(), point);
Â  Â  Â  Â  List&lt;String&gt; keys = Collections.singletonList(combineKey);
Â  Â  Â  Â  <span class="hljs-keyword">try</span> {
Â  Â  Â  Â  Â  Â  <span class="hljs-type">Long</span> <span class="hljs-variable">number</span> <span class="hljs-operator">=</span> (Long) redisTemplate.execute(limitScript, keys, count, time);
Â  Â  Â  Â  Â  Â  <span class="hljs-comment">// å½“å‰æµé‡numberå·²è¶…è¿‡é™åˆ¶ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</span>
Â  Â  Â  Â  Â  Â Â <span class="hljs-keyword">if</span>Â (number == <span class="hljs-literal">null</span> || number.intValue() &gt; count) {
Â  Â  Â  Â  Â  Â  Â <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•"</span>);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  log.info(<span class="hljs-string">"[limit] é™åˆ¶è¯·æ±‚æ•°'{}',å½“å‰è¯·æ±‚æ•°'{}',ç¼“å­˜key'{}'"</span>, count, number.intValue(), combineKey);
Â  Â  Â  Â  } <span class="hljs-keyword">catch</span> (Exception ex) {
Â  Â  Â  Â  Â  Â  ex.printStackTrace();
Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">"æœåŠ¡å™¨é™æµå¼‚å¸¸ï¼Œè¯·ç¨å€™å†è¯•"</span>);
Â  Â  Â  Â  }
Â  Â  }
Â  Â Â 
Â  Â  <span class="hljs-comment">/**
Â  Â  Â * æŠŠç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åæ‹¼æ¥æˆ redis çš„ key
Â  Â  Â * <span class="hljs-doctag">@param</span> point åˆ‡å…¥ç‚¹
Â  Â  Â * <span class="hljs-doctag">@return</span>Â ç»„åˆkey
Â  Â  Â */</span>
Â  Â  <span class="hljs-keyword">private</span> String <span class="hljs-title function_">getCombineKey</span><span class="hljs-params">(JoinPoint point)</span> {
Â  Â  Â  Â  <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">sb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>(<span class="hljs-string">"rate_limit:"</span>);
Â  Â  Â  Â  <span class="hljs-type">ServletRequestAttributes</span> <span class="hljs-variable">attributes</span> <span class="hljs-operator">=</span> (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();
Â  Â  Â  Â  <span class="hljs-type">HttpServletRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> attributes.getRequest();
Â  Â  Â  Â  sb.append( Utils.getIpAddress(request) );
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-type">MethodSignature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> (MethodSignature) point.getSignature();
Â  Â  Â  Â  <span class="hljs-type">Method</span> <span class="hljs-variable">method</span> <span class="hljs-operator">=</span> signature.getMethod();
Â  Â  Â  Â  Class&lt;?&gt; targetClass = method.getDeclaringClass();
Â  Â  Â  Â  <span class="hljs-comment">// keyPrefix +Â "-"Â + class +Â "-"Â + method</span>
Â  Â  Â  Â Â <span class="hljs-keyword">return</span>Â sb.append(<span class="hljs-string">"-"</span>).append( targetClass.getName() )
Â  Â  Â  Â  Â  Â  Â  Â  .append(<span class="hljs-string">"-"</span>).append(method.getName()).toString();
Â  Â  }
}
</code></pre>
<h3 data-id="heading-13">2.2 æ»‘åŠ¨çª—å£æ€è·¯</h3>
<h5 data-id="heading-14">2.2.1 é™æµæ³¨è§£</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Retention</span>(RetentionPolicy.RUNTIME)
<span class="hljs-variable">@Target</span>(ElementType.METHOD)
public <span class="hljs-variable">@interface</span> RateLimiter {

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ—¶é—´ï¼Œå•ä½ç§’
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">time</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">5</span>;

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * é™æµæ¬¡æ•°
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">count</span>() <span class="hljs-selector-tag">default</span> <span class="hljs-number">10</span>;
}
</code></pre>
<h5 data-id="heading-15">2.2.2 å®šä¹‰Aopåˆ‡é¢ç±»</h5>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Slf4j</span>
<span class="hljs-variable">@Aspect</span>
<span class="hljs-variable">@Component</span>
public class RateLimiterAspect {

Â  Â  <span class="hljs-variable">@Autowired</span>
Â  Â  private RedisTemplate redisTemplate;

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * å®ç°é™æµï¼ˆæ–°æ€è·¯ï¼‰
Â  Â  Â * @param point
Â  Â  Â * @param rateLimiter
Â  Â  Â * @throws Throwable
Â  Â  Â */</span>
Â  Â  <span class="hljs-variable">@SuppressWarnings</span>(<span class="hljs-string">"unchecked"</span>)
Â  Â  <span class="hljs-variable">@Before</span>(<span class="hljs-string">"@annotation(rateLimiter)"</span>)
Â  Â  public void <span class="hljs-built_in">doBefore</span>(JoinPoint point, RateLimiter rateLimiter) throws Throwable {
Â  Â  Â  Â  <span class="hljs-comment">// åœ¨ {time} ç§’å†…ä»…å…è®¸è®¿é—® {count} æ¬¡ã€‚</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">time</span> = <span class="hljs-selector-tag">rateLimiter</span><span class="hljs-selector-class">.time</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">int</span> <span class="hljs-selector-tag">count</span> = <span class="hljs-selector-tag">rateLimiter</span><span class="hljs-selector-class">.count</span>();
Â  Â  Â  Â  <span class="hljs-comment">// æ ¹æ®ç”¨æˆ·IPï¼ˆå¯é€‰ï¼‰å’Œæ¥å£æ–¹æ³•ï¼Œæ„é€ key</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">combineKey</span> = <span class="hljs-selector-tag">getCombineKey</span>(rateLimiter.<span class="hljs-built_in">type</span>(), point);
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-comment">// é™æµé€»è¾‘å®ç°</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">ZSetOperations</span> <span class="hljs-selector-tag">zSetOperations</span> = <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.opsForZSet</span>();
Â  Â  Â  Â  <span class="hljs-comment">// è®°å½•æœ¬æ¬¡è®¿é—®çš„æ—¶é—´ç»“ç‚¹</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">long</span> <span class="hljs-selector-tag">currentMs</span> = <span class="hljs-selector-tag">System</span><span class="hljs-selector-class">.currentTimeMillis</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">zSetOperations</span><span class="hljs-selector-class">.add</span>(combineKey, currentMs, currentMs);
Â  Â  Â  Â  <span class="hljs-comment">// è¿™ä¸€æ­¥æ˜¯ä¸ºäº†é˜²æ­¢memberä¸€ç›´å­˜åœ¨äºå†…å­˜ä¸­</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">redisTemplate</span><span class="hljs-selector-class">.expire</span>(combineKey, time, TimeUnit.SECONDS);
Â  Â  Â  Â  <span class="hljs-comment">// ç§»é™¤{time}ç§’ä¹‹å‰çš„è®¿é—®è®°å½•ï¼ˆæ»‘åŠ¨çª—å£æ€æƒ³ï¼‰</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">zSetOperations</span><span class="hljs-selector-class">.removeRangeByScore</span>(combineKey, <span class="hljs-number">0</span>, currentMs - time * <span class="hljs-number">1000</span>);
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-comment">// è·å¾—å½“å‰çª—å£å†…çš„è®¿é—®è®°å½•æ•°</span>
Â  Â  Â  Â  <span class="hljs-selector-tag">Long</span> <span class="hljs-selector-tag">currCount</span> = <span class="hljs-selector-tag">zSetOperations</span><span class="hljs-selector-class">.zCard</span>(combineKey);
Â  Â  Â  Â  <span class="hljs-comment">// é™æµåˆ¤æ–­</span>
Â  Â  Â  Â Â <span class="hljs-selector-tag">if</span>Â (currCount &gt; count) {
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-tag">log</span><span class="hljs-selector-class">.error</span>(<span class="hljs-string">"[limit] é™åˆ¶è¯·æ±‚æ•°'{}',å½“å‰è¯·æ±‚æ•°'{}',ç¼“å­˜key'{}'"</span>, count, currCount, combineKey);
Â  Â  Â  Â  Â  Â  <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RuntimeException</span>(<span class="hljs-string">"è®¿é—®è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•!"</span>);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  <span class="hljs-comment">/**
Â  Â  Â * æŠŠç”¨æˆ·IPå’Œæ¥å£æ–¹æ³•åæ‹¼æ¥æˆ redis çš„ key
Â  Â  Â * @param point åˆ‡å…¥ç‚¹
Â  Â  Â * @returnÂ ç»„åˆkey
Â  Â  Â */</span>
Â  Â  <span class="hljs-selector-tag">private</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">getCombineKey</span>(JoinPoint point) {
Â  Â  Â  Â  <span class="hljs-selector-tag">StringBuilder</span> <span class="hljs-selector-tag">sb</span> = <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">StringBuilder</span>(<span class="hljs-string">"rate_limit:"</span>);
Â  Â  Â  Â  <span class="hljs-selector-tag">ServletRequestAttributes</span> <span class="hljs-selector-tag">attributes</span> = (ServletRequestAttributes) <span class="hljs-selector-tag">RequestContextHolder</span><span class="hljs-selector-class">.getRequestAttributes</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">HttpServletRequest</span> <span class="hljs-selector-tag">request</span> = <span class="hljs-selector-tag">attributes</span><span class="hljs-selector-class">.getRequest</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">sb</span><span class="hljs-selector-class">.append</span>( Utils.<span class="hljs-built_in">getIpAddress</span>(request) );
Â  Â  Â  Â Â 
Â  Â  Â  Â  <span class="hljs-selector-tag">MethodSignature</span> <span class="hljs-selector-tag">signature</span> = (MethodSignature) <span class="hljs-selector-tag">point</span><span class="hljs-selector-class">.getSignature</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">Method</span> <span class="hljs-selector-tag">method</span> = <span class="hljs-selector-tag">signature</span><span class="hljs-selector-class">.getMethod</span>();
Â  Â  Â  Â  <span class="hljs-selector-tag">Class</span>&lt;?&gt; <span class="hljs-selector-tag">targetClass</span> = <span class="hljs-selector-tag">method</span><span class="hljs-selector-class">.getDeclaringClass</span>();
Â  Â  Â  Â  <span class="hljs-comment">// keyPrefix +Â "-"Â + class +Â "-"Â + method</span>
Â  Â  Â  Â Â <span class="hljs-selector-tag">return</span>Â <span class="hljs-selector-tag">sb</span><span class="hljs-selector-class">.append</span>(<span class="hljs-string">"-"</span>)<span class="hljs-selector-class">.append</span>( targetClass.<span class="hljs-built_in">getName</span>() )
Â  Â  Â  Â  Â  Â  Â  Â  <span class="hljs-selector-class">.append</span>(<span class="hljs-string">"-"</span>)<span class="hljs-selector-class">.append</span>(method.<span class="hljs-built_in">getName</span>())<span class="hljs-selector-class">.toString</span>();
Â  Â  }
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[Spring] Springé…ç½®æ–‡ä»¶]]></title>    <link>https://juejin.cn/post/7579167622106873856</link>    <guid>https://juejin.cn/post/7579167622106873856</guid>    <pubDate>2025-12-03T06:33:46.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7579167622106873856" data-draft-id="7579168400989667363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[Spring] Springé…ç½®æ–‡ä»¶"/> <meta itemprop="keywords" content="Spring,åç«¯"/> <meta itemprop="datePublished" content="2025-12-03T06:33:46.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaæ°´è§£"/> <meta itemprop="url" content="https://juejin.cn/user/2441349519143037"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [Spring] Springé…ç½®æ–‡ä»¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2441349519143037/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaæ°´è§£
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-12-03T06:33:46.000Z" title="Wed Dec 03 2025 06:33:46 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-12-03
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">## 1.Â é…ç½®æ–‡ä»¶å¿«é€Ÿä¸Šæ‰‹</h2>
<p>æˆ‘ä»¬åœ¨å‰é¢è®²è§£Tomcatçš„æ—¶å€™,é»˜è®¤çš„ç«¯å£å·æ˜¯8080,å¦‚æœæˆ‘ä»¬æœ‰çš„ç¨‹åºè®¿é—®çš„ç«¯å£å·ä¹Ÿæ˜¯8080çš„æ—¶å€™,è¿™æ—¶å€™å°±ä¼šå‘ç”Ÿç«¯å£å·å†²çª,<em>æ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡é…ç½®æ–‡ä»¶æ¥ä¿®æ”¹ç¨‹åºè¿è¡Œæ—¶çš„ç«¯å£å·</em>.åœ¨é¡¹ç›®åˆ›å»ºçš„æ—¶å€™,å°±å¸®æˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºäº†ä¸€ä¸ªé…ç½®æ–‡ä»¶.ä»–çš„åç¼€æ˜¯<code>.properties</code>.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91841eef96f5487daa5432379c3f99ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=Xhl72I3vV58ElSxgtRtns8CYgGI%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
æˆ‘ä»¬ç‚¹å¼€é…ç½®æ–‡ä»¶ä¿®æ”¹ç¨‹åºçš„ç«¯å£å·:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.application.name</span>=demo
<span class="hljs-attr">server.port</span>=<span class="hljs-number">9090</span>

AIå†™ä»£ç 
12
</code></pre>
<p>è¿è¡Œç¨‹åº:æˆ‘ä»¬å¯ä»¥å‘ç°ç¨‹åºçš„ç«¯å£å·å˜æˆäº†9090.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cd314c8106a64871a343b603a0fcbea2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=xFkMFY%2BnCi%2Fgs6pcAt%2B8cpNdyxQ%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
è¿™æ—¶å€™æˆ‘ä»¬é€šè¿‡8080ç«¯å£å·è®¿é—®å…¶ä¸­çš„htmlé¡µé¢çš„æ—¶å€™,å°±æ— æ³•è®¿é—®äº†.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f04dc281a47042bf8fec19273d6d061a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=aDnSBDS7sI2TaUQE753TLiEyNAs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-1"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>2. é…ç½®æ–‡ä»¶çš„æ ¼å¼</h3>
<p>SpringBootçš„é…ç½®æ–‡ä»¶æœ‰ä»¥ä¸‹ä¸‰ç§:<br/>
â€¢ application.properties<br/>
â€¢ application.yml<br/>
â€¢ application.yaml<br/>
å…¶ä¸­ymlæ ¼å¼å’Œyamlæ ¼å¼å…¶å®æ˜¯ç­‰åŒçš„.ymlæ˜¯yamlçš„ç¼©å†™.<br/>
<em>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯,é…ç½®æ–‡ä»¶çš„æ–‡ä»¶ååªèƒ½æ˜¯ä»¥ä¸Šä¸‰ä¸ª,æ–‡ä»¶åä¸€æ—¦ä¿®æ”¹,é…ç½®æ–‡ä»¶å°±ä¼šå˜æˆæ— æ•ˆé…ç½®æ–‡ä»¶</em>.</p>
<ul>
<li>
<p>ç‰¹æ®Šè¯´æ˜:</p>
<ol>
<li>å¦‚æœpropertieså’Œymlå­˜åœ¨äºåŒä¸€ä¸ªé¡¹ç›®çš„æ—¶å€™,ä¸¤ä¸ªé…ç½®éƒ½ä¼šåŠ è½½,ä½†æ˜¯å¦‚æœ<strong>é…ç½®æ–‡ä»¶å†…å®¹æœ‰å†²çªçš„æ—¶å€™,.propertiesæ–‡ä»¶çš„ä¼˜å…ˆçº§æ›´é«˜</strong>.</li>
<li>è™½ç„¶ä»–ä»¬å¯ä»¥å…±å­˜,ä½†æ˜¯æˆ‘ä»¬åœ¨å®é™…çš„ä¹Ÿä¸šåŠ¡å½“ä¸­,æˆ‘ä»¬ä¸€èˆ¬åªä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æ¥é…ç½®,è¿™æ ·å¯ä»¥æ›´å¥½çš„ç»´æŠ¤.</li>
</ol>
</li>
</ul>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3. propertiesé…ç½®æ–‡ä»¶çš„è¯´æ˜</h3>
<p>propertiesé…ç½®æ–‡ä»¶æ˜¯æœ€æ—©æœŸçš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼Œä¹Ÿæ˜¯åˆ›å»ºSpringBooté¡¹ç›®é»˜è®¤çš„é…ç½®æ–‡ä»¶</p>
<h4 data-id="heading-3"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.1 propertiesåŸºæœ¬è¯­æ³•</h4>
<p>propertiesæ˜¯ä»¥<em>é”®å€¼çš„å½¢å¼é…ç½®</em>çš„,å•è¯å’Œå•è¯ä¹‹é—´ç”¨<code>.</code>åˆ†å‰²,å°±åƒå¯¼åŒ…ä¸€æ ·.keyå’Œvalueä¹‹é—´æ˜¯ä»¥<code>=</code>è¿æ¥çš„.æ¯”å¦‚:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.application.name</span>=demo
<span class="hljs-attr">server.port</span>=<span class="hljs-number">9090</span>
<span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/mycnblog?characterEncoding=utf8&amp;useSSL=<span class="hljs-literal">false</span>
<span class="hljs-attr">spring.datasource.name</span>=root
<span class="hljs-attr">spring.datasource.password</span>=qwe123524

AIå†™ä»£ç 
12345
</code></pre>
<p>[æç¤º] é…ç½®æ–‡ä»¶ä¸­å¯ä»¥é€šè¿‡åœ¨å‰é¢åŠ <code>#</code>æ¥æ³¨é‡Šä¿¡æ¯.</p>
<h4 data-id="heading-4"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.2 è¯»å–é…ç½®æ–‡ä»¶</h4>
<p>å¦‚æœåœ¨é¡¹ç›®ä¸­,æƒ³è¦è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹,å¯ä»¥ä½¿ç”¨<code>@Value</code>æ³¨è§£æ¥å®ç°.<code>@Value</code>æ³¨è§£åœ¨åé¢çš„å‚æ•°ä¸­ä½¿ç”¨<code>${}</code>çš„æ ¼å¼æ¥è¯»å–,ä»£ç å¦‚ä¸‹:</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/demo"</span>)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PropertiesController</span> {
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${mykey.key}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String key;
    <span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/key"</span>)</span>
    <span class="hljs-keyword">public</span> String key(){
        <span class="hljs-keyword">return</span> key;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ff16092c25a4eafaeda1003e19d2148~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=nHvkPPfIy3MsNW9vV1CE1rlIVkE%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h4 data-id="heading-5"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>3.3 propertiesçš„ç¼ºç‚¹</h4>
<p>propertiesé…ç½®æ–‡ä»¶æ˜¯ä»¥key-Valueçš„å½¢å¼æ¥é…ç½®çš„,ä½†æ˜¯æœ‰çš„æ—¶å€™,é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯æœ‰äº›èµ˜ä½™,æ¯”å¦‚ä¸‹é¢çš„é…ç½®,<code>spring.datasource</code>è¿™ä¸ªå†…å®¹å°±æ˜¯èµ˜ä½™çš„:</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.datasource.url</span>=jdbc:mysql://<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3306</span>/mycnblog?characterEncoding=utf8&amp;useSSL=<span class="hljs-literal">false</span>
<span class="hljs-attr">spring.datasource.name</span>=root
<span class="hljs-attr">spring.datasource.password</span>=qwe123524

AIå†™ä»£ç 
123
</code></pre>
<p>è¦æƒ³è§£å†³è¿™ä¸ªé—®é¢˜,æˆ‘ä»¬éœ€è¦å¼•å…¥ymlé…ç½®æ–‡ä»¶çš„æ ¼å¼äº†.</p>
<h3 data-id="heading-6"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.ymlé…ç½®æ–‡ä»¶è¯´æ˜</h3>
<h4 data-id="heading-7"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.1 ymlåŸºæœ¬è¯­æ³•</h4>
<p>ymlæ˜¯æ ‘å½¢ç»“æ„çš„é…ç½®æ–‡ä»¶,ä»–çš„åŸºç¡€è¯­æ³•æ˜¯:<code>key: value</code>,éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯,<em>keyå’Œvalueä¹‹é—´çš„ç©ºæ ¼ä¸å¯ä»¥çœç•¥</em>.<br/>
åŸºç¡€è¯­æ³•å¦‚ä¸‹:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/208948300d234f9fa1d28e9bc0431758~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=z%2BhZJiRLWofRN2fHxJTjqcoxQuU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
æˆ‘ä»¬çœ‹åˆ°,è¦æ˜¯ymlçš„é”®å€¼å¯¹ä¸­é—´æ²¡æœ‰ç©ºæ ¼çš„è¯,keyæ˜¯æ²¡æœ‰è¯­æ³•é«˜äº®çš„,è¯­æ³•å°±æ˜¯é”™è¯¯çš„.<br/>
ä¸‹é¢æˆ‘ä»¬å°±æŠŠä¸Šé¢è¿æ¥æ•°æ®åº“çš„æ¡ˆä¾‹æ”¹å†™ä¸ºymlçš„æ ¼å¼.</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://127.0.0.1:3306/mycnblog?characterEncoding=utf8&amp;useSSL=false</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-string">qwe123524</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">12345</span>
</code></pre>
<p>æˆ‘ä»¬çœ‹åˆ°,å‰é¢æˆ‘ä»¬æ‰€è¯´çš„"èµ˜ä½™"çš„ä¿¡æ¯,<em>åœ¨ymlä¸‹å¯ä»¥åˆå¹¶åˆ°ä¸€èµ·å†™äº†</em>.<strong>è¿™é‡Œè¡Œä¸è¡Œä¹‹é—´çš„ç¼©è¿›ä¸€èˆ¬æ˜¯ä¸¤ä¸ªç©ºæ ¼</strong>.</p>
<h4 data-id="heading-8"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2 ymlä½¿ç”¨è¿›é˜¶</h4>
<h5 data-id="heading-9"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.1 ymlé…ç½®ä¸åŒçš„æ•°æ®ç±»å‹åŠå…¶null</h5>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment"># å­—ç¬¦ä¸² </span>
<span class="hljs-keyword">string</span>.value: Hello
<span class="hljs-comment"># å¸ƒå°”å€¼ï¼Œtrueæˆ–false </span>
<span class="hljs-keyword">boolean</span>.value: <span class="hljs-literal">true</span>
<span class="hljs-keyword">boolean</span>.value1: <span class="hljs-literal">false</span>
<span class="hljs-comment"># æ•´æ•° </span>
<span class="hljs-keyword">int</span>.value: <span class="hljs-number">10</span>
<span class="hljs-comment"># æµ®ç‚¹æ•° </span>
<span class="hljs-keyword">float</span>.value: <span class="hljs-number">3.14159</span>
<span class="hljs-comment"># Nullï¼Œ~ä»£è¡¨null </span>
<span class="hljs-literal">null</span>.value: ~
<span class="hljs-comment"># "" ç©ºå­—ç¬¦ä¸² </span>
<span class="hljs-comment">#, ç›´æ¥åâ¾¯ä»€ä¹ˆéƒ½ä¸åŠ å°±å¯ä»¥äº†, ä½†è¿™ç§â½…å¼ä¸ç›´è§‚, æ›´å¤šçš„è¡¨â½°æ˜¯ä½¿â½¤å¼•å·æ‹¬èµ·æ¥ </span>
<span class="hljs-keyword">empty</span>.value: <span class="hljs-string">''</span>

AIå†™ä»£ç yml
<span class="hljs-number">1234567891011121314</span>
</code></pre>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„åœ°æ–¹åªæœ‰ä¸¤ç‚¹,ç¬¬ä¸€å°±æ˜¯<em>ç©ºå­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªå•å¼•å·,ç¬¬äºŒå°±æ˜¯nullç”¨ä¸€ä¸ªæ³¢æµªå·æ¥è¡¨ç¤º</em>.</p>
<h5 data-id="heading-10"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.2 ymlé…ç½®è¯»å–</h5>
<p>ymlè¯»å–é…ç½®çš„æ–¹æ³•å’Œpropertiesç›¸åŒ,ä½¿ç”¨<code>@Value</code>æ³¨è§£å³å¯,å®ç°ä»£ç å¦‚ä¸‹:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">string:</span>
  <span class="hljs-attr">hello:</span> <span class="hljs-string">bite</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">12</span>
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/demo"</span>)</span>
<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">YmlController</span> {
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.hello}</span>"</span>)</span>
    <span class="hljs-keyword">public</span> String hello;
    <span class="hljs-meta">@RequestMapping(<span class="hljs-string">"/hello99"</span>)</span>
    <span class="hljs-keyword">public</span> String hello(){
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.hello;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3cddfb323e7b4f30a5b5a8db083b3112~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=uDa0rJ%2BD0qrKxO3fQWCjsxWlwQk%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h5 data-id="heading-11"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.3 æ³¨æ„äº‹é¡¹:valueå€¼ä½³å•å¼•å·å’ŒåŒå¼•å·</h5>
<p>å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…æ˜¯åŒå¼•å·,å¦‚æœåŠ äº†çš„è¯,æœ‰çš„æƒ…å†µä¸‹åˆä¼šè¡¨ç¤ºç‰¹æ®Šå«ä¹‰.<br/>
æ¯”å¦‚åœ¨ymlæ–‡ä»¶ä¸­é…ç½®å¦‚ä¸‹ä¿¡æ¯:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">string:</span>
  <span class="hljs-attr">str1:</span> <span class="hljs-string">Hello</span> <span class="hljs-string">\n</span> <span class="hljs-string">Spring</span> <span class="hljs-string">Boot.</span>
  <span class="hljs-attr">str2:</span> <span class="hljs-string">'Hello \n Spring Boot.'</span>
  <span class="hljs-attr">str3:</span> <span class="hljs-string">"Hello \n Spring Boot."</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">1234</span>
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadYml</span> {
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.str1}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String str1;
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.str2}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String str2;
    <span class="hljs-meta">@Value(<span class="hljs-string">"<span class="hljs-subst">${string.str3}</span>"</span>)</span>
    <span class="hljs-keyword">private</span> String str3;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> String readYml(){
        System.<span class="hljs-keyword">out</span>.println(str1);
        System.<span class="hljs-keyword">out</span>.println(str2);
        System.<span class="hljs-keyword">out</span>.println(str3);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"yml"</span>;
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">12345678910111213141516</span>
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6ca2bd10685945ab8b8ad79fb0ad2df4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=14Nvu8uQ9w1VF4QOQt6d%2FzfnZ8Y%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
åœ¨è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°:</p>
<ol>
<li>å­—ç¬¦ä¸²é»˜è®¤ä¸ç”¨åŠ ä¸Šå•å¼•å·æˆ–è€…åŒå¼•å·</li>
<li>åŠ äº†å•å¼•å·ä¹‹å,<em>ç‰¹æ®Šå­—ç¬¦ä¼šè¢«è½¬ä¹‰,åªè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²,åŠ äº†åŒå¼•å·ä¹‹å,ç‰¹æ®Šå­—ç¬¦ä¸ä¼šè¢«è½¬ä¹‰</em>.</li>
</ol>
<blockquote>
<p>æ³¨æ„:è¿™é‡Œçš„è½¬ä¹‰è¯´èµ·æ¥å¯èƒ½ä¼šæœ‰äº›æ‹—å£,\næœ¬æ¥è¡¨ç¤ºçš„æ˜¯æ¢è¡Œ,ä½¿ç”¨å•å¼•å·å‘ç”Ÿäº†è½¬ä¹‰,ä¹Ÿå°±æ˜¯è¯´,\nä¸å†è¡¨ç¤ºæ¢è¡Œäº†,è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªæ™®é€šçš„å­—ç¬¦ä¸²,è€ŒåŠ äº†åŒå¼•å·ä¹‹åå°±è¡¨ç¤ºçš„æ˜¯ç‰¹æ®Šå­—ç¬¦çš„æœ¬æ„,æ²¡æœ‰å‘ç”Ÿè½¬ä¹‰.</p>
</blockquote>
<blockquote>
<p>æˆ‘ä»¬æ¥è¯´æ˜ä¸€ä¸‹<code>@PostConstruct</code>è¿™ä¸ªæ³¨è§£,è¿™ä¸ªæ³¨è§£è¡¨ç¤ºçš„æ˜¯,åœ¨æœåŠ¡å¯åŠ¨ä¹‹å,<strong>è¿™ä¸ªæ–¹æ³•ä¼šå˜ä¸ºåˆå§‹åŒ–æ–¹æ³•</strong>,è¿™ä¸ªæ–¹æ³•åœ¨åç«¯ç«‹å³å°±ä¼šæ‰§è¡Œ,å¦‚æœæœ‰æ‰“å°ä¿¡æ¯çš„è¯,ä¼šç«‹å³æ‰“å°åœ¨åç«¯çš„æ§åˆ¶å°ä¸Š.ç›¸æ¯”äºä½¿ç”¨<code>@RequestMapping</code>æ³¨è§£,æˆ‘ä»¬å°±ä¸éœ€è¦é€šè¿‡æµè§ˆå™¨æ¥è®¿é—®æœ€ç»ˆç»“æœäº†,æˆ‘ä»¬åªéœ€è¦åœ¨åç«¯çš„æ§åˆ¶å°ä¸Šçœ‹æœ€ç»ˆçš„ç»“æœå³å¯.</p>
</blockquote>
<h5 data-id="heading-12"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.4 é…ç½®å¯¹è±¡</h5>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åœ¨ymlä¸­é…ç½®å¯¹è±¡.å¦‚ä¸‹é…ç½®:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">student:</span>
  <span class="hljs-attr">id:</span> <span class="hljs-number">1</span>
  <span class="hljs-attr">name:</span> <span class="hljs-string">java</span>
  <span class="hljs-attr">age:</span> <span class="hljs-number">20</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">1234</span>
</code></pre>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±ä¸å¯ä»¥ç”¨<code>@Value</code>æ¥é…ç½®å¯¹è±¡äº†,æ­¤æ—¶å°±è¦ä½¿ç”¨åˆ°å¦ä¸€ä¸ªæ³¨è§£:<code>@ConfigurationProperties</code>æ¥è¯»å–.å…·ä½“å®ç°å¦‚ä¸‹:</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"student"</span>)
<span class="hljs-variable">@Data</span>
public class Student {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">id</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">name</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">age</span>;
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">12345678</span>
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StudentController</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title class_">Student</span> student;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">readStudent</span>(<span class="hljs-params"/>){
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(student);
    }
}

<span class="hljs-variable constant_">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcf771fe9f95428881ff6c1c2cbe5ce1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=XCdT%2FWzMBQ6FHe5wxI%2BvwY46izY%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
[æ³¨æ„äº‹é¡¹]</p>
<ol>
<li>åœ¨ä¸€ä¸ªç±»ä¸­ç»™å¯¹è±¡ä¸­çš„å±æ€§èµ‹å€¼çš„æ—¶å€™,<em>è¿™ä¸ªç±»å¿…é¡»æœ‰Setæ–¹æ³•</em>,æ‰€ä»¥æˆ‘ä»¬æ‰è¦åœ¨ç±»çš„å¤´ä¸ŠåŠ ä¸Š<code>@Data</code>æ³¨è§£,æˆ‘ä»¬ä¸‹é¢ä¸å¼•å…¥æ³¨è§£,æ‰‹åŠ¨å†™å…¥Setæ–¹æ³•,æ¥éªŒè¯è¿™ç§è¯´æ³•çš„å¯é æ€§.</li>
</ol>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"student"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Integer</span> id;
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> name;
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">Integer</span> age;

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setId</span>(<span class="hljs-params">Integer id</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setName</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> name</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setAge</span>(<span class="hljs-params">Integer age</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">toString</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"Student{"</span> +
                <span class="hljs-string">"id="</span> + id +
                <span class="hljs-string">", name='"</span> + name + <span class="hljs-string">''</span><span class="hljs-string">' +
                ", age=" + age +
                '</span>}<span class="hljs-string">';
    }
}

AIå†™ä»£ç java
è¿è¡Œ
12345678910111213141516171819202122232425262728
</span></code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c5166c9f48f422fabd4eb50675f8af0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=JnJf%2FIg1bsM0bCjWUN9Pz%2B9g2kc%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<ol start="2">
<li>åœ¨ç±»çš„å±æ€§ä¸­,<em>å±æ€§åå¿…é¡»å’Œymlä¸­çš„å­—æ®µåæ˜¯ä¸€è‡´çš„.å¦åˆ™æ— æ³•å¯¹åº”çš„ä¸Š</em>.</li>
</ol>
<h5 data-id="heading-13"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.5 é…ç½®é›†åˆ</h5>
<p>é…ç½®æ–‡ä»¶è¿˜å¯ä»¥é…ç½®Listé›†åˆ,(åŒ…æ‹¬æ•°ç»„,Setåœ¨å†…éƒ½æ˜¯å¦‚ä¸‹çš„æ–¹æ³•)å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="hljs language-markdown" lang="markdown">dbtypes:
  name:
<span class="hljs-bullet">    -</span> mysql
<span class="hljs-bullet">    -</span> sqlserver
<span class="hljs-bullet">    -</span> db2

AIå†™ä»£ç yml
12345
</code></pre>
<p>å°±æ˜¯åœ¨æ¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„å‰é¢åŠ ä¸Šä¸€ä¸ªæ¨ªæ ,å°±è¡¨ç¤ºçš„æ˜¯åˆ—è¡¨,å’Œmdçš„è¯­æ³•éå¸¸ç›¸ä¼¼.</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Data</span>
<span class="hljs-meta">@ConfigurationProperties(prefix = "dbtypes")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ListConfig</span> {
    <span class="hljs-keyword">public</span> List&lt;String&gt; name;<span class="hljs-comment">//å¯¹åº”nameå­—æ®µ</span>
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567</span>
</code></pre>

<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadYml2</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> <span class="hljs-title class_">ListConfig</span> listConfig;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">readList</span>(<span class="hljs-params"/>){
        <span class="hljs-title class_">System</span>.<span class="hljs-property">out</span>.<span class="hljs-title function_">println</span>(listConfig);
    }
}

<span class="hljs-variable constant_">AI</span>å†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f08c7a390e145fea4b6c73ac8750e0a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=QSJIFcUr2yK0PjHteVDBPdbzHNA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
åœ¨é…ç½®é›†åˆçš„æ—¶å€™,ä¸Šè¿°ä»£ç å®é™…ä¸Šä¹Ÿæ˜¯åœ¨é…ç½®ä¸€ä¸ªå¯¹è±¡,æ‰€ä»¥ä»ç„¶ä½¿ç”¨<code>@ConfigurationProperties</code>æ³¨è§£.</p>
<h5 data-id="heading-14"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>4.2.6 é…ç½®map</h5>
<p>é…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥é…ç½®map,å¦‚ä¸‹æ‰€ç¤º:</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">maptypes:</span>
  <span class="hljs-attr">map:</span>
    <span class="hljs-attr">k1:</span> <span class="hljs-string">v1</span>
    <span class="hljs-attr">k2:</span> <span class="hljs-string">v2</span>
    <span class="hljs-attr">k3:</span> <span class="hljs-string">v3</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">12345</span>
</code></pre>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@Data</span>
<span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"maptypes"</span>)
public class MapConfig {
    <span class="hljs-comment">//æ³¨æ„å­—æ®µåçš„ä¸€è‡´æ€§</span>
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Map</span>&lt;<span class="hljs-selector-tag">String</span>,<span class="hljs-selector-tag">String</span>&gt; <span class="hljs-selector-tag">map</span>;
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">1234567</span>
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadYml3</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">public</span> MapConfig mapConfig;
    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> void mapReader(){
        System.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">this</span>.mapConfig);
    }
}

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">123456789</span>
</code></pre>
<p>è¿è¡Œç»“æœ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/74a84c2a97464ee19daa7639a26ab808~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=QFlAJY1FpVnN%2FHQbxI7nfVpnraA%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-15"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5. ç»¼åˆæ€§ç»ƒä¹ :éªŒè¯ç æ¡ˆä¾‹</h3>
<h4 data-id="heading-16"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.1 æ¥å£æ–‡æ¡£</h4>
<ul>
<li>
<p>éœ€æ±‚åˆ†æ</p>
<ol>
<li>ç”ŸæˆéªŒè¯ç ,å¹¶è¿”å›éªŒè¯ç </li>
<li>æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡®:æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡®.</li>
</ol>
</li>
<li>
<p>ç”ŸæˆéªŒè¯ç :</p>
<ul>
<li>è¯·æ±‚</li>
</ul>

<pre><code class="hljs language-javascript" lang="javascript">è¯·æ±‚<span class="hljs-attr">url</span>: <span class="hljs-regexp">/captcha/g</span>etCaptcha
è¯·æ±‚å‚æ•°: æ— 

<span class="hljs-variable constant_">AI</span>å†™ä»£ç 
<span class="hljs-number">12</span>
</code></pre>
<ul>
<li>å“åº”<br/>
éªŒè¯ç å†…å®¹çš„å›¾ç‰‡.æµè§ˆå™¨ç»™æœåŠ¡å™¨å‘é€â¼€ä¸ª/captcha/getCaptcha è¿™æ ·çš„è¯·æ±‚,æœåŠ¡å™¨è¿”å›â¼€ä¸ªå›¾ç‰‡,æµè§ˆå™¨æ˜¾æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š.</li>
</ul>
</li>
<li>
<p>æ ¡éªŒéªŒè¯ç æ˜¯å¦æ­£ç¡®</p>
<ul>
<li>è¯·æ±‚</li>
</ul>

<pre><code class="hljs language-ini" lang="ini">è¯·æ±‚url: /captcha/check
è¯·æ±‚å‚æ•°: <span class="hljs-attr">captcha</span>=ç”¨æˆ·è¾“å…¥çš„éªŒè¯ç 

AIå†™ä»£ç 
12
</code></pre>
<ul>
<li>å“åº”<br/>
true or false,éªŒè¯æˆåŠŸ,è¿”å›true,éªŒè¯å¤±è´¥,è¿”å›false.</li>
</ul>
</li>
</ul>
<h4 data-id="heading-17"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.2Â Hutoolå·¥å…·ä»‹ç»</h4>
<h4 data-id="heading-18"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.3 åç«¯ä»£ç </h4>
<ol>
<li>å¼•å…¥Hutoolä¾èµ–</li>
</ol>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>cn.hutool<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>hutool-captcha<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>5.8.22<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>

AIå†™ä»£ç xml
12345
</code></pre>
<p>2.  å†™å‡ºéªŒè¯ç çš„é…ç½®é¡¹ä¸éªŒè¯ç é…ç½®é¡¹æ‰€å¯¹åº”çš„ç±».å¹¶æ³¨å…¥IoCå®¹å™¨.</p>

<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">captcha:</span>
  <span class="hljs-attr">width:</span> <span class="hljs-number">100</span>
  <span class="hljs-attr">height:</span> <span class="hljs-number">40</span>
  <span class="hljs-attr">session:</span>
    <span class="hljs-attr">key:</span> <span class="hljs-string">CAPTCHA_SESSION_KEY</span>
    <span class="hljs-attr">date:</span> <span class="hljs-string">KAPTCHA_SESSION_DATE</span>

<span class="hljs-string">AIå†™ä»£ç yml</span>
<span class="hljs-number">123456</span>
</code></pre>
<p>é…ç½®é¡¹ä¸­å¯¹åº”çš„åˆ†åˆ«æ˜¯éªŒè¯ç çš„é•¿å’Œå®½,è¿˜æœ‰<strong>ç”¨äºå­˜å‚¨éªŒè¯ç å’Œè¿‡æœŸæ—¶é—´</strong>.</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Component</span>
<span class="hljs-variable">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"captcha"</span>)
<span class="hljs-variable">@Data</span>
public class CaptchaProperties {
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">width</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Integer</span> <span class="hljs-selector-tag">height</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">Session</span> <span class="hljs-selector-tag">session</span>;
    <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">static</span> <span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Session</span>{
        <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">key</span>;
        <span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">String</span> <span class="hljs-selector-tag">date</span>;
    }
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">123456789101112</span>
</code></pre>
<p>3.  è°ƒæ•´ç”ŸæˆéªŒè¯ç çš„Controllerä»£ç </p>

<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@RestController</span>
<span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/captcha"</span>)
public class CaptchaController {
    <span class="hljs-variable">@Autowired</span>
    public CaptchaProperties captchaProperties;
    <span class="hljs-variable">@RequestMapping</span>(<span class="hljs-string">"/getCaptcha"</span>)
    public void <span class="hljs-built_in">getCaptcha</span>(HttpServletResponse response, HttpSession session) throws IOException {<span class="hljs-comment">//å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°æ‹¿åˆ°å“åº”ä¸­çš„æ‰€æœ‰ä¿¡æ¯</span>
        <span class="hljs-selector-tag">LineCaptcha</span> <span class="hljs-selector-tag">lineCaptcha</span> = <span class="hljs-selector-tag">CaptchaUtil</span><span class="hljs-selector-class">.createLineCaptcha</span>(captchaProperties.<span class="hljs-built_in">getWidth</span>(),captchaProperties.<span class="hljs-built_in">getHeight</span>());<span class="hljs-comment">//åˆ›å»ºçº¿æ¡å¹²æ‰°éªŒè¯ç </span>
        <span class="hljs-comment">//å›¾å½¢éªŒè¯ç å†™å‡ºï¼Œå¯ä»¥å†™å‡ºåˆ°æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å†™å‡ºåˆ°æµ</span>
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setContentType</span>(<span class="hljs-string">"image/jpeg"</span>);<span class="hljs-comment">//ä»å“åº”ä¸­è·å–åˆ°ç±»å‹ä¿¡æ¯,è®¾ç½®ä¸ºå›¾ç‰‡æ ¼å¼</span>
        <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.setHeader</span>(<span class="hljs-string">"Pragma"</span>,<span class="hljs-string">"No-cache"</span>);<span class="hljs-comment">//ä»å“åº”ä¸­è·å–åˆ°Header,æŠŠPragmaé”®å€¼å¯¹è®¾ç½®ä¸ºæ²¡æœ‰ç¼“å­˜.</span>
        <span class="hljs-selector-tag">try</span> {
            <span class="hljs-selector-tag">lineCaptcha</span><span class="hljs-selector-class">.write</span>(response.<span class="hljs-built_in">getOutputStream</span>());
            <span class="hljs-comment">//æŠŠéªŒè¯ç æ”¾å…¥sessionä¸­</span>
            <span class="hljs-selector-tag">session</span><span class="hljs-selector-class">.setAttribute</span>(captchaProperties.<span class="hljs-built_in">getSession</span>().<span class="hljs-built_in">getKey</span>(),lineCaptcha.<span class="hljs-built_in">getCode</span>());
            <span class="hljs-comment">//æŠŠè¿‡æœŸæ—¶é—´æ”¾å…¥sessionä¸­</span>
            <span class="hljs-selector-tag">session</span><span class="hljs-selector-class">.setAttribute</span>(captchaProperties.<span class="hljs-built_in">getSession</span>().<span class="hljs-built_in">getDate</span>(),System.<span class="hljs-built_in">currentTimeMillis</span>());
            <span class="hljs-selector-tag">response</span><span class="hljs-selector-class">.getOutputStream</span>()<span class="hljs-selector-class">.close</span>();<span class="hljs-comment">//å…³é—­è¾“å‡ºæµ</span>
        } <span class="hljs-selector-tag">catch</span> (IOException e) {
            <span class="hljs-selector-tag">throw</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">RuntimeException</span>(e);
        }
    }
}

<span class="hljs-selector-tag">AI</span>å†™ä»£ç <span class="hljs-selector-tag">java</span>
è¿è¡Œ
<span class="hljs-number">1234567891011121314151617181920212223</span>
</code></pre>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è®¿é—®ç½‘é¡µæ¥è§‚å¯ŸéªŒè¯ç æ˜¯å¦ç”ŸæˆæˆåŠŸ.<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2a8b60400384253ae6da6a19cb80405~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=GDFGGdstt4X3SPchid9JLp0Vq74%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
éªŒè¯ç ç”ŸæˆæˆåŠŸ.</p>
<ol start="4">
<li>æ ¡éªŒéªŒè¯ç </li>
</ol>

<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">MAX_WAIT_MILLS</span> <span class="hljs-operator">=</span> <span class="hljs-number">60</span>*<span class="hljs-number">1000</span>;
    <span class="hljs-meta">@RequestMapping("/check")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkCaptcha</span><span class="hljs-params">(HttpSession session,String captcha)</span>{
       <span class="hljs-keyword">if</span> (!StringUtils.hasLength(captcha)){<span class="hljs-comment">//åˆ¤æ–­éªŒè¯ç æ˜¯å¦æœ‰é•¿åº¦</span>
           <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
       }
       <span class="hljs-type">String</span> <span class="hljs-variable">sessionCode</span> <span class="hljs-operator">=</span> (String) session.getAttribute(captchaProperties.getSession().getKey());
       <span class="hljs-type">Long</span> <span class="hljs-variable">sessionDate</span> <span class="hljs-operator">=</span> (Long) session.getAttribute(captchaProperties.getSession().getDate());
       <span class="hljs-keyword">if</span> (captcha.equalsIgnoreCase(sessionCode) &amp;&amp;
       System.currentTimeMillis()-sessionDate &lt; MAX_WAIT_MILLS){
           <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<span class="hljs-comment">//éªŒè¯ç å’Œç”¨æˆ·è¾“å…¥çš„ç­‰åŒä¸”</span>
       }
       <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }

AIå†™ä»£ç java
è¿è¡Œ
<span class="hljs-number">1234567891011121314</span>
</code></pre>
<h4 data-id="heading-19"><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/><a href="https://link.juejin.cn?target=" title="" ref="nofollow noopener noreferrer"/>5.4 å‰ç«¯ä»£ç </h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"utf-8"</span>&gt;</span>

  <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>éªŒè¯ç <span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
    <span class="hljs-selector-id">#inputCaptcha</span> {
      <span class="hljs-attribute">height</span>: <span class="hljs-number">30px</span>;
      <span class="hljs-attribute">vertical-align</span>: middle; 
    }
    <span class="hljs-selector-id">#verificationCodeImg</span>{
      <span class="hljs-attribute">vertical-align</span>: middle; 
    }
    <span class="hljs-selector-id">#checkCaptcha</span>{
      <span class="hljs-attribute">height</span>: <span class="hljs-number">40px</span>;
      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>è¾“å…¥éªŒè¯ç <span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"confirm"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"inputCaptcha"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"inputCaptcha"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"verificationCodeImg"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/captcha/getCaptcha"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"cursor: pointer;"</span> <span class="hljs-attr">title</span>=<span class="hljs-string">"çœ‹ä¸æ¸…ï¼Ÿæ¢ä¸€å¼ "</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"button"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"æäº¤"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"checkCaptcha"</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
    
    $(<span class="hljs-string">"#verificationCodeImg"</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"/>){
      $(<span class="hljs-variable language_">this</span>).<span class="hljs-title function_">hide</span>().<span class="hljs-title function_">attr</span>(<span class="hljs-string">'src'</span>, <span class="hljs-string">'/captcha/getCaptcha?dt='</span> + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>()).<span class="hljs-title function_">fadeIn</span>();
    });

    $(<span class="hljs-string">"#checkCaptcha"</span>).<span class="hljs-title function_">click</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
      $.<span class="hljs-title function_">ajax</span>({
        <span class="hljs-attr">url</span>: <span class="hljs-string">"/captcha/check"</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">"post"</span>,
        <span class="hljs-attr">data</span>: { <span class="hljs-attr">captcha</span>: $(<span class="hljs-string">"#inputCaptcha"</span>).<span class="hljs-title function_">val</span>() },
        <span class="hljs-attr">success</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) {
          <span class="hljs-keyword">if</span> (result) {
            location.<span class="hljs-property">href</span> = <span class="hljs-string">"success.html"</span>;
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-title function_">alert</span>(<span class="hljs-string">"éªŒè¯ç é”™è¯¯"</span>);
            $(<span class="hljs-string">"#inputCaptcha"</span>).<span class="hljs-title function_">val</span>(<span class="hljs-string">""</span>);
          }
        }
      });
    });

  </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

AIå†™ä»£ç html
1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556
</code></pre>

<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>éªŒè¯æˆåŠŸé¡µ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>éªŒè¯æˆåŠŸ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>

AIå†™ä»£ç html
1234567891011
</code></pre>
<p>æµ‹è¯•è¿è¡Œ:<br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2af944ac1861404da29d942d9b199a33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=H8cu5HTRw%2FGCumeO8uFXM8wqnWc%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/><br/>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44a6a972fde7496eabf72bc3a2eb6c46~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSmF2YeawtOinow==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1765348426&amp;x-signature=p4ETdkOO5gKVSRU2t%2B2LtbNCZAU%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>