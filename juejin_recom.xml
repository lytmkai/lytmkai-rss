<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>æ˜é‡‘æ–‡ç« æ¨è</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>ä¸€ä¸ªå¸®åŠ©å¼€å‘è€…æˆé•¿çš„ç¤¾åŒº</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[æ·±å…¥ç†è§£ DispatchQueue.sync çš„æ­»é”é™·é˜±ï¼šåŸç†ã€æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ]]></title>    <link>https://juejin.cn/post/7570976274236915758</link>    <guid>https://juejin.cn/post/7570976274236915758</guid>    <pubDate>2025-11-11T00:06:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570976274236915758" data-draft-id="7550959642794491944" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æ·±å…¥ç†è§£ DispatchQueue.sync çš„æ­»é”é™·é˜±ï¼šåŸç†ã€æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-11T00:06:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æ·±å…¥ç†è§£ DispatchQueue.sync çš„æ­»é”é™·é˜±ï¼šåŸç†ã€æ¡ˆä¾‹ä¸æœ€ä½³å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:06:19.000Z" title="Tue Nov 11 2025 00:06:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸ºä»€ä¹ˆè¦è°ˆâ€œæ­»é”â€</h2>
<p>åœ¨ Swift å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œ<code>DispatchQueue.sync</code> ä»¥â€œé˜»å¡å¼åŒæ­¥â€è‘—ç§°ï¼šç®€å•ã€ç›´è§‚ã€çº¿ç¨‹å®‰å…¨ï¼Œå´ä¹Ÿæœ€å®¹æ˜“è®©ç”Ÿäº§ç¯å¢ƒç›´æ¥å´©æºƒã€‚</p>
<h2 data-id="heading-1">ä»€ä¹ˆæ˜¯æ­»é”ï¼ˆDeadlockï¼‰</h2>





















<table><thead><tr><th>ç»´åº¦</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>å®šä¹‰</td><td>ä¸¤ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰æ‰§è¡Œå•å…ƒäº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œå¯¼è‡´æ°¸è¿œé˜»å¡ã€‚</td></tr><tr><td>åœ¨ GCD ä¸­çš„è¡¨ç°</td><td>çº¿ç¨‹ A é€šè¿‡ <code>sync</code> æäº¤ä»»åŠ¡åˆ°é˜Ÿåˆ— Qï¼Œè€Œé˜Ÿåˆ— Q æ­£åœ¨ç­‰å¾…çº¿ç¨‹ A å®Œæˆ â†’ å¾ªç¯ç­‰å¾… â†’ è§¦å‘ <code>EXC_BAD_INSTRUCTION</code> å´©æºƒã€‚</td></tr><tr><td>å¸¸è§ç»“æœ</td><td>ä¸»çº¿ç¨‹å¡æ­»ã€App ç§’é€€ï¼›Crash æ—¥å¿—ä¸­å‡ºç° <code>0x8badf00d</code>ï¼ˆåº”ç”¨æ— å“åº”ï¼‰æˆ– <code>EXC_I386_INVOP</code>ï¼ˆéæ³•æ“ä½œï¼‰ç­‰é”™è¯¯ç ã€‚</td></tr></tbody></table>
<p>é¤å…æ¯”å–»</p>
<ul>
<li>waiterï¼ˆæœåŠ¡å‘˜ï¼‰åŒæ­¥ä¸‹è®¢å•ç»™ chefï¼ˆå¨å¸ˆï¼‰ï¼›</li>
<li>chef éœ€è¦ waiter å›å»é—®é¡¾å®¢å£å‘³ï¼ŒåˆåŒæ­¥æ´¾ä»»åŠ¡ç»™ waiterï¼›</li>
<li>ä¸¤äººäº’ç›¸ç­‰ï¼Œé¤å…åœæ‘† â†’ æ­»é”ã€‚</li>
</ul>
<h2 data-id="heading-2">Swift æœ€å°æ­»é”ç¤ºä¾‹</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">import</span> Foundation

<span class="hljs-comment">// 1. åŒé˜Ÿåˆ—åµŒå¥— sync â†’ ç«‹å³å´©æºƒ</span>
<span class="hljs-keyword">let</span> queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"com.demo.queue"</span>)
queue.sync {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"å¤–å±‚ sync"</span>)
    queue.sync {          <span class="hljs-comment">// âŒ åœ¨è¿™é‡Œæ­»é”</span>
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"æ°¸è¿œè¿›ä¸æ¥"</span>)
    }
}
</code></pre>
<p>è¿è¡Œåæ§åˆ¶å°åªä¼šæ‰“å° <code>å¤–å±‚ sync</code>ï¼Œéšå App å´©æºƒã€‚</p>
<p>åŸå› ï¼š</p>
<ul>
<li>å¤–å±‚é—­åŒ…å·²å ç”¨é˜Ÿåˆ—å”¯ä¸€çº¿ç¨‹ï¼›</li>
<li>å†…å±‚ <code>sync</code> è¦æ±‚åŒä¸€æ¡çº¿ç¨‹å†æ¬¡è¿›å…¥ â†’ æ— æ³•æ»¡è¶³ â†’ æ­»é”ã€‚</li>
</ul>
<h2 data-id="heading-3">åŒé˜Ÿåˆ—äº¤å‰æ­»é”ï¼ˆæ›´æ¥è¿‘çœŸå®ä¸šåŠ¡ï¼‰</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">let</span> waiter <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"waiter"</span>)
<span class="hljs-keyword">let</span> chef   <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"chef"</span>)

<span class="hljs-comment">// æ¨¡æ‹Ÿä¸‹å•æµç¨‹</span>
waiter.sync {
    <span class="hljs-built_in">print</span>(<span class="hljs-string">"â‘  Waiterï¼šåŒæ­¥ä¸‹å•ç»™ Chef"</span>)
    
    chef.sync {
        <span class="hljs-built_in">print</span>(<span class="hljs-string">"â‘¡ Chefï¼šåŒæ­¥è¦æ±‚ Waiter å»é—®å£å‘³"</span>)
        
        waiter.sync {     <span class="hljs-comment">// âŒ äº¤å‰ç­‰å¾…</span>
            <span class="hljs-built_in">print</span>(<span class="hljs-string">"â‘¢ Waiterï¼šæ°¸è¿œæ— æ³•æ‰§è¡Œ"</span>)
        }
    }
}
</code></pre>
<p>å´©æºƒç‚¹ï¼šâ‘¢ å¤„ waiter é˜Ÿåˆ—å·²è¢«â‘ å ç”¨ï¼Œè€Œâ‘ åˆåœ¨ç­‰â‘¡ â†’ å¾ªç¯ç­‰å¾…ã€‚</p>
<h2 data-id="heading-4">å¦‚ä½•â€œä¸€é”®â€è§£å†³â€”â€”æŠŠä»»æ„ä¸€ä¸ª sync æ”¹æˆ async</h2>

























<table><thead><tr><th>ä¿®æ”¹æ–¹æ¡ˆ</th><th>ä»£ç ç‰‡æ®µ</th><th>æ˜¯å¦æ­»é”</th></tr></thead><tbody><tr><td>â‘  â†’ async</td><td><code>waiter.async { â€¦ }</code></td><td>âŒ</td></tr><tr><td>â‘¡ â†’ async</td><td><code>chef.async { â€¦ }</code></td><td>âŒ</td></tr><tr><td>â‘¢ â†’ async</td><td><code>waiter.async { â€¦ }</code></td><td>âŒ</td></tr></tbody></table>
<p>ç»“è®ºï¼š åªè¦æ‰“ç ´â€œå¾ªç¯ç­‰å¾…é“¾â€ä¸­çš„ä»»æ„ä¸€ä¸ªç¯ï¼Œæ­»é”å³åˆ»è§£é™¤ã€‚</p>
<p>åœ¨çœŸå®é¡¹ç›®ä¸­ï¼Œä¼˜å…ˆæŠŠâ€œåå‘è°ƒç”¨â€åšæˆ async å³å¯ã€‚</p>
<h2 data-id="heading-5">å·¥ç¨‹ä¸­æœ€å®¹æ˜“è¸©çš„â€œéšæ€§æ­»é”â€</h2>
<ol>
<li>å¯¹å¤–æš´éœ² sync æ¥å£</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"cache"</span>)
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> storage: [<span class="hljs-type">String</span>: <span class="hljs-type">UIImage</span>] <span class="hljs-operator">=</span> [:]
    
    <span class="hljs-comment">// âŒ å±é™©ï¼šæŠŠå†…éƒ¨é˜Ÿåˆ— sync æš´éœ²ç»™å¤–éƒ¨</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">read</span>&lt;<span class="hljs-type">T</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">closure</span>: () -&gt; <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">T</span> {
        <span class="hljs-keyword">return</span> queue.sync(execute: closure)   <span class="hljs-comment">// é—­åŒ…é‡Œå¯èƒ½å†è°ƒ read()</span>
    }
}
</code></pre>
<p>é—®é¢˜ï¼šè°ƒç”¨æ–¹å¯èƒ½åœ¨é—­åŒ…é‡Œå†æ¬¡è°ƒç”¨ <code>read()</code> â†’ é€’å½’åŒæ­¥ â†’ æ­»é”ã€‚</p>
<p>è§£å†³ï¼š</p>
<ul>
<li>ç»ä¸å¯¹å¤–æš´éœ² syncï¼›</li>
</ul>
<ol start="2">
<li>ä¸»çº¿ç¨‹ sync åˆ°ä¸»é˜Ÿåˆ—</li>
</ol>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-type">DispatchQueue</span>.main.sync {   <span class="hljs-comment">// âŒ 100 % æ­»é”</span>
    <span class="hljs-comment">// ä»£ç æ°¸è¿œä¸ä¼šè¿›æ¥</span>
}
</code></pre>
<p>åœºæ™¯ï¼šåœ¨åå°çº¿ç¨‹è®¡ç®—å®Œåï¼Œæƒ³â€œç«‹åˆ»â€å›ä¸»çº¿ç¨‹åˆ·æ–° UIï¼Œå´æ‰‹æ»‘å†™æˆ <code>sync</code>ã€‚</p>
<p>æ­£ç¡®å§¿åŠ¿ï¼š</p>
<p>æ°¸è¿œç”¨ <code>DispatchQueue.main.async { ... }</code>ã€‚</p>
<h2 data-id="heading-6">sync çš„æ­£ç¡®æ‰“å¼€æ–¹å¼â€”â€”â€œç§æœ‰é˜Ÿåˆ— + åŸå­è®¿é—®â€</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// çº¿ç¨‹å®‰å…¨çš„æ—¥æœŸæ ¼å¼åŒ–å™¨ç¼“å­˜</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DateFormatterCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> formatters: [<span class="hljs-type">String</span>: <span class="hljs-type">DateFormatter</span>] <span class="hljs-operator">=</span> [:]
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"cache.<span class="hljs-subst">\(UUID().uuidString)</span>"</span>)
    
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">formatter</span>(<span class="hljs-params">using</span> <span class="hljs-params">format</span>: <span class="hljs-type">String</span>) -&gt; <span class="hljs-type">DateFormatter</span> {
        <span class="hljs-comment">// 1. åªåœ¨æ­¤ç§æœ‰é˜Ÿåˆ—é‡ŒåŒæ­¥ï¼Œå¤–éƒ¨æ— æ³•é€’å½’æ ¹é™¤</span>
        <span class="hljs-keyword">return</span> queue.sync { [<span class="hljs-keyword">unowned</span> <span class="hljs-keyword">self</span>] <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> cached <span class="hljs-operator">=</span> formatters[format] {
                <span class="hljs-keyword">return</span> cached
            }
            <span class="hljs-keyword">let</span> df <span class="hljs-operator">=</span> <span class="hljs-type">DateFormatter</span>()
            df.locale <span class="hljs-operator">=</span> <span class="hljs-type">Locale</span>(identifier: <span class="hljs-string">"en_US_POSIX"</span>)
            df.dateFormat <span class="hljs-operator">=</span> format
            formatters[format] <span class="hljs-operator">=</span> df
            <span class="hljs-keyword">return</span> df
        }
    }
}
</code></pre>
<p>ä¸ºä»€ä¹ˆè¿™é‡Œä¸ä¼šæ­»é”ï¼Ÿ</p>
<ul>
<li><code>queue</code> ç§æœ‰ï¼Œå¤–éƒ¨æ— æ³•ç›´æ¥å¾€å®ƒå¡ sync ä»»åŠ¡ï¼›</li>
<li>å‡½æ•°å†…éƒ¨æ— é€’å½’è°ƒç”¨ï¼›</li>
<li>é—­åŒ…æ‰§è¡Œæ—¶é—´æçŸ­ï¼Œä¸ä¼šé˜»å¡ç”¨æˆ·å¯è§çº¿ç¨‹ã€‚</li>
</ul>
<p>checklist âœ…</p>





















<table><thead><tr><th>ä½¿ç”¨ sync å‰è‡ªé—®</th><th>å›ç­”</th></tr></thead><tbody><tr><td>é˜Ÿåˆ—æ˜¯å¦ç§æœ‰ï¼Ÿ</td><td>âœ…</td></tr><tr><td>é—­åŒ…é‡Œè¿˜ä¼š sync åˆ°åŒé˜Ÿåˆ—å—ï¼Ÿ</td><td>âŒ</td></tr><tr><td>é˜»å¡æ˜¯å¦å½±å“ä¸»çº¿ç¨‹/ç”¨æˆ·æ»‘åŠ¨ï¼Ÿ</td><td>âŒ</td></tr></tbody></table>
<h2 data-id="heading-7">å°è£…ä¸€ä¸ªâ€œé˜²æ­»é”â€çš„è¯»å†™é”</h2>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-comment">/// è¯»å†™é”ï¼šå†™æ“ä½œ barrierï¼Œè¯»æ“ä½œå¹¶å‘</span>
<span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RWLock</span>&lt;<span class="hljs-title class_">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> value: <span class="hljs-type">T</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">let</span> queue: <span class="hljs-type">DispatchQueue</span>
    
    <span class="hljs-keyword">init</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">initial</span>: <span class="hljs-type">T</span>) {
        value <span class="hljs-operator">=</span> initial
        queue <span class="hljs-operator">=</span> <span class="hljs-type">DispatchQueue</span>(label: <span class="hljs-string">"rw.<span class="hljs-subst">\(UUID().uuidString)</span>"</span>, attributes: .concurrent)
    }
    
    <span class="hljs-comment">// è¯»ï¼šå¹¶å‘</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">read</span>&lt;<span class="hljs-type">U</span>&gt;(<span class="hljs-keyword">_</span> <span class="hljs-params">closure</span>: (<span class="hljs-type">T</span>) <span class="hljs-keyword">throws</span> -&gt; <span class="hljs-type">U</span>) <span class="hljs-keyword">rethrows</span> -&gt; <span class="hljs-type">U</span> {
        <span class="hljs-keyword">try</span> queue.sync { <span class="hljs-keyword">try</span> closure(value) }
    }
    
    <span class="hljs-comment">// å†™ï¼šbarrier</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">write</span>(<span class="hljs-keyword">_</span> <span class="hljs-params">closure</span>: <span class="hljs-keyword">@escaping</span> (<span class="hljs-keyword">inout</span> <span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Void</span>) {
        queue.async(flags: .barrier) { closure(<span class="hljs-operator">&amp;</span><span class="hljs-keyword">self</span>.value) }
    }
}
</code></pre>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>è¯»å¹¶è¡Œã€å†™ä¸²è¡Œï¼›</li>
<li>å¤–éƒ¨æ— æ³•æ‹¿åˆ° <code>queue</code> å¼•ç”¨ï¼Œå½»åº•æœç»é€’å½’ syncï¼›</li>
<li>æ‰€æœ‰å†™æ“ä½œæ˜¯ <code>async</code>ï¼Œä¸ä¼šé˜»å¡è°ƒç”¨æ–¹ã€‚</li>
</ul>
<h2 data-id="heading-8">æ€»ç»“â€”â€”ä¸€å¥è¯è®°ä½</h2>
<p><strong>é™¤éä½ åœ¨åšåŸå­è®¿é—®ï¼Œä¸”é˜Ÿåˆ—ç§æœ‰ã€æ— é€’å½’ï¼Œå¦åˆ™ä¸€å¾‹ç”¨ asyncã€‚</strong></p>
<h2 data-id="heading-9">æ‰©å±•é˜…è¯» &amp; ä¸‹ä¸€æ­¥</h2>
<ol>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fdocumentation%2Fdispatch%2Fdispatchqueue%2F1452870-sync" target="_blank" title="https://developer.apple.com/documentation/dispatch/dispatchqueue/1452870-sync" ref="nofollow noopener noreferrer">DispatchQueue.sync</a></li>
<li>WWDC 2022 â€“ Visualize and eliminate hangs with Instruments</li>
<li>Swift Concurrency æ—¶ä»£ï¼š
<ul>
<li>ç”¨ <code>actor</code> æ›¿ä»£â€œç§æœ‰é˜Ÿåˆ— + syncâ€ï¼›</li>
<li>ç”¨ <code>AsyncSequence</code> åšâ€œå¼‚æ­¥å›è°ƒé“¾â€ï¼Œå¤©ç„¶é¿å…æ­»é”ã€‚</li>
</ul>
</li>
</ol>
<h2 data-id="heading-10">å­¦ä¹ èµ„æ–™</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.donnywals.com%2Funderstanding-how-dispatchqueue-sync-can-cause-deadlocks%2F" target="_blank" title="https://www.donnywals.com/understanding-how-dispatchqueue-sync-can-cause-deadlocks/" ref="nofollow noopener noreferrer">www.donnywals.com/understandiâ€¦</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€å‰ç«¯æ•ˆç‡å·¥å…·ã€‘å†ä¹Ÿä¸ç”¨ APIfox è”è°ƒï¼é›¶ä¾µå…¥ Mockï¼Œå…¨ç¨‹ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†]]></title>    <link>https://juejin.cn/post/7570984257666056238</link>    <guid>https://juejin.cn/post/7570984257666056238</guid>    <pubDate>2025-11-11T00:15:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984257666056238" data-draft-id="7569813790533730323" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€å‰ç«¯æ•ˆç‡å·¥å…·ã€‘å†ä¹Ÿä¸ç”¨ APIfox è”è°ƒï¼é›¶ä¾µå…¥ Mockï¼Œå…¨ç¨‹ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†"/> <meta itemprop="keywords" content="å‰ç«¯,æµè§ˆå™¨,JavaScript"/> <meta itemprop="datePublished" content="2025-11-11T00:15:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸ä¸€æ ·çš„å°‘å¹´_"/> <meta itemprop="url" content="https://juejin.cn/user/3035079961218551"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€å‰ç«¯æ•ˆç‡å·¥å…·ã€‘å†ä¹Ÿä¸ç”¨ APIfox è”è°ƒï¼é›¶ä¾µå…¥ Mockï¼Œå…¨ç¨‹ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3035079961218551/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸ä¸€æ ·çš„å°‘å¹´_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:15:35.000Z" title="Tue Nov 11 2025 00:15:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    22
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»16åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸Šå‘¨å››ä¸‹åˆï¼Œæˆ‘æ­£åœ¨è°ƒæ ·å¼ï¼Œçªç„¶ç”µè„‘é£æ‰‡å¼€å§‹å’†å“®ã€‚</p>
<p>æ‰“å¼€ä»»åŠ¡ç®¡ç†å™¨ï¼š<strong>å†…å­˜å ç”¨ 15.5G / 16G</strong>ã€‚</p>
<p>æˆ‘äººå‚»äº†ï¼Œ16G å†…å­˜å¼€å‘ä¸ªå‰ç«¯é¡¹ç›®è¿˜èƒ½å¡ï¼Ÿ</p>
<p>ä»”ç»†ä¸€çœ‹ï¼š</p>
<ul>
<li><strong>VSCode</strong>ï¼š2.1Gï¼ˆè·‘ç€é¡¹ç›®ï¼Œæ­£å¸¸ï¼‰</li>
<li><strong>Chrome 30 ä¸ªæ ‡ç­¾é¡µ</strong>ï¼š4.5Gï¼ˆæ˜é‡‘ã€Stack Overflowã€GitHubã€æ–‡æ¡£...èƒ½ç†è§£ï¼‰</li>
<li><strong>APIfox</strong>ï¼š1.5Gï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰</li>
<li><strong>å¾®ä¿¡ + ä¼ä¸šå¾®ä¿¡</strong>ï¼š1.1Gï¼ˆæ²¡åŠæ³•ï¼Œå·¥ä½œè¦ç”¨ï¼‰</li>
<li><strong>å…¶ä»–è‹¥å¹²è¿›ç¨‹â€¦</strong>ï¼š...</li>
</ul>
<p><strong>APIfoxè¿™ä¸€ä¸ªå·¥å…·ï¼Œå äº† 1.5Gï¼Ÿ</strong></p>
<p>å…³é”®æ˜¯ï¼Œæˆ‘åªæ˜¯æƒ³ Mock å‡ ä¸ªæ¥å£è€Œå·²ï¼Œä¸ºä»€ä¹ˆè¦ï¼š</p>
<ul>
<li>è£…ä¸€ä¸ª 500M+ çš„å®¢æˆ·ç«¯</li>
<li>å¼€ä»£ç†ï¼ˆè¿˜å¾—è®°å¾—å…³ï¼‰</li>
<li>æ¥å›åˆ‡çª—å£ï¼ˆæµè§ˆå™¨ â†’ APIfox â†’ VSCodeï¼‰</li>
<li>å ç”¨ 1.5G å†…å­˜</li>
</ul>
<p>æˆ‘è¯•è¿‡å…¶ä»–æ–¹æ¡ˆï¼š</p>
<ul>
<li><strong>åœ¨ä»£ç é‡Œå†™æ­» Mock æ•°æ®</strong> â†’ æœ‰æ—¶å€™å¿˜è®°åˆ æ‰ï¼Œä¸Šçº¿å·®ç‚¹å¸¦ç€å‡æ•°æ®å†²è¿›ç”Ÿäº§</li>
<li><strong>ç”¨ Mock.js</strong> â†’ é…ç½®å¤ªéº»çƒ¦ï¼Œè¿˜è¦æ”¹ä»£ç </li>
</ul>
<p>æˆ‘æƒ³è¦çš„æ˜¯ï¼šä¸è£…å®¢æˆ·ç«¯ã€ä¸æ”¹ä»£ç ã€ä¸å¼€ä»£ç†ã€ä¸è€—å†…å­˜ã€ä¸€é”®åˆ‡æ¢ Mock å¼€å…³
ã€‚
äºæ˜¯ï¼Œæˆ‘èŠ±äº†ä¸€ä¸ªå‘¨æœ«ï¼Œåšäº†ä¸€ä¸ªchromeæµè§ˆå™¨æ’ä»¶ã€‚</p>
<p><strong>ç°åœ¨mockä¸ç”¨ APIfoxï¼Œå†…å­˜å ç”¨é™äº†ä¸å°‘ï¼Œç”µè„‘é¡ºå¤šäº†ï¼Œæµè§ˆå™¨é‡Œä¸€é”® Mockï¼Œè°ƒè¯•åˆå¿«åˆçœå¿ƒã€‚</strong></p>
</blockquote>
<h2 data-id="heading-0">æ•ˆæœæ¼”ç¤º:  ä¸‹é¢æ˜¯æ’ä»¶åœ¨æ‹¦æˆª fetch/xhr è¯·æ±‚å¹¶è¿”å› Mock æ•°æ®æ—¶çš„æ¼”ç¤ºï¼š</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0ff5b4c2ddc4432491f849c8b01888f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763425628&amp;x-signature=vX5kaq6xW7Qc79Dwj3h56zjZo7k%3D" alt="mockæ’ä»¶æ•ˆæœ.gif" loading="lazy"/></p>
<h2 data-id="heading-1">æ’ä»¶åŠŸèƒ½é¢„è§ˆ</h2>
<ul>
<li>æ‹¦æˆªé¡µé¢çš„ <code>fetch</code>ã€<code>xhr</code> è¯·æ±‚</li>
<li>è§„åˆ™æ”¯æŒæ¨¡ç³ŠåŒ¹é…å’Œå®Œå…¨åŒ¹é…</li>
<li>æ”¯æŒæŒ‰ HTTP æ–¹æ³•è¿‡æ»¤ï¼ˆGET/POST/PUT/DELETEï¼‰</li>
<li>è‡ªå®šä¹‰è¿”å› JSON æ•°æ®</li>
<li><code>æŒç»­ä¼˜åŒ–ä¸­ï¼šæ€§èƒ½ã€åŒ¹é…è§„åˆ™å’Œç”¨æˆ·ä½“éªŒä¼šä¸æ–­è¿­ä»£ï¼Œæ¬¢è¿åé¦ˆä¸å»ºè®®</code></li>
</ul>
<h2 data-id="heading-2">æ ¹æœ¬åŸç†ï¼šåŠ«æŒæµè§ˆå™¨çš„ç½‘ç»œè¯·æ±‚æ–¹æ³•</h2>
<h3 data-id="heading-3">ä¸€å¥è¯æ€»ç»“</h3>
<p><strong>åœ¨ç½‘é¡µåŠ è½½å‰ï¼Œå·å·æ›¿æ¢æ‰æµè§ˆå™¨åŸç”Ÿçš„</strong> <strong><code>fetch</code></strong> <strong>å’Œ</strong> <strong><code>XMLHttpRequest</code></strong> <strong>ï¼Œè®©æ‰€æœ‰ç½‘ç»œè¯·æ±‚å…ˆç»è¿‡æˆ‘ä»¬çš„"æ£€æŸ¥ç«™"ï¼Œç¬¦åˆè§„åˆ™çš„å°±è¿”å›å‡æ•°æ®ï¼Œä¸ç¬¦åˆçš„å°±æ”¾è¡Œã€‚</strong></p>
<h3 data-id="heading-4">åŸç†:</h3>
<pre><code class="hljs language-sql" lang="sql">æ­£å¸¸æƒ…å†µï¼š
ç½‘é¡µä»£ç  â†’ <span class="hljs-keyword">fetch</span>(<span class="hljs-string">'/api/user'</span>) â†’ æµè§ˆå™¨å‘é€çœŸå®è¯·æ±‚ â†’ æœåŠ¡å™¨

æ’ä»¶ä»‹å…¥åï¼š
ç½‘é¡µä»£ç  â†’ <span class="hljs-keyword">fetch</span>(<span class="hljs-string">'/api/user'</span>) 
           â†“
       æˆ‘ä»¬çš„å‡ <span class="hljs-keyword">fetch</span>ï¼ˆæ£€æŸ¥æ˜¯å¦éœ€è¦ Mockï¼‰
           â†“
    éœ€è¦ Mockï¼Ÿ
    â”œâ”€ æ˜¯ â†’ ç›´æ¥è¿”å›å‡æ•°æ® âœ…
    â””â”€ å¦ â†’ è°ƒç”¨çœŸæ­£çš„ <span class="hljs-keyword">fetch</span> å‘é€è¯·æ±‚ â†’ æœåŠ¡å™¨
</code></pre>
<h3 data-id="heading-5">å…·ä½“å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 1. ä¿å­˜åŸå§‹æ–¹æ³•</span>
<span class="hljs-keyword">const</span> çœŸæ­£çš„fetch = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;

<span class="hljs-comment">// 2. æ›¿æ¢æˆæˆ‘ä»¬çš„æ–¹æ³•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-comment">// 3. æ£€æŸ¥æ˜¯å¦éœ€è¦ Mock</span>
  <span class="hljs-keyword">if</span> (url.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'/api/user'</span>)) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‹¦æˆªæˆåŠŸï¼è¿”å›å‡æ•°æ®'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>({
      <span class="hljs-attr">json</span>: <span class="hljs-function">() =&gt;</span> ({ <span class="hljs-attr">name</span>: <span class="hljs-string">'Mock User'</span> })
    });
  }
  
  <span class="hljs-comment">// 4. ä¸éœ€è¦ Mockï¼Œè°ƒç”¨åŸå§‹æ–¹æ³•</span>
  <span class="hljs-keyword">return</span> çœŸæ­£çš„<span class="hljs-title function_">fetch</span>(url);
};
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>å¿…é¡»å…ˆä¿å­˜åŸå§‹æ–¹æ³•ï¼Œå¦åˆ™æ— æ³•å‘é€çœŸå®è¯·æ±‚</li>
<li>å¿…é¡»åœ¨ç½‘é¡µåŠ è½½å‰æ‰§è¡Œï¼Œå¦åˆ™æ‹¦æˆªä¸åˆ°æ—©æœŸè¯·æ±‚</li>
<li>XMLHttpRequest åŒç†ï¼Œé‡å†™ <code>open</code> å’Œ <code>send</code> æ–¹æ³•</li>
</ul>
<h2 data-id="heading-6">é¡¹ç›®ç»“æ„</h2>
<pre><code class="hljs language-bash" lang="bash">quick-mock/
â”œâ”€â”€ manifest.json      <span class="hljs-comment"># æ’ä»¶é…ç½®æ–‡ä»¶</span>
â”œâ”€â”€ popup.html         <span class="hljs-comment"># å¼¹çª—é¡µé¢</span>
â”œâ”€â”€ popup.css          <span class="hljs-comment"># å¼¹çª—æ ·å¼</span>
â”œâ”€â”€ popup.js           <span class="hljs-comment"># å¼¹çª—é€»è¾‘</span>
â”œâ”€â”€ content.js         <span class="hljs-comment"># å†…å®¹è„šæœ¬ </span>
â””â”€â”€ injected.js        <span class="hljs-comment"># æ³¨å…¥è„šæœ¬ </span>
</code></pre>
<p>ğŸš€ <em><strong>æµè§ˆé¡¹ç›®çš„å®Œæ•´ä»£ç å¯ä»¥ç‚¹å‡»è¿™é‡Œ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTeernage%2Fquick-mock" target="_blank" title="https://github.com/Teernage/quick-mock" ref="nofollow noopener noreferrer">github.com/Teernage/quâ€¦</a>ï¼Œå¦‚æœå¯¹ä½ æœ‰å¸®åŠ©æ¬¢è¿Starã€‚</strong></em></p>
<h2 data-id="heading-7">æ–‡ä»¶åˆ†å·¥ï¼š6 ä¸ªæ–‡ä»¶çš„è§’è‰²</h2>
<h3 data-id="heading-8">ç•Œé¢å±‚ï¼ˆç”¨æˆ·äº¤äº’ï¼‰</h3>
<h4 data-id="heading-9">1. <strong>popup.html</strong> - æ’ä»¶çš„"è„¸é¢"-   ä½œç”¨ï¼šç”¨æˆ·ç‚¹å‡»æ’ä»¶å›¾æ ‡çœ‹åˆ°çš„å¼¹çª—ç•Œé¢</h4>
<ul>
<li>åŒ…å«ï¼šè¾“å…¥æ¡†ã€æŒ‰é’®ã€è§„åˆ™åˆ—è¡¨</li>
</ul>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"stylesheet"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"popup.css"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"header"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>API Mock<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è½»é‡çº§æ¥å£æ¨¡æ‹Ÿå·¥å…·<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-open-tab"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"openTab"</span>&gt;</span>åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"card"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>URL åŒ¹é…è§„åˆ™<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"url-row"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"matchMode"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"match-mode-select"</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"contains"</span>&gt;</span>åŒ…å«<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
              <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"exact"</span>&gt;</span>å®Œæ•´åŒ¹é…<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"url"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¾“å…¥ URL æˆ–å…³é”®è¯"</span> /&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>è¯·æ±‚æ–¹æ³•<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"method"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"ALL"</span>&gt;</span>ALL<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"GET"</span>&gt;</span>GET<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"POST"</span>&gt;</span>POST<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"PUT"</span>&gt;</span>PUT<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"DELETE"</span>&gt;</span>DELETE<span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span>
          <span class="hljs-tag">&lt;/<span class="hljs-name">select</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"input-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">label</span>&gt;</span>Mock æ•°æ® (JSON)<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"data"</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">'{"code": 0, "data": {}}'</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-group"</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"add"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-primary"</span>&gt;</span>æ·»åŠ è§„åˆ™<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"clear"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"btn-secondary"</span>&gt;</span>æ¸…ç©ºå…¨éƒ¨<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rules-header"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>å·²æ·»åŠ è§„åˆ™<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"rules-count"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"count"</span>&gt;</span>0 æ¡<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"rules"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"popup.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h4 data-id="heading-10">2. <strong>popup.css</strong> - ç•Œé¢æ ·å¼</h4>
<pre><code class="hljs language-css" lang="css">* {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">480px</span>;
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">480px</span>;
  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'SF Pro Text'</span>, <span class="hljs-string">'PingFang SC'</span>,
    sans-serif;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fafafa</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
}

<span class="hljs-selector-class">.header</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span> <span class="hljs-number">18px</span> <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">background</span>: transparent;
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: start;
}

<span class="hljs-selector-class">.header</span> <span class="hljs-selector-tag">h1</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">letter-spacing</span>: -<span class="hljs-number">0.3px</span>;
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#6b7cff</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#8b9aff</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">display</span>: inline-block;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-selector-class">.header</span> <span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;
  <span class="hljs-attribute">margin-left</span>: <span class="hljs-number">2px</span>;
}

<span class="hljs-selector-class">.btn-open-tab</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
  <span class="hljs-attribute">white-space</span>: nowrap;
}

<span class="hljs-selector-class">.btn-open-tab</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.15</span>);
}

<span class="hljs-selector-class">.btn-open-tab</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">14px</span> <span class="hljs-number">14px</span>;
}

<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e8e8e8</span>;
}

<span class="hljs-selector-class">.input-group</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-class">.input-group</span><span class="hljs-selector-pseudo">:last-of-type</span> {
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">12px</span>;
}

<span class="hljs-selector-class">.input-group</span> <span class="hljs-selector-tag">label</span> {
  <span class="hljs-attribute">display</span>: block;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">5px</span>;
}

<span class="hljs-comment">/* URL è¾“å…¥è¡Œ */</span>
<span class="hljs-selector-class">.url-row</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">align-items</span>: center;
}

<span class="hljs-selector-class">.match-mode-select</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">85px</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">7px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.match-mode-select</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
}

<span class="hljs-selector-class">.match-mode-select</span><span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-tag">input</span>,
<span class="hljs-selector-tag">textarea</span>,
select {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e0e0e0</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">7px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">8px</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-tag">input</span><span class="hljs-selector-pseudo">:focus</span>,
<span class="hljs-selector-tag">textarea</span><span class="hljs-selector-pseudo">:focus</span>,
select<span class="hljs-selector-pseudo">:focus</span> {
  <span class="hljs-attribute">outline</span>: none;
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">3px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-tag">textarea</span> {
  <span class="hljs-attribute">min-height</span>: <span class="hljs-number">80px</span>;
  <span class="hljs-attribute">resize</span>: vertical;
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'SF Mono'</span>, Monaco, Consolas, monospace;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
}

<span class="hljs-selector-class">.btn-group</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.btn-primary</span>,
<span class="hljs-selector-class">.btn-secondary</span> {
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">9px</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">7px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.btn-primary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(<span class="hljs-number">135deg</span>, <span class="hljs-number">#6b7cff</span> <span class="hljs-number">0%</span>, <span class="hljs-number">#8b9aff</span> <span class="hljs-number">100%</span>);
  <span class="hljs-attribute">color</span>: white;
}

<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">12px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.3</span>);
}

<span class="hljs-selector-class">.btn-primary</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-selector-class">.btn-secondary</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
}

<span class="hljs-selector-class">.btn-secondary</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e8e8ea</span>;
}

<span class="hljs-selector-class">.rules-header</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">4px</span> <span class="hljs-number">8px</span>;
}

<span class="hljs-selector-class">.rules-header</span> <span class="hljs-selector-tag">h2</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
}

<span class="hljs-selector-class">.rules-count</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">10px</span>;
}

<span class="hljs-selector-id">#rules</span> {
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">300px</span>;
  <span class="hljs-attribute">overflow-y</span>: auto;
}

<span class="hljs-selector-class">.rule-item</span> {
  <span class="hljs-attribute">background</span>: white;
  <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#e8e8e8</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-comment">/*  æ·»åŠ ç¦ç”¨çŠ¶æ€æ ·å¼ */</span>
<span class="hljs-selector-class">.rule-item</span><span class="hljs-selector-class">.disabled</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.5</span>;
}

<span class="hljs-selector-class">.rule-item</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">border-color</span>: <span class="hljs-number">#6b7cff</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">2px</span> <span class="hljs-number">8px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">107</span>, <span class="hljs-number">124</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.1</span>);
}

<span class="hljs-selector-class">.rule-header</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">justify-content</span>: space-between;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-selector-class">.rule-url</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
  <span class="hljs-attribute">flex</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.rule-url</span> <span class="hljs-selector-tag">span</span><span class="hljs-selector-pseudo">:last-child</span> {
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">text-overflow</span>: ellipsis;
  <span class="hljs-attribute">white-space</span>: nowrap;
}

<span class="hljs-selector-class">.method-badge</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.method-all</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e0e7ff</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4338ca</span>;
}

<span class="hljs-selector-class">.method-get</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#d1fae5</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#065f46</span>;
}

<span class="hljs-selector-class">.method-post</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fef3c7</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#92400e</span>;
}

<span class="hljs-selector-class">.method-put</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#dbeafe</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1e40af</span>;
}

<span class="hljs-selector-class">.method-delete</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fee2e2</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#991b1b</span>;
}

<span class="hljs-selector-class">.match-mode-badge</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2px</span> <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.match-mode-contains</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f3f4f6</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
}

<span class="hljs-selector-class">.match-mode-exact</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e0e7ff</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#4338ca</span>;
}



<span class="hljs-comment">/* æ–°çš„å¼€å…³æ ·å¼ */</span>
<span class="hljs-selector-class">.rule-toggle-wrapper</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">6px</span>;
}

<span class="hljs-comment">/* éšè— checkbox */</span>
<span class="hljs-selector-class">.rule-toggle-checkbox</span> {
  <span class="hljs-attribute">display</span>: none;
}

<span class="hljs-selector-class">.toggleSwitch</span> {
  <span class="hljs-attribute">display</span>: flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">justify-content</span>: center;
  <span class="hljs-attribute">position</span>: relative;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">36px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">82</span>, <span class="hljs-number">82</span>, <span class="hljs-number">82</span>);
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.toggleSwitch</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">""</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">background-color</span>: transparent;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
  <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">3px</span> <span class="hljs-number">1px</span> <span class="hljs-number">5px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">0.26</span>);
  <span class="hljs-attribute">border</span>: <span class="hljs-number">4px</span> solid white;

}

<span class="hljs-selector-class">.rule-toggle-checkbox</span><span class="hljs-selector-pseudo">:checked</span>+<span class="hljs-selector-class">.toggleSwitch</span><span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateX</span>(<span class="hljs-number">100%</span>);
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
  <span class="hljs-attribute">background-color</span>: white;
}

<span class="hljs-selector-class">.rule-toggle-checkbox</span><span class="hljs-selector-pseudo">:checked</span>+<span class="hljs-selector-class">.toggleSwitch</span> {
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgb</span>(<span class="hljs-number">148</span>, <span class="hljs-number">118</span>, <span class="hljs-number">255</span>);
  <span class="hljs-attribute">transition-duration</span>: .<span class="hljs-number">2s</span>;
}

<span class="hljs-comment">/* ç¦ç”¨çŠ¶æ€æ—¶çš„å¼€å…³æ ·å¼ */</span>
<span class="hljs-selector-class">.disabled</span> <span class="hljs-selector-class">.toggleSwitch</span> {
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.6</span>;
}

<span class="hljs-selector-class">.btn-delete</span> {
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">10px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fee2e2</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#991b1b</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;
}

<span class="hljs-selector-class">.btn-delete</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#fecaca</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(-<span class="hljs-number">1px</span>);
}

<span class="hljs-selector-class">.btn-delete</span><span class="hljs-selector-pseudo">:active</span> {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
}

<span class="hljs-selector-class">.rule-data</span> {
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'SF Mono'</span>, Monaco, Consolas, monospace;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9fafb</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">overflow-x</span>: auto;
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">word-break</span>: break-all;
}

<span class="hljs-selector-class">.empty-state</span> {
  <span class="hljs-attribute">text-align</span>: center;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">40px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#8e8e93</span>;
}

<span class="hljs-selector-class">.empty-state</span> svg {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">48px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">48px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.3</span>;
}

<span class="hljs-selector-class">.empty-state</span> <span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
}

<span class="hljs-selector-class">.toast</span> {
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">top</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">50%</span>;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translate</span>(-<span class="hljs-number">50%</span>, -<span class="hljs-number">50%</span>);
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0.85</span>);
  <span class="hljs-attribute">color</span>: white;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span> <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">13px</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">10000</span>;
  <span class="hljs-attribute">animation</span>: fadeInOut <span class="hljs-number">1.5s</span> ease-in-out;
}

<span class="hljs-keyword">@keyframes</span> fadeInOut {

  <span class="hljs-number">0%</span>,
  <span class="hljs-number">100%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0</span>;
  }

  <span class="hljs-number">10%</span>,
  <span class="hljs-number">90%</span> {
    <span class="hljs-attribute">opacity</span>: <span class="hljs-number">1</span>;
  }
}

<span class="hljs-comment">/* æŠ˜å å±•å¼€ç›¸å…³æ ·å¼ */</span>
<span class="hljs-selector-class">.rule-data-wrapper</span> {
  <span class="hljs-attribute">position</span>: relative;
}

<span class="hljs-selector-class">.rule-data</span> {
  <span class="hljs-attribute">font-family</span>: <span class="hljs-string">'SF Mono'</span>, Monaco, Consolas, monospace;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f9fafb</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">6px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">overflow</span>: hidden;
  <span class="hljs-attribute">white-space</span>: pre-wrap;
  <span class="hljs-attribute">word-break</span>: break-all;
  <span class="hljs-attribute">max-height</span>: <span class="hljs-number">60px</span>;
  <span class="hljs-attribute">transition</span>: max-height <span class="hljs-number">0.3s</span> ease;
}

<span class="hljs-selector-class">.rule-data</span><span class="hljs-selector-class">.expanded</span> {
  <span class="hljs-attribute">max-height</span>: none;
}

<span class="hljs-selector-class">.btn-toggle-data</span> {
  <span class="hljs-attribute">display</span>: inline-flex;
  <span class="hljs-attribute">align-items</span>: center;
  <span class="hljs-attribute">gap</span>: <span class="hljs-number">4px</span>;
  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6px</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">4px</span> <span class="hljs-number">8px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#f5f5f7</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#6b7280</span>;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">5px</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">11px</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.btn-toggle-data</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">background</span>: <span class="hljs-number">#e8e8ea</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#1d1d1f</span>;
}

<span class="hljs-selector-class">.btn-toggle-data</span> svg {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">12px</span>;
  <span class="hljs-attribute">transition</span>: transform <span class="hljs-number">0.2s</span>;
}

<span class="hljs-selector-class">.btn-toggle-data</span><span class="hljs-selector-class">.expanded</span> svg {
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">rotate</span>(<span class="hljs-number">180deg</span>);
}

<span class="hljs-comment">/* æ¸å˜é®ç½©æ•ˆæœ */</span>
<span class="hljs-selector-class">.rule-data</span><span class="hljs-selector-pseudo">:not</span>(<span class="hljs-selector-class">.expanded</span>)<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">content</span>: <span class="hljs-string">''</span>;
  <span class="hljs-attribute">position</span>: absolute;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">right</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">20px</span>;
  <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to bottom, transparent, <span class="hljs-number">#f9fafb</span>);
  <span class="hljs-attribute">pointer-events</span>: none;
}
</code></pre>
<h4 data-id="heading-11">3. <strong>popup.js</strong> - ç•Œé¢é€»è¾‘</h4>
<p>ä½œç”¨ï¼šå¤„ç†ç”¨æˆ·é…ç½®mockæ“ä½œ</p>
<p>åŠŸèƒ½ï¼š</p>
<ul>
<li>ç‚¹å‡»"æ·»åŠ è§„åˆ™" â†’ ä¿å­˜åˆ° chrome.storage</li>
<li>ç‚¹å‡»"åˆ é™¤" â†’ ä» chrome.storage ç§»é™¤</li>
<li>æ¸²æŸ“è§„åˆ™åˆ—è¡¨</li>
</ul>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">let</span> rules = [];

<span class="hljs-keyword">const</span> openTabBtn = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'openTab'</span>);

<span class="hljs-comment">// åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€</span>
openTabBtn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">href</span>);
});

<span class="hljs-comment">// æ¢å¤è¾“å…¥æ¡†å†…å®¹</span>
chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">get</span>([<span class="hljs-string">'mockRules'</span>, <span class="hljs-string">'draftInput'</span>], <span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {
  rules = result.<span class="hljs-property">mockRules</span> || [];
  rules = rules.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">rule</span>) =&gt;</span> ({
    ...rule,
    <span class="hljs-attr">matchMode</span>: rule.<span class="hljs-property">matchMode</span> || <span class="hljs-string">'contains'</span>,
    <span class="hljs-attr">enabled</span>: rule.<span class="hljs-property">enabled</span> !== <span class="hljs-literal">false</span>, <span class="hljs-comment">//  é»˜è®¤å¯ç”¨</span>
  }));
  <span class="hljs-title function_">renderRules</span>();

  <span class="hljs-comment">// æ¢å¤è‰ç¨¿</span>
  <span class="hljs-keyword">const</span> draft = result.<span class="hljs-property">draftInput</span> || {};
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">url</span>) <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">url</span>;
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">method</span>) <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">method</span>;
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">matchMode</span>)
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">matchMode</span>;
  <span class="hljs-keyword">if</span> (draft.<span class="hljs-property">data</span>) <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span> = draft.<span class="hljs-property">data</span>;
});

<span class="hljs-comment">// ç›‘å¬è¾“å…¥æ¡†å˜åŒ–ï¼Œè‡ªåŠ¨ä¿å­˜è‰ç¨¿</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">saveDraft</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> draft = {
    <span class="hljs-attr">url</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>(),
    <span class="hljs-attr">method</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span>,
    <span class="hljs-attr">matchMode</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span>,
    <span class="hljs-attr">data</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>(),
  };
  chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">draftInput</span>: draft });
}

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, saveDraft);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, saveDraft);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, saveDraft);
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'input'</span>, saveDraft);

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'add'</span>).<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();
  <span class="hljs-keyword">const</span> method = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span>;
  <span class="hljs-keyword">const</span> matchMode = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span>;
  <span class="hljs-keyword">const</span> data = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span>.<span class="hljs-title function_">trim</span>();

  <span class="hljs-keyword">if</span> (!url || !data) {
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'è¯·å¡«å†™å®Œæ•´ä¿¡æ¯'</span>);
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(data);
    <span class="hljs-comment">//  æ·»åŠ  enabled: true</span>
    rules.<span class="hljs-title function_">push</span>({ url, method, matchMode, data, <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span> });
    chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: rules });

    <span class="hljs-comment">// æ¸…ç©ºè¾“å…¥æ¡†å’Œå­˜å‚¨</span>
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'url'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'data'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">''</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'method'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">'ALL'</span>;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'matchMode'</span>).<span class="hljs-property">value</span> = <span class="hljs-string">'contains'</span>;
    chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">'draftInput'</span>);

    <span class="hljs-title function_">renderRules</span>();
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'âœ“ æ·»åŠ æˆåŠŸ'</span>);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'JSON æ ¼å¼é”™è¯¯'</span>);
  }
};

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-property">onclick</span> = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">if</span> (rules.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">confirm</span>(<span class="hljs-string">'ç¡®å®šæ¸…ç©ºæ‰€æœ‰è§„åˆ™ï¼Ÿ'</span>)) {
    rules = [];
    chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: [] });
    <span class="hljs-title function_">renderRules</span>();
    <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'âœ“ å·²æ¸…ç©º'</span>);
  }
};

<span class="hljs-comment">//  æ·»åŠ å¼€å…³è§„åˆ™å‡½æ•°</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">toggleRule</span> = <span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> {
  rules[index].<span class="hljs-property">enabled</span> = !rules[index].<span class="hljs-property">enabled</span>;
  chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: rules });
  <span class="hljs-title function_">renderRules</span>();
  <span class="hljs-keyword">const</span> status = rules[index].<span class="hljs-property">enabled</span> ? <span class="hljs-string">'å·²å¯ç”¨'</span> : <span class="hljs-string">'å·²ç¦ç”¨'</span>;
  <span class="hljs-title function_">showToast</span>(<span class="hljs-string">`âœ“ <span class="hljs-subst">${status}</span>`</span>);
};

<span class="hljs-keyword">function</span> <span class="hljs-title function_">renderRules</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'rules'</span>);
  <span class="hljs-keyword">const</span> count = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'count'</span>);
  count.<span class="hljs-property">textContent</span> = <span class="hljs-string">`<span class="hljs-subst">${rules.length}</span> æ¡`</span>;

  <span class="hljs-keyword">if</span> (rules.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
    container.<span class="hljs-property">innerHTML</span> = <span class="hljs-string">`
      &lt;div class="empty-state"&gt;
        &lt;svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"&gt;
          &lt;rect x="3" y="3" width="18" height="18" rx="2"/&gt;
          &lt;path d="M9 9h6M9 15h6"/&gt;
        &lt;/svg&gt;
        &lt;p&gt;æš‚æ—  Mock è§„åˆ™&lt;/p&gt;
      &lt;/div&gt;
    `</span>;
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">const</span> matchModeText = {
    <span class="hljs-attr">contains</span>: <span class="hljs-string">'åŒ…å«'</span>,
    <span class="hljs-attr">exact</span>: <span class="hljs-string">'å®Œæ•´'</span>,
  };

  container.<span class="hljs-property">innerHTML</span> = rules
    .<span class="hljs-title function_">map</span>(
      <span class="hljs-function">(<span class="hljs-params">rule, i</span>) =&gt;</span> <span class="hljs-string">`
    &lt;div class="rule-item <span class="hljs-subst">${rule.enabled === <span class="hljs-literal">false</span> ? <span class="hljs-string">'disabled'</span> : <span class="hljs-string">''</span>}</span>"&gt;
      &lt;div class="rule-header"&gt;
        &lt;div class="rule-url"&gt;
          &lt;span class="method-badge method-<span class="hljs-subst">${(rule.method || <span class="hljs-string">'ALL'</span>).toLowerCase()}</span>"&gt;<span class="hljs-subst">${rule.method || <span class="hljs-string">'ALL'</span>}</span>&lt;/span&gt;
          &lt;span class="match-mode-badge match-mode-<span class="hljs-subst">${rule.matchMode || <span class="hljs-string">'contains'</span>}</span>"&gt;<span class="hljs-subst">${matchModeText[rule.matchMode] || <span class="hljs-string">'åŒ…å«'</span>}</span>&lt;/span&gt;
          &lt;span&gt;<span class="hljs-subst">${escapeHtml(rule.url)}</span>&lt;/span&gt;
        &lt;/div&gt;
        &lt;div style="display: flex; gap: 6px; align-items: center;"&gt;
          &lt;div class="rule-toggle-wrapper"&gt;
            &lt;input 
              type="checkbox" 
              class="rule-toggle-checkbox" 
              id="toggle-<span class="hljs-subst">${i}</span>" 
              data-index="<span class="hljs-subst">${i}</span>"
              <span class="hljs-subst">${rule.enabled !== <span class="hljs-literal">false</span> ? <span class="hljs-string">'checked'</span> : <span class="hljs-string">''</span>}</span>
            &gt;
            &lt;label for="toggle-<span class="hljs-subst">${i}</span>" class="toggleSwitch"&gt;&lt;/label&gt;
          &lt;/div&gt;
          &lt;button class="btn-delete" data-index="<span class="hljs-subst">${i}</span>"&gt;åˆ é™¤&lt;/button&gt;
        &lt;/div&gt;
      &lt;/div&gt;
      &lt;div class="rule-data-wrapper"&gt;
        &lt;div class="rule-data" data-index="<span class="hljs-subst">${i}</span>"&gt;<span class="hljs-subst">${escapeHtml(rule.data)}</span>&lt;/div&gt;
        <span class="hljs-subst">${rule.data.length &gt; <span class="hljs-number">100</span> ? <span class="hljs-string">`
          &lt;button class="btn-toggle-data" data-index="<span class="hljs-subst">${i}</span>"&gt;
            &lt;span class="toggle-text"&gt;å±•å¼€&lt;/span&gt;
            &lt;svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"&gt;
              &lt;polyline points="6 9 12 15 18 9"&gt;&lt;/polyline&gt;
            &lt;/svg&gt;
          &lt;/button&gt;
        `</span> : <span class="hljs-string">''</span>}</span>
      &lt;/div&gt;
    &lt;/div&gt;
  `</span>
    )
    .<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);

  <span class="hljs-comment">// å¼€å…³æŒ‰é’®äº‹ä»¶ï¼ˆæ›¿æ¢åŸæ¥çš„ .btn-toggle äº‹ä»¶ï¼‰</span>
  container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.rule-toggle-checkbox'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">checkbox</span>) =&gt;</span> {
    checkbox.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Number</span>(e.<span class="hljs-property">target</span>.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-index'</span>));
      <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(index)) {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">toggleRule</span>(index);
      }
    });
  });

  <span class="hljs-comment">// åˆ é™¤æŒ‰é’®äº‹ä»¶</span>
  container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.btn-delete'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">btn</span>) =&gt;</span> {
    btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Number</span>(btn.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-index'</span>));
      <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(index)) {
        rules.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);
        chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">set</span>({ <span class="hljs-attr">mockRules</span>: rules });
        <span class="hljs-title function_">renderRules</span>();
        <span class="hljs-title function_">showToast</span>(<span class="hljs-string">'âœ“ å·²åˆ é™¤'</span>);
      }
    });
  });

  <span class="hljs-comment">// æŠ˜å å±•å¼€æŒ‰é’®äº‹ä»¶</span>
  container.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.btn-toggle-data'</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">btn</span>) =&gt;</span> {
    btn.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">const</span> index = <span class="hljs-title class_">Number</span>(btn.<span class="hljs-title function_">getAttribute</span>(<span class="hljs-string">'data-index'</span>));
      <span class="hljs-keyword">const</span> dataElement = container.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">`.rule-data[data-index="<span class="hljs-subst">${index}</span>"]`</span>);
      <span class="hljs-keyword">const</span> isExpanded = dataElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">contains</span>(<span class="hljs-string">'expanded'</span>);

      dataElement.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'expanded'</span>);
      btn.<span class="hljs-property">classList</span>.<span class="hljs-title function_">toggle</span>(<span class="hljs-string">'expanded'</span>);
      btn.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'.toggle-text'</span>).<span class="hljs-property">textContent</span> = isExpanded ? <span class="hljs-string">'å±•å¼€'</span> : <span class="hljs-string">'æ”¶èµ·'</span>;
    });
  });
}



<span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeHtml</span>(<span class="hljs-params">text</span>) {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  div.<span class="hljs-property">textContent</span> = text;
  <span class="hljs-keyword">return</span> div.<span class="hljs-property">innerHTML</span>;
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">showToast</span>(<span class="hljs-params">message</span>) {
  <span class="hljs-keyword">const</span> toast = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  toast.<span class="hljs-property">className</span> = <span class="hljs-string">'toast'</span>;
  toast.<span class="hljs-property">textContent</span> = message;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(toast);
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> toast.<span class="hljs-title function_">remove</span>(), <span class="hljs-number">1500</span>);
}

</code></pre>
<h3 data-id="heading-12">æ ¸å¿ƒå±‚ï¼ˆæ‹¦æˆªé€»è¾‘ï¼‰</h3>
<h4 data-id="heading-13">4. <strong>content.js</strong> - "ä¸­é—´äºº"</h4>
<p>ä½œç”¨ï¼šè¿æ¥æ’ä»¶å’Œç½‘é¡µçš„æ¡¥æ¢</p>
<p>èƒ½åŠ›ï¼š</p>
<ul>
<li>å¯ä»¥è®¿é—® Chrome APIï¼ˆè¯»å– chrome.storageï¼‰</li>
<li>å¯ä»¥è®¿é—®ç½‘é¡µ DOM</li>
<li>ä¸èƒ½è®¿é—®ç½‘é¡µçš„ JavaScript ç¯å¢ƒï¼ˆwindow.fetchï¼‰</li>
</ul>
<p>èŒè´£ï¼š</p>
<ol>
<li>æŠŠ injected.js æ³¨å…¥åˆ°ç½‘é¡µ</li>
<li>è¯»å–ç”¨æˆ·é…ç½®çš„ Mock è§„åˆ™</li>
<li>é€šè¿‡ postMessage ä¸ injected.js é€šä¿¡</li>
</ol>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * åœ¨é¡µé¢ä¸­æ³¨å…¥æ‰©å±•çš„ injected.js è„šæœ¬ã€‚
 * ä½¿ç”¨ chrome.runtime.getURL è·å–æ‰©å±•å†…èµ„æºçš„ç»å¯¹ URLã€‚
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'script'</span>);
  script.<span class="hljs-property">src</span> = chrome.<span class="hljs-property">runtime</span>.<span class="hljs-title function_">getURL</span>(<span class="hljs-string">'injected.js'</span>);
  (<span class="hljs-variable language_">document</span>.<span class="hljs-property">head</span> || <span class="hljs-variable language_">document</span>.<span class="hljs-property">documentElement</span>).<span class="hljs-title function_">appendChild</span>(script);
}

<span class="hljs-title function_">init</span>();

<span class="hljs-comment">/**
 * å®‰å…¨è¯»å–æœ¬åœ°å­˜å‚¨ä¸­çš„ mock è§„åˆ™ã€‚
 * è‹¥æ‰©å±•æœªåŠ è½½æˆ– API ä¸å¯ç”¨ã€æˆ–è¯»å–å¤±è´¥ï¼Œè¿”å›ç©ºæ•°ç»„ã€‚
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">Array</span>}  - mock è§„åˆ™æ•°ç»„ã€‚
 */</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMockRulesSafely</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span> (!chrome?.<span class="hljs-property">runtime</span>?.<span class="hljs-property">id</span> || !chrome?.<span class="hljs-property">storage</span>?.<span class="hljs-property">local</span>) <span class="hljs-keyword">return</span> [];
    <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> chrome.<span class="hljs-property">storage</span>.<span class="hljs-property">local</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">'mockRules'</span>);
    <span class="hljs-keyword">if</span> (chrome.<span class="hljs-property">runtime</span>.<span class="hljs-property">lastError</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] è¯»å–å­˜å‚¨å¤±è´¥:'</span>, chrome.<span class="hljs-property">runtime</span>.<span class="hljs-property">lastError</span>);
      <span class="hljs-keyword">return</span> [];
    }
    <span class="hljs-keyword">const</span> rules = result.<span class="hljs-property">mockRules</span> || [];
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(rules) ? rules : [];
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] è¯»å–å­˜å‚¨å¼‚å¸¸:'</span>, err);
    <span class="hljs-keyword">return</span> [];
  }
}

<span class="hljs-comment">/**
 * æ ¹æ®åŒ¹é…æ¨¡å¼å¯¹ URL è¿›è¡ŒåŒ¹é…ã€‚
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">url</span>  - è¯·æ±‚çš„ URLã€‚
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">pattern</span>  - åŒ¹é…è§„åˆ™ã€‚
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">mode</span>  - åŒ¹é…æ¨¡å¼
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">boolean</span>}  - åŒ¹é…ç»“æœã€‚
 */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">matchUrl</span>(<span class="hljs-params">url, pattern, mode</span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">switch</span> (mode) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'exact'</span>:
        <span class="hljs-keyword">return</span> url === pattern;
      <span class="hljs-keyword">case</span> <span class="hljs-string">'contains'</span>:
      <span class="hljs-attr">default</span>:
        <span class="hljs-keyword">return</span> url.<span class="hljs-title function_">includes</span>(pattern);
    }
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] URL åŒ¹é…å¤±è´¥:'</span>, e);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
}

<span class="hljs-comment">/**
 * ç›‘å¬æ¥è‡ª content-script çš„æ¶ˆæ¯ã€‚
 * è‹¥æ¶ˆæ¯ç±»å‹ä¸º MOCK_REQUESTï¼Œåˆ™æ ¹æ® URL å’Œ method åŒ¹é…è§„åˆ™ï¼Œè¿”å›å¯¹åº”çš„ mock æ•°æ®ã€‚
 */</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">async</span> (event) =&gt; {
  <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> !== <span class="hljs-string">'MOCK_REQUEST'</span>) <span class="hljs-keyword">return</span>;

  <span class="hljs-keyword">const</span> { url, method, id } = event.<span class="hljs-property">data</span>;
  <span class="hljs-keyword">const</span> rules = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getMockRulesSafely</span>();

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> rule <span class="hljs-keyword">of</span> rules) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-comment">// æ·»åŠ å¯ç”¨çŠ¶æ€æ£€æŸ¥</span>
      <span class="hljs-keyword">if</span> (rule.<span class="hljs-property">enabled</span> === <span class="hljs-literal">false</span>) <span class="hljs-keyword">continue</span>;

      <span class="hljs-keyword">const</span> matchMode = rule.<span class="hljs-property">matchMode</span> || <span class="hljs-string">'contains'</span>;
      <span class="hljs-keyword">const</span> urlMatch = <span class="hljs-title function_">matchUrl</span>(url, rule.<span class="hljs-property">url</span>, matchMode);
      <span class="hljs-keyword">const</span> methodMatch = rule.<span class="hljs-property">method</span> === <span class="hljs-string">'ALL'</span> || rule.<span class="hljs-property">method</span> === method;

      <span class="hljs-keyword">if</span> (urlMatch &amp;&amp; methodMatch) {
        <span class="hljs-keyword">let</span> mockData = rule.<span class="hljs-property">data</span>;
        <span class="hljs-keyword">try</span> {
          mockData = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(rule.<span class="hljs-property">data</span>);
        } <span class="hljs-keyword">catch</span> (e) {
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] JSON è§£æå¤±è´¥ï¼Œä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²'</span>);
        }

        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
          {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_RESPONSE'</span>,
            id,
            <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">true</span>,
            mockData,
            <span class="hljs-attr">status</span>: <span class="hljs-number">200</span>,
            <span class="hljs-attr">headers</span>: { <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span> },
          },
          <span class="hljs-string">'*'</span>
        );
        <span class="hljs-keyword">return</span>;
      }
    } <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'[Mock] è§„åˆ™å¤„ç†å¤±è´¥:'</span>, e);
      <span class="hljs-keyword">continue</span>;
    }
  }

  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_RESPONSE'</span>, id, <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">false</span> }, <span class="hljs-string">'*'</span>);
});

</code></pre>
<h4 data-id="heading-14">5. <strong>injected.js</strong> - "åŠ«åŒª"</h4>
<p>ä½œç”¨ï¼šçœŸæ­£æ‰§è¡Œæ‹¦æˆªçš„ä»£ç </p>
<p>èƒ½åŠ›ï¼š</p>
<ul>
<li>
<p><code>å¯ä»¥</code>è®¿é—®ç½‘é¡µçš„ JavaScript ç¯å¢ƒï¼ˆwindow.fetchï¼‰</p>
</li>
<li>
<p><code>å¯ä»¥</code>é‡å†™ fetch å’Œ XMLHttpRequest</p>
</li>
<li>
<p><code>ä¸èƒ½</code>è®¿é—® Chrome APIï¼ˆchrome.storageï¼‰</p>
</li>
</ul>
<p>èŒè´£ï¼š</p>
<ol>
<li>é‡å†™ window.fetch</li>
<li>é‡å†™ XMLHttpRequest.prototype.open/send</li>
<li>æ‹¦æˆªè¯·æ±‚ï¼Œè¯¢é—® content.js æ˜¯å¦éœ€è¦ Mock</li>
<li>æ ¹æ®å›å¤å†³å®šè¿”å›å‡æ•°æ®è¿˜æ˜¯çœŸå®è¯·æ±‚</li>
</ol>
<pre><code class="hljs language-js" lang="js">(<span class="hljs-keyword">function</span> (<span class="hljs-params"/>) {
  <span class="hljs-comment">//  ä¿å­˜åŸå§‹æ–¹æ³•</span>
  <span class="hljs-keyword">const</span> originalFetch = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;
  <span class="hljs-keyword">const</span> originalXHROpen = <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">open</span>;
  <span class="hljs-keyword">const</span> originalXHRSend = <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">send</span>;
  <span class="hljs-keyword">const</span> pendingRequests = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>(); <span class="hljs-comment">// å­˜å‚¨ç­‰å¾…å“åº”çš„è¯·æ±‚ï¼ˆkey: id, value: resolve å‡½æ•°ï¼‰</span>
  <span class="hljs-keyword">let</span> requestId = <span class="hljs-number">0</span>; <span class="hljs-comment">// æ¯ä¸ªè¯·æ±‚ID</span>

  <span class="hljs-comment">/**
   * ç›‘å¬æ¥è‡ª content-script çš„ mock å“åº”ã€‚
   * è‹¥æ¶ˆæ¯ç±»å‹ä¸º MOCK_RESPONSEï¼Œæ ¹æ®è¯·æ±‚IDåŒ¹é…å¹¶è°ƒç”¨å¯¹åº”çš„ resolve å‡½æ•°ã€‚
   */</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span>.<span class="hljs-property">type</span> !== <span class="hljs-string">'MOCK_RESPONSE'</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">const</span> { id, shouldMock, mockData, status, headers } = event.<span class="hljs-property">data</span>;
    <span class="hljs-keyword">const</span> resolve = pendingRequests.<span class="hljs-title function_">get</span>(id);

    <span class="hljs-keyword">if</span> (resolve) {
      <span class="hljs-title function_">resolve</span>({ shouldMock, mockData, status, headers });
      pendingRequests.<span class="hljs-title function_">delete</span>(id);
    }
  });

  <span class="hljs-comment">/**
   * è§„èŒƒåŒ– URLã€‚
   * è‹¥è¾“å…¥ä¸ºå­—ç¬¦ä¸²ï¼Œç›´æ¥è¿”å›ï¼›
   * è‹¥è¾“å…¥ä¸ºå¯¹è±¡ä¸”åŒ…å« url å±æ€§ï¼Œè¿”å›è¯¥å±æ€§å€¼ï¼›å¦åˆ™è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">input</span>  - è¯·æ±‚çš„ URL æˆ–åŒ…å« URL çš„å¯¹è±¡ã€‚
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>}  - è§„èŒƒåŒ–åçš„ URLã€‚
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">normalizeUrl</span>(<span class="hljs-params">input</span>) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input === <span class="hljs-string">'string'</span>) <span class="hljs-keyword">return</span> input;
      <span class="hljs-keyword">if</span> (input &amp;&amp; <span class="hljs-keyword">typeof</span> input === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-string">'url'</span> <span class="hljs-keyword">in</span> input) {
        <span class="hljs-keyword">return</span> input.<span class="hljs-property">url</span>;
      }
    } <span class="hljs-keyword">catch</span> (_) {}
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">String</span>(input);
  }

  <span class="hljs-comment">/**
   * è·å–è¯·æ±‚æ–¹æ³•
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">url</span>  - è¯·æ±‚çš„ URL æˆ–åŒ…å« URL çš„å¯¹è±¡ã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">options</span>  - è¯·æ±‚çš„é€‰é¡¹ã€‚
   * <span class="hljs-doctag">@returns</span>
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">getMethod</span>(<span class="hljs-params">url, options</span>) {
    <span class="hljs-keyword">if</span> (url &amp;&amp; <span class="hljs-keyword">typeof</span> url === <span class="hljs-string">'object'</span> &amp;&amp; <span class="hljs-string">'method'</span> <span class="hljs-keyword">in</span> url) {
      <span class="hljs-keyword">return</span> url.<span class="hljs-property">method</span>.<span class="hljs-title function_">toUpperCase</span>();
    }
    <span class="hljs-keyword">return</span> (options?.<span class="hljs-property">method</span> || <span class="hljs-string">'GET'</span>).<span class="hljs-title function_">toUpperCase</span>();
  }

  <span class="hljs-comment">/**
   *  å‘é€ Mock è¯·æ±‚åˆ° content-scriptã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">url</span> - è¯·æ±‚çš„ URL æˆ–åŒ…å« URL çš„å¯¹è±¡ã€‚
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">*</span>} <span class="hljs-variable">method</span> - è¯·æ±‚çš„æ–¹æ³•ã€‚
   * <span class="hljs-doctag">@returns</span>
   */</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">sendMockRequest</span>(<span class="hljs-params">url, method</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> id = requestId++;
      pendingRequests.<span class="hljs-title function_">set</span>(id, resolve);

      <span class="hljs-keyword">const</span> safeUrl = <span class="hljs-title function_">normalizeUrl</span>(url);

      <span class="hljs-keyword">try</span> {
        <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>(
          {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_REQUEST'</span>,
            <span class="hljs-attr">url</span>: safeUrl,
            method,
            id,
          },
          <span class="hljs-string">'*'</span>
        );
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">if</span> (pendingRequests.<span class="hljs-title function_">has</span>(id)) {
          <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">false</span> });
          pendingRequests.<span class="hljs-title function_">delete</span>(id);
        }
        <span class="hljs-keyword">return</span>;
      }
      <span class="hljs-comment">// è¶…æ—¶ä¿æŠ¤ï¼š100ms å†…æ²¡æ”¶åˆ°å“åº”ï¼Œè‡ªåŠ¨æ”¾è¡Œï¼ˆå‘é€çœŸå®è¯·æ±‚ï¼‰</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (pendingRequests.<span class="hljs-title function_">has</span>(id)) {
          <span class="hljs-title function_">resolve</span>({ <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">false</span> });
          pendingRequests.<span class="hljs-title function_">delete</span>(id);
        }
      }, <span class="hljs-number">100</span>);
    });
  }

  <span class="hljs-comment">// ========== Fetch æ‹¦æˆª ==========</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">url, options = {}</span>) {
    <span class="hljs-keyword">const</span> method = <span class="hljs-title function_">getMethod</span>(url, options);
    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendMockRequest</span>(url, method);

    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">shouldMock</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">mockData</span>), {
        <span class="hljs-attr">status</span>: response.<span class="hljs-property">status</span>,
        <span class="hljs-attr">headers</span>: response.<span class="hljs-property">headers</span>,
      });
    }

    <span class="hljs-keyword">return</span> originalFetch.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
  };

  <span class="hljs-comment">// ========== XMLHttpRequest æ‹¦æˆª ==========</span>
  <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">open</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">method, url, ...rest</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockMethod</span> = method.<span class="hljs-title function_">toUpperCase</span>();
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockUrl</span> = url;
    <span class="hljs-keyword">return</span> originalXHROpen.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, [method, url, ...rest]);
  };

  <span class="hljs-title class_">XMLHttpRequest</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">send</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">body</span>) {
    <span class="hljs-keyword">const</span> method = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockMethod</span> || <span class="hljs-string">'GET'</span>;
    <span class="hljs-keyword">const</span> url = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_mockUrl</span>;

    <span class="hljs-keyword">if</span> (!url) {
      <span class="hljs-keyword">return</span> originalXHRSend.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
    }

    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">sendMockRequest</span>(url, method);

    <span class="hljs-keyword">if</span> (response.<span class="hljs-property">shouldMock</span>) {
      <span class="hljs-comment">// æ¨¡æ‹Ÿ XHR å“åº”</span>
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'readyState'</span>, { <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">value</span>: <span class="hljs-number">4</span> });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'status'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: response.<span class="hljs-property">status</span>,
      });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'statusText'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-string">'OK'</span>,
      });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'responseText'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">mockData</span>),
      });
      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'response'</span>, {
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">value</span>: <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">mockData</span>),
      });

      <span class="hljs-comment">// è§¦å‘äº‹ä»¶</span>
      <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onreadystatechange</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onreadystatechange</span>();
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">onload</span>) {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onload</span>();
        }
      }, <span class="hljs-number">0</span>);

      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">return</span> originalXHRSend.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
  };
})();
</code></pre>
<h3 data-id="heading-15">é…ç½®å±‚</h3>
<h4 data-id="heading-16">6. <strong>manifest.json</strong> - æ’ä»¶çš„"èº«ä»½è¯"</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"manifest_version"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"API Mock Tool"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"permissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"storage"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"activeTab"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"default_popup"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"popup.html"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"content_scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"js"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"content.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"run_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"document_start"</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"web_accessible_resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"injected.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
      <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>

</code></pre>
<h3 data-id="heading-17">å®‰è£…æ‰©å±•</h3>
<ol>
<li>æ‰“å¼€Chromeæµè§ˆå™¨</li>
<li>åœ°å€æ è¾“å…¥ï¼š<code>chrome://extensions/</code></li>
<li>æ‰“å¼€å³ä¸Šè§’"å¼€å‘è€…æ¨¡å¼"</li>
<li>ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"</li>
<li>é€‰æ‹©åˆšæ‰çš„æ–‡ä»¶å¤¹</li>
<li>æå®šï¼æ‰©å±•å®‰è£…å®Œæˆï¼</li>
</ol>
<h4 data-id="heading-18">å®‰è£…æ“ä½œæ¼”ç¤ºï¼š</h4>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b3757cfb50c944109f1055b036e06ff1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiN5LiA5qC355qE5bCR5bm0Xw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763425628&amp;x-signature=Gr0RSqoaKXZZn5aVjWGVkWYgLaQ%3D" alt="å®‰è£…mockæ’ä»¶.gif" loading="lazy"/></p>
<h2 data-id="heading-19">æ–‡ä»¶åä½œæµç¨‹ï¼ˆå®Œæ•´é“¾è·¯ï¼‰</h2>
<h3 data-id="heading-20">ç¬¬ä¸€é˜¶æ®µï¼šç”¨æˆ·é…ç½®è§„åˆ™</h3>
<pre><code class="hljs language-c" lang="c">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·æ“ä½œ    â”‚ åœ¨ popup.html è¾“å…¥ Mock è§„åˆ™
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  popup.js   â”‚ ç‚¹å‡»<span class="hljs-string">"æ·»åŠ "</span>æŒ‰é’®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ chrome.storage.local.<span class="hljs-built_in">set</span>({ mockRules: [...] })
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Chrome Storageâ”‚ æŒä¹…åŒ–å­˜å‚¨è§„åˆ™ï¼ˆå…³é—­æµè§ˆå™¨ä¹Ÿä¸ä¸¢å¤±ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-21">ç¬¬äºŒé˜¶æ®µï¼šé¡µé¢åŠ è½½æ—¶æ³¨å…¥è„šæœ¬</h3>
<pre><code class="hljs language-ini" lang="ini">ç”¨æˆ·æ‰“å¼€ç½‘é¡µï¼ˆå¦‚ https://example.comï¼‰
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚manifest.jsonâ”‚ æ£€æµ‹åˆ°åŒ¹é…çš„ URL
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ è‡ªåŠ¨æ³¨å…¥
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ content.js  â”‚ åœ¨ç½‘é¡µä¸Šä¸‹æ–‡è¿è¡Œï¼ˆä½†åœ¨éš”ç¦»æ²™ç®±ï¼‰
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ åˆ›å»º &lt;script&gt; æ ‡ç­¾
       â”‚ <span class="hljs-attr">script.src</span> = chrome.runtime.getURL(<span class="hljs-string">'injected.js'</span>)
       â”‚ document.head.appendChild(script)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ injected.js â”‚ åœ¨ç½‘é¡µçœŸå®ç¯å¢ƒè¿è¡Œ
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ <span class="hljs-attr">window.fetch</span> = æˆ‘ä»¬çš„å‡fetch<span class="hljs-comment">;</span>
       â†“
    æ‹¦æˆªå°±ç»ªï¼
</code></pre>
<h3 data-id="heading-22">ç¬¬ä¸‰é˜¶æ®µï¼šæ‹¦æˆªè¯·æ±‚ï¼ˆå®æ—¶é€šä¿¡ï¼‰</h3>
<pre><code class="hljs language-php" lang="php">ç½‘é¡µä»£ç æ‰§è¡Œï¼š<span class="hljs-title function_ invoke__">fetch</span>(<span class="hljs-string">'/api/user'</span>)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ injected.js         
â”‚ æˆ‘ä»¬çš„å‡ fetch è¢«è°ƒç”¨ 
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ window.<span class="hljs-title function_ invoke__">postMessage</span>({
       â”‚   <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_REQUEST'</span>,
       â”‚   <span class="hljs-attr">url</span>: <span class="hljs-string">'/api/user'</span>,
       â”‚   <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>
       â”‚ })
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ content.js          â”‚ ç›‘å¬ message äº‹ä»¶
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ <span class="hljs-number">1</span>. è¯»å– chrome.storage.local
       â”‚ <span class="hljs-number">2</span>. éå†è§„åˆ™ï¼Œæ£€æŸ¥æ˜¯å¦åŒ¹é…
       â”‚ <span class="hljs-number">3</span>. æ‰¾åˆ°åŒ¹é…è§„åˆ™
       â†“
       â”‚ window.<span class="hljs-title function_ invoke__">postMessage</span>({
       â”‚   <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_RESPONSE'</span>,
       â”‚   <span class="hljs-attr">shouldMock</span>: <span class="hljs-literal">true</span>,
       â”‚   <span class="hljs-attr">mockData</span>: { <span class="hljs-attr">name</span>: <span class="hljs-string">'Mock User'</span> }
       â”‚ })
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ injected.js         â”‚ æ”¶åˆ°å›å¤
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ <span class="hljs-keyword">if</span> (shouldMock) {
       â”‚   <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>(JSON.<span class="hljs-title function_ invoke__">stringify</span>(mockData));
       â”‚ } <span class="hljs-keyword">else</span> {
       â”‚   <span class="hljs-keyword">return</span> çœŸ<span class="hljs-title function_ invoke__">fetch</span>(url); <span class="hljs-comment">// è°ƒç”¨åŸå§‹æ–¹æ³•</span>
       â”‚ }
       â†“
ç½‘é¡µä»£ç æ”¶åˆ°å“åº”ï¼š{ name: <span class="hljs-string">'Mock User'</span> }
</code></pre>
<h2 data-id="heading-23">ä¸ºä»€ä¹ˆè¦åˆ† content.js å’Œ injected.jsï¼Ÿ</h2>
<h3 data-id="heading-24">åªç”¨ Content Script è¡Œä¸è¡Œï¼Ÿ</h3>
<p><strong>ä¸è¡Œï¼</strong> å› ä¸º Content Script è¿è¡Œåœ¨éš”ç¦»çš„æ²™ç®±ä¸­ï¼Œæ— æ³•è®¿é—®ç½‘é¡µçš„ <code>window.fetch</code>ã€‚</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// content.js ä¸­è¿™æ ·åšæ˜¯æ— æ•ˆçš„ï¼</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) { 
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ‹¦æˆªå¤±è´¥ï¼'</span>); <span class="hljs-comment">// ç½‘é¡µçœ‹ä¸åˆ°è¿™ä¸ªä¿®æ”¹</span>
}
</code></pre>
<h3 data-id="heading-25">åªç”¨ Injected Script è¡Œä¸è¡Œï¼Ÿ</h3>
<p><strong>ä¸è¡Œï¼</strong> å› ä¸º Injected Script æ— æ³•è®¿é—® <code>chrome.storage</code> ç­‰ Chrome APIï¼Œæ— æ³•è¯»å–ç”¨æˆ·é…ç½®çš„ Mock è§„åˆ™ã€‚</p>
<pre><code class="hljs language-scss" lang="scss">### æ­£ç¡®æ–¹æ¡ˆï¼šä¸¤è€…é…åˆ

ç”¨æˆ·é…ç½® Mock è§„åˆ™
â†“
å­˜å‚¨åˆ° chrome<span class="hljs-selector-class">.storage</span> (Popup)
â†“
è¯»å–è§„åˆ™ (Content Script) â† å¯ä»¥è®¿é—® Chrome API
â†“
é€šè¿‡ postMessage é€šä¿¡
â†“
æ‹¦æˆª fetch (Injected Script) â† å¯ä»¥ä¿®æ”¹ window<span class="hljs-selector-class">.fetch</span>
</code></pre>
<h3 data-id="heading-26">é€šä¿—æ¯”å–»</h3>
<pre><code class="hljs language-markdown" lang="markdown">content.js = é“¶è¡Œé‡‘åº“ç®¡ç†å‘˜
<span class="hljs-bullet">  -</span> æœ‰é’¥åŒ™ï¼ˆChrome API æƒé™ï¼‰
<span class="hljs-bullet">  -</span> èƒ½è¯»å–ä¿é™©ç®±ï¼ˆchrome.storageï¼‰
<span class="hljs-bullet">  -</span> ä½†ä¸èƒ½ç›´æ¥æ¥è§¦å®¢æˆ·ï¼ˆç½‘é¡µ JavaScriptï¼‰

injected.js = é“¶è¡Œå¤§å ‚ç»ç†
<span class="hljs-bullet">  -</span> ç›´æ¥é¢å¯¹å®¢æˆ·ï¼ˆç½‘é¡µä»£ç ï¼‰
<span class="hljs-bullet">  -</span> èƒ½æ‹¦æˆªå®¢æˆ·è¯·æ±‚ï¼ˆé‡å†™ fetchï¼‰
<span class="hljs-bullet">  -</span> ä½†æ²¡æœ‰é‡‘åº“é’¥åŒ™ï¼ˆæ— æ³•è®¿é—® chrome.storageï¼‰

è§£å†³æ–¹æ¡ˆï¼šä¸¤äººç”¨å¯¹è®²æœºï¼ˆpostMessageï¼‰é€šä¿¡
  å®¢æˆ·å‘èµ·è¯·æ±‚ â†’ å¤§å ‚ç»ç†æ‹¦æˆª â†’ å¯¹è®²æœºé—®ç®¡ç†å‘˜"è¦ä¸è¦æ”¾è¡Œ"
  â†’ ç®¡ç†å‘˜æŸ¥ä¿é™©ç®± â†’ å›å¤"ä¸æ”¾è¡Œï¼Œç»™å‡é’" â†’ å¤§å ‚ç»ç†è¿”å›å‡é’
</code></pre>
<h2 data-id="heading-27">å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“</h2>
<h3 data-id="heading-28">1. <strong>ä¸ºä»€ä¹ˆè¦ç”¨</strong> <strong><code>run_at: "document_start"</code></strong> <strong>ï¼Ÿ</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// manifest.json</span>
<span class="hljs-attr">"run_at"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"document_start"</span>  <span class="hljs-comment">// åœ¨ HTML è§£æå‰è¿è¡Œ</span>
</code></pre>
<p><strong>åŸå› ï¼š</strong> å¦‚æœç½‘é¡µåœ¨æ’ä»¶åŠ è½½å‰å°±æ‰§è¡Œäº† <code>fetch('/api/data')</code>ï¼Œæˆ‘ä»¬å°±æ‹¦æˆªä¸åˆ°äº†ã€‚</p>
<h3 data-id="heading-29">2. <strong>ä¸ºä»€ä¹ˆè¦ç”¨</strong> <strong><code>web_accessible_resources</code></strong> <strong>ï¼Ÿ</strong></h3>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// manifest.json</span>
<span class="hljs-attr">"web_accessible_resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"resources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"injected.js"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"matches"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"&lt;all_urls&gt;"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span><span class="hljs-punctuation">]</span>
</code></pre>
<p><strong>åŸå› ï¼š</strong> é»˜è®¤æƒ…å†µä¸‹ï¼Œç½‘é¡µæ— æ³•åŠ è½½æ’ä»¶å†…éƒ¨çš„æ–‡ä»¶ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰ã€‚è¿™ä¸ªé…ç½®ç›¸å½“äºç»™ <code>injected.js</code> å¼€äº†"ç»¿è‰²é€šé“"ã€‚</p>
<h3 data-id="heading-30">3. <strong>ä¸ºä»€ä¹ˆç”¨</strong> <strong><code>postMessage</code></strong> <strong>è€Œä¸æ˜¯å…¨å±€å˜é‡ï¼Ÿ</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// âŒ é”™è¯¯åšæ³•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">mockRules</span> = [...];  <span class="hljs-comment">// content.js è®¾ç½®</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">mockRules</span>);  <span class="hljs-comment">// injected.js è¯»å–ï¼ˆè¯»ä¸åˆ°ï¼ï¼‰</span>

<span class="hljs-comment">// âœ… æ­£ç¡®åšæ³•</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">type</span>: <span class="hljs-string">'MOCK_REQUEST'</span> }, <span class="hljs-string">'*'</span>);  <span class="hljs-comment">// injected.js å‘é€</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> { ... });  <span class="hljs-comment">// content.js æ¥æ”¶</span>
</code></pre>
<p><strong>åŸå› ï¼š</strong> content.js å’Œ injected.js è™½ç„¶åœ¨åŒä¸€ä¸ªç½‘é¡µï¼Œä½† JavaScript ç¯å¢ƒæ˜¯éš”ç¦»çš„ï¼Œå°±åƒä¸¤ä¸ªå¹³è¡Œä¸–ç•Œï¼Œåªèƒ½é€šè¿‡ <code>postMessage</code> è¿™ä¸ª"ä¼ é€é—¨"é€šä¿¡ã€‚</p>
<h3 data-id="heading-31">4. <strong>ä¸ºä»€ä¹ˆè¦ä¿å­˜åŸå§‹ fetchã€xhrï¼Ÿ</strong></h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> originalFetch = <span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span>;  <span class="hljs-comment">//  å¿…é¡»å…ˆä¿å­˜</span>

<span class="hljs-variable language_">window</span>.<span class="hljs-property">fetch</span> = <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) {
  <span class="hljs-keyword">if</span> (needMock) {
    <span class="hljs-keyword">return</span> mockResponse;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">originalFetch</span>(url);  <span class="hljs-comment">//  ä¸ Mock æ—¶è°ƒç”¨åŸå§‹æ–¹æ³•</span>
};
</code></pre>
<p><strong>åŸå› ï¼š</strong> å¦‚æœä¸ä¿å­˜ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šè¢«æ‹¦æˆªï¼Œæ— æ³•å‘é€çœŸå®è¯·æ±‚ã€‚</p>
<h2 data-id="heading-32">æ€»ç»“</h2>
<h3 data-id="heading-33">æ ¸å¿ƒè¦ç‚¹</h3>
<ol>
<li><strong>æ ¹æœ¬åŸç†</strong>ï¼šé‡å†™ <code>window.fetch</code> å’Œ <code>XMLHttpRequest</code>ï¼Œåœ¨ç½‘é¡µä»£ç æ‰§è¡Œå‰åŠ«æŒè¯·æ±‚</li>
<li><strong>ä¸ºä»€ä¹ˆåˆ†ä¸¤ä¸ªè„šæœ¬</strong>ï¼šcontent.js èƒ½è¯»æ’ä»¶é…ç½®ï¼Œinjected.js èƒ½æ‹¦æˆªè¯·æ±‚</li>
<li><strong>æ€ä¹ˆé€šä¿¡</strong>ï¼š<code>postMessage</code>ï¼ˆå”¯ä¸€æ–¹å¼ï¼‰</li>
<li><strong>ä»€ä¹ˆæ—¶å€™æ³¨å…¥</strong>ï¼š<code>document_start</code>ï¼ˆè¶Šæ—©è¶Šå¥½ï¼‰</li>
<li><strong>ä¸ºä»€ä¹ˆèƒ½æ‹¦æˆª</strong>ï¼šåœ¨ç½‘é¡µä»£ç æ‰§è¡Œå‰å°±æ›¿æ¢äº†åŸç”Ÿæ–¹æ³•</li>
</ol>
<h3 data-id="heading-34">é€‚ç”¨åœºæ™¯</h3>
<ul>
<li>å‰ç«¯å¼€å‘æ—¶ï¼Œåç«¯æ¥å£è¿˜æ²¡å¥½</li>
<li>è°ƒè¯•çº¿ä¸Š Bugï¼Œæƒ³ä¸´æ—¶æ”¹è¿”å›æ•°æ®</li>
<li>æ¼”ç¤º Demoï¼Œä¸æƒ³ä¾èµ–çœŸå®æœåŠ¡å™¨</li>
<li>è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œéœ€è¦ç¨³å®šçš„ Mock æ•°æ®</li>
<li>æ¥å£æ–‡æ¡£ä¸å®Œå–„ï¼Œæƒ³è‡ªå·±é€ æ•°æ®æµ‹è¯•</li>
</ul>
<h3 data-id="heading-35">æœ€å</h3>
<p>å¦‚æœè¿™ä¸ªæ’ä»¶å¸®åˆ°äº†ä½ ï¼Œæ¬¢è¿ï¼š</p>
<ul>
<li>å¦‚æœè§‰å¾—å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµ ğŸ‘ æ”¶è— â­ å…³æ³¨ ğŸ”” æ”¯æŒä¸€ä¸‹ï¼</li>
<li>â­ <strong>GitHub Star æ”¯æŒ</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FTeernage%2Fquick-mock" target="_blank" title="https://github.com/Teernage/quick-mock" ref="nofollow noopener noreferrer">github.com/Teernage/quâ€¦</a></li>
<li>ğŸ’¬ <strong>è¯„è®ºåŒºèŠèŠä½ çš„ä½¿ç”¨åœºæ™¯</strong></li>
</ul>
<p>è¿™ä¸ªæ’ä»¶ä¼šæŒç»­ä¼˜åŒ–ï¼Œæ”¯æŒæ›´ä¸°å¯Œçš„é…ç½®é¡¹ã€æ›´å¥½çš„äº¤äº’ç­‰</p>
<p><strong>å¦‚æœä½ æœ‰å¥½çš„æƒ³æ³•ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºæˆ– GitHub Issue æå‡ºï¼</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%]]></title>    <link>https://juejin.cn/post/7570984341414313999</link>    <guid>https://juejin.cn/post/7570984341414313999</guid>    <pubDate>2025-11-11T00:16:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984341414313999" data-draft-id="7570940025581518888" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%"/> <meta itemprop="keywords" content="åç«¯,å‰ç«¯,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-11T00:16:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="IT_é™ˆå¯’"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    IT_é™ˆå¯’
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:16:38.000Z" title="Tue Nov 11 2025 00:16:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScript æ€§èƒ½ä¼˜åŒ–å®æˆ˜ï¼šæˆ‘é€šè¿‡è¿™7ä¸ªæŠ€å·§å°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%</strong></h2>
<h3 data-id="heading-1">å¼•è¨€</h3>
<p>åœ¨ç°ä»£Webå¼€å‘ä¸­ï¼Œæ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæ°¸æ’çš„è¯é¢˜ã€‚éšç€ç”¨æˆ·å¯¹é¡µé¢åŠ è½½é€Ÿåº¦çš„è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼ŒJavaScriptçš„æ€§èƒ½ä¼˜åŒ–æ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚æœ€è¿‘ï¼Œæˆ‘åœ¨ä¸€ä¸ªå¤§å‹ç”µå•†é¡¹ç›®ä¸­é€šè¿‡å®æ–½7ä¸ªå…³é”®çš„JavaScriptä¼˜åŒ–æŠ€å·§ï¼ŒæˆåŠŸå°†é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%ã€‚æœ¬æ–‡å°†è¯¦ç»†åˆ†äº«è¿™äº›å®æˆ˜ç»éªŒï¼Œå¸Œæœ›èƒ½ä¸ºå¼€å‘è€…æä¾›æœ‰ä»·å€¼çš„å‚è€ƒã€‚</p>
<h3 data-id="heading-2">ä¸ºä»€ä¹ˆJavaScriptæ€§èƒ½ä¼˜åŒ–å¦‚æ­¤é‡è¦ï¼Ÿ</h3>
<p>JavaScriptæ˜¯ç°ä»£Webåº”ç”¨çš„æ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€ï¼Œä½†å…¶æ‰§è¡Œæ•ˆç‡ç›´æ¥å½±å“é¡µé¢çš„å“åº”é€Ÿåº¦å’Œç”¨æˆ·ä½“éªŒã€‚æ ¹æ®Googleçš„ç ”ç©¶ï¼Œé¡µé¢åŠ è½½æ—¶é—´æ¯å¢åŠ 1ç§’ï¼Œè·³å‡ºç‡å°±ä¼šå¢åŠ 32%ã€‚æ­¤å¤–ï¼Œç§»åŠ¨è®¾å¤‡ä¸Šçš„æ€§èƒ½é—®é¢˜æ›´åŠ çªå‡ºï¼Œå› ä¸ºå®ƒä»¬çš„å¤„ç†èƒ½åŠ›å’Œç½‘ç»œæ¡ä»¶å¾€å¾€ä¸å¦‚æ¡Œé¢è®¾å¤‡ã€‚</p>
<h3 data-id="heading-3">ä¸»ä½“ï¼š7ä¸ªå…³é”®çš„æ€§èƒ½ä¼˜åŒ–æŠ€å·§</h3>
<h4 data-id="heading-4">1. <strong>ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
ä¼ ç»Ÿçš„æ‰“åŒ…æ–¹å¼ï¼ˆå¦‚Webpackçš„é»˜è®¤é…ç½®ï¼‰ä¼šå°†æ‰€æœ‰JavaScriptä»£ç æ‰“åŒ…æˆä¸€ä¸ªå·¨å¤§çš„bundleæ–‡ä»¶ã€‚è¿™ä¼šæ˜¾è‘—å¢åŠ é¦–å±åŠ è½½æ—¶é—´ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br/>
ä½¿ç”¨åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importsï¼‰å’Œè·¯ç”±çº§ä»£ç åˆ†å‰²ï¼ˆRoute-based Code Splittingï¼‰ï¼Œå°†ä»£ç æ‹†åˆ†ä¸ºå¤šä¸ªå°å—ï¼ŒæŒ‰éœ€åŠ è½½ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// åŠ¨æ€å¯¼å…¥ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable language_">module</span> = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./module.js'</span>);
</code></pre>
<p><strong>æ•ˆæœï¼š</strong><br/>
é¦–å±åŠ è½½æ—¶é—´å‡å°‘äº†30%ï¼Œå› ä¸ºæµè§ˆå™¨åªéœ€è¦ä¸‹è½½å’Œæ‰§è¡Œå½“å‰é¡µé¢æ‰€éœ€çš„ä»£ç ã€‚</p>
<h4 data-id="heading-5">2. <strong>Tree Shaking</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
é¡¹ç›®ä¸­å¼•å…¥äº†è®¸å¤šæœªä½¿ç”¨çš„åº“æˆ–æ¨¡å—ä»£ç ï¼Œå¯¼è‡´æ‰“åŒ…ä½“ç§¯è†¨èƒ€ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br/>
ä½¿ç”¨ES6æ¨¡å—è¯­æ³•ï¼ˆ<code>import/export</code>ï¼‰å¹¶é…ç½®æ„å»ºå·¥å…·ï¼ˆå¦‚Webpackã€Rollupï¼‰å¯ç”¨Tree ShakingåŠŸèƒ½ã€‚ç¡®ä¿ç¬¬ä¸‰æ–¹åº“ä¹Ÿæ”¯æŒES6æ¨¡å—ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Webpacké…ç½®ç¤ºä¾‹</span>
<span class="hljs-attr">optimization</span>: {
  <span class="hljs-attr">usedExports</span>: <span class="hljs-literal">true</span>,
}
</code></pre>
<p><strong>æ•ˆæœï¼š</strong><br/>
æ‰“åŒ…ä½“ç§¯å‡å°‘äº†çº¦25%ï¼Œæ˜¾è‘—é™ä½äº†ä¼ è¾“å’Œè§£ææ—¶é—´ã€‚</p>
<h4 data-id="heading-6">3. <strong>æ‡’åŠ è½½éå…³é”®èµ„æº</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
éå…³é”®çš„JavaScriptèµ„æºï¼ˆå¦‚åˆ†æè„šæœ¬ã€å¹¿å‘Šè„šæœ¬ï¼‰é˜»å¡äº†ä¸»çº¿ç¨‹çš„æ¸²æŸ“ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong><br/>
ä½¿ç”¨<code>defer</code>æˆ–<code>async</code>å±æ€§åŠ è½½éå…³é”®è„šæœ¬ï¼Œæˆ–å°†å®ƒä»¬å»¶è¿Ÿåˆ°é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">defer</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"analytics.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">async</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"ads.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><strong>æ•ˆæœï¼š</strong><br/>
ä¸»çº¿ç¨‹çš„é˜»å¡æ—¶é—´å‡å°‘äº†40%ï¼Œç”¨æˆ·æ„ŸçŸ¥çš„åŠ è½½é€Ÿåº¦å¤§å¹…æå‡ã€‚</p>
<h4 data-id="heading-7">4. <strong>å‡å°‘DOMæ“ä½œ</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong><br/>
é¢‘ç¹çš„DOMæ“ä½œä¼šå¯¼è‡´å›æµï¼ˆReflowï¼‰å’Œé‡ç»˜ï¼ˆRepaintï¼‰ï¼Œä¸¥é‡æ‹–æ…¢é¡µé¢æ€§èƒ½ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<ul>
<li>ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µï¼ˆ<code>DocumentFragment</code>ï¼‰æ‰¹é‡æ“ä½œDOMã€‚</li>
<li>é¿å…åœ¨å¾ªç¯ä¸­ç›´æ¥æ“ä½œDOMã€‚</li>
<li>ä½¿ç”¨è™šæ‹ŸDOMåº“ï¼ˆå¦‚Reactã€Vueï¼‰ã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// DocumentFragmentç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> fragment = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createDocumentFragment</span>();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
  <span class="hljs-keyword">const</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  fragment.<span class="hljs-title function_">appendChild</span>(div);
}
<span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(fragment);
</code></pre>
<p><strong>æ•ˆæœï¼š</strong>
äº¤äº’æ€§èƒ½æå‡äº†35%ï¼Œå°¤å…¶æ˜¯åœ¨ä½ç«¯è®¾å¤‡ä¸Šè¡¨ç°æ›´æ˜æ˜¾ã€‚</p>
<h4 data-id="heading-8">5. <strong>åˆ©ç”¨Web Workerså¤„ç†å¯†é›†å‹ä»»åŠ¡</strong></h4>
<p><strong>é—®é¢˜ï¼š</strong>
å¤æ‚çš„è®¡ç®—ä»»åŠ¡ä¼šé˜»å¡ä¸»çº¿ç¨‹ï¼Œå¯¼è‡´é¡µé¢å¡é¡¿æˆ–æ— å“åº”ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong>
å°†CPUå¯†é›†å‹ä»»åŠ¡ï¼ˆå¦‚æ•°æ®å¤„ç†ã€å›¾åƒå¤„ç†ï¼‰äº¤ç»™Web Workersæ‰§è¡Œã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Web Workerç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> worker = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'task.js'</span>);
worker.<span class="hljs-title function_">postMessage</span>(data);
worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">data</span>);
};
</code></pre>
<p>æ•ˆæœï¼š
ä¸»çº¿ç¨‹çš„è´Ÿè½½é™ä½äº†50%ï¼Œç”¨æˆ·äº¤äº’æ›´åŠ æµç•…ã€‚</p>
<h4 data-id="heading-9">6. <strong>ç¼“å­˜ä¸è®°å¿†åŒ–</strong></h4>
<p>é—®é¢˜ï¼š
é‡å¤è®¡ç®—ç›¸åŒçš„æ•°æ®æˆ–é¢‘ç¹å‘èµ·ç›¸åŒçš„APIè¯·æ±‚ä¼šæµªè´¹èµ„æºã€‚
è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>APIè¯·æ±‚ç»“æœç¼“å­˜åˆ°å†…å­˜æˆ–IndexedDBä¸­ã€‚</li>
<li>JavaScriptå‡½æ•°ä½¿ç”¨è®°å¿†åŒ–æŠ€æœ¯ç¼“å­˜è®¡ç®—ç»“æœã€‚</li>
</ul>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// APIç¼“å­˜ç¤ºä¾‹</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">fetchData</span>(<span class="hljs-params">key</span>) {
 <span class="hljs-keyword">if</span> (!cache[key]) {
   cache[key] = <span class="hljs-keyword">await</span> <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/<span class="hljs-subst">${key}</span>`</span>);
 }
 <span class="hljs-keyword">return</span> cache[key];
}

<span class="hljs-comment">// Memoizationç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">memoize</span> = (<span class="hljs-params">fn</span>) =&gt; {
 <span class="hljs-keyword">const</span> cache = {};
 <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">...args</span>) =&gt;</span> {
   <span class="hljs-keyword">const</span> key = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(args);
   <span class="hljs-keyword">if</span> (!cache[key]) cache[key] = <span class="hljs-title function_">fn</span>(...args);
   <span class="hljs-keyword">return</span> cache[key];
 };
};
</code></pre>
<p>æ•ˆæœï¼š
APIå“åº”æ—¶é—´å¹³å‡ç¼©çŸ­äº†60%ï¼Œå¤æ‚è®¡ç®—çš„é‡å¤æ‰§è¡Œæ—¶é—´å‡å°‘äº†70%ã€‚</p>
<p>####7.<strong>ä¼˜åŒ–äº‹ä»¶å¤„ç†</strong>
é—®é¢˜ï¼š
é«˜é¢‘è§¦å‘çš„äº‹ä»¶ç›‘å¬å™¨ä¼šå¼•èµ·å¤§é‡ä¸å¿…è¦çš„å‡½æ•°è°ƒç”¨å½±å“æ€§èƒ½ã€‚
è§£å†³æ–¹æ¡ˆï¼š
-èŠ‚æµ(throttling)
é˜²æŠ–(debouncing)
è¢«åŠ¨äº‹ä»¶ç›‘å¬å™¨(passiveeventlisteners)</p>
<pre><code class="hljs language-javascript//" lang="javascript//">èŠ‚æµç¤ºä¾‹functionthrottle(func,limit){
 letlastRan;
returnfunction(){
if(!lastRan||Date.now()-lastRan&gt;=limit){
func.apply(this,arguments);lastRan=Date.now();}};}
//
é˜²æŠ–ç¤ºä¾‹functiondebounce(func,delay){lettimeoutId;
returnfunction(){clearTimeout(timeoutId);timeoutId=setTimeout(()=&gt;func.apply(this,arguments),delay);};}
</code></pre>
<p>æ•ˆæœ:
æ»šåŠ¨äº‹ä»¶çš„CPUå ç”¨ç‡ä¸‹é™äº†80%,è§¦æ‘¸äº‹ä»¶çš„å¤„ç†å»¶è¿Ÿæ˜¾è‘—é™ä½.</p>
<p>###æ€»ç»“</p>
<p>é€šè¿‡å®æ–½ä»¥ä¸Š7ä¸ªJavaScriptæ€§èƒ½ä¼˜åŒ–æŠ€å·§,æˆ‘ä»¬æˆåŠŸåœ°å°†é¡¹ç›®çš„é¡µé¢åŠ è½½é€Ÿåº¦æå‡äº†65%,åŒæ—¶è¿˜æ”¹å–„äº†äº¤äº’æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒ.è¿™äº›æ–¹æ³•æ¶µç›–äº†ä»ä»£ç ç»“æ„åˆ°è¿è¡Œæ—¶ä¼˜åŒ–çš„å„ä¸ªæ–¹é¢,å…·æœ‰å¹¿æ³›çš„é€‚ç”¨æ€§.</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯,æ€§èƒ½ä¼˜åŒ–æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹è€Œéä¸€æ¬¡æ€§å·¥ä½œ.Webç”Ÿæ€åœ¨ä¸æ–­å˜åŒ–,æ–°çš„æŠ€æœ¯å’Œå·¥å…·ä¹Ÿä¼šä¸æ–­æ¶Œç°.å› æ­¤å»ºè®®å®šæœŸè¿›è¡Œæ€§èƒ½å®¡è®¡(Puppeteer,Lighthouseç­‰å·¥å…·),å¹¶æ ¹æ®é¡¹ç›®ç‰¹ç‚¹é€‰æ‹©æœ€é€‚åˆçš„ä¼˜åŒ–ç­–ç•¥.</p>
<p>æœ€åè¦å¼ºè°ƒçš„æ˜¯:ä»»ä½•ä¼˜åŒ–éƒ½åº”è¯¥å»ºç«‹åœ¨æ­£ç¡®æµ‹é‡æ•°æ®çš„åŸºç¡€ä¸Š."è¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æº",æˆ‘ä»¬åº”è¯¥ä¼˜å…ˆè§£å†³çœŸæ­£å½±å“ç”¨æˆ·ä½“éªŒçš„æ€§èƒ½ç“¶é¢ˆ</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Swift å¹¶å‘ï¼šæˆ‘åˆ°åº•è¯¥ä¸è¯¥ç”¨ Actorï¼Ÿâ€”â€”ä¸€å¼ å†³ç­–å›¾å¸®ä½ æ‹æ¿]]></title>    <link>https://juejin.cn/post/7570932873131999259</link>    <guid>https://juejin.cn/post/7570932873131999259</guid>    <pubDate>2025-11-11T00:20:01.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131999259" data-draft-id="7547552301117390902" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Swift å¹¶å‘ï¼šæˆ‘åˆ°åº•è¯¥ä¸è¯¥ç”¨ Actorï¼Ÿâ€”â€”ä¸€å¼ å†³ç­–å›¾å¸®ä½ æ‹æ¿"/> <meta itemprop="keywords" content="Swift"/> <meta itemprop="datePublished" content="2025-11-11T00:20:01.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="unravel2025"/> <meta itemprop="url" content="https://juejin.cn/user/1116759541421880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Swift å¹¶å‘ï¼šæˆ‘åˆ°åº•è¯¥ä¸è¯¥ç”¨ Actorï¼Ÿâ€”â€”ä¸€å¼ å†³ç­–å›¾å¸®ä½ æ‹æ¿
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1116759541421880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    unravel2025
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:20:01.000Z" title="Tue Nov 11 2025 00:20:01 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Actor æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¸€å¥è¯ç‰ˆï¼‰</h2>
<p>Actor = è‡ªå¸¦å¤§é—¨çš„æˆ¿é—´ï¼šä¸€æ¬¡åªèƒ½è¿›ä¸€ä¸ªäººï¼Œè¿›é—¨è¦â€œç­‰é’¥åŒ™â€ï¼ˆ<code>await</code>ï¼‰ã€‚</p>
<p>å®ƒå­˜åœ¨çš„å”¯ä¸€ç†ç”±ï¼šä¿æŠ¤é Sendable çš„å¯å˜çŠ¶æ€ã€‚</p>
<h2 data-id="heading-1">Actor vs Classï¼šåªå·®ä¸€ä¸ªéš”ç¦»åŸŸ</h2>



































<table><thead><tr><th>ç»´åº¦</th><th>Class</th><th>Actor</th></tr></thead><tbody><tr><td>å¼•ç”¨è¯­ä¹‰</td><td>âœ…</td><td>âœ…</td></tr><tr><td>ç»§æ‰¿</td><td>âœ…</td><td>âŒ</td></tr><tr><td>éš”ç¦»åŸŸ</td><td>âŒï¼ˆè°éƒ½èƒ½åŒæ­¥è®¿é—®ï¼‰</td><td>âœ…ï¼ˆå¿…é¡»Â <code>await</code>è¿›é—¨ï¼‰</td></tr><tr><td>çº¿ç¨‹å®‰å…¨</td><td>æ‰‹åŠ¨é”/é˜Ÿåˆ—</td><td>ç¼–è¯‘å™¨ä¿è¯</td></tr><tr><td>åŒæ­¥è°ƒç”¨</td><td>ä»»æ„</td><td>å¤–éƒ¨ç¦æ­¢</td></tr></tbody></table>
<p>æŠŠ Actor æƒ³æˆâ€œè¿œç¨‹æœåŠ¡â€ï¼š æ•°æ®åœ¨â€œæœåŠ¡å™¨â€é‡Œï¼Œä½ è¦å‘è¯·æ±‚ï¼ˆ<code>await</code>ï¼‰æ‰èƒ½è¯»å†™ã€‚</p>
<h2 data-id="heading-2">å†³ç­–ä¸‰è¦ç´ ï¼šç¼ºä¸€ä¸å¯ï¼</h2>
<p>åªæœ‰åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 æ¡ï¼Œæ‰å€¼å¾—ä¸Š Actorï¼š</p>
<ol>
<li>
<p>æœ‰é Sendable çŠ¶æ€</p>
<p>ï¼ˆçº¯ Sendable ç»“æ„ä½“/ç±» â†’ æ— éœ€ä¿æŠ¤ï¼‰</p>
</li>
<li>
<p>æ“ä½œå¿…é¡»åŸå­æ€§</p>
<p>ï¼ˆè¯»-æ”¹-å†™å¿…é¡»æ‰“åŒ…ï¼Œä¸èƒ½ä¸­é€”è¢«æ’ï¼‰</p>
</li>
<li>
<p>è¿™äº›åŸå­æ“ä½œ</p>
<p>ä¸èƒ½åœ¨ç°æœ‰ Actor ä¸Šå®Œæˆï¼ˆå¦‚ MainActorï¼‰</p>
</li>
</ol>





















<table><thead><tr><th>ç¼ºä¸€æ¡ â†’ ç”¨åˆ«çš„æ–¹å¼</th><th>åŸå› </th></tr></thead><tbody><tr><td>åªæœ‰ â‘  ç¼º â‘¡</td><td>ç”¨Â <code>Sendable</code>+ å€¼ç±»å‹å³å¯</td></tr><tr><td>æœ‰ â‘ â‘¡ ä½†èƒ½åœ¨ MainActor åš</td><td>ç›´æ¥æ ‡Â <code>@MainActor</code>ï¼Œè¿˜èƒ½åŒæ­¥è®¿é—® UI</td></tr><tr><td>ä¸ºäº†â€œé¿å¼€ä¸»çº¿ç¨‹â€è€Œé€  Actor</td><td>åæ¨¡å¼ï¼ç”¨Â <code>@concurrent</code>/Â <code>Task.detached</code>å³å¯</td></tr></tbody></table>
<h2 data-id="heading-3">åä¾‹é›†åˆï¼šè¿™äº› Actor éƒ½â€œå¸ˆå‡ºæ— åâ€</h2>
<p>âŒ ç½‘ç»œå®¢æˆ·ç«¯ Actor</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">actor</span> <span class="hljs-title class_">APIClient</span> {
    <span class="hljs-comment">// å…¨æ˜¯ Sendableï¼šURLSessionã€tokenString</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">request</span>() <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">Data</span> { <span class="hljs-operator">...</span> }
}
</code></pre>
<ul>
<li>çŠ¶æ€å·² Sendable â†’ æ— éœ€ä¿æŠ¤</li>
<li>å‰¯ä½œç”¨åªæ˜¯â€œä¸æƒ³è·‘ä¸»çº¿ç¨‹â€â†’ ç”¨ <code>@concurrent</code> å‡½æ•°å³å¯</li>
<li>ç»“æœï¼šäººä¸ºåŠ é”ï¼Œè§£ç éƒ½æ— æ³•å¹¶å‘</li>
</ul>
<p>âŒ â€œçœ‹ä¸æ‡‚å¹¶å‘æŠ¥é”™â€å°±å¥— Actor</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-meta">@globalActor</span> <span class="hljs-keyword">actor</span> <span class="hljs-title class_">MyRandomActor</span> {
    <span class="hljs-comment">// ç©ºçŠ¶æ€ï¼Œåªä¸ºæ¶ˆ Sendable è­¦å‘Š</span>
}
</code></pre>
<p>â†’ æ°¸è¿œåˆ«ç”¨ Actor å½“åˆ›å¯è´´ï¼</p>
<p>å…ˆç†è§£è­¦å‘Šï¼Œå†é€‰å·¥å…·ï¼ˆ<code>Sendable</code>ã€<code>@MainActor</code>ã€<code>@concurrent</code>ï¼‰ã€‚</p>
<h2 data-id="heading-4">æ­£ä¾‹ï¼šçœŸæ­£éœ€è¦ Actor çš„åœºæ™¯</h2>
<p>âœ… æœ¬åœ°é Sendable ç¼“å­˜</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">actor</span> <span class="hljs-title class_">ImageCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> store: [<span class="hljs-type">URL</span>: <span class="hljs-type">UIImage</span>] <span class="hljs-operator">=</span> [:]   <span class="hljs-comment">// UIImage é Sendable</span>
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">image</span>(<span class="hljs-params">for</span> <span class="hljs-params">url</span>: <span class="hljs-type">URL</span>) <span class="hljs-keyword">async</span> -&gt; <span class="hljs-type">UIImage</span>? {
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> img <span class="hljs-operator">=</span> store[url] { <span class="hljs-keyword">return</span> img }
        <span class="hljs-keyword">let</span> data <span class="hljs-operator">=</span> <span class="hljs-keyword">try</span> <span class="hljs-keyword">await</span> <span class="hljs-type">URLSession</span>.shared.data(from: url).<span class="hljs-number">0</span>
        <span class="hljs-keyword">let</span> img <span class="hljs-operator">=</span> <span class="hljs-type">UIImage</span>(data: data)<span class="hljs-operator">!</span>
        store[url] <span class="hljs-operator">=</span> img
        <span class="hljs-keyword">return</span> img
    }
}
</code></pre>
<ul>
<li>çŠ¶æ€é Sendable</li>
<li>è¯»-å†™-ç¼“å­˜å¿…é¡»åŸå­</li>
<li>MainActor ä¸é€‚åˆï¼ˆç½‘ç»œ+è§£ç è€—æ—¶ï¼‰</li>
</ul>
<p>âœ… åè®®å¼ºåˆ¶ Sendable</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">protocol</span> <span class="hljs-title class_">DataSource</span>: <span class="hljs-title class_">Sendable</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">fetch</span>() <span class="hljs-keyword">async</span> -&gt; [<span class="hljs-type">Item</span>]
}
</code></pre>
<ul>
<li>å®ç°å±‚å«é Sendable çŠ¶æ€ â†’ åªèƒ½ç”¨ Actor æ»¡è¶³ Sendable</li>
</ul>
<h2 data-id="heading-5">å†³ç­–æµç¨‹å›¾</h2>
<pre><code class="hljs language-arduino" lang="arduino">éœ€è¦å…±äº«å¯å˜çŠ¶æ€ï¼Ÿ
â”œâ”€ å¦ â†’ ç”¨ <span class="hljs-keyword">struct</span> / <span class="hljs-keyword">class</span>ï¼ˆSendableï¼‰
â”œâ”€ æ˜¯ â†’ çŠ¶æ€ Sendableï¼Ÿ
â”‚   â”œâ”€ æ˜¯ â†’ ç”¨ Sendable å€¼ç±»å‹æˆ–é”è‡ªç”±ç±»
â”‚   â””â”€ å¦ â†’ æ“ä½œå¿…é¡»åŸå­ï¼Ÿ
â”‚       â”œâ”€ å¦ â†’ æ‹†æˆ Sendable ç‰‡æ®µ
â”‚       â””â”€ æ˜¯ â†’ èƒ½åœ¨ MainActor å®Œæˆï¼Ÿ
â”‚           â”œâ”€ æ˜¯ â†’ @MainActor
â”‚           â””â”€ å¦ â†’ **ä¸Š Actor** âœ…
</code></pre>
<p>å£è¯€ï¼š</p>
<p>â€œSendable å…ˆï¼ŒMainActor å…¶æ¬¡ï¼Œæ–° Actor æœ€åã€‚â€</p>
<h2 data-id="heading-6">åŒæ­¥è®¿é—®çº¢çº¿ï¼šActor = â€œè¿œç¨‹æœåŠ¡â€</h2>
<p>å¤–éƒ¨è°ƒç”¨å¿…é¡»å¼‚æ­¥ï¼š</p>
<pre><code class="hljs language-swift" lang="swift"><span class="hljs-keyword">actor</span> <span class="hljs-title class_">Counter</span> {
    <span class="hljs-keyword">func</span> <span class="hljs-title function_">increment</span>() { value <span class="hljs-operator">+=</span> <span class="hljs-number">1</span> }
}

<span class="hljs-comment">// å¤–éƒ¨</span>
<span class="hljs-keyword">await</span> counter.increment()   <span class="hljs-comment">// âœ…</span>
counter.increment()         <span class="hljs-comment">// âŒ ç¼–è¯‘å¤±è´¥</span>
</code></pre>
<p>â†’ å¦‚æœä½ æ— æ³•å®¹å¿è¿™ç§å¼‚æ­¥æ¥å£ï¼ˆä¾‹å¦‚å®æ—¶éŸ³é¢‘å›è°ƒï¼‰ï¼Œ</p>
<p>æ ¹æœ¬ä¸è¯¥ç”¨ Actor â€”â€” è€ƒè™‘é”ã€åŸå­ç±»æˆ– <code>@concurrent</code> å‡½æ•°ã€‚</p>
<h2 data-id="heading-7">å¸¸è§è¯¯è§£é€Ÿç­”</h2>

























<table><thead><tr><th>è¯¯è§£</th><th>çœŸç›¸</th></tr></thead><tbody><tr><td>â€œActor è®©å¹¶å‘æ›´å¿«â€</td><td>å®ƒæ›´å®‰å…¨è€Œéæ›´å¿«ï¼›å¼‚æ­¥æ’é˜Ÿå¯èƒ½æ›´æ…¢</td></tr><tr><td>â€œæŠŠç±»æ”¹æˆ actor å°±èƒ½æ¶ˆå¹¶å‘è­¦å‘Šâ€</td><td>æ²»æ ‡ä¸æ²»æœ¬ï¼›å…ˆç†è§£ Sendable è¦æ±‚</td></tr><tr><td>â€œç½‘ç»œå±‚å¿…é¡» actorâ€</td><td>è‹¥çŠ¶æ€ Sendableï¼Œç”¨Â <code>@concurrent</code>å‡½æ•°/ä»»åŠ¡å³å¯</td></tr><tr><td>â€œactor é‡Œæ‰€æœ‰ä»£ç éƒ½å¼‚æ­¥â€</td><td>å†…éƒ¨å¯å®Œå…¨åŒæ­¥ï¼›åªæœ‰å¤–éƒ¨è°ƒç”¨éœ€ await</td></tr></tbody></table>
<h2 data-id="heading-8">ä¸€å¥è¯æ€»ç»“</h2>
<p>â€œActor æ˜¯ä¿æŠ¤â€˜é Sendable å¯å˜çŠ¶æ€â€™çš„æ˜‚è´µä¿é™©ç®±â€”â€” ç¡®è®¤ä½ çœŸçš„æœ‰å®è´ï¼Œä¸”åˆ«å¤„æ”¾ä¸ä¸‹ï¼Œå†æŠŠå®ƒè¯·å›å®¶ã€‚â€</p>
<p>è®°ä½ä¸‰è¦ç´ ï¼š</p>
<ol>
<li>é Sendable çŠ¶æ€</li>
<li>å¿…é¡»åŸå­æ“ä½œ</li>
<li>ç°æœ‰ Actor å¸®ä¸ä¸Š</li>
</ol>
<p>åŒæ—¶æ»¡è¶³ â†’ ç”¨ Actorï¼›ç¼ºä¸€æ¡ â†’ æ‰¾æ›´ç®€å•çš„å·¥å…·ã€‚</p>
<p>è®© Actor ç•™åœ¨çœŸæ­£éœ€è¦ä¸²è¡Œå¤§é—¨çš„åœ°æ–¹ï¼Œåˆ«æŠŠè¿œç¨‹æœåŠ¡çš„å¤æ‚åº¦ï¼Œå¸¦è¿›æœ¬å¯å¹¶è¡Œçš„å°èŠ±å›­ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[flutterå›¾ç‰‡é€‰æ‹©åº“multi_image_picker_pluså’Œimage_pickerçš„å¯¹æ¯”å’Œä½¿ç”¨è§£æ]]></title>    <link>https://juejin.cn/post/7570923924365230143</link>    <guid>https://juejin.cn/post/7570923924365230143</guid>    <pubDate>2025-11-11T00:24:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924365230143" data-draft-id="7560992984017322019" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="flutterå›¾ç‰‡é€‰æ‹©åº“multi_image_picker_pluså’Œimage_pickerçš„å¯¹æ¯”å’Œä½¿ç”¨è§£æ"/> <meta itemprop="keywords" content="Flutter,Android,iOS"/> <meta itemprop="datePublished" content="2025-11-11T00:24:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é¹å¤šå¤š"/> <meta itemprop="url" content="https://juejin.cn/user/747323639737191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            flutterå›¾ç‰‡é€‰æ‹©åº“multi_image_picker_pluså’Œimage_pickerçš„å¯¹æ¯”å’Œä½¿ç”¨è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/747323639737191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é¹å¤šå¤š
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:24:37.000Z" title="Tue Nov 11 2025 00:24:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:2;font-weight:400;font-size:15px;overflow-x:hidden;color:#333;letter-spacing:1.2px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1:first-child,.markdown-body h2:first-child,.markdown-body h3:first-child,.markdown-body h4:first-child,.markdown-body h5:first-child,.markdown-body h6:first-child{margin-top:-1.5rem;margin-bottom:1rem}.markdown-body h1:before,.markdown-body h2:before,.markdown-body h3:before,.markdown-body h4:before,.markdown-body h5:before,.markdown-body h6:before{content:"#";display:inline-block;color:#3eaf7c;padding-right:.23em}.markdown-body h1{position:relative;font-size:2.5rem;margin-bottom:5px}.markdown-body h1:before{font-size:2.5rem}.markdown-body h2{padding-bottom:.5rem;font-size:2.2rem;border-bottom:1px solid #ececec}.markdown-body h3{font-size:1.5rem;padding-bottom:0}.markdown-body h4{font-size:1.25rem}.markdown-body h5{font-size:1rem}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body strong{color:#3eaf7c}.markdown-body img{max-width:100%;border-radius:2px;display:block;margin:auto}.markdown-body hr{border:none;border-top:1px solid #3eaf7c;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;overflow-x:auto;padding:.2rem .5rem;margin:0;color:#3eaf7c;font-size:.85em;background-color:rgba(27,31,35,.05);border-radius:3px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;border:.5rem solid #3eaf7c}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{font-weight:500;text-decoration:none;color:#3eaf7c;margin:0 5px}.markdown-body a:active,.markdown-body a:hover{text-decoration:none;border-bottom:1.5px solid #3eaf7c}.markdown-body a[href^=http]:after{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTQiIGhlaWdodD0iMTQiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04MzIgMTI4SDY0MHY2NGgxNDYuNzUyTDUyMS4zNzYgNDU3LjM3Nmw0NS4yNDggNDUuMjQ4TDgzMiAyMzcuMjQ4VjM4NGg2NFYxMjh6IiBmaWxsPSIjM2VhZjdjIi8+PHBhdGggZD0iTTc2OCA4MzJIMTkyVjI1NmgzNTJ2LTY0SDE2MGEzMiAzMiAwIDAwLTMyIDMydjY0MGEzMiAzMiAwIDAwMzIgMzJoNjQwYTMyIDMyIDAgMDAzMi0zMlY0ODBoLTY0djM1MnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");margin-left:2px}.markdown-body a[href^="#"]:before{content:"#"}.markdown-body table{display:inline-block!important;font-size:13px;width:auto;max-width:100%;overflow:auto;border:1px solid #3eaf7c;border-collapse:collapse}.markdown-body thead{background:#3eaf7c;color:#fff;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(153,255,188,.1)}.markdown-body td,.markdown-body th{padding:4px 8px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#7b7878;padding:1px 23px;border-left:.5rem solid;border-color:#42b983;background-color:rgba(66,184,131,.1);position:relative;margin:14px 8px 0}.markdown-body blockquote:before{display:inline-block;position:absolute;content:url("data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjUiIHZpZXdCb3g9IjAgMCAyNyAyNyIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxLjg2MiAxLjg2MikiIGZpbGwtcnVsZT0ibm9uemVybyIgZmlsbD0ibm9uZSI+PGNpcmNsZSBzdHJva2U9IiNGRkYiIHN0cm9rZS13aWR0aD0iMS43MjQiIGZpbGw9IiM0MkI5ODMiIGN4PSIxMS42MzgiIGN5PSIxMS42MzgiIHI9IjExLjYzOCIvPjxwYXRoIGQ9Ik0xNC45NzggNi4yN0E1LjAwNiA1LjAwNiAwIDAwNi42NyA5LjQ2OGE0LjkwMSA0LjkwMSAwIDAwMS43NzMgNC4zNjJjLjMyMy4yNTguNTE0LjY0Ny41MjIgMS4wNnYxLjA2YTIuNjg1IDIuNjg1IDAgMDA1LjM3IDB2LTEuMDA4Yy4wMDItLjM5OC4xNzMtLjc3Ny40Ny0xLjA0MmE1LjAyMyA1LjAyMyAwIDAwLjE3My03LjYzem0tMy4zMzcgMTAuOTY3YTEuMzA0IDEuMzA0IDAgMDEtMS4yODYtMS4yODd2LS4yNzhoMi41NzJ2LjI2MWMwIC43MTMtLjU3MyAxLjI5NC0xLjI4NiAxLjMwNHptMi4yNi00LjQxNWMtLjQ0LjM4My0uNzUuODkzLS44ODcgMS40NmgtMi43NDZhMi44NjggMi44NjggMCAwMC0uOTM4LTEuNTNoLS4wMThhMy40NzYgMy40NzYgMCAwMS0xLjI2OS0zLjE0NSAzLjYxNSAzLjYxNSAwIDAxNy4xOTYuNCAzLjY1IDMuNjUgMCAwMS0xLjMzOCAyLjgxNXoiIGZpbGw9IiNGRkYiLz48L2c+PC9zdmc+");width:25px;height:25px;left:-16px;top:12px}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body details{outline:none;border:none;border-left:4px solid #3eaf7c;padding-left:10px;margin-left:4px}.markdown-body details summary{cursor:pointer;border:none;outline:none;background:#fff;margin:0 -17px}.markdown-body details summary::-webkit-details-marker{color:#3eaf7c}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body ol li::marker{color:#3eaf7c}.markdown-body ul li{list-style:none;padding-left:10px}.markdown-body ul li::marker{content:"â€¢";color:#3eaf7c}.markdown-body ul li.task-list-item:before{content:"";margin-right:0}.markdown-body input[type=checkbox]{vertical-align:text-bottom;box-shadow:inset 0 0 0 10px #fff}.markdown-body input[type=checkbox]:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik04NzcuMDU2IDE0Ni45NDR2NzMwLjExMkgxNDYuOTQ0VjE0Ni45NDRoNzMwLjExMnptMC0xMDQuMjc3SDE0Ni45NDRjLTU3LjYyOCAwLTEwNC4yNzcgNDYuNjQ5LTEwNC4yNzcgMTA0LjI3N3Y3MzAuMTEyYzAgNTcuNjI4IDQ2LjY0OSAxMDQuMjc3IDEwNC4yNzcgMTA0LjI3N2g3MzAuMTEyYzU3LjYyOCAwIDEwNC4yNzctNDYuNjQ5IDEwNC4yNzctMTA0LjI3N1YxNDYuOTQ0YzAtNTcuNjI4LTQ2LjY0OS0xMDQuMjc3LTEwNC4yNzctMTA0LjI3N3oiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}.markdown-body input[type=checkbox]:checked:before{content:url("data:image/svg+xml;base64,PHN2ZyBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMTUiIGhlaWdodD0iMTUiPjxkZWZzPjxzdHlsZS8+PC9kZWZzPjxwYXRoIGQ9Ik05MTAuMjA4IDBIMTEzLjc2QTExNC4xMTIgMTE0LjExMiAwIDAwLS4wMzIgMTEzLjc5MlY5MTAuMjRjMCA2Mi41OTIgNTEuMiAxMTMuNzkyIDExMy43OTIgMTEzLjc5Mmg3OTYuNDQ4YzYyLjU5MiAwIDExMy43OTItNTEuMiAxMTMuNzkyLTExMy43OTJWMTEzLjc5MkMxMDI0IDUxLjIgOTcyLjggMCA5MTAuMjA4IDB6bS01MTIgNzk2LjQ0OEwxMTMuNzYgNTEybDc5LjY0OC03OS42NDggMjA0LjggMjA0LjhMODMwLjU2IDIwNC44bDc5LjY0OCA3OS42NDgtNTEyIDUxMnoiIGZpbGw9IiMzZWFmN2MiLz48L3N2Zz4=");position:relative;top:-2px;right:2px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="agate">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#333;color:#fff}.hljs-name,.hljs-strong{font-weight:700}.hljs-code,.hljs-emphasis{font-style:italic}.hljs-tag{color:#62c8f3}.hljs-selector-class,.hljs-selector-id,.hljs-template-variable,.hljs-variable{color:#ade5fc}.hljs-bullet,.hljs-string{color:#a2fca2}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-quote,.hljs-section,.hljs-title,.hljs-type{color:#ffa}.hljs-bullet,.hljs-number,.hljs-symbol{color:#d36363}.hljs-keyword,.hljs-literal,.hljs-selector-tag{color:#fcc28c}.hljs-code,.hljs-comment,.hljs-deletion{color:#888}.hljs-link,.hljs-regexp{color:#c6b4f0}.hljs-meta{color:#fc9b9b}.hljs-deletion{background-color:#fc9b9b;color:#333}.hljs-addition{background-color:#a2fca2;color:#333}.hljs a{color:inherit}.hljs a:focus,.hljs a:hover{color:inherit;text-decoration:underline}</style><p>åœ¨Flutteråº”ç”¨å¼€å‘ä¸­ï¼Œå›¾ç‰‡é€‰æ‹©æ˜¯é«˜é¢‘åœºæ™¯ï¼Œæ— è®ºæ˜¯å¤´åƒä¸Šä¼ ã€ç›¸å†Œé€‰å›¾è¿˜æ˜¯æ‹ç…§åŠŸèƒ½ï¼Œéƒ½éœ€è¦å¯é çš„å›¾ç‰‡é€‰æ‹©ç»„ä»¶æ”¯æ’‘ã€‚ç›®å‰ç¤¾åŒºä¸­æœ€å¸¸ç”¨çš„ä¸¤æ¬¾ç»„ä»¶åˆ†åˆ«æ˜¯<strong>multi_image_picker_plus</strong>å’Œå®˜æ–¹ç»´æŠ¤çš„<strong>image_picker</strong>ã€‚æœ¬æ–‡å°†ä»æ ¸å¿ƒå±æ€§ã€APIæ¥å£ã€ä½¿ç”¨æµç¨‹ã€åŠŸèƒ½å·®å¼‚åŠä¼˜ç¼ºç‚¹ç­‰ç»´åº¦è¿›è¡Œå…¨é¢è§£æï¼Œå¸®åŠ©å¼€å‘è€…æ ¹æ®ä¸šåŠ¡éœ€æ±‚ç²¾å‡†é€‰å‹ã€‚</p>
<h2 data-id="heading-0">1. ç»„ä»¶åŸºç¡€è®¤çŸ¥</h2>
<p>åœ¨æ·±å…¥ç»†èŠ‚å‰ï¼Œå…ˆæ˜ç¡®ä¸¤æ¬¾ç»„ä»¶çš„æ ¸å¿ƒå®šä½ï¼Œä¸ºåç»­å¯¹æ¯”å»ºç«‹åŸºç¡€ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><strong>image_picker</strong>ï¼šFlutterå®˜æ–¹å›¢é˜Ÿç»´æŠ¤çš„å›¾ç‰‡/è§†é¢‘é€‰æ‹©ç»„ä»¶ï¼Œä¸»æ‰“è½»é‡ã€ç¨³å®šï¼Œæ”¯æŒæ‹ç…§å’Œå•å¼ /å¤šå¼ å›¾ç‰‡é€‰æ‹©ï¼Œé€‚é…iOSå’ŒAndroidåŒå¹³å°ï¼Œæ˜¯å®˜æ–¹æ¨èçš„åŸºç¡€é€‰æ‹©ã€‚</p>
</li>
<li>
<p><strong>multi_image_picker_plus</strong>ï¼šç¬¬ä¸‰æ–¹å¼€æºç»„ä»¶ï¼ŒåŸºäºæ—©æœŸçš„multi_image_pickerè¿­ä»£ä¼˜åŒ–ï¼Œä¸“æ³¨äº<strong>å¤šå›¾é€‰æ‹©åœºæ™¯</strong>ï¼Œæä¾›æ›´ä¸°å¯Œçš„é€‰å›¾äº¤äº’å’Œå›¾ç‰‡å¤„ç†èƒ½åŠ›ï¼Œæ‰©å±•æ€§æ›´å¼ºã€‚</p>
</li>
</ul>
<h2 data-id="heading-1">2. æ ¸å¿ƒå±æ€§ä¸APIè§£æ</h2>
<p>ä¸¤æ¬¾ç»„ä»¶çš„å±æ€§å’ŒAPIè®¾è®¡å›´ç»•å…¶å®šä½å±•å¼€ï¼Œimage_pickerä¾§é‡ç®€æ´æ˜“ç”¨ï¼Œmulti_image_picker_plusä¾§é‡å¤šå›¾åœºæ™¯çš„ç²¾ç»†åŒ–æ§åˆ¶ã€‚</p>
<h3 data-id="heading-2">2.1. image_picker æ ¸å¿ƒè§£æ</h3>
<p>image_pickerçš„APIè®¾è®¡æç®€ï¼Œé€šè¿‡é™æ€æ–¹æ³•ç›´æ¥è°ƒç”¨ï¼Œæ ¸å¿ƒå±æ€§é›†ä¸­åœ¨é€‰æ‹©å‚æ•°çš„é…ç½®ä¸Šã€‚</p>
<h4 data-id="heading-3">2.1.1. å…³é”®å±æ€§</h4>









































<table><thead><tr><th>å±æ€§å</th><th>ç±»å‹</th><th>ä½œç”¨</th><th>å¹³å°æ”¯æŒ</th></tr></thead><tbody><tr><td>source</td><td>ImageSource</td><td>æŒ‡å®šå›¾ç‰‡æ¥æºï¼Œå¯é€‰galleryï¼ˆç›¸å†Œï¼‰æˆ–cameraï¼ˆç›¸æœºï¼‰</td><td>iOS/Android</td></tr><tr><td>imageQuality</td><td>int (0-100)</td><td>å‹ç¼©åå›¾ç‰‡è´¨é‡ï¼Œæ•°å€¼è¶Šé«˜è´¨é‡è¶Šå¥½ï¼Œä»…Androidæ”¯æŒ</td><td>Android</td></tr><tr><td>maxWidth/maxHeight</td><td>double</td><td>å‹ç¼©åå›¾ç‰‡çš„æœ€å¤§å®½é«˜ï¼Œè¶…è¿‡åˆ™ç­‰æ¯”ç¼©æ”¾</td><td>iOS/Android</td></tr><tr><td>requestFullMetadata</td><td>bool</td><td>æ˜¯å¦è¯·æ±‚å›¾ç‰‡å…ƒæ•°æ®ï¼ˆå¦‚æ‹æ‘„æ—¶é—´ã€ä½ç½®ï¼‰ï¼Œé»˜è®¤false</td><td>iOS/Android</td></tr><tr><td>preferredCameraDevice</td><td>CameraDevice</td><td>æŒ‡å®šç›¸æœºè®¾å¤‡ï¼Œå¯é€‰rearï¼ˆåç½®ï¼‰æˆ–frontï¼ˆå‰ç½®ï¼‰</td><td>iOS/Android</td></tr></tbody></table>
<h4 data-id="heading-4">2.1.2. æ ¸å¿ƒAPI</h4>
<p>image_pickerçš„æ ¸å¿ƒAPIå°è£…åœ¨<code>ImagePicker</code>ç±»ä¸­ï¼Œä¸»è¦æä¾›å›¾ç‰‡å’Œè§†é¢‘é€‰æ‹©æ–¹æ³•ï¼Œæ”¯æŒå•å¼ å’Œå¤šå¼ é€‰æ‹©ï¼š</p>
<ol>
<li><strong>å•å¼ å›¾ç‰‡é€‰æ‹©</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;XFile?&gt; pickImage({
  <span class="hljs-keyword">required</span> ImageSource source,
  <span class="hljs-built_in">double?</span> maxWidth,
  <span class="hljs-built_in">double?</span> maxHeight,
  <span class="hljs-built_in">int?</span> imageQuality,
  <span class="hljs-built_in">bool</span> requestFullMetadata = <span class="hljs-keyword">false</span>,
})
</code></pre>
<ol start="2">
<li><strong>å¤šå¼ å›¾ç‰‡é€‰æ‹©</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-built_in">List</span>&lt;XFile&gt;?&gt; pickMultiImage({
  <span class="hljs-built_in">double?</span> maxWidth,
  <span class="hljs-built_in">double?</span> maxHeight,
  <span class="hljs-built_in">int?</span> imageQuality,
  <span class="hljs-built_in">bool</span> requestFullMetadata = <span class="hljs-keyword">false</span>,
})
</code></pre>
<ol start="3">
<li><strong>æ‹ç…§</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;XFile?&gt; pickImage(
  source: ImageSource.camera, <span class="hljs-comment">// æŒ‡å®šç›¸æœºæ¥æº</span>
  preferredCameraDevice: CameraDevice.front, <span class="hljs-comment">// å¯é€‰å‰ç½®ç›¸æœº</span>
)
</code></pre>
<ol start="4">
<li><strong>è·å–å›¾ç‰‡ä¸´æ—¶è·¯å¾„</strong>ï¼šé€šè¿‡è¿”å›çš„<code>XFile</code>å¯¹è±¡çš„<code>path</code>å±æ€§è·å–ï¼Œå¯ç”¨äºé¢„è§ˆæˆ–ä¸Šä¼ ã€‚</li>
</ol>
<h3 data-id="heading-5">2.2. multi_image_picker_plus æ ¸å¿ƒè§£æ</h3>
<p>multi_image_picker_plusä¸“ä¸ºå¤šå›¾åœºæ™¯è®¾è®¡ï¼ŒAPIæ”¯æŒæ‰¹é‡é€‰æ‹©ã€é¢„è§ˆã€ç¼–è¾‘ç­‰åŠŸèƒ½ï¼Œå±æ€§é…ç½®æ›´ç»†è‡´ï¼Œæ”¯æŒè‡ªå®šä¹‰é€‰å›¾ç•Œé¢é£æ ¼ã€‚</p>
<h4 data-id="heading-6">2.2.1. å…³é”®å±æ€§</h4>





















































<table><thead><tr><th>å±æ€§å</th><th>ç±»å‹</th><th>ä½œç”¨</th><th>å¹³å°æ”¯æŒ</th></tr></thead><tbody><tr><td>maxImages</td><td>int</td><td>æœ€å¤§é€‰æ‹©å›¾ç‰‡æ•°é‡ï¼Œå¿…å¡«å‚æ•°</td><td>iOS/Android</td></tr><tr><td>selectedAssets</td><td>List</td><td>å·²é€‰æ‹©çš„å›¾ç‰‡åˆ—è¡¨ï¼Œç”¨äºå›æ˜¾å·²é€‰å†…å®¹</td><td>iOS/Android</td></tr><tr><td>enableCamera</td><td>bool</td><td>æ˜¯å¦æ˜¾ç¤ºç›¸æœºå…¥å£ï¼Œæ”¯æŒé€‰å›¾æ—¶ç›´æ¥æ‹ç…§</td><td>iOS/Android</td></tr><tr><td>cupertinoOptions</td><td>CupertinoOptions</td><td>iOSç«¯è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚æ ‡é¢˜ã€å–æ¶ˆæŒ‰é’®æ–‡å­—ï¼‰</td><td>iOS</td></tr><tr><td>materialOptions</td><td>MaterialOptions</td><td>Androidç«¯è‡ªå®šä¹‰é…ç½®ï¼ˆå¦‚ä¸»é¢˜è‰²ã€ç½‘æ ¼åˆ—æ•°ï¼‰</td><td>Android</td></tr><tr><td>compressQuality</td><td>int (0-100)</td><td>å›¾ç‰‡å‹ç¼©è´¨é‡ï¼ŒåŒå¹³å°å‡æ”¯æŒ</td><td>iOS/Android</td></tr><tr><td>compressSize</td><td>int</td><td>å›¾ç‰‡å‹ç¼©åæœ€å¤§å°ºå¯¸ï¼ˆKBï¼‰ï¼Œè¶…è¿‡åˆ™è¿›ä¸€æ­¥å‹ç¼©</td><td>iOS/Android</td></tr></tbody></table>
<h4 data-id="heading-7">2.2.2. æ ¸å¿ƒAPI</h4>
<p>multi_image_picker_plusçš„æ ¸å¿ƒæ˜¯<code>MultiImagePicker</code>ç±»ï¼Œé€šè¿‡<code>pickImages</code>æ–¹æ³•è§¦å‘é€‰å›¾ï¼Œè¿”å›<code>Asset</code>å¯¹è±¡åˆ—è¡¨ï¼ˆåŒ…å«å›¾ç‰‡è¯¦æƒ…ï¼‰ï¼Œå…³é”®APIå¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å¤šå›¾é€‰æ‹©</strong>ï¼š</li>
</ol>
<pre><code class="hljs language-dart" lang="dart">Future&lt;<span class="hljs-built_in">List</span>&lt;Asset&gt;&gt; pickImages({
  <span class="hljs-keyword">required</span> <span class="hljs-built_in">int</span> maxImages,
  <span class="hljs-built_in">List</span>&lt;Asset&gt; selectedAssets = <span class="hljs-keyword">const</span> [],
  <span class="hljs-built_in">bool</span> enableCamera = <span class="hljs-keyword">true</span>,
  CupertinoOptions cupertinoOptions = <span class="hljs-keyword">const</span> CupertinoOptions(),
  MaterialOptions materialOptions = <span class="hljs-keyword">const</span> MaterialOptions(),
  <span class="hljs-built_in">int</span> compressQuality = <span class="hljs-number">80</span>,
  <span class="hljs-built_in">int?</span> compressSize,
})
</code></pre>
<ol start="2">
<li>
<p><strong>Assetå¯¹è±¡æ ¸å¿ƒæ–¹æ³•</strong>ï¼š
<code>getByteData({int? width, int? height})</code>ï¼šè·å–å›¾ç‰‡å­—èŠ‚æ•°æ®ï¼Œæ”¯æŒæŒ‡å®šå®½é«˜ç¼©æ”¾</p>
</li>
<li>
<p><code>getImageByteData()</code>ï¼šè·å–åŸå§‹å›¾ç‰‡å­—èŠ‚æ•°æ®</p>
</li>
<li>
<p><code>getThumbByteData(int width, int height)</code>ï¼šè·å–ç¼©ç•¥å›¾å­—èŠ‚æ•°æ®</p>
</li>
<li>
<p><code>getMetadata()</code>ï¼šè·å–å›¾ç‰‡å…ƒæ•°æ®ï¼ˆå°ºå¯¸ã€ç±»å‹ã€æ‹æ‘„æ—¶é—´ç­‰ï¼‰</p>
</li>
<li>
<p><strong>é¢„è§ˆå·²é€‰å›¾ç‰‡</strong>ï¼šé€šè¿‡<code>AssetPreview</code>ç»„ä»¶å¯ç›´æ¥é¢„è§ˆ<code>Asset</code>åˆ—è¡¨ï¼Œæ— éœ€é¢å¤–å¤„ç†è·¯å¾„ã€‚</p>
</li>
</ol>
<h2 data-id="heading-8">3. å®é™…ä½¿ç”¨æµç¨‹å¯¹æ¯”</h2>
<p>ä¸¤æ¬¾ç»„ä»¶çš„é›†æˆæµç¨‹ç›¸ä¼¼ï¼Œä½†åœ¨å¤šå›¾å¤„ç†å’Œè‡ªå®šä¹‰åœºæ™¯ä¸‹å­˜åœ¨å·®å¼‚ï¼Œä»¥ä¸‹æ˜¯å®Œæ•´é›†æˆæ­¥éª¤å¯¹æ¯”ã€‚</p>
<h3 data-id="heading-9">3.1. image_picker é›†æˆæ­¥éª¤</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬ä¾‹å­çš„é›†æˆæ­¥éª¤ï¼š</p>
<h4 data-id="heading-10">3.1.1. æ·»åŠ ä¾èµ–</h4>
<p>åœ¨<code>pubspec.yaml</code>ä¸­æ·»åŠ ä¾èµ–å¹¶æ‰§è¡Œ<code>pub get</code>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">image_picker:</span> <span class="hljs-string">^1.1.1</span>
</code></pre>
<h4 data-id="heading-11">3.1.2. å¹³å°é…ç½®</h4>
<p>iOSï¼šåœ¨<code>Info.plist</code>ä¸­æ·»åŠ æƒé™æè¿°ï¼š</p>
<pre><code class="hljs language-plist" lang="plist"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSCameraUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸æœºä»¥æ‹æ‘„å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
</code></pre>
<p>Androidï¼šåœ¨<code>AndroidManifest.xml</code>ä¸­æ·»åŠ æƒé™ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CAMERA"</span>/&gt;</span>
<span class="hljs-comment">&lt;!-- Android 13+ éœ€æ·»åŠ è¯»å†™åª’ä½“æƒé™ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_MEDIA_IMAGES"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-12">3.1.3. æ ¸å¿ƒä»£ç å®ç°</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:image_picker/image_picker.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ImagePickerDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _ImagePickerDemoState createState() =&gt; _ImagePickerDemoState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_ImagePickerDemoState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">ImagePickerDemo</span>&gt; </span>{
  <span class="hljs-keyword">final</span> ImagePicker _picker = ImagePicker();
  <span class="hljs-built_in">List</span>&lt;XFile&gt; _selectedImages = [];

  <span class="hljs-comment">// é€‰æ‹©å¤šå¼ å›¾ç‰‡</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; _pickMultiImages() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-built_in">List</span>&lt;XFile&gt;? images = <span class="hljs-keyword">await</span> _picker.pickMultiImage(
      imageQuality: <span class="hljs-number">80</span>, <span class="hljs-comment">// å‹ç¼©è´¨é‡</span>
      maxWidth: <span class="hljs-number">1080</span>, <span class="hljs-comment">// æœ€å¤§å®½åº¦</span>
    );
    <span class="hljs-keyword">if</span> (images != <span class="hljs-keyword">null</span>) {
      setState(() =&gt; _selectedImages = images);
    }
  }

  <span class="hljs-comment">// æ‹ç…§</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; _takePhoto() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">final</span> XFile? photo = <span class="hljs-keyword">await</span> _picker.pickImage(
      source: ImageSource.camera,
      preferredCameraDevice: CameraDevice.front,
    );
    <span class="hljs-keyword">if</span> (photo != <span class="hljs-keyword">null</span>) {
      setState(() =&gt; _selectedImages.add(photo));
    }
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">"ImagePickerç¤ºä¾‹"</span>)),
      body: GridView.count(
        crossAxisCount: <span class="hljs-number">3</span>,
        children: [
          <span class="hljs-comment">// é€‰æ‹©æŒ‰é’®</span>
          IconButton(onPressed: _pickMultiImages, icon: Icon(Icons.photo_library)),
          IconButton(onPressed: _takePhoto, icon: Icon(Icons.camera)),
          <span class="hljs-comment">// å·²é€‰å›¾ç‰‡é¢„è§ˆ</span>
          ..._selectedImages.map((image) =&gt; Image.file(File(image.path))),
        ],
      ),
    );
  }
}
</code></pre>
<h3 data-id="heading-13">3.2 multi_image_picker_plus é›†æˆæ­¥éª¤</h3>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬ä¾‹å­çš„é›†æˆæ­¥éª¤ï¼š</p>
<h4 data-id="heading-14">3.2.1. æ·»åŠ ä¾èµ–</h4>
<p>åœ¨<code>pubspec.yaml</code>ä¸­æ·»åŠ ä¾èµ–å¹¶æ‰§è¡Œ<code>pub get</code>ï¼š</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">multi_image_picker_plus:</span> <span class="hljs-string">^1.0.5</span>
</code></pre>
<h4 data-id="heading-15">3.2.2. å¹³å°é…ç½®</h4>
<p>iOSï¼šåœ¨<code>Info.plist</code>ä¸­æ·»åŠ ç›¸å†Œå’Œç›¸æœºæƒé™æè¿°ã€‚</p>
<pre><code class="hljs language-plist" lang="plist"><span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSPhotoLibraryUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸å†Œä»¥é€‰æ‹©å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">key</span>&gt;</span>NSCameraUsageDescription<span class="hljs-tag">&lt;/<span class="hljs-name">key</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">string</span>&gt;</span>éœ€è¦è®¿é—®ç›¸æœºä»¥æ‹æ‘„å›¾ç‰‡<span class="hljs-tag">&lt;/<span class="hljs-name">string</span>&gt;</span>
</code></pre>
<p>Androidï¼šåœ¨<code>AndroidManifest.xml</code>ä¸­æ·»åŠ æƒé™ï¼Œå¹¶é…ç½®ä¸»é¢˜ï¼ˆå¯é€‰ï¼‰ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.CAMERA"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">uses-permission</span> <span class="hljs-attr">android:name</span>=<span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span> <span class="hljs-attr">android:maxSdkVersion</span>=<span class="hljs-string">"32"</span>/&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">application</span> <span class="hljs-attr">...</span> <span class="hljs-attr">android:theme</span>=<span class="hljs-string">"@style/Theme.AppCompat.Light"</span>/&gt;</span>
</code></pre>
<h4 data-id="heading-16">3.2.3. æ ¸å¿ƒä»£ç å®ç°</h4>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:multi_image_picker_plus/multi_image_picker_plus.dart'</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MultiImagePickerDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-meta">@override</span>
  _MultiImagePickerDemoState createState() =&gt; _MultiImagePickerDemoState();
}

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_MultiImagePickerDemoState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&lt;<span class="hljs-title">MultiImagePickerDemo</span>&gt; </span>{
  <span class="hljs-built_in">List</span>&lt;Asset&gt; _selectedAssets = [];

  <span class="hljs-comment">// é€‰æ‹©å¤šå›¾</span>
  Future&lt;<span class="hljs-keyword">void</span>&gt; _pickImages() <span class="hljs-keyword">async</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-built_in">List</span>&lt;Asset&gt; resultList = <span class="hljs-keyword">await</span> MultiImagePicker.pickImages(
        maxImages: <span class="hljs-number">9</span>, <span class="hljs-comment">// æœ€å¤šé€‰9å¼ </span>
        selectedAssets: _selectedAssets, <span class="hljs-comment">// å›æ˜¾å·²é€‰</span>
        enableCamera: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// æ˜¾ç¤ºç›¸æœºå…¥å£</span>
        compressQuality: <span class="hljs-number">80</span>, <span class="hljs-comment">// å‹ç¼©è´¨é‡</span>
        materialOptions: MaterialOptions(
          actionBarColor: <span class="hljs-string">"#2196F3"</span>, <span class="hljs-comment">// æ ‡é¢˜æ é¢œè‰²</span>
          statusBarColor: <span class="hljs-string">"#2196F3"</span>, <span class="hljs-comment">// çŠ¶æ€æ é¢œè‰²</span>
          gridColumnCount: <span class="hljs-number">4</span>, <span class="hljs-comment">// ç½‘æ ¼åˆ—æ•°</span>
        ),
      );
      setState(() =&gt; _selectedAssets = resultList);
    } <span class="hljs-keyword">on</span> Exception <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-built_in">print</span>(<span class="hljs-string">"é€‰å›¾å¼‚å¸¸ï¼š<span class="hljs-subst">$e</span>"</span>);
    }
  }

  <span class="hljs-comment">// é¢„è§ˆå›¾ç‰‡</span>
  <span class="hljs-keyword">void</span> _previewImages() {
    <span class="hljs-keyword">if</span> (_selectedAssets.isNotEmpty) {
      Navigator.push(
        context,
        MaterialPageRoute(
          builder: (context) =&gt; AssetPreview(
            assets: _selectedAssets,
            startIndex: <span class="hljs-number">0</span>,
          ),
        ),
      );
    }
  }

  <span class="hljs-meta">@override</span>
  Widget build(BuildContext context) {
    <span class="hljs-keyword">return</span> Scaffold(
      appBar: AppBar(title: Text(<span class="hljs-string">"MultiImagePickerPlusç¤ºä¾‹"</span>)),
      body: Column(
        children: [
          ElevatedButton(onPressed: _pickImages, child: Text(<span class="hljs-string">"é€‰æ‹©å›¾ç‰‡"</span>)),
          ElevatedButton(onPressed: _previewImages, child: Text(<span class="hljs-string">"é¢„è§ˆå›¾ç‰‡"</span>)),
          Expanded(
            child: GridView.count(
              crossAxisCount: <span class="hljs-number">4</span>,
              children: _selectedAssets.map((asset) =&gt;
                AssetThumb(
                  asset: asset,
                  width: <span class="hljs-number">100</span>,
                  height: <span class="hljs-number">100</span>,
                )
              ).toList(),
            ),
          ),
        ],
      ),
    );
  }
}
</code></pre>
<h2 data-id="heading-17">4. æ ¸å¿ƒå·®å¼‚ä¸ä¼˜ç¼ºç‚¹å¯¹æ¯”</h2>
<p>åŸºäºä¸Šè¿°è§£æï¼Œä¸¤æ¬¾ç»„ä»¶åœ¨åŠŸèƒ½ã€æ€§èƒ½ã€æ‰©å±•æ€§ç­‰æ–¹é¢å­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œä»¥ä¸‹ä»å¤šä¸ªç»´åº¦è¿›è¡Œå¯¹æ¯”ï¼š</p>
<h3 data-id="heading-18">4.1 æ ¸å¿ƒåŠŸèƒ½å·®å¼‚</h3>













































<table><thead><tr><th>åŠŸèƒ½ç‚¹</th><th>image_picker</th><th>multi_image_picker_plus</th></tr></thead><tbody><tr><td>å¤šå›¾é€‰æ‹©</td><td>æ”¯æŒï¼Œä½†æ— é€‰å›¾æ•°é‡å®æ—¶æç¤º</td><td>åŸç”Ÿæ”¯æŒï¼Œæ˜¾ç¤ºå·²é€‰æ•°é‡å’Œå‰©ä½™å¯é€‰é¡¹</td></tr><tr><td>é€‰å›¾æ—¶æ‹ç…§</td><td>éœ€å•ç‹¬è°ƒç”¨ç›¸æœºAPIï¼Œæ— æ³•åœ¨é€‰å›¾ç•Œé¢ç›´æ¥æ‹ç…§</td><td>æ”¯æŒåœ¨é€‰å›¾ç•Œé¢å†…ç½®ç›¸æœºå…¥å£ï¼Œæ‹ç…§åç›´æ¥åŠ å…¥å·²é€‰</td></tr><tr><td>ç•Œé¢è‡ªå®šä¹‰</td><td>æ— ï¼Œä½¿ç”¨ç³»ç»ŸåŸç”Ÿé€‰å›¾ç•Œé¢</td><td>æ”¯æŒåŒå¹³å°ä¸»é¢˜ã€é¢œè‰²ã€ç½‘æ ¼åˆ—æ•°ç­‰è‡ªå®šä¹‰</td></tr><tr><td>å›¾ç‰‡é¢„è§ˆ</td><td>éœ€é€šè¿‡Fileè·¯å¾„è‡ªè¡Œå®ç°é¢„è§ˆç»„ä»¶</td><td>æä¾›AssetPreviewç»„ä»¶ï¼Œç›´æ¥é¢„è§ˆAssetåˆ—è¡¨</td></tr><tr><td>å‹ç¼©æ§åˆ¶</td><td>ä»…æ”¯æŒè´¨é‡å’Œå®½é«˜å‹ç¼©ï¼ŒAndroid/iOSå·®å¼‚å¤§</td><td>æ”¯æŒè´¨é‡ã€å°ºå¯¸ã€å¤§å°ä¸‰é‡å‹ç¼©ï¼ŒåŒå¹³å°ç»Ÿä¸€</td></tr><tr><td>å…ƒæ•°æ®è·å–</td><td>éœ€å¼€å¯requestFullMetadataï¼Œä»…è¿”å›åŸºç¡€ä¿¡æ¯</td><td>åŸç”Ÿæ”¯æŒï¼Œå¯è·å–å°ºå¯¸ã€ç±»å‹ã€æ‹æ‘„æ—¶é—´ç­‰è¯¦ç»†ä¿¡æ¯</td></tr><tr><td>è§†é¢‘é€‰æ‹©</td><td>æ”¯æŒå•è§†é¢‘/å¤šè§†é¢‘é€‰æ‹©</td><td>ä»…æ”¯æŒå›¾ç‰‡é€‰æ‹©ï¼Œä¸æ”¯æŒè§†é¢‘</td></tr></tbody></table>
<h3 data-id="heading-19">4.2 ä¼˜ç¼ºç‚¹å¯¹æ¯”</h3>
<p>ä»¥ä¸‹åˆ†ç±»å‹ç»´åº¦è¿›è¡Œå¯¹æ¯”:</p>
<h4 data-id="heading-20">4.2.1. image_pickerçš„ä¼˜ç¼ºç‚¹</h4>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š
å®˜æ–¹ç»´æŠ¤ï¼Œç¨³å®šæ€§é«˜ï¼Œä¸Flutterç‰ˆæœ¬å…¼å®¹æ€§å¥½</p>
</li>
<li>
<p>è½»é‡ç®€æ´ï¼ŒAPIå­¦ä¹ æˆæœ¬ä½ï¼Œå¿«é€Ÿé›†æˆ</p>
</li>
<li>
<p>æ”¯æŒè§†é¢‘é€‰æ‹©ï¼Œæ»¡è¶³å›¾æ–‡+è§†é¢‘æ··åˆåœºæ™¯</p>
</li>
<li>
<p>ç³»ç»ŸåŸç”Ÿç•Œé¢ï¼Œç”¨æˆ·ç†Ÿæ‚‰åº¦é«˜ï¼Œäº¤äº’ä¸€è‡´æ€§å¥½</p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š
å¤šå›¾é€‰æ‹©ä½“éªŒå·®ï¼Œæ— å®æ—¶æ•°é‡æç¤ºå’Œå·²é€‰å›æ˜¾ä¼˜åŒ–</p>
<p>ç•Œé¢æ— æ³•è‡ªå®šä¹‰ï¼Œæ— æ³•åŒ¹é…APPæ•´ä½“è®¾è®¡é£æ ¼</p>
<p>å‹ç¼©å’Œé¢„è§ˆéœ€è‡ªè¡Œå¤„ç†ï¼Œå¼€å‘æ•ˆç‡ä½</p>
<p>Androidå’ŒiOSå‹ç¼©é€»è¾‘ä¸ä¸€è‡´ï¼Œéœ€é¢å¤–é€‚é…</p>
<h4 data-id="heading-21">4.2.2. multi_image_picker_plusçš„ä¼˜ç¼ºç‚¹</h4>
<ul>
<li>
<p><strong>ä¼˜ç‚¹</strong>ï¼š
å¤šå›¾é€‰æ‹©ä½“éªŒæä½³ï¼Œæ”¯æŒå·²é€‰å›æ˜¾ã€æ•°é‡æ§åˆ¶ã€å†…ç½®ç›¸æœº</p>
</li>
<li>
<p>ä¸°å¯Œçš„è‡ªå®šä¹‰èƒ½åŠ›ï¼Œå¯åŒ¹é…APPä¸»é¢˜é£æ ¼</p>
</li>
<li>
<p>æä¾›AssetPreviewã€AssetThumbç­‰ç»„ä»¶ï¼Œå‡å°‘é‡å¤å¼€å‘</p>
</li>
<li>
<p>ç»Ÿä¸€çš„å‹ç¼©é€»è¾‘ï¼ŒåŒå¹³å°è¡¨ç°ä¸€è‡´</p>
</li>
<li>
<p>Assetå¯¹è±¡å°è£…å®Œå–„ï¼Œä¾¿äºå›¾ç‰‡å¤„ç†å’Œä¸Šä¼ </p>
</li>
</ul>
<p><strong>ç¼ºç‚¹</strong>ï¼š
ç¬¬ä¸‰æ–¹ç»´æŠ¤ï¼Œç‰ˆæœ¬æ›´æ–°é€Ÿåº¦å¯èƒ½æ»åäºFlutteræ–°ç‰ˆæœ¬</p>
<p>ä¸æ”¯æŒè§†é¢‘é€‰æ‹©ï¼Œéœ€é¢å¤–é›†æˆå…¶ä»–ç»„ä»¶</p>
<p>è‡ªå®šä¹‰é…ç½®é¡¹å¤šï¼Œåˆæ¬¡é›†æˆéœ€ç†Ÿæ‚‰æ›´å¤šå‚æ•°</p>
<p>åŒ…ä½“ç§¯ç•¥å¤§äºimage_picker</p>
<h2 data-id="heading-22">5. é€‰å‹å»ºè®®</h2>
<p>æ ¹æ®ä¸šåŠ¡åœºæ™¯çš„ä¸åŒï¼Œä¸¤æ¬¾ç»„ä»¶çš„é€‚ç”¨åœºæ™¯å­˜åœ¨æ˜æ˜¾åŒºåˆ†ï¼Œå»ºè®®æŒ‰ä»¥ä¸‹åŸåˆ™é€‰å‹ï¼š</p>
<ol>
<li>
<p><strong>ä¼˜å…ˆé€‰æ‹© image_picker çš„åœºæ™¯</strong>ï¼š
ç®€å•çš„å•å›¾é€‰æ‹©æˆ–æ‹ç…§åœºæ™¯ï¼ˆå¦‚å¤´åƒä¸Šä¼ ï¼‰</p>
</li>
<li>
<p>éœ€è¦åŒæ—¶æ”¯æŒå›¾ç‰‡å’Œè§†é¢‘é€‰æ‹©çš„åœºæ™¯</p>
</li>
<li>
<p>å¯¹åŒ…ä½“ç§¯æ•æ„Ÿï¼Œè¿½æ±‚è½»é‡é›†æˆçš„åœºæ™¯</p>
</li>
<li>
<p>é‡è§†å®˜æ–¹ç»´æŠ¤ä¿éšœï¼Œéœ€é•¿æœŸç¨³å®šæ€§çš„åœºæ™¯</p>
</li>
<li>
<p><strong>ä¼˜å…ˆé€‰æ‹© multi_image_picker_plus çš„åœºæ™¯</strong>ï¼š
æ ¸å¿ƒåœºæ™¯ä¸ºå¤šå›¾é€‰æ‹©ï¼ˆå¦‚æœ‹å‹åœˆã€ç›¸å†Œä¸Šä¼ ï¼‰</p>
</li>
<li>
<p>å¯¹é€‰å›¾ç•Œé¢é£æ ¼æœ‰è‡ªå®šä¹‰éœ€æ±‚ï¼Œéœ€åŒ¹é…APPä¸»é¢˜</p>
</li>
<li>
<p>éœ€è¦ä¼˜åŒ–å¤šå›¾é€‰å›¾ä½“éªŒï¼ˆå¦‚å·²é€‰å›æ˜¾ã€å†…ç½®ç›¸æœºï¼‰</p>
</li>
<li>
<p>éœ€è¦å¿«é€Ÿå®ç°å›¾ç‰‡é¢„è§ˆã€ç¼©ç•¥å›¾å±•ç¤ºçš„åœºæ™¯</p>
</li>
</ol>
<h2 data-id="heading-23">6. æ€»ç»“</h2>
<p>image_pickerå’Œmulti_image_picker_pluså„æœ‰ä¾§é‡ï¼š</p>
<ul>
<li>image_pickeræ˜¯å®˜æ–¹èƒŒä¹¦çš„"åŸºç¡€æ¬¾"ï¼Œèƒœåœ¨ç¨³å®šè½»é‡ã€æ”¯æŒè§†é¢‘ï¼›</li>
<li>multi_image_picker_plusæ˜¯å¤šå›¾åœºæ™¯çš„"ä¸“ä¸šæ¬¾"ï¼Œèµ¢åœ¨ä½“éªŒä¼˜åŒ–å’Œè‡ªå®šä¹‰èƒ½åŠ›ã€‚</li>
</ul>
<p>å¼€å‘è€…åœ¨å®é™…å¼€å‘ä¸­éœ€ç»“åˆä¸šåŠ¡éœ€æ±‚çš„æ ¸å¿ƒç—›ç‚¹ï¼Œæƒè¡¡ç¨³å®šæ€§ã€åŠŸèƒ½å®Œæ•´æ€§å’Œå¼€å‘æ•ˆç‡ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç»„ä»¶ã€‚è‹¥éœ€åŒæ—¶æ”¯æŒå¤šå›¾å’Œè§†é¢‘ï¼Œå¯è€ƒè™‘ä¸¤è€…ç»“åˆä½¿ç”¨ã€‚ç”¨multi_image_picker_pluså¤„ç†å¤šå›¾ï¼Œè€Œimage_pickerè¡¥å……è§†é¢‘é€‰æ‹©èƒ½åŠ›ã€‚</p>
<hr/>
<blockquote>
<p>æœ¬æ¬¡åˆ†äº«å°±åˆ°è¿™å„¿å•¦ï¼Œæˆ‘æ˜¯é¹å¤šå¤šï¼Œæ·±è€•å‰ç«¯çš„æŠ€æœ¯åˆ›ä½œè€…ï¼Œå¦‚æœæ‚¨çœ‹äº†è§‰å¾—æœ‰å¸®åŠ©ï¼Œæ¬¢è¿è¯„è®ºï¼Œå…³æ³¨ï¼Œç‚¹èµï¼Œè½¬å‘ï¼Œæˆ‘ä»¬ä¸‹æ¬¡è§~</p>
</blockquote>
<p>PSï¼šåœ¨æœ¬é¡µæŒ‰F12ï¼Œåœ¨consoleä¸­è¾“å…¥document.getElementsByClassName('panel-btn')[0].click();æœ‰æƒŠå–œå“¦~</p>
<p><code>å¾€æœŸæ–‡ç« </code></p>
<ul>
<li><a href="https://juejin.cn/post/7568136081302978623" target="_blank" title="https://juejin.cn/post/7568136081302978623">è§£é”flutterå¼¹çª—æ–°å§¿åŠ¿ï¼šdialog-flutter_smart_dialogæ’ä»¶è§£è¯»+æ¡ˆä¾‹</a></li>
<li><a href="https://juejin.cn/post/7559089440901545999" target="_blank" title="https://juejin.cn/post/7559089440901545999">flutter-åˆ‡æ¢çŠ¶æ€æ˜¾ç¤ºä¸åŒç»„ä»¶10ç§å®ç°æ–¹æ¡ˆå…¨è§£æ</a></li>
<li><a href="https://juejin.cn/post/7555079970491318308" target="_blank" title="https://juejin.cn/post/7555079970491318308">flutter-è¯¦è§£æ§åˆ¶ç»„ä»¶æ˜¾ç¤ºçš„ä¸¤ç§æ–¹å¼Offstageä¸Visibility</a></li>
<li><a href="https://juejin.cn/post/7535358416182788122" target="_blank" title="https://juejin.cn/post/7535358416182788122">flutter-ä½¿ç”¨AnimatedDefaultTextStyleå®ç°æ–‡æœ¬åŠ¨ç”»</a></li>
<li><a href="https://juejin.cn/post/7537339432291434496" target="_blank" title="https://juejin.cn/post/7537339432291434496">flutter-ä½¿ç”¨SafeAreaç»„ä»¶å¤„ç†å„æœºå‹çš„å®‰å…¨è·ç¦»</a></li>
<li><a href="https://juejin.cn/spost/7537593417099149321" target="_blank" title="https://juejin.cn/spost/7537593417099149321">flutter-å®ç°æ¸å˜è‰²è¾¹æ¡†èƒŒæ™¯ä»¥åŠæ¸å˜è‰²æ–‡å­—</a></li>
<li><a href="https://juejin.cn/post/7543474419240370185" target="_blank" title="https://juejin.cn/post/7543474419240370185">flutter-ä½¿ç”¨confettiåˆ¶ä½œç‚«é…·çº¸å±‘çˆ†ç‚¸ç²’å­åŠ¨ç”»</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŸå›¢äº’è”ç½‘å¤§å‚çš„ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“]]></title>    <link>https://juejin.cn/post/7570975737634275369</link>    <guid>https://juejin.cn/post/7570975737634275369</guid>    <pubDate>2025-11-11T00:41:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570975737634275369" data-draft-id="7570903763722043402" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŸå›¢äº’è”ç½‘å¤§å‚çš„ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-11T00:41:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŸå›¢äº’è”ç½‘å¤§å‚çš„ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:41:31.000Z" title="Tue Nov 11 2025 00:41:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>éšç€äº’è”ç½‘çš„å‘å±•ï¼Œç½‘ç»œåè®®çš„å¤æ‚æ€§ä¸é‡è¦æ€§æ—¥ç›Šæå‡ã€‚äº’è”ç½‘å¤§å‚ï¼Œå°¤å…¶æ˜¯å¦‚æŸå›¢è¿™æ ·çš„äº’è”ç½‘å…¬å¸ï¼Œä¾èµ–äºé«˜æ•ˆã€ç¨³å®šã€å®‰å…¨çš„æ•°æ®ä¼ è¾“æœºåˆ¶æ¥ç¡®ä¿ç”¨æˆ·ä½“éªŒå’Œä¸šåŠ¡ç¨³å®šã€‚æœ¬æ–‡å°†ç®€è¦ä»‹ç»ä¸€äº›ç½‘ç»œåè®®ç›¸å…³çš„æ¦‚å¿µå’ŒæŠ€æœ¯ï¼Œä»¥åŠå®ƒä»¬åœ¨ç°ä»£äº’è”ç½‘æ¶æ„ä¸­çš„åº”ç”¨ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/464ad972ff2e49898272275111aea0b1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=HguZq4HcjLqgXH1%2FYQYq4t28aTc%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<hr/>
<h4 data-id="heading-0">1. <strong>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆTCPè¿æ¥å»ºç«‹è¿‡ç¨‹ï¼‰</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e936389df78a417b907a77e92b8f0347~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=Djj%2FDvMQaeDdmXszriONVEuoH7Q%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h4>
<p>ä¸‰æ¬¡æ¡æ‰‹ï¼ˆThree-Way Handshakeï¼‰æ˜¯å»ºç«‹TCPè¿æ¥çš„è¿‡ç¨‹ã€‚åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ï¼Œå¿…é¡»é€šè¿‡ä¸‰æ¬¡äº¤æ¢æ•°æ®æ¥ç¡®ä¿åŒæ–¹éƒ½èƒ½å¤Ÿæ¥æ”¶å’Œå‘é€æ•°æ®ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªSYNï¼ˆåŒæ­¥ï¼‰è¯·æ±‚åŒ…åˆ°æœåŠ¡å™¨ï¼Œè¡¨ç¤ºè¯·æ±‚å»ºç«‹è¿æ¥ã€‚</li>
<li><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ï¼šæœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„SYNè¯·æ±‚åï¼Œå›å¤ä¸€ä¸ªSYN-ACKåŒ…ï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿æ¥ã€‚</li>
<li><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„SYN-ACKåŒ…åï¼Œå†å‘é€ä¸€ä¸ªACKï¼ˆç¡®è®¤ï¼‰åŒ…ï¼Œè¡¨ç¤ºè¿æ¥æˆåŠŸå»ºç«‹ã€‚</li>
</ul>
<p>é€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼ŒåŒæ–¹ç¡®è®¤äº†å½¼æ­¤çš„æ¥æ”¶èƒ½åŠ›ï¼Œç¡®ä¿è¿æ¥çš„å¯é æ€§ã€‚</p>
<h4 data-id="heading-1">2. <strong>å››æ¬¡æŒ¥æ‰‹ï¼ˆTCPè¿æ¥æ–­å¼€è¿‡ç¨‹ï¼‰</strong></h4>
<p>å››æ¬¡æŒ¥æ‰‹ï¼ˆFour-Way Handshakeï¼‰æ˜¯æ–­å¼€TCPè¿æ¥çš„è¿‡ç¨‹ã€‚åœ¨TCPè¿æ¥å…³é—­æ—¶ï¼ŒåŒæ–¹éœ€è¦è¿›è¡Œå››æ¬¡æ•°æ®äº¤æ¢ï¼š</p>
<ul>
<li><strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªFINï¼ˆç»“æŸï¼‰åŒ…ï¼Œè¡¨ç¤ºå¸Œæœ›æ–­å¼€è¿æ¥ã€‚</li>
<li><strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨æ”¶åˆ°FINåŒ…åï¼Œå›å¤ä¸€ä¸ªACKåŒ…ï¼Œç¡®è®¤æ¥æ”¶åˆ°æ–­å¼€è¯·æ±‚ã€‚</li>
<li><strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨å‘é€ä¸€ä¸ªFINåŒ…ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¹Ÿå‡†å¤‡å¥½å…³é—­è¿æ¥ã€‚</li>
<li><strong>ç¬¬å››æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„FINåŒ…åï¼Œå›å¤ä¸€ä¸ªACKåŒ…ï¼Œè¿æ¥æ­£å¼å…³é—­ã€‚</li>
</ul>
<p>å››æ¬¡æŒ¥æ‰‹ç¡®ä¿äº†è¿æ¥çš„åŒæ–¹éƒ½èƒ½å¤Ÿæ­£å¸¸å…³é—­è¿æ¥ï¼Œé¿å…æ•°æ®ä¸¢å¤±ã€‚</p>
<h4 data-id="heading-2">3. <strong>æ»‘åŠ¨çª—å£ä¸æ‹¥å¡æ§åˆ¶</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1a741938f7e847f8b331fd810720da45~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=yHm8BOC%2FCmBMzSoxjWXk81BAZyQ%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h4>
<p>TCPåè®®èƒ½å¤Ÿä¿è¯æ•°æ®ä¼ è¾“çš„å¯é æ€§ï¼Œä¸»è¦é€šè¿‡æ»‘åŠ¨çª—å£å’Œæ‹¥å¡æ§åˆ¶æœºåˆ¶ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1282b7162121441c9899a6c9c8be0d94~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=NaRjaQSfJv7Ie5AKUWK30oMXPDA%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</p>
<ul>
<li><strong>æ»‘åŠ¨çª—å£</strong>ï¼šTCPä½¿ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶æ¥æ§åˆ¶æ•°æ®æµçš„é€Ÿç‡ã€‚çª—å£çš„å¤§å°ä¼šæ ¹æ®ç½‘ç»œçš„æƒ…å†µåŠ¨æ€è°ƒæ•´ï¼Œç¡®ä¿å‘é€æ–¹ä¸ä¼šå› ä¸ºå‘é€è¿‡å¿«è€Œè®©æ¥æ”¶æ–¹çš„ç¼“å†²åŒºæº¢å‡ºã€‚</li>
<li><strong>æ‹¥å¡æ§åˆ¶</strong>ï¼šTCPåè®®é€šè¿‡æ§åˆ¶å‘é€é€Ÿç‡æ¥é¿å…ç½‘ç»œæ‹¥å¡ï¼Œé¿å…å› ç½‘ç»œé˜»å¡å¯¼è‡´çš„æ•°æ®ä¸¢å¤±ã€‚ä¸»è¦çš„æ‹¥å¡æ§åˆ¶ç®—æ³•åŒ…æ‹¬æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é‡ä¼ å’Œå¿«æ¢å¤ç­‰ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34150f4bef0d41c1afc594f0cc302bed~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426491&amp;x-signature=Dc5HK7%2FQ9l5fibPvhTIXMb7HjdU%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</li>
</ul>
<p>é€šè¿‡è¿™ä¸¤è€…çš„é…åˆï¼ŒTCPèƒ½å¤Ÿå®ç°å¯é çš„ä¼ è¾“ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±å’Œç½‘ç»œæ‹¥å¡ã€‚</p>
<h4 data-id="heading-3">4. <strong>ä¸ƒå±‚æ¨¡å‹ï¼ˆOSIæ¨¡å‹ï¼‰</strong></h4>
<p>OSIï¼ˆå¼€æ”¾ç³»ç»Ÿäº’è”ï¼‰æ¨¡å‹æ˜¯ä¸€ä¸ªæ ‡å‡†åŒ–çš„ç½‘ç»œåè®®æ¨¡å‹ï¼Œå°†ç½‘ç»œé€šä¿¡è¿‡ç¨‹åˆ†ä¸ºä¸ƒä¸ªå±‚æ¬¡ï¼š</p>
<ol>
<li><strong>ç‰©ç†å±‚</strong>ï¼šè´Ÿè´£ç¡¬ä»¶è®¾å¤‡çš„ä¼ è¾“ä»‹è´¨å’Œæ•°æ®ä¼ è¾“ã€‚</li>
<li><strong>æ•°æ®é“¾è·¯å±‚</strong>ï¼šé€šè¿‡MACåœ°å€æä¾›è®¾å¤‡é—´çš„é“¾è·¯æ§åˆ¶ã€‚</li>
<li><strong>ç½‘ç»œå±‚</strong>ï¼šè´Ÿè´£æ•°æ®åŒ…çš„è·¯ç”±é€‰æ‹©å’Œè½¬å‘ï¼ˆå¦‚IPåè®®ï¼‰ã€‚</li>
<li><strong>ä¼ è¾“å±‚</strong>ï¼šä¿è¯æ•°æ®çš„å¯é ä¼ è¾“ï¼ˆå¦‚TCP/UDPï¼‰ã€‚</li>
<li><strong>ä¼šè¯å±‚</strong>ï¼šå»ºç«‹å’Œç®¡ç†ä¼šè¯è¿æ¥ã€‚</li>
<li><strong>è¡¨ç¤ºå±‚</strong>ï¼šæ•°æ®çš„æ ¼å¼è½¬æ¢ã€åŠ å¯†ã€è§£å¯†ç­‰ã€‚</li>
<li><strong>åº”ç”¨å±‚</strong>ï¼šç›´æ¥ä¸ç”¨æˆ·äº¤äº’çš„åè®®ï¼ˆå¦‚HTTPã€FTPç­‰ï¼‰ã€‚</li>
</ol>
<h4 data-id="heading-4">5. <strong>HTTPå’ŒHTTPSçš„åŒºåˆ«</strong></h4>
<p>HTTPï¼ˆè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰å’ŒHTTPSï¼ˆå®‰å…¨è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼‰çš„ä¸»è¦åŒºåˆ«åœ¨äºå®‰å…¨æ€§ï¼š</p>
<ul>
<li><strong>HTTP</strong>ï¼šæ•°æ®ä¼ è¾“æ˜¯æ˜æ–‡çš„ï¼Œå®¹æ˜“è¢«çªƒå¬å’Œç¯¡æ”¹ã€‚</li>
<li><strong>HTTPS</strong>ï¼šåœ¨HTTPçš„åŸºç¡€ä¸Šï¼Œä½¿ç”¨SSL/TLSåè®®å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç¡®ä¿æ•°æ®çš„ä¼ è¾“å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚</li>
</ul>
<p>å› æ­¤ï¼ŒHTTPSé€‚ç”¨äºéœ€è¦ä¿è¯æ•°æ®å®‰å…¨æ€§çš„ç½‘ç«™ï¼Œå¦‚ç½‘é“¶ã€ç”µå­å•†åŠ¡ç­‰ã€‚</p>
<h4 data-id="heading-5">6. <strong>GETå’ŒPOSTçš„åŒºåˆ«</strong></h4>
<ul>
<li><strong>GET</strong>ï¼šé€šè¿‡URLä¼ é€’æ•°æ®ï¼Œæ•°æ®ä¼šæš´éœ²åœ¨æµè§ˆå™¨åœ°å€æ ä¸­ï¼Œé€‚ç”¨äºè·å–æ•°æ®ï¼Œä¸ä¼šæœ‰å‰¯ä½œç”¨ã€‚GETè¯·æ±‚çš„é•¿åº¦æœ‰é™åˆ¶ï¼Œé€šå¸¸ç”¨äºæŸ¥è¯¢æ“ä½œã€‚</li>
<li><strong>POST</strong>ï¼šé€šè¿‡è¯·æ±‚ä½“ä¼ é€’æ•°æ®ï¼Œæ•°æ®ä¸ä¼šæš´éœ²åœ¨URLä¸­ï¼Œé€‚ç”¨äºå‘é€æ•°æ®ï¼Œå¯èƒ½ä¼šå¼•å‘å‰¯ä½œç”¨ï¼Œå¦‚æäº¤è¡¨å•ã€‚POSTæ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œé€šå¸¸ç”¨äºæäº¤æ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-6">7. <strong>ä¸€æ¬¡URLè¯·æ±‚çš„è¿‡ç¨‹</strong></h4>
<p>ä¸€æ¬¡URLè¯·æ±‚çš„è¿‡ç¨‹æ¶‰åŠå¤šä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>DNSè§£æ</strong>ï¼šæµè§ˆå™¨å‘DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè§£æURLä¸­çš„åŸŸåï¼Œå¾—åˆ°IPåœ°å€ã€‚</li>
<li><strong>å»ºç«‹TCPè¿æ¥</strong>ï¼šé€šè¿‡ä¸‰æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</li>
<li><strong>å‘é€HTTPè¯·æ±‚</strong>ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€HTTPè¯·æ±‚ï¼ŒåŒ…å«è¯·æ±‚çš„èµ„æºè·¯å¾„ã€å¤´éƒ¨ä¿¡æ¯ç­‰ã€‚</li>
<li><strong>æœåŠ¡å™¨å“åº”</strong>ï¼šæœåŠ¡å™¨æ ¹æ®è¯·æ±‚è¿”å›æ•°æ®ï¼Œé€šå¸¸æ˜¯HTMLã€å›¾ç‰‡æˆ–JSONç­‰æ ¼å¼ã€‚</li>
<li><strong>å…³é—­è¿æ¥</strong>ï¼šé€šè¿‡å››æ¬¡æŒ¥æ‰‹ï¼Œå…³é—­TCPè¿æ¥ã€‚</li>
</ol>
<h4 data-id="heading-7">8. <strong>Cookieå’ŒSessionçš„åŒºåˆ«åŠä½¿ç”¨</strong></h4>
<ul>
<li><strong>Cookie</strong>ï¼šå­˜å‚¨åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨ä¸­çš„å°æ•°æ®å—ï¼Œå¯ä»¥ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚ç™»å½•çŠ¶æ€ã€‚æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šéšåŒå‘é€ã€‚</li>
<li><strong>Session</strong>ï¼šå­˜å‚¨åœ¨æœåŠ¡å™¨ç«¯çš„ç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼Œé€šè¿‡Session IDä¸å®¢æˆ·ç«¯å…³è”ã€‚Sessionæ›´å®‰å…¨ï¼Œé€šå¸¸ç”¨äºä¿å­˜æ•æ„Ÿæ•°æ®ã€‚</li>
</ul>
<h4 data-id="heading-8">9. <strong>HTTPSå®ç°è¿‡ç¨‹</strong></h4>
<p>HTTPSçš„å®ç°è¿‡ç¨‹ä¸»è¦é€šè¿‡SSL/TLSåè®®æ¥åŠ å¯†å’ŒéªŒè¯æ•°æ®ï¼š</p>
<ol>
<li>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨å»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šè¯·æ±‚æœåŠ¡å™¨çš„SSLè¯ä¹¦ã€‚</li>
<li>æœåŠ¡å™¨é€šè¿‡è¯ä¹¦å‘å®¢æˆ·ç«¯æä¾›å…¬é’¥ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å…¬é’¥åŠ å¯†å¯¹ç§°å¯†é’¥å¹¶å‘é€ç»™æœåŠ¡å™¨ã€‚</li>
<li>æœåŠ¡å™¨ä½¿ç”¨ç§é’¥è§£å¯†å¯¹ç§°å¯†é’¥ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨å¯¹ç§°åŠ å¯†æ¥åŠ å¯†åç»­çš„æ•°æ®ä¼ è¾“ã€‚</li>
</ol>
<h4 data-id="heading-9">10. <strong>å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</strong></h4>
<ul>
<li><strong>å¯¹ç§°åŠ å¯†</strong>ï¼šåŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ã€‚ä¼˜ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œç¼ºç‚¹æ˜¯å¯†é’¥åˆ†é…å­˜åœ¨é£é™©ã€‚</li>
<li><strong>éå¯¹ç§°åŠ å¯†</strong>ï¼šä½¿ç”¨å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ã€‚ä¼˜ç‚¹æ˜¯å®‰å…¨æ€§é«˜ï¼Œä½†åŠ å¯†è§£å¯†é€Ÿåº¦è¾ƒæ…¢ã€‚</li>
</ul>
<h4 data-id="heading-10">11. <strong>TCPå’ŒUDPçš„åŒºåˆ«</strong></h4>
<ul>
<li><strong>TCP</strong>ï¼šé¢å‘è¿æ¥çš„åè®®ï¼Œä¿è¯æ•°æ®å¯é æ€§ï¼Œç¡®ä¿æ•°æ®æŒ‰é¡ºåºåˆ°è¾¾ã€‚é€‚ç”¨äºå¯¹å¯é æ€§è¦æ±‚é«˜çš„åº”ç”¨ï¼ˆå¦‚ç½‘é¡µæµè§ˆã€æ–‡ä»¶ä¼ è¾“ï¼‰ã€‚</li>
<li><strong>UDP</strong>ï¼šæ— è¿æ¥çš„åè®®ï¼Œä¸ä¿è¯æ•°æ®å¯é æ€§ï¼Œé€‚ç”¨äºå¯¹é€Ÿåº¦è¦æ±‚é«˜ä¸”å¯ä»¥å®¹å¿ä¸¢åŒ…çš„åº”ç”¨ï¼ˆå¦‚è§†é¢‘æµã€åœ¨çº¿æ¸¸æˆï¼‰ã€‚</li>
</ul>
<h4 data-id="heading-11">12. <strong>DNSè§£æè¿‡ç¨‹</strong></h4>
<p>DNSè§£æè¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>æµè§ˆå™¨æŸ¥è¯¢æœ¬åœ°DNSç¼“å­˜</strong>ï¼šé¦–å…ˆæ£€æŸ¥æœ¬åœ°æ˜¯å¦å·²æœ‰è¯¥åŸŸåçš„è§£æç»“æœã€‚</li>
<li><strong>æŸ¥è¯¢DNSæœåŠ¡å™¨</strong>ï¼šå¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œæµè§ˆå™¨ä¼šå‘é…ç½®çš„DNSæœåŠ¡å™¨å‘é€è¯·æ±‚ã€‚</li>
<li><strong>é€’å½’æŸ¥è¯¢</strong>ï¼šDNSæœåŠ¡å™¨å¯èƒ½ä¼šè½¬å‘è¯·æ±‚åˆ°å…¶ä»–DNSæœåŠ¡å™¨ï¼Œç›´åˆ°æ‰¾åˆ°æƒå¨DNSæœåŠ¡å™¨ã€‚</li>
<li><strong>è¿”å›IPåœ°å€</strong>ï¼šæƒå¨DNSæœåŠ¡å™¨è¿”å›åŸŸåå¯¹åº”çš„IPåœ°å€ï¼Œæµè§ˆå™¨ä½¿ç”¨è¯¥IPåœ°å€ä¸ç›®æ ‡æœåŠ¡å™¨å»ºç«‹è¿æ¥ã€‚</li>
</ol>
<hr/>
<p>é€šè¿‡ç†è§£è¿™äº›ç½‘ç»œåè®®ä¸æ•°æ®ä¼ è¾“æœºåˆ¶ï¼ŒæŸå›¢äº’è”ç½‘å¤§å‚èƒ½å¤Ÿç¡®ä¿å…¶å¹³å°çš„é«˜æ•ˆæ€§ã€å®‰å…¨æ€§ä»¥åŠç”¨æˆ·ä½“éªŒã€‚è¿™äº›æŠ€æœ¯ä¸ä»…åœ¨æ—¥å¸¸çš„æ•°æ®äº¤äº’ä¸­è‡³å…³é‡è¦ï¼Œè€Œä¸”ä¸ºæ„å»ºç°ä»£äº’è”ç½‘æ¶æ„æä¾›äº†åšå®çš„åŸºç¡€ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#.NET å¼€å‘å¿…å¤‡ï¼šå¸¸ç”¨ç‰¹æ€§ä¸æ³¨è§£ç”¨æ³•å¤§å…¨]]></title>    <link>https://juejin.cn/post/7570935965436297231</link>    <guid>https://juejin.cn/post/7570935965436297231</guid>    <pubDate>2025-11-11T00:43:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570935965436297231" data-draft-id="7570940025581617192" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#.NET å¼€å‘å¿…å¤‡ï¼šå¸¸ç”¨ç‰¹æ€§ä¸æ³¨è§£ç”¨æ³•å¤§å…¨"/> <meta itemprop="keywords" content="C#,.NET"/> <meta itemprop="datePublished" content="2025-11-11T00:43:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å”é’æ«"/> <meta itemprop="url" content="https://juejin.cn/user/3737995266234280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#.NET å¼€å‘å¿…å¤‡ï¼šå¸¸ç”¨ç‰¹æ€§ä¸æ³¨è§£ç”¨æ³•å¤§å…¨
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3737995266234280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å”é’æ«
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:43:13.000Z" title="Tue Nov 11 2025 00:43:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">ç‰¹æ€§åŸºç¡€</h3>
<h4 data-id="heading-1">ä»€ä¹ˆæ˜¯ç‰¹æ€§</h4>
<p>ç‰¹æ€§æ˜¯é™„åŠ åˆ°ä»£ç å…ƒç´ ï¼ˆç¨‹åºé›†ã€ç±»å‹ã€æˆå‘˜ã€å‚æ•°ç­‰ï¼‰ä¸Šçš„å…ƒæ•°æ®ã€‚ç¼–è¯‘åå†™å…¥ ILï¼Œå¯åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„è¯»å–æˆ–ç”±è¿è¡Œæ—¶/æ¡†æ¶è¯†åˆ«å¹¶åšç›¸åº”å¤„ç†ã€‚</p>
<h4 data-id="heading-2">å®šä¹‰ç‰¹æ€§</h4>
<p>è‡ªå®šä¹‰ç‰¹æ€§éœ€ç»§æ‰¿è‡ª <code>System.Attribute</code>ï¼Œå¹¶å¯é€šè¿‡ <code>AttributeUsage</code> é™åˆ¶å…¶ä½œç”¨ç›®æ ‡å’Œå…è®¸å¤šé‡ä½¿ç”¨ã€‚</p>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">AttributeUsage(AttributeTargets.Class | AttributeTargets.Method, AllowMultiple = false, Inherited = true)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MyCustomAttribute</span> : <span class="hljs-title">Attribute</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Name { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MyCustomAttribute</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> name</span>)</span> =&gt; Name = name;
}
</code></pre>
<h3 data-id="heading-3">CLR å†…ç½®é€šç”¨ç‰¹æ€§</h3>


















































<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>[Obsolete]</code></td><td>æ ‡è®°å·²åºŸå¼ƒçš„ APIï¼Œè°ƒç”¨æ—¶æŠ¥ç¼–è¯‘è­¦å‘Šæˆ–é”™è¯¯</td><td><code>[Obsolete("Use NewMethod instead", true)] public void Old() { }</code></td></tr><tr><td><code>[Serializable]</code></td><td>æ ‡è®°å¯é€šè¿‡äºŒè¿›åˆ¶/SOAP åºåˆ—åŒ–</td><td><code>[Serializable] public class Person { ... }</code></td></tr><tr><td><code>[NonSerialized]</code></td><td>ä¸ <code>[Serializable]</code> é…åˆä½¿ç”¨ï¼Œæ ‡è®°å­—æ®µä¸å‚ä¸åºåˆ—åŒ–</td><td><code>[NonSerialized] private int _tempCache;</code></td></tr><tr><td><code>[DebuggerStepThrough]</code></td><td>è°ƒè¯•æ—¶è·³è¿‡è¯¥æ–¹æ³•æˆ–ç±»ï¼Œä¸å•æ­¥è¿›å…¥</td><td><code>[DebuggerStepThrough] void Helper() { ... }</code></td></tr><tr><td><code>[DebuggerDisplay]</code></td><td>è‡ªå®šä¹‰è°ƒè¯•å™¨ä¸­æ˜¾ç¤ºçš„ä¿¡æ¯</td><td><code>[DebuggerDisplay("{Id} - {Name}")] public class User { ... }</code></td></tr><tr><td><code>[CallerMemberName]</code></td><td>å‚æ•°è£…é¥°ï¼Œè·å–è°ƒç”¨è€…çš„æ–¹æ³•å</td><td><code>void Log([CallerMemberName] string caller = null) { ... }</code></td></tr><tr><td><code>[CallerFilePath]</code></td><td>è·å–è°ƒç”¨è€…æºæ–‡ä»¶è·¯å¾„</td><td>åŒä¸Š</td></tr><tr><td><code>[CallerLineNumber]</code></td><td>è·å–è°ƒç”¨è€…è¡Œå·</td><td>åŒä¸Š</td></tr></tbody></table>
<h3 data-id="heading-4">æ•°æ®ç»‘å®šä¸éªŒè¯ï¼ˆData Annotationsï¼‰</h3>
<p>ä½äº <code>System.ComponentModel.DataAnnotations</code>ï¼Œå¸¸ç”¨äº <code>ASP.NET MVC / EF Core / Blazor</code> ç­‰æ¡†æ¶ï¼š</p>


















































<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>[Required]</code></td><td>å±æ€§ä¸èƒ½ä¸ºç©º</td><td><code>[Required] public string Name { get; set; }</code></td></tr><tr><td><code>[StringLength]</code></td><td>é™åˆ¶å­—ç¬¦ä¸²æœ€å¤§/æœ€å°é•¿åº¦</td><td><code>[StringLength(100, MinimumLength = 5)]</code></td></tr><tr><td><code>[Range]</code></td><td>æ•°å€¼æˆ–æ—¥æœŸèŒƒå›´éªŒè¯</td><td><code>[Range(1, 100)] public int Age { get; set; }</code></td></tr><tr><td><code>[RegularExpression]</code></td><td>æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒ</td><td><code>[RegularExpression(@"^\d{3}-\d{4}$")] public string Phone;</code></td></tr><tr><td><code>[EmailAddress]</code></td><td>ç”µå­é‚®ä»¶æ ¼å¼éªŒè¯</td><td><code>[EmailAddress] public string Email { get; set; }</code></td></tr><tr><td><code>[Key]</code></td><td>æ ‡è®°å®ä½“ä¸»é”®ï¼ˆEF Coreï¼‰</td><td><code>[Key] public int Id { get; set; }</code></td></tr><tr><td><code>[Timestamp]</code></td><td>å¹¶å‘æ£€æŸ¥ï¼ˆè¡Œç‰ˆæœ¬å·ï¼‰</td><td><code>[Timestamp] public byte[] RowVersion { get; set; }</code></td></tr><tr><td><code>[Display(Name="...")]</code></td><td>æŒ‡å®šæ˜¾ç¤ºåç§°</td><td><code>[Display(Name="ç”¨æˆ·å")] public string UserName { get; set; }</code></td></tr></tbody></table>
<h3 data-id="heading-5">åºåˆ—åŒ–ä¸ Web API</h3>
<h4 data-id="heading-6">JSON.NET / System.Text.Json</h4>

























<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td><code>[JsonIgnore]</code></td><td>å¿½ç•¥å±æ€§åºåˆ—åŒ–</td><td><code>[JsonIgnore] public string InternalNote { get; set; }</code></td></tr><tr><td><code>[JsonProperty("name")]</code></td><td>æŒ‡å®š JSON å­—æ®µåç§°ï¼ˆNewtonsoftï¼‰</td><td><code>[JsonProperty("user_name")] public string Name { get; set; }</code></td></tr><tr><td><code>[JsonPropertyName("name")]</code></td><td>æŒ‡å®š JSON å­—æ®µåç§°ï¼ˆSystem.Text.Jsonï¼‰</td><td><code>[JsonPropertyName("user_name")] public string Name { get; set; }</code></td></tr></tbody></table>
<h4 data-id="heading-7">XML åºåˆ—åŒ–</h4>





















<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[XmlElement("Name")]</code></td><td>æŒ‡å®šå…ƒç´ å</td></tr><tr><td><code>[XmlAttribute]</code></td><td>åºåˆ—åŒ–ä¸º XML å±æ€§</td></tr><tr><td><code>[XmlIgnore]</code></td><td>å¿½ç•¥å­—æ®µ</td></tr></tbody></table>
<h3 data-id="heading-8">ä¾èµ–æ³¨å…¥ä¸æ¡†æ¶é›†æˆ</h3>
<h4 data-id="heading-9">ASP.NET Core</h4>





























<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[ApiController]</code></td><td>å¯ç”¨è‡ªåŠ¨å‚æ•°ç»‘å®šã€400 å“åº”ç­‰ Web API ç‰¹æ€§</td></tr><tr><td><code>[Route("api/[controller]")]</code></td><td>å®šä¹‰æ§åˆ¶å™¨è·¯ç”±</td></tr><tr><td><code>[HttpGet]</code>, <code>[HttpPost]</code> ç­‰</td><td>æ ‡è®° Action æ”¯æŒçš„ HTTP åŠ¨è¯</td></tr><tr><td><code>[FromServices]</code></td><td>ä» DI å®¹å™¨ä¸­è§£æå‚æ•°</td></tr><tr><td><code>[FromQuery]</code>, <code>[FromBody]</code> ç­‰</td><td>æŒ‡å®šå‚æ•°ç»‘å®šæ¥æº</td></tr></tbody></table>
<h3 data-id="heading-10">çº¿ç¨‹ä¸å¹¶å‘</h3>





















<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[MethodImpl(MethodImplOptions.Synchronized)]</code></td><td>å°†æ–¹æ³•é”å®šä¸ºå•çº¿ç¨‹è®¿é—®</td></tr><tr><td><code>[ThreadStatic]</code></td><td>æ ‡è®°å­—æ®µä¸ºçº¿ç¨‹é™æ€ï¼Œæ¯çº¿ç¨‹ç‹¬ç«‹å®ä¾‹</td></tr><tr><td><code>[AsyncStateMachine]</code></td><td>ç¼–è¯‘å™¨ç”Ÿæˆï¼Œç”¨äºæ ‡è®° async æ–¹æ³•</td></tr></tbody></table>
<h3 data-id="heading-11">å¹³å°å…¼å®¹ä¸ç‰ˆæœ¬</h3>





















<table><thead><tr><th>ç‰¹æ€§</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>[SupportedOSPlatform]</code></td><td>æŒ‡ç¤º API åœ¨æŒ‡å®šå¹³å°å¯ç”¨ï¼ˆ.NET 5+ï¼‰</td></tr><tr><td><code>[UnsupportedOSPlatform]</code></td><td>æŒ‡ç¤º API åœ¨æŒ‡å®šå¹³å°ä¸å¯ç”¨</td></tr><tr><td><code>[ObsoletedOSPlatform]</code></td><td>æ ‡è®° API åœ¨å¹³å°ä¸Šçš„è¿‡æ—¶ç‰ˆæœ¬</td></tr></tbody></table>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">SupportedOSPlatform(<span class="hljs-string">"windows"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WindowsOnly</span>()</span> { â€¦ }
</code></pre>
<h3 data-id="heading-12">è‡ªå®šä¹‰ç‰¹æ€§</h3>
<ul>
<li>
<p>å®šä¹‰ï¼šç»§æ‰¿ <code>Attribute</code></p>
</li>
<li>
<p>é™åˆ¶ä½œç”¨ç›®æ ‡ï¼šä½¿ç”¨ <code>[AttributeUsage]</code></p>
</li>
<li>
<p>è¯»å–ï¼šé€šè¿‡åå°„è·å– <code>MemberInfo.GetCustomAttributes&lt;T&gt;()</code></p>
</li>
</ul>
<pre><code class="hljs language-csharp" lang="csharp">[<span class="hljs-meta">AttributeUsage(AttributeTargets.Method, AllowMultiple = true)</span>]
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">AuditAttribute</span> : <span class="hljs-title">Attribute</span>
{
    <span class="hljs-keyword">public</span> <span class="hljs-built_in">string</span> Operation { <span class="hljs-keyword">get</span>; }
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">AuditAttribute</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> operation</span>)</span> =&gt; Operation = operation;
}

<span class="hljs-comment">// åœ¨æ–¹æ³•ä¸Šä½¿ç”¨</span>
[<span class="hljs-meta">Audit(<span class="hljs-string">"Create"</span>), Audit(<span class="hljs-string">"Validate"</span>)</span>]
<span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateUser</span>()</span> { â€¦ }
</code></pre>
<h3 data-id="heading-13">ä¼˜ç¼ºç‚¹</h3>
<p>ä¼˜ç‚¹</p>
<ul>
<li>
<p>å£°æ˜å¼ç¼–ç¨‹ï¼šç®€åŒ–é…ç½®ï¼Œä»£ç æ›´æ¸…æ™°ã€‚</p>
</li>
<li>
<p>æ¡†æ¶é›†æˆï¼šä¸ <code>ASP.NET Core</code>ã€<code>EF Core</code> ç­‰æ— ç¼åä½œã€‚</p>
</li>
<li>
<p>å¯æ‰©å±•æ€§ï¼šæ”¯æŒè‡ªå®šä¹‰ç‰¹æ€§ï¼Œæ‰©å±•åŠŸèƒ½ã€‚</p>
</li>
<li>
<p>è·¨åœºæ™¯æ”¯æŒï¼šé€‚ç”¨ <code>Web</code>ã€æ•°æ®åº“ã€æµ‹è¯•ç­‰ã€‚</p>
</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>
<p>åå°„æ€§èƒ½ï¼šè‡ªå®šä¹‰ç‰¹æ€§ä½¿ç”¨åå°„å¯èƒ½å½±å“æ€§èƒ½ã€‚</p>
</li>
<li>
<p>é…ç½®å¤æ‚ï¼šå¤§é‡ç‰¹æ€§å¯èƒ½å¯¼è‡´ä»£ç éš¾ä»¥ç»´æŠ¤ã€‚</p>
</li>
<li>
<p>è°ƒè¯•éš¾åº¦ï¼šç‰¹æ€§è¡Œä¸ºéœ€é€šè¿‡åå°„æˆ–æ—¥å¿—è°ƒè¯•ã€‚</p>
</li>
<li>
<p>ä¾èµ–æ¡†æ¶ï¼šéƒ¨åˆ†ç‰¹æ€§ï¼ˆå¦‚ <code>[Route]</code>ï¼‰ç‰¹å®šäºæ¡†æ¶ã€‚</p>
</li>
</ul>
<h3 data-id="heading-14">ä½¿ç”¨åœºæ™¯</h3>
<ul>
<li>
<p><code>Web API</code>ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Route]ã€[HttpGet]</code> ç­‰å®šä¹‰ <code>RESTful</code> ç«¯ç‚¹ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šç”¨æˆ·ç®¡ç† <code>API</code>ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ•°æ®åº“æ˜ å°„ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Key]ã€[Required]</code> é…ç½® <code>EF Core</code> æ¨¡å‹ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šæ‰¹æ¬¡è¡¨å¤´å’Œæ˜ç»†è¡¨ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ¨¡å‹éªŒè¯ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Required]ã€[StringLength]</code> éªŒè¯è¾“å…¥ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šå¯¼å…¥æ•°æ®éªŒè¯ã€‚</p>
</li>
</ul>
</li>
<li>
<p>å®‰å…¨æ§åˆ¶ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Authorize]ã€[ValidateAntiForgeryToken]</code> ä¿æŠ¤ç«¯ç‚¹ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šç®¡ç†å‘˜å¯¼å…¥æ¥å£ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æ—¥å¿—å’Œç›‘æ§ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨è‡ªå®šä¹‰ç‰¹æ€§ï¼ˆå¦‚ <code>[LogExecutionTime]</code>ï¼‰è®°å½•æ€§èƒ½ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šç›‘æ§å¯¼å…¥æ—¶é—´ã€‚</p>
</li>
</ul>
</li>
<li>
<p>æµ‹è¯•ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ <code>[Test]ã€[Fact]</code> ç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p>
</li>
<li>
<p>ç¤ºä¾‹ï¼šæµ‹è¯•å¯¼å…¥é€»è¾‘ã€‚</p>
</li>
</ul>
</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æŸå¤šå¤šé¢è¯•ç›¸å…³æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥]]></title>    <link>https://juejin.cn/post/7570923924365295679</link>    <guid>https://juejin.cn/post/7570923924365295679</guid>    <pubDate>2025-11-11T00:41:51.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924365295679" data-draft-id="7570897638440845339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æŸå¤šå¤šé¢è¯•ç›¸å…³æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥"/> <meta itemprop="keywords" content="åç«¯,é¢è¯•,æ¶æ„"/> <meta itemprop="datePublished" content="2025-11-11T00:41:51.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="360_go_php"/> <meta itemprop="url" content="https://juejin.cn/user/2436173498956695"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æŸå¤šå¤šé¢è¯•ç›¸å…³æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436173498956695/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    360_go_php
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:41:51.000Z" title="Tue Nov 11 2025 00:41:51 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€‹</p>
<p>åœ¨ç”µå•†å¹³å°å¦‚æŸå¤šå¤šçš„ç³»ç»Ÿæ¶æ„ä¸­ï¼Œæ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—å’Œ Linux å†…å­˜å›æ”¶ç­‰æŠ€æœ¯æ˜¯ä¿è¯ç³»ç»Ÿé«˜æ•ˆè¿è¡Œçš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æœ¬æ–‡å°†å›´ç»•è¿™äº›æŠ€æœ¯çŸ¥è¯†ç‚¹è¿›è¡Œæ€»ç»“ï¼Œå¹¶å›ç­”ç›¸å…³çš„é¢è¯•é—®é¢˜ã€‚</p>
<hr/>
<h4 data-id="heading-0"><strong>æ“ä½œç³»ç»Ÿç›¸å…³é—®é¢˜</strong></h4>
<h5 data-id="heading-1">1. <strong>çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f5bc64531c0a45229962d0bfc86f3e59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=DyhFK7PHcGGIEl4meDbQkK9GBbY%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h5>
<ul>
<li>
<p><strong>è¿›ç¨‹</strong>ï¼š<br/>
- æ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4ffa30b9c6014675ac295880a6081bd8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=rvG5vMRUZruKT5gxzzC8tOsZaH4%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘<br/>
- æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€ä»£ç ã€æ•°æ®å’Œç³»ç»Ÿèµ„æºï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c13a19efe99f41ce91204d8e61b44eeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=MyE7UrhlcgyD2vjA9xgaDBjJkKE%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘<br/>
- è¿›ç¨‹é—´çš„é€šä¿¡é€šå¸¸éœ€è¦é€šè¿‡ IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰æœºåˆ¶ï¼ˆå¦‚ç®¡é“ã€å…±äº«å†…å­˜ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼‰è¿›è¡Œã€‚</p>
</li>
<li>
<p><strong>çº¿ç¨‹</strong>ï¼š<br/>
- æ˜¯è¿›ç¨‹ä¸­çš„æ‰§è¡Œå•å…ƒï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€å †æ ˆç­‰èµ„æºã€‚<br/>
- çº¿ç¨‹é—´çš„é€šä¿¡æ¯”è¿›ç¨‹é—´é€šä¿¡æ›´é«˜æ•ˆï¼Œå› ä¸ºå®ƒä»¬å…±äº«åŒä¸€å†…å­˜ç©ºé—´ï¼Œä½†ä¹Ÿæ›´å®¹æ˜“å¼•å‘ç«äº‰æ¡ä»¶å’Œæ­»é”ã€‚<br/>
- çº¿ç¨‹é€šå¸¸ç”¨äºå¹¶å‘æ‰§è¡Œï¼Œå¯ä»¥æé«˜ç¨‹åºçš„å¹¶è¡Œåº¦ï¼Œç‰¹åˆ«é€‚ç”¨äº CPU å¯†é›†å‹æˆ– IO å¯†é›†å‹ä»»åŠ¡ã€‚</p>
</li>
</ul>
<p><strong>åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>èµ„æºéš”ç¦»</strong>ï¼šè¿›ç¨‹ä¹‹é—´å®Œå…¨ç‹¬ç«‹ï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«åŒä¸€è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/546c2cac483040a3a54f10d923568fef~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=p0Y2FypNP%2FJoGD98ErMe8WslaqE%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</li>
<li><strong>åˆ›å»ºå’Œé”€æ¯</strong>ï¼šè¿›ç¨‹çš„åˆ›å»ºå’Œé”€æ¯æ¯”çº¿ç¨‹æ›´åŠ è€—è´¹èµ„æºï¼Œå› ä¸ºè¿›ç¨‹éœ€è¦åˆ†é…ç‹¬ç«‹çš„èµ„æºï¼›çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯å¼€é”€è¾ƒå°ã€‚</li>
<li><strong>é€šä¿¡æ–¹å¼</strong>ï¼šè¿›ç¨‹é—´é€šä¿¡è¾ƒä¸ºå¤æ‚ï¼Œéœ€è¦é€šè¿‡ IPCï¼›çº¿ç¨‹é—´é€šä¿¡ç›¸å¯¹ç®€å•ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å…±äº«å†…å­˜æˆ–å…¶ä»–åŒæ­¥æœºåˆ¶è¿›è¡Œã€‚</li>
</ul>
<h5 data-id="heading-2">2. <strong>åˆ†æ®µå’Œåˆ†é¡µå†…å­˜ç®¡ç†</strong><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7dc80da6dc9e4c71a285b040fff574e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgMzYwX2dvX3BocA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763426510&amp;x-signature=AOsr3x6UHhgFOPIYgHiiqX5NtVw%3D" alt="" loading="lazy"/><img src="" alt="" title="ç‚¹å‡»å¹¶æ‹–æ‹½ä»¥ç§»åŠ¨" loading="lazy"/>â€‹ç¼–è¾‘</h5>
<ul>
<li><strong>åˆ†æ®µç®¡ç†</strong>ï¼šå°†ç¨‹åºçš„å†…å­˜åˆ’åˆ†ä¸ºä¸åŒå¤§å°çš„æ®µï¼Œå¦‚ä»£ç æ®µã€æ•°æ®æ®µã€å †æ ˆæ®µç­‰ï¼Œæ¯ä¸ªæ®µéƒ½æœ‰è‡ªå·±çš„åŸºåœ°å€å’Œé•¿åº¦ã€‚åˆ†æ®µæä¾›äº†æ›´ä¸ºçµæ´»çš„å†…å­˜ç®¡ç†ï¼Œé€‚ç”¨äºåŠ¨æ€å˜åŒ–çš„ç¨‹åºã€‚<br/>
</li>
<li><strong>åˆ†é¡µç®¡ç†</strong>ï¼šå°†ç‰©ç†å†…å­˜å’Œé€»è¾‘å†…å­˜éƒ½åˆ†æˆå›ºå®šå¤§å°çš„å—ï¼ˆé¡µå’Œé¡µæ¡†ï¼‰ã€‚åˆ†é¡µæ¶ˆé™¤äº†å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä½¿å¾—å†…å­˜çš„ç®¡ç†æ›´åŠ é«˜æ•ˆã€‚æ¯ä¸ªè¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„é¡µè¡¨æ¥æ˜ å°„è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€ã€‚</li>
</ul>
<p><strong>åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>çµæ´»æ€§</strong>ï¼šåˆ†æ®µç®¡ç†å¯ä»¥å¤„ç†ä¸åŒå¤§å°çš„å†…å­˜å—ï¼Œè€Œåˆ†é¡µç®¡ç†åˆ™ä½¿ç”¨å›ºå®šå¤§å°çš„å†…å­˜å—ã€‚</li>
<li><strong>å†…å­˜ç¢ç‰‡</strong>ï¼šåˆ†é¡µç®¡ç†å¯ä»¥é¿å…å¤–éƒ¨ç¢ç‰‡ï¼Œä½†å¯èƒ½å­˜åœ¨å†…éƒ¨ç¢ç‰‡ï¼›åˆ†æ®µç®¡ç†åˆ™å¯ä»¥çµæ´»åœ°é¿å…å†…éƒ¨ç¢ç‰‡ï¼Œä½†å¯èƒ½å­˜åœ¨å¤–éƒ¨ç¢ç‰‡ã€‚</li>
</ul>
<h5 data-id="heading-3">3. <strong>ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åŒºåˆ«</strong></h5>
<ul>
<li><strong>ç”¨æˆ·æ€</strong>ï¼šæŒ‡ç¨‹åºè¿è¡Œæ—¶ï¼Œç”¨æˆ·åº”ç”¨ç¨‹åºæ‰§è¡Œçš„çŠ¶æ€ã€‚åœ¨ç”¨æˆ·æ€ä¸‹ï¼Œç¨‹åºæ— æ³•ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºå’Œæ ¸å¿ƒæ“ä½œç³»ç»ŸåŠŸèƒ½ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è¯·æ±‚å†…æ ¸æœåŠ¡ã€‚<br/>
</li>
<li><strong>å†…æ ¸æ€</strong>ï¼šæŒ‡æ“ä½œç³»ç»Ÿæ ¸å¿ƒéƒ¨åˆ†æ‰§è¡Œçš„çŠ¶æ€ï¼Œå…·æœ‰å®Œå…¨çš„æ§åˆ¶æƒé™ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ç¡¬ä»¶èµ„æºå’Œç®¡ç†ç³»ç»Ÿèµ„æºã€‚å†…æ ¸æ€è¿è¡Œæ—¶ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æ‰§è¡Œæ¶‰åŠç¡¬ä»¶æ“ä½œå’Œèµ„æºç®¡ç†çš„ä»»åŠ¡ã€‚</li>
</ul>
<p><strong>åŒºåˆ«</strong>ï¼š</p>
<ul>
<li><strong>æƒé™</strong>ï¼šç”¨æˆ·æ€æƒé™æœ‰é™ï¼Œå†…æ ¸æ€æƒé™æ›´é«˜ï¼Œå¯ä»¥ç›´æ¥æ“ä½œç¡¬ä»¶èµ„æºã€‚</li>
<li><strong>åˆ‡æ¢æˆæœ¬</strong>ï¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€éœ€è¦è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¼€é”€è¾ƒå¤§ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-4"><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong></h4>
<h5 data-id="heading-5">1. <strong>å¦‚ä½•è®¾è®¡ä¸€ä¸ªäºŒé˜¶æ®µæäº¤ï¼ˆ2PCï¼‰åè®®</strong></h5>
<p>äºŒé˜¶æ®µæäº¤ï¼ˆ2PCï¼‰åè®®ç”¨äºè§£å†³åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„äº‹åŠ¡ä¸€è‡´æ€§é—®é¢˜ã€‚å®ƒçš„åŸºæœ¬æµç¨‹åŒ…æ‹¬ä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>
<p><strong>é˜¶æ®µä¸€ï¼šå‡†å¤‡é˜¶æ®µï¼ˆPrepare Phaseï¼‰</strong>ï¼š<br/>
- ä¸»åè°ƒè€…ï¼ˆé€šå¸¸æ˜¯äº‹åŠ¡åè°ƒå™¨ï¼‰å‘æ‰€æœ‰å‚ä¸è€…å‘é€æäº¤è¯·æ±‚ï¼Œå¹¶ç­‰å¾…å„ä¸ªå‚ä¸è€…çš„å“åº”ã€‚<br/>
- æ¯ä¸ªå‚ä¸è€…åˆ¤æ–­æ˜¯å¦èƒ½å¤Ÿæäº¤äº‹åŠ¡ï¼ˆå¦‚æ£€æŸ¥æœ¬åœ°äº‹åŠ¡çš„æ‰§è¡Œæƒ…å†µã€é”èµ„æºç­‰ï¼‰ï¼Œç„¶åå‘é€ "å‡†å¤‡æäº¤" æˆ– "æ‹’ç»" ç»™åè°ƒè€…ã€‚</p>
</li>
<li>
<p><strong>é˜¶æ®µäºŒï¼šæäº¤é˜¶æ®µï¼ˆCommit Phaseï¼‰</strong>ï¼š<br/>
- å¦‚æœæ‰€æœ‰å‚ä¸è€…éƒ½è¿”å› "å‡†å¤‡æäº¤"ï¼Œåè°ƒè€…ä¼šå‘é€ "æäº¤" å‘½ä»¤ï¼Œå‚ä¸è€…æ­£å¼æäº¤äº‹åŠ¡ã€‚<br/>
- å¦‚æœä»»ä½•ä¸€ä¸ªå‚ä¸è€…è¿”å› "æ‹’ç»" æˆ–è€…åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å‡ºç°æ•…éšœï¼Œåè°ƒè€…ä¼šå‘é€ "å›æ»š" å‘½ä»¤ï¼Œæ‰€æœ‰å‚ä¸è€…å›æ»šäº‹åŠ¡ã€‚</p>
</li>
</ul>
<p><strong>è®¾è®¡å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šå¿…é¡»ç¡®ä¿æ‰€æœ‰å‚ä¸è€…ä¸€è‡´åŒæ„æäº¤æˆ–å›æ»šï¼Œä¿è¯äº‹åŠ¡çš„åŸå­æ€§ã€‚</li>
<li><strong>å®¹é”™</strong>ï¼šå¿…é¡»è€ƒè™‘ç½‘ç»œæ•…éšœã€èŠ‚ç‚¹å´©æºƒç­‰å¼‚å¸¸æƒ…å†µï¼Œç¡®ä¿åœ¨ç³»ç»Ÿæ¢å¤åèƒ½å¤Ÿç»§ç»­å®Œæˆäº‹åŠ¡ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-6"><strong>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰</strong></h4>
<h5 data-id="heading-7">1. <strong>æ¶ˆæ¯é˜Ÿåˆ—æœ‰ä»€ä¹ˆå¥½å¤„</strong></h5>
<p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ˜¯ç”¨äºä¸åŒç³»ç»Ÿæˆ–åº”ç”¨ä¹‹é—´ä¼ é€’æ¶ˆæ¯çš„ä¸€ç§å¼‚æ­¥é€šä¿¡æ–¹å¼ã€‚å…¶ä¸»è¦ä¼˜ç‚¹åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>è§£è€¦</strong>ï¼šç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¸éœ€è¦ç›´æ¥é€šä¿¡ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œä¸­ä»‹ï¼Œç³»ç»Ÿä¹‹é—´æ¾è€¦åˆï¼Œä¾¿äºæ‰©å±•å’Œç»´æŠ¤ã€‚</li>
<li><strong>å¼‚æ­¥å¤„ç†</strong>ï¼šæ¶ˆè´¹è€…å¯ä»¥å¼‚æ­¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œç”Ÿäº§è€…ä¸éœ€è¦ç­‰å¾…æ¶ˆè´¹è€…çš„å¤„ç†ç»“æœï¼Œä»è€Œæé«˜ç³»ç»Ÿçš„ååé‡ã€‚</li>
<li><strong>æµé‡å‰Šå³°</strong>ï¼šåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥å¹³æ»‘æµé‡æ³¢åŠ¨ï¼Œé˜²æ­¢ç³»ç»Ÿè¿‡è½½ã€‚</li>
<li><strong>å¯é æ€§ä¿éšœ</strong>ï¼šé€šè¿‡æ¶ˆæ¯æŒä¹…åŒ–æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯åœ¨ç½‘ç»œå¼‚å¸¸æˆ–ç³»ç»Ÿå´©æºƒæ—¶ä¸ä¸¢å¤±ã€‚</li>
</ul>
<hr/>
<h4 data-id="heading-8"><strong>Linux å†…å­˜å›æ”¶ç­–ç•¥</strong></h4>
<h5 data-id="heading-9">1. <strong>Linux å†…å­˜å›æ”¶ç­–ç•¥</strong></h5>
<p>Linux ä½¿ç”¨çš„å†…å­˜å›æ”¶ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ul>
<li>
<p><strong>è™šæ‹Ÿå†…å­˜ç®¡ç†</strong>ï¼šLinux ä¼šå°†ä¸€éƒ¨åˆ†å†…å­˜æ ‡è®°ä¸ºè™šæ‹Ÿå†…å­˜ï¼Œå¹¶å°†ä¸å¸¸ç”¨çš„æ•°æ®æˆ–é¡µé¢äº¤æ¢åˆ°ç£ç›˜ï¼ˆäº¤æ¢ç©ºé—´ï¼‰ï¼Œä»¥é‡Šæ”¾ç‰©ç†å†…å­˜ã€‚<br/>
</p>
</li>
<li>
<p><strong>é¡µé¢å›æ”¶ï¼ˆPage Reclaimingï¼‰</strong>ï¼šå½“ç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶ï¼ŒLinux ä¼šé€‰æ‹©å›æ”¶ä¸æ´»è·ƒçš„é¡µé¢ï¼Œå¦‚æ¸…ç†æ–‡ä»¶ç¼“å­˜ã€å›æ”¶æœªä½¿ç”¨çš„å†…å­˜é¡µç­‰ã€‚</p>
</li>
<li>
<p><strong>å†…å­˜å‹ç¼©ï¼ˆZswapã€Zramï¼‰</strong>ï¼šé€šè¿‡å†…å­˜å‹ç¼©æŠ€æœ¯ï¼Œå°†æ•°æ®å‹ç¼©å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä»è€Œå»¶ç¼“æˆ–å‡å°‘ç£ç›˜äº¤æ¢çš„éœ€è¦ã€‚</p>
</li>
<li>
<p><strong>OOM Killer</strong>ï¼šå½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼Œå†…æ ¸ä¼šé€šè¿‡ OOMï¼ˆOut Of Memoryï¼‰æ€æ‰‹ç»“æŸæŸäº›è¿›ç¨‹ä»¥é‡Šæ”¾å†…å­˜ï¼Œé€šå¸¸ä¼šä¼˜å…ˆæ€æ­»å ç”¨å†…å­˜è¾ƒå¤§çš„è¿›ç¨‹ã€‚</p>
</li>
</ul>
<hr/>
<h3 data-id="heading-10">æ€»ç»“</h3>
<p>æœ¬æ–‡å›ç­”äº†åœ¨æŸå¤šå¤šé¢è¯•ä¸­å¯èƒ½é‡åˆ°çš„æ“ä½œç³»ç»Ÿã€åˆ†å¸ƒå¼äº‹åŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—ä»¥åŠ Linux å†…å­˜å›æ”¶ç­–ç•¥çš„ç›¸å…³é—®é¢˜ã€‚æŒæ¡è¿™äº›æŠ€æœ¯åŸç†ä¸ä»…æœ‰åŠ©äºé€šè¿‡é¢è¯•ï¼Œè¿˜èƒ½ä¸ºåç»­çš„å·¥ä½œå¥ å®šåšå®çš„åŸºç¡€ã€‚</p>
<p>â€‹</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ116ï¼‰Redisçš„å†…å­˜ç®¡ç†å¦‚ä½•å®ç°ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7570984341414182927</link>    <guid>https://juejin.cn/post/7570984341414182927</guid>    <pubDate>2025-11-10T23:06:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570984341414182927" data-draft-id="7570984341414166543" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ116ï¼‰Redisçš„å†…å­˜ç®¡ç†å¦‚ä½•å®ç°ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T23:06:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ116ï¼‰Redisçš„å†…å­˜ç®¡ç†å¦‚ä½•å®ç°ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:06:41.000Z" title="Mon Nov 10 2025 23:06:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Redis çš„å†…å­˜ç®¡ç†æ¶‰åŠå¤šä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å†…å­˜åˆ†é…ç­–ç•¥ã€æ•°æ®å‹ç¼©ã€æŒä¹…åŒ–ã€å†…å­˜æ¸…ç†ç­–ç•¥ç­‰ã€‚é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨ Redisï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†å’Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œä»è€Œæå‡ Redis çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ä»¥ä¸‹æ˜¯ Redis å†…å­˜ç®¡ç†çš„è¯¦ç»†è®²è§£ï¼Œå¹¶ç»“åˆå…·ä½“ä»£ç ç¤ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p>
<h3 data-id="heading-0">1. å†…å­˜åˆ†é…å™¨</h3>
<p>Redis é»˜è®¤ä½¿ç”¨ <code>jemalloc</code> ä½œä¸ºå†…å­˜åˆ†é…å™¨ï¼Œè¿™æ˜¯å› ä¸º <code>jemalloc</code> åœ¨å†…å­˜ç¢ç‰‡ç®¡ç†æ–¹é¢è¡¨ç°ä¼˜å¼‚ã€‚ä½ å¯ä»¥åœ¨ç¼–è¯‘ Redis æ—¶é€‰æ‹©ä½¿ç”¨ä¸åŒçš„å†…å­˜åˆ†é…å™¨ï¼Œä¾‹å¦‚ <code>libc</code> æˆ– <code>tcmalloc</code>ã€‚</p>
<h4 data-id="heading-1">æŸ¥çœ‹å½“å‰å†…å­˜åˆ†é…å™¨</h4>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ Redis ä½¿ç”¨çš„å†…å­˜åˆ†é…å™¨ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">redis-server --version
</code></pre>
<h3 data-id="heading-2">2. å†…å­˜é™åˆ¶</h3>
<p>Redis æä¾›äº† <code>maxmemory</code> é€‰é¡¹æ¥é™åˆ¶ Redis å®ä¾‹ä½¿ç”¨çš„æœ€å¤§å†…å­˜ã€‚è®¾ç½® <code>maxmemory</code> é€‰é¡¹å¯ä»¥æœ‰æ•ˆé˜²æ­¢ Redis å ç”¨è¿‡å¤šå†…å­˜ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">maxmemory 4gb
</code></pre>
<h3 data-id="heading-3">3. å†…å­˜æ¸…ç†ç­–ç•¥</h3>
<p>å½“å†…å­˜ä½¿ç”¨è¾¾åˆ° <code>maxmemory</code> é™åˆ¶æ—¶ï¼ŒRedis å¯ä»¥æ ¹æ®é…ç½®çš„å†…å­˜æ¸…ç†ç­–ç•¥æ¥ç§»é™¤ä¸€äº›é”®ä»¥é‡Šæ”¾å†…å­˜ã€‚å¸¸è§çš„å†…å­˜æ¸…ç†ç­–ç•¥åŒ…æ‹¬ï¼š</p>
<ul>
<li><code>volatile-lru</code>ï¼šç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆä»…é™äºè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼‰ã€‚</li>
<li><code>allkeys-lru</code>ï¼šç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é”®ï¼ˆé€‚ç”¨äºæ‰€æœ‰é”®ï¼‰ã€‚</li>
<li><code>volatile-random</code>ï¼šéšæœºç§»é™¤ä¸€äº›é”®ï¼ˆä»…é™äºè®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®ï¼‰ã€‚</li>
<li><code>allkeys-random</code>ï¼šéšæœºç§»é™¤ä¸€äº›é”®ï¼ˆé€‚ç”¨äºæ‰€æœ‰é”®ï¼‰ã€‚</li>
<li><code>volatile-ttl</code>ï¼šç§»é™¤ä¸€äº›å°†è¦è¿‡æœŸçš„é”®ã€‚</li>
<li><code>noeviction</code>ï¼šä¸ç§»é™¤ä»»ä½•é”®ï¼Œå½“å†…å­˜ä¸è¶³æ—¶è¿”å›é”™è¯¯ã€‚</li>
</ul>
<pre><code class="hljs language-conf" lang="conf">maxmemory-policy allkeys-lru
</code></pre>
<h3 data-id="heading-4">4. æ•°æ®å‹ç¼©</h3>
<p>Redis æä¾›äº† <code>hash-max-ziplist-entries</code> å’Œ <code>hash-max-ziplist-value</code> å‚æ•°ï¼Œç”¨äºåœ¨å­˜å‚¨å°å“ˆå¸Œå¯¹è±¡æ—¶ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚è¿™äº›å‚æ•°æŒ‡å®šäº†ä½•æ—¶å°†å“ˆå¸Œå¯¹è±¡è½¬æ¢ä¸º ziplist æ ¼å¼å­˜å‚¨ï¼Œä»¥å‡å°‘å†…å­˜å ç”¨ã€‚</p>
<pre><code class="hljs language-conf" lang="conf">hash-max-ziplist-entries 512
hash-max-ziplist-value 64
</code></pre>
<h3 data-id="heading-5">5. å†…å­˜ç»Ÿè®¡</h3>
<p>Redis æä¾›äº†å¤šç§å‘½ä»¤æ¥æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ä½¿ç”¨ä¿¡æ¯</span>
redis-cli info memory

<span class="hljs-comment"># æŸ¥çœ‹æŸä¸ªé”®çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</span>
redis-cli memory usage key_name
</code></pre>
<h3 data-id="heading-6">6. æŒä¹…åŒ–é…ç½®</h3>
<p>Redis æä¾›äº† RDB å’Œ AOF ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚åˆç†é…ç½®æŒä¹…åŒ–ï¼Œå¯ä»¥å¹³è¡¡æ€§èƒ½å’Œæ•°æ®å®‰å…¨ã€‚</p>
<h4 data-id="heading-7">RDB æŒä¹…åŒ–</h4>
<p>RDB æŒä¹…åŒ–å¯ä»¥é€šè¿‡é…ç½® <code>save</code> é€‰é¡¹æ¥æ§åˆ¶è‡ªåŠ¨ä¿å­˜å¿«ç…§çš„é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">save 900 1
save 300 10
save 60 10000
</code></pre>
<h4 data-id="heading-8">AOF æŒä¹…åŒ–</h4>
<p>AOF æŒä¹…åŒ–å¯ä»¥é€šè¿‡é…ç½® <code>appendonly</code> å’Œ <code>appendfsync</code> é€‰é¡¹æ¥æ§åˆ¶å†™å…¥æ—¥å¿—çš„é¢‘ç‡ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">appendonly yes
appendfsync everysec
</code></pre>
<h3 data-id="heading-9">7. å†…å­˜ä¼˜åŒ–</h3>
<h4 data-id="heading-10">ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„</h4>
<p>é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„å¯ä»¥æ˜¾è‘—ä¼˜åŒ–å†…å­˜ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li>å¯¹äºè®¡æ•°å™¨ä½¿ç”¨ <code>INCR</code> æˆ– <code>DECR</code>ã€‚</li>
<li>å¯¹äºå°é›†åˆä½¿ç”¨ <code>HASH</code>ã€‚</li>
<li>å¯¹äºæœ‰åºé›†åˆä½¿ç”¨ <code>ZSET</code>ã€‚</li>
</ul>
<h4 data-id="heading-11">ä½¿ç”¨åˆç†çš„é”®å’Œå€¼</h4>
<p>é¿å…ä½¿ç”¨è¿‡é•¿çš„é”®åå’Œå€¼ï¼Œå¯ä»¥æ˜¾è‘—å‡å°‘å†…å­˜ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Java Jedis ç¤ºä¾‹</span>
jedis.set(<span class="hljs-string">"k1"</span>, <span class="hljs-string">"v1"</span>);
</code></pre>
<h3 data-id="heading-12">8. å†…å­˜ç¢ç‰‡ç®¡ç†</h3>
<p>å†…å­˜ç¢ç‰‡å¯èƒ½å¯¼è‡´ Redis å®é™…å†…å­˜ä½¿ç”¨è¶…è¿‡é¢„æœŸã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥åˆ†æå’Œä¼˜åŒ–å†…å­˜ç¢ç‰‡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŸ¥çœ‹å†…å­˜ç¢ç‰‡ç‡</span>
redis-cli info memory | grep fragmentation_ratio

<span class="hljs-comment"># è§¦å‘æ‰‹åŠ¨åƒåœ¾å›æ”¶</span>
redis-cli memory purge
</code></pre>
<h3 data-id="heading-13">9. å†…å­˜ç›‘æ§ä¸æŠ¥è­¦</h3>
<p>ä½¿ç”¨ Redis è‡ªå¸¦çš„ç›‘æ§å·¥å…·å’Œå¤–éƒ¨ç›‘æ§å·¥å…·ï¼ˆå¦‚ Prometheus + Grafanaï¼‰æ¥ç›‘æ§ Redis å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå¹¶é…ç½®æŠ¥è­¦æœºåˆ¶ã€‚</p>
<h3 data-id="heading-14">10. ä»£ç ç¤ºä¾‹</h3>
<p>ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„å†…å­˜ç®¡ç†ç›¸å…³ä»£ç ç¤ºä¾‹ï¼š</p>
<h4 data-id="heading-15">è®¾ç½®é”®å’Œè¿‡æœŸæ—¶é—´</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisMemoryManagement</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-comment">// è®¾ç½®é”®å’Œå€¼</span>
            jedis.set(<span class="hljs-string">"key1"</span>, <span class="hljs-string">"value1"</span>);

            <span class="hljs-comment">// è®¾ç½®é”®çš„è¿‡æœŸæ—¶é—´</span>
            jedis.setex(<span class="hljs-string">"key2"</span>, <span class="hljs-number">3600</span>, <span class="hljs-string">"value2"</span>); <span class="hljs-comment">// 1å°æ—¶åè¿‡æœŸ</span>

            <span class="hljs-comment">// è·å–é”®çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</span>
            <span class="hljs-type">Long</span> <span class="hljs-variable">memoryUsage</span> <span class="hljs-operator">=</span> jedis.memoryUsage(<span class="hljs-string">"key1"</span>);
            System.out.println(<span class="hljs-string">"Memory usage of key1: "</span> + memoryUsage);
        }
    }
}
</code></pre>
<h4 data-id="heading-16">é…ç½®æŒä¹…åŒ–</h4>
<pre><code class="hljs language-conf" lang="conf"># redis.conf
save 900 1
save 300 10
save 60 10000

appendonly yes
appendfsync everysec
</code></pre>
<h3 data-id="heading-17">11. å…¶ä»–å†…å­˜ç®¡ç†ç­–ç•¥</h3>
<h4 data-id="heading-18">Lazy Freeingï¼ˆæƒ°æ€§åˆ é™¤ï¼‰</h4>
<p>åœ¨åˆ é™¤å¤§å‹é”®æˆ–é‡Šæ”¾å¤§å¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ Redis çš„æƒ°æ€§åˆ é™¤ç‰¹æ€§ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼š</p>
<pre><code class="hljs language-conf" lang="conf">lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes
</code></pre>
<h4 data-id="heading-19">å†…å­˜ä¼˜åŒ–å‚è€ƒé…ç½®</h4>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç»¼åˆçš„ Redis å†…å­˜ç®¡ç†é…ç½®ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-conf" lang="conf"># redis.conf

# å†…å­˜åˆ†é…å™¨
malloc-lib /usr/lib/libjemalloc.so

# æœ€å¤§å†…å­˜é™åˆ¶
maxmemory 4gb
maxmemory-policy allkeys-lru

# æ•°æ®å‹ç¼©
hash-max-ziplist-entries 512
hash-max-ziplist-value 64

# å†…å­˜æ¸…ç†ç­–ç•¥
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

# æŒä¹…åŒ–é…ç½®
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec

# ç½‘ç»œé…ç½®
tcp-keepalive 60

# æœ€å¤§å®¢æˆ·ç«¯è¿æ¥æ•°
maxclients 20000
</code></pre>
<h3 data-id="heading-20">æ€»ç»“</h3>
<p>Redis çš„å†…å­˜ç®¡ç†æ¶‰åŠå¤šä¸ªæ–¹é¢ï¼ŒåŒ…æ‹¬å†…å­˜åˆ†é…ã€å†…å­˜é™åˆ¶ã€å†…å­˜æ¸…ç†ç­–ç•¥ã€æ•°æ®å‹ç¼©ã€å†…å­˜ç¢ç‰‡ç®¡ç†ã€æŒä¹…åŒ–é…ç½®ã€åˆç†é€‰æ‹©æ•°æ®ç»“æ„å’Œé”®å€¼ã€æƒ°æ€§åˆ é™¤ç­‰ã€‚é€šè¿‡åˆç†é…ç½®å’Œä½¿ç”¨ Redisï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†å’Œä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼Œä»è€Œæå‡ Redis çš„æ€§èƒ½å’Œç¨³å®šæ€§ã€‚ç»“åˆä¸Šè¿°æ–¹æ³•å’Œé…ç½®ç¤ºä¾‹ï¼Œå¯ä»¥å¸®åŠ©ä½ åœ¨å®é™…åº”ç”¨ä¸­æ›´å¥½åœ°ç®¡ç† Redis å†…å­˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Redisï¼ˆ117ï¼‰Redisçš„åˆ†å¸ƒå¼é”å¦‚ä½•ä½¿ç”¨ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7570940025581371432</link>    <guid>https://juejin.cn/post/7570940025581371432</guid>    <pubDate>2025-11-10T23:07:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570940025581371432" data-draft-id="7570984341414199311" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Redisï¼ˆ117ï¼‰Redisçš„åˆ†å¸ƒå¼é”å¦‚ä½•ä½¿ç”¨ï¼Ÿ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T23:07:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Victor356"/> <meta itemprop="url" content="https://juejin.cn/user/3492507879476878"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Redisï¼ˆ117ï¼‰Redisçš„åˆ†å¸ƒå¼é”å¦‚ä½•ä½¿ç”¨ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3492507879476878/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Victor356
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:07:42.000Z" title="Mon Nov 10 2025 23:07:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œåˆ†å¸ƒå¼é”æ˜¯ä¸€ç§å…³é”®çš„å·¥å…·ï¼Œç”¨äºç¡®ä¿å¤šä¸ªè¿›ç¨‹åœ¨ä¸åŒæœºå™¨ä¸Šèƒ½å¤Ÿå®‰å…¨åœ°è®¿é—®å…±äº«èµ„æºã€‚Redis æä¾›äº†ä¸€ç§ç®€å•ä¸”é«˜æ•ˆçš„æ–¹å¼æ¥å®ç°åˆ†å¸ƒå¼é”ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•ä½¿ç”¨ Redis å®ç°åˆ†å¸ƒå¼é”çš„è¯¦ç»†ä»‹ç»å’Œä»£ç ç¤ºä¾‹ã€‚</p>
<h3 data-id="heading-0">1. åˆ†å¸ƒå¼é”çš„åŸºæœ¬åŸç†</h3>
<p>Redis åˆ†å¸ƒå¼é”çš„åŸºæœ¬åŸç†æ˜¯ä½¿ç”¨ Redis çš„ <code>SET</code> å‘½ä»¤æ¥å°è¯•è®¾ç½®ä¸€ä¸ªé”®ï¼Œå¦‚æœè¯¥é”®ä¸å­˜åœ¨ï¼Œåˆ™è¡¨ç¤ºè·å–é”æˆåŠŸã€‚ä¸ºäº†é˜²æ­¢æ­»é”ï¼Œéœ€è¦ä¸ºé”è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p>
<h3 data-id="heading-1">2. ä½¿ç”¨ Jedis å®ç° Redis åˆ†å¸ƒå¼é”</h3>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Jedis å®¢æˆ·ç«¯åœ¨ Java ä¸­å®ç° Redis åˆ†å¸ƒå¼é”çš„å®Œæ•´ç¤ºä¾‹ã€‚</p>
<h4 data-id="heading-2">ä¾èµ–æ·»åŠ </h4>
<p>åœ¨ä½ çš„ Maven é¡¹ç›®ä¸­æ·»åŠ  Jedis ä¾èµ–ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>redis.clients<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jedis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.7.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<h4 data-id="heading-3">åˆ†å¸ƒå¼é”å®ç°ç±»</h4>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ Redis åˆ†å¸ƒå¼é”å®ç°ç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.params.SetParams;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisDistributedLock</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Jedis jedis;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> String lockKey;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> expireTime;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisDistributedLock</span><span class="hljs-params">(Jedis jedis, String lockKey, <span class="hljs-type">long</span> expireTime)</span> {
        <span class="hljs-built_in">this</span>.jedis = jedis;
        <span class="hljs-built_in">this</span>.lockKey = lockKey;
        <span class="hljs-built_in">this</span>.expireTime = expireTime;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String lockValue)</span> {
        <span class="hljs-type">SetParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetParams</span>().nx().px(expireTime);
        <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(lockKey, lockValue, params);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"OK"</span>.equals(result);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String lockValue)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
                        <span class="hljs-string">"return redis.call('del', KEYS[1]) "</span> +
                        <span class="hljs-string">"else return 0 end"</span>;
        <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.eval(script, <span class="hljs-number">1</span>, lockKey, lockValue);
        <span class="hljs-keyword">return</span> <span class="hljs-string">"1"</span>.equals(result.toString());
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Jedis</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>)) {
            <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"myLock"</span>;
            <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> <span class="hljs-string">"myUniqueValue"</span>;
            <span class="hljs-type">long</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>; <span class="hljs-comment">// 30 seconds</span>

            <span class="hljs-type">RedisDistributedLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisDistributedLock</span>(jedis, lockKey, expireTime);

            <span class="hljs-comment">// Acquire lock</span>
            <span class="hljs-keyword">if</span> (lock.acquireLock(lockValue)) {
                System.out.println(<span class="hljs-string">"Lock acquired!"</span>);

                <span class="hljs-comment">// Do your critical section work here</span>

                <span class="hljs-comment">// Release lock</span>
                <span class="hljs-keyword">if</span> (lock.releaseLock(lockValue)) {
                    System.out.println(<span class="hljs-string">"Lock released!"</span>);
                } <span class="hljs-keyword">else</span> {
                    System.out.println(<span class="hljs-string">"Failed to release lock!"</span>);
                }
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"Failed to acquire lock!"</span>);
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-4">3. è¯¦ç»†è§£é‡Š</h3>
<ul>
<li>
<p><strong>acquireLock æ–¹æ³•</strong>ï¼šè¯¥æ–¹æ³•å°è¯•è·å–é”ã€‚ä½¿ç”¨ <code>SET</code> å‘½ä»¤å’Œ <code>NX</code>ï¼ˆä»…å½“é”®ä¸å­˜åœ¨æ—¶è®¾ç½®ï¼‰å’Œ <code>PX</code>ï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰å‚æ•°æ¥ç¡®ä¿è®¾ç½®é”æ—¶çš„åŸå­æ€§ã€‚è¿”å› <code>true</code> è¡¨ç¤ºè·å–é”æˆåŠŸï¼Œè¿”å› <code>false</code> è¡¨ç¤ºè·å–é”å¤±è´¥ã€‚</p>
</li>
<li>
<p><strong>releaseLock æ–¹æ³•</strong>ï¼šè¯¥æ–¹æ³•é‡Šæ”¾é”ã€‚ä½¿ç”¨ Lua è„šæœ¬æ¥ç¡®ä¿é‡Šæ”¾é”çš„åŸå­æ€§ï¼Œç¡®ä¿åªæœ‰æŒæœ‰é”çš„å®¢æˆ·ç«¯æ‰èƒ½é‡Šæ”¾é”ã€‚Lua è„šæœ¬æ£€æŸ¥å½“å‰é”çš„å€¼æ˜¯å¦ä¸ä¼ å…¥çš„å€¼åŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™åˆ é™¤é”ã€‚</p>
</li>
</ul>
<h3 data-id="heading-5">4. æ³¨æ„äº‹é¡¹</h3>
<ol>
<li>
<p><strong>é”çš„è¿‡æœŸæ—¶é—´</strong>ï¼šç¡®ä¿é”çš„è¿‡æœŸæ—¶é—´è¶³å¤Ÿé•¿ï¼Œå¯ä»¥è¦†ç›–æ‰€æœ‰å¯èƒ½çš„æ“ä½œæ—¶é—´ï¼Œä½†ä¹Ÿä¸èƒ½å¤ªé•¿ï¼Œä»¥é˜²æ­¢æ­»é”ã€‚</p>
</li>
<li>
<p><strong>å”¯ä¸€æ ‡è¯†</strong>ï¼šç¡®ä¿æ¯ä¸ªå®¢æˆ·ç«¯è®¾ç½®çš„ <code>lockValue</code> å”¯ä¸€ï¼Œè¿™æ ·å¯ä»¥ç¡®ä¿åªæœ‰æŒæœ‰é”çš„å®¢æˆ·ç«¯æ‰èƒ½é‡Šæ”¾é”ã€‚</p>
</li>
<li>
<p><strong>å®¹é”™å¤„ç†</strong>ï¼šåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘ç½‘ç»œåˆ†åŒºã€Redis æ•…éšœç­‰æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ Redlock ç®—æ³•æ¥å¢å¼ºå¯é æ€§ã€‚</p>
</li>
</ol>
<h3 data-id="heading-6">5. ä½¿ç”¨ Redlock ç®—æ³•</h3>
<p>Redlock æ˜¯ Redis æä¾›çš„ä¸€ç§åˆ†å¸ƒå¼é”ç®—æ³•ï¼Œæ—¨åœ¨æé«˜åˆ†å¸ƒå¼ç¯å¢ƒä¸‹é”çš„å¯é æ€§ã€‚å…¶åŸºæœ¬æ€æƒ³æ˜¯åœ¨å¤šä¸ªç‹¬ç«‹çš„ Redis å®ä¾‹ä¸Šå°è¯•è·å–é”ï¼Œä»¥æé«˜å®¹é”™æ€§ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ Redlock ç®—æ³•çš„å®ç°ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> redis.clients.jedis.Jedis;
<span class="hljs-keyword">import</span> redis.clients.jedis.JedisPool;
<span class="hljs-keyword">import</span> redis.clients.jedis.params.SetParams;

<span class="hljs-keyword">import</span> java.util.Arrays;
<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.UUID;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedisRedlock</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&lt;JedisPool&gt; jedisPools;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> expireTime;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> retryDelay;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> retryCount;

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RedisRedlock</span><span class="hljs-params">(List&lt;JedisPool&gt; jedisPools, <span class="hljs-type">long</span> expireTime, <span class="hljs-type">long</span> retryDelay, <span class="hljs-type">int</span> retryCount)</span> {
        <span class="hljs-built_in">this</span>.jedisPools = jedisPools;
        <span class="hljs-built_in">this</span>.expireTime = expireTime;
        <span class="hljs-built_in">this</span>.retryDelay = retryDelay;
        <span class="hljs-built_in">this</span>.retryCount = retryCount;
    }

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">acquireLock</span><span class="hljs-params">(String lockKey)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString();
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> jedisPools.size();
        <span class="hljs-type">int</span> <span class="hljs-variable">quorum</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span> + <span class="hljs-number">1</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; retryCount; i++) {
            <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis();

            <span class="hljs-keyword">for</span> (JedisPool pool : jedisPools) {
                <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
                    <span class="hljs-type">SetParams</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SetParams</span>().nx().px(expireTime);
                    <span class="hljs-type">String</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.set(lockKey, lockValue, params);
                    <span class="hljs-keyword">if</span> (<span class="hljs-string">"OK"</span>.equals(result)) {
                        count++;
                    }
                }
            }

            <span class="hljs-type">long</span> <span class="hljs-variable">elapsedTime</span> <span class="hljs-operator">=</span> System.currentTimeMillis() - startTime;
            <span class="hljs-keyword">if</span> (count &gt;= quorum &amp;&amp; elapsedTime &lt;= expireTime) {
                <span class="hljs-keyword">return</span> lockValue;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">for</span> (JedisPool pool : jedisPools) {
                    <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
                        <span class="hljs-keyword">if</span> (lockValue.equals(jedis.get(lockKey))) {
                            jedis.del(lockKey);
                        }
                    }
                }
            }

            <span class="hljs-keyword">try</span> {
                Thread.sleep(retryDelay);
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }

        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">releaseLock</span><span class="hljs-params">(String lockKey, String lockValue)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">script</span> <span class="hljs-operator">=</span> <span class="hljs-string">"if redis.call('get', KEYS[1]) == ARGV[1] then "</span> +
                        <span class="hljs-string">"return redis.call('del', KEYS[1]) "</span> +
                        <span class="hljs-string">"else return 0 end"</span>;
        <span class="hljs-type">boolean</span> <span class="hljs-variable">success</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;

        <span class="hljs-keyword">for</span> (JedisPool pool : jedisPools) {
            <span class="hljs-keyword">try</span> (<span class="hljs-type">Jedis</span> <span class="hljs-variable">jedis</span> <span class="hljs-operator">=</span> pool.getResource()) {
                <span class="hljs-type">Object</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> jedis.eval(script, Arrays.asList(lockKey), Arrays.asList(lockValue));
                <span class="hljs-keyword">if</span> (<span class="hljs-string">"1"</span>.equals(result.toString())) {
                    success = <span class="hljs-literal">true</span>;
                }
            }
        }

        <span class="hljs-keyword">return</span> success;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;JedisPool&gt; jedisPools = Arrays.asList(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6379</span>),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6380</span>),
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">JedisPool</span>(<span class="hljs-string">"localhost"</span>, <span class="hljs-number">6381</span>)
        );

        <span class="hljs-type">long</span> <span class="hljs-variable">expireTime</span> <span class="hljs-operator">=</span> <span class="hljs-number">30000</span>; <span class="hljs-comment">// 30 seconds</span>
        <span class="hljs-type">long</span> <span class="hljs-variable">retryDelay</span> <span class="hljs-operator">=</span> <span class="hljs-number">200</span>; <span class="hljs-comment">// 200 milliseconds</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">retryCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

        <span class="hljs-type">RedisRedlock</span> <span class="hljs-variable">redlock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RedisRedlock</span>(jedisPools, expireTime, retryDelay, retryCount);

        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"myLock"</span>;
        <span class="hljs-type">String</span> <span class="hljs-variable">lockValue</span> <span class="hljs-operator">=</span> redlock.acquireLock(lockKey);

        <span class="hljs-keyword">if</span> (lockValue != <span class="hljs-literal">null</span>) {
            System.out.println(<span class="hljs-string">"Lock acquired!"</span>);

            <span class="hljs-comment">// Do your critical section work here</span>

            <span class="hljs-keyword">if</span> (redlock.releaseLock(lockKey, lockValue)) {
                System.out.println(<span class="hljs-string">"Lock released!"</span>);
            } <span class="hljs-keyword">else</span> {
                System.out.println(<span class="hljs-string">"Failed to release lock!"</span>);
            }
        } <span class="hljs-keyword">else</span> {
            System.out.println(<span class="hljs-string">"Failed to acquire lock!"</span>);
        }
    }
}
</code></pre>
<h3 data-id="heading-7">æ€»ç»“</h3>
<p>Redis åˆ†å¸ƒå¼é”æ˜¯ä¸€ç§æœ‰æ•ˆçš„å·¥å…·ï¼Œç”¨äºåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­å®ç°äº’æ–¥è®¿é—®ã€‚é€šè¿‡ä½¿ç”¨ Jedis å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ–¹ä¾¿åœ°å®ç°åŸºæœ¬çš„åˆ†å¸ƒå¼é”åŠŸèƒ½ã€‚è€Œ Redlock ç®—æ³•åˆ™æä¾›äº†ä¸€ç§æ›´å¯é çš„åˆ†å¸ƒå¼é”å®ç°ï¼Œé€‚ç”¨äºå¯¹å®¹é”™æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚åˆç†é…ç½®å’Œä½¿ç”¨åˆ†å¸ƒå¼é”ï¼Œå¯ä»¥æ˜¾è‘—æé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œä¸€è‡´æ€§ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆæˆ‘ä»¬ä» Python è¿ç§»åˆ° Node.js]]></title>    <link>https://juejin.cn/post/7570932873131950107</link>    <guid>https://juejin.cn/post/7570932873131950107</guid>    <pubDate>2025-11-10T23:28:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131950107" data-draft-id="7436003502298447912" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸ºä»€ä¹ˆæˆ‘ä»¬ä» Python è¿ç§»åˆ° Node.js"/> <meta itemprop="keywords" content="å‰ç«¯,åç«¯,Node.js"/> <meta itemprop="datePublished" content="2025-11-10T23:28:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Moment"/> <meta itemprop="url" content="https://juejin.cn/user/3782764966460398"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸ºä»€ä¹ˆæˆ‘ä»¬ä» Python è¿ç§»åˆ° Node.js
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3782764966460398/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Moment
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:28:21.000Z" title="Mon Nov 10 2025 23:28:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"ã€Œ";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"ã€";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"Â»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"âœ“";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><p>æœ€è¿‘åœ¨ä½¿ç”¨ NestJs å’Œ NextJs åœ¨åšä¸€ä¸ªååŒæ–‡æ¡£ <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fxun082%2FDocFlow" target="_blank" title="https://github.com/xun082/DocFlow" ref="nofollow noopener noreferrer">DocFlow</a>ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œæ¬¢è¿ starï¼Œæœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åŠ æˆ‘å¾®ä¿¡è¿›è¡Œå’¨è¯¢ <code>yunmz777</code></p>
<p>æˆ‘ä»¬åšäº†ä¸€ä»¶å¤§äº‹ï¼šåœ¨ä¸Šçº¿ä»…ä¸€å‘¨åï¼Œæˆ‘ä»¬å†³å®šå°†åç«¯å½»åº•ä» Python è½¬ç§»åˆ° Node.jsã€‚è¿™ä¸€å†³å®šçš„æ ¸å¿ƒåŸå› æ˜¯ æ‰©å±•æ€§ã€‚</p>
<p>å½“æ—¶ï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿè¿˜å¾ˆå°ï¼Œç”¨æˆ·é‡ä¹Ÿä¸å¤§ï¼Œæ‰€ä»¥è¿™ä¸ªå†³å®šçœ‹èµ·æ¥æ—¢å†’é™©åˆå¤§èƒ†ï¼Œä½†ä»é•¿è¿œæ¥çœ‹ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™æœ‰åŠ©äºè§£å†³æ½œåœ¨çš„æŠ€æœ¯ç“¶é¢ˆã€‚</p>
<h2 data-id="heading-0">é—®é¢˜çš„æ ¹æºï¼šPython å¼‚æ­¥ç¼–ç¨‹çš„å¤æ‚æ€§</h2>
<p>æˆ‘æ˜¯ Django çš„å¿ å®ç²‰ä¸ï¼Œå®ƒè®©æˆ‘èƒ½å¤Ÿå¿«é€Ÿæ„å»ºåº”ç”¨ï¼Œå¹¶ä¸”æä¾›äº†å¾ˆå¤šä¾¿åˆ©çš„å·¥å…·ã€‚ç„¶è€Œï¼Œéšç€æˆ‘ä»¬é¡¹ç›®çš„ä¸æ–­æ¨è¿›ï¼Œæˆ‘ä»¬å‘ç°ï¼ŒPython åœ¨å¤„ç†å¼‚æ­¥æ“ä½œæ—¶å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦å¤§é‡å¹¶å‘è¯·æ±‚çš„æƒ…å†µä¸‹ã€‚</p>
<p>åœ¨æˆ‘ä»¬éœ€è¦å¼‚æ­¥æ‰§è¡Œå¤šä¸ª I/O æ“ä½œæ—¶ï¼ŒPython çš„å¼‚æ­¥ç¼–ç¨‹å˜å¾—æå…¶æ··ä¹±ã€‚è™½ç„¶ Python ä¹Ÿæœ‰å¼‚æ­¥æ”¯æŒï¼Œä½†ç”±äºå…¶å¼‚æ­¥æ¨¡å‹æ˜¯åæ¥åŠ å…¥çš„ï¼Œå¯¼è‡´å…¶ç¨³å®šæ€§å’Œæ€§èƒ½å¹¶ä¸ç†æƒ³ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒJavaScript å’Œ Go çš„å¼‚æ­¥æ¨¡å‹æ›´åŠ ç›´è§‚ä¸”é«˜æ•ˆã€‚å¯¹äº Python æ¥è¯´ï¼Œè¦ä½¿å¼‚æ­¥ç¼–ç¨‹æ­£å¸¸å·¥ä½œï¼Œéœ€è¦å¤§é‡äº†è§£åº•å±‚å®ç°ï¼Œå¹¶ä¸”ä¼šå—åˆ°è¯¸å¤šé™åˆ¶ã€‚</p>
<h3 data-id="heading-1">Python å¼‚æ­¥çš„æŒ‘æˆ˜ï¼š</h3>
<ul>
<li>Python æ²¡æœ‰åŸç”Ÿå¼‚æ­¥æ–‡ä»¶ I/O æ”¯æŒã€‚</li>
<li>Django å¯¹å¼‚æ­¥çš„æ”¯æŒå¹¶ä¸å®Œå–„ï¼Œå°¤å…¶æ˜¯ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰éƒ¨åˆ†ã€‚</li>
<li>ä¸ºäº†å®ç°å¼‚æ­¥åŠŸèƒ½ï¼Œå¼€å‘è€…å¿…é¡»ä½¿ç”¨å¦‚ <code>async_to_sync</code> å’Œ <code>sync_to_async</code> è¿™æ ·çš„å·¥å…·ï¼Œå¢åŠ äº†ä»£ç å¤æ‚æ€§ã€‚</li>
<li>å¼‚æ­¥æ“ä½œçš„æ€§èƒ½ä¾èµ–äºè¿è¡Œç¯å¢ƒï¼Œå¦‚ Gunicorn çš„å·¥ä½œæ¨¡å¼ç­‰ï¼Œè¿™ä½¿å¾—åœ¨ Python ä¸­å†™å‡ºé«˜æ•ˆçš„å¼‚æ­¥ä»£ç å˜å¾—æ›´åŠ å›°éš¾ã€‚</li>
</ul>
<h2 data-id="heading-2">ä¸ºä»€ä¹ˆé€‰æ‹© Node.jsï¼Ÿ</h2>
<p>åœ¨é¢å¯¹ Python å¼‚æ­¥ç¼–ç¨‹çš„å›°å¢ƒæ—¶ï¼Œæˆ‘ä»¬å†³å®šè½¬å‘ Node.jsã€‚Node.js æœ¬èº«å°±ä¸ºå¼‚æ­¥æ“ä½œæä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œå®ƒçš„äº‹ä»¶å¾ªç¯æœºåˆ¶ä½¿å¾—å¹¶å‘å¤„ç†å˜å¾—æ›´åŠ é«˜æ•ˆã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬æ›¾è€ƒè™‘è¿‡ä½¿ç”¨ Python ä¸­çš„ FastAPIï¼Œå®ƒçš„å¼‚æ­¥æ”¯æŒç¡®å®æ¯” Django å¼ºï¼Œä½†æˆ‘ä»¬æœ€ç»ˆè¿˜æ˜¯é€‰æ‹©äº† Node.jsï¼Œå› ä¸ºå®ƒæ›´ç¬¦åˆæˆ‘ä»¬å¯¹æœªæ¥å¯æ‰©å±•æ€§çš„éœ€æ±‚ã€‚Node.js çš„äº‹ä»¶å¾ªç¯æœºåˆ¶å’Œä¸°å¯Œçš„ç”Ÿæ€ç³»ç»Ÿä½¿å¾—å®ƒéå¸¸é€‚åˆæˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<h2 data-id="heading-3">è¿ç§»çš„æ”¶ç›Š</h2>
<ol>
<li>
<p>æ€§èƒ½æå‡
æˆ‘ä»¬çš„æµ‹è¯•æ˜¾ç¤ºï¼Œåœ¨è¿ç§»åˆ° Node.js åï¼Œååé‡æé«˜äº†çº¦ 3 å€ã€‚éšç€æˆ‘ä»¬åœ¨ Node.js ä¸­å®ç°æ›´å¤šå¹¶å‘æ“ä½œï¼ˆå¦‚æ–‡æ¡£ chunking å’Œé‡æ–°æ’åºï¼‰ï¼Œæˆ‘ä»¬é¢„æœŸæ€§èƒ½è¿˜ä¼šç»§ç»­æå‡ã€‚</p>
</li>
<li>
<p>å¼€å‘æ•ˆç‡
Node.js çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹è®©æˆ‘ä»¬èƒ½å¤Ÿæ›´å¥½åœ°å¤„ç†é«˜å¹¶å‘ä»»åŠ¡ï¼Œè€Œæ— éœ€æ‹…å¿ƒåƒ Python é‚£æ ·çš„å¼‚æ­¥é™·é˜±ã€‚æˆ‘ä»¬èƒ½æ›´å¿«é€Ÿåœ°å®ç°æ–°åŠŸèƒ½ï¼ŒåŒæ—¶å‡å°‘äº†å› åº•å±‚å¼‚æ­¥é—®é¢˜å¸¦æ¥çš„é˜»ç¢ã€‚</p>
</li>
<li>
<p>ç»Ÿä¸€ä»£ç åº“
è¿ç§»åˆ° Node.js åï¼Œæˆ‘ä»¬å°†åŸæœ¬åˆ†å¼€çš„åå° worker å’Œ Web æœåŠ¡å™¨æ•´åˆåˆ°ä¸€ä¸ªä»£ç åº“ä¸­ï¼Œå‡å°‘äº†é‡å¤ä»£ç ï¼Œæå‡äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œä¸€è‡´æ€§ã€‚</p>
</li>
<li>
<p>æ›´å¥½çš„æµ‹è¯•å’Œé‡æ„
è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å†™äº†å¤§é‡æ–°çš„æµ‹è¯•ï¼Œç¡®ä¿æ–°ç³»ç»ŸæŒ‰é¢„æœŸå·¥ä½œã€‚è¿™ä¹Ÿä¿ƒä½¿æˆ‘ä»¬å¯¹ç°æœ‰ä»£ç è¿›è¡Œäº†é‡æ„ï¼Œæå‡äº†ä»£ç è´¨é‡ã€‚</p>
</li>
</ol>
<h2 data-id="heading-4">è¿ç§»çš„æŒ‘æˆ˜</h2>
<ol>
<li>
<p>å¤±å» Django çš„ä¾¿åˆ©
Django æ˜¯ä¸€ä¸ªæˆç†Ÿçš„æ¡†æ¶ï¼Œå®ƒæä¾›äº†å¾ˆå¤šç°æˆçš„åŠŸèƒ½ï¼Œä¾‹å¦‚ ORM å’Œä¸­é—´ä»¶ã€‚è¿ç§»åˆ° Node.js åï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨å®ç°å¾ˆå¤šåŠŸèƒ½ï¼Œè™½ç„¶å¯ä»¥ä½¿ç”¨ Express ç­‰æ¡†æ¶ï¼Œä½†ä¸ Django çš„è‡ªåŠ¨åŒ–åŠŸèƒ½ç›¸æ¯”ï¼Œä»æœ‰ä¸€äº›ç¼ºå¤±ã€‚</p>
</li>
<li>
<p>Python ç”Ÿæ€çš„ä¸§å¤±
è™½ç„¶æˆ‘ä»¬å·²ç»è½¬å‘äº† Node.jsï¼Œä½†åœ¨æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½å·¥å…·ï¼ˆå¦‚ RAG å’Œ agentï¼‰æ–¹é¢ï¼ŒPython ä»ç„¶æ˜¯æœ€å¼ºçš„è¯­è¨€ã€‚æˆ‘ä»¬ç›®å‰å¯ä»¥æ¥å—è¿™ä¸ªæ”¹å˜ï¼Œä½†ä¸æ’é™¤æœªæ¥å¯èƒ½ä¼šé‡æ–°ä½¿ç”¨ Pythonã€‚</p>
</li>
</ol>
<h2 data-id="heading-5">æ€»ç»“</h2>
<p>è¿™æ¬¡è¿ç§»å¸¦æ¥äº†æ˜¾è‘—çš„æ€§èƒ½æå‡å’Œå¼€å‘æ•ˆç‡çš„æå‡ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå­¦åˆ°äº†å¾ˆå¤šã€‚è™½ç„¶è¿‡ç¨‹ä¸­é¢ä¸´äº†å¾ˆå¤šæŒ‘æˆ˜ï¼Œä½†æ•´ä½“æ¥çœ‹ï¼Œæˆ‘ä»¬å¯¹è¿™æ¬¡å†³å®šæ„Ÿåˆ°éå¸¸æ»¡æ„ã€‚</p>
<p>å¦‚æœä½ ä¹Ÿæ­£åœ¨é¢ä¸´ç±»ä¼¼çš„é€‰æ‹©ï¼Œè¿ç§»åˆ° Node.js æˆ–è®¸æ˜¯ä¸€ä¸ªå€¼å¾—è€ƒè™‘çš„é€‰é¡¹ï¼Œå°¤å…¶æ˜¯åœ¨ä½ å¯¹é«˜å¹¶å‘å’Œæ‰©å±•æ€§æœ‰è¾ƒé«˜è¦æ±‚çš„æƒ…å†µä¸‹ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Vueç»„ä»¶é€šä¿¡ä¸å†éš¾ï¼è¿™8ç§æ–¹å¼è®©ä½ å½»åº•ææ‡‚çˆ¶å­å…„å¼Ÿä¼ å€¼]]></title>    <link>https://juejin.cn/post/7570923924365180991</link>    <guid>https://juejin.cn/post/7570923924365180991</guid>    <pubDate>2025-11-10T23:29:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924365180991" data-draft-id="7570899512782929983" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Vueç»„ä»¶é€šä¿¡ä¸å†éš¾ï¼è¿™8ç§æ–¹å¼è®©ä½ å½»åº•ææ‡‚çˆ¶å­å…„å¼Ÿä¼ å€¼"/> <meta itemprop="keywords" content="Vue.js,å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T23:29:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è‰¯å±±æœ‰é£æ¥"/> <meta itemprop="url" content="https://juejin.cn/user/3940246036939358"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Vueç»„ä»¶é€šä¿¡ä¸å†éš¾ï¼è¿™8ç§æ–¹å¼è®©ä½ å½»åº•ææ‡‚çˆ¶å­å…„å¼Ÿä¼ å€¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3940246036939358/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è‰¯å±±æœ‰é£æ¥
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:29:25.000Z" title="Mon Nov 10 2025 23:29:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä½ æ˜¯ä¸æ˜¯ç»å¸¸é‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼Ÿçˆ¶ç»„ä»¶çš„æ•°æ®è¦ä¼ ç»™å­ç»„ä»¶ï¼Œå­ç»„ä»¶çš„äº‹ä»¶è¦é€šçŸ¥çˆ¶ç»„ä»¶ï¼Œå…„å¼Ÿç»„ä»¶ä¹‹é—´è¦å…±äº«çŠ¶æ€...æ¯æ¬¡å†™Vueç»„ä»¶é€šä¿¡éƒ½è§‰å¾—å¤´å¤§ï¼Œä¸çŸ¥é“ç”¨å“ªç§æ–¹å¼æœ€åˆé€‚ï¼Ÿ</p>
<p>åˆ«æ‹…å¿ƒï¼ä»Šå¤©æˆ‘å°±å¸¦ä½ å½»åº•ææ‡‚Vueç»„ä»¶é€šä¿¡çš„8ç§æ ¸å¿ƒæ–¹å¼ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰è¯¦ç»†çš„ä»£ç ç¤ºä¾‹å’Œé€‚ç”¨åœºæ™¯åˆ†æã€‚çœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ å°±èƒ½æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯é€‰æ‹©æœ€åˆé€‚çš„é€šä¿¡æ–¹æ¡ˆï¼Œå†ä¹Ÿä¸ç”¨ä¸ºç»„ä»¶é—´ä¼ å€¼å‘æ„äº†ï¼</p>
<h2 data-id="heading-0">Propsï¼šæœ€åŸºç¡€çš„çˆ¶å­é€šä¿¡</h2>
<p>Propsæ˜¯Vueä¸­æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„çˆ¶å­ç»„ä»¶é€šä¿¡æ–¹å¼ã€‚çˆ¶ç»„ä»¶é€šè¿‡å±æ€§å‘ä¸‹ä¼ é€’æ•°æ®ï¼Œå­ç»„ä»¶é€šè¿‡propsé€‰é¡¹æ¥æ”¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­ç»„ä»¶ ChildComponent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>å­ç»„ä»¶æ¥æ”¶åˆ°çš„æ¶ˆæ¯ï¼š{{ message }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç”¨æˆ·å¹´é¾„ï¼š{{ userInfo.age }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// å®šä¹‰propsï¼Œå¯ä»¥æŒ‡å®šç±»å‹å’Œé»˜è®¤å€¼</span>
  <span class="hljs-attr">props</span>: {
    <span class="hljs-attr">message</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">String</span>,
      <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>  <span class="hljs-comment">// å¿…é¡»ä¼ é€’è¿™ä¸ªprop</span>
    },
    <span class="hljs-attr">userInfo</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-title class_">Object</span>,
      <span class="hljs-attr">default</span>: <span class="hljs-function">() =&gt;</span> ({})  <span class="hljs-comment">// é»˜è®¤ç©ºå¯¹è±¡</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ ParentComponent.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> 
      <span class="hljs-attr">:message</span>=<span class="hljs-string">"parentMessage"</span> 
      <span class="hljs-attr">:user-info</span>=<span class="hljs-string">"userData"</span>
    /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ChildComponent.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">parentMessage</span>: <span class="hljs-string">'æ¥è‡ªçˆ¶ç»„ä»¶çš„é—®å€™'</span>,
      <span class="hljs-attr">userData</span>: {
        <span class="hljs-attr">name</span>: <span class="hljs-string">'å°æ˜'</span>,
        <span class="hljs-attr">age</span>: <span class="hljs-number">25</span>
      }
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç®€å•çš„çˆ¶å­ç»„ä»¶æ•°æ®ä¼ é€’ï¼Œæ•°æ®æµæ¸…æ™°æ˜ç¡®ã€‚ä½†è¦æ³¨æ„ï¼Œpropsæ˜¯å•å‘æ•°æ®æµï¼Œå­ç»„ä»¶ä¸èƒ½ç›´æ¥ä¿®æ”¹propsã€‚</p>
<h2 data-id="heading-1">$emitï¼šå­ç»„ä»¶å‘çˆ¶ç»„ä»¶é€šä¿¡</h2>
<p>å½“å­ç»„ä»¶éœ€è¦å‘çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®æˆ–è§¦å‘çˆ¶ç»„ä»¶çš„æŸä¸ªæ–¹æ³•æ—¶ï¼Œå°±éœ€è¦ç”¨åˆ°$emitã€‚å­ç»„ä»¶é€šè¿‡è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œçˆ¶ç»„ä»¶é€šè¿‡v-onç›‘å¬è¿™äº›äº‹ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­ç»„ä»¶ SubmitButton.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClick"</span>&gt;</span>
    æäº¤è¡¨å•
  <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleClick</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ï¼Œå¹¶ä¼ é€’æ•°æ®</span>
      <span class="hljs-variable language_">this</span>.$emit(<span class="hljs-string">'form-submit'</span>, {
        <span class="hljs-attr">timestamp</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(),
        <span class="hljs-attr">formData</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">formData</span>
      })
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ FormContainer.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">submit-button</span> @<span class="hljs-attr">form-submit</span>=<span class="hljs-string">"handleFormSubmit"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">SubmitButton</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./SubmitButton.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">SubmitButton</span> },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleFormSubmit</span>(<span class="hljs-params">payload</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¥æ”¶åˆ°å­ç»„ä»¶çš„æ•°æ®ï¼š'</span>, payload)
      <span class="hljs-comment">// è¿™é‡Œå¯ä»¥å¤„ç†è¡¨å•æäº¤é€»è¾‘</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">submitToServer</span>(payload.<span class="hljs-property">formData</span>)
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šå­ç»„ä»¶éœ€è¦é€šçŸ¥çˆ¶ç»„ä»¶æŸä¸ªäº‹ä»¶å‘ç”Ÿï¼Œæˆ–è€…éœ€è¦ä¼ é€’æ•°æ®ç»™çˆ¶ç»„ä»¶å¤„ç†ã€‚</p>
<h2 data-id="heading-2">refï¼šç›´æ¥è®¿é—®å­ç»„ä»¶å®ä¾‹</h2>
<p>é€šè¿‡refå±æ€§ï¼Œçˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥è®¿é—®å­ç»„ä»¶çš„å®ä¾‹ï¼Œè°ƒç”¨å…¶æ–¹æ³•æˆ–è®¿é—®å…¶æ•°æ®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// å­ç»„ä»¶ CustomInput.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> 
    <span class="hljs-attr">ref</span>=<span class="hljs-string">"inputRef"</span> 
    <span class="hljs-attr">v-model</span>=<span class="hljs-string">"inputValue"</span> 
    <span class="hljs-attr">type</span>=<span class="hljs-string">"text"</span>
  /&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">inputValue</span>: <span class="hljs-string">''</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// å­ç»„ä»¶çš„è‡ªå®šä¹‰æ–¹æ³•</span>
    <span class="hljs-title function_">focus</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">inputRef</span>.<span class="hljs-title function_">focus</span>()
    },
    <span class="hljs-title function_">clear</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputValue</span> = <span class="hljs-string">''</span>
    },
    <span class="hljs-title function_">getValue</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">inputValue</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ ParentComponent.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">custom-input</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"myInput"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleFocus"</span>&gt;</span>èšç„¦è¾“å…¥æ¡†<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"handleClear"</span>&gt;</span>æ¸…ç©ºè¾“å…¥æ¡†<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">CustomInput</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./CustomInput.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">CustomInput</span> },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">handleFocus</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// é€šè¿‡refç›´æ¥è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">myInput</span>.<span class="hljs-title function_">focus</span>()
    },
    <span class="hljs-title function_">handleClear</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è°ƒç”¨å­ç»„ä»¶çš„æ¸…ç©ºæ–¹æ³•</span>
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$refs</span>.<span class="hljs-property">myInput</span>.<span class="hljs-title function_">clear</span>()
      
      <span class="hljs-comment">// ä¹Ÿå¯ä»¥ç›´æ¥è®¿é—®å­ç»„ä»¶çš„æ•°æ®ï¼ˆä¸æ¨èï¼‰</span>
      <span class="hljs-comment">// this.$refs.myInput.inputValue = ''</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šéœ€è¦ç›´æ¥æ“ä½œå­ç»„ä»¶çš„DOMå…ƒç´ æˆ–è°ƒç”¨å­ç»„ä»¶æ–¹æ³•çš„åœºæ™¯ã€‚ä½†è¦è°¨æ…ä½¿ç”¨ï¼Œé¿å…ç ´åç»„ä»¶çš„å°è£…æ€§ã€‚</p>
<h2 data-id="heading-3">Event Busï¼šä»»æ„ç»„ä»¶é—´é€šä¿¡</h2>
<p>Event Busé€šè¿‡åˆ›å»ºä¸€ä¸ªç©ºçš„Vueå®ä¾‹ä½œä¸ºäº‹ä»¶ä¸­å¿ƒï¼Œå®ç°ä»»æ„ç»„ä»¶é—´çš„é€šä¿¡ï¼Œç‰¹åˆ«é€‚åˆéçˆ¶å­ç»„ä»¶çš„æƒ…å†µã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// event-bus.js - åˆ›å»ºäº‹ä»¶æ€»çº¿</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">Vue</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-title class_">EventBus</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Vue</span>()

<span class="hljs-comment">// ç»„ä»¶A - äº‹ä»¶å‘é€è€…</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"sendMessage"</span>&gt;</span>å‘é€å…¨å±€æ¶ˆæ¯<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventBus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./event-bus'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">sendMessage</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// è§¦å‘å…¨å±€äº‹ä»¶</span>
      <span class="hljs-title class_">EventBus</span>.$emit(<span class="hljs-string">'global-message'</span>, {
        <span class="hljs-attr">text</span>: <span class="hljs-string">'Hello from Component A!'</span>,
        <span class="hljs-attr">from</span>: <span class="hljs-string">'ComponentA'</span>
      })
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// ç»„ä»¶B - äº‹ä»¶ç›‘å¬è€…</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>æœ€æ–°æ¶ˆæ¯ï¼š{{ latestMessage }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { <span class="hljs-title class_">EventBus</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./event-bus'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">latestMessage</span>: <span class="hljs-string">''</span>
    }
  },
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç›‘å¬å…¨å±€äº‹ä»¶</span>
    <span class="hljs-title class_">EventBus</span>.$on(<span class="hljs-string">'global-message'</span>, <span class="hljs-function">(<span class="hljs-params">payload</span>) =&gt;</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">latestMessage</span> = <span class="hljs-string">`<span class="hljs-subst">${payload.<span class="hljs-keyword">from</span>}</span> è¯´ï¼š<span class="hljs-subst">${payload.text}</span>`</span>
    })
  },
  <span class="hljs-title function_">beforeDestroy</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ç»„ä»¶é”€æ¯å‰ç§»é™¤äº‹ä»¶ç›‘å¬ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</span>
    <span class="hljs-title class_">EventBus</span>.$off(<span class="hljs-string">'global-message'</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç®€å•çš„è·¨ç»„ä»¶é€šä¿¡ï¼Œå°å‹é¡¹ç›®ä¸­çš„çŠ¶æ€ç®¡ç†ã€‚ä½†åœ¨å¤æ‚é¡¹ç›®ä¸­å»ºè®®ä½¿ç”¨Vuexæˆ–Piniaã€‚</p>
<h2 data-id="heading-4">provide/injectï¼šä¾èµ–æ³¨å…¥</h2>
<p>provideå’Œinjectä¸»è¦ç”¨äºé«˜é˜¶ç»„ä»¶å¼€å‘ï¼Œå…è®¸ç¥–å…ˆç»„ä»¶å‘å…¶æ‰€æœ‰å­å­™åä»£æ³¨å…¥ä¾èµ–ï¼Œè€Œä¸éœ€è¦å±‚å±‚ä¼ é€’propsã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ç¥–å…ˆç»„ä»¶ Ancestor.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">middle-component</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// æä¾›æ•°æ®å’Œæ–¹æ³•</span>
  <span class="hljs-title function_">provide</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// æä¾›å“åº”å¼æ•°æ®</span>
      <span class="hljs-attr">appTheme</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">theme</span>,
      <span class="hljs-comment">// æä¾›æ–¹æ³•</span>
      <span class="hljs-attr">changeTheme</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">changeTheme</span>,
      <span class="hljs-comment">// æä¾›å¸¸é‡</span>
      <span class="hljs-attr">appName</span>: <span class="hljs-string">'æˆ‘çš„Vueåº”ç”¨'</span>
    }
  },
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">theme</span>: <span class="hljs-string">'dark'</span>
    }
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-title function_">changeTheme</span>(<span class="hljs-params">newTheme</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">theme</span> = newTheme
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// æ·±å±‚å­ç»„ä»¶ DeepChild.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">:class</span>=<span class="hljs-string">"`theme-${appTheme}`"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>åº”ç”¨åç§°ï¼š{{ appName }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeTheme('light')"</span>&gt;</span>åˆ‡æ¢äº®è‰²ä¸»é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"changeTheme('dark')"</span>&gt;</span>åˆ‡æ¢æš—è‰²ä¸»é¢˜<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-comment">// æ³¨å…¥ç¥–å…ˆç»„ä»¶æä¾›çš„æ•°æ®</span>
  <span class="hljs-attr">inject</span>: [<span class="hljs-string">'appTheme'</span>, <span class="hljs-string">'changeTheme'</span>, <span class="hljs-string">'appName'</span>],
  
  <span class="hljs-comment">// ä¹Ÿå¯ä»¥æŒ‡å®šé»˜è®¤å€¼å’Œæ¥æº</span>
  <span class="hljs-comment">// inject: {</span>
  <span class="hljs-comment">//   theme: {</span>
  <span class="hljs-comment">//     from: 'appTheme',</span>
  <span class="hljs-comment">//     default: 'light'</span>
  <span class="hljs-comment">//   }</span>
  <span class="hljs-comment">// }</span>
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç»„ä»¶å±‚çº§å¾ˆæ·±ï¼Œéœ€è¦é¿å…propsé€å±‚ä¼ é€’çš„éº»çƒ¦ã€‚å¸¸ç”¨äºå¼€å‘ç»„ä»¶åº“æˆ–å¤§å‹åº”ç”¨çš„åŸºç¡€é…ç½®ã€‚</p>
<h2 data-id="heading-5"><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mi mathvariant="normal">/</mi></mrow><annotation encoding="application/x-tex">attrs/</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord">/</span></span></span></span></span>listenersï¼šè·¨å±‚çº§å±æ€§ä¼ é€’</h2>
<p><span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mtext>åŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰é</mtext><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>s</mi><mtext>å±æ€§ï¼Œ</mtext></mrow><annotation encoding="application/x-tex">attrsåŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰épropså±æ€§ï¼Œ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord cjk_fallback">åŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰é</span><span class="mord mathnormal">p</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">p</span><span class="mord mathnormal">s</span><span class="mord cjk_fallback">å±æ€§ï¼Œ</span></span></span></span></span>listenersåŒ…å«äº†çˆ¶ç»„ä»¶ä¼ å…¥çš„æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ï¼Œå¯ä»¥ç”¨äºåˆ›å»ºé«˜é˜¶ç»„ä»¶ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸­é—´ç»„ä»¶ MiddleComponent.vue</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- ä¼ é€’æ‰€æœ‰å±æ€§å’Œäº‹ä»¶åˆ°å­ç»„ä»¶ --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">child-component</span> <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span> <span class="hljs-attr">v-on</span>=<span class="hljs-string">"$listeners"</span> /&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> <span class="hljs-title class_">ChildComponent</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./ChildComponent.vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">components</span>: { <span class="hljs-title class_">ChildComponent</span> },
  <span class="hljs-attr">inheritAttrs</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// ä¸è®©å±æ€§ç»‘å®šåˆ°æ ¹å…ƒç´ </span>
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'$attrs:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$attrs</span>) <span class="hljs-comment">// æ‰€æœ‰épropså±æ€§</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'$listeners:'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$listeners</span>) <span class="hljs-comment">// æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨</span>
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// æœ€ç»ˆå­ç»„ä»¶ ChildComponent.vue</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">input</span>
    <span class="hljs-attr">v-bind</span>=<span class="hljs-string">"$attrs"</span>
    <span class="hljs-attr">v-on</span>=<span class="hljs-string">"$listeners"</span>
    <span class="hljs-attr">class</span>=<span class="hljs-string">"custom-input"</span>
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// å¯ä»¥ç›´æ¥ä½¿ç”¨çˆ¶ç»„ä»¶ä¼ é€’çš„æ‰€æœ‰å±æ€§å’Œäº‹ä»¶</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ¥æ”¶åˆ°çš„å±æ€§ï¼š'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">$attrs</span>)
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// çˆ¶ç»„ä»¶ä½¿ç”¨</span>
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">middle-component</span>
    <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"è¯·è¾“å…¥å†…å®¹"</span>
    <span class="hljs-attr">maxlength</span>=<span class="hljs-string">"20"</span>
    @<span class="hljs-attr">focus</span>=<span class="hljs-string">"handleFocus"</span>
    @<span class="hljs-attr">blur</span>=<span class="hljs-string">"handleBlur"</span>
  /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šåˆ›å»ºåŒ…è£…ç»„ä»¶ã€é«˜é˜¶ç»„ä»¶ï¼Œéœ€è¦é€ä¼ å±æ€§å’Œäº‹ä»¶çš„åœºæ™¯ã€‚</p>
<h2 data-id="heading-6">Vuexï¼šé›†ä¸­å¼çŠ¶æ€ç®¡ç†</h2>
<p>Vuexæ˜¯Vueçš„å®˜æ–¹çŠ¶æ€ç®¡ç†åº“ï¼Œé€‚ç”¨äºä¸­å¤§å‹å¤æ‚åº”ç”¨çš„çŠ¶æ€ç®¡ç†ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// store/index.js</span>
<span class="hljs-keyword">import</span> { createStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>

<span class="hljs-keyword">const</span> store = <span class="hljs-title function_">createStore</span>({
  <span class="hljs-title function_">state</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,
      <span class="hljs-attr">loading</span>: <span class="hljs-literal">false</span>
    }
  },
  <span class="hljs-attr">mutations</span>: {
    <span class="hljs-comment">// åŒæ­¥ä¿®æ”¹çŠ¶æ€</span>
    <span class="hljs-title function_">increment</span>(<span class="hljs-params">state</span>) {
      state.<span class="hljs-property">count</span>++
    },
    <span class="hljs-title function_">setUser</span>(<span class="hljs-params">state, user</span>) {
      state.<span class="hljs-property">user</span> = user
    },
    <span class="hljs-title function_">setLoading</span>(<span class="hljs-params">state, loading</span>) {
      state.<span class="hljs-property">loading</span> = loading
    }
  },
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-comment">// å¼‚æ­¥æ“ä½œ</span>
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">{ commit }, credentials</span>) {
      <span class="hljs-title function_">commit</span>(<span class="hljs-string">'setLoading'</span>, <span class="hljs-literal">true</span>)
      <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> user = <span class="hljs-keyword">await</span> api.<span class="hljs-title function_">login</span>(credentials)
        <span class="hljs-title function_">commit</span>(<span class="hljs-string">'setUser'</span>, user)
        <span class="hljs-keyword">return</span> user
      } <span class="hljs-keyword">finally</span> {
        <span class="hljs-title function_">commit</span>(<span class="hljs-string">'setLoading'</span>, <span class="hljs-literal">false</span>)
      }
    }
  },
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-comment">// è®¡ç®—å±æ€§</span>
    <span class="hljs-attr">isLoggedIn</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> !!state.<span class="hljs-property">user</span>,
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function"><span class="hljs-params">state</span> =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>
  }
})

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>è®¡æ•°å™¨ï¼š{{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åŒå€è®¡æ•°ï¼š{{ doubleCount }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">"isLoggedIn"</span>&gt;</span>æ¬¢è¿ï¼Œ{{ user.name }}ï¼<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"login"</span> <span class="hljs-attr">:disabled</span>=<span class="hljs-string">"loading"</span>&gt;</span>
      {{ loading ? 'ç™»å½•ä¸­...' : 'ç™»å½•' }}
    <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { mapState, mapGetters, mapMutations, mapActions } <span class="hljs-keyword">from</span> <span class="hljs-string">'vuex'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-attr">computed</span>: {
    <span class="hljs-comment">// æ˜ å°„stateå’Œgettersåˆ°è®¡ç®—å±æ€§</span>
    ...<span class="hljs-title function_">mapState</span>([<span class="hljs-string">'count'</span>, <span class="hljs-string">'user'</span>, <span class="hljs-string">'loading'</span>]),
    ...<span class="hljs-title function_">mapGetters</span>([<span class="hljs-string">'doubleCount'</span>, <span class="hljs-string">'isLoggedIn'</span>])
  },
  <span class="hljs-attr">methods</span>: {
    <span class="hljs-comment">// æ˜ å°„mutationså’Œactionsåˆ°æ–¹æ³•</span>
    ...<span class="hljs-title function_">mapMutations</span>([<span class="hljs-string">'increment'</span>]),
    ...<span class="hljs-title function_">mapActions</span>([<span class="hljs-string">'login'</span>])
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šä¸­å¤§å‹å¤æ‚åº”ç”¨ï¼Œå¤šä¸ªç»„ä»¶éœ€è¦å…±äº«çŠ¶æ€ï¼Œéœ€è¦ä¸¥æ ¼çš„çŠ¶æ€ç®¡ç†æµç¨‹ã€‚</p>
<h2 data-id="heading-7">Piniaï¼šæ–°ä¸€ä»£çŠ¶æ€ç®¡ç†</h2>
<p>Piniaæ˜¯Vueå®˜æ–¹æ¨èçš„æ–°ä¸€ä»£çŠ¶æ€ç®¡ç†åº“ï¼Œç›¸æ¯”Vuexæ›´åŠ è½»é‡ã€ç›´è§‚ï¼Œå¹¶ä¸”å®Œç¾æ”¯æŒTypeScriptã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// stores/counter.js</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>, {
  <span class="hljs-attr">state</span>: <span class="hljs-function">() =&gt;</span> ({
    <span class="hljs-attr">count</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'æˆ‘çš„è®¡æ•°å™¨'</span>
  }),
  
  <span class="hljs-attr">getters</span>: {
    <span class="hljs-attr">doubleCount</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> state.<span class="hljs-property">count</span> * <span class="hljs-number">2</span>,
    <span class="hljs-comment">// ä½¿ç”¨thisè®¿é—®å…¶ä»–getter</span>
    <span class="hljs-title function_">doubleCountPlusOne</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">doubleCount</span> + <span class="hljs-number">1</span>
    }
  },
  
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-title function_">increment</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++
    },
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">incrementAsync</span>(<span class="hljs-params"/>) {
      <span class="hljs-comment">// å¼‚æ­¥action</span>
      <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function"><span class="hljs-params">resolve</span> =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>))
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">increment</span>()
    },
    <span class="hljs-title function_">reset</span>(<span class="hljs-params"/>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">0</span>
    }
  }
})

<span class="hljs-comment">// ç»„ä»¶ä¸­ä½¿ç”¨</span>
&lt;template&gt;
  <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">h3</span>&gt;</span>{{ name }}<span class="hljs-tag">&lt;/<span class="hljs-name">h3</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å½“å‰è®¡æ•°ï¼š{{ count }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>åŒå€è®¡æ•°ï¼š{{ doubleCount }}<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"increment"</span>&gt;</span>å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"incrementAsync"</span>&gt;</span>å¼‚æ­¥å¢åŠ <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">"reset"</span>&gt;</span>é‡ç½®<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
&lt;/template&gt;

<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
<span class="hljs-keyword">import</span> { useCounterStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/counter'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> counterStore = <span class="hljs-title function_">useCounterStore</span>()
    
    <span class="hljs-comment">// å¯ä»¥ç›´æ¥è§£æ„ï¼Œä½†ä¼šå¤±å»å“åº”å¼</span>
    <span class="hljs-comment">// ä½¿ç”¨storeToRefsä¿æŒå“åº”å¼</span>
    <span class="hljs-keyword">const</span> { name, count, doubleCount } = counterStore
    
    <span class="hljs-keyword">return</span> {
      <span class="hljs-comment">// stateå’Œgetters</span>
      name,
      count,
      doubleCount,
      <span class="hljs-comment">// actions</span>
      <span class="hljs-attr">increment</span>: counterStore.<span class="hljs-property">increment</span>,
      <span class="hljs-attr">incrementAsync</span>: counterStore.<span class="hljs-property">incrementAsync</span>,
      <span class="hljs-attr">reset</span>: counterStore.<span class="hljs-property">reset</span>
    }
  }
}
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>

<span class="hljs-comment">// åœ¨å¤šä¸ªstoreä¹‹é—´äº¤äº’</span>
<span class="hljs-keyword">import</span> { useUserStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@/stores/user'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCartStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'cart'</span>, {
  <span class="hljs-attr">actions</span>: {
    <span class="hljs-keyword">async</span> <span class="hljs-title function_">checkout</span>(<span class="hljs-params"/>) {
      <span class="hljs-keyword">const</span> userStore = <span class="hljs-title function_">useUserStore</span>()
      
      <span class="hljs-keyword">if</span> (!userStore.<span class="hljs-property">isLoggedIn</span>) {
        <span class="hljs-keyword">await</span> userStore.<span class="hljs-title function_">login</span>()
      }
      
      <span class="hljs-comment">// ç»“è´¦é€»è¾‘...</span>
    }
  }
})
</code></pre>
<p>é€‚ç”¨åœºæ™¯ï¼šç°ä»£Vueåº”ç”¨çš„çŠ¶æ€ç®¡ç†ï¼Œç‰¹åˆ«æ˜¯éœ€è¦TypeScriptæ”¯æŒå’Œæ›´ç®€æ´APIçš„é¡¹ç›®ã€‚</p>
<h2 data-id="heading-8">å®æˆ˜åœºæ™¯é€‰æ‹©æŒ‡å—</h2>
<p>ç°åœ¨ä½ å·²ç»äº†è§£äº†8ç§Vueç»„ä»¶é€šä¿¡æ–¹å¼ï¼Œä½†åœ¨å®é™…å¼€å‘ä¸­è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿæˆ‘æ¥ç»™ä½ ä¸€äº›å®ç”¨å»ºè®®ï¼š</p>
<p>å¦‚æœæ˜¯ç®€å•çš„çˆ¶å­ç»„ä»¶é€šä¿¡ï¼Œä¼˜å…ˆè€ƒè™‘propså’Œ$emitï¼Œè¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ã€‚</p>
<p>å½“ç»„ä»¶å±‚çº§è¾ƒæ·±ï¼Œéœ€è¦é¿å…propsé€å±‚ä¼ é€’æ—¶ï¼Œprovide/injectæ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>
<p>å¯¹äºéçˆ¶å­ç»„ä»¶é—´çš„ç®€å•é€šä¿¡ï¼ŒEvent Buså¯ä»¥å¿«é€Ÿè§£å†³é—®é¢˜ï¼Œä½†è¦æ³¨æ„äº‹ä»¶ç®¡ç†ã€‚</p>
<p>åœ¨éœ€è¦åˆ›å»ºé«˜é˜¶ç»„ä»¶æˆ–åŒ…è£…ç»„ä»¶æ—¶ï¼Œ<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi><mi>t</mi><mi>t</mi><mi>r</mi><mi>s</mi><mtext>å’Œ</mtext></mrow><annotation encoding="application/x-tex">attrså’Œ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"/><span class="mord mathnormal">a</span><span class="mord mathnormal">tt</span><span class="mord mathnormal">rs</span><span class="mord cjk_fallback">å’Œ</span></span></span></span></span>listenersèƒ½å¤§å¤§ç®€åŒ–ä»£ç ã€‚</p>
<p>å¯¹äºä¸­å¤§å‹å¤æ‚åº”ç”¨ï¼Œéœ€è¦é›†ä¸­ç®¡ç†çŠ¶æ€æ—¶ï¼ŒVuexæˆ–Piniaæ˜¯å¿…å¤‡çš„ã€‚ä¸ªäººæ›´æ¨èPiniaï¼Œå› ä¸ºå®ƒæ›´ç°ä»£ã€æ›´ç®€æ´ã€‚</p>
<p>å¦‚æœéœ€è¦ç›´æ¥æ“ä½œå­ç»„ä»¶ï¼Œrefæä¾›äº†æœ€ç›´æ¥çš„æ–¹å¼ï¼Œä½†è¦è°¨æ…ä½¿ç”¨ä»¥ä¿æŒç»„ä»¶çš„å°è£…æ€§ã€‚</p>
<p>è®°ä½ï¼Œæ²¡æœ‰æœ€å¥½çš„é€šä¿¡æ–¹å¼ï¼Œåªæœ‰æœ€é€‚åˆå½“å‰åœºæ™¯çš„æ–¹å¼ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¾€å¾€æ˜¯å¤šç§æ–¹å¼ç»“åˆä½¿ç”¨ã€‚</p>
<h2 data-id="heading-9">å†™åœ¨æœ€å</h2>
<p>ç»„ä»¶é€šä¿¡æ˜¯Vueå¼€å‘ä¸­çš„æ ¸å¿ƒæŠ€èƒ½ï¼ŒæŒæ¡è¿™äº›é€šä¿¡æ–¹å¼å°±åƒæŒæ¡äº†ç»„ä»¶é—´çš„"å¯¹è¯è¯­è¨€"ã€‚ä»ç®€å•çš„props/$emitåˆ°å¤æ‚çš„PiniaçŠ¶æ€ç®¡ç†ï¼Œæ¯ç§æ–¹å¼éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä»·å€¼å’Œé€‚ç”¨åœºæ™¯ã€‚</p>
<p>å…³é”®æ˜¯è¦ç†è§£æ¯ç§æ–¹å¼çš„åŸç†å’Œä¼˜ç¼ºç‚¹ï¼Œåœ¨å®é™…å¼€å‘ä¸­æ ¹æ®ç»„ä»¶å…³ç³»ã€æ•°æ®æµå¤æ‚åº¦ã€é¡¹ç›®è§„æ¨¡ç­‰å› ç´ åšå‡ºåˆé€‚çš„é€‰æ‹©ã€‚</p>
<p>ä½ ç°åœ¨å¯¹Vueç»„ä»¶é€šä¿¡æ˜¯ä¸æ˜¯æœ‰äº†æ›´æ¸…æ™°çš„è®¤è¯†ï¼Ÿåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ æœ€å–œæ¬¢ç”¨å“ªç§é€šä¿¡æ–¹å¼ï¼Ÿæœ‰æ²¡æœ‰é‡åˆ°è¿‡ç‰¹åˆ«çš„é€šä¿¡éš¾é¢˜ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç»éªŒå’Œå¿ƒå¾—ï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ“˜ å…¨é¢è§£æï¼šJavaScript æ—¶é—´æ ¼å¼åŒ– API å®æˆ˜æŒ‡å—]]></title>    <link>https://juejin.cn/post/7570932873131966491</link>    <guid>https://juejin.cn/post/7570932873131966491</guid>    <pubDate>2025-11-10T23:31:09.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131966491" data-draft-id="7570978150009667622" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ“˜ å…¨é¢è§£æï¼šJavaScript æ—¶é—´æ ¼å¼åŒ– API å®æˆ˜æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯"/> <meta itemprop="datePublished" content="2025-11-10T23:31:09.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="excel"/> <meta itemprop="url" content="https://juejin.cn/user/2911162520062862"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ“˜ å…¨é¢è§£æï¼šJavaScript æ—¶é—´æ ¼å¼åŒ– API å®æˆ˜æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2911162520062862/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    excel
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:31:09.000Z" title="Mon Nov 10 2025 23:31:09 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>â€”â€”ä» <code>toUTCString()</code> åˆ° <code>Intl.DateTimeFormat</code> çš„æ·±åº¦ç†è§£</p>
<p>æ—¶é—´ä¸æ—¥æœŸï¼Œæ˜¯å‰ç«¯å¼€å‘ä¸­æœ€å®¹æ˜“â€œè¸©å‘â€çš„éƒ¨åˆ†ã€‚ä¸åŒæµè§ˆå™¨ã€ä¸åŒåŒºåŸŸã€ç”šè‡³ä¸åŒç³»ç»Ÿè¯­è¨€ï¼Œéƒ½ä¼šé€ æˆè¾“å‡ºä¸ä¸€è‡´ã€‚<br/>
æœ¬æ–‡å°†ç³»ç»Ÿè§£æ JavaScript æä¾›çš„æ—¶é—´æ ¼å¼åŒ–æ–¹æ³•ï¼Œå¸®ä½ å½»åº•ææ‡‚å®ƒä»¬çš„å·®å¼‚ã€ç”¨é€”ä¸æ­£ç¡®ä½¿ç”¨æ–¹å¼ã€‚</p>
<hr/>
<h2 data-id="heading-0">ä¸€ã€èƒŒæ™¯ï¼šä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¹ˆå¤šæ—¶é—´æ ¼å¼åŒ–æ–¹æ³•ï¼Ÿ</h2>
<p>JavaScript çš„æ—¶é—´ç³»ç»ŸåŸºäº <strong>ECMAScript æ—¶é—´æ ‡å‡†</strong>ï¼Œæ—¶é—´ç‚¹ä»¥ UTC ä¸ºåŸºå‡†ï¼ˆUnix Epochï¼š1970-01-01 00:00:00 UTCï¼‰ã€‚<br/>
ä½†ç”±äºå‰ç«¯ä»£ç è¿è¡Œåœ¨ä¸åŒåœ°åŸŸçš„ç”¨æˆ·è®¾å¤‡ä¸­ï¼Œæ‰€ä»¥ï¼š</p>
<ul>
<li>ä¸€éƒ¨åˆ†æ–¹æ³•è¾“å‡º<strong>å›½é™…æ ‡å‡†æ ¼å¼</strong>ï¼ˆæœºå™¨å¯è¯»ï¼‰ï¼›</li>
<li>ä¸€éƒ¨åˆ†æ–¹æ³•è¾“å‡º<strong>æœ¬åœ°åŒ–æ ¼å¼</strong>ï¼ˆç”¨æˆ·å¯è¯»ï¼‰ï¼›</li>
<li>ä¸€éƒ¨åˆ†æ–¹æ³•æ”¯æŒ<strong>è‡ªå®šä¹‰åŒºåŸŸã€æ—¶åŒºå’Œæ ¼å¼</strong>ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-1">äºŒã€æ ¸å¿ƒ API æ€»è§ˆè¡¨</h2>





























































<table><thead><tr><th>æ–¹æ³•</th><th>æ—¶åŒº</th><th>æ˜¯å¦æœ¬åœ°åŒ–</th><th>æ˜¯å¦å¯å®šåˆ¶</th><th>è¾“å‡ºç¤ºä¾‹</th><th>ä¸»è¦ç”¨é€”</th></tr></thead><tbody><tr><td><code>toString()</code></td><td>æœ¬åœ°æ—¶é—´</td><td>å¦</td><td>å¦</td><td><code>"Tue Nov 11 2025 17:00:00 GMT+0800 (China Standard Time)"</code></td><td>è°ƒè¯•/é»˜è®¤è¾“å‡º</td></tr><tr><td><code>toUTCString()</code></td><td>UTC</td><td>å¦</td><td>å¦</td><td><code>"Tue, 11 Nov 2025 09:00:00 GMT"</code></td><td>æ ‡å‡†åŒ–è¾“å‡ºï¼ˆæ—¥å¿—/HTTPï¼‰</td></tr><tr><td><code>toGMTString()</code></td><td>UTC</td><td>å¦</td><td>å¦</td><td><code>"Tue, 11 Nov 2025 09:00:00 GMT"</code></td><td>å†å²é—ç•™ï¼ˆä¸æ¨èï¼‰</td></tr><tr><td><code>toISOString()</code></td><td>UTC</td><td>å¦</td><td>å¦</td><td><code>"2025-11-11T09:00:00.000Z"</code></td><td>æ•°æ®äº¤æ¢ï¼ˆJSON/HTTPï¼‰</td></tr><tr><td><code>toLocaleString()</code></td><td>æœ¬åœ°æ—¶åŒº</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td><code>"2025/11/11 17:00:00"</code></td><td>ç”¨æˆ·ç•Œé¢æ˜¾ç¤º</td></tr><tr><td><code>Intl.DateTimeFormat</code></td><td>ä»»æ„æŒ‡å®š</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td><code>"11 November 2025, 17:00:00"</code></td><td>å®Œå…¨å¯æ§æœ¬åœ°åŒ–è¾“å‡º</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-2">ä¸‰ã€é€ä¸ªè¯¦è§£ä¸ä»£ç ç¤ºä¾‹</h2>
<hr/>
<h3 data-id="heading-3">â‘  <code>toUTCString()</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šè¾“å‡º UTC æ—¶é—´çš„ RFC1123 æ ‡å‡†æ ¼å¼<br/>
<strong>è¯­æ³•</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">date.toUTCString()<span class="hljs-comment">;</span>
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d.<span class="hljs-title function_">toUTCString</span>());
<span class="hljs-comment">// "Tue, 11 Nov 2025 09:00:00 GMT"</span>
</code></pre>
<p><strong>ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>è¾“å‡ºå›ºå®šæ ¼å¼ï¼Œä¸å¯é…ç½®ï¼›</li>
<li>å¸¸ç”¨äºæ—¥å¿—ã€HTTP Headerï¼›</li>
<li>ä¸å—ç³»ç»ŸåŒºåŸŸå½±å“ã€‚</li>
</ul>
<p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è®¾ç½® HTTP å“åº”å¤´</span>
response.<span class="hljs-title function_">setHeader</span>(<span class="hljs-string">'Expires'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() + <span class="hljs-number">3600000</span>).<span class="hljs-title function_">toUTCString</span>());
</code></pre>
<hr/>
<h3 data-id="heading-4">â‘¡ <code>toGMTString()</code>ï¼ˆå·²åºŸå¼ƒï¼‰</h3>
<p><strong>ç”¨é€”</strong>ï¼š<code>toUTCString()</code> çš„æ—§ç‰ˆæœ¬ï¼Œæ—©æœŸ Netscape/IE å…¼å®¹æ¥å£ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">date.toGMTString()<span class="hljs-comment">;</span>
</code></pre>
<p><strong>è¯´æ˜ï¼š</strong></p>
<ul>
<li>åœ¨ç°ä»£æµè§ˆå™¨ä¸­è¡Œä¸ºä¸ <code>toUTCString()</code> ç›¸åŒï¼›</li>
<li>ECMAScript å·²æ ‡è®°ä¸º <strong>deprecated</strong>ï¼›</li>
<li>ä¸æ¨èä½¿ç”¨ï¼Œä»…å…¼å®¹è€é¡¹ç›®ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-5">â‘¢ <code>toLocaleString()</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šè¾“å‡ºä¸ç”¨æˆ·åœ°åŒºè¯­è¨€ç›¸ç¬¦çš„æœ¬åœ°åŒ–æ—¶é—´å­—ç¬¦ä¸²ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">date.toLocaleString(<span class="hljs-section">[locales]</span>, <span class="hljs-section">[options]</span>)<span class="hljs-comment">;</span>
</code></pre>
<p><strong>å‚æ•°è¯´æ˜ï¼š</strong></p>




















<table><thead><tr><th>å‚æ•°</th><th>ç±»å‹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>locales</code></td><td>string æˆ– string[]</td><td>è¯­è¨€ä»£ç ï¼ˆå¦‚ <code>'zh-CN'</code>, <code>'en-US'</code>ï¼‰</td></tr><tr><td><code>options</code></td><td>object</td><td>æ ¼å¼åŒ–é€‰é¡¹</td></tr></tbody></table>
<p><strong>å¸¸ç”¨é€‰é¡¹ï¼š</strong></p>
<pre><code class="hljs language-sql" lang="sql">{
  timeZone: <span class="hljs-string">'Asia/Shanghai'</span>, <span class="hljs-operator">/</span><span class="hljs-operator">/</span> æŒ‡å®šæ—¶åŒº
  <span class="hljs-keyword">year</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-keyword">month</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">day</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">hour</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">minute</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-keyword">second</span>: <span class="hljs-string">'2-digit'</span>,
  hour12: <span class="hljs-literal">false</span>
}
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'zh-CN'</span>, { <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'Asia/Shanghai'</span> }));
<span class="hljs-comment">// "2025/11/11 17:00:00"</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(d.<span class="hljs-title function_">toLocaleString</span>(<span class="hljs-string">'en-US'</span>, { <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'America/New_York'</span> }));
<span class="hljs-comment">// "11/11/2025, 4:00:00 AM"</span>
</code></pre>
<p>âœ… <strong>å¯æœ¬åœ°åŒ–ã€å¯æ§ã€æœ€çµæ´»ã€‚</strong></p>
<hr/>
<h3 data-id="heading-6">â‘£ <code>toISOString()</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šè¾“å‡º ISO 8601 æ ‡å‡†çš„ UTC æ—¶é—´å­—ç¬¦ä¸²ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-ini" lang="ini">date.toISOString()<span class="hljs-comment">;</span>
</code></pre>
<p><strong>è¾“å‡ºç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>).<span class="hljs-title function_">toISOString</span>();
<span class="hljs-comment">// "2025-11-11T09:00:00.000Z"</span>
</code></pre>
<p><strong>ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>è¾“å‡ºå›ºå®šæ ¼å¼ï¼›</li>
<li>ç²¾ç¡®åˆ°æ¯«ç§’ï¼›</li>
<li>å¸¸ç”¨äº JSON / æ•°æ®äº¤æ¢ï¼›</li>
<li>Node.js å’Œåç«¯ç³»ç»Ÿé«˜åº¦å…¼å®¹ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-css" lang="css">JSON<span class="hljs-selector-class">.stringify</span>({ createdAt: new <span class="hljs-built_in">Date</span>().<span class="hljs-built_in">toISOString</span>() });
</code></pre>
<hr/>
<h3 data-id="heading-7">â‘¤ <code>Intl.DateTimeFormat</code></h3>
<p><strong>ç”¨é€”</strong>ï¼šæä¾›å¼ºå¤§çš„å›½é™…åŒ–æ—¶é—´æ ¼å¼åŒ–èƒ½åŠ›ã€‚<br/>
<strong>è¯­æ³•ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>(locales, options).<span class="hljs-title function_">format</span>(date);
</code></pre>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-11-11T09:00:00Z'</span>);
<span class="hljs-keyword">const</span> fmt = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title class_">DateTimeFormat</span>(<span class="hljs-string">'en-GB'</span>, {
  <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'UTC'</span>,
  <span class="hljs-attr">dateStyle</span>: <span class="hljs-string">'full'</span>,
  <span class="hljs-attr">timeStyle</span>: <span class="hljs-string">'long'</span>
});
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(fmt.<span class="hljs-title function_">format</span>(d));
<span class="hljs-comment">// "Tuesday, 11 November 2025 at 09:00:00 GMT"</span>
</code></pre>
<p><strong>æ›´ç»†ç²’åº¦æ§åˆ¶ï¼š</strong></p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">custom</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title function_ invoke__">DateTimeFormat</span>(<span class="hljs-string">'zh-CN'</span>, {
  <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'Asia/Shanghai'</span>,
  <span class="hljs-attr">year</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-attr">month</span>: <span class="hljs-string">'long'</span>,
  <span class="hljs-attr">day</span>: <span class="hljs-string">'numeric'</span>,
  <span class="hljs-attr">weekday</span>: <span class="hljs-string">'long'</span>,
  <span class="hljs-attr">hour</span>: <span class="hljs-string">'2-digit'</span>,
  <span class="hljs-attr">minute</span>: <span class="hljs-string">'2-digit'</span>
});
console.<span class="hljs-title function_ invoke__">log</span>(custom.<span class="hljs-title function_ invoke__">format</span>(d));
<span class="hljs-comment">// "2025å¹´11æœˆ11æ—¥æ˜ŸæœŸäºŒ 17:00"</span>
</code></pre>
<p>âœ… æ”¯æŒï¼š</p>
<ul>
<li>æ—¶åŒºåˆ‡æ¢ï¼›</li>
<li>å¤šè¯­è¨€ï¼›</li>
<li>é•¿çŸ­æ—¥æœŸæ ¼å¼ï¼›</li>
<li>æ˜ŸæœŸæ˜¾ç¤ºï¼›</li>
<li>æœ¬åœ°åŒ–æ•°å­—ã€‚</li>
</ul>
<hr/>
<h2 data-id="heading-8">å››ã€å¯¹æ¯”å®æµ‹ï¼šåŒä¸€ä¸ªæ—¶é—´ï¼Œä¸åŒè¾“å‡º</h2>
<pre><code class="hljs language-vbscript" lang="vbscript"><span class="hljs-keyword">const</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-comment">'2025-11-11T09:00:00Z');</span>

console.<span class="hljs-built_in">log</span>(d.<span class="hljs-keyword">to</span><span class="hljs-built_in">String</span>());         // <span class="hljs-string">"Tue Nov 11 2025 17:00:00 GMT+0800 (China Standard Time)"</span>
console.<span class="hljs-built_in">log</span>(d.toUTC<span class="hljs-built_in">String</span>());      // <span class="hljs-string">"Tue, 11 Nov 2025 09:00:00 GMT"</span>
console.<span class="hljs-built_in">log</span>(d.toISO<span class="hljs-built_in">String</span>());      // <span class="hljs-string">"2025-11-11T09:00:00.000Z"</span>
console.<span class="hljs-built_in">log</span>(d.toLocale<span class="hljs-built_in">String</span>());   // <span class="hljs-string">"2025/11/11 17:00:00"</span>
console.<span class="hljs-built_in">log</span>(
  <span class="hljs-keyword">new</span> Intl.DateTimeFormat(<span class="hljs-comment">'en-US', { timeZone: 'UTC' }).format(d)</span>
);                                 // <span class="hljs-string">"11/11/2025"</span>
</code></pre>
<p>ğŸ“Š <strong>æ€»ç»“å›¾ç¤ºï¼š</strong></p>









































<table><thead><tr><th>æ–¹æ³•</th><th>æ—¶åŒº</th><th>è¾“å‡ºå¯å®šåˆ¶</th><th>æ¨èç”¨é€”</th></tr></thead><tbody><tr><td><code>toUTCString()</code></td><td>UTC</td><td>âŒ</td><td>æœºå™¨å¯è¯»ã€HTTP Header</td></tr><tr><td><code>toGMTString()</code></td><td>UTC</td><td>âŒ</td><td>å·²åºŸå¼ƒ</td></tr><tr><td><code>toLocaleString()</code></td><td>æœ¬åœ°æ—¶åŒº</td><td>âœ…</td><td>ç”¨æˆ·ç•Œé¢å±•ç¤º</td></tr><tr><td><code>toISOString()</code></td><td>UTC</td><td>âŒ</td><td>æ•°æ®åºåˆ—åŒ–ã€å­˜å‚¨</td></tr><tr><td><code>Intl.DateTimeFormat</code></td><td>ä»»æ„</td><td>âœ…âœ…âœ…</td><td>æœ€å¼ºå›½é™…åŒ–æ§åˆ¶</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">äº”ã€æ½œåœ¨é—®é¢˜ä¸å®æˆ˜å»ºè®®</h2>






























<table><thead><tr><th>é—®é¢˜</th><th>è¯´æ˜</th><th>å»ºè®®</th></tr></thead><tbody><tr><td>ä¸åŒæµè§ˆå™¨æ ¼å¼å·®å¼‚</td><td>ç‰¹åˆ«æ˜¯ <code>toLocaleString()</code></td><td>æ˜¾å¼æŒ‡å®š locale + timeZone</td></tr><tr><td>æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æ—¶åŒºä¸ä¸€è‡´</td><td>SSR è¾“å‡º UTCã€CSR è¾“å‡ºæœ¬åœ°</td><td>ç»Ÿä¸€ timeZoneï¼ˆå¦‚ 'UTC' æˆ– 'Asia/Shanghai'ï¼‰</td></tr><tr><td>æƒ³ç»Ÿä¸€æ ¼å¼è¾“å‡º</td><td><code>toUTCString()</code> å¤ªå›ºå®š</td><td>æ”¹ç”¨ <code>Intl.DateTimeFormat</code> æˆ– <code>dayjs</code></td></tr><tr><td>ç§»åŠ¨ç«¯å·®å¼‚</td><td>ICU ç‰ˆæœ¬ä¸åŒ</td><td>é¿å…ä¾èµ–ç³»ç»Ÿé»˜è®¤æ ¼å¼</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-10">å…­ã€å®è·µæ¡ˆä¾‹ï¼šç»Ÿä¸€æ ¼å¼åŒ–å‡½æ•°å°è£…</h2>
<pre><code class="hljs language-php" lang="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatDate</span>(<span class="hljs-params">date, opts = {}</span>) </span>{
  <span class="hljs-keyword">const</span> {
    locale = <span class="hljs-string">'zh-CN'</span>,
    timeZone = <span class="hljs-string">'Asia/Shanghai'</span>,
    options = {}
  } = opts;

  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">fmt</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Intl</span>.<span class="hljs-title function_ invoke__">DateTimeFormat</span>(locale, {
    timeZone,
    <span class="hljs-attr">year</span>: <span class="hljs-string">'numeric'</span>,
    <span class="hljs-attr">month</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">day</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">hour</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">minute</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">second</span>: <span class="hljs-string">'2-digit'</span>,
    <span class="hljs-attr">hour12</span>: <span class="hljs-literal">false</span>,
    ...options
  });
  <span class="hljs-keyword">return</span> fmt.<span class="hljs-title function_ invoke__">format</span>(date);
}

console.<span class="hljs-title function_ invoke__">log</span>(<span class="hljs-title function_ invoke__">formatDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(), { <span class="hljs-attr">timeZone</span>: <span class="hljs-string">'UTC'</span> }));
<span class="hljs-comment">// è¾“å‡ºå¦‚ï¼š2025/11/11 09:00:00</span>
</code></pre>
<hr/>
<h2 data-id="heading-11">ä¸ƒã€ç»“è¯­ï¼šé€‰æ‹©å»ºè®®æ€»ç»“</h2>

























<table><thead><tr><th>åœºæ™¯</th><th>æ¨è API</th></tr></thead><tbody><tr><td>æœºå™¨é€šä¿¡ / JSON / HTTP</td><td><code>toISOString()</code> / <code>toUTCString()</code></td></tr><tr><td>ç”¨æˆ·ç•Œé¢æ˜¾ç¤ºï¼ˆå›½é™…åŒ–ï¼‰</td><td><code>toLocaleString()</code> æˆ– <code>Intl.DateTimeFormat</code></td></tr><tr><td>è·¨åŒºåŸŸä¸€è‡´æ€§ï¼ˆå‰åç«¯ï¼‰</td><td>å›ºå®šä½¿ç”¨ UTC + æ ¼å¼åŒ–æ§åˆ¶</td></tr><tr><td>éœ€è¦çµæ´»æ ¼å¼</td><td>ä½¿ç”¨ <code>Intl.DateTimeFormat</code> æˆ– <code>dayjs</code></td></tr></tbody></table>
<blockquote>
<p><strong>ä¸€å¥è¯æ€»ç»“ï¼š</strong></p>
<ul>
<li><code>toUTCString()</code>ï¼šæ ‡å‡†åŒ– UTC æ–‡æœ¬è¾“å‡º</li>
<li><code>toLocaleString()</code>ï¼šæœ¬åœ°åŒ–ç”¨æˆ·ç•Œé¢è¾“å‡º</li>
<li><code>toISOString()</code>ï¼šæ•°æ®ä¼ è¾“æ ‡å‡†è¾“å‡º</li>
<li><code>Intl.DateTimeFormat</code>ï¼šå›½é™…åŒ–ä¸è‡ªå®šä¹‰æ ¼å¼é¦–é€‰</li>
</ul>
</blockquote>
<hr/>
<p><strong>æœ¬æ–‡éƒ¨åˆ†å†…å®¹å€ŸåŠ© AI è¾…åŠ©ç”Ÿæˆï¼Œå¹¶ç”±ä½œè€…æ•´ç†å®¡æ ¸ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼ -- è‚˜å­çš„ Swift å‘¨æŠ¥ #0110]]></title>    <link>https://juejin.cn/post/7571060853354397706</link>    <guid>https://juejin.cn/post/7571060853354397706</guid>    <pubDate>2025-11-10T23:51:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571060853354397706" data-draft-id="7569960869960384558" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼ -- è‚˜å­çš„ Swift å‘¨æŠ¥ #0110"/> <meta itemprop="keywords" content="Swift,SwiftUI,Android"/> <meta itemprop="datePublished" content="2025-11-10T23:51:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ä¸œå¡è‚˜å­"/> <meta itemprop="url" content="https://juejin.cn/user/1548526032528727"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼ -- è‚˜å­çš„ Swift å‘¨æŠ¥ #0110
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1548526032528727/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ä¸œå¡è‚˜å­
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T23:51:42.000Z" title="Mon Nov 10 2025 23:51:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d496c218bf294f099d0095add69c9539~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5Lic5Z2h6IKY5a2Q:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763423502&amp;x-signature=OMBm0tFy%2FRq2TKfkWoEhv1y%2FKZA%3D" alt="issue110.webp" loading="lazy"/></p>
<blockquote>
<p>ğŸ“® æƒ³æŒç»­å…³æ³¨ Swift æŠ€æœ¯å‰æ²¿ï¼Ÿ</p>
<p>æ¯å‘¨ä¸€æœŸã€Šè‚˜å­çš„ Swift å‘¨æŠ¥ã€‹ï¼Œä¸ºä½ ç²¾é€‰æœ¬å‘¨æœ€å€¼å¾—å…³æ³¨çš„ Swiftã€SwiftUI æŠ€æœ¯æ–‡ç« ã€å¼€æºé¡¹ç›®å’Œç¤¾åŒºåŠ¨æ€ã€‚</p>
<ul>
<li>ğŸ“¬ åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com" target="_blank" title="https://weekly.fatbobman.com" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> å…è´¹è®¢é˜…</li>
<li>ğŸ’¬ åŠ å…¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> ä¸ä¸­æ–‡ Swift å¼€å‘è€…æ·±å…¥äº¤æµ</li>
<li>ğŸ“š è®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> æŸ¥çœ‹æ•°ç™¾ç¯‡æ·±åº¦åŸåˆ›æ•™ç¨‹Â </li>
</ul>
<p>ä¸€èµ·æ„å»ºæ›´å¥½çš„ Swift åº”ç”¨ï¼ğŸš€</p>
</blockquote>
<h2 data-id="heading-0">Skip Fuseç°åœ¨å¯¹ç‹¬ç«‹å¼€å‘è€…å…è´¹ï¼</h2>
<p>åœ¨ Swift ç¤¾åŒº<a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-108%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/weekly/issue-108/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">å‘å¸ƒå®˜æ–¹ Android ç‰ˆ SDK</a> ä¸ä¹…ä¹‹åï¼ŒSkip å®£å¸ƒå…¶ <a href="https://link.juejin.cn?target=https%3A%2F%2Fskip.tools%2Fblog%2Fskip-fuse-free-for-indies%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://skip.tools/blog/skip-fuse-free-for-indies/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">Skip Fuse ç‰ˆæœ¬å°†å¯¹ç¬¦åˆæ¡ä»¶çš„ç‹¬ç«‹å¼€å‘è€…å…è´¹å¼€æ”¾</a>ï¼Œç”¨äºæ„å»º Android åº”ç”¨ã€‚</p>
<p>ä¸è¿‡å»ä¸€å¹´å¤šç‹¬ç«‹å¼€å‘è€…å¯å…è´¹ä½¿ç”¨çš„ Skip Lite ç›¸æ¯”ï¼ŒSkip Fuse å¸¦æ¥äº†å®è´¨æ€§çš„æŠ€æœ¯å˜é©ã€‚Skip Lite çš„åŸç†æ˜¯å°† Swift ä»£ç è½¬è¯‘ä¸º Kotlinï¼Œè€Œ Skip Fuse åˆ™ç›´æ¥åˆ©ç”¨ Swift å®˜æ–¹ Android SDK è¿›è¡Œäº¤å‰ç¼–è¯‘ï¼Œå°† Swift æºç ç¼–è¯‘ä¸ºå¯åœ¨ Android å¹³å°ä¸ŠåŸç”Ÿè¿è¡Œçš„ ARM äºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™æ„å‘³ç€å¼€å‘è€…ä¸å†å±€é™äºâ€œå…·æœ‰ Skip æ„ŸçŸ¥â€çš„ä¾èµ–åŒ…ï¼Œè€Œå¯ä»¥ä½¿ç”¨ä»»ä½•èƒ½åœ¨ Android ä¸Šç¼–è¯‘çš„ Swift åŒ…ã€‚</p>
<p>æ ¹æ® <a href="https://link.juejin.cn?target=https%3A%2F%2Fswift-everywhere.org%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://swift-everywhere.org/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">Swift Everywhere</a> çš„ç»Ÿè®¡ï¼Œç›®å‰å·²æœ‰è¶…è¿‡ 2000 ä¸ª Swift Package æ”¯æŒ Android å¹³å°ï¼Œå…¶ä¸­åŒ…æ‹¬ Alamofireã€SwiftSoupã€swift-sqlcipher ç­‰å¸¸ç”¨åº“ã€‚æ¢å¥è¯è¯´ï¼ŒFuse æ¨¡å¼è®©å¼€å‘è€…èƒ½å¤Ÿå……åˆ†åˆ©ç”¨æ ‡å‡† SwiftPM ç”Ÿæ€ã€‚è¿™ä¸ä»…æ˜¾è‘—æ‹“å®½äº†å¯ç”¨ä¾èµ–çš„èŒƒå›´ï¼Œä¹Ÿé™ä½äº†é¡¹ç›®è¿ç§»ä¸ç»´æŠ¤çš„å¤æ‚åº¦ã€‚</p>
<p>åœ¨æ¶æ„å±‚é¢ä¸Šï¼ŒSkip Fuse é‡‡ç”¨äº†æ··åˆå®ç°æ–¹æ¡ˆï¼šä¸šåŠ¡é€»è¾‘éƒ¨åˆ†ç”±åŸç”Ÿ Swift ç›´æ¥ç¼–è¯‘æ‰§è¡Œï¼Œè€Œ UI å±‚çš„ SwiftUI DSL åˆ™åœ¨æ„å»ºè¿‡ç¨‹ä¸­ç”± Skip Fuse UI æ¨¡å—æ˜ å°„ä¸º Jetpack Compose ä»£ç ï¼Œä»è€Œåœ¨ Android ä¸Šå‘ˆç°å‡ºå®Œå…¨åŸç”Ÿçš„ç”¨æˆ·ä½“éªŒã€‚è¿™ç§åšæ³•æ—¢ä¿ç•™äº† SwiftUI çš„å£°æ˜å¼è¯­æ³•ï¼Œåˆéµå¾ªäº† Android å¹³å°çš„è®¾è®¡è§„èŒƒã€‚</p>
<p>æ­¤æ¬¡æ”¿ç­–è°ƒæ•´ï¼Œæˆ–è®¸ä¼šè®©è®¸å¤šç‹¬ç«‹å¼€å‘è€…å’Œä¸­å°å›¢é˜Ÿåœ¨æŠ€æœ¯é€‰å‹ä¸Šæ›´å€¾å‘äºå…·å¤‡è·¨å¹³å°æ½œåŠ›çš„æ–¹æ¡ˆã€‚å³ä¾¿ç»§ç»­ä¸»è¦é¢å‘ Apple ç”Ÿæ€è¿›è¡Œå¼€å‘ï¼ˆä½¿ç”¨è‹¹æœç§æœ‰æ¡†æ¶ï¼‰ï¼Œä¹Ÿå¯èƒ½å¼€å§‹åœ¨æ¶æ„ä¸­åŠ å…¥æŠ½è±¡å±‚ï¼Œä¸ºæœªæ¥çš„å¤šå¹³å°æ‹“å±•é¢„ç•™ç©ºé—´ã€‚</p>
<p>å½“ç„¶ï¼ŒSkip å¯¹â€œç‹¬ç«‹å¼€å‘è€…â€çš„å®šä¹‰ä¹Ÿæœ‰æ˜ç¡®é™åˆ¶ï¼šä»…é€‚ç”¨äºä¸ªäººæˆ–ä¸è¶…è¿‡ä¸¤äººçš„å›¢é˜Ÿï¼Œå¹´æ”¶å…¥éœ€ä½äº 30,000 ç¾å…ƒï¼Œå¹¶ä¸”å…è´¹è®¸å¯ä»…å…è®¸å‘å¸ƒä¸€ä¸ªé—­æºå•†ä¸šåº”ç”¨ï¼ˆå¼€æºé¡¹ç›®æ•°é‡ä¸é™ï¼‰ã€‚å³ä¾¿å¦‚æ­¤ï¼Œè¿™ä¸€æ”¿ç­–ä»ä¸º Swift å¼€å‘è€…ä»¥è¿‘ä¹é›¶æˆæœ¬çš„æ–¹å¼è¿›å…¥ Android å¸‚åœºæ‰“å¼€äº†å¤§é—¨ï¼Œä¸ºä»–ä»¬åœ¨è¿™ä¸€åºå¤§å¹³å°ä¸Šæ¢ç´¢æ–°çš„å¯èƒ½ä¸æ”¶å…¥æ¥æºæä¾›äº†å¥‘æœºã€‚</p>
<p>å°½ç®¡æœªæ¥è¿˜ä¼šå‡ºç°æ›´å¤šé¢å‘ Swift çš„è·¨å¹³å°å¼€å‘æ–¹æ¡ˆï¼Œä½† Skip å·²ç»ä¸º Swift åœ¨ Android ç”Ÿæ€ä¸­çš„è½åœ°æä¾›äº†ä¸€æ¡æ¸…æ™°ã€å¯è¡Œçš„è·¯å¾„ã€‚ç¤¾åŒºä¹Ÿæ­£æœŸå¾…ç€ç±»ä¼¼ Skip è¿™æ ·æˆç†Ÿçš„è·¨å¹³å°æ–¹æ¡ˆèƒ½å¤Ÿæ‰©å±•è‡³ Linuxã€Windows ä¹ƒè‡³åµŒå…¥å¼å¹³å°ï¼Œä¸º Swift çš„å¤šå¹³å°å‘å±•å¥ å®šæ›´åšå®çš„åŸºç¡€ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-110%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-110/" ref="nofollow noopener noreferrer">æœ¬æœŸå†…å®¹</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-109%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-109/" ref="nofollow noopener noreferrer">å‰ä¸€æœŸå†…å®¹</a> | <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2F" target="_blank" title="https://fatbobman.com/zh/weekly/" ref="nofollow noopener noreferrer">å…¨éƒ¨å‘¨æŠ¥åˆ—è¡¨</a></p>
<h2 data-id="heading-1">è¿‘æœŸæ¨è</h2>
<h3 data-id="heading-2"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-01" target="_blank" title="https://l.fatbobman.com/w0110-01" ref="nofollow noopener noreferrer">SwiftData çš„ä¼˜é›…å–æ¶ˆç¼–è¾‘æ–¹æ¡ˆï¼šä»æ··ä¹±åˆ°è‰ºæœ¯ (The Art of SwiftData in 2025: From Scattered Pieces to a Masterpiece)</a></h3>
<p>ç”±äºå–æ¶ˆäº†çˆ¶å­ä¸Šä¸‹æ–‡çš„æ¦‚å¿µï¼ŒSwiftData åœ¨å®ç°â€œå¯æ’¤é”€ä¿®æ”¹â€æ–¹é¢å˜å¾—æ›´åŠ æ£˜æ‰‹ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fmathisgnt%2F" target="_blank" title="https://www.linkedin.com/in/mathisgnt/" ref="nofollow noopener noreferrer">Mathis Gaignet</a> åœ¨è¿™ç¯‡é•¿æ–‡ä¸­ï¼Œé€šè¿‡æ„å»ºä¸€ä¸ªä¸“ç”¨äºç¼–è¾‘çŠ¶æ€çš„ç‹¬ç«‹ <code>ModelContext</code>ï¼Œé˜è¿°äº†åœ¨ SwiftData ä¸­å®ç°â€œå¯æ’¤é”€ã€å¯å¤ç”¨ã€ä½æ ·æ¿â€å¢æ”¹ï¼ˆUpsertï¼‰æ¶æ„çš„æ€è·¯ï¼Œç”¨ä»¥å–ä»£æ•£ä¹±çš„è¡¨å•çŠ¶æ€ä¸è„†å¼±çš„å›æ»šæ–¹æ¡ˆã€‚</p>
<p>ä½œè€…å¹¶æœªç›´æ¥ç»™å‡ºâ€œæ ‡å‡†ç­”æ¡ˆâ€ï¼Œè€Œæ˜¯å®Œæ•´å±•ç¤ºäº†ä»é—®é¢˜å‘ç°åˆ°æ–¹æ¡ˆæ¼”è¿›çš„æ€è€ƒè·¯å¾„ã€‚æ–‡ç« æ·±å…¥è§£æäº† <code>@Model</code>ã€<code>@Query</code> å®çš„åº•å±‚æœºåˆ¶ï¼Œæ­ç¤ºäº† <code>PersistentIdentifier</code> çš„ä¸´æ—¶ä¸æ°¸ä¹…çŠ¶æ€é™·é˜±ï¼Œä»¥åŠä¸Šä¸‹æ–‡åŒæ­¥å»¶è¿Ÿå¯¼è‡´çš„éšè”½ Bugã€‚è¿™ç§æ¢ç´¢å¼çš„å†™ä½œæ–¹å¼ï¼Œä½¿è¯»è€…ä¸ä»…æ˜ç™½â€œæ€ä¹ˆåšâ€ï¼Œæ›´ç†è§£â€œä¸ºä»€ä¹ˆè¿™æ ·åšâ€ã€‚</p>
<hr/>
<h3 data-id="heading-3"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-02" target="_blank" title="https://l.fatbobman.com/w0110-02" ref="nofollow noopener noreferrer">ä» SPM é¡¹ç›®ç®¡ç†è¿ç§»åˆ° Tuist é¡¹ç›®ç®¡ç† (Back Market x Tuist - Part I: Why We Moved Our iOS Project To Tuist)</a></h3>
<p>åœ¨ Swift é¡¹ç›®ä¸­ï¼ŒSPM é™¤äº†è´Ÿè´£ä»£ç æ¨¡å—åŒ–ï¼Œä¹Ÿæ‰¿æ‹…äº†é¡¹ç›®ç»“æ„ç®¡ç†çš„èŒè´£ã€‚ç„¶è€Œï¼Œéšç€é¡¹ç›®è§„æ¨¡çš„æ‰©å¤§ï¼Œè¿™ç§æ–¹å¼çš„å±€é™é€æ¸æ˜¾ç°ï¼šä¾èµ–è§£æé¢‘ç¹ã€ç¼ºä¹æ„å»ºè®¾ç½®å’Œè‡ªå®šä¹‰é˜¶æ®µã€æ— æ³•è¿è¡Œè„šæœ¬ã€xcodeproj æ–‡ä»¶æ˜“å†²çªã€æ¨¡å—é—´è§„åˆ™éš¾ä»¥ç»Ÿä¸€ï¼Œä¸” SPM æ’ä»¶èƒ½åŠ›æœ‰é™ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Falbsala%2F" target="_blank" title="https://www.linkedin.com/in/albsala/" ref="nofollow noopener noreferrer">Alberto Salas</a> åœ¨æœ¬æ–‡ä¸­ä»‹ç»äº†å…¶å›¢é˜Ÿå¦‚ä½•å°†é¡¹ç›®ç»“æ„ç®¡ç†ä» SPM Packages è¿ç§»è‡³ Tuist Targetsï¼Œå¹¶ç³»ç»Ÿæ¢³ç†äº†é—®é¢˜æˆå› ã€æ¢ç´¢è·¯å¾„ä¸å†³ç­–è¿‡ç¨‹ã€‚åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-11" target="_blank" title="https://l.fatbobman.com/w0110-11" ref="nofollow noopener noreferrer">Part II</a> ä¸­ï¼Œä»–è¿›ä¸€æ­¥åˆ†äº«äº†å¦‚ä½•åœ¨ä¸é˜»å¡æ—¥å¸¸å¼€å‘çš„å‰æä¸‹å®Œæˆè¿ç§»ï¼Œå¹¶é‡åŒ–äº†æ„å»ºæ€§èƒ½çš„æå‡ã€‚</p>
<blockquote>
<p>æœ¬æ–‡å¹¶éè¦æŠ›å¼ƒ SPMï¼Œè€Œæ˜¯å°†é¡¹ç›®ç»“æ„ä¸ç”Ÿæˆå·¥ä½œäº¤ç”± Tuist æ¥ç®¡ï¼Œä¾èµ–ç®¡ç†ä¾ç„¶ç”± SPM è´Ÿè´£ã€‚æ–‡ç« è¿˜æ¯”è¾ƒäº† SPMã€Bazel ä¸ Tuist çš„ä¸åŒå–èˆã€‚ä½œè€…æŒ‡å‡ºï¼ŒBazel åŠŸèƒ½æ›´å¼ºå¤§ï¼Œä½†æœ€ç»ˆé€‰æ‹© Tuistï¼Œæ˜¯å› ä¸ºå®ƒæ›´ç¬¦åˆå›¢é˜Ÿèƒ½åŠ›ä¸é¡¹ç›®ç‰¹æ€§ã€‚è¿™ä¹Ÿæé†’æˆ‘ä»¬ï¼Œå·¥å…·é€‰å‹çš„å…³é”®ä¸åœ¨â€œæœ€å¼ºâ€ï¼Œè€Œåœ¨â€œæœ€åˆé€‚â€â€”â€”å°¤å…¶å¯¹äºä¸­å°å‹å›¢é˜Ÿï¼Œå¯è‡ªä¸»æŒæ§ã€æ˜“äºç»´æŠ¤çš„æ–¹æ¡ˆå¾€å¾€æ›´å…·é•¿æœŸä»·å€¼ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-4"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-03" target="_blank" title="https://l.fatbobman.com/w0110-03" ref="nofollow noopener noreferrer">è®©åº”ç”¨æ›´æ‡‚ç”¨æˆ·è¯­è¨€ï¼šLanguage Discovery çš„ä¸ªæ€§åŒ–æ–°æœºåˆ¶ (Making Apps More Personal with Language Discovery)</a></h3>
<p>ä¼ ç»Ÿçš„â€œé€‰æ‹©ä¸»è¦è¯­è¨€â€(<code>Locale.preferredLanguages</code>) æ¨¡å¼å‡è®¾æ¯ä½ç”¨æˆ·éƒ½æœ‰å•ä¸€è¯­è¨€åå¥½ï¼Œä½†ç°å®ä¸­äººä»¬å¾€å¾€åœ¨ä¸åŒæƒ…å¢ƒä¸‹ä½¿ç”¨å¤šç§è¯­è¨€â€”â€”ä¾‹å¦‚åœ¨å·¥ä½œä¸­ä½¿ç”¨è‹±è¯­ã€åœ¨ç¤¾äº¤ä¸­ä½¿ç”¨æ³•è¯­ã€åœ¨åª’ä½“æ¶ˆè´¹ä¸­ä½¿ç”¨è¥¿ç­ç‰™è¯­ã€‚è‹¹æœåœ¨ iOS 26 ä¸­æ·»åŠ äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.apple.com%2Fvideos%2Fplay%2Fwwdc2025%2F222%2F" target="_blank" title="https://developer.apple.com/videos/play/wwdc2025/222/" ref="nofollow noopener noreferrer">Language Discovery</a> åŠŸèƒ½ï¼Œé€šè¿‡è®¾å¤‡ç«¯çš„æœºå™¨å­¦ä¹ ï¼Œåœ¨ç¡®ä¿éšç§çš„å‰æä¸‹ï¼ŒåŸºäºç”¨æˆ·çš„è¾“å…¥æ¨¡å¼ã€å†…å®¹æ¶ˆè´¹ã€æ²Ÿé€šè¯­è¨€ä»¥åŠåº”ç”¨åå¥½ç­‰è¡Œä¸ºæ•°æ®ï¼Œè‡ªåŠ¨æ¨æ–­ç”¨æˆ·çš„è¯­è¨€ä½¿ç”¨ä¹ æƒ¯ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fletizia-granata%2F" target="_blank" title="https://www.linkedin.com/in/letizia-granata/" ref="nofollow noopener noreferrer">Letizia Granata</a> åœ¨æ–‡ä¸­ä»‹ç»äº†è¿™ä¸€æ™ºèƒ½è¯†åˆ«ç”¨æˆ·è¯­è¨€åå¥½çš„ç³»ç»Ÿæœºåˆ¶ã€‚</p>
<blockquote>
<p>é€šè¿‡ Language Discoveryï¼Œåº”ç”¨å¯ä»¥æ›´å‡†ç¡®åœ°å“åº”ç”¨æˆ·çš„è¯­è¨€ä¸æ–‡åŒ–èƒŒæ™¯ï¼Œä»è€Œåœ¨æœ¬åœ°åŒ–å±‚é¢å®ç°ä¸ªæ€§åŒ–ã€‚è¿™é¡¹åŠŸèƒ½æ ‡å¿—ç€è‹¹æœåœ¨å¤šè¯­è¨€æ”¯æŒä¸Šçš„ä¸€æ¬¡é‡è¦è½¬å˜ï¼šä»è¢«åŠ¨é…ç½®èµ°å‘ä¸»åŠ¨ç†è§£ï¼Œä»å•ä¸€è¯­è¨€åˆ°å¤šè¯­å…±å­˜ï¼Œä¸ºå¼€å‘è€…æä¾›äº†æ‰“é€ æ›´åŒ…å®¹ã€æ›´çœŸå®åº”ç”¨ä½“éªŒçš„æ–°åŸºç¡€ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-5"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-04" target="_blank" title="https://l.fatbobman.com/w0110-04" ref="nofollow noopener noreferrer">å…³äº Xcode 26.1 CPU å¼‚å¸¸å ç”¨çš„æé†’å’Œä¸´æ—¶è§£å†³æ–¹æ¡ˆ</a></h3>
<p>iOS å¼€å‘è€… <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Fartem-mirzabekian%2F" target="_blank" title="https://www.linkedin.com/in/artem-mirzabekian/" ref="nofollow noopener noreferrer">Artem Mirzabekian</a> æŒ‡å‡ºï¼ŒXcode 26.1 åœ¨è¿è¡Œ iOS 26.1 æ¨¡æ‹Ÿå™¨æ—¶ä¼šå‡ºç°å¼‚å¸¸çš„ CPU å ç”¨é—®é¢˜ã€‚åŸå› æ˜¯ iOS 26.1 æ¨¡æ‹Ÿå™¨ä¸­ä¸å£çº¸æ¸²æŸ“ç›¸å…³çš„ <code>MercuryPosterExtension</code> è¿›ç¨‹æŒç»­å´©æºƒå¹¶é‡å¯ï¼Œå¯¼è‡´ CPU å¼‚å¸¸å ç”¨ã€‚Xcode 26.2ï¼ˆbeta ç‰ˆï¼‰ç›®å‰ä¹Ÿå—å½±å“ã€‚</p>
<p>ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ iOS 26.0 æ¨¡æ‹Ÿå™¨ï¼Œæˆ–åœ¨ iOS 26.1 æ¨¡æ‹Ÿå™¨ä¸­æ›´æ¢å£çº¸å¹¶åˆ é™¤é»˜è®¤çš„çº¯é»‘å£çº¸ã€‚</p>
<hr/>
<h3 data-id="heading-6">Swift 6 å¹¶å‘æ¨¡å‹ï¼šæŠ€æœ¯æŒ‘æˆ˜ä¸ç¤¾åŒºäº‰è®®</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fmjtsai" target="_blank" title="https://x.com/mjtsai" ref="nofollow noopener noreferrer">Michael Tsai</a> æ±‡æ€»äº†ä¸¤ç»„å…³äº Swift 6 å¹¶å‘çš„é‡è¦è®¨è®ºã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-05" target="_blank" title="https://l.fatbobman.com/w0110-05" ref="nofollow noopener noreferrer">ç¬¬ä¸€ç¯‡</a> å…³æ³¨ Swift 6.2 æ¨å‡ºçš„ â€œApproachable Concurrencyâ€ æ”¹è¿›ï¼›<a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-06" target="_blank" title="https://l.fatbobman.com/w0110-06" ref="nofollow noopener noreferrer">ç¬¬äºŒç¯‡</a> åˆ™èšç„¦å…·ä½“æŠ€æœ¯è®®é¢˜ï¼Œå¦‚ <code>MainActor.assumeIsolated</code> ä¸ <code>@preconcurrency</code> çš„å®é™…ä½¿ç”¨ä¸é™åˆ¶ï¼›</p>
<p>ç¤¾åŒºè§‚ç‚¹å‘ˆç°æ˜æ˜¾åˆ†åŒ–ã€‚æ”¯æŒè€…è®¤ä¸ºï¼Œé»˜è®¤ä¸»çº¿ç¨‹éš”ç¦»æœ‰æ•ˆé˜²æ­¢äº†â€œæ„å¤–è·‘åˆ°åå°çº¿ç¨‹â€çš„å¸¸è§é—®é¢˜ï¼Œé™ä½äº†åˆå­¦è€…ä¸ UI å¯†é›†å‹é¡¹ç›®çš„ä¸Šæ‰‹éš¾åº¦ï¼Œä¸€äº›å›¢é˜Ÿå·²ç»æˆåŠŸå®Œæˆå¤§å‹åº”ç”¨çš„è¿ç§»ã€‚è´¨ç–‘è€…åˆ™æŒ‡å‡ºï¼Œå®Œæ•´çš„ UIKit åº”ç”¨ä»éš¾ä»¥å…¨é¢é‡‡ç”¨ Swift 6 æ¨¡å¼ï¼Œä¸ Core Data å’Œç¬¬ä¸‰æ–¹æ¡†æ¶çš„é›†æˆé—®é¢˜é¢‘å‡ºï¼Œé”™è¯¯ä¿¡æ¯æ™¦æ¶©éš¾æ‡‚ï¼Œè€Œè¯­è¨€çš„æŒç»­æ¼”è¿›ä¹Ÿè®©ä»£ç ä¸æ–­è€åŒ–ã€‚æ›´æ¿€è¿›çš„å£°éŸ³ç”šè‡³è®¤ä¸ºå½“å‰å¹¶å‘æ¨¡å‹å·²æˆä¸ºâ€œæ— æ³•ååŒè¿ä½œçš„æ‹¼å‡‘ä½“ç³»â€ï¼Œéœ€è¦ä¸€æ¬¡â€œå½»åº•é‡ç½®â€ã€‚</p>
<p>æ•´ä½“å…±è¯†æ˜¯ï¼šSwift 6 å¹¶å‘æœºåˆ¶çš„æ”¶ç›Šé«˜åº¦ä¾èµ–é¡¹ç›®çš„å¹¶å‘å¤æ‚åº¦â€”â€”å¯¹å•çº¿ç¨‹æˆ– UI é©±åŠ¨å‹åº”ç”¨å¸®åŠ©æ˜¾è‘—ï¼Œä½†å¯¹äºå¹¶å‘å¯†é›†æˆ–ç³»ç»Ÿè€¦åˆåº¦é«˜çš„é¡¹ç›®ï¼Œè¿ç§»ä»å……æ»¡æŒ‘æˆ˜ã€‚</p>
<hr/>
<h3 data-id="heading-7"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-07" target="_blank" title="https://l.fatbobman.com/w0110-07" ref="nofollow noopener noreferrer">æ·±å…¥è§£æ visionOS ä¸Šçš„åŠ¨ç”»æœºåˆ¶ (Deep Dive into Animation on visionOS)</a></h3>
<p>ç©ºé—´è®¡ç®—ä¸ä»…æ”¹å˜äº†ç”¨æˆ·ä½“éªŒï¼Œä¹Ÿå¯¹å¼€å‘è€…æå‡ºäº†æ›´é«˜çš„è¦æ±‚â€”â€”è®¸å¤šåœ¨å¹³é¢ç•Œé¢ä¸­è¡Œä¹‹æœ‰æ•ˆçš„æŠ€å·§ï¼Œåœ¨ä¸‰ç»´ç©ºé—´ä¸­å·²ä¸å†é€‚ç”¨ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.linkedin.com%2Fin%2Felkraneo%2F" target="_blank" title="https://www.linkedin.com/in/elkraneo/" ref="nofollow noopener noreferrer">Cristian DÃ­az</a> ä»â€œç©ºé—´äº¤äº’çš„å¯æ„ŸçŸ¥æ€§ä¸èˆ’é€‚æ€§â€å‡ºå‘ï¼Œæå‡ºäº†ä¸€ä¸ªåŠ¨ç”»å†³ç­–æ¡†æ¶ï¼šè°åˆ›ä½œåŠ¨ç”»ï¼ˆè®¾è®¡å¸ˆé¢„åˆ¶ vs. è¿è¡Œæ—¶ç”Ÿæˆï¼‰ã€ä»€ä¹ˆéœ€è¦åŠ¨ç”»ï¼ˆSwiftUI çª—å£ vs. RealityKit å®ä½“ï¼‰ã€å¤æ‚åº¦å¦‚ä½•ï¼ˆå¾®äº¤äº’ vs. ç¼–æ’è¡¨æ¼”)ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä»–ç³»ç»Ÿæ¢³ç†äº† visionOS çš„äº”æ¡æ¸²æŸ“è·¯å¾„ä¸åç§åŠ¨ç”»æœºåˆ¶ï¼Œä¸ºæ¯ç§æ–¹æ¡ˆæ˜ç¡®åˆ—å‡ºé€‚ç”¨åœºæ™¯ã€é¿å…æƒ…å½¢ä¸å®ç°è¦ç‚¹ã€‚</p>
<blockquote>
<p>å³ä¾¿ä½ å¹¶é visionOS å¼€å‘è€…ï¼Œä¹Ÿèƒ½ä»è¿™ç¯‡æ–‡ç« ä¸­å—ç›Šã€‚Cristian ä»¥â€œä»æ„ŸçŸ¥éœ€æ±‚æ¨å¯¼æŠ€æœ¯é€‰æ‹©â€çš„æ–¹å¼è¯ é‡Šäº†åŠ¨ç”»è®¾è®¡æ€ç»´ï¼Œè¿™ç§æ–¹æ³•åŒæ ·é€‚ç”¨äºå…¶ä»–å¹³å°å’Œç•Œé¢çš„åŠ¨æ€è®¾è®¡ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-8"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-08" target="_blank" title="https://l.fatbobman.com/w0110-08" ref="nofollow noopener noreferrer">ä½¿ç”¨ Instruments æ‰¾å‡º SwiftUI ä¸­æ›´æ–°æœ€é¢‘ç¹çš„è§†å›¾ (Find the SwiftUI Views that Update the Most Using Instruments)</a></h3>
<p>Xcode 26 ä¸º Instruments æ–°å¢äº† SwiftUI ä¸“ç”¨çš„åˆ†æå·¥å…·ï¼Œå¯ç»Ÿè®¡è§†å›¾çš„æ›´æ–°æ¬¡æ•°ä¸è€—æ—¶ï¼Œå¹¶é€šè¿‡ All Updates Summary ä¸ Cause &amp; Effect Graph å®šä½å“ªäº›è§†å›¾â€œæ›´æ–°è¿‡äºé¢‘ç¹â€ä»¥åŠå…·ä½“è§¦å‘é“¾è·¯ã€‚<a href="https://link.juejin.cn?target=https%3A%2F%2Fmastodon.world%2F%40swiftdevjournal" target="_blank" title="https://mastodon.world/@swiftdevjournal" ref="nofollow noopener noreferrer">Mark Szymczyk</a> ä»¥å®æ“ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åˆ›å»º SwiftUI Profiling ä¼šè¯ã€æŒ‰æ›´æ–°æ¬¡æ•°/è€—æ—¶æ’åºè§†å›¾ï¼Œå¹¶ç”¨å› æœå›¾è¿½è¸ªæ›´æ–°æ¥æºã€‚</p>
<blockquote>
<p>æ’æŸ¥ç—‡çŠ¶ä¹‹å¤–ï¼Œæ›´åº”ç†è§£ SwiftUI çš„åˆ·æ–°åŸç†ï¼Œæ‰èƒ½ä»æºå¤´å‡å°‘æ— æ•ˆé‡ç»˜ã€‚åœ¨æˆ‘çš„æ–‡ç« <a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fposts%2Funderstanding-swiftui-view-update-mechanism%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://fatbobman.com/zh/posts/understanding-swiftui-view-update-mechanism/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">ç†è§£ SwiftUI çš„è§†å›¾åˆ·æ–°æœºåˆ¶ï¼šä» TimelineView åˆ·æ–°é—®é¢˜è°ˆèµ·</a>ä¸­ï¼Œå€Ÿç”± TimelineView ä¸ªæ¡ˆç³»ç»Ÿé˜è¿°äº†è§†å›¾å£°æ˜ã€å“åº”æœºåˆ¶ä¸é€’å½’æ›´æ–°çš„åˆ¤å®šé€»è¾‘ã€‚åªæœ‰ææ¸…â€œä¸ºä»€ä¹ˆè§†å›¾ä¼šæ›´æ–°â€ã€â€œç³»ç»Ÿå¦‚ä½•å†³å®šæ˜¯å¦é‡ç®—è§†å›¾å£°æ˜å€¼â€ï¼Œä¼˜åŒ–æ‰ä¸ä¼šæ²¦ä¸ºè¡¥ä¸å¼ä¿®ä¿®è¡¥è¡¥ã€‚</p>
</blockquote>
<h2 data-id="heading-9">å·¥å…·</h2>
<h3 data-id="heading-10"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-09" target="_blank" title="https://l.fatbobman.com/w0110-09" ref="nofollow noopener noreferrer">imessage-kitï¼šåœ¨ AI Agent ä¸­æä¾›æ¶ˆæ¯é›†æˆèƒ½åŠ›</a></h3>
<p>imessage-kit æ˜¯ä¸€ä¸ªç”± <a href="https://link.juejin.cn?target=https%3A%2F%2Fx.com%2Fphoton_hq" target="_blank" title="https://x.com/photon_hq" ref="nofollow noopener noreferrer">Photon</a> å¼€å‘çš„åŠŸèƒ½å¼ºå¤§çš„ iMessage å¼€æº SDKï¼Œéå¸¸é€‚åˆå°† iMessage é›†æˆåˆ° AI æ™ºèƒ½ä½“æˆ–è‡ªåŠ¨åŒ–å·¥ä½œæµä¸­ã€‚å…¶ä¸»è¦åŠŸèƒ½æœ‰:</p>
<ul>
<li><strong>ç°ä»£åŒ–çš„ API</strong>ï¼šæä¾›ä¼˜é›…çš„é“¾å¼è°ƒç”¨ï¼ˆFluent APIï¼‰ï¼Œå¯ä»¥è½»æ¾å®ç°â€œæ”¶åˆ°æ¶ˆæ¯ Aï¼Œåˆ™å›å¤ Bâ€çš„é€»è¾‘ã€‚</li>
<li><strong>åŠŸèƒ½å…¨é¢</strong>ï¼šä¸ä»…æ”¯æŒæ”¶å‘æ–‡æœ¬ï¼Œè¿˜èƒ½å¤„ç†å›¾ç‰‡ã€å„ç±»æ–‡ä»¶ï¼Œå¹¶èƒ½å®æ—¶ç›‘æ§æ–°æ¶ˆæ¯ã€‚</li>
<li><strong>ç±»å‹å®‰å…¨ä¸è·¨è¿è¡Œæ—¶</strong>ï¼šå®Œå…¨ä½¿ç”¨ TypeScript ç¼–å†™ï¼Œç±»å‹æ”¯æŒè‰¯å¥½ï¼Œå¹¶åŒæ—¶å…¼å®¹ Node.js å’Œ Bunã€‚</li>
<li><strong>AI é›†æˆå‹å¥½</strong>ï¼šå®˜æ–¹å®šä½å°±æ˜¯ä¸º AI Agent æä¾›æ¶ˆæ¯é›†æˆèƒ½åŠ›ï¼Œæ˜¯è¿æ¥ç‰©ç†ä¸–ç•Œå’Œ AI çš„ä¸€ä¸ªæœ‰è¶£å°è¯•ã€‚</li>
</ul>
<p>å®ƒé€šè¿‡ç›´æ¥è¯»å– iMessage æ•°æ®åº“(<code>chat.db</code>)å¹¶ç»“åˆ AppleScript å®ç°è‡ªåŠ¨åŒ–,å› æ­¤ä»…é™ macOS ä½¿ç”¨ï¼Œä¸”éœ€è¦æˆäºˆåº”ç”¨"å®Œå…¨ç£ç›˜è®¿é—®æƒé™"ã€‚</p>
<blockquote>
<p>è¯¥åº“é‡‡ç”¨ SSPL-1.0 è®¸å¯è¯ï¼Œç¦æ­¢ç”¨äºåˆ›å»ºç«äº‰äº§å“ï¼ˆå¦‚å…¶ä»–æ¶ˆæ¯ SDK/APIï¼‰ï¼Œä½†å…è®¸ç”¨äºå†…éƒ¨ä¸šåŠ¡ã€ä¸ªäººé¡¹ç›®å’Œæ•™è‚²ç”¨é€”ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒPhoton è¿˜æä¾›é«˜çº§ç‰ˆæœ¬ï¼Œæ”¯æŒçº¿ç¨‹å›å¤ã€æ¶ˆæ¯æ’¤å›/ç¼–è¾‘ã€å®æ—¶è¾“å…¥æŒ‡ç¤ºå™¨ç­‰åŠŸèƒ½ï¼Œä»¥åŠä¼ä¸šçº§æ‰˜ç®¡æœåŠ¡ã€‚æ›´å¤šå†…å®¹å¯ä»¥åœ¨å…¶<a href="https://link.juejin.cn?target=https%3A%2F%2Fphoton.codes%2F%3Futm_source%3Dfatbobman%2520weekly%2520issue%2520110%26utm_medium%3Dweb" target="_blank" title="https://photon.codes/?utm_source=fatbobman%20weekly%20issue%20110&amp;utm_medium=web" ref="nofollow noopener noreferrer">å®˜ç½‘</a>è·å–ã€‚</p>
</blockquote>
<hr/>
<h3 data-id="heading-11"><a href="https://link.juejin.cn?target=https%3A%2F%2Fl.fatbobman.com%2Fw0110-10" target="_blank" title="https://l.fatbobman.com/w0110-10" ref="nofollow noopener noreferrer">SwiftUI-DetectGestureUtilï¼šä¸ºå•ä¸ª SwiftUI è§†å›¾ç»‘å®šå¤šä¸ªè‡ªå®šä¹‰æ‰‹åŠ¿</a></h3>
<p>åœ¨ SwiftUI ä¸­ï¼Œè®©åŒä¸€ä¸ªè§†å›¾åŒæ—¶è¯†åˆ«å¤šä¸ªæ‰‹åŠ¿ä¸€ç›´æ˜¯ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚ç”± <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSaw-000" target="_blank" title="https://github.com/Saw-000" ref="nofollow noopener noreferrer">Saw-000</a> å¼€å‘çš„ SwiftUI-DetectGestureUtil é€šè¿‡å¼•å…¥ç‹¬ç«‹çš„â€œæ£€æµ‹é˜¶æ®µâ€ï¼Œè®©å¼€å‘è€…èƒ½åœ¨å¤šä¸ªè‡ªå®šä¹‰æ‰‹åŠ¿ä¸­åªç¡®è®¤å…¶ä¸­ä¸€ä¸ªï¼Œä»è€Œç»•å¼€ç³»ç»Ÿé»˜è®¤ç»„åˆæ–¹å¼ï¼ˆsimultaneousã€sequencedã€exclusiveï¼‰å¸¦æ¥çš„çº¦æŸï¼Œå®ç°æ›´è‡ªç„¶çš„å¤šæ‰‹åŠ¿äº¤äº’ã€‚</p>
<p>å®ƒå°†æ‰‹åŠ¿è¯†åˆ«æµç¨‹æ¸…æ™°åœ°æ‹†åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>æ£€æµ‹é˜¶æ®µ</strong>(<code>detectGesture</code>)ï¼šåœ¨æ‰‹åŠ¿å‘ç”Ÿçš„æ•´ä¸ªå‘¨æœŸå†…æŒç»­æ›´æ–°çŠ¶æ€ï¼Œç›´åˆ°æŸä¸€è‡ªå®šä¹‰è§„åˆ™åŒ¹é…å¹¶è¿”å›æ‰‹åŠ¿ç±»å‹</li>
<li><strong>å¤„ç†é˜¶æ®µ</strong>(<code>handleGesture</code>)ï¼šåœ¨è¯†åˆ«å®ŒæˆåæŒç»­è¿½è¸ªæ‰‹åŠ¿è¿›å±•,é€šè¿‡ <code>.yet</code> ä¸ <code>.finished</code> æ˜ç¡®æ§åˆ¶ç”Ÿå‘½å‘¨æœŸ</li>
</ul>
<p>è¿™ä¸€æ¨¡å‹ä¸ºæ„å»ºå¤æ‚äº¤äº’ï¼ˆå¦‚â€œåŒå‡» + æ‹–åŠ¨â€ã€â€œåœ†å½¢ç»˜åˆ¶â€ã€â€œè‡ªå®šä¹‰ç¬”è¿¹æ£€æµ‹â€ï¼‰æä¾›äº†æ–°çš„æ€è·¯ã€‚å€ŸåŠ© <code>DetectGestureState</code>ï¼Œå¼€å‘è€…å¯åœ¨ä¸€æ¬¡æ‰‹åŠ¿å‘¨æœŸå†…è·å¾—æ‰€æœ‰è§¦ç‚¹ã€æ—¶é—´ä¸å‡ ä½•ä¿¡æ¯ï¼Œå®ç°è¿œè¶… SwiftUI åŸç”Ÿ Gesture API çš„è¡¨è¾¾åŠ›ä¸ç²¾åº¦ã€‚</p>
<h2 data-id="heading-12">å¾€æœŸå†…å®¹</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fhttps%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-109%2F" target="_blank" title="https://https://fatbobman.com/zh/weekly/issue-109/" ref="nofollow noopener noreferrer">æƒŠé™©ä½†å¹¸è¿ï¼Œä¸¤æ¬¡ï¼ - #109</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-108%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-108/" ref="nofollow noopener noreferrer">Swift å®˜æ–¹å‘å¸ƒ Android SDK - #108</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-107%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-107/" ref="nofollow noopener noreferrer">å» Apple Store ä¿®æ‰‹æœº - #107</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ffatbobman.com%2Fzh%2Fweekly%2Fissue-106%2F" target="_blank" title="https://fatbobman.com/zh/weekly/issue-106/" ref="nofollow noopener noreferrer">é«˜é€šæ”¶è´­ Arduinoï¼šå†å²çš„è½®å› - #106</a></li>
</ul>
<h2 data-id="heading-13">THANK YOU</h2>
<p>å¦‚æœä½ è§‰å¾—è¿™ä»½å‘¨æŠ¥æˆ–è€…æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿Â <strong>ç‚¹èµ</strong>Â å¹¶å°†å…¶Â <strong>è½¬å‘</strong>Â ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>
<blockquote>
<p>ğŸ“® æƒ³æŒç»­å…³æ³¨ Swift æŠ€æœ¯å‰æ²¿ï¼Ÿ</p>
<p>æ¯å‘¨ä¸€æœŸã€Šè‚˜å­çš„ Swift å‘¨æŠ¥ã€‹ï¼Œä¸ºä½ ç²¾é€‰æœ¬å‘¨æœ€å€¼å¾—å…³æ³¨çš„ Swiftã€SwiftUI æŠ€æœ¯æ–‡ç« ã€å¼€æºé¡¹ç›®å’Œç¤¾åŒºåŠ¨æ€ã€‚</p>
<ul>
<li>ğŸ“¬ åœ¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fweekly.fatbobman.com" target="_blank" title="https://weekly.fatbobman.com" ref="nofollow noopener noreferrer">weekly.fatbobman.com</a> å…è´¹è®¢é˜…</li>
<li>ğŸ’¬ åŠ å…¥ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdiscord.com%2Finvite%2F7FedN5E2QQ" target="_blank" title="https://discord.com/invite/7FedN5E2QQ" ref="nofollow noopener noreferrer">Discord</a> ä¸ä¸­æ–‡ Swift å¼€å‘è€…æ·±å…¥äº¤æµ</li>
<li>ğŸ“š è®¿é—® <a href="https://link.juejin.cn?target=http%3A%2F%2Ffatbobman.com" target="_blank" title="http://fatbobman.com" ref="nofollow noopener noreferrer">fatbobman.com</a> æŸ¥çœ‹æ•°ç™¾ç¯‡æ·±åº¦åŸåˆ›æ•™ç¨‹Â </li>
</ul>
<p>ä¸€èµ·æ„å»ºæ›´å¥½çš„ Swift åº”ç”¨ï¼ğŸš€</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[é‡æ¸© Java 21 ä¹‹å‘é‡ API]]></title>    <link>https://juejin.cn/post/7570908785293950995</link>    <guid>https://juejin.cn/post/7570908785293950995</guid>    <pubDate>2025-11-11T00:00:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570908785293950995" data-draft-id="7570923924365197375" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="é‡æ¸© Java 21 ä¹‹å‘é‡ API"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-11T00:00:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ—¥ä¹ ä¸€æŠ€"/> <meta itemprop="url" content="https://juejin.cn/user/3913917125896190"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            é‡æ¸© Java 21 ä¹‹å‘é‡ API
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3913917125896190/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ—¥ä¹ ä¸€æŠ€
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.1 åˆå­¦ä¹ç»ƒ
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.1 åˆå­¦ä¹ç»ƒ" title="VIP.1 åˆå­¦ä¹ç»ƒ" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-11T00:00:25.000Z" title="Tue Nov 11 2025 00:00:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-11
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>å‘é‡ API</strong> æœ€åˆç”± <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F338" target="_blank" title="https://openjdk.java.net/jeps/338" ref="nofollow noopener noreferrer">JEP 338</a> æå‡ºï¼Œå¹¶ä½œä¸ºå­µåŒ– API é›†æˆåˆ° Java 16 ä¸­ï¼Œåœ¨ Java 17 åˆ° 20 ä¸­ï¼Œåˆç»è¿‡äº† <a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F414" target="_blank" title="https://openjdk.java.net/jeps/414" ref="nofollow noopener noreferrer">JEP 414</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F417" target="_blank" title="https://openjdk.java.net/jeps/417" ref="nofollow noopener noreferrer">JEP 417</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.java.net%2Fjeps%2F426" target="_blank" title="https://openjdk.java.net/jeps/426" ref="nofollow noopener noreferrer">JEP 426</a>ã€<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenjdk.org%2Fjeps%2F438" target="_blank" title="https://openjdk.org/jeps/438" ref="nofollow noopener noreferrer">JEP 438</a> å››æ¬¡çš„å­µåŒ–ï¼Œè¿™æ¬¡åœ¨ Java 21 ä¸­ï¼Œå·²ç»æ˜¯ç¬¬å…­æ¬¡å­µåŒ–äº†ã€‚</p>
<p><strong>å‘é‡ API</strong> åˆè¢«ç§°ä¸º <strong>Vector API</strong>ï¼Œè¦æ³¨æ„ï¼Œè¿™é‡Œè®²çš„å¹¶ä¸æ˜¯ Java ä¸­çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.oracle.com%2Fjavase%2F8%2Fdocs%2Fapi%2Fjava%2Futil%2FVector.html" target="_blank" title="https://docs.oracle.com/javase/8/docs/api/java/util/Vector.html" ref="nofollow noopener noreferrer">Vector é›†åˆç±»</a>ï¼Œè€Œæ˜¯ä¸€ç§ä¸“é—¨ç”¨äºå‘é‡è®¡ç®—çš„å…¨æ–° APIã€‚å°½ç®¡è¿™ä¸ª API è¿˜åœ¨å­µåŒ–æœŸï¼Œå¹¶æ²¡æœ‰æ­£å¼å‘å¸ƒï¼Œä½†æ˜¯è¿™é¡¹æŠ€æœ¯å¾ˆå€¼å¾—æˆ‘ä»¬æå‰å­¦ä¹ å’Œäº†è§£ï¼Œå› ä¸ºè¿™é¡¹æŠ€æœ¯ä»£è¡¨äº† Java è¯­è¨€å‘å±•çš„ä¸€ä¸ªé‡è¦æ–¹å‘ï¼Œåœ¨æœªæ¥ä¸€å®šä¼šæœ‰ç€é‡è¦çš„å½±å“ã€‚éšç€ç”Ÿæˆå¼äººå·¥æ™ºèƒ½çš„å‘å±•ï¼ŒEmbedding æŠ€æœ¯ä¹Ÿå¦‚æ—¥ä¸­å¤©ï¼Œå®ƒå°†å„ç§ç±»å‹çš„æ•°æ®ï¼ˆå¦‚æ–‡æœ¬ã€å›¾åƒã€å£°éŸ³ç­‰ï¼‰è½¬æ¢ä¸ºé«˜ç»´æ•°å€¼å‘é‡ï¼Œä»è€Œå®ç°å¯¹æ•°æ®ç‰¹å¾å’Œè¯­ä¹‰ä¿¡æ¯çš„è¡¨ç¤ºã€‚Embedding æŠ€æœ¯åœ¨ä¸ªæ€§åŒ–æ¨èã€å¤šæ¨¡æ€æ£€ç´¢å’Œè‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸä¸­å‘æŒ¥ç€é‡è¦ä½œç”¨ï¼Œè€Œè¿™äº›åœºæ™¯éƒ½ç¦»ä¸å¼€å‘é‡è®¡ç®—ã€‚</p>
<h2 data-id="heading-0">ä»€ä¹ˆæ˜¯å‘é‡ï¼Ÿ</h2>
<p>å‘é‡æ˜¯æ•°å­¦å’Œç‰©ç†å­¦ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ¦‚å¿µï¼Œå…·æœ‰å¤§å°å’Œæ–¹å‘ä¸¤ä¸ªå±æ€§ï¼Œæ¯”å¦‚ç‰©ç†å­¦ä¸­çš„åŠ›å°±æ˜¯å‘é‡ã€‚å‘é‡å¯ä»¥æœ‰å¤šç§ä¸åŒçš„è¡¨ç¤ºæ–¹å¼ï¼š</p>
<ul>
<li>åœ¨ä»£æ•°ä¸­ï¼Œä¸€èˆ¬å°åˆ·ç”¨é»‘ä½“çš„å°å†™è‹±æ–‡å­—æ¯æ¥è¡¨ç¤ºï¼ˆæ¯”å¦‚ <strong>a</strong>ã€<strong>b</strong>ã€<strong>c</strong> ç­‰ï¼‰ï¼Œæ‰‹å†™ç”¨åœ¨ aã€bã€c ç­‰å­—æ¯ä¸ŠåŠ ä¸€ç®­å¤´ï¼ˆâ†’ï¼‰è¡¨ç¤ºï¼›</li>
<li>åœ¨å‡ ä½•ä¸­ï¼Œå‘é‡å¯ä»¥å½¢è±¡åŒ–åœ°è¡¨ç¤ºä¸ºå¸¦ç®­å¤´çš„çº¿æ®µï¼Œç®­å¤´æ‰€æŒ‡çš„æ–¹å‘ä»£è¡¨å‘é‡çš„æ–¹å‘ï¼Œçº¿æ®µé•¿åº¦åˆ™ä»£è¡¨å‘é‡çš„å¤§å°ï¼›</li>
<li>åœ¨åæ ‡ç³»ä¸­ï¼Œå‘é‡å¯ä»¥ç”¨ç‚¹çš„åæ ‡ä½ç½®æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚å¹³é¢ç›´è§’åæ ‡ç³»ä¸­çš„å‘é‡å¯ä»¥è®°ä¸º <code>(x, y)</code>ï¼Œç©ºé—´ç›´è§’åæ ‡ç³»ä¸­çš„å‘é‡å¯ä»¥è®°ä¸º <code>(x, y, z)</code>ï¼Œå¤šç»´ç©ºé—´ä»¥æ­¤ç±»æ¨ï¼›æ­¤å¤–ï¼Œå‘é‡ä¹Ÿå¯ä»¥ä½¿ç”¨çŸ©é˜µæ¥è¡¨ç¤ºï¼›</li>
<li>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ï¼Œå‘é‡å¯ä»¥è¢«ç†è§£ä¸ºä¸€ä¸ªæ•°å­—åˆ—è¡¨æˆ–æ•°ç»„ï¼Œè¿™åœ¨ç¼–ç¨‹è¯­è¨€ä¸­å°¤ä¸ºå¸¸è§ã€‚</li>
</ul>
<p>å’Œå‘é‡è¿™ä¸ªæ¦‚å¿µç›¸å¯¹åº”çš„ï¼Œè¿˜æœ‰æ ‡é‡ã€çŸ©é˜µã€å¼ é‡ç­‰æ¦‚å¿µï¼Œè¿™å‡ ä¸ªæ¦‚å¿µå¯ä»¥ä»£è¡¨ä¸åŒçš„ç»´åº¦ï¼Œä¸€èˆ¬ç”¨ç‚¹çº¿é¢ä½“æ¥ç±»æ¯”ï¼š</p>
<ul>
<li>ç‚¹â€”â€”æ ‡é‡ï¼ˆscalarï¼‰</li>
<li>çº¿â€”â€”å‘é‡ï¼ˆvectorï¼‰</li>
<li>é¢â€”â€”çŸ©é˜µï¼ˆmatrixï¼‰</li>
<li>ä½“â€”â€”å¼ é‡ï¼ˆtensorï¼‰</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/865c9ad3f89b479db11f90259960a725~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763424025&amp;x-signature=dfF%2FTddksEU9Lv3R9IDeyFYB16Y%3D" alt="vector.png" loading="lazy"/></p>
<h2 data-id="heading-1">æ ‡é‡è®¡ç®— vs. å‘é‡è®¡ç®—</h2>
<p>æ ‡é‡å°±æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œåœ¨ Java ä¸­é€šå¸¸å¯ä»¥è¡¨ç¤ºä¸ºä¸€ä¸ªæ•´æ•°æˆ–æµ®ç‚¹æ•°ç­‰ï¼Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ç®—æœ¯è¿ç®—åŸºæœ¬ä¸Šéƒ½æ˜¯ä½œç”¨äºæ ‡é‡ä¹‹ä¸Šçš„ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç å¯¹ <code>a</code> å’Œ <code>b</code> ä¸¤ä¸ªæ ‡é‡æ±‚å’Œï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
<span class="hljs-type">int</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> a + b;
</code></pre>
<p>å¦‚æœå°† <code>a</code> å’Œ <code>b</code> æ¢æˆå‘é‡ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„ï¼Œè¯¥å¦‚ä½•æ±‚å’Œå‘¢ï¼Ÿæœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨ <code>for</code> å¾ªç¯ä¾æ¬¡ç›¸åŠ æ•°ç»„ä¸­å¯¹åº”çš„å…ƒç´ ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>};
<span class="hljs-type">int</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>};
<span class="hljs-type">int</span>[] c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>];
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i++) {
  c[i] = a[i] + b[i];
}
</code></pre>
<p>å¾ˆæ˜¾ç„¶è¿™ä¸æ˜¯ä»€ä¹ˆé«˜æ˜çš„åšæ³•ï¼Œä»”ç»†è§‚å¯Ÿä¸Šé¢çš„ä»£ç å°±ä¼šå‘ç°ï¼Œå¯¹äºæ•°ç»„ä¸­æ¯ä¸ªå…ƒç´ çš„ç›¸åŠ æ˜¯äº’ä¸å½±å“çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½å¹¶è¡Œè®¡ç®—å‘¢ï¼Ÿä¸€ç§æœ‰æ•ˆçš„è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨ <strong>å¹¶è¡Œæµï¼ˆParallel Streamï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java">IntStream.range(<span class="hljs-number">0</span>, a.length)
  .parallel()
  .forEach(i -&gt; c[i] = a[i] + b[i]);
</code></pre>
<p>å¦ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯æˆ‘ä»¬å°†è¦å­¦ä¹ çš„ <strong>å‘é‡ APIï¼ˆVector APIï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">IntVector</span> <span class="hljs-variable">aVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, a, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">bVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, b, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">cVector</span> <span class="hljs-operator">=</span> aVector.add(bVector);
</code></pre>
<p>æ³¨æ„ï¼Œç”±äºå‘é‡ API å¹¶æ²¡æœ‰æ­£å¼å‘å¸ƒï¼Œè¿è¡Œæ—¶éœ€è¦æ‰‹åŠ¨åŠ ä¸Š <code>jdk.incubator.vector</code> æ¨¡å—ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">$ java --add-modules jdk.incubator.vector VectorDemo.java
</code></pre>
<p>å‘é‡ API å®šä¹‰äº†ä¸“é—¨çš„å‘é‡ç±»ï¼Œæ¯”å¦‚è¿™é‡Œçš„ <code>IntVector</code>ï¼Œå¹¶æä¾›äº† <code>fromArray</code> æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬å°†æ•°ç»„è½¬æ¢ä¸ºå‘é‡ï¼Œç„¶åå†é€šè¿‡ <code>aVector.add(bVector)</code> æ‰§è¡Œä¸¤ä¸ªå‘é‡çš„åŠ æ³•è¿ç®—ã€‚</p>
<p>é™¤äº†åŠ æ³•è¿ç®—ï¼Œå‘é‡ API è¿˜æä¾›äº†ä¸€ç»„æ–¹æ³•æ¥æ‰§è¡Œå„ç§å…¶ä»–çš„å‘é‡è®¡ç®—ï¼š</p>
<ul>
<li>ç®—æœ¯è¿ç®—ï¼ˆArithmetic Operationsï¼‰
<ul>
<li>åŠ æ³•ï¼š<code>vector1.add(vector2)</code></li>
<li>å‡æ³•ï¼š<code>vector1.sub(vector2)</code></li>
<li>ä¹˜æ³•ï¼š<code>vector1.mul(vector2)</code></li>
<li>é™¤æ³•ï¼š<code>vector1.div(vector2)</code></li>
</ul>
</li>
<li>é€å…ƒç´ æ“ä½œï¼ˆElement-Wise Operationsï¼‰
<ul>
<li>ç»å¯¹å€¼ï¼š<code>vector.abs()</code></li>
<li>è´Ÿæ•°ï¼š<code>vector.neg()</code></li>
<li>å¹³æ–¹æ ¹ï¼š<code>vector.sqrt()</code></li>
<li>æŒ‡æ•°ï¼š<code>vector.exp()</code></li>
<li>å¯¹æ•°ï¼š<code>vector.log()</code></li>
</ul>
</li>
<li>è§„çº¦è¿ç®—ï¼ˆReductionsï¼‰
<ul>
<li>å…ƒç´ ä¹‹å’Œï¼š<code>vector.reduce(VectorOperators.ADD)</code></li>
<li>æœ€å°å…ƒç´ ï¼š<code>vector.reduce(VectorOperators.MIN)</code></li>
<li>æœ€å¤§å…ƒç´ ï¼š<code>vector.reduce(VectorOperators.MAX)</code></li>
<li>å¹³å‡å€¼ï¼š<code>vector.reduce(VectorOperators.ADD).mul(1.0 / vector.length())</code></li>
</ul>
</li>
<li>é€»è¾‘è¿ç®—ï¼ˆLogical Operationsï¼‰
<ul>
<li>ä¸ï¼š<code>vector1.and(vector2)</code></li>
<li>æˆ–ï¼š<code>vector1.or(vector2)</code></li>
<li>éï¼š<code>vector.not()</code></li>
</ul>
</li>
<li>æ¯”è¾ƒæ“ä½œï¼ˆComparisonsï¼‰
<ul>
<li>ç­‰äºï¼š<code>vector1.eq(vector2)</code></li>
<li>å°äºï¼š<code>vector1.lt(vector2)</code></li>
<li>å¤§äºï¼š<code>vector1.compare(VectorOperators.GT, vector2)</code></li>
</ul>
</li>
</ul>
<h2 data-id="heading-2">å•æŒ‡ä»¤å¤šæ•°æ®ï¼ˆSIMDï¼‰</h2>
<p>ä½¿ç”¨å‘é‡ API æ¥æ‰§è¡Œå‘é‡è®¡ç®—ï¼Œä¸ä»…ä»£ç ç²¾ç®€ï¼Œå®¹æ˜“ç†è§£ï¼Œè€Œä¸”å®ƒè¿˜æœ‰å¦ä¸€ä¸ªå¥½å¤„ï¼Œé‚£å°±æ˜¯æ€§èƒ½æå‡ã€‚å°½ç®¡ä½¿ç”¨å¹¶è¡Œæµä¹Ÿèƒ½æå‡ä¸€å®šçš„æ€§èƒ½ï¼Œä½†æ˜¯å¹¶è¡Œæµå’Œå‘é‡ API æ˜¯ä¸¤ç§å®Œå…¨ä¸åŒçš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå‰è€…ä½¿ç”¨å¤šçº¿ç¨‹åœ¨ä¸åŒçš„ CPU æ ¸ä¸Šå¹¶è¡Œè®¡ç®—ï¼Œè€Œåè€…é€šè¿‡ SIMD æŠ€æœ¯ï¼Œåœ¨å•ä¸ª CPU å‘¨æœŸå†…å¯¹å¤šä¸ªæ•°æ®åŒæ—¶æ‰§è¡Œç›¸åŒæ“ä½œï¼Œä»è€Œè¾¾åˆ°å¹¶è¡Œè®¡ç®—çš„ç›®çš„ã€‚</p>
<p><strong>SIMDï¼ˆSingle Instruction, Multiple Dataï¼Œå•æŒ‡ä»¤å¤šæ•°æ®ï¼‰</strong> æ˜¯ä¸€ç§å¹¶è¡Œå¤„ç†æŠ€æœ¯ï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†ä¸€ä¸ªæ§åˆ¶å™¨ä¸å¤šä¸ªå¤„ç†å•å…ƒç»“åˆåœ¨ä¸€èµ·ï¼Œä½¿å¾—è¿™äº›å¤„ç†å•å…ƒå¯ä»¥é’ˆå¯¹ä¸åŒçš„æ•°æ®åŒæ—¶æ‰§è¡Œç›¸åŒçš„æ“ä½œï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªæŒ‡ä»¤èƒ½å¤ŸåŒæ—¶å¤„ç†å¤šä¸ªæ•°æ®ã€‚è¿™ä¸ä¼ ç»Ÿçš„ <strong>SISDï¼ˆSingle Instruction, Single Dataï¼Œå•æŒ‡ä»¤å•æ•°æ®ï¼‰</strong> å½¢æˆå¯¹æ¯”ï¼Œåœ¨åè€…ä¸­ï¼Œä¸€ä¸ªæŒ‡ä»¤åªèƒ½å¤„ç†ä¸€ä¸ªæ•°æ®ã€‚</p>
<p>åœ¨ä¸Šé¢é‚£ä¸ªå‘é‡æ±‚å’Œçš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å…ˆæ˜¯ä½¿ç”¨ <code>for</code> å¾ªç¯å®ç°ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; a.length; i++) {
  c[i] = a[i] + b[i];
}
</code></pre>
<p>æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ å°†ä½¿ç”¨ï¼ˆå¤§è‡´ï¼‰1 ä¸ª CPU æŒ‡ä»¤è¿›è¡Œè®¡ç®—ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦ 4 ä¸ªæŒ‡ä»¤æˆ– 4 ä¸ª CPU å‘¨æœŸæ‰èƒ½å®Œæˆè®¡ç®—ï¼Œè¿™å°±æ˜¯å…¸å‹çš„ SISDã€‚è€Œä½¿ç”¨å‘é‡ API å¯ä»¥å°†å‘é‡çš„è®¡ç®—ç¼–è¯‘ä¸ºå¯¹åº” CPU æ¶æ„ä¸Šçš„ SIMD æŒ‡ä»¤é›†ï¼Œåªè¦ 1 ä¸ªæŒ‡ä»¤å³å¯å®Œæˆå‘é‡è®¡ç®—ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d501a8c58b7d4e2b9b5ab5f0e9a4e92d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5Lmg5LiA5oqA:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763424025&amp;x-signature=Dg2Hl9n39B8Tf52KogAz%2F5SeNV8%3D" alt="simd.png" loading="lazy"/></p>
<p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè®¸å¤šç°ä»£å¤„ç†å™¨éƒ½æ”¯æŒ SIMD æŒ‡ä»¤é›†ï¼Œå¦‚ Intel çš„ <strong>MMX</strong>ã€<strong>SSE</strong> å’Œ <strong>AVX</strong>ï¼ŒARM çš„ <strong>NEON</strong> å’Œ <strong>SVE</strong> ç­‰ï¼Œè¿™äº›æŒ‡ä»¤é›†èƒ½å¤Ÿæ˜¾è‘—æå‡ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦å¤§é‡æ•°å€¼è®¡ç®—çš„åœºæ™¯ä¸‹ã€‚ä¸è¿‡ä½¿ç”¨è¿™äº›æŒ‡ä»¤é›†çš„é—¨æ§›å¹¶ä¸ä½ï¼Œé€šå¸¸æ¶‰åŠåˆ°æ±‡ç¼–è¯­è¨€æˆ–ä¸€äº›ç‰¹æ®Šçš„å‡½æ•°åº“ï¼Œæ¯”å¦‚ Intel çš„è·¨å¹³å°å‡½æ•°åº“ <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FIntegrated_Performance_Primitives" target="_blank" title="https://en.wikipedia.org/wiki/Integrated_Performance_Primitives" ref="nofollow noopener noreferrer">IPPï¼ˆIntegrated Performance Primitivesï¼‰</a> æˆ–ä½¿ç”¨ <a href="https://link.juejin.cn?target=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FIntrinsic_function" target="_blank" title="https://en.wikipedia.org/wiki/Intrinsic_function" ref="nofollow noopener noreferrer">å†…ç½®å‡½æ•° (Intrinsic function)</a> ç­‰ã€‚</p>
<p>ç›¸æ¯”äºä¼ ç»Ÿçš„æ‰‹å†™ SIMD ä»£ç ï¼ŒJava çš„å‘é‡ API æä¾›äº†æ›´é«˜çš„å¯è¯»æ€§å’Œç»´æŠ¤æ€§ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨ç†Ÿæ‚‰çš„ Java è¯­æ³•å’Œç±»å‹ç³»ç»Ÿï¼Œæ— éœ€å¤„ç†åº•å±‚å¯„å­˜å™¨å’ŒæŒ‡ä»¤ï¼Œç¼–å†™å‡ºç®€æ´æ˜äº†çš„ã€å¹³å°æ— å…³çš„ã€é«˜æ€§èƒ½çš„å‘é‡è®¡ç®—ä»£ç ã€‚</p>
<p>å…¶å®ï¼Œåœ¨å‘é‡ API æå‡ºä¹‹å‰ï¼ŒJava å·²ç»åœ¨ SIMD ä¸Šæ¢ç´¢äº†å¾ˆé•¿ä¸€æ®µæ—¶é—´äº†ï¼Œæ¯”å¦‚ HotSpot çš„ <a href="https://link.juejin.cn?target=https%3A%2F%2Fcr.openjdk.org%2F~vlivanov%2Ftalks%2F2017_Vectorization_in_HotSpot_JVM.pdf" target="_blank" title="https://cr.openjdk.org/~vlivanov/talks/2017_Vectorization_in_HotSpot_JVM.pdf" ref="nofollow noopener noreferrer">è‡ªåŠ¨å‘é‡åŒ–ï¼ˆAuto-Vectorizationï¼‰</a> åŠŸèƒ½ï¼Œå®ƒå°†æ ‡é‡æ“ä½œè½¬æ¢ä¸º <strong>è¶…å­—æ“ä½œï¼ˆSuperWord Operationsï¼‰</strong>ï¼Œç„¶åå†æ˜ å°„åˆ° SIMD æŒ‡ä»¤ã€‚ç„¶è€Œï¼Œè¿™ä¸ªè¿‡ç¨‹å®Œå…¨ä¾èµ– JITï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆå¯é çš„æ–¹æ³•æ¥ä¿è¯ç¼–å†™çš„ä»£ç ä¸€å®šå¯ä»¥ä½¿ç”¨ SIMD æŒ‡ä»¤ä¼˜åŒ–ï¼Œæœ‰äº›ä»£ç ç”šè‡³æ ¹æœ¬æ— æ³•è¿›è¡Œä¼˜åŒ–ï¼Œå¼€å‘äººå‘˜å¿…é¡»æ·±å…¥äº†è§£ HotSpot çš„è‡ªåŠ¨å‘é‡åŒ–ç®—æ³•åŠå…¶é™åˆ¶ï¼Œæ‰èƒ½å®ç°å¯é çš„æ€§èƒ½æå‡ã€‚å‘é‡ API ä½¿å¾—è¿™ä¸ªè¿‡ç¨‹å®Œå…¨ç”±å¼€å‘äººå‘˜è‡ªå·±æ§åˆ¶ï¼Œå› æ­¤å¯ä»¥å†™å‡ºæ›´åŠ å¯é¢„æµ‹ã€æ›´åŠ ç¨³å¥çš„ä»£ç ã€‚</p>
<blockquote>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>-XX:-UseSuperWord</code> å‚æ•°å…³é—­ HotSpot çš„è‡ªåŠ¨å‘é‡åŒ–åŠŸèƒ½ã€‚</p>
</blockquote>
<h2 data-id="heading-3">ä½¿ç”¨å‘é‡ API</h2>
<p>åœ¨å­¦ä¹ äº†å‘é‡çš„åŸºç¡€çŸ¥è¯†ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†ç»§ç»­æ·±å…¥å­¦ä¹ å‘é‡ API çš„ä½¿ç”¨ã€‚</p>
<p>ä¸Šé¢ä»‹ç»å‘é‡è®¡ç®—æ—¶ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº†å‘é‡ API çš„åŸºæœ¬ç”¨æ³•ï¼Œä½¿ç”¨ <code>IntVector</code> å®ç°ä¸¤ä¸ªå‘é‡ç›¸åŠ ã€‚è¿™ä¸ªç¤ºä¾‹ä¸ºäº†æ˜“äºç†è§£ï¼Œåšäº†ç®€å•å¤„ç†ï¼Œå¹¶æ²¡æœ‰è€ƒè™‘åœ¨å®é™…ä½¿ç”¨æ—¶çš„è¾¹ç•Œæƒ…å†µï¼Œå‡è®¾æˆ‘ä»¬å°† <code>a</code> å’Œ <code>b</code> ä¸¤ä¸ªæ•°ç»„æ”¹æˆ 10 ä¸ªæ•°å­—ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">int</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">IntVector</span> <span class="hljs-variable">aVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, a, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">bVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, b, <span class="hljs-number">0</span>);
<span class="hljs-type">IntVector</span> <span class="hljs-variable">cVector</span> <span class="hljs-operator">=</span> aVector.add(bVector);
</code></pre>
<p>è¿è¡Œåå¾—åˆ°çš„ç»“æœ <code>c</code> ä»ç„¶æ˜¯ <code>[2, 4, 6, 8]</code>ï¼Œåé¢æ–°åŠ çš„æ•°å­—å¹¶æ²¡æœ‰è®¡ç®—ã€‚è¿™æ˜¯å› ä¸ºæ¯ä¸ªå‘é‡çš„å­˜å‚¨ç©ºé—´æœ‰é™ï¼Œå¹¶ä¸èƒ½ä¸€æ¬¡å­˜ä¸‹æ‰€æœ‰çš„æ•°æ®ã€‚è¿™é‡Œæ¶‰åŠå‘é‡ API çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼š<strong>å‘é‡ç§ç±»ï¼ˆVector Speciesï¼‰</strong>ï¼Œå®ƒæ˜¯ <strong>æ•°æ®ç±»å‹ï¼ˆData Typesï¼‰</strong> å’Œ <strong>å‘é‡å½¢çŠ¶ï¼ˆVector Shapesï¼‰</strong> çš„ç»„åˆï¼›æ‰€è°“æ•°æ®ç±»å‹å°±æ˜¯ Java çš„åŸºç¡€ç±»å‹ï¼Œæ¯”å¦‚ byteã€shortã€intã€long è¿™äº›æ•´æ•°ç±»å‹å’Œ floatã€double æµ®ç‚¹ç±»å‹ï¼Œè€Œæ‰€è°“å‘é‡å½¢çŠ¶å°±æ˜¯å‘é‡çš„ä½å¤§å°æˆ–ä½æ•°ï¼›æ¯”å¦‚è¿™é‡Œçš„å‘é‡ç§ç±»ä¸º <code>IntVector.SPECIES_128</code>ï¼Œå®ƒä»£è¡¨æ•°æ®ç±»å‹ä¸º intï¼Œå‘é‡å½¢çŠ¶ä¸º 128 ä½ï¼›è€Œæˆ‘ä»¬çŸ¥é“ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ int å€¼çš„å¤§å°ä¸º 32 ä½ï¼Œæ‰€ä»¥è¿™ä¸ªå‘é‡ä¸€æ¬¡åªèƒ½å­˜å‚¨ <code>128/32 = 4</code> ä¸ª int å€¼ï¼Œè¿™ä¹Ÿè¢«å½¢è±¡åœ°ç§°ä¸º <strong>é€šé“ï¼ˆLanesï¼‰</strong>ï¼Œè¡¨ç¤ºå‘é‡ä¸€æ¬¡å¯ä»¥å¤„ç†çš„æ•°æ®ä¸ªæ•°ã€‚</p>
<p>çŸ¥é“è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™å‡ºæ›´åŠ é€šç”¨çš„å‘é‡è®¡ç®—ä»£ç äº†ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†æ•°æ®æŒ‰é€šé“æ•°åˆ†ç»„ï¼Œç„¶åä¸€ç»„ä¸€ç»„çš„è¿›è¡Œå¤„ç†ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">int</span>[] a = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">int</span>[] b = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[] {<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>};
<span class="hljs-type">int</span>[] c = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>];
<span class="hljs-type">int</span> <span class="hljs-variable">lanes</span> <span class="hljs-operator">=</span> IntVector.SPECIES_128.length();
<span class="hljs-type">int</span> <span class="hljs-variable">loopBound</span> <span class="hljs-operator">=</span> IntVector.SPECIES_128.loopBound(a.length);
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; loopBound; i += lanes) {
  <span class="hljs-type">IntVector</span> <span class="hljs-variable">aVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, a, i);
  <span class="hljs-type">IntVector</span> <span class="hljs-variable">bVector</span> <span class="hljs-operator">=</span> IntVector.fromArray(IntVector.SPECIES_128, b, i);
  <span class="hljs-type">IntVector</span> <span class="hljs-variable">cVector</span> <span class="hljs-operator">=</span> aVector.add(bVector);
  cVector.intoArray(c, i);
}
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> loopBound; i &lt; a.length; i++) {
  c[i] = a[i] + b[i];
}
IntStream.of(c).forEach(x -&gt; System.out.println(x));
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°ï¼Œåœ¨éå†æ—¶ i æ¯æ¬¡å¢åŠ  <code>lanes</code>ï¼Œå®ƒçš„å€¼ç­‰äº <code>IntVector.SPECIES_128.length()</code>ï¼Œä¹Ÿå°±æ˜¯é€šé“æ•°ï¼Œä¸€èˆ¬æ¥è¯´è¯¥å€¼ç­‰äº 4ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯æŒ‰ 4 ä¸ªä¸€ç»„è¿›è¡Œå¤„ç†çš„ã€‚ä½†æ˜¯è¦æ³¨æ„æ•°æ®ä¸ä¸€å®šèƒ½è¢«é€šé“æ•°å®Œå…¨æ•´é™¤ï¼Œæ¯”å¦‚è¿™é‡Œ 10 ä¸ªæ•°å­—ï¼Œå‰ 8 ä¸ªå¯ä»¥åˆ†ä¸ºä¸¤ç»„å¤„ç†æ‰ï¼Œè¿˜å‰©ä¸‹ 2 ä¸ªæ€ä¹ˆåŠå‘¢ï¼Ÿè¿™æ—¶æˆ‘ä»¬åªèƒ½ä½¿ç”¨æœ€åŸå§‹çš„æ ‡é‡è®¡ç®—æ¥å¤„ç†äº†ã€‚</p>
<p>æ­¤å¤–ï¼Œåœ¨å®é™…ç¼–ç æ—¶å‘é‡ç§ç±»ä¸å»ºè®®å†™æ­»ï¼Œå¯ä»¥ä½¿ç”¨ <code>IntVector.SPECIES_PREFERRED</code> æ›¿ä»£ï¼Œå®ƒä¼šæ ¹æ®å¹³å°è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å‘é‡ç§ç±»ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> VectorSpecies&lt;Integer&gt; SPECIES = IntVector.SPECIES_PREFERRED;
</code></pre>
<p>å¯ä»¥çœ‹å‡ºå°½ç®¡å‘é‡ API çš„ä½¿ç”¨æœ‰ä¸å°‘å¥½å¤„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿéœ€è¦è°¨æ…å¯¹å¾…ï¼š</p>
<ul>
<li>é¦–å…ˆï¼Œåœ¨ä½¿ç”¨å‘é‡ API æ—¶ï¼Œæ•°æ®å¯¹é½æ˜¯ä¸€ä¸ªé‡è¦çš„è€ƒè™‘å› ç´ ï¼Œä¸å¯¹é½çš„æ•°æ®è®¿é—®å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚å¼€å‘è€…éœ€è¦ç¡®ä¿æ•°æ®åœ¨å†…å­˜ä¸­çš„å¯¹é½æ–¹å¼ï¼Œä»¥å……åˆ†å‘æŒ¥ SIMD æŒ‡ä»¤çš„ä¼˜åŠ¿ï¼›</li>
<li>å¦å¤–ï¼Œå‘é‡ API æœ‰ç¡¬ä»¶ä¾èµ–æ€§ï¼Œå®ƒä¾èµ–äºåº•å±‚ç¡¬ä»¶æ”¯æŒçš„ SIMD æŒ‡ä»¤é›†ï¼Œè®¸å¤šåŠŸèƒ½å¯èƒ½åœ¨å…¶ä»–å¹³å°å’Œæ¶æ„ä¸Šä¸å¯ç”¨ï¼Œæ€§èƒ½ä¹Ÿå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚å¼€å‘è€…éœ€è¦äº†è§£ç›®æ ‡å¹³å°çš„ç‰¹æ€§ï¼Œå¹¶è¿›è¡Œé€‚å½“çš„æ€§èƒ½ä¼˜åŒ–ã€‚</li>
</ul>
<h2 data-id="heading-4">å°ç»“</h2>
<p>ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº† Java 21 ä¸­çš„ <strong>å‘é‡ APIï¼ˆVector APIï¼‰</strong>ï¼Œè¿™ä¸ªç‰¹æ€§ä» Java 16 å¼€å§‹å°±å·²å¼•å…¥ï¼Œä¸€ç›´åœ¨ä¸æ–­æ¼”è¿›å’Œå®Œå–„ã€‚å­¦ä¹ å†…å®¹æ€»ç»“å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>å‘é‡è®¡ç®—åŸºç¡€</strong> - å‘é‡æ˜¯æ•°å­¦å’Œç‰©ç†å­¦ä¸­çš„åŸºæœ¬æ¦‚å¿µï¼Œåœ¨è®¡ç®—æœºç§‘å­¦ä¸­è¢«è¡¨ç¤ºä¸ºæ•°ç»„æˆ–åˆ—è¡¨ã€‚å‘é‡è®¡ç®—ç›¸æ¯”æ ‡é‡è®¡ç®—ï¼Œé€šè¿‡ä¸€æ¬¡æ€§å¤„ç†å¤šä¸ªæ•°æ®å…ƒç´ ï¼Œæ˜¾è‘—æé«˜äº†è®¡ç®—æ•ˆç‡ï¼Œè¿™æ­£æ˜¯ç°ä»£é«˜æ€§èƒ½è®¡ç®—çš„å…³é”®æ‰€åœ¨ï¼›</li>
<li><strong>SIMD ä¼˜åŠ¿</strong> - å‘é‡ API å……åˆ†åˆ©ç”¨ç°ä»£å¤„ç†å™¨çš„ SIMDï¼ˆå•æŒ‡ä»¤å¤šæ•°æ®ï¼‰æŒ‡ä»¤é›†ç‰¹æ€§ï¼Œå¦‚ Intel çš„ AVX å’Œ ARM çš„ NEONï¼Œç›¸æ¯”äºæ‰‹å†™æ±‡ç¼–æˆ–ä½¿ç”¨ä½çº§ Unsafe APIï¼Œå‘é‡ API æä¾›äº†æ›´é«˜çš„å¯è¯»æ€§ã€æ›´å¥½çš„å¯ç»´æŠ¤æ€§å’Œæ›´å¯é çš„æ€§èƒ½ä¿è¯ï¼›</li>
<li><strong>å‘é‡ API çš„ä½¿ç”¨</strong>ï¼šè™½ç„¶å‘é‡ API å¸¦æ¥äº†æ€§èƒ½æå‡ï¼Œä½†æˆ‘ä»¬åœ¨ä½¿ç”¨æ—¶ä¹Ÿéœ€è¦å…³æ³¨æ•°æ®å¯¹é½ã€ç¡¬ä»¶ä¾èµ–æ€§ç­‰é—®é¢˜ï¼Œéœ€è¦æ ¹æ®ç›®æ ‡å¹³å°çš„ç‰¹æ€§è¿›è¡Œé€‚å½“çš„ä¼˜åŒ–ï¼Œè¿™æ ·æ‰èƒ½å……åˆ†å‘æŒ¥å‘é‡è®¡ç®—çš„ä¼˜åŠ¿ï¼›</li>
</ol>
<p>éšç€ç”Ÿæˆå¼äººå·¥æ™ºèƒ½çš„å¿«é€Ÿå‘å±•ï¼ŒEmbedding æŠ€æœ¯å’Œå‘é‡è®¡ç®—åœ¨æ¨èç³»ç»Ÿã€å¤šæ¨¡æ€æ£€ç´¢ã€è‡ªç„¶è¯­è¨€å¤„ç†ç­‰é¢†åŸŸçš„åº”ç”¨æ—¥ç›Šå¹¿æ³›ï¼Œå‘é‡ API ä¸º Java åœ¨è¿™äº›é¢†åŸŸçš„åº”ç”¨æä¾›äº†åŸºç¡€ï¼Œæœ‰æœ›æ¨åŠ¨ Java åœ¨ AI å’Œæ•°æ®ç§‘å­¦é¢†åŸŸçš„è¿›ä¸€æ­¥å‘å±•ã€‚</p>
<h2 data-id="heading-5">æ¬¢è¿å…³æ³¨</h2>
<p>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿å…³æ³¨æˆ‘çš„åŒåå…¬ä¼—å·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fi-study-everyday.online%2Fabout-me.html" target="_blank" title="https://i-study-everyday.online/about-me.html" ref="nofollow noopener noreferrer">æ—¥ä¹ ä¸€æŠ€ï¼Œæ¯å¤©å­¦ä¸€ç‚¹æ–°æŠ€æœ¯</a>ã€‚</p>
<p>æˆ‘ä¼šæ¯å¤©èŠ±ä¸€ä¸ªå°æ—¶ï¼Œè®°å½•ä¸‹æˆ‘å­¦ä¹ çš„ç‚¹ç‚¹æ»´æ»´ã€‚å†…å®¹åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li>æŸä¸ªäº§å“çš„ä½¿ç”¨å°çªé—¨</li>
<li>å¼€æºé¡¹ç›®çš„å®è·µå’Œå¿ƒå¾—</li>
<li>æŠ€æœ¯ç‚¹çš„ç®€å•è§£è¯»</li>
</ul>
<p>ç›®æ ‡æ˜¯è®©å¤§å®¶ç”¨5åˆ†é’Ÿè¯»å®Œå°±èƒ½æœ‰æ‰€æ”¶è·ï¼Œä¸éœ€è¦å¤ªè´¹åŠ²ï¼Œä½†å´å¯ä»¥è½»æ¾è·å–ä¸€äº›å¹²è´§ã€‚ä¸ç®¡ä½ æ˜¯æŠ€æœ¯æ–°æ‰‹è¿˜æ˜¯è€é¸Ÿï¼Œæ¬¢è¿ç»™æˆ‘æå»ºè®®ï¼Œå¦‚æœæœ‰æƒ³å­¦ä¹ çš„æŠ€æœ¯ï¼Œä¹Ÿæ¬¢è¿äº¤æµï¼</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Guava è¿­ä»£å™¨å¢å¼ºç±»ä»‹ç»]]></title>    <link>https://juejin.cn/post/7570903763722453002</link>    <guid>https://juejin.cn/post/7570903763722453002</guid>    <pubDate>2025-11-10T16:17:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763722453002" data-draft-id="7570897638441320475" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Guava è¿­ä»£å™¨å¢å¼ºç±»ä»‹ç»"/> <meta itemprop="keywords" content="åç«¯,Java,è®¾è®¡æ¨¡å¼"/> <meta itemprop="datePublished" content="2025-11-10T16:17:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ¡¦è¯´ç¼–ç¨‹"/> <meta itemprop="url" content="https://juejin.cn/user/2212689394274136"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Guava è¿­ä»£å™¨å¢å¼ºç±»ä»‹ç»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2212689394274136/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ¡¦è¯´ç¼–ç¨‹
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T16:17:00.000Z" title="Mon Nov 10 2025 16:17:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Guava åº“ä¸º Java å¼€å‘è€…æä¾›äº†ä¸€ç³»åˆ—å¼ºå¤§çš„è¿­ä»£å™¨å¢å¼ºå·¥å…·ï¼Œå®ƒä»¬ç®€åŒ–äº†å¤æ‚è¿­ä»£æ¨¡å¼çš„å®ç°ã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨ Guava çš„ PeekingIteratorã€AbstractIterator å’Œ AbstractSequentialIteratorã€‚</p>
<h3 data-id="heading-0">1. PeekingIteratorï¼šæ´å¯Ÿå…ˆæœº</h3>
<p>æ ‡å‡†çš„ Iterator æ¥å£ä»…æä¾› hasNext() å’Œ next() æ–¹æ³•ï¼Œè¿™åœ¨æŸäº›åœºæ™¯ä¸‹æ˜¾å¾—åŠ›ä¸ä»å¿ƒã€‚å½“éœ€è¦â€œé¢„è¯»â€ä¸‹ä¸€ä¸ªå…ƒç´ ä»¥åšå‡ºå†³ç­–ï¼Œä½†åˆä¸æƒ³ç«‹å³æ¶ˆè€—å®ƒæ—¶ï¼ŒPeekingIterator åº”è¿è€Œç”Ÿã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<ul>
<li><code>Iterators.peekingIterator(Iterator)</code> æ–¹æ³•ç”¨äºå°†ç°æœ‰çš„ <code>Iterator</code> åŒ…è£…æˆä¸€ä¸ª <code>PeekingIterator</code>ã€‚</li>
<li>å…¶æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>peek()</code>ï¼Œå…è®¸åœ¨ä¸æ¨è¿›è¿­ä»£å™¨çš„æƒ…å†µä¸‹ï¼ŒæŸ¥çœ‹ä¸‹ä¸€ä¸ªè°ƒç”¨ <code>next()</code> æ—¶å°†è¿”å›çš„å…ƒç´ ã€‚</li>
</ul>
<p><strong>å®ƒå¸¦æ¥çš„ä¾¿åˆ©ï¼š</strong></p>
<p>PeekingIterator çš„ <code>peek()</code> æ–¹æ³•èƒ½å¤Ÿæ”¯æŒæ›´çµæ´»çš„è¿­ä»£é€»è¾‘ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ ¹æ®å½“å‰å…ƒç´ å’Œâ€œä¸‹ä¸€ä¸ªâ€å…ƒç´ å…³ç³»è¿›è¡Œåˆ¤æ–­çš„åœºæ™¯ä¸­ã€‚å®ƒå…è®¸åœ¨ä¸€æ¬¡è¿­ä»£è¿‡ç¨‹ä¸­å®Œæˆå¤æ‚çš„é€»è¾‘åˆ¤æ–­å’Œæ•°æ®å¤„ç†ï¼Œé¿å…äº†ä¼ ç»Ÿæ–¹æ³•ä¸­å¯èƒ½å‡ºç°çš„å†—ä½™ <code>next()</code> è°ƒç”¨æˆ–é¢å¤–çš„çŠ¶æ€å˜é‡ç®¡ç†ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šæ¶ˆé™¤è¿ç»­é‡å¤å…ƒç´ </strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PeekingIteratorExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;Integer&gt; source = Arrays.asList(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>);
        List&lt;Integer&gt; result = Lists.newArrayList();

        PeekingIterator&lt;Integer&gt; iter = Iterators.peekingIterator(source.iterator());

        <span class="hljs-keyword">while</span> (iter.hasNext()) {
            <span class="hljs-type">Integer</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> iter.next(); <span class="hljs-comment">// è·å–å½“å‰å…ƒç´ </span>
            result.add(current); <span class="hljs-comment">// å°†å½“å‰å…ƒç´ æ·»åŠ åˆ°ç»“æœ</span>

            <span class="hljs-comment">// åˆ©ç”¨ peek() æå‰åˆ¤æ–­ï¼Œå¦‚æœä¸‹ä¸€ä¸ªå…ƒç´ ä¸å½“å‰å…ƒç´ é‡å¤ï¼Œåˆ™è·³è¿‡ã€‚</span>
            <span class="hljs-keyword">while</span> (iter.hasNext() &amp;&amp; iter.peek().equals(current)) {
                iter.next(); <span class="hljs-comment">// è·³è¿‡è¿™ä¸ªé‡å¤å…ƒç´ </span>
            }
        }
        System.out.println(<span class="hljs-string">"Original: "</span> + source);
        System.out.println(<span class="hljs-string">"Deduplicated: "</span> + result); <span class="hljs-comment">// Output: [1, 2, 3, 4, 5]</span>
    }
}
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…å¯¹ <code>source</code> åˆ—è¡¨è¿›è¡Œäº†ä¸€æ¬¡é€»è¾‘éå†ã€‚PeekingIterator ä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿåœ¨å¤„ç† <code>current</code> å…ƒç´ çš„åŒæ—¶ï¼Œé¢„åˆ¤å¹¶è·³è¿‡æ‰€æœ‰åç»­çš„é‡å¤é¡¹ï¼Œè€Œæ— éœ€å°†å®ƒä»¬å­˜å‚¨åˆ°ä»»ä½•ä¸­é—´ç»“æ„æˆ–è¿›è¡Œåç»­çš„å»é‡å¤„ç†ã€‚è¿™ç®€åŒ–äº†å»é‡é€»è¾‘çš„å®ç°ã€‚</p>
<p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong> ç”± <code>Iterators.peekingIterator</code> è¿”å›çš„ <code>PeekingIterator</code> ä¸æ”¯æŒåœ¨è°ƒç”¨ <code>peek()</code> ä¹‹åæ‰§è¡Œ <code>remove()</code> æ“ä½œã€‚</p>
<h3 data-id="heading-1">2. AbstractIteratorï¼šä¸€ä¸ªæ–¹æ³•å®šä¹‰è¿­ä»£å™¨</h3>
<p>å½“éœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ Iteratorï¼Œä¾‹å¦‚å¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€è½¬æ¢æˆ–ä»å¤æ‚æ•°æ®æºä¸­æå–æ—¶ï¼Œæ‰‹åŠ¨ç®¡ç† <code>hasNext()</code> å’Œ <code>next()</code> çš„å†…éƒ¨çŠ¶æ€ä¼šå¼•å…¥å¤§é‡æ ·æ¿ä»£ç ã€‚AbstractIterator æå¤§åœ°ç®€åŒ–äº†è¿™ä¸€è¿‡ç¨‹ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<ul>
<li>å¼€å‘è€…åªéœ€å®ç°ä¸€ä¸ªæ–¹æ³•ï¼š<code>computeNext()</code>ã€‚æ­¤æ–¹æ³•è´Ÿè´£è®¡ç®—å¹¶è¿”å›åºåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ã€‚</li>
<li>å½“è¿­ä»£åºåˆ—å®Œæˆæ—¶ï¼Œ<code>computeNext()</code> åº”è¿”å› <code>endOfData()</code> ä»¥æ ‡è®°è¿­ä»£ç»“æŸã€‚</li>
</ul>
<p><strong>å®ƒå¸¦æ¥çš„ä¾¿åˆ©ï¼š</strong></p>
<p>AbstractIterator é‡‡ç”¨æƒ°æ€§æ±‚å€¼ï¼ˆlazy evaluationï¼‰æœºåˆ¶ã€‚å®ƒç¡®ä¿ <code>computeNext()</code> æ–¹æ³•ä»…åœ¨çœŸæ­£éœ€è¦ä¸‹ä¸€ä¸ªå…ƒç´ ï¼ˆå³ <code>next()</code> è¢«è°ƒç”¨æ—¶ï¼‰æ‰ä¼šè¢«æ‰§è¡Œã€‚è¿™ä½¿å¾—è¿­ä»£å™¨èƒ½å¤ŸæŒ‰éœ€ç”Ÿæˆå…ƒç´ ï¼Œé¿å…äº†åœ¨è¿­ä»£å™¨æœªè¢«å®Œå…¨æ¶ˆè´¹æ—¶è¿›è¡Œä¸å¿…è¦çš„è®¡ç®—ã€‚åŒæ—¶ï¼ŒGuava è´Ÿè´£å¤„ç† <code>hasNext()</code> å’Œ <code>next()</code> ä¹‹é—´çš„çŠ¶æ€åŒæ­¥ï¼Œç®€åŒ–äº†è‡ªå®šä¹‰è¿­ä»£å™¨çš„å®ç°ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šæƒ°æ€§è¿‡æ»¤ Null å€¼</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractIteratorExample</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Iterator&lt;String&gt; <span class="hljs-title function_">skipNulls</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Iterator&lt;String&gt; in)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractIterator</span>&lt;String&gt;() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> String <span class="hljs-title function_">computeNext</span><span class="hljs-params">()</span> {
                <span class="hljs-keyword">while</span> (in.hasNext()) {
                    <span class="hljs-type">String</span> <span class="hljs-variable">s</span> <span class="hljs-operator">=</span> in.next();
                    <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>) {
                        <span class="hljs-keyword">return</span> s; <span class="hljs-comment">// æ‰¾åˆ°é null å…ƒç´ ï¼Œè¿”å›</span>
                    }
                }
                <span class="hljs-keyword">return</span> endOfData(); <span class="hljs-comment">// å†…éƒ¨è¿­ä»£å™¨è€—å°½ï¼Œè¿”å› endOfData()</span>
            }
        };
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        List&lt;String&gt; source = Arrays.asList(<span class="hljs-string">"hello"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"world"</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">"guava"</span>, <span class="hljs-string">"java"</span>);
        Iterator&lt;String&gt; filteredIterator = skipNulls(source.iterator());

        System.out.println(<span class="hljs-string">"Filtered elements (only consuming first 3):"</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (filteredIterator.hasNext() &amp;&amp; count &lt; <span class="hljs-number">3</span>) { <span class="hljs-comment">// å‡è®¾æˆ‘ä»¬åªæ¶ˆè´¹å‰3ä¸ªå…ƒç´ </span>
            System.out.println(filteredIterator.next());
            count++;
        }
        <span class="hljs-comment">// Output:</span>
        <span class="hljs-comment">// hello</span>
        <span class="hljs-comment">// world</span>
        <span class="hljs-comment">// guava</span>
    }
}
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œå³ä½¿ <code>source</code> åˆ—è¡¨ä¸­æœ‰æ›´å¤šå…ƒç´ ï¼Œæˆ‘ä»¬åªæ¶ˆè´¹äº†å‰ 3 ä¸ªéç©ºå­—ç¬¦ä¸²ã€‚AbstractIterator ç¡®ä¿äº† <code>in.next()</code> å’Œ <code>if (s != null)</code> è¿™æ ·çš„æ“ä½œä»…æ‰§è¡Œäº†åˆšå¥½è¶³ä»¥æ‰¾åˆ°è¿™ 3 ä¸ªå…ƒç´ æ‰€éœ€çš„æœ€å°æ¬¡æ•°ã€‚è¿™ç§æŒ‰éœ€è®¡ç®—çš„æ¨¡å¼ï¼Œä½¿å¾—è¿­ä»£å™¨åªåœ¨éœ€è¦æ—¶æ‰å¤„ç†æ•°æ®ã€‚</p>
<p><strong>é™åˆ¶ï¼š</strong> AbstractIterator ç»§æ‰¿è‡ª <code>UnmodifiableIterator</code>ï¼Œè¿™æ„å‘³ç€å®ƒç¦æ­¢å®ç° <code>remove()</code> æ–¹æ³•ã€‚å¦‚æœæ‚¨çš„è¿­ä»£å™¨å¿…é¡»æ”¯æŒ <code>remove()</code>ï¼Œåˆ™ä¸åº”ç»§æ‰¿ AbstractIteratorã€‚</p>
<pre><code class="hljs language-java" lang="java"/></pre>
<h3 data-id="heading-2">3. AbstractSequentialIterator</h3>
<p>å¯¹äºé‚£äº›ä¸‹ä¸€ä¸ªå€¼å¾ˆå®¹æ˜“æ ¹æ®å‰ä¸€ä¸ªå€¼è®¡ç®—å‡ºæ¥çš„è¿­ä»£å™¨ï¼ŒAbstractSequentialIterator æä¾›äº†ä¸€ç§è¡¨è¾¾è¿­ä»£çš„æ›¿ä»£æ–¹å¼ã€‚</p>
<p><strong>æ ¸å¿ƒåŠŸèƒ½ï¼š</strong></p>
<ul>
<li>å¼€å‘è€…å®ç°çš„æ–¹æ³•æ˜¯ <code>computeNext(T previous)</code>ï¼Œå®ƒæ¥å—åºåˆ—ä¸­çš„å‰ä¸€ä¸ªå€¼ä½œä¸ºå‚æ•°ã€‚</li>
<li>å¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­æä¾›ä¸€ä¸ªåˆå§‹å€¼ï¼ˆæˆ–è€…å¦‚æœè¿­ä»£å™¨åº”ç«‹å³ç»ˆæ­¢ï¼Œåˆ™ä¼ å…¥ <code>null</code>ï¼‰ã€‚</li>
<li><code>computeNext()</code> æ–¹æ³•çº¦å®šï¼Œè¿”å› <code>null</code> æ„å‘³ç€è¿­ä»£ç»“æŸã€‚</li>
</ul>
<p><strong>å®ƒå¸¦æ¥çš„ä¾¿åˆ©ï¼š</strong></p>
<p>AbstractSequentialIterator é€‚ç”¨äºé‚£äº›ä¸‹ä¸€ä¸ªå€¼å¯ä»¥æ ¹æ®å‰ä¸€ä¸ªå€¼è®¡ç®—å‡ºæ¥çš„åºåˆ—ã€‚å®ƒé€šè¿‡**æŒ‰éœ€ç”Ÿæˆï¼ˆon-demand generationï¼‰**æœºåˆ¶ï¼Œä»…åœ¨ <code>next()</code> è¢«è°ƒç”¨æ—¶æ‰è®¡ç®—ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚è¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆå¤„ç†å¯èƒ½éå¸¸é•¿ç”šè‡³æ— é™çš„åºåˆ—ï¼Œå› ä¸ºå®ƒé¿å…äº†é¢„å…ˆè®¡ç®—å’Œå­˜å‚¨æ•´ä¸ªåºåˆ—ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼šæƒ°æ€§è®¡ç®— 2 çš„å¹‚æ¬¡</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AbstractSequentialIteratorExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-comment">// ä»1å¼€å§‹ç”Ÿæˆ2çš„å¹‚æ¬¡æ–¹ï¼Œç›´åˆ°è¾¾åˆ° 1 &lt;&lt; 30</span>
        Iterator&lt;Integer&gt; powersOfTwo = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractSequentialIterator</span>&lt;Integer&gt;(<span class="hljs-number">1</span>) {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> Integer <span class="hljs-title function_">computeNext</span><span class="hljs-params">(Integer previous)</span> {
                <span class="hljs-comment">// å¦‚æœ previous å·²ç»è¾¾åˆ°æœ€å¤§å€¼ï¼Œåˆ™è¿”å› null ç»“æŸè¿­ä»£</span>
                <span class="hljs-keyword">return</span> (previous == <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">30</span>) ? <span class="hljs-literal">null</span> : previous * <span class="hljs-number">2</span>;
            }
        };

        System.out.println(<span class="hljs-string">"Powers of two (only consuming first 7):"</span>);
        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (powersOfTwo.hasNext() &amp;&amp; count &lt; <span class="hljs-number">7</span>) { <span class="hljs-comment">// å‡è®¾æˆ‘ä»¬åªæ¶ˆè´¹å‰7ä¸ªå…ƒç´ </span>
            System.out.println(powersOfTwo.next());
            count++;
        }
        <span class="hljs-comment">// Output: 1, 2, 4, 8, 16, 32, 64</span>
    }
}
</code></pre>
<p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä»…æ¶ˆè´¹äº†åºåˆ—çš„å‰ 7 ä¸ªå…ƒç´ ã€‚AbstractSequentialIterator ç¡®ä¿äº†åªæœ‰è¿™ 7 æ¬¡ä¹˜æ³•æ“ä½œè¢«æ‰§è¡Œï¼Œå¹¶ä¸”åœ¨å†…å­˜ä¸­åªç»´æŠ¤äº†å½“å‰ <code>previous</code> å…ƒç´ çš„çŠ¶æ€ã€‚è¿™ç§æƒ°æ€§ç”Ÿæˆæ–¹å¼ï¼Œé¿å…äº†å¯¹æ•´ä¸ªåºåˆ—è¿›è¡Œé¢„è®¡ç®—å’Œå­˜å‚¨çš„éœ€è¦ã€‚</p>
<p><strong>å…³é”®é™åˆ¶ï¼š</strong> ç”±äºè¿”å› <code>null</code> æ ‡å¿—ç€è¿­ä»£çš„ç»“æŸï¼Œå› æ­¤ AbstractSequentialIterator ä¸èƒ½ç”¨äºå®ç°ä¸€ä¸ªå¯ä»¥åˆæ³•è¿”å› <code>null</code> å…ƒç´ çš„è¿­ä»£å™¨ã€‚</p>
<p>ç¬”è€…é‡åˆ°ä¸€ä¸ªæŒ‰éœ€æ·±æ‹·è´çš„éœ€æ±‚ï¼Œç®€å•æè¿°ä¸ºï¼šå·²è·å¾—å¯¹è±¡aï¼Œéœ€è¦æ·±æ‹·è´è‹¥å¹²ä»½ï¼ŒåŒæ—¶éœ€è¦æ ‡è®°åºå·ï¼Œaå·²ç»å®ç°deepCopyæ–¹æ³•ã€‚å®ç°å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å®ç°1</span>
<span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();
<span class="hljs-type">boolean</span> <span class="hljs-variable">first</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x: request.getXList()) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (first) {
            x.setA(a);
            first = <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-type">A</span> <span class="hljs-variable">newA</span> <span class="hljs-operator">=</span> a.deepCopy();
            newA.seq++;
            x.setA(newA);
        }
    }
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// å®ç°2ï¼Œä¿®æ”¹å¼•ç”¨a</span>
<span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x: request.getXList()) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">null</span>) {
        x.setA(a);
        a = a.deepCopy(); <span class="hljs-comment">//ä¼šå¤šå¤åˆ¶ä¸€æ¬¡</span>
        a.seq++;
    }
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// æ–°å®ç°</span>
<span class="hljs-type">A</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getA();
<span class="hljs-comment">// copy iter</span>
Iterator&lt;A&gt; aIter = <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractSequentialIterator</span>&lt;&gt;(a) {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">protected</span> A <span class="hljs-title function_">computeNext</span><span class="hljs-params">(A prev)</span> {
        <span class="hljs-type">A</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> prev.deepCopy();
        result.seq++;
        <span class="hljs-keyword">return</span> result;
    }
};
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x: request.getXList()) {
    <span class="hljs-comment">// ...</span>
    <span class="hljs-keyword">if</span> (a != <span class="hljs-literal">null</span>) {
        x.setA(aIter.next());
    }
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>å’ŒåŸæœ‰å®ç°ç›¸æ¯”ï¼Œæ–°å®ç°æŠ½å–å‡ºäº†Açš„è¿­ä»£é€»è¾‘ï¼Œæ›´å¥½ç†è§£ã€‚</p>
<h3 data-id="heading-3">æ€»ç»“</h3>
<p>Guava çš„ PeekingIteratorã€AbstractIterator å’Œ AbstractSequentialIterator ä¸º Java å¼€å‘è€…æä¾›äº†å¼ºå¤§çš„å·¥å…·ï¼Œç”¨äºç®€åŒ–å’Œå¢å¼ºè¿­ä»£å™¨çš„ä½¿ç”¨ã€‚å®ƒä»¬é€šè¿‡ä»¥ä¸‹æ–¹å¼æå‡ä»£ç çš„å¥å£®æ€§å’Œå¯ç»´æŠ¤æ€§ï¼š</p>
<ul>
<li><strong>PeekingIteratorï¼š</strong> å…è®¸åœ¨å•æ¬¡éå†ä¸­è¿›è¡Œé¢„åˆ¤å’Œå¤æ‚é€»è¾‘å¤„ç†ï¼Œå‡å°‘äº†çŠ¶æ€ç®¡ç†å’Œå†—ä½™æ“ä½œã€‚</li>
<li><strong>AbstractIteratorï¼š</strong> å¼ºåˆ¶æƒ°æ€§æ±‚å€¼ï¼Œç®€åŒ–äº†è‡ªå®šä¹‰è¿­ä»£å™¨çš„å®ç°ï¼Œå¹¶æŒ‰éœ€å¤„ç†æ•°æ®ã€‚</li>
<li><strong>AbstractSequentialIteratorï¼š</strong> å®ç°æŒ‰éœ€ç”Ÿæˆåºåˆ—ï¼Œé€‚ç”¨äºå¤„ç†é•¿åºåˆ—ï¼Œé¿å…äº†ä¸å¿…è¦çš„é¢„è®¡ç®—å’Œå­˜å‚¨ã€‚</li>
</ul>
<p>åœ¨å¤„ç†æ•°æ®æµã€æ„å»ºæ•°æ®ç®¡é“æˆ–å®ç°å¤æ‚ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œåˆç†åˆ©ç”¨è¿™äº›è¿­ä»£å™¨ï¼Œå¯ä»¥ä½¿ä»£ç æ›´åŠ æ¸…æ™°ã€çµæ´»ï¼Œå¹¶æ›´å¥½åœ°ç®¡ç†èµ„æºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€]]></title>    <link>https://juejin.cn/post/7570903763722321930</link>    <guid>https://juejin.cn/post/7570903763722321930</guid>    <pubDate>2025-11-10T15:05:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763722321930" data-draft-id="7570912420568367114" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T15:05:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æˆ‘æ˜¯æ°å°¼"/> <meta itemprop="url" content="https://juejin.cn/user/4200579899599495"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4200579899599495/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æˆ‘æ˜¯æ°å°¼
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:05:41.000Z" title="Mon Nov 10 2025 15:05:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æµ‹è¯•è‡ªåŠ¨åŒ–Replayï¼šè®©æ•°æ®åº“è¿ç§»æµ‹è¯•å›å½’çœŸå®åœºæ™¯çš„ä¸€æŠŠâ€œåˆ©å™¨â€</h2>
<p>åœ¨å½“å‰æ•°æ®åº“å›½äº§åŒ–çš„å¤§è¶‹åŠ¿ä¸‹ï¼Œè¶Šæ¥è¶Šå¤šçš„ä¼ä¸šå¼€å§‹ä»ä¼ ç»Ÿè¿›å£æ•°æ®åº“å‘å›½äº§æ•°æ®åº“è¿›è¡Œæ›¿ä»£ã€‚ç„¶è€Œï¼ŒçœŸæ­£å½±å“è¿ç§»è¿›åº¦çš„å¾€å¾€ä¸æ˜¯æ•°æ®è¿ç§»æœ¬èº«ï¼Œè€Œæ˜¯ <strong>æµ‹è¯•éªŒè¯ç¯èŠ‚</strong>ã€‚</p>
<p>å¦‚æœæµ‹è¯•ä¸èƒ½è¦†ç›–çœŸå®ä¸šåŠ¡åœºæ™¯ï¼Œè¿ç§»åçš„ç³»ç»Ÿä¸Šçº¿åå¾ˆå¯èƒ½å‡ºç°ï¼š</p>
<ul>
<li>æ€§èƒ½æ˜æ˜¾ä¸‹é™</li>
<li>å¹¶å‘å†²çªå’Œæ…¢æŸ¥è¯¢é¢‘å‘</li>
<li>æ•°æ®ä¸€è‡´æ€§å¼‚å¸¸éš¾ä»¥å®šä½</li>
</ul>
<p>å¾ˆå¤šä¼ä¸šè¿ç§»é¡¹ç›®å»¶æœŸ 1~3 ä¸ªæœˆï¼Œæ ¹æœ¬åŸå› éƒ½æŒ‡å‘äº†åŒä¸€ä¸ªé—®é¢˜ï¼š<strong>æµ‹è¯•ä¸å¤ŸçœŸå®</strong>ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ˜¯å¦æœ‰åŠæ³•æŠŠâ€œç”Ÿäº§ç¯å¢ƒæ­£åœ¨å‘ç”Ÿçš„çœŸå®è¡Œä¸ºâ€ï¼Œç›´æ¥æ¬è¿›æµ‹è¯•ç¯å¢ƒä¸­æ¥å¤ç°ï¼Ÿ
è¿™ä¾¿æ˜¯æœ¬æ–‡è¦ä»‹ç»çš„å®è·µæ–¹å‘ï¼š<strong>ç”Ÿäº§è´Ÿè½½å›æ”¾ï¼ˆReplayï¼‰æŠ€æœ¯</strong>ã€‚</p>
<hr/>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/61cb0ad2efe74364b0b6762d536b7b81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5oiR5piv5p2w5bC8:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763391940&amp;x-signature=Dc6XybQ1Aqqp1rO2fgcVtBIiyKs%3D" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°" loading="lazy"/></p>
<h3 data-id="heading-1"><strong>ä¸€ã€è¿ç§»æµ‹è¯•ä¸ºä½•æ€»æ˜¯éš¾ä»¥åšå¥½ï¼Ÿ</strong></h3>
<p>æ•°æ®åº“è¿ç§»æµ‹è¯•ï¼Œä¼ ç»Ÿæ–¹å¼å¤šä¾èµ–äººåŠ›ç¼–å†™ SQLã€è„šæœ¬æ¨¡æ‹Ÿä¸šåŠ¡åœºæ™¯ï¼Œä½†è¿™ç±»æ‰‹æ®µå­˜åœ¨å¤©ç„¶é™åˆ¶ï¼š</p>





















<table><thead><tr><th>é—®é¢˜</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åœºæ™¯è¦†ç›–ä¸è¶³</strong></td><td>äººå·¥ç”¨ä¾‹åªå…³æ³¨æ ¸å¿ƒæµç¨‹ï¼ŒçœŸå®ç¯å¢ƒä¸­å¤§é‡è¾¹ç¼˜å¹¶å‘åœºæ™¯æ— æ³•è¦†ç›–</td></tr><tr><td><strong>æ€§èƒ½æµ‹è¯•å¤±çœŸ</strong></td><td>è‡ªåˆ¶å‹åŠ›è„šæœ¬æ— æ³•å¤ç°ä¸šåŠ¡å³°å€¼ç‰¹å¾ä¸å¹¶å‘æ¨¡å‹</td></tr><tr><td><strong>å›å½’æµ‹è¯•æˆæœ¬é«˜</strong></td><td>é…ç½®å˜æ›´ / å‚æ•°è°ƒä¼˜åï¼Œéœ€è¦é‡å¤å¤§é‡éªŒè¯å·¥ä½œ</td></tr></tbody></table>
<p>ç®€å•æ¥è¯´ï¼š<strong>ä½ æµ‹åˆ°çš„ç³»ç»Ÿå’Œä½ è¦ä¸Šçº¿çš„ç³»ç»Ÿä¸æ˜¯åŒä¸€ä¸ªç³»ç»Ÿã€‚</strong></p>
<p>å°±åƒæœ‰å¥è¯è¯´çš„ï¼š</p>
<blockquote>
<p><em>â€œåœ¨å®éªŒå®¤è·‘å¾—å†é¡ºï¼Œä¹Ÿä¸ä»£è¡¨èƒ½æ‰›ä½åŒåä¸€ã€‚â€</em></p>
</blockquote>
<p>è¿ç§»æµ‹è¯•ç¼ºçš„ï¼Œå°±æ˜¯ <strong>çœŸå®ä¸šåŠ¡è´Ÿè½½æœ¬èº«</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-2"><strong>äºŒã€è§£å†³æ€è·¯ï¼šæŠŠç”Ÿäº§ç¯å¢ƒâ€œå½•ä¸‹æ¥ï¼Œå†æ”¾ä¸€éâ€</strong></h3>
<p>ä¸ºäº†è®©æµ‹è¯•è´´è¿‘çœŸå®ä¸šåŠ¡ï¼ŒæŠ€æœ¯å›¢é˜Ÿé‡‡ç”¨äº† <strong>KReplay ç”Ÿäº§è´Ÿè½½å›æ”¾å·¥å…·</strong>ï¼Œå…¶æ ¸å¿ƒæ€è·¯å¯æ¦‚æ‹¬ä¸ºå››æ­¥ï¼š</p>
<blockquote>
<p><strong>é‡‡ â†’ è½¬ â†’ æ”¾ â†’ æ ¸</strong></p>
<p>å³ï¼šé‡‡é›†çœŸå®æµé‡ â†’ è½¬æ¢é€‚é… â†’ å›æ”¾æ‰§è¡Œ â†’ ç»“æœæ¯”å¯¹</p>
</blockquote>
<h4 data-id="heading-3"><strong>1. ä¸šåŠ¡è´Ÿè½½é‡‡é›†ï¼ˆCaptureï¼‰</strong></h4>
<p>ä»æ—§æ•°æ®åº“ï¼ˆå¦‚ Oracleï¼‰ä¸­æŒç»­è®°å½•çœŸå®ä¸šåŠ¡æ“ä½œï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>SQL è¯­å¥ + å…¥å‚å˜é‡</li>
<li>ä¼šè¯ IDã€äº‹åŠ¡è¾¹ç•Œ</li>
<li>æ‰§è¡Œæ—¶åºä¸å¹¶å‘å…³ç³»</li>
</ul>
<p>ç¤ºä¾‹ï¼ˆOracle ç«¯å¼€å¯è´Ÿè½½é‡‡é›†ï¼‰ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>
  DBMS_WORKLOAD_CAPTURE.START_CAPTURE(
    name <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'daily_load_capture'</span>,
    dir  <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-string">'CAP_DIR'</span>,
    duration <span class="hljs-operator">=</span><span class="hljs-operator">&gt;</span> <span class="hljs-number">72000</span>   <span class="hljs-comment">-- é‡‡é›† 20å°æ—¶</span>
  );
<span class="hljs-keyword">END</span>;
<span class="hljs-operator">/</span>
</code></pre>
<p>æ­¤è¿‡ç¨‹å¯¹ç”Ÿäº§ç¯å¢ƒå½±å“æä½ï¼ˆCPU &lt; 5%ï¼‰ï¼Œå¯å®‰å…¨è¿è¡Œã€‚</p>
<hr/>
<h4 data-id="heading-4"><strong>2. è´Ÿè½½è½¬æ¢ï¼ˆConvertï¼‰</strong></h4>
<p>ç”±äºä¸åŒæ•°æ®åº“åœ¨è¯­æ³•ã€ç±»å‹ã€å‡½æ•°ä¸Šå­˜åœ¨å·®å¼‚ï¼Œéœ€è¦è‡ªåŠ¨è½¬æ¢ï¼š</p>





















<table><thead><tr><th>Oracle</th><th>KingbaseES</th></tr></thead><tbody><tr><td><code>ROWNUM</code></td><td><code>LIMIT</code></td></tr><tr><td><code>NVL(a,b)</code></td><td><code>COALESCE(a,b)</code></td></tr><tr><td><code>DATE</code> ç²¾åº¦</td><td><code>TIMESTAMP</code> ç²¾åº¦æ‰©å±•</td></tr></tbody></table>
<p>è¯¥æ­¥éª¤ç”±å·¥å…·è‡ªåŠ¨å®Œæˆï¼Œå®æµ‹è‡ªåŠ¨åŒ–é€‚é…ç‡å¯è¾¾ <strong>99%+</strong>ï¼Œå¤§å¹…å‡å°‘äººå·¥æ”¹å†™ã€‚</p>
<hr/>
<h4 data-id="heading-5"><strong>3. é«˜ä¿çœŸè´Ÿè½½å›æ”¾ï¼ˆReplayï¼‰</strong></h4>
<p>è½¬æ¢åçš„è´Ÿè½½åœ¨æ–°æ•°æ®åº“ä¸ŠæŒ‰åŸå§‹æ‰§è¡ŒèŠ‚å¥å¤ç°ã€‚</p>
<p>æ”¯æŒä¸‰ç§æ¨¡å¼ï¼š</p>





















<table><thead><tr><th>æ¨¡å¼</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>åŸé€Ÿå›æ”¾</td><td>éªŒè¯ç¨³å®šæ€§</td></tr><tr><td>åŠ é€Ÿå›æ”¾ï¼ˆä¾‹å¦‚ Ã—2ï¼‰</td><td>çŸ­æ—¶é—´å†…å‹æµ‹æ€§èƒ½ç“¶é¢ˆ</td></tr><tr><td>å‡é€Ÿå›æ”¾ï¼ˆä¾‹å¦‚ Ã·2ï¼‰</td><td>ç”¨äºå®šä½å¤æ‚æ…¢ SQL / é”ç­‰å¾…é—®é¢˜</td></tr></tbody></table>
<p>åŒæ—¶ç”Ÿæˆ <strong>KWR æ€§èƒ½åˆ†ææŠ¥å‘Š</strong>ï¼ˆç±»ä¼¼ Oracle AWRï¼‰ï¼Œè¦†ç›–ï¼š</p>
<ul>
<li>I/O å‹åŠ›æƒ…å†µ</li>
<li>ç¼“å­˜å‘½ä¸­ç‡</li>
<li>é”ç­‰å¾…å…³ç³»</li>
<li>Top SQL åˆ†å¸ƒ</li>
</ul>
<p>è®© DBA èƒ½å¤Ÿç›´è§‚çœ‹åˆ°æ€§èƒ½å·®å¼‚æ ¹å› ã€‚</p>
<hr/>
<h4 data-id="heading-6"><strong>4. æ•°æ®ä¸€è‡´æ€§æ¯”å¯¹ï¼ˆValidateï¼‰</strong></h4>
<p>é€šè¿‡ <strong>KDTS æ•°æ®æ¯”å¯¹å·¥å…·</strong>ï¼Œå®ç°æºåº“ä¸ç›®æ ‡åº“çš„æ•°æ®ç»“æ„ &amp; å†…å®¹åŒå‘éªŒè¯ï¼š</p>
<ul>
<li>è¡¨è¡Œæ•°æ˜¯å¦ä¸€è‡´</li>
<li>å­—æ®µå€¼é€æ¡æ¯”å¯¹ï¼ˆå« BLOB / CLOBï¼‰</li>
<li>ç´¢å¼• / å¤–é”® / è§¦å‘å™¨ç­‰å…ƒä¿¡æ¯æ£€æŸ¥</li>
</ul>
<p>ä¸€æ—¦å‘ç°å·®å¼‚ï¼Œè‡ªåŠ¨ç”Ÿæˆå·®å¼‚æŠ¥å‘Šï¼Œå®šä½åˆ°è¡¨ + è¡Œ + å­—æ®µã€‚</p>
<p>ä¸å†éœ€è¦ç†¬å¤œæŸ¥æ—¥å¿—ã€å†™è„šæœ¬ã€åšäººå·¥æŠ½æŸ¥ã€‚</p>
<hr/>
<h3 data-id="heading-7"><strong>ä¸‰ã€å®æˆ˜æ¡ˆä¾‹ï¼šæŸå¤§å‹æ±½è½¦åˆ¶é€ é›†å›¢ ERP è¿ç§»</strong></h3>






























<table><thead><tr><th>æŒ‡æ ‡</th><th>å¼•å…¥ Replay å‰</th><th>å¼•å…¥å</th></tr></thead><tbody><tr><td>æµ‹è¯•å‘¨æœŸ</td><td>6 å‘¨</td><td><strong>3 å‘¨ï¼ˆç¼©çŸ­ 50%ï¼‰</strong></td></tr><tr><td>åœºæ™¯è¦†ç›–ç‡</td><td>çº¦ 40%</td><td><strong>è¾¾åˆ° 100%ï¼ˆçœŸå®ä¸šåŠ¡å…¨é‡å¤ç°ï¼‰</strong></td></tr><tr><td>äººå·¥æµ‹è¯•å·¥ä½œé‡</td><td>é«˜</td><td><strong>å‡å°‘ 70%+</strong></td></tr><tr><td>ä¸Šçº¿é£é™©</td><td>è¿ç§»åä»éœ€çº¿ä¸Šè§‚å¯Ÿ</td><td><strong>è¿ç§»å‰é£é™©å¯æå‰æš´éœ²ä¸ä¿®å¤</strong></td></tr></tbody></table>
<p>ä¸€å¥è¯ï¼š
<strong>ä»–ä»¬ä¸å†â€œé è¿æ°”ä¸Šçº¿â€ï¼Œè€Œæ˜¯â€œä¸Šçº¿å‰å°±çŸ¥é“ä¼šä¸ä¼šå‡ºäº‹â€ã€‚</strong></p>
<hr/>
<h3 data-id="heading-8"><strong>å››ã€æ€»ç»“ï¼šè¿ç§»æµ‹è¯•çš„æœªæ¥å±äºâ€œçœŸå®éªŒè¯â€</strong></h3>
<p>ä¼ ç»Ÿè¿ç§»æµ‹è¯•çš„ä¸Šé™æ˜¯â€œå¯ç”¨â€ï¼Œè€Œç”Ÿäº§è´Ÿè½½å›æ”¾çš„ç›®æ ‡æ˜¯ <strong>â€œå¯æ”¾å¿ƒä¸Šçº¿â€</strong>ã€‚</p>
<h4 data-id="heading-9"><strong>Replay æŠ€æœ¯å¸¦æ¥çš„æ”¹å˜</strong></h4>
<p>âœ… æµ‹è¯•ä»â€œæ¨¡æ‹Ÿâ€å‡çº§ä¸ºâ€œå®æˆ˜å¤åˆ»â€
âœ… æ€§èƒ½ç“¶é¢ˆèƒ½æå‰æš´éœ²ï¼Œè€Œä¸æ˜¯ä¸Šçº¿åæŠ¥è­¦
âœ… å›å½’æµ‹è¯•ä¸å†æ˜¯è€—æ—¶é»‘æ´
âœ… è¿ç§»æˆåŠŸç‡æ˜¾è‘—æå‡</p>
<p>éšç€ AI ä¸è‡ªåŠ¨è¯Šæ–­èƒ½åŠ›é€æ­¥èå…¥ï¼Œæœªæ¥è´Ÿè½½å›æ”¾å°†ä¸ä»…èƒ½â€œå¤ç°é—®é¢˜â€ï¼Œè¿˜å°†èƒ½â€œæå‰é¢„æµ‹é—®é¢˜â€ã€‚</p>
<blockquote>
<p><strong>æµ‹è¯•ä¸å†åªæ˜¯éªŒè¯ï¼Œè€Œæ˜¯å†³ç­–å¯ä¿¡æ€§çš„æ ¸å¿ƒä¾æ®ã€‚</strong></p>
</blockquote>
<p>åœ¨æ•°æ®åº“å›½äº§åŒ–è¿ç§»è¿›å…¥æ·±æ°´åŒºçš„ä»Šå¤©ï¼Œé—®é¢˜ä¸å†åªæ˜¯â€œèƒ½å¦å¹³æ›¿â€ï¼Œè€Œæ˜¯ èƒ½å¦ç¨³å®šä¸Šçº¿ã€å¯æ§è¿ç»´ã€é•¿æœŸå¯é è¿è¡Œã€‚ä¼ ç»Ÿæµ‹è¯•æ–¹å¼ç”±äºè„±ç¦»çœŸå®ä¸šåŠ¡ç¯å¢ƒï¼Œæ— æ³•æœ‰æ•ˆæš´éœ²æ½œåœ¨æ€§èƒ½ç“¶é¢ˆå’Œå…¼å®¹æ€§é£é™©ï¼Œå·²é€æ¸æˆä¸ºè¿ç§»é¡¹ç›®çš„ä¸»è¦é˜»ç¢ã€‚è€Œä»¥ KReplay ä¸ºä»£è¡¨çš„ ç”Ÿäº§è´Ÿè½½å›æ”¾æŠ€æœ¯ï¼Œé€šè¿‡â€œçœŸå®è´Ÿè½½é‡‡é›† + è‡ªåŠ¨åŒ–è½¬æ¢ + é«˜ä¿çœŸå›æ”¾ + å®Œæ•´ç»“æœæ¯”å¯¹â€çš„é—­ç¯èƒ½åŠ›ï¼Œè®©æµ‹è¯•ä»â€œé™æ€éªŒè¯â€èµ°å‘â€œçœŸå®é¢„æ¼”â€ï¼Œæ˜¾è‘—æå‡äº†è¿ç§»æ•ˆç‡ã€å¯æ§æ€§ä¸ç³»ç»Ÿä¸Šçº¿æˆåŠŸç‡ã€‚</p>
<p>äº‹å®è¯æ˜ï¼ŒçœŸå®è´Ÿè½½æœ¬èº«å°±æ˜¯æœ€å¥½çš„æµ‹è¯•ç”¨ä¾‹ã€‚åœ¨å¯é¢„è§çš„æœªæ¥ï¼Œä¼ä¸šçº§ç³»ç»Ÿçš„è¿ç§»ä¸å›å½’éªŒè¯å°†è¶Šæ¥è¶Šä¾èµ–è¿™ç±»åœºæ™¯å¤åˆ»ä¸æ™ºèƒ½åˆ†æçš„æŠ€æœ¯ä½“ç³»ã€‚å¯¹äºæ­£åœ¨æ¨è¿›æ•°æ®åº“å›½äº§åŒ–æˆ–å¤§å‹ç³»ç»Ÿå¹³å°è¿ç§»çš„ä¼ä¸šè€Œè¨€ï¼Œå°½æ—©å°†ç”Ÿäº§çº§å›æ”¾èƒ½åŠ›çº³å…¥æµ‹è¯•ä½“ç³»ï¼Œå°†ä¸åªæ˜¯æå‡æ•ˆç‡çš„é€‰æ‹©ï¼Œæ›´æ˜¯é™ä½é£é™©ã€ä¿éšœä¸šåŠ¡è¿ç»­æ€§çš„å…³é”®ä¸€æ­¥ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI Ã— Loguruï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯è¿ç»´â€çš„æ—¥å¿—å®æˆ˜]]></title>    <link>https://juejin.cn/post/7570912420568350730</link>    <guid>https://juejin.cn/post/7570912420568350730</guid>    <pubDate>2025-11-10T14:57:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570912420568350730" data-draft-id="7570912420568334346" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI Ã— Loguruï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯è¿ç»´â€çš„æ—¥å¿—å®æˆ˜"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T14:57:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI Ã— Loguruï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯è¿ç»´â€çš„æ—¥å¿—å®æˆ˜
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T14:57:18.000Z" title="Mon Nov 10 2025 14:57:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»3åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸€å¥è¯æ€»ç»“<br/>
æŠŠæ•£è½åœ¨ Uvicorn / FastAPI / ä¸šåŠ¡ä»£ç é‡Œçš„æ‰€æœ‰æ—¥å¿—ï¼Œ<strong>å…¨éƒ¨æ”¶æ•›åˆ° Loguru ä¸€ä¸ªç®¡é“</strong>ï¼Œç»Ÿä¸€æ ¼å¼ã€ç»Ÿä¸€åˆ†çº§ã€ç»Ÿä¸€è½ç›˜ï¼Œå¹¶è§£å†³é‡å¤è¾“å‡ºã€å¼‚æ­¥å®‰å…¨ã€è¯·æ±‚æº¯æºä¸‰å¤§ç—›ç‚¹ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆè¦â€œå¤šæ­¤ä¸€ä¸¾â€ï¼Ÿ</h2>






























<table><thead><tr><th>ç—›ç‚¹</th><th>åŸç”Ÿ logging çš„è¡¨ç°</th><th>Loguru çš„æ”¹è¿›</th></tr></thead><tbody><tr><td><strong>é‡å¤è¾“å‡º</strong></td><td>Uvicorn ä¸ FastAPI å„ç”¨å„çš„ Handlerï¼Œä¸€æ¡è¯·æ±‚åœ¨ç»ˆç«¯å‡ºç° 2~3 æ¬¡</td><td>æ‹¦æˆªæ ‡å‡†åº“ï¼Œå½»åº•å¹²æ‰é‡å¤ Handler</td></tr><tr><td><strong>æ ¼å¼ä¸ç»Ÿä¸€</strong></td><td>access æ—¥å¿—æ— é¢œè‰²ï¼Œä¸šåŠ¡æ—¥å¿—éš¾åŠ å­—æ®µ</td><td>ä¸€ä»½æ¨¡æ¿æ§åˆ¶æ‰€æœ‰ç›®çš„åœ°ï¼Œæ”¯æŒå½©è‰²/JSON</td></tr><tr><td><strong>å¼‚æ­¥å®‰å…¨</strong></td><td>å¤š worker ä¸‹æ–‡ä»¶é”ç«äº‰ï¼Œå‡ºç°é”™ä¹±</td><td><code>enqueue=True</code> å†…éƒ¨é˜Ÿåˆ— + åç¨‹å®‰å…¨</td></tr><tr><td><strong>å¯è§‚æµ‹æ€§</strong></td><td>æŠ¥é”™æ—¶åªèƒ½çœ‹åˆ°æ¡†æ¶æ ˆï¼Œæ‰¾ä¸åˆ°ä¸šåŠ¡å‚æ•°</td><td>ä¸­é—´ä»¶æ³¨å…¥ request_idï¼Œä¸€æ¬¡ grep å®šä½å…¨é“¾è·¯</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-1">2. æœ€å°å¯è¿è¡Œç‰ˆæœ¬ï¼ˆMVPï¼‰</h2>
<p><strong>å®‰è£…ä¾èµ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install fastapi uvicorn[standard] loguru
</code></pre>
<p><strong>main.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">import</span> uvicorn, sys

<span class="hljs-comment"># 1. ç§»é™¤é»˜è®¤ handlerï¼Œé˜²æ­¢é‡å¤</span>
logger.remove()
logger.add(sys.stdout,
           colorize=<span class="hljs-literal">True</span>,
           <span class="hljs-built_in">format</span>=<span class="hljs-string">"&lt;green&gt;{time:HH:mm:ss}&lt;/green&gt; | &lt;lvl&gt;{level: &lt;8}&lt;/lvl&gt; | {message}"</span>)

app = FastAPI()

<span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">"/ping"</span></span>)</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">ping</span>():
    logger.info(<span class="hljs-string">"pong"</span>)
    <span class="hljs-keyword">return</span> {<span class="hljs-string">"msg"</span>: <span class="hljs-string">"pong"</span>}

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    <span class="hljs-comment"># 2. å…³é”®ï¼šç¦ç”¨ uvicorn çš„é»˜è®¤æ—¥å¿—é…ç½®</span>
    uvicorn.run(<span class="hljs-string">"main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, log_config=<span class="hljs-literal">None</span>)
</code></pre>
<blockquote>
<p>ç»ˆç«¯ç°åœ¨åªæœ‰ä¸€è¡Œå¸¦é¢œè‰²çš„ <code>pong</code>ï¼Œä¸–ç•Œå®‰é™äº†ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-2">3. ç”Ÿäº§çº§è„šæ‰‹æ¶ï¼šä¸ƒæ­¥ç»Ÿä¸€æ—¥å¿—</h2>
<p>æŠŠä¸‹é¢ä»£ç æ”¾åˆ° <code>app/core/logging.py</code>ï¼Œé¡¹ç›®å¯åŠ¨æ—¶ä¸€æ¬¡ <code>setup_logging()</code> å³å¯ã€‚</p>













































<table><thead><tr><th>æ­¥éª¤</th><th>ç›®çš„</th><th>å…³é”®å‚æ•°</th></tr></thead><tbody><tr><td>â‘  æ¸…ç©ºé»˜è®¤</td><td>é˜²æ­¢é‡å¤</td><td><code>logger.remove()</code></td></tr><tr><td>â‘¡ å½©è‰²ç»ˆç«¯</td><td>å¼€å‘è°ƒè¯•</td><td><code>colorize=True</code></td></tr><tr><td>â‘¢ æ–‡ä»¶è½®è½¬</td><td>é¿å…æ‰“çˆ†ç£ç›˜</td><td><code>rotation="100 MB", retention="30 days"</code></td></tr><tr><td>â‘£ é”™è¯¯åˆ†æµ</td><td>error.log å•ç‹¬åˆ†æ</td><td><code>level="ERROR"</code></td></tr><tr><td>â‘¤ å¼‚æ­¥å†™å…¥</td><td>é«˜å¹¶å‘ä¸é˜»å¡</td><td><code>enqueue=True</code></td></tr><tr><td>â‘¥ æ‹¦æˆªæ ‡å‡†åº“</td><td>æ”¶ç¼– Uvicorn</td><td><code>InterceptHandler</code></td></tr><tr><td>â‘¦ æ³¨å…¥ request_id</td><td>å…¨é“¾è·¯è¿½è¸ª</td><td><code>bind(request_id=...)</code></td></tr></tbody></table>
<p><strong>å®Œæ•´ä»£ç ï¼ˆå¯ç›´æ¥å¤ç”¨ï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> logging, sys, os
<span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">from</span> loguru <span class="hljs-keyword">import</span> logger
<span class="hljs-keyword">from</span> contextvars <span class="hljs-keyword">import</span> ContextVar

<span class="hljs-comment"># å…¨é“¾è·¯ request_id</span>
request_id: ContextVar[<span class="hljs-built_in">str</span>] = ContextVar(<span class="hljs-string">"request_id"</span>, default=<span class="hljs-string">"-"</span>)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">InterceptHandler</span>(logging.Handler):
    <span class="hljs-string">"""æŠŠæ ‡å‡†åº“æ—¥å¿—æ— ç¼è½¬åˆ° loguru"""</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">emit</span>(<span class="hljs-params">self, record: logging.LogRecord</span>):
        <span class="hljs-keyword">try</span>:
            level = logger.level(record.levelname).name
        <span class="hljs-keyword">except</span> ValueError:
            level = record.levelno
        frame, depth = logging.currentframe(), <span class="hljs-number">2</span>
        <span class="hljs-keyword">while</span> frame <span class="hljs-keyword">and</span> frame.f_code.co_filename == logging.__file__:
            frame = frame.f_back
            depth += <span class="hljs-number">1</span>
        logger.opt(depth=depth, exception=record.exc_info).log(
            level, record.getMessage()
        )

<span class="hljs-keyword">def</span> <span class="hljs-title function_">setup_logging</span>():
    log_dir = Path(<span class="hljs-string">"logs"</span>)
    log_dir.mkdir(exist_ok=<span class="hljs-literal">True</span>)

    <span class="hljs-comment"># ç»Ÿä¸€æ ¼å¼</span>
    fmt = (<span class="hljs-string">"&lt;green&gt;{time:YYYY-MM-DD HH:mm:ss.SSS}&lt;/green&gt; | "</span>
           <span class="hljs-string">"{extra[request_id]} | &lt;lvl&gt;{level: &lt;8}&lt;/lvl&gt; | "</span>
           <span class="hljs-string">"&lt;cyan&gt;{name}&lt;/cyan&gt;:&lt;cyan&gt;{function}&lt;/cyan&gt;:&lt;cyan&gt;{line}&lt;/cyan&gt; - &lt;lvl&gt;{message}&lt;/lvl&gt;"</span>)

    logger.remove()
    logger.add(sys.stdout, <span class="hljs-built_in">format</span>=fmt, level=<span class="hljs-string">"INFO"</span>, colorize=<span class="hljs-literal">True</span>)
    logger.add(log_dir / <span class="hljs-string">"app.log"</span>, rotation=<span class="hljs-string">"100 MB"</span>, retention=<span class="hljs-string">"30 days"</span>, enqueue=<span class="hljs-literal">True</span>, <span class="hljs-built_in">format</span>=fmt)
    logger.add(log_dir / <span class="hljs-string">"error.log"</span>, level=<span class="hljs-string">"ERROR"</span>, rotation=<span class="hljs-string">"100 MB"</span>, retention=<span class="hljs-string">"30 days"</span>, enqueue=<span class="hljs-literal">True</span>, <span class="hljs-built_in">format</span>=fmt)

    <span class="hljs-comment"># æ”¶ç¼–ä¸‰æ–¹åº“</span>
    logging.basicConfig(handlers=[InterceptHandler()], level=logging.INFO)
    <span class="hljs-keyword">for</span> name <span class="hljs-keyword">in</span> [<span class="hljs-string">"uvicorn"</span>, <span class="hljs-string">"uvicorn.access"</span>, <span class="hljs-string">"uvicorn.error"</span>, <span class="hljs-string">"fastapi"</span>]:
        _log = logging.getLogger(name)
        _log.handlers = [InterceptHandler()]
        _log.propagate = <span class="hljs-literal">False</span>
</code></pre>
<p><strong>FastAPI ä¸­é—´ä»¶ï¼šè‡ªåŠ¨æ³¨å…¥ request_id</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Request
<span class="hljs-keyword">import</span> uuid

<span class="hljs-meta">@app.middleware(<span class="hljs-params"><span class="hljs-string">"http"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_request_id</span>(<span class="hljs-params">request: Request, call_next</span>):
    rid = request.headers.get(<span class="hljs-string">"X-Request-ID"</span>) <span class="hljs-keyword">or</span> <span class="hljs-built_in">str</span>(uuid.uuid4())
    request_id.<span class="hljs-built_in">set</span>(rid)
    <span class="hljs-keyword">with</span> logger.contextualize(request_id=rid):
        logger.info(<span class="hljs-string">f"<span class="hljs-subst">{request.method}</span> <span class="hljs-subst">{request.url.path}</span>"</span>)
        response = <span class="hljs-keyword">await</span> call_next(request)
    response.headers[<span class="hljs-string">"X-Request-ID"</span>] = rid
    <span class="hljs-keyword">return</span> response
</code></pre>
<blockquote>
<p>ä¸€æ¬¡ <code>grep &lt;request_id&gt;</code> å³å¯æŠŠ access + ä¸šåŠ¡ + é”™è¯¯ æ—¥å¿—å…¨éƒ¨æ‹‰å‡ºæ¥ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-3">4. å¸¸è§é—®é¢˜ FAQ</h2>






























<table><thead><tr><th>ç°è±¡</th><th>æ ¹å› </th><th>è§£æ³•</th></tr></thead><tbody><tr><td>ç»ˆç«¯ä»ç„¶å‡ºç°åŒä»½</td><td>æ—§ handler æœªæ¸…å¹²å‡€</td><td>ç¡®ä¿ <code>logger.remove()</code> åœ¨æ–°å¢ add ä¹‹å‰æ‰§è¡Œ</td></tr><tr><td>å¤šè¿›ç¨‹æ—¥å¿—é”™ä¹±</td><td>æœªå¼€å¼‚æ­¥é˜Ÿåˆ—</td><td>æ‰€æœ‰ <code>logger.add(..., enqueue=True)</code></td></tr><tr><td>422 æŠ¥é”™æ— è¯·æ±‚ä½“</td><td>æ¡†æ¶æå‰æŠ›é”™</td><td>åœ¨ä¸­é—´ä»¶é‡Œ <code>try/except</code> å¹¶ <code>logger.bind(body=...)</code></td></tr><tr><td>æ—¥å¿—æ–‡ä»¶ä¸­æ–‡ä¹±ç </td><td>Windows é»˜è®¤ GBK</td><td>æ˜¾å¼ <code>encoding="utf-8"</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-4">5. ä¸€é”®å¯åŠ¨è„šæœ¬</h2>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># run.py</span>
<span class="hljs-keyword">import</span> uvicorn, asyncio
<span class="hljs-keyword">from</span> app.core.logging <span class="hljs-keyword">import</span> setup_logging

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():
    <span class="hljs-keyword">await</span> setup_logging()
    config = uvicorn.Config(<span class="hljs-string">"app.main:app"</span>, host=<span class="hljs-string">"0.0.0.0"</span>, port=<span class="hljs-number">8000</span>, log_config=<span class="hljs-literal">None</span>)
    server = uvicorn.Server(config)
    <span class="hljs-keyword">await</span> server.serve()

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:
    asyncio.run(main())
</code></pre>
<blockquote>
<p>æŠŠ <code>log_config=None</code> å†™æ­»ï¼Œå½»åº•æ–­ç» Uvicorn è‡ªå»º handler çš„æœºä¼šã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-5">6. ç»“è¯­</h2>
<p>æ—¥å¿—ä¸æ˜¯â€œæ‰“å°å­—ç¬¦ä¸²â€ï¼Œè€Œæ˜¯<strong>å¯è§‚æµ‹æ€§çš„åœ°åŸº</strong>ã€‚<br/>
ç”¨ Loguru æŠŠæ ¼å¼ã€åˆ†çº§ã€è½®è½¬ã€è¿½è¸ªä¸€æ¬¡åšåˆ°ä½ï¼Œä»¥åæŸ¥é—®é¢˜åªéœ€å¸¦ä¸Š <code>request_id</code> å’Œ <code>grep</code>ï¼Œå†ä¹Ÿä¸ç”¨é¢å¯¹æ»¡å±é‡å¤ã€æ ¼å¼ä¹±ç³Ÿç³Ÿçš„ç»ˆç«¯å‘å‘†ã€‚Happy logging!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7570903763722289162</link>    <guid>https://juejin.cn/post/7570903763722289162</guid>    <pubDate>2025-11-10T15:02:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763722289162" data-draft-id="7570897638441238555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T15:02:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Javaç§æ•™"/> <meta itemprop="url" content="https://juejin.cn/user/3394924618197325"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            FastAPI Ã— SQLAlchemy 2.0 Asyncï¼šä»â€œèƒ½è·‘â€åˆ°â€œå¯å‹æµ‹â€çš„å®Œæ•´å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3394924618197325/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Javaç§æ•™
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T15:02:02.000Z" title="Mon Nov 10 2025 15:02:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ä¸€å¥è¯æ€»ç»“<br/>
ç”¨ <strong>SQLAlchemy 2.0 AsyncIO</strong> æ¨¡å¼ï¼ŒæŠŠ FastAPI çš„å¹¶å‘ä¼˜åŠ¿å…‘ç°æˆ <strong>çœŸæ­£çš„æ•°æ®åº“åå</strong>ï¼›å†å ä¸Šè¿æ¥æ± ã€äº‹åŠ¡ã€è¿ç§»ã€æµ‹è¯•å››ä»¶å¥—ï¼Œ<strong>ç›´æ¥ä¸Šçº¿ä¸è¸©å‘</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">1. ä¸ºä»€ä¹ˆè¦â€œå¼‚æ­¥ ORMâ€ï¼Ÿ</h2>

























<table><thead><tr><th>åœºæ™¯</th><th>åŒæ­¥ SQLAlchemy</th><th>å¼‚æ­¥ SQLAlchemy</th></tr></thead><tbody><tr><td>100 ä¸ªå¹¶å‘ä¸Šä¼ </td><td>å¼€ 100 çº¿ç¨‹ â†’ 100 ä¸ªè¿æ¥ â†’ DB è¢«æ‰“çˆ†</td><td>å•çº¿ç¨‹ 20 è¿æ¥å³å¯è·‘æ»¡ CPU</td></tr><tr><td>è¯·æ±‚ç­‰å¾… I/O</td><td>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ 8 ms</td><td>åç¨‹åˆ‡æ¢ 0.3 ms</td></tr><tr><td>ä»£ç é£æ ¼</td><td>åˆ°å¤„ <code>run_in_threadpool</code></td><td>åŸç”Ÿ <code>await</code> ä¸€è·¯åˆ°åº•</td></tr></tbody></table>
<blockquote>
<p>ä¸€å¥è¯ï¼š<strong>åŒæ­¥æ¨¡å¼æŠŠ FastAPI çš„å¼‚æ­¥äº‹ä»¶å¾ªç¯æ‹–å›è§£æ”¾å‰</strong>ã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-1">2. æœ€å°å¯è¿è¡Œç‰ˆæœ¬ï¼ˆMVPï¼‰</h2>
<p><strong>å®‰è£…ä¾èµ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">pip install <span class="hljs-string">"fastapi[all]"</span> \
            <span class="hljs-string">"sqlalchemy[asyncio]&gt;=2.0"</span> \
            asyncpg alembic pydantic[email]
</code></pre>
<blockquote>
<p>æ•°æ®åº“ä»¥ PostgreSQL ä¸ºä¾‹ï¼ŒMySQL æ¢æˆ <code>asyncmy</code> å³å¯ã€‚</p>
</blockquote>
<p><strong>é¡¹ç›®éª¨æ¶</strong></p>
<pre><code class="hljs language-arduino" lang="arduino">app/
 â”œâ”€ api/
 â”‚   â””â”€ user.py
 â”œâ”€ core/
 â”‚   â”œâ”€ db.py
 â”‚   â””â”€ config.py
 â”œâ”€ models/
 â”‚   â””â”€ user.py
 â”œâ”€ schemas/
 â”‚   â””â”€ user.py
 â””â”€ main.py
</code></pre>
<hr/>
<h2 data-id="heading-2">3. æ ¸å¿ƒä»£ç ï¼šSession ç”Ÿå‘½å‘¨æœŸä¸€æ¡é¾™</h2>
<p><strong>app/core/config.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseSettings

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Settings</span>(<span class="hljs-title class_ inherited__">BaseSettings</span>):
    database_url: <span class="hljs-built_in">str</span> = <span class="hljs-string">"postgresql+asyncpg://user:pass@localhost:5432/demo"</span>
    pool_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>
    max_overflow: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>
    echo_sql: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        env_file = <span class="hljs-string">".env"</span>

settings = Settings()
</code></pre>
<p><strong>app/core/db.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> (
    AsyncEngine, AsyncSession, async_sessionmaker, create_async_engine
)

<span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncDatabaseSession</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, url: <span class="hljs-built_in">str</span>, *, pool_size: <span class="hljs-built_in">int</span> = <span class="hljs-number">20</span>, max_overflow: <span class="hljs-built_in">int</span> = <span class="hljs-number">0</span>, echo: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):
        self.engine: AsyncEngine = create_async_engine(
            url,
            pool_size=pool_size,
            max_overflow=max_overflow,
            echo=echo,
            pool_pre_ping=<span class="hljs-literal">True</span>,          <span class="hljs-comment"># å¿ƒè·³ä¿æ´»</span>
        )
        self.session_factory = async_sessionmaker(
            self.engine,
            expire_on_commit=<span class="hljs-literal">False</span>,      <span class="hljs-comment"># é˜²æ­¢æ‡’åŠ è½½å¼‚å¸¸</span>
            class_=AsyncSession,
        )

    <span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">close</span>(<span class="hljs-params">self</span>):
        <span class="hljs-keyword">await</span> self.engine.dispose()

db = AsyncDatabaseSession(
    settings.database_url,
    pool_size=settings.pool_size,
    echo=settings.echo_sql,
)
</code></pre>
<p><strong>main.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db
<span class="hljs-keyword">from</span> app.api <span class="hljs-keyword">import</span> user

app = FastAPI(title=<span class="hljs-string">"Async SQLAlchemy Demo"</span>)

app.include_router(user.router)

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"startup"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">startup</span>():
    <span class="hljs-comment"># å¯é€‰ï¼šå»ºè¡¨</span>
    <span class="hljs-comment"># from app.models import Base</span>
    <span class="hljs-comment"># async with db.engine.begin() as conn:</span>
    <span class="hljs-comment">#     await conn.run_sync(Base.metadata.create_all)</span>
    <span class="hljs-keyword">pass</span>

<span class="hljs-meta">@app.on_event(<span class="hljs-params"><span class="hljs-string">"shutdown"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">shutdown</span>():
    <span class="hljs-keyword">await</span> db.close()
</code></pre>
<hr/>
<h2 data-id="heading-3">4. ä¾èµ–æ³¨å…¥ï¼šæ¯æ¬¡è¯·æ±‚ä¸€ä¸ª Sessionï¼Œè‡ªåŠ¨å›æ»š</h2>
<p><strong>app/core/deps.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> AsyncGenerator
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncSession
<span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_session</span>() -&gt; AsyncGenerator[AsyncSession, <span class="hljs-literal">None</span>]:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> db.session_factory() <span class="hljs-keyword">as</span> session:
        <span class="hljs-keyword">try</span>:
            <span class="hljs-keyword">yield</span> session
        <span class="hljs-keyword">except</span> Exception:
            <span class="hljs-keyword">await</span> session.rollback()
            <span class="hljs-keyword">raise</span>
        <span class="hljs-keyword">finally</span>:
            <span class="hljs-keyword">await</span> session.close()
</code></pre>
<blockquote>
<p>ç”¨ <code>yield</code> + <code>rollback</code> ä¿è¯<strong>è¯·æ±‚çº§äº‹åŠ¡</strong>ï¼›æŠ›å¼‚å¸¸è‡ªåŠ¨å›æ»šï¼Œæ­£å¸¸åˆ™ commitã€‚</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">5. Model / Schema / CRUD ä¸€æ¡é¾™</h2>
<p><strong>app/models/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> String
<span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> DeclarativeBase, Mapped, mapped_column

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span>(<span class="hljs-title class_ inherited__">DeclarativeBase</span>):
    <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">Base</span>):
    __tablename__ = <span class="hljs-string">"users"</span>

    <span class="hljs-built_in">id</span>: Mapped[<span class="hljs-built_in">int</span>] = mapped_column(primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    email: Mapped[<span class="hljs-built_in">str</span>] = mapped_column(String(<span class="hljs-number">320</span>), unique=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>)
    full_name: Mapped[<span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>]
</code></pre>
<p><strong>app/schemas/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, EmailStr

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCreate</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    email: EmailStr
    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span> = <span class="hljs-literal">None</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserRead</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):
    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>
    email: EmailStr
    full_name: <span class="hljs-built_in">str</span> | <span class="hljs-literal">None</span>

    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:
        orm_mode = <span class="hljs-literal">True</span>
</code></pre>
<p><strong>app/api/user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter, Depends, HTTPException
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncSession
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> select
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User
<span class="hljs-keyword">from</span> app.schemas <span class="hljs-keyword">import</span> UserCreate, UserRead
<span class="hljs-keyword">from</span> app.core.deps <span class="hljs-keyword">import</span> get_session

router = APIRouter(prefix=<span class="hljs-string">"/users"</span>, tags=[<span class="hljs-string">"users"</span>])

<span class="hljs-meta">@router.post(<span class="hljs-params"><span class="hljs-string">""</span>, response_model=UserRead</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">payload: UserCreate, session: AsyncSession = Depends(<span class="hljs-params">get_session</span>)</span>):
    user = User(**payload.<span class="hljs-built_in">dict</span>())
    session.add(user)
    <span class="hljs-keyword">await</span> session.flush()          <span class="hljs-comment"># è·å– id</span>
    <span class="hljs-keyword">await</span> session.commit()
    <span class="hljs-keyword">await</span> session.refresh(user)
    <span class="hljs-keyword">return</span> user

<span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">"/{uid}"</span>, response_model=UserRead</span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_user</span>(<span class="hljs-params">uid: <span class="hljs-built_in">int</span>, session: AsyncSession = Depends(<span class="hljs-params">get_session</span>)</span>):
    user = <span class="hljs-keyword">await</span> session.get(User, uid)
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:
        <span class="hljs-keyword">raise</span> HTTPException(<span class="hljs-number">404</span>, <span class="hljs-string">"User not found"</span>)
    <span class="hljs-keyword">return</span> user
</code></pre>
<hr/>
<h2 data-id="heading-5">6. è¿ç§»ï¼šAlembic åŒæ ·èƒ½å¼‚æ­¥</h2>
<p><strong>åˆå§‹åŒ–</strong></p>
<pre><code class="hljs language-bash" lang="bash">alembic init -t async migrations
</code></pre>
<p><strong>ä¿®æ”¹ <code>alembic.ini</code> ä¸­çš„ <code>sqlalchemy.url</code> ä¸º <code>postgresql+asyncpg://...</code></strong></p>
<p><strong>migrations/env.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> app.core.config <span class="hljs-keyword">import</span> settings
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> Base
target_metadata = Base.metadata

<span class="hljs-keyword">def</span> <span class="hljs-title function_">do_run_migrations</span>(<span class="hljs-params">connection</span>):
    context.configure(connection=connection, target_metadata=target_metadata)
    <span class="hljs-keyword">with</span> context.begin_transaction():
        context.run_migrations()

<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_async_migrations</span>():
    <span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncEngine
    connectable = AsyncEngine(create_async_engine(settings.database_url))
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> connectable.connect() <span class="hljs-keyword">as</span> connection:
        <span class="hljs-keyword">await</span> connection.run_sync(do_run_migrations)
    <span class="hljs-keyword">await</span> connectable.dispose()
</code></pre>
<p><strong>ç”Ÿæˆ / å‡çº§</strong></p>
<pre><code class="hljs language-bash" lang="bash">alembic revision --autogenerate -m <span class="hljs-string">"init"</span>
alembic upgrade <span class="hljs-built_in">head</span>
</code></pre>
<hr/>
<h2 data-id="heading-6">7. æµ‹è¯•ï¼špytest-asyncio + å¼‚æ­¥æ•°æ®åº“äº‹åŠ¡</h2>
<p><strong>tests/conftest.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> httpx <span class="hljs-keyword">import</span> AsyncClient
<span class="hljs-keyword">from</span> app.main <span class="hljs-keyword">import</span> app
<span class="hljs-keyword">from</span> app.core.db <span class="hljs-keyword">import</span> db <span class="hljs-keyword">as</span> db_instance
<span class="hljs-keyword">from</span> sqlalchemy.pool <span class="hljs-keyword">import</span> StaticPool
<span class="hljs-keyword">from</span> sqlalchemy.ext.asyncio <span class="hljs-keyword">import</span> AsyncEngine, create_async_engine

<span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">"session"</span></span>)</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">engine</span>() -&gt; AsyncEngine:
    <span class="hljs-comment"># å†…å­˜ SQLite ä¹Ÿå¯ä»¥å¼‚æ­¥ï¼Œä½† PostgreSQL æ›´çœŸå®</span>
    engine = create_async_engine(
        <span class="hljs-string">"postgresql+asyncpg://test:test@localhost:5432/test"</span>,
        poolclass=StaticPool,
    )
    <span class="hljs-keyword">yield</span> engine
    <span class="hljs-keyword">await</span> engine.dispose()

<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">session</span>(<span class="hljs-params">engine: AsyncEngine</span>):
    conn = <span class="hljs-keyword">await</span> engine.begin()
    sess = db_instance.session_factory(bind=conn)
    <span class="hljs-keyword">yield</span> sess
    <span class="hljs-keyword">await</span> sess.close()
    <span class="hljs-keyword">await</span> conn.rollback()
    <span class="hljs-keyword">await</span> conn.close()

<span class="hljs-meta">@pytest.fixture</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">client</span>() -&gt; AsyncGenerator[AsyncClient, <span class="hljs-literal">None</span>]:
    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> AsyncClient(app=app, base_url=<span class="hljs-string">"http://test"</span>) <span class="hljs-keyword">as</span> c:
        <span class="hljs-keyword">yield</span> c
</code></pre>
<p><strong>tests/test_user.py</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">import</span> pytest
<span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> select
<span class="hljs-keyword">from</span> app.models <span class="hljs-keyword">import</span> User

<span class="hljs-meta">@pytest.mark.asyncio</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_create_user</span>(<span class="hljs-params">client, session</span>):
    res = <span class="hljs-keyword">await</span> client.post(<span class="hljs-string">"/users"</span>, json={<span class="hljs-string">"email"</span>: <span class="hljs-string">"a@b.com"</span>, <span class="hljs-string">"full_name"</span>: <span class="hljs-string">"abc"</span>})
    <span class="hljs-keyword">assert</span> res.status_code == <span class="hljs-number">201</span>
    data = res.json()
    <span class="hljs-keyword">assert</span> data[<span class="hljs-string">"email"</span>] == <span class="hljs-string">"a@b.com"</span>

    user = <span class="hljs-keyword">await</span> session.get(User, data[<span class="hljs-string">"id"</span>])
    <span class="hljs-keyword">assert</span> user <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>
</code></pre>
<hr/>
<h2 data-id="heading-7">8. æ€§èƒ½è°ƒä¼˜ checklist</h2>



































<table><thead><tr><th>å‚æ•°</th><th>å»ºè®®å€¼</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>pool_size</code></td><td>CPU æ ¸å¿ƒ Ã— 2</td><td>20 å¹¶å‘å·²èƒ½å‹åˆ° 10k RPS</td></tr><tr><td><code>max_overflow</code></td><td>0</td><td>é˜²æ­¢çªå‘è¿æ¥æ‰“çˆ† DB</td></tr><tr><td><code>pool_pre_ping=True</code></td><td>å¿…é¡»</td><td>ç½‘ç»œé—ªæ–­åè‡ªåŠ¨é‡è¿</td></tr><tr><td><code>expire_on_commit=False</code></td><td>å¿…é¡»</td><td>å¦åˆ™ commit åå±æ€§å¤±æ•ˆ</td></tr><tr><td><code>echo=False</code></td><td>ç”Ÿäº§å…³é—­</td><td>å‡å°‘åºåˆ—åŒ–å¼€é”€</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-8">9. å¸¸è§é”™è¯¯é€ŸæŸ¥è¡¨</h2>






























<table><thead><tr><th>å¼‚å¸¸</th><th>åŸå› </th><th>è§£æ³•</th></tr></thead><tbody><tr><td><code>greenlet_spawn has not been called</code></td><td>ç”¨äº†åŒæ­¥å¼•æ“</td><td><code>create_async_engine</code></td></tr><tr><td><code>DetachedInstanceError</code></td><td>ä¼šè¯å…³é—­åè®¿é—®å±æ€§</td><td><code>expire_on_commit=False</code> + <code>await session.refresh()</code></td></tr><tr><td><code>InterfaceError: connection already closed</code></td><td>åç¨‹é—´å¤ç”¨ Session</td><td>ä¸€ä¸ªè¯·æ±‚ä¸€ä¸ª Sessionï¼Œç¦æ­¢å…¨å±€å•ä¾‹</td></tr><tr><td><code>ImportError: asyncmy</code></td><td>MySQL é©±åŠ¨æœªè£…</td><td><code>pip install asyncmy</code></td></tr></tbody></table>
<hr/>
<h2 data-id="heading-9">10. ç»“è¯­</h2>
<p>FastAPI çš„å¼‚æ­¥ç”Ÿæ€é‡Œï¼Œ<strong>æ•°æ®åº“æ˜¯æœ€åä¸€é“é—¸é—¨</strong>ã€‚<br/>
ç”¨ä¸Š SQLAlchemy 2.0 AsyncIO ä¹‹åï¼Œ<strong>I/O ç­‰å¾…ä¸å†æ˜¯ç“¶é¢ˆ</strong>ï¼Œå‹æµ‹æ›²çº¿ç›´æ¥å¤šä¸€ä¸ªé‡çº§ã€‚<br/>
æŠŠæœ¬æ–‡çš„ <code>db.py</code> + <code>deps.py</code> å¤åˆ¶èµ°ï¼Œ<strong>10 åˆ†é’Ÿå°±èƒ½è®©è€é¡¹ç›®åŸåœ°èµ·é£</strong>ã€‚Happy async coding!</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾16ï¼šæˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼â€”â€”å†…å­˜ç®¡ç†çš„ç²¾ç¡®åŒ¹é…åŸåˆ™]]></title>    <link>https://juejin.cn/post/7570909641682780200</link>    <guid>https://juejin.cn/post/7570909641682780200</guid>    <pubDate>2025-11-10T13:14:55.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570909641682780200" data-draft-id="7570940025580568616" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾16ï¼šæˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼â€”â€”å†…å­˜ç®¡ç†çš„ç²¾ç¡®åŒ¹é…åŸåˆ™"/> <meta itemprop="keywords" content="C++,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T13:14:55.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²æ€¡æ—¸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€ç©¿è¶ŠEffective C++ã€‘æ¡æ¬¾16ï¼šæˆå¯¹ä½¿ç”¨newå’Œdeleteæ—¶è¦é‡‡ç”¨ç›¸åŒå½¢å¼â€”â€”å†…å­˜ç®¡ç†çš„ç²¾ç¡®åŒ¹é…åŸåˆ™
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²æ€¡æ—¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:14:55.000Z" title="Mon Nov 10 2025 13:14:55 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è¿™ä¸ªæ¡æ¬¾æ­ç¤ºäº†C++åŠ¨æ€å†…å­˜ç®¡ç†ä¸­æœ€åŸºæœ¬ä½†å¸¸è¢«å¿½è§†çš„è§„åˆ™ï¼šnew/deleteå½¢å¼å¿…é¡»ä¸¥æ ¼åŒ¹é…ã€‚ç†è§£è¿™ä¸€åŸåˆ™æ˜¯é¿å…å†…å­˜æ³„æ¼å’Œæœªå®šä¹‰è¡Œä¸ºçš„å…³é”®ã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>æ€ç»´å¯¼å›¾ï¼šnew/deleteé…å¯¹ä½¿ç”¨çš„å®Œæ•´ä½“ç³»</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/294e89093b45496b8b2215e315e05f97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385295&amp;x-signature=p68QUDVmtXnFF9vTKtJN7M3os1U%3D" alt="16æˆå¯¹ä½¿ç”¨newå’Œdeleteçš„ç›¸åŒå½¢å¼.png" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-1"><strong>å…³é”®æ´è§ä¸è¡ŒåŠ¨æŒ‡å—</strong></h3>
<h4 data-id="heading-2"><strong>å¿…é¡»éµå®ˆçš„æ ¸å¿ƒåŸåˆ™ï¼š</strong></h4>
<ol>
<li><strong>ä¸¥æ ¼å½¢å¼åŒ¹é…</strong>ï¼š<code>new</code>é…<code>delete</code>ï¼Œ<code>new[]</code>é…<code>delete[]</code></li>
<li><strong>é¿å…å¤šæ€æ•°ç»„</strong>ï¼šä¸è¦é€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»æ•°ç»„</li>
<li><strong>ä½¿ç”¨æ ‡å‡†åº“</strong>ï¼šä¼˜å…ˆä½¿ç”¨å®¹å™¨å’Œæ™ºèƒ½æŒ‡é’ˆæ›¿ä»£æ‰‹åŠ¨å†…å­˜ç®¡ç†</li>
<li><strong>æ˜ç¡®ç±»å‹ä¿¡æ¯</strong>ï¼šä½¿ç”¨æ¸…æ™°çš„ç±»å‹åˆ«åï¼Œé¿å…æ··æ·†</li>
</ol>
<h4 data-id="heading-3"><strong>ç°ä»£C++å¼€å‘å»ºè®®ï¼š</strong></h4>
<ol>
<li><strong>ç¦æ­¢è£¸new/delete</strong>ï¼šåœ¨ä»£ç è§„èŒƒä¸­æ˜ç¡®ç¦æ­¢æ‰‹åŠ¨å†…å­˜ç®¡ç†</li>
<li><strong>ä½¿ç”¨make_unique/make_shared</strong>ï¼šå·¥å‚å‡½æ•°è‡ªåŠ¨é€‰æ‹©æ­£ç¡®çš„åˆ†é…å½¢å¼</li>
<li><strong>å®¹å™¨ä¼˜å…ˆåŸåˆ™</strong>ï¼šä½¿ç”¨<code>std::vector</code>ã€<code>std::array</code>æ›¿ä»£åŠ¨æ€æ•°ç»„</li>
<li><strong>é™æ€åˆ†æé›†æˆ</strong>ï¼šåœ¨CI/CDæµæ°´çº¿ä¸­é›†æˆå†…å­˜æ£€æµ‹å·¥å…·</li>
</ol>
<h4 data-id="heading-4"><strong>è®¾è®¡åŸåˆ™æ€»ç»“ï¼š</strong></h4>
<ol>
<li><strong>RAIIåŸåˆ™</strong>ï¼šèµ„æºè·å–å³åˆå§‹åŒ–ï¼Œåˆ©ç”¨ææ„å‡½æ•°è‡ªåŠ¨é‡Šæ”¾</li>
<li><strong>é›¶è§„åˆ™</strong>ï¼šè®©ç¼–è¯‘å™¨ç”Ÿæˆæ­£ç¡®çš„æ‹·è´æ§åˆ¶æˆå‘˜</li>
<li><strong>æ˜ç¡®æ‰€æœ‰æƒ</strong>ï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆæ˜ç¡®è¡¨è¾¾èµ„æºæ‰€æœ‰æƒè¯­ä¹‰</li>
<li><strong>é˜²å¾¡æ€§ç¼–ç¨‹</strong>ï¼šå‡è®¾æ‰€æœ‰æ‰‹åŠ¨å†…å­˜ç®¡ç†éƒ½å¯èƒ½å‡ºé”™</li>
</ol>
<h4 data-id="heading-5"><strong>éœ€è¦è­¦æƒ•çš„é™·é˜±ï¼š</strong></h4>
<ol>
<li><strong>typedeféšè—çš„æ•°ç»„</strong>ï¼šç±»å‹åˆ«åå¯èƒ½éšè—æ•°ç»„æœ¬è´¨</li>
<li><strong>å¤šæ€æ•°ç»„åˆ é™¤</strong>ï¼šé€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»æ•°ç»„</li>
<li><strong>è·¨æ¨¡å—è¾¹ç•Œ</strong>ï¼šåœ¨ä¸åŒDLLä¸­åˆ†é…å’Œé‡Šæ”¾å†…å­˜</li>
<li><strong>å¼‚å¸¸å®‰å…¨</strong>ï¼šåœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾</li>
</ol>
<p><strong>æœ€ç»ˆå»ºè®®ï¼š</strong> å°†new/deleteé…å¯¹è§„åˆ™è§†ä¸ºC++å†…å­˜ç®¡ç†çš„"ç‰©ç†å®šå¾‹"ã€‚åŸ¹å…»"è‡ªåŠ¨ç®¡ç†æ€ç»´"â€”â€”åœ¨éœ€è¦åŠ¨æ€å†…å­˜æ—¶é¦–å…ˆé—®è‡ªå·±ï¼š"èƒ½å¦ç”¨æ ‡å‡†åº“å®¹å™¨æˆ–æ™ºèƒ½æŒ‡é’ˆæ›¿ä»£æ‰‹åŠ¨ç®¡ç†ï¼Ÿ" è¿™ç§é¢„é˜²æ€§çš„æ€è€ƒæ–¹å¼æ˜¯æ„å»ºå¥å£®C++ç³»ç»Ÿçš„å…³é”®ã€‚</p>
<p>è®°ä½ï¼š<strong>åœ¨C++å†…å­˜ç®¡ç†ä¸­ï¼Œæ­£ç¡®çš„é…å¯¹ä¸æ˜¯æœ€ä½³å®è·µï¼Œè€Œæ˜¯é¿å…ç¾éš¾çš„åŸºæœ¬è¦æ±‚ã€‚</strong> æ¡æ¬¾16æ•™ä¼šæˆ‘ä»¬çš„ä¸ä»…æ˜¯ä¸€ä¸ªè¯­æ³•è§„åˆ™ï¼Œæ›´æ˜¯å¯¹C++å†…å­˜æ¨¡å‹æ·±åˆ»ç†è§£çš„ä½“ç°ã€‚</p>
<hr/>
<h3 data-id="heading-6"><strong>æ·±å…¥è§£æï¼šå†…å­˜å¸ƒå±€çš„æ ¸å¿ƒå·®å¼‚</strong></h3>
<h4 data-id="heading-7"><strong>1. é—®é¢˜æ ¹æºï¼šå†…å­˜åˆ†é…çš„å†…éƒ¨æœºåˆ¶</strong></h4>
<p><strong>å•ä¸ªå¯¹è±¡ vs å¯¹è±¡æ•°ç»„çš„å†…å­˜å¸ƒå±€ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Widget</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Widget</span>() { std::cout &lt;&lt; <span class="hljs-string">"Widgetæ„é€  "</span> &lt;&lt; <span class="hljs-keyword">this</span> &lt;&lt; std::endl; }
    ~<span class="hljs-built_in">Widget</span>() { std::cout &lt;&lt; <span class="hljs-string">"Widgetææ„ "</span> &lt;&lt; <span class="hljs-keyword">this</span> &lt;&lt; std::endl; }
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">int</span> data[<span class="hljs-number">10</span>];
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_memory_layout</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å•ä¸ªå¯¹è±¡çš„å†…å­˜åˆ†é…</span>
    Widget* singleObj = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Widget</span>();
    <span class="hljs-comment">// å†…å­˜å¸ƒå±€: [Widgetå¯¹è±¡æ•°æ®]</span>
    
    <span class="hljs-comment">// å¯¹è±¡æ•°ç»„çš„å†…å­˜åˆ†é…  </span>
    Widget* arrayObj = <span class="hljs-keyword">new</span> Widget[<span class="hljs-number">3</span>];
    <span class="hljs-comment">// å†…å­˜å¸ƒå±€: [æ•°ç»„å¤§å°][Widget][Widget][Widget]</span>
    <span class="hljs-comment">// å¤§å¤šæ•°ç¼–è¯‘å™¨ä¼šåœ¨æ•°ç»„å‰é¢å­˜å‚¨å…ƒç´ æ•°é‡</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"å•ä¸ªå¯¹è±¡åœ°å€: "</span> &lt;&lt; singleObj &lt;&lt; std::endl;
    std::cout &lt;&lt; <span class="hljs-string">"æ•°ç»„å¯¹è±¡åœ°å€: "</span> &lt;&lt; arrayObj &lt;&lt; std::endl;
    
    <span class="hljs-comment">// æ­£ç¡®çš„é‡Šæ”¾</span>
    <span class="hljs-keyword">delete</span> singleObj;      <span class="hljs-comment">// é‡Šæ”¾å•ä¸ªå¯¹è±¡</span>
    <span class="hljs-keyword">delete</span>[] arrayObj;     <span class="hljs-comment">// é‡Šæ”¾å¯¹è±¡æ•°ç»„</span>
}
</code></pre>
<p><strong>å±é™©çš„é”™è¯¯é…å¯¹ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_dangerous_mismatch</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// åœºæ™¯1ï¼šnew[] é… delete</span>
    std::cout &lt;&lt; <span class="hljs-string">"=== é”™è¯¯1: new[] é… delete ==="</span> &lt;&lt; std::endl;
    Widget* widgets = <span class="hljs-keyword">new</span> Widget[<span class="hljs-number">3</span>];
    
    <span class="hljs-comment">// delete widgets;  // ç¾éš¾ï¼</span>
    <span class="hljs-comment">// å®é™…å‘ç”Ÿï¼š</span>
    <span class="hljs-comment">// 1. åªè°ƒç”¨ç¬¬ä¸€ä¸ªå…ƒç´ çš„ææ„å‡½æ•°</span>
    <span class="hljs-comment">// 2. è¯•å›¾é‡Šæ”¾é”™è¯¯çš„å†…å­˜åœ°å€ï¼ˆæ•°ç»„å¼€å§‹ä½ç½® - æ•°ç»„å¤§å°å­˜å‚¨åç§»ï¼‰</span>
    <span class="hljs-comment">// 3. å †æ•°æ®ç»“æ„ç ´å</span>
    
    <span class="hljs-comment">// åœºæ™¯2ï¼šnew é… delete[]</span>
    std::cout &lt;&lt; <span class="hljs-string">"\n=== é”™è¯¯2: new é… delete[] ==="</span> &lt;&lt; std::endl;
    Widget* single = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Widget</span>();
    
    <span class="hljs-comment">// delete[] single;  // åŒæ ·ç¾éš¾ï¼</span>
    <span class="hljs-comment">// å®é™…å‘ç”Ÿï¼š</span>
    <span class="hljs-comment">// 1. è¯•å›¾è¯»å–æ•°ç»„å¤§å°ï¼ˆåœ¨å¯¹è±¡å‰é¢ï¼‰</span>
    <span class="hljs-comment">// 2. è°ƒç”¨å¤šä¸ªä¸å­˜åœ¨çš„å¯¹è±¡çš„ææ„å‡½æ•°</span>
    <span class="hljs-comment">// 3. é‡Šæ”¾é”™è¯¯å¤§å°çš„å†…å­˜å—</span>
    
    <span class="hljs-comment">// æ­£ç¡®é‡Šæ”¾</span>
    <span class="hljs-keyword">delete</span>[] widgets;
    <span class="hljs-keyword">delete</span> single;
}
</code></pre>
<h4 data-id="heading-8"><strong>2. ç¼–è¯‘å™¨å®ç°çš„å·®å¼‚</strong></h4>
<p><strong>ä¸åŒç¼–è¯‘å™¨çš„æ•°ç»„å¤§å°å­˜å‚¨ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_compiler_differences</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Simple</span> {
    <span class="hljs-keyword">public</span>:
        ~<span class="hljs-built_in">Simple</span>() {}  <span class="hljs-comment">// æœ‰ææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨å¿…é¡»è®°å½•æ•°ç»„å¤§å°</span>
    };
    
    Simple* array1 = <span class="hljs-keyword">new</span> Simple[<span class="hljs-number">5</span>];
    
    <span class="hljs-comment">// åœ¨å¤§å¤šæ•°ç¼–è¯‘å™¨ä¸­ï¼Œå†…å­˜å¸ƒå±€ç±»ä¼¼ï¼š</span>
    <span class="hljs-comment">// [size_t n=5][Simple][Simple][Simple][Simple][Simple]</span>
    <span class="hljs-comment">// æ•°ç»„å¼€å§‹çš„å®é™…åœ°å€æ˜¯ &amp;array1 - sizeof(size_t)</span>
    
    <span class="hljs-keyword">delete</span>[] array1;  <span class="hljs-comment">// ç¼–è¯‘å™¨çŸ¥é“è¦è°ƒç”¨5æ¬¡ææ„å‡½æ•°</span>
    
    <span class="hljs-comment">// å¯¹äºæ²¡æœ‰ææ„å‡½æ•°çš„ç±»å‹ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼˜åŒ–</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">NoDestructor</span> {
    <span class="hljs-keyword">public</span>:
        <span class="hljs-comment">// æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„ææ„å‡½æ•°</span>
    };
    
    NoDestructor* array2 = <span class="hljs-keyword">new</span> NoDestructor[<span class="hljs-number">5</span>];
    <span class="hljs-comment">// ç¼–è¯‘å™¨å¯èƒ½ä¸å­˜å‚¨æ•°ç»„å¤§å°ï¼Œå› ä¸ºä¸éœ€è¦è°ƒç”¨ææ„å‡½æ•°</span>
    
    <span class="hljs-keyword">delete</span>[] array2;  <span class="hljs-comment">// å¯èƒ½åªæ˜¯é‡Šæ”¾å†…å­˜ï¼Œä¸è°ƒç”¨ææ„å‡½æ•°</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-9"><strong>è§£å†³æ–¹æ¡ˆï¼šä¸¥æ ¼çš„é…å¯¹è§„åˆ™</strong></h3>
<h4 data-id="heading-10"><strong>1. åŸºæœ¬é…å¯¹è§„åˆ™</strong></h4>
<p><strong>æ­£ç¡®çš„new/deleteé…å¯¹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Investment</span> {
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Investment</span>() { std::cout &lt;&lt; <span class="hljs-string">"Investmentæ„é€ "</span> &lt;&lt; std::endl; }
    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Investment</span>() { std::cout &lt;&lt; <span class="hljs-string">"Investmentææ„"</span> &lt;&lt; std::endl; }
    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Stock</span> : <span class="hljs-keyword">public</span> Investment {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{ 
        std::cout &lt;&lt; <span class="hljs-string">"è®¡ç®—è‚¡ç¥¨æ”¶ç›Š"</span> &lt;&lt; std::endl; 
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_correct_pairing</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== å•ä¸ªå¯¹è±¡ ==="</span> &lt;&lt; std::endl;
    Investment* single = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Stock</span>();
    single-&gt;<span class="hljs-built_in">calculate</span>();
    <span class="hljs-keyword">delete</span> single;  <span class="hljs-comment">// æ­£ç¡®ï¼šnew é… delete</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== å¯¹è±¡æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    Investment* array = <span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>];
    <span class="hljs-comment">// æ³¨æ„ï¼šè¿™é‡Œæœ‰å¤šæ€æ•°ç»„çš„é—®é¢˜ï¼Œåé¢ä¼šè®¨è®º</span>
    <span class="hljs-keyword">delete</span>[] array;  <span class="hljs-comment">// æ­£ç¡®ï¼šnew[] é… delete[]</span>
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== å†…ç½®ç±»å‹æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    <span class="hljs-type">int</span>* intArray = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];
    <span class="hljs-keyword">delete</span>[] intArray;  <span class="hljs-comment">// æ­£ç¡®ï¼šå³ä½¿æ²¡æœ‰ææ„å‡½æ•°ä¹Ÿè¦åŒ¹é…</span>
    
    <span class="hljs-type">double</span>* singleDouble = <span class="hljs-keyword">new</span> <span class="hljs-type">double</span>;
    <span class="hljs-keyword">delete</span> singleDouble;  <span class="hljs-comment">// æ­£ç¡®ï¼šnew é… delete</span>
}
</code></pre>
<h4 data-id="heading-11"><strong>2. typedefå¸¦æ¥çš„é™·é˜±</strong></h4>
<p><strong>typedeféšè—çš„æ•°ç»„æœ¬è´¨ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å±é™©çš„typedefå®šä¹‰</span>
<span class="hljs-keyword">typedef</span> Investment* InvestmentPtr;
<span class="hljs-keyword">typedef</span> Investment* InvestmentArray[<span class="hljs-number">10</span>];  <span class="hljs-comment">// å¤§å°ä¸º10çš„InvestmentæŒ‡é’ˆæ•°ç»„</span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_typedef_danger</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æƒ…å†µ1ï¼šçœ‹èµ·æ¥åƒå•ä¸ªå¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯æ•°ç»„</span>
    InvestmentArray investments;  <span class="hljs-comment">// Investment* investments[10]</span>
    
    <span class="hljs-comment">// é”™è¯¯çš„åˆ†é…æ–¹å¼</span>
    InvestmentPtr* badAlloc = <span class="hljs-keyword">new</span> InvestmentArray;  <span class="hljs-comment">// å®é™…ä¸Šæ˜¯ new Investment*[10]</span>
    <span class="hljs-comment">// çœ‹èµ·æ¥åƒå•ä¸ªå¯¹è±¡ï¼Œä½†å®é™…ä¸Šæ˜¯æ•°ç»„ï¼</span>
    
    <span class="hljs-comment">// delete badAlloc;  // é”™è¯¯ï¼šåº”è¯¥ç”¨ delete[]</span>
    <span class="hljs-keyword">delete</span>[] badAlloc;   <span class="hljs-comment">// æ­£ç¡®</span>
    
    <span class="hljs-comment">// æƒ…å†µ2ï¼šæ›´æ¸…æ™°çš„ç°ä»£æ›¿ä»£</span>
    <span class="hljs-keyword">using</span> InvestmentPtr = Investment*;
    <span class="hljs-keyword">using</span> InvestmentArray = std::array&lt;Investment*, <span class="hljs-number">10</span>&gt;;
    
    InvestmentArray safeInvestments;  <span class="hljs-comment">// æ˜ç¡®çš„å®¹å™¨ç±»å‹</span>
    <span class="hljs-comment">// ä¸éœ€è¦æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼</span>
}
</code></pre>
<p><strong>ç°ä»£C++çš„è§£å†³æ–¹æ¡ˆï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ä½¿ç”¨usingæ›¿ä»£typedefï¼Œæ›´æ¸…æ™°</span>
<span class="hljs-keyword">using</span> SingleInvestment = Investment;
<span class="hljs-keyword">using</span> InvestmentArray = Investment[<span class="hljs-number">10</span>];

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_modern_solution</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// C++11 usingè¯­æ³•æ›´æ¸…æ™°</span>
    <span class="hljs-keyword">auto</span> single = <span class="hljs-keyword">new</span> SingleInvestment;  <span class="hljs-comment">// æ˜ç¡®æ˜¯å•ä¸ªå¯¹è±¡</span>
    <span class="hljs-keyword">delete</span> single;
    
    <span class="hljs-comment">// ä½†æ›´å¥½çš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨æ ‡å‡†åº“å®¹å™¨</span>
    std::vector&lt;std::unique_ptr&lt;Investment&gt;&gt; investments;
    investments.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;());
    <span class="hljs-comment">// è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ— éœ€æ‹…å¿ƒnew/deleteé…å¯¹</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-12"><strong>ç°ä»£C++çš„æ”¹è¿›æ–¹æ¡ˆ</strong></h3>
<h4 data-id="heading-13"><strong>1. æ™ºèƒ½æŒ‡é’ˆè‡ªåŠ¨ç®¡ç†</strong></h4>
<p><strong>unique_ptrçš„æ•°ç»„ç‰¹åŒ–ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_smart_pointers</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== unique_ptr å•å¯¹è±¡ ==="</span> &lt;&lt; std::endl;
    {
        std::unique_ptr&lt;Investment&gt; investment = std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;();
        investment-&gt;<span class="hljs-built_in">calculate</span>();
        <span class="hljs-comment">// è‡ªåŠ¨è°ƒç”¨deleteï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== unique_ptr å¯¹è±¡æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    {
        <span class="hljs-comment">// unique_ptrçš„æ•°ç»„ç‰¹åŒ–ç‰ˆæœ¬</span>
        <span class="hljs-function">std::unique_ptr&lt;Investment[]&gt; <span class="hljs-title">array</span><span class="hljs-params">(<span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>])</span></span>;
        <span class="hljs-comment">// ä¼šè‡ªåŠ¨è°ƒç”¨delete[]</span>
        
        <span class="hljs-comment">// C++20æ”¯æŒmake_uniqueå¯¹äºæ•°ç»„ï¼ˆæœ‰é™åˆ¶ï¼‰</span>
        <span class="hljs-comment">// auto array = std::make_unique&lt;Investment[]&gt;(3);</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== shared_ptr éœ€è¦è‡ªå®šä¹‰åˆ é™¤å™¨ ==="</span> &lt;&lt; std::endl;
    {
        <span class="hljs-comment">// shared_ptré»˜è®¤ä½¿ç”¨deleteï¼Œä¸æ˜¯delete[]</span>
        std::shared_ptr&lt;Investment&gt; single = std::<span class="hljs-built_in">make_shared</span>&lt;Stock&gt;();
        
        <span class="hljs-comment">// å¯¹äºæ•°ç»„ï¼Œéœ€è¦æä¾›è‡ªå®šä¹‰åˆ é™¤å™¨</span>
        <span class="hljs-function">std::shared_ptr&lt;Investment&gt; <span class="hljs-title">array</span><span class="hljs-params">(
            <span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>],
            [](Investment* p) { <span class="hljs-keyword">delete</span>[] p; }
        )</span></span>;
    }
}
</code></pre>
<h4 data-id="heading-14"><strong>2. æ ‡å‡†åº“å®¹å™¨ä¼˜å…ˆ</strong></h4>
<p><strong>å®Œå…¨é¿å…æ‰‹åŠ¨å†…å­˜ç®¡ç†ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;array&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_standard_containers</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== std::vector æ›¿ä»£åŠ¨æ€æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    {
        <span class="hljs-function">std::vector&lt;Stock&gt; <span class="hljs-title">stocks</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>;  <span class="hljs-comment">// åˆ›å»º3ä¸ªStockå¯¹è±¡</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; stock : stocks) {
            stock.<span class="hljs-built_in">calculate</span>();
        }
        <span class="hljs-comment">// è‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ­£ç¡®è°ƒç”¨æ‰€æœ‰ææ„å‡½æ•°</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== std::array æ›¿ä»£å›ºå®šå¤§å°æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    {
        std::array&lt;Stock, 5&gt; fixedStocks;  <span class="hljs-comment">// å›ºå®šå¤§å°æ•°ç»„</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; stock : fixedStocks) {
            stock.<span class="hljs-built_in">calculate</span>();
        }
        <span class="hljs-comment">// æ ˆä¸Šåˆ†é…ï¼Œè‡ªåŠ¨ææ„</span>
    }
    
    std::cout &lt;&lt; <span class="hljs-string">"\n=== å¤šæ€å¯¹è±¡ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå®¹å™¨ ==="</span> &lt;&lt; std::endl;
    {
        std::vector&lt;std::unique_ptr&lt;Investment&gt;&gt; portfolio;
        portfolio.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;());
        <span class="hljs-comment">// portfolio.push_back(std::make_unique&lt;Bond&gt;());</span>
        
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; investment : portfolio) {
            investment-&gt;<span class="hljs-built_in">calculate</span>();
        }
        <span class="hljs-comment">// è‡ªåŠ¨æ­£ç¡®é‡Šæ”¾æ‰€æœ‰å¯¹è±¡</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-15"><strong>ç‰¹æ®Šåœºæ™¯ä¸é™·é˜±è§„é¿</strong></h3>
<h4 data-id="heading-16"><strong>1. å¤šæ€å¯¹è±¡æ•°ç»„çš„é—®é¢˜</strong></h4>
<p><strong>å¤šæ€æ•°ç»„çš„å±é™©æ€§ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bond</span> : <span class="hljs-keyword">public</span> Investment {
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">calculate</span><span class="hljs-params">()</span> <span class="hljs-keyword">override</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"è®¡ç®—å€ºåˆ¸æ”¶ç›Š"</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_polymorphic_array_danger</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// å±é™©ï¼šå¤šæ€æ•°ç»„</span>
    Investment* investments = <span class="hljs-keyword">new</span> Stock[<span class="hljs-number">3</span>];
    
    <span class="hljs-comment">// delete[] investments;  // æœªå®šä¹‰è¡Œä¸ºï¼</span>
    <span class="hljs-comment">// é—®é¢˜ï¼š</span>
    <span class="hljs-comment">// 1. é€šè¿‡åŸºç±»æŒ‡é’ˆåˆ é™¤æ´¾ç”Ÿç±»æ•°ç»„</span>
    <span class="hljs-comment">// 2. æ´¾ç”Ÿç±»å¯¹è±¡å¤§å°å¯èƒ½ä¸åŸºç±»ä¸åŒ</span>
    <span class="hljs-comment">// 3. ææ„å‡½æ•°è°ƒç”¨ä¸æ­£ç¡®</span>
    
    <span class="hljs-comment">// æ­£ç¡®åšæ³•ï¼šä½¿ç”¨æŒ‡é’ˆæ•°ç»„</span>
    Investment** safeInvestments = <span class="hljs-keyword">new</span> Investment*[<span class="hljs-number">3</span>];
    safeInvestments[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Stock</span>();
    safeInvestments[<span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Bond</span>();
    safeInvestments[<span class="hljs-number">2</span>] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Stock</span>();
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i) {
        <span class="hljs-keyword">delete</span> safeInvestments[i];  <span class="hljs-comment">// æ­£ç¡®è°ƒç”¨è™šææ„å‡½æ•°</span>
    }
    <span class="hljs-keyword">delete</span>[] safeInvestments;  <span class="hljs-comment">// é‡Šæ”¾æŒ‡é’ˆæ•°ç»„</span>
    
    <span class="hljs-comment">// æ›´å¥½çš„åšæ³•ï¼šä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆå®¹å™¨</span>
    std::vector&lt;std::unique_ptr&lt;Investment&gt;&gt; bestInvestments;
    bestInvestments.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Stock&gt;());
    bestInvestments.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Bond&gt;());
}
</code></pre>
<h4 data-id="heading-17"><strong>2. å­—ç¬¦ä¸²å†…å­˜ç®¡ç†</strong></h4>
<p><strong>Cé£æ ¼å­—ç¬¦ä¸²çš„æ­£ç¡®ç®¡ç†ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_string_management</span><span class="hljs-params">()</span> </span>{
    std::cout &lt;&lt; <span class="hljs-string">"=== Cé£æ ¼å­—ç¬¦ä¸²æ•°ç»„ ==="</span> &lt;&lt; std::endl;
    
    <span class="hljs-comment">// å­—ç¬¦æ•°ç»„</span>
    <span class="hljs-type">char</span>* str = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[<span class="hljs-number">100</span>];
    std::<span class="hljs-built_in">strcpy</span>(str, <span class="hljs-string">"Hello World"</span>);
    std::cout &lt;&lt; <span class="hljs-string">"Cå­—ç¬¦ä¸²: "</span> &lt;&lt; str &lt;&lt; std::endl;
    <span class="hljs-keyword">delete</span>[] str;  <span class="hljs-comment">// å¿…é¡»ä½¿ç”¨delete[]</span>
    
    <span class="hljs-comment">// å­—ç¬¦ä¸²æŒ‡é’ˆæ•°ç»„</span>
    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* <span class="hljs-type">const</span>* strings = <span class="hljs-keyword">new</span> <span class="hljs-type">const</span> <span class="hljs-type">char</span>*[<span class="hljs-number">3</span>] {
        <span class="hljs-string">"Hello"</span>, <span class="hljs-string">"World"</span>, <span class="hljs-string">"!"</span>
    };
    
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i) {
        std::cout &lt;&lt; strings[i] &lt;&lt; <span class="hljs-string">" "</span>;
    }
    std::cout &lt;&lt; std::endl;
    
    <span class="hljs-keyword">delete</span>[] strings;  <span class="hljs-comment">// é‡Šæ”¾æŒ‡é’ˆæ•°ç»„</span>
    
    <span class="hljs-comment">// ç°ä»£C++ï¼šä½¿ç”¨std::stringå’Œstd::vector</span>
    std::vector&lt;std::string&gt; modernStrings = {<span class="hljs-string">"Hello"</span>, <span class="hljs-string">"World"</span>, <span class="hljs-string">"!"</span>};
    <span class="hljs-keyword">for</span> (<span class="hljs-type">const</span> <span class="hljs-keyword">auto</span>&amp; s : modernStrings) {
        std::cout &lt;&lt; s &lt;&lt; <span class="hljs-string">" "</span>;
    }
    std::cout &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-18"><strong>å®æˆ˜æ¡ˆä¾‹ï¼šå¤æ‚ç³»ç»Ÿçš„å†…å­˜ç®¡ç†</strong></h3>
<h4 data-id="heading-19"><strong>æ¡ˆä¾‹1ï¼šå›¾å½¢ç³»ç»Ÿèµ„æºç®¡ç†</strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Texture</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> textureId;
    <span class="hljs-type">int</span> width, height;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">Texture</span>(<span class="hljs-type">int</span> w, <span class="hljs-type">int</span> h) : <span class="hljs-built_in">width</span>(w), <span class="hljs-built_in">height</span>(h) {
        <span class="hljs-comment">// æ¨¡æ‹ŸOpenGLçº¹ç†åˆ›å»º</span>
        textureId = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span>&gt;(w * h); <span class="hljs-comment">// æ¨¡æ‹ŸIDç”Ÿæˆ</span>
        std::cout &lt;&lt; <span class="hljs-string">"åˆ›å»ºçº¹ç† "</span> &lt;&lt; textureId &lt;&lt; <span class="hljs-string">" ("</span> &lt;&lt; w &lt;&lt; <span class="hljs-string">"x"</span> &lt;&lt; h &lt;&lt; <span class="hljs-string">")"</span> &lt;&lt; std::endl;
    }
    
    ~<span class="hljs-built_in">Texture</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"é”€æ¯çº¹ç† "</span> &lt;&lt; textureId &lt;&lt; std::endl;
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">bind</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"ç»‘å®šçº¹ç† "</span> &lt;&lt; textureId &lt;&lt; std::endl;
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">TextureManager</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†å•ä¸ªçº¹ç†</span>
    std::vector&lt;std::unique_ptr&lt;Texture&gt;&gt; textures;
    
    <span class="hljs-comment">// çº¹ç†æ•°ç»„çš„ä¸“é—¨ç®¡ç†</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextureArray</span> {
    <span class="hljs-keyword">private</span>:
        std::unique_ptr&lt;Texture[]&gt; array;
        <span class="hljs-type">size_t</span> count;
        
    <span class="hljs-keyword">public</span>:
        <span class="hljs-built_in">TextureArray</span>(<span class="hljs-type">size_t</span> n) : <span class="hljs-built_in">array</span>(<span class="hljs-keyword">new</span> Texture[n]), <span class="hljs-built_in">count</span>(n) {
            std::cout &lt;&lt; <span class="hljs-string">"åˆ›å»ºçº¹ç†æ•°ç»„ï¼Œå¤§å°: "</span> &lt;&lt; n &lt;&lt; std::endl;
        }
        
        <span class="hljs-comment">// è‡ªåŠ¨è°ƒç”¨delete[]</span>
        ~<span class="hljs-built_in">TextureArray</span>() = <span class="hljs-keyword">default</span>;
        
        Texture&amp; <span class="hljs-keyword">operator</span>[](<span class="hljs-type">size_t</span> index) {
            <span class="hljs-keyword">return</span> array[index];
        }
        
        <span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">size</span><span class="hljs-params">()</span> <span class="hljs-type">const</span> </span>{ <span class="hljs-keyword">return</span> count; }
    };
    
    std::vector&lt;std::unique_ptr&lt;TextureArray&gt;&gt; textureArrays;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-comment">// æ·»åŠ å•ä¸ªçº¹ç†</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addTexture</span><span class="hljs-params">(<span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> </span>{
        textures.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">make_unique</span>&lt;Texture&gt;(width, height));
    }
    
    <span class="hljs-comment">// æ·»åŠ çº¹ç†æ•°ç»„</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">addTextureArray</span><span class="hljs-params">(<span class="hljs-type">size_t</span> count, <span class="hljs-type">int</span> width, <span class="hljs-type">int</span> height)</span> </span>{
        <span class="hljs-keyword">auto</span> array = std::<span class="hljs-built_in">make_unique</span>&lt;TextureArray&gt;(count);
        textureArrays.<span class="hljs-built_in">push_back</span>(std::<span class="hljs-built_in">move</span>(array));
    }
    
    <span class="hljs-comment">// ä½¿ç”¨æ‰€æœ‰çº¹ç†</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">useAllTextures</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨å•ä¸ªçº¹ç† ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; texture : textures) {
            texture-&gt;<span class="hljs-built_in">bind</span>();
        }
        
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨çº¹ç†æ•°ç»„ ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; array : textureArrays) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; array-&gt;<span class="hljs-built_in">size</span>(); ++i) {
                (*array)[i].<span class="hljs-built_in">bind</span>();
            }
        }
    }
    
    <span class="hljs-comment">// è‡ªåŠ¨æ­£ç¡®é‡Šæ”¾æ‰€æœ‰èµ„æº</span>
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_graphics_resource_management</span><span class="hljs-params">()</span> </span>{
    TextureManager manager;
    
    <span class="hljs-comment">// æ·»åŠ å•ä¸ªçº¹ç†</span>
    manager.<span class="hljs-built_in">addTexture</span>(<span class="hljs-number">256</span>, <span class="hljs-number">256</span>);
    manager.<span class="hljs-built_in">addTexture</span>(<span class="hljs-number">512</span>, <span class="hljs-number">512</span>);
    
    <span class="hljs-comment">// æ·»åŠ çº¹ç†æ•°ç»„</span>
    manager.<span class="hljs-built_in">addTextureArray</span>(<span class="hljs-number">3</span>, <span class="hljs-number">128</span>, <span class="hljs-number">128</span>);
    manager.<span class="hljs-built_in">addTextureArray</span>(<span class="hljs-number">5</span>, <span class="hljs-number">64</span>, <span class="hljs-number">64</span>);
    
    manager.<span class="hljs-built_in">useAllTextures</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"TextureManagerç¦»å¼€ä½œç”¨åŸŸï¼Œè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰èµ„æº..."</span> &lt;&lt; std::endl;
}
</code></pre>
<h4 data-id="heading-20"><strong>æ¡ˆä¾‹2ï¼šæ•°æ®åº“è¿æ¥æ± </strong></h4>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;memory&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span>
<span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;array&gt;</span></span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatabaseConnection</span> {
<span class="hljs-keyword">private</span>:
    std::string connectionString;
    <span class="hljs-type">bool</span> connected;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">DatabaseConnection</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; connStr)</span> 
        : connectionString(connStr), connected(false) {</span>
        <span class="hljs-built_in">connect</span>();
    }
    
    ~<span class="hljs-built_in">DatabaseConnection</span>() {
        <span class="hljs-built_in">disconnect</span>();
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">connect</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (!connected) {
            connected = <span class="hljs-literal">true</span>;
            std::cout &lt;&lt; <span class="hljs-string">"è¿æ¥æ•°æ®åº“: "</span> &lt;&lt; connectionString &lt;&lt; std::endl;
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">disconnect</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (connected) {
            connected = <span class="hljs-literal">false</span>;
            std::cout &lt;&lt; <span class="hljs-string">"æ–­å¼€æ•°æ®åº“è¿æ¥: "</span> &lt;&lt; connectionString &lt;&lt; std::endl;
        }
    }
    
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">execute</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; query)</span> </span>{
        <span class="hljs-keyword">if</span> (connected) {
            std::cout &lt;&lt; <span class="hljs-string">"æ‰§è¡ŒæŸ¥è¯¢: "</span> &lt;&lt; query &lt;&lt; <span class="hljs-string">" on "</span> &lt;&lt; connectionString &lt;&lt; std::endl;
        }
    }
};

<span class="hljs-keyword">class</span> <span class="hljs-title class_">ConnectionPool</span> {
<span class="hljs-keyword">private</span>:
    <span class="hljs-comment">// å›ºå®šå¤§å°è¿æ¥æ±  - ä½¿ç”¨std::array</span>
    <span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">size_t</span> POOL_SIZE = <span class="hljs-number">5</span>;
    std::array&lt;std::unique_ptr&lt;DatabaseConnection&gt;, POOL_SIZE&gt; connections;
    
    <span class="hljs-comment">// åŠ¨æ€æ‰©å±•è¿æ¥ - ä½¿ç”¨std::vector</span>
    std::vector&lt;std::unique_ptr&lt;DatabaseConnection&gt;&gt; extraConnections;
    
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">ConnectionPool</span>() {
        <span class="hljs-comment">// åˆå§‹åŒ–å›ºå®šè¿æ¥æ± </span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; POOL_SIZE; ++i) {
            connections[i] = std::<span class="hljs-built_in">make_unique</span>&lt;DatabaseConnection&gt;(
                <span class="hljs-string">"Server=DB"</span> + std::<span class="hljs-built_in">to_string</span>(i) + <span class="hljs-string">";Database=App"</span>
            );
        }
        std::cout &lt;&lt; <span class="hljs-string">"åˆå§‹åŒ–è¿æ¥æ± ï¼Œå¤§å°: "</span> &lt;&lt; POOL_SIZE &lt;&lt; std::endl;
    }
    
    <span class="hljs-comment">// è·å–å›ºå®šè¿æ¥æ± ä¸­çš„è¿æ¥</span>
    <span class="hljs-function">DatabaseConnection* <span class="hljs-title">getConnection</span><span class="hljs-params">(<span class="hljs-type">size_t</span> index)</span> </span>{
        <span class="hljs-keyword">if</span> (index &lt; POOL_SIZE) {
            <span class="hljs-keyword">return</span> connections[index].<span class="hljs-built_in">get</span>();
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;
    }
    
    <span class="hljs-comment">// åˆ›å»ºæ–°çš„åŠ¨æ€è¿æ¥</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">createExtraConnection</span><span class="hljs-params">(<span class="hljs-type">const</span> std::string&amp; connStr)</span> </span>{
        extraConnections.<span class="hljs-built_in">push_back</span>(
            std::<span class="hljs-built_in">make_unique</span>&lt;DatabaseConnection&gt;(connStr)
        );
    }
    
    <span class="hljs-comment">// ä½¿ç”¨æ‰€æœ‰è¿æ¥</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">useAllConnections</span><span class="hljs-params">()</span> </span>{
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨å›ºå®šè¿æ¥æ±  ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; POOL_SIZE; ++i) {
            connections[i]-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"SELECT * FROM users"</span>);
        }
        
        std::cout &lt;&lt; <span class="hljs-string">"=== ä½¿ç”¨åŠ¨æ€è¿æ¥ ==="</span> &lt;&lt; std::endl;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span>&amp; conn : extraConnections) {
            conn-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"UPDATE stats SET value = 1"</span>);
        }
    }
    
    <span class="hljs-comment">// è‡ªåŠ¨æ­£ç¡®é‡Šæ”¾æ‰€æœ‰è¿æ¥</span>
    ~<span class="hljs-built_in">ConnectionPool</span>() {
        std::cout &lt;&lt; <span class="hljs-string">"è¿æ¥æ± é”€æ¯ï¼Œè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰è¿æ¥..."</span> &lt;&lt; std::endl;
    }
};

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_connection_pool_management</span><span class="hljs-params">()</span> </span>{
    ConnectionPool pool;
    
    <span class="hljs-comment">// ä½¿ç”¨å›ºå®šè¿æ¥</span>
    <span class="hljs-keyword">auto</span>* conn1 = pool.<span class="hljs-built_in">getConnection</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">auto</span>* conn2 = pool.<span class="hljs-built_in">getConnection</span>(<span class="hljs-number">1</span>);
    
    <span class="hljs-keyword">if</span> (conn1 &amp;&amp; conn2) {
        conn1-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"BEGIN TRANSACTION"</span>);
        conn2-&gt;<span class="hljs-built_in">execute</span>(<span class="hljs-string">"COMMIT"</span>);
    }
    
    <span class="hljs-comment">// æ·»åŠ åŠ¨æ€è¿æ¥</span>
    pool.<span class="hljs-built_in">createExtraConnection</span>(<span class="hljs-string">"Server=EXTRA;Database=Backup"</span>);
    pool.<span class="hljs-built_in">createExtraConnection</span>(<span class="hljs-string">"Server=ANALYTICS;Database=Reports"</span>);
    
    pool.<span class="hljs-built_in">useAllConnections</span>();
    
    std::cout &lt;&lt; <span class="hljs-string">"ConnectionPoolç¦»å¼€ä½œç”¨åŸŸ..."</span> &lt;&lt; std::endl;
}
</code></pre>
<hr/>
<h3 data-id="heading-21"><strong>è°ƒè¯•ä¸æ£€æµ‹æŠ€æœ¯</strong></h3>
<h4 data-id="heading-22"><strong>1. å†…å­˜æ£€æµ‹å·¥å…·ä½¿ç”¨</strong></h4>
<p><strong>Valgrindæ£€æµ‹ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_memory_debugging</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// è¿™äº›é”™è¯¯ä¼šåœ¨Valgrind/Memcheckä¸­è¢«æ£€æµ‹åˆ°</span>
    
    <span class="hljs-comment">// é”™è¯¯1ï¼šnew[] é… delete</span>
    <span class="hljs-type">int</span>* array1 = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">10</span>];
    <span class="hljs-comment">// delete array1;  // Valgrindä¼šæŠ¥å‘Šï¼šmismatched free() / delete / delete[]</span>
    
    <span class="hljs-comment">// é”™è¯¯2ï¼šå†…å­˜æ³„æ¼</span>
    <span class="hljs-type">int</span>* leaked = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>[<span class="hljs-number">100</span>];
    <span class="hljs-comment">// å¿˜è®°delete[] leaked</span>
    
    <span class="hljs-comment">// é”™è¯¯3ï¼šé‡å¤é‡Šæ”¾</span>
    <span class="hljs-type">int</span>* doubleFree = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>;
    <span class="hljs-keyword">delete</span> doubleFree;
    <span class="hljs-comment">// delete doubleFree;  // Valgrindä¼šæŠ¥å‘Šï¼šinvalid free()</span>
    
    <span class="hljs-comment">// æ­£ç¡®é‡Šæ”¾</span>
    <span class="hljs-keyword">delete</span>[] array1;
    <span class="hljs-comment">// delete[] leaked;  // ä¿®å¤æ³„æ¼</span>
    <span class="hljs-comment">// ç¬¬äºŒä¸ªdeleteæ³¨é‡Šæ‰</span>
}
</code></pre>
<h4 data-id="heading-23"><strong>2. ç¼–è¯‘å™¨è¯Šæ–­é€‰é¡¹</strong></h4>
<p><strong>åˆ©ç”¨ç¼–è¯‘å™¨è­¦å‘Šï¼š</strong></p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// ç¼–è¯‘æ—¶ä½¿ç”¨è¿™äº›é€‰é¡¹æ£€æµ‹é—®é¢˜ï¼š</span>
<span class="hljs-comment">// g++ -Wall -Wextra -Werror main.cpp</span>
<span class="hljs-comment">// clang++ -Weverything -Werror main.cpp</span>
<span class="hljs-comment">// MSVC /W4 /WX</span>

<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">demonstrate_compiler_warnings</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// æŸäº›ç¼–è¯‘å™¨å¯ä»¥æ£€æµ‹åˆ°æ˜æ˜¾çš„ç±»å‹ä¸åŒ¹é…</span>
    <span class="hljs-type">int</span>* single = <span class="hljs-keyword">new</span> <span class="hljs-type">int</span>;
    
    <span class="hljs-comment">// delete[] single;  // æŸäº›ç¼–è¯‘å™¨ä¼šè­¦å‘Šï¼šä¸åŒ¹é…çš„åˆ é™¤å½¢å¼</span>
    
    <span class="hljs-keyword">delete</span> single;  <span class="hljs-comment">// æ­£ç¡®</span>
}
</code></pre>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ]]></title>    <link>https://juejin.cn/post/7570897638440894491</link>    <guid>https://juejin.cn/post/7570897638440894491</guid>    <pubDate>2025-11-10T13:22:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570897638440894491" data-draft-id="7570897638440878107" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-10T13:22:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:22:56.000Z" title="Mon Nov 10 2025 13:22:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Androidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æ</h2>
<h3 data-id="heading-1">é—®é¢˜èƒŒæ™¯</h3>
<ul>
<li>
<p>ç»ˆç«¯è®¾å¤‡ï¼šç”¨æˆ·æ“ä½œï¼š</p>
<ol>
<li>è¾“å…¥æ•°å­— "123456"</li>
<li>åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜ï¼ˆç™¾åº¦/æœç‹—è¾“å…¥æ³•ï¼‰</li>
<li>è¿ç»­ç‚¹å‡»å­—æ¯ 'q'</li>
</ol>
</li>
<li>
<p>å¼‚å¸¸ç»“æœï¼š
ç‚¹å‡»ç¬¬1æ¬¡ 'q': "123456" (ä¸å˜)
ç‚¹å‡»ç¬¬2æ¬¡ 'q': "12345"  (åˆ é™¤1ä½)
ç‚¹å‡»ç¬¬3æ¬¡ 'q': "123"    (åˆ é™¤2ä½)
ç‚¹å‡»ç¬¬4æ¬¡ 'q': ""       (å…¨éƒ¨åˆ é™¤)</p>
</li>
</ul>
<blockquote>
<p>å¾ˆå¥‡å¦™ï¼Œå°ç±³æ‰‹æœºæ˜¯æ²¡æœ‰è¿™äº›é—®é¢˜çš„ï¼Œæ— è®ºæ˜¯è‡ªå¸¦çš„è¾“å…¥æ³•è¿˜æ˜¯å®‰è£…çš„ç™¾åº¦è¾“å…¥æ³•å‡æ²¡æœ‰æ­¤é—®é¢˜</p>
</blockquote>
<p><strong>ä»¥Android 10 æºç è¿›è¡Œåˆ†æ</strong></p>
<h3 data-id="heading-2">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>ç°è±¡</strong>ï¼šEditTextè®¾ç½®<code>inputType="number"</code>åï¼Œåˆ‡æ¢å­—æ¯é”®ç›˜è¾“å…¥å­—æ¯å¯¼è‡´æ•°å­—å†…å®¹è¢«åˆ é™¤</li>
<li><strong>æœ¬è´¨</strong>ï¼šè¾“å…¥æ³•ä¸åº”ç”¨æ˜¯ä¸¤ä¸ªç‹¬ç«‹è¿›ç¨‹ï¼Œé€šè¿‡Binder IPCé€šä¿¡ï¼Œå­˜åœ¨å¤©ç„¶çš„ä¿¡æ¯ä¸å¯¹ç§°</li>
<li><strong>æ ¸å¿ƒæœºåˆ¶</strong>ï¼šAIDLæ¥å£å®šä¹‰ â†’ Stub/Proxyè‡ªåŠ¨ç”Ÿæˆ â†’ Binderé©±åŠ¨è·¨è¿›ç¨‹ä¼ è¾“ â†’ Handlerçº¿ç¨‹åˆ‡æ¢</li>
<li><strong>å…³é”®æ´å¯Ÿ</strong>ï¼šå¼‚æ­¥é€šä¿¡å¯¼è‡´è¾“å…¥æ³•æ— æ³•è·çŸ¥æ–‡æœ¬æ“ä½œçš„å®é™…æ‰§è¡Œç»“æœï¼Œå¼•å‘åç»­ä¸€ç³»åˆ—é—®é¢˜</li>
<li><strong>ä»·å€¼</strong>ï¼šç†è§£Androidè¾“å…¥æ³•æ¶æ„ï¼Œä¸ºåç»­ä¸¤ç¯‡æ–‡ç« ï¼ˆè®¾è®¡ç¼ºé™·ã€å·¥ç¨‹å®è·µï¼‰å¥ å®šåŸºç¡€</li>
</ul>
<hr/>
<h3 data-id="heading-3">ä¸€ã€é—®é¢˜ç°è±¡ï¼šä¸€ä¸ª"ä¸åº”è¯¥å­˜åœ¨"çš„Bug</h3>
<h4 data-id="heading-4">1.1 å¤ç°æ­¥éª¤</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- activity_main.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">EditText</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_number"</span>
    <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span>
    <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·æ“ä½œï¼š
<span class="hljs-number">1.</span> è¾“å…¥æ•°å­— <span class="hljs-string">"123456"</span>
<span class="hljs-number">2.</span> åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜ï¼ˆç™¾åº¦/æœç‹—è¾“å…¥æ³•ï¼‰
<span class="hljs-number">3.</span> è¿ç»­ç‚¹å‡»å­—æ¯ <span class="hljs-string">'q'</span>

å¼‚å¸¸ç»“æœï¼š
ç‚¹å‡»ç¬¬<span class="hljs-number">1</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">"123456"</span> (ä¸å˜)
ç‚¹å‡»ç¬¬<span class="hljs-number">2</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">"12345"</span>  (åˆ é™¤<span class="hljs-number">1</span>ä½)
ç‚¹å‡»ç¬¬<span class="hljs-number">3</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">"123"</span>    (åˆ é™¤<span class="hljs-number">2</span>ä½)
ç‚¹å‡»ç¬¬<span class="hljs-number">4</span>æ¬¡ <span class="hljs-string">'q'</span>: <span class="hljs-string">""</span>       (å…¨éƒ¨åˆ é™¤)
</code></pre>
<h4 data-id="heading-5">1.2 ç¬¬ä¸€ç›´è§‰çš„å›°æƒ‘</h4>
<ul>
<li><strong>InputFilterå·²ç”Ÿæ•ˆ</strong>ï¼šDigitsKeyListeneræ‹’ç»äº†å­—æ¯æ’å…¥</li>
<li><strong>æ—¥å¿—æ˜¾ç¤ºæ­£å¸¸</strong>ï¼šinsert("q")ç¡®å®è¢«æ‹’ç»</li>
<li><strong>ä½†æ•°å­—å´ä¸¢å¤±äº†</strong>ï¼šä¸ºä»€ä¹ˆåˆæ³•å†…å®¹è¢«åˆ é™¤ï¼Ÿ</li>
</ul>
<p>è¿™ä¸æ˜¯åº”ç”¨å±‚Bugï¼Œè€Œæ˜¯<strong>è·¨è¿›ç¨‹é€šä¿¡æœºåˆ¶å¯¼è‡´çš„ç³»ç»Ÿçº§é—®é¢˜</strong>ã€‚</p>
<hr/>
<h3 data-id="heading-6">äºŒã€è¾“å…¥æ³•æ¡†æ¶çš„ä¸‰è¿›ç¨‹æ¶æ„</h3>
<h4 data-id="heading-7">2.1 ä¸ºä»€ä¹ˆè¾“å…¥æ³•è¦ç‹¬ç«‹è¿›ç¨‹ï¼Ÿ</h4>
<pre><code class="hljs language-scss" lang="scss">å‡è®¾æ²¡æœ‰è¿›ç¨‹éš”ç¦»ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨è¿›ç¨‹                            â”‚
â”‚  â”œâ”€ EditText (å¯†ç : "MyPassword")   â”‚
â”‚  â””â”€ è¾“å…¥æ³•ä»£ç  (ç›´æ¥è¿è¡Œåœ¨åº”ç”¨å†…)     â”‚
â”‚       â†“                             â”‚
â”‚    æ¶æ„è¾“å…¥æ³•å¯ä»¥ï¼š                  â”‚
â”‚    - è¯»å– EditText<span class="hljs-selector-class">.getText</span>()        â”‚
â”‚    - è®¿é—® Activity<span class="hljs-selector-class">.findViewById</span>()   â”‚
â”‚    - çªƒå–åº”ç”¨å†…å­˜æ•°æ®                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>å®‰å…¨é£é™©</strong>ï¼šè¾“å…¥æ³•æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œä¸èƒ½ä¿¡ä»»ã€‚</p>
<h4 data-id="heading-8">2.2 å®é™…çš„ä¸‰å±‚æ¶æ„</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               åº”ç”¨è¿›ç¨‹ (com.example.app)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ EditText                                           â”‚ â”‚
â”‚  â”‚   â””â”€ InputConnection (BaseInputConnection)        â”‚ â”‚
â”‚  â”‚        - Binder Stub (IInputConnectionWrapper)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ç³»ç»ŸæœåŠ¡è¿›ç¨‹ (system_server)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ InputMethodManagerService (IMMS)                   â”‚ â”‚
â”‚  â”‚   - ç®¡ç†è¾“å…¥æ³•ç”Ÿå‘½å‘¨æœŸ                               â”‚ â”‚
â”‚  â”‚   - è½¬å‘Binderè°ƒç”¨                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†• Binder IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            è¾“å…¥æ³•è¿›ç¨‹ (com.baidu.input)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ InputMethodService                                 â”‚ â”‚
â”‚  â”‚   â””â”€ InputConnection (Binder Proxy)               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ¸å¿ƒè¦ç‚¹</strong>ï¼š</p>
<ol>
<li><strong>è¿›ç¨‹éš”ç¦»</strong>ï¼šè¾“å…¥æ³•æ— æ³•ç›´æ¥è®¿é—®åº”ç”¨å†…å­˜</li>
<li><strong>å”¯ä¸€é€šé“</strong>ï¼šInputConnectionæ˜¯ä¸¤è€…é€šä¿¡çš„å”¯ä¸€æ¡¥æ¢</li>
<li><strong>æƒé™å—é™</strong>ï¼šInputConnectionæ¥å£åªæš´éœ²æ–‡æœ¬ç¼–è¾‘æ–¹æ³•ï¼Œä¸æš´éœ²UIè®¿é—®</li>
</ol>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€InputConnectionçš„Binderå®ç°</h3>
<h4 data-id="heading-10">3.1 AIDLæ¥å£å®šä¹‰</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IInputContext.aidl (ç³»ç»Ÿå†…éƒ¨æ¥å£)</span>
<span class="hljs-keyword">package</span> com.android.internal.view;

<span class="hljs-keyword">interface</span> <span class="hljs-title class_">IInputContext</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">commitText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span>;
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">deleteSurroundingText</span><span class="hljs-params">(<span class="hljs-type">int</span> beforeLength, <span class="hljs-type">int</span> afterLength)</span>;

    CharSequence <span class="hljs-title function_">getTextBeforeCursor</span><span class="hljs-params">(<span class="hljs-type">int</span> length, <span class="hljs-type">int</span> flags)</span>;
    CharSequence <span class="hljs-title function_">getTextAfterCursor</span><span class="hljs-params">(<span class="hljs-type">int</span> length, <span class="hljs-type">int</span> flags)</span>;
    <span class="hljs-comment">// ... æ›´å¤šæ–¹æ³•</span>
}
</code></pre>
<p><strong>AIDLçš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å®šä¹‰è·¨è¿›ç¨‹æ¥å£</li>
<li>ç¼–è¯‘åè‡ªåŠ¨ç”ŸæˆStubï¼ˆæœåŠ¡ç«¯ï¼‰å’ŒProxyï¼ˆå®¢æˆ·ç«¯ï¼‰</li>
</ul>
<h4 data-id="heading-11">3.2 åº”ç”¨è¿›ç¨‹ï¼šBinder Stub</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// IInputConnectionWrapper.java (åº”ç”¨è¿›ç¨‹)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">IInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IInputContext</span>.Stub {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> InputConnection mInputConnection; <span class="hljs-comment">// BaseInputConnection</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Handler mH;                      <span class="hljs-comment">// ä¸»çº¿ç¨‹Handler</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
        <span class="hljs-comment">// å½“å‰çº¿ç¨‹ï¼šBinderçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼ˆå¦‚ Binder:12345_3ï¼‰</span>

        <span class="hljs-comment">// å‘é€åˆ°ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
        mH.post(() -&gt; {
            <span class="hljs-comment">// ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
            mInputConnection.setComposingText(text, newCursorPosition);
        });

        <span class="hljs-comment">// ç«‹å³è¿”å›ï¼Œä¸ç­‰å¾…æ‰§è¡Œå®Œæˆï¼</span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹1</strong>ï¼šçº¿ç¨‹åˆ‡æ¢</p>
<ul>
<li>Binderè°ƒç”¨å‘ç”Ÿåœ¨Binderçº¿ç¨‹ï¼ˆéä¸»çº¿ç¨‹ï¼‰</li>
<li>EditTextæ“ä½œå¿…é¡»åœ¨ä¸»çº¿ç¨‹ï¼ˆViewRootImplæ£€æŸ¥ï¼‰</li>
<li>é€šè¿‡Handler.poståˆ‡æ¢çº¿ç¨‹</li>
</ul>
<p><strong>å…³é”®ç‚¹2</strong>ï¼šå¼‚æ­¥æ‰§è¡Œ</p>
<ul>
<li><code>post()</code>åç«‹å³è¿”å›ï¼Œä¸é˜»å¡Binderçº¿ç¨‹</li>
<li>è¾“å…¥æ³•è®¤ä¸ºè°ƒç”¨"æˆåŠŸ"ï¼Œä½†å®é™…å°šæœªæ‰§è¡Œ</li>
<li>è¿™æ˜¯åç»­Bugçš„æ ¹æºä¹‹ä¸€</li>
</ul>
<h4 data-id="heading-12">3.3 è¾“å…¥æ³•è¿›ç¨‹ï¼šBinder Proxy</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥æ³•è¿›ç¨‹ä¸­çš„ä»£ç†å¯¹è±¡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">InputConnectionProxy</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputConnection</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> IInputContext mIInputContext; <span class="hljs-comment">// Binderä»£ç†</span>

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// çœ‹ä¼¼æœ¬åœ°è°ƒç”¨ï¼Œå®é™…è·¨è¿›ç¨‹</span>
            mIInputContext.setComposingText(text, newCursorPosition);
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        } <span class="hljs-keyword">catch</span> (RemoteException e) {
            <span class="hljs-comment">// åº”ç”¨è¿›ç¨‹å´©æºƒæˆ–è¿æ¥æ–­å¼€</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼šé€æ˜çš„è·¨è¿›ç¨‹</p>
<ul>
<li>è¾“å…¥æ³•è°ƒç”¨æœ¬åœ°æ–¹æ³•</li>
<li>Binderé©±åŠ¨è‡ªåŠ¨è½¬å‘åˆ°åº”ç”¨è¿›ç¨‹</li>
<li>è¿”å›å€¼åªè¡¨ç¤º"Binderè°ƒç”¨æˆåŠŸ"ï¼Œä¸è¡¨ç¤º"æ–‡æœ¬æ“ä½œæˆåŠŸ"</li>
</ul>
<hr/>
<h3 data-id="heading-13">å››ã€å®Œæ•´çš„Binderè°ƒç”¨é“¾è·¯</h3>
<h4 data-id="heading-14">4.1 è¯¦ç»†æ—¶åºå›¾</h4>
<p>ç”¨æˆ·ç‚¹å‡»å­—æ¯'q'çš„å®Œæ•´æµç¨‹ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">è¾“å…¥æ³•è¿›ç¨‹                Binderé©±åŠ¨           åº”ç”¨è¿›ç¨‹
(Baidu IME)                                   (Your App)
     â”‚                                            â”‚
     â”‚ <span class="hljs-number">1</span>. <span class="hljs-built_in">onKeyClick</span>('q')                         â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">2</span>. <span class="hljs-built_in">getCurrentInputConnection</span>()             â”‚
     â”‚    â†’ InputConnectionProxy                  â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">3</span>. proxy<span class="hljs-selector-class">.setComposingText</span>("q", <span class="hljs-number">1</span>)          â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">4</span>. Parcel<span class="hljs-selector-class">.obtain</span>()                         â”‚
     â”‚    å†™å…¥å‚æ•°åˆ°Parcel                         â”‚
     â”‚    â†“                                       â”‚
     â”‚ <span class="hljs-number">5</span>. mRemote<span class="hljs-selector-class">.transact</span>()                      â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Binderé©±åŠ¨                   â”‚
     â”‚               â”œâ”€ æ‹·è´æ•°æ®åˆ°å†…æ ¸ç¼“å†²åŒº        â”‚
     â”‚               â”œâ”€ æŸ¥æ‰¾ç›®æ ‡è¿›ç¨‹ (PID)         â”‚
     â”‚               â”œâ”€ å”¤é†’Binderçº¿ç¨‹             â”‚
     â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Binderçº¿ç¨‹æ±      â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">6</span>. <span class="hljs-built_in">onTransact</span>()   â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">7</span>. è§£æParcel     â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">8</span>. Handler<span class="hljs-selector-class">.post</span>() â”‚
     â”‚                              â†“             â”‚
     â”‚                          è¿”å›æˆåŠŸ           â”‚
     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
     â”‚                                            â”‚
     â”‚ <span class="hljs-number">9</span>. è¾“å…¥æ³•è®¤ä¸ºè°ƒç”¨æˆåŠŸ                        â”‚
     â”‚    ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘                          â”‚
     â”‚                                            â”‚
     â”‚                              æ¶ˆæ¯é˜Ÿåˆ—       â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">10</span>. ä¸»çº¿ç¨‹         â”‚
     â”‚                              Handler<span class="hljs-selector-class">.handleMessage</span>()
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">11</span>. BaseInputConnection
     â”‚                              <span class="hljs-selector-class">.setComposingText</span>()
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">12</span>. <span class="hljs-built_in">replaceText</span>() â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">13</span>. Editableæ“ä½œ  â”‚
     â”‚                              â†“             â”‚
     â”‚                          <span class="hljs-number">14</span>. UIåˆ·æ–°        â”‚
</code></pre>
<h4 data-id="heading-15">4.2 Binder transactçš„å®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Proxyç«¯ï¼ˆè¾“å…¥æ³•è¿›ç¨‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-type">Parcel</span> <span class="hljs-variable">data</span> <span class="hljs-operator">=</span> Parcel.obtain();   <span class="hljs-comment">// æ•°æ®åŒ…</span>
    <span class="hljs-type">Parcel</span> <span class="hljs-variable">reply</span> <span class="hljs-operator">=</span> Parcel.obtain();  <span class="hljs-comment">// è¿”å›åŒ…</span>

    <span class="hljs-keyword">try</span> {
        data.writeInterfaceToken(DESCRIPTOR);

        <span class="hljs-comment">// åºåˆ—åŒ–å‚æ•°</span>
        TextUtils.writeToParcel(text, data, <span class="hljs-number">0</span>);
        data.writeInt(newCursorPosition);

        <span class="hljs-comment">// å‘èµ·Binderè°ƒç”¨ï¼ˆé˜»å¡ç­‰å¾…è¿”å›ï¼‰</span>
        mRemote.transact(TRANSACTION_setComposingText, data, reply, <span class="hljs-number">0</span>);

        reply.readException(); <span class="hljs-comment">// è¯»å–å¼‚å¸¸ï¼ˆå¦‚æœæœ‰ï¼‰</span>
    } <span class="hljs-keyword">finally</span> {
        data.recycle();
        reply.recycle();
    }
}
</code></pre>
<p><strong>æ€§èƒ½æ•°æ®</strong>ï¼š</p>
<ul>
<li>åºåˆ—åŒ–ï¼š~10Î¼s</li>
<li>Binder transactï¼š~100Î¼s</li>
<li>æ€»è€—æ—¶ï¼š~110Î¼s</li>
</ul>
<p>ä½†è¿™åªæ˜¯åˆ°è¾¾åº”ç”¨è¿›ç¨‹Binderçº¿ç¨‹çš„æ—¶é—´ï¼Œå®é™…æ‰§è¡Œè¿˜è¦ç­‰ä¸»çº¿ç¨‹è°ƒåº¦ã€‚</p>
<h4 data-id="heading-16">4.3 çº¿ç¨‹åˆ‡æ¢çš„å»¶è¿Ÿ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// Stubç«¯ï¼ˆåº”ç”¨è¿›ç¨‹ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-comment">// å½“å‰ï¼šBinderçº¿ç¨‹</span>

    <span class="hljs-type">Message</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> mH.obtainMessage(DO_SET_COMPOSING_TEXT);
    msg.obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SomeArgs</span>(text, newCursorPosition);
    msg.sendToTarget();

    <span class="hljs-comment">// ç«‹å³è¿”å›ï¼ˆæ€»è€—æ—¶ ~110Î¼sï¼‰</span>
}

<span class="hljs-comment">// ä¸»çº¿ç¨‹ Handler</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleMessage</span><span class="hljs-params">(Message msg)</span> {
    <span class="hljs-comment">// å½“å‰ï¼šä¸»çº¿ç¨‹</span>
    <span class="hljs-comment">// å»¶è¿Ÿï¼šå–å†³äºä¸»çº¿ç¨‹æ¶ˆæ¯é˜Ÿåˆ—</span>
    <span class="hljs-comment">//      æ­£å¸¸æƒ…å†µï¼š&lt; 16ms (ä¸€å¸§)</span>
    <span class="hljs-comment">//      ç¹å¿™æƒ…å†µï¼š&gt; 100ms</span>

    mInputConnection.setComposingText(...);
}
</code></pre>
<p><strong>ä¿¡æ¯ä¸å¯¹ç§°çš„æ ¹æº</strong>ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">è¾“å…¥æ³•è§†è§’ï¼š
  è°ƒç”¨ <span class="hljs-built_in">setComposingText</span>() â†’ è¿”å› <span class="hljs-literal">true</span> â†’ <span class="hljs-string">"æˆåŠŸ"</span>

å®é™…æƒ…å†µï¼š
  Binderè°ƒç”¨æˆåŠŸ â‰  æ–‡æœ¬æ“ä½œæˆåŠŸ
  å¯èƒ½è¿˜åœ¨æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ’é˜Ÿ
  å¯èƒ½è¢«InputFilteræ‹’ç»

è¾“å…¥æ³•æ— ä»å¾—çŸ¥çœŸå®ç»“æœï¼
</code></pre>
<hr/>
<h3 data-id="heading-17">äº”ã€Binderæœºåˆ¶çš„æ€§èƒ½è€ƒé‡</h3>
<h4 data-id="heading-18">5.1 ä¸€æ¬¡æ‹·è´ vs ä¸¤æ¬¡æ‹·è´</h4>
<p><strong>ä¼ ç»ŸIPCï¼ˆç®¡é“/Socketï¼‰</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">å‘é€è¿›ç¨‹ç”¨æˆ·ç©ºé—´ â†’ å†…æ ¸ç¼“å†²åŒº â†’ æ¥æ”¶è¿›ç¨‹ç”¨æˆ·ç©ºé—´
     (æ‹·è´<span class="hljs-number">1</span>)           (æ‹·è´<span class="hljs-number">2</span>)
</code></pre>
<p><strong>Binder IPC</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å‘é€è¿›ç¨‹ç”¨æˆ·ç©ºé—´ â†’ Binderå†…æ ¸ç¼“å†²åŒºï¼ˆmmapæ˜ å°„ï¼‰
<span class="hljs-code">     (æ‹·è´1)            â†“
                 æ¥æ”¶è¿›ç¨‹ç›´æ¥è®¿é—®ï¼ˆé›¶æ‹·è´ï¼‰
</span></code></pre>
<p><strong>mmapçš„ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å†…æ ¸ç¼“å†²åŒºæ˜ å°„åˆ°æ¥æ”¶è¿›ç¨‹åœ°å€ç©ºé—´</li>
<li>æ¥æ”¶è¿›ç¨‹è¯»å–æ—¶æ— éœ€æ‹·è´</li>
<li>å‡å°‘50%çš„æ•°æ®æ‹·è´å¼€é”€</li>
</ul>
<h4 data-id="heading-19">5.2 CharSequenceçš„ä¼ è¾“æˆæœ¬</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// TextUtils.java</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeToParcel</span><span class="hljs-params">(CharSequence cs, Parcel p, <span class="hljs-type">int</span> flags)</span> {
    <span class="hljs-keyword">if</span> (cs <span class="hljs-keyword">instanceof</span> Spanned) {
        <span class="hljs-comment">// åŒ…å«å¯Œæ–‡æœ¬æ ·å¼</span>
        p.writeInt(<span class="hljs-number">1</span>);
        p.writeString(cs.toString());

        <span class="hljs-comment">// åºåˆ—åŒ–Spanä¿¡æ¯</span>
        <span class="hljs-type">Spanned</span> <span class="hljs-variable">sp</span> <span class="hljs-operator">=</span> (Spanned) cs;
        Object[] spans = sp.getSpans(<span class="hljs-number">0</span>, cs.length(), Object.class);
        p.writeInt(spans.length);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; spans.length; i++) {
            <span class="hljs-type">Object</span> <span class="hljs-variable">span</span> <span class="hljs-operator">=</span> spans[i];
            <span class="hljs-type">int</span> <span class="hljs-variable">spanStart</span> <span class="hljs-operator">=</span> sp.getSpanStart(span);
            <span class="hljs-type">int</span> <span class="hljs-variable">spanEnd</span> <span class="hljs-operator">=</span> sp.getSpanEnd(span);
            <span class="hljs-type">int</span> <span class="hljs-variable">spanFlags</span> <span class="hljs-operator">=</span> sp.getSpanFlags(span);

            <span class="hljs-comment">// æ¯ä¸ªSpan: ç±»å‹ + èµ·å§‹ + ç»“æŸ + æ ‡å¿—</span>
            <span class="hljs-comment">// çº¦ 20-50 bytes</span>
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// çº¯æ–‡æœ¬</span>
        p.writeInt(<span class="hljs-number">0</span>);
        p.writeString(cs.toString());
    }
}
</code></pre>
<p><strong>æ€§èƒ½å¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python">çº¯æ–‡æœ¬ <span class="hljs-string">"hello"</span>:
  <span class="hljs-number">5</span>ä¸ªå­—ç¬¦ Ã— <span class="hljs-number">2</span> <span class="hljs-built_in">bytes</span> (UTF-<span class="hljs-number">16</span>) = <span class="hljs-number">10</span> <span class="hljs-built_in">bytes</span>
  + é•¿åº¦ä¿¡æ¯ = <span class="hljs-number">14</span> <span class="hljs-built_in">bytes</span>

å¯Œæ–‡æœ¬ <span class="hljs-string">"hello"</span> (çº¢è‰² + ç²—ä½“):
  æ–‡æœ¬: <span class="hljs-number">14</span> <span class="hljs-built_in">bytes</span>
  + <span class="hljs-number">2</span>ä¸ªSpan Ã— <span class="hljs-number">40</span> <span class="hljs-built_in">bytes</span> = <span class="hljs-number">80</span> <span class="hljs-built_in">bytes</span>
  æ€»è®¡: <span class="hljs-number">94</span> <span class="hljs-built_in">bytes</span> (<span class="hljs-number">6.7</span>å€)
</code></pre>
<p><strong>ä¼˜åŒ–å»ºè®®</strong>ï¼šè¾“å…¥æ³•å°½é‡å‘é€çº¯æ–‡æœ¬ï¼Œé¿å…Spanã€‚</p>
<h4 data-id="heading-20">5.3 é«˜é¢‘è°ƒç”¨çš„æ€§èƒ½å½±å“</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·å¿«é€Ÿè¾“å…¥ "hello"</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : <span class="hljs-string">"hello"</span>.toCharArray()) {
    ic.commitText(String.valueOf(c), <span class="hljs-number">1</span>);
    <span class="hljs-comment">// æ¯æ¬¡è°ƒç”¨ï¼š~110Î¼s Binder + ~200Î¼s ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
}

<span class="hljs-comment">// 5ä¸ªå­—ç¬¦ Ã— 310Î¼s = 1.55ms (å¯æ¥å—)</span>

<span class="hljs-comment">// ä½†å¦‚æœè¾“å…¥æ³•è¿˜è¯»å–ä¸Šä¸‹æ–‡ï¼š</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">char</span> c : <span class="hljs-string">"hello"</span>.toCharArray()) {
    <span class="hljs-type">CharSequence</span> <span class="hljs-variable">ctx</span> <span class="hljs-operator">=</span> ic.getTextBeforeCursor(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// +110Î¼s</span>
    ic.commitText(String.valueOf(c), <span class="hljs-number">1</span>);              <span class="hljs-comment">// +310Î¼s</span>
}

<span class="hljs-comment">// 5ä¸ªå­—ç¬¦ Ã— 420Î¼s = 2.1ms (ä»å¯æ¥å—)</span>
</code></pre>
<p><strong>ç»“è®º</strong>ï¼šBinderæ€§èƒ½è¶³å¤Ÿå¥½ï¼Œä¸æ˜¯ç“¶é¢ˆã€‚</p>
<hr/>
<h3 data-id="heading-21">å…­ã€ä»Binderè§†è§’çœ‹Bugçš„è§¦å‘</h3>
<h4 data-id="heading-22">6.1 æ­£å¸¸åœºæ™¯ï¼šè¾“å…¥æ•°å­—</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥æ³•è¿›ç¨‹</span>
ic.commitText(<span class="hljs-string">"1"</span>, <span class="hljs-number">1</span>);

<span class="hljs-comment">// Binderä¼ è¾“åˆ°åº”ç”¨è¿›ç¨‹</span>
<span class="hljs-comment">// â†“</span>

<span class="hljs-comment">// åº”ç”¨è¿›ç¨‹ä¸»çº¿ç¨‹</span>
BaseInputConnection.commitText(<span class="hljs-string">"1"</span>, <span class="hljs-number">1</span>)
  â†’ Editable.insert(<span class="hljs-number">0</span>, <span class="hljs-string">"1"</span>)
  â†’ InputFilter.filter(<span class="hljs-string">"1"</span>, ...)  <span class="hljs-comment">// DigitsKeyListener</span>
  â†’ æ£€æŸ¥ï¼š<span class="hljs-string">'1'</span> æ˜¯æ•°å­— â†’ è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
  â†’ æ’å…¥æˆåŠŸ
</code></pre>
<p><strong>ç»“æœ</strong>ï¼šâœ“ æ­£å¸¸</p>
<h4 data-id="heading-23">6.2 Bugåœºæ™¯ï¼šè¾“å…¥å­—æ¯</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¬¬1æ¬¡ï¼šsetComposingText("q")</span>
è¾“å…¥æ³•è¿›ç¨‹ï¼š
  ic.setComposingText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC
åº”ç”¨è¿›ç¨‹ Binderçº¿ç¨‹ï¼š
  IInputConnectionWrapper.onTransact()
  â†’ Handler.post(runnable)
  â†’ è¿”å›æˆåŠŸ
  â†“
è¾“å…¥æ³•ï¼šè®¤ä¸ºæˆåŠŸï¼Œç»§ç»­
  â†“
åº”ç”¨è¿›ç¨‹ä¸»çº¿ç¨‹ï¼ˆå»¶è¿Ÿæ‰§è¡Œï¼‰ï¼š
  BaseInputConnection.setComposingText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†’ replaceText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†’ ç»„åˆèŒƒå›´: a=-<span class="hljs-number">1</span>, b=-<span class="hljs-number">1</span> (æ— )
  â†’ delete: ä¸æ‰§è¡Œ
  â†’ insert(<span class="hljs-string">"q"</span>): è¢«DigitsKeyListeneræ‹’ç»
  â†’ setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>) <span class="hljs-comment">// è®¾ç½®äº†ç©ºèŒƒå›´</span>

<span class="hljs-comment">// ç¬¬2æ¬¡ï¼šsetComposingText("qq")</span>
è¾“å…¥æ³•è¿›ç¨‹ï¼š
  ic.setComposingText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC
åº”ç”¨è¿›ç¨‹ä¸»çº¿ç¨‹ï¼š
  BaseInputConnection.setComposingText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†’ replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†’ ç»„åˆèŒƒå›´: a=<span class="hljs-number">5</span>, b=<span class="hljs-number">6</span> â† ä¸Šæ¬¡è®¾ç½®çš„
  â†’ delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>): åˆ é™¤å­—ç¬¦<span class="hljs-string">'6'</span> âœ— (ç»•è¿‡äº†Filter!)
  â†’ insert(<span class="hljs-string">"qq"</span>): è¢«DigitsKeyListeneræ‹’ç»
  â†’ ç»“æœ: <span class="hljs-string">"12345"</span> (ä¸¢å¤±äº†<span class="hljs-string">'6'</span>)
</code></pre>
<p><strong>Binderå±‚é¢çš„é—®é¢˜</strong>ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">è¾“å…¥æ³•å‘é€ï¼šsetComposingText("qq")
  â†“ æœŸæœ›ï¼šæ›¿æ¢ä¸º"qq"
  â†“ å®é™…ï¼š<span class="hljs-keyword">delete</span>æˆåŠŸ <span class="hljs-operator">+</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  â†“ ç»“æœï¼šæ•°æ®ä¸¢å¤±
  â†“ åé¦ˆï¼šè¿”å› <span class="hljs-literal">true</span> (æˆåŠŸ)

è¾“å…¥æ³•ä¸çŸ¥é“å®é™…å‘ç”Ÿäº†ä»€ä¹ˆï¼
</code></pre>
<h4 data-id="heading-24">6.3 ä¿¡æ¯ä¸å¯¹ç§°çš„æœ¬è´¨</h4>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Binderæ¥å£çš„å±€é™æ€§                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  æ¥å£å®šä¹‰ï¼š                                      â”‚
â”‚  <span class="hljs-type">boolean</span> setComposingText(CharSequence, <span class="hljs-type">int</span>)   â”‚
â”‚                                                 â”‚
â”‚  è¿”å›å€¼å«ä¹‰ï¼š                                    â”‚
â”‚  <span class="hljs-operator">-</span> <span class="hljs-literal">true</span>:  Binderè°ƒç”¨æˆåŠŸ                        â”‚
â”‚  <span class="hljs-operator">-</span> <span class="hljs-literal">false</span>: Binderè°ƒç”¨å¤±è´¥ï¼ˆRemoteExceptionï¼‰     â”‚
â”‚                                                 â”‚
â”‚  æ— æ³•è¡¨è¾¾ï¼š                                      â”‚
â”‚  <span class="hljs-operator">-</span> æ–‡æœ¬æ˜¯å¦çœŸçš„è¢«æ’å…¥                            â”‚
â”‚  <span class="hljs-operator">-</span> è¢«InputFilterè¿‡æ»¤æ‰å¤šå°‘å­—ç¬¦                   â”‚
â”‚  <span class="hljs-operator">-</span> å®é™…å…‰æ ‡ä½ç½®                                 â”‚
â”‚  <span class="hljs-operator">-</span> <span class="hljs-keyword">delete</span><span class="hljs-operator">/</span><span class="hljs-keyword">insert</span>çš„è¯¦ç»†ç»“æœ                      â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>è®¾è®¡ç¼ºé™·</strong>ï¼š</p>
<ul>
<li>æ¥å£è¿‡äºç®€å•ï¼Œæ— æ³•ä¼ é€’è¯¦ç»†ä¿¡æ¯</li>
<li>å¼‚æ­¥æ‰§è¡Œï¼Œæ— æ³•ç­‰å¾…å®é™…ç»“æœ</li>
<li>è¾“å…¥æ³•ä¸åº”ç”¨çŠ¶æ€ä¸åŒæ­¥</li>
</ul>
<hr/>
<h3 data-id="heading-25">ä¸ƒã€æ€»ç»“ï¼šBinderé€šä¿¡çš„æœ¬è´¨</h3>
<h4 data-id="heading-26">7.1 æ ¸å¿ƒæ¶æ„å›é¡¾</h4>
<pre><code class="hljs language-scss" lang="scss">è¾“å…¥æ³•è¿›ç¨‹ â†â”€ Binder IPC â”€â†’ åº”ç”¨è¿›ç¨‹
   â†“                          â†“
é€æ˜ä»£ç†                    çº¿ç¨‹åˆ‡æ¢
(ä»¥ä¸ºæ˜¯æœ¬åœ°è°ƒç”¨)          (Binderçº¿ç¨‹ â†’ ä¸»çº¿ç¨‹)
   â†“                          â†“
è°ƒç”¨è¿”å› true               å¼‚æ­¥æ‰§è¡Œ
(åªè¡¨ç¤ºIPCæˆåŠŸ)            (å¯èƒ½å¤±è´¥ï¼Œä½†æ— åé¦ˆ)
   â†“                          â†“
ç»§ç»­åç»­æ“ä½œ                 å®é™…æ–‡æœ¬æ“ä½œ
(åŸºäºé”™è¯¯å‡è®¾)              (ç»“æœæœªçŸ¥)
</code></pre>
<h4 data-id="heading-27">7.2 å…³é”®æŠ€æœ¯ç‚¹</h4>



































<table><thead><tr><th>æŠ€æœ¯ç‚¹</th><th>å®ç°</th><th>å½±å“</th></tr></thead><tbody><tr><td><strong>è¿›ç¨‹éš”ç¦»</strong></td><td>è¾“å…¥æ³•ç‹¬ç«‹è¿›ç¨‹</td><td>å®‰å…¨æ€§â†‘ï¼Œéœ€è¦IPC</td></tr><tr><td><strong>Binder IPC</strong></td><td>AIDLç”ŸæˆStub/Proxy</td><td>ä¸€æ¬¡æ‹·è´ï¼Œæ€§èƒ½å¥½</td></tr><tr><td><strong>çº¿ç¨‹åˆ‡æ¢</strong></td><td>Binderçº¿ç¨‹â†’Handlerâ†’ä¸»çº¿ç¨‹</td><td>å¼‚æ­¥æ‰§è¡Œï¼Œå»¶è¿Ÿ</td></tr><tr><td><strong>è¿”å›å€¼</strong></td><td>boolean (æˆåŠŸ/å¤±è´¥)</td><td>ä¿¡æ¯ä¸è¶³ï¼Œæ— ç»†èŠ‚</td></tr><tr><td><strong>ä¿¡æ¯ä¸å¯¹ç§°</strong></td><td>è¾“å…¥æ³•ä¸çŸ¥é“å®é™…ç»“æœ</td><td>å¼•å‘åç»­Bug</td></tr></tbody></table>
<h4 data-id="heading-28">7.3 ä¸ºåç»­æ–‡ç« é“ºå«</h4>
<p><strong>ç¬¬ä¸€ç¯‡ï¼ˆæœ¬æ–‡ï¼‰</strong>ï¼š</p>
<ul>
<li>âœ“ ç†è§£äº†ä¸‰è¿›ç¨‹æ¶æ„</li>
<li>âœ“ ç†è§£äº†Binder IPCæœºåˆ¶</li>
<li>âœ“ ç†è§£äº†å¼‚æ­¥é€šä¿¡å¯¼è‡´çš„ä¿¡æ¯ä¸å¯¹ç§°</li>
</ul>
<p><strong>ç¬¬äºŒç¯‡é¢„å‘Š</strong>ï¼š</p>
<ul>
<li>ä»åº”ç”¨è¿›ç¨‹å†…éƒ¨çœ‹ï¼šreplaceText()ä¸ºä»€ä¹ˆå…ˆdeleteåinsertï¼Ÿ</li>
<li>deleteä¸ºä»€ä¹ˆèƒ½ç»•è¿‡InputFilterï¼Ÿ</li>
<li>SpanèŒƒå›´ä¸ºä»€ä¹ˆä¼šå¼‚å¸¸æ‰©å±•ï¼Ÿ</li>
<li>â†’ æ·±å…¥Editableã€InputFilterã€Spançš„è®¾è®¡ç¼ºé™·</li>
</ul>
<p><strong>ç¬¬ä¸‰ç¯‡é¢„å‘Š</strong>ï¼š</p>
<ul>
<li>å¦‚ä½•åœ¨åº”ç”¨å±‚è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ</li>
<li>å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼ˆä¿ç•™æ•°å­—é”®ç›˜ï¼‰</li>
<li>å·¥ç¨‹å®è·µçš„æœ€ä½³åšæ³•</li>
<li>â†’ ä»æ¶æ„è®¾è®¡åˆ°ä»£ç å®ç°</li>
</ul>
<hr/>
<h3 data-id="heading-29">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/</code></li>
<li>Binderé©±åŠ¨ï¼š<code>kernel/drivers/android/binder.c</code></li>
<li>AIDLæ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Fguide%2Fcomponents%2Faidl" target="_blank" title="https://developer.android.com/guide/components/aidl" ref="nofollow noopener noreferrer">Android Interface Definition Language</a></li>
<li>BinderåŸç†ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fsource.android.com%2Fdevices%2Farchitecture%2Fhidl%2Fbinder-ipc" target="_blank" title="https://source.android.com/devices/architecture/hidl/binder-ipc" ref="nofollow noopener noreferrer">Android Binder Design</a></li>
</ol>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡</strong>ï¼šã€Šä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·ã€‹- æ·±å…¥åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼Œå‰–æEditableã€InputFilterã€Spanæœºåˆ¶çš„ä¸å¯¹ç§°æ€§</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·]]></title>    <link>https://juejin.cn/post/7570932873131294747</link>    <guid>https://juejin.cn/post/7570932873131294747</guid>    <pubDate>2025-11-10T13:24:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873131294747" data-draft-id="7570932873131278363" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·"/> <meta itemprop="keywords" content="Android,Linux"/> <meta itemprop="datePublished" content="2025-11-10T13:24:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:24:41.000Z" title="Mon Nov 10 2025 13:24:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·</h2>
<h3 data-id="heading-1">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>æ‰¿æ¥ä¸Šæ–‡</strong>ï¼šç¬¬ä¸€ç¯‡è§£æäº†è·¨è¿›ç¨‹é€šä¿¡ï¼Œæœ¬ç¯‡æ·±å…¥åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼Œå‰–ææ–‡æœ¬æ“ä½œçš„è®¾è®¡ç¼ºé™·</li>
<li><strong>æ ¸å¿ƒçŸ›ç›¾</strong>ï¼šInputFilteræœŸæœ›æ§åˆ¶æ‰€æœ‰æ–‡æœ¬æ“ä½œï¼Œä½†delete()ç»•è¿‡äº†è¿‡æ»¤æœºåˆ¶</li>
<li><strong>å…³é”®å‘ç°</strong>ï¼š<code>replaceText()</code>å…ˆdeleteåinsertï¼Œdeleteä¼ å…¥ç©ºå­—ç¬¦ä¸²""ï¼ŒInputFilterè®¤ä¸ºåˆæ³•æ”¾è¡Œ</li>
<li><strong>æ·±å±‚åŸå› </strong>ï¼šSpanèŒƒå›´åœ¨insertå¤±è´¥åä¸å®é™…æ–‡æœ¬ä¸åŒæ­¥ï¼Œå¯¼è‡´èŒƒå›´å¼‚å¸¸æ‰©å±•ï¼Œåå™¬æ›´å¤šå­—ç¬¦</li>
<li><strong>ä»·å€¼</strong>ï¼šç†è§£Androidæ–‡æœ¬ç¼–è¾‘æ¡†æ¶çš„è®¾è®¡å±€é™ï¼Œä¸ºç¬¬ä¸‰ç¯‡çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆåšå‡†å¤‡</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€åº”ç”¨è¿›ç¨‹å†…éƒ¨çš„æ–‡æœ¬ç¼–è¾‘æ¶æ„</h3>
<h4 data-id="heading-3">1.1 ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</h4>
<p>ä¸Šä¸€ç¯‡æˆ‘ä»¬ç†è§£äº†Binderå¦‚ä½•å°†è¾“å…¥æ³•çš„è°ƒç”¨ä¼ é€’åˆ°åº”ç”¨è¿›ç¨‹ã€‚ç°åœ¨èšç„¦åº”ç”¨è¿›ç¨‹å†…éƒ¨ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨è¿›ç¨‹å†…éƒ¨æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TextView / EditText                    â”‚
â”‚    â”œâ”€ Editable (SpannableStringBuilder)â”‚ â† æ–‡æœ¬ç¼“å†²åŒº
â”‚    â”‚    - char<span class="hljs-selector-attr">[]</span> mText                  â”‚
â”‚    â”‚    - <span class="hljs-selector-tag">Object</span><span class="hljs-selector-attr">[]</span> mSpans               â”‚
â”‚    â”‚                                    â”‚
â”‚    â”œâ”€ InputFilter<span class="hljs-selector-attr">[]</span>                    â”‚ â† è¿‡æ»¤å™¨é“¾
â”‚    â”‚    - DigitsKeyListener             â”‚
â”‚    â”‚    - LengthFilter                  â”‚
â”‚    â”‚                                    â”‚
â”‚    â””â”€ InputConnection                  â”‚ â† å¤–éƒ¨æ¥å£
â”‚         - BaseInputConnection           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ä¸Šä¸€ç¯‡å·²è®²</strong>ï¼šInputConnectionæ˜¯è·¨è¿›ç¨‹æ¥å£
<strong>æœ¬ç¯‡èšç„¦</strong>ï¼šEditableã€InputFilterã€Spanå¦‚ä½•ååŒå·¥ä½œ</p>
<h4 data-id="heading-4">1.2 Editableæ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Editable</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">CharSequence</span>, Spannable {
    <span class="hljs-comment">// æ ¸å¿ƒçš„ä¸‰ä¸ªæ“ä½œ</span>
    Editable <span class="hljs-title function_">insert</span><span class="hljs-params">(<span class="hljs-type">int</span> where, CharSequence text)</span>;
    Editable <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-type">int</span> st, <span class="hljs-type">int</span> en)</span>;
    Editable <span class="hljs-title function_">replace</span><span class="hljs-params">(<span class="hljs-type">int</span> st, <span class="hljs-type">int</span> en, CharSequence text)</span>;

    <span class="hljs-comment">// è¿‡æ»¤å™¨ç®¡ç†</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">setFilters</span><span class="hljs-params">(InputFilter[] filters)</span>;
    InputFilter[] getFilters();
}
</code></pre>
<p><strong>å®ç°ç±»</strong>ï¼šSpannableStringBuilder</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpannableStringBuilder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Editable</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-type">char</span>[] mText;           <span class="hljs-comment">// å­˜å‚¨å­—ç¬¦</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mGapStart;          <span class="hljs-comment">// Gap Bufferä¼˜åŒ–</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> mGapLength;

    <span class="hljs-keyword">private</span> Object[] mSpans;        <span class="hljs-comment">// å­˜å‚¨Spanå¯¹è±¡</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanStarts;      <span class="hljs-comment">// Spanèµ·å§‹ä½ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanEnds;        <span class="hljs-comment">// Spanç»“æŸä½ç½®</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] mSpanFlags;       <span class="hljs-comment">// Spanæ ‡å¿—</span>

    <span class="hljs-comment">// æ ¸å¿ƒå®ç°</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> SpannableStringBuilder <span class="hljs-title function_">replace</span><span class="hljs-params">(<span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                          CharSequence tb, <span class="hljs-type">int</span> tbstart, <span class="hljs-type">int</span> tbend)</span> {
        <span class="hljs-comment">// å…³é”®ï¼šè¿™é‡Œä¼šè°ƒç”¨InputFilteré“¾</span>
        InputFilter[] filters = getFilters();
        <span class="hljs-keyword">if</span> (filters != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; filters.length; i++) {
                <span class="hljs-type">CharSequence</span> <span class="hljs-variable">repl</span> <span class="hljs-operator">=</span> filters[i].filter(tb, tbstart, tbend,
                                                      <span class="hljs-built_in">this</span>, start, end);
                <span class="hljs-keyword">if</span> (repl != <span class="hljs-literal">null</span>) {
                    tb = repl;
                    tbstart = <span class="hljs-number">0</span>;
                    tbend = repl.length();
                }
            }
        }

        <span class="hljs-comment">// æ‰§è¡Œå®é™…çš„æ–‡æœ¬æ›¿æ¢</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li>insert/deleteæœ€ç»ˆéƒ½è°ƒç”¨replace()</li>
<li>replace()ä¼šè§¦å‘InputFilteré“¾</li>
<li>ä½†æœ‰ä¸ªä¾‹å¤–...</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€è®¾è®¡ç¼ºé™·çš„æ ¸å¿ƒï¼šä¸å¯¹ç§°çš„æ§åˆ¶æƒ</h3>
<h4 data-id="heading-6">2.1 InputFilterçš„æ¥å£è®¾è®¡</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">InputFilter</span> {
    <span class="hljs-comment">/**
     * <span class="hljs-doctag">@param</span> source è¦æ’å…¥çš„æ–°æ–‡æœ¬
     * <span class="hljs-doctag">@param</span> start  sourceçš„èµ·å§‹ä½ç½®
     * <span class="hljs-doctag">@param</span> end    sourceçš„ç»“æŸä½ç½®
     * <span class="hljs-doctag">@param</span> dest   ç›®æ ‡æ–‡æœ¬(å½“å‰EditTextå†…å®¹)
     * <span class="hljs-doctag">@param</span> dstart æ’å…¥ä½ç½®çš„èµ·å§‹
     * <span class="hljs-doctag">@param</span> dend   æ’å…¥ä½ç½®çš„ç»“æŸ
     * <span class="hljs-doctag">@return</span> null  = æ¥å—source
     *         ""    = æ‹’ç»source
     *         å…¶ä»–  = æ›¿æ¢ä¸ºè¿”å›çš„å†…å®¹
     */</span>
    CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                       Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span>;
}
</code></pre>
<p><strong>DigitsKeyListenerçš„å®ç°</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// NumberKeyListener.java (çˆ¶ç±»)</span>
<span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                           Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
    <span class="hljs-type">char</span>[] accept = getAcceptedChars(); <span class="hljs-comment">// ['0'-'9']</span>

    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
        <span class="hljs-keyword">if</span> (!ok(accept, source.charAt(i))) {
            <span class="hljs-comment">// å‘ç°éæ³•å­—ç¬¦ (å¦‚å­—æ¯ 'q')</span>
            <span class="hljs-keyword">if</span> (end - start == <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// å•ä¸ªå­—ç¬¦ï¼Œç›´æ¥æ‹’ç»</span>
            }
            <span class="hljs-comment">// å¤šä¸ªå­—ç¬¦ï¼Œè¿‡æ»¤æ‰éæ³•çš„</span>
            <span class="hljs-comment">// ...</span>
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// å…¨éƒ¨åˆæ³•ï¼Œæ¥å—</span>
}

<span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">ok</span><span class="hljs-params">(<span class="hljs-type">char</span>[] accept, <span class="hljs-type">char</span> c)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> accept.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
        <span class="hljs-keyword">if</span> (accept[i] == c) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}
</code></pre>
<h4 data-id="heading-7">2.2 delete()çš„ç‰¹æ®Šå®ç°</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// SpannableStringBuilder.java</span>
<span class="hljs-keyword">public</span> SpannableStringBuilder <span class="hljs-title function_">delete</span><span class="hljs-params">(<span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// å…³é”®ï¼šdeleteæœ¬è´¨æ˜¯replaceæ“ä½œï¼Œä¼ å…¥ç©ºå­—ç¬¦ä¸²""</span>
    <span class="hljs-keyword">return</span> replace(start, end, <span class="hljs-string">""</span>);
}

<span class="hljs-comment">// è°ƒç”¨é“¾</span>
delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
  â†“
replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
  â†“
filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)  â† InputFilterçœ‹åˆ°çš„æ˜¯ç©ºå­—ç¬¦ä¸²
  â†“
<span class="hljs-comment">// DigitsKeyListenerçš„æ£€æŸ¥</span>
<span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0</span>; i++) {  <span class="hljs-comment">// start=0, end=0ï¼Œå¾ªç¯ä¸æ‰§è¡Œ</span>
    <span class="hljs-comment">// æ£€æŸ¥å­—ç¬¦åˆæ³•æ€§</span>
}
  â†“
<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;  <span class="hljs-comment">// æ¥å—ï¼</span>
</code></pre>
<p><strong>é—®é¢˜æœ¬è´¨</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         InputFilterçš„è§†è§’                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  <span class="hljs-built_in">insert</span>(<span class="hljs-number">5</span>, "abc"):                             â”‚
â”‚    <span class="hljs-built_in">filter</span>(<span class="hljs-string">"abc"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>, dest, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>)            â”‚
â”‚    â†’ æ£€æŸ¥ <span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span> â†’ æ‹’ç» âœ“               â”‚
â”‚                                                 â”‚
â”‚  <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">8</span>):                                 â”‚
â”‚    <span class="hljs-built_in">filter</span>(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, dest, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>)               â”‚
â”‚    â†’ æ£€æŸ¥ç©ºå­—ç¬¦ä¸² â†’ æ¥å— âœ—                     â”‚
â”‚                                                 â”‚
â”‚  InputFilteræ— æ³•åŒºåˆ†ï¼š                          â”‚
â”‚  - æ’å…¥ç©ºå­—ç¬¦ä¸² (åº”æ¥å—)                        â”‚
â”‚  - åˆ é™¤æ“ä½œ (åº”è¯¥ä¹Ÿèƒ½æ‹¦æˆªå—?)                   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-8">2.3 è®¾è®¡å‡è®¾ vs å®é™…æƒ…å†µ</h4>



































<table><thead><tr><th>åœºæ™¯</th><th>è®¾è®¡å‡è®¾</th><th>å®é™…æƒ…å†µ</th><th>æ˜¯å¦åˆç†</th></tr></thead><tbody><tr><td><strong>ç”¨æˆ·æŒ‰åˆ é™¤é”®</strong></td><td>deleteåº”è¯¥æ— æ¡ä»¶æ‰§è¡Œ</td><td>deleteç»•è¿‡InputFilter</td><td>âœ“ åˆç†ï¼ˆå°Šé‡ç”¨æˆ·æ„å›¾ï¼‰</td></tr><tr><td><strong>InputFilteræ‹¦æˆªinsert</strong></td><td>æ‹¦æˆªéæ³•å­—ç¬¦æ’å…¥</td><td>åªèƒ½æ‹¦æˆªinsert</td><td>âœ“ ç¬¦åˆé¢„æœŸ</td></tr><tr><td><strong>ç»„åˆæ–‡æœ¬æ›¿æ¢</strong></td><td>æ›¿æ¢åº”è¯¥åŸå­æ‰§è¡Œ</td><td>deleteå…ˆäºinsertï¼Œåˆ†ç¦»æ‰§è¡Œ</td><td>âœ— ä¸åˆç†</td></tr><tr><td><strong>delete+insertç»„åˆ</strong></td><td>åº”è¯¥ä¿æŒä¸€è‡´æ€§</td><td>deleteç»•è¿‡ï¼Œinsertæ‹¦æˆª</td><td>âœ— ä¸å¯¹ç§°</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-9">ä¸‰ã€BaseInputConnectionçš„replaceText()å®ç°</h3>
<h4 data-id="heading-10">3.1 æ ¸å¿ƒä»£ç åˆ†æ</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BaseInputConnection.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition, <span class="hljs-type">boolean</span> composing)</span> {
    <span class="hljs-keyword">final</span> <span class="hljs-type">Editable</span> <span class="hljs-variable">content</span> <span class="hljs-operator">=</span> getEditable();
    <span class="hljs-keyword">if</span> (content == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">return</span>;
    }

    beginBatchEdit();

    <span class="hljs-comment">// ========== æ­¥éª¤1: è·å–æ—§çš„ç»„åˆæ–‡æœ¬èŒƒå›´ ==========</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getComposingSpanStart(content);
    <span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> getComposingSpanEnd(content);

    <span class="hljs-keyword">if</span> (b &lt; a) {
        <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> a;
        a = b;
        b = tmp;
    }

    <span class="hljs-keyword">if</span> (a != -<span class="hljs-number">1</span> &amp;&amp; b != -<span class="hljs-number">1</span>) {
        removeComposingSpans(content);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-comment">// å¦‚æœæ²¡æœ‰ç»„åˆèŒƒå›´ï¼Œä½¿ç”¨é€‰ä¸­èŒƒå›´</span>
        a = Selection.getSelectionStart(content);
        b = Selection.getSelectionEnd(content);
    }

    <span class="hljs-comment">// ========== æ­¥éª¤2: å…ˆåˆ é™¤æ—§èŒƒå›´ ==========</span>
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b);  <span class="hljs-comment">// â† å…³é”®: å…ˆåˆ é™¤ï¼Œä¸ç»è¿‡InputFilteréªŒè¯ï¼</span>
    }

    <span class="hljs-comment">// ========== æ­¥éª¤3: å†æ’å…¥æ–°æ–‡æœ¬ ==========</span>
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text);  <span class="hljs-comment">// â† ç»è¿‡InputFilterï¼Œå¯èƒ½è¢«æ‹’ç»</span>
    }

    <span class="hljs-comment">// ========== æ­¥éª¤4: è®¾ç½®æ–°çš„ç»„åˆèŒƒå›´ ==========</span>
    <span class="hljs-keyword">if</span> (composing) {
        setComposingSpans(content, a, a + text.length());
    }

    endBatchEdit();
}
</code></pre>
<h4 data-id="heading-11">3.2 Bugè§¦å‘çš„å®Œæ•´æµç¨‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å‰æï¼šEditTextå†…å®¹ "123456"ï¼Œå…‰æ ‡åœ¨æœ«å°¾</span>

<span class="hljs-comment">// ========== ç¬¬1æ¬¡ï¼šsetComposingText("q") ==========</span>
replaceText(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
æ­¥éª¤<span class="hljs-number">1</span>: è·å–ç»„åˆèŒƒå›´
  a = getComposingSpanStart() â†’ -<span class="hljs-number">1</span> (æ— æ—§èŒƒå›´)
  b = getComposingSpanEnd() â†’ -<span class="hljs-number">1</span>
  ä½¿ç”¨å…‰æ ‡ä½ç½®: a=<span class="hljs-number">6</span>, b=<span class="hljs-number">6</span>
  â†“
æ­¥éª¤<span class="hljs-number">2</span>: åˆ é™¤
  <span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> != <span class="hljs-number">6</span>) â†’ <span class="hljs-literal">false</span>ï¼Œä¸æ‰§è¡Œdelete
  â†“
æ­¥éª¤<span class="hljs-number">3</span>: æ’å…¥
  content.insert(<span class="hljs-number">6</span>, <span class="hljs-string">"q"</span>)
    â†’ filter(<span class="hljs-string">"q"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
    â†’ æ£€æŸ¥: <span class="hljs-string">'q'</span> ä¸æ˜¯æ•°å­—
    â†’ è¿”å› <span class="hljs-string">""</span> (æ‹’ç»)
    â†’ æ’å…¥å¤±è´¥
  â†“
æ­¥éª¤<span class="hljs-number">4</span>: è®¾ç½®ç»„åˆèŒƒå›´
  setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span> + <span class="hljs-number">0</span>) â†’ [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
  â†“
ç»“æœ: <span class="hljs-string">"123456"</span> (æœªå˜)

<span class="hljs-comment">// ========== ç¬¬2æ¬¡ï¼šsetComposingText("qq") ==========</span>
replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
æ­¥éª¤<span class="hljs-number">1</span>: è·å–ç»„åˆèŒƒå›´
  a = getComposingSpanStart() â†’ <span class="hljs-number">5</span> â† ä¸ºä»€ä¹ˆæ˜¯<span class="hljs-number">5</span>? (ç¨ååˆ†æ)
  b = getComposingSpanEnd() â†’ <span class="hljs-number">6</span>
  â†“
æ­¥éª¤<span class="hljs-number">2</span>: åˆ é™¤ â† Bugå¼€å§‹ï¼
  <span class="hljs-keyword">if</span> (<span class="hljs-number">6</span> != <span class="hljs-number">5</span>) â†’ <span class="hljs-literal">true</span>
  content.delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    â†’ replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
    â†’ filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
    â†’ å¾ªç¯ä¸æ‰§è¡Œ (start=<span class="hljs-number">0</span>, end=<span class="hljs-number">0</span>)
    â†’ è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
    â†’ åˆ é™¤æˆåŠŸï¼å­—ç¬¦<span class="hljs-string">'6'</span>è¢«åˆ é™¤
  content = <span class="hljs-string">"12345"</span>
  â†“
æ­¥éª¤<span class="hljs-number">3</span>: æ’å…¥
  content.insert(<span class="hljs-number">5</span>, <span class="hljs-string">"qq"</span>)
    â†’ filter(<span class="hljs-string">"qq"</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-string">"12345"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>)
    â†’ æ£€æŸ¥: <span class="hljs-string">'q'</span> ä¸æ˜¯æ•°å­—
    â†’ è¿”å› <span class="hljs-string">""</span> (æ‹’ç»)
    â†’ æ’å…¥å¤±è´¥
  â†“
æ­¥éª¤<span class="hljs-number">4</span>: è®¾ç½®ç»„åˆèŒƒå›´
  setComposingSpans(<span class="hljs-number">5</span>, <span class="hljs-number">5</span> + <span class="hljs-number">0</span>) â†’ [<span class="hljs-number">5</span>, <span class="hljs-number">5</span>)
  â†“
ç»“æœ: <span class="hljs-string">"12345"</span> âœ— (ä¸¢å¤±äº†<span class="hljs-string">'6'</span>)
</code></pre>
<h4 data-id="heading-12">3.3 ä¸ºä»€ä¹ˆå…ˆdeleteåinsertï¼Ÿ</h4>
<p><strong>è®¾è®¡æ„å›¾</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç»„åˆæ–‡æœ¬çš„æ›¿æ¢é€»è¾‘</span>
<span class="hljs-comment">// ä¾‹å¦‚ï¼šæ‹¼éŸ³è¾“å…¥ "zhongguo" â†’ å€™é€‰è¯ "ä¸­å›½"</span>

<span class="hljs-comment">// æ—§ç»„åˆæ–‡æœ¬: "zhongguo" (8ä¸ªå­—ç¬¦)</span>
<span class="hljs-comment">// æ–°ç»„åˆæ–‡æœ¬: "ä¸­å›½" (2ä¸ªå­—ç¬¦)</span>

<span class="hljs-comment">// å¦‚æœå…ˆinsertådeleteï¼š</span>
insert(<span class="hljs-string">"ä¸­å›½"</span>)    â†’ <span class="hljs-string">"123456zhongguoä¸­å›½"</span>
delete(<span class="hljs-number">6</span>, <span class="hljs-number">14</span>)    â†’ <span class="hljs-string">"123456ä¸­å›½"</span>

<span class="hljs-comment">// å¦‚æœå…ˆdeleteåinsertï¼š</span>
delete(<span class="hljs-number">6</span>, <span class="hljs-number">14</span>)    â†’ <span class="hljs-string">"123456"</span>
insert(<span class="hljs-string">"ä¸­å›½"</span>)   â†’ <span class="hljs-string">"123456ä¸­å›½"</span>

<span class="hljs-comment">// ä¸¤ç§æ–¹å¼ç»“æœç›¸åŒï¼Œä½†å…ˆdeleteåinsertæ›´é«˜æ•ˆ</span>
<span class="hljs-comment">// (é¿å…ä¸´æ—¶åˆ›å»ºè¿‡é•¿çš„å­—ç¬¦ä¸²)</span>
</code></pre>
<p><strong>é—®é¢˜</strong>ï¼š</p>
<ul>
<li>å‡è®¾äº†insertæ€»æ˜¯æˆåŠŸ</li>
<li>æ²¡æœ‰è€ƒè™‘InputFilteræ‹’ç»çš„æƒ…å†µ</li>
<li>æ²¡æœ‰å›æ»šæœºåˆ¶</li>
</ul>
<hr/>
<h3 data-id="heading-13">å››ã€Spanæœºåˆ¶å¯¼è‡´çš„èŒƒå›´å¼‚å¸¸æ‰©å±•</h3>
<h4 data-id="heading-14">4.1 COMPOSING Spançš„ä½œç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// BaseInputConnection.java</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">COMPOSING</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComposingText</span>();

<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ComposingText</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">NoCopySpan</span> {
    <span class="hljs-comment">// ç©ºå®ç°ï¼Œåªä½œä¸ºæ ‡è®°</span>
}

<span class="hljs-comment">// è·å–ç»„åˆæ–‡æœ¬èŒƒå›´</span>
<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getComposingSpanStart</span><span class="hljs-params">(Spannable text)</span> {
    <span class="hljs-keyword">return</span> text.getSpanStart(COMPOSING);
}

<span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getComposingSpanEnd</span><span class="hljs-params">(Spannable text)</span> {
    <span class="hljs-keyword">return</span> text.getSpanEnd(COMPOSING);
}

<span class="hljs-comment">// è®¾ç½®ç»„åˆæ–‡æœ¬èŒƒå›´</span>
<span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingSpans</span><span class="hljs-params">(Spannable text, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// ç§»é™¤æ—§çš„COMPOSING Span</span>
    removeComposingSpans(text);

    <span class="hljs-comment">// è®¾ç½®æ–°çš„COMPOSING Span</span>
    text.setSpan(COMPOSING, start, end,
                 Spanned.SPAN_EXCLUSIVE_EXCLUSIVE | Spanned.SPAN_COMPOSING);
}
</code></pre>
<h4 data-id="heading-15">4.2 SpanèŒƒå›´çš„åŠ¨æ€å˜åŒ–</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// åˆå§‹çŠ¶æ€</span>
<span class="hljs-type">SpannableStringBuilder</span> <span class="hljs-variable">text</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpannableStringBuilder</span>(<span class="hljs-string">"123456"</span>);
<span class="hljs-comment">// æ— COMPOSING Span</span>

<span class="hljs-comment">// ç¬¬1æ¬¡ setComposingText("q")</span>
setComposingSpans(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)  <span class="hljs-comment">// è®¾ç½®ç©ºèŒƒå›´Span</span>
<span class="hljs-comment">// text: "123456"</span>
<span class="hljs-comment">// Span: [6, 6) â† ç©ºèŒƒå›´ï¼Œä½†Spanå­˜åœ¨</span>

<span class="hljs-comment">// ç¬¬2æ¬¡ setComposingText("qq")</span>
<span class="hljs-comment">// 1. è·å–èŒƒå›´</span>
<span class="hljs-type">int</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> getComposingSpanStart() â†’ è¿”å› <span class="hljs-number">5</span> â† ä¸ºä»€ä¹ˆï¼Ÿ
<span class="hljs-type">int</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> getComposingSpanEnd() â†’ è¿”å› <span class="hljs-number">6</span>

<span class="hljs-comment">// 2. delete(5, 6)</span>
text.delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
<span class="hljs-comment">// text: "12345"</span>
<span class="hljs-comment">// Spanè¢«è‡ªåŠ¨è°ƒæ•´...</span>

<span class="hljs-comment">// 3. insert("qq") å¤±è´¥</span>

<span class="hljs-comment">// 4. setComposingSpans(5, 5)</span>
<span class="hljs-comment">// text: "12345"</span>
<span class="hljs-comment">// Span: [5, 5)</span>
</code></pre>
<h4 data-id="heading-16">4.3 ä¸ºä»€ä¹ˆSpanèŒƒå›´ä¼šä»[6,6)å˜æˆ[5,6)?</h4>
<p><strong>å…³é”®ä»£ç </strong>ï¼šsetComposingSpansçš„å®ç°</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setComposingSpans</span><span class="hljs-params">(Spannable text, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end)</span> {
    <span class="hljs-comment">// è·å–[start, end)èŒƒå›´å†…çš„æ‰€æœ‰Span</span>
    <span class="hljs-keyword">final</span> Object[] sps = text.getSpans(start, end, Object.class);
    <span class="hljs-keyword">if</span> (sps != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> sps.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-keyword">final</span> <span class="hljs-type">Object</span> <span class="hljs-variable">o</span> <span class="hljs-operator">=</span> sps[i];
            <span class="hljs-keyword">if</span> (o == COMPOSING) {
                text.removeSpan(o);
                <span class="hljs-keyword">continue</span>;
            }

            <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">fl</span> <span class="hljs-operator">=</span> text.getSpanFlags(o);
            <span class="hljs-comment">// å…³é”®ï¼šä¿®æ”¹å…¶ä»–Spançš„èŒƒå›´å’Œæ ‡å¿—</span>
            <span class="hljs-keyword">if</span> ((fl &amp; (Spanned.SPAN_COMPOSING | Spanned.SPAN_POINT_MARK_MASK))
                    != (Spanned.SPAN_COMPOSING | SPAN_EXCLUSIVE_EXCLUSIVE)) {
                text.setSpan(o, start, end,
                    (fl &amp; ~SPAN_POINT_MARK_MASK)
                    | SPAN_COMPOSING | SPAN_EXCLUSIVE_EXCLUSIVE);
            }
        }
    }

    <span class="hljs-comment">// è®¾ç½®æ–°çš„COMPOSING Span</span>
    text.setSpan(COMPOSING, start, end,
        SPAN_EXCLUSIVE_EXCLUSIVE | SPAN_COMPOSING);
}
</code></pre>
<p><strong>é—®é¢˜æ ¹æº</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ç¬¬<span class="hljs-number">1</span>æ¬¡ <span class="hljs-built_in">setComposingSpans</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span>):
  - è®¾ç½® COMPOSING Span [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)
  - texté•¿åº¦: <span class="hljs-number">6</span>
  - æœŸæœ›: Spanåœ¨æ–‡æœ¬æœ«å°¾

ç¬¬<span class="hljs-number">2</span>æ¬¡ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"q"</span>) å¤±è´¥:
  - texté•¿åº¦ä»æ˜¯<span class="hljs-number">6</span>
  - ä½† <span class="hljs-built_in">setComposingSpans</span>(<span class="hljs-number">6</span>, <span class="hljs-number">6</span> + <span class="hljs-string">"q"</span>.<span class="hljs-built_in">length</span>()) æœŸæœ›é•¿åº¦æ˜¯<span class="hljs-number">7</span>
  - SpanèŒƒå›´è®¡ç®—å‡ºç°åå·®

ç¬¬<span class="hljs-number">3</span>æ¬¡ <span class="hljs-built_in">getComposingSpanStart</span>():
  - SpannableStringBuilderå†…éƒ¨çš„Spanä½ç½®è®¡ç®—
  - ç”±äºtexté•¿åº¦ä¸é¢„æœŸä¸ç¬¦
  - è¿”å›äº†é”™è¯¯çš„èµ·å§‹ä½ç½® (<span class="hljs-number">5</span>è€Œä¸æ˜¯<span class="hljs-number">6</span>)

è¿é”ååº”:
  [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>) â†’ deleteä¸æ‰§è¡Œ â†’ [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>,<span class="hljs-number">6</span>) â†’ [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>) â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>) â†’ ...
  èŒƒå›´é€æ¸å‘å‰æ‰©å±•ï¼Œåå™¬æ›´å¤šå­—ç¬¦ï¼
</code></pre>
<h4 data-id="heading-17">4.4 SpanèŒƒå›´æ‰©å±•çš„å¯è§†åŒ–</h4>
<pre><code class="hljs language-sql" lang="sql">æ–‡æœ¬:     "123456"
ç´¢å¼•:      <span class="hljs-number">012345</span>

ç¬¬<span class="hljs-number">1</span>æ¬¡æ“ä½œå:
  text:  "123456"
  Span:  [<span class="hljs-number">6</span>, <span class="hljs-number">6</span>)  â† ç©ºèŒƒå›´ï¼Œåœ¨<span class="hljs-string">'6'</span>ä¹‹å

ç¬¬<span class="hljs-number">2</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â† å¼‚å¸¸ï¼ä¸ºä»€ä¹ˆå˜äº†ï¼Ÿ
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>): "12345" â† åˆ é™¤<span class="hljs-string">'6'</span>
  <span class="hljs-number">3.</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  <span class="hljs-number">4.</span> è®¾ç½®Span: [<span class="hljs-number">5</span>, <span class="hljs-number">5</span>) â† åœ¨<span class="hljs-string">'5'</span>ä¹‹å

ç¬¬<span class="hljs-number">3</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>) â† ç»§ç»­æ‰©å±•
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>): "123" â† åˆ é™¤<span class="hljs-string">'4'</span>å’Œ<span class="hljs-string">'5'</span>
  <span class="hljs-number">3.</span> <span class="hljs-keyword">insert</span>å¤±è´¥
  <span class="hljs-number">4.</span> è®¾ç½®Span: [<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)

ç¬¬<span class="hljs-number">4</span>æ¬¡æ“ä½œ:
  <span class="hljs-number">1.</span> è·å–èŒƒå›´: [<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)
  <span class="hljs-number">2.</span> <span class="hljs-keyword">delete</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>): "" â† åˆ é™¤å…¨éƒ¨
</code></pre>
<p><strong>åº•å±‚åŸå› </strong>ï¼šSpannableStringBuilderçš„Spanä½ç½®è®¡ç®—ä¾èµ–æ–‡æœ¬é•¿åº¦ï¼Œå½“å®é™…é•¿åº¦ä¸é¢„æœŸä¸ç¬¦æ—¶ï¼ŒSpançš„<code>start/end</code>ä¼šè¢«é”™è¯¯åœ°è°ƒæ•´ã€‚</p>
<hr/>
<h3 data-id="heading-18">äº”ã€è®¾è®¡ç¼ºé™·çš„å±‚æ¬¡åˆ†æ</h3>
<h4 data-id="heading-19">5.1 æ¥å£å±‚ï¼šfilter()æ— æ³•åŒºåˆ†æ“ä½œç±»å‹</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å½“å‰æ¥å£</span>
CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span>;
</code></pre>
<p><strong>ç¼ºé™·</strong>ï¼š</p>
<ul>
<li>åªçœ‹åˆ°<code>source</code>ï¼ˆè¦æ’å…¥çš„å†…å®¹ï¼‰</li>
<li>çœ‹ä¸åˆ°æ“ä½œç±»å‹ï¼ˆinsert? delete? replace?ï¼‰</li>
<li>çœ‹ä¸åˆ°æ“ä½œæ¥æºï¼ˆç”¨æˆ·? è¾“å…¥æ³•? ç³»ç»Ÿ?ï¼‰</li>
<li>æ— æ³•åŒºåˆ†"æ’å…¥ç©ºå­—ç¬¦ä¸²"å’Œ"åˆ é™¤æ“ä½œ"</li>
</ul>
<p><strong>ç†æƒ³æ¥å£</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperationType</span> { INSERT, DELETE, REPLACE }
<span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperationSource</span> { USER_KEY, IME, SYSTEM }

CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend,
                   OperationType type,     // æ“ä½œç±»å‹
                   OperationSource source)</span>; <span class="hljs-comment">// æ“ä½œæ¥æº</span>
</code></pre>
<h4 data-id="heading-20">5.2 å®ç°å±‚ï¼šreplaceText()ç¼ºä¹åŸå­æ€§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å½“å‰å®ç°ï¼ˆæœ‰ç¼ºé™·ï¼‰</span>
<span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, ...)</span> {
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b); <span class="hljs-comment">// å¯èƒ½åˆ é™¤åˆæ³•å†…å®¹</span>
    }
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text); <span class="hljs-comment">// å¯èƒ½è¢«è¿‡æ»¤</span>
    }
    <span class="hljs-comment">// æ²¡æœ‰å›æ»šæœºåˆ¶ï¼</span>
}
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘1</strong>ï¼šå…ˆéªŒè¯</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">replaceText</span><span class="hljs-params">(CharSequence text, ...)</span> {
    <span class="hljs-comment">// å…ˆæ£€æŸ¥æ–°æ–‡æœ¬æ˜¯å¦åˆæ³•</span>
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        <span class="hljs-type">CharSequence</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> applyFilters(text, a, a);
        <span class="hljs-keyword">if</span> (filtered.length() == <span class="hljs-number">0</span> &amp;&amp; text.length() &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-comment">// æ–°æ–‡æœ¬è¢«å®Œå…¨è¿‡æ»¤ï¼Œæ”¾å¼ƒæ›¿æ¢</span>
            <span class="hljs-keyword">return</span>;
        }
        text = filtered; <span class="hljs-comment">// ä½¿ç”¨è¿‡æ»¤åçš„å†…å®¹</span>
    }

    <span class="hljs-comment">// å†æ‰§è¡Œæ›¿æ¢</span>
    <span class="hljs-keyword">if</span> (b != a) {
        content.delete(a, b);
    }
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
        content.insert(a, text);
    }
}
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘2</strong>ï¼šä½¿ç”¨åŸå­replace</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ä¸è¦åˆ†å¼€deleteå’Œinsertï¼Œä½¿ç”¨Editable.replace()</span>
content.replace(a, b, text);
<span class="hljs-comment">// replace()å†…éƒ¨ä¸€æ¬¡æ€§è°ƒç”¨filter</span>
<span class="hljs-comment">// filterå¯ä»¥åŒæ—¶çœ‹åˆ°åˆ é™¤èŒƒå›´[a,b)å’Œæ’å…¥å†…å®¹text</span>
</code></pre>
<h4 data-id="heading-21">5.3 åè®®å±‚ï¼šSpanèŒƒå›´ä¸å¯é </h4>
<p><strong>å½“å‰æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-built_in">setComposingSpans</span>(start, end)
  â†’ å‡è®¾æ–‡æœ¬é•¿åº¦ä¼šå˜ä¸ºstart + text<span class="hljs-selector-class">.length</span>()
  â†’ å®é™…: insertå¤±è´¥ï¼Œé•¿åº¦ä¸å˜
  â†’ SpanèŒƒå›´ä¸å®é™…ä¸ç¬¦
  â†’ ä¸‹æ¬¡getComposingSpanStart/<span class="hljs-built_in">End</span>()è¿”å›é”™è¯¯å€¼
</code></pre>
<p><strong>æ”¹è¿›æ–¹å‘</strong>ï¼šå¼•å…¥ç‰ˆæœ¬å·</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComposingState</span> {
    <span class="hljs-type">int</span> start;
    <span class="hljs-type">int</span> end;
    <span class="hljs-type">int</span> textVersion; <span class="hljs-comment">// æ–‡æœ¬ç‰ˆæœ¬å·</span>

    <span class="hljs-comment">// æ¯æ¬¡æ–‡æœ¬æ“ä½œå¢åŠ ç‰ˆæœ¬å·</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">increment</span><span class="hljs-params">()</span> {
        textVersion++;
    }

    <span class="hljs-comment">// éªŒè¯SpanèŒƒå›´æ˜¯å¦ä»æœ‰æ•ˆ</span>
    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValid</span><span class="hljs-params">(<span class="hljs-type">int</span> currentVersion)</span> {
        <span class="hljs-keyword">return</span> textVersion == currentVersion;
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-22">å…­ã€å¯¹æ¯”ï¼šæ­£å¸¸åœºæ™¯ vs Bugåœºæ™¯</h3>
<h4 data-id="heading-23">6.1 æ­£å¸¸åœºæ™¯ï¼šç”¨æˆ·ä¸»åŠ¨åˆ é™¤</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç”¨æˆ·æŒ‰åˆ é™¤é”®</span>
onKeyDown(KeyEvent.KEYCODE_DEL)
  â†“
BaseInputConnection.deleteSurroundingText(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>)
  â†“
Editable.delete(cursorPos - <span class="hljs-number">1</span>, cursorPos)
  â†“
replace(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)
  â†“
filter(<span class="hljs-string">""</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"123456"</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>)
  â†“
è¿”å› <span class="hljs-literal">null</span> (æ¥å—)
  â†“
åˆ é™¤æˆåŠŸ âœ“
</code></pre>
<p><strong>è¿™ç§æƒ…å†µä¸‹ï¼Œdeleteåº”è¯¥è¢«å…è®¸</strong>ï¼ˆç”¨æˆ·ä¸»åŠ¨æ“ä½œï¼‰ã€‚</p>
<h4 data-id="heading-24">6.2 Bugåœºæ™¯ï¼šè¾“å…¥æ³•è‡ªåŠ¨æ›¿æ¢</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// è¾“å…¥æ³•è°ƒç”¨ setComposingText("qq", 1)</span>
BaseInputConnection.setComposingText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“
replaceText(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  â†“
delete(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) + insert(<span class="hljs-string">"qq"</span>)
  â†“
deleteæˆåŠŸ + insertå¤±è´¥
  â†“
æ•°æ®ä¸¢å¤± âœ—
</code></pre>
<p><strong>è¿™ç§æƒ…å†µä¸‹ï¼Œdeleteæ˜¯"æ›¿æ¢çš„ä¸€éƒ¨åˆ†"ï¼Œåº”è¯¥ä¸insertä¿æŒä¸€è‡´</strong>ã€‚</p>
<h4 data-id="heading-25">6.3 æ ¸å¿ƒå·®å¼‚</h4>






























<table><thead><tr><th>ç»´åº¦</th><th>ç”¨æˆ·åˆ é™¤</th><th>è¾“å…¥æ³•æ›¿æ¢</th></tr></thead><tbody><tr><td><strong>æ“ä½œæ„å›¾</strong></td><td>åˆ é™¤å†…å®¹</td><td>æ›¿æ¢å†…å®¹ï¼ˆdelete+insertï¼‰</td></tr><tr><td><strong>åŸå­æ€§</strong></td><td>å•ä¸ªæ“ä½œ</td><td>ç»„åˆæ“ä½œ</td></tr><tr><td><strong>æ˜¯å¦åº”æ‹¦æˆª</strong></td><td>å¦ï¼ˆå°Šé‡ç”¨æˆ·ï¼‰</td><td>æ˜¯ï¼ˆä¿æŒä¸€è‡´æ€§ï¼‰</td></tr><tr><td><strong>å®é™…è¡Œä¸º</strong></td><td>deleteé€šè¿‡ âœ“</td><td>deleteé€šè¿‡ï¼Œinsertè¢«æ‹’ âœ—</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-26">ä¸ƒã€æ€»ç»“ï¼šè®¾è®¡çš„ä¸å¯¹ç§°æ€§</h3>
<h4 data-id="heading-27">7.1 æ ¸å¿ƒçŸ›ç›¾</h4>
<pre><code class="hljs language-sql" lang="sql">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ–‡æœ¬ç¼–è¾‘æ¡†æ¶çš„ä¸å¯¹ç§°æ€§                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  InputFilter çš„æœŸæœ›:                            â”‚
â”‚    æ§åˆ¶æ‰€æœ‰æ–‡æœ¬æ“ä½œ                              â”‚
â”‚                                                 â”‚
â”‚  Editable çš„å®ç°:                               â”‚
â”‚    <span class="hljs-keyword">insert</span>() â†’ ç»è¿‡<span class="hljs-keyword">filter</span> âœ“                     â”‚
â”‚    <span class="hljs-keyword">delete</span>() â†’ ç»•è¿‡<span class="hljs-keyword">filter</span> âœ—                     â”‚
â”‚                                                 â”‚
â”‚  replaceText() çš„å‡è®¾:                          â”‚
â”‚    <span class="hljs-keyword">delete</span>() æ€»æ˜¯æˆåŠŸ                            â”‚
â”‚    <span class="hljs-keyword">insert</span>() ä¹Ÿæ€»æ˜¯æˆåŠŸ                          â”‚
â”‚                                                 â”‚
â”‚  å®é™…åœºæ™¯:                                       â”‚
â”‚    <span class="hljs-keyword">delete</span>() æˆåŠŸ                                â”‚
â”‚    <span class="hljs-keyword">insert</span>() è¢«InputFilteræ‹’ç»                  â”‚
â”‚    â†’ æ•°æ®ä¸¢å¤±                                   â”‚
â”‚                                                 â”‚
â”‚  Span çš„å‰¯ä½œç”¨:                                 â”‚
â”‚    èŒƒå›´è®¡ç®—ä¾èµ–æ–‡æœ¬é•¿åº¦                          â”‚
â”‚    <span class="hljs-keyword">insert</span>å¤±è´¥å¯¼è‡´é•¿åº¦ä¸ç¬¦                        â”‚
â”‚    â†’ èŒƒå›´å¼‚å¸¸æ‰©å±•                               â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-28">7.2 å¾ªåºæ¸è¿›çš„çŸ¥è¯†é“¾</h4>
<p><strong>ç¬¬ä¸€ç¯‡</strong>ï¼šBinderé€šä¿¡æœºåˆ¶</p>
<ul>
<li>âœ“ ç†è§£äº†è¾“å…¥æ³•â†’åº”ç”¨çš„è·¨è¿›ç¨‹è°ƒç”¨</li>
<li>âœ“ ç†è§£äº†å¼‚æ­¥æ‰§è¡Œå¯¼è‡´çš„ä¿¡æ¯ä¸å¯¹ç§°</li>
<li>â†’ setComposingText("qq")è¢«ä¼ é€’åˆ°åº”ç”¨è¿›ç¨‹</li>
</ul>
<p><strong>ç¬¬äºŒç¯‡ï¼ˆæœ¬æ–‡ï¼‰</strong>ï¼šæ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·</p>
<ul>
<li>âœ“ ç†è§£äº†replaceText()çš„å…ˆdeleteåinsert</li>
<li>âœ“ ç†è§£äº†deleteç»•è¿‡InputFilterçš„æœºåˆ¶</li>
<li>âœ“ ç†è§£äº†SpanèŒƒå›´å¼‚å¸¸æ‰©å±•çš„åŸå› </li>
<li>â†’ ç†è§£äº†ä¸ºä»€ä¹ˆæ•°å­—ä¼šè¢«åˆ é™¤</li>
</ul>
<p><strong>ç¬¬ä¸‰ç¯‡é¢„å‘Š</strong>ï¼šå·¥ç¨‹è§£å†³æ–¹æ¡ˆ</p>
<ul>
<li>å¦‚ä½•åœ¨InputConnectionå±‚æ‹¦æˆªéæ³•ç»„åˆæ–‡æœ¬ï¼Ÿ</li>
<li>å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼ˆä¿ç•™æ•°å­—é”®ç›˜ï¼‰</li>
<li>ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ä¸æœ€ä½³å®è·µ</li>
<li>â†’ ä»ç†è®ºåˆ°å®è·µ</li>
</ul>
<hr/>
<h3 data-id="heading-29">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/text/SpannableStringBuilder.java</code></li>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/BaseInputConnection.java</code></li>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/text/method/DigitsKeyListener.java</code></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Ftext%2FInputFilter" target="_blank" title="https://developer.android.com/reference/android/text/InputFilter" ref="nofollow noopener noreferrer">InputFilter</a></li>
</ol>
<hr/>
<p><strong>ä¸‹ä¸€ç¯‡</strong>ï¼šã€ŠInputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µã€‹- å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæ—¢ä¿ç•™æ•°å­—é”®ç›˜ï¼Œåˆé¿å…æ•°æ®ä¸¢å¤±</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä½ çŸ¥é“npm create vite æ€ä¹ˆè¿ä½œçš„å—ï¼Ÿå’Œæˆ‘ä¸€èµ·æ¥å†™ä¸€ä¸ªcli]]></title>    <link>https://juejin.cn/post/7570908785293557779</link>    <guid>https://juejin.cn/post/7570908785293557779</guid>    <pubDate>2025-11-10T13:23:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570908785293557779" data-draft-id="7569798982942228516" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä½ çŸ¥é“npm create vite æ€ä¹ˆè¿ä½œçš„å—ï¼Ÿå’Œæˆ‘ä¸€èµ·æ¥å†™ä¸€ä¸ªcli"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T13:23:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¥ˆå¾·ä¸½"/> <meta itemprop="url" content="https://juejin.cn/user/620537392934711"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä½ çŸ¥é“npm create vite æ€ä¹ˆè¿ä½œçš„å—ï¼Ÿå’Œæˆ‘ä¸€èµ·æ¥å†™ä¸€ä¸ªcli
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/620537392934711/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¥ˆå¾·ä¸½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:23:05.000Z" title="Mon Nov 10 2025 13:23:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    21
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»9åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{color:#595959;font-size:15px;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(1turn,rgba(60,10,30,.04) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body p{color:#595959;font-size:15px;line-height:2;font-weight:400}.markdown-body p+p{margin-top:16px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin:0;color:#135ce0}.markdown-body h1{position:relative;text-align:center;font-size:22px;margin:50px 0}.markdown-body h1:before{position:absolute;content:"";top:-10px;left:50%;width:32px;height:32px;transform:translateX(-50%);background-size:100% 100%;opacity:.36;background-repeat:no-repeat;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABfVBMVEX///8Ad/8AgP8AgP8AgP8Aff8AgP8Af/8AgP8AVf8Af/8Af/8AgP8AgP8Af/8Afv8AAP8Afv8Afv8Aef8AgP8AdP8Afv8AgP8AgP8Acf8Ae/8AgP8Af/8AgP8Af/8Af/8AfP8Afv8AgP8Af/8Af/8Afv8Afv8AgP8Afv8AgP8Af/8Af/8AgP8AgP8Afv8AgP8Af/8AgP8AgP8AgP8Ae/8Afv8Af/8AgP8Af/8AgP8Af/8Af/8Aff8Af/8Abf8AgP8Af/8AgP8Af/8Af/8Afv8AgP8AgP8Afv8Afv8AgP8Af/8Aff8AgP8Afv8AgP8Aff8AgP8AfP8AgP8Ae/8AgP8Af/8AgP8AgP8AgP8Afv8AgP8AgP8AgP8Afv8AgP8AgP8AgP8AgP8AgP8Af/8AgP8Af/8Af/8Aev8Af/8AgP8Aff8Afv8AgP8AgP8AgP8Af/8AgP8Af/8Af/8AgP8Afv8AgP8AgP8AgP8AgP8Af/8AeP8Af/8Af/8Af//////rzEHnAAAAfXRSTlMAD7CCAivatxIDx5EMrP19AXdLEwgLR+6iCR/M0yLRzyFF7JupSXn8cw6v60Q0QeqzKtgeG237HMne850/6Qeq7QaZ+WdydHtj+OM3qENCMRYl1B3K2U7wnlWE/mhlirjkODa9FN/BF7/iNV/2kASNZpX1Wlf03C4stRGxgUPclqoAAAABYktHRACIBR1IAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gEaBzgZ4yeM3AAAAT9JREFUOMvNUldbwkAQvCAqsSBoABE7asSOBRUVVBQNNuy9996789+9cMFAMHnVebmdm+/bmdtbQv4dOFOW2UjPzgFyLfo6nweKfIMOBYWwFtmMPGz2Yj2pJI0JDq3udJW6VVbmKa9I192VQFV1ktXUAl5NB0cd4KpnORqsEO2ZIRpF9gJfE9Dckqq0KuZt7UAH5+8EPF3spjsRpCeQNO/tA/qDwIDA+OCQbBoKA8NOdjMySgcZGVM6jwcgRuUiSs0nlPFNSrEpJfU0jTLD6llqbvKxei7OzvkFNQohi0vAsj81+MoqsCaoPOQFgus/1LyxichW+hS2JWCHZ7VlF9jb187pIAYcHiViHAMnp5mTjJ8B5xeEXF4B1ze/fTh/C0h398DDI9HB07O8ci+vRBdvdGnfP4gBuM8vw7X/G3wDmFhFZEdxzjMAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTgtMDEtMjZUMDc6NTY6MjUrMDE6MDA67pVWAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE4LTAxLTI2VDA3OjU2OjI1KzAxOjAwS7Mt6gAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAAWdEVYdFRpdGxlAGp1ZWppbl9sb2dvIGNvcHlxapmKAAAAV3pUWHRSYXcgcHJvZmlsZSB0eXBlIGlwdGMAAHic4/IMCHFWKCjKT8vMSeVSAAMjCy5jCxMjE0uTFAMTIESANMNkAyOzVCDL2NTIxMzEHMQHy4BIoEouAOoXEXTyQjWVAAAAAElFTkSuQmCC)}.markdown-body h2{position:relative;font-size:20px;border-left:4px solid;padding:0 0 0 10px;margin:30px 0}.markdown-body h3{font-size:16px}.markdown-body ul{list-style:disc outside;margin-left:2em;margin-top:1em}.markdown-body li{line-height:2;color:#595959}.markdown-body img.loaded{margin:0 auto;display:block}.markdown-body blockquote{background:#fff9f9;margin:2em 0;padding:2px 20px;border-left:4px solid #b2aec5}.markdown-body blockquote p{color:#666;line-height:2}.markdown-body a{color:#036aca;border-bottom:1px solid rgba(3,106,202,.8);font-weight:400;text-decoration:none}.markdown-body em strong,.markdown-body strong{color:#036aca}.markdown-body hr{border-top:1px solid #135ce0}.markdown-body pre{overflow:auto}.markdown-body code,.markdown-body pre{overflow:auto;position:relative;line-height:1.75;font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body table{border-collapse:collapse;margin:1rem 0;overflow-x:auto}.markdown-body table td,.markdown-body table th{border:1px solid #dfe2e5;padding:.6em 1em}.markdown-body table tr{border-top:1px solid #dfe2e5}.markdown-body table tr:nth-child(2n){background-color:#f6f8fa}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å¥ˆå¾·ä¸½ã€‚</p>
<p>å‘¨æœ«é—²ç€æ²¡äº‹ï¼Œçªç„¶æƒ³ç ”ç©¶ä¸€ä¸‹ <code>create-vite</code> æ˜¯æ€ä¹ˆå®ç°çš„ã€‚æ‰“å¼€æºç ä¸€çœ‹ï¼Œæˆ‘äººéƒ½å‚»äº†â€”â€”æ ¸å¿ƒé€»è¾‘å°±å‡ ç™¾è¡Œä»£ç ï¼è¿™è®©æˆ‘çªç„¶æ¥äº†å…´è‡´ï¼šæ—¢ç„¶è¿™ä¹ˆç®€å•ï¼Œä¸ºä»€ä¹ˆä¸è‡ªå·±æ’¸ä¸€ä¸ªå‘¢ï¼Ÿ</p>
<p>äºæ˜¯æˆ‘èŠ±äº†ä¸€ä¸ªå‘¨æœ«çš„æ—¶é—´ï¼Œä»é›¶å¼€å§‹å®ç°äº†ä¸€ä¸ªç®€åŒ–ç‰ˆçš„è„šæ‰‹æ¶å·¥å…· <code>custom-create-vite</code>ã€‚è™½ç„¶åŠŸèƒ½æ²¡æœ‰å®˜æ–¹çš„å…¨é¢ï¼Œä½†è¯¥æœ‰çš„éƒ½æœ‰ï¼Œè€Œä¸”è¿˜åŠ äº†ä¸€äº›è‡ªå·±è§‰å¾—å¥½ç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚eslintã€tailwindç­‰ã€‚</p>
<p>ä»Šå¤©å°±æ¥å’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹æ•´ä¸ªå®ç°è¿‡ç¨‹ï¼Œä»¥åŠæˆ‘è¸©è¿‡çš„é‚£äº›å‘ï¼Œå¦‚æœä½ ä¹Ÿæƒ³æœ‰ä¸€ä¸ªè‡ªå·±çš„cliå·¥å…·ï¼Œä¸å¦¨èŠ±å‡ åˆ†é’Ÿçœ‹ä¸€çœ‹ã€‚</p>
<h2 data-id="heading-1">ä¸ºä»€ä¹ˆè¦é€ è¿™ä¸ªè½®å­ï¼Ÿ</h2>
<p>å¯èƒ½æœ‰äººä¼šé—®ï¼šå®˜æ–¹çš„ <code>create-vite</code> ä¸æ˜¯æŒºå¥½ç”¨çš„å—ï¼Ÿå¹²å˜›è¦è‡ªå·±å†™ï¼Ÿ</p>
<p>è¯´å®è¯ï¼Œæˆ‘ä¸»è¦æ˜¯å‡ºäºè¿™å‡ ä¸ªåŸå› ï¼š</p>
<p><strong>1. å­¦ä¹ ç›®çš„</strong></p>
<p>å­¦ä¹ å½“ç„¶æ˜¯ä¸ºäº†è§£å†³è‡ªå·±çš„ç–‘æƒ‘ï¼Œä»¥å‰é€šè¿‡<code>npm create vite</code>ï¼Œä¸çŸ¥é“å®é™…ä¸Šæ˜¯æ€ä¹ˆè¿è¡Œçš„ï¼Œä¹‹å‰ä¸€ç›´ä»¥ä¸ºæˆ‘æ‰§è¡Œäº†è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œvite cliæ˜¯æ ¹æ®ç”¨æˆ·é€‰æ‹©å®æ—¶åŠ¨æ€ç”Ÿæˆå†…å®¹ï¼Œç®€å•ç‚¹è¯´ï¼Œå°±æ˜¯å½“ä½ åœ¨Vueã€Reactç­‰ä¼—å¤šæ¡†æ¶ä¸­é€‰æ‹©Vueæ—¶ï¼Œcliæ˜¯åŠ¨æ€ç”Ÿæˆäº†vueæ¨¡æ¿ï¼Œå…¶å®ä¸æ˜¯è¿™æ ·ï¼Œå®ƒæ˜¯æå‰åˆ›å»ºäº†å¾ˆå¤šä¸ªtemplateï¼Œæ¯”å¦‚jså’Œtså°±å¯¹åº”äº†ä¸åŒæ¨¡æ¿ï¼Œè€ŒReactå’ŒVueä¹Ÿæ˜¯ï¼Œä»–ä¿©ç»„åˆå°±æœ‰4ä¸ªæ¨¡æ¿ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c3b5488ad30d46b3a23de17eb09f1bb9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=b%2B9krr%2F0kckRX55KtXlXkQSwIMI%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/892a06b59f9c43f297f797bd930445bf~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=rfCnateS2kLJx2rpmoyxmdX%2F7xc%3D" alt="image.png" loading="lazy"/></p>
<p><strong>2. å›¢é˜Ÿå®šåˆ¶éœ€æ±‚</strong></p>
<p>æˆ‘ä»¬å›¢é˜Ÿæœ‰ä¸€äº›å›ºå®šçš„å¼€å‘è§„èŒƒï¼Œæ¯”å¦‚ç»Ÿä¸€ç”¨ Antfu çš„ ESLint é…ç½®ã€Tailwind CSS v4 ç­‰ç­‰ã€‚æ¯æ¬¡åˆ›å»ºæ–°é¡¹ç›®éƒ½è¦æ‰‹åŠ¨é…ç½®è¿™äº›ä¸œè¥¿ï¼Œè´¼çƒ¦ã€‚å¦‚æœèƒ½åœ¨è„šæ‰‹æ¶é‡Œé¢„ç½®è¿™äº›é€‰é¡¹ï¼Œé‚£å°±çˆ½æ­ªæ­ªäº†ã€‚</p>
<p><strong>3. æ’ä»¶åŒ–æ‰©å±•</strong></p>
<p>æˆ‘æƒ³å®ç°ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿï¼Œè®©ç”¨æˆ·åœ¨åˆ›å»ºé¡¹ç›®çš„æ—¶å€™å°±èƒ½é€‰æ‹©è¦ä¸è¦è£… ESLintã€Tailwind CSSã€UnoCSS è¿™äº›å·¥å…·ã€‚è¿™æ ·æ–°é¡¹ç›®å¼€ç®±å³ç”¨ï¼Œä¸ç”¨å†æ‰‹åŠ¨é…ç½®ã€‚</p>
<p>åŸºäºè¿™äº›æƒ³æ³•ï¼Œæˆ‘å¼€å§‹åŠ¨æ‰‹äº†ã€‚</p>
<h2 data-id="heading-2">æŠ€æœ¯é€‰å‹</h2>
<p>æ—¢ç„¶æ˜¯ 2025 å¹´äº†ï¼Œé‚£å¿…é¡»å¾—ç”¨ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆï¼š</p>
<ul>
<li><strong>prompts</strong>ï¼šäº¤äº’å¼å‘½ä»¤è¡Œå·¥å…·ï¼ŒAPI ç®€å•ï¼Œä½“ç§¯å°</li>
<li><strong>picocolors</strong>ï¼šç»™ç»ˆç«¯è¾“å‡ºåŠ ç‚¹é¢œè‰²ï¼Œæå‡ç”¨æˆ·ä½“éªŒ</li>
</ul>
<p>æ²¡é”™ï¼Œæ•´ä¸ªé¡¹ç›®åªä¾èµ–è¿™ä¸¤ä¸ªåŒ…ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"prompts"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^2.4.2"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"picocolors"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^1.1.1"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-3">é¡¹ç›®ç»“æ„è®¾è®¡</h2>
<p>åœ¨åŠ¨æ‰‹å†™ä»£ç ä¹‹å‰ï¼Œæˆ‘å…ˆè§„åˆ’äº†ä¸€ä¸‹é¡¹ç›®ä¸»è¦ç»“æ„ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mini-vite/
â”œâ”€â”€ index.js                    <span class="hljs-comment"># ä¸»å…¥å£æ–‡ä»¶</span>
â”œâ”€â”€ plugins/                    <span class="hljs-comment"># æ’ä»¶ç³»ç»Ÿ</span>
â”‚   â”œâ”€â”€ index.js               <span class="hljs-comment"># æ’ä»¶ç®¡ç†å™¨</span>
â”‚   â”œâ”€â”€ eslint.js              <span class="hljs-comment"># ESLint æ’ä»¶</span>
â”‚   â”œâ”€â”€ tailwind.js            <span class="hljs-comment"># Tailwind CSS æ’ä»¶</span>
â”‚   â””â”€â”€ unocss.js              <span class="hljs-comment"># UnoCSS æ’ä»¶</span>
â”œâ”€â”€ template-vue/              <span class="hljs-comment"># Vue JavaScript æ¨¡æ¿</span>
â”œâ”€â”€ template-vue-ts/           <span class="hljs-comment"># Vue TypeScript æ¨¡æ¿</span>
â”œâ”€â”€ template-react/            <span class="hljs-comment"># React JavaScript æ¨¡æ¿</span>
â”œâ”€â”€ template-react-ts/         <span class="hljs-comment"># React TypeScript æ¨¡æ¿</span>
â””â”€â”€ package.json
</code></pre>
<p>ç»“æ„å¾ˆæ¸…æ™°ï¼š</p>
<ul>
<li>ä¸»é€»è¾‘æ”¾åœ¨ <code>index.js</code></li>
<li>æ’ä»¶ç³»ç»Ÿç‹¬ç«‹æˆ <code>plugins</code> ç›®å½•ï¼Œæ–¹ä¾¿æ‰©å±•</li>
<li>æ¯ä¸ªæ¨¡æ¿éƒ½æ˜¯ç‹¬ç«‹çš„ç›®å½•ï¼ŒåŒ…å«å®Œæ•´çš„é¡¹ç›®æ–‡ä»¶</li>
</ul>
<p>é™¤äº†ä¸»è¦ç›®å½•ï¼Œæˆ‘è¿˜æ­å»ºäº†å·¥ä½œæµï¼Œä»¥åŠgithub åŸç”Ÿdependabotï¼Œå¦‚æœæœ‰å°ä¼™ä¼´æ„Ÿå…´è¶£çš„è¯ï¼ŒåæœŸå¯ä»¥å†™ä¸€ç¯‡æ–‡ç« ä¸“é—¨è®²ä¸€è®²å¦‚ä½•é…ç½®ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/373a8ee2d0794daea52d5f85c3c6591c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=4r4KzwW503x2myF5tiqinM0Q68g%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">æ ¸å¿ƒæµç¨‹å®ç°</h2>
<p>ä¸‹é¢è®²è®²å…·ä½“çš„å®ç°ç»†èŠ‚ã€‚æ•´ä¸ªæµç¨‹å¯ä»¥åˆ†ä¸º 7 ä¸ªæ­¥éª¤ï¼š</p>
<h3 data-id="heading-5">ç¬¬ä¸€æ­¥ï¼šé…ç½®å‘½ä»¤è¡Œå…¥å£</h3>
<p>é¦–å…ˆåœ¨ <code>package.json</code> é‡Œå£°æ˜ bin å­—æ®µï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"mini-vite"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"bin"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"mini-vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"create-mini-vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"index.js"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ol>
<li><strong>type å¿…é¡»è®¾ç½®ä¸º module</strong>ï¼Œè¿™æ ·æ‰èƒ½ç”¨ ES Module è¯­æ³•</li>
<li>æˆ‘é…ç½®äº†ä¸¤ä¸ªå‘½ä»¤åï¼Œç”¨æˆ·å¯ä»¥ç”¨ <code>mini-vite</code> æˆ– <code>create-mini-vite</code>ï¼Œæ€ä¹ˆé¡ºæ‰‹æ€ä¹ˆæ¥</li>
</ol>
<p>ç„¶ååœ¨ <code>index.js</code> å¼€å¤´åŠ ä¸Š shebangï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-meta">#!/usr/bin/env node</span>
</code></pre>
<p>è¿™ä¸€è¡Œå‘Šè¯‰ç³»ç»Ÿç”¨ Node.js æ¥æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶ã€‚æ²¡æœ‰è¿™ä¸€è¡Œï¼Œç›´æ¥è¿è¡Œä¼šæŠ¥é”™ã€‚</p>
<h3 data-id="heading-6">ç¬¬äºŒæ­¥ï¼šè¯¢é—®é¡¹ç›®åç§°</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> prompts <span class="hljs-keyword">from</span> <span class="hljs-string">'prompts'</span>
<span class="hljs-keyword">import</span> colors <span class="hljs-keyword">from</span> <span class="hljs-string">'picocolors'</span>

<span class="hljs-keyword">const</span> { cyan, green, yellow, red, reset } = colors

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"/>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n<span class="hljs-subst">${cyan(<span class="hljs-string">'Mini Vite'</span>)}</span> - A minimal scaffolding tool\n`</span>)

  <span class="hljs-keyword">let</span> targetDir = <span class="hljs-string">'mini-vite-project'</span>

  <span class="hljs-keyword">const</span> result = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'projectName'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Project name:'</span>),
    <span class="hljs-attr">initial</span>: targetDir,
    <span class="hljs-attr">onState</span>: <span class="hljs-function">(<span class="hljs-params">state</span>) =&gt;</span> {
      targetDir = state.<span class="hljs-property">value</span>?.<span class="hljs-title function_">trim</span>() || targetDir
    }
  })

  <span class="hljs-keyword">if</span> (!result.<span class="hljs-property">projectName</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-title function_">red</span>(<span class="hljs-string">'âœ–'</span>) + <span class="hljs-string">' Operation cancelled'</span>)
    <span class="hljs-keyword">return</span>
  }
}

<span class="hljs-title function_">init</span>().<span class="hljs-keyword">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-title function_">red</span>(<span class="hljs-string">'Error:'</span>), e)
  process.<span class="hljs-title function_">exit</span>(<span class="hljs-number">1</span>)
})
</code></pre>
<p>ç”¨ <code>prompts</code> è¯¢é—®ç”¨æˆ·è¾“å…¥é¡¹ç›®åç§°ï¼Œé»˜è®¤æ˜¯ <code>mini-vite-project</code>ã€‚å¦‚æœç”¨æˆ·ç›´æ¥æŒ‰å›è½¦æˆ–è€… Ctrl+C å–æ¶ˆï¼Œå°±é€€å‡ºç¨‹åºã€‚</p>
<h3 data-id="heading-7">ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥ç›®å½•æ˜¯å¦å­˜åœ¨</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> fs <span class="hljs-keyword">from</span> <span class="hljs-string">'fs'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">const</span> root = path.<span class="hljs-title function_">join</span>(process.<span class="hljs-title function_">cwd</span>(), targetDir)

<span class="hljs-comment">// åˆ¤æ–­ç›®å½•æ˜¯å¦ä¸ºç©º</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">isEmpty</span>(<span class="hljs-params">path</span>) {
  <span class="hljs-keyword">const</span> files = fs.<span class="hljs-title function_">readdirSync</span>(path)
  <span class="hljs-keyword">return</span> files.<span class="hljs-property">length</span> === <span class="hljs-number">0</span> || (files.<span class="hljs-property">length</span> === <span class="hljs-number">1</span> &amp;&amp; files[<span class="hljs-number">0</span>] === <span class="hljs-string">'.git'</span>)
}

<span class="hljs-comment">// æ¸…ç©ºç›®å½•</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">emptyDir</span>(<span class="hljs-params">dir</span>) {
  <span class="hljs-keyword">if</span> (!fs.<span class="hljs-title function_">existsSync</span>(dir)) <span class="hljs-keyword">return</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> fs.<span class="hljs-title function_">readdirSync</span>(dir)) {
    <span class="hljs-keyword">if</span> (file === <span class="hljs-string">'.git'</span>) <span class="hljs-keyword">continue</span>
    fs.<span class="hljs-title function_">rmSync</span>(path.<span class="hljs-title function_">resolve</span>(dir, file), { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">force</span>: <span class="hljs-literal">true</span> })
  }
}

<span class="hljs-keyword">if</span> (fs.<span class="hljs-title function_">existsSync</span>(root) &amp;&amp; !<span class="hljs-title function_">isEmpty</span>(root)) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'overwrite'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-string">`Target directory "<span class="hljs-subst">${targetDir}</span>" is not empty. Please choose:`</span>,
    <span class="hljs-attr">choices</span>: [
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'Cancel'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'no'</span> },
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'Remove existing files'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'yes'</span> }
    ]
  })

  <span class="hljs-keyword">if</span> (response.<span class="hljs-property">overwrite</span> === <span class="hljs-string">'no'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-title function_">red</span>(<span class="hljs-string">'âœ–'</span>) + <span class="hljs-string">' Operation cancelled'</span>)
    <span class="hljs-keyword">return</span>
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (response.<span class="hljs-property">overwrite</span> === <span class="hljs-string">'yes'</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\nRemoving existing files in <span class="hljs-subst">${targetDir}</span>...`</span>)
    <span class="hljs-title function_">emptyDir</span>(root)
  }
}
</code></pre>
<p>è¿™é‡Œæˆ‘è¸©äº†ä¸ªå‘ï¼ä¸€å¼€å§‹æˆ‘ç”¨ <code>fs.rmdirSync()</code>ï¼Œç»“æœå‘ç°å¦‚æœç›®å½•éç©ºå°±ä¼šæŠ¥é”™ã€‚åæ¥æ”¹æˆ <code>fs.rmSync()</code> é…åˆ <code>recursive: true</code>ï¼Œæ‰èƒ½é€’å½’åˆ é™¤æ•´ä¸ªç›®å½•ã€‚</p>
<h3 data-id="heading-8">ç¬¬å››æ­¥ï¼šéªŒè¯åŒ…å</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">isValidPackageName</span>(<span class="hljs-params">projectName</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^(?:@[a-z\d\-*~][a-z\d\-*._~]*\/)?[a-z\d\-~][a-z\d\-._~]*$/</span>.<span class="hljs-title function_">test</span>(projectName)
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">toValidPackageName</span>(<span class="hljs-params">projectName</span>) {
  <span class="hljs-keyword">return</span> projectName
    .<span class="hljs-title function_">trim</span>()
    .<span class="hljs-title function_">toLowerCase</span>()
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">'-'</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^[._]/</span>, <span class="hljs-string">''</span>)
    .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[^a-z\d\-~]+/g</span>, <span class="hljs-string">'-'</span>)
}

<span class="hljs-keyword">let</span> packageName = path.<span class="hljs-title function_">basename</span>(root)

<span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isValidPackageName</span>(packageName)) {
  <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'text'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'packageName'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Package name:'</span>),
    <span class="hljs-attr">initial</span>: <span class="hljs-title function_">toValidPackageName</span>(packageName),
    <span class="hljs-attr">validate</span>: <span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> <span class="hljs-title function_">isValidPackageName</span>(name) || <span class="hljs-string">'Invalid package name'</span>
  })
  packageName = response.<span class="hljs-property">packageName</span>
}
</code></pre>
<p>npm åŒ…åæœ‰ä¸€å®šçš„è§„èŒƒï¼Œä¸èƒ½æœ‰å¤§å†™å­—æ¯ã€ç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦ç­‰ã€‚æ‰€ä»¥éœ€è¦éªŒè¯ä¸€ä¸‹ï¼Œå¦‚æœä¸åˆæ³•å°±æç¤ºç”¨æˆ·é‡æ–°è¾“å…¥ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7f3dcf8b3e3046d7bd9ae62a55b9ea7f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aWI5b635Li9:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763386516&amp;x-signature=mCg2bucE19LkPNHly0wD6lIb31o%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-9">ç¬¬äº”æ­¥ï¼šé€‰æ‹©æ¡†æ¶å’Œå˜ä½“</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">FRAMEWORKS</span> = [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'vue'</span>,
    <span class="hljs-attr">display</span>: <span class="hljs-string">'Vue'</span>,
    <span class="hljs-attr">color</span>: green,
    <span class="hljs-attr">variants</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue-ts'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'TypeScript'</span>, <span class="hljs-attr">color</span>: blue },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'vue'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'JavaScript'</span>, <span class="hljs-attr">color</span>: yellow }
    ]
  },
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'react'</span>,
    <span class="hljs-attr">display</span>: <span class="hljs-string">'React'</span>,
    <span class="hljs-attr">color</span>: cyan,
    <span class="hljs-attr">variants</span>: [
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'react-ts'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'TypeScript'</span>, <span class="hljs-attr">color</span>: blue },
      { <span class="hljs-attr">name</span>: <span class="hljs-string">'react'</span>, <span class="hljs-attr">display</span>: <span class="hljs-string">'JavaScript'</span>, <span class="hljs-attr">color</span>: yellow }
    ]
  }
]

<span class="hljs-comment">// é€‰æ‹©æ¡†æ¶</span>
<span class="hljs-keyword">const</span> frameworkResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'framework'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select a framework:'</span>),
  <span class="hljs-attr">choices</span>: <span class="hljs-variable constant_">FRAMEWORKS</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">framework</span> =&gt;</span> ({
    <span class="hljs-attr">title</span>: framework.<span class="hljs-title function_">color</span>(framework.<span class="hljs-property">display</span>),
    <span class="hljs-attr">value</span>: framework
  }))
})

<span class="hljs-keyword">const</span> framework = frameworkResponse.<span class="hljs-property">framework</span>

<span class="hljs-keyword">if</span> (!framework) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'\n'</span> + <span class="hljs-title function_">red</span>(<span class="hljs-string">'âœ–'</span>) + <span class="hljs-string">' Operation cancelled'</span>)
  <span class="hljs-keyword">return</span>
}

<span class="hljs-comment">// é€‰æ‹©å˜ä½“ï¼ˆTypeScript æˆ– JavaScriptï¼‰</span>
<span class="hljs-keyword">const</span> variantResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
  <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
  <span class="hljs-attr">name</span>: <span class="hljs-string">'variant'</span>,
  <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select a variant:'</span>),
  <span class="hljs-attr">choices</span>: framework.<span class="hljs-property">variants</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">variant</span> =&gt;</span> ({
    <span class="hljs-attr">title</span>: variant.<span class="hljs-title function_">color</span>(variant.<span class="hljs-property">display</span>),
    <span class="hljs-attr">value</span>: variant.<span class="hljs-property">name</span>
  }))
})

<span class="hljs-keyword">const</span> template = variantResponse.<span class="hljs-property">variant</span>
</code></pre>
<p>è¿™é‡Œæˆ‘ç”¨äº†ä¸¤çº§é€‰æ‹©ï¼šå…ˆé€‰æ¡†æ¶ï¼ˆVue æˆ– Reactï¼‰ï¼Œå†é€‰å˜ä½“ï¼ˆTypeScript æˆ– JavaScriptï¼‰ã€‚è¿™æ ·äº¤äº’æ›´æ¸…æ™°ï¼Œç”¨æˆ·ä½“éªŒæ›´å¥½ã€‚</p>
<p>æ¯ä¸ªé€‰é¡¹éƒ½ç”¨ä¸åŒçš„é¢œè‰²æ ‡è¯†ï¼Œè§†è§‰æ•ˆæœæ›´å‹å¥½ã€‚</p>
<h3 data-id="heading-10">ç¬¬å…­æ­¥ï¼šé€‰æ‹©å¢å¼ºåŠŸèƒ½ï¼ˆæ’ä»¶ç³»ç»Ÿï¼‰</h3>
<p>è¿™æ˜¯æˆ‘è§‰å¾—æœ€æœ‰æ„æ€çš„éƒ¨åˆ†ï¼ä¸€å¼€å§‹æˆ‘vite cli çš„swcä¹Ÿæ˜¯åŠ¨æ€æ’å…¥çš„ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿™ç§æ’ä»¶æ¨¡å—ï¼Œæˆ‘æƒ³äº†ä¸€ä¸‹è¿˜æ˜¯é€šè¿‡å•ç‹¬çš„æ¨¡å—æ¥å®ç°ä¸€ä¸ªæ’ä»¶ç³»ç»Ÿï¼Œå› ä¸ºåç»­ä¼šæ‰©å±•æ›´å¤šçš„æ’ä»¶ï¼Œè¿™æ ·å¯æ‰©å±•æ€§ä¹Ÿæ›´é«˜ç‚¹</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// 5. é€‰æ‹©å¢å¼ºåŠŸèƒ½ï¼ˆå¯é€‰ï¼‰</span>
  <span class="hljs-keyword">const</span> featuresResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>([
    {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'multiselect'</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">'features'</span>,
      <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select additional features:'</span>),
      <span class="hljs-comment">//æŠŠå¤šé€‰ä¸€çš„æ’ä»¶æ’é™¤æ‰</span>
      <span class="hljs-attr">choices</span>: <span class="hljs-title function_">getPluginChoices</span>().<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">choice</span> =&gt;</span> ![<span class="hljs-string">'tailwind'</span>, <span class="hljs-string">'unocss'</span>].<span class="hljs-title function_">includes</span>(choice.<span class="hljs-property">value</span>)),
      <span class="hljs-attr">hint</span>: <span class="hljs-string">'- Space to select. Return to submit'</span>,
      <span class="hljs-attr">instructions</span>: <span class="hljs-literal">false</span>
    }
  ])

  <span class="hljs-keyword">const</span> selectedFeatures = featuresResponse.<span class="hljs-property">features</span> || []

  <span class="hljs-comment">// 6. é€‰æ‹© CSS æ¡†æ¶ï¼ˆå•é€‰ï¼Œå¯é€‰ï¼‰</span>
  <span class="hljs-keyword">const</span> cssFrameworkResponse = <span class="hljs-keyword">await</span> <span class="hljs-title function_">prompts</span>({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'select'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'cssFramework'</span>,
    <span class="hljs-attr">message</span>: <span class="hljs-title function_">reset</span>(<span class="hljs-string">'Select a CSS framework (optional):'</span>),
    <span class="hljs-attr">choices</span>: [
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'None'</span>, <span class="hljs-attr">value</span>: <span class="hljs-literal">null</span> },
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'Tailwind CSS v4'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'tailwind'</span>, <span class="hljs-attr">description</span>: <span class="hljs-string">'Utility-first CSS framework'</span> },
      { <span class="hljs-attr">title</span>: <span class="hljs-string">'UnoCSS'</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">'unocss'</span>, <span class="hljs-attr">description</span>: <span class="hljs-string">'Instant on-demand Atomic CSS'</span> }
    ]
  })

  <span class="hljs-keyword">if</span> (cssFrameworkResponse.<span class="hljs-property">cssFramework</span>) {
    selectedFeatures.<span class="hljs-title function_">push</span>(cssFrameworkResponse.<span class="hljs-property">cssFramework</span>)
  }
</code></pre>
<p>æˆ‘æŠŠæ’ä»¶åˆ†æˆäº†ä¸¤ç±»ï¼š</p>
<ol>
<li><strong>é€šç”¨åŠŸèƒ½</strong>ï¼šESLintï¼ˆå¤šé€‰ï¼‰ç­‰ä¸èƒ½åŒæ—¶é€‰æ‹©çš„æ‰©å±•</li>
<li><strong>CSS æ¡†æ¶</strong>ï¼šTailwind CSS æˆ– UnoCSSï¼ˆå•é€‰ï¼‰</li>
</ol>
<p>ä¸ºä»€ä¹ˆè¦åˆ†å¼€å‘¢ï¼Ÿå› ä¸º CSS æ¡†æ¶æ˜¯äº’æ–¥çš„ï¼Œä¸èƒ½åŒæ—¶è£… Tailwind å’Œ UnoCSSï¼Œä¼šå†²çªã€‚æ‰€ä»¥å¿…é¡»ç”¨å•é€‰ã€‚</p>
<h3 data-id="heading-11">ç¬¬ä¸ƒæ­¥ï¼šå¤åˆ¶æ¨¡æ¿å¹¶åº”ç”¨æ’ä»¶</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>
<span class="hljs-keyword">import</span> { applyPlugins } <span class="hljs-keyword">from</span> <span class="hljs-string">'./plugins/index.js'</span>

<span class="hljs-keyword">const</span> currentDir = path.<span class="hljs-title function_">dirname</span>(<span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>))
<span class="hljs-keyword">const</span> templateDir = path.<span class="hljs-title function_">resolve</span>(currentDir, <span class="hljs-string">`template-<span class="hljs-subst">${template}</span>`</span>)

<span class="hljs-comment">// å¤åˆ¶æ–‡ä»¶çš„å·¥å…·å‡½æ•°</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">copy</span>(<span class="hljs-params">src, dest</span>) {
  <span class="hljs-keyword">const</span> stat = fs.<span class="hljs-title function_">statSync</span>(src)
  <span class="hljs-keyword">if</span> (stat.<span class="hljs-title function_">isDirectory</span>()) {
    <span class="hljs-title function_">copyDir</span>(src, dest)
  } <span class="hljs-keyword">else</span> {
    fs.<span class="hljs-title function_">copyFileSync</span>(src, dest)
  }
}

<span class="hljs-keyword">function</span> <span class="hljs-title function_">copyDir</span>(<span class="hljs-params">srcDir, destDir</span>) {
  fs.<span class="hljs-title function_">mkdirSync</span>(destDir, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> })
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> fs.<span class="hljs-title function_">readdirSync</span>(srcDir)) {
    <span class="hljs-keyword">const</span> srcFile = path.<span class="hljs-title function_">resolve</span>(srcDir, file)
    <span class="hljs-keyword">const</span> destFile = path.<span class="hljs-title function_">resolve</span>(destDir, file)
    <span class="hljs-title function_">copy</span>(srcFile, destFile)
  }
}

<span class="hljs-comment">// åˆ›å»ºç›®æ ‡ç›®å½•</span>
fs.<span class="hljs-title function_">mkdirSync</span>(root, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> })

<span class="hljs-comment">// å¤åˆ¶æ¨¡æ¿æ–‡ä»¶</span>
<span class="hljs-keyword">const</span> files = fs.<span class="hljs-title function_">readdirSync</span>(templateDir)
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> file <span class="hljs-keyword">of</span> files.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">f</span> =&gt;</span> f !== <span class="hljs-string">'package.json'</span>)) {
  <span class="hljs-keyword">const</span> srcFile = path.<span class="hljs-title function_">join</span>(templateDir, file)
  <span class="hljs-keyword">const</span> destFile = path.<span class="hljs-title function_">join</span>(root, file)
  <span class="hljs-title function_">copy</span>(srcFile, destFile)
}

<span class="hljs-comment">// è¯»å–å¹¶ä¿®æ”¹ package.json</span>
<span class="hljs-keyword">const</span> pkgPath = path.<span class="hljs-title function_">join</span>(templateDir, <span class="hljs-string">'package.json'</span>)
<span class="hljs-keyword">const</span> pkg = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(fs.<span class="hljs-title function_">readFileSync</span>(pkgPath, <span class="hljs-string">'utf-8'</span>))
pkg.<span class="hljs-property">name</span> = packageName

<span class="hljs-comment">// åº”ç”¨é€‰ä¸­çš„æ’ä»¶</span>
<span class="hljs-title function_">applyPlugins</span>(selectedFeatures, root, template, pkg)

<span class="hljs-comment">// å†™å…¥ package.json</span>
fs.<span class="hljs-title function_">writeFileSync</span>(
  path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'package.json'</span>),
  <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(pkg, <span class="hljs-literal">null</span>, <span class="hljs-number">2</span>) + <span class="hljs-string">'\n'</span>
)
</code></pre>
<p>è¿™é‡Œæœ‰ä¸ªå°ç»†èŠ‚ï¼šå› ä¸ºç”¨äº† ES Moduleï¼Œæ²¡æœ‰ <code>__dirname</code> å˜é‡ï¼Œæ‰€ä»¥è¦ç”¨ <code>import.meta.url</code> é…åˆ <code>fileURLToPath</code> æ¥è·å–å½“å‰æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>å¤åˆ¶æ–‡ä»¶çš„é€»è¾‘å¾ˆç®€å•ï¼šé€’å½’éå†æ¨¡æ¿ç›®å½•ï¼ŒæŠŠæ¯ä¸ªæ–‡ä»¶éƒ½å¤åˆ¶åˆ°ç›®æ ‡ç›®å½•ã€‚</p>
<p>æœ€å…³é”®çš„æ˜¯ <code>applyPlugins</code> è¿™ä¸€æ­¥ï¼Œå®ƒä¼šæ ¹æ®ç”¨æˆ·é€‰æ‹©çš„æ’ä»¶ï¼ŒåŠ¨æ€ä¿®æ”¹é¡¹ç›®é…ç½®ã€‚</p>
<h2 data-id="heading-12">æ’ä»¶ç³»ç»Ÿçš„è®¾è®¡</h2>
<p>æ’ä»¶ç³»ç»Ÿæ˜¯æ•´ä¸ªé¡¹ç›®çš„æ ¸å¿ƒï¼Œæˆ‘èŠ±äº†ä¸å°‘æ—¶é—´æ¥è®¾è®¡å®ƒçš„æ¶æ„ã€‚</p>
<h3 data-id="heading-13">æ’ä»¶çš„æ ‡å‡†ç»“æ„</h3>
<p>æ¯ä¸ªæ’ä»¶éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ JS æ–‡ä»¶ï¼Œå¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/eslint.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> eslintPlugin = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'eslint'</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">'ESLint + Prettier (Antfu Config)'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Code quality and formatting'</span>,
  
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">root, template, pkg</span>) {
    <span class="hljs-comment">// 1. æ·»åŠ ä¾èµ–</span>
    pkg.<span class="hljs-property">devDependencies</span> = pkg.<span class="hljs-property">devDependencies</span> || {}
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'eslint'</span>] = <span class="hljs-string">'^9.39.1'</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'@antfu/eslint-config'</span>] = <span class="hljs-string">'^6.2.0'</span>
  
    <span class="hljs-comment">// 2. åˆ›å»ºé…ç½®æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> configContent = <span class="hljs-string">`import antfu from '@antfu/eslint-config'

export default antfu()`</span>
  
    fs.<span class="hljs-title function_">writeFileSync</span>(
      path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'eslint.config.js'</span>),
      configContent
    )
  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${green(<span class="hljs-string">'âœ”'</span>)}</span> ESLint configured`</span>)
  }
}
</code></pre>
<p>æ¯ä¸ªæ’ä»¶åŒ…å«ï¼š</p>
<ul>
<li><strong>name</strong>ï¼šæ’ä»¶æ ‡è¯†</li>
<li><strong>title</strong>ï¼šæ˜¾ç¤ºç»™ç”¨æˆ·çœ‹çš„åç§°</li>
<li><strong>description</strong>ï¼šç®€çŸ­æè¿°</li>
<li><strong>setup</strong>ï¼šå®‰è£…å‡½æ•°ï¼Œæ¥æ”¶ <code>root</code>ï¼ˆé¡¹ç›®ç›®å½•ï¼‰ã€<code>template</code>ï¼ˆæ¨¡æ¿åç§°ï¼‰ã€<code>pkg</code>ï¼ˆpackage.json å¯¹è±¡ï¼‰ä¸‰ä¸ªå‚æ•°</li>
</ul>
<h3 data-id="heading-14">æ’ä»¶ç®¡ç†å™¨</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/index.js</span>
<span class="hljs-keyword">import</span> { eslintPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./eslint.js'</span>
<span class="hljs-keyword">import</span> { tailwindPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./tailwind.js'</span>
<span class="hljs-keyword">import</span> { unocssPlugin } <span class="hljs-keyword">from</span> <span class="hljs-string">'./unocss.js'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> plugins = {
  <span class="hljs-attr">eslint</span>: eslintPlugin,
  <span class="hljs-attr">tailwind</span>: tailwindPlugin,
  <span class="hljs-attr">unocss</span>: unocssPlugin
}

<span class="hljs-comment">// æ’ä»¶æ‰§è¡Œé¡ºåº</span>
<span class="hljs-keyword">const</span> pluginOrder = {
  <span class="hljs-attr">eslint</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">tailwind</span>: <span class="hljs-number">2</span>,
  <span class="hljs-attr">unocss</span>: <span class="hljs-number">2</span>
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">applyPlugins</span>(<span class="hljs-params">selectedPlugins, root, template, pkg</span>) {
  <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§æ’åº</span>
  <span class="hljs-keyword">const</span> sortedPlugins = [...selectedPlugins].<span class="hljs-title function_">sort</span>(<span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> orderA = pluginOrder[a] || <span class="hljs-number">999</span>
    <span class="hljs-keyword">const</span> orderB = pluginOrder[b] || <span class="hljs-number">999</span>
    <span class="hljs-keyword">return</span> orderA - orderB
  })
  
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> pluginName <span class="hljs-keyword">of</span> sortedPlugins) {
    <span class="hljs-keyword">const</span> plugin = plugins[pluginName]
  
    <span class="hljs-keyword">if</span> (!plugin) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${red(<span class="hljs-string">'âœ–'</span>)}</span> Plugin "<span class="hljs-subst">${pluginName}</span>" not found`</span>)
      <span class="hljs-keyword">continue</span>
    }
  
    <span class="hljs-keyword">try</span> {
      plugin.<span class="hljs-title function_">setup</span>(root, template, pkg)
    } <span class="hljs-keyword">catch</span> (error) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`<span class="hljs-subst">${red(<span class="hljs-string">'âœ–'</span>)}</span> Failed to configure <span class="hljs-subst">${plugin.title}</span>`</span>)
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`   <span class="hljs-subst">${error.message}</span>`</span>)
    }
  }
}
</code></pre>
<p>æ’ä»¶ç®¡ç†å™¨è´Ÿè´£ï¼š</p>
<ol>
<li>æŒ‰ä¼˜å…ˆçº§æ’åºæ’ä»¶ï¼ˆESLint è¦å…ˆæ‰§è¡Œï¼ŒCSS æ¡†æ¶åæ‰§è¡Œï¼‰</li>
<li>ä¾æ¬¡è°ƒç”¨æ¯ä¸ªæ’ä»¶çš„ <code>setup</code> æ–¹æ³•</li>
<li>é”™è¯¯å¤„ç†ï¼Œé˜²æ­¢æŸä¸ªæ’ä»¶å¤±è´¥å¯¼è‡´æ•´ä¸ªæµç¨‹å´©æºƒ</li>
</ol>
<h3 data-id="heading-15">Tailwind CSS v4 æ’ä»¶</h3>
<p>è¿™é‡Œæˆ‘åˆè¸©äº†ä¸ªå‘ï¼</p>
<p>Tailwind CSS v4 çš„é…ç½®æ–¹å¼å’Œ v3 å®Œå…¨ä¸åŒã€‚v3 éœ€è¦åˆ›å»º <code>tailwind.config.js</code> å’Œ <code>postcss.config.js</code>ï¼Œä½† v4 ç®€åŒ–äº†å¾ˆå¤šï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/tailwind.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> tailwindPlugin = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'tailwind'</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">'Tailwind CSS v4'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Utility-first CSS framework'</span>,
  
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">root, template, pkg</span>) {
    <span class="hljs-comment">// 1. æ·»åŠ ä¾èµ–</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'tailwindcss'</span>] = <span class="hljs-string">'^4.1.0'</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'@tailwindcss/vite'</span>] = <span class="hljs-string">'^4.1.0'</span>
  
    <span class="hljs-comment">// 2. åˆ›å»º CSS æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> cssPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'src/index.css'</span>)
    fs.<span class="hljs-title function_">writeFileSync</span>(cssPath, <span class="hljs-string">'@import "tailwindcss";\n'</span>)
  
    <span class="hljs-comment">// 3. ä¿®æ”¹ vite.config.js</span>
    <span class="hljs-keyword">const</span> viteConfigPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'vite.config.js'</span>)
    <span class="hljs-keyword">let</span> viteConfig = fs.<span class="hljs-title function_">readFileSync</span>(viteConfigPath, <span class="hljs-string">'utf-8'</span>)
  
    <span class="hljs-comment">// åœ¨ import åŒºåŸŸæ·»åŠ </span>
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/(import .+ from .+\n)/</span>,
      <span class="hljs-string">`$1import tailwindcss from '@tailwindcss/vite'\n`</span>
    )
  
    <span class="hljs-comment">// åœ¨ plugins æ•°ç»„æ·»åŠ </span>
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/plugins:\s*\[/</span>,
      <span class="hljs-string">'plugins: [tailwindcss(), '</span>
    )
  
    fs.<span class="hljs-title function_">writeFileSync</span>(viteConfigPath, viteConfig)
  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${green(<span class="hljs-string">'âœ”'</span>)}</span> Tailwind CSS v4 configured`</span>)
  }
}
</code></pre>
<p>è¿™é‡Œé‡‡ç”¨çš„æœ€æ–°ç‰ˆçš„v4 tailwindcssï¼Œv4 çš„é…ç½®æ­¥éª¤ï¼š</p>
<ol>
<li>å®‰è£… <code>tailwindcss</code> å’Œ <code>@tailwindcss/vite</code></li>
<li>åœ¨ CSS æ–‡ä»¶é‡Œå†™ <code>@import "tailwindcss";</code></li>
<li>åœ¨ <code>vite.config.js</code> å¼•å…¥ Vite æ’ä»¶</li>
</ol>
<p><strong>ä¸éœ€è¦</strong>åˆ›å»º <code>tailwind.config.js</code> å’Œ <code>postcss.config.js</code>ï¼</p>
<h3 data-id="heading-16">UnoCSS æ’ä»¶</h3>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// plugins/unocss.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> unocssPlugin = {
  <span class="hljs-attr">name</span>: <span class="hljs-string">'unocss'</span>,
  <span class="hljs-attr">title</span>: <span class="hljs-string">'UnoCSS'</span>,
  <span class="hljs-attr">description</span>: <span class="hljs-string">'Instant on-demand Atomic CSS'</span>,
  
  <span class="hljs-title function_">setup</span>(<span class="hljs-params">root, template, pkg</span>) {
    <span class="hljs-comment">// 1. æ·»åŠ ä¾èµ–</span>
    pkg.<span class="hljs-property">devDependencies</span>[<span class="hljs-string">'unocss'</span>] = <span class="hljs-string">'^0.64.6'</span>
  
    <span class="hljs-comment">// 2. åˆ›å»ºé…ç½®æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> configContent = <span class="hljs-string">`import { defineConfig } from 'unocss'

export default defineConfig({
  // ä½ çš„é…ç½®
})`</span>
  
    fs.<span class="hljs-title function_">writeFileSync</span>(
      path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'uno.config.ts'</span>),
      configContent
    )
  
    <span class="hljs-comment">// 3. ä¿®æ”¹ vite.config.js</span>
    <span class="hljs-keyword">const</span> viteConfigPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'vite.config.js'</span>)
    <span class="hljs-keyword">let</span> viteConfig = fs.<span class="hljs-title function_">readFileSync</span>(viteConfigPath, <span class="hljs-string">'utf-8'</span>)
  
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/(import .+ from .+\n)/</span>,
      <span class="hljs-string">`$1import UnoCSS from 'unocss/vite'\n`</span>
    )
  
    viteConfig = viteConfig.<span class="hljs-title function_">replace</span>(
      <span class="hljs-regexp">/plugins:\s*\[/</span>,
      <span class="hljs-string">'plugins: [UnoCSS(), '</span>
    )
  
    fs.<span class="hljs-title function_">writeFileSync</span>(viteConfigPath, viteConfig)
  
    <span class="hljs-comment">// 4. ä¿®æ”¹ main å…¥å£æ–‡ä»¶</span>
    <span class="hljs-keyword">const</span> isVue = template.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'vue'</span>)
    <span class="hljs-keyword">const</span> mainFile = isVue ? <span class="hljs-string">'main.js'</span> : <span class="hljs-string">'main.jsx'</span>
    <span class="hljs-keyword">const</span> mainPath = path.<span class="hljs-title function_">join</span>(root, <span class="hljs-string">'src'</span>, mainFile)
    <span class="hljs-keyword">let</span> mainContent = fs.<span class="hljs-title function_">readFileSync</span>(mainPath, <span class="hljs-string">'utf-8'</span>)
  
    mainContent = <span class="hljs-string">`import 'virtual:uno.css'\n<span class="hljs-subst">${mainContent}</span>`</span>
  
    fs.<span class="hljs-title function_">writeFileSync</span>(mainPath, mainContent)
  
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`<span class="hljs-subst">${green(<span class="hljs-string">'âœ”'</span>)}</span> UnoCSS configured`</span>)
  }
}
</code></pre>
<p>UnoCSS çš„é…ç½®ç›¸å¯¹å¤æ‚ä¸€ç‚¹ï¼š</p>
<ol>
<li>åˆ›å»º <code>uno.config.ts</code></li>
<li>ä¿®æ”¹ <code>vite.config.js</code> å¼•å…¥æ’ä»¶</li>
<li>åœ¨å…¥å£æ–‡ä»¶ï¼ˆ<code>main.js</code> æˆ– <code>main.jsx</code>ï¼‰å¼•å…¥ <code>virtual:uno.css</code></li>
</ol>
<h2 data-id="heading-17">æ¨¡æ¿è®¾è®¡</h2>
<p>å› ä¸ºå¹³å¸¸ä¸»è¦ç”¨Vueå’ŒReactæ¯”è¾ƒå¤šï¼Œæˆ‘ä¸º Vue å’Œ React å„å‡†å¤‡äº† JS å’Œ TS ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€å…± 4 ä¸ªæ¨¡æ¿ã€‚</p>
<h3 data-id="heading-18">Vue æ¨¡æ¿</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">template</span>-vue/
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ <span class="hljs-keyword">public</span>/
â”‚   â””â”€â”€ vite.svg
â””â”€â”€ src/
    â”œâ”€â”€ main.js
    â”œâ”€â”€ App.vue
    â”œâ”€â”€ style.css
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ HelloWorld.vue
    â””â”€â”€ assets/
        â””â”€â”€ vue.svg
</code></pre>
<p><strong>package.json</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^3.5.13"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vitejs/plugin-vue"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^5.2.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.5"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><strong>vite.config.js</strong>ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()]
})
</code></pre>
<h3 data-id="heading-19">React æ¨¡æ¿</h3>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">template</span>-react/
â”œâ”€â”€ index.html
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ package.json
â”œâ”€â”€ <span class="hljs-keyword">public</span>/
â”‚   â””â”€â”€ vite.svg
â””â”€â”€ src/
    â”œâ”€â”€ main.jsx
    â”œâ”€â”€ App.jsx
    â”œâ”€â”€ index.css
    â”œâ”€â”€ components/
    â”‚   â””â”€â”€ Counter.jsx
    â””â”€â”€ assets/
        â””â”€â”€ react.svg
</code></pre>
<p><strong>package.json</strong>ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"private"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"0.0.0"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"module"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"scripts"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"dev"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"build"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite build"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"preview"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"vite preview"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.1"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.1"</span>
  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"devDependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"@vitejs/plugin-react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^4.3.4"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.18"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"@types/react-dom"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^18.3.5"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"vite"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"^6.0.5"</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>TypeScript ç‰ˆæœ¬å°±æ˜¯åœ¨ä¸Šé¢çš„åŸºç¡€ä¸Šï¼š</p>
<ol>
<li>æ·»åŠ  <code>tsconfig.json</code> å’Œ <code>tsconfig.node.json</code></li>
<li>æ–‡ä»¶åç¼€æ”¹æˆ <code>.ts</code> æˆ– <code>.tsx</code></li>
<li><code>package.json</code> é‡ŒåŠ ä¸Š <code>typescript</code> ä¾èµ–</li>
</ol>
<h2 data-id="heading-20">ä½¿ç”¨æ–¹å¼</h2>
<p>å¼€å‘é˜¶æ®µï¼Œå¯ä»¥ç”¨<code>node index.js</code>æˆ–åˆ™æ˜¯ä½¿ç”¨ <code>npm link</code> æŠŠå‘½ä»¤é“¾æ¥åˆ°å…¨å±€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-built_in">cd</span> mini-vite
npm <span class="hljs-built_in">link</span>
</code></pre>
<p>ç„¶åå°±å¯ä»¥åœ¨ä»»æ„ç›®å½•ä½¿ç”¨äº†ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">mini-vite my-app
</code></pre>
<p>æˆ–è€…ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">create-mini-vite my-app
</code></pre>
<p>æ‰§è¡Œåä¼šçœ‹åˆ°äº¤äº’å¼ç•Œé¢ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">Mini Vite - A minimal scaffolding tool

? Project name: â€º my-app
? <span class="hljs-keyword">Select</span> a framework: â€º 
  Vue
  React
? <span class="hljs-keyword">Select</span> a variant: â€º 
  TypeScript
  JavaScript
? <span class="hljs-keyword">Select</span> additional features: â€º 
â—¯ ESLint + Prettier (Antfu Config)
? <span class="hljs-keyword">Select</span> a CSS framework (<span class="hljs-keyword">optional</span>): â€º 
  None
  Tailwind CSS v4
  UnoCSS

âœ” Scaffolding project <span class="hljs-keyword">in</span> /path/<span class="hljs-keyword">to</span>/my-app...

âœ” ESLint configured
âœ” Tailwind CSS v4 configured

âœ” Done!

Now run:

  cd my-app
  npm install
  npm run dev
</code></pre>
<h2 data-id="heading-21">è¸©è¿‡çš„å‘</h2>
<h3 data-id="heading-22">1. ES Module çš„ __dirname é—®é¢˜</h3>
<p>åœ¨ ES Module é‡Œæ²¡æœ‰ <code>__dirname</code> å’Œ <code>__filename</code>ï¼Œè¦è¿™æ ·è·å–ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { fileURLToPath } <span class="hljs-keyword">from</span> <span class="hljs-string">'url'</span>
<span class="hljs-keyword">import</span> path <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-keyword">const</span> __filename = <span class="hljs-title function_">fileURLToPath</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">url</span>)
<span class="hljs-keyword">const</span> __dirname = path.<span class="hljs-title function_">dirname</span>(__filename)
</code></pre>
<p>æˆ‘ä¸€å¼€å§‹ç›´æ¥ç”¨ <code>__dirname</code>ï¼Œç»“æœæŠ¥é”™è¯´æœªå®šä¹‰ã€‚æŸ¥äº†æ–‡æ¡£æ‰çŸ¥é“è¦ç”¨ <code>import.meta.url</code>ã€‚</p>
<h3 data-id="heading-23">2. Tailwind CSS v4 çš„é…ç½®å˜åŒ–</h3>
<p>v4 ä¸å†éœ€è¦ <code>tailwind.config.js</code> å’Œ <code>postcss.config.js</code>ï¼Œç›´æ¥åœ¨ CSS é‡Œå¼•å…¥å°±è¡Œï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-keyword">@import</span> <span class="hljs-string">"tailwindcss"</span>;
</code></pre>
<p>ç„¶ååœ¨ <code>vite.config.js</code> å¼•å…¥ Vite æ’ä»¶ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> tailwindcss <span class="hljs-keyword">from</span> <span class="hljs-string">'@tailwindcss/vite'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">tailwindcss</span>()]
})
</code></pre>
<p>æˆ‘ä¸€å¼€å§‹è¿˜æŒ‰ v3 çš„æ–¹å¼åˆ›å»ºé…ç½®æ–‡ä»¶ï¼Œæµªè´¹äº†å¥½é•¿æ—¶é—´ã€‚</p>
<h3 data-id="heading-24">3. æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹ vite.config.js</h3>
<p>ç”¨æ­£åˆ™è¡¨è¾¾å¼ä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ—¶å€™è¦ç‰¹åˆ«å°å¿ƒï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// ä¸å¥½çš„å†™æ³•ï¼ˆå‡è®¾æ ¼å¼å›ºå®šï¼‰</span>
content.<span class="hljs-title function_">replace</span>(<span class="hljs-string">'plugins: ['</span>, <span class="hljs-string">'plugins: [tailwindcss(), '</span>)

<span class="hljs-comment">// å¥½çš„å†™æ³•ï¼ˆè€ƒè™‘å„ç§ç©ºæ ¼æƒ…å†µï¼‰</span>
content.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/plugins:\s*\[/</span>, <span class="hljs-string">'plugins: [tailwindcss(), '</span>)
</code></pre>
<p>å› ä¸ºä¸åŒäººå†™ä»£ç çš„æ ¼å¼å¯èƒ½ä¸ä¸€æ ·ï¼Œæœ‰äººå†™ <code>plugins:[</code>ï¼Œæœ‰äººå†™ <code>plugins: [</code>ã€‚ç”¨æ­£åˆ™çš„ <code>\s*</code> å¯ä»¥åŒ¹é…ä»»æ„ç©ºæ ¼ã€‚</p>
<h2 data-id="heading-25">å’Œå®˜æ–¹å·¥å…·çš„å¯¹æ¯”</h2>













































<table><thead><tr><th>ç‰¹æ€§</th><th>create-vite</th><th>mini-vite</th></tr></thead><tbody><tr><td>æ”¯æŒçš„æ¡†æ¶</td><td>8+</td><td>2ï¼ˆVueã€Reactï¼‰</td></tr><tr><td>æ¨¡æ¿æ•°é‡</td><td>18+</td><td>4</td></tr><tr><td>ä¾èµ–æ•°é‡</td><td>3</td><td>2</td></tr><tr><td>æ’ä»¶ç³»ç»Ÿ</td><td>âœ—</td><td>âœ“ï¼ˆESLintã€Tailwindã€UnoCSSï¼‰</td></tr><tr><td>ä»£ç é‡</td><td>~500 è¡Œ</td><td>~300 è¡Œ</td></tr><tr><td>å›¢é˜Ÿå®šåˆ¶</td><td>å›°éš¾</td><td>å®¹æ˜“</td></tr><tr><td>å­¦ä¹ éš¾åº¦</td><td>ä¸­ç­‰</td><td>ç®€å•</td></tr></tbody></table>
<p>å®˜æ–¹å·¥å…·åŠŸèƒ½æ›´å…¨é¢ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒã€‚æˆ‘è¿™ä¸ªæ›´è½»é‡ã€æ›´çµæ´»ï¼Œé€‚åˆå­¦ä¹ å’Œå›¢é˜Ÿå®šåˆ¶ã€‚</p>
<h2 data-id="heading-26">å†™åœ¨æœ€å</h2>
<p>åç»­æˆ‘ä¼šè¡¥å……æ›´å¤špluginï¼Œæ”¯æŒh5ç«¯ä¸åŒæœºå‹é€‚é…ã€routerå’Œè·¨é¡µé¢åº”ç”¨å­˜å‚¨ç­‰é€šç”¨åŠŸèƒ½
å¤§å®¶ä¹Ÿå¯ä»¥å°è¯•å†™ä¸€ä¸ªè‡ªå·±çš„cliå·¥å…·ï¼Œæ— è®ºæ˜¯å›¢é˜Ÿå¼€å‘è¿˜æ˜¯ä¸ªäººç‹¬ç«‹å¼€å‘ï¼Œæˆ‘è§‰å¾—éƒ½æŒºæœ‰ç”¨çš„ï¼Œè™½ç„¶ç°åœ¨aiå¾ˆç‰›ï¼Œæœ‰æ—¶å€™è®©å®ƒåˆ›å»ºé¡¹ç›®ï¼Œä¹Ÿä¼šå‡ºé”™ï¼Œè¿˜å¾—ä¸æ–­è°ƒè¯•æ‰èƒ½åšå¥½ï¼ˆåæ§½ä¸€ä¸‹ï¼‰</p>
<p>emm æ‡¦å¤«çš„å‘³é“...</p>
<hr/>
<h2 data-id="heading-27">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fvitejs%2Fvite%2Ftree%2Fmain%2Fpackages%2Fcreate-vite" target="_blank" title="https://github.com/vitejs/vite/tree/main/packages/create-vite" ref="nofollow noopener noreferrer">create-vite æºç </a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fterkelg%2Fprompts" target="_blank" title="https://github.com/terkelg/prompts" ref="nofollow noopener noreferrer">prompts</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Falexeyraspopov%2Fpicocolors" target="_blank" title="https://github.com/alexeyraspopov/picocolors" ref="nofollow noopener noreferrer">picocolors</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fantfu%2Feslint-config" target="_blank" title="https://github.com/antfu/eslint-config" ref="nofollow noopener noreferrer">@antfu/eslint-config</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Ftailwindcss.com%2Fblog%2Ftailwindcss-v4-alpha" target="_blank" title="https://tailwindcss.com/blog/tailwindcss-v4-alpha" ref="nofollow noopener noreferrer">Tailwind CSS v4</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Funocss.dev%2F" target="_blank" title="https://unocss.dev/" ref="nofollow noopener noreferrer">UnoCSS</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€åº•å±‚æœºåˆ¶ã€‘Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ·±åº¦è§£æ]]></title>    <link>https://juejin.cn/post/7570901172527415331</link>    <guid>https://juejin.cn/post/7570901172527415331</guid>    <pubDate>2025-11-10T13:24:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172527415331" data-draft-id="7570909641682812968" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€åº•å±‚æœºåˆ¶ã€‘Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ·±åº¦è§£æ"/> <meta itemprop="keywords" content="Android"/> <meta itemprop="datePublished" content="2025-11-10T13:24:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²æ€¡æ—¸"/> <meta itemprop="url" content="https://juejin.cn/user/2875978146656750"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€åº•å±‚æœºåˆ¶ã€‘Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ·±åº¦è§£æ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2875978146656750/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²æ€¡æ—¸
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:24:02.000Z" title="Mon Nov 10 2025 13:24:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ä¸€ã€ä½å†…å­˜ç®¡ç†æ¶æ„æ¦‚è¿°</h2>
<h3 data-id="heading-1">1.1 ç³»ç»Ÿçº§å†…å­˜å‹åŠ›å“åº”</h3>
<p>Androidä½å†…å­˜ç®¡ç†æ˜¯ä¸€ä¸ªå¤šå±‚æ¬¡ã€ååŒå·¥ä½œçš„ç³»ç»Ÿï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯åœ¨å†…å­˜å‹åŠ›ä¸‹ç»´æŒç³»ç»Ÿå“åº”æ€§å’Œç¨³å®šæ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/03b8018a7d404502ba3ebd625cdcf2c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385842&amp;x-signature=2EgAwvUn24hfcdDX6kDD4NMx3bE%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">äºŒã€ä½å†…å­˜æ€æ‰‹ï¼ˆLMKï¼‰æ ¸å¿ƒå®ç°</h2>
<h3 data-id="heading-3">2.1 LMKé©±åŠ¨æ¶æ„</h3>
<h4 data-id="heading-4">2.1.1 å†…æ ¸ç©ºé—´å®ç°</h4>
<p>LMKä½œä¸ºLinuxå†…æ ¸æ¨¡å—å®ç°ï¼Œä¸»è¦ç»„ä»¶åŒ…æ‹¬ï¼š</p>
<p><strong>å†…å­˜å‹åŠ›æ£€æµ‹</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">lmk_metrics</span> {</span>
    <span class="hljs-type">long</span> free_pages;           <span class="hljs-comment">// ç³»ç»Ÿç©ºé—²é¡µé¢</span>
    <span class="hljs-type">long</span> file_cache;           <span class="hljs-comment">// é¡µé¢ç¼“å­˜å¤§å°</span>
    <span class="hljs-type">long</span> swap_used;            <span class="hljs-comment">// äº¤æ¢ç©ºé—´ä½¿ç”¨</span>
    <span class="hljs-type">long</span> anon_pages;           <span class="hljs-comment">// åŒ¿åé¡µé¢æ•°é‡</span>
    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">zone_watermarks</span> <span class="hljs-title">wm</span>;</span> <span class="hljs-comment">// å†…å­˜åŒºåŸŸæ°´ä½çº¿</span>
};
</code></pre>
<p><strong>è¿›ç¨‹è¯„åˆ†æœºåˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">proc_score</span> {</span>
    <span class="hljs-type">pid_t</span> pid;                 <span class="hljs-comment">// è¿›ç¨‹ID</span>
    <span class="hljs-type">int</span> oom_score_adj;         <span class="hljs-comment">// OOMè°ƒæ•´åˆ†æ•°</span>
    <span class="hljs-type">long</span> rss;                  <span class="hljs-comment">// é©»ç•™å†…å­˜å¤§å°</span>
    <span class="hljs-type">long</span> swap_usage;           <span class="hljs-comment">// äº¤æ¢ä½¿ç”¨é‡</span>
    <span class="hljs-type">long</span> last_visible_time;    <span class="hljs-comment">// æœ€åå¯è§æ—¶é—´</span>
    <span class="hljs-type">int</span> importance;            <span class="hljs-comment">// è¿›ç¨‹é‡è¦æ€§</span>
};
</code></pre>
<h4 data-id="heading-5">2.1.2 æ€è¿›ç¨‹å†³ç­–ç®—æ³•</h4>
<p>LMKä½¿ç”¨ç»¼åˆè¯„åˆ†ç³»ç»Ÿé€‰æ‹©ç›®æ ‡è¿›ç¨‹ï¼š</p>
<p><strong>è¯„åˆ†å…¬å¼</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">score</span> = base_oom_score Ã— memory_pressure Ã— time_factor

å…¶ä¸­ï¼š
<span class="hljs-attr">base_oom_score</span> = f(oom_score_adj, process_state)
<span class="hljs-attr">memory_pressure</span> = current_free_pages / low_memory_threshold
<span class="hljs-attr">time_factor</span> = time_since_last_visible / time_constant
</code></pre>
<p><strong>é€‰æ‹©ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>ä¼˜å…ˆé€‰æ‹©é«˜oom_score_adjçš„è¿›ç¨‹</li>
<li>è€ƒè™‘è¿›ç¨‹å†…å­˜å ç”¨å¤§å°</li>
<li>å¹³è¡¡æ€è¿›ç¨‹çš„æˆæœ¬ä¸æ”¶ç›Š</li>
</ul>
<h3 data-id="heading-6">2.2 ç”¨æˆ·ç©ºé—´åä½œ</h3>
<h4 data-id="heading-7">2.2.1 ActivityManagerServiceé›†æˆ</h4>
<p>AMSç»´æŠ¤è¿›ç¨‹çŠ¶æ€å¹¶åŠ¨æ€è°ƒæ•´OOMåˆ†æ•°ï¼š</p>
<p><strong>è¿›ç¨‹çŠ¶æ€æ˜ å°„</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProcessRecord</span> {
    <span class="hljs-type">int</span> curAdj;          <span class="hljs-comment">// å½“å‰OOMè°ƒæ•´åˆ†æ•°</span>
    <span class="hljs-type">int</span> setAdj;          <span class="hljs-comment">// è®¾ç½®çš„OOMåˆ†æ•°</span>
    ProcessState state;  <span class="hljs-comment">// è¿›ç¨‹çŠ¶æ€</span>
    <span class="hljs-type">boolean</span> foreground;  <span class="hljs-comment">// æ˜¯å¦å‰å°</span>
    <span class="hljs-type">long</span> lastVisibleTime;<span class="hljs-comment">// æœ€åå¯è§æ—¶é—´</span>
}
</code></pre>
<p><strong>åŠ¨æ€åˆ†æ•°è°ƒæ•´</strong>ï¼š</p>
<ul>
<li>å‰å°è¿›ç¨‹ï¼š0 (ADJ_MEM_FACTOR_NORMAL)</li>
<li>å¯è§è¿›ç¨‹ï¼š100 (ADJ_MEM_FACTOR_VISIBLE)</li>
<li>æœåŠ¡è¿›ç¨‹ï¼š200-400 (åŸºäºæœåŠ¡é‡è¦æ€§)</li>
<li>åå°è¿›ç¨‹ï¼š600-900</li>
<li>ç¼“å­˜è¿›ç¨‹ï¼š900+</li>
</ul>
<h2 data-id="heading-8">ä¸‰ã€å†…å­˜å‹åŠ›æ£€æµ‹ä¸å“åº”</h2>
<h3 data-id="heading-9">3.1 å¤šçº§æ°´ä½çº¿ç›‘æ§</h3>
<h4 data-id="heading-10">3.1.1 å†…æ ¸æ°´ä½çº¿å®šä¹‰</h4>
<p>Linuxå†…æ ¸å®šä¹‰äº†ä¸‰å±‚å†…å­˜æ°´ä½çº¿ï¼š</p>
<p><strong>æ°´ä½çº¿è®¡ç®—</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">high_wmark</span> = total_pages Ã— <span class="hljs-number">0.9</span>    // å¼€å§‹å›æ”¶ç¼“å­˜
<span class="hljs-attr">low_wmark</span> = total_pages Ã— <span class="hljs-number">0.7</span>     // ç§¯æå›æ”¶
<span class="hljs-attr">min_wmark</span> = total_pages Ã— <span class="hljs-number">0.5</span>     // ç›´æ¥å›æ”¶å’ŒOOM
</code></pre>
<h4 data-id="heading-11">3.1.2 Androidæ‰©å±•æ°´ä½çº¿</h4>
<p>Androidåœ¨æ ‡å‡†æ°´ä½çº¿åŸºç¡€ä¸Šæ·»åŠ ç§»åŠ¨è®¾å¤‡ç‰¹å®šæ‰©å±•ï¼š</p>
<p><strong>ç§»åŠ¨ä¼˜åŒ–æ°´ä½çº¿</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">critical_wmark</span> = total_pages Ã— <span class="hljs-number">0.3</span>    // è§¦å‘LMK
<span class="hljs-attr">super_critical</span> = total_pages Ã— <span class="hljs-number">0.2</span>    // æ¿€è¿›LMK
<span class="hljs-attr">emergency_wmark</span> = total_pages Ã— <span class="hljs-number">0.1</span>   // ç³»ç»Ÿç¨³å®šæ€§æªæ–½
</code></pre>
<h3 data-id="heading-12">3.2 å†…å­˜å‹åŠ›ä¼ æ’­æœºåˆ¶</h3>
<h4 data-id="heading-13">3.2.1 å‹åŠ›çŠ¶æ€é€šçŸ¥</h4>
<p><strong>vmpressureäº‹ä»¶</strong>ï¼š</p>
<pre><code class="hljs language-c" lang="c"><span class="hljs-class"><span class="hljs-keyword">enum</span> <span class="hljs-title">vmpressure_level</span> {</span>
    VMPRESSURE_LOW,      <span class="hljs-comment">// ä½å‹åŠ›</span>
    VMPRESSURE_MEDIUM,   <span class="hljs-comment">// ä¸­ç­‰å‹åŠ›</span>
    VMPRESSURE_CRITICAL, <span class="hljs-comment">// ä¸´ç•Œå‹åŠ›</span>
    VMPRESSULE_OOM       <span class="hljs-comment">// OOMçŠ¶æ€</span>
};
</code></pre>
<p><strong>äº‹ä»¶ä¼ é€’è·¯å¾„</strong>ï¼š
å†…æ ¸vmpressure â†’ ç”¨æˆ·ç©ºé—´lmkd â†’ ActivityManagerService â†’ åº”ç”¨è¿›ç¨‹</p>
<h4 data-id="heading-14">3.2.2 åˆ†çº§å“åº”ç­–ç•¥</h4>
<p>åŸºäºå‹åŠ›çº§åˆ«å®æ–½ä¸åŒå¼ºåº¦çš„å†…å­˜å›æ”¶ï¼š</p>
<p><strong>ä½å‹åŠ›å“åº”</strong>ï¼š</p>
<ul>
<li>åå°è¿›ç¨‹å‹ç¼©</li>
<li>ç¼“å­˜æ¸…ç†</li>
<li>æ¸©å’Œçš„äº¤æ¢</li>
</ul>
<p><strong>ä¸­ç­‰å‹åŠ›å“åº”</strong>ï¼š</p>
<ul>
<li>æ€æ­»éƒ¨åˆ†åå°è¿›ç¨‹</li>
<li>ç§¯æå›æ”¶æ–‡ä»¶ç¼“å­˜</li>
<li>å‹ç¼©åŒ¿åå†…å­˜</li>
</ul>
<p><strong>ä¸´ç•Œå‹åŠ›å“åº”</strong>ï¼š</p>
<ul>
<li>æ€æ­»å¯è§è¿›ç¨‹ä¹‹å¤–çš„æ‰€æœ‰è¿›ç¨‹</li>
<li>å¼ºåˆ¶å†…å­˜å‹ç¼©</li>
<li>ç³»ç»ŸæœåŠ¡é™çº§</li>
</ul>
<h2 data-id="heading-15">å››ã€è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†</h2>
<h3 data-id="heading-16">4.1 è¿›ç¨‹çŠ¶æ€æœº</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/799354e4b136464eb7ce112a75efe333~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKQ5oCh5pe4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763385842&amp;x-signature=1bp13nVliHZAJyDntw1bR3%2Ftqds%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-17">4.2 é‡è¦æ€§è®¡ç®—ç®—æ³•</h3>
<h4 data-id="heading-18">4.2.1 åŸºç¡€é‡è¦æ€§åˆ†æ•°</h4>
<p>åŸºäºè¿›ç¨‹åŒ…å«çš„ç»„ä»¶ç±»å‹è®¡ç®—åŸºç¡€åˆ†æ•°ï¼š</p>
<p><strong>ç»„ä»¶æƒé‡</strong>ï¼š</p>
<ul>
<li>å‰å°Activityï¼š+100</li>
<li>å¯è§Activityï¼š+50</li>
<li>å‰å°æœåŠ¡ï¼š+30</li>
<li>ç»‘å®šæœåŠ¡ï¼š+20</li>
<li>å†…å®¹æä¾›è€…ï¼š+10</li>
<li>å¹¿æ’­æ¥æ”¶å™¨ï¼š+5</li>
</ul>
<h4 data-id="heading-19">4.2.2 åŠ¨æ€è°ƒæ•´å› ç´ </h4>
<p><strong>ç”¨æˆ·äº¤äº’å› ç´ </strong>ï¼š</p>
<ul>
<li>æœ€è¿‘ç”¨æˆ·äº¤äº’æ—¶é—´</li>
<li>äº¤äº’é¢‘ç‡å’ŒæŒç»­æ—¶é—´</li>
<li>ç”¨æˆ·æ˜¾å¼é‡è¦æ€§è®¾ç½®</li>
</ul>
<p><strong>ç³»ç»Ÿç­–ç•¥å› ç´ </strong>ï¼š</p>
<ul>
<li>ç”µæºç®¡ç†çŠ¶æ€</li>
<li>çƒ­çŠ¶æ€çº¦æŸ</li>
<li>ç³»ç»Ÿè´Ÿè½½æ°´å¹³</li>
</ul>
<h2 data-id="heading-20">äº”ã€å†…å­˜å›æ”¶ç­–ç•¥</h2>
<h3 data-id="heading-21">5.1 åˆ†å±‚å›æ”¶æœºåˆ¶</h3>
<h4 data-id="heading-22">5.1.1 åº”ç”¨å±‚å›æ”¶</h4>
<p><strong>ä¸»åŠ¨å†…å­˜é‡Šæ”¾</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ComponentCallbacks2æ¥å£</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">ComponentCallbacks2</span> {
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTrimMemory</span><span class="hljs-params">(<span class="hljs-type">int</span> level)</span>;  <span class="hljs-comment">// å†…å­˜ä¿®å‰ªé€šçŸ¥</span>
    <span class="hljs-keyword">void</span> <span class="hljs-title function_">onLowMemory</span><span class="hljs-params">()</span>;           <span class="hljs-comment">// ä½å†…å­˜é€šçŸ¥</span>
}
</code></pre>
<p><strong>ä¿®å‰ªçº§åˆ«</strong>ï¼š</p>
<ul>
<li>TRIM_MEMORY_COMPLETEï¼šè¿›ç¨‹å¯èƒ½å¾ˆå¿«è¢«æ€æ­»</li>
<li>TRIM_MEMORY_MODERATEï¼šå»ºè®®é‡Šæ”¾éå…³é”®èµ„æº</li>
<li>TRIM_MEMORY_BACKGROUNDï¼šé‡Šæ”¾å®¹æ˜“é‡å»ºçš„èµ„æº</li>
</ul>
<h4 data-id="heading-23">5.1.2 ç³»ç»Ÿå±‚å›æ”¶</h4>
<p><strong>ç¼“å­˜ç®¡ç†</strong>ï¼š</p>
<ul>
<li>æ–‡ä»¶ç³»ç»Ÿç¼“å­˜æ¸…ç†</li>
<li>å­—ä½“å’Œèµ„æºç¼“å­˜å›æ”¶</li>
<li>ZRAMå‹ç¼©å†…å­˜é‡Šæ”¾</li>
</ul>
<p><strong>æœåŠ¡é™çº§</strong>ï¼š</p>
<ul>
<li>å‡å°‘åå°æœåŠ¡è¿è¡Œé¢‘ç‡</li>
<li>é™åˆ¶å¹¿æ’­å‘é€</li>
<li>æ¨è¿Ÿéç´§æ€¥ä»»åŠ¡</li>
</ul>
<h3 data-id="heading-24">5.2 äº¤æ¢ä¸å‹ç¼©ç­–ç•¥</h3>
<h4 data-id="heading-25">5.2.1 ZRAMäº¤æ¢ä¼˜åŒ–</h4>
<p>Androidä½¿ç”¨å‹ç¼©çš„RAMä½œä¸ºäº¤æ¢è®¾å¤‡ï¼š</p>
<p><strong>å‹ç¼©ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>åŒ¿åé¡µé¢ä¼˜å…ˆå‹ç¼©</li>
<li>å†·é¡µé¢ä¼˜å…ˆæ¢å‡º</li>
<li>ä¿æŒçƒ­é¡µé¢åœ¨ç‰©ç†å†…å­˜</li>
</ul>
<p><strong>å‹ç¼©ç®—æ³•é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>LZ4ï¼šå¿«é€Ÿå‹ç¼©ï¼Œé€‚åˆäº¤äº’åœºæ™¯</li>
<li>LZOï¼šå¹³è¡¡å‹ç¼©æ¯”å’Œé€Ÿåº¦</li>
<li>ZSTDï¼šé«˜å‹ç¼©æ¯”ï¼Œé€‚åˆåå°ä»»åŠ¡</li>
</ul>
<h4 data-id="heading-26">5.2.2 KSMé¡µé¢åˆå¹¶</h4>
<p>å†…æ ¸åŒé¡µåˆå¹¶ä¼˜åŒ–é‡å¤å†…å­˜ï¼š</p>
<p><strong>åˆå¹¶ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>é›¶é¡µé¢ä¼˜å…ˆåˆå¹¶</li>
<li>åº“ä»£ç é¡µé¢åˆå¹¶</li>
<li>åº”ç”¨é—´å…±äº«èµ„æºåˆå¹¶</li>
</ul>
<h2 data-id="heading-27">å…­ã€è‡ªé€‚åº”ä¼˜åŒ–æœºåˆ¶</h2>
<h3 data-id="heading-28">6.1 å­¦ä¹ å‹å†…å­˜ç®¡ç†</h3>
<h4 data-id="heading-29">6.1.1 ä½¿ç”¨æ¨¡å¼åˆ†æ</h4>
<p><strong>ç”¨æˆ·è¡Œä¸ºå»ºæ¨¡</strong>ï¼š</p>
<ul>
<li>åº”ç”¨ä½¿ç”¨é¢‘ç‡å’Œæ—¶é•¿</li>
<li>å†…å­˜è®¿é—®æ¨¡å¼è¯†åˆ«</li>
<li>é¢„æµ‹æ€§å†…å­˜é¢„åˆ†é…</li>
</ul>
<p><strong>è‡ªé€‚åº”é˜ˆå€¼è°ƒæ•´</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">dynamic_threshold</span> = base_threshold Ã— usage_factor Ã— behavior_factor

<span class="hljs-attr">usage_factor</span> = f(historical_memory_usage)
<span class="hljs-attr">behavior_factor</span> = f(user_interaction_pattern)
</code></pre>
<h4 data-id="heading-30">6.1.2 é¢„æµ‹æ€§ç®¡ç†</h4>
<p><strong>å†…å­˜éœ€æ±‚é¢„æµ‹</strong>ï¼š</p>
<ul>
<li>åŸºäºå†å²æ•°æ®çš„åº”ç”¨å¯åŠ¨é¢„æµ‹</li>
<li>å‘¨æœŸæ€§ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´é¢„æµ‹</li>
<li>ç”¨æˆ·å·¥ä½œè´Ÿè½½æ¨¡å¼è¯†åˆ«</li>
</ul>
<h3 data-id="heading-31">6.2 è®¾å¤‡ç‰¹å®šä¼˜åŒ–</h3>
<h4 data-id="heading-32">6.2.1 å†…å­˜å®¹é‡é€‚é…</h4>
<p><strong>åˆ†çº§é…ç½®ç­–ç•¥</strong>ï¼š</p>
<ul>
<li>å°å†…å­˜è®¾å¤‡ï¼ˆ2GBä»¥ä¸‹ï¼‰ï¼šæ¿€è¿›å›æ”¶ç­–ç•¥</li>
<li>ä¸­ç­‰å†…å­˜è®¾å¤‡ï¼ˆ2-6GBï¼‰ï¼šå¹³è¡¡ç­–ç•¥</li>
<li>å¤§å†…å­˜è®¾å¤‡ï¼ˆ6GBä»¥ä¸Šï¼‰ï¼šå®½æ¾ç­–ç•¥</li>
</ul>
<h4 data-id="heading-33">6.2.2 ç¡¬ä»¶ç‰¹æ€§åˆ©ç”¨</h4>
<p><strong>å†…å­˜æ¶æ„ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li>NUMAæ„ŸçŸ¥çš„å†…å­˜åˆ†é…</li>
<li>å¤§é¡µé¢æ”¯æŒ</li>
<li>å†…å­˜å¸¦å®½ç®¡ç†</li>
</ul>
<h2 data-id="heading-34">ä¸ƒã€ç³»ç»Ÿç¨³å®šæ€§ä¿éšœ</h2>
<h3 data-id="heading-35">7.1 é˜²æŠ–åŠ¨æœºåˆ¶</h3>
<h4 data-id="heading-36">7.1.1 æ€è¿›ç¨‹é¢‘ç‡é™åˆ¶</h4>
<p>é˜²æ­¢è¿‡äºé¢‘ç¹çš„è¿›ç¨‹æ€æ­»å¯¼è‡´ç³»ç»Ÿä¸ç¨³å®šï¼š</p>
<p><strong>æ—¶é—´çª—å£é™åˆ¶</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">if (time_since_last_kill &lt; min_kill_interval) {
    <span class="hljs-built_in">delay_kill_decision</span>();
}
</code></pre>
<p><strong>æˆæœ¬æ•ˆç›Šåˆ†æ</strong>ï¼š</p>
<ul>
<li>è¯„ä¼°æ€è¿›ç¨‹çš„ç³»ç»Ÿå¼€é”€</li>
<li>è€ƒè™‘è¿›ç¨‹é‡å¯æˆæœ¬</li>
<li>å¹³è¡¡å†…å­˜æ”¶ç›Šä¸æ€§èƒ½æŸå¤±</li>
</ul>
<h4 data-id="heading-37">7.1.2 å…³é”®è¿›ç¨‹ä¿æŠ¤</h4>
<p><strong>ç³»ç»Ÿæ ¸å¿ƒæœåŠ¡</strong>ï¼š</p>
<ul>
<li>System Serverè¿›ç¨‹</li>
<li>è¾“å…¥æ³•æœåŠ¡</li>
<li>ç”µè¯æœåŠ¡</li>
<li>æ˜¾ç¤ºæœåŠ¡</li>
</ul>
<p><strong>ä¿æŠ¤æœºåˆ¶</strong>ï¼š</p>
<ul>
<li>æœ€ä½OOMè°ƒæ•´åˆ†æ•°</li>
<li>å†…å­˜ä½¿ç”¨é™åˆ¶è±å…</li>
<li>ç´§æ€¥æƒ…å†µç‰¹æ®Šå¤„ç†</li>
</ul>
<h3 data-id="heading-38">7.2 ç›‘æ§ä¸è¯Šæ–­</h3>
<h4 data-id="heading-39">7.2.1 å®æ—¶ç›‘æ§</h4>
<p><strong>æ€§èƒ½æŒ‡æ ‡æ”¶é›†</strong>ï¼š</p>
<ul>
<li>LMKè§¦å‘é¢‘ç‡å’Œæ—¶æœº</li>
<li>è¿›ç¨‹æ€æ­»ç»Ÿè®¡ä¿¡æ¯</li>
<li>å†…å­˜å‹åŠ›æŒç»­æ—¶é—´</li>
<li>ç”¨æˆ·æ„ŸçŸ¥çš„å¡é¡¿æƒ…å†µ</li>
</ul>
<h4 data-id="heading-40">7.2.2 é—®é¢˜è¯Šæ–­</h4>
<p><strong>å†…å­˜æ³„æ¼æ£€æµ‹</strong>ï¼š</p>
<ul>
<li>å¯ç–‘çš„å†…å­˜å¢é•¿æ¨¡å¼è¯†åˆ«</li>
<li>å¼•ç”¨é“¾åˆ†æ</li>
<li>æ³„æ¼æ¨¡å¼åˆ†ç±»</li>
</ul>
<h2 data-id="heading-41">æŠ€æœ¯æ€»ç»“</h2>
<p>Androidä½å†…å­˜ç®¡ç†æœºåˆ¶æ˜¯ä¸€ä¸ªå¤æ‚è€Œç²¾å¯†çš„ç³»ç»Ÿï¼Œé€šè¿‡å¤šå±‚æ¬¡åä½œåœ¨æœ‰é™çš„å†…å­˜èµ„æºä¸‹ç»´æŒç³»ç»Ÿæ€§èƒ½å’Œç¨³å®šæ€§ã€‚å…¶æ ¸å¿ƒåˆ›æ–°åœ¨äºï¼š</p>
<ol>
<li><strong>æ™ºèƒ½çš„è¿›ç¨‹é‡è¦æ€§è¯„ä¼°</strong>ï¼šåŸºäºç”¨æˆ·äº¤äº’å’Œç³»ç»ŸçŠ¶æ€çš„åŠ¨æ€è¯„åˆ†</li>
<li><strong>åˆ†çº§çš„å‹åŠ›å“åº”</strong>ï¼šä»æ¸©å’Œçš„èµ„æºå›æ”¶åˆ°æ¿€è¿›çš„è¿›ç¨‹æ€æ­»</li>
<li><strong>è‡ªé€‚åº”çš„é˜ˆå€¼è°ƒæ•´</strong>ï¼šåŸºäºä½¿ç”¨æ¨¡å¼å’Œè®¾å¤‡ç‰¹æ€§çš„åŠ¨æ€ä¼˜åŒ–</li>
<li><strong>ç³»ç»Ÿç¨³å®šæ€§ä¿éšœ</strong>ï¼šé˜²æ­¢è¿‡åº¦å›æ”¶å’Œå…³é”®æœåŠ¡ä¿æŠ¤</li>
</ol>
<p>è¿™å¥—æœºåˆ¶ä½¿å¾—Androidèƒ½å¤Ÿåœ¨å„ç§å†…å­˜çº¦æŸæ¡ä»¶ä¸‹æä¾›ä¸€è‡´çš„ç”¨æˆ·ä½“éªŒï¼Œæ˜¯ç§»åŠ¨æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†çš„å…¸èŒƒå®ç°ã€‚éšç€è®¾å¤‡å†…å­˜å®¹é‡çš„å¢é•¿å’Œç”¨æˆ·éœ€æ±‚çš„æå‡ï¼Œä½å†…å­˜ç®¡ç†æœºåˆ¶ä»åœ¨æŒç»­æ¼”è¿›ï¼Œä»¥æ›´å¥½åœ°å¹³è¡¡æ€§èƒ½ã€åŠŸè€—å’Œç”¨æˆ·ä½“éªŒã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ]]></title>    <link>https://juejin.cn/post/7570923924364853311</link>    <guid>https://juejin.cn/post/7570923924364853311</guid>    <pubDate>2025-11-10T13:26:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570923924364853311" data-draft-id="7571060853353824266" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ"/> <meta itemprop="keywords" content="Android,Linux"/> <meta itemprop="datePublished" content="2025-11-10T13:26:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="WAsbry"/> <meta itemprop="url" content="https://juejin.cn/user/3413335797139511"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3413335797139511/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    WAsbry
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:26:16.000Z" title="Mon Nov 10 2025 13:26:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»13åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">InputConnectionæœºåˆ¶ä¸è·¨è¿›ç¨‹æ–‡æœ¬æ“ä½œçš„å·¥ç¨‹å®è·µ</h2>
<h3 data-id="heading-1">ğŸ’¡ æœ¬æ–‡ç²¾å</h3>
<ul>
<li><strong>æ‰¿æ¥å‰æ–‡</strong>ï¼šç¬¬ä¸€ç¯‡è®²Binderé€šä¿¡ï¼Œç¬¬äºŒç¯‡è®²è®¾è®¡ç¼ºé™·ï¼Œæœ¬ç¯‡ç»™å‡ºå®Œæ•´çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆ</li>
<li><strong>æ ¸å¿ƒéœ€æ±‚</strong>ï¼šæ—¢ä¿ç•™æ•°å­—é”®ç›˜ï¼ˆinputType="number"ï¼‰ï¼Œåˆé¿å…å­—æ¯è¾“å…¥å¯¼è‡´æ•°å­—ä¸¢å¤±</li>
<li><strong>æœ€ä½³æ–¹æ¡ˆ</strong>ï¼šè‡ªå®šä¹‰InputConnectionåœ¨<code>setComposingText()</code>å±‚æ‹¦æˆªéæ³•å­—ç¬¦ï¼Œé˜»æ­¢è¿›å…¥delete-insertæµç¨‹</li>
<li><strong>ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”</strong>ï¼šInputConnectionæ‹¦æˆªï¼ˆæ¨èâ­â­â­â­â­ï¼‰ã€TextWatcherè¿‡æ»¤ï¼ˆâ­â­â­ï¼‰ã€è‡ªå®šä¹‰InputFilterï¼ˆâ­â­â­â­ï¼‰</li>
<li><strong>ä»·å€¼</strong>ï¼šæä¾›å¯ç›´æ¥ä½¿ç”¨çš„å®Œæ•´ä»£ç ï¼Œåˆ†ææ–¹æ¡ˆä¼˜åŠ£ï¼ŒæŒ‡å¯¼å·¥ç¨‹å®è·µ</li>
</ul>
<hr/>
<h3 data-id="heading-2">ä¸€ã€éœ€æ±‚åˆ†æä¸çº¦æŸæ¡ä»¶</h3>
<h4 data-id="heading-3">1.1 æ ¸å¿ƒéœ€æ±‚</h4>
<pre><code class="hljs language-markdown" lang="markdown">ç”¨æˆ·éœ€æ±‚:
<span class="hljs-bullet">1.</span> ç‚¹å‡»EditTextæ—¶ï¼Œå¼¹å‡ºæ•°å­—é”®ç›˜ï¼ˆä¸æ˜¯å…¨é”®ç›˜ï¼‰
<span class="hljs-bullet">2.</span> åªå…è®¸è¾“å…¥æ•°å­—å­—ç¬¦
<span class="hljs-bullet">3.</span> åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜è¾“å…¥å­—æ¯æ—¶ï¼Œä¸åº”å¯¼è‡´å·²æœ‰æ•°å­—ä¸¢å¤±

æŠ€æœ¯çº¦æŸ:
<span class="hljs-bullet">1.</span> å¿…é¡»ä½¿ç”¨ android:inputType="number" (ä¿è¯æ•°å­—é”®ç›˜)
<span class="hljs-bullet">2.</span> ä¸èƒ½ä¿®æ”¹Androidæ¡†æ¶ä»£ç 
<span class="hljs-bullet">3.</span> éœ€è¦å…¼å®¹ä¸»æµè¾“å…¥æ³•ï¼ˆç™¾åº¦ã€æœç‹—ã€è®¯é£ç­‰ï¼‰
<span class="hljs-bullet">4.</span> æ€§èƒ½å¼€é”€è¦å°
</code></pre>
<h4 data-id="heading-4">1.2 é—®é¢˜å›é¡¾</h4>
<p><strong>å‰ä¸¤ç¯‡å·²åˆ†æçš„æ ¹æœ¬åŸå› </strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">è¾“å…¥æ³•è¿›ç¨‹:
  ic.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC
åº”ç”¨è¿›ç¨‹:
  BaseInputConnection.<span class="hljs-built_in">replaceText</span>(<span class="hljs-string">"qq"</span>, <span class="hljs-number">1</span>, true)
  â†“
  <span class="hljs-number">1</span>. <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ æˆåŠŸï¼ˆç»•è¿‡InputFilterï¼‰
  <span class="hljs-number">2</span>. <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â†’ å¤±è´¥ï¼ˆè¢«DigitsKeyListeneræ‹’ç»ï¼‰
  â†“
  ç»“æœ: æ•°æ®ä¸¢å¤±
</code></pre>
<p><strong>è§£å†³æ–¹å‘</strong>ï¼š</p>
<ul>
<li>åœ¨deleteæ‰§è¡Œä¹‹å‰æ‹¦æˆª</li>
<li>åˆ¤æ–­æ–°æ–‡æœ¬æ˜¯å¦åˆæ³•</li>
<li>å¦‚æœéæ³•ï¼Œä¸è¿›å…¥delete-insertæµç¨‹</li>
</ul>
<hr/>
<h3 data-id="heading-5">äºŒã€è§£å†³æ–¹æ¡ˆä¸€ï¼šInputConnectionæ‹¦æˆªï¼ˆæ¨èâ­â­â­â­â­ï¼‰</h3>
<h4 data-id="heading-6">2.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs language-css" lang="css">åŸå§‹æµç¨‹ï¼ˆæœ‰Bugï¼‰:
<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
  â†’ <span class="hljs-built_in">replaceText</span>()
  â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â† åˆ é™¤æ•°å­—
  â†’ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â† è¢«æ‹’ç»
  â†’ Bug!

ä¼˜åŒ–åæµç¨‹:
<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
  â†’ NumberInputConnectionWrapper.<span class="hljs-built_in">setComposingText</span>()
  â†’ æ£€æµ‹åˆ°å­—æ¯ <span class="hljs-string">'q'</span>
  â†’ è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>() â† ç›´æ¥å®Œæˆç»„åˆï¼Œä¸æ‰§è¡Œdelete-insert
  â†’ æ•°å­—ä¿æŒä¸å˜ âœ“
</code></pre>
<h4 data-id="heading-7">2.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecommendedNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-comment">// è·å–çˆ¶ç±»åˆ›å»ºçš„InputConnection</span>
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// åŒ…è£…æˆæˆ‘ä»¬çš„è‡ªå®šä¹‰InputConnection</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputConnectionåŒ…è£…ç±»
     * æ‹¦æˆªsetComposingTextï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">NumberInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-comment">// å…³é”®ï¼šåœ¨æ‰§è¡Œdelete-insertä¹‹å‰æ£€æŸ¥</span>
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-comment">// åŒ…å«éæ•°å­—å­—ç¬¦ï¼Œç›´æ¥å®Œæˆç»„åˆï¼ˆä¸æ‰§è¡Œdelete-insertï¼‰</span>
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }

            <span class="hljs-comment">// çº¯æ•°å­—æˆ–nullï¼Œæ­£å¸¸å¤„ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-comment">/**
         * æ£€æŸ¥CharSequenceæ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
                <span class="hljs-keyword">if</span> (!Character.isDigit(c)) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// å‘ç°éæ•°å­—å­—ç¬¦</span>
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// å…¨éƒ¨æ˜¯æ•°å­—</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-8">2.3 ä½¿ç”¨æ–¹æ³•</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- activity_main.xml --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">com.yourpackage.RecommendedNumberEditText</span>
    <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_number"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
    <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span>
    <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span> /&gt;</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// MainActivity.java</span>
<span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> findViewById(R.id.edit_number);
<span class="hljs-comment">// æ­£å¸¸ä½¿ç”¨ï¼Œæ— éœ€é¢å¤–ä»£ç </span>
</code></pre>
<h4 data-id="heading-9">2.4 æ–¹æ¡ˆä¼˜åŠ¿</h4>

































<table><thead><tr><th>ä¼˜åŠ¿</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>æ‹¦æˆªæ—¶æœºæ—©</strong></td><td>åœ¨deleteä¹‹å‰æ‹¦æˆªï¼Œä»æºå¤´è§£å†³é—®é¢˜</td></tr><tr><td><strong>æ€§èƒ½æœ€ä¼˜</strong></td><td>ä¸æ‰§è¡Œdelete-insertï¼Œé¿å…æ— æ•ˆæ“ä½œ</td></tr><tr><td><strong>å¯¹è¾“å…¥æ³•é€æ˜</strong></td><td>è¿”å›trueï¼Œè¾“å…¥æ³•è®¤ä¸ºæˆåŠŸï¼Œä¸å½±å“æ­£å¸¸æµç¨‹</td></tr><tr><td><strong>ä¸å½±å“æ­£å¸¸è¾“å…¥</strong></td><td>æ•°å­—è¾“å…¥ä¸å—å½±å“ï¼Œä»èµ°åŸæœ‰é€»è¾‘</td></tr><tr><td><strong>ä»£ç ç®€æ´</strong></td><td>åªéœ€é‡å†™ä¸€ä¸ªæ–¹æ³•</td></tr><tr><td><strong>æ•°å­—é”®ç›˜ä¿ç•™</strong></td><td>inputType="number"ä¿è¯æ•°å­—é”®ç›˜å¼¹å‡º</td></tr></tbody></table>
<h4 data-id="heading-10">2.5 å·¥ä½œæµç¨‹å›¾</h4>
<pre><code class="hljs language-css" lang="css">ç”¨æˆ·æ“ä½œï¼š
  è¾“å…¥æ•°å­— "<span class="hljs-number">123456</span>"
  â†“
  åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜
  â†“
  ç‚¹å‡» '<span class="hljs-selector-tag">q</span>'

è¾“å…¥æ³•è¿›ç¨‹:
  ic.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“ Binder IPC

åº”ç”¨è¿›ç¨‹:
  NumberInputConnectionWrapper.<span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"q"</span>, <span class="hljs-number">1</span>)
  â†“
  <span class="hljs-built_in">containsNonDigit</span>(<span class="hljs-string">"q"</span>) â†’ true (æ£€æµ‹åˆ°å­—æ¯)
  â†“
  è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>()
  â†“
  BaseInputConnection.<span class="hljs-built_in">finishComposingText</span>()
    - ç§»é™¤COMPOSING Span
    - ä¸æ‰§è¡Œdelete
    - ä¸æ‰§è¡Œinsert
  â†“
  è¿”å› true
  â†“
  å†…å®¹ä¿æŒ <span class="hljs-string">"123456"</span> âœ“

ç»§ç»­ç‚¹å‡» <span class="hljs-string">'q'</span>:
  åŒæ ·æµç¨‹ï¼Œæ¯æ¬¡éƒ½è°ƒç”¨ <span class="hljs-built_in">finishComposingText</span>()
  å†…å®¹å§‹ç»ˆä¿æŒ <span class="hljs-string">"123456"</span> âœ“
</code></pre>
<hr/>
<h3 data-id="heading-11">ä¸‰ã€è§£å†³æ–¹æ¡ˆäºŒï¼šTextWatcherè¿‡æ»¤ï¼ˆâ­â­â­ï¼‰</h3>
<h4 data-id="heading-12">3.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs">åŸç†ï¼š
ä¸ä¾èµ–InputFilterï¼Œè€Œæ˜¯ç›‘å¬æ–‡æœ¬å˜åŒ–
åœ¨æ–‡æœ¬æ”¹å˜åï¼Œè¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦
</code></pre>
<h4 data-id="heading-13">3.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SimpleNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">isFiltering</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// é˜²æ­¢é€’å½’</span>

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SimpleNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// ä¸è®¾ç½®inputTypeä¸ºnumberï¼Œé¿å…DigitsKeyListener</span>
        <span class="hljs-comment">// ä½†ä¼šä¸¢å¤±æ•°å­—é”®ç›˜ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½®</span>
        setRawInputType(InputType.TYPE_CLASS_NUMBER);

        addTextChangedListener(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextWatcher</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">beforeTextChanged</span><span class="hljs-params">(CharSequence s, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> count, <span class="hljs-type">int</span> after)</span> {
                <span class="hljs-comment">// ä¸éœ€è¦å¤„ç†</span>
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onTextChanged</span><span class="hljs-params">(CharSequence s, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> before, <span class="hljs-type">int</span> count)</span> {
                <span class="hljs-comment">// ä¸éœ€è¦å¤„ç†</span>
            }

            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterTextChanged</span><span class="hljs-params">(Editable s)</span> {
                <span class="hljs-keyword">if</span> (isFiltering) {
                    <span class="hljs-keyword">return</span>; <span class="hljs-comment">// é¿å…é€’å½’</span>
                }

                <span class="hljs-comment">// è¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> s.toString().replaceAll(<span class="hljs-string">"[^0-9]"</span>, <span class="hljs-string">""</span>);

                <span class="hljs-keyword">if</span> (!s.toString().equals(filtered)) {
                    isFiltering = <span class="hljs-literal">true</span>;

                    <span class="hljs-comment">// ä¿å­˜å…‰æ ‡ä½ç½®</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">cursorPos</span> <span class="hljs-operator">=</span> getSelectionStart();
                    <span class="hljs-type">int</span> <span class="hljs-variable">lengthBefore</span> <span class="hljs-operator">=</span> s.length();

                    <span class="hljs-comment">// æ›¿æ¢ä¸ºè¿‡æ»¤åçš„å†…å®¹</span>
                    setText(filtered);

                    <span class="hljs-comment">// è°ƒæ•´å…‰æ ‡ä½ç½®</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">lengthAfter</span> <span class="hljs-operator">=</span> filtered.length();
                    <span class="hljs-type">int</span> <span class="hljs-variable">diff</span> <span class="hljs-operator">=</span> lengthBefore - lengthAfter;
                    <span class="hljs-type">int</span> <span class="hljs-variable">newCursorPos</span> <span class="hljs-operator">=</span> Math.max(<span class="hljs-number">0</span>, cursorPos - diff);
                    setSelection(Math.min(newCursorPos, filtered.length()));

                    isFiltering = <span class="hljs-literal">false</span>;
                }
            }
        });
    }
}
</code></pre>
<h4 data-id="heading-14">3.3 æ–¹æ¡ˆä¼˜åŠ£</h4>





























<table><thead><tr><th>ç»´åº¦</th><th>è¯„ä»·</th></tr></thead><tbody><tr><td><strong>ä¼˜ç‚¹</strong></td><td>å®ç°ç®€å•ï¼Œæ˜“äºç†è§£</td></tr><tr><td><strong>ä¼˜ç‚¹</strong></td><td>ä¸ä¾èµ–InputConnectionï¼Œé€»è¾‘ç‹¬ç«‹</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>éœ€è¦é¢å¤–çš„setTextæ“ä½œï¼Œæ€§èƒ½ç•¥å·®</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>å…‰æ ‡ä½ç½®å¤„ç†å¤æ‚</td></tr><tr><td><strong>ç¼ºç‚¹</strong></td><td>ä¼šè§¦å‘é¢å¤–çš„TextWatcherå›è°ƒ</td></tr></tbody></table>
<h4 data-id="heading-15">3.4 æ€§èƒ½å¯¹æ¯”</h4>
<pre><code class="hljs language-css" lang="css">æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰:
  <span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
    â†’ æ£€æµ‹åˆ°å­—æ¯
    â†’ <span class="hljs-built_in">finishComposingText</span>()
    â†’ <span class="hljs-number">1</span>æ¬¡æ“ä½œ

æ–¹æ¡ˆäºŒï¼ˆTextWatcherï¼‰:
  <span class="hljs-built_in">setComposingText</span>(<span class="hljs-string">"qq"</span>)
    â†’ <span class="hljs-built_in">delete</span>(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>) â†’ åˆ é™¤<span class="hljs-string">'6'</span>
    â†’ <span class="hljs-built_in">insert</span>(<span class="hljs-string">"qq"</span>) â†’ è¢«æ‹’ç»
    â†’ afterTextChangedè§¦å‘
    â†’ <span class="hljs-built_in">setText</span>(<span class="hljs-string">"123456"</span>) â†’ æ¢å¤
    â†’ <span class="hljs-number">3</span>æ¬¡æ“ä½œ

æ€§èƒ½å·®è·ï¼šæ–¹æ¡ˆäºŒçº¦<span class="hljs-number">3</span>å€äºæ–¹æ¡ˆä¸€
</code></pre>
<hr/>
<h3 data-id="heading-16">å››ã€è§£å†³æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰InputFilterï¼ˆâ­â­â­â­ï¼‰</h3>
<h4 data-id="heading-17">4.1 æ ¸å¿ƒæ€è·¯</h4>
<pre><code class="hljs language-sql" lang="sql">åŸç†ï¼š
ä¸ä»…æ‹¦æˆª<span class="hljs-keyword">insert</span>ï¼Œä¹Ÿæ‹¦æˆª<span class="hljs-keyword">delete</span>
é€šè¿‡åˆ¤æ–­sourceæ˜¯å¦ä¸ºç©ºæ¥åŒºåˆ†æ“ä½œç±»å‹
</code></pre>
<h4 data-id="heading-18">4.2 å®Œæ•´å®ç°ä»£ç </h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
        init();
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
        init();
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// è®¾ç½®è‡ªå®šä¹‰Filterï¼Œæ›¿æ¢ç³»ç»Ÿçš„DigitsKeyListener</span>
        setFilters(<span class="hljs-keyword">new</span> <span class="hljs-title class_">InputFilter</span>[]{<span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeNumberInputFilter</span>()});
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-comment">// åŒæ—¶ä½¿ç”¨InputConnectionæ‹¦æˆªï¼ˆåŒé‡ä¿æŠ¤ï¼‰</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SafeInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputFilter
     * æ‹¦æˆªéæ•°å­—å­—ç¬¦çš„æ’å…¥
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeNumberInputFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputFilter</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
            <span class="hljs-comment">// è¿‡æ»¤æ‰éæ•°å­—å­—ç¬¦</span>
            <span class="hljs-type">StringBuilder</span> <span class="hljs-variable">filtered</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuilder</span>();
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> start; i &lt; end; i++) {
                <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> source.charAt(i);
                <span class="hljs-keyword">if</span> (Character.isDigit(c)) {
                    filtered.append(c);
                }
            }

            <span class="hljs-comment">// å¦‚æœå…¨éƒ¨è¢«è¿‡æ»¤æ‰ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²</span>
            <span class="hljs-keyword">if</span> (filtered.length() == <span class="hljs-number">0</span> &amp;&amp; end &gt; start) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
            }

            <span class="hljs-comment">// å¦‚æœæœ‰å­—ç¬¦è¢«è¿‡æ»¤æ‰ï¼Œè¿”å›è¿‡æ»¤åçš„å†…å®¹</span>
            <span class="hljs-keyword">if</span> (filtered.length() &lt; (end - start)) {
                <span class="hljs-keyword">return</span> filtered.toString();
            }

            <span class="hljs-comment">// å…¨éƒ¨åˆæ³•ï¼Œè¿”å›nullï¼ˆæ¥å—åŸå§‹å†…å®¹ï¼‰</span>
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
    }

    <span class="hljs-comment">/**
     * InputConnectionåŒ…è£…ç±»
     * ä½œä¸ºç¬¬äºŒå±‚é˜²æŠ¤
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SafeInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">SafeInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-19">4.3 æ–¹æ¡ˆç‰¹ç‚¹</h4>

























<table><thead><tr><th>ç‰¹ç‚¹</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><strong>åŒé‡ä¿æŠ¤</strong></td><td>InputFilter + InputConnectionä¸¤å±‚æ‹¦æˆª</td></tr><tr><td><strong>çµæ´»æ€§é«˜</strong></td><td>å¯ä»¥è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚å…è®¸å°æ•°ç‚¹ï¼‰</td></tr><tr><td><strong>å…¼å®¹æ€§å¥½</strong></td><td>é€‚é…å„ç§è¾“å…¥åœºæ™¯</td></tr><tr><td><strong>ä»£ç å¤æ‚</strong></td><td>éœ€è¦åŒæ—¶å®ç°Filterå’ŒWrapper</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-20">äº”ã€ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”ä¸é€‰å‹æŒ‡å—</h3>
<h4 data-id="heading-21">5.1 å…¨é¢å¯¹æ¯”</h4>





















































<table><thead><tr><th>ç»´åº¦</th><th>æ–¹æ¡ˆä¸€ï¼šInputConnection</th><th>æ–¹æ¡ˆäºŒï¼šTextWatcher</th><th>æ–¹æ¡ˆä¸‰ï¼šè‡ªå®šä¹‰Filter</th></tr></thead><tbody><tr><td><strong>å®ç°å¤æ‚åº¦</strong></td><td>â­â­ (ç®€å•)</td><td>â­ (æœ€ç®€å•)</td><td>â­â­â­â­ (å¤æ‚)</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>â­â­â­â­â­ (æœ€ä¼˜)</td><td>â­â­â­ (ä¸€èˆ¬)</td><td>â­â­â­â­ (å¥½)</td></tr><tr><td><strong>æ‹¦æˆªæ—¶æœº</strong></td><td>æ—©ï¼ˆdeleteä¹‹å‰ï¼‰</td><td>æ™šï¼ˆæ–‡æœ¬å·²æ”¹å˜ï¼‰</td><td>æ—©ï¼ˆä½†æœ‰å±€é™ï¼‰</td></tr><tr><td><strong>æ•°å­—é”®ç›˜</strong></td><td>âœ“ è‡ªåŠ¨</td><td>âœ“ æ‰‹åŠ¨è®¾ç½®</td><td>âœ“ è‡ªåŠ¨</td></tr><tr><td><strong>å…‰æ ‡å¤„ç†</strong></td><td>âœ“ è‡ªåŠ¨</td><td>âœ— éœ€æ‰‹åŠ¨</td><td>âœ“ è‡ªåŠ¨</td></tr><tr><td><strong>ä»£ç é‡</strong></td><td>~40è¡Œ</td><td>~60è¡Œ</td><td>~80è¡Œ</td></tr><tr><td><strong>æ¨èåº¦</strong></td><td>â­â­â­â­â­</td><td>â­â­â­</td><td>â­â­â­â­</td></tr></tbody></table>
<h4 data-id="heading-22">5.2 é€‰å‹å»ºè®®</h4>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">åœºæ™¯1: æ™®é€šæ•°å­—è¾“å…¥æ¡†</span>
  æ¨è: æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰
  ç†ç”±: æ€§èƒ½æœ€ä¼˜ï¼Œä»£ç æœ€ç®€æ´

<span class="hljs-section">åœºæ™¯2: éœ€è¦è‡ªå®šä¹‰è¿‡æ»¤è§„åˆ™ï¼ˆå¦‚ç”µè¯å·ç ï¼šæ•°å­— + '-'ï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸‰ï¼ˆè‡ªå®šä¹‰Filter + InputConnectionï¼‰
  ç†ç”±: çµæ´»æ€§é«˜ï¼Œå¯è‡ªå®šä¹‰allowedå­—ç¬¦é›†

<span class="hljs-section">åœºæ™¯3: å¿«é€ŸåŸå‹å¼€å‘</span>
  æ¨è: æ–¹æ¡ˆäºŒï¼ˆTextWatcherï¼‰
  ç†ç”±: æœ€ç®€å•ï¼Œå¿«é€Ÿå®ç°

<span class="hljs-section">åœºæ™¯4: é«˜æ€§èƒ½è¦æ±‚ï¼ˆå¦‚å¤§é‡EditTextï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸€ï¼ˆInputConnectionæ‹¦æˆªï¼‰
  ç†ç”±: æ€§èƒ½å¼€é”€æœ€å°

<span class="hljs-section">åœºæ™¯5: å¤æ‚è¾“å…¥éªŒè¯ï¼ˆå¦‚é‡‘é¢ï¼šæ•°å­— + å°æ•°ç‚¹ï¼Œæœ€å¤š2ä½å°æ•°ï¼‰</span>
  æ¨è: æ–¹æ¡ˆä¸‰ï¼ˆè‡ªå®šä¹‰Filterï¼‰
  ç†ç”±: å¯ä»¥åœ¨filter()ä¸­å®ç°å¤æ‚è§„åˆ™
</code></pre>
<h4 data-id="heading-23">5.3 å®é™…é¡¹ç›®ä¸­çš„ä½¿ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// ç¤ºä¾‹ï¼šé‡‘é¢è¾“å…¥æ¡†ï¼ˆå…è®¸æ•°å­—å’Œå°æ•°ç‚¹ï¼Œæœ€å¤š2ä½å°æ•°ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MoneyInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MoneyInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦ç¬¦åˆé‡‘é¢æ ¼å¼</span>
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; !isValidMoneyInput(text)) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidMoneyInput</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-comment">// å…è®¸ï¼šæ•°å­—ã€å°æ•°ç‚¹</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">str</span> <span class="hljs-operator">=</span> text.toString();
            <span class="hljs-comment">// ç®€å•éªŒè¯ï¼šåªåŒ…å«[0-9.]</span>
            <span class="hljs-keyword">return</span> str.matches(<span class="hljs-string">"[0-9.]*"</span>);
        }
    }

    <span class="hljs-comment">// å¯ä»¥é…åˆInputFilteråšæ›´å¤æ‚çš„éªŒè¯ï¼ˆå¦‚æœ€å¤š2ä½å°æ•°ï¼‰</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MoneyInputFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">InputFilter</span> {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> CharSequence <span class="hljs-title function_">filter</span><span class="hljs-params">(CharSequence source, <span class="hljs-type">int</span> start, <span class="hljs-type">int</span> end,
                                   Spanned dest, <span class="hljs-type">int</span> dstart, <span class="hljs-type">int</span> dend)</span> {
            <span class="hljs-comment">// ç»„åˆåçš„å®Œæ•´æ–‡æœ¬</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">beforeInsert</span> <span class="hljs-operator">=</span> dest.subSequence(<span class="hljs-number">0</span>, dstart).toString();
            <span class="hljs-type">String</span> <span class="hljs-variable">afterInsert</span> <span class="hljs-operator">=</span> dest.subSequence(dend, dest.length()).toString();
            <span class="hljs-type">String</span> <span class="hljs-variable">newText</span> <span class="hljs-operator">=</span> beforeInsert + source.subSequence(start, end) + afterInsert;

            <span class="hljs-comment">// éªŒè¯ï¼šæœ€å¤šä¸€ä¸ªå°æ•°ç‚¹</span>
            <span class="hljs-keyword">if</span> (newText.indexOf(<span class="hljs-string">'.'</span>) != newText.lastIndexOf(<span class="hljs-string">'.'</span>)) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// æ‹’ç»ï¼ˆå¤šä¸ªå°æ•°ç‚¹ï¼‰</span>
            }

            <span class="hljs-comment">// éªŒè¯ï¼šå°æ•°ç‚¹åæœ€å¤š2ä½</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">dotIndex</span> <span class="hljs-operator">=</span> newText.indexOf(<span class="hljs-string">'.'</span>);
            <span class="hljs-keyword">if</span> (dotIndex != -<span class="hljs-number">1</span> &amp;&amp; newText.length() - dotIndex &gt; <span class="hljs-number">3</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>; <span class="hljs-comment">// æ‹’ç»ï¼ˆè¶…è¿‡2ä½å°æ•°ï¼‰</span>
            }

            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// æ¥å—</span>
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-24">å…­ã€å·¥ç¨‹å®è·µçš„æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-25">6.1 æ€§èƒ½ç›‘æ§</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MonitoredInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MonitoredInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">MonitoredInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-type">long</span> <span class="hljs-variable">startTime</span> <span class="hljs-operator">=</span> System.nanoTime();

            <span class="hljs-type">boolean</span> result;
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                result = <span class="hljs-built_in">super</span>.finishComposingText();
            } <span class="hljs-keyword">else</span> {
                result = <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
            }

            <span class="hljs-type">long</span> <span class="hljs-variable">duration</span> <span class="hljs-operator">=</span> System.nanoTime() - startTime;
            <span class="hljs-keyword">if</span> (duration &gt; <span class="hljs-number">1_000_000</span>) { <span class="hljs-comment">// è¶…è¿‡1ms</span>
                Log.w(<span class="hljs-string">"InputMonitor"</span>, <span class="hljs-string">"setComposingText slow: "</span> + duration / <span class="hljs-number">1_000_000.0</span> + <span class="hljs-string">"ms"</span>);
            }

            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<h4 data-id="heading-26">6.2 æ—¥å¿—è°ƒè¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TAG</span> <span class="hljs-operator">=</span> <span class="hljs-string">"DebugNumberEditText"</span>;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DebugInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">DebugInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            Log.d(TAG, <span class="hljs-string">"setComposingText: text='"</span> + text + <span class="hljs-string">"', cursor="</span> + newCursorPosition);

            <span class="hljs-type">boolean</span> <span class="hljs-variable">hasNonDigit</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                    <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
                    <span class="hljs-keyword">if</span> (!Character.isDigit(c)) {
                        hasNonDigit = <span class="hljs-literal">true</span>;
                        Log.w(TAG, <span class="hljs-string">"  Detected non-digit: '"</span> + c + <span class="hljs-string">"' at index "</span> + i);
                    }
                }
            }

            <span class="hljs-type">boolean</span> result;
            <span class="hljs-keyword">if</span> (hasNonDigit) {
                Log.d(TAG, <span class="hljs-string">"  Action: finishComposingText() (rejecting non-digit input)"</span>);
                result = <span class="hljs-built_in">super</span>.finishComposingText();
            } <span class="hljs-keyword">else</span> {
                Log.d(TAG, <span class="hljs-string">"  Action: setComposingText() (accepting digit input)"</span>);
                result = <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
            }

            Log.d(TAG, <span class="hljs-string">"  Result: "</span> + result);
            <span class="hljs-keyword">return</span> result;
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">commitText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            Log.d(TAG, <span class="hljs-string">"commitText: text='"</span> + text + <span class="hljs-string">"', cursor="</span> + newCursorPosition);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.commitText(text, newCursorPosition);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">finishComposingText</span><span class="hljs-params">()</span> {
            Log.d(TAG, <span class="hljs-string">"finishComposingText"</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
        }
    }
}
</code></pre>
<h4 data-id="heading-27">6.3 å•å…ƒæµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RunWith(RobolectricTestRunner.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberEditTextTest</span> {

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testDigitInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•æ­£å¸¸æ•°å­—è¾“å…¥</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"456"</span>, <span class="hljs-number">1</span>);

        assertEquals(<span class="hljs-string">"123456"</span>, editText.getText().toString());
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testLetterInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•å­—æ¯è¾“å…¥ï¼ˆåº”è¯¥è¢«æ‹’ç»ï¼‰</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"abc"</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// å†…å®¹ä¸åº”è¯¥å˜åŒ–</span>
        assertEquals(<span class="hljs-string">"123"</span>, editText.getText().toString());
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testMixedInput</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æµ‹è¯•æ··åˆè¾“å…¥</span>
        <span class="hljs-type">RecommendedNumberEditText</span> <span class="hljs-variable">editText</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RecommendedNumberEditText</span>(ApplicationProvider.getApplicationContext());
        editText.setText(<span class="hljs-string">"123"</span>);

        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">ic</span> <span class="hljs-operator">=</span> editText.onCreateInputConnection(<span class="hljs-keyword">new</span> <span class="hljs-title class_">EditorInfo</span>());
        ic.setComposingText(<span class="hljs-string">"4a5"</span>, <span class="hljs-number">1</span>);

        <span class="hljs-comment">// åŒ…å«å­—æ¯ï¼Œåº”è¯¥è¢«æ‹’ç»</span>
        assertEquals(<span class="hljs-string">"123"</span>, editText.getText().toString());
    }
}
</code></pre>
<h4 data-id="heading-28">6.4 å…¼å®¹æ€§æµ‹è¯•</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">/**
 * æµ‹è¯•ä¸åŒè¾“å…¥æ³•çš„å…¼å®¹æ€§
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IMECompatibilityTest</span> {

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testBaiduIME</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿç™¾åº¦è¾“å…¥æ³•çš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSogouIME</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹Ÿæœç‹—è¾“å…¥æ³•çš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-meta">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testGboard</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// æ¨¡æ‹ŸGoogle Gboardçš„è¡Œä¸º</span>
        <span class="hljs-comment">// ...</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-29">ä¸ƒã€å¸¸è§é—®é¢˜ä¸è§£ç­”</h3>
<h4 data-id="heading-30">7.1 ä¸ºä»€ä¹ˆä¸ç›´æ¥å»æ‰inputType="number"ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šå»æ‰inputTypeåï¼Œä¸ä¼šæœ‰Bugï¼Œä¸ºä»€ä¹ˆä¸è¿™æ ·åšï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">å»æ‰ <span class="hljs-attr">inputType</span>=<span class="hljs-string">"number"</span> çš„åæœ:
1. å¼¹å‡ºå…¨é”®ç›˜ï¼ˆè€Œä¸æ˜¯æ•°å­—é”®ç›˜ï¼‰
2. ç”¨æˆ·ä½“éªŒå˜å·®ï¼ˆè¾“å…¥æ•°å­—éœ€è¦åˆ‡æ¢é”®ç›˜ï¼‰
3. æ— æ³•ä½¿ç”¨ç³»ç»Ÿçš„æ•°å­—é”®ç›˜ä¼˜åŒ–

ä¿ç•™ <span class="hljs-attr">inputType</span>=<span class="hljs-string">"number"</span> + InputConnectionæ‹¦æˆª:
1. ä¿ç•™æ•°å­—é”®ç›˜ï¼ˆç”¨æˆ·ä½“éªŒå¥½ï¼‰
2. é¿å…æ•°æ®ä¸¢å¤±ï¼ˆæŠ€æœ¯æ­£ç¡®ï¼‰
3. æœ€ä½³å®è·µ
</code></pre>
<h4 data-id="heading-31">7.2 ä¸ºä»€ä¹ˆè°ƒç”¨finishComposingText()ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸ºä»€ä¹ˆä¸ç›´æ¥return falseï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// é”™è¯¯åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (containsNonDigit(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// âœ— è¾“å…¥æ³•ä¼šè®¤ä¸ºå¤±è´¥ï¼Œå¯èƒ½é‡è¯•æˆ–æŠ¥é”™</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}

<span class="hljs-comment">// æ­£ç¡®åšæ³•</span>
<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (containsNonDigit(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText(); <span class="hljs-comment">// âœ“ å‘Šè¯‰è¾“å…¥æ³•"ç»„åˆå·²å®Œæˆ"</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}
</code></pre>
<p><strong>åŸå› </strong>ï¼š</p>
<ul>
<li><code>finishComposingText()</code> æ˜¯åˆæ³•çš„æ“ä½œï¼Œè¾“å…¥æ³•ä¼šæ­£å¸¸å¤„ç†</li>
<li>è¿”å› <code>false</code> è¡¨ç¤ºæ“ä½œå¤±è´¥ï¼Œè¾“å…¥æ³•å¯èƒ½å‡ºç°å¼‚å¸¸è¡Œä¸º</li>
<li><code>finishComposingText()</code> ä¼šæ¸…é™¤COMPOSING Spanï¼Œé¿å…åç»­é—®é¢˜</li>
</ul>
<h4 data-id="heading-32">7.3 ä¸ºä»€ä¹ˆä¸ç”¨setFilterså®Œå…¨æ›¿ä»£ï¼Ÿ</h4>
<p><strong>é—®é¢˜</strong>ï¼šä¸ºä»€ä¹ˆä¸åªç”¨InputFilterï¼Œè¿˜è¦ç”¨InputConnectionï¼Ÿ</p>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å•ç‹¬ä½¿ç”¨ InputFilter çš„é—®é¢˜:
<span class="hljs-bullet">1.</span> æ— æ³•é˜»æ­¢deleteæ“ä½œï¼ˆdeleteç»•è¿‡Filterï¼‰
<span class="hljs-bullet">2.</span> ä»ä¼šè§¦å‘Bug

å•ç‹¬ä½¿ç”¨ InputConnection çš„ä¼˜åŠ¿:
<span class="hljs-bullet">1.</span> æ‹¦æˆªæ—¶æœºæ—©ï¼ˆdeleteä¹‹å‰ï¼‰
<span class="hljs-bullet">2.</span> ä»æºå¤´è§£å†³é—®é¢˜

æœ€ä½³å®è·µ:
  InputConnectionæ‹¦æˆªä¸ºä¸»ï¼ˆæ–¹æ¡ˆä¸€ï¼‰
  æˆ– InputFilter + InputConnectionåŒé‡ä¿æŠ¤ï¼ˆæ–¹æ¡ˆä¸‰ï¼‰
</code></pre>
<h4 data-id="heading-33">7.4 å¦‚ä½•æ”¯æŒå°æ•°ç‚¹ï¼Ÿ</h4>
<p><strong>æ‰©å±•æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isValidNumberInput</span><span class="hljs-params">(CharSequence text)</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
        <span class="hljs-type">char</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> text.charAt(i);
        <span class="hljs-comment">// å…è®¸æ•°å­—å’Œå°æ•°ç‚¹</span>
        <span class="hljs-keyword">if</span> (!Character.isDigit(c) &amp;&amp; c != <span class="hljs-string">'.'</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
    <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; !isValidNumberInput(text)) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
}

<span class="hljs-comment">// åŒæ—¶è®¾ç½®inputType</span>
setInputType(InputType.TYPE_CLASS_NUMBER | InputType.TYPE_NUMBER_FLAG_DECIMAL);
</code></pre>
<hr/>
<h3 data-id="heading-34">å…«ã€æ€»ç»“ï¼šä»ç†è®ºåˆ°å®è·µçš„å®Œæ•´é“¾è·¯</h3>
<h4 data-id="heading-35">8.1 ä¸‰ç¯‡æ–‡ç« çš„çŸ¥è¯†é“¾</h4>
<pre><code class="hljs language-sql" lang="sql">ç¬¬ä¸€ç¯‡ï¼šBinderé€šä¿¡æœºåˆ¶
  â”œâ”€ ä¸‰è¿›ç¨‹æ¶æ„
  â”œâ”€ AIDLæ¥å£å®šä¹‰
  â”œâ”€ Stub<span class="hljs-operator">/</span>Proxyå®ç°
  â”œâ”€ çº¿ç¨‹åˆ‡æ¢
  â””â”€ ä¿¡æ¯ä¸å¯¹ç§°
       â†“ ä¸ºä»€ä¹ˆè¾“å…¥æ³•ä¸çŸ¥é“å®é™…ç»“æœ

ç¬¬äºŒç¯‡ï¼šæ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·
  â”œâ”€ InputFilteræ¥å£å±€é™
  â”œâ”€ <span class="hljs-keyword">delete</span>ç»•è¿‡<span class="hljs-keyword">Filter</span>
  â”œâ”€ replaceTextå…ˆ<span class="hljs-keyword">delete</span>å<span class="hljs-keyword">insert</span>
  â”œâ”€ SpanèŒƒå›´å¼‚å¸¸æ‰©å±•
  â””â”€ ä¸å¯¹ç§°çš„æ§åˆ¶æƒ
       â†“ ä¸ºä»€ä¹ˆæ•°å­—ä¼šè¢«åˆ é™¤

ç¬¬ä¸‰ç¯‡ï¼ˆæœ¬æ–‡ï¼‰ï¼šå·¥ç¨‹è§£å†³æ–¹æ¡ˆ
  â”œâ”€ InputConnectionæ‹¦æˆªï¼ˆæ¨èï¼‰
  â”œâ”€ TextWatcherè¿‡æ»¤ï¼ˆç®€å•ï¼‰
  â”œâ”€ è‡ªå®šä¹‰InputFilterï¼ˆçµæ´»ï¼‰
  â”œâ”€ ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯”
  â”œâ”€ é€‰å‹æŒ‡å—
  â”œâ”€ æœ€ä½³å®è·µ
  â””â”€ å®Œæ•´ä»£ç 
       â†“ å¦‚ä½•åœ¨å®é™…é¡¹ç›®ä¸­è§£å†³
</code></pre>
<h4 data-id="heading-36">8.2 æœ€ä½³å®è·µæ€»ç»“</h4>






























<table><thead><tr><th>åœºæ™¯</th><th>æ¨èæ–¹æ¡ˆ</th><th>æ ¸å¿ƒä»£ç </th></tr></thead><tbody><tr><td><strong>æ™®é€šæ•°å­—è¾“å…¥</strong></td><td>InputConnectionæ‹¦æˆª</td><td><code>finishComposingText()</code></td></tr><tr><td><strong>è‡ªå®šä¹‰è§„åˆ™</strong></td><td>è‡ªå®šä¹‰Filter + IC</td><td><code>filter()</code> + <code>finishComposingText()</code></td></tr><tr><td><strong>å¿«é€Ÿå¼€å‘</strong></td><td>TextWatcher</td><td><code>afterTextChanged()</code> + <code>setText()</code></td></tr><tr><td><strong>é«˜æ€§èƒ½</strong></td><td>InputConnectionæ‹¦æˆª</td><td>é¿å…å¤šä½™æ“ä½œ</td></tr></tbody></table>
<h4 data-id="heading-37">8.3 æ ¸å¿ƒè¦ç‚¹</h4>
<pre><code class="hljs language-markdown" lang="markdown">å…³é”®è®¾è®¡å†³ç­–:
<span class="hljs-bullet">1.</span> ä¿ç•™ inputType="number" ï¼ˆæ•°å­—é”®ç›˜ï¼‰
<span class="hljs-bullet">2.</span> é‡å†™ onCreateInputConnection() ï¼ˆæ‹¦æˆªå…¥å£ï¼‰
<span class="hljs-bullet">3.</span> åŒ…è£… InputConnectionWrapper ï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰
<span class="hljs-bullet">4.</span> æ‹¦æˆª setComposingText() ï¼ˆå…³é”®æ–¹æ³•ï¼‰
<span class="hljs-bullet">5.</span> è°ƒç”¨ finishComposingText() ï¼ˆæ­£ç¡®å¤„ç†ï¼‰

ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡:
<span class="hljs-bullet">1.</span> ç”¨æˆ·ä½“éªŒï¼šæ•°å­—é”®ç›˜æ›´æ–¹ä¾¿
<span class="hljs-bullet">2.</span> æ€§èƒ½ä¼˜åŒ–ï¼šæ‹¦æˆªæ—©ï¼Œå¼€é”€å°
<span class="hljs-bullet">3.</span> å…¼å®¹æ€§å¥½ï¼šå¯¹è¾“å…¥æ³•é€æ˜
<span class="hljs-bullet">4.</span> ä»£ç ç®€æ´ï¼šåªéœ€40è¡Œä»£ç 
<span class="hljs-bullet">5.</span> æ˜“äºç»´æŠ¤ï¼šé€»è¾‘æ¸…æ™°
</code></pre>
<h4 data-id="heading-38">8.4 å»¶ä¼¸åº”ç”¨</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// å¯ä»¥æ‰©å±•åˆ°å…¶ä»–åœºæ™¯:</span>

<span class="hljs-comment">// 1. æ‰‹æœºå·è¾“å…¥ï¼ˆæ•°å­— + ç©ºæ ¼/æ¨ªçº¿ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PhoneNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 2. é‚®ç®±è¾“å…¥ï¼ˆé™åˆ¶ç‰¹æ®Šå­—ç¬¦ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 3. ç”¨æˆ·åè¾“å…¥ï¼ˆå­—æ¯ + æ•°å­— + ä¸‹åˆ’çº¿ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UsernameEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// 4. å¯†ç è¾“å…¥ï¼ˆå¢å¼ºå®‰å…¨ï¼‰</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SecurePasswordEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {
    <span class="hljs-comment">// ...</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-39">ä¹ã€å®Œæ•´ç¤ºä¾‹é¡¹ç›®ç»“æ„</h3>
<pre><code class="hljs language-css" lang="css">app/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/java/com/yourpackage/
â”œâ”€ widget/
â”‚  â”œâ”€ RecommendedNumberEditText<span class="hljs-selector-class">.java</span>   â† æ–¹æ¡ˆä¸€ï¼ˆæ¨èï¼‰
â”‚  â”œâ”€ SimpleNumberEditText<span class="hljs-selector-class">.java</span>        â† æ–¹æ¡ˆäºŒ
â”‚  â”œâ”€ SafeNumberEditText<span class="hljs-selector-class">.java</span>          â† æ–¹æ¡ˆä¸‰
â”‚  â”œâ”€ MoneyEditText<span class="hljs-selector-class">.java</span>               â† æ‰©å±•ï¼šé‡‘é¢è¾“å…¥
â”‚  â”œâ”€ PhoneNumberEditText<span class="hljs-selector-class">.java</span>         â† æ‰©å±•ï¼šç”µè¯è¾“å…¥
â”‚  â””â”€ DebugNumberEditText<span class="hljs-selector-class">.java</span>         â† è°ƒè¯•ç‰ˆæœ¬
â”‚
â”œâ”€ utils/
â”‚  â””â”€ InputValidationUtils<span class="hljs-selector-class">.java</span>        â† é€šç”¨éªŒè¯å·¥å…·
â”‚
â””â”€ MainActivity<span class="hljs-selector-class">.java</span>

app/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/res/layout/
â””â”€ activity_main<span class="hljs-selector-class">.xml</span>

app/<span class="hljs-attribute">src</span>/test/java/com/yourpackage/
â””â”€ NumberEditTextTest<span class="hljs-selector-class">.java</span>             â† å•å…ƒæµ‹è¯•
</code></pre>
<hr/>
<h3 data-id="heading-40">å‚è€ƒèµ„æ–™</h3>
<ol>
<li>Androidæºç ï¼š<code>frameworks/base/core/java/android/view/inputmethod/InputConnectionWrapper.java</code></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fview%2Finputmethod%2FInputConnectionWrapper" target="_blank" title="https://developer.android.com/reference/android/view/inputmethod/InputConnectionWrapper" ref="nofollow noopener noreferrer">InputConnectionWrapper</a></li>
<li>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.android.com%2Freference%2Fandroid%2Fview%2Finputmethod%2FInputConnection" target="_blank" title="https://developer.android.com/reference/android/view/inputmethod/InputConnection" ref="nofollow noopener noreferrer">InputConnection</a></li>
<li>æœ¬ç³»åˆ—å‰ä¸¤ç¯‡ï¼š
<ul>
<li>ç¬¬ä¸€ç¯‡ï¼šã€ŠAndroidè¾“å…¥æ³•æ¡†æ¶çš„Binderé€šä¿¡æœºåˆ¶å‰–æã€‹</li>
<li>ç¬¬äºŒç¯‡ï¼šã€Šä»ä¸€ä¸ªBugçœ‹Androidæ–‡æœ¬ç¼–è¾‘çš„è®¾è®¡ç¼ºé™·ã€‹</li>
</ul>
</li>
</ol>
<hr/>
<h3 data-id="heading-41">é™„å½•ï¼šå®Œæ•´å¯è¿è¡Œçš„ç¤ºä¾‹ä»£ç </h3>
<p><strong>RecommendedNumberEditText.java</strong>ï¼ˆç›´æ¥å¤åˆ¶å¯ç”¨ï¼‰ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.yourpackage.widget;

<span class="hljs-keyword">import</span> android.content.Context;
<span class="hljs-keyword">import</span> android.util.AttributeSet;
<span class="hljs-keyword">import</span> android.view.inputmethod.EditorInfo;
<span class="hljs-keyword">import</span> android.view.inputmethod.InputConnection;
<span class="hljs-keyword">import</span> android.view.inputmethod.InputConnectionWrapper;
<span class="hljs-keyword">import</span> androidx.appcompat.widget.AppCompatEditText;

<span class="hljs-comment">/**
 * æ¨èçš„æ•°å­—è¾“å…¥æ¡†å®ç°
 * è§£å†³ inputType="number" æ—¶ï¼Œåˆ‡æ¢å­—æ¯é”®ç›˜å¯¼è‡´æ•°å­—ä¸¢å¤±çš„é—®é¢˜
 *
 * ä½¿ç”¨æ–¹æ³•:
 * &lt;com.yourpackage.widget.RecommendedNumberEditText
 *     android:inputType="number"
 *     ... /&gt;
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RecommendedNumberEditText</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatEditText</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context)</span> {
        <span class="hljs-built_in">super</span>(context);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs)</span> {
        <span class="hljs-built_in">super</span>(context, attrs);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">RecommendedNumberEditText</span><span class="hljs-params">(Context context, AttributeSet attrs, <span class="hljs-type">int</span> defStyleAttr)</span> {
        <span class="hljs-built_in">super</span>(context, attrs, defStyleAttr);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> InputConnection <span class="hljs-title function_">onCreateInputConnection</span><span class="hljs-params">(EditorInfo outAttrs)</span> {
        <span class="hljs-type">InputConnection</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">super</span>.onCreateInputConnection(outAttrs);
        <span class="hljs-keyword">if</span> (base == <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span>(base, <span class="hljs-literal">true</span>);
    }

    <span class="hljs-comment">/**
     * è‡ªå®šä¹‰InputConnectionåŒ…è£…ç±»
     * æ‹¦æˆªsetComposingTextï¼Œæ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">NumberInputConnectionWrapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">InputConnectionWrapper</span> {

        <span class="hljs-keyword">public</span> <span class="hljs-title function_">NumberInputConnectionWrapper</span><span class="hljs-params">(InputConnection target, <span class="hljs-type">boolean</span> mutable)</span> {
            <span class="hljs-built_in">super</span>(target, mutable);
        }

        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">setComposingText</span><span class="hljs-params">(CharSequence text, <span class="hljs-type">int</span> newCursorPosition)</span> {
            <span class="hljs-keyword">if</span> (text != <span class="hljs-literal">null</span> &amp;&amp; containsNonDigit(text)) {
                <span class="hljs-comment">// åŒ…å«éæ•°å­—å­—ç¬¦ï¼Œç›´æ¥å®Œæˆç»„åˆï¼ˆä¸æ‰§è¡Œdelete-insertï¼‰</span>
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.finishComposingText();
            }
            <span class="hljs-comment">// çº¯æ•°å­—æˆ–nullï¼Œæ­£å¸¸å¤„ç†</span>
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>.setComposingText(text, newCursorPosition);
        }

        <span class="hljs-comment">/**
         * æ£€æŸ¥æ˜¯å¦åŒ…å«éæ•°å­—å­—ç¬¦
         */</span>
        <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">containsNonDigit</span><span class="hljs-params">(CharSequence text)</span> {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; text.length(); i++) {
                <span class="hljs-keyword">if</span> (!Character.isDigit(text.charAt(i))) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    }
}
</code></pre>
<p><strong>activity_main.xml</strong>ï¼š</p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">"1.0"</span> encoding=<span class="hljs-string">"utf-8"</span>?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span>
    <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>
    <span class="hljs-attr">android:orientation</span>=<span class="hljs-string">"vertical"</span>
    <span class="hljs-attr">android:padding</span>=<span class="hljs-string">"16dp"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æ¨èæ–¹æ¡ˆï¼ˆInputConnectionæ‹¦æˆªï¼‰ï¼š"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"16sp"</span>
        <span class="hljs-attr">android:textStyle</span>=<span class="hljs-string">"bold"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">com.yourpackage.widget.RecommendedNumberEditText</span>
        <span class="hljs-attr">android:id</span>=<span class="hljs-string">"@+id/edit_recommended"</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:hint</span>=<span class="hljs-string">"è¯·è¾“å…¥æ•°å­—"</span>
        <span class="hljs-attr">android:inputType</span>=<span class="hljs-string">"number"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"24dp"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"æµ‹è¯•è¯´æ˜ï¼š"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"14sp"</span> /&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span>
        <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"wrap_content"</span>
        <span class="hljs-attr">android:layout_marginTop</span>=<span class="hljs-string">"8dp"</span>
        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"1. è¾“å…¥æ•°å­— 123456\n2. åˆ‡æ¢åˆ°å­—æ¯é”®ç›˜\n3. è¿ç»­ç‚¹å‡»å­—æ¯ 'q'\n4. æ•°å­—ä¸ä¼šè¢«åˆ é™¤ âœ“"</span>
        <span class="hljs-attr">android:textSize</span>=<span class="hljs-string">"12sp"</span> /&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>
</code></pre>
<hr/>
<p><strong>ç³»åˆ—å®Œç»“</strong>ã€‚ä»Binderé€šä¿¡æœºåˆ¶ï¼Œåˆ°æ–‡æœ¬ç¼–è¾‘è®¾è®¡ç¼ºé™·ï¼Œå†åˆ°å®Œæ•´çš„å·¥ç¨‹è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›è¿™ä¸‰ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ·±å…¥ç†è§£Androidè¾“å…¥æ³•æ¡†æ¶ï¼Œå¹¶åœ¨å®é™…é¡¹ç›®ä¸­æ¸¸åˆƒæœ‰ä½™åœ°è§£å†³ç±»ä¼¼é—®é¢˜ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”â€”ç«‹è¶³]]></title>    <link>https://juejin.cn/post/7570935965435510799</link>    <guid>https://juejin.cn/post/7570935965435510799</guid>    <pubDate>2025-11-10T13:58:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570935965435510799" data-draft-id="7570901172527497251" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”â€”ç«‹è¶³"/> <meta itemprop="keywords" content="ç¨‹åºå‘˜"/> <meta itemprop="datePublished" content="2025-11-10T13:58:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Mapbarfront"/> <meta itemprop="url" content="https://juejin.cn/user/624178336632407"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”â€”ç«‹è¶³
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/624178336632407/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Mapbarfront
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T13:58:13.000Z" title="Mon Nov 10 2025 13:58:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»4åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">è¿›å…¥èŒåœºç¬¬ä¸‰è¯¾â€”ç«‹è¶³</h2>
<p>åœ¨è§‚å¯Ÿå’Œèå…¥ä¹‹åï¼Œè¦åšçš„ç¬¬ä¸‰ä»¶äº‹å°±æ˜¯ç«‹è¶³ã€‚ä½ å·²ç»åº¦è¿‡äº†æ–°æ‰‹æœŸï¼Œæ¥ä¸‹æ¥ï¼Œéœ€è¦ä½ æ‰¿æ‹…æ›´å¤šæœ‰æŒ‘æˆ˜çš„å·¥ä½œï¼Œæ¥è¯æ˜ä½ çš„èƒ½åŠ›ã€‚</p>
<p>å¦‚æœä½ æ˜¯åº”å±Šæ–°äººï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½è·Ÿç€å¸¦ä½ çš„å¯¼å¸ˆï¼Œå¼€å§‹æ­£å¼å‚åŠ ä¸šåŠ¡å¼€å‘ï¼›å¦‚æœä½ æ˜¯èŒåœºè€é¸Ÿï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ä½ ç‹¬ç«‹å®Œæˆä»»åŠ¡äº†ã€‚è¿™ä¸ªé˜¶æ®µæ˜¯ä½ ç»™ç›´å±é¢†å¯¼ï¼Œä¹Ÿå°±æ˜¯ä½ çš„è€æ¿ï¼Œå»ºç«‹å°è±¡æœ€å…³é”®çš„æ—¶åˆ»ï¼Œå¦‚æœç¬¦åˆé¢„æœŸç”šè‡³è¶…é¢„æœŸï¼Œä»¥åï¼Œåœ¨å…¬å¸å¤§æ¦‚ç‡ä¼šå‘å±•çš„é¡ºé¡ºåˆ©åˆ©ï¼›å¦‚æœä¸åŠé¢„æœŸçš„è¯ï¼Œåˆ™å¯èƒ½ä¼šè¢«è€æ¿è´´ä¸Šä¸å¤ªè¡Œçš„æ ‡ç­¾ï¼Œè¢«å½’ä¸ºä½ç»©æ•ˆçš„å€™é€‰äººã€‚</p>
<p>æ¸¡è¿‡äº†æ–°æ‰‹æœŸï¼Œæ¥ä¸‹æ¥å°±è¯¥ç«‹è¶³äº†ï¼Œåªæœ‰ç«™å¾—ç¨³ï¼Œæ‰èƒ½èµ°å¾—å¥½ï¼Œæ‰æœ‰æœºä¼šè·³å¾—é«˜ï¼Œæ˜“ç»ä¹¾å¦ä¸­çš„è§é¾™åœ¨ç”°ï¼Œè¯´çš„å°±æ˜¯è¿™ä¸ªæ„æ€ï¼Œæƒ³è¦ç«‹è¶³ï¼Œæƒ³è¦ç«™å¾—ç¨³ï¼Œä½ éœ€è¦åšå¥½ä»¥ä¸‹è¿™å››ä¸ªåŠ¨ä½œã€‚</p>
<h3 data-id="heading-1">1ã€åšå¥½ç¬¬ä¸€ä¸ªç‹¬ç«‹ä»»åŠ¡</h3>
<p>ä»æ–°æ‰‹æœŸçš„å­¦ä¹ é€‚åº”ï¼Œåˆ°ç«‹è¶³æœŸçš„æ‰¿æ‹…è´Ÿè´£ï¼Œè¿™æ˜¯å›¢é˜Ÿå†…å…¶ä»–æˆå‘˜ï¼Œå¯¹ä½ é¢„æœŸçš„æ”¹å˜ï¼Œè€æ¿ç»™äº†ä½ å¾ˆé•¿æ—¶é—´ï¼Œæ˜¯æ—¶å€™ä½“ç°ä½ çš„ä»·å€¼äº†ï¼Œå½“ä½ æ¥åˆ°ç¬¬ä¸€ä¸ªç‹¬ç«‹å®Œæˆçš„ä»»åŠ¡ï¼Œå°¤å…¶é‡è¦ï¼Œä½ éœ€è¦èŠ±120%çš„å¿ƒæ€æ¥æŠŠå®ƒåšå¥½ã€‚</p>
<p>åŸå› å¾ˆç®€å•ï¼Œè¿™ä¸ªä»»åŠ¡å®Œæˆçš„å¥½åï¼Œç›´æ¥å†³å®šï¼Œä½ åœ¨è€æ¿å¿ƒä¸­å»ºç«‹ä»€ä¹ˆæ ·çš„å°è±¡ï¼Œæƒ³è¢«è€æ¿è®¤å¯ï¼Œåç»­è¢«ä»–å½’åˆ°æ”¾å¿ƒã€é è°±è¿™ä¸€ç±»é‡Œï¼Œç¬¬ä¸€ä¸ªç‹¬ç«‹ä»»åŠ¡æ˜¯ä½ å¿…é¡»åšå¥½çš„ã€‚å½“ç„¶ï¼Œä½ æ¥çš„æ—¶é—´è¿˜ä¸é•¿ï¼Œä¸€äº›å†å²å€ºåŠ¡å¯èƒ½è¿˜ä¸æ¸…æ¥šï¼Œä»ç„¶å­˜åœ¨çŠ¯é”™çš„å¯èƒ½æ€§ï¼Œæ²¡å…³ç³»ï¼Œå°½åŠ›å»æŠŠå®ƒåšå¥½ï¼Œå³ä½¿çŠ¯é”™ä¹Ÿåˆ«æ‹…å¿ƒï¼Œç§¯ææ”¹æ­£çš„åŠªåŠ›æ€åº¦ä¸€å®šè¦æ‰“æ»¡ã€‚</p>
<h3 data-id="heading-2">2ã€ä¸»åŠ¨ä¼˜åŒ–ä¸€ä¸ªå°äº‹</h3>
<p>æ¯ä¸ªå…¬å¸ã€æ¯ä¸ªå›¢é˜Ÿï¼Œéƒ½æœ‰å¤§å¤§å°å°ã€å„ç§å„æ ·çš„é—®é¢˜ï¼Œå°±ç®—å†ä¼˜ç§€çš„å›¢é˜Ÿï¼Œä¹Ÿä¸€å®šæœ‰å°çš„ç‘•ç–µå¯ä»¥ä¼˜åŒ–ï¼Œåœ¨ä½ è´Ÿè´£çš„å·¥ä½œèŒƒå›´å†…ï¼Œæ‰¾åˆ°ä¸€ä»¶å°äº‹æƒ…ï¼Œåœ¨é¢†å¯¼æ²¡æœ‰å®‰æ’ï¼Œå…¶ä»–åŒäº‹é»˜è®¤æ¥å—çš„æƒ…å†µä¸‹ï¼Œä½ ä¸»åŠ¨å»æŠŠå®ƒä¼˜åŒ–ä¸€ä¸‹ï¼Œåšçš„æ›´å¥½ä¸€ç‚¹ï¼Œè®©å›¢é˜Ÿçš„åä½œæ•ˆç‡å˜å¾—æ›´é«˜ä¸€ç‚¹ï¼Œå¯åˆ«å°çœ‹è¿™ç§å°äº‹æƒ…ï¼Œè¿™æ˜¯æœ‰è§‚å¯ŸåŠ›ã€ä¸»åŠ¨æ€è€ƒçš„å…¸å‹è¡¨ç°ï¼Œä¼šç»™è€æ¿å’Œå›¢é˜Ÿå…¶ä»–æˆå‘˜ï¼Œç•™ä¸‹å¾ˆå¥½çš„å°è±¡ã€‚</p>
<h3 data-id="heading-3">3ã€ä¸ºè‡ªå·±è´´ä¸Šé è°±çš„æ ‡ç­¾</h3>
<p>å‡¡äº‹æœ‰äº¤ä»£ï¼Œä»¶ä»¶æœ‰ç€è½ï¼Œäº‹äº‹æœ‰å›å“ï¼Œæ— è®ºæ˜¯ç‹¬ç«‹ä»»åŠ¡ã€åˆä½œä»»åŠ¡ï¼Œåˆæˆ–è€…æ˜¯å…±åŒè®¨è®ºï¼Œä¸»åŠ¨å‚ä¸ã€ç§¯æåé¦ˆã€æ‡‚å¾—å¿…è¿˜ï¼Œè¿™äº›éƒ½æ˜¯å»ºç«‹ä¿¡ä»»çš„è¡Œä¸ºï¼Œä¹Ÿæ˜¯ä¸ºè‡ªå·±è´´ä¸Šé è°±æ ‡ç­¾çš„åŠ¨ä½œï¼Œåƒä¸‡è®°å¾—ï¼Œä¸€å®šä¸è¦è®©æµè½¬åˆ°ä½ æ‰‹ä¸Šçš„äº‹æƒ…ï¼Œæ²¡å®Œæˆã€æ²¡ä¸‹æ–‡ï¼Œæ‰åœ¨åœ°ä¸Šï¼ŒåŒæ—¶ï¼Œæœ‰é£é™©ä¹Ÿè¦ç¬¬ä¸€æ—¶é—´åŒæ­¥å‡ºæ¥ï¼Œä¸è¦æ‚åœ¨è‡ªå·±çš„ç›–å­åº•ä¸‹ã€‚</p>
<h3 data-id="heading-4">4ã€ç»“äº¤æ­£ç£åœºçš„åŒäº‹</h3>
<p>å›¢é˜Ÿé‡Œï¼Œè€æ¿å–œæ¬¢çš„äººï¼Œå¾€å¾€æ˜¯ä¸»åŠ›è¾“å‡ºï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸­é«˜ç»©æ•ˆï¼Œå¦‚æœä½ æœ‰é‡å¿ƒï¼Œæƒ³åœ¨å›¢é˜Ÿé‡Œç«‹è¶³ï¼Œç«‹çš„é«˜ä¸€ç‚¹ï¼Œå°½é‡è¦ç»“äº¤é‚£äº›ï¼Œèƒ½ç»™ä½ æä¾›æ­£ç£åœºçš„åŒäº‹ï¼Œäººéƒ½æ˜¯æœ‰ç£åœºçš„ï¼Œæ¯ä¸ªäººçš„ç£åœºä¹Ÿä¸åŒï¼Œç£åœºä¹‹é—´ç›¸äº’å¸å¼•ã€ç›¸äº’å½±å“ï¼Œç›¸äº’ä¼ é€’ã€‚</p>
<p>ä½ç»©æ•ˆï¼Œè¾¹ç¼˜åŒ–çš„åŒäº‹ï¼Œä»–å¯èƒ½è‡ªå·±å·²ç»æ‘†çƒ‚äº†æˆ–è€…æƒ³æºœäº†ï¼Œä½ è·Ÿä»–åœ¨ä¸€èµ·ï¼Œé™¤äº†å¤©å¤©å¬ä»–åæ§½å…¬å¸ã€åæ§½è€æ¿ï¼ŒæŠ±æ€¨ä¸œæŠ±æ€¨è¥¿ï¼Œå•¥ä¹Ÿæ”¶è·ä¸äº†ï¼Œè€Œä¸”æ—¶é—´é•¿äº†ï¼Œåœ¨è€æ¿çœ¼é‡Œï¼Œä½ ä¹Ÿä¼šè¢«å½’åˆ°å’Œä»–åŒä¸€ç±»æ€åº¦é‡Œå»ã€‚</p>
<h2 data-id="heading-5">ç»“è¯­</h2>
<p>è§é¾™åœ¨ç”°ï¼Œåˆ©è§å¤§äººï¼Œä¹Ÿæœ‰è¯¥ç»“äº¤å¯ä»¥å¸®åŠ©ä½ è´µäººçš„æ„æ€ï¼Œåšå¥½ä¸Šé¢è¿™4ä»¶äº‹ï¼Œä½ å°±ç®—åœ¨å›¢é˜Ÿä¸­çœŸæ­£çš„ç«‹è¶³ç«™ç¨³äº†ã€‚</p>
<p>ä½ çš„èƒ½åŠ›æœ‰äº†æ–½å±•çš„æœºä¼šï¼Œä½ ä¹Ÿå¼€å§‹çœŸæ­£ç‹¬ç«‹çš„è¢«äººå®¡è§†ï¼Œè¢«äººçœ‹è§ï¼Œè¿™æ˜¯ä¸€ä¸ªä»è¢«åŠ¨æ¥å—ï¼Œåˆ°ä¸»åŠ¨æ‰¿æ‹…çš„è¿‡ç¨‹ã€‚</p>
<p>è§é¾™åœ¨ç”°ï¼Œé¾™åˆšåˆšå‡ºç°åœ¨å¤§åœ°ä¸Šè¢«äººå‘ç°ï¼Œé‡ç‚¹åœ¨äºæ˜¾ç°ï¼Œè€Œä¸æ˜¯å†²åˆºï¼Œç«‹è¶³ç«™ç¨³ï¼Œè€Œä¸æ˜¯æ€¥åŠŸè¿‘åˆ©ï¼Œåˆ«ç€æ€¥ï¼Œåé¢çš„è·¯è¿˜é•¿ç€å‘¢ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[éœ‡æ’¼ä¸šç•Œï¼šæ–‡å¿ƒ5.0 Previewç™»é¡¶å…¨çƒç¬¬äºŒï¼Œåˆ›æ„å†™ä½œèƒ½åŠ›äº®çœ¼ï¼]]></title>    <link>https://juejin.cn/post/7570885801478553641</link>    <guid>https://juejin.cn/post/7570885801478553641</guid>    <pubDate>2025-11-10T14:00:44.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570885801478553641" data-draft-id="7570908785293656083" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="éœ‡æ’¼ä¸šç•Œï¼šæ–‡å¿ƒ5.0 Previewç™»é¡¶å…¨çƒç¬¬äºŒï¼Œåˆ›æ„å†™ä½œèƒ½åŠ›äº®çœ¼ï¼"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2025-11-10T14:00:44.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å¢¨é£å¦‚é›ª"/> <meta itemprop="url" content="https://juejin.cn/user/4064249017803927"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            éœ‡æ’¼ä¸šç•Œï¼šæ–‡å¿ƒ5.0 Previewç™»é¡¶å…¨çƒç¬¬äºŒï¼Œåˆ›æ„å†™ä½œèƒ½åŠ›äº®çœ¼ï¼
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4064249017803927/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å¢¨é£å¦‚é›ª
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T14:00:44.000Z" title="Mon Nov 10 2025 14:00:44 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>æœ€è¿‘AIåœˆå­çœŸæ˜¯çƒ­é—¹éå‡¡ï¼Œå„å¤§æ¨¡å‹ä½ æ–¹å”±ç½¢æˆ‘ç™»åœºï¼Œä½†å¦‚æœè¯´å“ªä¸ªæ¶ˆæ¯æœ€è®©äººå¿ƒå¤´ä¸€éœ‡ï¼Œé‚£è«è¿‡äºç™¾åº¦æ–‡å¿ƒå¤§æ¨¡å‹5.0 Previewçš„æ¨ªç©ºå‡ºä¸–ï¼Œå®ƒä¸ä»…ä¸€ä¸¾é—®é¼å›½å†…å¤§æ¨¡å‹ä¹‹é¦–ï¼Œæ›´æ˜¯åœ¨å›½é™…èˆå°ä¸Šæ€å…¥äº†å…¨çƒå¹¶åˆ—ç¬¬äºŒçš„å®åº§ï¼Œå°¤å…¶åœ¨åˆ›æ„å†™ä½œæ–¹é¢ï¼Œæ›´æ˜¯ç‹¬æ­¥å¤©ä¸‹ï¼Œæ‹¿ä¸‹äº†å…¨çƒç¬¬ä¸€çš„æ¡‚å† ï¼</p>
<p>è¿™å¯ä¸æ˜¯ä»€ä¹ˆå®éªŒå®¤é‡Œçš„æ•°æ®ï¼Œè€Œæ˜¯æ¥è‡ªAIç•Œå…¬è®¤çš„æƒå¨è¯„æµ‹å¹³å°â€”â€”LMArenaï¼ˆåŸåLMSYS Chatbot Arenaï¼‰çš„å®æˆ˜ç»“æœã€‚è¿™ä¸ªç”±åŠ å·å¤§å­¦ä¼¯å…‹åˆ©åˆ†æ ¡å›¢é˜Ÿæ‰“é€ çš„å¹³å°ï¼Œè¯„æµ‹æœºåˆ¶å¯ä»¥è¯´ç›¸å½“â€œæ®‹é…·â€ä½†ä¹Ÿæœ€è´´è¿‘çœŸå®ï¼šå®ƒè®©å…¨çƒç”¨æˆ·å¯¹ä¸¤ä¸ªåŒ¿åçš„æ¨¡å‹å›ç­”è¿›è¡Œç›²æµ‹æŠ•ç¥¨ï¼Œè°ç­”å¾—å¥½å°±ç»™è°ä¸€ç¥¨ã€‚è¿™ç§åŸºäºç”¨æˆ·çœŸå®åå¥½çš„Eloè¯„åˆ†ç³»ç»Ÿï¼Œèƒ½æœ€ç›´è§‚åœ°åæ˜ æ¨¡å‹åœ¨å®é™…åº”ç”¨ä¸­çš„ç”¨æˆ·ä½“éªŒå’Œèƒ½åŠ›ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.49.55-1024x459.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.49.55-1024x459.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3436459c86fb45338d988e052ab726c5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=Yv4VwgSfUz%2F12ZBNrMpTObMqqBE%3D" alt="iShot_2025-11-10_21.49.55" loading="lazy"/></a></p>
<h3 data-id="heading-0">LMArenaæ¦œå•çš„æƒŠè‰³è¡¨ç°</h3>
<p>å°±åœ¨æœ€è¿‘çš„LMArena Text Arenaæ¦œå•ä¸Šï¼Œæ–‡å¿ƒ5.0 Previewï¼ˆERNIE-5.0-Preview-1022ï¼‰å‡­å€Ÿ1432åˆ†çš„Eloé«˜åˆ†ï¼Œä¸OpenAIçš„GPT-4.5-Previewã€Anthropicçš„Claude-Opus-4-1ç­‰å›½é™…é¡¶çº§æ¨¡å‹å¹³èµ·å¹³åï¼Œä¸€åŒä½åˆ—å…¨çƒå¹¶åˆ—ç¬¬äºŒã€‚æ›´ä»¤äººå…´å¥‹çš„æ˜¯ï¼Œå®ƒè¶…è¶Šäº†åŒ…æ‹¬GPT-5-Highã€Qwen3-Maxã€DeepSeek-R1åœ¨å†…çš„è¯¸å¤šå›½å†…å¤–ä¸»æµå¼ºåŠ²å¯¹æ‰‹ã€‚è¿™ä¸å…‰æ˜¯æ–‡å¿ƒçš„èƒœåˆ©ï¼Œæ›´æ˜¯å›½äº§å¤§æ¨¡å‹è¿ˆå‘å…¨çƒå·…å³°çš„é‡è¦é‡Œç¨‹ç¢‘ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.50.03-1024x726.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.50.03-1024x726.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a6d2c8280f584680a4368bac46b1111b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=L%2Bx%2BGhpQvyJr6NHYbXGQRsT4Kmg%3D" alt="iShot_2025-11-10_21.50.03" loading="lazy"/></a></p>
<h3 data-id="heading-1">ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼Œå®šä¹‰é¡¶å°–æ°´å‡†</h3>
<p>é‚£ä¹ˆï¼Œè¿™ä¸ªæ–°æ¥çš„â€œé»‘é©¬â€ç©¶ç«Ÿå‡­ä»€ä¹ˆèƒ½ä¸€é¸£æƒŠäººå‘¢ï¼Ÿåœ¨æˆ‘çœ‹æ¥ï¼Œæ–‡å¿ƒ5.0 Previewåœ¨ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ–‡æœ¬èƒ½åŠ›ç»´åº¦ä¸Šï¼Œç¡®å®å±•ç°äº†é¡¶çº§æ°´å‡†ï¼š</p>
<h4 data-id="heading-2">ğŸ† åˆ›æ„å†™ä½œï¼šå…¨çƒç‹¬ä¸€ä»½çš„â€œå¦™ç¬”ç”ŸèŠ±â€</h4>
<p>è¦è¯´æœ€è®©äººæ‹æ¡ˆå«ç»çš„ï¼Œå¿…é¡»æ˜¯æ–‡å¿ƒ5.0 Previewåœ¨<strong>åˆ›æ„å†™ä½œ</strong>ä¸Šçš„ç»Ÿæ²»åŠ›â€”â€”å®ƒåœ¨è¿™ä¸ªç»´åº¦æ‹¿ä¸‹äº†<strong>å…¨çƒç¬¬ä¸€</strong>ï¼è¿™æ„å‘³ç€ï¼Œæ— è®ºæ˜¯ç­–åˆ’ä¸€åœºå£°åŠ¿æµ©å¤§çš„è¥é”€æˆ˜å½¹ã€æ’°å†™å¼•äººå…¥èƒœçš„å‰§æœ¬ï¼Œè¿˜æ˜¯ç”Ÿæˆä¸€ç¯‡æƒ…æ„ŸçœŸæŒšçš„æ–‡ç« ï¼Œå®ƒçš„äº§å‡ºéƒ½èƒ½åœ¨æ•ˆç‡å’Œè´¨é‡ä¸Šå®ç°å¤§å¹…è·ƒå‡ã€‚æœ‰å®æµ‹æ¡ˆä¾‹æ˜¾ç¤ºï¼Œåœ¨ç­–åˆ’ä¸€åœºè¥é”€æˆ˜å½¹æ—¶ï¼Œæ–‡å¿ƒ5.0 Previewä¸ä»…èƒ½æŠ“ä½â€œæƒ…ç»ªä»·å€¼â€çš„æ ¸å¿ƒæ´å¯Ÿï¼Œè¿è¾“å‡ºçš„çŸ­è§†é¢‘è„šæœ¬éƒ½ä¸“ä¸šåˆ°ä»¤äººæƒŠå¹ï¼Œç”»é¢ã€å‰ªè¾‘ç‚¹ã€éŸ³æ•ˆç­‰æ‰§è¡Œç»†èŠ‚ä¸€åº”ä¿±å…¨ï¼Œè¿™å¯ä¸æ˜¯ç®€å•çš„å †ç Œæ–‡å­—ï¼Œè€Œæ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„â€œå¦™ç¬”ç”ŸèŠ±â€ã€‚</p>
<h4 data-id="heading-3">ğŸ§  å¤æ‚é•¿é—®é¢˜ç†è§£ï¼šæ´å¯Ÿæ·±å±‚é€»è¾‘çš„â€œæ™ºè€…â€</h4>
<p>åœ¨å¤„ç†<strong>å¤æ‚é•¿é—®é¢˜</strong>æ–¹é¢ï¼Œæ–‡å¿ƒ5.0 Previewä¹Ÿè¡¨ç°å‡ºäº†éå‡¡çš„æ‰èƒ½ã€‚å®ƒæ“…é•¿å¤„ç†é‚£äº›æ‹¥æœ‰å¤šå±‚é€»è¾‘ã€éœ€è¦æ·±å…¥é˜…è¯»å’Œæ¨ç†çš„é•¿æ–‡æœ¬ä»»åŠ¡ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œé¢å¯¹ä¸€ç¯‡å†—é•¿çš„å­¦æœ¯æŠ¥å‘Šï¼Œæˆ–è€…ä¸€ä¸ªéœ€è¦å¤šæ–¹é¢çŸ¥è¯†èåˆçš„æ·±åº¦é—®ç­”ï¼Œå®ƒèƒ½å¤Ÿç²¾å‡†æŠŠæ¡æ ¸å¿ƒè¦ç‚¹ï¼Œè¿›è¡Œé«˜æ•ˆçš„çŸ¥è¯†æ¨ç†å’Œåˆ†æã€‚è¿™å¯¹äºç§‘ç ”ã€æ³•å¾‹ã€é‡‘èç­‰é«˜è®¤çŸ¥è¦æ±‚çš„åœºæ™¯ï¼Œç®€ç›´æ˜¯å¦‚è™æ·»ç¿¼ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.50.09-1024x742.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.50.09-1024x742.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c20f358cc2f9492d8ab091f17d873731~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=VuX6EDrmBLEcNTHHDjQe8mkNbO8%3D" alt="iShot_2025-11-10_21.50.09" loading="lazy"/></a></p>
<h4 data-id="heading-4">âœ… æŒ‡ä»¤éµå¾ªï¼šç²¾ç¡®æ— è¯¯çš„â€œæ‰§è¡Œå®˜â€</h4>
<p>ç¬¬ä¸‰ä¸ªæ ¸å¿ƒèƒ½åŠ›æ˜¯<strong>æŒ‡ä»¤éµå¾ª</strong>ã€‚è¿™å¬èµ·æ¥ç®€å•ï¼Œä½†åœ¨å®é™…åº”ç”¨ä¸­å´è‡³å…³é‡è¦ã€‚æ–‡å¿ƒ5.0 Previewèƒ½ç²¾å‡†ç†è§£å¹¶æ‰§è¡Œç”¨æˆ·æå‡ºçš„å„é¡¹å¤æ‚æ„å›¾ï¼Œè¿™å¯¹äºæ™ºèƒ½åŠ©ç†ã€ä»£ç ç”Ÿæˆã€ä¸šåŠ¡æµç¨‹è‡ªåŠ¨åŒ–ç­‰åœºæ™¯ï¼Œæ˜¯ä¿è¯è¾“å‡ºå¯é æ€§å’Œå‡†ç¡®æ€§çš„åŸºçŸ³ã€‚è¿˜è®°å¾—é‚£ä¸ªä»¤äººç§°å¥‡çš„æµ‹è¯•å—ï¼Ÿåœ¨æ’°å†™å…³äºâ€œåŒ—äº¬â€çš„ä»‹ç»æ—¶ï¼Œæ¨¡å‹è¢«è¦æ±‚åŒæ—¶æ»¡è¶³â€œç¦æ­¢ä½¿ç”¨â€˜çš„â€™å­—ã€ç¦æ­¢ä½¿ç”¨é€—å·å’Œé¡¿å·ã€å¿…é¡»åˆ†ä¸‰ä¸ªç¼–å·æ®µè½â€ç­‰å¤šé¡¹åç›´è§‰çš„è‹›åˆ»çº¦æŸã€‚ç»“æœå‘¢ï¼Ÿå®ƒå‡ºè‰²åœ°ç†è§£å¹¶å®Œç¾æ‰§è¡Œäº†æ‰€æœ‰è§„åˆ™ï¼Œåœ¨å®Œå…¨ä¸ç”¨ç‰¹å®šæ ‡ç‚¹å’Œå­—è¯çš„æƒ…å†µä¸‹ï¼Œä¾ç„¶ç”Ÿæˆäº†ä¸€æ®µè¿è´¯ä¸”å¯Œæœ‰æ–‡é‡‡çš„ä»‹ç»ï¼Œè¿™ç®€ç›´æ˜¯åœ¨AIçš„â€œåˆ€å°–ä¸Šè·³èˆâ€ï¼</p>
<h3 data-id="heading-5">å›½äº§AIï¼Œæœªæ¥å¯æœŸ</h3>
<p>æ–‡å¿ƒ5.0 Previewçš„å¼ºåŠ²è¡¨ç°ï¼Œç»éå¶ç„¶ã€‚è¿™èƒŒåæ˜¯ç™¾åº¦åœ¨â€œèŠ¯ç‰‡-æ¡†æ¶-æ¨¡å‹-åº”ç”¨â€å››å±‚å…¨æ ˆAIæŠ€æœ¯å¸ƒå±€ä¸Šçš„é•¿æœŸæ·±è€•ä¸ç§¯ç´¯ã€‚è¿™ä¸å…‰æ˜¯æ¨¡å‹çš„èƒœåˆ©ï¼Œæ›´æ˜¯ç™¾åº¦åœ¨AIé¢†åŸŸé•¿æœŸæŠ•å…¥çš„å…¨æ ˆæŠ€æœ¯ä½“ç³»å¼€èŠ±ç»“æœï¼Œå®ƒæ¸…æ™°åœ°å‘Šè¯‰æˆ‘ä»¬ï¼Œä¸­å›½çš„å¤§æ¨¡å‹åœ¨ç†è§£å’Œç”Ÿæˆäººç±»è¯­è¨€æ–¹é¢ï¼Œå·²ç»å®Œå…¨æœ‰èƒ½åŠ›ä¸å…¨çƒæœ€é¡¶å°–çš„äº§å“æ°æ‰‹è…•ã€‚</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.worldcodeing.com%2Fwp-content%2Fuploads%2F2025%2F11%2FiShot_2025-11-10_21.50.18-1024x725.png" target="_blank" title="https://blog.worldcodeing.com/wp-content/uploads/2025/11/iShot_2025-11-10_21.50.18-1024x725.png" ref="nofollow noopener noreferrer"><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/67f77e84520c4c21b64349d8fcda82d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5aKo6aOO5aaC6Zuq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763388044&amp;x-signature=%2B4Bh0ustsJWE9xKqr9WV7hFQPzQ%3D" alt="iShot_2025-11-10_21.50.18" loading="lazy"/></a></p>
<p>è™½ç„¶ç›®å‰æˆ‘ä»¬çœ‹åˆ°çš„æ˜¯ä¸€ä¸ªPreviewç‰ˆæœ¬ï¼Œä½†å®ƒå¸¦æ¥çš„æƒŠå–œå·²ç»è¶³å¤Ÿéœ‡åŠ¨ä¸šç•Œã€‚æ®æ‚‰ï¼Œæ–‡å¿ƒå¤§æ¨¡å‹çš„æœ€æ–°åŸºåº§æ¨¡å‹è®¡åˆ’äº2025å¹´11æœˆ13æ—¥çš„ç™¾åº¦ä¸–ç•Œå¤§ä¼šä¸Šæ­£å¼å‘å¸ƒï¼Œå±Šæ—¶ï¼Œå¼€å‘è€…å’Œç”¨æˆ·å°†æœ‰æœºä¼šæ›´å…¨é¢åœ°ä½“éªŒå®ƒçš„å¼ºå¤§èƒ½åŠ›ã€‚ä½œä¸ºAIåˆ›ä½œè€…ï¼Œæˆ‘å·²ç»è¿«ä¸åŠå¾…æƒ³çœ‹çœ‹å®ƒåœ¨æ›´å¹¿é˜”çš„åº”ç”¨åœºæ™¯ä¸­ï¼Œè¿˜èƒ½å¸¦æ¥å¤šå°‘æƒŠå–œã€‚å›½äº§AIçš„æœªæ¥ï¼Œä»æœªå¦‚æ­¤æ¸…æ™°å’Œä»¤äººæŒ¯å¥‹ï¼</p>
<p><strong>å¦‚æœä½ ä¹Ÿå¯¹æœ€æ–°çš„AIä¿¡æ¯æ„Ÿå…´è¶£æˆ–è€…æœ‰ç–‘é—® éƒ½å¯ä»¥åŠ å…¥æˆ‘çš„å¤§å®¶åº­ ç¬¬ä¸€æ—¶é—´åˆ†äº«æœ€æ–°AIèµ„è®¯ã€å·¥å…·ã€æ•™ç¨‹ã€æ–‡æ¡£ æ¬¢è¿ä½ çš„åŠ å…¥ï¼ï¼ï¼ğŸ˜‰ğŸ˜‰ğŸ˜‰</strong></p>
<p>å…¬ä¼—å·ï¼šå¢¨é£å¦‚é›ªå°ç«™</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 60 æœŸï¼ˆ2025å¹´11.1-11.9ï¼‰]]></title>    <link>https://juejin.cn/post/7570902804451475466</link>    <guid>https://juejin.cn/post/7570902804451475466</guid>    <pubDate>2025-11-10T12:03:25.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804451475466" data-draft-id="7570912420567744522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 60 æœŸï¼ˆ2025å¹´11.1-11.9ï¼‰"/> <meta itemprop="keywords" content="åç«¯,.NET"/> <meta itemprop="datePublished" content="2025-11-10T12:03:25.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è¿½é€æ—¶å…‰è€…"/> <meta itemprop="url" content="https://juejin.cn/user/2770425031690333"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠ | ç¬¬ 60 æœŸï¼ˆ2025å¹´11.1-11.9ï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2770425031690333/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è¿½é€æ—¶å…‰è€…
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:03:25.000Z" title="Mon Nov 10 2025 12:03:25 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/43a29eaf433a41e99b3836c7caf5a516~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=02RmGren4qCBIuicXq0AsqbFjkg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-0">å‰è¨€</h2>
<p>C#/.NET/.NET CoreæŠ€æœ¯å‰æ²¿å‘¨åˆŠï¼Œä½ çš„æ¯å‘¨æŠ€æœ¯æŒ‡å—é’ˆï¼è®°å½•ã€è¿½è¸ªC#/.NET/.NET Coreé¢†åŸŸã€ç”Ÿæ€çš„æ¯å‘¨æœ€æ–°ã€æœ€å®ç”¨ã€æœ€æœ‰ä»·å€¼çš„æŠ€æœ¯æ–‡ç« ã€ç¤¾åŒºåŠ¨æ€ã€ä¼˜è´¨é¡¹ç›®å’Œå­¦ä¹ èµ„æºç­‰ã€‚è®©ä½ æ—¶åˆ»ç«™åœ¨æŠ€æœ¯å‰æ²¿ï¼ŒåŠ©åŠ›æŠ€æœ¯æˆé•¿ä¸è§†é‡æ‹“å®½ã€‚</p>
<blockquote>
<p>æ¬¢è¿æŠ•ç¨¿ã€æ¨èæˆ–è‡ªèä¼˜è´¨æ–‡ç« ã€é¡¹ç›®ã€å­¦ä¹ èµ„æºç­‰ã€‚</p>
</blockquote>
<ul>
<li><strong>ğŸ†æŠ€æœ¯å‰æ²¿å‘¨åˆŠGiteeå¼€æºåœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fysgdaydayup%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetWeekly.md" target="_blank" title="https://gitee.com/ysgdaydayup/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md" ref="nofollow noopener noreferrer">gitee.com/ysgdaydayupâ€¦</a></li>
<li><strong>ğŸ“°æŠ€æœ¯å‰æ²¿å‘¨åˆŠGitHubå¼€æºåœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FYSGStudyHards%2FDotNetGuide%2Fblob%2Fmain%2Fdocs%2FDotNet%2FDotNetWeekly.md" target="_blank" title="https://github.com/YSGStudyHards/DotNetGuide/blob/main/docs/DotNet/DotNetWeekly.md" ref="nofollow noopener noreferrer">github.com/YSGStudyHarâ€¦</a></li>
</ul>
<h2 data-id="heading-1">C#/.NET/.NET Coreä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶2025å¹´10æœˆç®€æŠ¥</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> å…¬ä¼—å·æ¯æœˆå®šæœŸæ¨å¹¿å’Œåˆ†äº«çš„C#/.NET/.NET Coreä¼˜ç§€é¡¹ç›®å’Œæ¡†æ¶ï¼ˆæ¯å‘¨è‡³å°‘ä¼šæ¨èä¸¤ä¸ªä¼˜ç§€çš„é¡¹ç›®å’Œæ¡†æ¶å½“ç„¶èŠ‚å‡æ—¥é™¤å¤–ï¼‰ï¼Œå…¬ä¼—å·æ¨æ–‡ä¸­æœ‰é¡¹ç›®å’Œæ¡†æ¶çš„è¯¦ç»†ä»‹ç»ã€åŠŸèƒ½ç‰¹ç‚¹ã€ä½¿ç”¨æ–¹å¼ä»¥åŠéƒ¨åˆ†åŠŸèƒ½æˆªå›¾ç­‰ï¼ˆæ‰“ä¸å¼€æˆ–è€…æ‰“å¼€GitHubå¾ˆæ…¢çš„åŒå­¦å¯ä»¥ä¼˜å…ˆæŸ¥çœ‹å…¬ä¼—å·æ¨æ–‡ï¼Œæ–‡æœ«ä¸€å®šä¼šé™„å¸¦é¡¹ç›®å’Œæ¡†æ¶æºç åœ°å€ï¼‰ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FDB1UBuiS2BvZjf7VlH0_MQ" target="_blank" title="https://mp.weixin.qq.com/s/DB1UBuiS2BvZjf7VlH0_MQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/DB1UBuiS2â€¦</a></li>
</ul>
<h2 data-id="heading-2">äº‹åŠåŠŸå€ï¼š.NET å¼€å‘è€…çš„ Visual Studio æ•ˆç‡æŠ€å·§ï¼</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æœ¬æ–‡å¤§å§šå°†ä¸ºä½ åˆ†äº«ä¸€äº› Visual Studio çš„ä½¿ç”¨æŠ€å·§å’Œå»ºè®®ï¼Œæ—¨åœ¨å¸®åŠ© .NET å¼€å‘è€…æ›´åŠ é«˜æ•ˆåœ°åˆ©ç”¨ Visual Studio è¿›è¡Œç¼–ç¨‹å¼€å‘å·¥ä½œã€‚æ— è®ºä½ æ˜¯ .NET åˆå­¦è€…è¿˜æ˜¯ç»éªŒä¸°å¯Œçš„ .NET å¼€å‘è€…ï¼Œè¿™äº›æŠ€å·§éƒ½å°†æœ‰åŠ©äºæå‡ä½ çš„å·¥ä½œæ•ˆç‡ï¼Œè®©ä½ èƒ½å¤Ÿæ›´å¿«åœ°ç¼–å†™å‡ºé«˜è´¨é‡çš„ä»£ç ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FyHAK0VvcOR8bqZVqOBizXQ" target="_blank" title="https://mp.weixin.qq.com/s/yHAK0VvcOR8bqZVqOBizXQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/yHAK0VvcOâ€¦</a></li>
</ul>
<h2 data-id="heading-3">ã€æ‹¾é—è¡¥æ¼ã€‘.NET å¸¸è§æœ¯è¯­é›†</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> .NET å¸¸è§æœ¯è¯­é›†æ—¨åœ¨ä¸º .NET åˆå­¦è€…æä¾›ä¸€ä»½æ¸…æ™°çš„å…¥é—¨æŒ‡å¼•ï¼Œä¹Ÿä¸ºç»éªŒä¸°å¯Œçš„ .NET å¼€å‘è€…æä¾›ä¸€ä»½ä¾¿æ·çš„å‚è€ƒï¼Œå¸®åŠ©å¤§å®¶æ›´å‡†ç¡®åœ°è¡¨è¾¾ã€æ›´é«˜æ•ˆåœ°å­¦ä¹ ã€æ›´æ·±å…¥åœ°æ¢ç´¢ .NET çš„å¼ºå¤§åŠŸèƒ½ï¼ˆæœ‰é—æ¼çš„æ¬¢è¿æ–‡æœ«ç•™è¨€ï¼‰ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2FCan-daydayup%2Fp%2F19193323" target="_blank" title="https://www.cnblogs.com/Can-daydayup/p/19193323" ref="nofollow noopener noreferrer">www.cnblogs.com/Can-daydayuâ€¦</a></li>
</ul>
<h2 data-id="heading-4">ä¸€æ¬¾åŸºäº .NET WinForm å¼€æºã€è½»é‡ä¸”åŠŸèƒ½å¼ºå¤§çš„èŠ‚ç‚¹ç¼–è¾‘å™¨</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> STNodeEditor æ˜¯ä¸€æ¬¾åŸºäº .NET WinForm å¼€æºå…è´¹ï¼ˆMIT Licenseï¼‰ã€è½»é‡ä¸”åŠŸèƒ½å¼ºå¤§çš„èŠ‚ç‚¹ç¼–è¾‘å™¨ï¼Œé‡‡ç”¨çº¯ GDI+ ç»˜åˆ¶æ— ä»»ä½•ä¾èµ–åº“ä»…ä»…100+Kbï¼Œæä¾›äº†ä¸°å¯Œçš„å±æ€§ä»¥åŠäº‹ä»¶ï¼Œå¯ä»¥éå¸¸æ–¹ä¾¿çš„å®ŒæˆèŠ‚ç‚¹ä¹‹é—´æ•°æ®çš„äº¤äº’åŠé€šçŸ¥ï¼Œç¼–è¾‘å™¨å†…ç½®äº†å¤§é‡è™šå‡½æ•°ï¼Œä¾›å¼€å‘è€…æ ¹æ®éœ€æ±‚è¿›è¡Œé‡å†™ï¼Œèµ‹äºˆäº†æé«˜çš„è‡ªç”±åº¦å’Œå®šåˆ¶èƒ½åŠ›ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfMG3iAu1Y0Fkmf6d-fcgiA" target="_blank" title="https://mp.weixin.qq.com/s/fMG3iAu1Y0Fkmf6d-fcgiA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/fMG3iAu1Yâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dc08d40683fa477e8650ce425439488d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=vcdiT%2FJjvahnXVpAR%2FRfeU15dtM%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-5">ä¸€æ¬¾ .NET å¼€æºï¼ˆGPL-3.0 licenseï¼‰ã€å…è´¹ã€ç°ä»£çš„è¿œç¨‹ä¼šè¯ç®¡ç†å’Œå¯åŠ¨å™¨</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> 1Remote æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ä¸ªäººè¿œç¨‹ä¼šè¯ç®¡ç†å’Œå¯åŠ¨å™¨ï¼Œé€‚ç”¨äºéœ€è¦ç®¡ç†å¤šç§ä¸åŒåè®®è¿œç¨‹ä¼šè¯çš„ç”¨æˆ·ã€‚æ— è®ºæ˜¯ç³»ç»Ÿç®¡ç†å‘˜ã€å¼€å‘äººå‘˜è¿˜æ˜¯ITæ”¯æŒäººå‘˜ï¼Œéƒ½å¯ä»¥é€šè¿‡1Remoteåœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°æ–¹ç®¡ç†ä»–ä»¬çš„æ‰€æœ‰è¿œç¨‹è¿æ¥ï¼Œæé«˜å·¥ä½œæ•ˆç‡å’Œä¾¿åˆ©æ€§ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F4PIKVLGLkOsvSJJO9InvXA" target="_blank" title="https://mp.weixin.qq.com/s/4PIKVLGLkOsvSJJO9InvXA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/4PIKVLGLkâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f16c45ff1bbb482694f0b734b8c887c1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=InIjYF7OsUCLt68OEaIhv7ZSPa0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-6">ASP.NET Core éƒ¨ç½²è¿›åŒ–å²ï¼šä» Windows IIS åˆ° Dockerï¼Œå†åˆ°å›½äº§ Linux å®¹å™¨åŒ–å®è·µ</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ASP.NET Core éƒ¨ç½²è¿›åŒ–å²ï¼šä» Windows IIS åˆ° Dockerï¼Œå†åˆ°å›½äº§ Linux å®¹å™¨åŒ–å®è·µã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FqxBAzom3He-Lk7hQr7T7bQ" target="_blank" title="https://mp.weixin.qq.com/s/qxBAzom3He-Lk7hQr7T7bQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/qxBAzom3Hâ€¦</a></li>
</ul>
<h2 data-id="heading-7">æ·±å…¥æ¢ç´¢C# Channelsï¼šé«˜çº§æ¨¡å¼ä¸å®æˆ˜æŒ‡å—</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æˆ‘ä»¬å·²ç»ä»‹ç»äº†åŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ç±»å‹ã€å¾ªç¯ï¼Œç”šè‡³ä¸€äº›å®é™…åº”ç”¨åœºæ™¯ã€‚ç°åœ¨ï¼Œæ‚¨åº”è¯¥å¯¹ç”Ÿäº§è€…ã€æ¶ˆè´¹è€…ã€å®Œæˆå’Œå–æ¶ˆæ“ä½œæ„Ÿåˆ°ç†Ÿæ‚‰äº†ã€‚ä½† Channels å°±åƒä¸€åº§å†°å±±ï¼›æ‚¨ç›®å‰æ‰€è§çš„ä»…æ˜¯å†°å±±ä¸€è§’ã€‚å…¶åº•å±‚éšè—ç€é«˜çº§æ¨¡å¼ï¼Œå¦‚æœèƒ½å¤Ÿæ°å½“åœ°è¿ç”¨ï¼ˆæˆ–é¿å…ä½¿ç”¨ï¼‰ï¼Œå®ƒä»¬èƒ½è®©æ‚¨çš„ç³»ç»Ÿå‘æŒ¥å‡ºå“è¶Šçš„æ€§èƒ½ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fjhu0IEk_4D1n-cJocPLMbA" target="_blank" title="https://mp.weixin.qq.com/s/jhu0IEk_4D1n-cJocPLMbA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/jhu0IEk_4â€¦</a></li>
</ul>
<h2 data-id="heading-8">ä¸€ä¸ªå¼€æºã€ç²¾ç¾çš„ WPF ç”¨æˆ·ç•Œé¢</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> WPFUIDemo æ˜¯ä¸€ä¸ªä¸“æ³¨äº WPFï¼ˆWindows Presentation Foundationï¼‰ç”¨æˆ·ç•Œé¢è®¾è®¡ä¸å¼€å‘çš„ç¤ºä¾‹é¡¹ç›®ã€‚è¯¥é¡¹ç›®æ—¨åœ¨ä¸ºå¼€å‘è€…æä¾›ä¸€ä¸ªå…¨é¢ã€å®ç”¨çš„å‚è€ƒèŒƒä¾‹ï¼Œå¸®åŠ©ä»–ä»¬å¿«é€ŸæŒæ¡ WPF åº”ç”¨å¼€å‘çš„æ ¸å¿ƒæŠ€å·§å’Œæœ€ä½³å®è·µï¼Œæå‡å¼€å‘æ•ˆç‡ä¸ç•Œé¢è®¾è®¡æ°´å¹³ã€‚é€šè¿‡ä¸°å¯Œçš„åŠŸèƒ½æ¨¡å—å’Œä»£ç ç¤ºä¾‹ï¼Œå¼€å‘è€…å¯ä»¥æ·±å…¥äº†è§£ WPF çš„å¼ºå¤§ç‰¹æ€§ï¼Œå¹¶å°†å…¶çµæ´»åº”ç”¨äºå®é™…é¡¹ç›®ä¸­ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F15oTrGmLzGl4AAUV6maIgw" target="_blank" title="https://mp.weixin.qq.com/s/15oTrGmLzGl4AAUV6maIgw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/15oTrGmLzâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a24154ae6baf4a4abe006b250011e0aa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=8o%2Bl%2BjX7g6ofRRlwWg7bi7C6q%2BI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-9">ä¸€æ¬¾åŸºäº .NET 8 + Vue å‰åç«¯åˆ†ç¦»çš„å¿«é€Ÿå¼€å‘æ¡†æ¶ï¼Œè§£å†³ 70% çš„é‡å¤å·¥ä½œï¼</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ZrAdminNetCoreÂ æ˜¯ä¸€æ¬¾åŸºäºå‰åç«¯åˆ†ç¦»æ¶æ„ã€è·¨å¹³å°éƒ¨ç½²çš„é€šç”¨æƒé™ç®¡ç†åå°ç³»ç»Ÿï¼Œé‡‡ç”¨Â RBACï¼ˆRole-Based Access Controlï¼‰Â æƒé™æ¨¡å‹è®¾è®¡ï¼Œæ”¯æŒå¤šç§Ÿæˆ·ã€åŠ¨æ€èœå•ã€ç»†ç²’åº¦æƒé™æ§åˆ¶ç­‰åŠŸèƒ½ã€‚é¡¹ç›®ä»¥Â .NET CoreÂ ä¸ºåç«¯æŠ€æœ¯æ ˆï¼Œç»“åˆç°ä»£åŒ–å‰ç«¯æ¡†æ¶æ„å»ºï¼Œé€‚ç”¨äºä¼ä¸šçº§ä¸­åå°ç®¡ç†ç³»ç»Ÿå¿«é€Ÿå¼€å‘ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FilK-HScDVxb9tBykwgP_JQ" target="_blank" title="https://mp.weixin.qq.com/s/ilK-HScDVxb9tBykwgP_JQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/ilK-HScDVâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b10e69eb50b34b46a44e7a6e49522c35~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=oPvimKfOYTCAyP03fo7uZ%2FyuBU0%3D" alt="" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3f8875103a4d4b548847114e259a4e5f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=RTruBica7oXG6cFg4A4%2Bvxl8BoI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-10">ã€è¯‘ã€‘Avalonia UIä¸è°·æ­ŒFlutterå›¢é˜Ÿåˆä½œå°†Impelleræ¸²æŸ“å¼•æ“å¼•å…¥.NET</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æˆ‘ä»¬æ¿€åŠ¨åœ°å®£å¸ƒé˜¿ç“¦æ´›å°¼äºšåœ¨æ¸²æŸ“æŠ€æœ¯é“è·¯ä¸Šè¿æ¥ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ã€‚æˆ‘ä»¬çš„å›¢é˜Ÿæ­£ä¸è°·æ­ŒFlutterå·¥ç¨‹å¸ˆåˆä½œï¼Œå°†å…¶ä¸‹ä¸€ä»£"GPUä¼˜å…ˆ"æ¸²æŸ“å™¨Impellerå¼•å…¥.NETå¼€å‘è€…ç”Ÿæ€ã€‚è¿™é¡¹æŠ€æœ¯åˆä½œæ—¨åœ¨çªç ´è·¨å¹³å°æ€§èƒ½è¾¹ç•Œï¼Œå±•ç°å¼€æºç¤¾åŒºå¦‚ä½•é€šè¿‡åä½œåˆ›é€ æ›´å¤§ä»·å€¼ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FBQz1GrnknYqlAMujSJQ55A" target="_blank" title="https://mp.weixin.qq.com/s/BQz1GrnknYqlAMujSJQ55A" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/BQz1Grnknâ€¦</a></li>
</ul>
<h2 data-id="heading-11">ä¸€æ¬¾ .NET å¼€æºå…è´¹ã€åŠŸèƒ½å…¨é¢çš„ä¸²å£è°ƒè¯•ç¥å™¨ï¼Œå·¥æ§å¿…å¤‡æ•ˆç‡å·¥å…·ï¼</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> BYSerial æ˜¯ä¸€æ¬¾åŠŸèƒ½å…¨é¢ã€ç”¨æˆ·å‹å¥½çš„ä¸²å£è°ƒè¯•å·¥å…·ï¼Œé€‚ç”¨äºå·¥æ§é¢†åŸŸã€ç‰©è”ç½‘å¼€å‘ã€åµŒå…¥å¼ç³»ç»Ÿå¼€å‘ç­‰å¤šç§åœºæ™¯ã€‚é¡¹ç›®å¼€æºå…è´¹ï¼ˆMIT Licenseï¼‰ï¼Œæ”¯æŒå¤šè¯­è¨€åˆ‡æ¢ã€è‡ªåŠ¨æ›´æ–°ã€è‡ªå®šä¹‰å¿«æ·å‘½ä»¤ç­‰åŠŸèƒ½ï¼Œæ˜¯å·¥æ§é¢†åŸŸå¿…å¤‡çš„æ•ˆç‡å·¥å…·ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F6aJr_eT1kFCgvBvILXHkXQ" target="_blank" title="https://mp.weixin.qq.com/s/6aJr_eT1kFCgvBvILXHkXQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/6aJr_eT1kâ€¦</a></li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87c8079ad7a34f52857d19b403b3552f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L-96YCQ5pe25YWJ6ICF:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381005&amp;x-signature=BMcKIQQlkPErIQrkouOP2Cbq2Fg%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-12">.NET æ AI ä¸è¡Œï¼Ÿ</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ä»Šå¤©ï¼Œæˆ‘è¦å‘Šè¯‰ä½ ä¸€ä¸ªè¢«ä¸¥é‡ä½ä¼°çš„äº‹å®ï¼š.NETå¼€å‘è€…ä¸ä»…èƒ½åšAIï¼Œè€Œä¸”å¯èƒ½æ˜¯æœ€é€‚åˆæŠŠAIè½åœ°åˆ°ç”Ÿäº§ç¯å¢ƒçš„é‚£ç¾¤äººã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fsheng-jie%2Fp%2F19200934" target="_blank" title="https://www.cnblogs.com/sheng-jie/p/19200934" ref="nofollow noopener noreferrer">www.cnblogs.com/sheng-jie/pâ€¦</a></li>
</ul>
<h2 data-id="heading-13">ä»é›¶å¼€å§‹:C#ä¸C++å‡½æ•°ä¼ å‚â€”â€”è°ƒåŒ…ä¾ ç§˜ç±</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼ŒC# å’Œ C++ éƒ½æ˜¯éå¸¸å¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€ã€‚C# æœ‰ç€ç®€æ´çš„è¯­æ³•å’Œå¼ºå¤§çš„æ¡†æ¶æ”¯æŒï¼Œè€Œ C++ åœ¨æ€§èƒ½å’Œåº•å±‚æ“ä½œä¸Šæœ‰ç€ç‹¬ç‰¹çš„ä¼˜åŠ¿ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åœ¨ C# é¡¹ç›®ä¸­è°ƒç”¨ C++ ç¼–å†™çš„é«˜æ€§èƒ½å‡½æ•°ï¼Œæ¯”å¦‚å¤„ç†å¤æ‚çš„å›¾åƒç®—æ³•ã€è°ƒç”¨åº•å±‚ç¡¬ä»¶æ¥å£ç­‰ï¼Œè¿˜æœ‰å°±æ˜¯å¯ä»¥æ›´å¤šçš„ä¸°å¯Œå’±ä»¬çš„ä»£ç åº“ï¼Œå› ä¸ºå¾ˆå¤šæ€§èƒ½å¥½ã€å®ç”¨ã€è·¨å¹³å°çš„åº“éƒ½æ˜¯C++å†™çš„ï¼Œå¯ä»¥æå¤§æ‰©å±•å’±ä»¬ç¨‹åºçš„åº”ç”¨åœºæ™¯ã€‚ä½†å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œç¬¬ä¸€å¤§éš¾é¢˜å°±æ˜¯æ–¹æ³•/å‡½æ•°çš„è°ƒç”¨ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹C#è°ƒç”¨C++åŠ¨æ€é“¾æ¥åº“å‡½æ•°çš„è¯¦ç»†å®ç°ï¼ˆä»¥windowsç³»ç»Ÿä¸ºä¾‹ï¼‰ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fluojin765%2Fp%2F19199730" target="_blank" title="https://www.cnblogs.com/luojin765/p/19199730" ref="nofollow noopener noreferrer">www.cnblogs.com/luojin765/pâ€¦</a></li>
</ul>
<h2 data-id="heading-14">ASP.NET Core Blazor æ ¸å¿ƒåŠŸèƒ½ä¸‰ï¼šBlazorä¸JavaScriptäº’æ“ä½œâ€”â€”è®©Webå¼€å‘æ›´çµæ´»</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠBlazorä¸­C#ä¸JavaScriptäº’æ“ä½œã€‚æˆ‘çŸ¥é“å¾ˆå¤šåŒå­¦åœ¨å¬åˆ°"Blazor"å’Œ"JavaScript"è¦ä¸€èµ·å·¥ä½œæ—¶ä¼šæœ‰ç‚¹æ‡µï¼Œä½†åˆ«æ‹…å¿ƒï¼Œæˆ‘ä¼šç”¨æœ€ç®€å•çš„æ–¹å¼å¸¦ä½ æŒæ¡è¿™ä¸ªæŠ€èƒ½ï¼</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fshenchuanchao%2Fp%2F19194651" target="_blank" title="https://www.cnblogs.com/shenchuanchao/p/19194651" ref="nofollow noopener noreferrer">www.cnblogs.com/shenchuanchâ€¦</a></li>
</ul>
<h2 data-id="heading-15">ASP.NET Core Blazor æ ¸å¿ƒåŠŸèƒ½äºŒï¼šBlazorè¡¨å•å’ŒéªŒè¯</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> æœ¬æ–‡ä»‹ç»äº†Blazorä¸­EditFormç»„ä»¶çš„ä½¿ç”¨åŠè¡¨å•éªŒè¯æ–¹æ¡ˆã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fshenchuanchao%2Fp%2F19189573" target="_blank" title="https://www.cnblogs.com/shenchuanchao/p/19189573" ref="nofollow noopener noreferrer">www.cnblogs.com/shenchuanchâ€¦</a></li>
</ul>
<h2 data-id="heading-16">ã€EF Coreã€‘â€œå¤šå¯¹å¤šâ€å…³ç³»ä¸è·³è·ƒå¯¼èˆª</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> â€œå¤šå¯¹å¤šâ€å…³ç³»ä¸åƒâ€œä¸€å¯¹å¤šâ€é‚£ä¹ˆâ€œå•çº¯â€ï¼Œå®ƒå†…éƒ¨æ¶‰åŠåˆ°â€œè¿æ¥å®ä½“â€ï¼ˆJoin Entityï¼‰çš„æ¦‚å¿µã€‚å’±ä»¬å…ˆæ”¾ä¸‹è¿™ä¸ªæ¦‚å¿µä¸è¡¨ï¼Œæ¥äº†è§£ä¸€ä¸‹å¤šå¯¹å¤šæ•°æ®è¡¨ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªâ€œè¾…åŠ©è¡¨â€æ¥å»ºç«‹å…³ç³»ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Ftcjiaan%2Fp%2F19184567" target="_blank" title="https://www.cnblogs.com/tcjiaan/p/19184567" ref="nofollow noopener noreferrer">www.cnblogs.com/tcjiaan/p/1â€¦</a></li>
</ul>
<h2 data-id="heading-17">LVGLSharpï¼šLVGLçš„C#ç»‘å®šåº“ä»‹ç»</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> åœ¨åµŒå…¥å¼ç³»ç»Ÿå’Œå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆGUIï¼‰å¼€å‘é¢†åŸŸï¼ŒLVGLï¼ˆLight and Versatile Graphics Libraryï¼‰æ˜¯ä¸€ä¸ªå¹¿å—æ¬¢è¿çš„å¼€æºå›¾å½¢åº“ï¼Œå®ƒæä¾›äº†ä¸°å¯Œçš„UIç»„ä»¶å’Œé«˜æ•ˆçš„æ¸²æŸ“èƒ½åŠ›ï¼Œé€‚ç”¨äºå„ç§èµ„æºå—é™çš„è®¾å¤‡ã€‚è€ŒLVGLSharpåˆ™æ˜¯LVGLçš„ä¸€ä¸ªC#ç»‘å®šåº“ï¼Œå®ƒä½¿å¾—.NETå¼€å‘è€…èƒ½å¤Ÿæ›´æ–¹ä¾¿åœ°åˆ©ç”¨LVGLçš„å¼ºå¤§åŠŸèƒ½ï¼Œåœ¨C#ç¯å¢ƒä¸­åˆ›å»ºå‡ºç¾è§‚ä¸”é«˜æ•ˆçš„å›¾å½¢ç•Œé¢ã€‚æœ¬æ–‡å°†è¯¦ç»†ä»‹ç»LVGLSharpåŠå…¶ç‰¹ç‚¹ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.cnblogs.com%2Fshanyou%2Fp%2F19185046" target="_blank" title="https://www.cnblogs.com/shanyou/p/19185046" ref="nofollow noopener noreferrer">www.cnblogs.com/shanyou/p/1â€¦</a></li>
</ul>
<h2 data-id="heading-18">Copilot Studio å¦‚ä½•ä½¿ç”¨ .NET å’Œ WebAssembly å®ç°æ€§èƒ½å’Œåˆ›æ–°</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> Microsoft Copilot Studio å¤„äºå¯¹è¯å¼ AI å’Œè‡ªåŠ¨åŒ–çš„æœ€å‰æ²¿ï¼Œä½¿ç»„ç»‡èƒ½å¤Ÿä¸ºå„ç§ä¼ä¸šåœºæ™¯æ„å»ºã€è‡ªå®šä¹‰å’Œç®¡ç†æ™ºèƒ½åŠ©æ‰‹å’Œæœºå™¨äººã€‚éšç€å¹³å°çš„å‘å±•ï¼Œæ”¯æ’‘å®ƒçš„æŠ€æœ¯ä¹Ÿåœ¨ä¸æ–­å‘å±•ã€‚Copilot Studio åˆ›æ–°çš„æ ¸å¿ƒæ˜¯å®ƒä¸ .NET çš„æ·±åº¦é›†æˆï¼ŒåŒ…æ‹¬åœ¨ WebAssembly ï¼ˆWASMï¼‰ ä¸Šä½¿ç”¨ .NETã€‚è¿™ç¯‡æ–‡ç« æ¢è®¨äº† Copilot Studio å¦‚ä½•åˆ©ç”¨ .NETã€å¹³å°å‡çº§å¸¦æ¥çš„å¥½å¤„ï¼Œä»¥åŠç”±æ­¤å¸¦æ¥çš„æ€§èƒ½ã€æˆæœ¬å’Œç”Ÿäº§åŠ›æ”¹è¿›ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fdevblogs.microsoft.com%2Fdotnet%2Fcopilot-studio-dotnet-wasm%2F" target="_blank" title="https://devblogs.microsoft.com/dotnet/copilot-studio-dotnet-wasm/" ref="nofollow noopener noreferrer">devblogs.microsoft.com/dotnet/copiâ€¦</a></li>
</ul>
<h2 data-id="heading-19">.NET Conf 2025å³å°†å¼€å§‹</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> .NET Conf 2025 ä»…å‡ å¤©åå°±è¦å¼€å§‹äº†ï¼Œå‚åŠ 11 æœˆ 11 æ—¥è‡³ 13 æ—¥çš„è¿™åœºå…è´¹ä¸‰æ—¥è™šæ‹Ÿä¼šè®®ï¼Œäº†è§£ .NET å¹³å°ã€å¼€æºé¡¹ç›®å’Œå¼€å‘è€…å·¥å…·çš„æœ€æ–°è¿›å±•â€”åŒ…æ‹¬ .NET 10 çš„æ­£å¼å‘å¸ƒï¼Œä»¥åŠå¯¹ Visual Studio 2026 çš„æ·±åº¦æ¢è®¨ã€‚ä»Šå¹´çš„ä¼šè®®ç‰¹åˆ«èšç„¦ä½¿ç”¨ Aspire è¿›è¡Œäº‘åŸç”Ÿå¼€å‘ã€å¿«é€Ÿåœ°å°†ç°æœ‰åº”ç”¨å‡çº§åˆ° .NET 10ï¼Œä»¥åŠä½¿ç”¨ AI æ„å»ºæ™ºèƒ½åº”ç”¨ï¼ŒåŒ…æ‹¬å…¨æ–°çš„ Microsoft Agent Framework å’Œ Model Context Protocol (MCP) æ”¯æŒã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FGqLWiGQ77EZ4MTUFhwGqUA" target="_blank" title="https://mp.weixin.qq.com/s/GqLWiGQ77EZ4MTUFhwGqUA" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/GqLWiGQ77â€¦</a></li>
</ul>
<h2 data-id="heading-20">AI æ—¶ä»£ï¼Œ.NET å¼€å‘è€…å‘å·¦è¿˜æ˜¯å‘å³ï¼Ÿ</h2>
<ul>
<li><strong>æ–‡ç« ç®€ä»‹ï¼š</strong> AI æ—¶ä»£ï¼Œ.NET å¼€å‘è€…å‘å·¦è¿˜æ˜¯å‘å³ï¼Ÿ MAF vs LangChain 1.0 ä¸€åœºå…³ä¹æœªæ¥çš„æŠ€æœ¯é€‰æ‹©ã€‚</li>
<li><strong>æ–‡ç« åœ°å€ï¼š</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FXBYYsjkmhuDEq3gyTvSmmQ" target="_blank" title="https://mp.weixin.qq.com/s/XBYYsjkmhuDEq3gyTvSmmQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/XBYYsjkmhâ€¦</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåŸºäº Apache Doris çš„æ•°æ®æ¨¡å‹è®¾è®¡ä¸å®è·µ]]></title>    <link>https://juejin.cn/post/7570903763721797642</link>    <guid>https://juejin.cn/post/7570903763721797642</guid>    <pubDate>2025-11-10T12:03:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763721797642" data-draft-id="7570932873130803227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåŸºäº Apache Doris çš„æ•°æ®æ¨¡å‹è®¾è®¡ä¸å®è·µ"/> <meta itemprop="keywords" content="æ•°æ®åº“,Apache"/> <meta itemprop="datePublished" content="2025-11-10T12:03:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåŸºäº Apache Doris çš„æ•°æ®æ¨¡å‹è®¾è®¡ä¸å®è·µ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:03:56.000Z" title="Mon Nov 10 2025 12:03:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»15åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>è´§æ‹‰æ‹‰æ˜¯å›½å†…é¢†å…ˆçš„åŒåŸè´§è¿æ•°å­—åŒ–å¹³å°ï¼Œæˆç«‹äº 2013 å¹´ã€‚æˆªâ¾„2025 å¹´ 4â½‰ ï¼Œè´§æ‹‰æ‹‰ä¸šåŠ¡è¦†ç›–å…¨çƒ 14 ä¸ªå¸‚åœº ï¼Œ400+ åŸå¸‚ ï¼Œå…¶ä¸­ä¸­å›½å†…åœ°æ€»å…±è¦†ç›– 363 åº§åŸå¸‚ ï¼Œâ½‰æ´»å¸æœºè¾¾ 120 ä¸‡ ï¼Œâ½‰æ´»â½¤æˆ·è¾¾ 1400 ä¸‡ï¼Œ å¹¶åœ¨å…¨çƒè®¾æœ‰ 6 ä¸ªæ•°æ®ä¸­â¼¼ã€‚ä½œä¸ºå…±äº«ç»æµæ¨¡å¼çš„ä»£è¡¨ä¼ä¸š ï¼Œè´§æ‹‰æ‹‰é€šè¿‡ç§»åŠ¨äº’è”â½¹æŠ€æœ¯æ•´åˆç¤¾ä¼šè¿â¼’èµ„æº ï¼Œä¸ºâ½¤æˆ·æä¾›å³æ—¶è´§è¿ã€ä¼ä¸šç‰©æµã€æ¬å®¶æœåŠ¡ç­‰å¤šå…ƒåŒ–è§£å†³â½…æ¡ˆã€‚</p>
<p>åœ¨åºâ¼¤çš„ä¸šåŠ¡è§„æ¨¡ä¸‹ ï¼Œæ„å»ºå®Œå–„çš„â½¤æˆ·ç”»åƒå¹³å°æˆä¸ºå®ç°ç²¾ç»†åŒ–è¿è¥çš„é‡è¦åŸºç¡€ ï¼Œå¯ä»¥æœ‰æ•ˆæå‡è¿è¥æ•ˆç‡å’Œâ½¤æˆ·ä½“éªŒã€‚</p>
<h2 data-id="heading-0">ç”»åƒæœåŠ¡èƒŒæ™¯ä¸æ¶æ„</h2>
<p>ç›®å‰è´§æ‹‰æ‹‰çš„ç”»åƒå¹³å°å·²æ·±åº¦åº”ç”¨äºå¤šä¸ªæ ¸å¿ƒä¸šåŠ¡åœºæ™¯ï¼Œå„ä¸šåŠ¡åœºæ™¯å¯¹æ ‡ç­¾çš„ä½¿â½¤â½…å¼å’Œæ—¶æ•ˆæ€§è¦æ±‚å„ä¸ç›¸åŒã€‚ä» 22 å¹´åˆ° 25 å¹´ï¼Œç”¨æˆ·å‘ˆç°ç¨³å®šå¢é•¿è¶‹åŠ¿ï¼Œä¸šåŠ¡å¯¹æœåŠ¡çš„å‹åŠ›ä¹Ÿæ˜¯é€å¹´é€’å¢ï¼Œç´¯è®¡æ¥å…¥äº† 300+ ä¸šåŠ¡ï¼Œ3,000+ ä¸ªæ ‡ç­¾ä»¥åŠ 5 ä¸‡å¤šäººç¾¤ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c66913f70762483c865b8f6a4c96ca0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=ygxNmiZsth03AsIZmiNNqnrZksE%3D" alt="ç”»åƒæœåŠ¡èƒŒæ™¯ä¸æ¶æ„.png" loading="lazy"/></p>
<h3 data-id="heading-1">01 åº”ç”¨æ¶æ„</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55e13b8607e243a98ef31a3995963291~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=2ko8cdEzlCDoZJZYfm9wMalSkio%3D" alt="è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåº”ç”¨æ¶æ„.PNG" loading="lazy"/></p>
<p>ä¸Šå›¾æ˜¯è´§æ‹‰æ‹‰ç”»åƒå¹³å°æ•´ä½“æ¶æ„å›¾ï¼ŒApache Doris ä½œä¸ºç»Ÿä¸€æŸ¥è¯¢å¼•æ“ï¼Œä¸ºäººç¾¤ç”»åƒæä¾›é«˜æ•ˆçš„åˆ†æèƒ½åŠ›ã€‚è¯¥å¹³å°é€šè¿‡æ¶æ„åˆ†å±‚å®ç°äº†ä¸šåŠ¡éœ€æ±‚ä¸æŠ€æœ¯èƒ½åŠ›çš„ç²¾å‡†åŒ¹é…ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¨¡å—ï¼š</p>
<ul>
<li>API å±‚ï¼ˆæ¥â¼æœåŠ¡å±‚ï¼‰ï¼šåŸºäºé‡ç‚¹ä½¿â½¤åœºæ™¯å’Œå¯¹æ¥ç³»ç»Ÿæ­å»ºçš„ç”»åƒæ¥å£æœåŠ¡ ï¼Œä»â½½ç²¾å‡†åœ°â½£æˆç”¨æˆ·ç”»åƒ ï¼Œç»™åˆ°å¯¹æ¥ä¸šåŠ¡â½…ä½¿â½¤ã€‚å…¶ä¸­åŒ…æ‹¬ï¼š
<ul>
<li>persona-apiï¼šâ¾¯å‘â¾¼å¹¶å‘æŸ¥è¯¢åœºæ™¯</li>
<li>persona-analysis-apiï¼šæ‰¿æ¥åˆ†æè®¡ç®—ä¸æ¨é€ä½œä¸šè¯·æ±‚</li>
<li>persona-web-apiï¼šâ½€æŒç®¡ç†åå°çš„ Web æœåŠ¡</li>
</ul>
</li>
<li>BE å±‚ï¼ˆè®¡ç®—å¼•æ“å±‚ï¼‰ ï¼šå»ºé€ åŸºäºå¤§æ•°æ®ä½“ç³»çš„ç”¨æˆ·æ ‡ç­¾é“¾è·¯çš„ç”»åƒç®¡ç†å¹³å° ï¼Œâ½¤äºåœ¨ç‰¹å®šä¸šåŠ¡å½¢æ€ä¸‹æè¿°ä¸šåŠ¡ä¸»ä½“ï¼›å…¶ä¸­åŒ…æ‹¬ï¼š
<ul>
<li>persona-taskï¼šæ‰§â¾åˆ†å¸ƒå¼è®¡ç®—ä½œä¸š ï¼Œâ½€æŒæ¨ªå‘æ‰©å±•</li>
<li>persona-scheduler ï¼šè°ƒåº¦â¼ˆç¾¤è®¡ç®—ä»»åŠ¡</li>
</ul>
</li>
</ul>
<p>ä¸¤å¤§æ¨¡å—ååŒå·¥ä½œï¼Œå…±åŒæ”¯æ’‘ä¸šåŠ¡æ–¹çš„ç²¾ç»†åŒ–è¿è¥éœ€æ±‚ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1331ddf1992b4fcfa2c32bf8ae770647~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=wp%2F6LvWGnjEARAq8aX614Wrq2Xo%3D" alt="è´§æ‹‰æ‹‰ç”¨æˆ·ç”»åƒåº”ç”¨æ¶æ„-1.PNG" loading="lazy"/></p>
<h3 data-id="heading-2">02 ç”»åƒå¹³å°è®¡ç®—å¼•æ“æ¼”è¿›</h3>
<p>åœ¨æ ¸å¿ƒè®¡ç®—å¼•æ“çš„é€‰å‹ä¸æ¼”è¿›è¿‡ç¨‹ä¸­ï¼ŒæŠ€æœ¯å›¢é˜Ÿç»å†äº†ä¸‰ä¸ªä¸»è¦é˜¶æ®µã€‚</p>
<ul>
<li>ç¬¬ä¸€é˜¶æ®µï¼Œå—é™äºæˆæœ¬å› ç´ ï¼Œé‡‡ç”¨äº†ä¸‰æ–¹æœåŠ¡ç»“åˆ Impala+KUDU çš„æ¶æ„ä½œä¸ºç”¨æˆ·ç”»åƒè®¡ç®—å¼•æ“ã€‚è¯¥æ¶æ„åœ¨å®é™…åº”ç”¨ä¸­æš´éœ²å‡ºè¯¸å¤šé—®é¢˜ï¼šå•æ¬¡äººç¾¤è®¡ç®—è€—æ—¶ 10 åˆ†é’Ÿä»¥ä¸Šï¼Œé«˜å³°æœŸç”šè‡³è¶…è¿‡ 30 åˆ†é’Ÿï¼›åŒæ—¶ï¼Œæ•°æ®å¯¼å…¥è€—æ—¶è¾ƒé•¿ï¼Œç»å¸¸è¶…æ—¶ã€‚æ­¤å¤–ï¼Œè¯¥æ¶æ„å­˜åœ¨æ¨ªå‘æ‰©å±•å›°éš¾ã€å¤æ‚æŸ¥è¯¢æ•ˆç‡åä½åŠè¿ç»´å¤æ‚ç­‰ä¸è¶³ã€‚</li>
<li>ç¬¬äºŒé˜¶æ®µï¼Œä¸ºå¯»æ±‚æ”¹è¿›ï¼Œæˆ‘ä»¬å°è¯•å¼•å…¥ Elasticsearchï¼Œè™½åœ¨ä¸€å®šç¨‹åº¦ä¸Šæœ‰æ‰€ç¼“è§£ï¼Œä½†ä»é¢ä¸´å¼€å‘æˆæœ¬é«˜ã€è¯­æ³•å¤æ‚ã€å¤šç»´åˆ†æèƒ½åŠ›ä¸è¶³ç­‰æŒ‘æˆ˜ï¼Œä¸”åœ¨åŠ¨æ€æ‰©å±•å’Œå¤æ‚æŸ¥è¯¢æ–¹é¢æœªå®ç°æ ¹æœ¬æ€§æ”¹å–„ã€‚å°¤å…¶åœ¨å¤„ç†äººç¾¤é—´å­˜åœ¨ä¾èµ–å…³ç³»çš„ç‰¹æ®Šä¸šåŠ¡åœºæ™¯æ—¶ï¼ŒElasticsearch æ¶æ„éš¾ä»¥æœ‰æ•ˆæ”¯æŒã€‚</li>
<li>åŸºäºæ­¤ï¼Œæˆ‘ä»¬æœ€ç»ˆè½¬å‘é‡‡ç”¨ Doris ä½œä¸ºæ ¸å¿ƒè®¡ç®—å¼•æ“ã€‚é€‰æ‹© Doris çš„å…³é”®å› ç´ å¦‚ä¸‹ï¼š
<ul>
<li><strong>æ€§èƒ½ä¼˜è¶Š</strong>ï¼šåŸºäº MPP æ¶æ„ã€å…·å¤‡å‘é‡åŒ–å¼•æ“å’Œå…ˆè¿›çš„ä¼˜åŒ–å™¨èƒ½åŠ›ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¼˜ç§€ã€‚</li>
<li><strong>ç¤¾åŒºèµ„æºä¸°å¯Œ</strong>ï¼šDoris æ‹¥æœ‰æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒä»¥åŠä¸°å¯Œçš„æ–‡æ¡£èµ„æ–™ï¼Œè‡ªè¡Œæ­å»ºé‡åˆ°å¡ç‚¹æ—¶ï¼Œå¯å‘ç¤¾åŒºå¸®åŠ©å¯»æ±‚ä¸“ä¸šçš„æŒ‡å¯¼ä¸å¸®åŠ©ã€‚</li>
<li><strong>æ”¯æŒå¤šç§æ•°æ®ç±»å‹</strong>ï¼šç”»åƒåœºæ™¯å¯ä»¥ä½¿ç”¨ BITMAP å®ç°é«˜æ•ˆçš„äº¤å¹¶é›†è¿ç®—ï¼Œæˆä¸ºæ”¯æ’‘å¤šæ ·åŒ–æ ‡ç­¾ç±»å‹ä¸äººç¾¤åˆ†æä¸šåŠ¡çš„æŠ€æœ¯åŸºç¡€ã€‚</li>
<li><strong>æ”¯æŒå¤šç§æ•°æ®æ¨¡å‹</strong>ï¼šé’ˆå¯¹å¤šç»´å¤æ‚çš„äººç¾¤ç”»åƒï¼Œå¯ä»¥ä½¿ç”¨ä¸åŒçš„æ•°æ®æ¨¡å‹æ”¯æ’‘å„ç§æ ‡ç­¾ç±»å‹ä¸äººç¾¤ä¸šåŠ¡ã€‚</li>
</ul>
</li>
</ul>
<p>è‡ªå¼•å…¥ Doris åï¼Œç³»ç»Ÿç¨³å®šæ€§å¾—åˆ°äº†æ˜¾è‘—æå‡ï¼Œè‡³ä»Šæœªå‡ºç°è¿‡é‡å¤§ç¨³å®šæ€§é—®é¢˜ï¼Œæ•´ä½“é“¾è·¯çš„æ—¶æ•ˆæ€§ä¸å¯é æ€§å‡å®ç°äº†æ ¹æœ¬æ€§çš„ä¼˜åŒ–ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<ul>
<li>åœ¨è®¡ç®—æ•ˆç‡æ–¹é¢ï¼Œå•ä¸ªäººç¾¤çš„è®¡ç®—èƒ½å¤Ÿå®ç°ç§’çº§å“åº”ï¼Œå³ä½¿åœ¨é«˜å³°æœŸï¼Œå“åº”æ—¶é—´ä¹Ÿä¿æŒåœ¨ 1 åˆ†é’Ÿä»¥å†…ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒImpala æ¶æ„ä¸‹è¯¥è®¡ç®—è¿‡ç¨‹é€šå¸¸éœ€è¦ 10 è‡³ 30 åˆ†é’Ÿã€‚<strong>é‡‡ç”¨ Doris åï¼Œè®¡ç®—æ•ˆç‡æå‡äº†è¿‘ 30 å€ã€‚</strong></li>
<li>åœ¨æ•°æ®å¯¼å…¥æ–¹é¢ï¼ŒDoris åŒæ ·è¡¨ç°å‡ºè‰²ã€‚åœ¨å¤„ç† 4 äº¿è¡Œ 200 åˆ—çš„å•è¡¨æ•°æ®æ—¶ï¼ŒDoris å¯åœ¨ 30 åˆ†é’Ÿå†…å®Œæˆå¯¼å…¥æ“ä½œã€‚è€Œåœ¨åŒç­‰æ¡ä»¶ä¸‹ï¼ŒImpala æ¶æ„åˆ™éœ€è¦ 90 åˆ†é’Ÿä»¥ä¸Šï¼Œ<strong>Doris æ•°æ®å¯¼å…¥æ•ˆç‡æ˜¯ Impala æ¶æ„çš„ 3 å€</strong>ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e11a63c30e5d480b82e6415f75c1b972~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=pHrcYb7lNVtrHwxTHa8vw%2Fohwto%3D" alt="ç”»åƒå¹³å°è®¡ç®—å¼•æ“æ¼”è¿›.png" loading="lazy"/></p>
<h2 data-id="heading-3">æ•°æ®æ¨¡å‹è®¾è®¡ä¸å¼‚æ„æŸ¥è¯¢å®ç°</h2>
<h3 data-id="heading-4">01 æ ¸å¿ƒæŒ‘æˆ˜</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0942780c34794cc5a1867f7ce10fb846~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=N0laRIszv2f04xcN5fy%2Bcyyip4E%3D" alt="æ ¸å¿ƒæŒ‘æˆ˜.png" loading="lazy"/></p>
<p>é¦–å…ˆæ˜¯ç”¨æˆ·ç”»åƒæ ‡ç­¾å­˜å‚¨çš„æŒ‘æˆ˜ã€‚é¢å¯¹ 3000+ æ ‡ç­¾çš„ä½“ç³»ï¼Œæˆ‘ä»¬å‘ç°æ ‡ç­¾æ•°æ®å¤©ç„¶å­˜åœ¨ä¸‰ä¸ªç»´åº¦çš„åˆ†è£‚ç‰¹å¾ï¼šä¸šåŠ¡å±æ€§ï¼ˆè¡Œä¸º/å±æ€§/åœ°ç†ç­‰ï¼‰ã€èšåˆç²’åº¦ï¼ˆæ˜ç»†/èšåˆ/äººç¾¤ï¼‰ã€æ›´æ–°æ—¶æ•ˆï¼ˆç¦»çº¿/è¿‘å®æ—¶/å®æ—¶ï¼‰ã€‚ä¸åŒä¸šåŠ¡å±æ€§çš„æ•°æ®åœ¨æ›´æ–°é¢‘ç‡ã€æŸ¥è¯¢æ¨¡å¼ã€å­˜å‚¨å¯†åº¦ä¸Šå·®å¼‚å·¨å¤§ã€‚</p>
<p>æ­¤å¤–ï¼Œç”¨æˆ·ä½¿ç”¨ç”»åƒæ ‡ç­¾çš„æ—¶å€™ï¼Œå¯¹äººç¾¤æ ‡ç­¾/æ˜ç»†æ ‡ç­¾/èšåˆæ ‡ç­¾ç­‰æ¦‚å¿µä¸æ¸…æ™°ï¼Œåªä¼šè¿›è¡Œç®€å•çš„æ‹–æ‹‰æ‹½æ‹¼æ¥è§„åˆ™ã€‚å› æ­¤åœ¨æ ‡ç­¾ä½¿ç”¨åœºæ™¯ï¼Œå¦‚ä½•é€‰æ‹©å­˜å‚¨æ¨¡å‹æˆä¸ºäº†æ ¸å¿ƒé—®é¢˜ã€‚è‹¥ä½¿ç”¨å®½è¡¨ï¼Œå°†é¢ä¸´åŠ¨æ€æ›´æ–°ä»¥åŠåˆ—æ‹“å±•çš„æŒ‘æˆ˜ï¼›è€Œé«˜è¡¨åˆ™é¢ä¸´å¤æ‚æŸ¥è¯¢ä¸åµŒå¥—é€»è¾‘çš„æŒ‘æˆ˜ã€‚</p>
<h3 data-id="heading-5">02 å­˜å‚¨æ¨¡å‹è®¾è®¡</h3>
<p>é¢å¯¹å¤æ‚çš„æ ‡ç­¾ç®¡ç†ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†<strong>åŸºäº Apache Doris åˆ†è€Œæ²»ä¹‹çš„å­˜å‚¨æ–¹æ¡ˆ</strong>ï¼Œå…·ä½“åˆ†ä¸ºä¸‰ç±»æ¨¡å‹æ¥è¿›è¡ŒååŒå·¥ä½œã€‚</p>
<p><strong>æ ‡ç­¾å®½è¡¨</strong></p>
<ul>
<li>å­˜å‚¨ä½é¢‘æ›´æ–°çš„æ ‡ç­¾ã€‚</li>
<li>å­˜å‚¨æ— æ³•ç”¨é«˜è¡¨å­˜å‚¨çš„å¯†é›†æ ‡ç­¾ã€‚</li>
<li>åˆ©ç”¨ Doris çš„åˆ—å¼å­˜å‚¨æŠ€æœ¯ï¼Œåˆ©ç”¨ç´¢å¼•ã€ç‰©åŒ–è§†å›¾ç­‰ä¼˜åŒ–æ‰‹æ®µï¼Œæ”¯æŒé«˜æ•ˆçš„å¤šç»´åˆ†æã€‚</li>
</ul>
<p>æ ‡ç­¾å®½è¡¨å»ºè¡¨ SQL å‚è€ƒï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  wide_table  (
 user_id  <span class="hljs-type">varchar</span>(<span class="hljs-number">1000</span>) <span class="hljs-keyword">NULL</span> COMMENT "",
 age  <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) REPLACE_IF_NOT_NULL <span class="hljs-keyword">NULL</span> COMMENT "",
 height  <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) REPLACE_IF_NOT_NULL <span class="hljs-keyword">NULL</span> COMMENT "",
 ......) ENGINE<span class="hljs-operator">=</span>OLAP AGGREGATE KEY( user_id ) COMMENT "OLAP"
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH( user_id ) BUCKETS <span class="hljs-number">40</span>
PROPERTIES ( ... )
</code></pre>
<p><strong>æ ‡ç­¾é«˜è¡¨</strong></p>
<ul>
<li>å­˜å‚¨é«˜é¢‘æ›´æ–°çš„ç¨€ç–æ ‡ç­¾ã€‚</li>
<li>æ”¯æŒç§’çº§/åˆ†é’Ÿçº§æ•°æ®æ›´æ–°ï¼Œæ ‡ç­¾æ–°å¢çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥è§„é¿å®½è¡¨é¢‘ç¹ ALTER TABLE å¯¼è‡´çš„é”è¡¨é—®é¢˜ã€‚</li>
<li>å¤šä¸ªæ ‡ç­¾çš„ä½å›¾äº¤å¹¶è®¡ç®—ï¼Œå¹¶ä¸”æ”¯æŒæ¯«ç§’çº§å“åº”ã€‚</li>
</ul>
<p>æ ‡ç­¾é«˜è¡¨å»ºè¡¨ SQL å‚è€ƒï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  high_table  (
 tag  <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NULL</span> COMMENT "æ ‡ç­¾å",
 tag_value  <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NULL</span> COMMENT "æ ‡ç­¾å€¼",
 <span class="hljs-type">time</span>  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT "æ•°æ®çŒå…¥æ—¶é—´",
 user_ids  bitmap BITMAP_UNION <span class="hljs-keyword">NULL</span> COMMENT "ç”¨æˆ·é›†"
) ENGINE<span class="hljs-operator">=</span>OLAP AGGREGATE KEY( tag ,  tag_value ,  <span class="hljs-type">time</span>  ) COMMENT "OLAP"
DISTRIBUTED <span class="hljs-keyword">BY</span> HASH( tag ) BUCKETS <span class="hljs-number">128</span>
PROPERTIES ( ... )
</code></pre>
<p><strong>äººç¾¤ä½å›¾è¡¨</strong></p>
<ul>
<li>ç”¨äºå­˜å‚¨æ ‡ç­¾è§„åˆ™åœˆé€‰å‡ºæ¥çš„äººç¾¤ç»“æœã€‚</li>
<li>ç”¨æˆ· ID é›†åˆä½¿ç”¨ RoaringBitmap å‹ç¼©ï¼Œé™ä½å­˜å‚¨æˆæœ¬ã€‚</li>
<li>æ”¯æŒäººç¾¤ä¾èµ–è®¡ç®—ï¼Œé¿å…è¡¨æ•°é‡è†¨èƒ€é—®é¢˜ï¼Œâ½€æŒâ¼ˆç¾¤è¥é”€å®éªŒä¸šåŠ¡ã€‚</li>
</ul>
<p>äººç¾¤ä½å›¾è¡¨å»ºè¡¨ SQL å‚è€ƒï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span>  routine_segmentation_bitmap (
 <span class="hljs-type">time</span>  datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT "æ•°æ®çŒå…¥æ—¶é—´",
 seg_name  <span class="hljs-type">varchar</span>(<span class="hljs-number">45</span>) <span class="hljs-keyword">NULL</span> COMMENT "æ ‡ç­¾å€¼",
 user_ids  bitmap BITMAP_UNION <span class="hljs-keyword">NULL</span> COMMENT "äººç¾¤IDé›†åˆ"
) ENGINE<span class="hljs-operator">=</span>OLAP AGGREGATE KEY( <span class="hljs-type">time</span> ,  seg_name )
COMMENT "OLAP" <span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> <span class="hljs-keyword">RANGE</span>(`<span class="hljs-type">time</span>`) (...)DISTRIBUTED <span class="hljs-keyword">BY</span> HASH( seg_name )
BUCKETS <span class="hljs-number">128</span>
PROPERTIES (..., "dynamic_partition.enable" <span class="hljs-operator">=</span> "true", ...);
</code></pre>
<h3 data-id="heading-6">03 äººç¾¤åœˆé€‰ä¸å¼‚æ„ç»„åˆæŸ¥è¯¢</h3>
<p>åŸºäºä¸Šè¿°æåˆ°äº†ä¸‰ç§å­˜å‚¨æ¨¡å‹ï¼Œæˆ‘ä»¬æ„å»ºäº†ä»¥ä½å›¾è®¡ç®—ä¸ºæ ¸å¿ƒçš„å¼‚æ„ç»„åˆè®¡ç®—ä½“ç³»ï¼Œå¹¶å°†å…¶ä½œç”¨äºæ•´ä¸ªäººç¾¤åœˆé€‰çš„åœºæ™¯ï¼Œå®ç°å®½è¡¨ã€é«˜è¡¨åŠäººç¾¤è¡¨è¿™ä¸‰ç±»å­˜å‚¨æ¨¡å‹ä¹‹é—´çš„æ— ç¼è”åŠ¨ã€‚</p>
<ol>
<li>ç¬¬ä¸€æ­¥ï¼šå°†æ‰€æœ‰å•ä¸€æ ‡ç­¾æˆ–å­æŸ¥è¯¢çš„ç»“æœéƒ½å¤„ç†æˆ Bitmap ä½å›¾ï¼Œå¤„ç†å®½è¡¨çš„æ ‡ç­¾ä½¿ç”¨<code>TO_BITMAP</code>èšåˆå¤šåˆ— ID ç»“æœï¼Œå¤„ç†æ ‡ç­¾é«˜è¡¨å’Œäººç¾¤è¡¨åˆ™ç›´æ¥ä½¿ç”¨é¢„èšåˆçš„ Bitmapï¼ŒåŠ é€Ÿé€»è¾‘å¤ç”¨ã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼Œé€šè¿‡<code>UNION ALL</code>æ•´åˆå®½è¡¨/é«˜è¡¨/äººç¾¤è¡¨ä¸‰ç§æ•°æ®æºçš„ Bitmapï¼Œå¹¶ä½¿ç”¨å¤–å±‚çš„<code>BITMAP_INTERSECT</code>/<code>BITMAP_UNION</code>å®ç°è·¨æ¨¡å‹äº¤å¹¶é›†è¿ç®—ï¼ˆAND/OR é€»è¾‘ï¼‰ã€‚</li>
<li>ç¬¬ä¸‰æ­¥ï¼Œç”±äº<code>BITMAP_INTERSECT</code>/<code>BITMAP_UNION</code>çš„ç»“æœä¹Ÿæ˜¯ Bitmapï¼Œæ‰€ä»¥å¯ä»¥ç”¨åŒæ ·çš„å¤„ç†æ–¹å¼ï¼Œé€’å½’æ•´åˆå­æŸ¥è¯¢çš„æŸ¥è¯¢ç»“æœï¼Œå¹¶æ”¯æŒç›´æ¥å¯¼å‡ºæˆ–å¯¹æ¥ä¸šåŠ¡ç³»ç»Ÿã€‚</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a99ecd4ce2249518f26832e57d7d1d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=sv5DbJfnXHGJ41zgvegBpAh%2Bq%2Bo%3D" alt="äººç¾¤åœˆé€‰ä¸å¼‚æ„ç»„åˆæŸ¥è¯¢.png" loading="lazy"/></p>
<p>è¯¥å®ç°æ–¹æ³•å…·å¤‡ä¸‰å¤§æ ¸å¿ƒä¼˜åŠ¿ï¼š</p>
<ul>
<li><strong>çµæ´»æ‹“å±•</strong>ï¼šåŠ¨æ€åµŒå¥—å­æŸ¥è¯¢æ”¯æŒæ— é™å±‚çº§è§„åˆ™ï¼ˆå¦‚ â€œA ä¸”ï¼ˆB æˆ– Cï¼‰ä¸”ï¼ˆD ä¸”ï¼ˆE æˆ– Fï¼‰ï¼‰â€ ï¼‰ ï¼Œé™æ€å±æ€§ã€åŠ¨æ€è¡Œä¸ºä»¥åŠé¢„è®¡ç®—äººç¾¤ç­‰å¤æ‚çš„æ ‡ç­¾è§„åˆ™çš†å¯æ— ç¼åµŒå…¥ã€‚</li>
<li><strong>èµ„æºèŠ‚çœ</strong>ï¼šå¤ç”¨äººç¾¤è¡¨ï¼ˆé¢„è®¡ç®—äººç¾¤ï¼‰çš„æ•°æ®ä»è€Œå¤§å¹…å‡è½»è®¡ç®—å‹åŠ›ï¼Œå¹¶å…è®¸ä¸åŒäººç¾¤é—´ç›¸äº’ä¾èµ–è¿›è¡Œè®¡ç®—ï¼›äººç¾¤è®¡ç®—ç»“æœä½¿ç”¨ RoaringBitmap å­˜å‚¨ï¼Œä¸éœ€è¦é¢å¤–æ–°å¢è¡¨ã€‚</li>
<li><strong>ä¸šåŠ¡å‹å¥½</strong>ï¼šæ”¯æŒäººç¾¤+æ ‡ç­¾çš„å¤æ‚æ··åˆåµŒå¥—æŸ¥è¯¢ï¼Œç”¨æˆ·æ— éœ€æŠ€æœ¯åŸºç¡€ï¼Œä»…é€šè¿‡ç®€å•çš„æ‹–æ‹½æ ‡ç­¾æ¡ä»¶å³å¯é«˜æ•ˆåœˆå®šç›®æ ‡ç”¨æˆ·ç¾¤ä½“ï¼Œé€‚ç”¨äºè¥é”€ç­‰å¤šç§åœºæ™¯ã€‚</li>
</ul>
<p>æŸ¥è¯¢ SQL ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">FROM</span> (
  <span class="hljs-comment">-- Layer1: å®½è¡¨æ¡ä»¶A</span>
  <span class="hljs-keyword">SELECT</span> TO_BITMAP(...) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾å®½è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶A
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
  <span class="hljs-comment">-- Layer1: é«˜è¡¨æ¡ä»¶B</span>
  <span class="hljs-keyword">SELECT</span> user_ids <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾é«˜è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶B
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
  <span class="hljs-comment">-- Layer1: äººç¾¤æ¡ä»¶C</span>
  <span class="hljs-keyword">SELECT</span> user_ids <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> äººç¾¤è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶C
  <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
  <span class="hljs-comment">-- Layer2: åµŒå¥—å­æŸ¥è¯¢ï¼ˆæ–°æ¡ä»¶D/E/Fï¼‰</span>
  <span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> TO_BITMAP(...) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾å®½è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶D  <span class="hljs-comment">-- æ–°å®½è¡¨æ¡ä»¶</span>
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-keyword">SELECT</span> user_ids <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> æ ‡ç­¾é«˜è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶E      <span class="hljs-comment">-- æ–°é«˜è¡¨æ¡ä»¶</span>
    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
    <span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(...) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> äººç¾¤è¡¨ <span class="hljs-keyword">WHERE</span> æ¡ä»¶F <span class="hljs-comment">-- æ–°äººç¾¤æ¡ä»¶</span>
  )
) t;
</code></pre>
<h3 data-id="heading-7">04 æ•°æ®å¯¼å…¥</h3>
<p>è´§æ‹‰æ‹‰ç”»åƒæœåŠ¡çš„å®æ—¶æ ‡ç­¾/äººç¾¤ç‚¹æŸ¥ä¸»è¦é‡‡ç”¨ HBase ä¸ Redis ç›¸ç»“åˆçš„æ–¹å¼ï¼ŒDoris ä¸»è¦æ‰¿æ‹…äººç¾¤åœˆé€‰ã€äººç¾¤æ´å¯Ÿã€è¡Œä¸ºåˆ†æç­‰ä»»åŠ¡ã€‚å®æ—¶å’Œè¿‘å®æ—¶æ ‡ç­¾å†™å…¥ Doris åˆ™é€šè¿‡ Flink å®Œæˆï¼Œç¦»çº¿å¯¼å…¥ä¾èµ– Doris çš„ Broker Load åŠŸèƒ½ã€‚å¯¹åº”çš„æ•°æ®å¯¼â¼Šâ½…å¼å’Œåº”â½¤åœºæ™¯å¦‚ä¸‹ï¼š</p>
<p><strong>å®æ—¶/è¿‘å®æ—¶æ ‡ç­¾</strong></p>
<p>å®šä¹‰ï¼šç§’çº§/å°æ—¶çº§æ›´æ–°çš„åŠ¨æ€æ•°æ®ï¼ˆå¦‚ç‚¹å‡»ã€ç™»å½•äº‹ä»¶ï¼‰ã€‚</p>
<p>æ•°æ®æºï¼šKafka æ—¥å¿—ã€API åŸ‹ç‚¹ã€äº‘æ–‡ä»¶å­˜å‚¨ã€‚</p>
<p>å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li>ç§’çº§/åˆ†é’Ÿçº§æ ‡ç­¾ï¼šFlink -&gt; Doris / Hbaseã€‚</li>
<li>å°æ—¶çº§æ ‡ç­¾ï¼šäº‘æ–‡ä»¶å­˜å‚¨ -&gt; BrokerLoadã€‚</li>
</ul>
<p>åœºæ™¯ï¼šç”¨æˆ·è¡Œä¸ºåˆ†æï¼Œç”¨æˆ·å®æ—¶äººç¾¤ã€‚</p>
<p><strong>ç¦»çº¿æ ‡ç­¾</strong></p>
<p>å®šä¹‰ï¼šT+1 æ›´æ–°çš„å†å²æ•°æ®ï¼ˆå¦‚å¹´é¾„ã€å†å²è®¢å•ï¼‰ã€‚</p>
<p>æ•°æ®æºï¼šHiveã€‚</p>
<p>å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li>æ•°æ®é‡ï¼š3000+ æ ‡ç­¾ï¼Œ4 äº¿+ç”¨æˆ·æ€»é‡ã€‚</li>
<li>å®šæ—¶è°ƒåº¦ï¼šBrokerLoadã€‚</li>
<li>è°ƒä¼˜æ‰‹æ®µï¼šå®½è¡¨å¯¼å…¥æ‹†åˆ†å¤šè¡¨å’Œå¤šä¸ª BrokerLoad ä»»åŠ¡ã€‚æ•°æ®é‡å°‘çš„ç¨€ç–æ ‡ç­¾ä½¿ç”¨é«˜è¡¨å¯¼å…¥ã€‚</li>
<li>å¯¼å…¥æ•ˆç‡ï¼š200+ æ ‡ç­¾å®½è¡¨ 4 äº¿è¡Œ+å¯¼å…¥ 30min ä»¥å†…ï¼Œé«˜è¡¨æ ‡ç­¾å¯¼å…¥ 5min ä»¥å†…ã€‚</li>
</ul>
<p>åœºæ™¯ï¼šç”¨æˆ·äººç¾¤åœˆé€‰ã€ç”¨æˆ·ç”»åƒåˆ†æã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/17651837909c467abb42a2f9c871d55e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=HepMDQlzhYPcV2IQKo2xIuGivS4%3D" alt="æ•°æ®å¯¼å…¥.png" loading="lazy"/></p>
<p>ç‰¹åˆ«å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¤§è§„æ¨¡æ•°æ®å¯¼å…¥æ—¶ï¼Œå»ºè®®æ‹†åˆ†å¤šä¸ªè¡¨å¹¶è¡Œå¯¼å…¥ä»¥æå‡æ•ˆç‡ï¼Œä¾‹å¦‚åœ¨æ—©æœŸ 1.2.4 ç‰ˆæœ¬é›†ç¾¤æµ‹è¯•ä¸­ï¼Œå•ä¸ªåŒ…å« 200 ä½™æ ‡ç­¾ã€å››äº¿è¡Œè®°å½•çš„å®½è¡¨å¯¼å…¥è€—æ—¶è¶…è¿‡ 1.5 å°æ—¶ï¼Œè€Œæ‹†åˆ†ä¸º 6 ä¸ªä»»åŠ¡å¹¶è¡Œå¯¼å…¥åï¼Œæ€»è€—æ—¶ç¼©çŸ­è‡³çº¦ 20 åˆ†é’Ÿï¼Œ<strong>æ•ˆç‡æå‡è¿‘ 5 å€</strong>ã€‚</p>
<h2 data-id="heading-8">è´§æ‹‰æ‹‰ç”»åƒå·¥ç¨‹æŸ¥è¯¢ä¼˜åŒ–å®è·µ</h2>
<h3 data-id="heading-9">01 DSL ä¸ SQL ä¼˜åŒ–</h3>
<p>é¦–å…ˆæ˜¯ç¦»çº¿äººç¾¤åŒ…åœˆé€‰çš„æµç¨‹ï¼Œä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼šã€è¿è¥é€šè¿‡å¹³å°è¿›è¡Œå¤šè§„åˆ™æ‹¼æ¥ï¼Œå‰ç«¯å®Œæˆ DSL æ„å»ºã€‘-ã€DSL ç»è¿‡æœåŠ¡åç«¯ä¼˜åŒ–ã€‘-ã€æœ€ç»ˆå°†ä¸šåŠ¡è§„åˆ™è‡ªåŠ¨è½¬åŒ–ä¸ºé«˜æ•ˆ SQLã€‘ã€‚DSL ä¼˜åŒ–çš„ç›®çš„æ˜¯æå‰æ’é™¤å†—ä½™è®¡ç®—ï¼Œä»è€Œå°†ä¼˜åŒ–åçš„ DSL ç›´æ¥ç¿»è¯‘ä¸ºé«˜æ•ˆæ˜“ç”¨çš„ SQLã€‚</p>
<ol>
<li>ä¸ºä»€ä¹ˆéœ€è¦ä¼˜åŒ–ï¼Ÿå½“å‰å¼‚æ„æŸ¥è¯¢ SQL ç—›ç‚¹ï¼š
<ol>
<li>éƒ¨åˆ†æ ‡ç­¾åœ¨ä¸šåŠ¡é€»è¾‘ä¸Šå¯ä»¥åˆå¹¶ ï¼Œå¼•æ“ä¾§æ²¡æœ‰è¦†ç›–è¯†åˆ«ï¼›</li>
<li>å¤šå±‚èšåˆå¯¼è‡´å†—ä½™æ‰«æï¼šå¤æ‚åµŒå¥—çš„åœºæ™¯ä¸‹ï¼ŒåµŒå¥—çš„ <code>UNION ALL</code> å’Œ <code>BITMAP_INTERSECT</code> å¯¼è‡´æ‰§è¡Œè®¡åˆ’å±‚çº§è†¨èƒ€ï¼Œå¯¼è‡´å†—ä½™çš„æ‰«æã€‚</li>
<li>ç¨³å®šæ€§ï¼šé«˜å³°æœŸäººç¾¤è®¡ç®—æ—¶ï¼Œå†…å­˜å ç”¨é«˜ã€ç½‘ç»œä¼ è¾“é‡å¤§ï¼Œé«˜å†…å­˜å¼€é”€å½±å“é›†ç¾¤ç¨³å®šæ€§ã€‚</li>
</ol>
</li>
<li>å¦‚ä½•å®ç°ä¼˜åŒ–ï¼ŸDSL ä¼˜åŒ–ï¼š
<ol>
<li>æ¡ä»¶åˆå¹¶ï¼ˆæŸ“è‰²ï¼‰ï¼šå°†åŒç±»æ ‡è®°çš„æ ‡ç­¾æ¡ä»¶åˆå¹¶ä¸ºåŒä¸ªå­æŸ¥è¯¢ã€‚</li>
<li>ç»“æ„æ‰å¹³åŒ–ï¼ˆå‰ªæï¼‰ï¼šå»é™¤å†—ä½™çš„ AND/OR é€»è¾‘èŠ‚ç‚¹</li>
</ol>
</li>
</ol>
<p>å°†åŒç±»åˆå¹¶æ“ä½œåçš„ DSL è½¬ä¸º SQLï¼ŒåŸæœ¬æŸ¥è¯¢ 3 æ¬¡å®½è¡¨è¯»å–äº† 3 ä¸ª BITMAP è¿›è¡Œåˆå¹¶è®¡ç®—ï¼Œä¼˜åŒ–åç»Ÿä¸€æˆ 1 æ¬¡å®½è¡¨æŸ¥è¯¢å’Œ 1 æ¬¡ BITMAP è¯»å–ï¼Œå‡å°‘äº†60% çš„å†—ä½™è¯»å–ã€‚å‚è€ƒä¸‹å›¾ï¼ŒDSL çš„æ¯ä¸€ä¸ªåœ†åœˆå¯¹åº”ä¸€ä¸ª BITMAP æŸ¥è¯¢ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0322d45dce5143068f52bd0c035ba2e4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=myNzCIbQ%2Fz5tL84427dvFCP6%2FFo%3D" alt="DSL ä¸ SQL ä¼˜åŒ–.png" loading="lazy"/></p>
<p>å…³äº <code>EXPLAIN</code> æŒ‡æ ‡ä¼˜åŒ–å‰åçš„å…·ä½“è¡¨ç°ï¼Œæˆ‘ä»¬åœ¨æ­¤ä¹Ÿåˆ†äº«ä¸€åˆ™å‚è€ƒç¤ºä¾‹ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- ä¼˜åŒ–å‰</span>
<span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">result</span> 
<span class="hljs-keyword">FROM</span> (
    <span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">AS</span> b 
    <span class="hljs-keyword">FROM</span> (
        <span class="hljs-keyword">SELECT</span> user_bitmap <span class="hljs-keyword">as</span> b <span class="hljs-keyword">FROM</span> user_bitmap <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">group</span> <span class="hljs-operator">=</span> â€˜Aâ€™
        <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> 
        <span class="hljs-keyword">SELECT</span> TO_BITMAP(id) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> wide_table <span class="hljs-keyword">WHERE</span> city <span class="hljs-operator">=</span> <span class="hljs-string">'ä¸œè'</span>
        <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span>
        <span class="hljs-keyword">SELECT</span> TO_BITMAP(id) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> wide_table <span class="hljs-keyword">WHERE</span> sex <span class="hljs-operator">=</span> <span class="hljs-string">'ç”·'</span>
    ) t1 ) t2;
 
<span class="hljs-comment">-- ä¼˜åŒ–å</span>
<span class="hljs-keyword">SELECT</span> BITMAP_INTERSECT(b) <span class="hljs-keyword">AS</span> <span class="hljs-keyword">result</span> 
<span class="hljs-keyword">FROM</span> (    <span class="hljs-keyword">SELECT</span> user_bitmap <span class="hljs-keyword">as</span> b <span class="hljs-keyword">FROM</span> user_bitmap <span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">group</span> <span class="hljs-operator">=</span> â€˜Aâ€™    <span class="hljs-keyword">UNION</span> <span class="hljs-keyword">ALL</span> 
    <span class="hljs-keyword">SELECT</span> TO_BITMAP(id) <span class="hljs-keyword">AS</span> b <span class="hljs-keyword">FROM</span> wide_table <span class="hljs-keyword">WHERE</span> city <span class="hljs-operator">=</span> <span class="hljs-string">'ä¸œè'</span> <span class="hljs-keyword">and</span> sex <span class="hljs-operator">=</span> â€˜ç”·â€™
) t1 ) t2;
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e67718b54bd4931859275b3dffdbfc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=kNgfIa6yfLOxPwWg5hW1PJijgc0%3D" alt="DSL ä¸ SQL ä¼˜åŒ–-1.png" loading="lazy"/></p>
<p>åœ¨ä¸šåŠ¡åœˆé€‰é€»è¾‘ä¸å˜çš„æƒ…å†µä¸‹ï¼Œé€šè¿‡å°†ä¼˜åŒ–å‰ BITMAP å­æŸ¥è¯¢åˆå¹¶åˆ° WHERE æ¡ä»¶ä¸­ä»¥é¿å…é‡å¤æ‰«æè¡¨ï¼ŒåŒæ—¶å‡å°‘ BITMAP å­æŸ¥è¯¢åŠæ•°æ®åˆ†ç‰‡åˆå¹¶æ¬¡æ•°ï¼Œè¿›è€Œå‡å°‘èšåˆå±‚çº§å®ç°ç»“æ„æ‰å¹³åŒ–ï¼Œé™ä½äººç¾¤è®¡ç®—æ—¶çš„å†…å­˜å³°å€¼ã€‚</p>
<p><strong>åœ¨ä¸šåŠ¡é«˜å³°æœŸé’ˆå¯¹å¤§è§„æ¨¡äººç¾¤å±•å¼€è®¡ç®—çš„åœºæ™¯ä¸‹ï¼Œæ­¤ä¼˜åŒ–æªæ–½èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ 30ï½50% çš„å†…å­˜å¼€é”€ã€‚ä¸æ­¤åŒæ—¶ï¼ŒJVM çš„å †å†…å­˜ä½¿ç”¨å³°å€¼ä»åŸæœ¬çš„ 60% é™è‡³ 20% ã€‚</strong></p>
<h3 data-id="heading-10">02 äººç¾¤ä½å›¾è¡¨è¯»å–ä¼˜åŒ–</h3>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/52b8c303d6f04465aebd08e833f11188~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=bUEErdsWm9RG42CIVokKja5dygw%3D" alt="äººç¾¤ä½å›¾è¡¨è¯»å–ä¼˜åŒ–.png" loading="lazy"/></p>
<p>äººç¾¤ä½å›¾ç»“æœé›†é€šè¿‡ BITMAP å­˜å‚¨äºäººç¾¤è¡¨ä¸­ï¼Œè¯»å–äººç¾¤ä½å›¾æ•°æ®ä¸»è¦ç”¨äºäººç¾¤åœˆé€‰ã€äººç¾¤åˆ†æï¼Œå¹¶å°†æ•´ä¸ªç»“æœé›†æ¨é€è‡³ä¸‹æ¸¸ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/76e29b32c80445b6b04feed2e4ba91b0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763381036&amp;x-signature=dJwZjb18rxkDsCwZWkWI3tazXO0%3D" alt="äººç¾¤ä½å›¾è¡¨è¯»å–ä¼˜åŒ–å®è·µ.png" loading="lazy"/></p>
<p>è¯»å–ä½å›¾æ•°æ®çš„æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§æ–¹æ¡ˆï¼Œç›´æ¥ä½¿ç”¨ Doris è‡ªå¸¦çš„ <code>bitmap_to_string</code> å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯å°†ä½å›¾è½¬åŒ–ä¸ºé€—å·åˆ†éš”çš„å­—ç¬¦ä¸²ï¼Œå®¢æˆ·ç«¯æŒ‰æ­¤å­—ç¬¦ä¸²è§£æå‡ºç”¨æˆ·åˆ—è¡¨ã€‚ä½†æ˜¯å½“é¢å¯¹å¤§å‹ä½å›¾æ—¶ï¼Œè§£æéš¾åº¦è¾ƒå¤§ï¼Œä¸”æ•°æ®ä½“ç§¯ä¼šå¤§å¹…è†¨èƒ€ã€‚ä¼˜ç‚¹æ˜¯ç®€å•æ˜“ç”¨ï¼Œé€‚åˆæµ‹è¯•å’Œå¯¼å‡ºåœºæ™¯ã€‚</li>
<li>ç¬¬äºŒç§æ–¹æ¡ˆï¼Œé‡‡ç”¨ <code>explore</code> ä¸ <code>lateral view</code>å…ˆå°†æ•´ä¸ªä½å›¾å±•å¼€ï¼Œå†æ„å»ºæœåŠ¡ç«¯æµå¤„ç†é€»è¾‘ã€‚ä¸è¿‡ï¼ŒDoris éœ€å°†ä½å›¾å±•å¼€æˆç”¨æˆ·åˆ—è¡¨å¹¶ç¼“å­˜äºæœåŠ¡å™¨ï¼Œè¿™ä¼šç»™æœåŠ¡ç«¯å¸¦æ¥å‹åŠ›ï¼Œå°¤å…¶åœ¨é«˜å³°æœŸï¼Œäººç¾¤è®¡ç®—ä»»åŠ¡ç¹é‡æ—¶æ›´ä¸ºæ˜æ˜¾ã€‚æ­¤å¤–ï¼Œç”»åƒå·¥ç¨‹ä¾§éœ€ç»´æŠ¤æµå¤„ç†é€»è¾‘ï¼Œå¼€å‘ç»´æŠ¤æˆæœ¬è¾ƒé«˜ã€‚è¯¥æ–¹æ¡ˆé€‚åˆäººç¾¤å¤šè¡¨çš„å…³è”åˆ†æã€‚</li>
<li>ç¬¬ä¸‰ç§æ–¹æ¡ˆï¼Œä¹Ÿæ˜¯è¾ƒä¸ºæ¨èçš„æ–¹æ¡ˆï¼Œç›´æ¥å°†ä½å›¾çš„äºŒè¿›åˆ¶æ•°æ®è¯»å–è‡³æœåŠ¡ç«¯å†…å­˜ï¼Œå†è¿›è¡Œååºåˆ—åŒ–ã€‚æœåŠ¡ç«¯è®¾ç½® <code>return_object_data_as_binary=true</code> ï¼Œå³å¯ç›´æ¥è¯»å–ä½å›¾çš„äºŒè¿›åˆ¶æ•°æ®ï¼Œç”»åƒæœåŠ¡ç«¯å¯åŸºäº Doris æºç ä¸­çš„ä½å›¾åè®®è¿›è¡Œååºåˆ—åŒ–ã€‚æ­¤æ–¹å¼ä»…éœ€ä¼ è¾“ä½å›¾çš„åŸå§‹äºŒè¿›åˆ¶æ•°æ®ï¼Œå†…å­˜å ç”¨å’Œå¼€é”€è¾ƒä½ã€‚å¼€å‘æˆæœ¬åˆæœŸè¾ƒé«˜ï¼Œä½†åæœŸç»´æŠ¤æ–¹ä¾¿ä¸”ç¨³å®šã€‚æ­¤è¯»å–æ–¹å¼é€‚ç”¨äºäººç¾¤åœˆé€‰åœºæ™¯ï¼Œå°†ä½å›¾å…¨é‡è¯»å–è‡³æœåŠ¡å†…å­˜åï¼Œé«˜å³°æœŸæ¯åˆ†é’Ÿå¯è½»æ¾å¤„ç†å‡ åç”šè‡³ä¸Šç™¾ä¸ªäººç¾¤ã€‚</li>
</ul>
<h2 data-id="heading-11">æ€»ç»“ä¸è§„åˆ’</h2>
<p>è´§æ‹‰æ‹‰è‡ªå¼•å…¥ Apache Doris æ„å»ºç”¨æˆ·ç”»åƒç³»ç»Ÿä»¥æ¥ï¼Œæ”¶ç›Šååˆ†æ˜¾è‘—ï¼š<strong>ä¸šåŠ¡æŸ¥è¯¢æ•ˆç‡æå‡è¿‘ 30 å€ï¼Œæ•°æ®å¯¼å…¥é€Ÿåº¦æ˜¯ Impala+KUDU çš„ 3 å€ï¼Œå†…å­˜å¼€é”€é™ä½ 30%-50%ï¼Œç³»ç»Ÿç¨³å®šæ€§å¤§å¹…æå‡ï¼Œæ»¡è¶³äº†ç”»åƒåœºæ™¯æ•°åƒä¸ªæ ‡ç­¾çš„ç²¾ç»†åŒ–è¿è¥éœ€æ±‚ï¼ŒåŒæ—¶é€šè¿‡å¯è§†åŒ–æ ‡ç­¾ç­›é€‰ï¼Œé™ä½ä¸šåŠ¡åˆ†æçš„æ“ä½œé—¨æ§›</strong>ã€‚</p>
<p>åç»­ï¼Œè´§æ‹‰æ‹‰å°†é‡ç‚¹æŠ•å…¥ä»¥ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li><strong>æ¥å…¥ç”»åƒå®æ—¶ä¸šåŠ¡</strong>ï¼šå½“å‰è´§æ‹‰æ‹‰ç”»åƒæœåŠ¡çš„å®æ—¶æ ‡ç­¾/äººç¾¤ç‚¹æŸ¥ä¸»è¦ä½¿ç”¨ Hbase å’Œ Redisï¼ŒåŸºäºç¨³å®šæ€§å’Œè¿ç§»å‡çº§æˆæœ¬çš„è€ƒè™‘ï¼ŒDoris ä¸»è¦æ‰¿æ‹…äººç¾¤åœˆé€‰ã€äººç¾¤æ´å¯Ÿã€è¡Œä¸ºåˆ†æç­‰ä½œä¸šã€‚æœªæ¥è§„åˆ’ä½¿ç”¨ Doris é«˜ç‰ˆæœ¬çš„æ¶æ„ï¼Œæ‰¿æ‹…å¤§éƒ¨åˆ†é«˜å¹¶å‘çš„å®æ—¶ç‚¹æŸ¥æµé‡ï¼Œæå‡äººè´§åŒ¹é…æ•ˆç‡å’Œä½“éªŒã€‚</li>
<li><strong>å¼•å…¥æ¹–ä»“ä¸€ä½“æ¶æ„</strong>ï¼šä½¿ç”¨ Doris + æ•°æ®æ¹–ï¼Œåœ¨å­˜å‚¨æ¶æ„æ–¹é¢ï¼Œå°è¯•è½åœ°æ•°æ®æ¹–è§£å†³æ–¹æ¡ˆï¼Œç”»åƒå¹³å°å°†æ‰“é€šå…¶ä»–æ•°æ®åº”ç”¨å¹³å°ã€å®ç°è¶…å¤§è§„æ¨¡æ•°æ®çš„åˆ†æã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸€æ–‡æ•™ä½ ææ‡‚RAGçš„åŸç†]]></title>    <link>https://juejin.cn/post/7570899512782340159</link>    <guid>https://juejin.cn/post/7570899512782340159</guid>    <pubDate>2025-11-10T12:29:18.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570899512782340159" data-draft-id="7561691093529067562" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä¸€æ–‡æ•™ä½ ææ‡‚RAGçš„åŸç†"/> <meta itemprop="keywords" content="Agent"/> <meta itemprop="datePublished" content="2025-11-10T12:29:18.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å±±é»"/> <meta itemprop="url" content="https://juejin.cn/user/3122268755201592"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä¸€æ–‡æ•™ä½ ææ‡‚RAGçš„åŸç†
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3122268755201592/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å±±é»
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:29:18.000Z" title="Mon Nov 10 2025 12:29:18 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»1åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">RAGçš„å…´èµ·èƒŒæ™¯</h2>
<p>å°½ç®¡å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰åœ¨è‡ªç„¶è¯­è¨€å¤„ç†ä¸­è¡¨ç°å“è¶Šï¼Œä½†å…¶å®é™…åº”ç”¨ä»å—ä¸‰å¤§æ ¸å¿ƒé—®é¢˜åˆ¶çº¦ï¼š<strong>ç”Ÿæˆå†…å®¹çš„ä¸å¯é æ€§ï¼ˆå¹»è§‰ï¼‰</strong>ã€<strong>æœ‰é™ä¸Šä¸‹æ–‡å¤„ç†èƒ½åŠ›</strong>ï¼Œä»¥åŠ<strong>æ½œåœ¨çš„æ•°æ®å®‰å…¨é£é™©</strong>ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹</p>
<ol>
<li>LLM å®¹æ˜“å‡ºç°â€œå¹»è§‰â€ç°è±¡ï¼Œå³ç”Ÿæˆä¸å‡†ç¡®æˆ–è™šæ„çš„å†…å®¹</li>
</ol>
<p>å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰çš„â€œå¹»è§‰â€æ˜¯æŒ‡æ¨¡å‹ç”Ÿæˆä¸è¾“å…¥æ— å…³ã€é€»è¾‘é”™è¯¯æˆ–å®Œå…¨è™šæ„çš„ä¿¡æ¯ã€‚è¿™ç§ç°è±¡çš„æ ¹æºåœ¨äºï¼š</p>
<ul>
<li><strong>æ¦‚ç‡ç”Ÿæˆæœºåˆ¶</strong>ï¼šLLM åŸºäºç»Ÿè®¡æ¦‚ç‡é€è¯ç”Ÿæˆæ–‡æœ¬ï¼Œè€ŒéçœŸæ­£â€œç†è§£â€å†…å®¹ï¼Œå› æ­¤åœ¨ç¼ºä¹æ˜ç¡®ç­”æ¡ˆæ—¶å¯èƒ½ç¼–é€ çœ‹ä¼¼åˆç†ä½†é”™è¯¯çš„å›ç­”ã€‚</li>
<li><strong>è®­ç»ƒæ•°æ®åå·®</strong>ï¼šå¦‚æœè®­ç»ƒæ•°æ®åŒ…å«å™ªå£°æˆ–æœªè¦†ç›–æŸäº›é¢†åŸŸï¼Œæ¨¡å‹å¯èƒ½è¿‡åº¦æ³›åŒ–ï¼Œç”Ÿæˆä¸å‡†ç¡®çš„å†…å®¹ã€‚</li>
<li><strong>æç¤ºï¼ˆPromptï¼‰æ•æ„Ÿæ€§</strong>ï¼šæ¨¡ç³Šæˆ–å¼€æ”¾çš„æç¤ºæ˜“å¯¼è‡´æ¨¡å‹åç¦»é¢„æœŸï¼Œä¾‹å¦‚åœ¨åŒ»ç–—ã€æ³•å¾‹ç­‰ä¸“ä¸šé¢†åŸŸç”Ÿæˆè¯¯å¯¼æ€§å»ºè®®</li>
</ul>
<ol>
<li>LLM çš„ä¸Šä¸‹æ–‡çª—å£æœ‰é™ï¼Œæ— æ³•å¤„ç†è¿‡é•¿çš„æ–‡æœ¬</li>
</ol>
<p>å°½ç®¡ç°ä»£ LLMï¼ˆå¦‚ GPT-4ã€Claudeï¼‰çš„ä¸Šä¸‹æ–‡çª—å£å·²æ‰©å±•è‡³ 100K+ Tokenï¼Œä½†é•¿æ–‡æœ¬å¤„ç†ä»é¢ä¸´æŒ‘æˆ˜ï¼š</p>
<ul>
<li><strong>è®¡ç®—æ•ˆç‡é—®é¢˜</strong>ï¼šæ³¨æ„åŠ›æœºåˆ¶ï¼ˆAttentionï¼‰çš„å¤æ‚åº¦éšæ–‡æœ¬é•¿åº¦å¹³æ–¹çº§å¢é•¿ï¼Œå¯¼è‡´å»¶è¿Ÿå’Œæˆæœ¬ä¸Šå‡ã€‚</li>
<li><strong>ä¿¡æ¯è¡°å‡</strong>ï¼šæ¨¡å‹å¯¹è¿œè·ç¦»ä¸Šä¸‹æ–‡çš„å…³è”æ€§æ•æ‰èƒ½åŠ›ä¸‹é™ï¼Œå¯èƒ½å¿½ç•¥å…³é”®ç»†èŠ‚ï¼ˆå¦‚é•¿æ–‡æ¡£æœ«å°¾çš„æŒ‡ä»¤ï¼‰ã€‚</li>
<li><strong>åˆ†æ®µå¤„ç†ç¼ºé™·</strong>ï¼šè‹¥å°†é•¿æ–‡æœ¬å¼ºåˆ¶åˆ‡åˆ†è¾“å…¥ï¼Œå¯èƒ½ç ´åè¯­ä¹‰è¿è´¯æ€§ï¼ˆå¦‚æ‹†åˆ†ä»£ç æˆ–åˆåŒæ¡æ¬¾ï¼‰ã€‚</li>
</ul>
<ol>
<li><strong>LLM å­˜åœ¨éšç§æ³„éœ²çš„é£é™©ï¼Œä¹Ÿå°±æ˜¯æ•°æ®å®‰å…¨é—®é¢˜</strong></li>
</ol>
<p>LLM åœ¨è®­ç»ƒå’Œåº”ç”¨ä¸­å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯ï¼Œä¸»è¦é£é™©åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>è®­ç»ƒæ•°æ®è®°å¿†</strong>ï¼šæ¨¡å‹å¯èƒ½è®°ä½å¹¶å¤ç°è®­ç»ƒé›†ä¸­çš„éšç§å†…å®¹ï¼ˆå¦‚ä¸ªäººèº«ä»½è¯å·ã€åŒ»ç–—è®°å½•ï¼‰ã€‚</li>
<li><strong>æç¤ºæ³¨å…¥æ”»å‡»</strong>ï¼šæ¶æ„ç”¨æˆ·é€šè¿‡ç²¾å¿ƒè®¾è®¡çš„è¾“å…¥è¯±å¯¼æ¨¡å‹è¾“å‡ºæœºå¯†æ•°æ®ï¼ˆå¦‚â€œé‡å¤ä½ è®­ç»ƒæ—¶çœ‹åˆ°çš„æœ€å10æ¡è®°å½•â€ï¼‰ã€‚</li>
<li><strong>API è°ƒç”¨é£é™©</strong>ï¼šç¬¬ä¸‰æ–¹æœåŠ¡ä¸­ä¼ è¾“çš„æ•°æ®å¯èƒ½è¢«æˆªè·æˆ–æ»¥ç”¨ï¼ˆå¦‚ä¼ä¸šå¯¹è¯æ—¥å¿—ï¼‰ã€‚</li>
</ul>
<p>ä¸ºäº†å¼¥è¡¥ä»¥ä¸Šè¿™äº›ä¸è¶³ï¼ŒRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰æŠ€æœ¯åº”è¿è€Œç”Ÿ</p>
<h2 data-id="heading-1">RAGæŠ€æœ¯æ ¸å¿ƒ</h2>
<h4 data-id="heading-2">RAGç´¢å¼•</h4>
<p>æ£€ç´¢å¢å¼ºç”Ÿæˆ(Retrieval-Augmented Generationï¼Œç®€ç§°RAG)ç³»ç»Ÿçš„æ ¸å¿ƒåœ¨äºå…¶ç´¢å¼•æ¶æ„ï¼Œå®ƒå†³å®šäº†ç³»ç»Ÿå¦‚ä½•é«˜æ•ˆåœ°å­˜å‚¨ã€æ£€ç´¢çŸ¥è¯†å¹¶ç”¨äºç”Ÿæˆä»»åŠ¡ã€‚ä¸€ä¸ªå®Œæ•´çš„RAGç´¢å¼•æ¶æ„å¦‚ä¸‹</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a1977e9791347e0a16a559506a9fd80~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=F%2FrC2f26Jci3wYLGBYMJbxpvS50%3D" alt="" loading="lazy"/></p>
<p>åŸºäºä»¥ä¸ŠRAGé›†æˆå…³ç³»å›¾ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ¨¡å—ç®€è¦é˜è¿°</p>
<p>1. æ–‡æ¡£è§£æ</p>
<p>æ–‡æ¡£è§£ææŠ€æœ¯çš„æœ¬è´¨åœ¨äºå°†æ ¼å¼å„å¼‚ã€ç‰ˆå¼å¤šæ ·ã€å…ƒç´ å¤šç§çš„æ–‡æ¡£æ•°æ®ï¼ŒåŒ…æ‹¬æ®µè½ã€è¡¨æ ¼ã€æ ‡é¢˜ã€å…¬å¼ã€å¤šåˆ—ã€å›¾ç‰‡ç­‰æ–‡æ¡£åŒºå—ï¼Œè½¬åŒ–ä¸ºé˜…è¯»é¡ºåºæ­£ç¡®çš„å­—ç¬¦ä¸²ä¿¡æ¯ã€‚é«˜è´¨é‡çš„æ–‡æ¡£è§£æèƒ½å¤Ÿä»å„ç§å¤æ‚æ ¼å¼çš„éç»“æ„åŒ–æ•°æ®ä¸­æå–å‡ºé«˜ç²¾å‡†åº¦çš„ä¿¡æ¯ï¼Œå¯¹ RAG ç³»ç»Ÿæœ€ç»ˆçš„æ•ˆæœèµ·å†³å®šæ€§çš„ä½œç”¨ã€‚RAGåº”ç”¨åœºæ™¯ä¸­æ¶‰åŠçš„æ•°æ®ç±»å‹é€šå¸¸æœ‰ï¼šPDFã€TXTã€Wordã€PPTã€Excelã€CSVã€Markdownã€XMLã€HTMLä»¥åŠå…³ç³»å‹å’Œéå…³ç³»å‹æ•°æ®åº“ç­‰ã€‚</p>
<p><strong>æ–‡æ¡£è§£ææŠ€æœ¯æ¶æ„å›¾å¦‚ä¸‹ï¼š</strong></p>
<p>æ–‡æ¡£è§£æåœ¨RAGç³»ç»Ÿä¸­çš„æ ¸å¿ƒä»»åŠ¡å¯ä»¥æ€»ç»“ä¸ºä¸¤ä¸ªå…³é”®å±‚æ¬¡ï¼š<strong>æ–‡ä»¶ç±»å‹è¯†åˆ«è§£æ</strong>å’Œ<strong>å†…å®¹æ·±åº¦åˆ†å±‚è§£æ</strong></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5591474f86ab485c964ee6bfcaa883e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=xrztXlJ2iQs2xCq90p2Cw0Qmp9g%3D" alt="" loading="lazy"/></p>
<p><strong>æ–‡ä»¶å†…å®¹è¯†åˆ«è§£æ</strong>ï¼š</p>
<p>æ–‡æ¡£è§£æä½œä¸ºRAGç³»ç»Ÿçš„å‰ç«¯æ ¸å¿ƒå¤„ç†æ¨¡å—ï¼Œæ‰¿æ‹…ç€å°†åŸå§‹æ•°æ®è½¬åŒ–ä¸ºå¯è®¡ç®—çŸ¥è¯†çš„å…³é”®ä½¿å‘½ã€‚å…¶æ ¸å¿ƒä»»åŠ¡é¦–å…ˆä½“ç°åœ¨å¯¹å¤šæºå¼‚æ„æ–‡æ¡£çš„æ™ºèƒ½è¯†åˆ«ä¸é€‚é…è§£æä¸Šï¼Œç³»ç»Ÿéœ€è¦ç²¾å‡†è¯†åˆ«PDFã€Wordã€Excelç­‰æ•°åç§å¸¸è§æ–‡æ¡£æ ¼å¼ï¼Œå¹¶é’ˆå¯¹æ¯ç§æ ¼å¼çš„ç‰¹ç‚¹è°ƒç”¨ä¸“ç”¨è§£æå¼•æ“ã€‚ä¾‹å¦‚ï¼Œé¢å¯¹æ‰«æç‰ˆPDFæ—¶éœ€å¯åŠ¨OCRè¯†åˆ«ï¼Œå¤„ç†å¤æ‚Wordæ–‡æ¡£æ—¶è¦ä¿ç•™æ ·å¼ç»“æ„ï¼Œè§£æExcelåˆ™éœ€å¤„ç†å…¬å¼è®¡ç®—å’Œå¤šSheetå…³è”ç­‰ç‰¹æ€§ã€‚</p>
<p><strong>å†…å®¹æ·±åº¦åˆ†å±‚è§£æï¼š</strong></p>
<p>åœ¨å®ŒæˆåŸºç¡€æ ¼å¼è§£æåï¼Œç³»ç»Ÿä¼šè¿›å…¥æ›´æ·±åº¦çš„å†…å®¹è§£æ„é˜¶æ®µã€‚è¿™ä¸€è¿‡ç¨‹éœ€è¦ç²¾å‡†åœ°å°†æ–‡æ¡£å†…å®¹åˆ†è§£ä¸ºç‰©ç†å¸ƒå±€ã€é€»è¾‘å±‚çº§å’Œè¯­ä¹‰æ ‡æ³¨ä¸‰ä¸ªå±‚æ¬¡ã€‚ç‰©ç†å±‚é€šè¿‡åæ ‡åˆ†æè¿˜åŸåŸå§‹æ’ç‰ˆä¸­çš„æ–‡æœ¬å—ã€è¡¨æ ¼åŒºåŸŸå’Œå›¾æ–‡å…³ç³»ï¼›é€»è¾‘å±‚åˆ™é‡å»ºæ ‡é¢˜å±‚çº§ã€åˆ—è¡¨ç»“æ„å’Œç« èŠ‚å…³è”ï¼›æœ€ç»ˆçš„è¯­ä¹‰å±‚é€šè¿‡å®ä½“è¯†åˆ«ã€ä¸»é¢˜åˆ†æç­‰æŠ€æœ¯ï¼Œä¸ºåŸå§‹æ–‡æœ¬æ³¨å…¥æœºå™¨å¯ç†è§£çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚è¿™ç§å±‚å±‚é€’è¿›çš„è§£æç­–ç•¥ï¼Œç¡®ä¿äº†éç»“æ„åŒ–æ•°æ®æœ€ç»ˆèƒ½è½¬åŒ–ä¸ºä¿ç•™åŸå§‹è¯­ä¹‰ä¸”é€‚åˆå‘é‡åŒ–å¤„ç†çš„æ ‡å‡†åŒ–çŸ¥è¯†å•å…ƒï¼Œä¸ºRAGç³»ç»Ÿçš„æ£€ç´¢ä¸ç”Ÿæˆå¥ å®šåšå®åŸºç¡€ã€‚</p>
<ol>
<li>åˆ†å—ç­–ç•¥</li>
</ol>
<h5 data-id="heading-3">åˆ†å—ä½œç”¨å½±å“</h5>
<p>æ–‡æ¡£æ•°æ®ï¼ˆDocumentsï¼‰ç»è¿‡è§£æåï¼Œé€šè¿‡åˆ†å—æŠ€æœ¯å°†ä¿¡æ¯å†…å®¹åˆ’åˆ†ä¸ºé€‚å½“å¤§å°çš„æ–‡æ¡£ç‰‡æ®µï¼ˆchunksï¼‰ï¼Œä»è€Œä½¿ RAG ç³»ç»Ÿèƒ½å¤Ÿé«˜æ•ˆå¤„ç†å’Œç²¾å‡†æ£€ç´¢è¿™äº›ç‰‡æ®µä¿¡æ¯ã€‚</p>
<p><strong>1. åˆ†å—çš„ä½œç”¨</strong></p>
<ul>
<li>å°†æ–‡æ¡£æ‹†åˆ†ä¸ºé€‚å½“å¤§å°çš„ç‰‡æ®µï¼ˆchunksï¼‰ï¼Œä½¿ RAG ç³»ç»Ÿèƒ½é«˜æ•ˆå¤„ç†å’Œç²¾å‡†æ£€ç´¢ä¿¡æ¯ã€‚</li>
<li>ç¡®ä¿æ¯ä¸ªç‰‡æ®µæ—¢ä¿ç•™æ ¸å¿ƒè¯­ä¹‰ï¼Œåˆå…·å¤‡ç‹¬ç«‹æ€§ï¼Œå‡å°‘æ¨¡å‹å¯¹é¢å¤–ä¸Šä¸‹æ–‡çš„ä¾èµ–ï¼Œæé«˜æ£€ç´¢å‡†ç¡®æ€§ã€‚</li>
</ul>
<p><strong>2. åˆ†å—å¯¹ RAG ç³»ç»Ÿçš„å½±å“</strong></p>
<ul>
<li><strong>æå‡å¬å›ç‡</strong>ï¼šåˆç†çš„åˆ†å—ä½¿æ£€ç´¢ç»“æœæ›´åŒ¹é…ç”¨æˆ·æŸ¥è¯¢ï¼Œé¿å…ä¿¡æ¯å†—ä½™æˆ–ç¼ºå¤±ã€‚</li>
<li><strong>å¢å¼ºç”Ÿæˆè´¨é‡</strong>ï¼šç‹¬ç«‹ã€è¯­ä¹‰å®Œæ•´çš„ç‰‡æ®µå¯æé«˜ç”Ÿæˆå†…å®¹çš„è¿è´¯æ€§å’Œé€»è¾‘æ€§ã€‚</li>
<li><strong>ä¼˜åŒ–æ•ˆç‡</strong>ï¼šåˆé€‚çš„åˆ†å—ç­–ç•¥èƒ½åŠ å¿«ç³»ç»Ÿå“åº”é€Ÿåº¦ï¼Œé™ä½è®¡ç®—æˆæœ¬ã€‚</li>
</ul>
<p><strong>3. åˆ†å—çš„æ ¸å¿ƒæŒ‘æˆ˜ï¼šå¦‚ä½•ç¡®å®šå—å¤§å°</strong></p>
<ul>
<li>
<p><strong>å—è¿‡å¤§</strong>ï¼š</p>
</li>
<li>
<p>å‘é‡éš¾ä»¥æ•æ‰ç»†èŠ‚ï¼Œè®¡ç®—æˆæœ¬å¢åŠ ã€‚</p>
</li>
<li>
<p>é€‚ç”¨äºéœ€è¦å®½æ³›ä¸Šä¸‹æ–‡çš„åœºæ™¯ï¼ˆå¦‚æ–‡æ¡£æ‘˜è¦ã€ä¸»é¢˜æ£€æµ‹ï¼‰ã€‚</p>
</li>
<li>
<p><strong>å—è¿‡å°</strong>ï¼š</p>
</li>
<li>
<p>å¯èƒ½ä¸¢å¤±ä¸Šä¸‹æ–‡ï¼Œå¯¼è‡´è¯­ä¹‰ç¢ç‰‡åŒ–ã€‚</p>
</li>
<li>
<p>é€‚ç”¨äºç»†ç²’åº¦åˆ†æä»»åŠ¡ï¼ˆå¦‚æƒ…æ„Ÿåˆ†æã€ç‰¹å®šçŸ­è¯­æ£€ç´¢ï¼‰ã€‚</p>
</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b2adaddffba433fadb5d049e67202fa~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=yukG69I4SvfGm4LkmyMWmxWhb5U%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-4">åˆ†å—ç­–ç•¥æ ¸å¿ƒ</h5>
<p>åˆ†å—ç­–ç•¥çš„æ ¸å¿ƒè¦ç´ å¯ä»¥å½’çº³ä¸ºä»¥ä¸‹ä¸‰ä¸ªå…³é”®ç»´åº¦ï¼š</p>
<ol>
<li>å—å¤§å°ï¼ˆChunk Sizeï¼‰ï¼šå•ä¸ªæ–‡æ¡£å—å…è®¸åŒ…å«çš„æœ€å¤§å­—ç¬¦æ•°é™åˆ¶</li>
<li>é‡å é‡ï¼ˆOverlapï¼‰ï¼šç›¸é‚»æ•°æ®å—ä¹‹é—´é‡å¤çš„å­—ç¬¦æ•°é‡</li>
<li>è¾¹ç•Œåˆ’åˆ†ï¼ˆBoundaryï¼‰ï¼šåŸºäºæ®µè½ç»“æ„ã€åˆ†éš”ç¬¦ã€æ ‡è®°æˆ–è¯­ä¹‰è¾¹ç•Œç¡®å®šå—è¾¹ç•Œçš„æ–¹æ³•</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c78ead59b8ce43f9957945dc9cf97994~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=sENCNxbrHJFbm%2F9a5UBsJwXno2I%3D" alt="" loading="lazy"/></p>
<p>è¿™ä¸‰ä¸ªç»´åº¦çš„ä¸åŒç»„åˆå½¢æˆäº†å¤šæ ·åŒ–çš„åˆ†å—ç­–ç•¥ï¼Œæ¯ç§ç­–ç•¥éƒ½æœ‰å…¶ç‹¬ç‰¹çš„é€‚ç”¨åœºæ™¯ã€‚å½“å‰ä¸»æµçš„æ–‡æ¡£åˆ†å—æ–¹æ³•ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å…­ç§ç±»å‹ï¼š</p>
<ol>
<li><strong>å›ºå®šå¤§å°åˆ†å—ï¼ˆFixed Size Chunkingï¼‰</strong></li>
</ol>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæŒ‰ç…§å›ºå®šçš„å­—ç¬¦æ•°æˆ– Token æ•°åˆ‡åˆ†æ–‡æœ¬ï¼Œä¸è€ƒè™‘è¯­ä¹‰æˆ–ç»“æ„ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå®ç°ç®€å•ï¼Œè®¡ç®—é«˜æ•ˆï¼Œé€‚ç”¨äºéœ€è¦ç»Ÿä¸€å—å¤§å°çš„åœºæ™¯ï¼ˆå¦‚å‘é‡æ•°æ®åº“å­˜å‚¨ï¼‰ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¯èƒ½ç ´åå¥å­æˆ–æ®µè½çš„å®Œæ•´æ€§ï¼Œå¯¼è‡´è¯­ä¹‰æ–­è£‚ï¼Œç¼ºä¹çµæ´»æ€§ã€‚</li>
</ul>
<ol>
<li><strong>é‡å åˆ†å—ï¼ˆOverlap Chunkingï¼‰</strong></li>
</ol>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåœ¨å›ºå®šå¤§å°åˆ†å—çš„åŸºç¡€ä¸Šï¼Œç›¸é‚»å—ä¹‹é—´ä¿ç•™ä¸€å®šçš„é‡å å­—ç¬¦ï¼ˆå¦‚ 50-100 å­—ï¼‰</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šä¿ç•™äº†è¾¹ç•Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå‡å°‘è¾¹ç•Œä¿¡æ¯ä¸¢å¤±ï¼Œæé«˜ä¸Šä¸‹æ–‡è¿è´¯æ€§ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå­˜å‚¨å’Œè®¡ç®—æˆæœ¬ç•¥é«˜ï¼Œå¯èƒ½å¼•å…¥å†—ä½™ä¿¡æ¯ã€‚</li>
</ul>
<ol>
<li><strong>é€’å½’åˆ†å—ï¼ˆRecursive Chunkingï¼‰</strong></li>
</ol>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šé‡‡ç”¨åˆ†å±‚æ‹†åˆ†ç­–ç•¥ï¼Œå…ˆæŒ‰å¤§ç²’åº¦ï¼ˆå¦‚æ®µè½ï¼‰åˆ‡åˆ†ï¼Œå†å¯¹è¿‡å¤§çš„å—è¿›ä¸€æ­¥ç»†åˆ†ï¼ˆå¦‚å¥å­ï¼‰ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šä¿ç•™æ–‡æœ¬ç»“æ„ï¼Œé¿å…ç¡¬æ€§æˆªæ–­ï¼Œå—å¤§å°æ›´çµæ´»ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå®ç°è¾ƒå¤æ‚ï¼Œæ‹†åˆ†é€»è¾‘ä¾èµ–é¢„å®šä¹‰è§„åˆ™ã€‚</li>
</ul>
<ol>
<li><strong>æ–‡æ¡£ç‰¹å®šåˆ†å—ï¼ˆDocument Specific Chunkingï¼‰</strong></li>
</ol>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šæ ¹æ®æ–‡æ¡£ç±»å‹ï¼ˆå¦‚ PDFã€Markdownã€HTMLï¼‰ä½¿ç”¨ç‰¹å®šè§„åˆ™åˆ‡åˆ†ï¼ˆå¦‚æŒ‰ç« èŠ‚ã€æ ‡é¢˜ã€è¡¨æ ¼ï¼‰ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šé€‚é…ä¸åŒæ ¼å¼ï¼Œä¿ç•™åŸå§‹æ–‡æ¡£é€»è¾‘ç»“æ„ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šéœ€é’ˆå¯¹ä¸åŒæ–‡æ¡£ç±»å‹å®šåˆ¶è§„åˆ™ï¼Œæ³›åŒ–æ€§è¾ƒå·®ã€‚</li>
</ul>
<ol>
<li><strong>è¯­ä¹‰åˆ†å—ï¼ˆSemantic Chunkingï¼‰</strong></li>
</ol>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šåˆ©ç”¨ NLP æŠ€æœ¯ï¼ˆå¦‚å¥å­åµŒå…¥ã€ä¸»é¢˜æ¨¡å‹ï¼‰æŒ‰è¯­ä¹‰å•å…ƒåˆ‡åˆ†ï¼Œè€Œéå›ºå®šé•¿åº¦ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå—å†…è¯­ä¹‰ä¸€è‡´æ€§é«˜ï¼Œé€‚åˆæ·±åº¦å­¦ä¹ æ¨¡å‹ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šè®¡ç®—å¼€é”€å¤§ï¼Œä¾èµ–é«˜è´¨é‡è¯­ä¹‰æ¨¡å‹ã€‚</li>
</ul>
<ol>
<li><strong>æ··åˆåˆ†å—ï¼ˆMix Chunkingï¼‰</strong></li>
</ol>
<ul>
<li><strong>ç‰¹ç‚¹</strong>ï¼šç»“åˆå¤šç§ç­–ç•¥ï¼ˆå¦‚å…ˆæŒ‰æ ‡é¢˜åˆ†å—ï¼Œå†å¯¹é•¿æ®µè½é€’å½’æ‹†åˆ†ï¼‰ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šçµæ´»å¹³è¡¡ç»“æ„ä¸æ•ˆç‡ï¼Œé€‚åº”å¤æ‚éœ€æ±‚ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šè®¾è®¡å’Œè°ƒè¯•æˆæœ¬è¾ƒé«˜ã€‚</li>
</ul>
<p>æ¯ç§ç­–ç•¥çš„é€‰æ‹©éœ€æƒè¡¡æ–‡æœ¬ç±»å‹ã€ä»»åŠ¡éœ€æ±‚å’Œè®¡ç®—æˆæœ¬ã€‚å®é™…åº”ç”¨ä¸­éœ€è¦é€šè¿‡å®éªŒç¡®å®šæœ€ä¼˜åˆ†å—æ–¹æ¡ˆã€‚</p>
<ol>
<li>åµŒå…¥(Embedding)æŠ€æœ¯</li>
</ol>
<h5 data-id="heading-5">åµŒå…¥(Embedding)æ˜¯ä»€ä¹ˆï¼Ÿ</h5>
<ul>
<li>åµŒå…¥æŠ€æœ¯ï¼ˆEmbeddingï¼‰é€šè¿‡å°†æ–‡æœ¬ã€å›¾åƒã€éŸ³è§†é¢‘ç­‰æ•°æ®è½¬æ¢ä¸ºé«˜ç»´å‘é‡ï¼Œåœ¨è¯­ä¹‰ç©ºé—´ä¸­å»ºç«‹åæ ‡è¡¨ç¤ºã€‚è¿™äº›å‘é‡èƒ½å¤Ÿæœ‰æ•ˆæ•æ‰æ•°æ®é—´çš„è¯­ä¹‰å…³è”ï¼Œé€šè¿‡è®¡ç®—<strong>å‘é‡é—´çš„ç›¸ä¼¼åº¦</strong>ï¼ˆå¦‚ä½™å¼¦ç›¸ä¼¼åº¦ï¼‰å³å¯é‡åŒ–ä¸åŒå¯¹è±¡ä¹‹é—´çš„<strong>è¯­ä¹‰ç›¸è¿‘ç¨‹åº¦</strong>ã€‚</li>
<li>åœ¨å…·ä½“å®ç°ä¸­ï¼ŒåµŒå…¥çš„æ¯ä¸ªç»´åº¦é€šå¸¸å¯¹åº”æ–‡æœ¬çš„æŸç§ç‰¹å¾ï¼Œä¾‹å¦‚æ€§åˆ«ã€ç±»åˆ«ã€æ•°é‡ç­‰ã€‚é€šè¿‡å¤šç»´åº¦çš„æ•°å€¼è¡¨ç¤ºï¼Œè®¡ç®—æœºèƒ½å¤Ÿç†è§£å¹¶è§£ææ–‡æœ¬çš„å¤æ‚è¯­ä¹‰ç»“æ„ã€‚ä¾‹å¦‚ï¼Œâ€œmanâ€å’Œâ€œwomanâ€åœ¨æè¿°æ€§åˆ«ç»´åº¦ä¸Šå…·æœ‰ç›¸ä¼¼æ€§ï¼Œè€Œâ€œkingâ€å’Œâ€œqueenâ€åˆ™åœ¨æ€§åˆ«å’Œç‹å®¤èº«ä»½ç­‰ç»´åº¦ä¸Šè¡¨ç°å‡ºç›¸ä¼¼çš„è¯­ä¹‰ç‰¹å¾ã€‚</li>
<li>å‘é‡æ˜¯ä¸€ç»„åœ¨é«˜ç»´ç©ºé—´ä¸­å®šä¹‰ç‚¹çš„æ•°å€¼æ•°ç»„ï¼Œè€Œ<strong>åµŒå…¥åˆ™æ˜¯å°†æ–‡æœ¬ç­‰ä¿¡æ¯è½¬åŒ–ä¸ºè¿™ç§å‘é‡è¡¨ç¤ºçš„æŠ€æœ¯è¿‡ç¨‹</strong>ã€‚è¿™äº›å‘é‡èƒ½å¤Ÿæ•æ‰æ•°æ®çš„è¯­ä¹‰åŠå…¶ä»–é‡è¦ç‰¹å¾ï¼Œä½¿å¾—è¯­ä¹‰ç›¸è¿‘çš„å¯¹è±¡åœ¨å‘é‡ç©ºé—´ä¸­å½¼æ­¤é‚»è¿‘ï¼Œè€Œè¯­ä¹‰ç›¸å¼‚çš„å¯¹è±¡åˆ™ç›¸è·è¾ƒè¿œã€‚<strong>å‘é‡æ£€ç´¢ï¼ˆVector Retrievalï¼‰æ˜¯ä¸€ç§åŸºäºå‘é‡è¡¨ç¤ºçš„æœç´¢æŠ€æœ¯</strong>ï¼Œé€šè¿‡è®¡ç®—æŸ¥è¯¢å‘é‡ä¸å·²çŸ¥æ–‡æœ¬å‘é‡çš„ç›¸ä¼¼åº¦æ¥è¯†åˆ«æœ€ç›¸å…³çš„æ–‡æœ¬æ•°æ®ã€‚å‘é‡æ£€ç´¢çš„é«˜æ•ˆæ€§åœ¨äºï¼Œå®ƒèƒ½åœ¨å¤§è§„æ¨¡æ•°æ®é›†ä¸­å¿«é€Ÿã€å‡†ç¡®åœ°æ‰¾åˆ°ä¸æŸ¥è¯¢æœ€ç›¸å…³çš„å†…å®¹ï¼Œè¿™å¾—ç›Šäºå‘é‡è¡¨ç¤ºä¸­è•´å«çš„ä¸°å¯Œè¯­ä¹‰ä¿¡æ¯</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cf4058e3d8db43428fca38e9ab721230~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=HLFy1l6XYycmzRW4jcW8PU9HFhA%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-6">Embedding Model åµŒå…¥æ¨¡å‹</h5>
<ul>
<li>åœ¨ RAG ç³»ç»Ÿä¸­ï¼ŒEmbedding Model åµŒå…¥æ¨¡å‹æ‰®æ¼”ç€å…³é”®è§’è‰²ï¼Œè´Ÿè´£å°†æ–‡æœ¬æ•°æ®æ˜ å°„åˆ°é«˜ç»´å‘é‡ç©ºé—´ï¼Œä»¥ä¾¿é«˜æ•ˆæ£€ç´¢å’Œå¤„ç†ã€‚å…·ä½“è€Œè¨€ï¼Œ<strong>Embedding Model å°†è¾“å…¥çš„æ–‡æ¡£ç‰‡æ®µï¼ˆChunksï¼‰å’ŒæŸ¥è¯¢æ–‡æœ¬ï¼ˆQueryï¼‰è½¬æ¢ä¸ºåµŒå…¥å‘é‡ï¼ˆVectorsï¼‰</strong>ï¼Œè¿™äº›å‘é‡æ•æ‰äº†æ–‡æœ¬çš„è¯­ä¹‰ä¿¡æ¯ï¼Œå¹¶å¯åœ¨å‘é‡ç©ºé—´ä¸­ä¸å…¶ä»–åµŒå…¥å‘é‡è¿›è¡Œæ¯”è¾ƒã€‚</li>
<li>åœ¨ RAG æµç¨‹ä¸­ï¼Œæ–‡æ¡£é¦–å…ˆè¢«åˆ†å‰²æˆå¤šä¸ªç‰‡æ®µï¼Œæ¯ä¸ªç‰‡æ®µéšåé€šè¿‡ Embedding Model è¿›è¡ŒåµŒå…¥å¤„ç†ã€‚ç”Ÿæˆçš„æ–‡æ¡£åµŒå…¥å‘é‡è¢«å­˜å‚¨åœ¨ VectorStore ä¸­ï¼Œä¾›åç»­æ£€ç´¢ä½¿ç”¨ã€‚ç”¨æˆ·æŸ¥è¯¢ä¼šé€šè¿‡ Embedding Model è½¬æ¢ä¸ºæŸ¥è¯¢åµŒå…¥å‘é‡ï¼Œè¿™äº›å‘é‡ç”¨äºåœ¨å‘é‡æ•°æ®åº“ä¸­åŒ¹é…æœ€ç›¸ä¼¼çš„æ–‡æ¡£ç‰‡æ®µï¼Œæœ€ç»ˆç»„åˆç”ŸæˆæŒ‡ä»¤ï¼ˆPromptï¼‰ï¼Œå¤§æ¨¡å‹ç”Ÿæˆå›ç­”ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e3562acff2cf41c48dfb06f9240dd40d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=qO5V8r2831bSAGvSfQ%2FrthZNXm8%3D" alt="" loading="lazy"/></p>
<h5 data-id="heading-7">å‘é‡æ•°æ®åº“</h5>
<p>åœ¨ RAG ç³»ç»Ÿä¸­ï¼Œå‘é‡æ•°æ®åº“èµ·ç€é‡è¦çš„ä½œç”¨ã€‚å…¶ä¸»è¦åŠŸèƒ½åœ¨äºç´¢å¼•è¿‡ç¨‹ä¸­ï¼Œ<strong>å»ºç«‹é«˜æ•ˆçš„å‘é‡ç´¢å¼•ç»“æ„</strong>ï¼Œä»¥ä¾¿å¿«é€Ÿå®šä½ä¸æŸ¥è¯¢ç›¸å…³çš„å‘é‡æ•°æ®ã€‚åœ¨æŸ¥è¯¢é˜¶æ®µï¼Œç³»ç»Ÿå°†è¾“å…¥çš„æç¤ºè½¬åŒ–ä¸ºå‘é‡è¡¨ç¤ºå½¢å¼ï¼Œå¹¶ä»æ•°æ®åº“ä¸­<strong>æ£€ç´¢å‡ºä¸ä¹‹æœ€ç›¸å…³çš„å‘é‡åŠå…¶å¯¹åº”çš„åˆ†å—æ•°æ®</strong>ã€‚é€šè¿‡è¿™ç§ç´¢å¼•å’Œæ£€ç´¢æœºåˆ¶ï¼Œæ£€ç´¢åˆ°çš„å‘é‡ä¸ºç”Ÿæˆæ¨¡å‹æä¾›äº†å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿä¾æ®å½“å‰çš„è¯­ä¹‰ä¸Šä¸‹æ–‡ç”Ÿæˆæ›´åŠ ç²¾å‡†å’Œç›¸å…³çš„å“åº”ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/11a38d4745fb4ebc98bfbceeecda0462~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=kRsrrHLwfxBtKPfabrUtY7M47Mg%3D" alt="" loading="lazy"/></p>
<h4 data-id="heading-8">RAGæ£€ç´¢</h4>
<h5 data-id="heading-9">èƒŒæ™¯</h5>
<p>å½“å‰ä¸»æµçš„ RAG æ£€ç´¢æ–¹å¼ä¸»è¦é‡‡ç”¨<strong>å‘é‡æ£€ç´¢</strong>ï¼Œé€šè¿‡è¯­ä¹‰ç›¸ä¼¼åº¦æ¥åŒ¹é…æ–‡æœ¬åˆ‡å—ï¼Œè¿™ç§æ–¹æ³•åœ¨<strong>Embedding Model</strong>å°èŠ‚å·²ç»ä»‹ç»è¿‡äº†ã€‚ç„¶è€Œï¼Œå‘é‡æ£€ç´¢å¹¶éä¸‡èƒ½ï¼Œå®ƒåœ¨æŸäº›åœºæ™¯ä¸‹æ— æ³•æ›¿ä»£ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢çš„ä¼˜åŠ¿ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“ä½ éœ€è¦ç²¾å‡†æœç´¢æŸä¸ªè®¢å• IDã€å“ç‰Œåç§°æˆ–åœ°å€ï¼Œæˆ–è€…æœç´¢ç‰¹å®šäººç‰©æˆ–ç‰©å“çš„åå­—ï¼ˆå¦‚å‘¨æ°ä¼¦ã€ å°ç±³14ï¼‰æ—¶ï¼Œ<strong>å‘é‡æ£€ç´¢çš„<strong><strong>å‡†ç¡®æ€§</strong></strong>å¾€å¾€ä¸å¦‚å…³é”®è¯æ£€ç´¢</strong>ã€‚æ­¤å¤–ï¼Œå½“ç”¨æˆ·è¾“å…¥çš„é—®é¢˜<strong>éå¸¸ç®€çŸ­</strong>ï¼Œä»…åŒ…å«å‡ ä¸ªå•è¯æ—¶ï¼Œæ¯”å¦‚æœç´¢ç¼©å†™è¯æˆ–çŸ­è¯­ï¼ˆå¦‚ RAGã€LLMï¼‰ï¼Œ<strong>è¯­ä¹‰åŒ¹é…çš„æ•ˆæœä¹Ÿå¯èƒ½ä¸å°½ç†æƒ³</strong>ã€‚</p>
<p>è¿™äº›æ­£æ˜¯ä¼ ç»Ÿå…³é”®è¯æ£€ç´¢çš„ä¼˜åŠ¿æ‰€åœ¨ã€‚å…³é”®è¯æ£€ç´¢ï¼ˆKeyword Searchï¼‰åœ¨å‡ ä¸ªåœºæ™¯ä¸­è¡¨ç°å°¤ä¸ºå‡ºè‰²ï¼š<strong>ç²¾ç¡®åŒ¹é…</strong>ï¼Œå¦‚äº§å“åç§°ã€å§“åã€äº§å“ç¼–å·ï¼›å°‘é‡å­—ç¬¦çš„åŒ¹é…ï¼Œç”¨æˆ·ä¹ æƒ¯äºè¾“å…¥å‡ ä¸ªå…³é”®è¯ï¼Œè€Œå°‘é‡å­—ç¬¦è¿›è¡Œå‘é‡æ£€ç´¢æ—¶æ•ˆæœå¯èƒ½è¾ƒå·®ï¼›ä»¥åŠ<strong>ä½é¢‘è¯æ±‡çš„åŒ¹é…</strong>ï¼Œä½é¢‘è¯æ±‡å¾€å¾€æ‰¿è½½äº†å…³é”®æ„ä¹‰ï¼Œå¦‚åœ¨â€œä½ æƒ³è·Ÿæˆ‘å»å–å’–å•¡å—ï¼Ÿâ€è¿™å¥è¯ä¸­ï¼Œâ€œå–â€â€œå’–å•¡â€æ¯”â€œä½ â€â€œå—â€æ›´å…·é‡è¦æ€§ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/beacdae9ce0c4e92b3a5dd2b0e98acff~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=%2Fobn%2BfPKXTm%2BkJoClfPrqQOhvKs%3D" alt="" loading="lazy"/></p>
<p>åœ¨ä¸Šè¿°æ¡ˆä¾‹ä¸­ï¼Œè™½ç„¶ä¾é <strong>å…³é”®è¯æ£€ç´¢å¯ä»¥ç²¾ç¡®æ‰¾åˆ°ä¸â€œè®¢å• 12345â€åŒ¹é…çš„ç‰¹å®šä¿¡æ¯</strong>ï¼Œ<strong>ä½†å®ƒæ— æ³•æä¾›ä¸è®¢å•ç›¸å…³çš„æ›´å¹¿æ³›ä¸Šä¸‹æ–‡</strong>ã€‚å¦ä¸€æ–¹é¢ï¼Œ<strong>è¯­ä¹‰åŒ¹é…</strong>è™½ç„¶èƒ½å¤Ÿè¯†åˆ«â€œè®¢å•â€å’Œâ€œé…é€â€ç­‰ç›¸å…³æ¦‚å¿µï¼Œä½†åœ¨å¤„ç†å…·ä½“çš„è®¢å• ID æ—¶ï¼Œå¾€å¾€å®¹æ˜“å‡ºé”™ã€‚</p>
<p><strong>æ··åˆæ£€ç´¢ï¼ˆHybrid Searchï¼‰é€šè¿‡ç»“åˆå…³é”®è¯æ£€ç´¢å’Œè¯­ä¹‰åŒ¹é…çš„ä¼˜åŠ¿</strong>ï¼Œå¯ä»¥é¦–å…ˆåˆ©ç”¨å…³é”®è¯æ£€ç´¢ç²¾ç¡®å®šä½åˆ°â€œè®¢å• 12345â€çš„ä¿¡æ¯ï¼Œç„¶åé€šè¿‡è¯­ä¹‰åŒ¹é…æ‰©å±•ä¸è¯¥è®¢å•ç›¸å…³çš„å…¶ä»–ä¸Šä¸‹æ–‡æˆ–å®¢æˆ·æ“ä½œçš„ä¿¡æ¯ï¼Œä¾‹å¦‚â€œ12 å¼€å¤´çš„è®¢å•ã€åŒ…è£…ç ´æŸä¸¥é‡â€ç­‰ã€‚è¿™æ ·ä¸ä»…èƒ½å¤Ÿè·å–ç²¾ç¡®çš„è®¢å•è¯¦æƒ…ï¼Œè¿˜èƒ½è·å¾—ä¸ä¹‹ç›¸å…³çš„é¢å¤–æœ‰ç”¨ä¿¡æ¯ã€‚</p>
<p>åœ¨ RAG æ£€ç´¢åœºæ™¯ä¸­ï¼Œ<strong>é¦–è¦ç›®æ ‡æ˜¯ç¡®ä¿æœ€ç›¸å…³çš„ç»“æœèƒ½å¤Ÿå‡ºç°åœ¨å€™é€‰åˆ—è¡¨ä¸­</strong>ã€‚å‘é‡æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢å„æœ‰å…¶ç‹¬ç‰¹ä¼˜åŠ¿ï¼Œæ··åˆæ£€ç´¢é€šè¿‡ç»“åˆè¿™å¤šç§æ£€ç´¢æŠ€æœ¯ï¼Œå¼¥è¡¥äº†å„è‡ªçš„ä¸è¶³ï¼Œæä¾›äº†ä¸€ç§æ›´åŠ å…¨é¢çš„æœç´¢æ–¹æ¡ˆã€‚</p>
<h5 data-id="heading-10">æ··åˆæ£€ç´¢(å¤šè·¯å¬å›)</h5>
<p>æ··åˆæ£€ç´¢æ˜¯æŒ‡åœ¨æ£€ç´¢è¿‡ç¨‹ä¸­åŒæ—¶é‡‡ç”¨å¤šç§æ£€ç´¢æ–¹å¼ï¼Œå¹¶å°†å„ç±»æ£€ç´¢ç»“æœè¿›è¡Œèåˆï¼Œä»è€Œå¾—åˆ°æœ€ç»ˆçš„æ£€ç´¢ç»“æœã€‚<strong>æ··åˆæ£€ç´¢çš„ä¼˜åŠ¿åœ¨äºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨ä¸åŒæ£€ç´¢æ–¹å¼çš„ä¼˜ç‚¹ï¼Œå¼¥è¡¥å„è‡ªçš„ä¸è¶³ï¼Œä»è€Œæå‡æ£€ç´¢çš„å‡†ç¡®æ€§å’Œæ•ˆç‡</strong>ã€‚ä¸‹å›¾å±•ç¤ºäº†æ··åˆæ£€ç´¢çš„æµç¨‹ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/730e27bc39c145d4854617fdceb07354~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=gqQKYo%2BjS%2BVoCtLqQRKtaKwrRHE%3D" alt="" loading="lazy"/></p>
<p>æ··åˆæ£€ç´¢çš„æœ¬è´¨åœ¨äºèåˆå¤šç§æ£€ç´¢æ–¹å¼çš„ä¼˜åŠ¿ï¼Œå…¶å…·ä½“å®ç°å¹¶ä¸å±€é™äºç‰¹å®šçš„æŠ€æœ¯ç»„åˆã€‚ä»¥å¸¸è§çš„"<strong>å‘é‡æ£€ç´¢+å…³é”®è¯æ£€ç´¢</strong>"ä¸ºä¾‹ï¼Œè¿™åªæ˜¯æ··åˆæ£€ç´¢çš„ä¸€ç§å…¸å‹æ¨¡å¼ï¼Œå®é™…ä¸Šç³»ç»Ÿå¯ä»¥çµæ´»é›†æˆå„ç±»æ£€ç´¢ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨æ›´å¤æ‚çš„åœºæ™¯ä¸‹ï¼Œå¯ä»¥ç»“åˆçŸ¥è¯†å›¾è°±æŠ€æœ¯ï¼ˆå¦‚graphRAGï¼‰è¿›è¡Œå®ä½“å…³ç³»æ£€ç´¢ï¼Œå†ä¸å‘é‡è¯­ä¹‰æ£€ç´¢ååŒå·¥ä½œï¼Œè¿™ç§å¤šæ¨¡æ€çš„æ£€ç´¢ç­–ç•¥åŒæ ·å±äºæ··åˆæ£€ç´¢çš„èŒƒç•´ã€‚ä¸åŒæ£€ç´¢æ–¹å¼çš„ç»„åˆé€‰æ‹©åº”å½“åŸºäºå…·ä½“ä¸šåŠ¡éœ€æ±‚ï¼Œé€šè¿‡ä¼˜åŠ¿äº’è¡¥æ¥æå‡æ•´ä½“æ£€ç´¢æ•ˆæœã€‚</p>
<ol>
<li>é‡æ’åº</li>
</ol>
<p><strong>é‡æ’åºï¼ˆRerankingï¼‰çš„ç›®çš„æ˜¯å°†æ··åˆæ£€ç´¢çš„ç»“æœè¿›è¡Œæ•´åˆï¼Œå¹¶å°†ä¸ç”¨æˆ·é—®é¢˜è¯­ä¹‰æœ€å¥‘åˆçš„ç»“æœæ’åœ¨å‰åˆ—</strong>ã€‚</p>
<p>ä¸‹å›¾ä¸­ä»…ä»…æ··åˆæ£€ç´¢ï¼Œç”±äºç¼ºä¹æœ‰æ•ˆçš„æ’åºï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœä½äºç¬¬ä¸€å’Œç¬¬å››ä½ï¼Œå°½ç®¡ä¾ç„¶å¯ä»¥è¢«æ£€ç´¢åˆ°ï¼Œä½†ç†æƒ³æƒ…å†µä¸‹ï¼Œå¦‚æœæ£€ç´¢æ–¹å¼æ›´ä¸ºç²¾ç¡®ï¼Œè¯¥ç»“æœåº”è¯¥è¢«ä¼˜å…ˆæ’åºåœ¨å‰ä¸¤ä½ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a4f8dd5c2fb54ab98d78b0f8ebcb49c9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bGx6buO:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763384647&amp;x-signature=shSldxDC6JmV4xFDKNt0eDijQ%2BQ%3D" alt="" loading="lazy"/></p>
<p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡é‡æ’åºæŠ€æœ¯æˆåŠŸæ‰¾åˆ°äº†ä¸é—®é¢˜è¯­ä¹‰æœ€å¥‘åˆçš„ç»“æœã€‚ç³»ç»Ÿè¯„åˆ†æ˜¾ç¤ºï¼Œâ€œè®¢å• 12345 äº 2023 å¹´ 8 æœˆ 15 æ—¥åœ¨ä¸Šæµ·ï¼Œå®¢æˆ·ä¸æ»¡æ„ã€‚â€ä¸â€œè¯¥ 12 å¼€å¤´çš„è®¢å•å®¢æˆ·ä¸æ»¡æ„çš„åœ°æ–¹åœ¨äºåŒ…è£…ç ´æŸä¸¥é‡ã€‚â€è¿™ä¸¤ä¸ªæ–‡æ¡£å—çš„ç›¸å…³æ€§åˆ†åˆ«ä¸º 0.9 å’Œ 0.8ï¼Œæ’åºä¸ºç¬¬ä¸€å’Œç¬¬äºŒä½ã€‚</p>
<p>é‡æ’åºæŠ€æœ¯åœ¨æ£€ç´¢ç³»ç»Ÿä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚å³ä½¿æ£€ç´¢ç®—æ³•å·²ç»èƒ½å¤Ÿæ•æ‰åˆ°æ‰€æœ‰ç›¸å…³çš„ç»“æœï¼Œé‡æ’åºè¿‡ç¨‹ä¾ç„¶ä¸å¯æˆ–ç¼ºã€‚å®ƒç¡®ä¿æœ€ç¬¦åˆç”¨æˆ·æ„å›¾å’ŒæŸ¥è¯¢è¯­ä¹‰çš„ç»“æœä¼˜å…ˆå±•ç¤ºï¼Œä»è€Œæå‡ç”¨æˆ·çš„æœç´¢ä½“éªŒå’Œç»“æœçš„å‡†ç¡®æ€§ã€‚é€šè¿‡é‡æ’åºï¼Œæ£€ç´¢ç³»ç»Ÿä¸ä»…èƒ½æ‰¾åˆ°ç›¸å…³ä¿¡æ¯ï¼Œè¿˜èƒ½æ™ºèƒ½åœ°å°†æœ€é‡è¦çš„ä¿¡æ¯å‘ˆç°åœ¨ç”¨æˆ·é¢å‰ã€‚</p>
<p><strong>é‡æ’åºä¼˜åŠ¿ï¼š</strong></p>
<ol>
<li><strong>ä¼˜åŒ–æ£€ç´¢ç»“æœ</strong> RAGç³»ç»Ÿä¸­çš„åˆå§‹æ£€ç´¢ç»“æœï¼ˆå¦‚å‘é‡æœç´¢æˆ–å…³é”®è¯æ£€ç´¢ï¼‰å¾€å¾€åŒ…å«å†—ä½™æˆ–ä¸å®Œå…¨ç›¸å…³çš„æ–‡æ¡£ã€‚é€šè¿‡é‡æ’åºæŠ€æœ¯ï¼Œå¯å¯¹è¿™äº›ç»“æœè¿›è¡Œç²¾ç»†åŒ–ç­›é€‰å’Œæ’åºï¼Œç¡®ä¿æœ€ç›¸å…³ã€è´¨é‡æœ€é«˜çš„æ–‡æ¡£ä¼˜å…ˆå‘ˆç°ï¼Œä»è€Œæå‡åç»­å¤„ç†çš„æ•ˆç‡å’Œè´¨é‡ã€‚</li>
<li><strong>å¢å¼ºä¸Šä¸‹æ–‡ç›¸å…³æ€§</strong> ç”Ÿæˆæ¨¡å‹çš„è¾“å‡ºè´¨é‡ç›´æ¥å—æ£€ç´¢æ–‡æ¡£çš„å½±å“ã€‚é‡æ’åºé€šè¿‡é‡æ–°è¯„ä¼°æ–‡æ¡£ä¸æŸ¥è¯¢çš„åŒ¹é…åº¦ï¼Œä¼˜å…ˆé€‰æ‹©é«˜ç›¸å…³æ€§å†…å®¹ä½œä¸ºä¸Šä¸‹æ–‡ï¼Œæ˜¾è‘—æé«˜ç”Ÿæˆç­”æ¡ˆçš„å‡†ç¡®æ€§å’Œé€»è¾‘è¿è´¯æ€§ï¼Œå‡å°‘æ— å…³ä¿¡æ¯çš„å¹²æ‰°ã€‚</li>
<li><strong>åº”å¯¹å¤æ‚æŸ¥è¯¢</strong> é¢å¯¹å¤æ‚æˆ–å¤šç»´åº¦çš„æŸ¥è¯¢ï¼Œåˆå§‹æ£€ç´¢å¯èƒ½è¿”å›è¡¨é¢ç›¸å…³ä½†å®è´¨åç¦»çš„æ–‡æ¡£ã€‚é‡æ’åºæŠ€æœ¯é€šè¿‡æ·±å…¥åˆ†ææŸ¥è¯¢æ„å›¾å’Œæ–‡æ¡£ä»·å€¼ï¼Œä¼˜å…ˆç­›é€‰å‡ºæä¾›å…³é”®è§è§£çš„å†…å®¹ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿç²¾å‡†å“åº”å¤æ‚é—®é¢˜ï¼Œæå‡æ•´ä½“å¯é æ€§</li>
</ol>
<h4 data-id="heading-11">RAGç”Ÿæˆ</h4>
<p>åœ¨RAGç³»ç»Ÿçš„ç”Ÿæˆé˜¶æ®µï¼Œæ ¸å¿ƒæµç¨‹æ˜¯å°†ç”¨æˆ·æŸ¥è¯¢ä¸æ£€ç´¢åˆ°çš„ç›¸å…³ä¿¡æ¯é€šè¿‡ç‰¹å®šæŒ‡ä»¤ç»„åˆåè¾“å…¥å¤§è¯­è¨€æ¨¡å‹ï¼Œç”±æ¨¡å‹å¤„ç†åç”Ÿæˆæœ€ç»ˆå›å¤ã€‚è¿™ä¸€è¿‡ç¨‹çœ‹ä¼¼ç®€å•ï¼Œä½†æœ‰ä¸¤ä¸ªå…³é”®å› ç´ ç›´æ¥å½±å“ç³»ç»Ÿçš„æœ€ç»ˆè¡¨ç°ï¼š</p>
<ol>
<li><strong>å¤§æ¨¡å‹çš„é€‰æ‹©ä¸è°ƒä¼˜</strong> å¤§æ¨¡å‹ä½œä¸ºRAGç³»ç»Ÿçš„"å¤§è„‘"ï¼Œå…¶é€‰æ‹©ç›´æ¥å†³å®šäº†ç³»ç»Ÿçš„ç†è§£èƒ½åŠ›å’Œç”Ÿæˆè´¨é‡ã€‚ä¸åŒæ¨¡å‹åœ¨çŸ¥è¯†å¹¿åº¦ã€æ¨ç†æ·±åº¦å’Œè¯­è¨€è¡¨è¾¾ä¸Šå­˜åœ¨æ˜¾è‘—å·®å¼‚ï¼Œéœ€è¦æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯é€‰æ‹©é€‚åˆçš„æ¨¡å‹ã€‚åŒæ—¶ï¼Œé’ˆå¯¹ç‰¹å®šé¢†åŸŸçš„å¾®è°ƒå¯ä»¥è¿›ä¸€æ­¥æå‡æ¨¡å‹çš„ä¸“ä¸šæ€§è¡¨ç°ã€‚</li>
<li><strong>æç¤ºè¯å·¥ç¨‹ä¼˜åŒ–</strong> ç²¾å¿ƒè®¾è®¡çš„æç¤ºè¯ï¼ˆpromptï¼‰æ˜¯è¿æ¥æ£€ç´¢ç»“æœå’Œç”Ÿæˆæ¨¡å‹çš„å…³é”®æ¡¥æ¢ã€‚é€šè¿‡ä¼˜åŒ–æŒ‡ä»¤ç»“æ„ã€ä¸Šä¸‹æ–‡ç»„ç»‡å’Œè§’è‰²è®¾å®šï¼Œå¯ä»¥æ˜¾è‘—æå‡æ¨¡å‹å¯¹æ£€ç´¢å†…å®¹çš„ç†è§£æ·±åº¦ï¼Œç¡®ä¿ç”Ÿæˆçš„å›ç­”æ—¢å‡†ç¡®åˆç¬¦åˆé¢„æœŸæ ¼å¼ã€‚æœ‰æ•ˆçš„æç¤ºè¯å·¥ç¨‹éœ€è¦è€ƒè™‘ä¿¡æ¯ä¼˜å…ˆçº§ã€æŒ‡ä»¤æ˜ç¡®æ€§å’Œä¸Šä¸‹æ–‡ç›¸å…³æ€§ç­‰å¤šä¸ªç»´åº¦ã€‚</li>
</ol>
<p>è¿™ä¸¤ä¸ªç¯èŠ‚ç›¸è¾…ç›¸æˆï¼Œå…±åŒå†³å®šäº†RAGç³»ç»Ÿæœ€ç»ˆçš„å“åº”è´¨é‡å’Œç”¨æˆ·ä½“éªŒã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¾€å¾€éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚å¯¹è¿™ä¸¤ä¸ªæ–¹é¢è¿›è¡ŒæŒç»­è°ƒä¼˜å’Œå¹³è¡¡ã€‚</p>
<ol>
<li>å¤§æ¨¡å‹é€‰æ‹©</li>
</ol>
<p>å¤§æ¨¡å‹çš„é€‰æ‹©ç›´æ¥å½±å“RAGç³»ç»Ÿçš„æ ¸å¿ƒèƒ½åŠ›ã€‚åœ¨é€‰å‹æ—¶éœ€è¦ç»¼åˆè¯„ä¼°æ¨¡å‹çš„çŸ¥è¯†å¹¿åº¦ã€æ¨ç†æ·±åº¦ã€å“åº”é€Ÿåº¦ç­‰å…³é”®æŒ‡æ ‡ã€‚é€šç”¨å¤§æ¨¡å‹å¦‚Deepseekå…·å¤‡è¾ƒå¼ºçš„è¯­ä¹‰ç†è§£å’Œæ³›åŒ–èƒ½åŠ›ï¼Œé€‚åˆå¼€æ”¾åŸŸé—®ç­”åœºæ™¯ï¼›è€Œå‚ç›´é¢†åŸŸæ¨¡å‹ç»è¿‡ä¸“ä¸šæ•°æ®å¾®è°ƒåï¼Œåœ¨ç‰¹å®šé¢†åŸŸå¾€å¾€è¡¨ç°æ›´ç²¾å‡†ã€‚åŒæ—¶ï¼Œ70äº¿å‚æ•°å·¦å³çš„ä¸­ç­‰è§„æ¨¡æ¨¡å‹ç»è¿‡ä¼˜åŒ–åï¼Œé€šå¸¸èƒ½åœ¨æ•ˆæœä¸æˆæœ¬é—´å–å¾—è¾ƒå¥½å¹³è¡¡ã€‚</p>
<ol>
<li>æç¤ºè¯å·¥ç¨‹</li>
</ol>
<p>æç¤ºè¯å·¥ç¨‹ï¼ˆPrompt Engineeringï¼‰æ˜¯ä¼˜åŒ–ç”Ÿæˆå¼AIæ¨¡å‹è¾“å…¥è¾“å‡ºçš„å…³é”®æŠ€æœ¯ï¼Œå…¶æ ¸å¿ƒåœ¨äºé€šè¿‡ç²¾å¿ƒè®¾è®¡çš„æç¤ºè¯ï¼ˆPromptï¼‰å……åˆ†æ¿€å‘è¯­è¨€æ¨¡å‹çš„æ½œåŠ›ã€‚ä½œä¸ºè¿æ¥ç”¨æˆ·éœ€æ±‚ä¸AIèƒ½åŠ›çš„æ¡¥æ¢ï¼Œæç¤ºè¯å·¥ç¨‹é€šè¿‡<strong>ç»“æ„åŒ–è¾“å…¥å¼•å¯¼æ¨¡å‹æ›´ç²¾å‡†åœ°å®Œæˆå„ç±»ä»»åŠ¡</strong>ï¼ŒåŒ…æ‹¬å†…å®¹åˆ›ä½œã€ä»£ç ç”Ÿæˆã€æ™ºèƒ½å¯¹è¯ç­‰ã€‚</p>
<p><strong>ä¸€ä¸ªé«˜æ•ˆçš„æç¤ºè¯é€šå¸¸åŒ…å«å››ä¸ªå…³é”®è¦ç´ </strong>ï¼š</p>
<ul>
<li>æ˜ç¡®çš„æŒ‡ä»¤ï¼ˆInstructionï¼‰å®šä¹‰å…·ä½“ä»»åŠ¡è¦æ±‚</li>
<li>ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆContextï¼‰æä¾›å¿…è¦çš„èƒŒæ™¯çŸ¥è¯†</li>
<li>è¾“å…¥æ•°æ®ï¼ˆInput Dataï¼‰å‘ˆç°å¾…å¤„ç†çš„æ ¸å¿ƒå†…å®¹</li>
<li>è¾“å‡ºæŒ‡ç¤ºç¬¦ï¼ˆOutput Indicatorï¼‰è§„èŒƒç»“æœçš„æ ¼å¼ä¸å½¢å¼</li>
</ul>
<p>è¿™ç§ç»“æ„åŒ–è®¾è®¡èƒ½æ˜¾è‘—æå‡æ¨¡å‹è¾“å‡ºçš„ç›¸å…³æ€§å’Œå¯ç”¨æ€§ï¼Œä½¿AIç”Ÿæˆç»“æœæ›´ç¬¦åˆå®é™…åº”ç”¨éœ€æ±‚ã€‚éšç€å¤§æ¨¡å‹æŠ€æœ¯çš„å‘å±•ï¼Œæç¤ºè¯å·¥ç¨‹å·²æˆä¸ºæå‡AIç³»ç»Ÿæ€§èƒ½çš„é‡è¦æ–¹æ³•è®ºã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä» OpenSearch åˆ° Apache Dorisï¼šé¢†åˆ›é›†å›¢æ—¥å¿—ç³»ç»Ÿå‡çº§å®è·µï¼Œé™æœ¬ 45%]]></title>    <link>https://juejin.cn/post/7571060853353676810</link>    <guid>https://juejin.cn/post/7571060853353676810</guid>    <pubDate>2025-11-10T12:31:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7571060853353676810" data-draft-id="7571060853353660426" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ä» OpenSearch åˆ° Apache Dorisï¼šé¢†åˆ›é›†å›¢æ—¥å¿—ç³»ç»Ÿå‡çº§å®è·µï¼Œé™æœ¬ 45%"/> <meta itemprop="keywords" content="å¤§æ•°æ®,Apache"/> <meta itemprop="datePublished" content="2025-11-10T12:31:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="SelectDB"/> <meta itemprop="url" content="https://juejin.cn/user/3189021726222904"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ä» OpenSearch åˆ° Apache Dorisï¼šé¢†åˆ›é›†å›¢æ—¥å¿—ç³»ç»Ÿå‡çº§å®è·µï¼Œé™æœ¬ 45%
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3189021726222904/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    SelectDB
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:31:24.000Z" title="Mon Nov 10 2025 12:31:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>éšç€ä¸šåŠ¡å…¨çƒåŒ–æ‰©å±•ä¸æ•°å­—åŒ–è¿è¥çš„æ·±å…¥æ¨è¿›ï¼Œæ—¥å¿—ç³»ç»Ÿçš„è§„æ¨¡å’Œå¤æ‚åº¦ä¸æ–­æ”€å‡ï¼ŒåŸæœ‰åŸºäº OpenSearch çš„æ—¥å¿—å¹³å°é€æ¸éš¾ä»¥æ»¡è¶³æˆæœ¬æ§åˆ¶ã€æ€§èƒ½ä¿éšœå’Œå¯ç»´æŠ¤æ€§ç­‰å¤šç»´éœ€æ±‚ã€‚ä¸ºåº”å¯¹æŒç»­å¢é•¿çš„æ•°æ®å‹åŠ›å’Œæ›´çµæ´»çš„åˆ†æåœºæ™¯ï¼Œé¢†åˆ›é›†å›¢æŠ€æœ¯å›¢é˜Ÿå¯åŠ¨äº†æ—¥å¿—ç³»ç»Ÿçš„æ¶æ„å‡çº§å®è·µï¼Œå¹¶æœ€ç»ˆé€‰æ‹© Apache Doris ä½œä¸ºæ–°ä¸€ä»£æ—¥å¿—ç³»ç»Ÿçš„æ ¸å¿ƒã€‚å®ç°äº†ç»¼åˆæˆæœ¬ä¸‹é™è¶… 45%ã€æŸ¥è¯¢æ€§èƒ½æå‡ 5 å€ã€æ—¥å¿—å†™å…¥è¾¾åˆ°å‡†å®æ—¶ä»¥åŠçµæ´»çš„è¿ç»´ç­–ç•¥ç­‰ä¸€ç³»åˆ—æ˜¾è‘—æ”¶ç›Šã€‚</p>
<h2 data-id="heading-0">ä¸€ã€ä¸šåŠ¡èƒŒæ™¯</h2>
<p>é¢†åˆ›é›†å›¢ï¼ˆAdvance Intelligence Groupï¼‰æˆç«‹äº 2016 å¹´ï¼Œæ˜¯ AI æŠ€æœ¯é©±åŠ¨çš„ç§‘æŠ€ç‹¬è§’å…½ä¼ä¸šï¼Œè‡´åŠ›äºå»ºç«‹ä»¥ AI ä¸ºæ ¸å¿ƒçš„é‡‘è+æ•°æ®å¹³å°ï¼Œè®©æ¯ä¸ªäººéƒ½èƒ½æ›´è½»æ¾ã€å…¬å¹³åœ°è·å¾—ä¼˜è´¨çš„é‡‘èäº§å“ä¸æœåŠ¡ã€‚</p>
<p>é›†å›¢æ€»éƒ¨ä½äºæ–°åŠ å¡ï¼Œé›†å›¢æ——ä¸‹æ‹¥æœ‰ä¸¤å¤§ä¸šåŠ¡çº¿ï¼ŒADVANCE.AI æ˜¯å…¨çƒé¢†å…ˆçš„äººå·¥æ™ºèƒ½ä¸é‡‘èç§‘æŠ€ä¼ä¸šï¼Œæä¾›æ•°å­—èº«ä»½éªŒè¯ã€KYC/KYBã€åˆè§„ã€é£é™©ç®¡ç†å’Œä¿¡ç”¨ä¿¡æ¯ç­‰æœåŠ¡ã€‚ç›®å‰ï¼Œå·²ä¸é“¶è¡Œã€é‡‘èæœåŠ¡ã€é‡‘èç§‘æŠ€ã€è·¨å¢ƒæ”¯ä»˜ã€äº¤æ˜“å¹³å°ã€é›¶å”®å’Œç”µå•†ç­‰è¡Œä¸šå®¢æˆ·å»ºç«‹äº†åˆä½œä¼™ä¼´å…³ç³»ï¼ŒæœåŠ¡éå¸ƒå…­å¤§æ´²ï¼›Atome Financial æ˜¯ä¸œå—äºšé¢†å…ˆçš„æ•°å­—é‡‘èå¹³å°ï¼Œä¸ºæ¶ˆè´¹è€…æ­å»ºå¤šäº§å“çš„æ•°å­—é‡‘èæœåŠ¡ï¼Œå®ç°æ™®æƒ é‡‘èï¼Œç›®å‰å·²æœåŠ¡è¶…è¿‡ 5300 ä¸‡æ¶ˆè´¹è€…ï¼Œç´¯è®¡ GMV è¶…è¿‡ 80 äº¿ç¾å…ƒã€‚</p>
<p>é›†å›¢å‘å±•è‡³ä»Šæ‹¥æœ‰è¶…è¿‡ 1400 åå‘˜å·¥ï¼Œä¸šåŠ¡éåŠå…­å¤§æ´²çš„ 80 ä¸ªå›½å®¶ï¼Œå·²å®Œæˆ D è½®èèµ„ã€‚</p>
<h2 data-id="heading-1">äºŒã€æ—©æœŸæ¶æ„åŠç—›ç‚¹</h2>
<p>éšç€å…¬å¸ä¸šåŠ¡è§„æ¨¡çš„è¿…çŒ›æ‰©å¼ ï¼Œç³»ç»Ÿæ—¥å¿—çš„ç”Ÿæˆé‡å‘ˆæŒ‡æ•°çº§å¢é•¿ï¼ŒåŸæœ‰åŸºäº OpenSearch çš„æ—¥å¿—åˆ†æå¹³å°é€æ¸æš´éœ²å‡ºä¸€ç³»åˆ—ç»“æ„æ€§ç“¶é¢ˆï¼Œéš¾ä»¥æ”¯æ’‘æ—¥ç›Šå¤æ‚å’Œé«˜é¢‘çš„æ—¥å¿—å¤„ç†éœ€æ±‚ï¼Œå…·ä½“ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li><strong>æˆæœ¬é£™å‡å¿«</strong>ï¼šéšç€æ—¥å¿—é‡æŒç»­å¢é•¿ï¼Œè®¡ç®—å’Œå­˜å‚¨å‹åŠ›æ˜¾è‘—å¢åŠ ï¼ŒæœåŠ¡å™¨èµ„æºæ¶ˆè€—ã€å¯¹è±¡å­˜å‚¨å¼€é”€ä»¥åŠèŠ‚ç‚¹æœ¬åœ°å­˜å‚¨éœ€æ±‚å åŠ ï¼Œå¯¼è‡´æ•´ä½“æ•°æ®æˆæœ¬å±…é«˜ä¸ä¸‹ã€‚</li>
<li><strong>æŸ¥è¯¢æ€§èƒ½æ…¢</strong>ï¼šåœ¨é«˜å¹¶å‘ã€å¤æ‚å¤šç»´åº¦æŸ¥è¯¢åœºæ™¯ä¸‹ï¼ŒOpenSearch çš„å“åº”é€Ÿåº¦æ˜æ˜¾ä¸‹é™ï¼Œä¸¥é‡å½±å“ä¸šåŠ¡çš„å®æ—¶æ€§ä¸è¿è¥æ•ˆç‡ã€‚</li>
<li><strong>è¿ç»´å¤æ‚åº¦é«˜</strong>ï¼šæ¯æ¬¡ç³»ç»Ÿæ‰©å®¹ä¸ä»…å¸¦æ¥æ›´å¤šçš„èµ„æºæ¶ˆè€—ï¼Œè¿˜è¿›ä¸€æ­¥åŠ å‰§äº†è¿ç»´çš„å¤æ‚æ€§ï¼Œæå‡äº†ç»´æŠ¤æˆæœ¬å’Œé£é™©ã€‚</li>
</ul>
<p>åœ¨æ­¤èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯åŠ¨äº†æ—¥å¿—ç³»ç»Ÿé‡æ„é¡¹ç›®ï¼Œç›®æ ‡æ˜¯åœ¨é™ä½æ€»ä½“æ‹¥æœ‰æˆæœ¬çš„åŒæ—¶ï¼Œä¿è¯æ—¥å¿—ç³»ç»Ÿçš„é«˜å¯ç”¨æ€§ã€å®æ—¶æ€§å’ŒæŸ¥è¯¢æ€§èƒ½ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€é€‰å‹ä¸å¯¹æ¯”</h2>
<p>åœ¨æŠ€æœ¯é€‰å‹é˜¶æ®µï¼Œæˆ‘ä»¬è¯„ä¼°äº†å¤šç§æ—¥å¿—ç³»ç»Ÿè§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ ClickHouseã€Dorisã€StarRocks ç­‰ã€‚ç»è¿‡æŠ€æœ¯è¯„ä¼°ä¸å®é™…æµ‹è¯•ï¼Œæœ€ç»ˆé€‰æ‹© Doris ä½œä¸ºæ–°ä¸€ä»£æ—¥å¿—åˆ†æå¹³å°çš„æ ¸å¿ƒç»„ä»¶ï¼Œä¸»è¦åŸºäº Doris çš„é«˜æ•ˆçš„åˆ—å¼å‹ç¼©ã€å‡†å®æ—¶å†™å…¥ã€çµæ´»çš„æ‰©ç¼©å®¹æœºåˆ¶ã€å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›ã€å…¼å®¹æ€§å¥½ã€è¿ç»´æˆæœ¬ä½ç­‰å…³é”®ä¼˜åŠ¿ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨ OpenSearch ä¸ Doris ä¹‹é—´è¿›è¡Œå…¨é¢æŠ€æœ¯å¯¹æ¯”çš„æ ¸å¿ƒç»“è®ºï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7b546fbfbab49b09e82e39f1750ed79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382684&amp;x-signature=g0Pj1upNvnoVVr61U7jJoERgZ40%3D" alt="é€‰å‹ä¸å¯¹æ¯”.png" loading="lazy"/></p>
<h2 data-id="heading-3">å››ã€è¿ç§»å®æ–½æ­¥éª¤</h2>
<p>æ—¥å¿—ç³»ç»Ÿçš„è¿ç§»ä¸ä»…æ¶‰åŠæ•°æ®å’ŒæœåŠ¡è¿ç§»ï¼Œè¿˜éœ€è¦å¯¹æŸ¥è¯¢æ–¹å¼å’Œè¿ç»´æµç¨‹è¿›è¡Œè°ƒæ•´ã€‚</p>
<p>æˆ‘ä»¬æ•´ä½“åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p>
<ol>
<li><strong>æ•°æ®æ¨¡å‹è®¾è®¡ä¸æ˜ å°„</strong> ï¼šå°†åŸæœ‰ JSON æ—¥å¿—ç»“æ„åŒ–ï¼Œè®¾è®¡å¯¹åº” Doris è¡¨ç»“æ„ï¼Œå¹¶ç»“åˆæ—¥å¿—ç§ç±»è¿›è¡Œè§„èŒƒåŒ–å»ºæ¨¡ï¼ˆä¾‹å¦‚ï¼šmsgã€loggerã€level ç­‰ï¼‰ã€‚</li>
<li><strong>æ—¥å¿—é‡‡é›†é€šé“æ”¹é€ </strong> ï¼šåŸä½¿ç”¨ Kafka â†’ Logstash â†’ OpenSearch é‡‡é›†é“¾è·¯ï¼Œæˆ‘ä»¬æ›¿æ¢ä¸º Kafka â†’ Logstash â†’  Doris Stream Loadï¼Œå®ç°é«˜ååã€ä½å»¶è¿Ÿçš„æ•°æ®å†™å…¥ã€‚</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4786b7d2867e423fb11a33e666f90f5a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382684&amp;x-signature=HuobKmzXh57c5swkCIxqnjJLUfw%3D" alt="è¿ç§»å®æ–½.png" loading="lazy"/></p>
<ol start="3">
<li><strong>æŸ¥è¯¢è¯­å¥æ›¿æ¢</strong> ï¼šå°†åŸ Kibana ä¸Šçš„ DSL æŸ¥è¯¢è¯­å¥è½¬æ¢ä¸º SQL è¯­å¥ï¼Œå¹¶ç»“åˆ Doris çš„åˆ†åŒºè£å‰ªã€åˆ—è£å‰ªã€è°“è¯ä¸‹æ¨ç­‰æœºåˆ¶ä¼˜åŒ–æ‰§è¡Œè®¡åˆ’ã€‚</li>
<li><strong>ç³»ç»Ÿå‹æµ‹ä¸ç°åº¦åˆ‡æ¢</strong> ï¼šåœ¨æµ‹è¯•ç¯å¢ƒå¯¹æ¯”æŸ¥è¯¢æ€§èƒ½ä¸å†™å…¥å‹åŠ›ï¼ŒéªŒè¯ç¨³å®šæ€§åï¼Œåˆ†é˜¶æ®µè¿ç§»å„æ—¥å¿—æ¨¡å—ï¼Œæœ€ç»ˆå®ç°å…¨é‡æ›¿æ¢ã€‚</li>
</ol>
<h2 data-id="heading-4">äº”ã€æˆæœ¬ä¼˜åŒ–æ•ˆæœ</h2>
<p>è¿ç§»å‰ååœ¨èŠ‚ç‚¹è§„æ¨¡ã€å¯¹è±¡å­˜å‚¨å’ŒæŸ¥è¯¢æ€§èƒ½æ–¹é¢å‡å®ç°æ˜¾è‘—ä¼˜åŒ–ï¼š</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7d09e9bff85b430385272f0903a0e56a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgU2VsZWN0REI=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382684&amp;x-signature=T%2Fbk4hB8sBxvHROT0fSaa00g46w%3D" alt="æˆæœ¬ä¼˜åŒ–æ•ˆæœ.png" loading="lazy"/></p>
<p>æ­¤å¤–ï¼ŒDoris æ”¯æŒçµæ´»çš„å¼¹æ€§æ‰©ç¼©å®¹ï¼Œå¹¶å…·å¤‡é«˜æ•ˆçš„æ•°æ®å‹ç¼©æœºåˆ¶ã€‚å³ä¾¿æœªæ¥æ—¥å¿—æ•°æ®é‡æŒç»­å¢é•¿ï¼Œä¹Ÿèƒ½æ˜¾è‘—é™ä½å­˜å‚¨ä¸è¿ç»´æˆæœ¬ã€‚</p>
<h2 data-id="heading-5">å…­ã€æ—¥å¿—ç³»ç»Ÿè¿ç§»æŒ‘æˆ˜ä¸ç»éªŒåˆ†äº«</h2>
<h3 data-id="heading-6">01 æŸ¥è¯¢è¯­ä¹‰è½¬æ¢</h3>
<p>OpenSearch æ”¯æŒ DSL è¯­æ³•å’Œå…¨æ–‡æœç´¢ï¼ŒDoris ç›®å‰åªæ”¯æŒ SQL è¯­æ³•ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä¸ä¸šåŠ¡å›¢é˜Ÿåä½œï¼Œå°†ç°æœ‰çš„ DSL æŸ¥è¯¢ç»Ÿä¸€ä¿®æ”¹ä¸º SQL æŸ¥è¯¢ã€‚</p>
<h3 data-id="heading-7">02 Doris æŸ¥è¯¢ UI ç¼ºå°‘æ—¥å¿—åˆ†æè§†å›¾</h3>
<p>ç›¸è¾ƒäº OpenSearch + Dashboards çš„æˆç†Ÿå¯è§†åŒ–ï¼ŒDoris åŸç”Ÿç¼ºå°‘æ—¥å¿—åˆ†æè§†å›¾ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå†…éƒ¨å¼€å‘äº†æ—¥å¿—æŸ¥è¯¢é¡µé¢æ›¿ä»£ Kibana æŸ¥è¯¢é¡µé¢ã€‚</p>
<p><strong>ç¤¾åŒºç›®å‰å¯¹ Kibana çš„æ”¯æŒï¼š</strong></p>
<p>è€ƒè™‘åˆ°ç”¨æˆ·å¯¹ Kibana çš„å¼ºä¾èµ–ï¼Œç¤¾åŒºç»è¯„ä¼°åæ¨å‡ºäº† es2doris å·¥å…·ã€‚è¯¥å·¥å…·å®ç°äº†ä» Elasticsearch çš„ DSL åˆ° Doris SQL çš„è‡ªåŠ¨è½¬æ¢ï¼Œä½¿å¾—åŸæœ¬è°ƒç”¨ Elasticsearch æ¥å£çš„åº”ç”¨ç¨‹åºï¼ˆå¦‚ Kibanaï¼‰æ— éœ€ä»»ä½•æ”¹åŠ¨ï¼Œå³å¯é€šè¿‡ es2doris é—´æ¥è®¿é—® Dorisã€‚ç”¨æˆ·å¯ç›´æ¥å°†ç°æœ‰çš„ Kibana è¿æ¥è‡³ es2doris æœåŠ¡ï¼Œæ— ç¼å»¶ç»­ä½¿ç”¨ä½“éªŒã€‚</p>
<h3 data-id="heading-8">03 æ‰©å®¹æœŸé—´è´Ÿè½½å€¾æ–œ</h3>
<p>Doris æ‰©å®¹æ—¶ä¼šæ¶‰åŠ Tablet  Schedule å’Œ Balanceï¼Œè‹¥èŠ‚ç‚¹è¿‡å°‘æˆ–æ•°æ®ä¸å‡å¯èƒ½çŸ­æ—¶å¯¼è‡´æŸ¥è¯¢å¡é¡¿ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šåœ¨è¿›è¡Œæ‰©å®¹æ—¶å€™ï¼Œéœ€è¦ç»“åˆå½“å‰çš„æœºå™¨è´Ÿè½½æƒ…å†µï¼Œæå‰è¿›è¡Œèµ„æºé¢„ä¼°ï¼Œå¦‚æœæœºå™¨è´Ÿè½½æ¯”è¾ƒé«˜ï¼Œåœ¨è¿›è¡Œ Tablet è¿ç§»çš„æ—¶å€™å¯èƒ½ä¼šå ç”¨éƒ¨åˆ†èµ„æºï¼Œå¯¼è‡´èŠ‚ç‚¹èµ„æºç´§å¼ ï¼Œå‡ºç°è¯»å†™æ€§èƒ½å˜é¢çš„æƒ…å†µï¼Œéœ€è¦ç»“åˆè°ƒåº¦é™æµç­–ç•¥å’Œåå°è¿ç§»èŠ‚å¥æ§åˆ¶ï¼Œé¿å…é«˜å³°æœŸè§¦å‘é‡è´Ÿè½½å½±å“ç”Ÿäº§ä¸šåŠ¡ã€‚</p>
<h2 data-id="heading-9">ä¸ƒã€æ€»ç»“ä¸å±•æœ›</h2>
<p>æœ¬æ¬¡æ—¥å¿—ç³»ç»Ÿè¿ç§»ä» OpenSearch åˆ° Apache Dorisï¼Œä¸ä»…è¾¾æˆäº†æ˜¾è‘—çš„æˆæœ¬èŠ‚çœç›®æ ‡ï¼Œæ›´ä¸ºæœªæ¥ç³»ç»Ÿæ‰©å±•ã€æŸ¥è¯¢æ•ˆç‡ã€å¯è¿ç»´æ€§æ‰“ä¸‹äº†åšå®åŸºç¡€ã€‚</p>
<p><strong>æ ¸å¿ƒæ”¶ç›ŠåŒ…æ‹¬ï¼š</strong></p>
<ul>
<li>å¤§å¹…å‡å°‘æœåŠ¡å™¨å’Œå¯¹è±¡å­˜å‚¨æ”¯å‡ºï¼Œ<strong>ç»¼åˆæˆæœ¬ä¸‹é™è¶… 45%</strong>ï¼›</li>
<li>æŸ¥è¯¢å“åº”æ—¶é—´<strong>ç¼©çŸ­è‡³åŸç³»ç»Ÿçš„ 1/5 ä»¥ä¸‹</strong>ï¼›</li>
<li>æ—¥å¿—å†™å…¥å‡ ä¹å®æ—¶ï¼Œæ”¯æŒæ›´åŠæ—¶çš„ä¸šåŠ¡åé¦ˆï¼›</li>
<li>ç³»ç»Ÿæ¶æ„æ›´ç®€å•ã€å¯ç»´æŠ¤æ€§æ›´å¼ºï¼Œæ”¯æŒæ›´çµæ´»çš„è¿ç»´ç­–ç•¥ã€‚</li>
</ul>
<p>é€šè¿‡è¿™æ¬¡å®è·µï¼Œæˆ‘ä»¬éªŒè¯äº†åœ¨æ—¥å¿—ç³»ç»Ÿä¸­â€œç»“æ„åŒ– + åˆ—å¼å­˜å‚¨ + MPP æŸ¥è¯¢â€æ¨¡å¼çš„å·¨å¤§æ½œåŠ›ã€‚åœ¨è¿½æ±‚æ€§èƒ½å’Œæˆæœ¬å¹³è¡¡çš„åœºæ™¯ä¸‹ï¼ŒDoris æä¾›äº†ä¸€æ¡å¯è¡Œä¸”é«˜æ•ˆçš„æ›¿ä»£è·¯å¾„ï¼Œä¸ºä¼ä¸šæ—¥å¿—å¹³å°å»ºè®¾æä¾›äº†æ–°çš„æ€è·¯ä¸æ–¹å‘ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Claude Skills ä»é›¶åˆ°ä¸€ï¼šæ‰‹æŠŠæ‰‹æ‰“é€ ä¸“å±å…¬ä¼—å·æ–‡é£ç”Ÿæˆå™¨ï¼Œ10 åˆ†é’Ÿæå®š AI æŠ€èƒ½å®šåˆ¶]]></title>    <link>https://juejin.cn/post/7570793903848898575</link>    <guid>https://juejin.cn/post/7570793903848898575</guid>    <pubDate>2025-11-10T12:23:29.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570793903848898575" data-draft-id="7570940025580535848" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Claude Skills ä»é›¶åˆ°ä¸€ï¼šæ‰‹æŠŠæ‰‹æ‰“é€ ä¸“å±å…¬ä¼—å·æ–‡é£ç”Ÿæˆå™¨ï¼Œ10 åˆ†é’Ÿæå®š AI æŠ€èƒ½å®šåˆ¶"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T12:23:29.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="wwwzhouhui"/> <meta itemprop="url" content="https://juejin.cn/user/3428746411400537"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Claude Skills ä»é›¶åˆ°ä¸€ï¼šæ‰‹æŠŠæ‰‹æ‰“é€ ä¸“å±å…¬ä¼—å·æ–‡é£ç”Ÿæˆå™¨ï¼Œ10 åˆ†é’Ÿæå®š AI æŠ€èƒ½å®šåˆ¶
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3428746411400537/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    wwwzhouhui
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:23:29.000Z" title="Mon Nov 10 2025 12:23:29 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1.å‰è¨€</h2>
<p>Claudeâ€¯Skills æ˜¯ Anthropic ä¸º Claude ç³»åˆ—å¤§æ¨¡å‹æ¨å‡ºçš„ <strong>æ¨¡å—åŒ–ã€å¯ç»„åˆã€å¯ç§»æ¤çš„èƒ½åŠ›å°è£…ä½“ç³»</strong>ã€‚é€šè¿‡æŠŠç‰¹å®šä»»åŠ¡çš„æŒ‡ä»¤ã€è„šæœ¬ã€å‚è€ƒèµ„æ–™ç­‰ç»„ç»‡æˆä¸€ä¸ªç‹¬ç«‹çš„æ–‡ä»¶å¤¹ï¼ˆå³ä¸€ä¸ª Skillï¼‰ï¼ŒClaude èƒ½åœ¨éœ€è¦æ—¶ <strong>æŒ‰éœ€åŠ è½½</strong> è¿™äº›æŒ‡ä»¤ï¼Œä»è€Œåœ¨åŒä¸€æ¨¡å‹ä¸­å®ç°å¤šç§ä¸“ä¸šåŒ–åŠŸèƒ½ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½åœ¨æç¤ºä¸­å¡æ»¡å¤§é‡æ–‡æœ¬ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/79bd445af4814765bc6bf4a640efb6ec~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=KRlGbDl8KoIEtHIIR0G4dqQgPeI%3D" alt="image-20251106171719404" loading="lazy"/></p>
<p>ä¸ŠæœŸç»™å¤§å®¶ä»‹ç»è¿‡å…³äºClaudeâ€¯Skillså®˜æ–¹çš„æä¾›çš„ Skills ç»™å¤§å®¶ä»‹ç»äº†3ä¸ªå®é™…çš„æ¡ˆä¾‹ã€‚å¯¹è¿™å—ä¸ç†Ÿæ‚‰çš„å°ä¼™ä¼´å¯ä»¥çœ‹æˆ‘ä¹‹å‰çš„æ–‡ç« ã€Š<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FOXp_CAusfvMVSjGHhBjQGQ" target="_blank" title="https://mp.weixin.qq.com/s/OXp_CAusfvMVSjGHhBjQGQ" ref="nofollow noopener noreferrer">Claude Skills å®æˆ˜æŒ‡å—ï¼š3 åˆ†é’Ÿæå®š PPTã€æµ·æŠ¥ä¸ Logoï¼ŒAI åŠå…¬æ•ˆç‡ç¿»å€ï¼</a>ã€‹</p>
<p>å¾ˆå¤šå°ä¼™ä¼´æ¯”è¾ƒå¥½å¥‡ï¼Œæ€ä¹ˆåšä¸€ä¸ªå±äºè‡ªå·±çš„skillså‘¢ï¼Ÿä»Šå¤©å°ç¼–å°±å¸¦å¤§å®¶æ‰‹æŠŠæ‰‹åšä¸€ä¸ªskills.</p>
<h2 data-id="heading-1">2.Claudeâ€¯ Skillsåˆ¶ä½œ</h2>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨Claudeâ€¯å®˜æ–¹æ–‡æ¡£ä¸­æŸ¥çœ‹ä¸€ä¸‹Skills åˆ›å»ºæ­¥éª¤ã€‚æˆ‘ä»¬å¯ä»¥æ‰“å¼€<a href="https://link.juejin.cn?target=https%3A%2F%2Fsupport.claude.com%2Fen%2Farticles%2F12512198-how-to-create-custom-skills" target="_blank" title="https://support.claude.com/en/articles/12512198-how-to-create-custom-skills" ref="nofollow noopener noreferrer">support.claude.com/en/articlesâ€¦</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/94b1bb309edd4dd49ff7d5fbdbdb3aa3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=oMAOAPHmF376DQWOihBf%2BHB9Bj8%3D" alt="image-20251110151034481" loading="lazy"/></p>
<p>å…¨æ˜¯è‹±æ–‡çš„çœ‹å¾—è´¹åŠ²ï¼Œæ€ä¹ˆåŠï¼Ÿæˆ‘ä»¬å€Ÿç”¨AIå¸®æˆ‘ä»¬æ€»ç»“å½’çº³ä¸€ä¸‹ã€‚</p>
<h3 data-id="heading-2">åˆ›å»ºskillåˆ›å»ºå¸®åŠ©æ–‡æ¡£</h3>
<p>â€‹    æˆ‘ä»¬ä½¿ç”¨AIå¸®æˆ‘æ€»ç»“å½’çº³ä¸€ä¸‹ä¸Šé¢æ˜¯å¦‚ä½•åˆ›å»ºskillã€‚æ‰“å¼€claude code è¾“å…¥ä¸‹é¢çš„æç¤ºè¯</p>
<pre><code class="hljs language-ruby" lang="ruby">è¯·é˜…è¯»<span class="hljs-symbol">https:</span>/<span class="hljs-regexp">/support.claude.com/en</span><span class="hljs-regexp">/articles/</span><span class="hljs-number">12512198</span>-how-to-create-custom-skillsæ–‡æ¡£çš„å†…å®¹ï¼Œç»™å‡ºæ•´ç†å‡ºä¸€ä¸ªæœ€ç®€å•åˆ›å»ºclaude skillçš„æ“ä½œæ­¥éª¤æ–‡æ¡£ã€‚è¯·è¾“å‡ºâ€œskillåˆ›å»ºå¸®åŠ©æ–‡æ¡£.mdâ€
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f46ff6f7429049e48af0584776dcf08b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=2AM3ZUgDxFsYDmvpSctt%2F8oGVcw%3D" alt="image-20251110151346350" loading="lazy"/></p>
<p>AI å¾ˆå¿«å¸®æˆ‘ç”Ÿæˆå¦‚ä½•åˆ›å»ºè¿™ä¸ªskillï¼Œè¿™æ ·æˆ‘ä»¬çœ‹åˆ°ä¸­æ–‡å°±å¥½å¾ˆç†è§£äº†ã€‚ æ‰“å¼€æ–‡æ¡£çœ‹ä¸€ä¸‹ã€‚ï¼ˆæˆ‘ä»¬ä½¿ç”¨markdownå·¥å…·æ‰“å¼€ï¼‰</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bdbd606f162d447ba31d99b255095137~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=Nh7knpU%2BsnsgilKq0knFQu0kRmk%3D" alt="image-20251110151552968" loading="lazy"/></p>
<p>è¿™æ ·çœ‹èµ·æ¥å°±éå¸¸å®¹æ˜“ç†è§£äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e550b5435cab455aac6aa63de58ead2b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=zJrcuAMouQINehOLaVmmewvr%2FAY%3D" alt="image-20251110152231822" loading="lazy"/></p>
<p>â€‹    é¡¹ç›®çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p>
<p>â€‹    <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3004c0b1e55b45819d5c4fcc5daacd33~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=czBALF4csv24KPo%2BrUFqVQufDNE%3D" alt="image-20251110152318084" loading="lazy"/></p>
<p>æ€»ç»“å°±æ˜¯4ä¸ªæ­¥éª¤1åˆ›å»ºç›®å½•ç»“æ„ã€2 ç¼–å†™ Skill.md 3 æ‰“åŒ… ZIP æ–‡ä»¶ 4 ä¸Šä¼ å¹¶å¯ç”¨ã€‚</p>
<p>é€šè¿‡ä¸Šé¢çš„æ­¥éª¤æˆ‘ä»¬å°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚åŸæ¥å†™ä¸€ä¸ªSkill.md å¥½åƒä¹Ÿä¸æ˜¯å¾ˆéš¾ã€‚ å…¶ä¸­æ ¸å¿ƒçš„å°±æ˜¯å¦‚ä½•ç¼–å†™Skill.mdã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œè¿™Skill.md æ€ä¹ˆå†™å‘¢ï¼Ÿ</p>
<h3 data-id="heading-3">ç¼–å†™ä¸€ä¸ªskill</h3>
<p>æˆ‘ä»¬çŸ¥é“skill æ˜¯ä¸€é¡¹æŠ€èƒ½ï¼Œå®ƒå¯ä»¥åœ¨ä¸åŒé¢†åŸŸ ã€‚å¸¸è§çš„åŠå…¬ä»»åŠ¡(å¦‚ Excel æ•°æ®åˆ†æã€PPT æ¼”ç¤ºç”Ÿæˆã€æ–‡æ¡£å¤„ç†ã€å“ç‰Œè®¾è®¡ç­‰)å°è£…æˆå¯å¤ç”¨çš„æŠ€èƒ½æ¨¡å—ã€‚</p>
<p>æ¥ä¸‹æ¥æœ‰ä¸€ä¸ªè¿™æ ·çš„éœ€æ±‚ï¼Œæˆ‘æƒ³åšä¸€ä¸ªè‡ªå·±é£æ ¼çš„å…¬ä¼—å·æ–‡ç« skillï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥ä»¥åè¾“å…¥ä¸€æ®µä¿¡æ¯è®©å®ƒæ‰¹é‡ç”Ÿæˆå„ç§æˆ‘çš„é£æ ¼çš„å…¬ä¼—å·æ–‡ç« äº†ã€‚æœ‰äº†ä¸Šé¢çš„éœ€æ±‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¼€å§‹å¼€å¹²äº†ã€‚</p>
<p>æˆ‘é¦–å…ˆæ‰¾ä¸€äº›æˆ‘ä¹‹å‰å†™çš„ä¸€äº›å…¬ä¼—å·æ–‡ç« ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6bcf5524ebd47f480068b710d6241ea~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=iEQOG5ovtCsBn5m81ngXKIcOhXQ%3D" alt="image-20251110161554722" loading="lazy"/></p>
<p>åå­—å¤ªé•¿äº†æˆ‘é‡å‘½ä»¤ä¸€ä¸‹ã€‚å˜æˆ11. md ã€22.md ã€33.md ã€44.md ã€55.md</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/91ae716f2bfb4963a3f627505fe841e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=c0Npz3Fsw1qYNpRs2sssz3gi%2Bwg%3D" alt="image-20251110161718175" loading="lazy"/></p>
<p>åŒæ ·æˆ‘ä»¬ä½¿ç”¨claude code è¾“å…¥ä¸‹é¢çš„æç¤ºè¯</p>
<pre><code class="hljs">è¯·è®¤çœŸé˜…è¯»â€œ11.mdâ€ã€â€œ22.mdâ€ã€â€œ33.mdâ€ã€â€œ44.mdâ€ã€â€œ55.mdâ€ æ–‡æ¡£ï¼Œä»¥ä¸Šæ–‡æ¡£æ˜¯æˆ‘ä¹‹å‰å†™çš„å¾®ä¿¡å…¬ä¼—å·çš„æ–‡ç« ã€‚è¯·æ€»ç»“å½’çº³å‡ºæˆ‘å¾®ä¿¡å…¬ä¼—å·æ–‡æ¡£çš„ç‰¹ç‚¹ï¼ŒåŒ…æ‹¬ç›®å½•ç»“æ„ï¼Œè¯­æ°”ã€å¼€å¤´ã€ç»“å°¾ç­‰ä¿¡æ¯ã€‚è¾“å‡ºâ€œå°ç°ç°å…¬ä¼—å·ç‰¹ç‚¹.mdâ€ æ–‡æ¡£
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e5b5eff209a448479f73283a8d96d569~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=bB1sfY3UV35DPgihUOCmtEUWTlo%3D" alt="image-20251110161918817" loading="lazy"/></p>
<p>è¿™ä¸ªæ—¶å€™ AI ä¼šå­¦ä¹ æˆ‘æä¾›ç»™å®ƒçš„5ç¯‡æ–‡ç« çš„å†…å®¹ï¼Œå®ƒæ€»ç»“å½’çº³å‡ºæˆ‘å†™ä½œçš„é£æ ¼è¾“å‡ºâ€œå°ç°ç°å…¬ä¼—å·ç‰¹ç‚¹.mdâ€ æ–‡æ¡£ã€‚æ–‡æ¡£ç‰‡æ®µå¦‚ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dfc646abcc32459a874549347776414d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=z3cXI7iYB7Ng9l2tgyQVpcCAQZg%3D" alt="image-20251110162310005" loading="lazy"/></p>
<p>å—¯ AIæ€»ç»“çš„è¿˜ç®—å‡†ç¡®ã€‚å½“ç„¶è¿™ä¸ªå¦‚æœæœ‰å“ªé‡Œä¸å‡†ç¡® å¯ä»¥æ‰‹å·¥å»ä¿®æ”¹ã€‚</p>
<p>æœ‰äº†ä¸Šé¢çš„å°ç°ç°å…¬ä¼—å·ç‰¹ç‚¹.md å’Œskillåˆ›å»ºå¸®åŠ©æ–‡æ¡£.md æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥è®©AI å¸®æˆ‘ç¼–å†™skills.mdæ–‡æ¡£äº†ã€‚</p>
<p>æç¤ºè¯å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs">è¯·å‚è€ƒâ€œskillåˆ›å»ºå¸®åŠ©æ–‡æ¡£.mdâ€å’Œâ€œå°ç°ç°å…¬ä¼—å·ç‰¹ç‚¹.mdâ€å¸®æˆ‘ç¼–å†™ä¸€ä¸ªå°ç°ç°å…¬ä¼—å·çš„skillæ’ä»¶ã€‚ç»™å‡ºè¿™ä¸ªæ’ä»¶å®ç°ã€‚
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/41dc3eea2fb64284a70621ba1500b574~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=qM%2Bvm1TWP2xX3YcJfhuNdbM2VvQ%3D" alt="image-20251110162557839" loading="lazy"/></p>
<p>å½“ç„¶è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šé‡åˆ°ç‚¹é—®é¢˜ï¼Œæˆ‘çš„é—®é¢˜å°±æ˜¯ç”Ÿäº§çš„skills.mdæ–‡æ¡£ä¹±ç ï¼Œåº”è¯¥æ˜¯å­—ç¬¦é›†çš„é—®é¢˜ï¼Œæˆ‘è®©AI å¸®æˆ‘ä¿®æ­£ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c53bfd20d66439183124490eeb69d0b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=ibYllCp7JIRx0MdVH7NCJkhVZDA%3D" alt="image-20251110162719384" loading="lazy"/></p>
<p>è¿™æ ·æˆ‘ä»¬å°±åœ¨xiaohuihui-tech-article æ–‡ä»¶å¤¹æ‰¾åˆ°ç”Ÿæˆå¥½çš„ skills.md</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efa49beab97e489e97c0e3e59c993c15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=8zwngDOx42LTc%2F%2BEY8vm21W8d3E%3D" alt="image-20251110162819428" loading="lazy"/></p>
<p>æ‰“å¼€æŸ¥çœ‹ä¸€ä¸‹ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f0368f0c84fc4f13934b42a33367266d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=JxOHaJNXsAKbTB0aW7VkrXVN7sg%3D" alt="image-20251110162855796" loading="lazy"/></p>
<p>çœ‹èµ·æ¥ä¸é”™ã€‚æˆ‘ä»¬æŠŠå®ƒä¹Ÿç”Ÿæˆç½‘é¡µæ–¹ä¾¿å±•ç¤ºã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b9e4887abd68459ba08d990c9f363745~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=BBZrcVJUiQPqkgBNcOQhmfGoqNU%3D" alt="image-20251110163800267" loading="lazy"/></p>
<p>é€šè¿‡å›¾è¡¨æ ¼å¼å±•ç¤ºï¼Œè¿™æ ·skill.mdæ–¹ä¾¿ç†è§£å¤šäº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/dcb06c3bb73645bba2108659e30ad2ad~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=3IWg2xcbb4H1OIHhP%2B4FZncvhm0%3D" alt="image-20251110163902850" loading="lazy"/></p>
<p>å¦å¤–ç¨‹åºä¹ŸåŸºäºskillåˆ›å»ºå¸®åŠ©æ–‡æ¡£.md è¿˜å¸®æˆ‘æŠŠæ’ä»¶æ‰“åŒ…å¥½äº†ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bef306a8034463dae348d3c84d5ecb6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=mJVMjTbgYaby4qqIoKgSsWURS3c%3D" alt="image-20251110164106077" loading="lazy"/></p>
<h3 data-id="heading-4">å®‰è£…skill</h3>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å®‰è£…è¿™ä¸ªè‡ªå·±å¼€å‘çš„skillã€‚æˆ‘ä»¬è¿™ä¸ªè¿™ä¸ªå‹ç¼©åŒ…å¤åˆ¶åˆ°~/.claude/skills æ–‡ä»¶å¤¹ä¸­</p>
<p>è¾“å…¥</p>
<p>å¦‚æœæ˜¯windowså¹³å°å¯ä»¥æ‰‹å·¥å¤åˆ¶åˆ° C:\Users\xxx.claude\skills</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3c94ac40cd51410a9e7af9dce51a41f5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=2xvFWBjGr59%2BpVK9c5HeiiQYRNI%3D" alt="image-20251110164730420" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/822658b6aa734d9097df96e7d05e5a42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=%2FKjS1VdpyIE6VAfQcEilKN%2Froww%3D" alt="image-20251110165041134" loading="lazy"/></p>
<p>æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹è¿™ä¸ªskillsæ˜¯å¦å¯ä»¥ä½¿ç”¨ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aab05ae7abff418d8dcd3cf69226ec4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=4ksyGty01WBHq4gYy896aqqnm10%3D" alt="image-20251110170638487" loading="lazy"/></p>
<h2 data-id="heading-5">3.ä½¿ç”¨skillç”Ÿæˆæ–‡ç« </h2>
<p>â€‹     æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªskillæ¥ç”Ÿæˆä¸€ä¸ªå°ç°ç°ç‰ˆæœ¬çš„å…¬ä¼—å·æ–‡ç« æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p>â€‹      å®‰è£…claude skills æˆ‘ä»¬é€€å‡ºclaude  é‡æ–°è¿›å…¥ã€‚</p>
<p>â€‹     <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a691220c63924640b4d01ced98a66639~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=lbyUmhwAULtaqOdU6dBCfbdEPOg%3D" alt="image-20251110170837560" loading="lazy"/></p>
<p>æç¤ºè¯å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">è¯·è®¤çœŸåˆ†æhttps://github.com/wwwzhouhui/in_animationå¼€æºé¡¹ç›®ï¼Œè¯·å¸®æˆ‘ä½¿ç”¨xiaohuihui-tech-article skillåŸºäºè¿™ä¸ªå¼€æºé¡¹ç›®ç”Ÿæˆä¸€ä¸ªå…¬ä¼—å·æ–‡ç« ã€‚è¾“å‡º<span class="hljs-string">"20251101in_animationå…¬ä¼—å·æ–‡ç« .md"</span>
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/63029ac38e974868b8a24790f3b28664~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=Alf8y4kqMGbT%2F3KTivGMY3PmRaA%3D" alt="image-20251110171352603" loading="lazy"/></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1524879e10d47ecace8e0d0f27e8cf2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=7JpZBBZXa71h3wI2HW%2BEVvz0vGM%3D" alt="image-20251110174826034" loading="lazy"/></p>
<p>æ–‡ç« å†™å®Œäº†ï¼Œæˆ‘ä»¬æ£€æŸ¥ä¸‹ç”Ÿæˆå¥½çš„æ–‡ç« ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/611194b1426f4486905272e459e49044~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=WCqrbxgca4wwk1Xh7pYKeGyaO2w%3D" alt="image-20251110175034671" loading="lazy"/></p>
<p>â€‹     ç›®å½•ç»“æ„æ˜¯ç¬¦åˆæˆ‘æ–‡ç« é£æ ¼çš„ã€‚æ¥ä¸‹æ¥æˆ‘çœ‹ä¸€ä¸‹æ–‡ç« çš„å†…å®¹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/53704604904548a69c812aac14d8c9d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=x6%2Bd5aw7LAUZ9TqbrpBMt4iycAg%3D" alt="image-20251110175146630" loading="lazy"/></p>
<p>â€‹     <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a69b80864bcc40f6a95a42162cfe02cd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=weahj2xEtAsHD63X%2FGLnAQQCQlA%3D" alt="image-20251110175215254" loading="lazy"/></p>
<p>æ–‡ç« å‰è¨€å’Œæ€»ç»“éƒ¨åˆ†ä¹Ÿçš„ç¡®æ˜¯å’Œæˆ‘ä¹‹å‰å†™æ–‡ç« é£æ ¼æ¯”è¾ƒç›¸è¿‘ã€‚æœ‰ä¸ªé—®é¢˜å°±æ˜¯æˆ‘çš„æ–‡ç« æœ‰å¤§é‡çš„æˆªå›¾ã€‚è¿™é‡Œå›¾æ˜¯ç¼ºå¤±çš„ï¼Œä¸è¿‡ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæˆ‘ä¹‹å‰å‹æ ¹å°±æ²¡æœ‰è®©å®ƒç”Ÿæˆå›¾ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d8541841baa341de83cda4c2fb7d70b5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgd3d3emhvdWh1aQ==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763382209&amp;x-signature=69txxllXyS6x6C8hsn3xORTNMC0%3D" alt="image-20251110175422733" loading="lazy"/></p>
<p>é€šè¿‡ä¸Šé¢çš„æ–¹å¼æˆ‘ä»¬åŸºæœ¬ä¸Šå®ç°äº†ä¸€ä¸ªåŸºäºå°ç°ç°æŠ€æœ¯æ–‡ç« ç”Ÿæˆå™¨skill æŠ€èƒ½ã€‚</p>
<h2 data-id="heading-6">4.æ€»ç»“</h2>
<p>ä»Šå¤©ä¸»è¦å¸¦å¤§å®¶äº†è§£å¹¶å®ç°äº†è‡ªå®šä¹‰ Claude Skill çš„åˆ›å»ºä¸ä½¿ç”¨å®Œæ•´æµç¨‹ï¼Œè¯¥æµç¨‹ä»¥ Anthropic æ¨å‡ºçš„ Skills æ¨¡å—åŒ–ä½“ç³»ä¸ºæ ¸å¿ƒï¼Œé€šè¿‡åˆ†æå®˜æ–¹æ–‡æ¡£çš„è§„èŒƒè¦æ±‚ï¼Œç»“åˆ AI è¾…åŠ©ç”Ÿæˆå·¥å…·ï¼Œå½¢æˆäº†ä¸€å¥—ä»æŠ€èƒ½å®šä¹‰åˆ°å®é™…åº”ç”¨çš„å®ç”¨åŒ–è§£å†³æ–¹æ¡ˆã€‚</p>
<p>é€šè¿‡è¿™å¥—å®è·µæ–¹æ¡ˆï¼Œç”¨æˆ·èƒ½å¤Ÿä½æˆæœ¬æ‰“é€ ä¸“å±çš„ AI æŠ€èƒ½æ¨¡å— â€”â€” å€ŸåŠ©å››ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼ˆç›®å½•ç»“æ„åˆ›å»ºã€Skill.md ç¼–å†™ã€ZIP æ‰“åŒ…ã€ä¸Šä¼ å¯ç”¨ï¼‰çš„æ¸…æ™°æŒ‡å¼•ï¼Œæ— éœ€å¤æ‚çš„å¼€å‘ç»éªŒï¼Œå°±èƒ½å¿«é€Ÿæ„å»ºç¬¦åˆä¸ªäººé£æ ¼çš„ä¸“ä¸šåŒ–èƒ½åŠ›å°è£…ã€‚æ— è®ºæ˜¯å…¬ä¼—å·æ–‡ç« ç”Ÿæˆã€åŠå…¬æ–‡æ¡£å¤„ç†ï¼Œè¿˜æ˜¯ç‰¹å®šé¢†åŸŸçš„ä»»åŠ¡è‡ªåŠ¨åŒ–ï¼Œéƒ½èƒ½é€šè¿‡æ ‡å‡†åŒ–çš„ Skill æ ¼å¼å®ç°ï¼Œæå¤§é™ä½äº†å¼€å‘è€…å®šåˆ¶ Claude èƒ½åŠ›çš„æŠ€æœ¯é—¨æ§›ã€‚åœ¨å®é™…éªŒè¯ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ã€Œå°ç°ç°å…¬ä¼—å·æ–‡ç« ç”Ÿæˆå™¨ã€èƒ½å¤Ÿç¨³å®šå¤ç°é¢„è®¾çš„å†™ä½œé£æ ¼ï¼Œæœ‰æ•ˆè§£å†³äº†é‡å¤åˆ›ä½œä¸­ä¿æŒé£æ ¼ä¸€è‡´æ€§çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œè¯¥æ–¹æ¡ˆå…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ â€”â€” å°ä¼™ä¼´ä»¬å¯ä»¥åŸºäºæ­¤æµç¨‹æ‰©å±•æ›´å¤šå®ç”¨æŠ€èƒ½ï¼Œå¦‚å­¦æœ¯è®ºæ–‡æ ¼å¼æ’ç‰ˆã€äº§å“æ–‡æ¡ˆæ‰¹é‡ç”Ÿæˆã€å¤šè¯­è¨€å†…å®¹è½¬æ¢ç­‰ï¼Œè¿›ä¸€æ­¥ä¸°å¯Œ Claude æ¨¡å‹åœ¨å®é™…ä¸šåŠ¡åœºæ™¯ä¸­çš„åº”ç”¨ä»·å€¼ã€‚</p>
<p>æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å‚ç…§æ–‡ä¸­æä¾›çš„æ­¥éª¤ï¼Œç»“åˆè‡ªèº«éœ€æ±‚åˆ›å»ºä¸“å± Skill è¿›è¡Œå®è·µã€‚ä»Šå¤©çš„åˆ†äº«å°±åˆ°è¿™é‡Œç»“æŸäº†ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« è§ã€‚</p>
<p>é™„ä»¶èµ„æ–™</p>
<p>é€šè¿‡ç½‘ç›˜åˆ†äº«çš„æ–‡ä»¶ï¼šå°ç°ç°æŠ€æœ¯æ–‡ç« ç”Ÿæˆå™¨+ç”Ÿæˆæ–‡ç« .zip
é“¾æ¥: <a href="https://link.juejin.cn?target=https%3A%2F%2Fpan.baidu.com%2Fs%2F1xwzBWOkqsYaTg7zf9WsRag" target="_blank" title="https://pan.baidu.com/s/1xwzBWOkqsYaTg7zf9WsRag" ref="nofollow noopener noreferrer">pan.baidu.com/s/1xwzBWOkqâ€¦</a> æå–ç : vjx9</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MiniMind æ¨¡å‹æ¶æ„åˆ›æ–°æŠ€æœ¯è¯¦è§£]]></title>    <link>https://juejin.cn/post/7570793903848996879</link>    <guid>https://juejin.cn/post/7570793903848996879</guid>    <pubDate>2025-11-10T12:51:41.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570793903848996879" data-draft-id="7570793903848980495" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MiniMind æ¨¡å‹æ¶æ„åˆ›æ–°æŠ€æœ¯è¯¦è§£"/> <meta itemprop="keywords" content="äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-10T12:51:41.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="mwq30123"/> <meta itemprop="url" content="https://juejin.cn/user/3403743729030686"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MiniMind æ¨¡å‹æ¶æ„åˆ›æ–°æŠ€æœ¯è¯¦è§£
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3403743729030686/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    mwq30123
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T12:51:41.000Z" title="Mon Nov 10 2025 12:51:41 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»29åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MiniMind æ¨¡å‹æ¶æ„åˆ›æ–°æŠ€æœ¯è¯¦è§£</h2>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FAlvinScrp%2Fminimind%2Fblob%2Fmaster%2Fmodel%2Fmodel.py" target="_blank" title="https://github.com/AlvinScrp/minimind/blob/master/model/model.py" ref="nofollow noopener noreferrer">github.com/AlvinScrp/mâ€¦</a></p>
<h3 data-id="heading-1">ä¸€ã€æ ¸å¿ƒæ¶æ„å·®å¼‚</h3>
<h4 data-id="heading-2">1. RMSNormï¼ˆRoot Mean Square Layer Normalizationï¼‰</h4>
<h5 data-id="heading-3">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:16-50</code></p>
<h5 data-id="heading-4">å®ç°åŸç†</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_norm</span>(<span class="hljs-params">self, x</span>):
    <span class="hljs-string">"""æ‰§è¡Œ RMS å½’ä¸€åŒ–è®¡ç®—
    è®¡ç®—å…¬å¼: x / sqrt(mean(x^2) + eps)
    """</span>
    <span class="hljs-keyword">return</span> x * torch.rsqrt(x.<span class="hljs-built_in">pow</span>(<span class="hljs-number">2</span>).mean(-<span class="hljs-number">1</span>, keepdim=<span class="hljs-literal">True</span>) + self.eps)

<span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
    <span class="hljs-keyword">return</span> self.weight * self._norm(x.<span class="hljs-built_in">float</span>()).type_as(x)
</code></pre>
<h5 data-id="heading-5">ä¸LayerNormçš„å¯¹æ¯”</h5>








































<table><thead><tr><th>ç‰¹æ€§</th><th>LayerNorm</th><th>RMSNorm</th></tr></thead><tbody><tr><td><strong>è®¡ç®—å…¬å¼</strong></td><td><code>(x - mean) / sqrt(var + eps)</code></td><td><code>x / sqrt(mean(x^2) + eps)</code></td></tr><tr><td><strong>å‡å»å‡å€¼</strong></td><td>âœ… æ˜¯</td><td>âŒ å¦</td></tr><tr><td><strong>è®¡ç®—é‡</strong></td><td>è¾ƒé«˜</td><td><strong>è¾ƒä½</strong></td></tr><tr><td><strong>å†…å­˜å ç”¨</strong></td><td>è¾ƒé«˜</td><td><strong>è¾ƒä½</strong></td></tr><tr><td><strong>ç¨³å®šæ€§</strong></td><td>éå¸¸å¥½</td><td>è‰¯å¥½</td></tr><tr><td><strong>GPUå‹å¥½åº¦</strong></td><td>ä¸€èˆ¬</td><td><strong>æå¥½</strong></td></tr></tbody></table>
<h5 data-id="heading-6">é€‰å–åŸå› </h5>
<ul>
<li><strong>è®¡ç®—æ•ˆç‡</strong>ï¼šRMSNorm æ¶ˆé™¤äº†å‡å»å‡å€¼çš„æ­¥éª¤ï¼Œå‡å°‘äº†è®¡ç®—é‡</li>
<li><strong>å†…å­˜æ•ˆç‡</strong>ï¼šä¸éœ€è¦å­˜å‚¨å‡å€¼å’Œæ–¹å·®ï¼Œå†…å­˜å ç”¨æ›´å°‘</li>
<li><strong>ç°ä»£LLMæ ‡å‡†</strong>ï¼šLLaMAã€Falconç­‰æœ€æ–°å¤§æ¨¡å‹éƒ½é‡‡ç”¨RMSNorm</li>
<li><strong>GPUä¼˜åŒ–</strong>ï¼šæ›´æ˜“è¢«GPUçš„åº•å±‚ä¼˜åŒ–å†…æ ¸åŠ é€Ÿ</li>
</ul>
<h5 data-id="heading-7">æŠ€æœ¯å¯¹æ¯”ç³»åˆ—</h5>
<ul>
<li><strong>L1 Normalization</strong>ï¼šå›ºå®šå‡å€¼å’Œæ–¹å·®ï¼ˆè¿‡æ—¶ï¼‰</li>
<li><strong>BatchNorm</strong>ï¼šè·¨batchç»´åº¦å½’ä¸€åŒ–ï¼ˆä¸é€‚ç”¨åºåˆ—ä»»åŠ¡ï¼‰</li>
<li><strong>LayerNorm</strong>ï¼šè·¨ç‰¹å¾ç»´åº¦å½’ä¸€åŒ–ï¼ˆæ ‡å‡†åšæ³•ï¼‰</li>
<li><strong>GroupNorm</strong>ï¼šåˆ†ç»„å½’ä¸€åŒ–ï¼ˆä»‹äºä¸¤è€…ä¹‹é—´ï¼‰</li>
<li><strong>RMSNorm</strong> â­ï¼šç®€åŒ–çš„LayerNormï¼ˆå½“å‰æœ€ä¼˜å®è·µï¼‰</li>
</ul>
<h5 data-id="heading-8">æ ¸å¿ƒä¼˜åŠ¿</h5>
<pre><code class="hljs language-erlang" lang="erlang">è®¡ç®—å¤æ‚åº¦é™ä½ <span class="hljs-number">30</span>-<span class="hljs-number">40</span><span class="hljs-comment">%</span>
â†“
è®­ç»ƒå’Œæ¨ç†é€Ÿåº¦æ›´å¿«
â†“
æ˜¾å­˜å ç”¨æ›´å°‘
â†“
å¯è®­ç»ƒæ›´å¤§æ¨¡å‹æˆ–æ›´é•¿åºåˆ—
</code></pre>
<hr/>
<h4 data-id="heading-9">2. RoPEï¼ˆRotary Position Embeddingsï¼‰</h4>
<h5 data-id="heading-10">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:53-74</code> å’Œ <code>model/model.py:77-113</code></p>
<h5 data-id="heading-11">å®ç°åŸç†</h5>
<p><strong>é¢„è®¡ç®—é˜¶æ®µ</strong> (model.py:53-74)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">precompute_pos_cis</span>(<span class="hljs-params">dim: <span class="hljs-built_in">int</span>, end: <span class="hljs-built_in">int</span> = <span class="hljs-built_in">int</span>(<span class="hljs-params"><span class="hljs-number">32</span> * <span class="hljs-number">1024</span></span>), theta: <span class="hljs-built_in">float</span> = <span class="hljs-number">1e6</span></span>):
    <span class="hljs-string">"""é¢„è®¡ç®—æ—‹è½¬ä½ç½®ç¼–ç æ‰€éœ€çš„å¤æ•°å€¼"""</span>
    <span class="hljs-comment"># è®¡ç®—ä¸åŒé¢‘ç‡çš„é€†é¢‘ç‡é¡¹</span>
    freqs = <span class="hljs-number">1.0</span> / (theta ** (torch.arange(<span class="hljs-number">0</span>, dim, <span class="hljs-number">2</span>)[: (dim // <span class="hljs-number">2</span>)].<span class="hljs-built_in">float</span>() / dim))
    <span class="hljs-comment"># ç”Ÿæˆä½ç½®ç´¢å¼•</span>
    t = torch.arange(end, device=freqs.device)
    <span class="hljs-comment"># è®¡ç®—å¤–ç§¯å¾—åˆ°æ¯ä¸ªä½ç½®å¯¹åº”çš„æ¯ä¸ªé¢‘ç‡</span>
    freqs = torch.outer(t, freqs).<span class="hljs-built_in">float</span>()
    <span class="hljs-comment"># ä½¿ç”¨æ¬§æ‹‰å…¬å¼ e^(i*Î¸) = cos(Î¸) + i*sin(Î¸) ç”Ÿæˆå¤æ•°</span>
    pos_cis = torch.polar(torch.ones_like(freqs), freqs)  <span class="hljs-comment"># complex64</span>
    <span class="hljs-keyword">return</span> pos_cis
</code></pre>
<p><strong>åº”ç”¨é˜¶æ®µ</strong> (model.py:77-113)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">apply_rotary_emb</span>(<span class="hljs-params">xq, xk, pos_cis</span>):
    <span class="hljs-comment"># å°†Qå’ŒKè½¬æ¢ä¸ºå¤æ•°å½¢å¼</span>
    xq_ = torch.view_as_complex(xq.<span class="hljs-built_in">float</span>().reshape(*xq.shape[:-<span class="hljs-number">1</span>], -<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))
    xk_ = torch.view_as_complex(xk.<span class="hljs-built_in">float</span>().reshape(*xk.shape[:-<span class="hljs-number">1</span>], -<span class="hljs-number">1</span>, <span class="hljs-number">2</span>))

    <span class="hljs-comment"># åœ¨å¤æ•°åŸŸä¸­åº”ç”¨æ—‹è½¬ï¼ˆä¹˜ä»¥pos_cisï¼‰</span>
    xq_out = torch.view_as_real(xq_ * pos_cis).flatten(<span class="hljs-number">3</span>)
    xk_out = torch.view_as_real(xk_ * pos_cis).flatten(<span class="hljs-number">3</span>)
    <span class="hljs-keyword">return</span> xq_out.type_as(xq), xk_out.type_as(xk)
</code></pre>
<h5 data-id="heading-12">ä¸ä¼ ç»Ÿä½ç½®ç¼–ç çš„å¯¹æ¯”</h5>















































<table><thead><tr><th>ç‰¹æ€§</th><th>ç»å¯¹ä½ç½®ç¼–ç </th><th>ç›¸å¯¹ä½ç½®ç¼–ç </th><th>RoPE</th></tr></thead><tbody><tr><td><strong>å®ç°æ–¹å¼</strong></td><td>ç›´æ¥åŠ åˆ°åµŒå…¥</td><td>ç›¸å¯¹ä½ç½®çŸ©é˜µ</td><td>å¤æ•°æ—‹è½¬</td></tr><tr><td><strong>å¤–æ¨æ€§èƒ½</strong></td><td>âŒ æå·®</td><td>ä¸€èˆ¬</td><td>âœ…<strong>ä¼˜ç§€</strong></td></tr><tr><td><strong>é•¿æ–‡æœ¬é€‚åº”</strong></td><td>âŒ æ— æ³•å¤„ç†</td><td>ä¸­ç­‰</td><td>âœ…<strong>å¯è¾¾32K+</strong></td></tr><tr><td><strong>è®¡ç®—å¤æ‚åº¦</strong></td><td>O(1)</td><td>O(nÂ²)</td><td>O(n)</td></tr><tr><td><strong>æ˜¾å­˜å ç”¨</strong></td><td>æœ€å°‘</td><td>ä¸­ç­‰</td><td>æå°‘</td></tr><tr><td><strong>ç†è®ºåŸºç¡€</strong></td><td>æ— </td><td>ç›¸å¯¹ä½ç½®åç½®</td><td><strong>å¤æ•°å‡ ä½•</strong></td></tr></tbody></table>
<h5 data-id="heading-13">é€‰å–åŸå› </h5>
<p><strong>æ•°å­¦ä¼˜é›…æ€§</strong>ï¼š</p>
<ul>
<li>åˆ©ç”¨å¤æ•°æ—‹è½¬çš„å‡ ä½•æ€§è´¨ç¼–ç ä½ç½®ä¿¡æ¯</li>
<li>ç›¸é‚»ä½ç½®ä¹‹é—´çš„ç›¸å¯¹è·ç¦»ç”±æ—‹è½¬è§’åº¦å†³å®š</li>
</ul>
<p><strong>å¤–æ¨èƒ½åŠ›</strong>ï¼š</p>
<ul>
<li>å¯ä»¥å¤„ç†è®­ç»ƒé•¿åº¦ä¹‹å¤–çš„åºåˆ—ï¼ˆå¤–æ¨é•¿åº¦å¯è¾¾10-100å€ï¼‰</li>
<li>è¿™æ˜¯LLaMAèƒ½å¤„ç†4Kâ†’32Kåºåˆ—çš„å…³é”®</li>
</ul>
<p><strong>ç¡¬ä»¶å‹å¥½</strong>ï¼š</p>
<ul>
<li>æ— éœ€é¢å¤–çš„ä½ç½®çŸ©é˜µå­˜å‚¨</li>
<li>è®¡ç®—å¯å®Œå…¨èåˆåˆ°Qã€Kçš„æŠ•å½±ä¸­</li>
</ul>
<h5 data-id="heading-14">æŠ€æœ¯æ¼”è¿›çº¿è·¯</h5>
<pre><code class="hljs language-scss" lang="scss">ç»å¯¹ä½ç½®ç¼–ç  (Sin/Cos embedding)
    â†“ <span class="hljs-selector-attr">[é—®é¢˜ï¼šå¤–æ¨èƒ½åŠ›å·®]</span>
ç›¸å¯¹ä½ç½®ç¼–ç  (Shaw et al., <span class="hljs-number">2018</span>)
    â†“ <span class="hljs-selector-attr">[é—®é¢˜ï¼šè®¡ç®—å¤æ‚åº¦é«˜]</span>
ALiBi (Press et al., <span class="hljs-number">2022</span>)
    â†“ <span class="hljs-selector-attr">[é—®é¢˜ï¼šéœ€è¦ä¿®æ”¹æ³¨æ„åŠ›è®¡ç®—]</span>
RoPE (Su et al., <span class="hljs-number">2021</span>) â­
    â†“ <span class="hljs-selector-attr">[æœ€ä¼˜æ–¹æ¡ˆ]</span>
YaRN / NTK-Aware (<span class="hljs-number">2023</span>)
</code></pre>
<h5 data-id="heading-15">æ ¸å¿ƒä¼˜åŠ¿</h5>
<pre><code class="hljs">ç›¸å¯¹ä½ç½®ä¸å˜æ€§
â†“
é¢‘ç‡åˆ†è§£çš„è‡ªç„¶æ€§
â†“
ä¼˜ç§€çš„å¤–æ¨æ€§èƒ½
â†“
å¯è®­ç»ƒæ›´é•¿åºåˆ—
</code></pre>
<hr/>
<h4 data-id="heading-16">3. GQAï¼ˆGrouped-Query Attentionï¼‰</h4>
<h5 data-id="heading-17">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:142-280</code></p>
<h5 data-id="heading-18">å®ç°åŸç†</h5>
<p><strong>å¤´éƒ¨é…ç½®</strong> (model.py:163-201)ï¼š</p>
<pre><code class="hljs language-python" lang="python">self.n_kv_heads = args.n_kv_heads <span class="hljs-keyword">if</span> args.n_kv_heads <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">else</span> args.n_heads
<span class="hljs-keyword">assert</span> args.n_heads % self.n_kv_heads == <span class="hljs-number">0</span>  <span class="hljs-comment"># Qå¤´æ•°å¿…é¡»æ˜¯KVå¤´æ•°çš„å€æ•°</span>
self.n_rep = self.n_local_heads // self.n_local_kv_heads  <span class="hljs-comment"># æ¯ä¸ªKVå¤´å¯¹åº”çš„Qå¤´æ•°</span>
</code></pre>
<p><strong>é‡å¤KVå¤´</strong> (model.py:116-139)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">repeat_kv</span>(<span class="hljs-params">x: torch.Tensor, n_rep: <span class="hljs-built_in">int</span></span>) -&gt; torch.Tensor:
    <span class="hljs-string">"""å°†KVå¤´é‡å¤n_repæ¬¡ä»¥åŒ¹é…Qå¤´æ•°é‡"""</span>
    bs, slen, n_kv_heads, head_dim = x.shape
    <span class="hljs-keyword">if</span> n_rep == <span class="hljs-number">1</span>:
        <span class="hljs-keyword">return</span> x
    <span class="hljs-keyword">return</span> (
        x[:, :, :, <span class="hljs-literal">None</span>, :]
        .expand(bs, slen, n_kv_heads, n_rep, head_dim)
        .reshape(bs, slen, n_kv_heads * n_rep, head_dim)
    )
</code></pre>
<p><strong>æ³¨æ„åŠ›è®¡ç®—</strong> (model.py:244-272)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é‡å¤KVå¤´ä»¥åŒ¹é…Qå¤´æ•°é‡</span>
xq, xk, xv = (
    xq.transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),
    repeat_kv(xk, self.n_rep).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>),  <span class="hljs-comment"># â† å…³é”®ï¼šKVè¢«é‡å¤</span>
    repeat_kv(xv, self.n_rep).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
)
</code></pre>
<h5 data-id="heading-19">ä¸æ ‡å‡†MHAçš„å¯¹æ¯”</h5>















































<table><thead><tr><th>ç‰¹æ€§</th><th>MHA</th><th>MQA</th><th>GQA</th></tr></thead><tbody><tr><td><strong>Qå¤´æ•°</strong></td><td>n</td><td>n</td><td>n</td></tr><tr><td><strong>KVå¤´æ•°</strong></td><td>n</td><td>1</td><td>n/g (å¯è°ƒ)</td></tr><tr><td><strong>KVæŠ•å½±å‚æ•°</strong></td><td>æœ€å¤š</td><td>æœ€å°‘</td><td><strong>ä¸­ç­‰</strong></td></tr><tr><td><strong>æ¨ç†æ˜¾å­˜</strong></td><td>åŸºå‡†</td><td>å‡å°‘ 95%</td><td>å‡å°‘ 50-80%</td></tr><tr><td><strong>æ¨ç†é€Ÿåº¦</strong></td><td>åŸºå‡†</td><td><strong>å¿«</strong></td><td><strong>å¿«</strong></td></tr><tr><td><strong>ç²¾åº¦æŸå¤±</strong></td><td>0%</td><td>0-2%</td><td><strong>&lt;0.5%</strong></td></tr></tbody></table>
<h5 data-id="heading-20">é…ç½®ç¤ºä¾‹</h5>
<pre><code class="hljs language-ini" lang="ini">æ ‡å‡† MHAï¼š<span class="hljs-attr">Q</span>=<span class="hljs-number">32</span>å¤´, KV=<span class="hljs-number">32</span>å¤´
    â†“
MQAï¼š<span class="hljs-attr">Q</span>=<span class="hljs-number">32</span>å¤´, KV=<span class="hljs-number">1</span>å¤´ (æ¿€è¿›ï¼Œç²¾åº¦å¯èƒ½ä¸‹é™)
    â†“
GQA (<span class="hljs-attr">n_kv_heads</span>=<span class="hljs-number">4</span>)ï¼šQ=<span class="hljs-number">32</span>å¤´, KV=<span class="hljs-number">4</span>å¤´ (å‡è¡¡) â­
    â†“
GQA (<span class="hljs-attr">n_kv_heads</span>=<span class="hljs-number">8</span>)ï¼šQ=<span class="hljs-number">32</span>å¤´, KV=<span class="hljs-number">8</span>å¤´ (æ¥è¿‘MHA)
</code></pre>
<h5 data-id="heading-21">é€‰å–åŸå› </h5>
<p><strong>æ¨ç†æ€§èƒ½</strong>ï¼š</p>
<ul>
<li>KVç¼“å­˜å¤§å°å‡å°‘ï¼Œæé«˜æ˜¾å­˜åˆ©ç”¨ç‡</li>
<li>åœ¨é•¿åºåˆ—ç”Ÿæˆæ—¶æ˜¾è‘—åŠ é€Ÿ</li>
</ul>
<p><strong>è®­ç»ƒç¨³å®šæ€§</strong>ï¼š</p>
<ul>
<li>ç›¸æ¯”MQAï¼Œç²¾åº¦æŸå¤±æå°ï¼ˆ&lt;0.5%ï¼‰</li>
<li>ä¿ç•™äº†è¶³å¤Ÿçš„KVå¤šæ ·æ€§</li>
</ul>
<p><strong>å·¥ä¸šæ ‡å‡†</strong>ï¼š</p>
<ul>
<li>Llama 2ä½¿ç”¨GQA</li>
<li>OpenAIçš„æœ€æ–°æ¨¡å‹é‡‡ç”¨æ­¤æ–¹æ¡ˆ</li>
</ul>
<h5 data-id="heading-22">æŠ€æœ¯æ¼”è¿›</h5>
<pre><code class="hljs language-scss" lang="scss">Multi-Head Attention (Vaswani et al., <span class="hljs-number">2017</span>)
    â†“ <span class="hljs-selector-attr">[é—®é¢˜ï¼šæ¨ç†æ—¶KVç¼“å­˜å¤ªå¤§]</span>
Multi-Query Attention (Shazeer, <span class="hljs-number">2019</span>)
    â†“ <span class="hljs-selector-attr">[é—®é¢˜ï¼šç²¾åº¦ä¸‹é™æ˜æ˜¾]</span>
Grouped-Query Attention (Ainslie et al., <span class="hljs-number">2023</span>) â­
    â†“ <span class="hljs-selector-attr">[æœ€ä¼˜å¹³è¡¡ç‚¹]</span>
</code></pre>
<h5 data-id="heading-23">æ ¸å¿ƒä¼˜åŠ¿</h5>
<pre><code class="hljs language-erlang" lang="erlang">KVç¼“å­˜å‡å°‘ <span class="hljs-number">50</span>-<span class="hljs-number">80</span><span class="hljs-comment">%</span>
â†“
æ¨ç†æ˜¾å­˜å‹åŠ›å‡è½»
â†“
å¯æé«˜ååé‡æˆ–å¤„ç†æ›´é•¿åºåˆ—
â†“
ç²¾åº¦åŸºæœ¬æ— æŸ
</code></pre>
<hr/>
<h4 data-id="heading-24">4. Flash Attention</h4>
<h5 data-id="heading-25">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:254-261</code></p>
<h5 data-id="heading-26">å®ç°åŸç†</h5>
<p><strong>æ£€æµ‹ä¸å¯ç”¨</strong> (model.py:194-195)ï¼š</p>
<pre><code class="hljs language-python" lang="python">self.flash = <span class="hljs-built_in">hasattr</span>(torch.nn.functional, <span class="hljs-string">'scaled_dot_product_attention'</span>) <span class="hljs-keyword">and</span> args.flash_attn
</code></pre>
<p><strong>è°ƒç”¨æ–¹å¼</strong> (model.py:254-261)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> self.flash <span class="hljs-keyword">and</span> seq_len != <span class="hljs-number">1</span>:
    dropout_p = self.dropout <span class="hljs-keyword">if</span> self.training <span class="hljs-keyword">else</span> <span class="hljs-number">0.0</span>
    output = F.scaled_dot_product_attention(
        xq, xk, xv,
        attn_mask=<span class="hljs-literal">None</span>,  <span class="hljs-comment"># Flash Attentionå†…éƒ¨å¤„ç†å› æœæ©ç </span>
        dropout_p=dropout_p,
        is_causal=<span class="hljs-literal">True</span>  <span class="hljs-comment"># æŒ‡ç¤ºä½¿ç”¨å› æœæ©ç </span>
    )
<span class="hljs-keyword">else</span>:  <span class="hljs-comment"># é™çº§åˆ°æ ‡å‡†æ³¨æ„åŠ›</span>
    scores = (xq @ xk.transpose(-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>)) / math.sqrt(self.head_dim)
    scores += self.mask[:, :, :seq_len, :seq_len]
    scores = F.softmax(scores.<span class="hljs-built_in">float</span>(), dim=-<span class="hljs-number">1</span>).type_as(xq)
    scores = self.attn_dropout(scores)
    output = scores @ xv
</code></pre>
<h5 data-id="heading-27">ä¸æ ‡å‡†Attentionçš„å¯¹æ¯”</h5>








































<table><thead><tr><th>ç‰¹æ€§</th><th>æ ‡å‡†Attention</th><th>Flash Attention</th></tr></thead><tbody><tr><td><strong>è®¡ç®—æµç¨‹</strong></td><td>Q@Kâ†’softmaxâ†’@V</td><td>ä¼˜åŒ–çš„èåˆæ ¸</td></tr><tr><td><strong>ä¸­é—´å¼ é‡</strong></td><td>éœ€è¦å­˜å‚¨NÂ²åˆ†æ•°çŸ©é˜µ</td><td>æŒ‰å—æµå¼å¤„ç†</td></tr><tr><td><strong>IOå¤æ‚åº¦</strong></td><td>O(NÂ²)</td><td>O(N)</td></tr><tr><td><strong>è®¡ç®—é€Ÿåº¦</strong></td><td>åŸºå‡†</td><td><strong>2-4å€å¿«</strong></td></tr><tr><td><strong>æ˜¾å­˜å ç”¨</strong></td><td>åŸºå‡†</td><td><strong>å‡å°‘ 90%</strong></td></tr><tr><td><strong>ç²¾åº¦</strong></td><td>FP32</td><td>FP16ï¼ˆè‡ªé€‚åº”ï¼‰</td></tr></tbody></table>
<h5 data-id="heading-28">å·¥ä½œåŸç†ï¼ˆé«˜å±‚ï¼‰</h5>
<p>æ ‡å‡†æ–¹æ³•çš„é—®é¢˜ï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[Q @ K^T]</span> â†’ ç”ŸæˆNÃ—Nçš„åˆ†æ•°çŸ©é˜µï¼ˆæ˜¾å­˜ç“¶é¢ˆï¼‰
    â†“
<span class="hljs-selector-attr">[softmax]</span> â†’ æ¯ä¸ªå…ƒç´ ä¾èµ–å…¨å±€ä¿¡æ¯
    â†“
<span class="hljs-selector-attr">[@ V]</span> â†’ éœ€è¦é‡æ–°è¯»å–å…¨NÃ—NçŸ©é˜µ
</code></pre>
<p>Flash Attentionè§£å†³æ–¹æ¡ˆï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">å°†æ³¨æ„åŠ›è®¡ç®—åˆ†å—è¿›è¡Œï¼š
<span class="hljs-bullet">  1.</span> å°†Qã€Kã€Våˆ†å—åŠ è½½åˆ°å¿«é€Ÿæ˜¾å­˜ï¼ˆSRAMï¼‰
<span class="hljs-bullet">  2.</span> å¯¹æ¯å—è®¡ç®—æ³¨æ„åŠ›
<span class="hljs-bullet">  3.</span> èåˆsoftmaxå’Œdropout
<span class="hljs-bullet">  4.</span> ç›´æ¥å†™å…¥ç»“æœï¼Œæ— éœ€å­˜å‚¨ä¸­é—´åˆ†æ•°
</code></pre>
<h5 data-id="heading-29">é€‰å–åŸå› </h5>
<p><strong>æ€§èƒ½ç“¶é¢ˆçªç ´</strong>ï¼š</p>
<ul>
<li>æ ‡å‡†æ³¨æ„åŠ›çš„IOæˆä¸ºä¸»è¦ç“¶é¢ˆï¼ˆä¸æ˜¯è®¡ç®—ï¼‰</li>
<li>Flash Attentioné€šè¿‡å‡å°‘IOå®ç°2-4å€åŠ é€Ÿ</li>
</ul>
<p><strong>æ˜¾å­˜èŠ‚çœ</strong>ï¼š</p>
<ul>
<li>å…³é”®åœ¨é•¿åºåˆ—åœºæ™¯ä¸‹</li>
<li>å¯è®­ç»ƒæ›´é•¿ä¸Šä¸‹æ–‡</li>
</ul>
<p><strong>åº“æ”¯æŒ</strong>ï¼š</p>
<ul>
<li>PyTorch 2.0+é›†æˆæ”¯æŒ</li>
<li>æ— éœ€é¢å¤–ä¾èµ–</li>
</ul>
<h5 data-id="heading-30">æ ¸å¿ƒä¼˜åŠ¿</h5>
<pre><code class="hljs">IOæ„ŸçŸ¥çš„ç®—æ³•è®¾è®¡
â†“
å……åˆ†åˆ©ç”¨GPUç¡¬ä»¶ç‰¹æ€§
â†“
æ¨ç†å’Œè®­ç»ƒéƒ½å¿« 2-4 å€
â†“
é•¿åºåˆ—æˆä¸ºå¯èƒ½
</code></pre>
<hr/>
<h4 data-id="heading-31">5. KV Cache ä¼˜åŒ–</h4>
<h5 data-id="heading-32">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:236-242</code></p>
<h5 data-id="heading-33">å®ç°åŸç†</h5>
<p><strong>ç¼“å­˜ä¿å­˜</strong> (model.py:236-242)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># KVç¼“å­˜å¤„ç†ï¼šå¦‚æœæœ‰å†å²KVï¼Œåˆ™ä¸å½“å‰KVæ‹¼æ¥</span>
<span class="hljs-keyword">if</span> past_key_value <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
    xk = torch.cat([past_key_value[<span class="hljs-number">0</span>], xk], dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># æ‹¼æ¥å†å²Kå’Œå½“å‰K</span>
    xv = torch.cat([past_key_value[<span class="hljs-number">1</span>], xv], dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># æ‹¼æ¥å†å²Vå’Œå½“å‰V</span>

<span class="hljs-comment"># å¦‚æœéœ€è¦ç¼“å­˜ï¼Œåˆ™ä¿å­˜å½“å‰KVç”¨äºä¸‹ä¸€æ­¥</span>
past_kv = (xk, xv) <span class="hljs-keyword">if</span> use_cache <span class="hljs-keyword">else</span> <span class="hljs-literal">None</span>
</code></pre>
<p><strong>ç”Ÿæˆæ—¶çš„ä½¿ç”¨</strong> (model.py:731-737)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é¦–æ¬¡æ¨ç†æˆ–ä¸ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œå¤„ç†æ•´ä¸ªåºåˆ—</span>
<span class="hljs-keyword">if</span> first_seq <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> use_cache:
    out, first_seq = self(input_ids, past_key_values=past_kvs, use_cache=use_cache, **args), <span class="hljs-literal">False</span>
<span class="hljs-comment"># åç»­æ¨ç†ä¸”ä½¿ç”¨ç¼“å­˜æ—¶ï¼Œåªå¤„ç†æœ€æ–°çš„token</span>
<span class="hljs-keyword">else</span>:
    out = self(input_ids[:, -<span class="hljs-number">1</span>:], past_key_values=past_kvs, use_cache=use_cache,
               start_pos=input_ids.shape[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>, **args)
</code></pre>
<h5 data-id="heading-34">æ€§èƒ½å½±å“</h5>



































<table><thead><tr><th>åœºæ™¯</th><th>æ— KV Cache</th><th>æœ‰KV Cache</th></tr></thead><tbody><tr><td><strong>ç”Ÿæˆé€Ÿåº¦</strong></td><td>åŸºå‡† (100%)</td><td><strong>~10å€å¿«</strong></td></tr><tr><td><strong>æ˜¾å­˜å ç”¨</strong></td><td>éšé•¿åº¦å¹³æ–¹å¢é•¿</td><td>çº¿æ€§å¢é•¿</td></tr><tr><td><strong>é•¿åºåˆ—ç”Ÿæˆ</strong></td><td>ä¸å¯è¡Œ</td><td>âœ… å¯è¡Œ</td></tr><tr><td><strong>é¦–tokenå»¶è¿Ÿ</strong></td><td>ä½</td><td>ç•¥é«˜ï¼ˆéœ€è¦å…¨åºåˆ—è®¡ç®—ï¼‰</td></tr><tr><td><strong>åç»­tokenå»¶è¿Ÿ</strong></td><td><strong>é«˜</strong></td><td>æä½</td></tr></tbody></table>
<h5 data-id="heading-35">åŸç†åˆ†æ</h5>
<p>æ— ç¼“å­˜æ—¶çš„è®¡ç®—æµç¨‹ï¼š</p>
<pre><code class="hljs language-perl" lang="perl">ç”Ÿæˆtoken <span class="hljs-number">100</span>ï¼š
  Q, K, V = self.w<span class="hljs-string">q(seq_0-100)</span>, self.wk(seq_<span class="hljs-number">0</span>-<span class="hljs-number">100</span>), self.wv(seq_<span class="hljs-number">0</span>-<span class="hljs-number">100</span>)
  attn = softmax(Q @ K^T) @ V
  é‡æ–°è®¡ç®—äº†seq_<span class="hljs-number">0</span>-<span class="hljs-number">99</span>çš„Kã€Vï¼ˆæµªè´¹ï¼ï¼‰

ç”Ÿæˆtoken <span class="hljs-number">101</span>ï¼š
  Q, K, V = self.w<span class="hljs-string">q(seq_0-101)</span>, self.wk(seq_<span class="hljs-number">0</span>-<span class="hljs-number">101</span>), self.wv(seq_<span class="hljs-number">0</span>-<span class="hljs-number">101</span>)
  attn = softmax(Q @ K^T) @ V
  åˆé‡æ–°è®¡ç®—äº†seq_<span class="hljs-number">0</span>-<span class="hljs-number">100</span>çš„Kã€Vï¼ˆäºŒæ¬¡æµªè´¹ï¼ï¼‰
</code></pre>
<p>æœ‰ç¼“å­˜æ—¶ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ç”Ÿæˆtoken 100ï¼š
  Q100, K100, <span class="hljs-attr">V100</span> = self.wq(token_100), self.wk(token_100), self.wv(token_100)
  <span class="hljs-attr">cached_K</span> = [K_0-<span class="hljs-number">99</span>, K100]  â† ä¿å­˜
  <span class="hljs-attr">cached_V</span> = [V_0-<span class="hljs-number">99</span>, V100]  â† ä¿å­˜
  <span class="hljs-attr">attn</span> = softmax(Q100 @ cached_K^T) @ cached_V

ç”Ÿæˆtoken 101ï¼š
  Q101, K101, <span class="hljs-attr">V101</span> = self.wq(token_101), self.wk(token_101), self.wv(token_101)
  <span class="hljs-attr">cached_K</span> = [K_0-<span class="hljs-number">99</span>, K100, K101]  â† è¿½åŠ ï¼ˆåªè®¡ç®—æ–°tokenï¼‰
  <span class="hljs-attr">cached_V</span> = [V_0-<span class="hljs-number">99</span>, V100, V101]  â† è¿½åŠ 
  <span class="hljs-attr">attn</span> = softmax(Q101 @ cached_K^T) @ cached_V
</code></pre>
<h5 data-id="heading-36">é€‰å–åŸå› </h5>
<p><strong>è‡ªå›å½’ç”Ÿæˆçš„å¿…è¦æ¡ä»¶</strong>ï¼š</p>
<ul>
<li>ä¸ä½¿ç”¨KV Cacheæ—¶ï¼Œç”Ÿæˆ100ä¸ªtokenéœ€è¦è®¡ç®—~5000æ¬¡çŸ©é˜µä¹˜æ³•</li>
<li>ä½¿ç”¨KV Cacheåªéœ€~200æ¬¡ï¼ˆç†è®ºåŠ é€Ÿ50å€ï¼‰</li>
</ul>
<p><strong>å®é™…åœºæ™¯</strong>ï¼š</p>
<ul>
<li>æ‰€æœ‰LLMæ¨ç†æ¡†æ¶éƒ½ä½¿ç”¨KV Cache</li>
<li>æ²¡æœ‰KV Cacheæ— æ³•è¿›è¡Œå®ç”¨çš„æ–‡æœ¬ç”Ÿæˆ</li>
</ul>
<h5 data-id="heading-37">æ ¸å¿ƒä¼˜åŠ¿</h5>
<pre><code class="hljs">é¿å…é‡å¤è®¡ç®—å†å²tokençš„Kã€V
â†“
ç”Ÿæˆé€Ÿåº¦æå‡ 10-50 å€
â†“
å¯è¿›è¡Œå®æ—¶äº¤äº’å¼åº”ç”¨
â†“
å¤§å¹…é™ä½æ¨ç†æˆæœ¬
</code></pre>
<hr/>
<h3 data-id="heading-38">æŠ€æœ¯æ€»ç»“çŸ©é˜µ</h3>















































<table><thead><tr><th>æŠ€æœ¯</th><th>æ”¹è¿›ç›®æ ‡</th><th>ç›¸å¯¹å¤æ‚åº¦</th><th>æ”¶ç›Šå¹…åº¦</th><th>ç°ä»£åœ°ä½</th></tr></thead><tbody><tr><td><strong>RMSNorm</strong></td><td>è®¡ç®—æ•ˆç‡</td><td>â­ ä½</td><td>30-40%</td><td>ğŸ”¥ æ ‡å‡†</td></tr><tr><td><strong>RoPE</strong></td><td>å¤–æ¨èƒ½åŠ›</td><td>â­â­ ä¸­</td><td>10-100å€</td><td>ğŸ”¥ æ ‡å‡†</td></tr><tr><td><strong>GQA</strong></td><td>æ¨ç†æ•ˆç‡</td><td>â­â­ ä¸­</td><td>2-4å€</td><td>ğŸ”¥ æ ‡å‡†</td></tr><tr><td><strong>Flash Attention</strong></td><td>è®¡ç®—é€Ÿåº¦</td><td>â­â­â­ å¤æ‚</td><td>2-4å€</td><td>ğŸ”¥ æ¨è</td></tr><tr><td><strong>KV Cache</strong></td><td>ç”Ÿæˆé€Ÿåº¦</td><td>â­ ä½</td><td>10-50å€</td><td>ğŸ”¥ å¿…é¡»</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-39">æ¶æ„æ¼”è¿›å¯¹æ¯”</h3>
<h4 data-id="heading-40">åŸå§‹Transformer (Vaswani et al., 2017)</h4>
<pre><code class="hljs language-scss" lang="scss">Embedding + LayerNorm
    â†“
Positional Encoding (ç»å¯¹ä½ç½®)
    â†“
Multi-Head Attention (<span class="hljs-number">32</span>å¤´, <span class="hljs-number">32</span>KV)
    â†“
LayerNorm + FFN (<span class="hljs-number">4</span>å€ç»´åº¦)
    â†“
æ— KV Cacheæ¨ç†
    â†“
å¤–æ¨èƒ½åŠ›ï¼šâŒ æå·®
æ¨ç†é€Ÿåº¦ï¼šâŒ ææ…¢
</code></pre>
<h4 data-id="heading-41">GPT-3é£æ ¼ (Brown et al., 2020)</h4>
<pre><code class="hljs language-scss" lang="scss">Embedding + LayerNorm
    â†“
Positional Encoding (ç»å¯¹ä½ç½®)
    â†“
Multi-Head Attention (<span class="hljs-number">96</span>å¤´, <span class="hljs-number">96</span>KV)
    â†“
LayerNorm + FFN (<span class="hljs-number">4</span>å€ç»´åº¦)
    â†“
KV Cacheæ¨ç†
    â†“
å¤–æ¨èƒ½åŠ›ï¼šâŒ æ— æ³•å¤„ç†è¶…è®­ç»ƒé•¿åº¦
æ¨ç†é€Ÿåº¦ï¼šä¸­ç­‰ï¼ˆæœ‰Cacheï¼‰
</code></pre>
<h4 data-id="heading-42">LLaMAé£æ ¼ (Meta, 2023) - MiniMindé‡‡ç”¨</h4>
<pre><code class="hljs language-java" lang="java">Embedding + RMSNorm â­
    â†“
RoPEä½ç½®ç¼–ç  â­
    â†“
Grouped-Query <span class="hljs-title function_">Attention</span> <span class="hljs-params">(32Q, 8KV)</span> â­
    â†“
RMSNorm + SwiGLU FFN
    â†“
Flash Attention + KV Cache â­
    â†“
å¤–æ¨èƒ½åŠ›ï¼šâœ… å¯å¤„ç† <span class="hljs-number">10</span>-<span class="hljs-number">100</span>å€é•¿åºåˆ—
æ¨ç†é€Ÿåº¦ï¼šâœ… æ¯”GPT-<span class="hljs-number">3</span>å¿« <span class="hljs-number">10</span>-<span class="hljs-number">50</span>å€
æ˜¾å­˜å ç”¨ï¼šâœ… å‡å°‘ <span class="hljs-number">50</span>-<span class="hljs-number">80</span>%
</code></pre>
<hr/>
<h2 data-id="heading-43">MiniMind å‰é¦ˆç½‘ç»œåˆ›æ–°æŠ€æœ¯è¯¦è§£</h2>
<h3 data-id="heading-44">äºŒã€å‰é¦ˆç½‘ç»œå·®å¼‚</h3>
<h4 data-id="heading-45">1. SwiGLU æ¿€æ´»å‡½æ•°</h4>
<h5 data-id="heading-46">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:283-344</code></p>
<h5 data-id="heading-47">å®ç°åŸç†</h5>
<p><strong>ç±»å®šä¹‰å’Œåˆå§‹åŒ–</strong> (model.py:300-324)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FeedForward</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: LMConfig</span>):
        <span class="hljs-built_in">super</span>().__init__()
        <span class="hljs-comment"># å¦‚æœæœªæŒ‡å®šéšè—å±‚ç»´åº¦ï¼Œåˆ™è‡ªåŠ¨è®¡ç®—</span>
        <span class="hljs-keyword">if</span> config.hidden_dim <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            hidden_dim = <span class="hljs-number">4</span> * config.dim  <span class="hljs-comment"># åˆå§‹ä¸º4å€ç»´åº¦</span>
            hidden_dim = <span class="hljs-built_in">int</span>(<span class="hljs-number">2</span> * hidden_dim / <span class="hljs-number">3</span>)  <span class="hljs-comment"># â† å…³é”®ï¼šé™åˆ°çº¦2.67å€</span>
            <span class="hljs-comment"># å¯¹é½åˆ°multiple_ofçš„å€æ•°ï¼ˆé€šå¸¸ä¸º256ï¼‰</span>
            config.hidden_dim = config.multiple_of * ((hidden_dim + config.multiple_of - <span class="hljs-number">1</span>) // config.multiple_of)

        <span class="hljs-comment"># ä¸‰ä¸ªçº¿æ€§æŠ•å½±å±‚</span>
        self.w1 = nn.Linear(config.dim, config.hidden_dim, bias=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># å‡ç»´</span>
        self.w2 = nn.Linear(config.hidden_dim, config.dim, bias=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># é™ç»´</span>
        self.w3 = nn.Linear(config.dim, config.hidden_dim, bias=<span class="hljs-literal">False</span>)  <span class="hljs-comment"># é—¨æ§</span>
        self.dropout = nn.Dropout(config.dropout)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-string">"""SwiGLUå®ç°ï¼šFFN(x) = dropout(Wâ‚‚ Â· (SiLU(Wâ‚Â·x) âŠ™ Wâ‚ƒÂ·x))"""</span>
        <span class="hljs-keyword">return</span> self.dropout(self.w2(F.silu(self.w1(x)) * self.w3(x)))
        <span class="hljs-comment">#                                    â†‘ æ¿€æ´»å‡½æ•°      â†‘ é—¨æ§ä¿¡å·</span>
</code></pre>
<h5 data-id="heading-48">æ•°å­¦å…¬å¼å¯¹æ¯”</h5>

























<table><thead><tr><th>æ¶æ„</th><th>å…¬å¼</th><th>å‚æ•°æ•°é‡</th></tr></thead><tbody><tr><td><strong>ä¼ ç»ŸFFN</strong></td><td><code>FFN(x) = Wâ‚‚ Â· ReLU(Wâ‚ Â· x)</code></td><td><code>2DÂ·H</code></td></tr><tr><td><strong>GELU FFN</strong></td><td><code>FFN(x) = Wâ‚‚ Â· GELU(Wâ‚ Â· x)</code></td><td><code>2DÂ·H</code></td></tr><tr><td><strong>SwiGLU</strong></td><td><code>FFN(x) = Wâ‚‚ Â· (SiLU(Wâ‚Â·x) âŠ™ Wâ‚ƒÂ·x)</code></td><td><code>3DÂ·H</code></td></tr></tbody></table>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>D</code> = æ¨¡å‹ç»´åº¦ (é€šå¸¸ 768-4096)</li>
<li><code>H</code> = éšè—ç»´åº¦ (é€šå¸¸ 2.67D)</li>
<li><code>âŠ™</code> = é€å…ƒç´ ä¹˜æ³•ï¼ˆHadamardç§¯ï¼‰</li>
<li><code>SiLU(x) = x Â· sigmoid(x)</code> = Swishæ¿€æ´»</li>
</ul>
<h5 data-id="heading-49">SwiGLUçš„ä¸‰ä¸ªå…³é”®ç»„ä»¶</h5>
<p><strong>1. SiLUæ¿€æ´»å‡½æ•°ï¼ˆSwishï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python">SiLU(x) = x Â· sigmoid(x) = x Â· <span class="hljs-number">1</span>/(<span class="hljs-number">1</span> + e^(-x))
</code></pre>
<p>å¯¹æ¯”å…¶ä»–æ¿€æ´»å‡½æ•°ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">ReLUï¼š          <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, x)           - éå…‰æ»‘ï¼Œæ¢¯åº¦ä¸º<span class="hljs-number">0</span>æˆ–<span class="hljs-number">1</span>
GELUï¼š          x Â· Î¦(x)            - å…‰æ»‘ï¼Œç±»ä¼¼softmax
Swish/SiLUï¼š    x Â· <span class="hljs-built_in">sigmoid</span>(x)      - å…‰æ»‘è‡ªé—¨æ§ â­
</code></pre>
<p><strong>2. é—¨æ§æœºåˆ¶ï¼ˆGatingï¼‰</strong></p>
<pre><code class="hljs language-python" lang="python">f(x) = SiLU(Wâ‚Â·x) âŠ™ Wâ‚ƒÂ·x
       â†‘ æ¿€æ´»è·¯å¾„    â†‘ é—¨æ§è·¯å¾„
</code></pre>
<p>é—¨æ§ä½œç”¨ï¼š</p>
<ul>
<li><code>Wâ‚ƒÂ·x</code> äº§ç”Ÿçš„å€¼èŒƒå›´åœ¨ [0, 1] ä¹‹é—´ï¼ˆæˆ–æ¥è¿‘ï¼‰</li>
<li>é€šè¿‡é€å…ƒç´ ä¹˜æ³•æ¥è°ƒèŠ‚ä¿¡æ¯æµ</li>
<li>ç±»ä¼¼äºLSTMä¸­çš„é—å¿˜é—¨</li>
</ul>
<p><strong>3. å‚æ•°é«˜æ•ˆæ€§</strong></p>
<pre><code class="hljs language-r" lang="r">æ ‡å‡†FFNï¼š<span class="hljs-built_in">dim</span> â†’ <span class="hljs-number">4</span><span class="hljs-operator">*</span><span class="hljs-built_in">dim</span> â†’ <span class="hljs-built_in">dim</span>
         å‚æ•°æ•°ï¼š<span class="hljs-number">2</span><span class="hljs-operator">*</span>D<span class="hljs-operator">*</span><span class="hljs-number">4</span>D <span class="hljs-operator">=</span> <span class="hljs-number">8</span>DÂ²

SwiGLUï¼š  <span class="hljs-built_in">dim</span> â†’ <span class="hljs-number">2.67</span><span class="hljs-operator">*</span><span class="hljs-built_in">dim</span> â†’ <span class="hljs-built_in">dim</span> <span class="hljs-punctuation">(</span>ä¸¤ä¸ªåˆ†æ”¯<span class="hljs-punctuation">)</span>
         å‚æ•°æ•°ï¼š<span class="hljs-punctuation">(</span><span class="hljs-number">1</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span> <span class="hljs-operator">+</span> <span class="hljs-number">1</span><span class="hljs-punctuation">)</span><span class="hljs-operator">*</span>D<span class="hljs-operator">*</span><span class="hljs-number">2.67</span>D â‰ˆ <span class="hljs-number">8</span>DÂ²

â†“ è™½ç„¶å‚æ•°ç›¸åŒï¼Œä½†è®¡ç®—é‡ç›¸è¿‘ï¼Œä½†æ•ˆæœæ˜¾è‘—æ›´å¥½
</code></pre>
<h5 data-id="heading-50">ä¸å…¶ä»–æ¿€æ´»å‡½æ•°çš„å¯¹æ¯”</h5>





























































<table><thead><tr><th>ç‰¹æ€§</th><th>ReLU</th><th>GELU</th><th>Swish/SiLU</th><th>SwiGLU</th></tr></thead><tbody><tr><td><strong>å¹³æ»‘æ€§</strong></td><td>âŒ ä¸å¹³æ»‘</td><td>âœ… å¹³æ»‘</td><td>âœ… å¹³æ»‘</td><td>âœ… å¹³æ»‘</td></tr><tr><td><strong>è‡ªé—¨æ§</strong></td><td>âŒ æ— </td><td>âŒ æ— </td><td>âœ… æœ‰</td><td>âœ… æœ‰</td></tr><tr><td><strong>åŒè·¯å¾„</strong></td><td>âŒ å•è·¯</td><td>âŒ å•è·¯</td><td>âŒ å•è·¯</td><td>âœ… åŒè·¯</td></tr><tr><td><strong>æ¢¯åº¦æµ</strong></td><td>å·®</td><td>å¥½</td><td>ä¼˜</td><td><strong>ä¼˜å¼‚</strong></td></tr><tr><td><strong>è®¡ç®—æˆæœ¬</strong></td><td>æœ€ä½</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td><td>ä¸­ç­‰</td></tr><tr><td><strong>æ¨¡å‹è´¨é‡</strong></td><td>ä½</td><td>é«˜</td><td>é«˜</td><td><strong>æœ€é«˜</strong></td></tr><tr><td><strong>ç°ä»£é‡‡ç”¨</strong></td><td>è¿‡æ—¶</td><td>å¹¿æ³›</td><td>å¸¸è§</td><td><strong>ğŸ”¥æ ‡å‡†</strong></td></tr></tbody></table>
<h5 data-id="heading-51">é€‰å–åŸå› </h5>
<p><strong>1. é—¨æ§çš„å¿…è¦æ€§</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">ä¼ ç»ŸFFNçš„é—®é¢˜ï¼š
<span class="hljs-bullet">  -</span> æ¿€æ´»å‡½æ•°å¤„ç†æ‰€æœ‰ä¿¡æ¯
<span class="hljs-bullet">  -</span> æ— æ³•æ ¹æ®ä¸Šä¸‹æ–‡è°ƒèŠ‚ä¿¡æ¯
<span class="hljs-bullet">  -</span> æ¢¯åº¦æµå—é™

SwiGLUçš„ä¼˜åŠ¿ï¼š
<span class="hljs-bullet">  -</span> åŒè·¯å¾„è®¾è®¡ï¼šæ¿€æ´»è·¯å¾„ + é—¨æ§è·¯å¾„
<span class="hljs-bullet">  -</span> å¯åŠ¨æ€è°ƒèŠ‚ä¿¡æ¯æµå¼ºåº¦
<span class="hljs-bullet">  -</span> æ¢¯åº¦ä»ä¸¤æ¡è·¯å¾„æµå‘åå‘ä¼ æ’­
</code></pre>
<p><strong>2. å®éªŒè¯æ®ï¼ˆæ¥è‡ªåŸå§‹è®ºæ–‡ï¼‰</strong></p>
<p>ä½¿ç”¨ç›¸åŒå‚æ•°é‡çš„æƒ…å†µä¸‹ï¼š</p>

























<table><thead><tr><th>æ¶æ„</th><th>BLEUè¯„åˆ†</th><th>å›°æƒ‘åº¦</th></tr></thead><tbody><tr><td>ReLU FFN</td><td>25.4</td><td>5.20</td></tr><tr><td>GELU FFN</td><td>26.8</td><td>4.95</td></tr><tr><td>SwiGLU</td><td><strong>27.6</strong></td><td><strong>4.71</strong></td></tr></tbody></table>
<p>SwiGLUç›¸æ¯”GELUæå‡ ~3%ï¼Œç›¸æ¯”ReLUæå‡ ~8%</p>
<p><strong>3. å‚æ•°é«˜æ•ˆæ€§</strong></p>
<pre><code class="hljs language-r" lang="r">å…³é”®å‘ç°ï¼ˆShazeer et al.<span class="hljs-punctuation">,</span> <span class="hljs-number">2022</span>ï¼‰ï¼š

ä½¿ç”¨SwiGLUæ—¶ï¼Œå¯ä»¥å‡å°‘FFNçš„éšè—ç»´åº¦ï¼Œ
åŒæ—¶ä¿æŒç›¸åŒç”šè‡³æ›´å¥½çš„æ€§èƒ½

åŸå§‹ï¼š<span class="hljs-built_in">dim</span> â†’ <span class="hljs-number">4</span><span class="hljs-operator">*</span><span class="hljs-built_in">dim</span> â†’ <span class="hljs-built_in">dim</span>
ç°åœ¨ï¼š<span class="hljs-built_in">dim</span> â†’ <span class="hljs-number">2.67</span><span class="hljs-operator">*</span><span class="hljs-built_in">dim</span> â†’ <span class="hljs-built_in">dim</span> â­

æ•ˆæœï¼šå‚æ•°å‡å°‘ <span class="hljs-number">33</span>%ï¼Œæ€§èƒ½æŒå¹³æˆ–æ›´ä¼˜
</code></pre>
<p><strong>4. ç°ä»£LLMæ ‡å‡†</strong></p>
<pre><code class="hljs">LLaMA / LLaMA-2ï¼šSwiGLU
PaLM / Geminiï¼šSwiGLU
Falconï¼šSwiGLU
MistralAIï¼šSwiGLU
</code></pre>
<h5 data-id="heading-52">æ¿€æ´»å‡½æ•°æ¼”è¿›çº¿</h5>
<pre><code class="hljs language-scss" lang="scss">æ—¶ä»£ <span class="hljs-number">1</span> (<span class="hljs-number">2012</span>-<span class="hljs-number">2017</span>)ï¼šReLU ä¸»å®°
  <span class="hljs-built_in">max</span>(<span class="hljs-number">0</span>, x)
  â†“ <span class="hljs-selector-attr">[æ¢¯åº¦æ¶ˆå¤±é—®é¢˜]</span>

æ—¶ä»£ <span class="hljs-number">2</span> (<span class="hljs-number">2017</span>-<span class="hljs-number">2020</span>)ï¼šGELU å…´èµ·
  xÂ·Î¦(x)  <span class="hljs-selector-attr">[æ›´å¹³æ»‘çš„æ¢¯åº¦]</span>
  â†“ <span class="hljs-selector-attr">[ç¼ºå°‘è‡ªé€‚åº”é—¨æ§]</span>

æ—¶ä»£ <span class="hljs-number">3</span> (<span class="hljs-number">2020</span>-<span class="hljs-number">2022</span>)ï¼šSwish å®éªŒé˜¶æ®µ
  xÂ·<span class="hljs-built_in">sigmoid</span>(x)  <span class="hljs-selector-attr">[è‡ªé—¨æ§]</span>
  â†“ <span class="hljs-selector-attr">[é—¨æ§ä¸å¤Ÿç»“æ„åŒ–]</span>

æ—¶ä»£ <span class="hljs-number">4</span> (<span class="hljs-number">2022</span>+)ï¼šSwiGLU æ ‡å‡†åŒ– â­
  Wâ‚‚(SiLU(Wâ‚x) âŠ™ Wâ‚ƒx)  <span class="hljs-selector-attr">[æœ€ä¼˜çš„è¡¨è¾¾åŠ›+æ•ˆç‡]</span>
  â†“

æœªæ¥å¯èƒ½ï¼šMLP-Mixer, GLU Variants
</code></pre>
<h5 data-id="heading-53">æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“</h5>
<pre><code class="hljs language-markdown" lang="markdown">åŒè·¯å¾„è®¾è®¡
<span class="hljs-code">    â†“
æ›´å¥½çš„æ¢¯åº¦æµ
    â†“
æ›´å¼ºçš„è¡¨è¾¾èƒ½åŠ›
    â†“
å¯å‡å°‘å‚æ•°åŒæ—¶ä¿æŒæ€§èƒ½
    â†“
æˆä¸ºç°ä»£LLMæ ‡å‡†æ¿€æ´»å‡½æ•°
</span></code></pre>
<hr/>
<h4 data-id="heading-54">2. MoEï¼ˆMixture of Expertsï¼‰æ··åˆä¸“å®¶æ¨¡å‹</h4>
<h5 data-id="heading-55">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:347-459</code></p>
<h5 data-id="heading-56">å®ç°åŸç†</h5>
<p><strong>MoEé—¨æ§ç½‘ç»œ</strong> (model.py:347-401)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MoEGate</span>(nn.Module):
    <span class="hljs-string">"""é—¨æ§ç½‘ç»œï¼šå†³å®šæ¯ä¸ªtokenç”±å“ªäº›ä¸“å®¶å¤„ç†"""</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: LMConfig</span>):
        <span class="hljs-built_in">super</span>().__init__()
        self.top_k = config.num_experts_per_tok  <span class="hljs-comment"># æ¯ä¸ªtokené€‰æ‹©çš„ä¸“å®¶æ•°</span>
        self.n_routed_experts = config.n_routed_experts  <span class="hljs-comment"># è·¯ç”±ä¸“å®¶æ€»æ•°</span>
        self.scoring_func = config.scoring_func  <span class="hljs-comment"># è¯„åˆ†å‡½æ•°ï¼ˆsoftmaxï¼‰</span>
        self.alpha = config.aux_loss_alpha  <span class="hljs-comment"># è¾…åŠ©æŸå¤±æƒé‡</span>
        self.weight = nn.Parameter(torch.empty((self.n_routed_experts, self.gating_dim)))

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, hidden_states</span>):
        <span class="hljs-comment"># è®¡ç®—æ¯ä¸ªä¸“å®¶çš„å¾—åˆ†</span>
        logits = F.linear(hidden_states, self.weight, <span class="hljs-literal">None</span>)
        scores = logits.softmax(dim=-<span class="hljs-number">1</span>)  <span class="hljs-comment"># è½¬æ¢ä¸ºæ¦‚ç‡</span>

        <span class="hljs-comment"># é€‰æ‹©top-kä¸ªä¸“å®¶</span>
        topk_weight, topk_idx = torch.topk(scores, k=self.top_k, dim=-<span class="hljs-number">1</span>, <span class="hljs-built_in">sorted</span>=<span class="hljs-literal">False</span>)

        <span class="hljs-comment"># å½’ä¸€åŒ–top-kæƒé‡</span>
        <span class="hljs-keyword">if</span> self.top_k &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> self.norm_topk_prob:
            denominator = topk_weight.<span class="hljs-built_in">sum</span>(dim=-<span class="hljs-number">1</span>, keepdim=<span class="hljs-literal">True</span>) + <span class="hljs-number">1e-20</span>
            topk_weight = topk_weight / denominator

        <span class="hljs-comment"># è®¡ç®—è¾…åŠ©æŸå¤±ï¼ˆå¹³è¡¡ä¸“å®¶è´Ÿè½½ï¼‰</span>
        aux_loss = self._compute_aux_loss(...)

        <span class="hljs-keyword">return</span> topk_idx, topk_weight, aux_loss
</code></pre>
<p><strong>MoEå‰é¦ˆç½‘ç»œ</strong> (model.py:404-436)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MOEFeedForward</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config: LMConfig</span>):
        <span class="hljs-built_in">super</span>().__init__()
        <span class="hljs-comment"># åˆ›å»ºå¤šä¸ªä¸“å®¶ï¼ˆæ¯ä¸ªéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„FFNï¼‰</span>
        self.experts = nn.ModuleList([
            FeedForward(config)
            <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(config.n_routed_experts)
        ])
        self.gate = MoEGate(config)  <span class="hljs-comment"># é—¨æ§ç½‘ç»œ</span>

        <span class="hljs-comment"># å¯é€‰çš„å…±äº«ä¸“å®¶ï¼ˆæ‰€æœ‰tokenéƒ½ç»è¿‡ï¼‰</span>
        <span class="hljs-keyword">if</span> config.n_shared_experts <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.shared_experts = FeedForward(config)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        identity = x
        <span class="hljs-comment"># 1. ä½¿ç”¨é—¨æ§ç½‘ç»œé€‰æ‹©ä¸“å®¶</span>
        topk_idx, topk_weight, aux_loss = self.gate(x)

        <span class="hljs-comment"># 2. åˆ†å‘tokenç»™é€‰ä¸­çš„ä¸“å®¶</span>
        <span class="hljs-keyword">if</span> self.training:
            <span class="hljs-comment"># è®­ç»ƒæ—¶ï¼šå¾ªç¯åˆ†å‘ï¼ˆæ›´ç®€å•çš„å®ç°ï¼‰</span>
            y = torch.empty_like(x, dtype=torch.float16)
            <span class="hljs-keyword">for</span> i, expert <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(self.experts):
                y[flat_topk_idx == i] = expert(x[flat_topk_idx == i])
            y = (y.view(*topk_weight.shape, -<span class="hljs-number">1</span>) * topk_weight.unsqueeze(-<span class="hljs-number">1</span>)).<span class="hljs-built_in">sum</span>(dim=<span class="hljs-number">1</span>)
        <span class="hljs-keyword">else</span>:
            <span class="hljs-comment"># æ¨ç†æ—¶ï¼šä¼˜åŒ–çš„æ¨ç†æµç¨‹</span>
            y = self.moe_infer(x, flat_topk_idx, topk_weight.view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>))

        <span class="hljs-comment"># 3. å¯é€‰ï¼šæ·»åŠ å…±äº«ä¸“å®¶çš„è¾“å‡º</span>
        <span class="hljs-keyword">if</span> self.config.n_shared_experts <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            y = y + self.shared_experts(identity)

        <span class="hljs-comment"># ä¿å­˜è¾…åŠ©æŸå¤±ç”¨äºåå‘ä¼ æ’­</span>
        self.aux_loss = aux_loss
        <span class="hljs-keyword">return</span> y
</code></pre>
<p><strong>é«˜æ•ˆæ¨ç†</strong> (model.py:438-459)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@torch.no_grad()</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">moe_infer</span>(<span class="hljs-params">self, x, flat_expert_indices, flat_expert_weights</span>):
    <span class="hljs-string">"""æ¨ç†æ—¶çš„é«˜æ•ˆMoEè®¡ç®—"""</span>
    expert_cache = torch.zeros_like(x)

    <span class="hljs-comment"># æŒ‰ä¸“å®¶ç´¢å¼•æ’åºtoken</span>
    idxs = flat_expert_indices.argsort()

    <span class="hljs-comment"># è®¡ç®—æ¯ä¸ªä¸“å®¶å¤„ç†çš„tokenæ•°</span>
    tokens_per_expert = flat_expert_indices.bincount().cpu().numpy().cumsum(<span class="hljs-number">0</span>)
    token_idxs = idxs // self.config.num_experts_per_tok

    <span class="hljs-comment"># ä¸ºæ¯ä¸ªä¸“å®¶å¤„ç†å¯¹åº”çš„tokens</span>
    <span class="hljs-keyword">for</span> i, end_idx <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(tokens_per_expert):
        start_idx = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> <span class="hljs-keyword">else</span> tokens_per_expert[i - <span class="hljs-number">1</span>]
        <span class="hljs-keyword">if</span> start_idx == end_idx:
            <span class="hljs-keyword">continue</span>
        expert = self.experts[i]
        exp_token_idx = token_idxs[start_idx:end_idx]
        expert_tokens = x[exp_token_idx]
        expert_out = expert(expert_tokens)
        expert_out.mul_(flat_expert_weights[idxs[start_idx:end_idx]])
        expert_cache.scatter_add_(<span class="hljs-number">0</span>, exp_token_idx.view(-<span class="hljs-number">1</span>, <span class="hljs-number">1</span>).repeat(<span class="hljs-number">1</span>, x.shape[-<span class="hljs-number">1</span>]), expert_out)

    <span class="hljs-keyword">return</span> expert_cache
</code></pre>
<h5 data-id="heading-57">MoEå·¥ä½œæµç¨‹è¯¦è§£</h5>
<p><strong>æ­¥éª¤ 1ï¼šé—¨æ§è·¯ç”±</strong></p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">Input:</span> <span class="hljs-string">token</span> <span class="hljs-string">sequence</span> [<span class="hljs-string">seq_len</span>, <span class="hljs-string">dim</span>]
            <span class="hljs-string">â†“</span>
<span class="hljs-attr">Gate Network:</span> <span class="hljs-string">è®¡ç®—æ¯ä¸ªtoken</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ¯ä¸ªä¸“å®¶çš„æ¦‚ç‡</span>
            <span class="hljs-string">â†“</span>
<span class="hljs-attr">Top-k Selection:</span> <span class="hljs-string">ä¸ºæ¯ä¸ªtokené€‰æ‹©top-kä¸ªä¸“å®¶</span>
            <span class="hljs-string">â†“</span>
<span class="hljs-attr">Output:</span> <span class="hljs-string">(token_to_expert_mapping,</span> <span class="hljs-string">expert_weights)</span>
</code></pre>
<p><strong>æ­¥éª¤ 2ï¼šä¸“å®¶åˆ†å‘</strong></p>
<pre><code class="hljs language-python" lang="python">è¾“å…¥ï¼šTokenåºåˆ— [B, S, D]
         â†“
Gate: [B*S, num_experts] â†’ æ¯ä¸ªtokençš„ä¸“å®¶æƒé‡
         â†“
TopK: ä¸ºæ¯ä¸ªtokené€‰æ‹© top_k=<span class="hljs-number">2</span> ä¸ªä¸“å®¶
         â†“
åˆ†å‘ï¼š
  Token <span class="hljs-number">0</span> â†’ Expert <span class="hljs-number">3</span>, Expert <span class="hljs-number">7</span>  (æƒé‡: <span class="hljs-number">0.6</span>, <span class="hljs-number">0.4</span>)
  Token <span class="hljs-number">1</span> â†’ Expert <span class="hljs-number">1</span>, Expert <span class="hljs-number">5</span>  (æƒé‡: <span class="hljs-number">0.7</span>, <span class="hljs-number">0.3</span>)
  Token <span class="hljs-number">2</span> â†’ Expert <span class="hljs-number">7</span>, Expert <span class="hljs-number">9</span>  (æƒé‡: <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>)
         â†“
æ±‡èšï¼šå¯¹æ¯ä¸ªtokençš„å¤šä¸ªä¸“å®¶è¾“å‡ºåŠ æƒæ±‚å’Œ
</code></pre>
<p><strong>æ­¥éª¤ 3ï¼šè¾“å‡ºåˆå¹¶</strong></p>
<pre><code class="hljs language-ini" lang="ini">Expert 1 output: <span class="hljs-section">[0.7 * token_1_output, ...]</span>
Expert 3 output: <span class="hljs-section">[0.6 * token_0_output, ...]</span>
Expert 5 output: <span class="hljs-section">[0.3 * token_1_output, ...]</span>
Expert 7 output: <span class="hljs-section">[0.4 * token_0_output, 0.5 * token_2_output, ...]</span>
Expert 9 output: <span class="hljs-section">[0.5 * token_2_output, ...]</span>
         â†“ <span class="hljs-section">[åˆå¹¶åˆ°åŸå§‹ä½ç½®]</span>
Final output: <span class="hljs-section">[token_0_out, token_1_out, token_2_out, ...]</span>
</code></pre>
<h5 data-id="heading-58">MoE vs æ ‡å‡†FFN</h5>













































<table><thead><tr><th>ç‰¹æ€§</th><th>æ ‡å‡†FFN</th><th>MoE</th></tr></thead><tbody><tr><td><strong>å‚æ•°æ•°é‡</strong></td><td>åŸºå‡† (8DÂ²)</td><td><strong>ç¨é«˜</strong> (~10DÂ²)</td></tr><tr><td><strong>è®¡ç®—é‡</strong></td><td>æ‰€æœ‰tokenéƒ½ç»è¿‡æ‰€æœ‰ç¥ç»å…ƒ</td><td><strong>åªç»è¿‡top-kä¸“å®¶</strong></td></tr><tr><td><strong>æ¿€æ´»å‚æ•°</strong></td><td>åŸºå‡†</td><td><strong>å‡å°‘ 80-90%</strong></td></tr><tr><td><strong>æ¨¡å‹å®¹é‡</strong></td><td>å›ºå®š</td><td><strong>åŠ¨æ€å¯æ‰©å±•</strong></td></tr><tr><td><strong>æ³›åŒ–èƒ½åŠ›</strong></td><td>åŸºå‡†</td><td><strong>æ›´å¼º</strong></td></tr><tr><td><strong>è®­ç»ƒç¨³å®šæ€§</strong></td><td>è‰¯å¥½</td><td>éœ€è¦è´Ÿè½½å‡è¡¡</td></tr><tr><td><strong>æ¨ç†é€Ÿåº¦</strong></td><td>åŸºå‡†</td><td><strong>å–å†³äºtop-k</strong></td></tr></tbody></table>
<h5 data-id="heading-59">è¯¦ç»†å¯¹æ¯”åˆ†æ</h5>
<p><strong>è®¡ç®—é‡å¯¹æ¯”ï¼ˆä»¥Transformerå—ä¸ºä¾‹ï¼‰</strong></p>
<p>æ ‡å‡†FFNï¼š</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[B, S, D]</span> â†’ <span class="hljs-selector-attr">[B, S, 4D]</span> â†’ <span class="hljs-selector-attr">[B, S, D]</span>

æ€»è®¡ç®—é‡ = <span class="hljs-selector-tag">B</span>*S*D * <span class="hljs-number">4</span>D + <span class="hljs-selector-tag">B</span>*S*<span class="hljs-number">4</span>D * D = <span class="hljs-number">8</span>*<span class="hljs-selector-tag">B</span>*S*DÂ²
ï¼ˆæ¯ä¸ªtokenéƒ½ç»è¿‡å…¨éƒ¨è®¡ç®—ï¼‰
</code></pre>
<p>MoE (num_experts=8, top_k=2)ï¼š</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-selector-attr">[B, S, D]</span> â†’ Gate â†’ é€‰æ‹©<span class="hljs-attribute">top</span>-<span class="hljs-number">2</span>ä¸“å®¶ (å…±<span class="hljs-number">8</span>ä¸ªä¸“å®¶)

æ¯ä¸ªä¸“å®¶å¤§å° = D â†’ D/<span class="hljs-number">2</span> â†’ D  (ä¸ºäº†ä¿æŒæ€»å‚æ•°é‡)

å•ä¸ªtokençš„è®¡ç®— = D * (D/<span class="hljs-number">2</span>) * <span class="hljs-number">2</span> = <span class="hljs-selector-tag">B</span>*S*DÂ²
                  (åªå¤„ç†<span class="hljs-number">2</span>ä¸ªä¸“å®¶)

æ€»è®¡ç®—é‡ â‰ˆ <span class="hljs-number">2</span>*<span class="hljs-selector-tag">B</span>*S*DÂ²
ï¼ˆç›¸æ¯”æ ‡å‡†FFNå‡å°‘ <span class="hljs-number">75%</span>ï¼ï¼‰
</code></pre>
<p><strong>å®é™…æ€§èƒ½æ•°æ®</strong> (æ¥è‡ªGLaMè®ºæ–‡)</p>





























<table><thead><tr><th>é…ç½®</th><th>å‚æ•°</th><th>è®¡ç®—</th><th>å›°æƒ‘åº¦</th></tr></thead><tbody><tr><td>æ ‡å‡† 175B</td><td>175B</td><td>åŸºå‡†</td><td>10.5</td></tr><tr><td>MoE 64E 2K</td><td>175B</td><td>åŸºå‡†</td><td><strong>9.8</strong></td></tr><tr><td>MoE 1024E 2K</td><td>175B</td><td>åŸºå‡†</td><td><strong>9.2</strong></td></tr></tbody></table>
<p><strong>å…³é”®å‘ç°</strong>ï¼š</p>
<ul>
<li>ç›¸åŒå‚æ•°é‡ï¼ŒMoEæ˜¾è‘—è¶…è¿‡æ ‡å‡†æ¨¡å‹</li>
<li>å¯ä»¥ç”¨æ›´å°‘è®¡ç®—è¾¾åˆ°ç›¸åŒç²¾åº¦</li>
<li>æˆ–ç”¨ç›¸åŒè®¡ç®—è¾¾åˆ°æ›´é«˜ç²¾åº¦</li>
</ul>
<h5 data-id="heading-60">MoEçš„å››å¤§æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ</h5>
<p><strong>æŒ‘æˆ˜ 1ï¼šè´Ÿè½½ä¸å‡è¡¡</strong></p>
<pre><code class="hljs language-ini" lang="ini">é—®é¢˜ï¼šæŸäº›ä¸“å®¶è¢«é¢‘ç¹é€‰ä¸­ï¼ŒæŸäº›å¾ˆå°‘è¢«é€‰ä¸­
      â†“ æµªè´¹äº†å‚æ•°å’Œè®¡ç®—èµ„æº

è§£å†³æ–¹æ¡ˆï¼šAuxiliary Lossï¼ˆè¾…åŠ©æŸå¤±ï¼‰
  <span class="hljs-attr">aux_loss</span> = alpha * (ä¸“å®¶ä½¿ç”¨æ¦‚ç‡ * ä¸“å®¶å®¹é‡)
  â†“ é¼“åŠ±å‡åŒ€åˆ†å¸ƒ
</code></pre>
<p><strong>æŒ‘æˆ˜ 2ï¼šè·¯ç”±ç¢°æ’</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">é—®é¢˜ï¼šæŸäº›tokenæƒ³å»çš„ä¸“å®¶éƒ½æ»¡äº†ï¼ˆå®¹é‡é™åˆ¶ï¼‰
<span class="hljs-code">      â†“ éœ€è¦ä¸¢å¼ƒæˆ–é™çº§å¤„ç†
</span>
è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  1.</span> Expert Capacityï¼šä¸ºæ¯ä¸ªä¸“å®¶è®¾å®šå®¹é‡é˜ˆå€¼
<span class="hljs-bullet">  2.</span> Drop Tokensï¼šè¶…è¿‡å®¹é‡çš„tokenä¸¢å¼ƒ
<span class="hljs-bullet">  3.</span> Shared Expertsï¼šæ‰€æœ‰tokenéƒ½ç»è¿‡çš„åå¤‡ä¸“å®¶
</code></pre>
<p><strong>æŒ‘æˆ˜ 3ï¼šè®­ç»ƒä¸ç¨³å®š</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">é—®é¢˜ï¼šGateç½‘ç»œçªç„¶æ”¹å˜è·¯ç”±å†³ç­–
<span class="hljs-code">      â†“ æ¢¯åº¦ä¸ç¨³å®š
</span>
è§£å†³æ–¹æ¡ˆï¼š
<span class="hljs-bullet">  1.</span> Sticky Gateï¼šæ·»åŠ éšæœºå™ªå£°å¹³æ»‘è·¯ç”±
<span class="hljs-bullet">  2.</span> Temperature Annealingï¼šé€æ­¥é™ä½æ¸©åº¦
<span class="hljs-bullet">  3.</span> Load Balancingï¼šå¼ºåˆ¶å‡è¡¡ä¸“å®¶è´Ÿè½½
</code></pre>
<p><strong>æŒ‘æˆ˜ 4ï¼šæ¨ç†å»¶è¿Ÿ</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">é—®é¢˜ï¼šä¸è§„åˆ™çš„å†…å­˜è®¿é—®æ¨¡å¼
<span class="hljs-code">      â†“ GPUåˆ©ç”¨ç‡ä½
</span>
è§£å†³æ–¹æ¡ˆï¼šToken Reorderingï¼ˆä»£ç ä¸­çš„moe<span class="hljs-emphasis">_inferï¼‰
  1. æŒ‰ä¸“å®¶æ’åºtoken
  2. è¿ç»­å¤„ç†ç›¸åŒä¸“å®¶çš„token
  3. æé«˜GPUç¼“å­˜å‘½ä¸­ç‡
</span></code></pre>
<h5 data-id="heading-61">é€‰å–åŸå› </h5>
<p><strong>1. ç¨€ç–æ€§çš„åŠ›é‡</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">åœ¨æå¤§è§„æ¨¡æ¨¡å‹ä¸­ï¼š
<span class="hljs-bullet">  -</span> æ ‡å‡†æ¨¡å‹æ¯ä¸ªtokenéƒ½è¦ç»è¿‡æ¯ä¸ªå‚æ•° â†’ è®¡ç®—é‡å·¨å¤§
<span class="hljs-bullet">  -</span> MoEè®©æ¯ä¸ªtokenåªç»è¿‡éƒ¨åˆ†å‚æ•° â†’ å¤§å¹…å‡å°‘è®¡ç®—

ä¾‹å­ï¼šGoogle GLaM
<span class="hljs-bullet">  -</span> 1.2 ä¸‡äº¿å‚æ•°çš„MoEæ¨¡å‹
<span class="hljs-bullet">  -</span> è®¡ç®—é‡ä»…ç›¸å½“äº100Bæ ‡å‡†æ¨¡å‹
</code></pre>
<p><strong>2. æ¨¡å‹ç¼©æ”¾çš„æ–°æ–¹å‘</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">å‚æ•°ç¼©æ”¾ï¼šåŸºæœ¬é¥±å’Œï¼ˆ<span class="hljs-number">10</span>Bâ†’<span class="hljs-number">100</span>Bæ•ˆæœé€’å‡ï¼‰

è®¡ç®—ç¼©æ”¾ï¼šæœ‰æ•ˆä½†ä¸å¤Ÿå¿«ï¼ˆè®¡ç®—<span class="hljs-number">4</span>å€â†’æ€§èƒ½ä»…æå‡~<span class="hljs-number">40</span><span class="hljs-comment">%ï¼‰</span>

ç¨€ç–ç¼©æ”¾ï¼ˆMoEï¼‰ï¼šææœ‰æ•ˆï¼ˆè®¡ç®—<span class="hljs-number">4</span>å€â†’æ€§èƒ½æå‡~<span class="hljs-number">60</span><span class="hljs-comment">%ï¼‰â­</span>
             å¯ä»¥ç”¨æ›´å°‘è®¡ç®—å¾—åˆ°æ›´å¼ºæ¨¡å‹
</code></pre>
<p><strong>3. å·¥ä¸šçº§åº”ç”¨çš„å¯è¡Œæ€§</strong></p>
<pre><code class="hljs language-r" lang="r">æœ‰äº†MoEï¼Œæ‰èƒ½åœ¨å®é™…ä¸­è®­ç»ƒ<span class="hljs-operator">/</span>è¿è¡Œæœ€å¼ºå¤§çš„æ¨¡å‹

Switch Transformerï¼š<span class="hljs-number">1.6</span><span class="hljs-built_in">T</span>å‚æ•°ï¼Œä½†æ¿€æ´»å‚æ•°ä»…ç›¸å½“äº<span class="hljs-number">30</span>B
Google<span class="hljs-string">'s Gemini MoEï¼šå‚æ•°å·¨å¤§ï¼Œä½†é«˜æ•ˆå¯ç”¨
</span></code></pre>
<h5 data-id="heading-62">å…±äº«ä¸“å®¶ï¼ˆShared Expertsï¼‰è®¾è®¡</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> config.n_shared_experts <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
    y = y + self.shared_experts(identity)
</code></pre>
<p>ä¸ºä»€ä¹ˆéœ€è¦å…±äº«ä¸“å®¶ï¼Ÿ</p>






























<table><thead><tr><th>ç‰¹æ€§</th><th>çº¯MoE</th><th>å…±äº«+MoE</th></tr></thead><tbody><tr><td><strong>å®¹é‡</strong></td><td>æ‰€æœ‰ä¸“å®¶éƒ½è·¯ç”±</td><td>å…±äº«ä¸“å®¶å§‹ç»ˆæ´»è·ƒ</td></tr><tr><td><strong>ç¨³å®šæ€§</strong></td><td>éœ€è¦å¼ºåˆ¶å‡è¡¡</td><td>è‡ªç„¶æ›´å‡è¡¡</td></tr><tr><td><strong>æ³›åŒ–</strong></td><td>å¯èƒ½è¿‡ä¸“åŒ–</td><td>æ›´ä¸€èˆ¬åŒ–</td></tr><tr><td><strong>è®¡ç®—</strong></td><td>æœ€å°‘</td><td>ç•¥é«˜</td></tr></tbody></table>
<pre><code class="hljs language-markdown" lang="markdown">å…±äº«ä¸“å®¶çš„ä½œç”¨ï¼š
<span class="hljs-bullet">  -</span> æ‰€æœ‰tokenéƒ½ç»è¿‡å…±äº«ä¸“å®¶ â†’ æä¾›åŸºç¡€ç‰¹å¾
<span class="hljs-bullet">  -</span> è·¯ç”±ä¸“å®¶åŸºäºtokençš„ç‰¹æ®Šæ€§ â†’ æä¾›ç‰¹åŒ–ç‰¹å¾
<span class="hljs-bullet">  -</span> åˆå¹¶ï¼šy = y<span class="hljs-emphasis">_routed + y_</span>shared â­

ç±»æ¯”ï¼š
  å…±äº«ä¸“å®¶ â‰ˆ é€šç”¨éª¨æ¶
  è·¯ç”±ä¸“å®¶ â‰ˆ ç‰¹åŒ–æ¨¡å—
</code></pre>
<h5 data-id="heading-63">æ ¸å¿ƒä¼˜åŠ¿æ€»ç»“</h5>
<pre><code class="hljs language-markdown" lang="markdown">æ¨¡å‹å‚æ•°å·¨å¤§ä½†è®¡ç®—ç²¾ç®€
<span class="hljs-code">    â†“
ç¨€ç–æ¿€æ´»çš„åŠ›é‡
    â†“
ç”¨æ›´å°‘è®¡ç®—è¾¾åˆ°æ›´å¼ºæ€§èƒ½
    â†“
å¯ä»¥è®­ç»ƒè¶…å¤§è§„æ¨¡æ¨¡å‹
    â†“
é€‚åˆå®é™…å·¥ä¸šåº”ç”¨
</span></code></pre>
<hr/>
<h3 data-id="heading-64">å‰é¦ˆç½‘ç»œæ¶æ„æ¼”è¿›</h3>
<pre><code class="hljs language-scss" lang="scss">æ—¶ä»£ <span class="hljs-number">1</span> (<span class="hljs-number">2017</span>)ï¼šæ ‡å‡†FFN
  dim â†’ <span class="hljs-number">4</span>*dim â†’ dim
  æ¿€æ´»ï¼šReLU
  å‚æ•°ï¼š<span class="hljs-number">8</span>DÂ²

         â†“ <span class="hljs-selector-attr">[è´¨é‡ç“¶é¢ˆ]</span>

æ—¶ä»£ <span class="hljs-number">2</span> (<span class="hljs-number">2018</span>-<span class="hljs-number">2020</span>)ï¼šGELUæ¿€æ´»å‡½æ•°
  dim â†’ <span class="hljs-number">4</span>*dim â†’ dim
  æ¿€æ´»ï¼šGELU
  å‚æ•°ï¼š<span class="hljs-number">8</span>DÂ²
  è´¨é‡æå‡ï¼š~<span class="hljs-number">15%</span>

         â†“ <span class="hljs-selector-attr">[å®¹é‡ç“¶é¢ˆ]</span>

æ—¶ä»£ <span class="hljs-number">3</span> (<span class="hljs-number">2020</span>-<span class="hljs-number">2022</span>)ï¼šé—¨æ§å’ŒSwiGLU
  dim â†’ <span class="hljs-number">2.67</span>*dim â†’ dim (ä¸¤åˆ†æ”¯)
  æ¿€æ´»ï¼šSiLU + é—¨æ§
  å‚æ•°ï¼š<span class="hljs-number">8</span>DÂ²ï¼ˆä½†æ•ˆæœæ›´å¥½ï¼‰
  è´¨é‡æå‡ï¼š+<span class="hljs-number">3%</span> vs GELU

         â†“ <span class="hljs-selector-attr">[ç¼©æ”¾ç“¶é¢ˆ]</span>

æ—¶ä»£ <span class="hljs-number">4</span> (<span class="hljs-number">2022</span>+)ï¼šMoEæ··åˆä¸“å®¶ â­
  dim â†’ å¤šä¸ªä¸“å®¶ â†’ dim
  æ¿€æ´»ï¼šSwiGLU + ç¨€ç–è·¯ç”±
  å‚æ•°ï¼š<span class="hljs-number">10</span>DÂ² (ä½†æ¿€æ´»ä»…<span class="hljs-number">2</span>/<span class="hljs-number">8</span>)
  è´¨é‡æå‡ï¼š+<span class="hljs-number">60%</span> vs æ ‡å‡†FFNï¼ˆç›¸åŒè®¡ç®—ï¼‰
  å¯æ‰©å±•ï¼šåˆ°æ•°ä¸‡äº¿å‚æ•°
</code></pre>
<hr/>
<h3 data-id="heading-65">ä¸æ ‡å‡†FFNçš„å®Œæ•´å¯¹æ¯”</h3>
<h4 data-id="heading-66">æ ‡å‡†FFN (åŸå§‹Transformer)</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç®€å•çº¿æ€§å˜æ¢</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">StandardFFN</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config</span>):
        self.w1 = nn.Linear(dim, <span class="hljs-number">4</span>*dim)
        self.w2 = nn.Linear(<span class="hljs-number">4</span>*dim, dim)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-keyword">return</span> self.w2(F.relu(self.w1(x)))

æ•ˆæœï¼šåŸºå‡†
è®¡ç®—ï¼šåŸºå‡†
å‚æ•°ï¼š8DÂ²
</code></pre>
<h4 data-id="heading-67">SwiGLU FFN (MiniMindé‡‡ç”¨)</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># é—¨æ§åŒè·¯å¾„è®¾è®¡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">FeedForward</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config</span>):
        self.w1 = nn.Linear(dim, hidden_dim)
        self.w2 = nn.Linear(hidden_dim, dim)
        self.w3 = nn.Linear(dim, hidden_dim)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        <span class="hljs-keyword">return</span> self.w2(F.silu(self.w1(x)) * self.w3(x))

æ•ˆæœï¼š+<span class="hljs-number">3</span>% vs GELU
è®¡ç®—ï¼šä¸­ç­‰
å‚æ•°ï¼š8DÂ²ï¼ˆä½†æ›´é«˜æ•ˆï¼‰
</code></pre>
<h4 data-id="heading-68">MoE FFN (å¯é€‰)</h4>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ç¨€ç–ä¸“å®¶è·¯ç”±</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MOEFeedForward</span>(nn.Module):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, config</span>):
        self.experts = [FeedForward(config) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(num_experts)]
        self.gate = MoEGate(config)
        self.shared_experts = FeedForward(config)

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):
        idx, weight, aux_loss = self.gate(x)  <span class="hljs-comment"># è·¯ç”±</span>
        y = self._route(x, idx, weight)       <span class="hljs-comment"># åˆ†å‘</span>
        y = y + self.shared_experts(x)        <span class="hljs-comment"># å…±äº«</span>
        <span class="hljs-keyword">return</span> y

æ•ˆæœï¼š+<span class="hljs-number">60</span>% vs æ ‡å‡†FFNï¼ˆç›¸åŒè®¡ç®—ï¼‰
è®¡ç®—ï¼šå‡å°‘ <span class="hljs-number">75</span>%ï¼ˆæ¿€æ´»å‚æ•°ï¼‰
å‚æ•°ï¼š10DÂ²ï¼ˆä½†ä»…<span class="hljs-number">2</span>/<span class="hljs-number">8</span>æ´»è·ƒï¼‰
å¯æ‰©å±•ï¼šæœ€å¥½
</code></pre>
<hr/>
<h3 data-id="heading-69">å¯¹æ ‡åŸå§‹GPTè®ºæ–‡çš„æ”¹è¿›</h3>
<p>åŸå§‹GPTè®ºæ–‡ä¸­çš„FFNï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-string">"We employed a position-wise feed-forward network
which consists of two linear transformations with a
ReLU activation in between."</span>

<span class="hljs-keyword">dim</span> â†’ <span class="hljs-number">4</span>*<span class="hljs-keyword">dim</span> â†’ <span class="hljs-keyword">dim</span> <span class="hljs-keyword">with</span> ReLU
</code></pre>
<p>MiniMindçš„æ”¹è¿›ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> æ¿€æ´»å‡½æ•°å‡çº§ï¼šReLU â†’ GELU â†’ SwiGLU
   è´¨é‡æå‡ï¼š+30% (ç›¸åŒå‚æ•°)

<span class="hljs-bullet">2.</span> æ™ºèƒ½é—¨æ§ï¼šæ·»åŠ ç¬¬ä¸‰ä¸ªæŠ•å½± (W3)
   å‚æ•°ç›¸åŒï¼Œè¡¨è¾¾åŠ›å¤§å¹…æå‡

<span class="hljs-bullet">3.</span> å¯é€‰ç¨€ç–åŒ–ï¼šæ ‡å‡†FFN â†’ MoE
   è®¡ç®—å‡å°‘ï¼š75%ï¼ˆæ¨ç†ï¼‰
   æ€§èƒ½ï¼š+60%ï¼ˆç›¸åŒè®¡ç®—ï¼‰
</code></pre>
<hr/>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>ä¼˜åŒ–æŠ€æœ¯</strong> (å‚æ•°å…±äº«, ç”Ÿæˆé‡‡æ ·ç­–ç•¥)</li>
<li class="task-list-item"><input type="checkbox" disabled="disabled"/> <strong>å®Œæ•´æ€»ç»“</strong> (æ‰€æœ‰æŠ€æœ¯ç»¼åˆè¯„åˆ†)</li>
</ul>
<h2 data-id="heading-70">MiniMind ä¼˜åŒ–æŠ€æœ¯è¯¦è§£</h2>
<h3 data-id="heading-71">ä¸‰ã€ä¼˜åŒ–æŠ€æœ¯</h3>
<h4 data-id="heading-72">1. å‚æ•°å…±äº«ï¼ˆWeight Tyingï¼‰</h4>
<h5 data-id="heading-73">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:562-578</code></p>
<h5 data-id="heading-74">å®ç°åŸç†</h5>
<p><strong>åˆå§‹åŒ–é˜¶æ®µ</strong> (model.py:562-578)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MiniMindLM</span>(<span class="hljs-title class_ inherited__">PreTrainedModel</span>):
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, params: LMConfig = <span class="hljs-literal">None</span></span>):
        <span class="hljs-comment"># ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...</span>

        <span class="hljs-comment"># è¯å…ƒåµŒå…¥å±‚ï¼šå°†token IDæ˜ å°„ä¸ºå‘é‡è¡¨ç¤º</span>
        self.tok_embeddings = nn.Embedding(params.vocab_size, params.dim)

        <span class="hljs-comment"># è¾“å‡ºå±‚ï¼šå°†éšè—çŠ¶æ€æ˜ å°„ä¸ºè¯æ±‡è¡¨å¤§å°çš„logits</span>
        self.output = nn.Linear(params.dim, params.vocab_size, bias=<span class="hljs-literal">False</span>)

        <span class="hljs-comment"># â­ å…³é”®ï¼šå‚æ•°å…±äº«</span>
        <span class="hljs-comment"># è®©è¾“å‡ºå±‚çš„æƒé‡ä¸åµŒå…¥å±‚æƒé‡æŒ‡å‘åŒä¸€ä¸ªå‚æ•°å¼ é‡</span>
        self.tok_embeddings.weight = self.output.weight
</code></pre>
<h5 data-id="heading-75">æ•°å­¦åŸç†</h5>
<pre><code class="hljs language-r" lang="r">æ ‡å‡†æ–¹å¼ï¼š
  åµŒå…¥çŸ©é˜µï¼šW_emb <span class="hljs-punctuation">[</span>vocab_size<span class="hljs-punctuation">,</span> <span class="hljs-built_in">dim</span><span class="hljs-punctuation">]</span>
  è¾“å‡ºçŸ©é˜µï¼šW_out <span class="hljs-punctuation">[</span><span class="hljs-built_in">dim</span><span class="hljs-punctuation">,</span> vocab_size<span class="hljs-punctuation">]</span>
  æ€»å‚æ•°ï¼švocab_size <span class="hljs-operator">*</span> <span class="hljs-built_in">dim</span> <span class="hljs-operator">*</span> <span class="hljs-number">2</span>

å‚æ•°å…±äº«ï¼š
  å…±äº«çŸ©é˜µï¼šW <span class="hljs-punctuation">[</span>vocab_size<span class="hljs-punctuation">,</span> <span class="hljs-built_in">dim</span><span class="hljs-punctuation">]</span>
  åµŒå…¥ï¼štoken_id â†’ W<span class="hljs-punctuation">[</span>token_id<span class="hljs-punctuation">,</span> <span class="hljs-operator">:</span><span class="hljs-punctuation">]</span> âˆˆ â„<span class="hljs-operator">^</span><span class="hljs-built_in">dim</span>
  è¾“å‡ºï¼šh âˆˆ â„<span class="hljs-operator">^</span><span class="hljs-built_in">dim</span> â†’ h <span class="hljs-operator">@</span> W<span class="hljs-operator">^</span><span class="hljs-built_in">T</span> âˆˆ â„<span class="hljs-operator">^</span>vocab_size
  æ€»å‚æ•°ï¼švocab_size <span class="hljs-operator">*</span> <span class="hljs-built_in">dim</span>ï¼ˆå‡å°‘<span class="hljs-number">50</span>%ï¼ï¼‰
</code></pre>
<h5 data-id="heading-76">å‰å‘è®¡ç®—å¯¹æ¯”</h5>
<p><strong>æ ‡å‡†æ–¹å¼</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åµŒå…¥é˜¶æ®µ</span>
h = embedding_matrix[input_ids]  <span class="hljs-comment"># [B, S, dim]</span>

<span class="hljs-comment"># è¾“å‡ºé˜¶æ®µ</span>
logits = h @ output_matrix       <span class="hljs-comment"># [B, S, vocab_size]</span>
</code></pre>
<p><strong>å‚æ•°å…±äº«</strong>ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># åµŒå…¥å’Œè¾“å‡ºå…±ç”¨åŒä¸€ä¸ªçŸ©é˜µW [vocab_size, dim]</span>

<span class="hljs-comment"># åµŒå…¥é˜¶æ®µ</span>
h = W[input_ids, :]              <span class="hljs-comment"># [B, S, dim]</span>

<span class="hljs-comment"># è¾“å‡ºé˜¶æ®µï¼ˆWæ˜¯åµŒå…¥å±‚æƒé‡çš„å¼•ç”¨ï¼‰</span>
logits = h @ W.T                 <span class="hljs-comment"># [B, S, vocab_size]</span>
</code></pre>
<h5 data-id="heading-77">å½±å“åˆ†æ</h5>








































<table><thead><tr><th>æ–¹é¢</th><th>æ ‡å‡†æ–¹å¼</th><th>å‚æ•°å…±äº«</th></tr></thead><tbody><tr><td><strong>å‚æ•°æ•°é‡</strong></td><td>vocab_size Ã— dim Ã— 2</td><td>vocab_size Ã— dim â­</td></tr><tr><td><strong>å‚æ•°å‡å°‘</strong></td><td>åŸºå‡†</td><td><strong>50%</strong></td></tr><tr><td><strong>æ˜¾å­˜å ç”¨</strong></td><td>åŸºå‡†</td><td><strong>å‡å°‘ 50%</strong></td></tr><tr><td><strong>è®¡ç®—é‡</strong></td><td>åŸºå‡†</td><td>ç›¸åŒ</td></tr><tr><td><strong>ç²¾åº¦</strong></td><td>åŸºå‡†</td><td>ç›¸åŒ</td></tr><tr><td><strong>è®­ç»ƒç¨³å®šæ€§</strong></td><td>åŸºå‡†</td><td>ç¨å·®ï¼ˆä½†å¯æ¥å—ï¼‰</td></tr></tbody></table>
<h5 data-id="heading-78">å‚æ•°é‡ä¼°ç®—ç¤ºä¾‹</h5>
<p>ä»¥Llama-7Bä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Vocabulary size: 32,000
Hidden dimension: 4,096

æ ‡å‡†æ–¹å¼ï¼š
  åµŒå…¥å‚æ•°ï¼š32,000 Ã— 4,<span class="hljs-attr">096</span> = <span class="hljs-number">131.1</span>M
  è¾“å‡ºå‚æ•°ï¼š4,096 Ã— 32,<span class="hljs-attr">000</span> = <span class="hljs-number">131.1</span>M
  æ€»è®¡ï¼š262.2M å‚æ•°ï¼ˆå æ¨¡å‹çº¦3.8%ï¼‰

å‚æ•°å…±äº«ï¼š
  å…±äº«å‚æ•°ï¼š32,000 Ã— 4,<span class="hljs-attr">096</span> = <span class="hljs-number">131.1</span>M
  æ€»è®¡ï¼š131.1M å‚æ•°ï¼ˆå‡å°‘ 50%ï¼‰

èŠ‚çœæ˜¾å­˜ï¼š
  32-bit: 262.2M Ã— <span class="hljs-attr">4B</span> = <span class="hljs-number">1.05</span>GB
  åŠç²¾åº¦: 262.2M Ã— <span class="hljs-attr">2B</span> = <span class="hljs-number">0.52</span>GB
</code></pre>
<h5 data-id="heading-79">é€‰å–åŸå› </h5>
<p><strong>1. åµŒå…¥å’Œè¾“å‡ºçš„å¯¹ç§°æ€§</strong></p>
<pre><code class="hljs">è¯­è¨€æ¨¡å‹çš„æœ¬è´¨æ˜¯ï¼štokenç¼–ç  â†’ ä¸­é—´è¡¨ç¤º â†’ tokenè§£ç 

åµŒå…¥å±‚ï¼štoken_id â†’ å‘é‡
è¾“å‡ºå±‚ï¼šå‘é‡ â†’ token_id

è¿™ä¸¤ä¸ªæ“ä½œåœ¨æ•°å­¦ä¸Šåº”è¯¥äº’ä¸ºè½¬ç½®å…³ç³»ï¼
</code></pre>
<p><strong>è¯­è¨€æ¨¡å‹å‡è®¾</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">ä¸€ä¸ªtokençš„åµŒå…¥å‘é‡åº”è¯¥ä¸è¾“å‡ºæ—¶çš„å¾—åˆ†å‘é‡ç›¸è¿‘

å³ï¼š
  token <span class="hljs-selector-tag">i</span> çš„åµŒå…¥å‘é‡ â‰ˆ æ¨¡å‹é¢„æµ‹token <span class="hljs-selector-tag">i</span>æ—¶çš„æƒé‡å‘é‡

å¦‚æœä½¿ç”¨åŒä¸€ä¸ªçŸ©é˜µï¼Œè¿™ä¸ªå…³ç³»ä¼šæ›´å¼ºï¼
</code></pre>
<p><strong>2. å‚æ•°é«˜æ•ˆæ€§</strong></p>
<pre><code class="hljs language-erlang" lang="erlang">æ¨¡å‹çš„æ˜¾å­˜ç“¶é¢ˆï¼š
  æ€»å‚æ•°æ•° = n_layers Ã— (æ³¨æ„åŠ›å‚æ•° + FFNå‚æ•°) + åµŒå…¥+è¾“å‡º

å¯¹äºå¤§è¯æ±‡è¡¨æ¨¡å‹ï¼ˆå¦‚ä¸­æ–‡ï¼Œè¯æ±‡è¡¨&gt;<span class="hljs-number">50</span>Kï¼‰ï¼š
  åµŒå…¥+è¾“å‡ºå¯å æ€»å‚æ•°çš„ <span class="hljs-number">3</span>-<span class="hljs-number">10</span><span class="hljs-comment">%</span>
  å‚æ•°å…±äº«å¯èŠ‚çœ <span class="hljs-number">1.5</span>-<span class="hljs-number">5</span><span class="hljs-comment">% çš„æ€»å‚æ•°é‡</span>
</code></pre>
<p><strong>3. ç°ä»£LLMæ ‡å‡†</strong></p>
<pre><code class="hljs">BERTï¼šâœ… ä½¿ç”¨å‚æ•°å…±äº«
GPTï¼šâœ… ä½¿ç”¨å‚æ•°å…±äº«
ALBERTï¼šâœ… è®¾è®¡çš„æ ¸å¿ƒç‰¹æ€§
LLaMAï¼šâœ… ä½¿ç”¨å‚æ•°å…±äº«
T5ï¼šâœ… ä½¿ç”¨å‚æ•°å…±äº«
</code></pre>
<h5 data-id="heading-80">æ½œåœ¨çš„ç¼ºç‚¹ä¸åº”å¯¹</h5>
<p><strong>ç¼ºç‚¹ 1ï¼šåµŒå…¥å’Œè¾“å‡ºå­¦ä¹ ç›®æ ‡ä¸åŒ</strong></p>
<pre><code class="hljs">åµŒå…¥éœ€è¦ç¼–ç ï¼štokençš„è¯­ä¹‰ã€è¯­æ³•ä¿¡æ¯
è¾“å‡ºéœ€è¦åˆ¤åˆ«ï¼šä¸åŒtokençš„åŒºåˆ«

å¼ºåˆ¶ä½¿ç”¨åŒä¸€ä¸ªçŸ©é˜µå¯èƒ½å¼•å…¥å†²çª
</code></pre>
<p>åº”å¯¹ï¼š<strong>éšå±‚å˜æ¢</strong></p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># ä½¿ç”¨ä¸€ä¸ªé¢å¤–çš„çº¿æ€§å±‚è§£è€¦</span>
self.output = nn.Linear(params.dim, params.vocab_size, bias=<span class="hljs-literal">False</span>)
<span class="hljs-comment"># ä½†ä¸å†ä½¿ç”¨å…±äº«æƒé‡</span>
<span class="hljs-comment"># è€Œæ˜¯ä½¿ç”¨æŠ•å½±å±‚è¿›è¡Œå˜æ¢</span>
</code></pre>
<p><strong>ç¼ºç‚¹ 2ï¼šè¯æ±‡è¡¨å¢é•¿æ—¶é—®é¢˜</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">å¦‚æœéœ€è¦æ‰©å±•è¯æ±‡è¡¨ï¼ˆå¦‚æ·»åŠ æ–°è¯­è¨€tokenï¼‰ï¼š
<span class="hljs-bullet">  -</span> åµŒå…¥çŸ©é˜µéœ€è¦æ‰©å±•ï¼š[vocab<span class="hljs-emphasis">_size_</span>old, dim] â†’ [vocab<span class="hljs-emphasis">_size_</span>new, dim]
<span class="hljs-bullet">  -</span> è¾“å‡ºçŸ©é˜µä¹Ÿéœ€è¦æ‰©å±•
<span class="hljs-bullet">  -</span> å¦‚æœå‚æ•°å…±äº«ï¼ŒåµŒå…¥å’Œè¾“å‡ºåŒæ—¶æ‰©å±•ï¼ˆæ²¡é—®é¢˜ï¼‰
</code></pre>
<h5 data-id="heading-81">ä»£ç å®ç°è¦ç‚¹</h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># æ­£ç¡®çš„å‚æ•°å…±äº«æ–¹å¼</span>
self.tok_embeddings = nn.Embedding(params.vocab_size, params.dim)
self.output = nn.Linear(params.dim, params.vocab_size, bias=<span class="hljs-literal">False</span>)

<span class="hljs-comment"># å…³é”®ï¼šä½¿åµŒå…¥å±‚æƒé‡å’Œè¾“å‡ºå±‚æƒé‡æŒ‡å‘åŒä¸€ä¸ªå‚æ•°</span>
self.tok_embeddings.weight = self.output.weight

<span class="hljs-comment"># ä¸ºä»€ä¹ˆè¿™æ ·åšæœ‰æ•ˆï¼Ÿ</span>
<span class="hljs-comment"># 1. åµŒå…¥ï¼štoken_id â†’ self.tok_embeddings.weight[token_id]</span>
<span class="hljs-comment"># 2. è¾“å‡ºï¼šhidden â†’ hidden @ self.output.weight.T</span>
<span class="hljs-comment">#        = hidden @ self.tok_embeddings.weight.T</span>
</code></pre>
<h5 data-id="heading-82">æ ¸å¿ƒä¼˜åŠ¿</h5>
<pre><code class="hljs language-erlang" lang="erlang">å‚æ•°å‡å°‘ <span class="hljs-number">50</span><span class="hljs-comment">%ï¼ˆåµŒå…¥+è¾“å‡ºï¼‰</span>
    â†“
æ˜¾å­˜èŠ‚çœ <span class="hljs-number">1</span>-<span class="hljs-number">3</span><span class="hljs-comment">%ï¼ˆæ€»æ¨¡å‹ï¼‰</span>
    â†“
è®­ç»ƒé€Ÿåº¦ç¨å¿«
    â†“
å¯¹é½åµŒå…¥å’Œè¾“å‡ºçš„å­¦ä¹ ç›®æ ‡
    â†“
æˆæœ¬æ”¶ç›Šæ¯”æé«˜
</code></pre>
<hr/>
<h4 data-id="heading-83">2. ç”Ÿæˆé‡‡æ ·ç­–ç•¥</h4>
<h5 data-id="heading-84">ä»£ç ä½ç½®</h5>
<p><code>model/model.py:710-773</code></p>
<h5 data-id="heading-85">å®ç°åŸç†</h5>
<p><strong>æµå¼ç”Ÿæˆçš„å®Œæ•´æµç¨‹</strong> (model.py:710-773)ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">_stream</span>(<span class="hljs-params">self, input_ids, eos_token_id, max_new_tokens,
            temperature, top_p, rp, use_cache, **args</span>):
    <span class="hljs-string">"""
    é€tokenç”Ÿæˆçš„æµå¼é‡‡æ ·å‡½æ•°
    """</span>
    start, first_seq, past_kvs = input_ids.shape[<span class="hljs-number">1</span>], <span class="hljs-literal">True</span>, <span class="hljs-literal">None</span>

    <span class="hljs-keyword">while</span> input_ids.shape[<span class="hljs-number">1</span>] &lt; max_new_tokens - <span class="hljs-number">1</span>:
        <span class="hljs-comment"># æ¨ç†ï¼šè·å–logits</span>
        <span class="hljs-keyword">if</span> first_seq <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> use_cache:
            out = self(input_ids, past_key_values=past_kvs, use_cache=use_cache)
        <span class="hljs-keyword">else</span>:
            out = self(input_ids[:, -<span class="hljs-number">1</span>:], past_key_values=past_kvs,
                      use_cache=use_cache, start_pos=input_ids.shape[<span class="hljs-number">1</span>] - <span class="hljs-number">1</span>)

        logits, past_kvs = out.logits[:, -<span class="hljs-number">1</span>, :], out.past_key_values

        <span class="hljs-comment"># â­ ç­–ç•¥ 1ï¼šé‡å¤æƒ©ç½šï¼ˆRepetition Penaltyï¼‰</span>
        logits[:, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(input_ids.tolist()[<span class="hljs-number">0</span>]))] /= rp

        <span class="hljs-comment"># â­ ç­–ç•¥ 2ï¼šæ¸©åº¦ç¼©æ”¾ï¼ˆTemperature Scalingï¼‰</span>
        logits /= (temperature + <span class="hljs-number">1e-9</span>)

        <span class="hljs-comment"># â­ ç­–ç•¥ 3ï¼šæ ¸é‡‡æ ·ï¼ˆTop-p/Nucleus Samplingï¼‰</span>
        <span class="hljs-keyword">if</span> top_p <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> top_p &lt; <span class="hljs-number">1.0</span>:
            sorted_logits, sorted_indices = torch.sort(logits, descending=<span class="hljs-literal">True</span>, dim=-<span class="hljs-number">1</span>)
            sorted_probs = F.softmax(sorted_logits, dim=-<span class="hljs-number">1</span>)
            cumulative_probs = torch.cumsum(sorted_probs, dim=-<span class="hljs-number">1</span>)

            <span class="hljs-comment"># æ‰¾å‡ºè¶…è¿‡thresholdçš„ä½ç½®</span>
            sorted_indices_to_remove = cumulative_probs &gt; top_p
            sorted_indices_to_remove[:, <span class="hljs-number">1</span>:] = sorted_indices_to_remove[:, :-<span class="hljs-number">1</span>].clone()
            sorted_indices_to_remove[:, <span class="hljs-number">0</span>] = <span class="hljs-literal">False</span>

            indices_to_remove = sorted_indices_to_remove.scatter(<span class="hljs-number">1</span>, sorted_indices,
                                                                  sorted_indices_to_remove)
            logits[indices_to_remove] = -<span class="hljs-built_in">float</span>(<span class="hljs-string">'Inf'</span>)

        <span class="hljs-comment"># â­ ç­–ç•¥ 4ï¼šå¤šé¡¹å¼é‡‡æ ·ï¼ˆMultinomial Samplingï¼‰</span>
        input_ids_next = torch.multinomial(F.softmax(logits, dim=-<span class="hljs-number">1</span>), num_samples=<span class="hljs-number">1</span>)
        input_ids = torch.cat((input_ids, input_ids_next), dim=<span class="hljs-number">1</span>)

        <span class="hljs-keyword">yield</span> input_ids[:, start:]

        <span class="hljs-keyword">if</span> input_ids_next.item() == eos_token_id:
            <span class="hljs-keyword">break</span>
</code></pre>
<h5 data-id="heading-86">å››å¤§é‡‡æ ·ç­–ç•¥è¯¦è§£</h5>
<p><strong>ç­–ç•¥ 1ï¼šé‡å¤æƒ©ç½šï¼ˆRepetition Penaltyï¼‰</strong> [model.py:742]</p>
<pre><code class="hljs language-python" lang="python">logits[:, <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(input_ids.tolist()[<span class="hljs-number">0</span>]))] /= rp
</code></pre>
<p><strong>ç›®çš„</strong>ï¼šé¿å…ç”Ÿæˆé‡å¤æ–‡æœ¬</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">å·²ç”Ÿæˆçš„tokenï¼š<span class="hljs-section">[æˆ‘, æ˜¯, ä¸€, ä¸ª, AI]</span>

é‡å¤æƒ©ç½šï¼ˆ<span class="hljs-attr">rp</span> = <span class="hljs-number">1.2</span>ï¼‰ï¼š
  å¯¹å·²ç»å‡ºç°è¿‡çš„tokenï¼Œé™ä½å…¶logitå€¼
  logit<span class="hljs-section">[æˆ‘]</span> = logit<span class="hljs-section">[æˆ‘]</span> / 1.2
  logit<span class="hljs-section">[æ˜¯]</span> = logit<span class="hljs-section">[æ˜¯]</span> / 1.2
  ...

æ•ˆæœï¼š
  è¿™äº›tokenè¢«é€‰ä¸­çš„æ¦‚ç‡ä¸‹é™
  â†’ æ–°çš„tokenè¢«é€‰ä¸­çš„æ¦‚ç‡ä¸Šå‡
  â†’ é¿å…"æˆ‘æˆ‘æˆ‘"æˆ–"æ˜¯æ˜¯æ˜¯"
</code></pre>
<p><strong>å‚æ•°è¯´æ˜</strong>ï¼š</p>
<ul>
<li><code>rp = 1.0</code>ï¼šæ— æƒ©ç½šï¼ˆå…è®¸é‡å¤ï¼‰</li>
<li><code>rp = 1.2</code>ï¼šè½»åº¦æƒ©ç½šï¼ˆæ¨èï¼‰</li>
<li><code>rp = 2.0</code>ï¼šå¼ºåº¦æƒ©ç½šï¼ˆå¯èƒ½å¤±å»å¿…è¦çš„é‡å¤ï¼‰</li>
</ul>






























<table><thead><tr><th>å€¼</th><th>æ•ˆæœ</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>1.0</td><td>å…è®¸é‡å¤</td><td>åˆ—è¡¨ã€æšä¸¾</td></tr><tr><td>1.2</td><td><strong>è½»åº¦é™åˆ¶</strong></td><td><strong>é€šç”¨å¯¹è¯</strong> â­</td></tr><tr><td>1.5</td><td>ä¸­ç­‰é™åˆ¶</td><td>åˆ›æ„å†™ä½œ</td></tr><tr><td>2.0+</td><td>ä¸¥æ ¼ç¦æ­¢</td><td>å¤šæ ·æ€§è¦æ±‚é«˜</td></tr></tbody></table>
<hr/>
<p><strong>ç­–ç•¥ 2ï¼šæ¸©åº¦ç¼©æ”¾ï¼ˆTemperature Scalingï¼‰</strong> [model.py:744]</p>
<pre><code class="hljs language-python" lang="python">logits /= (temperature + <span class="hljs-number">1e-9</span>)
</code></pre>
<p><strong>ç›®çš„</strong>ï¼šæ§åˆ¶ç”Ÿæˆçš„éšæœºæ€§/ç¡®å®šæ€§ç¨‹åº¦</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Softmax æ¦‚ç‡è®¡ç®—ï¼š
  <span class="hljs-selector-tag">P</span>(token_i) = <span class="hljs-built_in">exp</span>(logits_i / temperature) / Î£ <span class="hljs-built_in">exp</span>(logits_j / temperature)

temperature = <span class="hljs-number">0.1</span>ï¼ˆä½æ¸©ï¼‰ï¼š
  <span class="hljs-built_in">exp</span>(logits_i / <span class="hljs-number">0.1</span>) æ”¾å¤§äº†logitsçš„å·®å¼‚
  â†’ åˆ†å¸ƒå°–é”ï¼Œæ¦‚ç‡é«˜çš„tokenæ›´å®¹æ˜“è¢«é€‰ä¸­
  â†’ ç”Ÿæˆç»“æœç¡®å®šã€è¿è´¯

temperature = <span class="hljs-number">1.0</span>ï¼ˆå¸¸æ¸©ï¼‰ï¼š
  æ ‡å‡† softmax
  â†’ å¹³è¡¡çš„éšæœºæ€§

temperature = <span class="hljs-number">2.0</span>ï¼ˆé«˜æ¸©ï¼‰ï¼š
  <span class="hljs-built_in">exp</span>(logits_i / <span class="hljs-number">2.0</span>) ç¼©å°äº†logitsçš„å·®å¼‚
  â†’ åˆ†å¸ƒå¹³å¦ï¼Œæ‰€æœ‰tokenæ¦‚ç‡æ¥è¿‘
  â†’ ç”Ÿæˆç»“æœéšæ„ã€å¤šæ ·
</code></pre>
<p><strong>å¯è§†åŒ–</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Logits: <span class="hljs-section">[2.0, 1.0, 0.5]</span>

<span class="hljs-attr">Temperature</span> = <span class="hljs-number">0.1</span> (ç¡®å®šæ¨¡å¼):
  <span class="hljs-attr">P</span> = softmax([<span class="hljs-number">20</span>, <span class="hljs-number">10</span>, <span class="hljs-number">5</span>]) â‰ˆ [<span class="hljs-number">0.999</span>, <span class="hljs-number">0.001</span>, <span class="hljs-number">0.0</span>]
  â†“ é«˜æ¦‚ç‡tokenå‡ ä¹å¿…ä¸­

<span class="hljs-attr">Temperature</span> = <span class="hljs-number">1.0</span> (å¹³è¡¡æ¨¡å¼):
  <span class="hljs-attr">P</span> = softmax([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0.5</span>]) â‰ˆ [<span class="hljs-number">0.659</span>, <span class="hljs-number">0.242</span>, <span class="hljs-number">0.099</span>]
  â†“ ä¿ç•™ä¸€å®šçš„éšæœºæ€§

<span class="hljs-attr">Temperature</span> = <span class="hljs-number">2.0</span> (éšæœºæ¨¡å¼):
  <span class="hljs-attr">P</span> = softmax([<span class="hljs-number">1</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.25</span>]) â‰ˆ [<span class="hljs-number">0.409</span>, <span class="hljs-number">0.326</span>, <span class="hljs-number">0.265</span>]
  â†“ æ‰€æœ‰tokenæ¦‚ç‡æ¥è¿‘ï¼Œé«˜åº¦éšæ„
</code></pre>






























<table><thead><tr><th>æ¸©åº¦</th><th>è¡Œä¸º</th><th>ä½¿ç”¨åœºæ™¯</th></tr></thead><tbody><tr><td>0.1-0.5</td><td>ç¡®å®šã€ä¿å®ˆ</td><td>ä»£ç ã€æ•°æ®ã€äº‹å®é—®ç­”</td></tr><tr><td>0.7-0.8</td><td><strong>å¹³è¡¡</strong></td><td><strong>é€šç”¨å¯¹è¯</strong> â­</td></tr><tr><td>1.0-1.5</td><td>åˆ›æ„ã€å¤šæ ·</td><td>æ•…äº‹åˆ›ä½œã€è¯—æ­Œ</td></tr><tr><td>2.0+</td><td>æåº¦éšæ„</td><td>æ•°æ®å¢å¼ºã€æ¢ç´¢</td></tr></tbody></table>
<hr/>
<p><strong>ç­–ç•¥ 3ï¼šæ ¸é‡‡æ ·ï¼ˆTop-p/Nucleus Samplingï¼‰</strong> [model.py:747-763]</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">if</span> top_p <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span> <span class="hljs-keyword">and</span> top_p &lt; <span class="hljs-number">1.0</span>:
    sorted_logits, sorted_indices = torch.sort(logits, descending=<span class="hljs-literal">True</span>, dim=-<span class="hljs-number">1</span>)
    sorted_probs = F.softmax(sorted_logits, dim=-<span class="hljs-number">1</span>)
    cumulative_probs = torch.cumsum(sorted_probs, dim=-<span class="hljs-number">1</span>)

    sorted_indices_to_remove = cumulative_probs &gt; top_p
    sorted_indices_to_remove[:, <span class="hljs-number">1</span>:] = sorted_indices_to_remove[:, :-<span class="hljs-number">1</span>].clone()
    sorted_indices_to_remove[:, <span class="hljs-number">0</span>] = <span class="hljs-literal">False</span>

    indices_to_remove = sorted_indices_to_remove.scatter(<span class="hljs-number">1</span>, sorted_indices,
                                                          sorted_indices_to_remove)
    logits[indices_to_remove] = -<span class="hljs-built_in">float</span>(<span class="hljs-string">'Inf'</span>)
</code></pre>
<p><strong>ç›®çš„</strong>ï¼šåŠ¨æ€é€‰æ‹©å€™é€‰tokené›†åˆï¼Œé¿å…é€‰æ‹©ä½æ¦‚ç‡token</p>
<p><strong>å·¥ä½œåŸç†</strong>ï¼ˆç¤ºä¾‹ï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">æ¦‚ç‡åˆ†å¸ƒï¼ˆå·²æ’åºï¼‰ï¼š
  P(token_A) = 0.50 â†’ ç´¯ç§¯: 0.50 âœ… ä¿ç•™
  P(token_B) = 0.25 â†’ ç´¯ç§¯: 0.75 âœ… ä¿ç•™
  P(token_C) = 0.15 â†’ ç´¯ç§¯: 0.90 âœ… ä¿ç•™
  P(token_D) = 0.08 â†’ ç´¯ç§¯: 0.98 âŒ ç§»é™¤ï¼ˆè¶…è¿‡<span class="hljs-attr">top_p</span>=<span class="hljs-number">0.9</span>ï¼‰
  P(token_E) = 0.02 â†’ ç´¯ç§¯: 1.00 âŒ ç§»é™¤

Top-pé‡‡æ ·ï¼šä»<span class="hljs-section">[A, B, C]</span>ä¸­éšæœºé€‰æ‹©
          P(A|selected) = 0.50/<span class="hljs-attr">0.90</span> = <span class="hljs-number">0.556</span>
          P(B|selected) = 0.25/<span class="hljs-attr">0.90</span> = <span class="hljs-number">0.278</span>
          P(C|selected) = 0.15/<span class="hljs-attr">0.90</span> = <span class="hljs-number">0.167</span>
</code></pre>
<p><strong>ä¸Top-kçš„å¯¹æ¯”</strong>ï¼š</p>



































<table><thead><tr><th>ç‰¹æ€§</th><th>Top-ké‡‡æ ·</th><th>Top-pé‡‡æ ·</th></tr></thead><tbody><tr><td><strong>åŸç†</strong></td><td>ä¿ç•™æ¦‚ç‡æœ€é«˜çš„kä¸ªtoken</td><td>ä¿ç•™ç´¯ç§¯æ¦‚ç‡è¾¾pçš„token</td></tr><tr><td><strong>å€™é€‰æ•°</strong></td><td>å›ºå®šk</td><td>åŠ¨æ€ï¼ˆå–å†³äºåˆ†å¸ƒï¼‰</td></tr><tr><td><strong>ä½ç½®ä¿¡åº¦æƒ…å†µ</strong></td><td>å¯èƒ½åŒ…å«ä½åˆ†token</td><td>è‡ªåŠ¨è¿‡æ»¤</td></tr><tr><td><strong>é«˜ç½®ä¿¡åº¦æƒ…å†µ</strong></td><td>å¯èƒ½è¿‡åº¦é™åˆ¶</td><td>è‡ªåŠ¨æ”¾æ¾</td></tr><tr><td><strong>æ¨èå€¼</strong></td><td>k=50</td><td><strong>p=0.9</strong> â­</td></tr></tbody></table>
<p><strong>å·¥ä½œåœºæ™¯å¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-css" lang="css">é«˜ç½®ä¿¡æƒ…å†µï¼ˆæ¨¡å‹å¾ˆç¡®å®šç­”æ¡ˆï¼‰ï¼š
  <span class="hljs-attribute">Top</span>-k (k=<span class="hljs-number">50</span>)ï¼šå¼ºåˆ¶é€‰æ‹©<span class="hljs-number">50</span>ä¸ªtoken
               å¯èƒ½åŒ…å«ä¸ç›¸å…³çš„token

  <span class="hljs-attribute">Top</span>-<span class="hljs-selector-tag">p</span> (<span class="hljs-selector-tag">p</span>=<span class="hljs-number">0.9</span>)ï¼šå¯èƒ½åªéœ€<span class="hljs-number">5</span>ä¸ªtokenå°±è¾¾åˆ°<span class="hljs-number">0.9</span>
                è‡ªåŠ¨ç¼©å°å€™é€‰é›†
                æ›´ä¼˜ï¼âœ…

ä½ç½®ä¿¡æƒ…å†µï¼ˆæ¨¡å‹ä¸ç¡®å®šç­”æ¡ˆï¼‰ï¼š
  <span class="hljs-attribute">Top</span>-k (k=<span class="hljs-number">50</span>)ï¼šä¿ç•™<span class="hljs-number">50</span>ä¸ªtoken
               å¯èƒ½åŒ…å«å¾ˆä½åˆ†çš„

  <span class="hljs-attribute">Top</span>-<span class="hljs-selector-tag">p</span> (<span class="hljs-selector-tag">p</span>=<span class="hljs-number">0.9</span>)ï¼šéœ€è¦<span class="hljs-number">50</span>ä¸ªtokenæ‰èƒ½è¾¾åˆ°<span class="hljs-number">0.9</span>
                è‡ªåŠ¨æ”¾æ¾é™åˆ¶
                æ›´ä¼˜ï¼âœ…
</code></pre>
<hr/>
<p><strong>ç­–ç•¥ 4ï¼šå¤šé¡¹å¼é‡‡æ ·ï¼ˆMultinomial Samplingï¼‰</strong> [model.py:766]</p>
<pre><code class="hljs language-python" lang="python">input_ids_next = torch.multinomial(F.softmax(logits, dim=-<span class="hljs-number">1</span>), num_samples=<span class="hljs-number">1</span>)
</code></pre>
<p><strong>ç›®çš„</strong>ï¼šæŒ‰æ¦‚ç‡åˆ†å¸ƒéšæœºé‡‡æ ·ä¸‹ä¸€ä¸ªtoken</p>
<p><strong>ä¸è´ªå¿ƒè§£ç çš„å¯¹æ¯”</strong>ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">è´ªå¿ƒè§£ç ï¼ˆGreedy Decodingï¼‰ï¼š
  selected_token = <span class="hljs-built_in">argmax</span>(logits)
  â†“ æ€»æ˜¯é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„token
  â†“ ç¡®å®šä½†å¯èƒ½é™·å…¥å±€éƒ¨æœ€ä¼˜

å¤šé¡¹å¼é‡‡æ ·ï¼ˆMultinomial Samplingï¼‰ï¼š
  <span class="hljs-selector-tag">P</span>(token_i) âˆ <span class="hljs-built_in">exp</span>(logits_i)
  selected_token ~ <span class="hljs-built_in">Multinomial</span>(P)
  â†“ æŒ‰æ¦‚ç‡éšæœºé€‰æ‹©
  â†“ ä¿ç•™ä¸€å®šéšæœºæ€§ï¼Œå‘ç°æ›´å¤šå¯èƒ½æ€§
</code></pre>
<p><strong>æ¦‚ç‡ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">logits</span> = [<span class="hljs-number">2.0</span>, <span class="hljs-number">1.5</span>, <span class="hljs-number">0.5</span>]
<span class="hljs-attr">P</span> = softmax(logits) = [<span class="hljs-number">0.659</span>, <span class="hljs-number">0.242</span>, <span class="hljs-number">0.099</span>]

å¤šé¡¹å¼é‡‡æ ·ï¼š
  - 65.9% æ¦‚ç‡é€‰token_0
  - 24.2% æ¦‚ç‡é€‰token_1
  - 9.9% æ¦‚ç‡é€‰token_2

è€Œä¸æ˜¯æ€»æ˜¯é€‰token_0ï¼ˆè´ªå¿ƒï¼‰
</code></pre>
<hr/>
<h5 data-id="heading-87">é‡‡æ ·ç­–ç•¥çš„å®Œæ•´æµç¨‹</h5>
<pre><code class="hljs language-scss" lang="scss">logits <span class="hljs-selector-attr">[vocab_size]</span>
    â†“
<span class="hljs-selector-attr">[1]</span> é‡å¤æƒ©ç½š
    å¯¹å·²å‡ºç°çš„tokenï¼šlogits /= rp
    â†“ logits_penalized

<span class="hljs-selector-attr">[2]</span> æ¸©åº¦ç¼©æ”¾
    logits /= temperature
    â†“ logits_scaled

<span class="hljs-selector-attr">[3]</span> æ ¸é‡‡æ ·ï¼ˆå¯é€‰ï¼‰
    <span class="hljs-attribute">mask</span> out low-probability tokens
    â†“ logits_filtered

<span class="hljs-selector-attr">[4]</span> å¤šé¡¹å¼é‡‡æ ·
    <span class="hljs-selector-tag">P</span> = <span class="hljs-built_in">softmax</span>(logits_filtered)
    token ~ <span class="hljs-built_in">Multinomial</span>(P)
    â†“
next_token
</code></pre>
<h5 data-id="heading-88">é‡‡æ ·å‚æ•°çš„æ¨èé…ç½®</h5>






















































<table><thead><tr><th>åœºæ™¯</th><th>temperature</th><th>top_p</th><th>rp</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><strong>ä»£ç ç”Ÿæˆ</strong></td><td>0.1</td><td>0.95</td><td>1.0</td><td>ç¡®å®šã€æ— é‡å¤é™åˆ¶</td></tr><tr><td><strong>äº‹å®é—®ç­”</strong></td><td>0.7</td><td>0.90</td><td>1.2</td><td>å‡†ç¡®ã€é¿å…é‡å¤</td></tr><tr><td><strong>å¯¹è¯äº¤äº’</strong></td><td>0.8</td><td>0.90</td><td>1.2</td><td><strong>å¹³è¡¡</strong> â­</td></tr><tr><td><strong>æ•…äº‹åˆ›ä½œ</strong></td><td>1.2</td><td>0.85</td><td>1.1</td><td>åˆ›æ„ã€è¿è´¯</td></tr><tr><td><strong>æ•°æ®å¢å¼º</strong></td><td>1.5</td><td>0.80</td><td>1.0</td><td>å¤šæ ·ã€è‡ªç”±</td></tr><tr><td><strong>æåº¦åˆ›æ„</strong></td><td>2.0</td><td>0.75</td><td>1.0</td><td>éšæ„ã€æ— çº¦æŸ</td></tr></tbody></table>
<h5 data-id="heading-89">é€‰å–åŸå› </h5>
<p><strong>1. è§£å†³æ¨¡å¼åå¡Œï¼ˆMode Collapseï¼‰</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">åœ¨ç”Ÿæˆä»»åŠ¡ä¸­ï¼Œå¦‚æœåªä½¿ç”¨è´ªå¿ƒè§£ç ï¼š
<span class="hljs-bullet">  -</span> æ¨¡å‹æ€»æ˜¯é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„token
<span class="hljs-bullet">  -</span> ç”Ÿæˆçš„æ–‡æœ¬è™½ç„¶é€šé¡ºï¼Œä½†æå…¶å•è°ƒ
<span class="hljs-bullet">  -</span> é‡å¤æŸäº›çŸ­è¯­ï¼š"æˆ‘å¾ˆé«˜å…´...æˆ‘å¾ˆé«˜å…´...æˆ‘å¾ˆé«˜å…´"

é‡‡æ ·ç­–ç•¥å¯ä»¥ï¼š
<span class="hljs-bullet">  -</span> ä¿ç•™å¤šæ ·æ€§
<span class="hljs-bullet">  -</span> è®©"åˆç†ä½†ä¸æ˜¯æœ€ä¼˜"çš„tokenæœ‰æœºä¼šè¢«é€‰ä¸­
<span class="hljs-bullet">  -</span> ç”Ÿæˆæ›´è‡ªç„¶çš„æ–‡æœ¬
</code></pre>
<p><strong>2. å¹³è¡¡è´¨é‡å’Œå¤šæ ·æ€§</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">è´ªå¿ƒï¼šé«˜è´¨é‡ âœ…ï¼Œä½å¤šæ ·æ€§ âŒ
é‡‡æ ·ï¼šä¸­ç­‰è´¨é‡ï¼Œé«˜å¤šæ ·æ€§ âœ…

é‡‡æ ·ç­–ç•¥çš„ç»„åˆï¼š
<span class="hljs-bullet">  -</span> æ¸©åº¦ï¼šæ§åˆ¶éšæœºæ€§ç¨‹åº¦
<span class="hljs-bullet">  -</span> Top-pï¼šåŠ¨æ€é€‰æ‹©å€™é€‰é›†
<span class="hljs-bullet">  -</span> é‡å¤æƒ©ç½šï¼šé¿å…å†—ä½™
<span class="hljs-bullet">  -</span> å¤šé¡¹å¼é‡‡æ ·ï¼šæœ€ç»ˆé€‰æ‹©

å››è€…ç»“åˆ â†’ æ—¢ä¿æŒè´¨é‡ï¼Œåˆä¿ç•™å¤šæ ·æ€§ â­
</code></pre>
<p><strong>3. å®ç”¨æ€§</strong></p>
<pre><code class="hljs language-markdown" lang="markdown">æ‰€æœ‰å…ˆè¿›LLMéƒ½ä½¿ç”¨é‡‡æ ·ç”Ÿæˆï¼š
<span class="hljs-bullet">  -</span> ChatGPT
<span class="hljs-bullet">  -</span> Claude
<span class="hljs-bullet">  -</span> Gemini
<span class="hljs-bullet">  -</span> LLaMA

éƒ½æ˜¯ temperature + top<span class="hljs-emphasis">_p + é‡å¤æƒ©ç½š çš„ç»„åˆ
</span></code></pre>
<h5 data-id="heading-90">æ ¸å¿ƒä¼˜åŠ¿</h5>
<pre><code class="hljs language-markdown" lang="markdown">é¿å…ç”Ÿæˆå•è°ƒé‡å¤æ–‡æœ¬
<span class="hljs-code">    â†“
ä¿æŒå¤šæ ·æ€§å’Œåˆ›æ„æ€§
    â†“
å¹³è¡¡è´¨é‡å’Œéšæœºæ€§
    â†“
é€‚åº”ä¸åŒåº”ç”¨åœºæ™¯
    â†“
æå‡ç”¨æˆ·ä½“éªŒ
</span></code></pre>
<hr/>
<h3 data-id="heading-91">ä¼˜åŒ–æŠ€æœ¯å¯¹æ¯”æ€»ç»“</h3>















































<table><thead><tr><th>æŠ€æœ¯</th><th>æ”¹è¿›ç›®æ ‡</th><th>å®ç°å¤æ‚åº¦</th><th>æ”¶ç›Š</th><th>ç°çŠ¶</th></tr></thead><tbody><tr><td><strong>å‚æ•°å…±äº«</strong></td><td>æ¨¡å‹å¤§å°</td><td>â­ æç®€</td><td>å‚æ•°å‡å°‘50%</td><td>ğŸ”¥ æ ‡å‡†</td></tr><tr><td><strong>é‡å¤æƒ©ç½š</strong></td><td>ç”Ÿæˆè´¨é‡</td><td>â­ æç®€</td><td>é¿å…é‡å¤</td><td>ğŸ”¥ å¿…éœ€</td></tr><tr><td><strong>æ¸©åº¦ç¼©æ”¾</strong></td><td>ç”Ÿæˆå¤šæ ·æ€§</td><td>â­ æç®€</td><td>å¯è°ƒéšæœºæ€§</td><td>ğŸ”¥ å¿…éœ€</td></tr><tr><td><strong>æ ¸é‡‡æ ·</strong></td><td>ç”Ÿæˆæ•ˆç‡</td><td>â­â­ ç®€å•</td><td>åŠ¨æ€å€™é€‰é›†</td><td>ğŸ”¥ æ¨è</td></tr><tr><td><strong>å¤šé¡¹å¼é‡‡æ ·</strong></td><td>ç”Ÿæˆæ–¹å¼</td><td>â­ æç®€</td><td>ä¿ç•™å¤šæ ·æ€§</td><td>ğŸ”¥ æ ‡å‡†</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-92">ä¸æ ‡å‡†GPTçš„æ”¹è¿›å¯¹æ¯”</h3>
<h4 data-id="heading-93">åŸå§‹GPTè®ºæ–‡</h4>
<pre><code class="hljs language-scss" lang="scss">å‚æ•°ï¼šåµŒå…¥çŸ©é˜µ + è¾“å‡ºçŸ©é˜µï¼ˆåˆ†å¼€ï¼‰
ç”Ÿæˆï¼šè´ªå¿ƒè§£ç  <span class="hljs-built_in">argmax</span>(logits)
      â†’ å•è°ƒã€é‡å¤
</code></pre>
<h4 data-id="heading-94">MiniMindçš„æ”¹è¿›</h4>
<pre><code class="hljs language-css" lang="css">å‚æ•°ï¼šå‚æ•°å…±äº«
      â†’ å‡å°‘ <span class="hljs-number">50%</span> çš„åµŒå…¥+è¾“å‡ºå‚æ•°

ç”Ÿæˆï¼šå››é˜¶æ®µé‡‡æ ·ç­–ç•¥
      <span class="hljs-selector-attr">[é‡å¤æƒ©ç½š]</span> â†’ <span class="hljs-selector-attr">[æ¸©åº¦ç¼©æ”¾]</span> â†’ <span class="hljs-selector-attr">[æ ¸é‡‡æ ·]</span> â†’ <span class="hljs-selector-attr">[å¤šé¡¹å¼é‡‡æ ·]</span>
      â†’ å¤šæ ·ã€æµç•…ã€è‡ªç„¶
</code></pre>
<hr/>
<h3 data-id="heading-95">ä¼˜åŒ–æŠ€æœ¯çš„å®é™…æ•ˆæœ</h3>
<h4 data-id="heading-96">å‚æ•°å…±äº«çš„æ˜¾å­˜èŠ‚çœ</h4>
<pre><code class="hljs language-ini" lang="ini">è¯æ±‡è¡¨å¤§å°ï¼š32,000
æ¨¡å‹ç»´åº¦ï¼š4,096

èŠ‚çœæ˜¾å­˜ï¼š32,000 Ã— 4,096 Ã— <span class="hljs-attr">4bytes</span> = <span class="hljs-number">0.52</span> GBï¼ˆF32ï¼‰
         32,000 Ã— 4,096 Ã— <span class="hljs-attr">2bytes</span> = <span class="hljs-number">0.26</span> GBï¼ˆF16ï¼‰

å¯¹äºä¸€ä¸ª7Bæ¨¡å‹æ¥è¯´ï¼šèŠ‚çœ 1-3% æ˜¾å­˜
</code></pre>
<h4 data-id="heading-97">é‡‡æ ·ç­–ç•¥çš„ç”Ÿæˆè´¨é‡å¯¹æ¯”</h4>















































<table><thead><tr><th>è®¾ç½®</th><th>æ–‡æœ¬æµç•…åº¦</th><th>é‡å¤ç‡</th><th>å¤šæ ·æ€§</th><th>æ¨èåº¦</th></tr></thead><tbody><tr><td><strong>è´ªå¿ƒè§£ç </strong></td><td>é«˜</td><td>é«˜</td><td>ä½</td><td>âŒ</td></tr><tr><td><strong>Temperature=0.8</strong></td><td>é«˜</td><td>ä½</td><td>ä¸­</td><td>â­â­</td></tr><tr><td><strong>Top-p=0.9</strong></td><td>é«˜</td><td>ä¸­</td><td>é«˜</td><td>â­â­â­</td></tr><tr><td><strong>T=0.8 + p=0.9</strong></td><td>é«˜</td><td>ä½</td><td>é«˜</td><td>â­â­â­â­</td></tr><tr><td><strong>T=0.8 + p=0.9 + rp=1.2</strong></td><td><strong>æœ€ä¼˜</strong></td><td><strong>æœ€ä½</strong></td><td><strong>é«˜</strong></td><td>â­â­â­â­â­</td></tr></tbody></table>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Elasticsearch é¿å‘æŒ‡å—ï¼šæˆ‘åœ¨é¡¹ç›®ä¸­æ€»ç»“çš„ 14 æ¡å®ç”¨ç»éªŒ]]></title>    <link>https://juejin.cn/post/7569959427879567370</link>    <guid>https://juejin.cn/post/7569959427879567370</guid>    <pubDate>2025-11-09T13:45:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569959427879567370" data-draft-id="7567249547006607387" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Elasticsearch é¿å‘æŒ‡å—ï¼šæˆ‘åœ¨é¡¹ç›®ä¸­æ€»ç»“çš„ 14 æ¡å®ç”¨ç»éªŒ"/> <meta itemprop="keywords" content="Elasticsearch,åç«¯,æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-11-09T13:45:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çº¢å°˜æ—…äºº"/> <meta itemprop="url" content="https://juejin.cn/user/3485898277388519"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Elasticsearch é¿å‘æŒ‡å—ï¼šæˆ‘åœ¨é¡¹ç›®ä¸­æ€»ç»“çš„ 14 æ¡å®ç”¨ç»éªŒ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3485898277388519/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çº¢å°˜æ—…äºº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T13:45:03.000Z" title="Sun Nov 09 2025 13:45:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"ã€Œ"}.markdown-body strong:after{content:"ã€"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"â";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"â";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åˆšå¼€å§‹æ¥è§¦ Elasticsearch æ—¶ï¼Œæˆ‘è§‰å¾—å®ƒå°±åƒä¸ªé»‘ç›’å­â€”â€”æ•°æ®å¾€é‡Œä¸€æ‰”ï¼ŒæŸ¥è¯¢è¯­å¥ä¸€å†™ï¼Œç»“æœå°±å‡ºæ¥äº†ã€‚ç›´åˆ°è´Ÿè´£å…¬å¸æ ¸å¿ƒä¸šåŠ¡çš„æœç´¢æ¨¡å—åï¼Œæˆ‘æ‰å‘ç°è¿™ä¸ªé»‘ç›’å­é‡Œé¢è—ç€æ— æ•°éœ€è¦æ³¨æ„çš„ç»†èŠ‚ã€‚</p>
</blockquote>
<hr/>
<p>ä»Šå¤©å°±æŠŠæˆ‘åœ¨å®é™…é¡¹ç›®ä¸­ç§¯ç´¯çš„ ES ä½¿ç”¨ç»éªŒåˆ†äº«ç»™å¤§å®¶ï¼Œä¸»è¦ä»<strong>ç´¢å¼•è®¾è®¡</strong>ã€<strong>å­—æ®µç±»å‹</strong>ã€<strong>æŸ¥è¯¢ä¼˜åŒ–</strong>ã€<strong>é›†ç¾¤ç®¡ç†</strong>å’Œ<strong>æ¶æ„è®¾è®¡</strong>è¿™å‡ ä¸ªæ–¹é¢æ¥å±•å¼€ã€‚</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ed326ed06d3f41ec9c1ee1010da01c42~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qi5bCY5peF5Lq6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763300702&amp;x-signature=kA3%2FCjHgK3B0Ze8upiBaoF5nBzE%3D" alt="20251102-4.jpg" loading="lazy"/></p>
<h2 data-id="heading-0">ç´¢å¼•è®¾è®¡ï¼šä»åŸºç¡€åˆ°è¿›é˜¶</h2>
<h3 data-id="heading-1">1. ç´¢å¼•åˆ«åï¼ˆaliasï¼‰ï¼šä¸ºå˜æ›´ç•™æ¡åè·¯</h3>
<p>åˆšå¼€å§‹åšé¡¹ç›®æ—¶ï¼Œæˆ‘ä¹ æƒ¯ç›´æ¥ç”¨ç´¢å¼•åã€‚ç›´åˆ°æœ‰ä¸€æ¬¡éœ€è¦ä¿®æ”¹å­—æ®µç±»å‹ï¼Œæ‰å‘ç° <strong>ES ä¸æ”¯æŒç›´æ¥ä¿®æ”¹æ˜ å°„ï¼Œä¹Ÿä¸æ”¯æŒä¿®æ”¹ä¸»åˆ†ç‰‡æ•°</strong>ï¼Œå¿…é¡»é‡å»ºç´¢å¼•ã€‚ï¼ˆ**æ–°å¢å­—æ®µæ˜¯å¯ä»¥çš„ï¼‰</p>
<p><strong>è§£å†³æ–¹æ¡ˆå¾ˆç®€å•</strong>ï¼šä½¿ç”¨<strong>ç´¢å¼•åˆ«å</strong>ã€‚ä¸šåŠ¡ä»£ç ä¸­æ°¸è¿œä½¿ç”¨åˆ«åï¼Œé‡å»ºç´¢å¼•æ—¶åªéœ€è¦åˆ‡æ¢åˆ«åçš„æŒ‡å‘ï¼Œæ•´ä¸ªè¿‡ç¨‹ç”¨æˆ·æ— æ„ŸçŸ¥ã€‚</p>
<p>è¿™å°±å¥½æ¯”ç»™ç´¢å¼•èµ·äº†ä¸ª"å¤–å·"ï¼Œé‡Œé¢æ€ä¹ˆæ¢å†…å®¹éƒ½ä¸å½±å“å¤–é¢çš„äººç§°å‘¼å®ƒã€‚</p>
<h3 data-id="heading-2">2. Routing è·¯ç”±ï¼šè®©æŸ¥è¯¢æ›´ç²¾å‡†</h3>
<p>åœ¨åš <strong>SaaS ç”µå•†ç³»ç»Ÿ</strong>æ—¶ï¼Œæˆ‘å‘ç°æŸ¥è¯¢æŸä¸ªå•†å®¶çš„è®¢å•æ•°æ®ç‰¹åˆ«æ…¢ã€‚åŸæ¥ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹ESæ ¹æ®æ–‡æ¡£IDçš„å“ˆå¸Œå€¼åˆ†é…åˆ†ç‰‡</strong>ï¼Œå¯¼è‡´åŒä¸€ä¸ªå•†å®¶çš„æ•°æ®åˆ†æ•£åœ¨ä¸åŒåˆ†ç‰‡ä¸Šã€‚</p>
<p><strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨å•†å®¶ ID ä½œä¸º <strong>routing key</strong>ï¼Œå­˜å‚¨å’ŒæŸ¥è¯¢æ•°æ®æ—¶æŒ‡å®šrouting keyã€‚è¿™æ ·ï¼ŒåŒä¸€ä¸ªå•†å®¶çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šå­˜å‚¨åœ¨åŒä¸€ä¸ªåˆ†ç‰‡ä¸Šã€‚</p>
<p><strong>æ•ˆæœå¯¹æ¯”</strong>ï¼š</p>
<ul>
<li>ä¼˜åŒ–å‰ï¼šæŸ¥è¯¢è¦æ‰«ææ‰€æœ‰åˆ†ç‰‡ï¼ˆæ¯”å¦‚3ä¸ªåˆ†ç‰‡éƒ½è¦æŸ¥ï¼‰</li>
<li>ä¼˜åŒ–åï¼šåªéœ€è¦æŸ¥1ä¸ªåˆ†ç‰‡</li>
<li><strong>ç»“æœ</strong>ï¼šæŸ¥è¯¢é€Ÿåº¦ç›´æ¥ç¿»å€ï¼Œèµ„æºæ¶ˆè€—è¿˜æ›´å°‘</li>
</ul>
<h3 data-id="heading-3">3. åˆ†ç‰‡æ‹†åˆ†ï¼šåº”å¯¹æ•°æ®å¢é•¿</h3>
<p>å½“å•ä¸ªç´¢å¼•æ•°æ®é‡æŒç»­å¢é•¿æ—¶ï¼Œå•çº¯å¢åŠ åˆ†ç‰‡æ•°å¹¶ä¸æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚</p>
<p><strong>æˆ‘çš„ç»éªŒæ˜¯</strong>ï¼š</p>
<ul>
<li><strong>ä¸šåŠ¡ç´¢å¼•</strong>ï¼šå•ä¸ªåˆ†ç‰‡æ§åˆ¶åœ¨ 10-30GB</li>
<li><strong>æœç´¢ç´¢å¼•</strong>ï¼š10GB ä»¥å†…æ›´åˆé€‚</li>
<li><strong>æ—¥å¿—ç´¢å¼•</strong>ï¼šå¯ä»¥æ”¾å®½åˆ° 20-50GB</li>
</ul>
<p>å¯¹äº SaaS ç³»ç»Ÿï¼ŒESå•ç´¢å¼•æ•°æ®è¾ƒå¤§ï¼Œä¸”å­˜åœ¨â€œè¶…çº§å¤§å•†æˆ·â€ï¼Œå¯¼è‡´æ•°æ®å€¾æ–œä¸¥é‡æ—¶ï¼Œå¯ä»¥æŒ‰<strong>å•†å®¶ID%64å–æ¨¡</strong>è¿›è¡Œç´¢å¼•æ‹†åˆ†ï¼Œæ¯”å¦‚ <code>orders_001</code> åˆ° <code>orders_064</code>ï¼Œæ¯ä¸ªç´¢å¼•åŒ…å«éƒ¨åˆ†å•†å®¶çš„æ•°æ®ï¼Œç„¶åå†æ ¹æ®å•†æˆ·IDæŒ‡å®šrouting keyã€‚</p>
<blockquote>
<p>è¯·æ ¹æ®<strong>ä¸šåŠ¡æ•°æ®é‡</strong>å’Œ<strong>ä¸šåŠ¡è¦æ±‚</strong>ï¼Œé€‰æ‹©æœ€é€‚åˆçš„<strong>åˆ†ç‰‡æ‹†åˆ†è§„åˆ™</strong> å’Œ<strong>routing keyè·¯ç”±ç®—æ³•</strong>ï¼ŒåŒæ—¶ä¸è¦å› ä¸ºæ‹†åˆ†ä¸åˆç†ï¼Œå¯¼è‡´ESèŠ‚ç‚¹ä¸­å­˜åœ¨å¤§é‡åˆ†ç‰‡ã€‚</p>
<p>ESé»˜è®¤<strong>å•èŠ‚ç‚¹åˆ†ç‰‡æœ€å¤§å€¼ä¸º1000</strong>(7.0ç‰ˆæœ¬å)ï¼Œå¯ä»¥å‚è€ƒESå®˜æ–¹å»ºè®®ï¼Œ<strong>å †å†…å­˜åˆ†ç‰‡æ•°é‡</strong>ç»´æŒå¤§çº¦<strong>1:20</strong>çš„æ¯”ä¾‹</p>
</blockquote>
<hr/>
<h2 data-id="heading-4">å­—æ®µç±»å‹ï¼šé€‰æ‹©æ¯”åŠªåŠ›é‡è¦</h2>
<h3 data-id="heading-5">4. Text vs Keywordï¼šç†è§£å®ƒä»¬çš„æœ¬è´¨åŒºåˆ«</h3>
<p>æ›¾ç»æœ‰ä¸ªå‘ï¼šç”¨æˆ·æ‰‹æœºå·ç”¨ <strong>text ç±»å‹</strong>å­˜å‚¨ï¼Œç»“æœæœç´¢å®Œæ•´çš„æ‰‹æœºå·å´æœä¸åˆ°ã€‚åŸæ¥ text ç±»å‹ä¼šè¢«åˆ†è¯ï¼Œ<code>13800138000</code> å¯èƒ½è¢«æ‹†æˆ <code>138</code>ã€<code>0013</code>ã€<code>8000</code> ç­‰ç‰‡æ®µã€‚</p>
<p><strong>æ­£ç¡®åšæ³•</strong>ï¼š</p>
<ul>
<li>éœ€è¦åˆ†è¯æœç´¢çš„ç”¨ <strong>text</strong>ï¼ˆå¦‚å•†å“æè¿°ï¼‰</li>
<li>éœ€è¦ç²¾ç¡®åŒ¹é…çš„ç”¨ <strong>keyword</strong>ï¼ˆå¦‚è®¢å•å·ã€æ‰‹æœºå·ï¼‰ï¼Œé€‚åˆ <strong>termã€terms</strong> ç­‰ç²¾ç¡®æŸ¥è¯¢</li>
<li><strong>æ•ˆæœ</strong>ï¼škeyword ç±»å‹çš„ term æŸ¥è¯¢é€Ÿåº¦æ›´å¿«ï¼Œå­˜å‚¨ç©ºé—´æ›´å°</li>
</ul>
<h3 data-id="heading-6">5. å¤šå­—æ®µæ˜ å°„ï¼ˆmulti-fieldsï¼‰ï¼šæŒ‰éœ€ä½¿ç”¨ä¸æµªè´¹</h3>
<p>ES é»˜è®¤ä¼šä¸º text å­—æ®µåˆ›å»º keyword å­å­—æ®µï¼Œä½†è¿™å¹¶ä¸æ€»æ˜¯å¿…è¦çš„ã€‚</p>
<p><strong>æˆ‘çš„é€‰æ‹©</strong>ï¼š</p>
<ul>
<li>ç¡®å®šå­—æ®µéœ€è¦<strong>ç²¾ç¡®åŒ¹é…å’Œèšåˆ</strong>æ—¶ï¼šå¯ç”¨ <strong>multi-fields</strong></li>
<li>åªç”¨äºå…¨æ–‡æœç´¢æ—¶ï¼šç¦ç”¨ multi-fields</li>
<li><strong>å¥½å¤„</strong>ï¼šèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œæå‡å†™å…¥é€Ÿåº¦</li>
</ul>
<h3 data-id="heading-7">6. æ’åºå­—æ®µï¼šé€‰å¯¹ç±»å‹æå‡æ€§èƒ½</h3>
<p>ç”¨ keyword å­—æ®µåšæ•°å€¼æ’åºæ˜¯ä¸ªå¸¸è§è¯¯åŒºã€‚æ¯”å¦‚ä»·æ ¼æ’åºï¼Œ<code>100</code> ä¼šæ’åœ¨ <code>99</code> å‰é¢ï¼Œå› ä¸ºå®ƒæ˜¯æŒ‰å­—ç¬¦ä¸²é¡ºåºæ¯”è¾ƒçš„ã€‚</p>
<p><strong>æ¨èåšæ³•</strong>ï¼š</p>
<ul>
<li>æ•°å€¼æ’åºï¼šç”¨ <strong>longã€integer</strong> ç±»å‹</li>
<li>æ—¶é—´æ’åºï¼šç”¨ <strong>date</strong> ç±»å‹</li>
<li><strong>æå‡æ•ˆæœ</strong>ï¼šæ’åºé€Ÿåº¦æå‡æ˜æ˜¾ï¼Œå†…å­˜å ç”¨ä¹Ÿæ›´å°‘</li>
</ul>
<hr/>
<h2 data-id="heading-8">æŸ¥è¯¢ä¼˜åŒ–ï¼šå¹³è¡¡é€Ÿåº¦ä¸ç²¾åº¦</h2>
<h3 data-id="heading-9">7. æ¨¡ç³ŠæŸ¥è¯¢ï¼šäº†è§£æ­£ç¡®çš„æ‰“å¼€æ–¹å¼</h3>
<p>åœ¨ <strong>ES 7.9 ä¹‹å‰</strong>ï¼Œ<strong>wildcard æŸ¥è¯¢</strong>æ˜¯ä¸ªæ€§èƒ½é™·é˜±ã€‚å®ƒåŸºäºæ­£åˆ™è¡¨è¾¾å¼å¼•æ“ï¼Œå‰å¯¼é€šé…ç¬¦ä¼šå¯¼è‡´å…¨é‡è¯é¡¹æ‰«æã€‚</p>
<p><strong>ç°åœ¨çš„æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li><strong>ES7.9+</strong>ï¼šä½¿ç”¨ <strong>wildcard å­—æ®µç±»å‹</strong></li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šåº•å±‚ä½¿ç”¨ä¼˜åŒ–çš„ <strong>n-gram</strong> + <strong>äºŒè¿›åˆ¶ doc value</strong> æœºåˆ¶ï¼Œæ€§èƒ½æå‡æ˜¾è‘—</li>
</ul>
<blockquote>
<p>æç¤ºï¼šES7.9å‰åç‰ˆæœ¬wildcardçš„å…·ä½“ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« </p>
<p><a href="https://juejin.cn/post/7567581946144522291" target="_blank" title="https://juejin.cn/post/7567581946144522291">ã€Šä¸äº§å“ç»ç†çš„â€œæ¨¡ç³Šâ€å¯¹å†³ï¼šElasticsearchå®ç°MySQL LIKE '%xxx%'ã€‹</a></p>
</blockquote>
<h3 data-id="heading-10">8. åˆ†é¡µæŸ¥è¯¢ï¼šé¿å…æ·±åº¦åˆ†é¡µçš„å‘</h3>
<p>äº§å“ç»ç†æ›¾è¦æ±‚å®ç°"æ— é™æ»šåŠ¨"ï¼Œæˆ‘å±•ç¤ºäº†æ·±åº¦åˆ†é¡µçš„æ€§èƒ½æ•°æ®åï¼Œå¤§å®¶è¾¾æˆå…±è¯†ï¼š<strong>ä¸šåŠ¡å±‚é¢é¿å…æ·±åº¦åˆ†é¡µæ‰æ˜¯æ ¹æœ¬è§£å†³æ–¹æ¡ˆ</strong>ã€‚å°±åƒæ·˜å®ã€Google è¿™æ ·çš„å¤§å‚ï¼Œä¹Ÿéƒ½å¯¹åˆ†é¡µåšäº†é™åˆ¶ï¼Œè¿™ä¸ä»…æ˜¯æŠ€æœ¯è€ƒé‡ï¼Œæ›´æ˜¯ç”¨æˆ·ä½“éªŒçš„æœ€ä¼˜é€‰æ‹©ã€‚</p>
<p><strong>æŠ€æœ¯æ–¹æ¡ˆ</strong>ï¼ˆä»…åœ¨ç¡®å®æ— æ³•é¿å…æ—¶è€ƒè™‘ï¼‰ï¼š</p>
<ul>
<li><strong>æµ…åˆ†é¡µ</strong>ï¼šä½¿ç”¨ <code>from/size</code>ï¼Œé€‚åˆå‰å‡ é¡µçš„å¸¸è§„åˆ†é¡µ</li>
<li><strong>Scroll</strong>ï¼šé€‚åˆå¤§æ•°æ®é‡å¯¼å‡ºï¼Œä½†éœ€è¦ç»´æŠ¤ scroll_id å’Œå†å²å¿«ç…§ï¼Œå¯¹æœåŠ¡å™¨èµ„æºæ¶ˆè€—è¾ƒå¤§</li>
<li><strong>search_after</strong>ï¼šåŸºäºä¸Šä¸€é¡µæœ€åä¸€æ¡è®°å½•è¿›è¡Œåˆ†é¡µï¼Œä½†æ— æ³•è·³è½¬ä»»æ„é¡µé¢ï¼Œä¸”é¢‘ç¹æŸ¥è¯¢ä¼šå¢åŠ æœåŠ¡å™¨å‹åŠ›</li>
</ul>
<p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼Œè¿™äº›æŠ€æœ¯æ–¹æ¡ˆéƒ½å­˜åœ¨å„è‡ªçš„å±€é™æ€§ï¼Œ<strong>ä¸šåŠ¡è®¾è®¡ä¸Šçš„è§„é¿å§‹ç»ˆæ˜¯æœ€ä½³é€‰æ‹©</strong>ã€‚</p>
<hr/>
<h2 data-id="heading-11">é›†ç¾¤ç®¡ç†ï¼šä¿éšœç¨³å®šè¿è¡Œ</h2>
<h3 data-id="heading-12">9. ç´¢å¼•ç”Ÿå‘½å‘¨æœŸï¼šè‡ªåŠ¨åŒ–è¿ç»´</h3>
<p>æ—¥å¿—æ•°æ®çš„ç‰¹ç‚¹æ˜¯æºæºä¸æ–­ï¼Œå¦‚æœä¸åŠ ç®¡ç†ï¼Œç£ç›˜å¾ˆå¿«å°±ä¼šè¢«æ’‘æ»¡ã€‚</p>
<p><strong>æˆ‘çš„åšæ³•</strong>ï¼š</p>
<ul>
<li>æŒ‰å¤©åˆ›å»ºç´¢å¼•ï¼ˆå¦‚ log_20231201ï¼‰</li>
<li>è®¾ç½®ä¿ç•™ç­–ç•¥ï¼ˆä¿ç•™7å¤©æˆ–30å¤©ï¼‰</li>
<li>ç»“åˆæ¨¡æ¿è‡ªåŠ¨åŒ–ç®¡ç†</li>
</ul>
<h3 data-id="heading-13">10. å‡†å®æ—¶æ€§ï¼šç†è§£åˆ·æ–°æœºåˆ¶</h3>
<p>å¾ˆå¤šæ–°æ‰‹ä¼šå›°æƒ‘ï¼šä¸ºä»€ä¹ˆæ•°æ®å†™å…¥åä¸èƒ½ç«‹å³æœç´¢ï¼Ÿ</p>
<p><strong>åŸç†</strong>ï¼š<strong>ES é»˜è®¤ 1 ç§’åˆ·æ–°ä¸€æ¬¡ç´¢å¼•</strong>ï¼Œè¿™æ˜¯ä¸ºäº†åœ¨å®æ—¶æ€§å’Œå†™å…¥æ€§èƒ½ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p>
<p><strong>è°ƒæ•´å»ºè®®</strong>ï¼š</p>
<ul>
<li>å®æ—¶æ€§è¦æ±‚é«˜ï¼šä¿æŒ 1s</li>
<li>å†™å…¥é‡å¤§ï¼šé€‚å½“è°ƒå¤§ refresh_interval</li>
</ul>
<blockquote>
<p><strong>è¡¥å……è¯´æ˜</strong>ï¼šå¦‚æœéœ€è¦æ›´æ–°åç«‹å³èƒ½æŸ¥è¯¢åˆ°ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p>
<ol>
<li>è®©å‰ç«¯ç›´æ¥å±•ç¤ºåˆšæäº¤çš„æ•°æ®ï¼Œç­‰ä¸‹ä¸€æ¬¡è°ƒç”¨æ¥å£æ—¶å†æŸ¥è¯¢ ES</li>
<li>æ›´æ–°å®Œåï¼Œå‰ç«¯å»¶è¿Ÿ 1.5 ç§’åå†æŸ¥è¯¢</li>
</ol>
<p><strong>å…³é”®ç‚¹</strong>ï¼šä¸šåŠ¡éœ€æ±‚ä¸ä¸€å®šéƒ½è¦åç«¯å®ç°ï¼Œå¯ä»¥ç»“åˆå‰ç«¯ä¸€èµ·è€ƒè™‘è§£å†³æ–¹æ¡ˆã€‚</p>
</blockquote>
<h3 data-id="heading-14">11. å†…å­˜é…ç½®ï¼š32G é™åˆ¶çš„çœŸç›¸</h3>
<p>ä¸ºä»€ä¹ˆ ES å®˜æ–¹å»ºè®®ä¸è¦è¶…è¿‡ 32G å†…å­˜ï¼Ÿ</p>
<p><strong>æŠ€æœ¯åŸå› </strong>ï¼šJava çš„<strong>å‹ç¼©æŒ‡é’ˆæŠ€æœ¯</strong>åœ¨ 32G ä»¥å†…æœ‰æ•ˆï¼Œè¶…è¿‡è¿™ä¸ªé™åˆ¶ä¼šæµªè´¹å¤§é‡å†…å­˜ã€‚</p>
<p><strong>å®è·µå»ºè®®</strong>ï¼šå•ä¸ªèŠ‚ç‚¹é…ç½®çº¦50%å†…å­˜ï¼Œç•™å‡ºéƒ¨åˆ†ç»™æ“ä½œç³»ç»Ÿã€‚</p>
<hr/>
<h2 data-id="heading-15">æ¶æ„è®¾è®¡ï¼šåˆç†çš„åˆ†å·¥åä½œ</h2>
<h3 data-id="heading-16">12. ES ä¸æ•°æ®åº“ï¼šå„å¸å…¶èŒ</h3>
<p>æ›¾ç»è¯•å›¾åœ¨ ES é‡Œå­˜å‚¨å®Œæ•´çš„ä¸šåŠ¡æ•°æ®ï¼Œç»“æœé‡åˆ°<strong>æ•°æ®ä¸€è‡´æ€§</strong>é—®é¢˜ã€‚</p>
<p><strong>ç°åœ¨çš„æ–¹æ¡ˆ</strong>ï¼š</p>
<ul>
<li><strong>ES</strong>ï¼šå­˜å‚¨æœç´¢æ¡ä»¶å’Œæ–‡æ¡£ ID</li>
<li><strong>æ•°æ®åº“</strong>ï¼šå­˜å‚¨å®Œæ•´ä¸šåŠ¡æ•°æ®</li>
<li><strong>æŸ¥è¯¢</strong>ï¼šES æ‰¾ IDï¼Œæ•°æ®åº“å–è¯¦æƒ…</li>
</ul>
<p><strong>å¥½å¤„</strong>ï¼šæ—¢äº«å— ES çš„æœç´¢èƒ½åŠ›ï¼Œåˆä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚</p>
<h3 data-id="heading-17">13. åµŒå¥—å¯¹è±¡ï¼šä¿æŒæ•°æ®å…³è”æ€§</h3>
<p>å¤„ç†å•†å“è§„æ ¼è¿™ç±»æ•°ç»„æ•°æ®æ—¶ï¼Œç”¨æ™®é€šçš„ <strong>object ç±»å‹</strong>ä¼šå¯¼è‡´æ•°æ®æ‰å¹³åŒ–ï¼Œç ´åå¯¹è±¡é—´çš„å…³è”ã€‚</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <strong>nested ç±»å‹</strong>ï¼Œä¿æŒæ•°ç»„å†…å¯¹è±¡çš„ç‹¬ç«‹æ€§ï¼Œç¡®ä¿æŸ¥è¯¢ç»“æœçš„å‡†ç¡®æ€§ã€‚</p>
<h3 data-id="heading-18">14. å‰¯æœ¬é…ç½®ï¼šè¯»å†™å¹³è¡¡çš„è‰ºæœ¯</h3>
<p>å‰¯æœ¬å¯ä»¥æå‡æŸ¥è¯¢èƒ½åŠ›ï¼Œä½†ä¹Ÿä¸æ˜¯è¶Šå¤šè¶Šå¥½ã€‚</p>
<p><strong>ç»éªŒå€¼</strong>ï¼š</p>
<ul>
<li>å¤§å¤šæ•°åœºæ™¯ï¼š<strong>1 ä¸ªå‰¯æœ¬</strong>è¶³å¤Ÿ</li>
<li>é«˜æŸ¥è¯¢å‹åŠ›ï¼šå¯é€‚å½“å¢åŠ </li>
<li><strong>æ³¨æ„</strong>ï¼šå‰¯æœ¬è¶Šå¤šï¼Œå†™å…¥å‹åŠ›è¶Šå¤§</li>
</ul>
<hr/>
<h2 data-id="heading-19">å†™åœ¨æœ€å</h2>
<p>è¿™äº›ç»éªŒéƒ½æ˜¯åœ¨è§£å†³å®é™…é—®é¢˜ä¸­æ…¢æ…¢ç§¯ç´¯çš„ã€‚å°±åƒä¿®è·¯ä¸€æ ·ï¼Œå¼€å§‹å¯èƒ½åªæ˜¯ç®€å•é“ºå¹³ï¼Œéšç€è½¦æµé‡çš„å¢åŠ ï¼Œéœ€è¦ä¸æ–­ä¼˜åŒ–â€”â€”è®¾ç½®çº¢ç»¿ç¯ã€åˆ’åˆ†è½¦é“ã€å»ºç«‹ç«‹äº¤æ¡¥ã€‚ä½¿ç”¨ ES ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œéšç€ä¸šåŠ¡çš„å‘å±•ï¼Œéœ€è¦ä¸æ–­è°ƒæ•´å’Œä¼˜åŒ–ã€‚</p>
<p>æœ€å¤§çš„ä½“ä¼šæ˜¯ï¼š<strong>ç†è§£åŸç†æ¯”è®°ä½å‘½ä»¤æ›´é‡è¦</strong>ã€‚åªæœ‰æ˜ç™½äº†ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Œæ‰èƒ½åœ¨é‡åˆ°æ–°é—®é¢˜æ—¶æ‰¾åˆ°åˆé€‚çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<blockquote>
<p>å¦‚æœæœ‰äººé—®æˆ‘ï¼š"ES æ€ä¹ˆæ‰èƒ½ç”¨å¾—æ›´å¥½ï¼Ÿ"æˆ‘çš„å›ç­”æ˜¯ï¼š"å…ˆç†è§£ä¸šåŠ¡åœºæ™¯ï¼Œå†é€‰æ‹©æŠ€æœ¯æ–¹æ¡ˆã€‚å°±åƒæˆ‘ä»¬ä¹‹å‰åšçš„æ¨¡ç³Šæœç´¢ï¼Œä¸æ˜¯ç®€å•åœ°ç”¨ wildcardï¼Œè€Œæ˜¯æ ¹æ® ES ç‰ˆæœ¬é€‰æ‹©æœ€ä¼˜è§£ã€‚"</p>
</blockquote>
<p><strong>æŠ€æœ¯çš„ä»·å€¼ä¸åœ¨äºå¤šå¤æ‚ï¼Œè€Œåœ¨äºèƒ½å¦ä¼˜é›…åœ°è§£å†³å®é™…é—®é¢˜ã€‚ä¸å¤§å®¶å…±å‹‰ã€‚</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Flutter æ‹–æ‹‰å¯¹æ¯”ç»„ä»¶ï¼Œæ¢è£…å›¾ç‰‡å‰åå¯¹æ¯”å¿…å¤‡]]></title>    <link>https://juejin.cn/post/7570197010885034030</link>    <guid>https://juejin.cn/post/7570197010885034030</guid>    <pubDate>2025-11-09T12:28:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570197010885034030" data-draft-id="7568699551101075508" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Flutter æ‹–æ‹‰å¯¹æ¯”ç»„ä»¶ï¼Œæ¢è£…å›¾ç‰‡å‰åå¯¹æ¯”å¿…å¤‡"/> <meta itemprop="keywords" content="Flutter,å‰ç«¯,å¼€æº"/> <meta itemprop="datePublished" content="2025-11-09T12:28:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LinXunFeng"/> <meta itemprop="url" content="https://juejin.cn/user/1820446984512392"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Flutter æ‹–æ‹‰å¯¹æ¯”ç»„ä»¶ï¼Œæ¢è£…å›¾ç‰‡å‰åå¯¹æ¯”å¿…å¤‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1820446984512392/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LinXunFeng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T12:28:38.000Z" title="Sun Nov 09 2025 12:28:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>æ¬¢è¿å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" target="_blank" title="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" ref="nofollow noopener noreferrer">FSAå…¨æ ˆè¡ŒåŠ¨</a> ğŸ‘‹</p>
</blockquote>
<h2 data-id="heading-0">ä¸€ã€å‰è¨€</h2>
<p>æœ€è¿‘ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦åœ¨ <code>photo_view</code> ä¸­å®ç°æ‹–æ‹‰å¯¹æ¯”ä¸¤å¼ å›¾ç‰‡çš„åŠŸèƒ½ï¼Œè¦æ±‚ä¸å½±å“å·¦å³ç¿»é¡µåŠç¼©æ”¾æ‰‹åŠ¿ã€‚</p>
<p>å…¶ä¸­å‰åå›¾ç‰‡ä¸Šéœ€è¦æ˜¾ç¤ºä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œæ‰€ä»¥æ›´å‡†ç¡®æ¥è¯´ï¼Œè¦å¯¹æ¯”çš„æ˜¯ä¸¤ä¸ªè§†å›¾ï¼Œè€Œä¸å•å•åªæ˜¯å›¾ç‰‡ã€‚</p>
<p>å¸‚é¢ä¸Šå‡ ä¸ªç°æœ‰çš„ç»„ä»¶åº“ï¼Œè¦ä¹ˆåªèƒ½ä¼ å…¥ <code>Image</code>ï¼Œè¦ä¹ˆåªå…è®¸å…¨å±æ‹–æ‹½ï¼Œä¸”æ— æ³•æ»¡è¶³æˆ‘ä»¬é«˜è‡ªå®šä¹‰çš„éœ€è¦ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±åšäº†ä¸€ä¸ªã€‚</p>
<p>ç›¸åº”çš„Â <code>Demo</code>Â å¯ç§‘å­¦ä¸Šç½‘ååœ¨çº¿ä½“éªŒ:
<a href="https://link.juejin.cn?target=https%3A%2F%2Flinxunfeng.github.io%2Fflutter_compare_slider%2F" target="_blank" title="https://linxunfeng.github.io/flutter_compare_slider/" ref="nofollow noopener noreferrer">linxunfeng.github.io/flutter_comâ€¦</a></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e582ebd2385247bdbfb966509bcdc5c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgTGluWHVuRmVuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296117&amp;x-signature=b6xhOjYJqMvCSsqTxQRu%2BLK7nRo%3D" alt="" loading="lazy"/></p>
<p>OKï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥çœ‹çœ‹å…·ä½“ä½¿ç”¨</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLinXunFeng%2Fflutter_compare_slider" target="_blank" title="https://github.com/LinXunFeng/flutter_compare_slider" ref="nofollow noopener noreferrer">github.com/LinXunFeng/â€¦</a></p>
<h2 data-id="heading-1">äºŒã€ä½¿ç”¨</h2>
<p>æ·»åŠ ä¾èµ–</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">dependencies:</span>
  <span class="hljs-attr">compare_slider:</span> <span class="hljs-string">latest_version</span>
</code></pre>
<p>å¯¼å…¥</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-keyword">import</span> <span class="hljs-string">'package:compare_slider/compare_slider.dart'</span>;
</code></pre>
<p>ä½¿ç”¨</p>
<pre><code class="hljs language-dart" lang="dart"><span class="hljs-built_in">double</span> value = <span class="hljs-number">0.5</span>;
<span class="hljs-built_in">double</span> thickness = <span class="hljs-number">1</span>;
<span class="hljs-built_in">bool</span> dragOnlyOnSlider = <span class="hljs-keyword">true</span>;

CompareSlider(
  <span class="hljs-comment">// å½“å‰å€¼ [0, 1]</span>
  value: value,
  <span class="hljs-comment">// æ˜¯å¦åªå…è®¸åœ¨æ»‘å—åŒºåŸŸæ‹–æ‹½</span>
  dragOnlyOnSlider: dragOnlyOnSlider,
  <span class="hljs-comment">// åŸå›¾è§†å›¾ï¼ˆæ¥æ”¶ç±»å‹ä¸º Widgetï¼Œä¸å±€é™äºå›¾ç‰‡ï¼‰</span>
  before: _buildImageView(isBefore: <span class="hljs-keyword">true</span>),
  <span class="hljs-comment">// æ¢è£…åçš„è§†å›¾</span>
  after: _buildImageView(isBefore: <span class="hljs-keyword">false</span>),
  <span class="hljs-comment">// åˆ†å‰²çº¿åšåº¦</span>
  thickness: thickness,
  <span class="hljs-comment">// æ‹–æ‹½çš„æ»‘å—å’Œåˆ†å‰²çº¿</span>
  thumb: _buildThumb(),
  <span class="hljs-comment">// æ»‘å—å€¼æ”¹å˜æ—¶è§¦å‘çš„å›è°ƒ</span>
  onValueChanged: (<span class="hljs-built_in">double</span> value) {
    <span class="hljs-keyword">this</span>.value = value;
    setState(() {});
  },
);
</code></pre>
<p>åˆ†å‰²çº¿ä¸æ»‘å—</p>
<pre><code class="hljs language-dart" lang="dart">Widget _buildThumb() {
  <span class="hljs-keyword">return</span> Stack(
    clipBehavior: Clip.none,
    alignment: Alignment.center,
    children: [
      <span class="hljs-comment">// åˆ†å‰²çº¿</span>
      _buildSliderLine(),
      <span class="hljs-comment">// æ»‘å—</span>
      Positioned(
        left: -(thumbSize - thickness) / <span class="hljs-number">2</span>,
        child: _buildSliderThumb(),
      ),
    ],
  );
}

Widget _buildSliderLine() {
  <span class="hljs-keyword">return</span> Container(
    width: thickness,
    color: Colors.white.withValues(alpha: <span class="hljs-number">0.5</span>),
  );
}
</code></pre>
<p><code>thickness</code> æ˜¯åˆ†å‰²çº¿çš„å®½åº¦ï¼Œä¼ å…¥ç”¨äºæå‰è®¡ç®—å…¶åç§»é‡ã€‚</p>
<p><code>dragOnlyOnSlider</code> é»˜è®¤ä¸º <code>false</code>ï¼Œå³å…¨åŒºåŸŸæ‹–åŠ¨ï¼Œå¦‚æœè®¾ç½®ä¸º <code>true</code>ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œäº¤äº’åŒºåŸŸä¸º <code>_buildSliderLine()</code> è§†å›¾ã€‚</p>
<p>æœ‰æ—¶åˆ†å‰²çº¿çš„å®½åº¦è¾ƒå°ï¼Œè€Œä½ æƒ³æ‰©å¤§äº¤äº’èŒƒå›´æ—¶ï¼Œåˆ™å¯ä»¥é€šè¿‡ <code>extraHitTestArea</code> æ¥å®ç°ï¼Œç»“åˆ <code>debugHitTestAreaColor</code> å¯æ¸…æ™°çŸ¥é“äº¤äº’èŒƒå›´ï¼Œå¦‚æ–‡ç« é¡¶éƒ¨åŠ¨å›¾ä¸­åŠé€æ˜çº¢è‰²ã€‚</p>
<p>ä¸ºäº†ä¸å½±å“ <code>photo_view</code> çš„ç¼©æ”¾æ‰‹åŠ¿ï¼Œå¯ä»¥åœ¨å¼€å§‹è§¦æ‘¸æ»‘å—æ—¶ï¼ˆ<code>onSliderThumbTouchBegin</code> å›è°ƒï¼‰ç¦ç”¨æ‰‹åŠ¿ï¼Œåœ¨ç»“æŸè§¦æ‘¸æ»‘å—æ—¶ï¼ˆ<code>onSliderThumbTouchEnd</code> å›è°ƒï¼‰æ¢å¤æ‰‹åŠ¿å³å¯ã€‚</p>
<h2 data-id="heading-2">ä¸‰ã€æœ€å</h2>
<p>å¥½äº†ï¼Œå¼€æºä¸æ˜“ï¼Œå¦‚æœä½ ä¹Ÿè§‰å¾—è¿™ä¸ªåº“å¥½ç”¨ï¼Œè¯·ä¸åç»™ä¸ª <code>Star</code>  ğŸ‘ ï¼Œå¹¶å¤šå¤šæ”¯æŒï¼</p>
<p><strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FLinXunFeng%2Fflutter_compare_slider" target="_blank" title="https://github.com/LinXunFeng/flutter_compare_slider" ref="nofollow noopener noreferrer">github.com/LinXunFeng/â€¦</a></strong></p>
<p>æœ¬ç¯‡åˆ°æ­¤ç»“æŸï¼Œæ„Ÿè°¢å¤§å®¶çš„æ”¯æŒï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§ï¼ ğŸ‘‹</p>
<blockquote>
<p>å¦‚æœæ–‡ç« å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©, è¯·ä¸åç‚¹å‡»å…³æ³¨ä¸€ä¸‹æˆ‘çš„å¾®ä¿¡å…¬ä¼—å·ï¼š<a href="https://link.juejin.cn/?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" title="https://link.juejin.cn/?target=https%3A%2F%2Fp3-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2F31960a996f1f4b0da35d69ab7480f7d6~tplv-k3u1fbpfcp-zoom-1.image" target="_blank">FSAå…¨æ ˆè¡ŒåŠ¨</a>, è¿™å°†æ˜¯å¯¹æˆ‘æœ€å¤§çš„æ¿€åŠ±. å…¬ä¼—å·ä¸ä»…æœ‰ <code>iOS</code> æŠ€æœ¯ï¼Œè¿˜æœ‰ <code>Android</code>ï¼Œ<code>Flutter</code>ï¼Œ<code>Python</code> ç­‰æ–‡ç« , å¯èƒ½æœ‰ä½ æƒ³è¦äº†è§£çš„æŠ€èƒ½çŸ¥è¯†ç‚¹å“¦~</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript + Web Audio API æ‰“é€ ç‚«é…·éŸ³ä¹å¯è§†åŒ–æ•ˆæœï¼Œè®©ä½ çš„ç½‘é¡µè·ŸéšéŸ³ä¹è·³èµ·æ¥]]></title>    <link>https://juejin.cn/post/7569904733718380563</link>    <guid>https://juejin.cn/post/7569904733718380563</guid>    <pubDate>2025-11-09T07:40:02.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569904733718380563" data-draft-id="7564589390656208930" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript + Web Audio API æ‰“é€ ç‚«é…·éŸ³ä¹å¯è§†åŒ–æ•ˆæœï¼Œè®©ä½ çš„ç½‘é¡µè·ŸéšéŸ³ä¹è·³èµ·æ¥"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T07:40:02.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="åˆ˜å¤§å"/> <meta itemprop="url" content="https://juejin.cn/user/3507878440995946"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript + Web Audio API æ‰“é€ ç‚«é…·éŸ³ä¹å¯è§†åŒ–æ•ˆæœï¼Œè®©ä½ çš„ç½‘é¡µè·ŸéšéŸ³ä¹è·³èµ·æ¥
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3507878440995946/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    åˆ˜å¤§å
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T07:40:02.000Z" title="Sun Nov 09 2025 07:40:02 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»6åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">å‰è¨€</h2>
<p>å¤§å®¶å¥½ï¼æˆ‘æ˜¯å¤§åï¼ä»Šå¤©åˆ†äº«ä¸€ä¸‹æ€ä¹ˆç”¨<code>Web Audio API</code>å’Œ<code>JavaScript</code>å®ç°ä¸€ä¸ªéŸ³ä¹æ—‹å¾‹æ³¢é•¿å¯è§†åŒ–æ•ˆæœã€‚</p>
<h3 data-id="heading-1">æ•ˆæœé¢„è§ˆ</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/9bdac7a16d0640c8b70da8229b5ae462~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YiY5aSn5Y2O:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763278802&amp;x-signature=H8H5cyOds0MvrrN2Yr45e3oCoL4%3D" alt="20251017_115321.gif" loading="lazy"/></p>
<p>å®ç°çš„æ•ˆæœï¼šä¸€ä¸ªåŠ¨æ€å“åº”éŸ³ä¹é¢‘ç‡çš„å¯è§†åŒ–ç•Œé¢ï¼ŒéŸ³é¢‘æ¡ä¼šéšç€éŸ³ä¹çš„èŠ‚å¥å’Œæ—‹å¾‹èµ·ä¼å˜åŒ–ï¼Œå½¢æˆæ³¢å½¢å›¾æ•ˆæœã€‚</p>
<p><strong>å®Œæ•´æºç åœ¨æ–‡æœ«~</strong></p>
<h3 data-id="heading-2">æŠ€æœ¯æ ¸å¿ƒï¼šWeb Audio API</h3>
<p>è¦å®ç°éŸ³ä¹å¯è§†åŒ–ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°æµè§ˆå™¨çš„<strong>Web Audio API</strong>ã€‚è¿™ä¸ªå¼ºå¤§çš„APIå…è®¸æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­å¤„ç†å’Œåˆ†æéŸ³é¢‘æ•°æ®ã€‚</p>
<h2 data-id="heading-3">ä»£ç å®ç°è¯¦è§£</h2>
<p>åœ¨å¼€å§‹ç¼–ç å‰ï¼Œæˆ‘ä»¬å…ˆç†è§£Web Audio APIçš„å·¥ä½œæµç¨‹ï¼š</p>
<pre><code class="hljs">éŸ³é¢‘è¾“å…¥ â†’ AudioContext â†’ AnalyserNode â†’ é¢‘ç‡æ•°æ® â†’ å¯è§†åŒ–æ¸²æŸ“
</code></pre>
<h3 data-id="heading-4">å…³é”®ç»„ä»¶ï¼š</h3>
<p><strong>1.AudioContext</strong>ï¼šéŸ³é¢‘å¤„ç†çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ
<strong>2.AnalyserNode</strong>ï¼šåˆ†æéŸ³é¢‘æ•°æ®çš„èŠ‚ç‚¹
<strong>3.Frequency Data</strong>ï¼šé¢‘ç‡æ•°æ®æ•°ç»„
<strong>4.requestAnimationFrame</strong>ï¼šå®ç°å¹³æ»‘åŠ¨ç”»</p>
<h3 data-id="heading-5">1. åˆ›å»ºåŸºç¡€HTMLç»“æ„</h3>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>éŸ³ä¹å¯è§†åŒ–<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="css">
        <span class="hljs-comment">/* CSSæ ·å¼ */</span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>éŸ³ä¹æ—‹å¾‹æ³¢é•¿å¯è§†åŒ–<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- å¯è§†åŒ–åŒºåŸŸ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"visualizer-container"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bars-container"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"barsContainer"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- æ§åˆ¶åŒºåŸŸ --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"controls"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"startBtn"</span>&gt;</span>å¼€å§‹å¯è§†åŒ–<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"file"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"audioFile"</span> <span class="hljs-attr">accept</span>=<span class="hljs-string">"audio/*"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">label</span> <span class="hljs-attr">for</span>=<span class="hljs-string">"audioFile"</span>&gt;</span>é€‰æ‹©éŸ³é¢‘æ–‡ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">label</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"stopBtn"</span>&gt;</span>åœæ­¢<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        
        <span class="hljs-comment">&lt;!-- éŸ³é¢‘ä¿¡æ¯æ˜¾ç¤º --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"audio-info"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"trackInfo"</span>&gt;</span>æœªé€‰æ‹©éŸ³é¢‘æ–‡ä»¶<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"frequency-info"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ä½é¢‘: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"lowFreq"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> Hz<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>ä¸­é¢‘: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"midFreq"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> Hz<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>é«˜é¢‘: <span class="hljs-tag">&lt;<span class="hljs-name">span</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"highFreq"</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span> Hz<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">
        <span class="hljs-comment">// JavaScriptä»£ç </span>
    </span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<p><strong>è®¾è®¡æ€è·¯ï¼š</strong></p>
<ul>
<li>æ¨¡å—åŒ–å¸ƒå±€ï¼šæ ‡é¢˜ã€å¯è§†åŒ–åŒºã€æ§åˆ¶åŒºã€ä¿¡æ¯åŒº</li>
<li>è¯­ä¹‰åŒ–IDå‘½åï¼šä¾¿äºJavaScriptæ“ä½œ</li>
</ul>
<h3 data-id="heading-6">2. åŠ¨æ€åˆ›å»ºéŸ³é¢‘æ¡</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// è·å–DOMå…ƒç´ </span>
<span class="hljs-keyword">const</span> barsContainer = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'barsContainer'</span>);

<span class="hljs-comment">// åˆ›å»º64ä¸ªéŸ³é¢‘æ¡</span>
<span class="hljs-keyword">const</span> barCount = <span class="hljs-number">64</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; barCount; i++) {
    <span class="hljs-keyword">const</span> bar = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    bar.<span class="hljs-property">className</span> = <span class="hljs-string">'bar'</span>;
    bar.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'5px'</span>;  <span class="hljs-comment">// åˆå§‹é«˜åº¦</span>
    barsContainer.<span class="hljs-title function_">appendChild</span>(bar);
}
<span class="hljs-keyword">const</span> bars = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelectorAll</span>(<span class="hljs-string">'.bar'</span>);
</code></pre>
<p><strong>æŠ€æœ¯è¦ç‚¹ï¼š</strong></p>
<ul>
<li>ä¸ºä»€ä¹ˆé€‰æ‹©64ä¸ªéŸ³é¢‘æ¡ï¼Ÿè¿™æ˜¯æ€§èƒ½ä¸æ•ˆæœçš„å¹³è¡¡ç‚¹</li>
<li>åˆå§‹é«˜åº¦5pxç¡®ä¿éŸ³é¢‘æ¡å§‹ç»ˆå¯è§</li>
<li>ä½¿ç”¨CSS Flexå¸ƒå±€è‡ªåŠ¨æ’åˆ—</li>
</ul>
<h3 data-id="heading-7">3. éŸ³é¢‘æ¡æ ·å¼è®¾è®¡</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.bar</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-number">12px</span>;
    <span class="hljs-attribute">background</span>: <span class="hljs-built_in">linear-gradient</span>(to top, <span class="hljs-number">#ff6b6b</span>, <span class="hljs-number">#ffde7d</span>, <span class="hljs-number">#6a98f0</span>);
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">6px</span> <span class="hljs-number">6px</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span>;
    <span class="hljs-attribute">transition</span>: height <span class="hljs-number">0.1s</span> ease-out;
    <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">106</span>, <span class="hljs-number">152</span>, <span class="hljs-number">240</span>, <span class="hljs-number">0.5</span>);
}

<span class="hljs-selector-class">.bars-container</span> {
    <span class="hljs-attribute">display</span>: flex;
    <span class="hljs-attribute">justify-content</span>: center;
    <span class="hljs-attribute">align-items</span>: flex-end;  <span class="hljs-comment">/* å…³é”®ï¼šä»åº•éƒ¨å‘ä¸Šç”Ÿé•¿ */</span>
    <span class="hljs-attribute">height</span>: <span class="hljs-number">200px</span>;
    <span class="hljs-attribute">width</span>: <span class="hljs-number">90%</span>;
    <span class="hljs-attribute">gap</span>: <span class="hljs-number">4px</span>;
}
</code></pre>
<p><strong>è®¾è®¡åŸç†ï¼š</strong></p>
<ul>
<li><code>align-items: flex-end</code>ï¼šè®©æŸ±å­ä»åº•éƒ¨å¼€å§‹ç”Ÿé•¿</li>
<li><code>transition: height 0.1s</code>ï¼šå¹³æ»‘çš„é«˜åº¦å˜åŒ–åŠ¨ç”»</li>
<li>æ¸å˜èƒŒæ™¯ï¼šä»çº¢è‰²åˆ°é»„è‰²åˆ°è“è‰²çš„è§†è§‰å±‚æ¬¡</li>
</ul>
<h3 data-id="heading-8">4. åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡å’Œåˆ†æå™¨</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">let</span> audioContext;
<span class="hljs-keyword">let</span> analyser;
<span class="hljs-keyword">let</span> source;
<span class="hljs-keyword">let</span> dataArray;
<span class="hljs-keyword">let</span> bufferLength;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">initAudioContext</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!audioContext) {
        <span class="hljs-comment">// åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆå…¼å®¹ä¸åŒæµè§ˆå™¨ï¼‰</span>
        audioContext = <span class="hljs-keyword">new</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">AudioContext</span> || <span class="hljs-variable language_">window</span>.<span class="hljs-property">webkitAudioContext</span>)();
        
        <span class="hljs-comment">// åˆ›å»ºåˆ†æå™¨èŠ‚ç‚¹</span>
        analyser = audioContext.<span class="hljs-title function_">createAnalyser</span>();
        
        <span class="hljs-comment">// è®¾ç½®FFTå¤§å°ï¼Œå½±å“é¢‘ç‡åˆ†æçš„ç²¾ç»†åº¦</span>
        analyser.<span class="hljs-property">fftSize</span> = <span class="hljs-number">256</span>;
        
        <span class="hljs-comment">// è·å–é¢‘ç‡æ•°æ®æ•°ç»„é•¿åº¦</span>
        bufferLength = analyser.<span class="hljs-property">frequencyBinCount</span>;  <span class="hljs-comment">// 128</span>
        
        <span class="hljs-comment">// åˆ›å»ºç”¨äºå­˜å‚¨é¢‘ç‡æ•°æ®çš„æ•°ç»„</span>
        dataArray = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(bufferLength);
    }
}
</code></pre>
<p><strong>æ ¸å¿ƒæ¦‚å¿µè§£æï¼š</strong></p>
<p><strong>FFTï¼ˆå¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼‰</strong></p>
<ul>
<li>ä½œç”¨ï¼šå°†æ—¶åŸŸä¿¡å·è½¬æ¢ä¸ºé¢‘åŸŸä¿¡å·</li>
<li>fftSize=256ï¼šå°†éŸ³é¢‘åˆ†æˆ256ä¸ªé‡‡æ ·ç‚¹è¿›è¡Œåˆ†æ</li>
<li>frequencyBinCount=128ï¼šå¾—åˆ°128ä¸ªé¢‘ç‡åŒºé—´æ•°æ®</li>
</ul>
<p><strong>Uint8Array</strong></p>
<ul>
<li>8ä½æ— ç¬¦å·æ•´æ•°æ•°ç»„</li>
<li>å–å€¼èŒƒå›´ï¼š0-255</li>
<li>æ¯ä¸ªå€¼ä»£è¡¨å¯¹åº”é¢‘ç‡åŒºé—´çš„æŒ¯å¹…</li>
</ul>
<h3 data-id="heading-9">5. åŠ¨ç”»å¾ªç¯å‡½æ•°</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">animate</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!isPlaying) <span class="hljs-keyword">return</span>;
    
    <span class="hljs-comment">// è·å–å®æ—¶é¢‘ç‡æ•°æ®</span>
    analyser.<span class="hljs-title function_">getByteFrequencyData</span>(dataArray);
    
    <span class="hljs-comment">// æ›´æ–°æ‰€æœ‰éŸ³é¢‘æ¡</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; bars.<span class="hljs-property">length</span>; i++) {
        <span class="hljs-keyword">const</span> value = dataArray[i];
        <span class="hljs-keyword">const</span> percent = value / <span class="hljs-number">256</span>;  <span class="hljs-comment">// è½¬æ¢ä¸ºç™¾åˆ†æ¯”</span>
        <span class="hljs-keyword">const</span> height = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(percent * <span class="hljs-number">200</span>, <span class="hljs-number">5</span>);  <span class="hljs-comment">// è®¡ç®—é«˜åº¦</span>
        
        bars[i].<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">`<span class="hljs-subst">${height}</span>px`</span>;
        
        <span class="hljs-comment">// åŠ¨æ€é¢œè‰²ï¼šæ ¹æ®é¢‘ç‡ä½ç½®å˜åŒ–</span>
        <span class="hljs-keyword">const</span> hue = i * <span class="hljs-number">360</span> / bars.<span class="hljs-property">length</span>;
        bars[i].<span class="hljs-property">style</span>.<span class="hljs-property">background</span> = <span class="hljs-string">`linear-gradient(to top, 
            hsl(<span class="hljs-subst">${hue}</span>, 100%, 50%), 
            hsl(<span class="hljs-subst">${hue + <span class="hljs-number">30</span>}</span>, 100%, 70%), 
            hsl(<span class="hljs-subst">${hue + <span class="hljs-number">60</span>}</span>, 100%, 50%))`</span>;
    }
    
    <span class="hljs-comment">// æ›´æ–°é¢‘ç‡ä¿¡æ¯æ˜¾ç¤º</span>
    <span class="hljs-title function_">updateFrequencyInfo</span>();
    
    <span class="hljs-comment">// å¾ªç¯è°ƒç”¨</span>
    <span class="hljs-title function_">requestAnimationFrame</span>(animate);
}
</code></pre>
<p><strong>æŠ€æœ¯æ·±åº¦è§£æï¼š</strong></p>
<p><strong>getByteFrequencyData()</strong></p>
<ul>
<li>åŠŸèƒ½ï¼šå°†å½“å‰éŸ³é¢‘çš„é¢‘ç‡æ•°æ®å¡«å……åˆ°æŒ‡å®šæ•°ç»„</li>
<li>æ•°æ®åˆ†å¸ƒï¼šä½é¢‘åœ¨æ•°ç»„å¼€å¤´ï¼Œé«˜é¢‘åœ¨æ•°ç»„æœ«å°¾</li>
<li>å®æ—¶æ€§ï¼šæ¯å¸§è·å–çš„éƒ½æ˜¯æœ€æ–°æ•°æ®</li>
</ul>
<p><strong>HSLè‰²å½©æ¨¡å‹</strong></p>
<ul>
<li>Hï¼ˆè‰²ç›¸ï¼‰ï¼š0-360åº¦ï¼Œå®ç°å½©è™¹æ•ˆæœ</li>
<li>Sï¼ˆé¥±å’Œåº¦ï¼‰ï¼š100%ï¼Œé²œè‰³çš„é¢œè‰²</li>
<li>Lï¼ˆäº®åº¦ï¼‰ï¼š50%ï¼Œé€‚ä¸­çš„äº®åº¦</li>
</ul>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong></p>
<ul>
<li><code>Math.max(percent * 200, 5)</code>ï¼šç¡®ä¿æœ€å°é«˜åº¦ï¼Œé¿å…é—ªçƒ</li>
<li><code>requestAnimationFrame</code>ï¼šæµè§ˆå™¨ä¼˜åŒ–çš„60fpsåŠ¨ç”»</li>
</ul>
<h3 data-id="heading-10">6. é¢‘ç‡ä¿¡æ¯æ˜¾ç¤º</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateFrequencyInfo</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// ä½é¢‘ï¼šç´¢å¼•2ï¼Œçº¦0-250Hzï¼ˆé¼“å£°ã€è´æ–¯ï¼‰</span>
    <span class="hljs-keyword">const</span> lowFreqValue = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(dataArray[<span class="hljs-number">2</span>] * <span class="hljs-number">2</span>);
    
    <span class="hljs-comment">// ä¸­é¢‘ï¼šç´¢å¼•8ï¼Œçº¦250-2000Hzï¼ˆäººå£°ã€ä¸»æ—‹å¾‹ï¼‰</span>
    <span class="hljs-keyword">const</span> midFreqValue = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(dataArray[<span class="hljs-number">8</span>] * <span class="hljs-number">4</span>);
    
    <span class="hljs-comment">// é«˜é¢‘ï¼šç´¢å¼•20ï¼Œçº¦2000Hzä»¥ä¸Šï¼ˆé•²ç‰‡ã€ç»†èŠ‚ï¼‰</span>
    <span class="hljs-keyword">const</span> highFreqValue = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(dataArray[<span class="hljs-number">20</span>] * <span class="hljs-number">8</span>);
    
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'lowFreq'</span>).<span class="hljs-property">textContent</span> = lowFreqValue;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'midFreq'</span>).<span class="hljs-property">textContent</span> = midFreqValue;
    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'highFreq'</span>).<span class="hljs-property">textContent</span> = highFreqValue;
}
</code></pre>
<p><strong>é¢‘ç‡åˆ†å¸ƒåŸç†ï¼š</strong></p>
<ul>
<li>æ•°ç»„ç´¢å¼•å¯¹åº”ä¸åŒçš„é¢‘ç‡èŒƒå›´</li>
<li>ä¹˜æ•°ç³»æ•°ç”¨äºæ”¾å¤§æ˜¾ç¤ºæ•ˆæœ</li>
<li>å®é™…åº”ç”¨ä¸­å¯ä»¥è°ƒæ•´è¿™äº›å‚æ•°æ¥åŒ¹é…ä¸åŒéŸ³ä¹ç±»å‹</li>
</ul>
<h3 data-id="heading-11">7. æ–‡ä»¶ä¸Šä¼ å¤„ç†</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'audioFile'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) {
    <span class="hljs-keyword">const</span> file = e.<span class="hljs-property">target</span>.<span class="hljs-property">files</span>[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span> (file) {
        <span class="hljs-keyword">const</span> objectUrl = <span class="hljs-variable constant_">URL</span>.<span class="hljs-title function_">createObjectURL</span>(file);
        <span class="hljs-title function_">playAudioFile</span>(objectUrl);
        <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'trackInfo'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-string">`æ­£åœ¨æ’­æ”¾: <span class="hljs-subst">${file.name}</span>`</span>;
    }
});

<span class="hljs-keyword">function</span> <span class="hljs-title function_">playAudioFile</span>(<span class="hljs-params">url</span>) {
    <span class="hljs-title function_">initAudioContext</span>();
    
    <span class="hljs-comment">// åœæ­¢ä¹‹å‰çš„éŸ³é¢‘</span>
    <span class="hljs-keyword">if</span> (source &amp;&amp; source.<span class="hljs-property">stop</span>) {
        source.<span class="hljs-title function_">stop</span>();
    }
    
    <span class="hljs-comment">// åˆ›å»ºéŸ³é¢‘å…ƒç´ </span>
    <span class="hljs-keyword">const</span> audio = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Audio</span>();
    audio.<span class="hljs-property">src</span> = url;
    audio.<span class="hljs-property">crossOrigin</span> = <span class="hljs-string">"anonymous"</span>;  <span class="hljs-comment">// è§£å†³CORSé—®é¢˜</span>
    
    <span class="hljs-comment">// è¿æ¥åˆ°Web Audio API</span>
    source = audioContext.<span class="hljs-title function_">createMediaElementSource</span>(audio);
    source.<span class="hljs-title function_">connect</span>(analyser);
    analyser.<span class="hljs-title function_">connect</span>(audioContext.<span class="hljs-property">destination</span>);
    
    <span class="hljs-comment">// å¼€å§‹æ’­æ”¾</span>
    audio.<span class="hljs-title function_">play</span>();
    isPlaying = <span class="hljs-literal">true</span>;
    
    <span class="hljs-comment">// å¼€å§‹åŠ¨ç”»</span>
    <span class="hljs-title function_">animate</span>();
}
</code></pre>
<p><strong>å…³é”®æŠ€æœ¯ç‚¹ï¼š</strong></p>
<p><strong>createObjectURL()</strong></p>
<ul>
<li>åˆ›å»ºæŒ‡å‘æœ¬åœ°æ–‡ä»¶çš„ä¸´æ—¶URL</li>
<li>é¿å…ç›´æ¥æ–‡ä»¶è·¯å¾„è®¿é—®çš„å®‰å…¨é™åˆ¶</li>
</ul>
<p><strong>createMediaElementSource()</strong></p>
<ul>
<li>å°†æ™®é€šAudioå…ƒç´ è½¬æ¢ä¸ºWeb AudioèŠ‚ç‚¹</li>
<li>å»ºç«‹éŸ³é¢‘å¤„ç†ç®¡é“</li>
</ul>
<p><strong>CORSå¤„ç†</strong></p>
<ul>
<li><code>crossOrigin="anonymous"</code>è§£å†³è·¨åŸŸèµ„æºè®¿é—®</li>
<li>å¿…è¦çš„å®‰å…¨æªæ–½</li>
</ul>
<h3 data-id="heading-12">8. æ§åˆ¶æŒ‰é’®é€»è¾‘</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'startBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (!isPlaying) {
        <span class="hljs-keyword">if</span> (!source) {
            <span class="hljs-title function_">createOscillator</span>();  <span class="hljs-comment">// é»˜è®¤æ¼”ç¤ºéŸ³é¢‘</span>
        }
        <span class="hljs-title function_">initAudioContext</span>();
        isPlaying = <span class="hljs-literal">true</span>;
        <span class="hljs-title function_">animate</span>();
    }
});

<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'stopBtn'</span>).<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">if</span> (isPlaying) {
        isPlaying = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">if</span> (source &amp;&amp; source.<span class="hljs-property">stop</span>) {
            source.<span class="hljs-title function_">stop</span>();
            source = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-comment">// é‡ç½®éŸ³é¢‘æ¡</span>
        bars.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">bar</span> =&gt;</span> {
            bar.<span class="hljs-property">style</span>.<span class="hljs-property">height</span> = <span class="hljs-string">'5px'</span>;
        });
    }
});
</code></pre>
<h3 data-id="heading-13">9. åˆ›å»ºæ¼”ç¤ºéŸ³é¢‘æº</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">createOscillator</span>(<span class="hljs-params"/>) {
    <span class="hljs-title function_">initAudioContext</span>();
    
    <span class="hljs-keyword">const</span> oscillator = audioContext.<span class="hljs-title function_">createOscillator</span>();
    oscillator.<span class="hljs-property">type</span> = <span class="hljs-string">'sawtooth'</span>;  <span class="hljs-comment">// é”¯é½¿æ³¢ï¼Œè°æ³¢ä¸°å¯Œ</span>
    oscillator.<span class="hljs-property">frequency</span>.<span class="hljs-title function_">setValueAtTime</span>(<span class="hljs-number">220</span>, audioContext.<span class="hljs-property">currentTime</span>);  <span class="hljs-comment">// A3éŸ³</span>
    
    <span class="hljs-keyword">const</span> gainNode = audioContext.<span class="hljs-title function_">createGain</span>();
    gainNode.<span class="hljs-property">gain</span>.<span class="hljs-property">value</span> = <span class="hljs-number">0.1</span>;  <span class="hljs-comment">// éŸ³é‡æ§åˆ¶</span>
    
    oscillator.<span class="hljs-title function_">connect</span>(gainNode);
    gainNode.<span class="hljs-title function_">connect</span>(analyser);
    analyser.<span class="hljs-title function_">connect</span>(audioContext.<span class="hljs-property">destination</span>);
    
    oscillator.<span class="hljs-title function_">start</span>();
    source = oscillator;
}
</code></pre>
<p><strong>éŸ³é¢‘åˆæˆåŸç†ï¼š</strong></p>
<ul>
<li>æŒ¯è¡å™¨ç±»å‹å½±å“éŸ³è‰²ç‰¹æ€§</li>
<li>å¢ç›ŠèŠ‚ç‚¹æ§åˆ¶è¾“å‡ºéŸ³é‡</li>
<li>220Hzå¯¹åº”é’¢ç´çš„A3éŸ³</li>
</ul>
<h2 data-id="heading-14">åŸç†è§£æï¼šéŸ³é¢‘å¯è§†åŒ–æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2>
<h3 data-id="heading-15">1. éŸ³é¢‘åˆ†æåŸºç¡€</h3>
<p>å½“å£°éŸ³é€šè¿‡éº¦å…‹é£æˆ–éŸ³é¢‘æ–‡ä»¶è¿›å…¥Web Audio APIæ—¶ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ç³»åˆ—è¿ç»­çš„æ³¢å½¢ã€‚AnalyserNodeå°†è¿™äº›æ³¢å½¢é€šè¿‡<strong>å‚…é‡Œå¶å˜æ¢</strong>è½¬æ¢ä¸ºé¢‘ç‡æ•°æ®ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå‚…é‡Œå¶å˜æ¢å¯ä»¥å°†å¤æ‚çš„æ³¢å½¢åˆ†è§£ä¸ºä¸åŒé¢‘ç‡çš„ç®€å•æ­£å¼¦æ³¢ç»„åˆã€‚</p>
<h3 data-id="heading-16">2. é¢‘ç‡æ•°æ®</h3>
<p><code>getByteFrequencyData</code>æ–¹æ³•è¿”å›ä¸€ä¸ªUint8Arrayï¼ˆ8ä½æ— ç¬¦å·æ•´æ•°æ•°ç»„ï¼‰ï¼Œå…¶ä¸­æ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªç‰¹å®šé¢‘ç‡åŒºé—´çš„æŒ¯å¹…å€¼ï¼ŒèŒƒå›´ä»0åˆ°255ã€‚</p>
<h3 data-id="heading-17">3. å¯è§†åŒ–æ˜ å°„</h3>
<p>æˆ‘ä»¬å°†è¿™äº›æ•°å€¼æ˜ å°„åˆ°éŸ³é¢‘æ¡çš„é«˜åº¦å’Œé¢œè‰²ï¼š</p>
<ul>
<li>å€¼è¶Šå¤§ï¼ŒéŸ³é¢‘æ¡è¶Šé«˜</li>
<li>ä¸åŒçš„é¢‘ç‡åŒºé—´å¯¹åº”ä¸åŒçš„é¢œè‰²</li>
</ul>
<h2 data-id="heading-18">é¡¹ç›®æ€»ç»“</h2>
<p><strong>å·²å®ç°åŠŸèƒ½</strong></p>
<ul>
<li>éŸ³é¢‘æ–‡ä»¶ä¸Šä¼ å’Œæ’­æ”¾</li>
<li>å®æ—¶é¢‘ç‡åˆ†æå’Œå¯è§†åŒ–</li>
<li>åŠ¨æ€é¢œè‰²å˜åŒ–æ•ˆæœ</li>
<li>é¢‘ç‡åˆ†åŒºä¿¡æ¯æ˜¾ç¤º</li>
<li>å“åº”å¼äº¤äº’æ§åˆ¶</li>
</ul>
<p><strong>é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ï¼š</strong></p>
<ul>
<li>Web Audio APIçš„åŸºæœ¬ä½¿ç”¨</li>
<li>å¦‚ä½•è·å–å’Œåˆ†æéŸ³é¢‘é¢‘ç‡æ•°æ®</li>
<li>ä½¿ç”¨JavaScriptå’ŒCSSåˆ›å»ºåŠ¨æ€å¯è§†åŒ–æ•ˆæœ</li>
<li>å¤„ç†ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶</li>
</ul>
<p>å®Œæ•´ä»£ç åœ¨æˆ‘çš„Githubä»“åº“ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ã€‚</p>
<p>Githubåœ°å€ï¼š
<strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2F1344160559-lch%2Fdh-vue3-component%2Fblob%2Fmain%2FAudioVisualization%2Findex.html" target="_blank" title="https://github.com/1344160559-lch/dh-vue3-component/blob/main/AudioVisualization/index.html" ref="nofollow noopener noreferrer">github.com/1344160559-â€¦</a></strong></p>
<blockquote>
<p>æœ¬æ–‡é¦–å‘äºå…¬ä¼—å·ï¼šç¨‹åºå‘˜åˆ˜å¤§åï¼Œä¸“æ³¨åˆ†äº«å‰åç«¯å¼€å‘çš„å®æˆ˜ç¬”è®°ã€‚å…³æ³¨æˆ‘ï¼Œå°‘èµ°å¼¯è·¯ï¼Œä¸€èµ·è¿›æ­¥ï¼</p>
</blockquote>
<h4 data-id="heading-19">ğŸ“Œå¾€æœŸç²¾å½©</h4>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FP7SMincYFKERZbNKAFtzGQ" target="_blank" title="https://mp.weixin.qq.com/s/P7SMincYFKERZbNKAFtzGQ" ref="nofollow noopener noreferrer">ã€Šè¿™20æ¡SQLä¼˜åŒ–æ–¹æ¡ˆï¼Œè®©ä½ çš„æ•°æ®åº“æŸ¥è¯¢é€Ÿåº¦æå‡10å€ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fy-GJ26kl0-yT6hE3fy2KjQ" target="_blank" title="https://mp.weixin.qq.com/s/y-GJ26kl0-yT6hE3fy2KjQ" ref="nofollow noopener noreferrer">ã€ŠMySQL ä¸ºä»€ä¹ˆä¸æ¨èç”¨é›ªèŠ±ID å’Œ UUID åšä¸»é”®ï¼Ÿã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F1Th3DuMqYpt4Xg5hEywIww" target="_blank" title="https://mp.weixin.qq.com/s/1Th3DuMqYpt4Xg5hEywIww" ref="nofollow noopener noreferrer">ã€Šç”¨htmlå†™äº†ä¸ªè¶…å¥½ç”¨çš„ç½‘é¡µä¸»é¢˜åˆ‡æ¢æ’ä»¶ã€‹</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FfSMv8b_2Z-kozaBeiCgqrA" target="_blank" title="https://mp.weixin.qq.com/s/fSMv8b_2Z-kozaBeiCgqrA" ref="nofollow noopener noreferrer">ã€ŠSpringBoot3+Vue3å®ç°çš„æ•°æ®åº“æ–‡æ¡£å·¥å…·ï¼Œè‡ªåŠ¨ç”ŸæˆMarkdown/HTMLã€‹</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Webpackï¼šä»æ„å»ºæµç¨‹åˆ°æ€§èƒ½ä¼˜åŒ–çš„æ·±åº¦æ¢ç´¢]]></title>    <link>https://juejin.cn/post/7569960869960368174</link>    <guid>https://juejin.cn/post/7569960869960368174</guid>    <pubDate>2025-11-09T12:35:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7569960869960368174" data-draft-id="7570201730991505434" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" Webpackï¼šä»æ„å»ºæµç¨‹åˆ°æ€§èƒ½ä¼˜åŒ–çš„æ·±åº¦æ¢ç´¢"/> <meta itemprop="keywords" content="Webpack,å‰ç«¯å·¥ç¨‹åŒ–,JavaScript"/> <meta itemprop="datePublished" content="2025-11-09T12:35:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="answerball"/> <meta itemprop="url" content="https://juejin.cn/user/209320781557531"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             Webpackï¼šä»æ„å»ºæµç¨‹åˆ°æ€§èƒ½ä¼˜åŒ–çš„æ·±åº¦æ¢ç´¢
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/209320781557531/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    answerball
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-09T12:35:37.000Z" title="Sun Nov 09 2025 12:35:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-09
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="github-gist">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fff;color:#333}.hljs-comment,.hljs-meta{color:#969896}.hljs-emphasis,.hljs-quote,.hljs-strong,.hljs-template-variable,.hljs-variable{color:#df5000}.hljs-keyword,.hljs-selector-tag,.hljs-type{color:#d73a49}.hljs-attribute,.hljs-bullet,.hljs-literal,.hljs-symbol{color:#0086b3}.hljs-name,.hljs-section{color:#63a35c}.hljs-tag{color:#333}.hljs-attr,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-id,.hljs-selector-pseudo,.hljs-title{color:#6f42c1}.hljs-addition{color:#55a532;background-color:#eaffea}.hljs-deletion{color:#bd2c00;background-color:#ffecec}.hljs-link{text-decoration:underline}.hljs-number{color:#005cc5}.hljs-string{color:#032f62}</style><p><strong>å¼•è¨€ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦æ„å»ºå·¥å…·ï¼Ÿ</strong></p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå¤æ‚çš„å‰ç«¯åº”ç”¨ï¼Œæœ‰å‡ åä¸ªJavaScriptæ–‡ä»¶ã€å‡ åä¸ªCSSæ–‡ä»¶ã€å„ç§å›¾ç‰‡å’Œå­—ä½“èµ„æºã€‚å¦‚æœæ‰‹åŠ¨ç®¡ç†è¿™äº›æ–‡ä»¶çš„ä¾èµ–å…³ç³»ã€åˆå¹¶ã€å‹ç¼©ï¼Œé‚£å°†æ˜¯ä¸€åœºå™©æ¢¦ã€‚è¿™å°±æ˜¯Webpackç­‰æ„å»ºå·¥å…·è¯ç”Ÿçš„åŸå› â€”â€”å®ƒä»¬åƒä¸€ä½ç»†å¿ƒçš„ç®¡å®¶ï¼Œå¸®æˆ‘ä»¬æ‰“ç†å‰ç«¯é¡¹ç›®ä¸­çš„å„ç§èµ„æºï¼Œè®©å¼€å‘å˜å¾—é«˜æ•ˆè€Œæ„‰å¿«ã€‚</p>
<p>ä½œä¸ºå‰ç«¯å¼€å‘é¢†åŸŸæœ€æµè¡Œçš„æ„å»ºå·¥å…·ä¹‹ä¸€ï¼ŒWebpackå·²ç»æˆä¸ºäº†ç°ä»£Webå¼€å‘ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚æœ¬æ–‡å°†å¸¦ä½ æ·±å…¥æ¢ç´¢Webpackçš„æ„å»ºæœºåˆ¶ï¼Œå¹¶åˆ†äº«ä¸€ç³»åˆ—æå‡å¼€å‘æ•ˆç‡çš„å®ç”¨æŠ€å·§ã€‚</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a3c1fcfc332450c8738452b7fcd9f3e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYW5zd2VyYmFsbA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296537&amp;x-signature=fs9CxMtzbLXdGwebCmHIQ8%2BpNkg%3D" alt="image.png" width="50%" loading="lazy"/></p>
<h2 data-id="heading-0">ä¸€ã€Webpackæ„å»ºæµç¨‹ï¼šä¸€åœºç²¾å¿ƒç¼–æ’çš„æ¼”å‡º</h2>
<p>Webpackçš„æ„å»ºè¿‡ç¨‹å°±åƒä¸€åœºç²¾å¿ƒç¼–æ’çš„æ¼”å‡ºï¼Œæ¯ä¸ªç¯èŠ‚éƒ½æœ‰æ˜ç¡®çš„èŒè´£å’Œé¡ºåºã€‚è®©æˆ‘ä»¬æ­å¼€è¿™åœºæ¼”å‡ºçš„å¹•åç§˜å¯†ã€‚</p>
<h3 data-id="heading-1">1.1 åˆå§‹åŒ–é˜¶æ®µï¼šå‡†å¤‡èˆå°</h3>
<p>ä¸€åˆ‡å§‹äºå‚æ•°åˆå§‹åŒ–ã€‚Webpackä¼šä»é…ç½®æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯webpack.config.jsï¼‰å’ŒShellå‘½ä»¤ä¸­è¯»å–å‚æ•°ï¼Œç„¶ååˆå¹¶è¿™äº›å‚æ•°ï¼Œå¾—å‡ºæœ€ç»ˆçš„é…ç½®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack.config.js ç¤ºä¾‹</span>
<span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>
  },
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'development'</span>
};
</code></pre>
<p>åœ¨è¿™ä¸ªé˜¶æ®µï¼ŒWebpackä¼šåˆå§‹åŒ–Compilerå¯¹è±¡â€”â€”è¿™æ˜¯æ•´ä¸ªæ„å»ºè¿‡ç¨‹çš„å¤§è„‘ï¼Œè´Ÿè´£è°ƒåº¦å’Œæ‰§è¡Œå„ä¸ªæ„å»ºä»»åŠ¡ã€‚åŒæ—¶ï¼Œæ‰€æœ‰é…ç½®çš„æ’ä»¶ä¼šè¢«åŠ è½½ï¼Œå¹¶æ³¨å†Œåˆ°å¯¹åº”çš„äº‹ä»¶é’©å­ä¸Šã€‚</p>
<h3 data-id="heading-2">1.2 ç¼–è¯‘é˜¶æ®µï¼šæ¼”å‘˜å°±ä½</h3>
<p>ç¼–è¯‘é˜¶æ®µæ˜¯æ„å»ºè¿‡ç¨‹çš„æ ¸å¿ƒï¼Œå®ƒåˆå¯ä»¥åˆ†ä¸ºå‡ ä¸ªå…³é”®æ­¥éª¤ï¼š</p>
<p><strong>ç¡®å®šå…¥å£</strong></p>
<p>Webpackä»é…ç½®çš„entryå¼€å§‹ï¼Œåƒä¾¦æ¢ä¸€æ ·è¿½è¸ªæ¯ä¸€ä¸ªä¾èµ–ã€‚å‡è®¾æˆ‘ä»¬çš„å…¥å£æ–‡ä»¶æ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// src/index.js</span>
<span class="hljs-keyword">import</span> { utils } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-keyword">import</span> <span class="hljs-string">'./styles.css'</span>;

utils.<span class="hljs-title function_">sayHello</span>();
</code></pre>
<p>Webpackä¼šå…ˆå¤„ç†index.jsï¼Œç„¶åå‘ç°å®ƒä¾èµ–utils.jså’Œstyles.cssï¼Œæ¥ç€å»å¤„ç†è¿™äº›æ–‡ä»¶ï¼Œå†å‘ç°è¿™äº›æ–‡ä»¶çš„ä¾èµ–...å¦‚æ­¤é€’å½’ä¸‹å»ï¼Œæœ€ç»ˆå½¢æˆä¸€ä¸ªå®Œæ•´çš„ä¾èµ–å›¾ã€‚</p>
<p><strong>ç¼–è¯‘æ¨¡å—</strong></p>
<p>å¯¹äºæ¯ä¸ªæ¨¡å—ï¼ŒWebpackä¼šæ ¹æ®é…ç½®çš„loaderå¯¹å…¶è¿›è¡Œ"ç¿»è¯‘"ã€‚æ¯”å¦‚ï¼Œå¯¹äºCSSæ–‡ä»¶ï¼Œcss-loaderä¼šå¤„ç†å…¶ä¸­çš„@importå’Œurl()ï¼Œstyle-loaderåˆ™ä¼šå°†CSSæ³¨å…¥åˆ°DOMä¸­ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpacké…ç½®ä¸­çš„loaderéƒ¨åˆ†</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>]
      },
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-attr">use</span>: <span class="hljs-string">'babel-loader'</span>
      }
    ]
  }
};
</code></pre>
<p>è¿™ä¸ªè¿‡ç¨‹å°±åƒæŠŠå„ç§è¯­è¨€çš„ä¹¦ç±ï¼ˆä¸åŒç±»å‹çš„æ¨¡å—ï¼‰ç¿»è¯‘æˆç»Ÿä¸€çš„è¯­è¨€ï¼ˆJavaScriptï¼‰ï¼Œè®©æµè§ˆå™¨è¿™ä¸ª"è¯»è€…"èƒ½å¤Ÿç†è§£ã€‚</p>
<p><strong>å®Œæˆæ¨¡å—ç¼–è¯‘</strong></p>
<p>ç»è¿‡loaderçš„å¤„ç†ï¼Œæ¯ä¸ªæ¨¡å—éƒ½è¢«è½¬æ¢æˆäº†æµè§ˆå™¨èƒ½å¤Ÿç†è§£çš„å½¢å¼ï¼ŒåŒæ—¶Webpackä¹Ÿæ¸…æ™°åœ°æŒæ¡äº†æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚</p>
<h3 data-id="heading-3">1.3 è¾“å‡ºé˜¶æ®µï¼šæ¼”å‡ºå¼€å§‹</h3>
<p><strong>è¾“å‡ºèµ„æº</strong></p>
<p>Webpackä¼šå°†ç›¸å…³çš„æ¨¡å—åˆ†ç»„åˆ°ä¸åŒçš„chunkä¸­ã€‚æ¯”å¦‚ï¼Œé€šè¿‡splitChunksä¼˜åŒ–ï¼Œå¯ä»¥å°†ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
      <span class="hljs-attr">cacheGroups</span>: {
        <span class="hljs-attr">vendor</span>: {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>,
          <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>
        }
      }
    }
  }
};
</code></pre>
<p>æ¯ä¸ªchunkæœ€ç»ˆä¼šè¢«è½¬æ¢æˆå•ç‹¬çš„æ–‡ä»¶ï¼ŒåŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨ä¸­ã€‚è¿™æ—¶ï¼Œæ’ä»¶è¿˜æœ‰æœ€åä¸€æ¬¡æœºä¼šä¿®æ”¹è¾“å‡ºå†…å®¹ã€‚</p>
<p><strong>è¾“å‡ºå®Œæˆ</strong></p>
<p>æœ€åï¼ŒWebpackæ ¹æ®é…ç½®çš„è¾“å‡ºè·¯å¾„å’Œæ–‡ä»¶åï¼Œå°†æ–‡ä»¶å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚è‡³æ­¤ï¼Œæ„å»ºè¿‡ç¨‹åœ†æ»¡å®Œæˆã€‚</p>
<h3 data-id="heading-4">1.4 æ’ä»¶ç³»ç»Ÿï¼šæ¼”å‡ºçš„ç‰¹æ•ˆå›¢é˜Ÿ</h3>
<p>Webpackçš„æ’ä»¶ç³»ç»Ÿå°±åƒæ¼”å‡ºçš„ç‰¹æ•ˆå›¢é˜Ÿï¼Œåœ¨ç‰¹å®šæ—¶åˆ»ä¸ºæ¼”å‡ºå¢æ·»äº®ç‚¹ã€‚æ’ä»¶é€šè¿‡ç›‘å¬Webpackåœ¨ç”Ÿå‘½å‘¨æœŸä¸­å¹¿æ’­çš„å„ç§äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ä¸€ä¸ªç®€å•çš„æ’ä»¶ç¤ºä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">emit</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">compilation</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'æ„å»ºå®Œæˆï¼Œå‡†å¤‡è¾“å‡ºèµ„æºï¼'</span>);
    });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">MyPlugin</span>;
</code></pre>
<h2 data-id="heading-5">äºŒã€æå‡å¼€å‘æ•ˆç‡ï¼šWebpackçš„å¥½å¸®æ‰‹</h2>
<p>åœ¨äº†è§£äº†Webpackçš„æ„å»ºæµç¨‹åï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•é€šè¿‡å„ç§å·¥å…·å’ŒæŠ€å·§æå‡å¼€å‘æ•ˆç‡ã€‚</p>
<h3 data-id="heading-6">2.1 å¯è§†åŒ–å·¥å…·ï¼šè®©æ„å»ºè¿‡ç¨‹ä¸€ç›®äº†ç„¶</h3>
<p><strong>webpack-dashboardï¼šæ„å»ºä»ªè¡¨ç›˜</strong></p>
<p>ä¼ ç»Ÿçš„å‘½ä»¤è¡Œè¾“å‡ºä¿¡æ¯æœ‰é™ä¸”ä¸å¤Ÿç›´è§‚ã€‚webpack-dashboardæä¾›äº†ä¸€ä¸ªå…¨æ–°çš„ç»ˆç«¯å¯è§†åŒ–ç•Œé¢ï¼Œè®©ä½ å¯¹æ„å»ºçŠ¶æ€ã€èµ„æºå¤§å°ã€é”™è¯¯ä¿¡æ¯ç­‰ä¸€ç›®äº†ç„¶ã€‚</p>
<p>å®‰è£…å’Œä½¿ç”¨éå¸¸ç®€å•ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">npm install --save-dev webpack-dashboard
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// webpack.config.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">DashboardPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-dashboard/plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ...å…¶ä»–é…ç½®</span>
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">DashboardPlugin</span>()
  ]
};
</code></pre>
<p><strong>speed-measure-webpack-pluginï¼šæ€§èƒ½åˆ†æä¸“å®¶</strong></p>
<p>è¿™ä¸ªæ’ä»¶å¯ä»¥æµ‹é‡å„ä¸ªloaderå’Œæ’ä»¶çš„è€—æ—¶ï¼Œå¸®ä½ æ‰¾å‡ºæ„å»ºè¿‡ç¨‹ä¸­çš„æ€§èƒ½ç“¶é¢ˆã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">SpeedMeasurePlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">"speed-measure-webpack-plugin"</span>);
<span class="hljs-keyword">const</span> smp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SpeedMeasurePlugin</span>();

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = smp.<span class="hljs-title function_">wrap</span>({
  <span class="hljs-comment">// åŸæ¥çš„webpacké…ç½®</span>
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-string">'style-loader'</span>, <span class="hljs-string">'css-loader'</span>] <span class="hljs-comment">// è¿™é‡Œä¼šæ˜¾ç¤ºæ¯ä¸ªloaderçš„è€—æ—¶</span>
      }
    ]
  }
});
</code></pre>
<h3 data-id="heading-7">2.2 é…ç½®ç®¡ç†ï¼šè®©é…ç½®æ›´æ¸…æ™°</h3>
<p><strong>webpack-mergeï¼šé…ç½®åˆå¹¶åˆ©å™¨</strong></p>
<p>åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦é’ˆå¯¹ä¸åŒç¯å¢ƒï¼ˆå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ï¼‰ä½¿ç”¨ä¸åŒçš„é…ç½®ã€‚webpack-mergeå¯ä»¥å¸®åŠ©æˆ‘ä»¬æå–å…¬å…±é…ç½®ï¼Œé¿å…é‡å¤ä»£ç ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { merge } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack-merge'</span>);

<span class="hljs-comment">// å…¬å…±é…ç½®</span>
<span class="hljs-keyword">const</span> commonConfig = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [{
      <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
      <span class="hljs-attr">use</span>: <span class="hljs-string">'babel-loader'</span>
    }]
  }
};

<span class="hljs-comment">// å¼€å‘ç¯å¢ƒé…ç½®</span>
<span class="hljs-keyword">const</span> devConfig = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'development'</span>,
  <span class="hljs-attr">devtool</span>: <span class="hljs-string">'cheap-module-source-map'</span>
};

<span class="hljs-comment">// ç”Ÿäº§ç¯å¢ƒé…ç½®  </span>
<span class="hljs-keyword">const</span> prodConfig = {
  <span class="hljs-attr">mode</span>: <span class="hljs-string">'production'</span>,
  <span class="hljs-attr">devtool</span>: <span class="hljs-string">'source-map'</span>
};

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">env</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (env === <span class="hljs-string">'production'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(commonConfig, prodConfig);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">merge</span>(commonConfig, devConfig);
};
</code></pre>
<h3 data-id="heading-8">2.3 çƒ­æ›´æ–°ï¼šå¼€å‘è€…çš„ç¦éŸ³</h3>
<p><strong>HotModuleReplacementPlugin</strong></p>
<p>çƒ­æ¨¡å—æ›¿æ¢ï¼ˆHMRï¼‰æ˜¯å¼€å‘è¿‡ç¨‹ä¸­æå…¶æœ‰ç”¨çš„åŠŸèƒ½ã€‚å®ƒå…è®¸åœ¨è¿è¡Œæ—¶æ›´æ–°å„ç§æ¨¡å—ï¼Œè€Œæ— éœ€è¿›è¡Œå®Œå…¨åˆ·æ–°ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä¸ä¸¢å¤±åº”ç”¨çŠ¶æ€çš„æƒ…å†µä¸‹çœ‹åˆ°ä»£ç æ›´æ”¹çš„æ•ˆæœã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> webpack = <span class="hljs-built_in">require</span>(<span class="hljs-string">'webpack'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ...å…¶ä»–é…ç½®</span>
  <span class="hljs-attr">devServer</span>: {
    <span class="hljs-attr">hot</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å¯çƒ­æ›´æ–°</span>
    <span class="hljs-attr">contentBase</span>: <span class="hljs-string">'./dist'</span>
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> webpack.<span class="hljs-title class_">HotModuleReplacementPlugin</span>()
  ]
};
</code></pre>
<p>å¯¹äºCSSï¼ŒHMRä½“éªŒå°¤ä¸ºå‡ºè‰² - æ ·å¼æ›´æ”¹ä¼šç«‹å³åæ˜ åœ¨é¡µé¢ä¸Šã€‚å¯¹äºJavaScriptï¼Œä½ å¯èƒ½éœ€è¦æ‰‹åŠ¨å¤„ç†æ¨¡å—æ›´æ–°ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">if</span> (<span class="hljs-variable language_">module</span>.<span class="hljs-property">hot</span>) {
  <span class="hljs-variable language_">module</span>.<span class="hljs-property">hot</span>.<span class="hljs-title function_">accept</span>(<span class="hljs-string">'./myModule'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// æ¨¡å—æ›´æ–°åçš„å›è°ƒ</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'myModuleæ›´æ–°äº†ï¼'</span>);
  });
}
</code></pre>
<h2 data-id="heading-9">ä¸‰ã€æ–‡ä»¶æŒ‡çº¹ï¼šç²¾å‡†æ§åˆ¶ç¼“å­˜ç­–ç•¥</h2>
<p>æ–‡ä»¶æŒ‡çº¹æ˜¯æ‰“åŒ…åè¾“å‡ºæ–‡ä»¶åçš„åç¼€ï¼Œç”¨äºæ§åˆ¶æµè§ˆå™¨ç¼“å­˜ï¼Œæ˜¯æ€§èƒ½ä¼˜åŒ–ä¸­çš„é‡è¦ä¸€ç¯ã€‚</p>
<h3 data-id="heading-10">3.1 ä¸‰ç§æ–‡ä»¶æŒ‡çº¹ç­–ç•¥</h3>
<p><strong>Hashï¼šé¡¹ç›®çº§åˆ«</strong></p>
<p>Hashä¸æ•´ä¸ªé¡¹ç›®æ„å»ºç›¸å…³ï¼Œåªè¦é¡¹ç›®æ–‡ä»¶æœ‰ä¿®æ”¹ï¼Œæ•´ä¸ªé¡¹ç›®æ„å»ºçš„hashå€¼å°±ä¼šæ”¹å˜ã€‚è¿™ç§ç­–ç•¥æ¯”è¾ƒ"ç²—æ”¾"ï¼Œä»»ä½•æ–‡ä»¶æ”¹åŠ¨éƒ½ä¼šå¯¼è‡´æ‰€æœ‰è¾“å‡ºæ–‡ä»¶çš„hashå˜åŒ–ã€‚</p>
<p><strong>ChunkHashï¼šä»£ç å—çº§åˆ«</strong></p>
<p>ChunkHashä¸webpackæ‰“åŒ…çš„chunkç›¸å…³ï¼Œä¸åŒçš„entryä¼šç”Ÿæˆä¸åŒçš„chunkhashã€‚è¿™ç§æ–¹å¼æ›´ä¸ºç²¾å‡†ï¼Œåªæœ‰å±äºåŒä¸€chunkçš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¯¥chunkçš„hashæ‰ä¼šæ”¹å˜ã€‚</p>
<p><strong>ContentHashï¼šå†…å®¹çº§åˆ«</strong></p>
<p>ContentHashæ ¹æ®æ–‡ä»¶å†…å®¹æ¥å®šä¹‰hashï¼Œæ–‡ä»¶å†…å®¹ä¸å˜ï¼Œcontenthashå°±ä¸å˜ã€‚è¿™æ˜¯æœ€ç²¾ç¡®çš„ç¼“å­˜æ§åˆ¶ç­–ç•¥ï¼Œç‰¹åˆ«é€‚ç”¨äºCSSç­‰èµ„æºæ–‡ä»¶ã€‚</p>
<h3 data-id="heading-11">3.2 å®æˆ˜æ–‡ä»¶æŒ‡çº¹é…ç½®</h3>
<p><strong>JavaScriptçš„æ–‡ä»¶æŒ‡çº¹</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: {
    <span class="hljs-attr">app</span>: <span class="hljs-string">'./src/app.js'</span>,
    <span class="hljs-attr">search</span>: <span class="hljs-string">'./src/search.js'</span>
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]-[chunkhash:8].js'</span> <span class="hljs-comment">// ä½¿ç”¨8ä½chunkhash</span>
  }
};
</code></pre>
<p>è¿™æ ·ä¼šç”Ÿæˆç±»ä¼¼app-a1b2c3d4.jså’Œsearch-e5f6g7h8.jsçš„æ–‡ä»¶ã€‚</p>
<p><strong>CSSçš„æ–‡ä»¶æŒ‡çº¹</strong></p>
<p>CSSçš„æ–‡ä»¶æŒ‡çº¹éœ€è¦å€ŸåŠ©MiniCssExtractPluginï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: {
    <span class="hljs-attr">app</span>: <span class="hljs-string">'./src/app.js'</span>,
    <span class="hljs-attr">search</span>: <span class="hljs-string">'./src/search.js'</span>
  },
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>),
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]-[chunkhash:8].js'</span>
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [
          <span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-comment">// ä½¿ç”¨MiniCssExtractPluginçš„loader</span>
          <span class="hljs-string">'css-loader'</span>
        ]
      }
    ]
  },
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>({
      <span class="hljs-attr">filename</span>: <span class="hljs-string">'[name]-[contenthash:8].css'</span> <span class="hljs-comment">// ä½¿ç”¨8ä½contenthash</span>
    })
  ]
};
</code></pre>
<p><strong>å›¾ç‰‡èµ„æºçš„æ–‡ä»¶æŒ‡çº¹</strong></p>
<p>å¯¹äºå›¾ç‰‡ç­‰é™æ€èµ„æºï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨file-loaderæˆ–url-loaderæ¥å¤„ç†ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">entry</span>: <span class="hljs-string">'./src/index.js'</span>,
  <span class="hljs-attr">output</span>: {
    <span class="hljs-attr">filename</span>: <span class="hljs-string">'bundle.js'</span>,
    <span class="hljs-attr">path</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'dist'</span>)
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(png|svg|jpg|gif)$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'file-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-string">'images/[name]-[hash:8].[ext]'</span> <span class="hljs-comment">// å›¾ç‰‡ä½¿ç”¨hash</span>
            }
          }
        ]
      }
    ]
  }
};
</code></pre>
<p>file-loaderæä¾›äº†ä¸°å¯Œçš„å ä½ç¬¦ï¼š</p>
<ul>
<li><code>[name]</code>ï¼šæ–‡ä»¶åŸå</li>
<li><code>[path]</code>ï¼šæ–‡ä»¶ç›¸å¯¹è·¯å¾„</li>
<li><code>[folder]</code>ï¼šæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹</li>
<li><code>[hash]</code>ï¼šæ–‡ä»¶å†…å®¹hash</li>
<li><code>[contenthash]</code>ï¼šå†…å®¹hashï¼ˆä¸hashé€šå¸¸ç›¸åŒï¼‰</li>
</ul>
<h2 data-id="heading-12">å››ã€æ„å»ºæ€§èƒ½ä¼˜åŒ–ï¼šè®©æ‰“åŒ…é€Ÿåº¦é£èµ·æ¥</h2>
<p>éšç€é¡¹ç›®è§„æ¨¡çš„å¢é•¿ï¼Œæ„å»ºæ—¶é—´å¯èƒ½ä¼šæˆä¸ºå¼€å‘æ•ˆç‡çš„ç“¶é¢ˆã€‚ä¸‹é¢æ˜¯ä¸€äº›å®ç”¨çš„ä¼˜åŒ–ç­–ç•¥ã€‚</p>
<h3 data-id="heading-13">4.1 ä½¿ç”¨æœ€æ–°å·¥å…·</h3>
<p>å§‹ç»ˆä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„Webpackå’ŒNode.jsã€‚æ¯ä¸ªæ–°ç‰ˆæœ¬é€šå¸¸éƒ½ä¼šå¸¦æ¥æ€§èƒ½æ”¹è¿›å’Œæ–°ç‰¹æ€§ã€‚Webpack 5ç›¸æ¯”Webpack 4åœ¨æ„å»ºæ€§èƒ½ä¸Šæœ‰æ˜¾è‘—æå‡ã€‚</p>
<h3 data-id="heading-14">4.2 å¤šè¿›ç¨‹æ„å»º</h3>
<p><strong>thread-loader</strong></p>
<p>å°†è¿™ä¸ªloaderæ”¾åœ¨å…¶ä»–loaderä¹‹å‰ï¼Œå…¶åçš„loaderå°±ä¼šåœ¨å•ç‹¬çš„workeræ± ä¸­è¿è¡Œï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸CPUçš„ä¼˜åŠ¿ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'thread-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">workers</span>: <span class="hljs-number">2</span>, <span class="hljs-comment">// å¼€å¯2ä¸ªworker</span>
            }
          },
          <span class="hljs-string">'babel-loader'</span>
        ]
      }
    ]
  }
};
</code></pre>
<p>æ³¨æ„ï¼šthread-loaderæœ‰ä¸€å®šå¯åŠ¨å¼€é”€ï¼Œåœ¨å°å‹é¡¹ç›®ä¸­å¯èƒ½ä¸å¤ªåˆ’ç®—ã€‚</p>
<h3 data-id="heading-15">4.3 ä¼˜åŒ–å‹ç¼©è¿‡ç¨‹</h3>
<p><strong>å¹¶è¡Œå‹ç¼©JavaScript</strong></p>
<p>ä½¿ç”¨TerserWebpackPluginå¼€å¯å¤šè¿›ç¨‹å¹¶è¡Œå‹ç¼©ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">TerserPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'terser-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">minimizer</span>: [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">TerserPlugin</span>({
        <span class="hljs-attr">parallel</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// å¼€å¯å¤šè¿›ç¨‹</span>
        <span class="hljs-attr">cache</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// å¼€å¯ç¼“å­˜</span>
      })
    ]
  }
};
</code></pre>
<p><strong>CSSå‹ç¼©å’Œæå–</strong></p>
<p>ä½¿ç”¨MiniCssExtractPluginé…åˆä¼˜åŒ–å™¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">MiniCssExtractPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mini-css-extract-plugin'</span>);
<span class="hljs-keyword">const</span> <span class="hljs-title class_">CssMinimizerPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'css-minimizer-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.css$/</span>,
        <span class="hljs-attr">use</span>: [<span class="hljs-title class_">MiniCssExtractPlugin</span>.<span class="hljs-property">loader</span>, <span class="hljs-string">'css-loader'</span>]
      }
    ]
  },
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">minimizer</span>: [
      <span class="hljs-keyword">new</span> <span class="hljs-title class_">CssMinimizerPlugin</span>()
    ]
  },
  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">MiniCssExtractPlugin</span>()]
};
</code></pre>
<h3 data-id="heading-16">4.4 å›¾ç‰‡ä¼˜åŒ–</h3>
<p>ä½¿ç”¨image-webpack-loaderè‡ªåŠ¨å‹ç¼©å›¾ç‰‡ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.(jpe?g|png|gif|svg)$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'file-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">name</span>: <span class="hljs-string">'images/[name]-[hash:8].[ext]'</span>
            }
          },
          {
            <span class="hljs-attr">loader</span>: <span class="hljs-string">'image-webpack-loader'</span>,
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">mozjpeg</span>: {
                <span class="hljs-attr">progressive</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">quality</span>: <span class="hljs-number">65</span>
              },
              <span class="hljs-attr">optipng</span>: {
                <span class="hljs-attr">enabled</span>: <span class="hljs-literal">true</span>
              },
              <span class="hljs-attr">pngquant</span>: {
                <span class="hljs-attr">quality</span>: [<span class="hljs-number">0.65</span>, <span class="hljs-number">0.90</span>],
                <span class="hljs-attr">speed</span>: <span class="hljs-number">4</span>
              }
            }
          }
        ]
      }
    ]
  }
};
</code></pre>
<h3 data-id="heading-17">4.5 ç¼©å°æ‰“åŒ…ä½œç”¨åŸŸ</h3>
<p>é€šè¿‡ç²¾ç¡®é…ç½®ï¼Œå‡å°‘Webpackçš„æœç´¢èŒƒå›´ï¼Œå¯ä»¥æ˜¾è‘—æå‡æ„å»ºé€Ÿåº¦ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-comment">// æ˜ç¡®å‘Šè¯‰webpackæœç´¢å“ªäº›ç›®å½•</span>
    <span class="hljs-attr">modules</span>: [path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'node_modules'</span>)],
    <span class="hljs-comment">// ä½¿ç”¨åˆ«åå‡å°‘æŸ¥æ‰¾è¿‡ç¨‹</span>
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>)
    },
    <span class="hljs-comment">// å‡å°‘å°è¯•çš„æ‰©å±•å</span>
    <span class="hljs-attr">extensions</span>: [<span class="hljs-string">'.js'</span>, <span class="hljs-string">'.jsx'</span>, <span class="hljs-string">'.json'</span>]
  },
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-comment">// åªå¯¹srcç›®å½•ä¸‹çš„jsæ–‡ä»¶ä½¿ç”¨babel-loader</span>
        <span class="hljs-attr">include</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>),
        <span class="hljs-attr">use</span>: <span class="hljs-string">'babel-loader'</span>
      }
    ]
  }
};
</code></pre>
<h3 data-id="heading-18">4.6 æå–å…¬å…±èµ„æº</h3>
<p><strong>åˆ†ç¦»ç¬¬ä¸‰æ–¹åº“</strong></p>
<p>å°†ä¸å¸¸å˜åŠ¨çš„ç¬¬ä¸‰æ–¹åº“å•ç‹¬æ‰“åŒ…ï¼Œå¯ä»¥åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">optimization</span>: {
    <span class="hljs-attr">splitChunks</span>: {
      <span class="hljs-attr">cacheGroups</span>: {
        <span class="hljs-attr">vendor</span>: {
          <span class="hljs-attr">test</span>: <span class="hljs-regexp">/[\\/]node_modules[\\/]/</span>,
          <span class="hljs-attr">name</span>: <span class="hljs-string">'vendors'</span>,
          <span class="hljs-attr">chunks</span>: <span class="hljs-string">'all'</span>
        }
      }
    }
  }
};
</code></pre>
<p><strong>ä½¿ç”¨CDN</strong></p>
<p>é€šè¿‡externalsé…ç½®ï¼Œå°†ä¸€äº›å¤§å‹åº“æ’é™¤åœ¨æ‰“åŒ…ä¹‹å¤–ï¼Œé€šè¿‡CDNå¼•å…¥ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">externals</span>: {
    <span class="hljs-attr">react</span>: <span class="hljs-string">'React'</span>,
    <span class="hljs-string">'react-dom'</span>: <span class="hljs-string">'ReactDOM'</span>
  }
};
</code></pre>
<p>ç„¶ååœ¨HTMLä¸­é€šè¿‡scriptæ ‡ç­¾å¼•å…¥CDNèµ„æºã€‚</p>
<h3 data-id="heading-19">4.7 å……åˆ†åˆ©ç”¨ç¼“å­˜</h3>
<p>ç¼“å­˜æ˜¯æå‡äºŒæ¬¡æ„å»ºé€Ÿåº¦çš„åˆ©å™¨ã€‚</p>
<p><strong>babel-loaderç¼“å­˜</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.js$/</span>,
        <span class="hljs-attr">use</span>: {
          <span class="hljs-attr">loader</span>: <span class="hljs-string">'babel-loader'</span>,
          <span class="hljs-attr">options</span>: {
            <span class="hljs-attr">cacheDirectory</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// å¼€å¯babelç¼“å­˜</span>
          }
        }
      }
    ]
  }
};
</code></pre>
<p><strong>æŒä¹…åŒ–ç¼“å­˜</strong></p>
<p>Webpack 5æä¾›äº†å†…ç½®çš„æŒä¹…åŒ–ç¼“å­˜ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">cache</span>: {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'filesystem'</span> <span class="hljs-comment">// ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜</span>
  }
};
</code></pre>
<p>å¯¹äºWebpack 4ï¼Œå¯ä»¥ä½¿ç”¨hard-source-webpack-pluginï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">HardSourceWebpackPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hard-source-webpack-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [<span class="hljs-keyword">new</span> <span class="hljs-title class_">HardSourceWebpackPlugin</span>()]
};
</code></pre>
<h3 data-id="heading-20">4.8 Tree Shakingï¼šæ¶ˆé™¤æ— ç”¨ä»£ç </h3>
<p>Tree Shakingå°±åƒå›­ä¸ä¿®å‰ªæ ‘æœ¨ä¸€æ ·ï¼Œå»é™¤ä»£ç ä¸­æœªè¢«ä½¿ç”¨çš„éƒ¨åˆ†ï¼Œè®©æœ€ç»ˆæ‰“åŒ…ä½“ç§¯æ›´å°ã€‚</p>
<p>ES6æ¨¡å—ç³»ç»Ÿæ˜¯Tree Shakingçš„åŸºç¡€ï¼Œå› ä¸ºES6æ¨¡å—æ˜¯é™æ€çš„ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶ç¡®å®šä¾èµ–å…³ç³»ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// math.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">square</span>(<span class="hljs-params">x</span>) {
  <span class="hljs-keyword">return</span> x * x;
}

<span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cube</span>(<span class="hljs-params">x</span>) {
  <span class="hljs-keyword">return</span> x * x * x;
}

<span class="hljs-comment">// index.js</span>
<span class="hljs-keyword">import</span> { cube } <span class="hljs-keyword">from</span> <span class="hljs-string">'./math.js'</span>; <span class="hljs-comment">// åªå¼•å…¥äº†cube</span>

<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">cube</span>(<span class="hljs-number">5</span>));
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œsquareå‡½æ•°ä¸ä¼šè¢«åŒ…å«åœ¨æœ€ç»ˆçš„bundleä¸­ã€‚</p>
<p>ç¡®ä¿åœ¨package.jsonä¸­è®¾ç½®sideEffectså±æ€§ï¼Œå¸®åŠ©Webpackè¯†åˆ«å“ªäº›æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"your-project"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"sideEffects"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
    <span class="hljs-string">"*.css"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-string">"*.scss"</span>
  <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-21">äº”ã€è‡ªå®šä¹‰Loaderå’ŒPluginï¼šæ‰©å±•Webpackèƒ½åŠ›</h2>
<p>å½“Webpackå†…ç½®åŠŸèƒ½æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™è‡ªå®šä¹‰loaderå’Œpluginæ¥æ‰©å±•å…¶èƒ½åŠ›ã€‚</p>
<h3 data-id="heading-22">5.1 ç¼–å†™Loaderï¼šæ¨¡å—è½¬æ¢å™¨</h3>
<p>Loaderå°±åƒä¸€ä¸ªç¿»è¯‘å®˜ï¼Œè´Ÿè´£å°†å„ç§ç±»å‹çš„æ¨¡å—"ç¿»è¯‘"æˆWebpackèƒ½å¤Ÿç†è§£çš„JavaScriptã€‚</p>
<p><strong>Loaderå¼€å‘åŸåˆ™</strong></p>
<ul>
<li>å•ä¸€èŒè´£ï¼šæ¯ä¸ªloaderåªåšä¸€ä»¶äº‹</li>
<li>é“¾å¼è°ƒç”¨ï¼šloaderæ”¯æŒé“¾å¼è°ƒç”¨ï¼Œå‰ä¸€ä¸ªloaderçš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªloaderçš„è¾“å…¥</li>
<li>æ¨¡å—åŒ–ï¼šç¡®ä¿loaderè¾“å‡ºçš„æ˜¯JavaScriptæ¨¡å—</li>
<li>æ— çŠ¶æ€ï¼šåœ¨å¤šæ¬¡æ„å»ºä¹‹é—´ï¼Œloaderä¸åº”è¯¥ä¿ç•™çŠ¶æ€</li>
</ul>
<p><strong>ä¸€ä¸ªç®€å•çš„Loaderç¤ºä¾‹</strong></p>
<p>å‡è®¾æˆ‘ä»¬è¦å¼€å‘ä¸€ä¸ªç®€å•çš„markdown loaderï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> marked = <span class="hljs-built_in">require</span>(<span class="hljs-string">'marked'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) {
  <span class="hljs-comment">// è·å–loaderçš„é…ç½®é€‰é¡¹</span>
  <span class="hljs-keyword">const</span> options = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getOptions</span>();
  
  <span class="hljs-comment">// ä½¿ç”¨markedè§£æmarkdown</span>
  <span class="hljs-keyword">const</span> html = <span class="hljs-title function_">marked</span>(source, options);
  
  <span class="hljs-comment">// è¿”å›JavaScriptæ¨¡å—</span>
  <span class="hljs-keyword">return</span> <span class="hljs-string">`module.exports = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(html)}</span>`</span>;
};
</code></pre>
<p>ä½¿ç”¨è¿™ä¸ªloaderï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">module</span>: {
    <span class="hljs-attr">rules</span>: [
      {
        <span class="hljs-attr">test</span>: <span class="hljs-regexp">/\.md$/</span>,
        <span class="hljs-attr">use</span>: [
          {
            <span class="hljs-attr">loader</span>: path.<span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'markdown-loader.js'</span>),
            <span class="hljs-attr">options</span>: {
              <span class="hljs-attr">pedantic</span>: <span class="hljs-literal">true</span>
            }
          }
        ]
      }
    ]
  }
};
</code></pre>
<p><strong>Loaderå·¥å…·åº“</strong></p>
<p>å®˜æ–¹æä¾›çš„loader-utilså’Œschema-utilså¯ä»¥ç®€åŒ–loaderå¼€å‘ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> { getOptions } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'loader-utils'</span>);
<span class="hljs-keyword">const</span> { validate } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'schema-utils'</span>);

<span class="hljs-keyword">const</span> schema = {
  <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
  <span class="hljs-attr">properties</span>: {
    <span class="hljs-attr">test</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'boolean'</span>
    }
  }
};

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">source</span>) {
  <span class="hljs-keyword">const</span> options = <span class="hljs-title function_">getOptions</span>(<span class="hljs-variable language_">this</span>);
  
  <span class="hljs-comment">// éªŒè¯optionsæ˜¯å¦ç¬¦åˆschema</span>
  <span class="hljs-title function_">validate</span>(schema, options, <span class="hljs-string">'Example Loader'</span>);
  
  <span class="hljs-comment">// loaderé€»è¾‘...</span>
  <span class="hljs-keyword">return</span> source;
};
</code></pre>
<h3 data-id="heading-23">5.2 ç¼–å†™Pluginï¼šæ„å»ºè¿‡ç¨‹å¢å¼ºå™¨</h3>
<p>å¦‚æœè¯´Loaderå¤„ç†çš„æ˜¯å•ä¸ªæ¨¡å—ï¼Œé‚£ä¹ˆPluginåˆ™æ˜¯åœ¨æ•´ä¸ªæ„å»ºè¿‡ç¨‹ä¸­èµ·ä½œç”¨ï¼Œå¯ä»¥ç›‘å¬Webpackæ„å»ºç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚</p>
<p><strong>PluginåŸºæœ¬ç»“æ„</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyPlugin</span> {
  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    <span class="hljs-comment">// æ³¨å†Œé’©å­</span>
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">someHook</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'MyPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">params</span>) =&gt;</span> {
      <span class="hljs-comment">// æ’ä»¶é€»è¾‘</span>
    });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">MyPlugin</span>;
</code></pre>
<p><strong>ä¸€ä¸ªå®ç”¨çš„Pluginç¤ºä¾‹</strong></p>
<p>è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåœ¨æ„å»ºå®Œæˆåæ˜¾ç¤ºæ„å»ºä¿¡æ¯çš„æ’ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">class</span> <span class="hljs-title class_">BuildInfoPlugin</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span> = options || {};
  }

  <span class="hljs-title function_">apply</span>(<span class="hljs-params">compiler</span>) {
    compiler.<span class="hljs-property">hooks</span>.<span class="hljs-property">done</span>.<span class="hljs-title function_">tap</span>(<span class="hljs-string">'BuildInfoPlugin'</span>, <span class="hljs-function">(<span class="hljs-params">stats</span>) =&gt;</span> {
      <span class="hljs-keyword">const</span> { compilation } = stats;
      <span class="hljs-keyword">const</span> { outputOptions } = compilation;
      
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ‰ æ„å»ºå®Œæˆï¼'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ğŸ“ è¾“å‡ºç›®å½•: <span class="hljs-subst">${outputOptions.path}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`ğŸ“¦ æ–‡ä»¶æ•°é‡: <span class="hljs-subst">${compilation.assets.length}</span>`</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`â± æ„å»ºæ—¶é—´: <span class="hljs-subst">${stats.endTime - stats.startTime}</span>ms`</span>);
      
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span>.<span class="hljs-property">showAssets</span>) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ğŸ“„ ç”Ÿæˆæ–‡ä»¶:'</span>);
        <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(compilation.<span class="hljs-property">assets</span>).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">assetName</span> =&gt;</span> {
          <span class="hljs-keyword">const</span> asset = compilation.<span class="hljs-property">assets</span>[assetName];
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`   <span class="hljs-subst">${assetName}</span> (<span class="hljs-subst">${asset.size()}</span> bytes)`</span>);
        });
      }
    });
  }
}

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title class_">BuildInfoPlugin</span>;
</code></pre>
<p>ä½¿ç”¨è¿™ä¸ªæ’ä»¶ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> <span class="hljs-title class_">BuildInfoPlugin</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./build-info-plugin'</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">plugins</span>: [
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuildInfoPlugin</span>({
      <span class="hljs-attr">showAssets</span>: <span class="hljs-literal">true</span>
    })
  ]
};
</code></pre>
<p><strong>ç†è§£Compilerå’ŒCompilation</strong></p>
<p>åœ¨Pluginå¼€å‘ä¸­ï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µéœ€è¦ç†è§£ï¼š</p>
<ul>
<li>compilerï¼šä»£è¡¨äº†é…ç½®å®Œå¤‡çš„Webpackç¯å¢ƒï¼Œä»å¯åŠ¨åˆ°å…³é—­çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸ</li>
<li>compilationï¼šä»£è¡¨äº†ä¸€æ¬¡å•ä¸€çš„æ„å»ºï¼ŒåŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ä¿¡æ¯</li>
</ul>
<p><strong>å¸¸ç”¨çš„é’©å­æ—¶æœº</strong></p>
<ul>
<li>entryOptionï¼šå¤„ç†entryé…ç½®</li>
<li>compileï¼šå¼€å§‹ç¼–è¯‘</li>
<li>emitï¼šç”Ÿæˆèµ„æºåˆ°outputç›®å½•ä¹‹å‰</li>
<li>doneï¼šç¼–è¯‘å®Œæˆ</li>
</ul>
<h2 data-id="heading-24">ç»“è¯­</h2>
<p>Webpackä½œä¸ºç°ä»£å‰ç«¯å¼€å‘çš„åŸºçŸ³ï¼Œå…¶é‡è¦æ€§ä¸è¨€è€Œå–»ã€‚é€šè¿‡æ·±å…¥äº†è§£å…¶æ„å»ºæµç¨‹ã€æŒæ¡æ€§èƒ½ä¼˜åŒ–æŠ€å·§ã€ç”šè‡³èƒ½å¤Ÿç¼–å†™è‡ªå®šä¹‰çš„loaderå’Œpluginï¼Œæˆ‘ä»¬ä¸ä»…èƒ½å¤Ÿæå‡å¼€å‘æ•ˆç‡ï¼Œè¿˜èƒ½æ›´å¥½åœ°åº”å¯¹å¤æ‚é¡¹ç›®çš„æ„å»ºéœ€æ±‚ã€‚</p>
<p>è®°ä½ï¼ŒWebpacké…ç½®æ²¡æœ‰ç»å¯¹çš„"æœ€ä½³å®è·µ"ï¼Œæœ€é€‚åˆé¡¹ç›®éœ€æ±‚çš„é…ç½®å°±æ˜¯æœ€å¥½çš„é…ç½®ã€‚å¸Œæœ›æœ¬æ–‡èƒ½å¸®åŠ©ä½ åœ¨Webpackçš„å­¦ä¹ å’Œä½¿ç”¨é“è·¯ä¸Šèµ°å¾—æ›´è¿œï¼Œè®©æ„å»ºå·¥å…·çœŸæ­£æˆä¸ºæå‡å¼€å‘ä½“éªŒçš„åˆ©å™¨ï¼Œè€Œä¸æ˜¯ä»¤äººå¤´ç–¼çš„è´Ÿæ‹…ã€‚</p>
<p>æ„å»ºæ„‰å¿«ï¼</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/310f9fafebf248d2bcd0e307983f15d3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgYW5zd2VyYmFsbA==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763296537&amp;x-signature=hd5FmxDyvnYgqcpe4eXd1FJ9zhg%3D" alt="image.png" width="50%" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C++åŒå‘é“¾è¡¨åˆ é™¤æ“ä½œï¼šç”±æµ…å…¥æ·±å®Œå…¨æŒ‡å—]]></title>    <link>https://juejin.cn/post/7570899512782176319</link>    <guid>https://juejin.cn/post/7570899512782176319</guid>    <pubDate>2025-11-10T11:17:08.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570899512782176319" data-draft-id="7570885801478144041" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C++åŒå‘é“¾è¡¨åˆ é™¤æ“ä½œï¼šç”±æµ…å…¥æ·±å®Œå…¨æŒ‡å—"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T11:17:08.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C++åŒå‘é“¾è¡¨åˆ é™¤æ“ä½œï¼šç”±æµ…å…¥æ·±å®Œå…¨æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T11:17:08.000Z" title="Mon Nov 10 2025 11:17:08 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åŒå‘é“¾è¡¨æ˜¯ä¸€ç§åŸºç¡€ä¸”é‡è¦çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸ä»…åŒ…å«æ•°æ®ï¼Œè¿˜åŒ…å«æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆã€‚è¿™ç§ç»“æ„ä½¿å¾—åŒå‘é“¾è¡¨åœ¨æ’å…¥å’Œåˆ é™¤æ“ä½œä¸Šï¼Œå°¤å…¶æ˜¯åœ¨å·²çŸ¥èŠ‚ç‚¹ä½ç½®æ—¶ï¼Œæ¯”å•å‘é“¾è¡¨æ›´å…·ä¼˜åŠ¿ã€‚</p>
<p>æœ¬æ–‡å°†èšç„¦äº<strong>åˆ é™¤æ“ä½œ</strong>ï¼Œå¸¦ä½ ä»åŸºæœ¬æ¦‚å¿µå‡ºå‘ï¼Œé€æ­¥æ·±å…¥åˆ°è¾¹ç•Œå¤„ç†å’Œåº”ç”¨å®è·µã€‚</p>
<hr/>
<h3 data-id="heading-0"><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼šåŸºç¡€ç¯‡ â€”â€” åˆ é™¤èŠ‚ç‚¹çš„æ ¸å¿ƒé€»è¾‘</strong></h3>
<p>åœ¨åŒå‘é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ ¸å¿ƒåœ¨äºâ€œé‡æ–°å¸ƒçº¿â€ï¼Œå°†è¢«åˆ é™¤èŠ‚ç‚¹å‰åä¸¤ä¸ªèŠ‚ç‚¹è¿æ¥èµ·æ¥ï¼Œç„¶åå®‰å…¨åœ°é‡Šæ”¾è¯¥èŠ‚ç‚¹ã€‚</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„èŠ‚ç‚¹å®šä¹‰ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">struct</span> <span class="hljs-title class_">ListNode</span> {
    <span class="hljs-type">int</span> val;
    ListNode* prev; <span class="hljs-comment">// æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹</span>
    ListNode* next; <span class="hljs-comment">// æŒ‡å‘åä¸€ä¸ªèŠ‚ç‚¹</span>
    <span class="hljs-built_in">ListNode</span>(<span class="hljs-type">int</span> x) : <span class="hljs-built_in">val</span>(x), <span class="hljs-built_in">prev</span>(<span class="hljs-literal">nullptr</span>), <span class="hljs-built_in">next</span>(<span class="hljs-literal">nullptr</span>) {}
};
</code></pre>
<p>ç°åœ¨ï¼Œå‡è®¾æˆ‘ä»¬è¦åœ¨é“¾è¡¨ä¸­åˆ é™¤ä¸€ä¸ªå·²çŸ¥çš„èŠ‚ç‚¹ <code>delNode</code>ã€‚ä¸‹å›¾æ¸…æ™°åœ°å±•ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ï¼š</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8e15fa6831ca4695a50edf681093c273~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgb2lvaWhvaWk=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763378228&amp;x-signature=4X8IV%2FJbTfw%2F%2Bt5w0hC4DnX8Ajo%3D" alt="deepseek_mermaid_20251110_5ac562.png" loading="lazy"/></p>
<p>æ ¹æ®å›¾ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬åŒ–ä¸ºä»£ç ï¼š</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-comment">// å‰æï¼šdelNode ä¸æ˜¯ç©ºæŒ‡é’ˆï¼Œä¸”å­˜åœ¨äºé“¾è¡¨ä¸­</span>
<span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteNode</span><span class="hljs-params">(ListNode* delNode)</span> </span>{
    <span class="hljs-comment">// 1. å¤„ç†å‰é©±èŠ‚ç‚¹çš„nextæŒ‡é’ˆ</span>
    <span class="hljs-keyword">if</span> (delNode-&gt;prev != <span class="hljs-literal">nullptr</span>) {
        delNode-&gt;prev-&gt;next = delNode-&gt;next;
    }
    <span class="hljs-comment">// 2. å¤„ç†åç»§èŠ‚ç‚¹çš„prevæŒ‡é’ˆ</span>
    <span class="hljs-keyword">if</span> (delNode-&gt;next != <span class="hljs-literal">nullptr</span>) {
        delNode-&gt;next-&gt;prev = delNode-&gt;prev;
    }
    <span class="hljs-comment">// 3. å®‰å…¨åˆ é™¤èŠ‚ç‚¹</span>
    <span class="hljs-keyword">delete</span> delNode;
}
</code></pre>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li>æˆ‘ä»¬å¿…é¡»æ£€æŸ¥ <code>delNode-&gt;prev</code> å’Œ <code>delNode-&gt;next</code> æ˜¯å¦ä¸ºç©ºï¼Œå› ä¸ºè¦åˆ é™¤çš„èŠ‚ç‚¹å¯èƒ½æ˜¯å¤´èŠ‚ç‚¹æˆ–å°¾èŠ‚ç‚¹ã€‚</li>
<li>æ“ä½œé¡ºåºå¾ˆé‡è¦ï¼Œä½†åœ¨æ­¤ä¾‹ä¸­ï¼Œåªè¦åœ¨è§£é™¤é“¾æ¥å‰è·å–äº†å¿…è¦çš„ä¿¡æ¯ï¼Œé¡ºåºå¯ä»¥è°ƒæ•´ã€‚</li>
</ul>
<hr/>
<h3 data-id="heading-1"><strong>ç¬¬äºŒéƒ¨åˆ†ï¼šè¿›é˜¶ç¯‡ â€”â€” å¤„ç†è¾¹ç•Œæƒ…å†µä¸è®¾è®¡å°è£…</strong></h3>
<p>åŸºç¡€çš„åˆ é™¤é€»è¾‘å¾ˆç®€å•ï¼Œä½†ä¸€ä¸ªå¥å£®çš„é“¾è¡¨å®ç°éœ€è¦ meticulously (ä¸€ä¸ä¸è‹Ÿåœ°) å¤„ç†å„ç§è¾¹ç•Œæƒ…å†µã€‚</p>
<h4 data-id="heading-2"><strong>æƒ…å†µä¸€ï¼šåˆ é™¤å¤´èŠ‚ç‚¹</strong></h4>
<p>å¦‚æœ <code>delNode</code> æ˜¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹ï¼Œåœ¨åˆ é™¤åï¼Œé“¾è¡¨çš„å¤´æŒ‡é’ˆéœ€è¦è¢«æ›´æ–°ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteNode</span><span class="hljs-params">(ListNode** head_ref, ListNode* delNode)</span> </span>{
    <span class="hljs-comment">// æ£€æŸ¥ç©ºæŒ‡é’ˆ</span>
    <span class="hljs-keyword">if</span> (*head_ref == <span class="hljs-literal">nullptr</span> || delNode == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span>;

    <span class="hljs-comment">// å¦‚æœåˆ é™¤çš„æ˜¯å¤´èŠ‚ç‚¹ï¼Œåˆ™éœ€è¦æ›´æ–°å¤´æŒ‡é’ˆ</span>
    <span class="hljs-keyword">if</span> (*head_ref == delNode) {
        *head_ref = delNode-&gt;next; <span class="hljs-comment">// æ–°çš„å¤´èŠ‚ç‚¹æ˜¯åŸå¤´çš„ä¸‹ä¸€ä¸ª</span>
    }

    <span class="hljs-comment">// ... (æ¥ä¸‹æ¥çš„è¿æ¥æ“ä½œä¸åŸºç¡€ç¯‡ç›¸åŒ)</span>
    <span class="hljs-keyword">if</span> (delNode-&gt;next != <span class="hljs-literal">nullptr</span>) {
        delNode-&gt;next-&gt;prev = delNode-&gt;prev;
    }
    <span class="hljs-keyword">if</span> (delNode-&gt;prev != <span class="hljs-literal">nullptr</span>) {
        delNode-&gt;prev-&gt;next = delNode-&gt;next;
    }

    <span class="hljs-keyword">delete</span> delNode;
}
</code></pre>
<h4 data-id="heading-3"><strong>æƒ…å†µäºŒï¼šåˆ é™¤å°¾èŠ‚ç‚¹</strong></h4>
<p>å¦‚æœ <code>delNode</code> æ˜¯å°¾èŠ‚ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°å®ƒå‰ä¸€ä¸ªèŠ‚ç‚¹çš„ <code>next</code> æŒ‡é’ˆä¸º <code>nullptr</code>ã€‚åŸºç¡€ä»£ç ä¸­çš„ <code>if (delNode-&gt;next != nullptr)</code> å·²ç»å®Œç¾å¤„ç†äº†è¿™ç§æƒ…å†µï¼Œé˜²æ­¢äº†è®¿é—®ç©ºæŒ‡é’ˆçš„ <code>prev</code>ã€‚</p>
<h4 data-id="heading-4"><strong>æƒ…å†µä¸‰ï¼šåˆ é™¤å”¯ä¸€èŠ‚ç‚¹</strong></h4>
<p>å¦‚æœé“¾è¡¨åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé‚£ä¹ˆåˆ é™¤å®ƒåï¼Œå¤´æŒ‡é’ˆéœ€è¦è¢«ç½®ä¸º <code>nullptr</code>ã€‚ä¸Šé¢çš„ä»£ç åŒæ ·å¯ä»¥å¤„ç†ï¼šå®ƒé¦–å…ˆå°† <code>*head_ref</code> è®¾ç½®ä¸º <code>delNode-&gt;next</code>ï¼ˆä¹Ÿå°±æ˜¯ <code>nullptr</code>ï¼‰ï¼Œç„¶åè¿›è¡Œè¿æ¥æ“ä½œï¼ˆå› ä¸º <code>prev</code> å’Œ <code>next</code> éƒ½æ˜¯ <code>nullptr</code>ï¼Œæ‰€ä»¥ <code>if</code> å†…çš„è¯­å¥ä¸ä¼šæ‰§è¡Œï¼‰ã€‚</p>
<hr/>
<h3 data-id="heading-5"><strong>ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®è·µç¯‡ â€”â€” å®Œæ•´çš„é“¾è¡¨ç±»ä¸å¤æ‚åˆ é™¤</strong></h3>
<p>è®©æˆ‘ä»¬åœ¨ä¸€ä¸ªç®€å•çš„åŒå‘é“¾è¡¨ç±»ä¸­å®ç°åˆ é™¤åŠŸèƒ½ï¼Œå¹¶æ¢è®¨æ›´å¤æ‚çš„åœºæ™¯ã€‚</p>
<pre><code class="hljs language-cpp" lang="cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DoublyLinkedList</span> {
<span class="hljs-keyword">private</span>:
    ListNode* head;
<span class="hljs-keyword">public</span>:
    <span class="hljs-built_in">DoublyLinkedList</span>() : <span class="hljs-built_in">head</span>(<span class="hljs-literal">nullptr</span>) {}

    <span class="hljs-comment">// åˆ é™¤æŒ‡å®šå€¼çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteByValue</span><span class="hljs-params">(<span class="hljs-type">int</span> value)</span> </span>{
        ListNode* current = head;
        <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">nullptr</span>) {
            <span class="hljs-keyword">if</span> (current-&gt;val == value) {
                <span class="hljs-comment">// æ‰¾åˆ°èŠ‚ç‚¹ï¼Œè°ƒç”¨åˆ é™¤é€»è¾‘</span>
                <span class="hljs-keyword">if</span> (current == head) {
                    head = head-&gt;next;
                }
                <span class="hljs-keyword">if</span> (current-&gt;next != <span class="hljs-literal">nullptr</span>) {
                    current-&gt;next-&gt;prev = current-&gt;prev;
                }
                <span class="hljs-keyword">if</span> (current-&gt;prev != <span class="hljs-literal">nullptr</span>) {
                    current-&gt;prev-&gt;next = current-&gt;next;
                }
                <span class="hljs-keyword">delete</span> current;
                <span class="hljs-keyword">return</span>; <span class="hljs-comment">// åªåˆ é™¤ç¬¬ä¸€ä¸ªæ‰¾åˆ°çš„</span>
            }
            current = current-&gt;next;
        }
    }

    <span class="hljs-comment">// åˆ é™¤æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹ (ç´¢å¼•ä»0å¼€å§‹)</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">deleteByPosition</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>{
        <span class="hljs-keyword">if</span> (head == <span class="hljs-literal">nullptr</span> || position &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

        ListNode* current = head;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; current != <span class="hljs-literal">nullptr</span> &amp;&amp; i &lt; position; i++) {
            current = current-&gt;next;
        }

        <span class="hljs-comment">// å¦‚æœcurrentä¸ºç©ºï¼Œè¯´æ˜ä½ç½®è¶…å‡ºé“¾è¡¨é•¿åº¦</span>
        <span class="hljs-keyword">if</span> (current == <span class="hljs-literal">nullptr</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// å¤ç”¨åˆ é™¤èŠ‚ç‚¹çš„æ ¸å¿ƒé€»è¾‘</span>
        <span class="hljs-keyword">if</span> (current == head) {
            head = head-&gt;next;
        }
        <span class="hljs-keyword">if</span> (current-&gt;next != <span class="hljs-literal">nullptr</span>) {
            current-&gt;next-&gt;prev = current-&gt;prev;
        }
        <span class="hljs-keyword">if</span> (current-&gt;prev != <span class="hljs-literal">nullptr</span>) {
            current-&gt;prev-&gt;next = current-&gt;next;
        }
        <span class="hljs-keyword">delete</span> current;
    }

    <span class="hljs-comment">// æ¸…ç©ºæ•´ä¸ªé“¾è¡¨</span>
    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">clear</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">while</span> (head != <span class="hljs-literal">nullptr</span>) {
            ListNode* temp = head;
            head = head-&gt;next;
            <span class="hljs-keyword">delete</span> temp;
        }
    }

    <span class="hljs-comment">// ... å…¶ä»–æˆå‘˜å‡½æ•°ï¼Œå¦‚push_front, push_back, printç­‰</span>
};
</code></pre>
<p><strong>å¤æ‚åˆ é™¤åœºæ™¯ï¼š</strong></p>
<ol>
<li><strong>æ¸…ç©ºé“¾è¡¨ï¼š</strong> å¦‚ <code>clear()</code> å‡½æ•°æ‰€ç¤ºï¼Œå®ƒåå¤åˆ é™¤å¤´èŠ‚ç‚¹ï¼Œç›´åˆ°é“¾è¡¨ä¸ºç©ºã€‚è¿™æ˜¯ä¸€ç§é«˜æ•ˆä¸”å®‰å…¨çš„æ–¹æ³•ã€‚</li>
<li><strong>åœ¨ææ„å‡½æ•°ä¸­è°ƒç”¨ï¼š</strong> ä¸€ä¸ªè‰¯å¥½çš„ C++ é“¾è¡¨ç±»å¿…é¡»åœ¨ææ„å‡½æ•°ä¸­æ¸…ç†æ‰€æœ‰èŠ‚ç‚¹ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼ã€‚
<pre><code class="hljs language-cpp" lang="cpp">~<span class="hljs-built_in">DoublyLinkedList</span>() {
    <span class="hljs-built_in">clear</span>();
}
</code></pre>
</li>
</ol>
<hr/>
<h3 data-id="heading-6"><strong>ç¬¬å››éƒ¨åˆ†ï¼šæ·±å…¥ç†è§£ â€”â€” ä¸å•å‘é“¾è¡¨åˆ é™¤çš„å¯¹æ¯”</strong></h3>
<p>è¿™æ˜¯ç†è§£åŒå‘é“¾è¡¨ä¼˜åŠ¿çš„å…³é”®ã€‚</p>

























<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">å•å‘é“¾è¡¨</th><th align="left">åŒå‘é“¾è¡¨</th></tr></thead><tbody><tr><td align="left"><strong>åˆ é™¤ç»™å®šèŠ‚ç‚¹</strong></td><td align="left"><strong>O(n)</strong>ã€‚éœ€è¦ä»å¤´éå†ä»¥æ‰¾åˆ°è¯¥èŠ‚ç‚¹çš„å‰é©±èŠ‚ç‚¹ã€‚</td><td align="left"><strong>O(1)</strong>ã€‚å› ä¸ºé€šè¿‡ <code>prev</code> æŒ‡é’ˆå¯ä»¥ç›´æ¥æ‰¾åˆ°å‰é©±èŠ‚ç‚¹ã€‚</td></tr><tr><td align="left"><strong>åˆ é™¤å¤´èŠ‚ç‚¹</strong></td><td align="left">O(1)</td><td align="left">O(1)</td></tr><tr><td align="left"><strong>åˆ é™¤å°¾èŠ‚ç‚¹</strong></td><td align="left">O(n)ã€‚éœ€è¦æ‰¾åˆ°å€’æ•°ç¬¬äºŒä¸ªèŠ‚ç‚¹ã€‚</td><td align="left">O(1)ã€‚é€šè¿‡å°¾èŠ‚ç‚¹çš„ <code>prev</code> ç›´æ¥æ‰¾åˆ°å‰é©±ã€‚</td></tr></tbody></table>
<p><strong>ç»“è®ºï¼š</strong> å½“æ“ä½œæ¶‰åŠåˆ°åå‘éå†æˆ–å·²çŸ¥èŠ‚ç‚¹ä½ç½®è€Œéä»…å€¼æ—¶çš„åˆ é™¤ï¼ŒåŒå‘é“¾è¡¨çš„æ•ˆç‡è¿œé«˜äºå•å‘é“¾è¡¨ã€‚</p>
<h3 data-id="heading-7"><strong>æ€»ç»“</strong></h3>
<p>ä»æœ€åŸºç¡€çš„â€œé‡æ–°å¸ƒçº¿â€é€»è¾‘ï¼Œåˆ°å¤„ç†å¤´èŠ‚ç‚¹ã€å°¾èŠ‚ç‚¹ç­‰è¾¹ç•Œæƒ…å†µï¼Œå†åˆ°å°è£…æˆå®Œæ•´çš„ç±»å¹¶ä¸å•å‘é“¾è¡¨è¿›è¡Œå¯¹æ¯”ï¼Œæˆ‘ä»¬å¯¹C++åŒå‘é“¾è¡¨çš„åˆ é™¤æ“ä½œè¿›è¡Œäº†ä¸€æ¬¡ç”±æµ…å…¥æ·±çš„æ¢ç´¢ã€‚</p>
<p>è®°ä½æˆä¸ºä¸€åä¼˜ç§€C++ç¨‹åºå‘˜çš„å…³é”®ï¼š</p>
<ul>
<li><strong>å§‹ç»ˆæ³¨æ„å†…å­˜ç®¡ç†</strong>ï¼š<code>new</code> å’Œ <code>delete</code> è¦æˆå¯¹å‡ºç°ã€‚</li>
<li><strong>ä¸¥è°¨å¤„ç†è¾¹ç•Œ</strong>ï¼šå¤´èŠ‚ç‚¹ã€å°¾èŠ‚ç‚¹ã€ç©ºé“¾è¡¨æ˜¯bugçš„é«˜å‘åŒºã€‚</li>
<li><strong>ç†è§£åº•å±‚åŸç†</strong>ï¼šæ˜ç™½æŒ‡é’ˆæ˜¯å¦‚ä½•è¢«æ“ä½œçš„ï¼Œæ‰èƒ½å†™å‡ºæ­£ç¡®ã€é«˜æ•ˆçš„ä»£ç ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[è½¯ä»¶ç”Ÿäº§çš„â€œé«˜é€Ÿå…¬è·¯ç½‘â€ï¼šæ·±å…¥æµ…å‡ºç†è§£CI/CDçš„æ ¸å¿ƒæµç¨‹]]></title>    <link>https://juejin.cn/post/7570885801478160425</link>    <guid>https://juejin.cn/post/7570885801478160425</guid>    <pubDate>2025-11-10T11:18:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570885801478160425" data-draft-id="7570899512782192703" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="è½¯ä»¶ç”Ÿäº§çš„â€œé«˜é€Ÿå…¬è·¯ç½‘â€ï¼šæ·±å…¥æµ…å‡ºç†è§£CI/CDçš„æ ¸å¿ƒæµç¨‹"/> <meta itemprop="keywords" content="åç«¯"/> <meta itemprop="datePublished" content="2025-11-10T11:18:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="oioihoii"/> <meta itemprop="url" content="https://juejin.cn/user/1972974802965230"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            è½¯ä»¶ç”Ÿäº§çš„â€œé«˜é€Ÿå…¬è·¯ç½‘â€ï¼šæ·±å…¥æµ…å‡ºç†è§£CI/CDçš„æ ¸å¿ƒæµç¨‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1972974802965230/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    oioihoii
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T11:18:19.000Z" title="Mon Nov 10 2025 11:18:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>åœ¨ç°ä»£è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿½æ±‚çš„æ˜¯å¿«é€Ÿã€é¢‘ç¹ä¸”å¯é åœ°å‘å¸ƒæ–°åŠŸèƒ½ã€‚è€Œå®ç°è¿™ä¸€ç›®æ ‡çš„åŸºçŸ³ï¼Œå°±æ˜¯CI/CDã€‚å¾ˆå¤šäººæŠŠCI/CDç®€å•ç†è§£ä¸ºä¸€æ¡â€œæµæ°´çº¿â€ï¼Œä½†å…¶å†…éƒ¨å®åˆ™æœ‰ä¸€å¥—ç²¾å¯†çš„â€œäº¤é€šç³»ç»Ÿâ€ï¼Œç”±å¤šç§ä¸åŒçš„â€œæµâ€æ„æˆã€‚æœ¬æ–‡å°†ä¸ºæ‚¨æ‹†è§£CI/CDä¸­å„ç§â€œæµâ€çš„æ¦‚å¿µä¸ä½œç”¨ã€‚</p>
<h3 data-id="heading-0"><strong>ä¸€ã€ æ ¸å¿ƒä¸»å¹²é“ï¼šæŒ‰æµç¨‹é˜¶æ®µåˆ’åˆ†çš„â€œæµâ€</strong></h3>
<p>è¿™æ˜¯ç†è§£CI/CDæœ€ç»å…¸çš„è§†è§’ï¼Œæç»˜äº†ä»£ç ä»æäº¤åˆ°ä¸Šçº¿çš„å®Œæ•´æ—…ç¨‹ã€‚</p>
<h4 data-id="heading-1"><strong>1. CIï¼ˆæŒç»­é›†æˆï¼‰æµï¼šä»£ç çš„â€œè´¨é‡æ£€æµ‹çº¿â€</strong></h4>
<p>è¿™æ¡æµçš„æ ¸å¿ƒæ˜¯<strong>å¿«é€Ÿåé¦ˆï¼Œç¡®ä¿ä»£ç è´¨é‡</strong>ã€‚</p>
<ul>
<li><strong>è§¦å‘ä¿¡å·</strong>ï¼šå¼€å‘è€…å‘ä»£ç ä»“åº“ï¼ˆå¦‚Gitï¼‰æ¨é€äº†æ–°çš„ä»£ç ã€‚</li>
<li><strong>æµæ°´çº¿å·¥åº</strong>ï¼š
<ol>
<li><strong>æ‹‰å–ä»£ç </strong>ï¼šè‡ªåŠ¨æŠ“å–æœ€æ–°çš„ä»£ç å˜æ›´ã€‚</li>
<li><strong>é™æ€æ£€æŸ¥</strong>ï¼šå¦‚åŒä»£ç çš„â€œè¯­æ³•æ£€æŸ¥â€ï¼Œè¿è¡Œè‡ªåŠ¨åŒ–å·¥å…·æ‰«æä»£ç é£æ ¼ã€æ½œåœ¨æ¼æ´å’Œå¤æ‚åº¦ã€‚</li>
<li><strong>ç¼–è¯‘æ‰“åŒ…</strong>ï¼šå°†æºä»£ç â€œç¿»è¯‘â€æˆå¯æ‰§è¡Œçš„è½¯ä»¶åŒ…ï¼ˆå¦‚Dockeré•œåƒã€JARåŒ…ï¼‰ã€‚</li>
<li><strong>å•å…ƒæµ‹è¯•</strong>ï¼šè¿è¡Œå¤§é‡ç»†ç²’åº¦çš„æµ‹è¯•ï¼ŒéªŒè¯æ¯ä¸ªä»£ç å•å…ƒçš„æ­£ç¡®æ€§ã€‚</li>
</ol>
</li>
<li><strong>æœ€ç»ˆç›®æ ‡</strong>ï¼šç”Ÿæˆä¸€ä¸ª<strong>å¯ä¿¡çš„ã€å¯éšæ—¶éƒ¨ç½²çš„è½¯ä»¶åˆ¶å“</strong>ï¼Œå¹¶å­˜å…¥â€œåˆ¶å“åº“â€ã€‚å¦‚æœæ­¤æµç¨‹ä»»ä½•ä¸€æ­¥å¤±è´¥ï¼Œå›¢é˜Ÿä¼šç«‹å³æ”¶åˆ°è­¦æŠ¥ã€‚</li>
</ul>
<h4 data-id="heading-2"><strong>2. CDæµï¼šè½¯ä»¶çš„â€œå‘å¸ƒä¹‹æ—…â€</strong></h4>
<p>CIæµç¡®ä¿äº†â€œè´§ç‰©â€è´¨é‡åˆæ ¼ï¼ŒCDæµåˆ™è´Ÿè´£å°†å…¶â€œå®‰å…¨é€è¾¾ç”¨æˆ·æ‰‹ä¸­â€ã€‚CDåˆåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼š</p>
<p><strong>a) æŒç»­äº¤ä»˜æµï¼šæ•´è£…å¾…å‘ï¼Œä¸€é”®éƒ¨ç½²</strong></p>
<ul>
<li><strong>æ ¸å¿ƒç‰¹å¾</strong>ï¼š<strong>è‡ªåŠ¨åŒ–ä¸€åˆ‡ï¼Œä½†ç”Ÿäº§éƒ¨ç½²éœ€è¦æ‰‹åŠ¨æ‰¹å‡†</strong>ã€‚</li>
<li><strong>æµæ°´çº¿å·¥åº</strong>ï¼š
<ol>
<li><strong>è‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ</strong>ï¼šå°†CIäº§ç”Ÿçš„åˆ¶å“éƒ¨ç½²åˆ°ç±»ç”Ÿäº§ç¯å¢ƒã€‚</li>
<li><strong>å…¨é¢æµ‹è¯•</strong>ï¼šè¿›è¡Œæ›´ä¸¥æ ¼çš„é›†æˆæµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•å’Œå®‰å…¨æ‰«æã€‚</li>
<li><strong>ç­‰å¾…æ‰‹åŠ¨æ‰¹å‡†</strong>ï¼šåœ¨æœ€ç»ˆéƒ¨ç½²å‰ï¼Œé¡¹ç›®ç»ç†æˆ–è¿ç»´äººå‘˜ç‚¹å‡»â€œç¡®è®¤â€æŒ‰é’®ã€‚</li>
<li><strong>ä¸€é”®éƒ¨ç½²</strong>ï¼šç»æ‰¹å‡†åï¼Œè‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li>
</ol>
</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šå¯¹å‘å¸ƒæœ‰ä¸¥æ ¼ç®¡æ§è¦æ±‚çš„ä¼ä¸šï¼Œæ˜¯ç›®å‰æœ€ä¸»æµçš„æ¨¡å¼ã€‚</li>
</ul>
<p><strong>b) æŒç»­éƒ¨ç½²æµï¼šå…¨ç¨‹è‡ªåŠ¨é©¾é©¶</strong></p>
<ul>
<li><strong>æ ¸å¿ƒç‰¹å¾</strong>ï¼š<strong>å®Œå…¨è‡ªåŠ¨åŒ–ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„</strong>ã€‚</li>
<li><strong>æµæ°´çº¿å·¥åº</strong>ï¼šåœ¨æŒç»­äº¤ä»˜çš„åŸºç¡€ä¸Šï¼Œ<strong>ç§»é™¤äº†æ‰‹åŠ¨æ‰¹å‡†ç¯èŠ‚</strong>ã€‚åªè¦ä»£ç é€šè¿‡æ‰€æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•å…³å¡ï¼Œå°±ä¼šåƒåä¸Šæ»‘æ¢¯ä¸€æ ·ï¼Œ<strong>è‡ªåŠ¨ã€ç›´æ¥åœ°å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒ</strong>ã€‚</li>
<li><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¿½æ±‚æè‡´æ•ˆç‡ã€æµ‹è¯•æ–‡åŒ–éå¸¸æˆç†Ÿçš„å›¢é˜Ÿã€‚</li>
</ul>
<blockquote>
<p><strong>ç®€å•æ¯”å–»</strong>ï¼šæŒç»­äº¤ä»˜åƒæ˜¯æŠŠç«ç®­å‘å°„æŒ‰é’®æ”¾åœ¨ç»ç’ƒç½©é‡Œï¼Œéœ€è¦æ—¶å†ç ¸ç¢æŒ‰ä¸‹ï¼›æŒç»­éƒ¨ç½²åˆ™æ˜¯ç¨‹åºè‡ªåŠ¨åˆ¤æ–­æœ€ä½³æ—¶æœºå¹¶ç›´æ¥å‘å°„ã€‚</p>
</blockquote>
<h3 data-id="heading-3"><strong>äºŒã€ åˆ†æ”¯ç­–ç•¥æµï¼šä»£ç ç®¡ç†çš„â€œäº¤é€šè§„åˆ™â€</strong></h3>
<p>åœ¨å¤šäººåä½œå¼€å‘ä¸­ï¼Œä»£ç å­˜æ”¾åœ¨ä¸åŒçš„åˆ†æ”¯ä¸Šï¼Œå°±åƒåŸå¸‚æœ‰ä¸åŒçš„é“è·¯ã€‚ä¸åŒçš„åˆ†æ”¯å¯¹åº”ç€ä¸åŒçš„CI/CDæµç¨‹ã€‚</p>
<ul>
<li>
<p><strong>ç‰¹æ€§åˆ†æ”¯æµï¼ˆåŸå¸‚å°é“ï¼‰</strong>ï¼š</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šå¼€å‘è€…åœ¨è‡ªå·±çš„åˆ†æ”¯ä¸Šå¼€å‘æ–°åŠŸèƒ½ã€‚</li>
<li><strong>æµç¨‹</strong>ï¼šè§¦å‘ä¸€ä¸ª<strong>è½»é‡çº§CIæµ</strong>ï¼Œåªè¿›è¡Œç¼–è¯‘å’ŒåŸºç¡€æµ‹è¯•ï¼Œç›®çš„æ˜¯ç»™å¼€å‘è€…å¿«é€Ÿåé¦ˆï¼Œ<strong>ä¸éƒ¨ç½²</strong>ã€‚</li>
</ul>
</li>
<li>
<p><strong>ä¸»å¹²/å¼€å‘åˆ†æ”¯æµï¼ˆåŸå¸‚ä¸»å¹²é“ï¼‰</strong>ï¼š</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šä»£ç åˆå¹¶åˆ°ä¸»åˆ†æ”¯æˆ–å¼€å‘åˆ†æ”¯ã€‚</li>
<li><strong>æµç¨‹</strong>ï¼šè§¦å‘<strong>å®Œæ•´çš„CIæµ</strong>å’Œåç»­çš„<strong>CDæµ</strong>ï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°æµ‹è¯•æˆ–é¢„å‘å¸ƒç¯å¢ƒã€‚è¿™æ˜¯æœ€é‡è¦çš„æµç¨‹ä¹‹ä¸€ã€‚</li>
</ul>
</li>
<li>
<p><strong>å‘å¸ƒ/çƒ­ä¿®å¤åˆ†æ”¯æµï¼ˆåº”æ€¥è½¦é“ï¼‰</strong>ï¼š</p>
<ul>
<li><strong>åœºæ™¯</strong>ï¼šä¸ºå‘å¸ƒç‰ˆæœ¬æˆ–ä¿®å¤çº¿ä¸Šç´§æ€¥Bugåˆ›å»ºçš„åˆ†æ”¯ã€‚</li>
<li><strong>æµç¨‹</strong>ï¼šè§¦å‘ä¸€ä¸ª<strong>ç¨³å®šã€å¿«é€Ÿçš„CI/CDæµ</strong>ï¼Œæ—¨åœ¨ç”¨æœ€ç®€è·¯å¾„å°†ä»£ç å®‰å…¨å¯é åœ°äº¤ä»˜ä¸Šçº¿ã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-4"><strong>ä¸‰ã€ å‘å¸ƒæ¨¡å¼æµï¼šä¸Šçº¿æ—¶çš„â€œäº¤é€šç–å¯¼æ–¹æ¡ˆâ€</strong></h3>
<p>å½“è½¯ä»¶åŒ…æŠµè¾¾ç”Ÿäº§ç¯å¢ƒé—¨å£ï¼Œå¦‚ä½•è®©ç”¨æˆ·æ— æ„ŸçŸ¥ã€å¹³æ»‘åœ°åˆ‡æ¢åˆ°æ–°ç‰ˆæœ¬ï¼Ÿè¿™å°±éœ€è¦æ™ºèƒ½çš„â€œäº¤é€šç–å¯¼â€ç­–ç•¥ã€‚</p>
<ul>
<li>
<p><strong>è“ç»¿éƒ¨ç½²ï¼šæ•´ä½“åˆ‡æ¢</strong></p>
<ul>
<li><strong>æè¿°</strong>ï¼šå‡†å¤‡ä¸¤å¥—å®Œå…¨ç›¸åŒçš„ç¯å¢ƒï¼ˆè“å’Œç»¿ï¼‰ã€‚å½“å‰ç”¨æˆ·æµé‡åœ¨è“è‰²ï¼ˆæ—§ç‰ˆæœ¬ï¼‰ã€‚æ–°ç‰ˆæœ¬åœ¨ç»¿è‰²ç¯å¢ƒéƒ¨ç½²æµ‹è¯•å®Œæ¯•åï¼Œ<strong>ç¬é—´å°†å…¨éƒ¨æµé‡ä»è“è‰²åˆ‡æ¢åˆ°ç»¿è‰²</strong>ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šå‘å¸ƒå’Œå›æ»šï¼ˆåˆ‡å›è“è‰²ï¼‰éƒ½æå¿«ï¼Œå‡ ä¹é›¶é£é™©ã€‚</li>
</ul>
</li>
<li>
<p><strong>é‡‘ä¸é›€å‘å¸ƒï¼šé€æ­¥æ”¾è¡Œ</strong></p>
<ul>
<li><strong>æè¿°</strong>ï¼šåƒçŸ¿å·¥ç”¨é‡‘ä¸é›€æ¢æµ‹ç“¦æ–¯ä¸€æ ·ï¼Œå…ˆå°†æ–°ç‰ˆæœ¬éƒ¨ç½²åˆ°ä¸€å°éƒ¨åˆ†æœåŠ¡å™¨ï¼Œå¼•å…¥å°‘é‡ç”¨æˆ·æµé‡ï¼ˆå¦‚2%ï¼‰ã€‚ç¡®è®¤æ— è¯¯åï¼Œå†é€æ­¥æ‰©å¤§èŒƒå›´ï¼Œç›´è‡³å®Œå…¨æ›¿æ¢æ—§ç‰ˆæœ¬ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šèƒ½æœ€å¤§é™åº¦åœ°æ§åˆ¶æ–°ç‰ˆæœ¬æ•…éšœçš„å½±å“èŒƒå›´ï¼Œæ˜¯é£é™©æœ€ä½çš„å‘å¸ƒç­–ç•¥ã€‚</li>
</ul>
</li>
<li>
<p><strong>æ»šåŠ¨æ›´æ–°ï¼šæ¸è¿›æ›¿æ¢</strong></p>
<ul>
<li><strong>æè¿°</strong>ï¼šåœ¨Kubernetesç­‰å¹³å°ä¸­å¸¸è§ã€‚é€æ­¥åœæ­¢æ—§ç‰ˆæœ¬çš„å®ä¾‹ï¼ŒåŒæ—¶å¯åŠ¨æ–°ç‰ˆæœ¬çš„å®ä¾‹ï¼Œç›´åˆ°æ‰€æœ‰å®ä¾‹éƒ½æ›´æ–°å®Œæ¯•ã€‚</li>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæœåŠ¡ä¸ä¼šä¸­æ–­ï¼Œèµ„æºåˆ©ç”¨é«˜æ•ˆã€‚</li>
</ul>
</li>
</ul>
<h3 data-id="heading-5"><strong>æ€»ç»“ï¼šä¸€å¼ äº¤ç»‡çš„æ™ºèƒ½ç½‘ç»œ</strong></h3>
<p>CI/CDä¸­çš„è¿™äº›â€œæµâ€å¹¶éå­¤ç«‹å­˜åœ¨ï¼Œå®ƒä»¬å…±åŒæ„æˆäº†ä¸€å¼ æ™ºèƒ½é«˜æ•ˆçš„è½¯ä»¶äº¤ä»˜ç½‘ç»œï¼š</p>
<ul>
<li><strong>ç‰¹æ€§åˆ†æ”¯æµ</strong> ä¿éšœäº†å¼€å‘è¿‡ç¨‹çš„æ•æ·ã€‚</li>
<li><strong>CIæµ</strong> ä½œä¸ºè´¨é‡åŸºçŸ³ï¼Œæ˜¯æ‰€æœ‰åç»­æµç¨‹çš„ä¿¡ä»»æ¥æºã€‚</li>
<li><strong>ä¸»å¹²åˆ†æ”¯æµ</strong> é©±åŠ¨ç€ <strong>æŒç»­äº¤ä»˜/éƒ¨ç½²æµ</strong>ï¼Œå®ç°äº†é›†æˆçš„è‡ªåŠ¨åŒ–ã€‚</li>
<li><strong>è“ç»¿éƒ¨ç½²/é‡‘ä¸é›€å‘å¸ƒ</strong> ç­‰ç­–ç•¥ï¼Œåˆ™ç¡®ä¿äº†å‘å¸ƒæœ€ç»ˆç”¨æˆ·æ—¶çš„å¹³æ»‘ä¸å®‰å…¨ã€‚</li>
</ul>
<p>ç†è§£å¹¶å·§å¦™ç»„åˆè¿™äº›æµç¨‹ï¼Œå°±å¦‚åŒä¸ºæ‚¨çš„è½¯ä»¶é¡¹ç›®è§„åˆ’äº†ä¸€å¥—å®Œç¾çš„äº¤é€šç³»ç»Ÿï¼Œèƒ½è®©æ‚¨çš„åˆ›æ„ä»¥å®‰å…¨ã€ç¨³å®šã€æé€Ÿçš„æ–¹å¼ï¼ŒæŠµè¾¾ç”¨æˆ·çš„æŒ‡å°–ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ä¸ºä»€ä¹ˆåœ¨ JavaScript ä¸­ NaN !== NaNï¼ŸèƒŒåè—ç€ 40 å¹´çš„æŠ€æœ¯æ•…äº‹]]></title>    <link>https://juejin.cn/post/7570932873130901531</link>    <guid>https://juejin.cn/post/7570932873130901531</guid>    <pubDate>2025-11-10T11:54:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570932873130901531" data-draft-id="7570912420567662602" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content=" ä¸ºä»€ä¹ˆåœ¨ JavaScript ä¸­ NaN !== NaNï¼ŸèƒŒåè—ç€ 40 å¹´çš„æŠ€æœ¯æ•…äº‹"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,Node.js"/> <meta itemprop="datePublished" content="2025-11-10T11:54:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="å†´ç¾½"/> <meta itemprop="url" content="https://juejin.cn/user/712139234359182"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
             ä¸ºä»€ä¹ˆåœ¨ JavaScript ä¸­ NaN !== NaNï¼ŸèƒŒåè—ç€ 40 å¹´çš„æŠ€æœ¯æ•…äº‹
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/712139234359182/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    å†´ç¾½
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T11:54:37.000Z" title="Mon Nov 10 2025 11:54:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">1. å‰è¨€</h2>
<p>åˆå­¦ JavaScript çš„æ—¶å€™ï¼Œç»å¸¸ä¼šé‡åˆ°ä¸€äº›ä»¤äººå›°æƒ‘çš„ç°è±¡ï¼Œæ¯”å¦‚ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">NaN</span> === <span class="hljs-title class_">NaN</span>); <span class="hljs-comment">// false</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">NaN</span> !== <span class="hljs-title class_">NaN</span>); <span class="hljs-comment">// true</span>
</code></pre>
<p>ä¸ºä»€ä¹ˆä¸€ä¸ªå€¼ä¼šä¸ç­‰äºå®ƒè‡ªå·±å‘¢ï¼Ÿ</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥æ¢ç©¶è¿™ä¸ªé—®é¢˜ã€‚</p>
<h2 data-id="heading-1">2. NaN çš„æœ¬è´¨ï¼šä¸€ä¸ªç‰¹æ®Šçš„â€œæ•°å­—â€</h2>
<p>NaN å…¶å®æ˜¯ <code>Not a Number</code> çš„ç¼©å†™ï¼Œè¡¨ç¤ºå®ƒä¸æ˜¯ä¸€ä¸ªæ•°å­—ã€‚ä½† NaN çš„ç±»å‹å´æ˜¯ <code>number</code></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-keyword">typeof</span> <span class="hljs-title class_">NaN</span>); <span class="hljs-comment">// "number"</span>
</code></pre>
<p>æ‰€ä»¥ä½ å¯ä»¥æŠŠ NaN ç†è§£ä¸ºä¸€ä¸ªæ•°å­—ç±»å‹çš„ç‰¹æ®Šå€¼ã€‚</p>
<p>å½“ä½ å°è¯•å°†éæ•°å­—å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—ï¼Œæˆ–è€…è¿›è¡Œæ— æ•ˆçš„æ•°å­¦è¿ç®—æ—¶ï¼Œå°±ä¼šå¾—åˆ° NaNï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript">+<span class="hljs-string">"oops"</span>; <span class="hljs-comment">// NaN</span>
<span class="hljs-number">0</span> / <span class="hljs-number">0</span>; <span class="hljs-comment">// NaN</span>
</code></pre>
<p>è€Œå½“ NaN å‡ºç°åœ¨æ•°å­¦è¿ç®—ä¸­æ—¶ï¼Œå®ƒä¼šå¯¼è‡´æ‰€æœ‰è¿ç®—ç»“æœéƒ½æ˜¯ NaNï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">NaN</span> + <span class="hljs-number">1</span>); <span class="hljs-comment">// NaN</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">NaN</span> - <span class="hljs-number">1</span>); <span class="hljs-comment">// NaN</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-title class_">NaN</span>, <span class="hljs-number">5</span>)); <span class="hljs-comment">// NaN</span>
</code></pre>
<h2 data-id="heading-2">3. æ·±å…¥åº•å±‚ï¼šIEEE 754 æ ‡å‡†çš„æ•…äº‹</h2>
<p>è¦ç†è§£ NaN !== NaN çš„æ ¹æºï¼Œæˆ‘ä»¬éœ€è¦å›åˆ° 1985 å¹´ã€‚</p>
<p>å½“æ—¶ï¼ŒIEEE å‘å¸ƒäº† <strong>754 å·æ ‡å‡†</strong>â€”â€”<a href="https://juejin.cn/post/6844904093601759239#heading-1" target="_blank" title="https://juejin.cn/post/6844904093601759239#heading-1">äºŒè¿›åˆ¶æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†</a>ã€‚</p>
<p>è¿™ä¸ªæ ‡å‡†å®šä¹‰äº†æµ®ç‚¹æ•°çš„è¡¨ç¤ºæ ¼å¼ï¼ŒåŒ…æ‹¬ä¸€äº›ç‰¹æ®Šå€¼ï¼šæ— ç©·å¤§ï¼ˆInfinityï¼‰ã€è´Ÿé›¶ï¼ˆ-0ï¼‰å’Œ NaNã€‚</p>
<p><strong>IEEE 754 æ ‡å‡†è§„å®šï¼Œå½“æŒ‡æ•°éƒ¨åˆ†ä¸º 0x7FF è€Œå°¾æ•°éƒ¨åˆ†éé›¶æ—¶ï¼Œè¿™ä¸ªå€¼è¡¨ç¤º NaNã€‚</strong></p>
<p><strong>æ›´é‡è¦çš„æ˜¯ï¼Œæ ‡å‡†æ˜ç¡®è¦æ±‚ NaN ä¸ç­‰äºè‡ªèº«ã€‚</strong></p>
<h3 data-id="heading-3">3.1. ä¸ºä»€ä¹ˆä¼šè¿™æ ·è®¾è®¡å‘¢ï¼Ÿ</h3>
<p>è¿™å…¶å®æ˜¯ä¸€ç§<strong>æ·±æ€ç†Ÿè™‘çš„è®¾è®¡</strong>ï¼Œè€Œéé”™è¯¯ã€‚ä¸»è¦åŸå› æ˜¯ï¼š</p>
<ol>
<li><strong>æä¾›é”™è¯¯æ£€æµ‹æœºåˆ¶</strong>ï¼šåœ¨æ—©æœŸæ²¡æœ‰ <code>isNaN()</code> å‡½æ•°çš„ç¼–ç¨‹ç¯å¢ƒä¸­ï¼Œ<code>x != x</code>æ˜¯æ£€æµ‹ NaN çš„å”¯ä¸€æ–¹æ³•</li>
<li><strong>é€»è¾‘ä¸€è‡´æ€§</strong>ï¼šNaN ä»£è¡¨â€œä¸æ˜¯æ•°å­—â€ï¼Œä¸€ä¸ªéæ•°å€¼ç¡®å®ä¸åº”è¯¥ç­‰äºå¦ä¸€ä¸ªéæ•°å€¼ï¼Œè¿™åœ¨é€»è¾‘ä¸Šä¹Ÿæ˜¯é€šç•…çš„</li>
</ol>
<h3 data-id="heading-4">3.2. è·¨è¯­è¨€çš„ä¸€è‡´æ€§</h3>
<p>å› æ­¤ <code>NaN !== NaN</code> çš„è¡Œä¸ºä¸ä»…å­˜åœ¨äº JavaScriptï¼Œè€Œæ˜¯è´¯ç©¿æ‰€æœ‰éµå¾ª IEEE 754 æ ‡å‡†çš„ç¼–ç¨‹è¯­è¨€ï¼š</p>
<p><strong>ä»¥ Python ä¸ºä¾‹ï¼š</strong></p>
<hr/>
<pre><code class="hljs language-plain" lang="plain">#Python

import math

nan = float('nan')
print(nan != nan)  # True
print(nan == nan)  # False
print(math.isnan(nan))  # True
</code></pre>
<hr/>
<p><strong>ä»¥ C++ ä¸ºä¾‹ï¼š</strong></p>
<hr/>
<pre><code class="hljs language-plain" lang="plain">//C++

#include &lt;iostream&gt;
#include &lt;cmath&gt;

int main() {
    double nan = NAN;
    std::cout &lt;&lt; (nan != nan) &lt;&lt; std::endl;  // 1 (true)
    std::cout &lt;&lt; (nan == nan) &lt;&lt; std::endl;  // 0 (false)
    std::cout &lt;&lt; std::isnan(nan) &lt;&lt; std::endl;  // 1 (true, proper way)
    return 0;
}
</code></pre>
<p>ä»¥ Rust ä¸ºä¾‹ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">//Rust

fn main() {
    let nan = f64::NAN;
    println!("{}", nan != nan);  // true
    println!("{}", nan == nan);  // false
    println!("{}", nan.is_nan());  // true (proper way)
}
</code></pre>
<h3 data-id="heading-5">3.3. ç¡¬ä»¶çº§åˆ«çš„å®ç°</h3>
<p>æœ‰è¶£çš„æ˜¯ï¼ŒNaN çš„æ¯”è¾ƒè¡Œä¸ºä¸æ˜¯åœ¨ JavaScript å¼•æ“å±‚é¢å®ç°çš„ï¼Œè€Œæ˜¯<strong>ç›´æ¥ç”± CPU ç¡¬ä»¶æä¾›</strong>çš„æ”¯æŒã€‚æƒ³ä¸€æƒ³ä¹Ÿå¾ˆåˆé€»è¾‘ï¼Œæˆ‘ä»¬æƒ³è¦å¯¹æ•°å­—è¿›è¡Œè¿ç®—ï¼ŒCPU ä¹Ÿæ˜¯åœ¨æ“ä½œæ•°å­—ï¼Œæ‰€ä»¥åœ¨ CPU ä¸­è¿›è¡Œè¿ç®—ä¼šæ˜¯æœ€å¿«çš„!</p>
<p>å½“æˆ‘ä»¬æŸ¥çœ‹ JavaScript å¼•æ“æºç æ—¶ï¼Œä¼šå‘ç°å®ƒä»¬ä¾èµ–åº•å±‚ç³»ç»Ÿçš„æ ‡å‡†åº“ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Firefox</span>
bool <span class="hljs-built_in">isNaN</span>() <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> <span class="hljs-title function_">isDouble</span>() &amp;&amp; <span class="hljs-attr">std</span>::<span class="hljs-title function_">isnan</span>(<span class="hljs-title function_">toDouble</span>()); }

<span class="hljs-comment">// V8</span>
<span class="hljs-keyword">if</span> (<span class="hljs-title class_">IsMinusZero</span>(value)) <span class="hljs-keyword">return</span> <span class="hljs-title function_">has_minus_zero</span>();
<span class="hljs-keyword">if</span> (<span class="hljs-attr">std</span>::<span class="hljs-title function_">isnan</span>(value)) <span class="hljs-keyword">return</span> <span class="hljs-title function_">has_nan</span>();
</code></pre>
<p>é‚£ CPU æ˜¯å¦‚ä½•è¯†åˆ« NaN çš„å‘¢ï¼Ÿ</p>
<p>ä»¥ x86 æ¶æ„çš„ CPU ä¸ºä¾‹ï¼Œå®ƒä¼šç”¨ä¸“é—¨çš„ â€œæµ®ç‚¹å¯„å­˜å™¨ï¼ˆxmm0ï¼‰â€ å¤„ç†æµ®ç‚¹æ•°è¿ç®—ï¼Œè¿˜ä¼šç”¨ä¸€æ¡å« ucomisd çš„æŒ‡ä»¤æ¯”è¾ƒä¸¤ä¸ªæµ®ç‚¹æ•° â€”â€” å¦‚æœæ¯”è¾ƒçš„æ˜¯ NaNï¼Œè¿™æ¡æŒ‡ä»¤ä¼šè®¾ç½®ä¸€ä¸ª â€œå¥‡å¶æ ‡å¿—ä½ï¼ˆPF=1ï¼‰â€ï¼Œç›¸å½“äºç»™ CPU å‘ä¿¡å·ï¼šâ€œè¿™æ˜¯ NaNï¼Œä¸èƒ½æ­£å¸¸æ¯”è¾ƒï¼â€</p>
<p>ç®€å•æ¥è¯´ï¼šå½“ä½ å†™ NaN === NaN æ—¶ï¼Œåº•å±‚ CPU å…¶å®å·²ç»åˆ¤æ–­å‡º â€œè¿™ä¸¤ä¸ªå€¼ç‰¹æ®Šâ€ï¼Œæ‰€ä»¥è¿”å› falseã€‚</p>
<p>å†ç›´è§‚ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ C è¯­è¨€ç›´æ¥æ“ä½œç¡¬ä»¶å¯„å­˜å™¨ï¼Œè®¡ç®— â€œ0.0/0.0â€ï¼ˆè¿™ä¼šç”Ÿæˆ NaNï¼‰ï¼š</p>
<pre><code class="hljs language-plain" lang="plain">#include &lt;stdio.h&gt;
#include &lt;stdint.h&gt;
int main() {
    double x = 0.0 / 0.0;
    // ç›´æ¥è¯»å– x åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶ä½
    uint64_t bits = *(uint64_t*)&amp;x;
    printf("NaN çš„åå…­è¿›åˆ¶è¡¨ç¤ºï¼š0x%016lx\n", bits);
    return 0;
}
</code></pre>
<p>è¿è¡Œç»“æœä¼šæ˜¯ <code>0xfff8000000000000</code>â€”â€” è¿™æ­£æ˜¯ IEEE 754 æ ‡å‡†è§„å®šçš„ NaN å­˜å‚¨æ ¼å¼ï¼Œå’Œ CPU çš„å¤„ç†é€»è¾‘å®Œå…¨å¯¹åº”ã€‚</p>
<h2 data-id="heading-6">4. JavaScript ä¸èƒ½æ²¡æœ‰ NaN</h2>
<p>åœ¨ IEEE 754 æ ‡å‡†ä¹‹å‰ï¼Œå„ç¡¬ä»¶å‚å•†æœ‰è‡ªå·±å¤„ç†æ— æ•ˆè¿ç®—çš„æ–¹å¼ã€‚å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œåƒ 0/0 è¿™æ ·çš„æ“ä½œä¼šç›´æ¥å¯¼è‡´<strong>ç¨‹åºå´©æºƒ</strong>ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰ NaNï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// æˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªæ•°å­¦è¿ç®—è¿›è¡Œé˜²å¾¡æ€§æ£€æŸ¥</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">safeDivide</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">if</span> (b === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Division by zero!"</span>);
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> a !== <span class="hljs-string">"number"</span> || <span class="hljs-keyword">typeof</span> b !== <span class="hljs-string">"number"</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"Arguments must be numbers!"</span>);
  }
  <span class="hljs-keyword">return</span> a / b;
}

<span class="hljs-comment">// ä½¿ç”¨try-catchåŒ…å›´æ¯ä¸ªå¯èƒ½å‡ºé”™çš„è¿ç®—</span>
<span class="hljs-keyword">try</span> {
  <span class="hljs-keyword">const</span> result = <span class="hljs-title function_">safeDivide</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>);
} <span class="hljs-keyword">catch</span> (e) {
  <span class="hljs-comment">// å¤„ç†é”™è¯¯...</span>
}
</code></pre>
<p>è€Œæœ‰äº† NaNï¼Œä»£ç å˜å¾—ç®€æ´è€Œå®‰å…¨ï¼š</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">divide</span>(<span class="hljs-params">a, b</span>) {
  <span class="hljs-keyword">return</span> a / b; <span class="hljs-comment">// è®©ç¡¬ä»¶å¤„ç†è¾¹ç•Œæƒ…å†µ</span>
}

<span class="hljs-keyword">const</span> result = <span class="hljs-title function_">divide</span>(<span class="hljs-number">10</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">// Infinity</span>
<span class="hljs-keyword">const</span> invalidResult = <span class="hljs-number">0</span> / <span class="hljs-number">0</span>; <span class="hljs-comment">// NaN</span>

<span class="hljs-keyword">if</span> (<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(invalidResult)) {
  <span class="hljs-comment">// åœ¨åˆé€‚çš„åœ°æ–¹ç»Ÿä¸€å¤„ç†é”™è¯¯</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"æ£€æµ‹åˆ°æ— æ•ˆè®¡ç®—"</span>);
}
</code></pre>
<h2 data-id="heading-7">5. å®é™…å¼€å‘ä¸­å¦‚ä½•æ£€æµ‹ï¼Ÿ</h2>
<p>åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•ä½¿ç”¨ NaN å‘¢ï¼Ÿ</p>
<h3 data-id="heading-8">5.1. ä½¿ç”¨ isNaN() å‡½æ•°ï¼ˆä¸æ¨èï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">isNaN</span>(<span class="hljs-title class_">NaN</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-built_in">isNaN</span>(<span class="hljs-string">"hello"</span>)); <span class="hljs-comment">// true - æ³¨æ„ï¼šå­—ç¬¦ä¸²ä¼šè¢«å…ˆè½¬æ¢ä¸ºæ•°å­—</span>
</code></pre>
<p><code>isNaN()</code> å‡½æ•°ä¼šå…ˆå°è¯•å°†å‚æ•°è½¬æ¢ä¸ºæ•°å­—ï¼Œè¿™å¯èƒ½å¯¼è‡´æ„å¤–çš„ç»“æœã€‚</p>
<h3 data-id="heading-9">5.2. ä½¿ç”¨ Number.isNaN()ï¼ˆæ¨èï¼‰</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(<span class="hljs-title class_">NaN</span>)); <span class="hljs-comment">// true</span>
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Number</span>.<span class="hljs-built_in">isNaN</span>(<span class="hljs-string">"hello"</span>)); <span class="hljs-comment">// false - ä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢</span>
</code></pre>
<p>ES6 å¼•å…¥çš„ <code>Number.isNaN()</code> åªä¼šå¯¹çœŸæ­£çš„ NaN å€¼è¿”å› trueï¼Œæ˜¯æ›´å®‰å…¨çš„é€‰æ‹©ã€‚</p>
<h3 data-id="heading-10">5.3. ä½¿ç”¨ Object.is() æ–¹æ³•</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">is</span>(<span class="hljs-title class_">NaN</span>, <span class="hljs-title class_">NaN</span>)); <span class="hljs-comment">// true</span>
</code></pre>
<p>ES6 çš„ <code>Object.is()</code> æ–¹æ³•èƒ½æ­£ç¡®è¯†åˆ« NaNï¼Œä½†å®ƒä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰æ¯”è¾ƒï¼Œé€‚ç”¨äºç‰¹æ®Šåœºæ™¯ã€‚</p>
<h2 data-id="heading-11">6. æ€»ç»“</h2>
<p>NaN !== NaN æ˜¯ JavaScript ä¸­ä¸€ä¸ªçœ‹ä¼¼å¥‡æ€ªä½†å´<strong>è®¾è®¡åˆç†</strong>çš„ç‰¹æ€§ã€‚å®ƒèƒŒåæ˜¯ IEEE 754 æ ‡å‡†çš„æ·±æ€ç†Ÿè™‘ï¼Œç›®çš„æ˜¯ä¸ºæµ®ç‚¹æ•°è¿ç®—æä¾›ä¸€è‡´ä¸”å¯é çš„é”™è¯¯å¤„ç†æœºåˆ¶ã€‚</p>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œè®°ä½ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<ol>
<li><strong>å§‹ç»ˆä½¿ç”¨<code>Number.isNaN()</code> è€Œä¸æ˜¯ <code>isNaN()</code> æ¥æ£€æµ‹ NaN å€¼</strong></li>
<li><strong>å«æœ‰ NaN çš„æ•°å­¦è¿ç®—æ€»ä¼šäº§ç”Ÿ NaN</strong></li>
<li><strong>åˆ©ç”¨è¿™ä¸€ç‰¹æ€§**</strong>åœ¨ä»£ç ä¸­ä¼˜é›…åœ°å¤„ç†é”™è¯¯æƒ…å†µ**</li>
<li><strong>è®°ä½ NaN æ˜¯æ•°å­—ç±»å‹çš„ç‰¹æ®Šå€¼ï¼Œè¿™åœ¨ç±»å‹æ£€æŸ¥æ—¶å¾ˆé‡è¦</strong></li>
</ol>
<h2 data-id="heading-12">7. å‚è€ƒé“¾æ¥</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpiccalil.li%2Fblog%2Fnan-the-not-a-number-number-that-isnt-nan%2F" target="_blank" title="https://piccalil.li/blog/nan-the-not-a-number-number-that-isnt-nan/" ref="nofollow noopener noreferrer">NaN, the not-a-number number that isnâ€™t NaN</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpzarycki.com%2Fen%2Fposts%2Fjs-nan%2F" target="_blank" title="https://pzarycki.com/en/posts/js-nan/" ref="nofollow noopener noreferrer">Why NaN !== NaN in JavaScript (and the IEEE 754 story behind it)</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Kotlinæ³›å‹ä½ç½®è§„å¾‹ä¸è®¾è®¡è€ƒé‡]]></title>    <link>https://juejin.cn/post/7570902804451409930</link>    <guid>https://juejin.cn/post/7570902804451409930</guid>    <pubDate>2025-11-10T11:56:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902804451409930" data-draft-id="7570932873130770459" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Kotlinæ³›å‹ä½ç½®è§„å¾‹ä¸è®¾è®¡è€ƒé‡"/> <meta itemprop="keywords" content="GitHub"/> <meta itemprop="datePublished" content="2025-11-10T11:56:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="é£å†·"/> <meta itemprop="url" content="https://juejin.cn/user/3843548379091742"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Kotlinæ³›å‹ä½ç½®è§„å¾‹ä¸è®¾è®¡è€ƒé‡
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3843548379091742/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    é£å†·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T11:56:17.000Z" title="Mon Nov 10 2025 11:56:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Kotlinæ³›å‹ä½ç½®è§„å¾‹ä¸è®¾è®¡è€ƒé‡</h2>
<h3 data-id="heading-1">1. æ³›å‹å‡ºç°çš„ä½ç½®åˆ†ç±»</h3>
<p>åœ¨Kotlinä¸­ï¼Œæ³›å‹å¯ä»¥å‡ºç°åœ¨ä»¥ä¸‹å‡ ä¸ªä¸»è¦ä½ç½®ï¼š</p>
<h4 data-id="heading-2">1.1 ç±»å£°æ˜ä¸­çš„æ³›å‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T : DeclarativeBaseView&lt;*, *</span>&gt;&gt;(
    <span class="hljs-keyword">val</span> pagerId: String,
    <span class="hljs-keyword">val</span> nativeRef: <span class="hljs-built_in">Int</span>
) {
    <span class="hljs-keyword">val</span> view: T?
        <span class="hljs-keyword">get</span>() = PagerManager.getPager(pagerId)
            .getViewWithNativeRef(nativeRef) <span class="hljs-keyword">as</span>? T
}
</code></pre>
<p><strong>è§„å¾‹</strong>ï¼š</p>
<ul>
<li>æ³›å‹å‚æ•°<code>&lt;T : DeclarativeBaseView&lt;*, *&gt;&gt;</code>ç´§è·Ÿåœ¨ç±»ååé¢</li>
<li>ç”¨äºå®šä¹‰æ•´ä¸ªç±»çš„ç±»å‹å‚æ•°</li>
<li>å¯ä»¥åœ¨ç±»çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨è¿™ä¸ªç±»å‹å‚æ•°</li>
</ul>
<p><strong>è®¾è®¡è€ƒé‡</strong>ï¼š</p>
<ul>
<li>ç±»å‹å®‰å…¨ï¼šç¡®ä¿ViewRefåªèƒ½å¼•ç”¨ç‰¹å®šç±»å‹çš„è§†å›¾</li>
<li>ä»£ç å¤ç”¨ï¼šä¸€ä¸ªç±»å¯ä»¥å¤„ç†å¤šç§ç±»å‹ï¼Œä½†ä¿æŒç±»å‹å®‰å…¨</li>
<li>APIä¸€è‡´æ€§ï¼šæ‰€æœ‰ViewRefå®ä¾‹éƒ½æœ‰ç›¸åŒçš„æ–¹æ³•ç­¾åï¼Œä½†ç±»å‹ä¸åŒ</li>
</ul>
<h4 data-id="heading-3">1.2 å‡½æ•°å£°æ˜ä¸­çš„æ³›å‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    ref(ViewRef&lt;T&gt;(pagerId, nativeRef))
}
</code></pre>
<p><strong>è§„å¾‹</strong>ï¼š</p>
<ul>
<li>æ³›å‹å‚æ•°<code>&lt;T : DeclarativeBaseView&lt;*, *&gt;&gt;</code>åœ¨funå…³é”®å­—å’Œå‡½æ•°åä¹‹é—´</li>
<li>ç”¨äºå®šä¹‰å‡½æ•°çš„ç±»å‹å‚æ•°</li>
<li>å¯ä»¥åœ¨å‡½æ•°çš„å‚æ•°ã€è¿”å›å€¼å’Œå‡½æ•°ä½“ä¸­ä½¿ç”¨è¿™ä¸ªç±»å‹å‚æ•°</li>
</ul>
<p><strong>è®¾è®¡è€ƒé‡</strong>ï¼š</p>
<ul>
<li>æ‰©å±•å‡½æ•°ï¼šä¸ºç‰¹å®šç±»å‹çš„æ‰€æœ‰å­ç±»æä¾›ç»Ÿä¸€æ–¹æ³•</li>
<li>ç±»å‹æ¨æ–­ï¼šç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨æ¨æ–­Tçš„ç±»å‹</li>
<li>çµæ´»æ€§ï¼šåŒä¸€ä¸ªå‡½æ•°å¯ä»¥å¤„ç†å¤šç§ç±»å‹ï¼Œä½†ä¿æŒç±»å‹å®‰å…¨</li>
</ul>
<h4 data-id="heading-4">1.3 æ¥å£å£°æ˜ä¸­çš„æ³›å‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">IViewPublicApi</span>&lt;<span class="hljs-type">A : Attr, E : Event</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">attr</span><span class="hljs-params">(<span class="hljs-keyword">init</span>: <span class="hljs-type">A</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">event</span><span class="hljs-params">(<span class="hljs-keyword">init</span>: <span class="hljs-type">E</span>.() -&gt; <span class="hljs-type">Unit</span>)</span></span>
}
</code></pre>
<p><strong>è§„å¾‹</strong>ï¼š</p>
<ul>
<li>æ¥å£çº§åˆ«çš„æ³›å‹<code>&lt;A : Attr, E : Event&gt;</code>åœ¨æ¥å£åå</li>
<li>æ–¹æ³•çº§åˆ«çš„æ³›å‹<code>&lt;T : DeclarativeBaseView&lt;*, *&gt;&gt;</code>åœ¨æ–¹æ³•åå‰</li>
</ul>
<p><strong>è®¾è®¡è€ƒé‡</strong>ï¼š</p>
<ul>
<li>æ¥å£æ³›å‹ï¼šå®šä¹‰æ¥å£çš„ç±»å‹å‚æ•°ï¼Œå½±å“æ•´ä¸ªæ¥å£</li>
<li>æ–¹æ³•æ³›å‹ï¼šåªå½±å“ç‰¹å®šæ–¹æ³•çš„ç±»å‹å‚æ•°</li>
</ul>
<h3 data-id="heading-5">2. æ³›å‹ä½ç½®çš„è®¾è®¡è§„å¾‹</h3>
<h4 data-id="heading-6">2.1 ä½œç”¨åŸŸè§„å¾‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç±»çº§åˆ«æ³›å‹ï¼šä½œç”¨åŸŸæ˜¯æ•´ä¸ªç±»</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T : DeclarativeBaseView&lt;*, *</span>&gt;&gt; {
    <span class="hljs-keyword">val</span> view: T? <span class="hljs-comment">// Tåœ¨æ•´ä¸ªç±»ä¸­å¯ç”¨</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span>: T? { <span class="hljs-keyword">return</span> view } <span class="hljs-comment">// Tåœ¨æ–¹æ³•ä¸­å¯ç”¨</span>
}

<span class="hljs-comment">// å‡½æ•°çº§åˆ«æ³›å‹ï¼šä½œç”¨åŸŸæ˜¯æ•´ä¸ªå‡½æ•°</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-comment">// Tåªåœ¨å‡½æ•°å†…å¯ç”¨</span>
    ref(ViewRef&lt;T&gt;(pagerId, nativeRef))
}
</code></pre>
<h4 data-id="heading-7">2.2 ç”Ÿå‘½å‘¨æœŸè§„å¾‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç±»æ³›å‹ï¼šä¸ç±»å®ä¾‹ç”Ÿå‘½å‘¨æœŸç›¸åŒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> items = mutableListOf&lt;T&gt;()
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">add</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span> { items.add(item) }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">(index: <span class="hljs-type">Int</span>)</span></span>: T = items[index]
}

<span class="hljs-comment">// å‡½æ•°æ³›å‹ï¼šåªå­˜åœ¨äºå‡½æ•°è°ƒç”¨æœŸé—´</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">createList</span><span class="hljs-params">(<span class="hljs-keyword">vararg</span> items: <span class="hljs-type">T</span>)</span></span>: List&lt;T&gt; {
    <span class="hljs-keyword">return</span> listOf(*items) <span class="hljs-comment">// Tåªåœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´æœ‰æ•ˆ</span>
}
</code></pre>
<h3 data-id="heading-8">3. æ³›å‹çº¦æŸçš„ä½ç½®è§„å¾‹</h3>
<h4 data-id="heading-9">3.1 ä¸Šç•Œçº¦æŸ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç±»æ³›å‹çº¦æŸ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T : DeclarativeBaseView&lt;*, *</span>&gt;&gt; { <span class="hljs-comment">// Tå¿…é¡»æ˜¯DeclarativeBaseViewçš„å­ç±»</span>
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// å‡½æ•°æ³›å‹çº¦æŸ</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(...)</span></span> { <span class="hljs-comment">// Tå¿…é¡»æ˜¯DeclarativeBaseViewçš„å­ç±»</span>
    <span class="hljs-comment">// ...</span>
}

<span class="hljs-comment">// å¤šé‡çº¦æŸ</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">process</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span> <span class="hljs-keyword">where</span> T : DeclarativeBaseView&lt;*, *&gt;, T : Cloneable {
    <span class="hljs-comment">// Tå¿…é¡»åŒæ—¶æ»¡è¶³ä¸¤ä¸ªçº¦æŸ</span>
}
</code></pre>
<h4 data-id="heading-10">3.2 å‹å˜çº¦æŸ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç”Ÿäº§è€…ä½ç½®ï¼ˆoutï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Producer</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produce</span><span class="hljs-params">()</span></span>: T { ... }
}

<span class="hljs-comment">// æ¶ˆè´¹è€…ä½ç½®ï¼ˆinï¼‰</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Consumer</span>&lt;<span class="hljs-type">in T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consume</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span> { ... }
}

<span class="hljs-comment">// ä¸å˜ä½ç½®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Container</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">get</span><span class="hljs-params">()</span></span>: T { ... }
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">set</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span> { ... }
}
</code></pre>
<h3 data-id="heading-11">4. æ³›å‹åœ¨Kotlinä¸­çš„ç‰¹æ®Šä½ç½®</h3>
<h4 data-id="heading-12">4.1 æ‰©å±•å‡½æ•°ä¸­çš„æ³›å‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æ‰©å±•å‡½æ•°æ³›å‹ï¼šTæ˜¯æ¥æ”¶è€…ç±»å‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-comment">// Tæ—¢æ˜¯æ³›å‹å‚æ•°ï¼Œä¹Ÿæ˜¯æ¥æ”¶è€…ç±»å‹</span>
}

<span class="hljs-comment">// æ‰©å±•å±æ€§ä¸­çš„æ³›å‹</span>
<span class="hljs-keyword">val</span> &lt;T : DeclarativeBaseView&lt;*, *&gt;&gt; T.refCount: <span class="hljs-built_in">Int</span>
    <span class="hljs-keyword">get</span>() = <span class="hljs-number">1</span>
</code></pre>
<h4 data-id="heading-13">4.2 é«˜é˜¶å‡½æ•°ä¸­çš„æ³›å‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å‡½æ•°ç±»å‹ä¸­çš„æ³›å‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">execute</span><span class="hljs-params">(operation: (<span class="hljs-type">T</span>) -&gt; <span class="hljs-type">Unit</span>, param: <span class="hljs-type">T</span>)</span></span> {
    operation(param)
}

<span class="hljs-comment">// å‡½æ•°ç±»å‹å‚æ•°ä¸­çš„æ³›å‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-comment">// Tåœ¨å‡½æ•°ç±»å‹å‚æ•°ä¸­ä½¿ç”¨</span>
}
</code></pre>
<h4 data-id="heading-14">4.3 æ³›å‹å‹å˜</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// åå˜ï¼ˆoutï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Producer</span>&lt;<span class="hljs-type">out T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">produce</span><span class="hljs-params">()</span></span>: T
}

<span class="hljs-comment">// é€†å˜ï¼ˆinï¼‰</span>
<span class="hljs-keyword">interface</span> <span class="hljs-title class_">Consumer</span>&lt;<span class="hljs-type">in T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">consume</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span>
}

<span class="hljs-comment">// æ˜ŸæŠ•å½±</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(list: <span class="hljs-type">List</span>&lt;*&gt;)</span></span> {
    <span class="hljs-comment">// List&lt;*&gt; è¡¨ç¤ºæœªçŸ¥ç±»å‹çš„List</span>
}
</code></pre>
<h3 data-id="heading-15">5. å®é™…é¡¹ç›®ä¸­çš„æ³›å‹ä½ç½®é€‰æ‹©</h3>
<h4 data-id="heading-16">5.1 ç±»æ³›å‹ vs å‡½æ•°æ³›å‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä½¿ç”¨ç±»æ³›å‹çš„æƒ…å†µï¼šç±»å‹éœ€è¦åœ¨æ•´ä¸ªç±»ä¸­ä¿æŒä¸€è‡´</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T : DeclarativeBaseView&lt;*, *</span>&gt;&gt; {
    <span class="hljs-keyword">val</span> view: T? <span class="hljs-comment">// éœ€è¦åœ¨å¤šä¸ªåœ°æ–¹ä½¿ç”¨T</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span>: T? { <span class="hljs-keyword">return</span> view }
}

<span class="hljs-comment">// ä½¿ç”¨å‡½æ•°æ³›å‹çš„æƒ…å†µï¼šç±»å‹åªåœ¨å‡½æ•°ä¸­ä½¿ç”¨</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; T.<span class="hljs-title">ref</span><span class="hljs-params">(ref: (<span class="hljs-type">viewRef</span>: <span class="hljs-type">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt;) -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    <span class="hljs-comment">// Tåªåœ¨å‡½æ•°å†…ä½¿ç”¨</span>
}
</code></pre>
<h4 data-id="heading-17">5.2 å¤šå±‚æ³›å‹åµŒå¥—</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¤šå±‚æ³›å‹åµŒå¥—</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">PagerManager</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : DeclarativeBaseView&lt;*, *&gt;</span>&gt; <span class="hljs-title">getView</span><span class="hljs-params">(pagerId: <span class="hljs-type">String</span>, nativeRef: <span class="hljs-type">Int</span>)</span></span>: T? {
        <span class="hljs-keyword">return</span> PagerManager.getPager(pagerId)
            .getViewWithNativeRef(nativeRef) <span class="hljs-keyword">as</span>? T
    }
}

<span class="hljs-comment">// ä½¿ç”¨æ—¶</span>
<span class="hljs-keyword">val</span> textView: TextView? = PagerManager.getView&lt;TextView&gt;(<span class="hljs-string">"pager1"</span>, <span class="hljs-number">123</span>)
<span class="hljs-keyword">val</span> buttonView: Button? = PagerManager.getView&lt;Button&gt;(<span class="hljs-string">"pager1"</span>, <span class="hljs-number">456</span>)
</code></pre>
<h3 data-id="heading-18">6. æ³›å‹ä½ç½®çš„è®¾è®¡åŸåˆ™</h3>
<h4 data-id="heading-19">6.1 æœ€å°ä½œç”¨åŸŸåŸåˆ™</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¥½çš„è®¾è®¡ï¼šæ³›å‹ä½œç”¨åŸŸæœ€å°åŒ–</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T&gt;</span> <span class="hljs-title">process</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span>: String {
    <span class="hljs-keyword">return</span> item.toString()
}

<span class="hljs-comment">// é¿å…ï¼šä¸å¿…è¦çš„ç±»æ³›å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Processor</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">process</span><span class="hljs-params">(item: <span class="hljs-type">T</span>)</span></span>: String {
        <span class="hljs-keyword">return</span> item.toString()
    }
}
</code></pre>
<h4 data-id="heading-20">6.2 ç±»å‹å®‰å…¨åŸåˆ™</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¥½çš„è®¾è®¡ï¼šæ˜ç¡®çš„ç±»å‹çº¦æŸ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T : DeclarativeBaseView&lt;*, *</span>&gt;&gt; {
    <span class="hljs-comment">// ç¡®ä¿Tæ˜¯DeclarativeBaseViewçš„å­ç±»</span>
}

<span class="hljs-comment">// é¿å…ï¼šæ— çº¦æŸçš„æ³›å‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-comment">// Tå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼Œå¯èƒ½å¯¼è‡´è¿è¡Œæ—¶é”™è¯¯</span>
}
</code></pre>
<h4 data-id="heading-21">6.3 å¯è¯»æ€§åŸåˆ™</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// å¥½çš„è®¾è®¡ï¼šæœ‰æ„ä¹‰çš„æ³›å‹å‚æ•°å</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">TView : DeclarativeBaseView&lt;*, *</span>&gt;&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getView</span><span class="hljs-params">()</span></span>: TView? { ... }
}

<span class="hljs-comment">// é¿å…ï¼šæ— æ„ä¹‰çš„æ³›å‹å‚æ•°å</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRef</span>&lt;<span class="hljs-type">T</span>&gt; {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getView</span><span class="hljs-params">()</span></span>: T? { ... }
}
</code></pre>
<h3 data-id="heading-22">7. æ€»ç»“</h3>
<p>Kotlinä¸­æ³›å‹ä½ç½®çš„é€‰æ‹©éµå¾ªä»¥ä¸‹è§„å¾‹å’ŒåŸåˆ™ï¼š</p>
<ol>
<li>
<p><strong>ä½œç”¨åŸŸå†³å®šä½ç½®</strong>ï¼š</p>
<ul>
<li>ç±»æ³›å‹ï¼šéœ€è¦åœ¨æ•´ä¸ªç±»ä¸­ä½¿ç”¨</li>
<li>å‡½æ•°æ³›å‹ï¼šåªåœ¨å‡½æ•°ä¸­ä½¿ç”¨</li>
<li>æ¥å£æ³›å‹ï¼šå½±å“æ•´ä¸ªæ¥å£</li>
</ul>
</li>
<li>
<p><strong>ç”Ÿå‘½å‘¨æœŸå†³å®šä½ç½®</strong>ï¼š</p>
<ul>
<li>é•¿ç”Ÿå‘½å‘¨æœŸï¼šä½¿ç”¨ç±»æ³›å‹</li>
<li>çŸ­ç”Ÿå‘½å‘¨æœŸï¼šä½¿ç”¨å‡½æ•°æ³›å‹</li>
</ul>
</li>
<li>
<p><strong>ç±»å‹å®‰å…¨å†³å®šçº¦æŸ</strong>ï¼š</p>
<ul>
<li>æ˜ç¡®çº¦æŸï¼šä½¿ç”¨ä¸Šç•Œçº¦æŸ</li>
<li>å¤šé‡çº¦æŸï¼šä½¿ç”¨whereå­å¥</li>
</ul>
</li>
<li>
<p><strong>ä½¿ç”¨åœºæ™¯å†³å®šå‹å˜</strong>ï¼š</p>
<ul>
<li>ç”Ÿäº§è€…ï¼šä½¿ç”¨out</li>
<li>æ¶ˆè´¹è€…ï¼šä½¿ç”¨in</li>
<li>è¯»å†™æ“ä½œï¼šä¸å˜</li>
</ul>
</li>
</ol>
<p>åœ¨ViewRefçš„è®¾è®¡ä¸­ï¼š</p>
<ul>
<li>ç±»æ³›å‹<code>&lt;T : DeclarativeBaseView&lt;*, *&gt;&gt;</code>ç¡®ä¿ç±»å‹å®‰å…¨</li>
<li>å‡½æ•°æ³›å‹<code>&lt;T : DeclarativeBaseView&lt;*, *&gt;&gt; T.ref(...)</code>æä¾›æ‰©å±•èƒ½åŠ›</li>
<li>æ³›å‹çº¦æŸç¡®ä¿åªèƒ½å¼•ç”¨æ­£ç¡®çš„è§†å›¾ç±»å‹</li>
<li>æ³›å‹ä½ç½®çš„é€‰æ‹©å¹³è¡¡äº†çµæ´»æ€§ã€å®‰å…¨æ€§å’Œå¯è¯»æ€§</li>
</ul>
<p>è¿™ç§è®¾è®¡ä½¿å¾—ViewRefæ—¢ç±»å‹å®‰å…¨åˆä½¿ç”¨çµæ´»ï¼Œæ˜¯Kotlinæ³›å‹ç³»ç»Ÿåœ¨å®é™…é¡¹ç›®ä¸­çš„ä¼˜ç§€åº”ç”¨ã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»]]></title>    <link>https://juejin.cn/post/7570940025580486696</link>    <guid>https://juejin.cn/post/7570940025580486696</guid>    <pubDate>2025-11-10T11:58:10.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570940025580486696" data-draft-id="7569864390942425139" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»"/> <meta itemprop="keywords" content="ç®—æ³•,äººå·¥æ™ºèƒ½"/> <meta itemprop="datePublished" content="2025-11-10T11:58:10.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ç½—è¥¿çš„æ€è€ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/351470467691175"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/351470467691175/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ç½—è¥¿çš„æ€è€ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T11:58:10.000Z" title="Mon Nov 10 2025 11:58:10 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»27åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">ã€Agentã€‘ç”Ÿæˆå¼éšå¼è®°å¿† MemGen æºç è§£è¯»</h2>
<p>[toc]</p>
<h3 data-id="heading-1">0x00 æ¦‚è¦</h3>
<p>MemGenæ—¨åœ¨æ„å»ºä¸€ä¸ªåŠ¨æ€ã€ç”Ÿæˆå¼çš„è®°å¿†æ¡†æ¶ï¼Œå…¶æ ¸å¿ƒç”±ä¸¤ä¸ªååŒå·¥ä½œçš„è½»é‡çº§æ¨¡å—æ„æˆï¼šä¸€ä¸ªåŸºäºå¼ºåŒ–å­¦ä¹ ï¼ˆRLï¼‰è®­ç»ƒçš„è®°å¿†è§¦å‘å™¨ï¼ˆMemory Triggerï¼‰å’Œä¸€ä¸ªè®°å¿†ç¼–ç»‡å™¨ï¼ˆMemory Weaverï¼‰ã€‚</p>
<p>è®ºæ–‡ï¼šMemGen: Weaving Generative Latent Memory for Self-Evolving Agents</p>
<p>é“¾æ¥ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2509.24704" target="_blank" title="https://arxiv.org/abs/2509.24704" ref="nofollow noopener noreferrer">arxiv.org/abs/2509.24â€¦</a></p>
<p>ä»£ç ï¼š<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FKANABOON1%2FMemGen" target="_blank" title="https://github.com/KANABOON1/MemGen" ref="nofollow noopener noreferrer">github.com/KANABOON1/Mâ€¦</a></p>
<h3 data-id="heading-2">0x01 èƒŒæ™¯</h3>
<p>MemGen æå‡ºåŠ¨æ€ç”Ÿæˆå¼è®°å¿†æ¡†æ¶ï¼Œç”±è®°å¿†è§¦å‘å™¨ä¸è®°å¿†ç¼–ç»‡å™¨ä¸¤ä¸ªè½»é‡æ¨¡å—ååŒæ„æˆï¼Œæ—¨åœ¨çªç ´ç°æœ‰æ™ºèƒ½ä½“è®°å¿†èŒƒå¼çš„å±€é™ã€‚</p>
<p>å½“å‰ä¸»æµçš„è®°å¿†å®ç°è·¯å¾„ä¸ºï¼š</p>
<ul>
<li>å‚æ•°åŒ–è®°å¿†é€šè¿‡å¾®è°ƒå°†ç»éªŒç¼–ç è¿›æ¨¡å‹å‚æ•°ï¼Œè™½èƒ½æ·±åº¦å†…åŒ–çŸ¥è¯†å´æ˜“å¼•å‘ç¾éš¾æ€§é—å¿˜ï¼›</li>
<li>åŸºäºæ£€ç´¢çš„è®°å¿†å°†ç»éªŒå¤–åŒ–å­˜å‚¨ï¼Œè™½è§„é¿äº†é—å¿˜é—®é¢˜ï¼Œä½†é™æ€çš„ä¸€æ¬¡æ€§æ£€ç´¢æœºåˆ¶æ— æ³•ä½“ç°è®°å¿†ä¸æ¨ç†åŠ¨æ€äº¤äº’çš„è®¤çŸ¥ç‰¹æ€§ã€‚</li>
</ul>
<p>è¿™ä¸€ç°çŠ¶å¼•å‡ºä¸¤å¤§æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•å®ç°è®°å¿†ä¸æ¨ç†åœ¨æ¯ä¸€æ­¥æ€è€ƒä¸­çš„æ— ç¼è€¦åˆï¼Œä»¥åŠå¦‚ä½•è®©è®°å¿†ä»æå–å¼å‡çº§ä¸ºæ»¡è¶³å½“å‰éœ€æ±‚çš„ç”Ÿæˆå¼é‡æ„ï¼Œè€ŒåŠ¨æ€ç”Ÿæˆå¼éšå¼è®°å¿†æ­£æ˜¯åº”å¯¹è¿™äº›æŒ‘æˆ˜çš„ç¬¬ä¸‰ç§æ¢ç´¢è·¯å¾„ã€‚</p>
<h3 data-id="heading-3">0x02 æºç è§£æ</h3>
<p>MemGené¡¹ç›®æ—¨åœ¨åˆ›å»ºä¸€ä¸ªåŠ¨æ€ä¸”è‡ªç”Ÿæˆçš„è®°å¿†æ¡†æ¶ï¼Œè¯¥æ¡†æ¶ç”±ä¸¤ä¸ªååŒå·¥ä½œçš„è½»é‡çº§æ¨¡å—ç»„æˆï¼šä¸€ä¸ªåŸºäºå¼ºåŒ–å­¦ä¹ è®­ç»ƒçš„è®°å¿†è§¦å‘å™¨å’Œä¸€ä¸ªè®°å¿†ç¼–ç»‡å™¨ã€‚è¿™ä¸€æ¡†æ¶çš„æ ¸å¿ƒæ€æƒ³æ˜¯è§£å†³å¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰æ™ºèƒ½ä½“èƒ½åŠ›æ¶Œç°æ—¶å¯¹â€œè‡ªè¿›åŒ–â€æœºåˆ¶çš„æ¢ç´¢éœ€æ±‚ï¼Œå…¶ä¸­è®°å¿†æ‰®æ¼”å…³é”®è§’è‰²ã€‚</p>
<h4 data-id="heading-4">2.1 æ¨¡å‹</h4>
<p>LatentMemoryModel æ˜¯ MemGen æ¡†æ¶çš„æ ¸å¿ƒå®ç°ï¼Œæ—¨åœ¨æ„å»ºåŠ¨æ€ç”Ÿæˆå¼éšå¼è®°å¿†ç³»ç»Ÿï¼Œè§£å†³ä¼ ç»Ÿè®°å¿†èŒƒå¼çš„å±€é™æ€§ã€‚é€šè¿‡æ•´åˆæ¨ç†å™¨ï¼ˆReasonerï¼‰ã€è®°å¿†ç¼–ç»‡å™¨ï¼ˆWeaverï¼‰å’Œè®°å¿†è§¦å‘å™¨ï¼ˆTriggerï¼‰ï¼Œå®ç°è®°å¿†ä¸æ¨ç†è¿‡ç¨‹çš„æ— ç¼è€¦åˆï¼Œè®©æ™ºèƒ½ä½“åœ¨ä»»åŠ¡æ‰§è¡Œä¸­åŠ¨æ€ç”Ÿæˆã€ä½¿ç”¨è®°å¿†ï¼Œè€Œéä¾èµ–é™æ€æ£€ç´¢æˆ–å‚æ•°åŒ–å­˜å‚¨ã€‚</p>
<h5 data-id="heading-5">2.1.1  æ ¸å¿ƒç‰¹è‰²</h5>
<p>æ¨¡å‹çš„æ ¸å¿ƒç‰¹è‰²å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong>æ¨¡å—åŒ–ååŒè®¾è®¡</strong>ï¼šç”±æ¨ç†å™¨ï¼ˆæ ¸å¿ƒæ¨ç†ï¼‰ã€ç¼–ç»‡å™¨ï¼ˆç”Ÿæˆæ½œåœ¨è®°å¿†ï¼‰ã€è§¦å‘å™¨ï¼ˆæ§åˆ¶è®°å¿†è§¦å‘ï¼‰ä¸‰å¤§æ¨¡å—æ„æˆï¼Œæ¨¡å—é—´é€šè¿‡æŠ•å½±å±‚å®ç°åµŒå…¥ç©ºé—´æ˜ å°„ï¼Œç»“æ„æ¸…æ™°ä¸”è§£è€¦ã€‚</li>
<li><strong>åŠ¨æ€è®°å¿†å¢å¼º</strong>ï¼šåœ¨æ¨ç†è¿‡ç¨‹ä¸­è‡ªåŠ¨è¯†åˆ«åˆ†éš”ç¬¦ä½ç½®ä½œä¸ºè®°å¿†å¢å¼ºç‚¹ï¼ŒåŠ¨æ€æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œçªç ´é™æ€è®°å¿†æ³¨å…¥çš„å±€é™ï¼Œè´´åˆäººç±»è®¤çŸ¥ä¸­è®°å¿†ä¸æ¨ç†çš„åŠ¨æ€äº¤äº’ç‰¹æ€§ã€‚</li>
<li><strong>ç²¾åº¦ä¸æ•ˆç‡ä¼˜åŒ–</strong>ï¼šé»˜è®¤ä½¿ç”¨ bfloat16 ç²¾åº¦ï¼Œæ¨ç†å™¨é‡‡ç”¨ Flash Attention 2 æå‡è®¡ç®—æ•ˆç‡ï¼›å†»ç»“æ¨ç†å™¨å‚æ•°ï¼Œä»…è®­ç»ƒç¼–ç»‡å™¨å’Œè§¦å‘å™¨ï¼Œå®ç°å‚æ•°é«˜æ•ˆå­¦ä¹ ã€‚</li>
<li><strong>çµæ´»é…ç½®ä¸å…¼å®¹æ€§</strong>ï¼šæ”¯æŒè‡ªå®šä¹‰è§¦å‘å™¨æ¨¡å‹ã€PEFT å¾®è°ƒé…ç½®ã€è®°å¿†å¢å¼ºæ¬¡æ•°ç­‰å‚æ•°ï¼›è‡ªåŠ¨å¤„ç† Tokenizer ç¼ºå¤± pad token çš„é—®é¢˜ï¼Œæ ‡å‡†åŒ–å¯¹è¯æ¨¡æ¿ï¼Œæå‡è·¨åœºæ™¯å…¼å®¹æ€§ã€‚</li>
<li><strong>æŸå¤±è®¡ç®—ç²¾å‡†è¿‡æ»¤</strong>ï¼šé€šè¿‡æ½œåœ¨è®°å¿†æ©ç æ’é™¤è®°å¿†åµŒå…¥å¯¹åº”çš„ä½ç½®ï¼Œä»…å¯¹åŸå§‹è¾“å…¥ä½ç½®è®¡ç®—æŸå¤±ï¼Œç¡®ä¿è®­ç»ƒç›®æ ‡èšç„¦äºæ ¸å¿ƒä»»åŠ¡æ€§èƒ½ï¼Œé¿å…è®°å¿†ç”Ÿæˆè¿‡ç¨‹å¹²æ‰°ä¸»ä»»åŠ¡å­¦ä¹ ã€‚</li>
</ul>
<h5 data-id="heading-6">2.1.2  ç½‘ç»œç»“æ„</h5>
<p>å…³é”®è¯´æ˜ï¼ˆæ ¸å¿ƒè®¾è®¡äº®ç‚¹ï¼‰</p>
<ol>
<li><strong>ä¸‰å¤§æ¨¡å—ååŒé€»è¾‘</strong>ï¼š
<ul>
<li>æ¨ç†å™¨ï¼ˆReasonerï¼‰ï¼šæ ¸å¿ƒæ¨ç†ç»„ä»¶ï¼Œæƒé‡å†»ç»“ä»¥ä¿ç•™åŸºç¡€èƒ½åŠ›ï¼Œä»…é€šè¿‡æ½œåœ¨è®°å¿†è°ƒæ•´è§£ç è·¯å¾„ã€‚</li>
<li>è§¦å‘å™¨ï¼ˆMemGenTriggerï¼‰ï¼šåŠ¨æ€åˆ¤æ–­è®°å¿†æ’å…¥æ—¶æœºï¼Œè¾“å‡ºäºŒåˆ†ç±»è§¦å‘æ¦‚ç‡ï¼Œå†³å®šæ˜¯å¦è°ƒç”¨ç¼–ç»‡å™¨ã€‚</li>
<li>ç¼–ç»‡å™¨ï¼ˆMemGenWeaverï¼‰ï¼šç”Ÿæˆé’ˆå¯¹æ€§æ½œåœ¨è®°å¿†ï¼Œåˆ†æç¤ºè¯ / æ¨ç†ä¸¤é˜¶æ®µè®¾è®¡ï¼Œæ”¯æŒ PEFT é«˜æ•ˆå¾®è°ƒã€‚</li>
</ul>
</li>
<li><strong>æ ¸å¿ƒæµç¨‹é—­ç¯</strong>ï¼šè¾“å…¥ â†’ æ¨ç†å™¨ç”ŸæˆåŸå§‹åµŒå…¥ â†’ è§¦å‘å™¨ + å¢å¼ºç‚¹é€‰æ‹©æ¨¡å—ç¡®å®šæ’å…¥ä½ç½® â†’ ç¼–ç»‡å™¨ç”Ÿæˆæ½œåœ¨è®°å¿† â†’ æŠ•å½±å±‚é€‚é…ç»´åº¦ â†’ é‡ç»„å¢å¼ºåºåˆ— â†’ æ¨ç†å™¨å®Œæˆæœ€ç»ˆæ¨ç† â†’ è¿‡æ»¤æ— æ•ˆä½ç½®è¾“å‡ºã€‚</li>
<li><strong>å…³é”®æŠ€æœ¯ç»†èŠ‚</strong>ï¼š
<ul>
<li>è·¨æ¨¡å—æŠ•å½±ï¼šé€šè¿‡ <code>reasoner_to_weaver</code> å’Œ <code>weaver_to_reasoner</code> è§£å†³æ¨ç†å™¨ä¸ç¼–ç»‡å™¨åµŒå…¥ç»´åº¦ä¸åŒ¹é…é—®é¢˜ã€‚</li>
<li>åŠ¨æ€è®°å¿†å¢å¼ºï¼šæŒ‰åˆ†éš”ç¬¦æ‹†åˆ†åºåˆ—ï¼Œé€æ®µæ’å…¥è®°å¿†ï¼Œé¿å…é•¿åºåˆ—å†—ä½™ï¼Œè´´åˆäººç±» â€œæ€è€ƒ - è®°å¿†â€ äº¤äº’æ¨¡å¼ã€‚</li>
<li>ç²¾åº¦ä¸æ•ˆç‡ï¼šå…¨æµç¨‹é‡‡ç”¨ bfloat16 ç²¾åº¦ï¼Œæ¨ç†å™¨ / ç¼–ç»‡å™¨å¯ç”¨ Flash Attention 2ï¼Œå¹³è¡¡æ€§èƒ½ä¸é€Ÿåº¦ã€‚</li>
</ul>
</li>
<li><strong>è®­ç»ƒä¸æ¨ç†é€‚é…</strong>ï¼š
<ul>
<li>è®­ç»ƒæ—¶ï¼šé€šè¿‡ <code>labels</code> å’Œ <code>valid_logits</code> è®¡ç®—æŸå¤±ï¼Œä»…ä¼˜åŒ–ç¼–ç»‡å™¨ã€è§¦å‘å™¨åŠæŠ•å½±å±‚å‚æ•°ã€‚</li>
<li>æ¨ç†æ—¶ï¼šæ— éœ€ <code>labels</code>ï¼Œè‡ªåŠ¨å®Œæˆ â€œè§¦å‘åˆ¤æ–­ - è®°å¿†ç”Ÿæˆ - æ¨ç†å¢å¼ºâ€ å…¨æµç¨‹ï¼Œå®ç°åŠ¨æ€è‡ªè¿›åŒ–ã€‚</li>
</ul>
</li>
</ol>
<p>å…·ä½“ç½‘ç»œç»“æ„å¦‚ä¸‹</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fedf1bee4f404d00b60b5ade066b5dd0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=udJwW4ZcYOdkSaA%2FuS5q7k6%2FUAc%3D" alt="MemGen-1.png" loading="lazy"/></p>
<h5 data-id="heading-7">2.1.3 ä»£ç </h5>
<p>LatentMemoryModel çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@registry.register_model(<span class="hljs-params"><span class="hljs-string">"latmem"</span></span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LatentMemoryModel</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):  <span class="hljs-comment"># å®šä¹‰äº†ä¸€ä¸ªåä¸º LatentMemoryModel çš„ç±»ï¼Œç»§æ‰¿è‡ª BaseModel</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self, 
        reasoner_model_name: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># æ¨ç†æ¨¡å‹åç§°</span>
        weaver_model_name: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># è®°å¿†ç¼–ç»‡å™¨æ¨¡å‹åç§°</span>
        prompt_latents_len: <span class="hljs-built_in">int</span>,  <span class="hljs-comment"># æç¤ºé•¿åº¦</span>
        inference_latents_len: <span class="hljs-built_in">int</span>,  <span class="hljs-comment"># æ¨ç†é•¿åº¦</span>
        weaver_peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># è®°å¿†ç¼–ç»‡å™¨é…ç½®ï¼Œå¯é€‰</span>
        trigger_model_name: <span class="hljs-built_in">str</span> = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># è§¦å‘æ¨¡å‹åç§°ï¼Œå¯é€‰</span>
        trigger_peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># è§¦å‘å™¨é…ç½®ï¼Œå¯é€‰</span>
        max_prompt_aug_num: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>,  <span class="hljs-comment"># æœ€å¤§æç¤ºå¢å¼ºæ•°é‡</span>
        max_inference_aug_num: <span class="hljs-built_in">int</span> = <span class="hljs-number">5</span>,  <span class="hljs-comment"># æœ€å¤§æ¨ç†å¢å¼ºæ•°é‡</span>
    </span>):   
        <span class="hljs-built_in">super</span>().__init__()  <span class="hljs-comment"># è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°</span>

        <span class="hljs-comment"># æ„å»ºæ¨ç†æ¨¡å‹</span>
        self.model = AutoModelForCausalLM.from_pretrained(  <span class="hljs-comment"># ä»é¢„è®­ç»ƒæ¨¡å‹åŠ è½½æ¨ç†æ¨¡å‹</span>
            reasoner_model_name, torch_dtype=torch.bfloat16, attn_implementation=<span class="hljs-string">"flash_attention_2"</span>)
        self.tokenizer = AutoTokenizer.from_pretrained(reasoner_model_name)  <span class="hljs-comment"># åŠ è½½å…¥åˆ†è¯å™¨</span>
        self.config = self.model.config  <span class="hljs-comment"># è·å–æ¨¡å‹é…ç½®</span>
        
        <span class="hljs-comment"># æ„å»ºè®°å¿†ç¼–ç»‡å™¨</span>
        self.weaver = MemGenWeaver(  <span class="hljs-comment"># åˆå§‹åŒ–è®°å¿†ç¼–ç»‡å™¨</span>
            weaver_model_name, prompt_latents_len, inference_latents_len, weaver_peft_config
        )
        
        <span class="hljs-comment"># æ„å»ºè§¦å‘å™¨</span>
        self.trigger = NanoTrigger()  <span class="hljs-comment"># é»˜è®¤è§¦å‘å™¨ï¼Œå§‹ç»ˆè¿”å› true</span>
        <span class="hljs-keyword">if</span> trigger_model_name <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.trigger = MemGenTrigger(  <span class="hljs-comment"># å¦‚æœæŒ‡å®šäº†è§¦å‘æ¨¡å‹ï¼Œåˆ™åŠ è½½ç›¸åº”çš„è§¦å‘å™¨</span>
                trigger_model_name, trigger_peft_config
            )
            logging.info(<span class="hljs-string">f"Use Trigger: <span class="hljs-subst">{trigger_model_name}</span>"</span>)  <span class="hljs-comment"># è®°å½•æ—¥å¿—</span>
        
        <span class="hljs-comment"># æŠ•å½±å±‚ï¼Œç”¨äºåœ¨æ¨ç†æ¨¡å‹å’Œè®°å¿†ç¼–ç»‡å™¨ä¹‹é—´æ˜ å°„åµŒå…¥</span>
        <span class="hljs-comment"># å°†æ¨ç†æ¨¡å‹è¾“å…¥åµŒå…¥æ˜ å°„åˆ°è®°å¿†ç¼–ç»‡å™¨è¾“å…¥åµŒå…¥</span>
        self.reasoner_to_weaver = nn.Linear(  <span class="hljs-comment"># çº¿æ€§å±‚ï¼Œä»æ¨ç†æ¨¡å‹éšè—å±‚åˆ°è®°å¿†ç¼–ç»‡å™¨éšè—å±‚</span>
            self.model.config.hidden_size, self.weaver.config.hidden_size, dtype=torch.bfloat16
        )
        <span class="hljs-comment"># å°†è®°å¿†ç¼–ç»‡å™¨éšè—çŠ¶æ€æ˜ å°„å›æ¨ç†æ¨¡å‹è¾“å…¥åµŒå…¥</span>
        self.weaver_to_reasoner = nn.Linear(  <span class="hljs-comment"># çº¿æ€§å±‚ï¼Œä»è®°å¿†ç¼–ç»‡å™¨éšè—å±‚åˆ°æ¨ç†æ¨¡å‹éšè—å±‚</span>
            self.weaver.config.hidden_size, self.model.config.hidden_size, dtype=torch.bfloat16
        )
        
        self.delimiters: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = [<span class="hljs-string">","</span>, <span class="hljs-string">"."</span>, <span class="hljs-string">"\n"</span>]  <span class="hljs-comment"># ç”¨äºæ£€æµ‹å¢å¼ºç‚¹çš„åˆ†éš”ç¬¦</span>
        self.max_prompt_aug_num = max_prompt_aug_num  <span class="hljs-comment"># æç¤ºåæç¤ºä¸­æ’å…¥æ½œåœ¨æ•°é‡</span>
        self.max_inference_aug_num = max_inference_aug_num  <span class="hljs-comment"># æŒ‡å®šåˆ†éš”ç¬¦åæ’å…¥æ½œåœ¨æ•°é‡</span>

        <span class="hljs-comment"># åå¤„ç†</span>
        self._postprocess_models()  <span class="hljs-comment"># åå¤„ç†æ¨¡å‹</span>

        self.warnings_issued = {}  <span class="hljs-comment"># å­˜å‚¨å‘å‡ºçš„è­¦å‘Š</span>
        self.model_tags = <span class="hljs-literal">None</span>  <span class="hljs-comment"># å­˜å‚¨æ¨¡å‹æ ‡ç­¾</span>
        log_trainable_params(self)  <span class="hljs-comment"># è®°å½•å¯è®­ç»ƒå‚æ•°</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_model_tags</span>(<span class="hljs-params">self, tags: <span class="hljs-type">Union</span>[<span class="hljs-built_in">list</span>[<span class="hljs-built_in">str</span>], <span class="hljs-built_in">str</span>]</span>) -&gt; <span class="hljs-literal">None</span>:  <span class="hljs-comment"># æ·»åŠ æ¨¡å‹æ ‡ç­¾</span>
        <span class="hljs-string">r"""
        å‘æ¨¡å‹æ·»åŠ è‡ªå®šä¹‰æ ‡ç­¾ï¼Œè¿™äº›æ ‡ç­¾å°†è¢«æ¨é€åˆ° Hugging Face Hubã€‚ä¸ä¼šè¦†ç›–æ¨¡å‹ä¸­ç°æœ‰çš„æ ‡ç­¾ã€‚

        å‚æ•°ï¼š
            tags (`Union[list[str], str]`)ï¼š
                è¦æ·»åŠ åˆ°æ¨¡å‹çš„æ ‡ç­¾

        ä¾‹å­ï¼š

        ```python
        from transformers import AutoModel

        model = AutoModel.from_pretrained("google-bert/bert-base-cased")

        model.add_model_tags(["custom", "custom-bert"])

        # å°†æ¨¡å‹æ¨é€åˆ°æ‚¨çš„å‘½åç©ºé—´ï¼Œåç§°ä¸º "my-custom-bert"ã€‚
        model.push_to_hub("my-custom-bert")
        """</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(tags, <span class="hljs-built_in">str</span>):
            tags = [tags]

        <span class="hljs-keyword">if</span> self.model_tags <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self.model_tags = []

        <span class="hljs-keyword">for</span> tag <span class="hljs-keyword">in</span> tags:
            <span class="hljs-keyword">if</span> tag <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.model_tags:
                self.model_tags.append(tag)
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_postprocess_models</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""
        åå¤„ç†è®°å¿†æ¨¡å‹çš„ç»„ä»¶ï¼šæ¨ç†æ¨¡å‹ã€è®°å¿†ç¼–ç»‡å™¨ã€è§¦å‘å™¨å’Œåˆ†è¯å™¨ã€‚

        æ­¥éª¤ï¼š
            1. å†»ç»“æ¨ç†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°ï¼ˆä¸æ›´æ–°æ¢¯åº¦ï¼‰ã€‚
            2. å°†æ‰€æœ‰æ¨¡å‹è½¬æ¢ä¸º bfloat16 ä»¥æé«˜å†…å­˜å’Œè®¡ç®—æ•ˆç‡ã€‚
            3. ç¡®ä¿åˆ†è¯å™¨æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„å¡«å……ç¬¦ï¼š
                - å¦‚æœç¼ºå°‘å¡«å……ç¬¦ï¼Œä½¿ç”¨ EOS ç¬¦ä½œä¸ºå¡«å……ç¬¦ã€‚
                - è®¾ç½® `padding_side` ä¸º "left" ä»¥å…¼å®¹ç”Ÿæˆä»»åŠ¡ã€‚
            4. æ ‡å‡†åŒ–åˆ†è¯å™¨çš„æ¨¡æ¿ä¸º `CONVERSATION_TEMPLATE`ã€‚
        """</span>
        <span class="hljs-comment"># é»˜è®¤å†»ç»“æ¨ç†æ¨¡å‹çš„æ‰€æœ‰å‚æ•°</span>
        fix_model_parameters(self.model)

        <span class="hljs-comment"># å°†æ‰€æœ‰å­æ¨¡å‹è½¬æ¢ä¸º bfloat16</span>
        self.model = self.model.bfloat16()
        self.weaver = self.weaver.bfloat16()
        self.trigger = self.trigger.bfloat16()

        <span class="hljs-comment"># ç¡®ä¿åˆ†è¯å™¨æœ‰ä¸€ä¸ªå¡«å……ç¬¦</span>
        <span class="hljs-keyword">if</span> self.tokenizer.pad_token <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:
            self.tokenizer.pad_token = self.tokenizer.eos_token
            self.tokenizer.pad_token_id = self.tokenizer.eos_token_id
            self.tokenizer.padding_side = <span class="hljs-string">"left"</span>
            logging.info(
                <span class="hljs-string">f"Tokenizer has no pad token. Using EOS token (<span class="hljs-subst">{self.tokenizer.eos_token}</span>) as pad token."</span>
            )

        <span class="hljs-comment"># æ ‡å‡†åŒ–åˆ†è¯å™¨çš„æ¨¡æ¿</span>
        self.tokenizer.chat_template = CONVERSATION_TEMPLATE
</code></pre>
<h5 data-id="heading-8">2.1.4 æ’å…¥é˜¶æ®µ</h5>
<p>LatentMemoryModel çš„ä¸¤ä¸ªå…³é”®å‡½æ•° forward å’Œ  generate åŒºåˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>forward å‡½æ•°
<ul>
<li>è®­ç»ƒæ—¶å€™è®¡ç®—æŸå¤±ï¼Œç”±è®­ç»ƒå¾ªç¯è‡ªåŠ¨è°ƒç”¨ã€‚</li>
</ul>
</li>
<li>generate å‡½æ•°
<ul>
<li>æ¨ç†æ—¶å€™ç”Ÿæˆæ–‡æœ¬ï¼Œç”±ä»£ç æ˜¾å¼è°ƒç”¨ã€‚</li>
</ul>
</li>
</ul>
<h6 data-id="heading-9">forward</h6>
<p>forward å‡½æ•°çš„ä¸»ä½“å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python">    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_forward</span>(<span class="hljs-params">
        self, 
        input_ids: torch.Tensor,
        attention_mask: torch.Tensor,
        labels: torch.Tensor,   
        **kwargs
    </span>) -&gt; torch.Tensor:
        <span class="hljs-comment"># é¢„å¤„ç†è¾“å…¥</span>
        <span class="hljs-keyword">assert</span> input_ids.shape == attention_mask.shape == labels.shape
        
        tokenizer = self.tokenizer
        reasoner = self.model
        weaver = self.weaver
        delimiters = self.delimiters
        max_augment_num = self.max_inference_aug_num  <span class="hljs-comment"># é™åˆ¶æ¨ç†å¢å¼ºç‚¹çš„æ•°é‡ä»¥é¿å…è¿‡åº¦å¢å¼º</span>
        device = self.device
        embeds_dtype = reasoner.get_input_embeddings().weight.dtype
        B, _ = input_ids.shape
        hidden_size = reasoner.config.hidden_size

        <span class="hljs-comment"># é€‰æ‹©å¢å¼ºç´¢å¼•</span>
        augmentation_indices = self._select_augment_points_after_delimiter(
            input_ids, labels, delimiters, tokenizer, max_augment_num
        )
        
        <span class="hljs-comment"># è¾“å…¥åµŒå…¥</span>
        inputs_embeds = reasoner.get_input_embeddings()(input_ids)
                 
        <span class="hljs-comment"># åˆå§‹åŒ–å¼€å§‹ç´¢å¼•å’Œç©ºå¼ é‡ä»¥ç´¯ç§¯å¤„ç†çš„æ®µ</span>
        current_start_idx = <span class="hljs-number">0</span>
        current_inputs_embeds = torch.empty(B, <span class="hljs-number">0</span>, hidden_size).to(device, dtype=embeds_dtype)
        current_attention_mask = torch.empty(B, <span class="hljs-number">0</span>).to(device, dtype=attention_mask.dtype)
        current_latents_mask = torch.empty(B, <span class="hljs-number">0</span>).to(device, dtype=torch.<span class="hljs-built_in">bool</span>)

        <span class="hljs-comment"># éå†æ‰€é€‰å¢å¼ºç‚¹</span>
        <span class="hljs-keyword">for</span> aug_idx <span class="hljs-keyword">in</span> augmentation_indices:
            <span class="hljs-comment"># åˆ‡ç‰‡åŸå§‹åµŒå…¥å’Œæ³¨æ„åŠ›æ©ç </span>
            segment_inputs_embeds = inputs_embeds[:, current_start:aug_idx]
            segment_attention_mask = attention_mask[:, current_start:aug_idx]
            segment_latents_mask = torch.zeros(B, segment_inputs_embeds.size(<span class="hljs-number">1</span>).to(device, dtype=torch.<span class="hljs-built_in">bool</span>)

            <span class="hljs-comment"># è¿æ¥å½“å‰æ®µåˆ°ç´¯ç§¯åµŒå…¥å’Œæ©ç </span>
            current_inputs_embeds = torch.cat([current_inputs_embeds, segment_inputs_embeds], dim=<span class="hljs-number">1</span>)
            current_mask = torch.cat([current_mask, segment_attention_mask], dim=<span class="hljs-number">1</span>)
            current_position_ids = generate_position_ids(current_mask)
            current_latents = torch.cat([current_latents, segment_latents], dim=<span class="hljs-number">1</span>)

            <span class="hljs-comment"># å°†æ¨ç†æ¨¡å‹åµŒå…¥æ˜ å°„åˆ°è®°å¿†ç¼–ç»‡å™¨åµŒå…¥</span>
            weaver_inputs_embeds = self.reasoner_to_weaver(current_inputs_embeds)

            <span class="hljs-comment"># ç¡®å®šæ­¤ç‚¹æ˜¯å¦ä¸ºæç¤ºï¼ˆå¢å¼ºï¼‰çš„ç»“æŸ</span>
            is_prompt_end_aug = (labels[:, aug_idx] != -<span class="hljs-number">100</span>).<span class="hljs-built_in">all</span>() <span class="hljs-keyword">and</span> (labels[:, aug_idx-<span class="hljs-number">1</span>] == -<span class="hljs-number">100</span>).<span class="hljs-built_in">all</span>().item()
            <span class="hljs-comment"># æ ¹æ®ç±»å‹ï¼Œä½¿ç”¨è®°å¿†ç¼–ç»‡å™¨å¢å¼ºæç¤ºæˆ–æ¨ç†</span>
            <span class="hljs-keyword">if</span> is_prompt_end_aug:
                weaver_hidden_states, attn_mask, pos_ids = weaver.augment_prompt(
                    weaver_inputs, current_attention_mask, current_position_ids
                )
            <span class="hljs-keyword">else</span>:
                weaver_hidden_states, attn_mask, pos_ids = weaver.augment_inference(
                    weaver_inputs, current_attention_mask, current_position_ids
                ) 

            <span class="hljs-comment"># å°†è®°å¿†ç¼–ç»‡å™¨éšè—çŠ¶æ€æ˜ å°„å›æ¨ç†æ¨¡å‹åµŒå…¥</span>
            latent_inputs_embeds = self.weaver_to_reasoner(weaver_hidden_states)

            <span class="hljs-comment"># æ›´æ–°ç´¯ç§¯åµŒå…¥å’Œæ©ç ä¸æ–°å¢å¼ºæ®µ</span>
            current_inputs_embeds = torch.cat
</code></pre>
<h6 data-id="heading-10">generate</h6>
<h6 data-id="heading-11">æ ¸å¿ƒä½œç”¨</h6>
<p>è¯¥ <code>generate</code> æ–¹æ³•æ˜¯ MemGen æ¨¡å‹çš„æ¨ç†æ ¸å¿ƒï¼Œå®ç°äº†<strong>åŠ¨æ€è®°å¿†å¢å¼ºä¸åºåˆ—ç”Ÿæˆçš„æ— ç¼èåˆ</strong>ã€‚é€šè¿‡è¿­ä»£ç”Ÿæˆæ–° tokenï¼Œæ¯æ­¥è‡ªé€‚åº”åˆ¤æ–­æ˜¯å¦æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œè®©æ¨ç†å™¨åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­å®æ—¶åˆ©ç”¨åŠ¨æ€è®°å¿†è°ƒæ•´è§£ç è·¯å¾„ï¼Œæœ€ç»ˆè¾“å‡ºå¢å¼ºåçš„åºåˆ—ï¼ˆå¯é€‰è¿”å›è®°å¿†å¢å¼ºä½ç½®æ©ç ï¼‰ã€‚</p>
<h6 data-id="heading-12">æ ¸å¿ƒç‰¹è‰²</h6>
<ul>
<li><strong>åŒé˜¶æ®µè®°å¿†å¢å¼º</strong>ï¼šå…ˆæ‰§è¡Œæç¤ºè¯é˜¶æ®µè®°å¿†å¢å¼ºï¼ˆåˆå§‹åŒ–å…¨å±€è®°å¿†ï¼‰ï¼Œå†åœ¨è¿­ä»£ç”Ÿæˆä¸­åŠ¨æ€è§¦å‘æ¨ç†é˜¶æ®µå¢å¼ºï¼ˆè¡¥å……å®æ—¶è®°å¿†ï¼‰ï¼Œé€‚é…ä¸åŒç”Ÿæˆé˜¶æ®µçš„è®°å¿†éœ€æ±‚ã€‚</li>
<li><strong>è‡ªé€‚åº”è§¦å‘æœºåˆ¶</strong>ï¼šé€šè¿‡ <code>_should_augment</code> ç»“åˆè§¦å‘å™¨å†³ç­–ï¼Œä»…å¯¹éœ€è¦è®°å¿†æ”¯æŒçš„åºåˆ—æ‰§è¡Œå¢å¼ºï¼Œé¿å…æ— æ„ä¹‰çš„è®¡ç®—å¼€é”€ã€‚</li>
<li><strong>ç»´åº¦å¯¹é½ä¼˜åŒ–</strong>ï¼šéå¢å¼ºåºåˆ—é‡‡ç”¨å·¦å¡«å……ï¼ˆ<code>_left_pad</code>ï¼‰æ–¹å¼å¯¹é½å¢å¼ºåºåˆ—ç»´åº¦ï¼Œç¡®ä¿æ‰¹æ¬¡å†…æ‰€æœ‰åºåˆ—æ ¼å¼ç»Ÿä¸€ï¼Œä¸å½±å“æ‰¹é‡ç”Ÿæˆæ•ˆç‡ã€‚</li>
<li>é«˜æ•ˆæ¨ç†è®¾è®¡ï¼š
<ul>
<li>ç¦ç”¨æ¢¯åº¦è®¡ç®—ï¼ˆ<code>@torch.no_grad()</code>ï¼‰ï¼ŒèŠ‚çœå†…å­˜å¹¶åŠ é€Ÿæ¨ç†ï¼›</li>
<li>å¯ç”¨æ¨ç†å™¨ç¼“å­˜ï¼ˆ<code>use_cache=True</code>ï¼‰ï¼Œå‡å°‘é‡å¤è®¡ç®—ï¼›</li>
<li>ä»…åœ¨å¿…è¦æ—¶è¾“å‡ºéšè—çŠ¶æ€ï¼Œé™ä½è®¡ç®—æˆæœ¬ã€‚</li>
</ul>
</li>
<li><strong>çµæ´»é…ç½®ä¸å¯è§£é‡Šæ€§</strong>ï¼šæ”¯æŒæ§åˆ¶æœ€å¤§ç”Ÿæˆ token æ•°ã€é‡‡æ ·ç­–ç•¥ç­‰å‚æ•°ï¼›å¯é€‰è¿”å› <code>augmentation_pos</code> æ©ç ï¼Œæ ‡è®°è®°å¿†æ’å…¥ä½ç½®ï¼Œæå‡æ¨¡å‹å¯è§£é‡Šæ€§ã€‚</li>
<li><strong>é²æ£’æ€§ä¿éšœ</strong>ï¼šæå‰ç»ˆæ­¢æœºåˆ¶ï¼ˆæ‰€æœ‰åºåˆ—ç”Ÿæˆ EOS æˆ–è¾¾æœ€å¤§å¢å¼ºæ¬¡æ•°æ—¶ç»ˆæ­¢ï¼‰ï¼Œé¿å…æ— æ•ˆè¿­ä»£ï¼›é‡æ„ç”Ÿæˆé…ç½®å›ºå®šå…³é”®å‚æ•°ï¼Œç¡®ä¿ç”Ÿæˆç¨³å®šæ€§ã€‚</li>
</ul>
<h6 data-id="heading-13">æ¨ç†ç”Ÿæˆæµç¨‹å›¾</h6>
<p>æ½œåœ¨è®°å¿†æ’å…¥çš„å®Œæ•´æµç¨‹ï¼š</p>
<ul>
<li>åˆå§‹åŒ–é˜¶æ®µï¼šå¯¹è¾“å…¥æç¤ºè¿›è¡Œå¢å¼ºï¼Œæ’å…¥åˆå§‹æ½œåœ¨è®°å¿†ã€‚</li>
<li>ç”Ÿæˆå¾ªç¯ï¼šé€ä¸ªç”Ÿæˆtokenã€‚</li>
<li>æ¡ä»¶æ£€æŸ¥ï¼šåœ¨æ¯ä¸ªæ­¥éª¤æ£€æŸ¥æ˜¯å¦æ»¡è¶³æ’å…¥æ¡ä»¶ã€‚</li>
<li>å†³ç­–åˆ¤æ–­ï¼šä½¿ç”¨triggeræ¨¡å‹å†³å®šæ˜¯å¦æ’å…¥æ½œåœ¨è®°å¿†ã€‚</li>
<li>æ½œåœ¨è®°å¿†ç”Ÿæˆï¼šé€šè¿‡weaveræ¨¡å‹ç”Ÿæˆæ½œåœ¨è®°å¿†è¡¨ç¤ºã€‚</li>
<li>åµŒå…¥è¿æ¥ï¼šå°†æ½œåœ¨è®°å¿†åµŒå…¥è¿æ¥åˆ°å½“å‰è¾“å…¥åºåˆ—ã€‚</li>
<li>ç»§ç»­ç”Ÿæˆï¼šä½¿ç”¨å¢å¼ºåçš„åºåˆ—ç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªtokenã€‚</li>
</ul>
<p>å…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/51a1177007e14bdd916d4e2ea501c2c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=aylwPhRKpttlymB%2BFRIe5TqKJmg%3D" alt="MemGen-2.png" loading="lazy"/></p>
<p>ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@torch.no_grad()  </span><span class="hljs-comment"># ç¦ç”¨æ¢¯åº¦è®¡ç®—ï¼Œé€‚ç”¨äºæ¨ç†é˜¶æ®µï¼Œæå‡æ•ˆç‡å¹¶èŠ‚çœå†…å­˜</span>
<span class="hljs-keyword">def</span> <span class="hljs-title function_">generate</span>(<span class="hljs-params">
    self, 
    input_ids: torch.Tensor,  <span class="hljs-comment"># è¾“å…¥token IDåºåˆ—ï¼Œå½¢çŠ¶[batch_size, prompt_len]</span>
    attention_mask: torch.Tensor,  <span class="hljs-comment"># æ³¨æ„åŠ›æ©ç ï¼Œå½¢çŠ¶ä¸input_idsä¸€è‡´</span>
    generation_config: GenerationConfig = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># ç”Ÿæˆé…ç½®ï¼ˆå¦‚æœ€å¤§æ–°tokenæ•°ã€é‡‡æ ·ç­–ç•¥ç­‰ï¼‰</span>
    return_augmentation_mask: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span>,  <span class="hljs-comment"># æ˜¯å¦è¿”å›è®°å¿†å¢å¼ºä½ç½®æ©ç </span>
    **kwargs
</span>) -&gt; <span class="hljs-type">Union</span>[torch.Tensor, <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor]]: 
    <span class="hljs-string">"""
    æ‰§è¡ŒMemGenæ¨¡å‹çš„æ¨ç†ç”Ÿæˆæµç¨‹ï¼šåŠ¨æ€èåˆæ½œåœ¨è®°å¿†ä¸æ¨ç†å™¨ï¼Œç”Ÿæˆå¢å¼ºåçš„è¾“å‡ºåºåˆ—ã€‚
    
    æ ¸å¿ƒé€»è¾‘ï¼š
    1. åˆå§‹åŒ–æç¤ºè¯é˜¶æ®µçš„è®°å¿†å¢å¼º
    2. è¿­ä»£ç”Ÿæˆæ–°tokenï¼Œæ¯æ­¥åˆ¤æ–­æ˜¯å¦è§¦å‘æ¨ç†é˜¶æ®µè®°å¿†å¢å¼º
    3. å¯¹éœ€å¢å¼ºçš„åºåˆ—æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œéå¢å¼ºåºåˆ—å·¦å¡«å……å¯¹é½ç»´åº¦
    4. ç”Ÿæˆå®Œæˆåè¿”å›ç»“æœï¼ˆå¯é€‰è¿”å›å¢å¼ºä½ç½®æ©ç ï¼‰
    """</span>
    tokenizer = self.tokenizer
    reasoner = self.model
    weaver = self.weaver
    trigger = self.trigger
    delimiters = self.delimiters
    max_augment_num = self.max_inference_aug_num  <span class="hljs-comment"># å•åºåˆ—æœ€å¤§æ¨ç†é˜¶æ®µå¢å¼ºæ¬¡æ•°</span>
    invalid_token_id = -<span class="hljs-number">100</span>  <span class="hljs-comment"># æ— æ•ˆä½ç½®æ ‡è®°ï¼ˆç”¨äºå¢å¼ºä½ç½®æ©ç ï¼‰</span>

    <span class="hljs-comment"># é¢„å¤„ç†è¾“å…¥ï¼šè½¬ç§»åˆ°æ¨¡å‹æ‰€åœ¨è®¾å¤‡</span>
    input_ids = input_ids.to(self.device)
    attention_mask = attention_mask.to(self.device)
    <span class="hljs-comment"># æå–ç”Ÿæˆé…ç½®å…³é”®å‚æ•°</span>
    max_new_tokens = generation_config.max_new_tokens  <span class="hljs-comment"># æœ€å¤§ç”Ÿæˆæ–°tokenæ•°</span>
    do_sample = generation_config.do_sample  <span class="hljs-comment"># æ˜¯å¦å¯ç”¨é‡‡æ ·ç”Ÿæˆ</span>
    temperature = generation_config.temperature  <span class="hljs-comment"># é‡‡æ ·æ¸©åº¦ï¼ˆæ§åˆ¶éšæœºæ€§ï¼‰</span>
    pad_token_id = tokenizer.pad_token_id  <span class="hljs-comment"># pad token ID</span>
    eos_token_id = tokenizer.eos_token_id  <span class="hljs-comment"># ç»“æŸtoken ID</span>
    prompt_len = input_ids.size(<span class="hljs-number">1</span>)  <span class="hljs-comment"># æç¤ºè¯é•¿åº¦</span>
    <span class="hljs-comment"># é‡æ„ç”Ÿæˆé…ç½®ï¼ˆå›ºå®šå¿…è¦å‚æ•°ï¼Œç¡®ä¿ç”Ÿæˆç¨³å®šæ€§ï¼‰</span>
    generation_config = GenerationConfig(
        do_sample=do_sample,
        temperature=temperature,
        pad_token_id=pad_token_id,
        eos_token_id=eos_token_id,
        use_cache=<span class="hljs-literal">True</span>  <span class="hljs-comment"># å¯ç”¨ç¼“å­˜åŠ é€Ÿç”Ÿæˆ</span>
    )

    <span class="hljs-comment"># å°†è¾“å…¥token IDè½¬æ¢ä¸ºåµŒå…¥å‘é‡</span>
    inputs_embeds = reasoner.get_input_embeddings()(input_ids)
    B, _, hidden_size = inputs_embeds.shape  <span class="hljs-comment"># B=batch_sizeï¼Œhidden_size=æ¨ç†å™¨éšè—å±‚ç»´åº¦</span>
    device = inputs_embeds.device  <span class="hljs-comment"># æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆCPU/GPUï¼‰</span>

    <span class="hljs-comment"># åˆå§‹åŒ–ç”Ÿæˆè¿‡ç¨‹ä¸­çš„å…³é”®å¼ é‡</span>
    current_inputs_embeds = inputs_embeds  <span class="hljs-comment"># å½“å‰è¾“å…¥åµŒå…¥ï¼ˆå«åŸå§‹æç¤ºè¯+æ½œåœ¨è®°å¿†ï¼‰</span>
    current_attention_mask = attention_mask  <span class="hljs-comment"># å½“å‰æ³¨æ„åŠ›æ©ç </span>
    current_position_ids = generate_position_ids(current_attention_mask)  <span class="hljs-comment"># å½“å‰ä½ç½®ID</span>
    current_input_ids = input_ids  <span class="hljs-comment"># å½“å‰å·²ç”Ÿæˆçš„token IDåºåˆ—</span>
    
    <span class="hljs-comment"># æç¤ºè¯é˜¶æ®µè®°å¿†å¢å¼ºï¼šç”Ÿæˆå¹¶æ’å…¥æç¤ºè¯ä¸“ç”¨æ½œåœ¨è®°å¿†</span>
    weaver_inputs_embeds = self.reasoner_to_weaver(current_inputs_embeds)  <span class="hljs-comment"># æ˜ å°„åˆ°ç¼–ç»‡å™¨åµŒå…¥ç©ºé—´</span>
    weaver_hidden_states, attn_mask, pos_ids = weaver.augment_prompt(
        weaver_inputs_embeds, current_attention_mask, current_position_ids
    )
    latent_inputs_embeds = self.weaver_to_reasoner(weaver_hidden_states)  <span class="hljs-comment"># æ˜ å°„å›æ¨ç†å™¨åµŒå…¥ç©ºé—´</span>

    <span class="hljs-comment"># æ‹¼æ¥æç¤ºè¯ä¸å¢å¼ºè®°å¿†</span>
    current_inputs_embeds = torch.cat([current_inputs_embeds, latent_inputs_embeds], dim=<span class="hljs-number">1</span>)
    current_attention_mask = torch.cat([current_attention_mask, attn_mask], dim=<span class="hljs-number">1</span>)
    current_position_ids = torch.cat([current_position_ids, pos_ids], dim=<span class="hljs-number">1</span>)

    <span class="hljs-comment"># ç”Ÿæˆå¾ªç¯åˆå§‹åŒ–</span>
    sentence_augment_count = torch.zeros(B, dtype=torch.<span class="hljs-built_in">int</span>, device=device)  <span class="hljs-comment"># å„åºåˆ—å·²å¢å¼ºæ¬¡æ•°</span>
    augmentation_pos = torch.full((B, max_new_tokens), fill_value=invalid_token_id, device=device)  <span class="hljs-comment"># å¢å¼ºä½ç½®æ©ç </span>
    inserted_embeds: <span class="hljs-type">List</span>[<span class="hljs-type">List</span>[torch.Tensor]] = [[] <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(B)]  <span class="hljs-comment"># è®°å½•æ’å…¥çš„æ½œåœ¨è®°å¿†ï¼ˆç”¨äºåå¤„ç†ï¼‰</span>
    
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(max_new_tokens):
        <span class="hljs-comment"># è‹¥æ‰€æœ‰åºåˆ—å‡å·²ç”ŸæˆEOS tokenï¼Œæå‰ç»ˆæ­¢</span>
        <span class="hljs-keyword">if</span> (current_input_ids[:, -<span class="hljs-number">1</span>] == eos_token_id).<span class="hljs-built_in">all</span>():
            <span class="hljs-keyword">break</span>   

        <span class="hljs-comment"># è‹¥æ‰€æœ‰åºåˆ—å‡å·²è¾¾åˆ°æœ€å¤§å¢å¼ºæ¬¡æ•°ï¼Œä¸€æ¬¡æ€§ç”Ÿæˆå‰©ä½™token</span>
        <span class="hljs-keyword">if</span> (sentence_augment_count &gt;= max_augment_num).<span class="hljs-built_in">all</span>():
            <span class="hljs-comment"># è°ƒæ•´å‰©ä½™ç”Ÿæˆé•¿åº¦</span>
            generation_config.max_new_tokens = max_new_tokens - i
            <span class="hljs-comment"># æ¨ç†å™¨ç”Ÿæˆå‰©ä½™token</span>
            generated = reasoner.generate(
                inputs_embeds=current_inputs_embeds,
                attention_mask=current_attention_mask,
                generation_config=generation_config,
            )
            current_input_ids = torch.cat([current_input_ids, generated], dim=<span class="hljs-number">1</span>)
            <span class="hljs-keyword">break</span>

        <span class="hljs-comment"># æ¨ç†å™¨å‰å‘ä¼ æ’­ï¼Œè·å–å½“å‰æ­¥è¾“å‡º</span>
        outputs = reasoner(
            inputs_embeds=current_inputs_embeds,
            attention_mask=current_attention_mask,
            position_ids=current_position_ids,
            output_hidden_states=<span class="hljs-literal">False</span>,  <span class="hljs-comment"># æ¨ç†é˜¶æ®µæ— éœ€è¾“å‡ºéšè—çŠ¶æ€ï¼Œæå‡æ•ˆç‡</span>
        )
        <span class="hljs-comment"># ç”Ÿæˆå¹¶è¿½åŠ ä¸€ä¸ªæ–°tokenï¼Œæ›´æ–°å…³é”®å¼ é‡</span>
        current_inputs_embeds, current_attention_mask, current_position_ids, current_input_ids = self._append_one_step(
            outputs, current_inputs_embeds, current_attention_mask, current_position_ids, current_input_ids, do_sample, temperature
        )
 
        <span class="hljs-comment"># è‹¥ä¸ºæœ€åä¸€æ­¥ç”Ÿæˆï¼Œç»ˆæ­¢å¾ªç¯</span>
        <span class="hljs-keyword">if</span> i == max_new_tokens - <span class="hljs-number">1</span>:  
            <span class="hljs-keyword">break</span> 

        <span class="hljs-comment"># åˆ¤æ–­å½“å‰æ‰¹æ¬¡ä¸­å“ªäº›åºåˆ—éœ€è¦è¿›è¡Œæ¨ç†é˜¶æ®µè®°å¿†å¢å¼º</span>
        augment_decision = self._should_augment(
            current_input_ids, current_attention_mask, sentence_augment_count=sentence_augment_count, 
            do_sample=do_sample, temperature=temperature  
        )
        augmentation_pos[:, i + <span class="hljs-number">1</span>] = augment_decision  <span class="hljs-comment"># è®°å½•å¢å¼ºä½ç½®ï¼ˆ1=å¢å¼ºï¼Œ0=ä¸å¢å¼ºï¼Œ-100=æ— æ•ˆï¼‰</span>
        augment_indices = torch.where(augment_decision == <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># éœ€å¢å¼ºçš„åºåˆ—ç´¢å¼•</span>

        <span class="hljs-comment"># å¯¹éœ€å¢å¼ºçš„åºåˆ—æ‰§è¡Œè®°å¿†å¢å¼ºï¼Œéå¢å¼ºåºåˆ—å·¦å¡«å……å¯¹é½ç»´åº¦</span>
        <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(augment_indices) &gt; <span class="hljs-number">0</span>:
            <span class="hljs-comment"># é€’å¢éœ€å¢å¼ºåºåˆ—çš„å¢å¼ºæ¬¡æ•°è®¡æ•°</span>
            sentence_augment_count[augment_indices] += <span class="hljs-number">1</span>

            <span class="hljs-comment"># æå–éœ€å¢å¼ºåºåˆ—çš„åµŒå…¥ã€æ©ç å’Œä½ç½®ID</span>
            candidate_inputs_embeds = current_inputs_embeds[augment_indices]
            candidate_attention_mask = current_attention_mask[augment_indices]
            candidate_position_ids = current_position_ids[augment_indices]
            
            <span class="hljs-comment"># ç¼–ç»‡å™¨ç”Ÿæˆæ¨ç†é˜¶æ®µæ½œåœ¨è®°å¿†</span>
            weaver_inputs_embeds = self.reasoner_to_weaver(candidate_inputs_embeds)
            weaver_hidden_states, attn_mask, _ = weaver.augment_inference(
                weaver_inputs_embeds, candidate_attention_mask, candidate_position_ids
            )
            latent_inputs_embeds = self.weaver_to_reasoner(weaver_hidden_states)  <span class="hljs-comment"># æ˜ å°„å›æ¨ç†å™¨ç©ºé—´</span>
            
            <span class="hljs-comment"># æ‹¼æ¥åŸå§‹åµŒå…¥ä¸æ½œåœ¨è®°å¿†</span>
            candidate_inputs_embeds = torch.cat([candidate_inputs_embeds, latent_inputs_embeds], dim=<span class="hljs-number">1</span>)
            candidate_attention_mask = torch.cat([candidate_attention_mask, attn_mask], dim=<span class="hljs-number">1</span>)
            
            <span class="hljs-comment"># æ„å»ºåˆå¹¶å¼ é‡ï¼ˆé€‚é…æ‰€æœ‰åºåˆ—ï¼ŒåŒ…æ‹¬å¢å¼ºå’Œéå¢å¼ºï¼‰</span>
            new_len = candidate_inputs_embeds.size(<span class="hljs-number">1</span>)  <span class="hljs-comment"># å¢å¼ºååºåˆ—é•¿åº¦</span>
            merged_inputs_embeds = torch.zeros((B, new_len, hidden_size), device=device, dtype=current_inputs_embeds.dtype)
            merged_attention_mask = torch.zeros((B, new_len), device=device, dtype=current_attention_mask.dtype)
            
            <span class="hljs-comment"># å¡«å……å¢å¼ºåºåˆ—</span>
            merged_inputs_embeds[augment_indices] = candidate_inputs_embeds
            merged_attention_mask[augment_indices] = candidate_attention_mask
            
            <span class="hljs-comment"># å¡«å……éå¢å¼ºåºåˆ—ï¼ˆå·¦å¡«å……å¯¹é½é•¿åº¦ï¼‰</span>
            non_augment_indices = torch.where(augment_decision != <span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]
            <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(non_augment_indices) &gt; <span class="hljs-number">0</span>:
                non_aug_inputs_embeds = current_inputs_embeds[non_augment_indices]
                non_aug_attention_mask = current_attention_mask[non_augment_indices]
                non_aug_inputs_embeds, non_aug_attention_mask, _ = self._left_pad(
                    non_aug_inputs_embeds, non_aug_attention_mask, <span class="hljs-literal">None</span>, weaver.inference_latents_num
                )
                merged_inputs_embeds[non_augment_indices] = non_aug_inputs_embeds
                merged_attention_mask[non_augment_indices] = non_aug_attention_mask
            
            <span class="hljs-comment"># æ›´æ–°å½“å‰å…³é”®å¼ é‡</span>
            current_inputs_embeds = merged_inputs_embeds
            current_attention_mask = merged_attention_mask
            current_position_ids = generate_position_ids(current_attention_mask)  <span class="hljs-comment"># é‡æ–°ç”Ÿæˆä½ç½®ID</span>
            
            <span class="hljs-comment"># è®°å½•æ’å…¥çš„æ½œåœ¨è®°å¿†ï¼ˆç”¨äºåå¤„ç†æˆ–å¯è§£é‡Šæ€§åˆ†æï¼‰</span>
            <span class="hljs-keyword">for</span> idx, embed <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(augment_indices, latent_inputs_embeds):
                inserted_embeds[idx].append(embed.clone().detach().cpu())
        
        <span class="hljs-comment"># åå¤„ç†ï¼šè°ƒæ•´å¢å¼ºä½ç½®æ©ç é•¿åº¦ä¸ç”Ÿæˆç»“æœä¸€è‡´</span>
        new_generated_len = current_input_ids.size(<span class="hljs-number">1</span>) - prompt_len
        augmentation_pos = augmentation_pos[:, :new_generated_len]
         
        <span class="hljs-comment"># æ ¹æ®é…ç½®è¿”å›ç»“æœï¼šä»…ç”Ÿæˆåºåˆ— æˆ– åºåˆ—+å¢å¼ºä½ç½®æ©ç </span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> return_augmentation_mask:
            <span class="hljs-keyword">return</span> current_input_ids
        <span class="hljs-keyword">else</span>:
            <span class="hljs-keyword">return</span> current_input_ids, augmentation_pos
</code></pre>
<h4 data-id="heading-14">2.2 Trigger</h4>
<h5 data-id="heading-15">2.2.1. æ ¸å¿ƒä½œç”¨</h5>
<p>è¯¥æ¨¡å—å®šä¹‰äº† MemGen æ¡†æ¶ä¸­è®°å¿†è§¦å‘å™¨çš„æ ¸å¿ƒæ¥å£ä¸ä¸¤ç§å…·ä½“å®ç°ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯<strong>åŠ¨æ€å†³ç­–è®°å¿†å¢å¼ºçš„æ—¶æœº</strong>â€”â€” å³åœ¨æ¨ç†è¿‡ç¨‹ä¸­åˆ¤æ–­ä½•æ—¶æ’å…¥ç¼–ç»‡å™¨ç”Ÿæˆçš„æ½œåœ¨è®°å¿†ï¼Œå®ç°è®°å¿†ä¸æ¨ç†çš„åŠ¨æ€è€¦åˆï¼Œçªç ´ä¼ ç»Ÿé™æ€è®°å¿†æ³¨å…¥çš„å±€é™ã€‚</p>
<h5 data-id="heading-16">2.2.2. æ ¸å¿ƒç‰¹è‰²</h5>
<ul>
<li><strong>æŠ½è±¡æ¥å£ç»Ÿä¸€è§„èŒƒ</strong>ï¼š<code>Trigger</code>æŠ½è±¡åŸºç±»å®šä¹‰äº†è§¦å‘å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œç¡®ä¿åç»­æ‰©å±•æ–°è§¦å‘å™¨æ—¶éµå¾ªç»Ÿä¸€æ ‡å‡†ï¼Œæå‡ä»£ç å¯æ‰©å±•æ€§ã€‚</li>
<li>åŒå®ç°é€‚é…ä¸åŒåœºæ™¯ï¼š
<ul>
<li><code>NanoTrigger</code>ï¼šæç®€å®ç°ï¼Œå§‹ç»ˆè§¦å‘è®°å¿†å¢å¼ºï¼Œæ— éœ€è®­ç»ƒï¼Œé€‚ç”¨äºå¿«é€Ÿæµ‹è¯•ã€åŸºçº¿å¯¹æ¯”æˆ–æ— éœ€åŠ¨æ€æ§åˆ¶çš„ç®€å•åœºæ™¯ã€‚</li>
<li><code>MemGenTrigger</code>ï¼šåŸºäºé¢„è®­ç»ƒ LLM çš„æ™ºèƒ½è§¦å‘å™¨ï¼Œé€šè¿‡äºŒåˆ†ç±»å¤´é€‚é…å†³ç­–ä»»åŠ¡ï¼Œæ”¯æŒ PEFT å‚æ•°é«˜æ•ˆå¾®è°ƒï¼Œèƒ½æ ¹æ®è¾“å…¥åºåˆ—åŠ¨æ€åˆ¤æ–­æ˜¯å¦è§¦å‘ï¼Œé€‚é…å¤æ‚çœŸå®åœºæ™¯ã€‚</li>
</ul>
</li>
<li>é«˜æ•ˆé€‚é…ä¸çµæ´»æ‰©å±•ï¼š
<ul>
<li>é‡‡ç”¨ bfloat16 ç²¾åº¦å’Œ Flash Attention 2 ä¼˜åŒ–è®¡ç®—æ•ˆç‡ï¼›</li>
<li>æ”¯æŒ PEFT å¾®è°ƒï¼Œåœ¨ä¸å†»ç»“åŸºç¡€æ¨¡å‹çš„å‰æä¸‹å®ç°å‚æ•°é«˜æ•ˆå­¦ä¹ ï¼›</li>
<li>æ›¿æ¢ LLM åŸå§‹è¾“å‡ºå¤´ä¸ºäºŒåˆ†ç±»å¤´ï¼Œç²¾å‡†é€‚é… "æ˜¯å¦æ’å…¥è®°å¿†" çš„å†³ç­–éœ€æ±‚ã€‚</li>
</ul>
</li>
<li><strong>æ¨¡å—è§£è€¦è®¾è®¡</strong>ï¼šè§¦å‘å™¨å†³ç­–ç‹¬ç«‹äºç¼–ç»‡å™¨æ¨¡å—ï¼Œä»…åŸºäºè¾“å…¥åºåˆ—å’Œæ•°æ®åˆ†å¸ƒåšå‡ºåˆ¤æ–­ï¼Œä¿è¯äº†æ¨¡å—é—´çš„ä½è€¦åˆå’Œé«˜å†…èšã€‚</li>
</ul>
<h5 data-id="heading-17">2.2.3 ç½‘ç»œæ¶æ„</h5>
<p>ç½‘ç»œæ¶æ„å›¾å¦‚ä¸‹ã€‚</p>
<p>è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ol>
<li>æ¨¡å‹æ”¯æŒPEFTå‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆå¦‚LoRAï¼‰ï¼Œé€‚é…äºTransformer Blockså±‚</li>
<li>æ•´ä½“ç²¾åº¦é‡‡ç”¨bfloat16ï¼Œå¹³è¡¡è®¡ç®—æ•ˆç‡ä¸æ•°å€¼ç¨³å®šæ€§</li>
<li>æ³¨æ„åŠ›è®¡ç®—é€šè¿‡Flash Attention 2ä¼˜åŒ–ï¼Œæå‡é•¿åºåˆ—å¤„ç†é€Ÿåº¦</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/34dd418dca1746b69160336bafae5e6f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=Av9etmryf2cwP7Mw6AaiNNc%2FzO4%3D" alt="MemGen-3.png" loading="lazy"/></p>
<h5 data-id="heading-18">2.2.4 ä»£ç </h5>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Trigger</span>(torch.nn.Module, ABC):
    <span class="hljs-string">"""
    è®°å¿†è§¦å‘å™¨çš„æŠ½è±¡åŸºç±»ï¼ˆTriggerï¼‰ã€‚
    å®šä¹‰äº†è§¦å‘å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œç”¨äºå†³å®šåœ¨æ¨ç†è¿‡ç¨‹ä¸­ä½•æ—¶è§¦å‘è®°å¿†å¢å¼ºï¼ˆæ’å…¥æ½œåœ¨è®°å¿†ï¼‰ã€‚
    æ‰€æœ‰å…·ä½“è§¦å‘å™¨å®ç°éƒ½éœ€ç»§æ‰¿æ­¤ç±»å¹¶å®ç°forwardæ–¹æ³•ã€‚
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()  <span class="hljs-comment"># è°ƒç”¨çˆ¶ç±»Moduleçš„åˆå§‹åŒ–æ–¹æ³•</span>
    
<span class="hljs-meta">    @abstractmethod</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, **kwargs</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-string">"""
        æŠ½è±¡å‰å‘ä¼ æ’­æ–¹æ³•ï¼šæ¥æ”¶è¾“å…¥æ•°æ®ï¼Œè¿”å›æ˜¯å¦è§¦å‘è®°å¿†å¢å¼ºçš„å†³ç­–ã€‚
        å­ç±»å¿…é¡»å®ç°æ­¤æ–¹æ³•ï¼Œå®šä¹‰å…·ä½“çš„è§¦å‘é€»è¾‘ã€‚
        
        Args:
            **kwargs: å¯å˜å…³é”®å­—å‚æ•°ï¼ŒåŒ…å«è¾“å…¥åºåˆ—ã€æ³¨æ„åŠ›æ©ç ç­‰æ¨¡å‹æ‰€éœ€æ•°æ®
            
        Returns:
            bool: è§¦å‘å†³ç­–ï¼ˆTrueè¡¨ç¤ºè§¦å‘è®°å¿†å¢å¼ºï¼ŒFalseè¡¨ç¤ºä¸è§¦å‘ï¼‰
        """</span>
        ...


<span class="hljs-keyword">class</span> <span class="hljs-title class_">NanoTrigger</span>(torch.nn.Module):
    <span class="hljs-string">"""
    æç®€è§¦å‘å™¨ï¼ˆNanoTriggerï¼‰ï¼šå§‹ç»ˆè§¦å‘è®°å¿†å¢å¼ºçš„åŸºç¡€å®ç°ã€‚
    æ— éœ€å¤æ‚é€»è¾‘ï¼Œå›ºå®šè¿”å›è§¦å‘å†³ç­–ï¼Œé€‚ç”¨äºåŸºç¡€æµ‹è¯•æˆ–æ— éœ€åŠ¨æ€æ§åˆ¶çš„åœºæ™¯ã€‚
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        <span class="hljs-built_in">super</span>().__init__()  
        <span class="hljs-comment"># æ³¨å†Œä¸€ä¸ªç¼“å†²åŒºå¼ é‡ï¼Œç”¨äºè·å–æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆæ— å®é™…è®¡ç®—æ„ä¹‰ï¼‰</span>
        self.register_buffer(<span class="hljs-string">"_device"</span>, torch.tensor(<span class="hljs-number">0.0</span>))
    
<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">device</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆCPU/GPUï¼‰"""</span>
        <span class="hljs-keyword">return</span> self._device.device
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, input_ids: torch.Tensor, attention_mask: torch.Tensor, **kwargs</span>) -&gt; <span class="hljs-built_in">bool</span>:
        <span class="hljs-comment"># è¯¥"æç®€è§¦å‘å™¨"å§‹ç»ˆé¢„æµ‹éœ€è¦æ’å…¥è®°å¿†</span>
        <span class="hljs-comment"># è¾“å‡ºlogitså¼ é‡ï¼Œå…¶ä¸­æ’å…¥å†³ç­–ï¼ˆç´¢å¼•=1ï¼‰çš„æ¦‚ç‡è¢«è®¾ä¸º1.0</span>
        <span class="hljs-comment"># é€‚ç”¨äºæ‰¹æ¬¡ä¸­çš„æ¯ä¸ªtokenä½ç½®</span>
        batch_size, seq_len = input_ids.shape

        <span class="hljs-comment"># åˆå§‹åŒ–logitså¼ é‡ï¼šå½¢çŠ¶ä¸º[batch_size, seq_len, 2]ï¼Œ2è¡¨ç¤º"ä¸æ’å…¥"ï¼ˆ0ï¼‰å’Œ"æ’å…¥"ï¼ˆ1ï¼‰ä¸¤ç±»</span>
        logits = torch.zeros(batch_size, seq_len, <span class="hljs-number">2</span>, device=input_ids.device)
        logits[..., <span class="hljs-number">1</span>] = <span class="hljs-number">1.0</span>  <span class="hljs-comment"># å°†æ‰€æœ‰ä½ç½®çš„"æ’å…¥"å†³ç­–æ¦‚ç‡è®¾ä¸º1.0</span>
        <span class="hljs-keyword">return</span> logits


<span class="hljs-keyword">class</span> <span class="hljs-title class_">MemGenTrigger</span>(torch.nn.Module):
    <span class="hljs-string">"""
    MemGenæ¡†æ¶çš„ä¸“ç”¨è§¦å‘å™¨æ¨¡å—ï¼ˆMemGenTriggerï¼‰ã€‚
    - è¾“å…¥ï¼šæ¥æ”¶æ¨ç†å™¨æ¨¡å‹å½“å‰è§£ç åºåˆ—çš„`inputs_embeds`ï¼ˆæˆ–input_idsï¼‰
    - è¾“å‡ºï¼šç”Ÿæˆå½¢çŠ¶ä¸º[batch_size, seq_len, 2]çš„logitså¼ é‡ï¼Œ
      è¡¨ç¤ºæ¯ä¸ªä½ç½®"ä¸æ’å…¥"ï¼ˆ0ï¼‰å’Œ"æ’å…¥"ï¼ˆ1ï¼‰è®°å¿†çš„æ¦‚ç‡ï¼Œç”¨äºåŠ¨æ€å†³ç­–è®°å¿†å¢å¼ºæ—¶æœºã€‚
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self, 
        pretrained_model_name_or_path: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># é¢„è®­ç»ƒæ¨¡å‹åç§°æˆ–è·¯å¾„ï¼ˆç”¨äºåˆå§‹åŒ–è§¦å‘å™¨LLMï¼‰</span>
        peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># PEFTé…ç½®ï¼ˆå¯é€‰ï¼Œç”¨äºå‚æ•°é«˜æ•ˆå¾®è°ƒï¼‰</span>
    </span>):
        <span class="hljs-built_in">super</span>().__init__()
        
        <span class="hljs-comment"># æ„å»ºåŸºç¡€LLMæ¨¡å‹ï¼ˆä½œä¸ºè§¦å‘å™¨çš„æ ¸å¿ƒæ¨ç†ç»„ä»¶ï¼‰</span>
        self.model = AutoModelForCausalLM.from_pretrained(
            pretrained_model_name_or_path, 
            torch_dtype=torch.bfloat16,  <span class="hljs-comment"># ä½¿ç”¨bfloat16ç²¾åº¦æå‡æ•ˆç‡</span>
            attn_implementation=<span class="hljs-string">"flash_attention_2"</span>  <span class="hljs-comment"># å¯ç”¨Flash Attention 2ä¼˜åŒ–æ³¨æ„åŠ›è®¡ç®—</span>
        )
        self.tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name_or_path)  <span class="hljs-comment"># å¯¹åº”çš„Tokenizer</span>
        
        <span class="hljs-comment"># å¯¹åŸºç¡€æ¨¡å‹è¿›è¡Œåå¤„ç†ï¼ˆè®¾ç½®å¯è®­ç»ƒã€æ›¿æ¢è¾“å‡ºå¤´ï¼‰</span>
        self.model = self._postprocess(self.model)
        <span class="hljs-comment"># è‹¥æä¾›PEFTé…ç½®ï¼Œåº”ç”¨å‚æ•°é«˜æ•ˆå¾®è°ƒ</span>
        <span class="hljs-keyword">if</span> peft_config <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.model = get_peft_model(self.model, peft_config)
        
        self.config = self.model.config  <span class="hljs-comment"># ä¿å­˜æ¨¡å‹é…ç½®</span>

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">device</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è·å–æ¨¡å‹æ‰€åœ¨è®¾å¤‡ï¼ˆCPU/GPUï¼‰"""</span>
        <span class="hljs-keyword">return</span> self.model.device
    
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_postprocess</span>(<span class="hljs-params">self, model: PreTrainedModel</span>):
        <span class="hljs-string">"""
        å¯¹åŸºç¡€æ¨¡å‹è¿›è¡Œåå¤„ç†ï¼Œé€‚é…è§¦å‘å™¨çš„äºŒåˆ†ç±»ä»»åŠ¡éœ€æ±‚ã€‚
        
        Args:
            model: åŸå§‹é¢„è®­ç»ƒLLMæ¨¡å‹
            
        Returns:
            å¤„ç†åçš„æ¨¡å‹ï¼ˆå¯è®­ç»ƒã€æ›¿æ¢ä¸ºäºŒåˆ†ç±»è¾“å‡ºå¤´ï¼‰
        """</span>
        <span class="hljs-comment"># è®¾ç½®æ‰€æœ‰æ¨¡å‹å‚æ•°ä¸ºå¯è®­ç»ƒ</span>
        <span class="hljs-keyword">for</span> parameter <span class="hljs-keyword">in</span> model.parameters():
            parameter.requires_grad = <span class="hljs-literal">True</span>
        
        <span class="hljs-comment"># å°†åŸå§‹è¯­è¨€æ¨¡å‹çš„è¾“å‡ºå¤´ï¼ˆlm_headï¼‰æ›¿æ¢ä¸ºäºŒåˆ†ç±»å¤´</span>
        hidden_size = model.config.hidden_size  <span class="hljs-comment"># æ¨¡å‹éšè—å±‚ç»´åº¦</span>
        classification_head = nn.Linear(hidden_size, <span class="hljs-number">2</span>)  <span class="hljs-comment"># è¾“å‡ºç»´åº¦ä¸º2ï¼ˆä¸æ’å…¥/æ’å…¥ï¼‰</span>
        model.lm_head = classification_head
        
        <span class="hljs-comment"># ç¡®ä¿æ–°çš„äºŒåˆ†ç±»å¤´å‚æ•°å¯è®­ç»ƒ</span>
        <span class="hljs-keyword">for</span> param <span class="hljs-keyword">in</span> model.lm_head.parameters():
            param.requires_grad = <span class="hljs-literal">True</span>

        <span class="hljs-keyword">return</span> model

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">
        self, 
        input_ids: <span class="hljs-type">Optional</span>[torch.LongTensor] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># ç”Ÿæˆåºåˆ—çš„token IDï¼Œå½¢çŠ¶[batch_size, seq_len]</span>
        attention_mask: <span class="hljs-type">Optional</span>[torch.Tensor] = <span class="hljs-literal">None</span>,  <span class="hljs-comment"># æ³¨æ„åŠ›æ©ç ï¼Œé¿å…å…³æ³¨å¡«å……token</span>
        **kwargs: Unpack[TransformersKwargs],  <span class="hljs-comment"># ä¼ é€’ç»™åº•å±‚æ¨¡å‹çš„é¢å¤–å‚æ•°</span>
    </span>) -&gt; torch.Tensor:
        <span class="hljs-string">"""
        åºåˆ—ç”Ÿæˆçš„è§¦å‘å†³ç­–æœºåˆ¶ã€‚
        è§¦å‘å™¨åŸºäºå·²ç”Ÿæˆçš„`input_ids`åšå‡ºå†³ç­–ï¼Œå—æ•°æ®åˆ†å¸ƒå½±å“ï¼Œä½†ç‹¬ç«‹äºç¼–ç»‡å™¨æ¨¡å—ã€‚

        Args:
            input_ids (Optional[torch.LongTensor]): ç”Ÿæˆåºåˆ—çš„token IDå¼ é‡
            attention_mask (Optional[torch.Tensor]): æ³¨æ„åŠ›æ©ç ï¼Œé»˜è®¤None
            **kwargs: ä¼ é€’ç»™åº•å±‚æ¨¡å‹çš„é¢å¤–å…³é”®å­—å‚æ•°

        Returns:
            torch.Tensor: Logitså¼ é‡ï¼Œå½¢çŠ¶ä¸º`(batch_size, seq_len, num_classes)`
                        num_classes=2ï¼Œåˆ†åˆ«å¯¹åº”"ä¸æ’å…¥"ï¼ˆç´¢å¼•0ï¼‰å’Œ"æ’å…¥"ï¼ˆç´¢å¼•1ï¼‰çš„æ¦‚ç‡
        """</span>   
        <span class="hljs-comment"># è°ƒç”¨åŸºç¡€æ¨¡å‹å‰å‘ä¼ æ’­ï¼Œè¿”å›äºŒåˆ†ç±»logits</span>
        <span class="hljs-keyword">return</span> self.model(
            input_ids=input_ids, 
            attention_mask=attention_mask, 
            **kwargs
        ).logits
</code></pre>
<h4 data-id="heading-19">2.3  MemGenWeaver</h4>
<h5 data-id="heading-20">2.3.1 æ ¸å¿ƒä½œç”¨</h5>
<p>MemGenWeaver æ˜¯ MemGen æ¡†æ¶çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£ç”ŸæˆåŠ¨æ€æ½œåœ¨è®°å¿†å¹¶å°†å…¶ä¸æ¨ç†å™¨çš„è¾“å…¥åºåˆ—èåˆï¼Œä»è€Œå®ç°è®°å¿†ä¸æ¨ç†è¿‡ç¨‹çš„æ— ç¼äº¤ç»‡ã€‚å®ƒé€šè¿‡å¯å­¦ä¹ çš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼Œåœ¨æç¤ºè¯é˜¶æ®µå’Œæ¨ç†é˜¶æ®µåˆ†åˆ«ç”Ÿæˆé’ˆå¯¹æ€§çš„è®°å¿†è¡¨ç¤ºï¼Œå¼•å¯¼æ¨ç†å™¨è°ƒæ•´è§£ç è·¯å¾„ï¼Œæå‡æ™ºèƒ½ä½“çš„åŠ¨æ€å†³ç­–èƒ½åŠ›ã€‚</p>
<h5 data-id="heading-21">2.3.2 æ ¸å¿ƒç‰¹è‰²</h5>
<ul>
<li>åŒé˜¶æ®µè®°å¿†ç”Ÿæˆï¼šåŒºåˆ†æç¤ºè¯é˜¶æ®µï¼ˆ<code>augment_prompt</code>ï¼‰å’Œæ¨ç†é˜¶æ®µï¼ˆ<code>augment_inference</code>ï¼‰ï¼Œä½¿ç”¨å„è‡ªç‹¬ç«‹çš„å¯å­¦ä¹ æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼Œé€‚é…ä¸åŒé˜¶æ®µçš„è®°å¿†éœ€æ±‚ï¼Œå¢å¼ºè®°å¿†ç”Ÿæˆçš„é’ˆå¯¹æ€§ã€‚</li>
<li>çµæ´»çš„æ½œåœ¨è®°å¿†èåˆï¼šé€šè¿‡<code>_augment</code>æ–¹æ³•ç»Ÿä¸€å®ç°æ½œåœ¨è®°å¿†ä¸è¾“å…¥åºåˆ—çš„èåˆï¼ŒåŒ…æ‹¬åµŒå…¥æ‹¼æ¥ã€æ³¨æ„åŠ›æ©ç æ‰©å±•å’Œä½ç½® ID è®¡ç®—ï¼Œç¡®ä¿è®°å¿†ä¸åŸå§‹è¾“å…¥åœ¨è¯­ä¹‰ç©ºé—´å’Œæ—¶åºä¸Šçš„ä¸€è‡´æ€§ã€‚</li>
<li>é«˜æ•ˆçš„æ¨¡å‹è®¾è®¡ï¼š
<ul>
<li>åŸºäºé¢„è®­ç»ƒ LLM æ„å»ºï¼Œæ”¯æŒ PEFT å‚æ•°é«˜æ•ˆå¾®è°ƒï¼Œåœ¨ä¿ç•™åŸºç¡€èƒ½åŠ›çš„åŒæ—¶é™ä½è®­ç»ƒæˆæœ¬ï¼›</li>
<li>é‡‡ç”¨ bfloat16 ç²¾åº¦å’Œ Flash Attention 2 ä¼˜åŒ–ï¼Œæå‡è®¡ç®—æ•ˆç‡å’Œå†…å­˜åˆ©ç”¨ç‡ã€‚</li>
</ul>
</li>
<li>åŠ¨æ€è®°å¿†ç¼–ç»‡æœºåˆ¶ï¼šç”Ÿæˆçš„æ½œåœ¨è®°å¿†å¹¶éé™æ€æ£€ç´¢ç»“æœï¼Œè€Œæ˜¯åŸºäºå½“å‰è¾“å…¥åºåˆ—åŠ¨æ€ç”Ÿæˆçš„éšè—çŠ¶æ€ï¼Œèƒ½å¤Ÿæ•æ‰å®æ—¶ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå®ç° â€œç”Ÿæˆå¼è®°å¿†â€ çš„æ ¸å¿ƒç‰¹æ€§ã€‚</li>
<li>æ¨¡å—åŒ–ä¸å¯æ‰©å±•æ€§ï¼šä¸æ¨ç†å™¨ã€è§¦å‘å™¨è§£è€¦ï¼Œé€šè¿‡æ ‡å‡†åŒ–æ¥å£äº¤äº’ï¼›æ½œåœ¨è®°å¿†çš„æ•°é‡å¯é€šè¿‡å‚æ•°çµæ´»é…ç½®ï¼Œé€‚é…ä¸åŒä»»åŠ¡å¯¹è®°å¿†å®¹é‡çš„éœ€æ±‚ã€‚</li>
</ul>
<h5 data-id="heading-22">2.3.3 ç½‘ç»œæ¶æ„</h5>
<p>ç½‘ç»œæ¶æ„å›¾å¦‚ä¸‹ã€‚</p>
<p>è¯´æ˜å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li>å¯å­¦ä¹ æ½œåœ¨è®°å¿†å‘é‡ï¼šåˆ†é˜¶æ®µè®¾è®¡ï¼ˆP=æç¤ºè¯é˜¶æ®µæ•°é‡ï¼ŒI=æ¨ç†é˜¶æ®µæ•°é‡ï¼‰ï¼Œæ”¯æŒåŠ¨æ€ç”Ÿæˆè®°å¿†</li>
<li>é¢„è®­ç»ƒLLMï¼šä½œä¸ºè®°å¿†ç”Ÿæˆæ ¸å¿ƒï¼Œé»˜è®¤å¯ç”¨bfloat16ç²¾åº¦å’ŒFlash Attention 2ä¼˜åŒ–</li>
<li>åºåˆ—èåˆå±‚ï¼šç¡®ä¿è¾“å…¥ä¸è®°å¿†åœ¨è¯­ä¹‰ã€æ©ç ã€æ—¶åºä¸Šçš„ä¸€è‡´æ€§</li>
</ul>
</li>
<li>
<p>æ ¸å¿ƒæµç¨‹ï¼š</p>
<ul>
<li>è¾“å…¥ â†’ é€‰æ‹©å¯¹åº”é˜¶æ®µçš„æ½œåœ¨è®°å¿† â†’ èåˆåºåˆ— â†’ LLMç”Ÿæˆéšè—çŠ¶æ€ â†’ æå–æ½œåœ¨è®°å¿†è¾“å‡º</li>
<li>æ”¯æŒPEFTå‚æ•°é«˜æ•ˆå¾®è°ƒï¼ˆå¦‚LoRAï¼‰ï¼Œé€‚é…äºTransformer Blockså±‚</li>
</ul>
</li>
<li>
<p>è¾“å‡ºç”¨é€”ï¼š</p>
<ul>
<li>ç”Ÿæˆçš„æ½œåœ¨è®°å¿†å°†é€šè¿‡æŠ•å½±å±‚æ˜ å°„åˆ°æ¨ç†å™¨çš„åµŒå…¥ç©ºé—´ï¼Œä¸åŸå§‹è¾“å…¥èåˆä»¥å¼•å¯¼è§£ç </li>
</ul>
</li>
</ol>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/171332decb0c4154ba66ca9f7de013db~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg572X6KW_55qE5oCd6ICD:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763380690&amp;x-signature=MkDfTVSJzZAmLMpyyKdipXchpbw%3D" alt="MemGen-4.png" loading="lazy"/></p>
<h5 data-id="heading-23">2.3.4 ä»£ç </h5>
<p>ä¸¤ä¸ªå…³é”®å˜é‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>prompt_query_latentsã€‚
<ul>
<li>ä½œç”¨ï¼šå¢å¼ºæ¨¡å‹åœ¨å¤„ç†promptæ—¶å€™çš„è¡¨ç°ã€‚ åœ¨æ¨¡å‹å¤„ç†å®ŒåŸå§‹æç¤ºä¹‹åä¼šè¢«æ³¨å…¥åˆ°åºåˆ—ä¸­ï¼Œä¸ºæ¨¡å‹æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šåœ¨ augment_prompt æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œåœ¨ç”Ÿæˆé˜¶æ®µçš„å¼€å§‹é˜¶æ®µä½¿ç”¨ä¸€æ¬¡ã€‚</li>
</ul>
</li>
<li>inference_query_latentsã€‚
<ul>
<li>ä½œç”¨ï¼šåœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åŠ¨æ€å¢å¼ºæ¨¡å‹çš„æ¨ç†èƒ½åŠ›ã€‚å¯ä»¥åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­çš„å¤šä¸ªç‚¹è¢«æ³¨å…¥ï¼Œä»¥æä¾›å®æ—¶ä¸Šä¸‹æ–‡å¢å¼ºã€‚</li>
<li>ä½¿ç”¨åœºæ™¯ï¼šåœ¨ augment_inference æ–¹æ³•ä¸­ä½¿ç”¨ï¼Œåœ¨ç”Ÿæˆé˜¶æ®µä¸­å¤šæ¬¡è¢«ä½¿ç”¨ã€‚é€šå¸¸åœ¨é‡åˆ°ç‰¹å®šåˆ†éš”ç¬¦ï¼ˆé€—å·ï¼Œå¥å·ç­‰ï¼‰åè§¦å‘æ’å…¥ã€‚</li>
</ul>
</li>
</ul>
<p>è¿™ä¸¤ä¸ªå˜é‡éƒ½é€šè¿‡_augment æ–¹æ³•è·å¾—ï¼ˆè·å–å­¦ä¹ åˆ°çš„æ½œåœ¨å‘é‡ï¼Œå¹¶å°†å…¶é™„åŠ åˆ°è¾“å…¥åµŒå…¥ä¸­ï¼‰ã€‚å…¶æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å°†æ½œåœ¨å˜é‡é™„åŠ åˆ°å½“å‰è¾“å…¥åµŒå…¥åºåˆ—çš„æœ«å°¾ã€‚</li>
<li>æ›´æ–°æ³¨æ„åŠ›æ©ç å’Œä½ç½®IDï¼Œä»¥è€ƒè™‘æ–°å¢çš„æ½œåœ¨å‘é‡ã€‚</li>
<li>å°†å¢å¼ºåçš„åºåˆ—é€šè¿‡Weaveræ¨¡å‹å¤„ç†ã€‚</li>
<li>æä¾›äºæ½œåœ¨å‘é‡ä½ç½®å¯¹åº”çš„éšçŠ¶æ€ä½œä¸ºå¢å¼ºè¡¨ç¤ºã€‚</li>
</ul>
<p>åˆ¤æ–­æ˜¯å¦æ’å…¥æ˜¯é€šè¿‡å‡½æ•° _should_augment å®Œæˆçš„ã€‚</p>
<ul>
<li>æ£€æŸ¥å½“å‰ç”Ÿæˆçš„æ–‡æœ¬æ˜¯å¦æ˜¯ç‰¹æ®Šå­—ç¬¦ï¼ˆé€—å·ç­‰ï¼‰</li>
<li>ä½¿ç”¨è§¦å‘æ¨¡å‹ï¼ˆtrigger modelï¼‰è¿›ä¸€æ­¥åˆ¤æ–­æ˜¯å¦åº”è¯¥å¢å¼ºã€‚</li>
<li>è€ƒè™‘æœ€å¤§å¢å¼ºæ¬¡æ•°é™åˆ¶ã€‚</li>
</ul>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MemGenWeaver</span>(torch.nn.Module):
    <span class="hljs-string">"""
    MemGenæ¨¡å‹çš„ç¼–ç»‡å™¨æ¨¡å—ï¼ˆMemGenWeaverï¼‰ã€‚
    - è¾“å…¥ï¼šæ¥æ”¶æ¥æ”¶æ¥è‡ªæ¨ç†å™¨æ¨¡å‹å½“å‰å½“å‰è§£ç åºåˆ—çš„`inputs_embeds`ï¼ˆè¾“å…¥åµŒå…¥å…¥ï¼‰
    - è¾“å‡ºï¼šç”Ÿæˆé•¿åº¦ä¸ºKçš„éšè—çŠ¶æ€åºåˆ—ï¼Œ
è¿™äº›çŠ¶æ€å°†ä¸åŸå§‹`inputs_embeds`æ‹¼æ¥ï¼Œä»¥æ”¹å˜æ¨ç†å™¨çš„è§£ç è·¯å¾„
    """</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">
        self, 
        pretrained_model_name_or_path: <span class="hljs-built_in">str</span>,  <span class="hljs-comment"># é¢„è®­ç»ƒæ¨¡å‹çš„åç§°æˆ–è·¯å¾„</span>
        prompt_latents_num: <span class="hljs-built_in">int</span>,    <span class="hljs-comment"># æç¤ºè¯é˜¶æ®µç”Ÿæˆçš„æ½œåœ¨è®°å¿†æ•°é‡</span>
        inference_latents_num: <span class="hljs-built_in">int</span>, <span class="hljs-comment"># æ¨ç†é˜¶æ®µç”Ÿæˆçš„æ½œåœ¨è®°å¿†æ•°é‡</span>
        peft_config: <span class="hljs-type">Optional</span>[PeftConfig] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># PEFTé…ç½®ï¼ˆå¯é€‰ï¼‰</span>
    </span>):
        <span class="hljs-built_in">super</span>().__init__()
        
        <span class="hljs-comment"># åŸºç¡€æ¨¡å‹åˆå§‹åŒ–</span>
        self.model = AutoModelForCausalLM.from_pretrained(
            pretrained_model_name_or_path,
            torch_dtype=torch.bfloat16,  <span class="hljs-comment"># ä½¿ç”¨bfloat16ç²¾åº¦ä»¥æé«˜æ•ˆç‡</span>
            attn_implementation=<span class="hljs-string">"flash_attention_2"</span>  <span class="hljs-comment"># å¯ç”¨Flash Attentionention 2ä¼˜åŒ–</span>
        )
        self.tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name_or_path)  <span class="hljs-comment"># å¯¹åº”çš„åˆ†è¯å™¨</span>
        <span class="hljs-comment"># è‹¥æä¾›PEFTé…ç½®ï¼Œåˆ™åº”ç”¨å‚æ•°é«˜æ•ˆå¾®è°ƒ</span>
        <span class="hljs-keyword">if</span> peft_config <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:
            self.model = get_peft_model(self.model, peft_config)
        
        self.config = self.model.config  <span class="hljs-comment"># ä¿å­˜æ¨¡å‹é…ç½®</span>
        
        <span class="hljs-comment"># æç¤ºè¯é˜¶æ®µçš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼ˆå¯å­¦ä¹ å‚æ•°ï¼‰</span>
        self.prompt_query_latents = nn.Parameter(
            torch.randn(prompt_latents_num, self.config.hidden_size),  <span class="hljs-comment"># å½¢çŠ¶ï¼š[prompt_latents_num, hidden_size]</span>
            requires_grad=<span class="hljs-literal">True</span>  <span class="hljs-comment"># å…è®¸åå‘ä¼ æ’­æ›´æ–°</span>
        )

        <span class="hljs-comment"># æ¨ç†é˜¶æ®µçš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼ˆå¯å­¦ä¹ å‚æ•°ï¼‰</span>
        self.inference_query_latents = nn.Parameter(
            torch.randn(inference_latents_num, self.config.hidden_size),  <span class="hljs-comment"># å½¢çŠ¶ï¼š[inference_latents_num, hidden_size]</span>
            requires_grad=<span class="hljs-literal">True</span>  <span class="hljs-comment"># å…è®¸åå‘ä¼ æ’­æ›´æ–°</span>
        )
    
<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">prompt_latents_num</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""è¿”å›æç¤ºè¯é˜¶æ®µçš„æ½œåœ¨è®°å¿†æ•°é‡"""</span>
        <span class="hljs-keyword">return</span> self.prompt_query_latents.size(<span class="hljs-number">0</span>)

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inference_latents_num</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">int</span>:
        <span class="hljs-string">"""è¿”å›æ¨ç†é˜¶æ®µçš„æ½œåœ¨è®°å¿†æ•°é‡"""</span>
        <span class="hljs-keyword">return</span> self.inference_query_latents.size(<span class="hljs-number">0</span>)

<span class="hljs-meta">    @property</span>
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">device</span>(<span class="hljs-params">self</span>):
        <span class="hljs-string">"""è¿”å›æ¨¡å‹æ‰€åœ¨çš„è®¾å¤‡ï¼ˆCPU/GPUï¼‰"""</span>
        <span class="hljs-keyword">return</span> self.model.device

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_augment</span>(<span class="hljs-params">
        self, 
        latents: torch.Tensor,                <span class="hljs-comment"># æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ï¼Œå½¢çŠ¶ï¼š[latents_num, hidden_size]</span>
        inputs_embeds: torch.Tensor,          <span class="hljs-comment"># è¾“å…¥åµŒå…¥ï¼Œå½¢çŠ¶ï¼š[batch_size, seq_len, hidden_size]</span>
        attention_mask: torch.Tensor,         <span class="hljs-comment"># æ³¨æ„åŠ›æ©ç ï¼Œå½¢çŠ¶ï¼š[batch_size, seq_len]</span>
        position_ids: torch.Tensor            <span class="hljs-comment"># ä½ç½®IDï¼Œå½¢çŠ¶ï¼š[batch_size, seq_len]</span>
    </span>) -&gt; <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor, torch.Tensor]:
        <span class="hljs-string">"""
        é€šç”¨çš„æ½œåœ¨è®°å¿†å¢å¼ºæ–¹æ³•ï¼šå°†æ½œåœ¨è®°å¿†ä¸è¾“å…¥åºåˆ—èåˆï¼Œç”Ÿæˆå¢å¼ºåçš„éšè—çŠ¶æ€ã€‚
        
        å‚æ•°ï¼š
            latents: æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡
            inputs_embeds: è¾“å…¥åºåˆ—çš„åµŒå…¥è¡¨ç¤º
            attention_mask: è¾“å…¥åºåˆ—çš„æ³¨æ„åŠ›æ©ç 
            position_ids: è¾“å…¥åºåˆ—çš„ä½ç½®ID
        
        è¿”å›ï¼š
            ä¸‰å…ƒç»„ (latents_hidden_states, latents_mask, latents_position_ids)
            - latents_hidden_states: ç”Ÿæˆçš„æ½œåœ¨è®°å¿†éšè—çŠ¶æ€ï¼Œå½¢çŠ¶ï¼š[batch_size, latents_num, hidden_size]
            - latents_mask: æ½œåœ¨è®°å¿†çš„æ³¨æ„åŠ›æ©ç ï¼Œå½¢çŠ¶ï¼š[batch_size, latents_num]
            - latents_position_ids: æ½œåœ¨è®°å¿†çš„ä½ç½®IDï¼Œå½¢çŠ¶ï¼š[batch_size, latents_num]
        """</span>
        batch_size = attention_mask.shape[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è·å–æ‰¹æ¬¡å¤§å°</span>
        latents_num = latents.size(<span class="hljs-number">0</span>)         <span class="hljs-comment"># è·å–æ½œåœ¨è®°å¿†æ•°é‡</span>
        
        <span class="hljs-comment"># æ‰©å±•æ½œåœ¨è®°å¿†ç»´åº¦ä»¥åŒ¹é…æ‰¹æ¬¡å¤§å°ï¼š[1, latents_num, hidden_size] â†’ [batch_size, latents_num, hidden_size]</span>
        latents = latents.unsqueeze(<span class="hljs-number">0</span>).repeat(batch_size, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>)
        
        <span class="hljs-comment"># å°†æ½œåœ¨è®°å¿†åµŒå…¥ä¸è¾“å…¥åµŒå…¥æ‹¼æ¥ï¼š[batch_size, seq_len + latents_num, hidden_size]</span>
        inputs_embeds = torch.cat([inputs_embeds, latents], dim=<span class="hljs-number">1</span>)

        <span class="hljs-comment"># æ„å»ºæ½œåœ¨è®°å¿†çš„æ³¨æ„åŠ›æ©ç ï¼ˆå…¨ä¸º1ï¼Œè¡¨ç¤ºæœ‰æ•ˆï¼‰å¹¶ä¸è¾“å…¥æ©ç æ‹¼æ¥</span>
        latents_mask = torch.ones(latents.shape[:-<span class="hljs-number">1</span>], dtype=attention_mask.dtype, device=attention_mask.device)
        attention_mask = torch.cat([attention_mask, latents_mask], dim=<span class="hljs-number">1</span>)  <span class="hljs-comment"># å½¢çŠ¶ï¼š[batch_size, seq_len + latents_num]</span>
        
        <span class="hljs-comment"># ç”Ÿæˆæ½œåœ¨è®°å¿†çš„ä½ç½®IDï¼ˆåœ¨è¾“å…¥åºåˆ—æœ€åä½ç½®çš„åŸºç¡€ä¸Šé€’å¢ï¼‰</span>
        last_position_ids = position_ids.<span class="hljs-built_in">max</span>(dim=<span class="hljs-number">1</span>)[<span class="hljs-number">0</span>]  <span class="hljs-comment"># è·å–è¾“å…¥åºåˆ—çš„æœ€å¤§ä½ç½®ID</span>
        latents_relative_positions = torch.arange(latents_num, device=attention_mask.device)  <span class="hljs-comment"># æ½œåœ¨è®°å¿†çš„ç›¸å¯¹ä½ç½®</span>
        <span class="hljs-comment"># è®¡ç®—ç»å¯¹ä½ç½®ï¼šè¾“å…¥åºåˆ—æœ€å¤§ä½ç½® + ç›¸å¯¹ä½ç½® + 1ï¼ˆé¿å…é‡å ï¼‰</span>
        latents_position_ids = last_position_ids.unsqueeze(<span class="hljs-number">1</span>) + latents_relative_positions + <span class="hljs-number">1</span>
        <span class="hljs-comment"># æ‹¼æ¥ä½ç½®IDï¼š[batch_size, seq_len + latents_num]</span>
        position_ids = torch.cat([position_ids.long(), latents_position_ids.long()], dim=<span class="hljs-number">1</span>) 

        <span class="hljs-comment"># éªŒè¯æ‹¼æ¥åçš„ç»´åº¦æ˜¯å¦ä¸€è‡´</span>
        <span class="hljs-keyword">assert</span> inputs_embeds.shape[:<span class="hljs-number">2</span>] == attention_mask.shape == position_ids.shape

        <span class="hljs-comment"># æ¨¡å‹å‰å‘ä¼ æ’­ï¼Œè·å–éšè—çŠ¶æ€</span>
        outputs = self.model(
            inputs_embeds=inputs_embeds,
            attention_mask=attention_mask,
            position_ids=position_ids,  
            output_hidden_states=<span class="hljs-literal">True</span>,  <span class="hljs-comment"># è¾“å‡ºæ‰€æœ‰å±‚çš„éšè—çŠ¶æ€</span>
        )
        <span class="hljs-comment"># å–æœ€åä¸€å±‚çš„éšè—çŠ¶æ€ï¼Œå¹¶æå–æ½œåœ¨è®°å¿†éƒ¨åˆ†ï¼ˆåºåˆ—æœ«å°¾çš„latents_numä¸ªä½ç½®ï¼‰</span>
        hidden_states = outputs.hidden_states[-<span class="hljs-number">1</span>]
        latents_hidden_states = hidden_states[:, -latents_num:, :]

        <span class="hljs-keyword">return</span> latents_hidden_states, latents_mask, latents_position_ids

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">augment_prompt</span>(<span class="hljs-params">
        self, 
        inputs_embeds: torch.Tensor, 
        attention_mask: torch.Tensor, 
        position_ids: torch.Tensor
    </span>) -&gt; <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor, torch.Tensor]:
        <span class="hljs-string">"""
        æç¤ºè¯é˜¶æ®µçš„æ½œåœ¨è®°å¿†å¢å¼ºï¼šä½¿ç”¨æç¤ºè¯ä¸“ç”¨çš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ã€‚
        
        å‚æ•°ä¸è¿”å›å€¼åŒ_augmentæ–¹æ³•
        """</span>
        <span class="hljs-keyword">return</span> self._augment(
            latents=self.prompt_query_latents,
            inputs_embeds=inputs_embeds,
            attention_mask=attention_mask,
            position_ids=position_ids
        )


    <span class="hljs-keyword">def</span> <span class="hljs-title function_">augment_inference</span>(<span class="hljs-params">
        self, 
        inputs_embeds: torch.Tensor, 
        attention_mask: torch.Tensor, 
        position_ids: torch.Tensor
    </span>) -&gt; <span class="hljs-type">Tuple</span>[torch.Tensor, torch.Tensor, torch.Tensor]:
        <span class="hljs-string">"""
        æ¨ç†é˜¶æ®µçš„æ½œåœ¨è®°å¿†å¢å¼ºï¼šä½¿ç”¨æ¨ç†ä¸“ç”¨çš„æ½œåœ¨è®°å¿†æŸ¥è¯¢å‘é‡ã€‚
        
        å‚æ•°ä¸è¿”å›å€¼åŒ_augmentæ–¹æ³•
        """</span>
        <span class="hljs-keyword">return</span> self._augment(
            latents=self.inference_query_latents,
            inputs_embeds=inputs_embeds,
            attention_mask=attention_mask,
            position_ids=position_ids
        )
</code></pre>
<h3 data-id="heading-24">0xFF å‚è€ƒ</h3>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FpqCPoUw0p2oTsnMUj9t2mw" target="_blank" title="https://mp.weixin.qq.com/s/pqCPoUw0p2oTsnMUj9t2mw" ref="nofollow noopener noreferrer">æœ€æ–°æˆæœï¼Agentè®°å¿†çš„ç¬¬ä¸‰ç§å¯èƒ½ï¼šç”Ÿæˆå¼éšå¼è®°å¿†</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring AI å®æˆ˜â€”â€”è¯„ä¼°ç”Ÿæˆç»“æœ]]></title>    <link>https://juejin.cn/post/7570901172526858275</link>    <guid>https://juejin.cn/post/7570901172526858275</guid>    <pubDate>2025-11-10T09:40:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172526858275" data-draft-id="7570866247980187700" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring AI å®æˆ˜â€”â€”è¯„ä¼°ç”Ÿæˆç»“æœ"/> <meta itemprop="keywords" content="Spring,AIç¼–ç¨‹,LLM"/> <meta itemprop="datePublished" content="2025-11-10T09:40:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•°æ®æ™ºèƒ½è€å¸æœº"/> <meta itemprop="url" content="https://juejin.cn/user/430664289626439"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring AI å®æˆ˜â€”â€”è¯„ä¼°ç”Ÿæˆç»“æœ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664289626439/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•°æ®æ™ºèƒ½è€å¸æœº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:40:14.000Z" title="Mon Nov 10 2025 09:40:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»8åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æœ¬ç« å†…å®¹</h2>
<ul>
<li>åˆè¯† Spring AI çš„è¯„ä¼°å™¨ï¼ˆevaluatorsï¼‰</li>
<li>æ£€æŸ¥ç›¸å…³æ€§ï¼ˆrelevancyï¼‰</li>
<li>åˆ¤æ–­å›ç­”çš„æ­£ç¡®æ€§ï¼ˆcorrectnessï¼‰</li>
<li>åœ¨è¿è¡Œæ—¶åº”ç”¨è¯„ä¼°å™¨</li>
</ul>
<p>ä¸ºä½ çš„ä»£ç ç¼–å†™æµ‹è¯•æ˜¯ä¸€ç§é‡è¦å®è·µã€‚è‡ªåŠ¨åŒ–æµ‹è¯•ä¸ä»…èƒ½ç¡®ä¿åº”ç”¨æ²¡æœ‰è¢«ç ´åï¼Œè¿˜èƒ½æä¾›æœ‰åŠ©äºè®¾è®¡ä¸å®ç°çš„åé¦ˆã€‚å¯¹åº”ç”¨ä¸­çš„<strong>ç”Ÿæˆå¼ AI ç»„ä»¶</strong>è¿›è¡Œæµ‹è¯•ï¼Œä¸æ¯«ä¸æ¯”å…¶ä»–éƒ¨åˆ†çš„æµ‹è¯•ä¸é‡è¦ã€‚</p>
<p>åªæœ‰ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä½ æŠŠç›¸åŒçš„æç¤ºå¤šæ¬¡å‘é€ç»™ä¸€ä¸ª LLMï¼Œä½ å¾ˆå¯èƒ½æ¯æ¬¡éƒ½ä¼šå¾—åˆ°ä¸åŒçš„ç­”æ¡ˆã€‚ç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>æ„å‘³ç€æµ‹è¯•ä¸­æ— æ³•é‡‡ç”¨â€œæ–­è¨€ç›¸ç­‰ï¼ˆassert equalsï¼‰â€çš„å¥—è·¯ã€‚</p>
<p>åœ¨ç¬¬ 1 ç« é‡Œï¼Œä½ çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ <strong>WireMock</strong> æ¥æ¨¡æ‹Ÿ API çš„å“åº”ï¼Œä»è€Œåœ¨æµ‹è¯•ä¸­è·å¾—<strong>ç¡®å®šæ€§çš„</strong>ç»“æœã€‚è¿™ç§æµ‹è¯•æ–¹å¼éå¸¸é€‚åˆæµ‹è¯•â€œå›´ç»•å‘ç”Ÿæˆå¼ AI API å‘èµ·è¯·æ±‚â€çš„ä»£ç ï¼Œä½†å®ƒå¹¶ä¸èƒ½æµ‹è¯•<strong>æç¤ºæœ¬èº«</strong>ä»¥åŠæ¨¡å‹å¦‚ä½•å¯¹è¯¥æç¤ºä½œå‡ºå“åº”ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring AI æä¾›äº†å¦ä¸€ç§åˆ¤æ–­â€œç”Ÿæˆå“åº”æ˜¯å¦å¯æ¥å—â€çš„æ–¹å¼ï¼š<strong>è¯„ä¼°å™¨ï¼ˆEvaluatorsï¼‰</strong> ã€‚</p>
<p>ä¸€ä¸ª<strong>è¯„ä¼°å™¨</strong>ä¼šæ‹¿åˆ°æäº¤ç»™ LLM çš„æç¤ºä¸­çš„ç”¨æˆ·æ–‡æœ¬ï¼Œä»¥åŠæ¨¡å‹è¿”å›çš„å†…å®¹ï¼Œç„¶åæ®æ­¤åˆ¤æ–­è¿™ä»½å“åº”å†…å®¹æ˜¯å¦é€šè¿‡æŸäº›å‡†åˆ™ã€‚ä»å†…éƒ¨æœºåˆ¶çœ‹ï¼Œè¯„ä¼°å™¨å¯ä»¥ç”¨ä»»ä½•é€‚åˆå…¶è¯„ä¼°ç±»å‹çš„æ–¹å¼å®ç°ã€‚ä½†å¦‚å›¾ 2.1 æ‰€ç¤ºï¼Œè¯„ä¼°å™¨é€šå¸¸ä¼š**å€ŸåŠ©ä¸€ä¸ª LLMï¼ˆé€šè¿‡ ChatClientï¼‰**æ¥åˆ¤æ–­ç”Ÿæˆçš„å“åº”ä¸æ‰€æäº¤æç¤ºä¹‹é—´çš„å¥‘åˆåº¦ã€‚</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f81731ace774ceb9bf9b4be09adc02b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763372413&amp;x-signature=y30vXdbCZqbHl%2FEgAco4CH6BmiA%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 2.1</strong> Spring AI è¯„ä¼°å™¨æŠŠæç¤ºä¸ç”Ÿæˆçš„å“åº”ä¸€å¹¶å‘é€ç»™ LLMï¼Œä»¥è¯„ä¼°å“åº”è´¨é‡ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨è¯„ä¼°å™¨ï¼Œä¸º <strong>BoardGameService</strong>ï¼ˆBoard Game Buddy åº”ç”¨ä¸­ä½¿ç”¨ç”Ÿæˆå¼ AI çš„é‚£ä¸ªç»„ä»¶ï¼‰ç¼–å†™ä¸€ä»½<strong>é›†æˆæµ‹è¯•</strong>ã€‚</p>
<h2 data-id="heading-1">2.1 ç¡®ä¿ç­”æ¡ˆç›¸å…³ï¼ˆEnsuring relevant answersï¼‰</h2>
<p>æœ€åŸºç¡€çš„è¯„ä¼°å½¢å¼ï¼Œå°±æ˜¯åˆ¤æ–­ LLM æ˜¯å¦å›ç­”äº†<strong>æ‰€æçš„é—®é¢˜</strong>ã€‚ä¹Ÿå°±æ˜¯ï¼šç”Ÿæˆçš„å“åº”<strong>è‡³å°‘ä¸æç¤ºåŒä¸€è¯é¢˜</strong>å—ï¼Ÿ</p>
<p>ä¾‹å¦‚ï¼Œç”¨æˆ·é—® â€œWhy is the sky blue?â€ï¼ŒLLM å›ç­” â€œBecause of Rayleigh scatteringâ€ï¼ˆæˆ–ç±»ä¼¼å›ç­”ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªç­”æ¡ˆæ˜¯<strong>ç›¸å…³çš„</strong>ã€‚åä¹‹ï¼Œè‹¥ LLM å›ç­” â€œThe moon is approximately 239,900 miles from Earth.â€ï¼Œå°½ç®¡å®ƒå¯èƒ½æ˜¯æ­£ç¡®äº‹å®ï¼Œä½†<strong>ä¸å¤©ç©ºä¸ºä½•æ˜¯è“è‰²</strong>è¿™ä¸€é—®é¢˜<strong>ä¸ç›¸å…³</strong>ã€‚</p>
<p>åˆ¤æ–­ç­”æ¡ˆæ˜¯å¦ä¸ç»™å®šé—®é¢˜ç›¸å…³ï¼Œæ­£æ˜¯ Spring AI çš„ <strong>RelevancyEvaluator</strong> è¦åšçš„äº‹ã€‚ä¸ºäº†ç†è§£å®ƒå¦‚ä½•å·¥ä½œï¼Œè®©æˆ‘ä»¬ç”¨å®ƒæ¥ä¸º <strong>BoardGameService</strong> å†™ä¸€ä¸ªæµ‹è¯•ã€‚ä¸‹é¢çš„æ¸…å•å±•ç¤ºäº†è¯¥æµ‹è¯•ç±»ã€‚</p>
<p><strong>æ¸…å• 2.1 æµ‹è¯• LLM çš„å“åº”æ˜¯å¦ä¸é—®é¢˜ç›¸å…³</strong></p>
<pre><code class="hljs language-typescript" lang="typescript">package com.<span class="hljs-property">example</span>.<span class="hljs-property">boardgamebuddy</span>;

<span class="hljs-keyword">import</span> org.<span class="hljs-property">assertj</span>.<span class="hljs-property">core</span>.<span class="hljs-property">api</span>.<span class="hljs-property">Assertions</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">junit</span>.<span class="hljs-property">jupiter</span>.<span class="hljs-property">api</span>.<span class="hljs-property">BeforeEach</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">junit</span>.<span class="hljs-property">jupiter</span>.<span class="hljs-property">api</span>.<span class="hljs-property">Test</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">chat</span>.<span class="hljs-property">client</span>.<span class="hljs-property">ChatClient</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">chat</span>.<span class="hljs-property">evaluation</span>.<span class="hljs-property">RelevancyEvaluator</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">evaluation</span>.<span class="hljs-property">EvaluationRequest</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">ai</span>.<span class="hljs-property">evaluation</span>.<span class="hljs-property">EvaluationResponse</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">beans</span>.<span class="hljs-property">factory</span>.<span class="hljs-property">annotation</span>.<span class="hljs-property">Autowired</span>;
<span class="hljs-keyword">import</span> org.<span class="hljs-property">springframework</span>.<span class="hljs-property">boot</span>.<span class="hljs-property">test</span>.<span class="hljs-property">context</span>.<span class="hljs-property">SpringBootTest</span>;

<span class="hljs-meta">@SpringBootTest</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameServiceTests</span> {

  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">BoardGameService</span> boardGameService;

  <span class="hljs-meta">@Autowired</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title class_">ChatClient</span>.<span class="hljs-property">Builder</span> chatClientBuilder;

  <span class="hljs-keyword">private</span> <span class="hljs-title class_">RelevancyEvaluator</span> relevancyEvaluator;

  <span class="hljs-meta">@BeforeEach</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">relevancyEvaluator</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RelevancyEvaluator</span>(chatClientBuilder);
  }

  <span class="hljs-meta">@Test</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">evaluateRelevancy</span>(<span class="hljs-params"/>) {
    <span class="hljs-title class_">String</span> userText = <span class="hljs-string">"Why is the sky blue?"</span>;
    <span class="hljs-title class_">Question</span> question = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Question</span>(userText);
    <span class="hljs-title class_">Answer</span> answer = boardGameService.<span class="hljs-title function_">askQuestion</span>(question);

    <span class="hljs-title class_">EvaluationRequest</span> evaluationRequest = <span class="hljs-keyword">new</span> <span class="hljs-title class_">EvaluationRequest</span>(
        userText, answer.<span class="hljs-title function_">answer</span>());

    <span class="hljs-title class_">EvaluationResponse</span> response = relevancyEvaluator
        .evaluate(evaluationRequest);

    <span class="hljs-title class_">Assertions</span>.<span class="hljs-title function_">assertThat</span>(response.<span class="hljs-title function_">isPass</span>())
        .<span class="hljs-title function_">withFailMessage</span>(<span class="hljs-string">""</span><span class="hljs-string">"
          ========================================
          The answer "</span>%s<span class="hljs-string">"
          is not considered relevant to the question
          "</span>%s<span class="hljs-string">".
          ========================================
          "</span><span class="hljs-string">""</span>, answer.<span class="hljs-title function_">answer</span>(), userText)
        .<span class="hljs-title function_">isTrue</span>();
  }

}
</code></pre>
<p>é˜…è¯» <code>SpringAiBoardGameServiceTests</code> å¯ä»¥çœ‹åˆ°ï¼Œæµ‹è¯•å‰å‡ è¡Œåœ¨åš<strong>è¯„ä¼°æ‰€éœ€çš„å‡†å¤‡</strong>ã€‚ç±»ä¸Šæ ‡æ³¨äº† <code>@SpringBootTest</code>ï¼Œè¡¨æ˜è¿™æ˜¯<strong>é›†æˆæµ‹è¯•</strong>ï¼šä¼šåˆ›å»ºä¸€ä¸ª Spring åº”ç”¨ä¸Šä¸‹æ–‡ï¼ˆåŒ…å«åº”ç”¨ä¸­çš„æ‰€æœ‰ beanï¼‰ã€‚ä»è¯¥ä¸Šä¸‹æ–‡ä¸­ï¼Œé€šè¿‡ <code>@Autowired</code> æ³¨å…¥äº† <code>BoardGameService</code> ä¸ <code>ChatClient.Builder</code>ã€‚éšååœ¨ <code>setup()</code> æ–¹æ³•é‡Œï¼Œç”¨ <code>ChatClient.Builder</code> åˆ›å»ºäº†ä¸€ä¸ª <code>RelevancyEvaluator</code>ï¼Œä»¥ä¾›æµ‹è¯•æ–¹æ³•ä½¿ç”¨ã€‚</p>
<p><code>evaluateRelevancy()</code> æµ‹è¯•æ–¹æ³•é¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>Question</code>ï¼Œå¹¶å°†å…¶å‘é€ç»™æ³¨å…¥çš„ <code>BoardGameService#askQuestion()</code> æ¥è·å¾— <code>Answer</code>ã€‚æ¥ç€ç”¨åŸå§‹ç”¨æˆ·æ–‡æœ¬ä¸ç­”æ¡ˆåˆ›å»º <code>EvaluationRequest</code>ï¼Œä¼ ç»™ <code>RelevancyEvaluator#evaluate()</code>ã€‚å…¶å†…éƒ¨ä¼šå‘ LLM å‘é€ä¸€ä¸ªæç¤ºï¼Œè¦æ±‚å®ƒåˆ¤æ–­<strong>ç­”æ¡ˆä¸é—®é¢˜çš„ç›¸å…³æ€§</strong>ã€‚</p>
<p><code>evaluate()</code> è¿”å› <code>EvaluationResponse</code>ï¼Œéšåè°ƒç”¨ <code>isPass()</code> åˆ¤æ–­è¯„ä¼°æ˜¯å¦é€šè¿‡ã€‚è‹¥è¿”å› <code>true</code>ï¼Œè¯´æ˜ç­”æ¡ˆè¢«è®¤ä¸ºä¸é—®é¢˜ç›¸å…³ï¼›å¦åˆ™è¿”å› <code>false</code>ï¼Œè¡¨ç¤ºä¸ç›¸å…³ï¼Œæ–­è¨€å¤±è´¥ã€‚</p>
<p>æœ‰äº†è¿™ä¸ªæµ‹è¯•ï¼Œä½ å°±èƒ½<strong>å¿«é€Ÿã€è‡ªåŠ¨</strong>æ£€æŸ¥ï¼šé€šè¿‡ <code>SpringAiBoardGameService#askQuestion()</code> æå‡ºçš„ä¸€ä¸ªé—®é¢˜æ˜¯å¦å¾—åˆ°<strong>å¥‘åˆè¯é¢˜</strong>çš„å›ç­”ã€‚å½“ç„¶ï¼Œ<strong>ç›¸å…³</strong>å¹¶ä¸ç­‰äº<strong>æ­£ç¡®</strong>ã€‚æˆ‘ä»¬å†æŠŠæµ‹è¯•æå‡ä¸€æ¡£ï¼Œæ£€æŸ¥ç­”æ¡ˆæ˜¯å¦<strong>æ­£ç¡®</strong>ã€‚</p>
<h2 data-id="heading-2">2.2 æµ‹è¯•äº‹å®æ­£ç¡®æ€§ï¼ˆTesting for factual accuracyï¼‰</h2>
<p>å‡è®¾å½“è¢«é—®åˆ°â€œå¤©ç©ºä¸ºä»€ä¹ˆæ˜¯è“è‰²â€æ—¶ï¼ŒLLM å›ç­”ï¼šâ€œThe sky is blue because there are a gazillion tiny bubbles filled with blueberry jam floating in the atmosphere.â€ï¼ˆå¤©ç©ºä¹‹æ‰€ä»¥è“ï¼Œæ˜¯å› ä¸ºå¤§æ°”ä¸­æ¼‚æµ®ç€æ— æ•°è£…æ»¡è“è“é…±çš„å°æ°”æ³¡ã€‚ï¼‰è¿™ä¸ªå›ç­”çœ‹èµ·æ¥<strong>ç›¸å…³</strong>ï¼Œä½†æ˜¾ç„¶<strong>ä¸æ­£ç¡®</strong>ã€‚å®ƒä¹Ÿè®¸èƒ½â€œèº²è¿‡â€ <code>RelevancyEvaluator</code> çš„æ³•çœ¼ï¼Œä½†å¹¶ä¸é€‚åˆç›´æ¥å±•ç¤ºç»™ä½ çš„ç”¨æˆ·ã€‚</p>
<p>Spring AI çš„ <strong>FactCheckingEvaluator</strong> ä¸ <code>RelevancyEvaluator</code> ç±»ä¼¼ï¼Œä½†å®ƒä¸æ˜¯è®© LLM åˆ¤æ–­<strong>ç›¸å…³æ€§</strong>ï¼Œè€Œæ˜¯è®© LLM åˆ¤æ–­è¿™ä¸ªå›ç­”æ˜¯å¦<strong>æ­£ç¡®åœ°å›ç­”</strong>äº†é—®é¢˜ã€‚</p>
<p>åœ¨æŠŠäº‹å®æ­£ç¡®æ€§æµ‹è¯•åŠ è¿› <code>SpringAiBoardGameServiceTests</code> ä¹‹å‰ï¼Œéœ€è¦ç¨å¾®è°ƒæ•´ä¸€ä¸‹ <code>setup()</code> æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ª <code>FactCheckingEvaluator</code> å¹¶èµ‹ç»™å®ä¾‹å˜é‡ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">private</span> <span class="hljs-title class_">FactCheckingEvaluator</span> factCheckingEvaluator;

  <span class="hljs-meta">@BeforeEach</span>
  <span class="hljs-keyword">public</span> <span class="hljs-built_in">void</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">relevancyEvaluator</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RelevancyEvaluator</span>(chatClientBuilder);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">factCheckingEvaluator</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FactCheckingEvaluator</span>(
        chatClientBuilder);
  }
</code></pre>
<p>ç°åœ¨ç¼–å†™äº‹å®æ ¸æŸ¥æµ‹è¯•æ–¹æ³•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">@Test
  public void evaluateFactualAccuracy() {
    var <span class="hljs-attr">userText</span> = <span class="hljs-string">"Why is the sky blue?"</span><span class="hljs-comment">;</span>
    var <span class="hljs-attr">question</span> = new Question(userText)<span class="hljs-comment">;</span>
    var <span class="hljs-attr">answer</span> = boardGameService.askQuestion(question)<span class="hljs-comment">;</span>

    var <span class="hljs-attr">evaluationRequest</span> =
            new EvaluationRequest(userText, answer.answer())<span class="hljs-comment">;</span>

    var <span class="hljs-attr">response</span> =
            factCheckingEvaluator.evaluate(evaluationRequest)<span class="hljs-comment">;</span>

    Assertions.assertThat(response.isPass())
        .withFailMessage("<span class="hljs-attr">""</span>

          ========================================
          The answer "%s"
          is not considered correct for the question
          "%s".
          ========================================
          """, answer.answer(), userText)
        .isTrue()<span class="hljs-comment">;</span>
  }
</code></pre>
<p><code>evaluateFactualAccuracy()</code> ä¸ä¹‹å‰çš„ <code>evaluateRelevancy()</code> å¾ˆç›¸ä¼¼ã€‚ä¸ç›¸å…³æ€§æµ‹è¯•ä¸€æ ·ï¼Œä»ç„¶é€šè¿‡ <code>EvaluationResponse#isPass()</code> è¿›è¡Œæ–­è¨€ï¼šè‹¥ç”Ÿæˆçš„ç­”æ¡ˆè¢«åˆ¤å®šä¸º<strong>ä¸æ­£ç¡®</strong>ï¼Œæ–­è¨€å°±ä¼šå¤±è´¥ã€‚</p>
<p>å½“ <code>isPass()</code> è¿”å› <code>false</code> å¯¼è‡´æ–­è¨€å¤±è´¥æ—¶ï¼Œå¤±è´¥ä¿¡æ¯ä¼šè§£é‡ŠåŸå› ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœç”Ÿæˆçš„ç­”æ¡ˆæ˜¯ â€œThere are tiny bubbles filled with blueberry jam high in the atmosphere.â€ï¼Œé‚£ä¹ˆ <code>FactCheckingEvaluator</code> ä¼šåˆ¤å®šè¯¥å›ç­”<strong>ä¸æ­£ç¡®</strong>ï¼Œæ–­è¨€å¤±è´¥ï¼Œè¾“å‡ºçš„å¤±è´¥ä¿¡æ¯å¯èƒ½å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-csharp" lang="csharp">========================================
The answer <span class="hljs-string">"The sky is blue because there are a gazillion tiny bubbles filled
with blueberry jam floating in the atmosphere."</span>
<span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> considered correct <span class="hljs-keyword">for</span> the question
<span class="hljs-string">"Why is the sky blue?"</span>.
========================================
</code></pre>
<p>åœ¨é€šè¯»æœ¬ä¹¦çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå¯¹<strong>å‘é€ç»™ LLM çš„æç¤º</strong>åšå‡ºè®¸å¤šæ”¹åŠ¨ã€‚å€ŸåŠ© <code>evaluateRelevancy()</code> ä¸ <code>evaluateFactualAccuracy()</code> è¿™æ ·çš„æµ‹è¯•ï¼Œä½ å¯ä»¥ç¡®ä¿ï¼š<strong>æ— è®ºæç¤ºå¦‚ä½•è°ƒæ•´</strong>ï¼Œä¾ç„¶èƒ½è·å¾—<strong>æ°å½“ä¸”æ­£ç¡®</strong>çš„å›ç­”ã€‚</p>
<p>å³ä¾¿å¦‚æ­¤ï¼Œè¿˜æœ‰ä¸€ç‚¹å¯èƒ½ä¸é‚£ä¹ˆæ˜¾è€Œæ˜“è§ï¼šä½ ä¹Ÿè®¸ä¼šå¸Œæœ›åœ¨<strong>æµ‹è¯•ä¹‹å¤–ï¼ˆè¿è¡Œæ—¶ï¼‰<strong>ä½¿ç”¨è¯„ä¼°å™¨ï¼Œä»¥ç¡®ä¿å®é™…è¿è¡Œä¸­è¿”å›ç»™ç”¨æˆ·çš„å›ç­”åŒæ ·</strong>ç›¸å…³</strong>ä¸”<strong>æ­£ç¡®</strong>ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åœ¨åº”ç”¨ä»£ç ä¸­<strong>ç›´æ¥åº”ç”¨è¯„ä¼°å™¨</strong>ã€‚</p>
<h2 data-id="heading-3">2.3 åœ¨è¿è¡Œæ—¶åº”ç”¨è‡ªè¯„ä¼°ï¼ˆApplying self-evaluation at runtimeï¼‰</h2>
<p>å³ä½¿åœ¨æ„å»ºåº”ç”¨æ—¶åŸºäºè¯„ä¼°å™¨çš„æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œ<strong>è¿è¡Œæ—¶</strong>ä»å¯èƒ½å‡ºç°<strong>ä¸ç›¸å…³</strong>æˆ–<strong>ä¸æ­£ç¡®</strong>çš„å›ç­”ã€‚ç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>æ„å‘³ç€ï¼šæµ‹è¯•é˜¶æ®µä¹Ÿè®¸â€œè¿æ°”ä¸é”™â€æ‹¿åˆ°äº†å¥½å›ç­”ï¼Œä½†åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶æƒ…å†µå´å¯èƒ½â€œè·‘åâ€ã€‚åœ¨è¿è¡Œæ—¶åº”ç”¨è¯„ä¼°å™¨ï¼Œå¯ä»¥å¸®åŠ©é¿å…æŠŠç³Ÿç³•ç­”æ¡ˆè¿”å›ç»™åº”ç”¨ç”¨æˆ·ã€‚</p>
<p>äº‹å®è¯æ˜ï¼Œè¯„ä¼°å™¨å¹¶<strong>ä¸é™äº</strong>ç”¨äºé›†æˆæµ‹è¯•ã€‚ä¸‹é¢çš„æ¸…å•å±•ç¤ºäº†å¦‚ä½•æŠŠ <strong>RelevancyEvaluator</strong> ä¸ <strong>Spring Retry</strong> ç»“åˆï¼Œé¿å…è¿”å›ä¸ç”¨æˆ·é—®é¢˜<strong>ä¸ç›¸å…³</strong>çš„ç­”æ¡ˆã€‚</p>
<p><strong>æ¸…å• 2.2 åœ¨è¿è¡Œæ—¶ä»£ç ä¸­æ ¡éªŒç›¸å…³æ€§ï¼ˆVerifying relevancy in runtime codeï¼‰</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.evaluation.RelevancyEvaluator;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.prompt.ChatOptions;
<span class="hljs-keyword">import</span> org.springframework.ai.evaluation.EvaluationRequest;
<span class="hljs-keyword">import</span> org.springframework.ai.evaluation.EvaluationResponse;
<span class="hljs-keyword">import</span> org.springframework.retry.annotation.Recover;
<span class="hljs-keyword">import</span> org.springframework.retry.annotation.Retryable;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelfEvaluatingBoardGameService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> RelevancyEvaluator evaluator;

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">SelfEvaluatingBoardGameService</span><span class="hljs-params">(ChatClient.Builder chatClientBuilder)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">chatOptions</span> <span class="hljs-operator">=</span> ChatOptions.builder()
        .model(<span class="hljs-string">"gpt-4o-mini"</span>)
        .build();

    <span class="hljs-built_in">this</span>.chatClient = chatClientBuilder
        .defaultOptions(chatOptions)
        .build();

    <span class="hljs-built_in">this</span>.evaluator = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RelevancyEvaluator</span>(chatClientBuilder);
  }

  <span class="hljs-meta">@Override</span>
  <span class="hljs-meta">@Retryable(retryFor = AnswerNotRelevantException.class)</span>
  <span class="hljs-keyword">public</span> Answer <span class="hljs-title function_">askQuestion</span><span class="hljs-params">(Question question)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">answerText</span> <span class="hljs-operator">=</span> chatClient.prompt()
        .user(question.question())
        .call()
        .content();

    evaluateRelevancy(question, answerText);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(answerText);
  }

  <span class="hljs-meta">@Recover</span>
  <span class="hljs-keyword">public</span> Answer <span class="hljs-title function_">recover</span><span class="hljs-params">(AnswerNotRelevantException e)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(<span class="hljs-string">"I'm sorry, I wasn't able to answer the question."</span>);
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">evaluateRelevancy</span><span class="hljs-params">(Question question, String answerText)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">evaluationRequest</span> <span class="hljs-operator">=</span>
        <span class="hljs-keyword">new</span> <span class="hljs-title class_">EvaluationRequest</span>(question.question(), answerText);
    <span class="hljs-type">var</span> <span class="hljs-variable">evaluationResponse</span> <span class="hljs-operator">=</span> evaluator.evaluate(evaluationRequest);
    <span class="hljs-keyword">if</span> (!evaluationResponse.isPass()) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnswerNotRelevantException</span>(question.question(), answerText);
    }
  }

}
</code></pre>
<p><code>SelfEvaluatingBoardGameService</code> ä¸ <code>SpringAiBoardGameService</code> å¾ˆç›¸ä¼¼ï¼Œåªæ˜¯ <code>askQuestion()</code> æ–¹æ³•ä¸Šæ·»åŠ äº† <code>@Retryable</code> æ³¨è§£ã€‚è¿™ä¸ªæ¥è‡ª <strong>Spring Retry</strong> çš„æ³¨è§£è¡¨ç¤ºï¼šå¦‚æœè¯¥æ–¹æ³•æŠ›å‡ºäº† <code>AnswerNotRelevantException</code>ï¼Œåˆ™<strong>é‡è¯•</strong>è¯¥æ–¹æ³•ã€‚</p>
<p>åœ¨ <code>askQuestion()</code> ä¸­ï¼Œä¼šè°ƒç”¨ <code>evaluateRelevancy()</code> æ¥è¿›è¡Œç›¸å…³æ€§è¯„ä¼°ã€‚<code>evaluateRelevancy()</code> ä½¿ç”¨æ„é€ å™¨é‡Œåˆ›å»ºçš„ <code>RelevancyEvaluator</code>ã€‚è‹¥ <code>isPass()</code> è¿”å› <code>false</code>ï¼Œ<code>evaluateRelevancy()</code> ä¼šæŠ›å‡º <code>AnswerNotRelevantException</code>ï¼Œè¯¥å¼‚å¸¸å‘å¤–ä¼ æ’­è‡³ <code>askQuestion()</code>ï¼Œä»è€Œè§¦å‘é‡è¯•ã€‚</p>
<p>è‡³äº <code>AnswerNotRelevantException</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„<strong>éå—æ£€</strong>å¼‚å¸¸ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-scala" lang="scala"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AnswerNotRelevantException</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">RuntimeException</span> </span>{
    public <span class="hljs-type">AnswerNotRelevantException</span>(<span class="hljs-type">String</span> question, <span class="hljs-type">String</span> answer) {
        <span class="hljs-keyword">super</span>(<span class="hljs-string">"The answer '"</span> + answer + <span class="hljs-string">"' is not relevant to the question '"</span> + question + <span class="hljs-string">"'."</span>);
    }
}
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¸¦æœ‰ <code>@Retryable</code> çš„æ–¹æ³•ä¼š<strong>æœ€å¤šé‡è¯•ä¸‰æ¬¡</strong>ã€‚ä½ å¯ä»¥é€šè¿‡ <code>maxAttempts</code> å±æ€§è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œå°†é‡è¯•ä¸Šé™è®¾ä¸º 5 æ¬¡ï¼š</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-meta">@Retryable(<span class="hljs-params">retryFor = AnswerNotRelevantException.<span class="hljs-keyword">class</span>, maxAttempts=<span class="hljs-number">5</span></span>)</span>
</code></pre>
<p>å°½ç®¡å¯ä»¥é€šè¿‡ <code>maxAttempts</code> å¢åŠ é‡è¯•æ¬¡æ•°ï¼Œä½†è¦æ³¨æ„ï¼šæ¯æ¬¡é‡è¯•éƒ½æ„å‘³ç€å¯¹ <strong>LLM</strong> å¤šå‘é€ä¸€æ¬¡æç¤ºï¼ŒåŒæ—¶è¯„ä¼°å™¨ä¹Ÿä¼šåå¤å‘ LLM å‘é€è¯„ä¼°æç¤ºã€‚è¿™ä¼š<strong>å¢åŠ è´¹ç”¨</strong>ï¼ˆå› ä¸ºåœ¨å¾—åˆ°ç›¸å…³ç­”æ¡ˆå‰å¯èƒ½å‘é€äº†æ›´å¤š tokenï¼‰ï¼Œå¹¶ä¸”å¦‚æœåœ¨çŸ­æ—¶é—´å†…è¿ç»­å‘é€åŒæ ·çš„æç¤ºï¼Œä¹Ÿå¯èƒ½è§¦å‘<strong>é™æµ</strong>ã€‚å› æ­¤æŠŠ <code>maxAttempts</code> è®¾å¾—è¾ƒä½å¯ä»¥é¿å…è¿™äº›é—®é¢˜ã€‚</p>
<p>å¦‚æœåœ¨ä¸‰æ¬¡ï¼ˆæˆ–ä½ é€šè¿‡ <code>maxAttempts</code> æŒ‡å®šçš„æ¬¡æ•°ï¼‰å°è¯•åä»æœªç”Ÿæˆç›¸å…³ç­”æ¡ˆï¼Œæ§åˆ¶æµç¨‹ä¼šè¿›å…¥ <code>recover()</code> æ–¹æ³•ã€‚<code>recover()</code> ç”¨ <code>@Recover</code> æ³¨è§£æ ‡æ³¨ï¼Œæ˜¯ Spring Retry æä¾›çš„<strong>å…œåº•</strong>æœºåˆ¶ï¼šå½“é‡è¯•æŒç»­å¤±è´¥æ—¶è°ƒç”¨ã€‚åœ¨ <code>SelfEvaluatingBoardGameService</code> ä¸­ï¼Œ<code>recover()</code> åªæ˜¯è¿”å›ä¸€ä¸ªè¡¨ç¤º<strong>æ— æ³•å›ç­”</strong>çš„ <code>Answer</code>ã€‚</p>
<p>å…³äº Spring AI çš„è¯„ä¼°å™¨ï¼Œè¿˜æœ‰æœ€åä¸€ç‚¹ï¼šè™½ç„¶å¼€ç®±å³ç”¨çš„åªæœ‰ <code>RelevancyEvaluator</code> ä¸ <code>FactCheckingEvaluator</code>ï¼Œä½†å®ƒä»¬éƒ½æ˜¯åŸºäº Spring AI çš„å¦‚ä¸‹ <strong>Evaluator</strong> æ¥å£æ„å»ºçš„ï¼š</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> org.springframework.ai.evaluation;

<span class="hljs-keyword">import</span> java.util.List;
<span class="hljs-keyword">import</span> java.util.stream.Collectors;

<span class="hljs-keyword">import</span> org.springframework.ai.document.Document;
<span class="hljs-keyword">import</span> org.springframework.util.StringUtils;

<span class="hljs-meta">@FunctionalInterface</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Evaluator</span> {

    EvaluationResponse <span class="hljs-title function_">evaluate</span><span class="hljs-params">(EvaluationRequest evaluationRequest)</span>;

    <span class="hljs-keyword">default</span> String <span class="hljs-title function_">doGetSupportingData</span><span class="hljs-params">(EvaluationRequest evaluationRequest)</span> {
        List&lt;Document&gt; data = evaluationRequest.getDataList();
        <span class="hljs-keyword">return</span> data.stream()
            .map(Document::getText)
            .filter(StringUtils::hasText)
            .collect(Collectors.joining(System.lineSeparator()));
    }

}
</code></pre>
<p>è‹¥ <code>RelevancyEvaluator</code> æˆ– <code>FactCheckingEvaluator</code> <strong>ä¸èƒ½æ»¡è¶³</strong>ä½ çš„è¯„ä¼°éœ€æ±‚ï¼Œä½ å¯ä»¥å®ç° <code>Evaluator</code> æ¥å£<strong>è‡ªå®šä¹‰è¯„ä¼°å™¨</strong>ã€‚</p>
<h2 data-id="heading-4">å°ç»“ï¼ˆSummaryï¼‰</h2>
<ul>
<li>ç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>ä½¿æµ‹è¯•å˜å¾—æ£˜æ‰‹ã€‚</li>
<li>Spring AI æä¾›<strong>è¯„ä¼°å™¨</strong>ï¼Œå¯ç”¨äºå¯¹ç”Ÿæˆçš„å“åº”è¿›è¡Œ<strong>æ–­è¨€</strong>ã€‚</li>
<li>è¯„ä¼°å™¨é€šè¿‡å‘ LLM å‘é€æç¤ºï¼Œæ¥åˆ¤æ–­å“åº”çš„<strong>ç›¸å…³æ€§</strong>ä¸<strong>äº‹å®æ­£ç¡®æ€§</strong>ã€‚</li>
<li>è¯„ä¼°å™¨å¯åœ¨<strong>è¿è¡Œæ—¶</strong>åº”ç”¨ï¼›è‹¥è¿”å›ä¸æ»¡æ„çš„ç»“æœï¼Œå¯ä»¥<strong>é‡è¯•</strong>æç¤ºã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[çº¿ä¸Špythoné—®é¢˜æ’æŸ¥æ€è·¯]]></title>    <link>https://juejin.cn/post/7570896170920951871</link>    <guid>https://juejin.cn/post/7570896170920951871</guid>    <pubDate>2025-11-10T10:02:13.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570896170920951871" data-draft-id="7570793903848407055" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="çº¿ä¸Špythoné—®é¢˜æ’æŸ¥æ€è·¯"/> <meta itemprop="keywords" content="åç«¯,Python"/> <meta itemprop="datePublished" content="2025-11-10T10:02:13.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ²™è™«ä¸€å·"/> <meta itemprop="url" content="https://juejin.cn/user/4427059249293504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            çº¿ä¸Špythoné—®é¢˜æ’æŸ¥æ€è·¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4427059249293504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ²™è™«ä¸€å·
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:02:13.000Z" title="Mon Nov 10 2025 10:02:13 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»2åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>ä¸‹é¢æŠŠæ£€æŸ¥çº¿ç¨‹é˜»å¡å’Œæ’æŸ¥å†…å­˜å¢é•¿çš„å·¥å…·ä¸å…¸å‹ç”¨æ³•æŒ‰è¦ç‚¹åˆ—æ¸…æ¥šã€‚</p>
<h2 data-id="heading-0">çº¿ç¨‹é˜»å¡ä¸æ­»é”æ’æŸ¥</h2>
<ul>
<li>
<p>è§‚æµ‹ç‚¹ï¼šè¿›ç¨‹å“åº”å˜æ…¢æˆ–å®Œå…¨åœæ»ï¼ŒCPU/IO å¼‚å¸¸æˆ–æ—¥å¿—æ˜¾ç¤ºçº¿ç¨‹ç­‰å¾…ã€‚</p>
</li>
<li>
<p>æ—¥å¿—æ£€æŸ¥ï¼šæŠ“å–çº¿ç¨‹ç›¸å…³æ—¥å¿—ã€å¼‚å¸¸å †æ ˆã€é˜»å¡/ç­‰å¾…ä¿¡æ¯ã€‚å…ˆå®šä½æ—¶é—´çª—å£å’Œå¯ç–‘çº¿ç¨‹IDã€‚</p>
</li>
<li>
<p>gdbï¼ˆåŠ¨æ€é™„åŠ æŸ¥çœ‹çº¿ç¨‹æ ˆï¼‰</p>
</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š<code>gdb -p &lt;pid&gt;</code>ï¼Œç„¶å <code>thread apply all bt</code> æŸ¥çœ‹æ¯ä¸ªçº¿ç¨‹çš„è°ƒç”¨æ ˆï¼Œå®šä½äº’æ–¥é”/ç­‰å¾…ç‚¹ã€‚</p>
<p>å¿«é€Ÿæµç¨‹ï¼šé™„åŠ  â†’ åˆ—å‡ºçº¿ç¨‹ â†’ å¯¹å¯ç–‘çº¿ç¨‹æ‰“å° backtraceã€‚</p>
<ul>
<li>straceï¼ˆè·Ÿè¸ªç³»ç»Ÿè°ƒç”¨/é˜»å¡åœ¨ syscallï¼‰</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š<code>strace -f -p &lt;pid&gt;</code> æˆ– <code>strace -ff -o out -p &lt;pid&gt;</code>ã€‚çœ‹æ˜¯å¦åœ¨ futexã€pollã€read/write ç­‰ç³»ç»Ÿè°ƒç”¨ä¸Šé•¿æ—¶é—´é˜»å¡ã€‚</p>
<ul>
<li>ç»¼åˆç­–ç•¥ï¼šå…ˆä»æ—¥å¿—ç¼©å°æ—¶é—´æ®µå’Œçº¿ç¨‹ï¼›ç”¨ gdb çœ‹ Python å±‚è°ƒç”¨æ ˆï¼ˆè‹¥æ˜¯ C æ‰©å±•æˆ–è§£é‡Šå™¨æ­»é”ä¹Ÿèƒ½çœ‹å‡ºï¼‰ï¼›ç”¨ strace åˆ¤æ–­æ˜¯ç”¨æˆ·æ€ç­‰å¾…è¿˜æ˜¯ç³»ç»Ÿè°ƒç”¨å±‚é¢é˜»å¡ã€‚</li>
</ul>
<h2 data-id="heading-1">å†…å­˜æ³„æ¼/å†…å­˜å¢é•¿æ’æŸ¥</h2>
<ul>
<li>
<p>è§‚æµ‹ç‚¹ï¼šé•¿æœŸè¿è¡Œè¿›ç¨‹å†…å­˜å ç”¨æŒç»­ä¸Šæ¶¨ï¼ŒGC åæœªå›è½ï¼Œæˆ– OOM é¢‘ç¹ã€‚</p>
</li>
<li>
<p>ç›‘æ§ï¼š<code>top</code>/<code>ps</code>/<code>smem</code>/<code>pmap</code> å®šæœŸé‡‡æ ·è®°å½• RSS/VSZã€‚ç»“åˆåº”ç”¨æ—¥å¿—æ ‡è®°æ—¶é—´ç‚¹ã€‚</p>
</li>
<li>
<p>tracemallocï¼ˆPython æ ‡å‡†åº“ï¼Œè·Ÿè¸ªå†…å­˜åˆ†é…åœ°ç‚¹ï¼‰</p>
</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">import</span> tracemalloc

tracemalloc.start()

<span class="hljs-comment"># åœ¨å…³é”®ç‚¹å–å¿«ç…§</span>

snap1 = tracemalloc.take_snapshot()

<span class="hljs-comment"># è¿è¡Œä¸€æ®µæ—¶é—´å</span>

snap2 = tracemalloc.take_snapshot()

stats = snap2.compare_to(snap1, <span class="hljs-string">'lineno'</span>)

<span class="hljs-keyword">for</span> stat <span class="hljs-keyword">in</span> stats[:<span class="hljs-number">20</span>]:

<span class="hljs-built_in">print</span>(stat)

</code></pre>
<p>èƒ½æ‰¾å‡ºæŒ‰æ–‡ä»¶è¡Œå·åˆ†é…å¢é•¿æœ€å¤šçš„åœ°æ–¹ã€‚</p>
<ul>
<li>objgraphï¼ˆåˆ†æå¯¹è±¡å¼•ç”¨å…³ç³»ï¼‰</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">import</span> objgraph

objgraph.show_most_common_types(limit=<span class="hljs-number">20</span>)

obj = objgraph.by_type(<span class="hljs-string">'YourTypeName'</span>)[:<span class="hljs-number">10</span>]

objgraph.show_backrefs(obj, max_depth=<span class="hljs-number">10</span>, filename=<span class="hljs-string">'leak.png'</span>)

</code></pre>
<p>ç”¨æ¥å‘ç°å“ªäº›å¯¹è±¡æ•°é‡å¼‚å¸¸å’Œå®ƒä»¬çš„å¼•ç”¨è·¯å¾„ï¼ˆå¯ç”Ÿæˆå›¾ç‰‡ï¼‰ã€‚</p>
<ul>
<li>pymplerï¼ˆè¿è¡Œæ—¶å†…å­˜æ¦‚è§ˆä¸åˆ†é…è¿½è¸ªï¼‰</li>
</ul>
<p>ç”¨æ³•è¦ç‚¹ï¼š</p>
<pre><code class="hljs language-python" lang="python">
<span class="hljs-keyword">from</span> pympler <span class="hljs-keyword">import</span> muppy, summary

all_objs = muppy.get_objects()

<span class="hljs-built_in">print</span>(summary.summarize(all_objs))

</code></pre>
<p>å¯ç»“åˆ <code>asizeof</code> æˆ– <code>tracker</code> åšæ›´ç»†ç²’åº¦çš„åˆ†é…è¿½è¸ªã€‚</p>
<ul>
<li>å®æˆ˜æµç¨‹å»ºè®®ï¼šå…ˆç”¨ç³»ç»Ÿå·¥å…·ç¡®è®¤å¢é•¿æ›²çº¿ â†’ ç”¨ tracemalloc æ‰¾åˆ°çƒ­ç‚¹åˆ†é…ä½ç½® â†’ ç”¨ objgraph å¯è§†åŒ–å¼•ç”¨é“¾ç¡®è®¤æ ¹å¯¹è±¡ â†’ ç”¨ä»£ç ä¿®å¤å¹¶éªŒè¯ï¼ˆé‡å¤é‡‡æ ·å¯¹æ¯”å¿«ç…§ï¼‰ã€‚</li>
</ul>
<h2 data-id="heading-2">å¿«é€Ÿæ£€æŸ¥æ¸…å•ï¼ˆæŒ‰ä¼˜å…ˆçº§ï¼‰</h2>
<ol>
<li>
<p>é‡‡é›†æ—¥å¿—ä¸è¿›ç¨‹å†…å­˜/çº¿ç¨‹å¿«ç…§ã€‚</p>
</li>
<li>
<p>è‹¥çº¿ç¨‹ç–‘ä¼¼é˜»å¡ï¼Œå…ˆ gdb æ‰“æ ˆï¼Œå†ç”¨ strace ç¡®è®¤æ˜¯ syscall å±‚é˜»å¡ã€‚</p>
</li>
<li>
<p>è‹¥å†…å­˜å¢é•¿ï¼Œå…ˆé‡‡æ · RSSï¼Œå†ç”¨ tracemalloc å®šä½åˆ†é…æºï¼Œæœ€åç”¨ objgraph éªŒè¯å¼•ç”¨é“¾ã€‚</p>
</li>
<li>
<p>ä¿®å¤ååšå›å½’é‡‡æ ·å¯¹æ¯”å¿«ç…§ã€‚</p>
</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[ğŸ§­ ä½¿ç”¨å†å²è®°å½• API - SPAå¯¼èˆªä¸çŠ¶æ€ç®¡ç†çš„å®Œæ•´æŒ‡å—]]></title>    <link>https://juejin.cn/post/7570598043298758719</link>    <guid>https://juejin.cn/post/7570598043298758719</guid>    <pubDate>2025-11-10T10:08:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570598043298758719" data-draft-id="7570908785292951571" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="ğŸ§­ ä½¿ç”¨å†å²è®°å½• API - SPAå¯¼èˆªä¸çŠ¶æ€ç®¡ç†çš„å®Œæ•´æŒ‡å—"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript"/> <meta itemprop="datePublished" content="2025-11-10T10:08:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Bug_Constructer"/> <meta itemprop="url" content="https://juejin.cn/user/254742426830856"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            ğŸ§­ ä½¿ç”¨å†å²è®°å½• API - SPAå¯¼èˆªä¸çŠ¶æ€ç®¡ç†çš„å®Œæ•´æŒ‡å—
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/254742426830856/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Bug_Constructer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:08:35.000Z" title="Mon Nov 10 2025 10:08:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>ğŸ¯ <strong>å­¦ä¹ ç›®æ ‡</strong>ï¼šæŒæ¡ <code>pushState</code> / <code>replaceState</code> / <code>popstate</code> çš„æ ¸å¿ƒç”¨æ³•ï¼›åœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹åŒæ­¥ URL ä¸ UI çŠ¶æ€ï¼›è®¾è®¡è½»é‡ã€å¯åºåˆ—åŒ–çš„ <code>state</code> å¯¹è±¡ï¼›ä¸ºç”¨æˆ·çš„å‰è¿›/åé€€æä¾›å¯æ§çš„å¯¼èˆªä½“éªŒã€‚</p>
<p>ğŸ“Š <strong>éš¾åº¦ç­‰çº§</strong>ï¼šåˆçº§-ä¸­çº§<br/>
ğŸ·ï¸ <strong>æŠ€æœ¯æ ‡ç­¾</strong>ï¼š<code>#WebAPI</code> <code>#HistoryAPI</code> <code>#SPA</code> <code>#è·¯ç”±</code><br/>
â±ï¸ <strong>é˜…è¯»æ—¶é—´</strong>ï¼šçº¦9åˆ†é’Ÿ</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">ğŸŒŸ å¼•è¨€</h2>
<p>åœ¨æ—¥å¸¸ SPA å¼€å‘ä¸­ï¼Œä½ æ˜¯å¦é‡åˆ°è¿‡è¿™äº›å›°æ‰°ï¼š</p>
<ul>
<li>å†…å®¹æ›´æ–°å´ä¸æ”¹å˜ URLï¼Œåˆ·æ–°æˆ–åˆ†äº«åæ— æ³•åˆ°è¾¾å½“å‰è§†å›¾</li>
<li>ç”¨æˆ·ç‚¹å‡»åé€€/å‰è¿›å¯¼è‡´çŠ¶æ€ä¸¢å¤±ï¼Œä½“éªŒä¸ä¸€è‡´</li>
<li>é¡µé¢åˆ·æ–°åæ— æ³•æ¢å¤è§†å›¾ä¸æ•°æ®ï¼Œéœ€é‡æ–°æ“ä½œ</li>
<li>è·¯ç”±å®ç°å¤æ‚ï¼ŒçŠ¶æ€å¯¹è±¡éš¾ä»¥ç»´æŠ¤ä¸åºåˆ—åŒ–</li>
</ul>
<p>è¿™ç¯‡æ–‡ç« å›´ç»• History APIï¼Œè®²é€å¦‚ä½•æ— åˆ·æ–°åœ°åŒæ­¥ URL ä¸çŠ¶æ€ï¼Œå¹¶æä¾›ç»æµ‹è¯•çš„æœ€ä½³å®è·µã€‚</p>
<hr/>
<h2 data-id="heading-1">ğŸ’¡ æ ¸å¿ƒæŠ€å·§è¯¦è§£</h2>
<h3 data-id="heading-2">1. æ— åˆ·æ–°å¯¼èˆªå°è£…ï¼šURL ä¸ UI åŒæ­¥</h3>
<h4 data-id="heading-3">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>èœå•åˆ‡æ¢ã€åˆ†é¡µ/ç­›é€‰ã€å¯åˆ†äº«çš„è§†å›¾å®šä½ã€‚</p>
<h4 data-id="heading-4">âŒ å¸¸è§é—®é¢˜</h4>
<p>åªæ›´æ–°å†…å®¹ä¸æ›´æ–° URLï¼›æœªæ ¡éªŒåŒæºå¯¼è‡´é”™è¯¯å¯¼èˆªã€‚</p>
<h4 data-id="heading-5">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ç»Ÿä¸€å°è£…å¯¼èˆªå‡½æ•°ï¼Œé›†ä¸­å¤„ç† <code>pushState</code> ä¸æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ä½¿ç”¨ History API è¿›è¡Œæ— åˆ·æ–°å¯¼èˆª
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">url</span> - ç›®æ ‡åŒæº URLï¼ˆå¯åŒ…å«æŸ¥è¯¢å‚æ•°ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{view:string, params?:Record&lt;string,string&gt;, scrollY?:number</span>}} state - è½»é‡é¡µé¢çŠ¶æ€
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">navigate</span> = (<span class="hljs-params">url, state</span>) =&gt; {
  <span class="hljs-keyword">const</span> target = <span class="hljs-keyword">new</span> <span class="hljs-title function_">URL</span>(url, <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span>);
  <span class="hljs-keyword">if</span> (target.<span class="hljs-property">origin</span> !== <span class="hljs-variable language_">window</span>.<span class="hljs-property">location</span>.<span class="hljs-property">origin</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// åŒæºæ ¡éªŒ</span>
  history.<span class="hljs-title function_">pushState</span>(state ?? {}, <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span>, target.<span class="hljs-property">href</span>);
  <span class="hljs-title function_">renderFromState</span>(state ?? {});
};

<span class="hljs-comment">/**
 * æ ¹æ® state æ¸²æŸ“é¡µé¢ï¼ˆè§†å›¾ä¸å‚æ•°ï¼‰
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">{view?:string, params?:Record&lt;string,string&gt;, scrollY?:number</span>}} state
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">renderFromState</span> = (<span class="hljs-params">state = {}</span>) =&gt; {
  <span class="hljs-keyword">const</span> view = state.<span class="hljs-property">view</span> || <span class="hljs-string">'home'</span>;
  <span class="hljs-keyword">const</span> params = state.<span class="hljs-property">params</span> || {};
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#app'</span>).<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">'data-view'</span>, view);
  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">'#params'</span>).<span class="hljs-property">textContent</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(params);
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">scrollTo</span>({ <span class="hljs-attr">top</span>: state.<span class="hljs-property">scrollY</span> ?? <span class="hljs-number">0</span>, <span class="hljs-attr">behavior</span>: <span class="hljs-string">'instant'</span> });
};
</code></pre>
<h4 data-id="heading-6">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>pushState</code> ä¸è§¦å‘ <code>popstate</code>ï¼Œéœ€ä¸»åŠ¨æ¸²æŸ“å½“å‰è§†å›¾</li>
<li>åŒæºæ ¡éªŒé¿å…è·¨æºå¯¼èˆªé”™è¯¯</li>
<li>ä»…ä¿å­˜å¿…è¦å‚æ•°ï¼Œä¿æŒçŠ¶æ€è½»é‡å¯åºåˆ—åŒ–</li>
</ul>
<h4 data-id="heading-7">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>åœ¨å¯¼èˆªç‚¹å‡»äº‹ä»¶ä¸­è°ƒç”¨ <code>navigate</code>ï¼Œå®ç°æ— åˆ·æ–°è·¯ç”±ä¸çŠ¶æ€åŒæ­¥ã€‚</p>
<hr/>
<h3 data-id="heading-8">2. åˆå§‹åŒ–é¦–æ¡å†å²è®°å½•ï¼šé¿å…å›é€€ä¸¢å¤±</h3>
<h4 data-id="heading-9">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>åº”ç”¨å¯åŠ¨ã€ç›´è¾¾é“¾æ¥ã€é¦–æ¬¡åŠ è½½æŸ¥è¯¢å‚æ•°ã€‚</p>
<h4 data-id="heading-10">âŒ å¸¸è§é—®é¢˜</h4>
<p>æœªè®¾ç½®åˆå§‹æ¡ç›®ï¼Œå›é€€åæ— æ³•æ­£ç¡®æ¢å¤è§†å›¾ã€‚</p>
<h4 data-id="heading-11">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ç”¨ <code>replaceState</code> å†™å…¥é¦–æ¡å†å²è®°å½•å¹¶æ¸²æŸ“ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç”¨ replaceState åˆå§‹åŒ–é¦–æ¡å†å²è®°å½•
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">initHistoryState</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-keyword">const</span> state = {
    <span class="hljs-attr">view</span>: <span class="hljs-string">'home'</span>,
    <span class="hljs-attr">params</span>: <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">fromEntries</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">URLSearchParams</span>(location.<span class="hljs-property">search</span>)),
    <span class="hljs-attr">scrollY</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>
  };
  history.<span class="hljs-title function_">replaceState</span>(state, <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span>, location.<span class="hljs-property">href</span>);
  <span class="hljs-title function_">renderFromState</span>(state);
};
</code></pre>
<h4 data-id="heading-12">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>replaceState</code> æ›¿æ¢å½“å‰æ¡ç›®ï¼Œé¿å…ç”Ÿæˆå¤šä½™å†å²è®°å½•</li>
<li>åˆå§‹æ¸²æŸ“ä» URL æŸ¥è¯¢å‚æ•°æ¨å¯¼çŠ¶æ€</li>
</ul>
<h4 data-id="heading-13">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>åº”ç”¨å…¥å£å¤„è°ƒç”¨ <code>initHistoryState</code>ï¼Œä¿éšœåé€€/å‰è¿›è¡Œä¸ºä¸€è‡´ã€‚</p>
<hr/>
<h3 data-id="heading-14">3. ç›‘å¬ popstateï¼šæµè§ˆå™¨å¯¼èˆªçŠ¶æ€æ¢å¤</h3>
<h4 data-id="heading-15">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>ç”¨æˆ·ä½¿ç”¨æµè§ˆå™¨åé€€/å‰è¿›æˆ– <code>history.go()</code>ã€‚</p>
<h4 data-id="heading-16">âŒ å¸¸è§é—®é¢˜</h4>
<p>æœªç›‘å¬ <code>popstate</code> å¯¼è‡´çŠ¶æ€æ— æ³•æ¢å¤ï¼Œé¡µé¢é—ªçƒæˆ–é‡è½½ã€‚</p>
<h4 data-id="heading-17">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ç»‘å®š <code>popstate</code>ï¼Œæ ¹æ®å†å²æ¡ç›®æ¢å¤ UIã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç»‘å®š popstate äº‹ä»¶ä»¥æ¢å¤ UI
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">void</span>}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">bindPopState</span> = (<span class="hljs-params"/>) =&gt; {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'popstate'</span>, <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> state = e.<span class="hljs-property">state</span> || {};
    <span class="hljs-title function_">renderFromState</span>(state);
  });
};
</code></pre>
<h4 data-id="heading-18">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li><code>popstate</code> ä»…åœ¨ç”¨æˆ·å¯¼èˆªæˆ– <code>history.go()</code> æ—¶è§¦å‘</li>
<li>å†å²æ¡ç›®ä¸­çš„ <code>state</code> åº”è¶³ä»¥æ¨å¯¼å¹¶æ¸²æŸ“ UI</li>
</ul>
<h4 data-id="heading-19">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>åº”ç”¨å¯åŠ¨åç«‹å³ç»‘å®šï¼Œä¿è¯å¯¼èˆªä¸€è‡´æ€§ã€‚</p>
<hr/>
<h3 data-id="heading-20">4. è½»é‡çŠ¶æ€å¯¹è±¡ï¼šå¯åºåˆ—åŒ–ä¸”å¯æ¨å¯¼ UI</h3>
<h4 data-id="heading-21">ğŸ” åº”ç”¨åœºæ™¯</h4>
<p>åˆ†é¡µã€ç­›é€‰ã€è¯¦æƒ…è§†å›¾å®šä½ã€‚</p>
<h4 data-id="heading-22">âŒ å¸¸è§é—®é¢˜</h4>
<p>çŠ¶æ€è¿‡åº¦å¤æ‚ï¼Œæ— æ³•åºåˆ—åŒ–æˆ–è·¨ä¼šè¯æ¢å¤ã€‚</p>
<h4 data-id="heading-23">âœ… æ¨èæ–¹æ¡ˆ</h4>
<p>ä»…ä¿å­˜è§†å›¾æ ‡è¯†ã€æŸ¥è¯¢å‚æ•°ä¸æ»šåŠ¨ä½ç½®ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/**
 * ç”Ÿæˆå¯åºåˆ—åŒ–çš„è½»é‡çŠ¶æ€å¯¹è±¡
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">string</span>} <span class="hljs-variable">view</span> - è§†å›¾æ ‡è¯†
 * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Record&lt;string,string&gt;</span>} <span class="hljs-variable">params</span> - æŸ¥è¯¢å‚æ•°
 * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">{view:string, params:Record&lt;string,string&gt;, scrollY:number</span>}}
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">makeState</span> = (<span class="hljs-params">view, params = {}</span>) =&gt; ({
  view,
  params,
  <span class="hljs-attr">scrollY</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">scrollY</span>
});
</code></pre>
<h4 data-id="heading-24">ğŸ’¡ æ ¸å¿ƒè¦ç‚¹</h4>
<ul>
<li>å¤æ‚å¯¹è±¡è½¬ ID æˆ–å¯é‡å»ºçš„å¼•ç”¨</li>
<li>ä¿æŒçŠ¶æ€å°è€Œæ¸…æ™°ï¼Œæå‡å…¼å®¹ä¸ç»´æŠ¤æ€§</li>
</ul>
<h4 data-id="heading-25">ğŸ¯ å®é™…åº”ç”¨</h4>
<p>ä¸è·¯ç”±æœåŠ¡ç»“åˆï¼Œç»Ÿä¸€ç”Ÿæˆå¹¶æŒä¹…åŒ–è½»é‡ <code>state</code>ã€‚</p>
<hr/>
<h2 data-id="heading-26">ğŸ“Š æŠ€å·§å¯¹æ¯”æ€»ç»“</h2>



































<table><thead><tr><th>æŠ€å·§</th><th>ä½¿ç”¨åœºæ™¯</th><th>ä¼˜åŠ¿</th><th>æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td>æ— åˆ·æ–°å¯¼èˆªå°è£…</td><td>èœå•åˆ‡æ¢ã€åˆ†é¡µ/ç­›é€‰</td><td>URL ä¸ UI åŒæ­¥ã€æ— åˆ·æ–°</td><td>åŒæºæ ¡éªŒã€è½»é‡çŠ¶æ€</td></tr><tr><td>åˆå§‹åŒ–é¦–æ¡è®°å½•</td><td>åº”ç”¨å¯åŠ¨ã€ç›´è¾¾é“¾æ¥</td><td>å›é€€è¡Œä¸ºä¸€è‡´ã€å¯æ¢å¤</td><td>ä½¿ç”¨ replaceState</td></tr><tr><td>ç›‘å¬ popstate</td><td>åé€€/å‰è¿›å¯¼èˆª</td><td>çŠ¶æ€æ¢å¤ã€ä½“éªŒä¸€è‡´</td><td>ä»…ç”¨æˆ·å¯¼èˆªè§¦å‘</td></tr><tr><td>è½»é‡çŠ¶æ€å¯¹è±¡</td><td>åˆ†é¡µã€ç­›é€‰ã€è¯¦æƒ…</td><td>å¯åºåˆ—åŒ–ã€å¯æ¨å¯¼ UI</td><td>å¤æ‚å¯¹è±¡è½¬ ID</td></tr></tbody></table>
<hr/>
<h2 data-id="heading-27">ğŸ¯ å®æˆ˜åº”ç”¨å»ºè®®</h2>
<h3 data-id="heading-28">æœ€ä½³å®è·µ</h3>
<ol>
<li>å°†å¯¼èˆªå°è£…ä¸ºæœåŠ¡æ¨¡å—ï¼Œç»Ÿä¸€åŒæºæ ¡éªŒä¸çŠ¶æ€æ„å»º</li>
<li>åˆ†äº«/æ”¶è—çš„åœºæ™¯æ›´æ–° URLï¼›å†…éƒ¨å¾®è°ƒå¯ä¸äº§ç”Ÿå†å²æ¡ç›®</li>
<li>å°†åˆ†é¡µ/ç­›é€‰å†™å…¥æŸ¥è¯¢ä¸²ï¼Œä¾¿äºç›´è¾¾åŒä¸€è§†å›¾</li>
<li>ç»“åˆæ»šåŠ¨ä½ç½®ä¸ç„¦ç‚¹ç®¡ç†ï¼Œæå‡è¿”å›ä½“éªŒè¿è´¯æ€§</li>
</ol>
<h3 data-id="heading-29">æ€§èƒ½è€ƒè™‘</h3>
<ul>
<li>é¿å…åœ¨ <code>popstate</code> ä¸­åšé‡è®¡ç®—ï¼Œä¼˜å…ˆä½¿ç”¨å·²ä¿å­˜çš„è½»é‡çŠ¶æ€</li>
<li>æ ¡éªŒ URL åŒæºåå†æ„å»ºçŠ¶æ€ï¼Œå‡å°‘å¼‚å¸¸ä¸é‡æ¸²æŸ“</li>
<li>å¿…è¦æ—¶æä¾› Hash é™çº§å…¼å®¹æ—§ç¯å¢ƒæˆ–è·¨æºè·¯å¾„</li>
</ul>
<hr/>
<h2 data-id="heading-30">ğŸ’¡ æ€»ç»“</h2>
<p>è¿™ 4 ä¸ª History API æŠ€å·§èƒ½è®© SPA åœ¨ä¸åˆ·æ–°é¡µé¢çš„å‰æä¸‹å®ç°â€œå¯å¯¼èˆªã€å¯æ¢å¤ã€å¯åˆ†äº«â€çš„èƒ½åŠ›ï¼š</p>
<ol>
<li>æ— åˆ·æ–°å¯¼èˆªå°è£…ï¼šç»Ÿä¸€ <code>pushState</code> ä¸æ¸²æŸ“</li>
<li>åˆå§‹åŒ–é¦–æ¡å†å²è®°å½•ï¼šç”¨ <code>replaceState</code> ä¿è¯å›é€€ä¸€è‡´</li>
<li>ç›‘å¬ <code>popstate</code>ï¼šç”¨æˆ·å¯¼èˆªæ—¶æ¢å¤ UI</li>
<li>è½»é‡çŠ¶æ€å¯¹è±¡ï¼šä»…ä¿å­˜å¿…è¦ä¿¡æ¯ï¼Œä¿æŒå¯åºåˆ—åŒ–ä¸å¯ç»´æŠ¤</li>
</ol>
<p>å¸Œæœ›è¿™äº›æŠ€å·§èƒ½å¸®åŠ©ä½ åœ¨ SPA è·¯ç”±ä¸çŠ¶æ€ç®¡ç†ä¸­å†™å‡ºæ›´ä¼˜é›…çš„ä»£ç ï¼</p>
<hr/>
<h2 data-id="heading-31">ğŸ”— ç›¸å…³èµ„æº</h2>
<ul>
<li>MDNï¼ˆä¸­æ–‡ï¼‰ï¼šWorking with the History API<br/>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FHistory_API%2FWorking_with_the_History_API" target="_blank" title="https://developer.mozilla.org/zh-CN/docs/Web/API/History_API/Working_with_the_History_API" ref="nofollow noopener noreferrer">developer.mozilla.org/zh-CN/docs/â€¦</a></li>
</ul>
<hr/>
<blockquote>
<p>ğŸ’¡ <strong>ä»Šæ—¥æ”¶è·</strong>ï¼šæŒæ¡äº†History APIçš„å¤šä¸ªæ ¸å¿ƒæŠ€å·§ï¼Œè¿™äº›çŸ¥è¯†ç‚¹åœ¨å®é™…å¼€å‘ä¸­éå¸¸å®ç”¨ã€‚</p>
</blockquote>
<p><strong>å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹èµã€æ”¶è—å’Œåˆ†äº«ï¼æœ‰ä»»ä½•é—®é¢˜ä¹Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚</strong> ğŸš€</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼šä»æ”¯ä»˜åŸºç¡€è®¾æ–½åˆ° ACP åè®®ï¼Œæ‹†è§£ Stripe å¦‚ä½•æ­å»ºAIæ™ºèƒ½ä½“ç»æµçš„å•†ä¸šæ ‡å‡†ï¼Ÿ]]></title>    <link>https://juejin.cn/post/7570793903848521743</link>    <guid>https://juejin.cn/post/7570793903848521743</guid>    <pubDate>2025-11-10T10:02:36.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570793903848521743" data-draft-id="7570901172526956579" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼šä»æ”¯ä»˜åŸºç¡€è®¾æ–½åˆ° ACP åè®®ï¼Œæ‹†è§£ Stripe å¦‚ä½•æ­å»ºAIæ™ºèƒ½ä½“ç»æµçš„å•†ä¸šæ ‡å‡†ï¼Ÿ"/> <meta itemprop="keywords" content="äº§å“ç»ç†"/> <meta itemprop="datePublished" content="2025-11-10T10:02:36.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="è«å°”ç´¢"/> <meta itemprop="url" content="https://juejin.cn/user/518625218016504"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼šä»æ”¯ä»˜åŸºç¡€è®¾æ–½åˆ° ACP åè®®ï¼Œæ‹†è§£ Stripe å¦‚ä½•æ­å»ºAIæ™ºèƒ½ä½“ç»æµçš„å•†ä¸šæ ‡å‡†ï¼Ÿ
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/518625218016504/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    è«å°”ç´¢
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:02:36.000Z" title="Mon Nov 10 2025 10:02:36 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»7åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>åœ¨è¿™æœŸæ’­å®¢ä¸­ï¼ŒStripeï¼ˆå‡ ä¹æ‰€æœ‰å‡ºæµ·äº§å“éƒ½åœ¨ç”¨çš„å…¨çƒæ€§æ”¯ä»˜å¹³å°ï¼‰çš„æ•°æ®ä¸ AI è´Ÿè´£äºº Emily æ·±å…¥æ¢è®¨äº† AI å¦‚ä½•ä»æ ¹æœ¬ä¸Šé‡å¡‘ç»æµåŸºç¡€è®¾æ–½ã€‚AI ä¸ä»…åœ¨åˆ›é€ æ–°çš„å•†ä¸šæ¨¡å¼ï¼ˆå¦‚ Agent æœåŠ¡å•†ï¼‰ï¼Œä¹Ÿå¸¦æ¥å…¨æ–°çš„ç»æµæŒ‘æˆ˜ï¼Œç‰¹åˆ«æ˜¯é«˜æ˜‚çš„è¾¹é™…æˆæœ¬å’Œæ–°å‹æ¬ºè¯ˆã€‚Stripe æ­£åœ¨é€šè¿‡æ‰©å±•å…¶åæ¬ºè¯ˆç³»ç»Ÿ (Radar)ã€<strong>æ¨å‡º Token Billingï¼ˆæŒ‰æ¨ç†æ—¶ token è®¡è´¹ï¼‰</strong> ç­‰åˆ›æ–°æ”¯ä»˜å·¥å…·ï¼Œä»¥åŠä¸ OpenAI è”åˆå‘å¸ƒ <strong>ACP (Agentic Commerce Protocolï¼Œä»£ç†å¼ç”µå•†åè®®)</strong> æ¥åº”å¯¹è¿™äº›æŒ‘æˆ˜ï¼Œæ—¨åœ¨ä¸ºå³å°†åˆ°æ¥çš„ AI Agent ç»æµå»ºç«‹ä¸€ä¸ªå¼€æ”¾ã€é«˜æ•ˆä¸”å®‰å…¨çš„å•†ä¸šæ ‡å‡†ã€‚</p>
</blockquote>
<p>æ¬¢è¿è®¢é˜…åˆé›† <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4221297752417992707%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FX1JwNWhO9tjVQfh9Qq9uJw%26nolastread%3D1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4221297752417992707&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX1JwNWhO9tjVQfh9Qq9uJw&amp;nolastread=1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AI æ’­å®¢æ•æ‰‹</a>ï¼šä¸“é—¨é¢å‘æ–‡å­—å†…å®¹çˆ±å¥½è€…åˆ†äº« AI é¢†åŸŸä¼˜è´¨æ’­å®¢ï¼Œå…¶ä»–åˆé›†ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243230891033935893%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FZcMiAmfNkmYLDgAu0rlb1Q%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243230891033935893&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZcMiAmfNkmYLDgAu0rlb1Q&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI å†·æ€è€ƒ</a>ï¼šä¸ªäººåœ¨ AI ç‹‚æ¬¢ä¸‹çš„å†·æ€è€ƒï¼Œèšç„¦ AI å·¥ç¨‹åŒ–ã€Agent Infra äº§å“ã€æ•ˆç‡å‹ AI å·¥å…·å’Œäººæœºåä½œè¯é¢˜ï¼Œå¯»æ‰¾å¯æŒç»­çš„äº§ä¸šä»·å€¼ã€‚</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243205243418624006%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252F0Tdan3R8juUlj-Lh-QMmew%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243205243418624006&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Tdan3R8juUlj-Lh-QMmew&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI åšå®¢ç²¾é€‰</a>ï¼šç²¾å¿ƒç¼–è¯‘æµ·å¤–æŠ€æœ¯å‚å•†å‘å¸ƒçš„é«˜è´¨é‡ AI é¢†åŸŸåšå®¢æ–‡ç« ã€‚</li>
</ul>
<h2 data-id="heading-0">ç›®å½•</h2>
<ul>
<li>Stripe çš„ AI æ¼”è¿›ï¼šä»åæ¬ºè¯ˆåˆ°æ”¯ä»˜åŸºç¡€æ¨¡å‹</li>
<li>AI æ—¶ä»£çš„ç»æµæŒ‘æˆ˜ï¼šé«˜æ˜‚çš„è¾¹é™…æˆæœ¬ä¸æ–°å‹æ¬ºè¯ˆ</li>
<li>ä¸º AI ç»æµæ„å»ºåŸºç¡€è®¾æ–½ï¼šä» Radar æ‰©å±•åˆ°æ”¯ä»˜åˆ›æ–°</li>
<li>ACPï¼šå®šä¹‰ AI Agent çš„å•†ä¸šæœªæ¥</li>
<li>AI ç»æµåˆ†æï¼šæ³¡æ²«è¿˜æ˜¯ç¹è£ï¼Ÿ</li>
<li>ä¸ªäººæ€è€ƒ</li>
</ul>
<h2 data-id="heading-1">Stripe çš„ AI æ¼”è¿›ï¼šä»åæ¬ºè¯ˆåˆ°æ”¯ä»˜åŸºç¡€æ¨¡å‹</h2>
<p>Stripe çš„ä½¿å‘½æ˜¯æ„å»ºäº’è”ç½‘çš„é‡‘èåŸºç¡€è®¾æ–½ï¼Œä½œä¸ºæ•°æ®ä¸ AI è´Ÿè´£äººï¼ŒEmily çš„èŒè´£æ˜¯å¸®åŠ© Stripe æœ‰æ•ˆåˆ©ç”¨å…¶åºå¤§çš„æ•°æ®â€”â€”æ¯å¹´å¤„ç†çº¦ 1.4 ä¸‡äº¿ç¾å…ƒï¼ˆå å…¨çƒ GDP çº¦ 1.3%ï¼‰çš„äº¤æ˜“é‡ï¼Œè¿™äº›æ•°æ®ä¸ä»…ç”¨äºç†è§£ç»æµåŠ¨æ€ï¼Œæ›´è¢«åé¦ˆåˆ°äº§å“ä¸­ï¼Œä»¥ä¼˜åŒ–æ”¯ä»˜ä½“éªŒã€å‡å°‘æ¬ºè¯ˆã€æé«˜æˆæƒç‡ã€‚</p>
<p>Emily é¢†å¯¼çš„ç»„ç»‡æ¶µç›–äº†ä»æ•°æ®å¹³å°ã€æœºå™¨å­¦ä¹ åŸºç¡€è®¾æ–½åˆ°åº”ç”¨å±‚çš„æ•´ä¸ªæŠ€æœ¯æ ˆã€‚å…¶ä¸­ä¸€ä¸ªç‰¹è‰²æ˜¯å®éªŒé¡¹ç›®å›¢é˜Ÿï¼Œè¿™ä¸ªå°è€Œç²¾çš„å›¢é˜Ÿä¸“æ³¨äºæ¢ç´¢é‚£äº›è·¨è¶Šå•ä¸€äº§å“çº¿çš„ã€ç”±ç”¨æˆ·éœ€æ±‚æ‹‰åŠ¨çš„ä» 0 åˆ° 1 çš„æœºä¼šï¼Œè¿‘æœŸçš„ ACP å’Œ Token Billing é¡¹ç›®å‡æºäºæ­¤å›¢é˜Ÿã€‚ï¼ˆç¼–æ³¨ï¼šè¿™ä¸ªå°å›¢é˜Ÿçº¦ 20 å¤šäººï¼Œç”±æ•°æ®éƒ¨é—¨ä¸»å¯¼ï¼Œå…·å¤‡è·¨éƒ¨é—¨çš„æ•°æ®è·å–æƒé™ï¼Œé«˜æ•ˆæŒ–æ˜ä¸šåŠ¡æ•°æ®ä»·å€¼ï¼Œå°† AI æ·±åº¦èå…¥åˆ°ä¼ä¸šä¸šåŠ¡æ¨¡å¼å’Œå·¥ä½œæµç¨‹ä¸­ï¼Œå¤§ä¼ä¸šè¯•éªŒæ€§æ¢ç´¢ AI åŸç”Ÿç»„ç»‡æ¨¡å¼çš„æœ‰æ•ˆæ€è·¯ï¼‰</p>
<p>è°ˆåˆ° AI åœ¨ Stripe çš„æ¼”è¿›ï¼ŒEmily æŒ‡å‡ºï¼ŒStripe ä½¿ç”¨ ML çš„å†å²å·²è¶…è¿‡åå¹´ï¼Œè¿œæ—©äºå½“ä¸‹çš„ AI æµªæ½®ã€‚æœ€åˆï¼ŒML è¢«ç”¨äºæ ¸å¿ƒäº§å“ Radarï¼ˆStripe çš„æ¬ºè¯ˆæ£€æµ‹ç³»ç»Ÿï¼‰ä»¥åŠå†…éƒ¨è¿è¥ã€‚Stripe æ¯å¤©éœ€è¦å®¡æ ¸æ•°åƒåæ–°ç”¨æˆ·ï¼Œç¡®ä¿ä»–ä»¬çš„å¯æ”¯æŒæ€§ã€ä¿¡ç”¨ä»·å€¼å’Œéæ¬ºè¯ˆæ€§ï¼Œè¿™ä»ä¸€å¼€å§‹å°±ç¦»ä¸å¼€ MLã€‚</p>
<p>çœŸæ­£çš„è½¬å˜å‘ç”Ÿåœ¨ GPT-3.5 å‡ºç°æ—¶ï¼ŒStripe æ„è¯†åˆ°éœ€è¦ä¸ºæ‰€æœ‰äººæä¾›é«˜è´¨é‡ã€å®‰å…¨ã€æ˜“ç”¨çš„ LLM è®¿é—®æƒé™ï¼Œä¸ä»…æ˜¯ä¸ºæ—¥å¸¸å·¥ä½œï¼Œæ›´æ˜¯ä¸ºäº†æ„å»ºç”Ÿäº§çº§çš„ AI ä½“éªŒã€‚åœ¨è¿‡å»ä¸€å¹´åŠä¸­ï¼ŒStripe çš„ç­–ç•¥ä»<strong>ä½¿ç”¨å¤šä¸ªå•ä»»åŠ¡ã€ç‚¹è§£å†³æ–¹æ¡ˆçš„ ML æ¨¡å‹ï¼Œè½¬å‘æ„å»ºè‡ªå·±ç‰¹å®šé¢†åŸŸçš„æ”¯ä»˜åŸºç¡€æ¨¡å‹ (Foundation Model, FM)</strong> ã€‚</p>
<p>è¿™ä¸ªåŸºç¡€æ¨¡å‹åœ¨ Stripe çš„æ”¯ä»˜å¤„ç†ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œæ¯åˆ†é’Ÿå¤„ç†é«˜è¾¾ 50,000 ç¬”äº¤æ˜“ï¼Œå¹¶ä¸”æ¯ä¸€ç¬”äº¤æ˜“éƒ½ä¼šæµç»è¿™ä¸ª FM è¿›è¡Œå®æ—¶è¯„ä¼°ï¼Œå»¶è¿Ÿå¿…é¡»æ§åˆ¶åœ¨ 100 æ¯«ç§’ä»¥å†…ã€‚FM çš„å¼ºå¤§ä¹‹å¤„åœ¨äºå®ƒèƒ½å¤„ç†æ‰€æœ‰äº‹æƒ…â€”â€”å®ƒè¢«è¾“å…¥äº†æ•°ç™¾äº¿ç¬”äº¤æ˜“çš„å…¨éƒ¨ç»†èŠ‚ï¼Œè€Œä¸åƒä¼ ç»Ÿ ML æ¨¡å‹é‚£æ ·ä¾èµ–äººç±»å·¥ç¨‹å¸ˆçš„æ‰‹å·¥ç‰¹å¾å·¥ç¨‹ã€‚</p>
<p>æ›´å…³é”®çš„æ˜¯ï¼Œ<strong>FM å¼•å…¥äº†åºåˆ—çš„æ¦‚å¿µï¼Œå°†æ”¯ä»˜æ•°æ®ç±»æ¯”ä¸ºè¯­è¨€æ•°æ®ã€‚ä¸€ä¸ªæ”¯ä»˜è¡Œä¸ºå°±åƒä¸€ä¸ªè¯ï¼Œå…¶æ„ä¹‰å–å†³äºä¸Šä¸‹æ–‡ï¼ˆå³å‘¨å›´çš„è¯ï¼‰ã€‚FM èƒ½å¤Ÿæ•æ‰åˆ°å¤æ‚çš„åºåˆ—æ¨¡å¼ï¼Œä¾‹å¦‚æŸä¸ª IP åœ¨æŸä¸ªç‰¹å®šæ—¶é—´ã€ä½¿ç”¨æŸç§å¡åœ¨ç‰¹å®šå•†å®¶è¿›è¡Œäº¤æ˜“ã€‚</strong> è¿™å¥½æ¯”è§‚çœ‹ä¸€éƒ¨ç”µå½±ï¼ŒFM èƒ½å¤Ÿè¯†åˆ«å‡ºå“ªäº›åœºæ™¯ç»„åˆèµ·æ¥æ„æˆäº†å¼‚å¸¸ã€‚</p>
<p>è¿™ç§èƒ½åŠ›åœ¨ç›—åˆ·æµ‹è¯•ç›‘æµ‹ä¸Šå–å¾—äº†æ˜¾è‘—æˆæœã€‚ä¼ ç»Ÿçš„ç›—åˆ·è€…ä¼šéšè—åœ¨å¤§å‹ç”µå•†çš„å·¨å¤§æµé‡ä¸­ï¼Œè¿›è¡Œå¤§é‡ 1 ç¾åˆ†ã€2 ç¾åˆ†çš„å°é¢æµ‹è¯•ã€‚ä¼ ç»Ÿ ML å¾ˆéš¾æ•æ‰åˆ°è¿™ç§æ’’èƒ¡æ¤’é¢å¼çš„æ”»å‡»ã€‚è€Œ FM é€šè¿‡åˆ†æåµŒå…¥å‘é‡ï¼Œèƒ½å®æ—¶å‘ç°è¿™äº›å¼‚å¸¸ç°‡ï¼Œå¹¶å°†å¤§å‹ç”¨æˆ·çš„ç›—åˆ·æ£€æµ‹ç‡ä» 59% æå‡åˆ°äº† 97%ã€‚</p>
<p>FM çš„å¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯å¿«é€Ÿé€‚åº”æ€§ã€‚ä¸€äº› AI å…¬å¸å‘ Stripe åæ˜ ï¼Œä»–ä»¬é¢ä¸´å¤§é‡å¯ç–‘äº¤æ˜“ï¼Œè¿™äº›äº¤æ˜“è™½ç„¶æœ€ç»ˆæ²¡æœ‰å¯¼è‡´æ¬ºè¯ˆæ€§äº‰è®®ï¼ˆå•†å®¶èƒ½æ”¶åˆ°é’±ï¼‰ï¼Œä½†å®ƒä»¬æ¥è‡ªæœºå™¨äººï¼Œä¼šå¹²æ‰°æ•°æ®ï¼Œå±äºä¸è‰¯æµé‡ã€‚Stripe åˆ©ç”¨ FM å¿«é€Ÿè¯†åˆ«å¹¶èšç±»äº†è¿™äº›æ–°å‹å¯ç–‘è¡Œä¸ºï¼ˆä¾‹å¦‚ï¼Œæšä¸¾ç™»å½•æµç¨‹ä¸­çš„æŸäº›ç»„ä»¶ï¼‰ï¼Œå¹¶åœ¨å‡ å¤©å†…å°±ä¸º AI å…¬å¸æä¾›äº†æ ‡è®°è¿™äº›æµé‡çš„èƒ½åŠ›ï¼Œå…è®¸å®ƒä»¬è‡ªè¡Œå†³å®šæ˜¯å¦é˜»æ­¢è¿™äº›äº¤æ˜“ã€‚</p>
<h2 data-id="heading-2">AI æ—¶ä»£çš„ç»æµæŒ‘æˆ˜ï¼šé«˜æ˜‚çš„è¾¹é™…æˆæœ¬ä¸æ–°å‹æ¬ºè¯ˆ</h2>
<p>åœ¨ AI æ—¶ä»£ï¼Œæ¬ºè¯ˆçš„å½¢æ€å‘ç”Ÿäº†æ ¹æœ¬æ€§çš„å˜åŒ–ã€‚Emily æŒ‡å‡ºï¼Œä¸€ç§è¢«ç§°ä¸ºå‹å¥½æ¬ºè¯ˆçš„é—®é¢˜æ­£å˜å¾—å°¤ä¸ºçªå‡ºã€‚è¿™å¹¶éæŒ‡ç›—ç”¨ä»–äººä¿¡ç”¨å¡ï¼Œè€Œæ˜¯ç”¨æˆ·ä½¿ç”¨è‡ªå·±çš„å‡­è¯è¿›è¡Œâ€œéæ”¯ä»˜æ»¥ç”¨â€ï¼Œä¾‹å¦‚å…è´¹è¯•ç”¨æ»¥ç”¨ ã€é€€æ¬¾æ»¥ç”¨æˆ–â€œå…ˆç”¨åä¸ä»˜â€ã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„ SaaS æ—¶ä»£ï¼Œè¿™ä¸ªé—®é¢˜å¹¶ä¸è‡´å‘½ã€‚å› ä¸º SaaS äº§å“çš„è¾¹é™…æˆæœ¬å‡ ä¹ä¸ºé›¶ã€‚å³ä½¿ç”¨æˆ·æ»¥ç”¨äº†å…è´¹è¯•ç”¨ï¼ŒSaaS å…¬å¸æŸå¤±çš„ä¹Ÿåªæ˜¯æ½œåœ¨çš„æ”¶å…¥ï¼Œè€Œæ²¡æœ‰äº§ç”Ÿå®é™…çš„ã€é«˜æ˜‚çš„äº¤ä»˜æˆæœ¬ã€‚</p>
<p>åœ¨ AI æ—¶ä»£ï¼Œæƒ…å†µå®Œå…¨ä¸åŒã€‚GPU éå¸¸æ˜‚è´µï¼Œæ¨ç†æˆæœ¬å¾ˆé«˜ã€‚å½“ä¸€ä¸ªç”¨æˆ·æ»¥ç”¨ AI äº§å“çš„å…è´¹è¯•ç”¨æ—¶ï¼Œä»–ä»¬æ˜¯åœ¨æ¶ˆè€—å®å®åœ¨åœ¨çš„ç®—åŠ›èµ„æºã€‚è¿™ç§é«˜æ˜‚çš„è¾¹é™…æˆæœ¬ä½¿å¾—æ¬ºè¯ˆå˜ä¸ºå¯¹ AI ä¼ä¸šç”Ÿæ­»å­˜äº¡çš„å¨èƒã€‚</p>
<p>Emily åˆ†äº«äº†ä¸€ä¸ªæ¡ˆä¾‹ï¼šå¥¹ä¸ä¸€ä½å°å‹ AI åˆ›å§‹äººäº¤æµï¼Œå¯¹æ–¹ç§°æ¬ºè¯ˆä¸æ˜¯é—®é¢˜ã€‚Emily è¿½é—®åå‘ç°ï¼Œè¿™ä½åˆ›å§‹äººä¸ºäº†è§£å†³æ¬ºè¯ˆé—®é¢˜ï¼Œä¸å¾—ä¸å®Œå…¨å…³é—­äº†å…è´¹è¯•ç”¨ï¼Œå¹¶ä¸”åœ¨æ–°ç”¨æˆ·è¯æ˜å…¶æ”¯ä»˜èƒ½åŠ›ä¹‹å‰ï¼Œæå¤§åœ°é™åˆ¶äº†ä»–ä»¬çš„ç§¯åˆ†æˆ–ä½¿ç”¨é¢åº¦ã€‚Emily çŠ€åˆ©åœ°æŒ‡å‡ºï¼šâ€œä½ ä¸æ˜¯è§£å†³äº†æ¬ºè¯ˆé—®é¢˜ï¼Œä½ æ˜¯åœ¨æ‰¼æ€ä½ è‡ªå·±çš„æ”¶å…¥ã€‚â€</p>
<p>è¿™ç§ç—›è‹¦æ˜¯çœŸå®å­˜åœ¨çš„ï¼Œå®ƒè¿«ä½¿ä¼ä¸šåœ¨å¢é•¿å’Œé£é™©ä¹‹é—´åšå‡ºè‰°éš¾çš„æƒè¡¡ã€‚è¿™ä¸ªé—®é¢˜ä¸ä»…é™äº AI å…¬å¸ï¼Œä¹Ÿå­˜åœ¨äºå¹¿å‘Šå¹³å°ï¼ˆå¹¿å‘Šå•†æŠ•æ”¾äº†å¹¿å‘Šå´ä¸ä»˜é’±ï¼Œå ç”¨äº†æœ¬å¯ä»¥ä»˜è´¹çš„å¹¿å‘Šä½ï¼‰ç­‰é¢†åŸŸã€‚</p>
<p>Emily ç”šè‡³æåˆ°ï¼Œå¥¹çš„æœ‹å‹æœ€è¿‘è·å¾—äº† Robin Hood ä¿¡ç”¨å¡ï¼Œè¯¥å¡ç”šè‡³åœ¨è¥é”€ä¸­æä¾›â€œå…è´¹è¯•ç”¨å¡â€â€”â€”è¿™ç§å¡ 24 å°æ—¶åå³è¿‡æœŸï¼Œä¸“é—¨ç”¨äºæ³¨å†Œå…è´¹è¯•ç”¨ã€‚è¿™å¯¹å–„æ„çš„æ¶ˆè´¹è€…æ¥è¯´å¾ˆæ–¹ä¾¿ï¼Œä½†å¯¹æ¬ºè¯ˆè€…è€Œè¨€ï¼Œè¿™æ˜¯å¯¹ AI ç»æµæå…·ç ´åæ€§çš„å·¥å…·ã€‚</p>
<p>Stripe æ­£åœ¨æ„å»ºä¸€å¥— Radar æ‰©å±•å¥—ä»¶ï¼Œä¸“é—¨é’ˆå¯¹è¿™äº›æ–°å‹æ¬ºè¯ˆã€‚ä¾‹å¦‚ï¼ŒStripe çš„å…è´¹è¯•ç”¨äº§å“å£°ç§°å¯ä»¥åœ¨æºå¤´æ•è·å¤§å¤šæ•°å…è´¹è¯•ç”¨æ»¥ç”¨ã€‚å¯¹äºé€€æ¬¾æ»¥ç”¨ï¼ŒStripe ä¹Ÿæ­£åœ¨å¼€å‘ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆã€‚é€€æ¬¾æ»¥ç”¨åœ¨ä¼ä¸šçº§å¥—é¤ï¼ˆå¦‚æ¯æœˆ 10,000 ç¾å…ƒè´­ä¹°æ•°åä¸‡ç§¯åˆ†ï¼‰ä¸­å°¤ä¸ºä¸¥é‡ã€‚Stripe çš„ç³»ç»Ÿå¯ä»¥çœ‹åˆ°è¿™äº›ç”¨æˆ·åœ¨ä½¿ç”¨æœåŠ¡ï¼ˆä¾‹å¦‚ï¼Œåœ¨æçŸ­æ—¶é—´å†…ç”¨å®Œæ‰€æœ‰ç§¯åˆ†ï¼‰ï¼Œå¹¶èƒ½éªŒè¯ä½¿ç”¨è€…èº«ä»½ï¼Œä»è€Œå¸®åŠ©å•†å®¶è¯†åˆ«å¹¶é˜»æ­¢è¿™ç§æ»¥ç”¨ã€‚</p>
<p>.... æ›´å¤šå†…å®¹</p>
<p>æ¬¢è¿è®¢é˜…åˆé›† <a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4221297752417992707%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FX1JwNWhO9tjVQfh9Qq9uJw%26nolastread%3D1%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4221297752417992707&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FX1JwNWhO9tjVQfh9Qq9uJw&amp;nolastread=1&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">AI æ’­å®¢æ•æ‰‹</a>ï¼šä¸“é—¨é¢å‘æ–‡å­—å†…å®¹çˆ±å¥½è€…åˆ†äº« AI é¢†åŸŸä¼˜è´¨æ’­å®¢ï¼Œå…¶ä»–åˆé›†ï¼š</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243230891033935893%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252FZcMiAmfNkmYLDgAu0rlb1Q%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243230891033935893&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FZcMiAmfNkmYLDgAu0rlb1Q&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI å†·æ€è€ƒ</a>ï¼šä¸ªäººåœ¨ AI ç‹‚æ¬¢ä¸‹çš„å†·æ€è€ƒï¼Œèšç„¦ AI å·¥ç¨‹åŒ–ã€Agent Infra äº§å“ã€æ•ˆç‡å‹ AI å·¥å…·å’Œäººæœºåä½œè¯é¢˜ï¼Œå¯»æ‰¾å¯æŒç»­çš„äº§ä¸šä»·å€¼ã€‚</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzg2OTk1NDQ4Ng%3D%3D%26action%3Dgetalbum%26album_id%3D4243205243418624006%26subscene%3D159%26subscene%3D%26scenenote%3Dhttps%253A%252F%252Fmp.weixin.qq.com%252Fs%252F0Tdan3R8juUlj-Lh-QMmew%26nolastread%3D1%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=Mzg2OTk1NDQ4Ng==&amp;action=getalbum&amp;album_id=4243205243418624006&amp;subscene=159&amp;subscene=&amp;scenenote=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F0Tdan3R8juUlj-Lh-QMmew&amp;nolastread=1#wechat_redirect" ref="nofollow noopener noreferrer">AI åšå®¢ç²¾é€‰</a>ï¼šç²¾å¿ƒç¼–è¯‘æµ·å¤–æŠ€æœ¯å‚å•†å‘å¸ƒçš„é«˜è´¨é‡ AI é¢†åŸŸåšå®¢æ–‡ç« ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[setTimeout å’Œ setIntervalï¼šçœ‹ä¼¼ç®€å•ï¼Œä½†ä½ ä¸çŸ¥é“çš„ä½¿ç”¨è¯¯åŒº]]></title>    <link>https://juejin.cn/post/7570902473432973312</link>    <guid>https://juejin.cn/post/7570902473432973312</guid>    <pubDate>2025-11-10T10:14:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570902473432973312" data-draft-id="7563194864416210979" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="setTimeout å’Œ setIntervalï¼šçœ‹ä¼¼ç®€å•ï¼Œä½†ä½ ä¸çŸ¥é“çš„ä½¿ç”¨è¯¯åŒº"/> <meta itemprop="keywords" content="å‰ç«¯,JavaScript,é¢è¯•"/> <meta itemprop="datePublished" content="2025-11-10T10:14:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="çŸ¢å¿ƒ"/> <meta itemprop="url" content="https://juejin.cn/user/4441682709588525"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            setTimeout å’Œ setIntervalï¼šçœ‹ä¼¼ç®€å•ï¼Œä½†ä½ ä¸çŸ¥é“çš„ä½¿ç”¨è¯¯åŒº
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682709588525/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    çŸ¢å¿ƒ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:14:05.000Z" title="Mon Nov 10 2025 10:14:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»5åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{line-height:1.75;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;letter-spacing:2px;background-image:linear-gradient(90deg,rgba(50,0,0,.05) 3%,transparent 0),linear-gradient(1turn,rgba(50,0,0,.05) 3%,transparent 0);background-size:20px 20px;background-position:50%;word-break:break-word;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1{font-size:23px;margin-bottom:5px;font-weight:700;padding-left:10px;border-left:5px solid #773098}.markdown-body h2{font-size:19px;font-weight:700;padding-left:10px;border-left:5px solid #916dd5}.markdown-body h3{font-size:17px;font-weight:700;padding-left:10px;border-left:5px solid #d89cf6}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{font-size:14px;margin-top:5px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{display:block;max-width:100%;margin:1em 0;border-radius:6px;box-shadow:2px 4px 7px #999;user-select:none}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{padding:.2em .5em;font-weight:700;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-size:1em;color:#916dd5;word-break:break-word;overflow-x:auto;background-color:none;border-radius:2px}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;font-family:-apple-system-font,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei UI,Microsoft YaHei,Arial,sans-serif;font-weight:400;font-size:.9em;padding:16px 12px;margin:0;color:#333;word-break:normal;overflow-x:auto;background:#f8f8f8;scroll-behavior:smooth}.markdown-body a{text-decoration:none;color:#916dd5;font-weight:700;border-bottom:1px solid #916dd5}.markdown-body a:active,.markdown-body a:hover{color:#773098}.markdown-body table{display:inline-block!important;font-size:14px;width:auto;max-width:100%;overflow:auto;border:1px solid #916dd5;border-collapse:collapse}.markdown-body thead{background-color:#916dd5;color:#fff;text-align:left}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px;border:1px solid #916dd5}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #d89cf6;background-color:#f4eeff}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0;line-height:26px}.markdown-body ol,.markdown-body ul{padding-left:28px;list-style-type:circle}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body b,.markdown-body strong{color:#916dd5;font-weight:700}.markdown-body b:before,.markdown-body strong:before{content:"ã€Œ"}.markdown-body b:after,.markdown-body strong:after{content:"ã€"}.markdown-body em,.markdown-body i{color:#916dd5}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#abb2bf;background:#282c34}.hljs-comment,.hljs-quote{color:#5c6370;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#c678dd}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e06c75}.hljs-literal{color:#56b6c2}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#98c379}.hljs-built_in,.hljs-class .hljs-title{color:#e6c07b}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#d19a66}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#61aeee}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">ä¸é‚£ä¹ˆå‡†æ—¶çš„setTimeoutå’ŒsetInterval</h2>
<h3 data-id="heading-1">setTimeoutå’ŒsetIntervalçš„æ‰§è¡Œæ—¶é—´è¯¯å·®</h3>
<p>åœ¨æˆ‘ä»¬å¸¸è§è§‚å¿µä¸­ï¼Œ<strong>setTimeout</strong> å’Œ <strong>setInterval</strong> éƒ½æ˜¯ç”¨æ¥åœ¨æŒ‡å®šæ—¶é—´å®šæ—¶æ‰§è¡Œä»£ç çš„å‡½æ•°ã€‚
setTimeoutç”¨äºåœ¨æŒ‡å®šçš„æ—¶é—´åæ‰§è¡Œä¸€æ¬¡ä»£ç ï¼Œè€ŒsetIntervalåˆ™ç”¨äºåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…é‡å¤æ‰§è¡Œä»£ç ã€‚</p>
<p>å¦‚é¢˜ï¼Œä¸‹é¢çš„ä»£ç ï¼Œå¾ˆå¤šäººä¼šä¸‹æ„è¯†çš„è®¤ä¸º setTimeout ä¼šåœ¨1ç§’åè¾“å‡ºï¼ŒsetInterval æ¯1ç§’è¾“å‡ºä¸€æ¬¡</p>
<p>ä½†æ˜¯å®é™…æƒ…å†µä¸­ï¼ŒsetTimeoutå’ŒsetIntervalçš„æ‰§è¡Œæ—¶é—´æ˜¯æœ‰ä¸€å®šè¯¯å·®çš„ã€‚</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>(); <span class="hljs-comment">// è®°å½•å¼€å§‹æ—¶é—´</span>
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`setTimeoutå®é™…æ‰§è¡Œæ—¶é—´ï¼š<span class="hljs-subst">${end - start}</span>ms`</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> start = performance.<span class="hljs-title function_">now</span>(); <span class="hljs-comment">// è®°å½•å¼€å§‹æ—¶é—´</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> end = performance.<span class="hljs-title function_">now</span>();
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`setIntervalå®é™…æ‰§è¡Œæ—¶é—´ï¼š<span class="hljs-subst">${end - start}</span>ms`</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<p><code>å®é™…ä¸Šæ‰§è¡Œæ—¶é—´ä¼šå¤§äºç­‰äºæŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´</code></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/87e579e21f4e4fc382585b162fe576a8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-i5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763374445&amp;x-signature=FTjApNmeB08XiZXzFZeSTan5k6A%3D" alt="GIF2.gif" loading="lazy"/></p>
<p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå®šæ—¶å™¨å§‹ç»ˆå­˜åœ¨å®é™…æœ€å°æ‰§è¡Œé—´éš”ï¼Œå³ä½¿æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´ä¸º<strong>0ms</strong>ï¼Œä¹Ÿä¼šå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿã€‚</p>
<h4 data-id="heading-2">1ã€JS å¼•æ“æœºåˆ¶</h4>
<p>è¿™æ˜¯å› ä¸ºJavaScriptæ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œè€Œ setTimeout å’Œ setInterval éƒ½æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œ
å½“JavaScriptå¼•æ“æ‰§è¡Œåˆ° setTimeout æˆ– setInterval æ—¶ï¼Œä¼šå°†å…¶æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼Œå®šæ—¶å™¨çš„å›è°ƒå‡½æ•°å¿…é¡»ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²æ—¶æ‰èƒ½æ‰§è¡Œã€‚è€Œä¸»çº¿ç¨‹ç©ºé—²çš„æ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼Œå–å†³äºå½“å‰æ‰§è¡Œçš„ä»£ç çš„è€—æ—¶ã€‚
å³ä½¿ä¸»çº¿ç¨‹ç©ºé—²ï¼Œæµè§ˆå™¨ä¹Ÿéœ€è¦ä¸€å®šæ—¶é—´è°ƒåº¦å›è°ƒå‡½æ•°ï¼ˆå±äºå¼•æ“å†…éƒ¨çš„ â€œè°ƒåº¦å¼€é”€â€ï¼‰ï¼Œè¿™ä¸ªå¼€é”€é€šå¸¸åœ¨ <strong>1ms~4ms</strong> ä¹‹é—´</p>
<h4 data-id="heading-3">2ã€HTML5 è§„èŒƒ</h4>
<ol>
<li>
<p>HTML5 è§„èŒƒæ˜ç¡®è§„å®šäº†<strong>å®šæ—¶å™¨çš„æœ€å°å»¶è¿Ÿé™åˆ¶ä¸º4ms</strong>ï¼ŒåµŒå¥—å±‚çº§è¾ƒæµ…æ—¶æœ€å°å»¶è¿Ÿå¯èƒ½ä½è‡³1msã€‚</p>
</li>
<li>
<p>å¯¹äºåµŒå¥—å±‚çº§ â‰¥ 5 çš„å®šæ—¶å™¨ï¼ˆå³å®šæ—¶å™¨å›è°ƒä¸­å†æ¬¡åˆ›å»ºå®šæ—¶å™¨ï¼Œå½¢æˆåµŒå¥—ï¼‰ï¼Œæµè§ˆå™¨ä¼šå¼ºåˆ¶å°†æœ€å°å»¶è¿Ÿé™åˆ¶ä¸º 4msã€‚</p>
</li>
<li>
<p>å¤„äºåå°æ ‡ç­¾é¡µä¸­çš„è®¡æ—¶å™¨ä¹Ÿå¯èƒ½ä¼šè¢«é™åˆ¶ä¸º1ç§’çš„æœ€å°å»¶è¿Ÿ</p>
</li>
</ol>
<p>å› æ­¤ï¼Œå¯¹äºå®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ä¾èµ– setTimeout å’Œ setInterval çš„ç²¾ç¡®æ‰§è¡Œæ—¶é—´ï¼Œè€Œåº”è¯¥æ ¹æ®å®é™…éœ€æ±‚æ¥è°ƒæ•´å®šæ—¶å™¨çš„å»¶è¿Ÿæ—¶é—´ã€‚</p>
<p>å› æ­¤ï¼Œå¯¹äºå®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½ä¾èµ– <code>0ms</code> å»¶è¿Ÿå®ç°é«˜ç²¾åº¦é€»è¾‘ï¼ˆæ¯”å¦‚åŠ¨ç”»å¸§ï¼‰</p>
<p>æ¨èä½¿ç”¨ <code>requestAnimationFrame</code>ï¼ˆä¸“é—¨ä¸ºåŠ¨ç”»è®¾è®¡ï¼Œä¸æµè§ˆå™¨åˆ·æ–°é¢‘ç‡åŒæ­¥ï¼‰</p>
<h3 data-id="heading-4">è§£å†³æ–¹æ³•</h3>
<p>1ã€è°ƒæ•´å»¶è¿Ÿæ—¶é—´
æ ¹æ®å®é™…éœ€æ±‚ï¼Œåˆç†è°ƒæ•´å®šæ—¶å™¨çš„å»¶è¿Ÿæ—¶é—´ã€‚å¦‚æœå¯¹æ‰§è¡Œæ—¶é—´æœ‰ä¸¥æ ¼è¦æ±‚ï¼Œå»ºè®®ä½¿ç”¨ Date.now() æˆ–performance.now() æ¥è®¡ç®—å®é™…æ‰§è¡Œæ—¶é—´ï¼Œè€Œä¸æ˜¯ä¾èµ–å®šæ—¶å™¨çš„å›è°ƒå‡½æ•°ã€‚</p>
<p>2ã€ä½¿ç”¨ requestAnimationFrame
requestAnimationFrame æ˜¯æµè§ˆå™¨æä¾›çš„ç”¨äºåŠ¨ç”»å¾ªç¯çš„å‡½æ•°ï¼Œå®ƒä¼šåœ¨æµè§ˆå™¨ä¸‹ä¸€æ¬¡é‡ç»˜ä¹‹å‰æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚ä¸æµè§ˆå™¨åˆ·æ–°é¢‘ç‡åŒæ­¥ï¼Œä½¿ç”¨ requestAnimationFrame å¯ä»¥å®ç°æ›´ç²¾ç¡®çš„åŠ¨ç”»æ•ˆæœã€‚</p>
<h2 data-id="heading-5">setIntervalå­˜åœ¨çš„é—®é¢˜</h2>
<p>é™¤äº†æœ€å°å»¶è¿Ÿæ—¶é—´å¤–ï¼ŒsetInterval è¿˜å­˜åœ¨ä¸€äº›é¢å¤–é—®é¢˜ï¼Œä¸»è¦è¡¨ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p>
<h3 data-id="heading-6">1ã€ä»»åŠ¡å †å ï¼ˆæ‰§è¡Œè€—æ—¶  &gt;  è®¾å®šé—´éš”ï¼‰</h3>
<p>å¦‚æœå›è°ƒä¸­çš„æ‰§è¡Œè€—æ—¶è¶…è¿‡é—´éš”æ—¶é—´ï¼ŒsetInterval å¯ä¸ä¼šç­‰ä½ ï¼Œè€Œæ˜¯ä¼šç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªå›è°ƒï¼Œå®ƒä¼šæ— è§†ä¸Šæ¬¡å›è°ƒæ˜¯å¦æ‰§è¡Œå®Œæ¯•ï¼Œå°†æ–°çš„å›è°ƒæ¨å…¥é˜Ÿåˆ—ï¼Œå¯¼è‡´ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­å †ç§¯ï¼Œä¸»çº¿ç¨‹ç©ºé—²åï¼Œè¿™äº›å›è°ƒä¼šè¿ç»­åœ°æ‰§è¡Œï¼Œå¤±å»é—´éš”æ„ä¹‰</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  count++;
  <span class="hljs-comment">// æ¯ç§’å…ˆè¾“å‡ºå½“å‰æ‰§è¡Œä¿¡æ¯</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ‰§è¡Œç¬¬<span class="hljs-subst">${count}</span>æ¬¡ï¼Œç´¯è®¡è¿è¡Œ<span class="hljs-subst">${((<span class="hljs-built_in">Date</span>.now() - startTime) / <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">1</span>)}</span>s`</span>);
  <span class="hljs-comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼ˆé˜»å¡2sï¼‰</span>
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">2000</span>) {} <span class="hljs-comment">// é˜»å¡2000ms</span>
  <span class="hljs-comment">// è¾“å‡ºä»»åŠ¡å®Œæˆä¿¡æ¯ï¼Œå¹¶æ ‡è®°æ—¶é—´ç‚¹</span>
  <span class="hljs-keyword">if</span> (count === <span class="hljs-number">1</span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ç¬¬ä¸€æ¬¡ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼ˆçº¦3ç§’åï¼‰"</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼ˆé—´éš”çº¦2ç§’ï¼‰"</span>);
  }
}, <span class="hljs-number">1000</span>); <span class="hljs-comment">// é—´éš”1000ms</span>
<span class="hljs-comment">// å®é™…ä¸ºé™¤äº†ç¬¬ä¸€æ¬¡æ˜¯3såæ‰§è¡Œå®Œæˆï¼Œåç»­éƒ½æ˜¯2såæ‰§è¡Œå®Œæˆï¼Œä¸ä¼šæŒ‰ç…§é¢„è®¾çš„1sé—´éš”æ‰§è¡Œ</span>
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7c6101b8b3274d47ba40309ea75e3aa0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-i5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763374445&amp;x-signature=WmNqYk7xjPs6fCFTbT%2Fv3aQVK88%3D" alt="GIF.gif" loading="lazy"/>
<code>å¦‚æœå›è°ƒä¸­çš„æ‰§è¡Œè€—æ—¶è¶…è¿‡é—´éš”æ—¶é—´ï¼Œå®é™…é—´éš”æ—¶é—´å°±æ˜¯æ‰§è¡Œä»»åŠ¡æ¶ˆè€—çš„æ—¶é—´ï¼Œè€Œä¸æ˜¯è®¾å®šçš„å€¼</code></p>
<h3 data-id="heading-7">2ã€è¯¯å·®ç´¯ç§¯ï¼ˆæ—¶é—´ä¸å‡†ï¼‰</h3>
<p>ä¸Šé¢è¯´è¿‡ï¼Œç”±äºjsçš„å•çº¿ç¨‹æœºåˆ¶ï¼ŒsetInterval æ— æ³•ä¿è¯ç²¾ç¡®é—´éš”â€‹ï¼Œå®é™…è¾“å‡ºæ—¶é—´é—´éš”å¯èƒ½å¤§äºè®¾å®šçš„æ—¶é—´ï¼Œå› ä¸ºjsæ˜¯å•çº¿ç¨‹çš„ï¼Œæ¸¸è§ˆå™¨æœ€å°é—´éš”é™åˆ¶ï¼šæµè§ˆå™¨é€šå¸¸æœ‰ â€‹4ms æœ€å°å»¶è¿Ÿâ€‹ï¼ˆå³ä½¿è®¾ 0msï¼‰ï¼Œæ²¡æœ‰0å»¶æ—¶å®šæ—¶å™¨ï¼ŒåŒ…æ‹¬setTimeoutã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨ setInterval æ—¶ï¼Œéœ€è¦æ³¨æ„ä»»åŠ¡çš„æ‰§è¡Œè€—æ—¶ï¼Œé¿å…è€—æ—¶è¿‡é•¿å¯¼è‡´è¯¯å·®ç´¯ç§¯ã€‚</p>
<h3 data-id="heading-8">3ã€å†…å­˜æ³„æ¼ï¼ˆå¿˜è®°æ¸…é™¤ï¼‰</h3>
<p>å¿˜è®°æ¸…ç† setTimeout åªä¼šå¯¼è‡´ä¸€ä¸ªå¤šä½™çš„å›è°ƒæ‰§è¡Œã€‚ä½†å¿˜è®° clearInterval ä¼šå¯¼è‡´å›è°ƒå‡½æ•°æ— é™æ‰§è¡Œï¼Œé€ æˆä¸¥é‡çš„å†…å­˜æ³„æ¼ï¼Œä¸”é¡µé¢è·³è½¬ä¹Ÿä¸ä¼šè‡ªåŠ¨åœæ­¢ï¼ˆåœ¨ SPA ä¸­æœ€ä¸ºæ˜æ˜¾ï¼‰</p>
<h3 data-id="heading-9">è§£å†³åŠæ³•</h3>
<p>æ‰‹åŠ¨å†™ä¸€ä¸ª <strong>setTimeout é€’å½’å°è£…çš„ã€Œå®‰å…¨ç‰ˆå®šæ—¶å™¨ã€</strong>ï¼Œè§£å†³ setInterval å¯èƒ½å‡ºç°çš„ä»»åŠ¡å †å ç­‰é—®é¢˜ï¼Œç¡®ä¿å‰ä¸€æ¬¡å›è°ƒå®Œå…¨æ‰§è¡Œå®Œæ¯•åï¼Œæ‰è§¦å‘ä¸‹ä¸€æ¬¡</p>
<p>ç®€å•ç¤ºä¾‹ï¼š</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">myInterval</span>(<span class="hljs-params">fn, delay</span>) {
  <span class="hljs-comment">// é€’å½’æ‰§è¡Œå‡½æ•°</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">run</span> = (<span class="hljs-params"/>) =&gt; {
    <span class="hljs-title function_">fn</span>(); <span class="hljs-comment">// æ‰§è¡Œä»»åŠ¡</span>
    <span class="hljs-built_in">setTimeout</span>(run, delay); <span class="hljs-comment">// ä»»åŠ¡å®Œæˆåï¼Œæ‰è§¦å‘ä¸‹ä¸€æ¬¡</span>
  };
  <span class="hljs-comment">// å¯åŠ¨é¦–æ¬¡æ‰§è¡Œ</span>
  <span class="hljs-built_in">setTimeout</span>(run, delay);
}
</code></pre>
<p>ä½¿ç”¨æ•ˆæœ</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> startTime = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
<span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>;
<span class="hljs-title function_">myInterval</span>(<span class="hljs-function">() =&gt;</span> {
  count++;
  <span class="hljs-keyword">const</span> start = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();
  <span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - start &lt; <span class="hljs-number">1000</span>) {} <span class="hljs-comment">// é˜»å¡1000ms</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`æ‰§è¡Œç¬¬<span class="hljs-subst">${count}</span>æ¬¡ï¼Œç´¯è®¡è¿è¡Œ<span class="hljs-subst">${((<span class="hljs-built_in">Date</span>.now() - startTime) / <span class="hljs-number">1000</span>).toFixed(<span class="hljs-number">1</span>)}</span>s`</span>);
}, <span class="hljs-number">1000</span>);
</code></pre>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d2d37d3144d4bba9c4b359bd8d8c7d2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55-i5b-D:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763374445&amp;x-signature=5697PMBvazkcfsfN2il0H%2F5ZsVM%3D" alt="GIF3.gif" loading="lazy"/>
æ¯<strong>2s</strong>é—´éš”æ‰§è¡Œï¼Œè¿™æ ·ç¡®ä¿äº†æ¯æ¬¡å›è°ƒæ‰§è¡Œå®Œæ¯•åï¼Œæ‰ä¼šè§¦å‘ä¸‹ä¸€æ¬¡ï¼Œé¿å…äº†ä»»åŠ¡å †å é—®é¢˜ã€‚</p>
<h2 data-id="heading-10">æ€»ç»“</h2>
<p>åœ¨å¼€å‘ä¸­ï¼Œåœ¨å¤§å¤šæ•°éœ€è¦è½®è¯¢å®šæ—¶å™¨çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨é€’å½’çš„ setTimeout ç›¸å¯¹æ›´å®‰å…¨ã€æ›´å¯æ§ï¼Œä½¿ç”¨ setInterval æ—¶è¦åšåˆ°å¿ƒä¸­æœ‰æ•°ï¼Œé¿å…äº§ç”Ÿbugã€‚</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æï¼ˆä¸€ä¸ªCrashå¼•å‘çš„æ€è€ƒï¼‰]]></title>    <link>https://juejin.cn/post/7570903763721453578</link>    <guid>https://juejin.cn/post/7570903763721453578</guid>    <pubDate>2025-11-10T10:11:12.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570903763721453578" data-draft-id="7570932873130557467" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æï¼ˆä¸€ä¸ªCrashå¼•å‘çš„æ€è€ƒï¼‰"/> <meta itemprop="keywords" content="æ€§èƒ½ä¼˜åŒ–"/> <meta itemprop="datePublished" content="2025-11-10T10:11:12.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="èŒƒç‰¹è›Ÿ"/> <meta itemprop="url" content="https://juejin.cn/user/3773179636744205"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æï¼ˆä¸€ä¸ªCrashå¼•å‘çš„æ€è€ƒï¼‰
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3773179636744205/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    èŒƒç‰¹è›Ÿ
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T10:11:12.000Z" title="Mon Nov 10 2025 10:11:12 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»10åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Android æ¸²æŸ“æœºåˆ¶æ·±åº¦è§£æ</h2>
<blockquote>
<p>èµ·å› ï¼šandroidx.recyclerview.widget.RecyclerView$Recycler.validateViewHolderForOffsetPosition</p>
</blockquote>
<blockquote>
<p>åŒ…å« RecyclerViewã€GapWorker å’Œ Choreographer çš„å®Œæ•´å·¥ä½œåŸç†</p>
</blockquote>
<h3 data-id="heading-1">ç›®å½•</h3>
<ul>
<li><a href="#%E4%B8%80recyclerview-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" title="#%E4%B8%80recyclerview-%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">ä¸€ã€RecyclerView å·¥ä½œåŸç†</a></li>
<li><a href="#%E4%BA%8Cgapworker-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90" title="#%E4%BA%8Cgapworker-%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90">äºŒã€GapWorker æ·±åº¦è§£æ</a></li>
<li><a href="#%E4%B8%89choreographer-%E8%AF%A6%E8%A7%A3" title="#%E4%B8%89choreographer-%E8%AF%A6%E8%A7%A3">ä¸‰ã€Choreographer è¯¦è§£</a></li>
</ul>
<hr/>
<h2 data-id="heading-2">ä¸€ã€RecyclerView å·¥ä½œåŸç†</h2>
<p>RecyclerView æ˜¯ Android ä¸­ç”¨äºé«˜æ•ˆæ˜¾ç¤ºå¤§é‡æ•°æ®çš„ç»„ä»¶ã€‚</p>
<h3 data-id="heading-3">æ ¸å¿ƒè®¾è®¡ç†å¿µ</h3>
<p><strong>å¤ç”¨ï¼ˆRecycleï¼‰+ è§†å›¾æŒæœ‰è€…ï¼ˆViewHolderï¼‰= é«˜æ€§èƒ½åˆ—è¡¨</strong></p>
<p>ä¼ ç»Ÿçš„ ListView æ¯æ¬¡æ»šåŠ¨éƒ½è¦ <code>findViewById</code>ï¼Œéå¸¸è€—æ—¶ã€‚RecyclerView é€šè¿‡ç¼“å­˜å’Œå¤ç”¨æœºåˆ¶å¤§å¹…æå‡æ€§èƒ½ã€‚</p>
<h3 data-id="heading-4">æ ¸å¿ƒç»„ä»¶</h3>
<h4 data-id="heading-5">1. ViewHolderï¼ˆè§†å›¾æŒæœ‰è€…ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyViewHolder</span>(itemView: View) : RecyclerView.ViewHolder(itemView) {
    <span class="hljs-keyword">val</span> textView = itemView.findViewById&lt;TextView&gt;(R.id.text)
    <span class="hljs-comment">// ç¼“å­˜å­Viewçš„å¼•ç”¨ï¼Œé¿å…é‡å¤ findViewById</span>
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>ç¼“å­˜ itemView ä¸­çš„å­ View å¼•ç”¨</li>
<li>æºå¸¦ positionã€itemId ç­‰å…ƒæ•°æ®</li>
<li>ä¸€ä¸ª ViewHolder å¯¹åº”ä¸€ä¸ªåˆ—è¡¨é¡¹</li>
</ul>
<h4 data-id="heading-6">2. Adapterï¼ˆé€‚é…å™¨ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAdapter</span> : <span class="hljs-type">RecyclerView.Adapter</span>&lt;<span class="hljs-type">MyViewHolder</span>&gt;() {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getItemCount</span><span class="hljs-params">()</span></span>: <span class="hljs-built_in">Int</span> { ... }          <span class="hljs-comment">// æ•°æ®æ€»æ•°</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateViewHolder</span><span class="hljs-params">(...)</span></span>: MyViewHolder <span class="hljs-comment">// åˆ›å»ºViewHolder</span>
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder, position)</span></span>    <span class="hljs-comment">// ç»‘å®šæ•°æ®</span>
}
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>ç®¡ç†æ•°æ®æº</li>
<li>åˆ›å»ºå’Œç»‘å®š ViewHolder</li>
<li>é€šçŸ¥ RecyclerView æ•°æ®å˜åŒ–</li>
</ul>
<h4 data-id="heading-7">3. LayoutManagerï¼ˆå¸ƒå±€ç®¡ç†å™¨ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">LinearLayoutManager    <span class="hljs-comment">// çº¿æ€§å¸ƒå±€</span>
GridLayoutManager      <span class="hljs-comment">// ç½‘æ ¼å¸ƒå±€</span>
StaggeredGridLayoutManager <span class="hljs-comment">// ç€‘å¸ƒæµ</span>
</code></pre>
<p><strong>ä½œç”¨</strong>ï¼š</p>
<ul>
<li>å†³å®š item å¦‚ä½•æ‘†æ”¾ï¼ˆå‚ç›´ã€æ¨ªå‘ã€ç½‘æ ¼ç­‰ï¼‰</li>
<li>å¤„ç†æ»šåŠ¨é€»è¾‘</li>
<li>å†³å®šå“ªäº› item å¯è§</li>
</ul>
<h4 data-id="heading-8">4. Recyclerï¼ˆå›æ”¶å™¨ï¼‰</h4>
<p>æ ¸å¿ƒå¤ç”¨æœºåˆ¶çš„å®ç°è€…ï¼Œç®¡ç†å¤šçº§ç¼“å­˜ã€‚</p>
<h3 data-id="heading-9">å››çº§ç¼“å­˜æœºåˆ¶</h3>
<p>è¿™æ˜¯ RecyclerView æ€§èƒ½çš„æ ¸å¿ƒï¼</p>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          RecyclerView ç¼“å­˜æ±              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">1</span>. mAttachedScrap (å±å¹•å†…ç¼“å­˜)           â”‚  â† æœ€å¿«ï¼Œæ— éœ€ç»‘å®š
â”‚    - ä¿å­˜æ­£åœ¨æ˜¾ç¤ºçš„ ViewHolder            â”‚
â”‚    - ç”¨äºå¸ƒå±€æœŸé—´ä¸´æ—¶åˆ†ç¦»çš„ ViewHolder     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">2</span>. mCachedViews (ç¦»å±ç¼“å­˜)               â”‚  â† å¿«ï¼Œæ— éœ€ç»‘å®š
â”‚    - é»˜è®¤å¤§å°ï¼š<span class="hljs-number">2</span>                          â”‚
â”‚    - ä¿å­˜åˆšæ»šå‡ºå±å¹•çš„ ViewHolder           â”‚
â”‚    - <span class="hljs-attribute">position</span> å’Œæ•°æ®å®Œå…¨åŒ¹é…æ‰èƒ½å¤ç”¨       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">3</span>. ViewCacheExtension (è‡ªå®šä¹‰ç¼“å­˜)       â”‚  â† å¼€å‘è€…è‡ªå®šä¹‰
â”‚    - å‡ ä¹ä¸ç”¨                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-number">4</span>. RecycledViewPool (å›æ”¶æ± )            â”‚  â† éœ€è¦é‡æ–°ç»‘å®š
â”‚    - é»˜è®¤æ¯ç§ type ç¼“å­˜ <span class="hljs-number">5</span> ä¸ª               â”‚
â”‚    - æŒ‰ viewType åˆ†ç±»å­˜å‚¨                 â”‚
â”‚    - ViewHolder ä¼šæ¸…é™¤ <span class="hljs-attribute">position</span> ä¿¡æ¯      â”‚
â”‚    - éœ€è¦é‡æ–° <span class="hljs-built_in">onBindViewHolder</span>()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-10">ç¼“å­˜æŸ¥æ‰¾ä¼˜å…ˆçº§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¼ªä»£ç å±•ç¤ºç¼“å­˜æŸ¥æ‰¾æµç¨‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">tryGetViewHolderForPositionByDeadline</span><span class="hljs-params">(position: <span class="hljs-type">Int</span>)</span></span>: ViewHolder? {
    <span class="hljs-comment">// 1. å…ˆä» mAttachedScrap æ‰¾ï¼ˆç²¾ç¡®åŒ¹é… positionï¼‰</span>
    holder = mAttachedScrap.findByPosition(position)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> holder  <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€ bind</span>

    <span class="hljs-comment">// 2. ä» mCachedViews æ‰¾ï¼ˆç²¾ç¡®åŒ¹é… positionï¼‰</span>
    holder = mCachedViews.findByPosition(position)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> holder  <span class="hljs-comment">// ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€ bind</span>

    <span class="hljs-comment">// 3. ä»è‡ªå®šä¹‰ç¼“å­˜æ‰¾</span>
    holder = mViewCacheExtension?.getViewForPosition(position)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> holder

    <span class="hljs-comment">// 4. ä» RecycledViewPool æ‰¾ï¼ˆæŒ‰ viewType æŸ¥æ‰¾ï¼‰</span>
    holder = mRecyclerPool.getRecycledView(viewType)
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) {
        holder.resetInternal()  <span class="hljs-comment">// æ¸…é™¤æ—§æ•°æ®</span>
        adapter.bindViewHolder(holder, position)  <span class="hljs-comment">// éœ€è¦é‡æ–°ç»‘å®š</span>
        <span class="hljs-keyword">return</span> holder
    }

    <span class="hljs-comment">// 5. æ‰€æœ‰ç¼“å­˜éƒ½æ²¡æœ‰ï¼Œåˆ›å»ºæ–°çš„</span>
    holder = adapter.createViewHolder(parent, viewType)
    adapter.bindViewHolder(holder, position)
    <span class="hljs-keyword">return</span> holder
}
</code></pre>
<h3 data-id="heading-11">å·¥ä½œæµç¨‹</h3>
<h4 data-id="heading-12">1. åˆå§‹åŒ–é˜¶æ®µ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">recyclerView.layoutManager = LinearLayoutManager(context)
recyclerView.adapter = myAdapter
</code></pre>
<p>RecyclerView ä¼šï¼š</p>
<ol>
<li>æµ‹é‡è‡ªå·±çš„å°ºå¯¸</li>
<li>è®© LayoutManager å¸ƒå±€å­ View</li>
<li>æ ¹æ®å¯è§åŒºåŸŸåˆ›å»ºè¶³å¤Ÿçš„ ViewHolder</li>
</ol>
<h4 data-id="heading-13">2. æ»šåŠ¨é˜¶æ®µ</h4>
<pre><code class="hljs language-arduino" lang="arduino">ç”¨æˆ·å‘ä¸Šæ»šåŠ¨ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ position <span class="hljs-number">0</span>       â”‚ â† æ»šå‡ºå±å¹•ï¼Œè¿›å…¥ mCachedViews
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">1</span>       â”‚ â† å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">2</span>       â”‚ â† å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">3</span>       â”‚ â† å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ position <span class="hljs-number">4</span>       â”‚ â† å³å°†å¯è§ï¼Œä»ç¼“å­˜ä¸­å– ViewHolder
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æµç¨‹</strong>ï¼š</p>
<ol>
<li>position 0 æ»šå‡ºå±å¹• â†’ detach â†’ æ”¾å…¥ <code>mCachedViews</code></li>
<li>position 4 å³å°†è¿›å…¥å±å¹• â†’ ä»ç¼“å­˜æŸ¥æ‰¾ ViewHolder</li>
<li>å¦‚æœ <code>mCachedViews</code> æ»¡äº†ï¼ˆè¶…è¿‡2ä¸ªï¼‰â†’ æœ€æ—§çš„ç§»åˆ° <code>RecycledViewPool</code></li>
</ol>
<h4 data-id="heading-14">3. æ•°æ®æ›´æ–°é˜¶æ®µ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯ï¼šnotifyDataSetChanged()</span>
adapter.notifyDataSetChanged()
<span class="hljs-comment">// æ‰€æœ‰ç¼“å­˜å¤±æ•ˆï¼Œå…¨éƒ¨é‡æ–° bindï¼Œæ€§èƒ½å·®</span>

<span class="hljs-comment">// âœ… æ­£ç¡®ï¼šç²¾ç¡®é€šçŸ¥</span>
adapter.notifyItemRemoved(position)      <span class="hljs-comment">// åˆ é™¤</span>
adapter.notifyItemInserted(position)     <span class="hljs-comment">// æ’å…¥</span>
adapter.notifyItemChanged(position)      <span class="hljs-comment">// æ›´æ–°</span>
adapter.notifyItemMoved(from, to)        <span class="hljs-comment">// ç§»åŠ¨</span>
</code></pre>
<h3 data-id="heading-15">notify æ–¹æ³•å¯¹æ¯”</h3>








































<table><thead><tr><th>æ–¹æ³•</th><th>ç¼“å­˜å¤±æ•ˆèŒƒå›´</th><th>é‡æ–° bind</th><th>åŠ¨ç”»</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td><code>notifyDataSetChanged()</code></td><td>å…¨éƒ¨å¤±æ•ˆ</td><td>å…¨éƒ¨é‡æ–° bind</td><td>âŒ æ— </td><td>âš ï¸ å·®</td></tr><tr><td><code>notifyItemRemoved(pos)</code></td><td>ä»…ä¸€ä¸ª</td><td>ä»…ä¸€ä¸ª</td><td>âœ… æœ‰</td><td>âœ… å¥½</td></tr><tr><td><code>notifyItemChanged(pos)</code></td><td>ä»…ä¸€ä¸ª</td><td>ä»…ä¸€ä¸ª</td><td>âœ… æœ‰</td><td>âœ… å¥½</td></tr><tr><td><code>notifyItemInserted(pos)</code></td><td>åç»­ä½ç½® +1</td><td>ä»…æ–°çš„</td><td>âœ… æœ‰</td><td>âœ… å¥½</td></tr></tbody></table>
<h3 data-id="heading-16">ä½ç½®ä¿¡æ¯ç®¡ç†</h3>
<p>RecyclerView ç»´æŠ¤äº†å¤æ‚çš„ä½ç½®æ˜ å°„ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewHolder</span> {
    <span class="hljs-keyword">var</span> mPosition: <span class="hljs-built_in">Int</span> = NO_POSITION        <span class="hljs-comment">// å½“å‰ä½ç½®</span>
    <span class="hljs-keyword">var</span> mOldPosition: <span class="hljs-built_in">Int</span> = NO_POSITION     <span class="hljs-comment">// æ—§ä½ç½®</span>
    <span class="hljs-keyword">var</span> mPreLayoutPosition: <span class="hljs-built_in">Int</span> = NO_POSITION <span class="hljs-comment">// å¸ƒå±€å‰ä½ç½®</span>
    <span class="hljs-comment">// ... å…¶ä»–ä½ç½®ä¿¡æ¯</span>
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆå¤šä½ç½®</strong>ï¼š</p>
<ul>
<li>åŠ¨ç”»æœŸé—´ï¼Œitem çš„ä½ç½®ä¼šå˜åŒ–</li>
<li>éœ€è¦è®°å½•åŠ¨ç”»å‰åçš„ä½ç½®</li>
<li>é¢„å–æœºåˆ¶éœ€è¦é¢„æµ‹ä½ç½®</li>
</ul>
<h3 data-id="heading-17">å®Œæ•´çš„åˆ é™¤æµç¨‹å¯¹æ¯”</h3>
<h4 data-id="heading-18">âŒ é”™è¯¯æ–¹å¼</h4>
<pre><code class="hljs language-kotlin" lang="kotlin">datas.remove(<span class="hljs-keyword">data</span>)
notifyDataSetChanged()

<span class="hljs-comment">// é—®é¢˜ï¼š</span>
<span class="hljs-comment">// 1. æ‰€æœ‰ ViewHolder çš„ position ä¿¡æ¯ç«‹å³å¤±æ•ˆ</span>
<span class="hljs-comment">// 2. GapWorker å¯èƒ½ä½¿ç”¨è¿‡æœŸçš„ position</span>
<span class="hljs-comment">// 3. æ‰€æœ‰å¯è§ item éƒ½è¦é‡æ–° bindï¼ˆæ€§èƒ½å·®ï¼‰</span>
<span class="hljs-comment">// 4. æ²¡æœ‰åˆ é™¤åŠ¨ç”»</span>
</code></pre>
<h4 data-id="heading-19">âœ… æ­£ç¡®æ–¹å¼</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">val</span> position = datas.indexOf(<span class="hljs-keyword">data</span>)
<span class="hljs-keyword">if</span> (position != -<span class="hljs-number">1</span>) {
    datas.remove(<span class="hljs-keyword">data</span>)
    notifyItemRemoved(position)
    notifyItemRangeChanged(position, datas.size - position)
}

<span class="hljs-comment">// ä¼˜ç‚¹ï¼š</span>
<span class="hljs-comment">// 1. RecyclerView ç«‹å³æ›´æ–°å†…éƒ¨ä½ç½®æ˜ å°„</span>
<span class="hljs-comment">// 2. GapWorker è·å¾—å‡†ç¡®çš„ position ä¿¡æ¯</span>
<span class="hljs-comment">// 3. åªæœ‰è¢«åˆ é™¤çš„ item éœ€è¦å¤„ç†</span>
<span class="hljs-comment">// 4. æœ‰æµç•…çš„åˆ é™¤åŠ¨ç”»</span>
<span class="hljs-comment">// 5. åç»­ item çš„ position è‡ªåŠ¨æ›´æ–°</span>
</code></pre>
<hr/>
<h2 data-id="heading-20">äºŒã€GapWorker æ·±åº¦è§£æ</h2>
<p>GapWorker æ˜¯ RecyclerView åœ¨ Android Support Library 25.1.0 å¼•å…¥çš„é¢„å–ï¼ˆPrefetchï¼‰æœºåˆ¶ï¼Œç”¨äºåœ¨ UI ç©ºé—²æ—¶æå‰å‡†å¤‡å³å°†æ˜¾ç¤ºçš„ ViewHolderã€‚</p>
<h3 data-id="heading-21">ä¸ºä»€ä¹ˆéœ€è¦ GapWorkerï¼Ÿ</h3>
<h4 data-id="heading-22">ä¼ ç»Ÿæ»šåŠ¨çš„æ€§èƒ½é—®é¢˜</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">ç”¨æˆ·æ»šåŠ¨æ—¶çš„å¸§æ—¶é—´åˆ†å¸ƒï¼ˆæ²¡æœ‰</span> <span class="hljs-string">GapWorkerï¼‰ï¼š</span>

<span class="hljs-attr">Frame 1:</span> <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span> <span class="hljs-string">(16ms</span> <span class="hljs-bullet">-</span> <span class="hljs-string">æµç•…)</span>
         <span class="hljs-string">åªéœ€è¦æ¸²æŸ“å·²æœ‰çš„</span> <span class="hljs-string">ViewHolder</span>

<span class="hljs-attr">Frame 2:</span> <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span> <span class="hljs-string">(28ms</span> <span class="hljs-bullet">-</span> <span class="hljs-string">å¡é¡¿ï¼âš ï¸)</span>
         <span class="hljs-string">éœ€è¦åˆ›å»ºæ–°çš„</span> <span class="hljs-string">ViewHolderï¼š</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">inflate</span> <span class="hljs-string">XML</span> <span class="hljs-string">(8ms)</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">onCreateViewHolder</span> <span class="hljs-string">(2ms)</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">onBindViewHolder</span> <span class="hljs-string">(5ms)</span>
         <span class="hljs-bullet">-</span> <span class="hljs-string">measure</span> <span class="hljs-string">+</span> <span class="hljs-string">layout</span> <span class="hljs-string">(3ms)</span>
         <span class="hljs-string">æ€»è®¡è¶…è¿‡</span> <span class="hljs-string">16ms</span> <span class="hljs-string">â†’</span> <span class="hljs-string">æ‰å¸§ï¼</span>

<span class="hljs-attr">Frame 3:</span> <span class="hljs-string">â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ</span> <span class="hljs-string">(16ms</span> <span class="hljs-bullet">-</span> <span class="hljs-string">æµç•…)</span>
</code></pre>
<h4 data-id="heading-23">æœ‰äº† GapWorker ä¹‹å</h4>
<pre><code class="hljs language-markdown" lang="markdown">Frame 1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (16ms - æµç•…)
<span class="hljs-code">         æ¸²æŸ“ + GapWorker åœ¨ç©ºé—²æ—¶é—´é¢„å–
</span>
Frame 2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (14ms - æµç•…ï¼âœ…)
<span class="hljs-code">         ç›´æ¥ä½¿ç”¨é¢„å–å¥½çš„ ViewHolder
</span>
ç©ºé—²æ—¶é—´: â–‘â–‘â–‘ (2ms)
<span class="hljs-code">         GapWorker ç»§ç»­é¢„å–ä¸‹ä¸€ä¸ª
</span></code></pre>
<h3 data-id="heading-24">GapWorker æ¶æ„</h3>
<pre><code class="hljs language-arduino" lang="arduino">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              <span class="hljs-built_in">GapWorker</span> (å•ä¾‹)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç®¡ç†å¤šä¸ª RecyclerView çš„é¢„å–ä»»åŠ¡                 â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   RecyclerView A çš„é¢„å–ä»»åŠ¡           â”‚      â”‚
â”‚  â”‚   - é¢„å– position <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>            â”‚      â”‚
â”‚  â”‚   - ä¼˜å…ˆçº§: é«˜                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   RecyclerView B çš„é¢„å–ä»»åŠ¡           â”‚      â”‚
â”‚  â”‚   - é¢„å– position <span class="hljs-number">10</span>                 â”‚      â”‚
â”‚  â”‚   - ä¼˜å…ˆçº§: ä¸­                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                 â”‚
â”‚  é€šè¿‡ Choreographer åœ¨æ¯ä¸€å¸§æ‰§è¡Œ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-25">å·¥ä½œæ—¶æœº</h3>
<p>GapWorker é€šè¿‡ <code>Choreographer</code> åœ¨æ¯ä¸€å¸§çš„ç‰¹å®šæ—¶æœºå·¥ä½œï¼š</p>
<pre><code class="hljs language-scss" lang="scss">Android æ¯ä¸€å¸§çš„æ—¶é—´åˆ†é…ï¼ˆ<span class="hljs-number">60</span>fps = <span class="hljs-number">16.67ms</span>ï¼‰ï¼š

<span class="hljs-number">0ms</span> â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ <span class="hljs-number">16.67ms</span>
â”‚                                    â”‚
â”œâ”€ <span class="hljs-selector-tag">Input</span> (è§¦æ‘¸äº‹ä»¶)                   â”‚
â”‚  çº¦ <span class="hljs-number">2ms</span>                             â”‚
â”‚                                    â”‚
â”œâ”€ <span class="hljs-attribute">Animation</span> (åŠ¨ç”»)                   â”‚
â”‚  çº¦ <span class="hljs-number">2ms</span>                             â”‚
â”‚                                    â”‚
â”œâ”€ Traversal (æµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶)        â”‚
â”‚  çº¦ <span class="hljs-number">8ms</span>                             â”‚
â”‚                                    â”‚
â”œâ”€ ç©ºé—²æ—¶é—´ â–‘â–‘â–‘â–‘â–‘â–‘                    â”‚ â† GapWorker åœ¨è¿™é‡Œå·¥ä½œï¼
â”‚  çº¦ <span class="hljs-number">4ms</span>                             â”‚
â”‚                                    â”‚
â””â”€ VSync ä¸‹ä¸€å¸§å¼€å§‹                   â”‚
</code></pre>
<h3 data-id="heading-26">é¢„å–ç­–ç•¥</h3>
<h4 data-id="heading-27">1. é¢„æµ‹ä¸‹ä¸€ä¸ªå¯è§çš„ä½ç½®</h4>
<pre><code class="hljs language-scss" lang="scss">ç”¨æˆ·å‘ä¸‹æ»šåŠ¨ï¼Œdy &gt; <span class="hljs-number">0</span>ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">5</span>  âœ…   â”‚ â† å®Œå…¨å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>  âœ…   â”‚ â† å®Œå…¨å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">7</span>  âœ…   â”‚ â† å®Œå…¨å¯è§
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">8</span>  âš ï¸   â”‚ â† éƒ¨åˆ†å¯è§ï¼Œç»§ç»­æ»šåŠ¨ä¼šå®Œå…¨æ˜¾ç¤º
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">9</span>  ğŸ¯   â”‚ â† å³å°†å¯è§ï¼Œéœ€è¦é¢„å–ï¼
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ <span class="hljs-attribute">position</span> <span class="hljs-number">10</span> ğŸ¯   â”‚ â† å¯èƒ½å¯è§ï¼Œä¹Ÿé¢„å–
  ï¼ˆå±å¹•å¤–ï¼‰

é¢„å–ä¼˜å…ˆçº§ï¼š
<span class="hljs-number">1</span>. <span class="hljs-attribute">position</span> <span class="hljs-number">9</span>  (ç´§æ€¥ï¼Œé©¬ä¸Šè¦æ˜¾ç¤º)
<span class="hljs-number">2</span>. <span class="hljs-attribute">position</span> <span class="hljs-number">10</span> (æ¬¡è¦ï¼Œå¯èƒ½è¦æ˜¾ç¤º)
</code></pre>
<h4 data-id="heading-28">2. LayoutManager çš„é¢„å–å®ç°</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// LinearLayoutManager çš„é¢„å–é€»è¾‘</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectInitialPrefetchPositions</span><span class="hljs-params">(
    adapterItemCount: <span class="hljs-type">Int</span>,
    layoutPrefetchRegistry: <span class="hljs-type">LayoutPrefetchRegistry</span>
)</span></span> {
    <span class="hljs-comment">// åˆå§‹å¸ƒå±€æ—¶çš„é¢„å–</span>
    <span class="hljs-keyword">val</span> prefetchCount = Math.min(
        adapterItemCount,
        mInitialPrefetchItemCount <span class="hljs-comment">// é»˜è®¤ 2 ä¸ª</span>
    )

    <span class="hljs-keyword">for</span> (i <span class="hljs-keyword">in</span> <span class="hljs-number">0</span> until prefetchCount) {
        layoutPrefetchRegistry.addPosition(i, <span class="hljs-number">0</span>)
    }
}

<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectAdditionalPrefetchPositions</span><span class="hljs-params">(
    dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>,
    state: <span class="hljs-type">RecyclerView</span>.<span class="hljs-type">State</span>,
    layoutPrefetchRegistry: <span class="hljs-type">LayoutPrefetchRegistry</span>
)</span></span> {
    <span class="hljs-comment">// æ»šåŠ¨æ—¶çš„é¢„å–</span>
    <span class="hljs-keyword">val</span> layoutDirection = <span class="hljs-keyword">if</span> (dy &gt; <span class="hljs-number">0</span>) <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span> <span class="hljs-comment">// æ»šåŠ¨æ–¹å‘</span>
    <span class="hljs-keyword">val</span> scrollingOffset = Math.abs(dy)

    <span class="hljs-comment">// è®¡ç®—éœ€è¦é¢„å–çš„ä½ç½®</span>
    <span class="hljs-keyword">val</span> prefetchPosition = getCurrentPosition() + layoutDirection

    <span class="hljs-comment">// æ³¨å†Œé¢„å–ä»»åŠ¡</span>
    layoutPrefetchRegistry.addPosition(prefetchPosition, scrollingOffset)
}
</code></pre>
<h4 data-id="heading-29">3. é¢„å–ä»»åŠ¡çš„æ•°æ®ç»“æ„</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// GapWorker å†…éƒ¨ä»»åŠ¡é˜Ÿåˆ—</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapWorker</span> {

    <span class="hljs-comment">// ä»»åŠ¡ç±»</span>
    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Task</span> {
        <span class="hljs-keyword">var</span> view: RecyclerView? = <span class="hljs-literal">null</span>
        <span class="hljs-keyword">var</span> position: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>
        <span class="hljs-keyword">var</span> immediate: <span class="hljs-built_in">Boolean</span> = <span class="hljs-literal">false</span>  <span class="hljs-comment">// æ˜¯å¦ç´§æ€¥</span>
        <span class="hljs-keyword">var</span> viewVelocity: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>       <span class="hljs-comment">// æ»šåŠ¨é€Ÿåº¦</span>
        <span class="hljs-keyword">var</span> distanceToItem: <span class="hljs-built_in">Int</span> = <span class="hljs-number">0</span>     <span class="hljs-comment">// è·ç¦»å½“å‰ä½ç½®çš„è·ç¦»</span>
    }

    <span class="hljs-comment">// ä»»åŠ¡ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼ˆæŒ‰ç´§æ€¥ç¨‹åº¦æ’åºï¼‰</span>
    <span class="hljs-keyword">val</span> mTasks = ArrayList&lt;Task&gt;()

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">sortTasks</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æ’åºï¼š</span>
        <span class="hljs-comment">// 1. immediate ä»»åŠ¡ä¼˜å…ˆ</span>
        <span class="hljs-comment">// 2. è·ç¦»è¿‘çš„ä¼˜å…ˆ</span>
        <span class="hljs-comment">// 3. æ»šåŠ¨é€Ÿåº¦å¿«çš„ä¼˜å…ˆ</span>
        mTasks.sortWith { task1, task2 -&gt;
            <span class="hljs-keyword">when</span> {
                task1.immediate &amp;&amp; !task2.immediate -&gt; -<span class="hljs-number">1</span>
                !task1.immediate &amp;&amp; task2.immediate -&gt; <span class="hljs-number">1</span>
                <span class="hljs-keyword">else</span> -&gt; task1.distanceToItem - task2.distanceToItem
            }
        }
    }
}
</code></pre>
<h3 data-id="heading-30">é¢„å–æ‰§è¡Œæµç¨‹</h3>
<h4 data-id="heading-31">è¯¦ç»†çš„æ‰§è¡Œæ­¥éª¤</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç®€åŒ–çš„æºç é€»è¾‘</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapWorker</span> : <span class="hljs-type">Runnable</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 1. è·å–æˆªæ­¢æ—¶é—´ï¼ˆå½“å‰å¸§ç»“æŸæ—¶é—´ï¼‰</span>
        <span class="hljs-keyword">val</span> deadlineNs = TimeUtils.currentAnimationTimeMillis() * <span class="hljs-number">1_000_000</span> + <span class="hljs-number">4_000_000</span>
        <span class="hljs-comment">// ç•™ 4ms ç»™ GapWorkerï¼Œå…¶ä»–æ—¶é—´ç•™ç»™æ¸²æŸ“</span>

        <span class="hljs-comment">// 2. æ‰§è¡Œé¢„å–ä»»åŠ¡</span>
        prefetch(deadlineNs)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">prefetch</span><span class="hljs-params">(deadlineNs: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-comment">// æŒ‰ä¼˜å…ˆçº§å¤„ç†ä»»åŠ¡</span>
        <span class="hljs-keyword">for</span> (task <span class="hljs-keyword">in</span> mTasks) {
            <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ—¶é—´</span>
            <span class="hljs-keyword">if</span> (System.nanoTime() &gt;= deadlineNs) {
                <span class="hljs-keyword">break</span> <span class="hljs-comment">// æ—¶é—´ç”¨å®Œï¼Œåœæ­¢é¢„å–</span>
            }

            <span class="hljs-comment">// æ‰§è¡Œé¢„å–</span>
            prefetchPositionWithDeadline(
                task.view,
                task.position,
                deadlineNs
            )
        }

        <span class="hljs-comment">// æ¸…ç©ºä»»åŠ¡é˜Ÿåˆ—</span>
        mTasks.clear()
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">prefetchPositionWithDeadline</span><span class="hljs-params">(
        view: <span class="hljs-type">RecyclerView</span>?,
        position: <span class="hljs-type">Int</span>,
        deadlineNs: <span class="hljs-type">Long</span>
    )</span></span>: ViewHolder? {
        <span class="hljs-comment">// è¿™é‡Œå°±æ˜¯å´©æºƒå‘ç”Ÿçš„åœ°æ–¹ï¼âš ï¸</span>

        <span class="hljs-keyword">val</span> holder = view?.mRecycler?.tryGetViewHolderForPositionByDeadline(
            position,
            <span class="hljs-literal">false</span>,
            deadlineNs
        )

        <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (holder.isBound &amp;&amp; !holder.isInvalid) {
                <span class="hljs-comment">// æˆåŠŸé¢„å–ï¼Œæ”¾å…¥ç¼“å­˜</span>
                view.mRecycler.recycleView(holder.itemView)
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// é¢„å–å¤±è´¥ï¼Œå›æ”¶</span>
                view.mRecycler.addViewHolderToRecycledViewPool(holder, <span class="hljs-literal">false</span>)
            }
        }

        <span class="hljs-keyword">return</span> holder
    }
}
</code></pre>
<h3 data-id="heading-32">ä¸ Recycler ç¼“å­˜çš„é…åˆ</h3>
<pre><code class="hljs language-bash" lang="bash">GapWorker é¢„å–çš„ ViewHolder æ”¾åœ¨å“ªé‡Œï¼Ÿ

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Recycler ç¼“å­˜ç³»ç»Ÿ                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  GapWorker é¢„å–                          â”‚
â”‚      â†“                                  â”‚
â”‚  åˆ›å»º/ç»‘å®š ViewHolder                     â”‚
â”‚      â†“                                  â”‚
â”‚  æ”¾å…¥ mCachedViews (ç¦»å±ç¼“å­˜)             â”‚  â† ä¼˜å…ˆæ”¾è¿™é‡Œ
â”‚      â”‚                                  â”‚
â”‚      â”œâ”€ å¦‚æœ mCachedViews æ»¡äº†           â”‚
â”‚      â””â”€â†’ æ”¾å…¥ RecycledViewPool           â”‚  â† æ¬¡é€‰
â”‚                                         â”‚
â”‚  å½“ item æ»šåŠ¨è¿›å±å¹•æ—¶ï¼š                   â”‚
â”‚      ä» mCachedViews ç›´æ¥å–å‡º âœ…          â”‚
â”‚      æ— éœ€é‡æ–° <span class="hljs-built_in">bind</span>ï¼                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3 data-id="heading-33">IndexOutOfBoundsException å´©æºƒåœºæ™¯è¯¦ç»†åˆ†æ</h3>
<h4 data-id="heading-34">å´©æºƒçš„æ—¶åºå›¾</h4>
<pre><code class="hljs language-scss" lang="scss">ä¸»çº¿ç¨‹ï¼ˆUI Threadï¼‰                   GapWorkerï¼ˆåå°ä»»åŠ¡ï¼‰
    â”‚                                      â”‚
    â”‚ ç”¨æˆ·æ»šåŠ¨åˆ° <span class="hljs-attribute">position</span> <span class="hljs-number">5</span>                â”‚
    â”‚ LayoutManager å¸ƒå±€å®Œæˆ                â”‚
    â”‚                                      â”‚
    â”œâ”€ <span class="hljs-built_in">collectPrefetchPositions</span>()          â”‚
    â”‚  å†³å®šé¢„å– <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>                 â”‚
    â”‚                                      â”‚
    â”‚ post GapWorker<span class="hljs-selector-class">.run</span>()                 â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’  â”‚
    â”‚                                      â”‚
    â”‚ ç»§ç»­æ¸²æŸ“ç•Œé¢                          â”‚  GapWorker<span class="hljs-selector-class">.run</span>() å¼€å§‹
    â”‚                                      â”‚  è¯»å–ä»»åŠ¡ï¼šé¢„å– <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>
    â”‚                                      â”‚
    â”‚ ç”¨æˆ·ç‚¹å‡»åˆ é™¤ <span class="hljs-attribute">position</span> <span class="hljs-number">2</span> âš ï¸            â”‚
    â”‚                                      â”‚
    â”œâ”€ <span class="hljs-built_in">onClick</span>() {                         â”‚
    â”‚    datas<span class="hljs-selector-class">.remove</span>(position <span class="hljs-number">2</span>)          â”‚  â† adapter ç°åœ¨åªæœ‰ <span class="hljs-number">9</span> æ¡æ•°æ®
    â”‚    <span class="hljs-built_in">notifyDataSetChanged</span>()            â”‚  â† åªæ˜¯æ ‡è®°ï¼Œæœªç«‹å³ç”Ÿæ•ˆï¼
    â”‚  }                                   â”‚
    â”‚                                      â”‚
    â”‚                                      â”œâ”€ <span class="hljs-built_in">prefetchPositionWithDeadline</span>(<span class="hljs-number">6</span>)
    â”‚                                      â”‚  è°ƒç”¨ adapter<span class="hljs-selector-class">.getItemCount</span>()
    â”‚                                      â”‚  è¿”å› <span class="hljs-number">9</span>ï¼ˆå·²ç»åˆ é™¤äº†ä¸€æ¡ï¼‰
    â”‚                                      â”‚
    â”‚                                      â”œâ”€ <span class="hljs-built_in">validateViewHolderForOffsetPosition</span>()
    â”‚                                      â”‚  æ£€æŸ¥ <span class="hljs-attribute">position</span> <span class="hljs-number">6</span> æ˜¯å¦æœ‰æ•ˆ
    â”‚                                      â”‚
    â”‚                                      â”‚  GapWorker è®¤ä¸ºï¼š
    â”‚                                      â”‚  - ä¹‹å‰è®¡åˆ’é¢„å– <span class="hljs-attribute">position</span> <span class="hljs-number">6</span>
    â”‚                                      â”‚  - ä½†ç°åœ¨ adapter åªæœ‰ <span class="hljs-number">9</span> æ¡æ•°æ®
    â”‚                                      â”‚  - ViewHolder çš„ä½ç½®ä¿¡æ¯ä¸ä¸€è‡´
    â”‚                                      â”‚
    â”‚                                      â”‚  æŠ›å‡ºå¼‚å¸¸ï¼šâš ï¸
    â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  IndexOutOfBoundsException:
    â”‚                                      â”‚  Inconsistency detected!
    â”‚                                      â”‚
    â”‚ CRASH! â˜ ï¸                            â”‚
</code></pre>
<h4 data-id="heading-35">å…³é”®ä»£ç è·¯å¾„</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// RecyclerView.Recycler</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">tryGetViewHolderForPositionByDeadline</span><span class="hljs-params">(
    position: <span class="hljs-type">Int</span>,
    dryRun: <span class="hljs-type">Boolean</span>,
    deadlineNs: <span class="hljs-type">Long</span>
)</span></span>: ViewHolder? {

    <span class="hljs-comment">// ... çœç•¥ç¼“å­˜æŸ¥æ‰¾é€»è¾‘</span>

    <span class="hljs-comment">// å…³é”®æ£€æŸ¥ç‚¹ï¼šéªŒè¯ ViewHolder çš„ä½ç½®æ˜¯å¦æœ‰æ•ˆ</span>
    <span class="hljs-keyword">if</span> (holder != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (!holder.isValid || holder.position != position) {
            <span class="hljs-comment">// è¿™é‡Œæ£€æµ‹åˆ°ä¸ä¸€è‡´ï¼âš ï¸</span>
            <span class="hljs-keyword">throw</span> IndexOutOfBoundsException(
                <span class="hljs-string">"Inconsistency detected. Invalid view holder "</span> +
                <span class="hljs-string">"adapter position <span class="hljs-variable">$holder</span>"</span>
            )
        }
    }

    <span class="hljs-keyword">return</span> holder
}

<span class="hljs-comment">// ä¸ºä»€ä¹ˆä¼šä¸ä¸€è‡´ï¼Ÿ</span>
<span class="hljs-comment">// 1. GapWorker è®¡åˆ’é¢„å–æ—¶ï¼šadapter.getItemCount() = 10</span>
<span class="hljs-comment">// 2. ç”¨æˆ·åˆ é™¤åï¼šadapter.getItemCount() = 9</span>
<span class="hljs-comment">// 3. ä½† GapWorker è¿˜åœ¨ç”¨æ—§çš„ position 6</span>
<span class="hljs-comment">// 4. position 6 åœ¨æ–°çš„æ•°æ®é›†ä¸­å¯èƒ½è¶Šç•Œæˆ–æŒ‡å‘é”™è¯¯çš„æ•°æ®</span>
</code></pre>
<h3 data-id="heading-36">ä¸ºä»€ä¹ˆç²¾ç¡®é€šçŸ¥èƒ½è§£å†³ï¼Ÿ</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯æ–¹å¼</span>
datas.remove(<span class="hljs-keyword">data</span>)
notifyDataSetChanged()

<span class="hljs-comment">// notifyDataSetChanged() åšäº†ä»€ä¹ˆï¼Ÿ</span>
<span class="hljs-comment">// 1. æ ‡è®°æ‰€æœ‰ ViewHolder ä¸º FLAG_INVALID</span>
<span class="hljs-comment">// 2. æ ‡è®° adapter ä¸º hasStableIds = false</span>
<span class="hljs-comment">// 3. è§¦å‘ requestLayout()</span>
<span class="hljs-comment">// 4. ä½†è¿™äº›éƒ½æ˜¯å¼‚æ­¥çš„ï¼ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼</span>
<span class="hljs-comment">// 5. GapWorker è¿˜åœ¨ä½¿ç”¨æ—§çš„ä½ç½®ä¿¡æ¯ âš ï¸</span>
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®æ–¹å¼</span>
<span class="hljs-keyword">val</span> position = datas.indexOf(<span class="hljs-keyword">data</span>)
<span class="hljs-keyword">if</span> (position != -<span class="hljs-number">1</span>) {
    datas.remove(<span class="hljs-keyword">data</span>)
    notifyItemRemoved(position)
    notifyItemRangeChanged(position, datas.size - position)
}

<span class="hljs-comment">// notifyItemRemoved() åšäº†ä»€ä¹ˆï¼Ÿ</span>
<span class="hljs-comment">// 1. ç«‹å³æ›´æ–° RecyclerView çš„å†…éƒ¨ AdapterHelper</span>
<span class="hljs-comment">// 2. AdapterHelper ç»´æŠ¤ä½ç½®æ›´æ–°æ“ä½œé˜Ÿåˆ—</span>
<span class="hljs-comment">// 3. å‘Šè¯‰ RecyclerViewï¼šposition è¢«ç§»é™¤äº†</span>
<span class="hljs-comment">// 4. RecyclerView ç«‹å³æ›´æ–°æ‰€æœ‰ ViewHolder çš„ä½ç½®</span>
<span class="hljs-comment">// 5. GapWorker æŸ¥è¯¢ä½ç½®æ—¶ï¼Œè·å¾—çš„æ˜¯æ›´æ–°åçš„æ­£ç¡®ä½ç½® âœ…</span>
</code></pre>
<h4 data-id="heading-37">AdapterHelper çš„ä½œç”¨</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// RecyclerView å†…éƒ¨çš„ AdapterHelper</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AdapterHelper</span> {

    <span class="hljs-comment">// ä¿å­˜æ‰€æœ‰çš„æ•°æ®å˜æ›´æ“ä½œ</span>
    <span class="hljs-keyword">val</span> mPendingUpdates = ArrayList&lt;UpdateOp&gt;()

    <span class="hljs-comment">// æ“ä½œç±»å‹</span>
    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> ADD = <span class="hljs-number">1</span>      <span class="hljs-comment">// æ’å…¥</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> REMOVE = <span class="hljs-number">2</span>   <span class="hljs-comment">// åˆ é™¤</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> UPDATE = <span class="hljs-number">3</span>   <span class="hljs-comment">// æ›´æ–°</span>
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> MOVE = <span class="hljs-number">4</span>     <span class="hljs-comment">// ç§»åŠ¨</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onItemRangeRemoved</span><span class="hljs-params">(positionStart: <span class="hljs-type">Int</span>, itemCount: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// åˆ›å»ºåˆ é™¤æ“ä½œ</span>
        <span class="hljs-keyword">val</span> op = UpdateOp(REMOVE, positionStart, itemCount)
        mPendingUpdates.add(op)

        <span class="hljs-comment">// ç«‹å³åº”ç”¨åˆ°ä½ç½®æ˜ å°„</span>
        applyRemove(op)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">applyRemove</span><span class="hljs-params">(op: <span class="hljs-type">UpdateOp</span>)</span></span> {
        <span class="hljs-comment">// æ›´æ–°åç»­æ‰€æœ‰ ViewHolder çš„ä½ç½®</span>
        <span class="hljs-keyword">for</span> (holder <span class="hljs-keyword">in</span> mCachedViews) {
            <span class="hljs-keyword">if</span> (holder.position &gt;= op.positionStart) {
                holder.offsetPosition(-op.itemCount, <span class="hljs-literal">false</span>)
            }
        }

        <span class="hljs-comment">// GapWorker è¯»å–ä½ç½®æ—¶ï¼Œä¼šç»è¿‡è¿™ä¸ªæ˜ å°„ âœ…</span>
        <span class="hljs-comment">// æ‰€ä»¥è·å¾—çš„æ˜¯æ­£ç¡®çš„ä½ç½®</span>
    }
}
</code></pre>
<h3 data-id="heading-38">GapWorker çš„ä¼˜ç¼ºç‚¹</h3>
<h4 data-id="heading-39">ä¼˜ç‚¹ âœ…</h4>
<ol>
<li><strong>æ˜¾è‘—æå‡æ»šåŠ¨æµç•…åº¦</strong>ï¼šé¿å…æ»šåŠ¨æ—¶åˆ›å»º ViewHolder å¯¼è‡´çš„å¡é¡¿</li>
<li><strong>æ™ºèƒ½é¢„æµ‹</strong>ï¼šæ ¹æ®æ»šåŠ¨æ–¹å‘å’Œé€Ÿåº¦é¢„æµ‹</li>
<li><strong>æ—¶é—´æ§åˆ¶</strong>ï¼šä¸ä¼šå ç”¨å¤ªå¤šå¸§æ—¶é—´ï¼ˆé»˜è®¤ 4msï¼‰</li>
<li><strong>å¤š RecyclerView æ”¯æŒ</strong>ï¼šä¸€ä¸ª GapWorker ç®¡ç†å¤šä¸ªåˆ—è¡¨</li>
</ol>
<h4 data-id="heading-40">ç¼ºç‚¹å’Œé£é™© âš ï¸</h4>
<ol>
<li><strong>æ•°æ®ä¸ä¸€è‡´å´©æºƒ</strong>ï¼šå¦‚é‡åˆ°çš„ IndexOutOfBoundsException</li>
<li><strong>è¿‡åº¦é¢„å–</strong>ï¼šå¯èƒ½é¢„å–ç”¨ä¸åˆ°çš„ ViewHolderï¼Œæµªè´¹èµ„æº</li>
<li><strong>å¤æ‚æ€§å¢åŠ </strong>ï¼šå¢åŠ äº†è°ƒè¯•éš¾åº¦</li>
<li><strong>å†…å­˜å ç”¨</strong>ï¼šé¢„å–çš„ ViewHolder ä¼šå ç”¨é¢å¤–å†…å­˜</li>
</ol>
<h3 data-id="heading-41">æœ€ä½³å®è·µ</h3>
<h4 data-id="heading-42">1. å§‹ç»ˆä½¿ç”¨ç²¾ç¡®é€šçŸ¥</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®</span>
adapter.notifyItemRemoved(position)
adapter.notifyItemInserted(position)
adapter.notifyItemChanged(position)

<span class="hljs-comment">// âŒ é¿å…</span>
adapter.notifyDataSetChanged()
</code></pre>
<h4 data-id="heading-43">2. åœ¨ä¸»çº¿ç¨‹ä¿®æ”¹æ•°æ®</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âœ… æ­£ç¡®</span>
lifecycleScope.launch(Dispatchers.Main) {
    adapter.removeItem(position)
}

<span class="hljs-comment">// âŒ é”™è¯¯ï¼šåå°çº¿ç¨‹ä¿®æ”¹</span>
lifecycleScope.launch(Dispatchers.IO) {
    adapter.removeItem(position) <span class="hljs-comment">// å¯èƒ½ä¸ GapWorker å†²çª</span>
}
</code></pre>
<h4 data-id="heading-44">3. ä½¿ç”¨ DiffUtil</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// DiffUtil ä¼šè‡ªåŠ¨è®¡ç®—å·®å¼‚å¹¶è°ƒç”¨ç²¾ç¡®çš„ notify æ–¹æ³•</span>
<span class="hljs-keyword">val</span> diffResult = DiffUtil.calculateDiff(MyDiffCallback(oldList, newList))
diffResult.dispatchUpdatesTo(adapter)
</code></pre>
<h4 data-id="heading-45">4. ä¼˜åŒ– onBindViewHolder</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// GapWorker ä¼šè°ƒç”¨ bindï¼Œæ‰€ä»¥è¦ä¿æŒé«˜æ•ˆ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onBindViewHolder</span><span class="hljs-params">(holder: <span class="hljs-type">ViewHolder</span>, position: <span class="hljs-type">Int</span>)</span></span> {
    <span class="hljs-comment">// âœ… å¿«é€Ÿç»‘å®š</span>
    holder.textView.text = <span class="hljs-keyword">data</span>[position].title

    <span class="hljs-comment">// âŒ é¿å…è€—æ—¶æ“ä½œ</span>
    <span class="hljs-comment">// loadImageFromNetwork()</span>
    <span class="hljs-comment">// complexCalculation()</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-46">ä¸‰ã€Choreographer è¯¦è§£</h2>
<p>Choreographer æ˜¯ Android 4.1ï¼ˆAPI 16ï¼‰å¼•å…¥çš„æ ¸å¿ƒç±»ï¼Œç”¨äºåè°ƒåŠ¨ç”»ã€è¾“å…¥å’Œç»˜åˆ¶çš„æ—¶é—´ã€‚å®ƒçš„åå­—æ¥è‡ªæ³•è¯­"ChorÃ©graphe"ï¼Œæ„ä¸º"ç¼–èˆè€…"ï¼Œè´Ÿè´£ç¼–æ’ UI çº¿ç¨‹çš„å„ç§æ“ä½œã€‚</p>
<h3 data-id="heading-47">ä¸ºä»€ä¹ˆéœ€è¦ Choreographerï¼Ÿ</h3>
<h4 data-id="heading-48">Android 4.1 ä¹‹å‰çš„é—®é¢˜</h4>
<pre><code class="hljs language-markdown" lang="markdown">æ²¡æœ‰ Choreographer çš„æ¸²æŸ“ï¼ˆæ··ä¹±ï¼‰ï¼š

æ—¶é—´è½´ï¼š
0ms     5ms     10ms    15ms    20ms
â”‚       â”‚       â”‚       â”‚       â”‚
â”œâ”€ åŠ¨ç”»æ›´æ–°
â”‚       â”œâ”€ ç»˜åˆ¶æ“ä½œ
â”‚               â”œâ”€ è§¦æ‘¸äº‹ä»¶
â”‚                       â”œâ”€ ç»˜åˆ¶æ“ä½œ
â”‚                               â””â”€ åŠ¨ç”»æ›´æ–°

é—®é¢˜ï¼š
<span class="hljs-bullet">1.</span> æ¸²æŸ“æ—¶æœºä¸ç»Ÿä¸€ï¼Œéšæœºè§¦å‘
<span class="hljs-bullet">2.</span> å¯èƒ½åœ¨å±å¹•åˆ·æ–°çš„ä»»ä½•æ—¶åˆ»ç»˜åˆ¶
<span class="hljs-bullet">3.</span> é€ æˆç”»é¢æ’•è£‚ï¼ˆTearingï¼‰
<span class="hljs-bullet">4.</span> æ— æ³•ä¿è¯ 60fps
</code></pre>
<h4 data-id="heading-49">æœ‰äº† Choreographer ä¹‹å</h4>
<pre><code class="hljs language-css" lang="css">VSync ä¿¡å·å¯¹é½ï¼ˆæ•´é½ï¼‰ï¼š

æ—¶é—´è½´ï¼ˆ<span class="hljs-number">60</span>fps = <span class="hljs-number">16.67ms</span>ä¸€å¸§ï¼‰ï¼š
<span class="hljs-number">0ms</span>           <span class="hljs-number">16.67ms</span>        <span class="hljs-number">33.34ms</span>
â”‚             â”‚              â”‚
VSync â”€â”€â”€â”€â”€â”€â”€â”€VSync â”€â”€â”€â”€â”€â”€â”€â”€ VSync
â”‚             â”‚              â”‚
â”œâ”€ <span class="hljs-selector-tag">Input</span>      â”œâ”€ <span class="hljs-selector-tag">Input</span>       â”œâ”€ <span class="hljs-selector-tag">Input</span>
â”œâ”€ <span class="hljs-attribute">Animation</span>  â”œâ”€ <span class="hljs-attribute">Animation</span>   â”œâ”€ <span class="hljs-attribute">Animation</span>
â”œâ”€ Traversal  â”œâ”€ Traversal   â”œâ”€ Traversal
â””â”€ Commit     â””â”€ Commit      â””â”€ Commit

ä¼˜ç‚¹ï¼š
<span class="hljs-number">1</span>. æ‰€æœ‰æ¸²æŸ“æ“ä½œå¯¹é½åˆ° VSync ä¿¡å·
<span class="hljs-number">2</span>. ç”»é¢æµç•…ï¼Œæ— æ’•è£‚
<span class="hljs-number">3</span>. å¯é¢„æµ‹çš„å¸§ç‡
</code></pre>
<h3 data-id="heading-50">VSyncï¼ˆå‚ç›´åŒæ­¥ï¼‰æœºåˆ¶</h3>
<h4 data-id="heading-51">ä»€ä¹ˆæ˜¯ VSyncï¼Ÿ</h4>
<pre><code class="hljs language-ini" lang="ini">å±å¹•åˆ·æ–°åŸç†ï¼š

LCD/OLED å±å¹•çš„ç”µå­æªä»ä¸Šåˆ°ä¸‹é€è¡Œæ‰«æï¼š

ç¬¬1è¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ç¬¬2è¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ç¬¬3è¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
...    ...
ç¬¬Nè¡Œ  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ‰«æå®Œä¸€å±åï¼Œå›åˆ°é¡¶éƒ¨ï¼ˆå‚ç›´å›æ‰«ï¼‰
æ­¤æ—¶å‘å‡º VSync ä¿¡å· ğŸ“¡

<span class="hljs-attr">VSync</span> = Vertical Synchronizationï¼ˆå‚ç›´åŒæ­¥ï¼‰
</code></pre>
<h4 data-id="heading-52">å±å¹•æ’•è£‚ï¼ˆTearingï¼‰é—®é¢˜</h4>
<pre><code class="hljs">æ²¡æœ‰ VSync åŒæ­¥ï¼š

GPU æ­£åœ¨æ¸²æŸ“ Frame 2      å±å¹•æ­£åœ¨æ˜¾ç¤º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚           â”‚ Frame 1 ä¸ŠåŠâ”‚ â† æ˜¾ç¤ºæ—§å¸§
â”‚  Frame 2    â”‚ â”€â”€â”€â”€â†’     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â† æ’•è£‚çº¿ï¼
â”‚             â”‚           â”‚ Frame 2 ä¸‹åŠâ”‚ â† æ˜¾ç¤ºæ–°å¸§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·çœ‹åˆ°çš„ç”»é¢ä¸è¿è´¯ âš ï¸
</code></pre>
<pre><code class="hljs language-scss" lang="scss">æœ‰äº† VSync åŒæ­¥ï¼š

ç­‰å¾… VSync ä¿¡å·æ‰æäº¤æ–°å¸§

GPU æ¸²æŸ“ Frame <span class="hljs-number">2</span>          VSync ä¿¡å·      å±å¹•æ˜¾ç¤º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚           â”‚              â”‚             â”‚
â”‚  Frame <span class="hljs-number">2</span>    â”‚ â”€â”€â”€â”€â”€ç­‰å¾…â”€â”¤ VSync ğŸ“¡ â”€â”€â”€â†’â”‚  Frame <span class="hljs-number">2</span>    â”‚
â”‚             â”‚           â”‚              â”‚  (å®Œæ•´)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”»é¢æµç•…æ— æ’•è£‚ âœ…
</code></pre>
<h4 data-id="heading-53">åŒç¼“å†²ï¼ˆDouble Bufferingï¼‰</h4>
<pre><code class="hljs language-markdown" lang="markdown">Android çš„åŒç¼“å†²æœºåˆ¶ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  æ˜¾ç¤º      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Front Buffer â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚  Screen  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
<span class="hljs-code">       â†‘
       â”‚ VSync æ—¶äº¤æ¢
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  ç»˜åˆ¶
â”‚ Back Buffer  â”‚ â†â”€â”€â”€â”€ GPU åœ¨è¿™é‡Œç»˜åˆ¶ä¸‹ä¸€å¸§
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</span>
å·¥ä½œæµç¨‹ï¼š
<span class="hljs-bullet">1.</span> GPU åœ¨ Back Buffer ç»˜åˆ¶
<span class="hljs-bullet">2.</span> VSync ä¿¡å·åˆ°æ¥
<span class="hljs-bullet">3.</span> äº¤æ¢ Front å’Œ Back Buffer
<span class="hljs-bullet">4.</span> å±å¹•æ˜¾ç¤º Front Buffer
<span class="hljs-bullet">5.</span> GPU ç»§ç»­åœ¨æ–°çš„ Back Buffer ç»˜åˆ¶
</code></pre>
<h3 data-id="heading-54">Choreographer æ¶æ„</h3>
<h4 data-id="heading-55">æ ¸å¿ƒç»„ä»¶</h4>
<pre><code class="hljs language-scss" lang="scss">â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Choreographer (ç¼–èˆè€…)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  CallbackQueue (å›è°ƒé˜Ÿåˆ—)                â”‚   â”‚
â”‚  â”‚                                         â”‚   â”‚
â”‚  â”‚  CALLBACK_INPUT      (è§¦æ‘¸è¾“å…¥)         â”‚   â”‚
â”‚  â”‚  CALLBACK_ANIMATION  (åŠ¨ç”»)             â”‚   â”‚
â”‚  â”‚  CALLBACK_TRAVERSAL  (æµ‹é‡/å¸ƒå±€/ç»˜åˆ¶)    â”‚   â”‚
â”‚  â”‚  CALLBACK_COMMIT     (æäº¤)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FrameDisplayEventReceiver              â”‚   â”‚
â”‚  â”‚  (æ¥æ”¶ VSync ä¿¡å·)                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FrameHandler                           â”‚   â”‚
â”‚  â”‚  (ä¸»çº¿ç¨‹ Handlerï¼Œå¤„ç†å›è°ƒ)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†‘
           â”‚ VSync ä¿¡å·
           â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  SurfaceFlinger  â”‚ â† ç³»ç»ŸæœåŠ¡
    â”‚  (å±å¹•åˆæˆå™¨)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h4 data-id="heading-56">Choreographer æ˜¯å•ä¾‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Choreographer æ¯ä¸ªçº¿ç¨‹ä¸€ä¸ªå®ä¾‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Choreographer</span> <span class="hljs-keyword">private</span> <span class="hljs-keyword">constructor</span>(looper: Looper) {

    <span class="hljs-keyword">companion</span> <span class="hljs-keyword">object</span> {
        <span class="hljs-comment">// ThreadLocal ä¿è¯æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹</span>
        <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> sThreadInstance = ThreadLocal&lt;Choreographer&gt;()

        <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>: Choreographer {
            <span class="hljs-keyword">return</span> sThreadInstance.<span class="hljs-keyword">get</span>() ?: synchronized(Choreographer::<span class="hljs-keyword">class</span>.java) {
                Choreographer(Looper.myLooper()).also {
                    sThreadInstance.<span class="hljs-keyword">set</span>(it)
                }
            }
        }
    }
}

<span class="hljs-comment">// ä½¿ç”¨ç¤ºä¾‹</span>
<span class="hljs-comment">// ä¸»çº¿ç¨‹çš„ Choreographer</span>
<span class="hljs-keyword">val</span> mainChoreographer = Choreographer.getInstance() <span class="hljs-comment">// UI çº¿ç¨‹</span>

<span class="hljs-comment">// å…¶ä»–çº¿ç¨‹éœ€è¦å…ˆåˆ›å»º Looper</span>
thread {
    Looper.prepare()
    <span class="hljs-keyword">val</span> threadChoreographer = Choreographer.getInstance() <span class="hljs-comment">// ç‹¬ç«‹å®ä¾‹</span>
    Looper.loop()
}
</code></pre>
<h3 data-id="heading-57">å››ç§å›è°ƒç±»å‹</h3>
<p>Choreographer å®šä¹‰äº†å››ç§å›è°ƒç±»å‹ï¼ŒæŒ‰æ‰§è¡Œé¡ºåºï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Choreographer çš„å›è°ƒç±»å‹</span>
<span class="hljs-keyword">object</span> Choreographer {
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_INPUT = <span class="hljs-number">0</span>      <span class="hljs-comment">// è¾“å…¥äº‹ä»¶</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_ANIMATION = <span class="hljs-number">1</span>  <span class="hljs-comment">// åŠ¨ç”»</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_TRAVERSAL = <span class="hljs-number">2</span>  <span class="hljs-comment">// éå†ï¼ˆæµ‹é‡ã€å¸ƒå±€ã€ç»˜åˆ¶ï¼‰</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">val</span> CALLBACK_COMMIT = <span class="hljs-number">3</span>     <span class="hljs-comment">// æäº¤</span>
}
</code></pre>
<h4 data-id="heading-58">æ‰§è¡Œé¡ºåºå’Œæ—¶é—´åˆ†é…</h4>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">ä¸€å¸§çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼ˆ16.67ms</span> <span class="hljs-string">@</span> <span class="hljs-string">60fpsï¼‰ï¼š</span>

<span class="hljs-string">VSync</span> <span class="hljs-string">ä¿¡å·åˆ°è¾¾</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">0-2ms:</span> <span class="hljs-string">CALLBACK_INPUT</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">å¤„ç†è§¦æ‘¸äº‹ä»¶</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">åˆ†å‘ç‚¹å‡»äº‹ä»¶</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æ›´æ–°è§¦æ‘¸çŠ¶æ€</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">2-4ms:</span> <span class="hljs-string">CALLBACK_ANIMATION</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ValueAnimator.animateValue()</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ObjectAnimator</span> <span class="hljs-string">æ›´æ–°å±æ€§</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">è§†å›¾åŠ¨ç”»æ›´æ–°</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">GapWorker.postFromTraversal()</span> <span class="hljs-string">â†</span> <span class="hljs-string">åœ¨è¿™é‡Œæ³¨å†Œé¢„å–</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">4-14ms:</span> <span class="hljs-string">CALLBACK_TRAVERSAL</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">ViewRootImpl.performTraversals()</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">measure</span> <span class="hljs-string">(æµ‹é‡)</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">â”œâ”€</span> <span class="hljs-string">layout</span> <span class="hljs-string">(å¸ƒå±€)</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">draw</span> <span class="hljs-string">(ç»˜åˆ¶)</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">ç”Ÿæˆ</span> <span class="hljs-string">DisplayList</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â”œâ”€</span> <span class="hljs-attr">14-16ms:</span> <span class="hljs-string">CALLBACK_COMMIT</span>
<span class="hljs-string">â”‚</span>  <span class="hljs-string">â””â”€</span> <span class="hljs-string">æäº¤æ¸²æŸ“æ•°æ®åˆ°</span> <span class="hljs-string">RenderThread</span>
<span class="hljs-string">â”‚</span>
<span class="hljs-string">â””â”€</span> <span class="hljs-attr">16ms:</span> <span class="hljs-string">ç©ºé—²æ—¶é—´</span>
   <span class="hljs-string">â””â”€</span> <span class="hljs-string">GapWorker.run()</span> <span class="hljs-string">â†</span> <span class="hljs-string">RecyclerView</span> <span class="hljs-string">é¢„å–åœ¨è¿™é‡Œæ‰§è¡Œï¼</span>
</code></pre>
<h4 data-id="heading-59">è¯¦ç»†è¯´æ˜æ¯ç§å›è°ƒ</h4>
<h5 data-id="heading-60">1. CALLBACK_INPUTï¼ˆè¾“å…¥ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// è§¦æ‘¸äº‹ä»¶çš„åˆ†å‘</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRootImpl</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">deliverInputEvent</span><span class="hljs-params">(event: <span class="hljs-type">InputEvent</span>)</span></span> {
        <span class="hljs-comment">// è§¦æ‘¸äº‹ä»¶ä¼šåœ¨ CALLBACK_INPUT é˜¶æ®µå¤„ç†</span>
        Choreographer.getInstance().postCallback(
            Choreographer.CALLBACK_INPUT,
            { processInputEvent(event) },
            <span class="hljs-literal">null</span>
        )
    }
}

<span class="hljs-comment">// ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¿è¯è§¦æ‘¸å“åº”å¿«é€Ÿ</span>
</code></pre>
<h5 data-id="heading-61">2. CALLBACK_ANIMATIONï¼ˆåŠ¨ç”»ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ValueAnimator çš„å®ç°</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ValueAnimator</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// æ³¨å†ŒåŠ¨ç”»å›è°ƒ</span>
        AnimationHandler.getInstance().addAnimationFrameCallback(<span class="hljs-keyword">this</span>)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doAnimationFrame</span><span class="hljs-params">(frameTime: <span class="hljs-type">Long</span>)</span></span>: <span class="hljs-built_in">Boolean</span> {
        <span class="hljs-comment">// æ¯ä¸€å¸§æ›´æ–°åŠ¨ç”»å€¼</span>
        <span class="hljs-keyword">val</span> fraction = (frameTime - mStartTime) / mDuration
        <span class="hljs-keyword">val</span> animatedValue = mInterpolator.getInterpolation(fraction)

        <span class="hljs-comment">// æ›´æ–°å±æ€§</span>
        mUpdateListeners.forEach { it.onAnimationUpdate(<span class="hljs-keyword">this</span>) }

        <span class="hljs-keyword">return</span> fraction &lt; <span class="hljs-number">1.0</span> <span class="hljs-comment">// æ˜¯å¦ç»§ç»­åŠ¨ç”»</span>
    }
}

<span class="hljs-comment">// AnimationHandler å†…éƒ¨ä½¿ç”¨ CALLBACK_ANIMATION</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">AnimationHandler</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-comment">// æ‰§è¡Œæ‰€æœ‰åŠ¨ç”»</span>
            mAnimationCallbacks.forEach {
                it.doAnimationFrame(frameTimeNanos)
            }

            <span class="hljs-comment">// å¦‚æœè¿˜æœ‰åŠ¨ç”»ï¼Œæ³¨å†Œä¸‹ä¸€å¸§</span>
            <span class="hljs-keyword">if</span> (mAnimationCallbacks.isNotEmpty()) {
                Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">addAnimationFrameCallback</span><span class="hljs-params">(callback: <span class="hljs-type">AnimationFrameCallback</span>)</span></span> {
        <span class="hljs-keyword">if</span> (mAnimationCallbacks.isEmpty()) {
            <span class="hljs-comment">// ç¬¬ä¸€ä¸ªåŠ¨ç”»ï¼Œå¼€å§‹ç›‘å¬å¸§å›è°ƒ</span>
            Choreographer.getInstance().postFrameCallback(mFrameCallback)
        }
        mAnimationCallbacks.add(callback)
    }
}
</code></pre>
<h5 data-id="heading-62">3. CALLBACK_TRAVERSALï¼ˆéå†ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ViewRootImpl çš„ç»˜åˆ¶æµç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewRootImpl</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scheduleTraversals</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> (!mTraversalScheduled) {
            mTraversalScheduled = <span class="hljs-literal">true</span>

            <span class="hljs-comment">// æ³¨å†Œéå†å›è°ƒ</span>
            mChoreographer.postCallback(
                Choreographer.CALLBACK_TRAVERSAL,
                mTraversalRunnable,  <span class="hljs-comment">// æ‰§è¡Œ performTraversals</span>
                <span class="hljs-literal">null</span>
            )
        }
    }

    <span class="hljs-keyword">val</span> mTraversalRunnable = Runnable {
        doTraversal()
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doTraversal</span><span class="hljs-params">()</span></span> {
        performTraversals()
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">performTraversals</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// 1. æµ‹é‡</span>
        performMeasure(childWidthMeasureSpec, childHeightMeasureSpec)

        <span class="hljs-comment">// 2. å¸ƒå±€</span>
        performLayout(lp, mWidth, mHeight)

        <span class="hljs-comment">// 3. ç»˜åˆ¶</span>
        performDraw()
    }
}
</code></pre>
<h5 data-id="heading-63">4. CALLBACK_COMMITï¼ˆæäº¤ï¼‰</h5>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// æäº¤æ¸²æŸ“æ•°æ®åˆ° RenderThread</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadedRenderer</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">draw</span><span class="hljs-params">(view: <span class="hljs-type">View</span>)</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_COMMIT é˜¶æ®µæäº¤</span>
        updateRootDisplayList(view, callbacks)

        <span class="hljs-comment">// æ³¨å†Œ commit å›è°ƒ</span>
        mChoreographer.postCallback(
            Choreographer.CALLBACK_COMMIT,
            {
                <span class="hljs-comment">// åŒæ­¥æ¸²æŸ“æ•°æ®</span>
                nSyncAndDrawFrame(mNativeProxy, frameInfo)
            },
            <span class="hljs-literal">null</span>
        )
    }
}
</code></pre>
<h3 data-id="heading-64">Choreographer å·¥ä½œæµç¨‹</h3>
<h4 data-id="heading-65">å®Œæ•´çš„æ‰§è¡Œæµç¨‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç®€åŒ–çš„ Choreographer æºç </span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">Choreographer</span> {

    <span class="hljs-comment">// 1. æ³¨å†Œå›è°ƒ</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">postCallback</span><span class="hljs-params">(callbackType: <span class="hljs-type">Int</span>, action: <span class="hljs-type">Runnable</span>, token: <span class="hljs-type">Any</span>?)</span></span> {
        postCallbackDelayed(callbackType, action, token, <span class="hljs-number">0</span>)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">postCallbackDelayed</span><span class="hljs-params">(
        callbackType: <span class="hljs-type">Int</span>,
        action: <span class="hljs-type">Runnable</span>,
        token: <span class="hljs-type">Any</span>?,
        delayMillis: <span class="hljs-type">Long</span>
    )</span></span> {
        <span class="hljs-comment">// æ·»åŠ åˆ°å¯¹åº”ç±»å‹çš„é˜Ÿåˆ—</span>
        mCallbackQueues[callbackType].addCallbackLocked(action, token)

        <span class="hljs-comment">// è¯·æ±‚ VSync ä¿¡å·</span>
        scheduleFrameLocked()
    }

    <span class="hljs-comment">// 2. è¯·æ±‚ VSync</span>
    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scheduleFrameLocked</span><span class="hljs-params">()</span></span> {
        <span class="hljs-keyword">if</span> (!mFrameScheduled) {
            mFrameScheduled = <span class="hljs-literal">true</span>

            <span class="hljs-keyword">if</span> (USE_VSYNC) {
                <span class="hljs-comment">// è¯·æ±‚ä¸‹ä¸€ä¸ª VSync ä¿¡å·</span>
                scheduleVsyncLocked()
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// é™çº§ï¼šä½¿ç”¨æ™®é€šæ¶ˆæ¯</span>
                <span class="hljs-keyword">val</span> msg = mHandler.obtainMessage(MSG_DO_FRAME)
                mHandler.sendMessageAtTime(msg, nextFrameTime)
            }
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">scheduleVsyncLocked</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// å‘ SurfaceFlinger è¯·æ±‚ VSync ä¿¡å·</span>
        mDisplayEventReceiver.scheduleVsync()
    }

    <span class="hljs-comment">// 3. æ¥æ”¶ VSync ä¿¡å·</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">inner</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FrameDisplayEventReceiver</span> : <span class="hljs-type">DisplayEventReceiver</span>() {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onVsync</span><span class="hljs-params">(
            timestampNanos: <span class="hljs-type">Long</span>,    <span class="hljs-comment">// VSync æ—¶é—´æˆ³</span>
            physicalDisplayId: <span class="hljs-type">Long</span>,  <span class="hljs-comment">// æ˜¾ç¤ºå™¨ ID</span>
            frame: <span class="hljs-type">Long</span>              <span class="hljs-comment">// å¸§å·</span>
        )</span></span> {
            <span class="hljs-comment">// VSync ä¿¡å·åˆ°äº†ï¼</span>
            mTimestampNanos = timestampNanos
            mFrame = frame

            <span class="hljs-comment">// å‘é€æ¶ˆæ¯åˆ°ä¸»çº¿ç¨‹</span>
            <span class="hljs-keyword">val</span> msg = Message.obtain(mHandler, <span class="hljs-keyword">this</span>)
            msg.setAsynchronous(<span class="hljs-literal">true</span>)  <span class="hljs-comment">// å¼‚æ­¥æ¶ˆæ¯ï¼Œä¼˜å…ˆå¤„ç†</span>
            mHandler.sendMessageAtTime(msg, timestampNanos / <span class="hljs-number">1_000_000</span>)
        }

        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
            <span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ</span>
            doFrame(mTimestampNanos, mFrame)
        }
    }

    <span class="hljs-comment">// 4. æ‰§è¡Œä¸€å¸§</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>, frame: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-keyword">val</span> startNanos = System.nanoTime()

        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// æŒ‰é¡ºåºæ‰§è¡Œå››ç§å›è°ƒ</span>
            doCallbacks(Choreographer.CALLBACK_INPUT, frameTimeNanos)
            doCallbacks(Choreographer.CALLBACK_ANIMATION, frameTimeNanos)
            doCallbacks(Choreographer.CALLBACK_TRAVERSAL, frameTimeNanos)
            doCallbacks(Choreographer.CALLBACK_COMMIT, frameTimeNanos)
        } <span class="hljs-keyword">finally</span> {
            mFrameScheduled = <span class="hljs-literal">false</span>
        }

        <span class="hljs-comment">// æ£€æŸ¥æ˜¯å¦æ‰å¸§</span>
        <span class="hljs-keyword">val</span> endNanos = System.nanoTime()
        <span class="hljs-keyword">val</span> durationMillis = (endNanos - startNanos) / <span class="hljs-number">1_000_000</span>

        <span class="hljs-keyword">if</span> (durationMillis &gt; mFrameIntervalNanos / <span class="hljs-number">1_000_000</span>) {
            <span class="hljs-comment">// è¶…è¿‡ä¸€å¸§æ—¶é—´ï¼Œæ‰å¸§äº†ï¼</span>
            <span class="hljs-keyword">val</span> skippedFrames = (durationMillis / (mFrameIntervalNanos / <span class="hljs-number">1_000_000</span>)).toInt()
            Log.w(TAG, <span class="hljs-string">"Skipped <span class="hljs-variable">$skippedFrames</span> frames! The application may be doing too much work on its main thread."</span>)
        }
    }

    <span class="hljs-comment">// 5. æ‰§è¡Œå›è°ƒé˜Ÿåˆ—</span>
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doCallbacks</span><span class="hljs-params">(callbackType: <span class="hljs-type">Int</span>, frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
        <span class="hljs-keyword">val</span> callbacks = mCallbackQueues[callbackType]

        <span class="hljs-comment">// æ‰§è¡Œè¯¥ç±»å‹çš„æ‰€æœ‰å›è°ƒ</span>
        <span class="hljs-keyword">while</span> (callbacks.hasNext()) {
            <span class="hljs-keyword">val</span> callback = callbacks.next()
            callback.run(frameTimeNanos)
        }
    }
}
</code></pre>
<h4 data-id="heading-66">æ—¶åºå›¾</h4>
<pre><code class="hljs language-scss" lang="scss">åº”ç”¨è¿›ç¨‹                          SurfaceFlinger è¿›ç¨‹
    â”‚                                   â”‚
    â”‚ <span class="hljs-built_in">scheduleTraversals</span>()              â”‚
    â”œâ”€ <span class="hljs-built_in">postCallback</span>(TRAVERSAL)          â”‚
    â”‚                                   â”‚
    â”‚ <span class="hljs-built_in">scheduleVsyncLocked</span>()             â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€ <span class="hljs-built_in">requestVsync</span>() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                                   â”‚
    â”‚ ç­‰å¾… VSync...                      â”‚ ä¸‹ä¸€ä¸ª VSync å‘¨æœŸåˆ°æ¥
    â”‚                                   â”‚
    â”‚ â†â”€â”€â”€â”€â”€â”€ <span class="hljs-built_in">onVsync</span>() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ ğŸ“¡ VSync ä¿¡å·
    â”‚                                   â”‚
    â”‚ <span class="hljs-built_in">doFrame</span>()                         â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(INPUT)               â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(ANIMATION)           â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(TRAVERSAL)           â”‚
    â”‚  â””â”€ <span class="hljs-built_in">performTraversals</span>()           â”‚
    â”‚     â”œâ”€ measure                    â”‚
    â”‚     â”œâ”€ layout                     â”‚
    â”‚     â””â”€ draw                       â”‚
    â”œâ”€ <span class="hljs-built_in">doCallbacks</span>(COMMIT)              â”‚
    â”‚  â””â”€ <span class="hljs-built_in">nSyncAndDrawFrame</span>() â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚ æäº¤æ¸²æŸ“æ•°æ®
    â”‚                                   â”‚
    â”‚                                   â”œâ”€ åˆæˆå›¾å±‚
    â”‚                                   â””â”€ æ˜¾ç¤ºåˆ°å±å¹•
</code></pre>
<h3 data-id="heading-67">æ‰å¸§ï¼ˆJankï¼‰åˆ†æ</h3>
<h4 data-id="heading-68">ä»€ä¹ˆæ˜¯æ‰å¸§ï¼Ÿ</h4>
<pre><code class="hljs">æ­£å¸¸æƒ…å†µï¼ˆ60fpsï¼‰ï¼š

Frame 1      Frame 2      Frame 3      Frame 4
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€
0ms         16.67ms      33.34ms      50ms

æ¯å¸§è€—æ—¶ &lt; 16.67ms âœ…
</code></pre>
<pre><code class="hljs">æ‰å¸§æƒ…å†µï¼š

Frame 1      Frame 2                    Frame 3
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”œâ”€â”€â”€â”€â”€â”€â”€â”€
0ms         16.67ms                   50ms

Frame 2 è€—æ—¶ 33.34msï¼ˆè·¨è¶Š 2 ä¸ª VSyncï¼‰âš ï¸
ç”¨æˆ·æ„Ÿè§‰å¡é¡¿
</code></pre>
<h4 data-id="heading-69">æ‰å¸§æ£€æµ‹</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Choreographer å†…éƒ¨çš„æ‰å¸§æ£€æµ‹</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>, frame: <span class="hljs-type">Long</span>)</span></span> {
    <span class="hljs-keyword">val</span> startNanos = System.nanoTime()

    <span class="hljs-comment">// è®¡ç®—åº”è¯¥æ‰§è¡Œçš„æ—¶é—´</span>
    <span class="hljs-keyword">val</span> intendedFrameTimeNanos = mLastFrameTimeNanos + mFrameIntervalNanos

    <span class="hljs-comment">// æ£€æŸ¥å»¶è¿Ÿ</span>
    <span class="hljs-keyword">val</span> jitterNanos = frameTimeNanos - intendedFrameTimeNanos
    <span class="hljs-keyword">if</span> (jitterNanos &gt;= mFrameIntervalNanos) {
        <span class="hljs-comment">// æ‰å¸§äº†ï¼</span>
        <span class="hljs-keyword">val</span> skippedFrames = jitterNanos / mFrameIntervalNanos

        <span class="hljs-keyword">if</span> (skippedFrames &gt;= SKIPPED_FRAME_WARNING_LIMIT) {  <span class="hljs-comment">// é»˜è®¤ 30 å¸§</span>
            Log.i(TAG, <span class="hljs-string">"Skipped <span class="hljs-variable">$skippedFrames</span> frames! "</span> +
                  <span class="hljs-string">"The application may be doing too much work on its main thread."</span>)
        }
    }

    <span class="hljs-comment">// æ‰§è¡Œå›è°ƒ...</span>

    <span class="hljs-keyword">val</span> endNanos = System.nanoTime()
    <span class="hljs-keyword">val</span> frameDuration = (endNanos - startNanos) / <span class="hljs-number">1_000_000</span>

    Log.d(<span class="hljs-string">"FrameTime"</span>, <span class="hljs-string">"Frame took <span class="hljs-subst">${frameDuration}</span>ms"</span>)
}
</code></pre>
<h4 data-id="heading-70">å¸¸è§æ‰å¸§åŸå› </h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// 1. ä¸»çº¿ç¨‹è€—æ—¶æ“ä½œ âŒ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
    <span class="hljs-comment">// ä¸è¦åœ¨ä¸»çº¿ç¨‹åšè¿™äº›ï¼š</span>
    <span class="hljs-keyword">val</span> bitmap = BitmapFactory.decodeFile(<span class="hljs-string">"/sdcard/large_image.jpg"</span>)  <span class="hljs-comment">// IO æ“ä½œ</span>
    <span class="hljs-keyword">val</span> result = complexCalculation()  <span class="hljs-comment">// å¤æ‚è®¡ç®—</span>
    Thread.sleep(<span class="hljs-number">100</span>)  <span class="hljs-comment">// é˜»å¡çº¿ç¨‹</span>

    <span class="hljs-comment">// å¿…ç„¶æ‰å¸§ï¼âš ï¸</span>
}

<span class="hljs-comment">// 2. å¸ƒå±€å±‚çº§è¿‡æ·± âŒ</span>
&lt;LinearLayout&gt;
  &lt;RelativeLayout&gt;
    &lt;FrameLayout&gt;
      &lt;LinearLayout&gt;
        &lt;RelativeLayout&gt;
          &lt;!-- <span class="hljs-number">5</span>å±‚åµŒå¥—ï¼Œmeasure å’Œ layout å¾ˆæ…¢ --&gt;
        &lt;/RelativeLayout&gt;
      &lt;/LinearLayout&gt;
    &lt;/FrameLayout&gt;
  &lt;/RelativeLayout&gt;
&lt;/LinearLayout&gt;

<span class="hljs-comment">// 3. è¿‡åº¦ç»˜åˆ¶ âŒ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onDraw</span><span class="hljs-params">(canvas: <span class="hljs-type">Canvas</span>)</span></span> {
    <span class="hljs-comment">// å¤šæ¬¡ç»˜åˆ¶åŒä¸€åŒºåŸŸ</span>
    canvas.drawColor(Color.WHITE)   <span class="hljs-comment">// èƒŒæ™¯</span>
    canvas.drawBitmap(bitmap1, ...)  <span class="hljs-comment">// å›¾å±‚1</span>
    canvas.drawBitmap(bitmap2, ...)  <span class="hljs-comment">// å›¾å±‚2</span>
    canvas.drawBitmap(bitmap3, ...)  <span class="hljs-comment">// å›¾å±‚3ï¼ˆå®Œå…¨è¦†ç›–ï¼‰</span>
    <span class="hljs-comment">// å‰é¢çš„ç»˜åˆ¶éƒ½æµªè´¹äº†ï¼</span>
}

<span class="hljs-comment">// 4. RecyclerView åˆ›å»º ViewHolder âŒ</span>
<span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateViewHolder</span><span class="hljs-params">(...)</span></span>: ViewHolder {
    <span class="hljs-comment">// inflate å¾ˆæ…¢ï¼ˆ8-10msï¼‰</span>
    <span class="hljs-keyword">val</span> view = LayoutInflater.from(context).inflate(R.layout.complex_item, parent, <span class="hljs-literal">false</span>)
    <span class="hljs-comment">// æ»šåŠ¨æ—¶åˆ›å»ºä¼šæ‰å¸§ â† GapWorker å°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼</span>
}
</code></pre>
<h3 data-id="heading-71">ä¸ RecyclerView çš„å…³ç³»</h3>
<p>RecyclerView å’Œ GapWorker å¦‚ä½•é…åˆï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// RecyclerView çš„æ¸²æŸ“æµç¨‹</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RecyclerView</span> {

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onLayout</span><span class="hljs-params">(changed: <span class="hljs-type">Boolean</span>, l: <span class="hljs-type">Int</span>, t: <span class="hljs-type">Int</span>, r: <span class="hljs-type">Int</span>, b: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// å¸ƒå±€å­ View</span>
        dispatchLayout()

        <span class="hljs-comment">// å¸ƒå±€å®Œæˆåï¼Œé€šçŸ¥ GapWorker å¯ä»¥é¢„å–äº†</span>
        <span class="hljs-keyword">if</span> (mPrefetchRegistry != <span class="hljs-literal">null</span>) {
            mPrefetchRegistry.collectPrefetchPositions(
                mLayout,
                mState,
                mGapWorker
            )
        }
    }
}

<span class="hljs-comment">// LayoutManager æ”¶é›†é¢„å–ä½ç½®</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">LinearLayoutManager</span> {
    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">collectAdditionalPrefetchPositions</span><span class="hljs-params">(
        dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>,
        state: <span class="hljs-type">RecyclerView</span>.<span class="hljs-type">State</span>,
        layoutPrefetchRegistry: <span class="hljs-type">LayoutPrefetchRegistry</span>
    )</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_ANIMATION é˜¶æ®µè¢«è°ƒç”¨</span>
        <span class="hljs-keyword">val</span> prefetchPosition = getCurrentPosition() + (<span class="hljs-keyword">if</span> (dy &gt; <span class="hljs-number">0</span>) <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> -<span class="hljs-number">1</span>)
        layoutPrefetchRegistry.addPosition(prefetchPosition, Math.abs(dy))
    }
}

<span class="hljs-comment">// GapWorker æ³¨å†Œå›è°ƒ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">GapWorker</span> {
    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">postFromTraversal</span><span class="hljs-params">(recyclerView: <span class="hljs-type">RecyclerView</span>, dx: <span class="hljs-type">Int</span>, dy: <span class="hljs-type">Int</span>)</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_TRAVERSAL å®Œæˆåè¢«è°ƒç”¨</span>

        <span class="hljs-comment">// æ³¨å†Œåˆ°ä¸‹ä¸€å¸§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä¸æ˜¯ Choreographer å›è°ƒï¼‰</span>
        recyclerView.post(<span class="hljs-keyword">this</span>)
    }

    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span> {
        <span class="hljs-comment">// åœ¨ CALLBACK_COMMIT ä¹‹åçš„ç©ºé—²æ—¶é—´æ‰§è¡Œ</span>
        <span class="hljs-comment">// æ­¤æ—¶ä¸€å¸§çš„ä¸»è¦å·¥ä½œå·²å®Œæˆï¼Œå¯ä»¥é¢„å–äº†</span>

        <span class="hljs-keyword">val</span> deadlineNs = System.nanoTime() + <span class="hljs-number">4_000_000</span> <span class="hljs-comment">// ç•™ 4ms</span>
        prefetch(deadlineNs)
    }
}
</code></pre>
<h4 data-id="heading-72">å®Œæ•´çš„ä¸€å¸§æ—¶é—´çº¿ï¼ˆåŒ…å« RecyclerViewï¼‰</h4>
<pre><code class="hljs language-css" lang="css">VSync ä¿¡å·
â”‚
â”œâ”€ <span class="hljs-number">0</span>-<span class="hljs-number">2ms</span>: CALLBACK_INPUT
â”‚  â””â”€ å¤„ç†è§¦æ‘¸æ»šåŠ¨äº‹ä»¶
â”‚
â”œâ”€ <span class="hljs-number">2</span>-<span class="hljs-number">4ms</span>: CALLBACK_ANIMATION
â”‚  â”œâ”€ åŠ¨ç”»æ›´æ–°
â”‚  â””â”€ LayoutManager.<span class="hljs-built_in">collectPrefetchPositions</span>() â† æ”¶é›†é¢„å–ä½ç½®
â”‚
â”œâ”€ <span class="hljs-number">4</span>-<span class="hljs-number">14ms</span>: CALLBACK_TRAVERSAL
â”‚  â”œâ”€ RecyclerView.<span class="hljs-built_in">onLayout</span>()
â”‚  â”œâ”€ å¸ƒå±€å¯è§çš„å­ View
â”‚  â””â”€ GapWorker.<span class="hljs-built_in">postFromTraversal</span>() â† æ³¨å†Œé¢„å–ä»»åŠ¡
â”‚
â”œâ”€ <span class="hljs-number">14</span>-<span class="hljs-number">16ms</span>: CALLBACK_COMMIT
â”‚  â””â”€ æäº¤æ¸²æŸ“æ•°æ®
â”‚
â””â”€ <span class="hljs-number">16ms</span>+: ç©ºé—²æ—¶é—´ï¼ˆä¸‹ä¸€å¸§ä¹‹å‰ï¼‰
   â””â”€ GapWorker.<span class="hljs-built_in">run</span>() â† æ‰§è¡Œé¢„å–ï¼âœ…
      â”œâ”€ åˆ›å»º ViewHolder (å¦‚éœ€è¦)
      â”œâ”€ ç»‘å®šæ•°æ®
      â””â”€ æ”¾å…¥ç¼“å­˜
</code></pre>
<h3 data-id="heading-73">å®é™…åº”ç”¨</h3>
<h4 data-id="heading-74">1. ç›‘æ§å¸§ç‡</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FpsMonitor</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mFrameCount = <span class="hljs-number">0</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mLastTime = <span class="hljs-number">0L</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            mFrameCount++

            <span class="hljs-keyword">val</span> currentTime = System.currentTimeMillis()
            <span class="hljs-keyword">if</span> (currentTime - mLastTime &gt;= <span class="hljs-number">1000</span>) {
                <span class="hljs-comment">// æ¯ç§’ç»Ÿè®¡ä¸€æ¬¡</span>
                <span class="hljs-keyword">val</span> fps = mFrameCount
                Log.d(<span class="hljs-string">"FPS"</span>, <span class="hljs-string">"å½“å‰å¸§ç‡: <span class="hljs-variable">$fps</span> fps"</span>)

                <span class="hljs-keyword">if</span> (fps &lt; <span class="hljs-number">55</span>) {
                    Log.w(<span class="hljs-string">"FPS"</span>, <span class="hljs-string">"å¸§ç‡è¿‡ä½ï¼Œå¯èƒ½å¡é¡¿ï¼"</span>)
                }

                mFrameCount = <span class="hljs-number">0</span>
                mLastTime = currentTime
            }

            <span class="hljs-comment">// æ³¨å†Œä¸‹ä¸€å¸§</span>
            Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> {
        mLastTime = System.currentTimeMillis()
        Choreographer.getInstance().postFrameCallback(mFrameCallback)
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">stop</span><span class="hljs-params">()</span></span> {
        Choreographer.getInstance().removeFrameCallback(mFrameCallback)
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> monitor = FpsMonitor()
monitor.start()
</code></pre>
<h4 data-id="heading-75">2. æ£€æµ‹æ‰å¸§</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JankDetector</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mLastFrameTimeNanos = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameIntervalNanos = <span class="hljs-number">16_666_666L</span> <span class="hljs-comment">// 60fps</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-keyword">if</span> (mLastFrameTimeNanos != <span class="hljs-number">0L</span>) {
                <span class="hljs-keyword">val</span> frameDuration = frameTimeNanos - mLastFrameTimeNanos
                <span class="hljs-keyword">val</span> skippedFrames = (frameDuration / mFrameIntervalNanos) - <span class="hljs-number">1</span>

                <span class="hljs-keyword">if</span> (skippedFrames &gt; <span class="hljs-number">0</span>) {
                    Log.w(<span class="hljs-string">"Jank"</span>, <span class="hljs-string">"æ‰å¸§ <span class="hljs-variable">$skippedFrames</span> å¸§ï¼"</span> +
                          <span class="hljs-string">"è€—æ—¶: <span class="hljs-subst">${frameDuration / <span class="hljs-number">1</span>_000_000}</span>ms"</span>)

                    <span class="hljs-comment">// ä¸ŠæŠ¥åˆ°æ€§èƒ½ç›‘æ§å¹³å°</span>
                    reportJank(skippedFrames, frameDuration)
                }
            }

            mLastFrameTimeNanos = frameTimeNanos

            <span class="hljs-comment">// ç»§ç»­ç›‘å¬</span>
            Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">()</span></span> {
        Choreographer.getInstance().postFrameCallback(mFrameCallback)
    }
}
</code></pre>
<h4 data-id="heading-76">3. å»¶è¿Ÿæ‰§è¡Œï¼ˆç­‰å¾…ä¸‹ä¸€å¸§ï¼‰</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ç­‰å¾…ä¸‹ä¸€å¸§å†æ‰§è¡Œ</span>
<span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doOnNextFrame</span><span class="hljs-params">(action: () -&gt; <span class="hljs-type">Unit</span>)</span></span> {
    Choreographer.getInstance().postFrameCallback {
        action()
    }
}

<span class="hljs-comment">// ä½¿ç”¨åœºæ™¯ï¼šView åˆšåˆ›å»ºï¼Œç­‰å¸ƒå±€å®Œæˆå†æ“ä½œ</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">MyView</span> : <span class="hljs-type">View</span> {
    <span class="hljs-keyword">init</span> {
        doOnNextFrame {
            <span class="hljs-comment">// æ­¤æ—¶ View å·²ç»æµ‹é‡å’Œå¸ƒå±€å®Œæˆ</span>
            <span class="hljs-keyword">val</span> width = measuredWidth
            <span class="hljs-keyword">val</span> height = measuredHeight
            <span class="hljs-comment">// å¯ä»¥å®‰å…¨ä½¿ç”¨å°ºå¯¸äº†</span>
        }
    }
}
</code></pre>
<h4 data-id="heading-77">4. ä¼˜åŒ–åŠ¨ç”»</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SmoothAnimator</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mStartValue = <span class="hljs-number">0f</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mEndValue = <span class="hljs-number">0f</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mStartTime = <span class="hljs-number">0L</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">var</span> mDuration = <span class="hljs-number">0L</span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> mFrameCallback = <span class="hljs-keyword">object</span> : Choreographer.FrameCallback {
        <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">doFrame</span><span class="hljs-params">(frameTimeNanos: <span class="hljs-type">Long</span>)</span></span> {
            <span class="hljs-keyword">val</span> elapsed = (frameTimeNanos - mStartTime) / <span class="hljs-number">1_000_000</span>
            <span class="hljs-keyword">val</span> fraction = (elapsed.toFloat() / mDuration).coerceIn(<span class="hljs-number">0f</span>, <span class="hljs-number">1f</span>)

            <span class="hljs-comment">// è®¡ç®—å½“å‰å€¼</span>
            <span class="hljs-keyword">val</span> value = mStartValue + (mEndValue - mStartValue) * fraction

            <span class="hljs-comment">// æ›´æ–° UI</span>
            onAnimationUpdate(value)

            <span class="hljs-keyword">if</span> (fraction &lt; <span class="hljs-number">1f</span>) {
                <span class="hljs-comment">// ç»§ç»­ä¸‹ä¸€å¸§</span>
                Choreographer.getInstance().postFrameCallback(<span class="hljs-keyword">this</span>)
            }
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">start</span><span class="hljs-params">(from: <span class="hljs-type">Float</span>, to: <span class="hljs-type">Float</span>, duration: <span class="hljs-type">Long</span>)</span></span> {
        mStartValue = from
        mEndValue = to
        mDuration = duration
        mStartTime = System.nanoTime()

        Choreographer.getInstance().postFrameCallback(mFrameCallback)
    }

    <span class="hljs-keyword">open</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onAnimationUpdate</span><span class="hljs-params">(value: <span class="hljs-type">Float</span>)</span></span> {
        <span class="hljs-comment">// å­ç±»å®ç°</span>
    }
}
</code></pre>
<h3 data-id="heading-78">é«˜åˆ·æ–°ç‡å±å¹•æ”¯æŒ</h3>
<h4 data-id="heading-79">90Hz / 120Hz / 144Hz å±å¹•</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// Android 11+ å¯ä»¥è·å–å±å¹•åˆ·æ–°ç‡</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">RefreshRateDetector</span> {

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getRefreshRate</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: <span class="hljs-built_in">Float</span> {
        <span class="hljs-keyword">val</span> display = <span class="hljs-keyword">if</span> (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.R) {
            context.display
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">val</span> wm = context.getSystemService(Context.WINDOW_SERVICE) <span class="hljs-keyword">as</span> WindowManager
            wm.defaultDisplay
        }

        <span class="hljs-keyword">return</span> display?.refreshRate ?: <span class="hljs-number">60f</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getFrameIntervalNanos</span><span class="hljs-params">(refreshRate: <span class="hljs-type">Float</span>)</span></span>: <span class="hljs-built_in">Long</span> {
        <span class="hljs-keyword">return</span> (<span class="hljs-number">1_000_000_000</span> / refreshRate).toLong()
    }
}

<span class="hljs-comment">// ä½¿ç”¨</span>
<span class="hljs-keyword">val</span> refreshRate = detector.getRefreshRate(context)
Log.d(<span class="hljs-string">"Display"</span>, <span class="hljs-string">"å±å¹•åˆ·æ–°ç‡: <span class="hljs-variable">$refreshRate</span> Hz"</span>)

<span class="hljs-keyword">when</span> {
    refreshRate &gt;= <span class="hljs-number">120f</span> -&gt; {
        <span class="hljs-comment">// 120Hz: æ¯å¸§ 8.33ms</span>
        <span class="hljs-comment">// éœ€è¦æ›´ä¸¥æ ¼çš„æ€§èƒ½ä¼˜åŒ–</span>
    }
    refreshRate &gt;= <span class="hljs-number">90f</span> -&gt; {
        <span class="hljs-comment">// 90Hz: æ¯å¸§ 11.11ms</span>
    }
    <span class="hljs-keyword">else</span> -&gt; {
        <span class="hljs-comment">// 60Hz: æ¯å¸§ 16.67ms</span>
    }
}
</code></pre>
<h3 data-id="heading-80">æ€§èƒ½ä¼˜åŒ–å»ºè®®</h3>
<h4 data-id="heading-81">1. é¿å…åœ¨å›è°ƒä¸­åšè€—æ—¶æ“ä½œ</h4>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// âŒ é”™è¯¯</span>
Choreographer.getInstance().postFrameCallback {
    <span class="hljs-keyword">val</span> bitmap = loadLargeBitmap()  <span class="hljs-comment">// IO æ“ä½œï¼Œå¾ˆæ…¢</span>
    imageView.setImageBitmap(bitmap)
}

<span class="hljs-comment">// âœ… æ­£ç¡®</span>
lifecycleScope.launch {
    <span class="hljs-keyword">val</span> bitmap = withContext(Dispatchers.IO) {
        loadLargeBitmap()  <span class="hljs-comment">// åœ¨åå°çº¿ç¨‹</span>
    }
    imageView.setImageBitmap(bitmap)  <span class="hljs-comment">// åœ¨ä¸»çº¿ç¨‹</span>
}
</code></pre>
<h4 data-id="heading-82">2. ä½¿ç”¨ Systrace åˆ†æ</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># æŠ“å– Systrace</span>
python systrace.py -a com.your.package -t 10 -o trace.html \
  gfx view res dalvik <span class="hljs-built_in">sched</span> freq idle

<span class="hljs-comment"># åˆ†æè¦ç‚¹ï¼š</span>
<span class="hljs-comment"># 1. æŸ¥çœ‹æ¯ä¸€å¸§çš„è€—æ—¶</span>
<span class="hljs-comment"># 2. æ‰¾å‡ºè¶…è¿‡ 16.67ms çš„å¸§</span>
<span class="hljs-comment"># 3. åˆ†ææ˜¯å“ªä¸ªé˜¶æ®µæ…¢ï¼ˆinput/animation/traversal/commitï¼‰</span>
<span class="hljs-comment"># 4. å®šä½å…·ä½“çš„æ…¢æ–¹æ³•</span>
</code></pre>
<h4 data-id="heading-83">3. å‡å°‘å¸ƒå±€å±‚çº§</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- âŒ è¿‡æ·±çš„å±‚çº§ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">LinearLayout</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">RelativeLayout</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">FrameLayout</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">FrameLayout</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">RelativeLayout</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">LinearLayout</span>&gt;</span>

<span class="hljs-comment">&lt;!-- âœ… æ‰å¹³åŒ– --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">ConstraintLayout</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">ConstraintLayout</span>&gt;</span>
</code></pre>
<h4 data-id="heading-84">4. ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ</h4>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-comment">&lt;!-- åœ¨ AndroidManifest.xml ä¸­å¯ç”¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">application</span> <span class="hljs-attr">android:hardwareAccelerated</span>=<span class="hljs-string">"true"</span>&gt;</span>
</code></pre>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">// ä¸ºç‰¹å®š View å¯ç”¨</span>
view.setLayerType(View.LAYER_TYPE_HARDWARE, <span class="hljs-literal">null</span>)
</code></pre>
<hr/>
<h3 data-id="heading-85">æ€»ç»“</h3>
<h4 data-id="heading-86">RecyclerView æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>å››çº§ç¼“å­˜</strong>ï¼šæè‡´çš„å¤ç”¨æœºåˆ¶</li>
<li><strong>ViewHolder</strong>ï¼šé¿å…é‡å¤ findViewById</li>
<li><strong>ç²¾ç¡®é€šçŸ¥</strong>ï¼šå‘Šè¯‰ RecyclerView å…·ä½“å“ªé‡Œå˜äº†</li>
<li><strong>ä½ç½®ç®¡ç†</strong>ï¼šç»´æŠ¤å¤æ‚çš„ä½ç½®æ˜ å°„å…³ç³»</li>
</ol>
<h4 data-id="heading-87">GapWorker æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>é¢„å–æœºåˆ¶</strong>ï¼šåœ¨ç©ºé—²æ—¶é—´æå‰å‡†å¤‡ ViewHolder</li>
<li><strong>ä¼˜å…ˆçº§è°ƒåº¦</strong>ï¼šæŒ‰è·ç¦»å’Œç´§æ€¥ç¨‹åº¦æ’åº</li>
<li><strong>æ—¶é—´æ§åˆ¶</strong>ï¼šé»˜è®¤æœ€å¤šå ç”¨ 4ms</li>
<li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šå¿…é¡»ä½¿ç”¨ç²¾ç¡®çš„ notify æ–¹æ³•</li>
</ol>
<h4 data-id="heading-88">Choreographer æ ¸å¿ƒè¦ç‚¹</h4>
<ol>
<li><strong>ç¼–èˆè€…</strong>ï¼šåè°ƒè¾“å…¥ã€åŠ¨ç”»ã€ç»˜åˆ¶çš„æ—¶é—´</li>
<li><strong>VSync åŒæ­¥</strong>ï¼šæ‰€æœ‰æ¸²æŸ“æ“ä½œå¯¹é½åˆ° VSync ä¿¡å·</li>
<li><strong>å››ç§å›è°ƒ</strong>ï¼šINPUT â†’ ANIMATION â†’ TRAVERSAL â†’ COMMIT</li>
<li><strong>æ‰å¸§æ£€æµ‹</strong>ï¼šè¶…è¿‡ 16.67ms å°±ä¼šæ‰å¸§</li>
</ol>
<h4 data-id="heading-89">ä¸‰è€…å…³ç³»</h4>
<pre><code class="hljs language-objectivec" lang="objectivec">Choreographer (ç¼–èˆè€…)
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_INPUT</span>: å¤„ç†è§¦æ‘¸æ»šåŠ¨
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_ANIMATION</span>: æ”¶é›†é¢„å–ä½ç½®
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_TRAVERSAL</span>: RecyclerView å¸ƒå±€
    â”‚   â””â”€ ä½¿ç”¨å››çº§ç¼“å­˜å¿«é€Ÿå¤ç”¨ ViewHolder
    â”‚
    â”œâ”€ <span class="hljs-built_in">CALLBACK_COMMIT</span>: æäº¤æ¸²æŸ“
    â”‚
    â””â”€ ç©ºé—²æ—¶é—´: GapWorker é¢„å–
        â””â”€ é¿å…ä¸‹ä¸€å¸§åˆ›å»º ViewHolder å¯¼è‡´æ‰å¸§
</code></pre>
<h4 data-id="heading-90">å´©æºƒæ ¹æœ¬åŸå› </h4>
<p><strong>æ•°æ®æ”¹å˜å’Œé€šçŸ¥ä¸åŒæ­¥ï¼Œå¯¼è‡´ä½ç½®ä¿¡æ¯ä¸ä¸€è‡´</strong></p>
<ul>
<li>GapWorker åœ¨ç©ºé—²æ—¶é—´é¢„å–</li>
<li>ä¸»çº¿ç¨‹åŒæ—¶åˆ é™¤æ•°æ®</li>
<li>ä½¿ç”¨ <code>notifyDataSetChanged()</code> å¼‚æ­¥é€šçŸ¥</li>
<li>GapWorker ä½¿ç”¨æ—§çš„ä½ç½®ä¿¡æ¯ â†’ å´©æºƒ</li>
</ul>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨ <code>notifyItemRemoved()</code> åŒæ­¥æ›´æ–°ä½ç½®</p>
<hr/>
<blockquote>
<p>æ–‡æ¡£ç”Ÿæˆæ—¶é—´ï¼š2025-11-10
æ–‡æ¡£ç‰ˆæœ¬ï¼š1.0
é€‚ç”¨äºï¼šAndroid å¼€å‘è€…æ·±å…¥ç†è§£æ¸²æŸ“æœºåˆ¶</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Spring AI å®æˆ˜â€”â€”æäº¤ç”¨äºç”Ÿæˆçš„æç¤ºè¯]]></title>    <link>https://juejin.cn/post/7570901172526940195</link>    <guid>https://juejin.cn/post/7570901172526940195</guid>    <pubDate>2025-11-10T09:57:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7570901172526940195" data-draft-id="7570909641682321448" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Spring AI å®æˆ˜â€”â€”æäº¤ç”¨äºç”Ÿæˆçš„æç¤ºè¯"/> <meta itemprop="keywords" content="Spring,AIç¼–ç¨‹,LLM"/> <meta itemprop="datePublished" content="2025-11-10T09:57:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="æ•°æ®æ™ºèƒ½è€å¸æœº"/> <meta itemprop="url" content="https://juejin.cn/user/430664289626439"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="æ˜é‡‘"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Spring AI å®æˆ˜â€”â€”æäº¤ç”¨äºç”Ÿæˆçš„æç¤ºè¯
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/430664289626439/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    æ•°æ®æ™ºèƒ½è€å¸æœº
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2025-11-10T09:57:05.000Z" title="Mon Nov 10 2025 09:57:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2025-11-10
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    é˜…è¯»11åˆ†é’Ÿ
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">æœ¬ç« å†…å®¹</h2>
<ul>
<li>å®šä¹‰æç¤ºæ¨¡æ¿ï¼ˆprompt templatesï¼‰</li>
<li>æä¾›ä¸Šä¸‹æ–‡</li>
<li>æ ¼å¼åŒ–å“åº”è¾“å‡º</li>
<li>æµå¼ä¼ è¾“å“åº”</li>
<li>è®¿é—®å“åº”å…ƒæ•°æ®</li>
</ul>
<p>åœ¨ç¬¬ 1 ç« ä¸­ï¼Œä½ åˆ›å»ºäº†ä¸€ä¸ªéå¸¸ç®€å•çš„ Spring AI åº”ç”¨ï¼šå®ƒåœ¨ POST è¯·æ±‚é‡Œæ¥æ”¶ä¸€ä¸ªé—®é¢˜ï¼Œå¹¶é€šè¿‡æ³¨å…¥çš„ <code>ChatClient</code> ç›´æ¥æäº¤ç»™ LLMã€‚å®ƒè¿è¡Œè‰¯å¥½ï¼Œä½†éšç€ä½ çš„ç”Ÿæˆå¼ AI éœ€æ±‚å˜å¾—æ›´é«˜çº§ï¼Œä½ å‘ç»™ LLM çš„æç¤ºä¹Ÿä¼šéšä¹‹å¤æ‚åŒ–ã€‚æ­¤æ—¶ï¼ŒåŸºäº <code>String</code> çš„æç¤ºå¯èƒ½å°±ä¸å¤Ÿç”¨äº†ã€‚</p>
<p>å¦å¤–ï¼Œç”Ÿæˆçš„å“åº”ä¹Ÿä¸ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ã€‚ç»“æœä¸­å¯èƒ½åŒ…å«æœ‰ç”¨çš„<strong>å…ƒæ•°æ®</strong>ï¼Œä¾‹å¦‚<strong>ç”¨é‡æ•°æ®</strong>ï¼Œå¸®åŠ©ä½ è¯„ä¼°æ¯æ¬¡ç”Ÿæˆå¯¹è®¡è´¹çš„å½±å“ã€‚å“åº”è¿˜å¯ä»¥<strong>åˆ†ç‰‡æµå¼è¿”å›</strong>ç»™å®¢æˆ·ç«¯ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›å®Œæ•´ç»“æœã€‚</p>
<p>æœ¬ç« å°†æŠŠä½ çš„æç¤ºä¸å“åº”å¤„ç†æå‡åˆ°æ–°æ°´å¹³ã€‚å…ˆä»<strong>å¦‚ä½•å®šä¹‰æç¤ºæ¨¡æ¿</strong>å¼€å§‹ã€‚</p>
<h2 data-id="heading-1">3.1 ä½¿ç”¨æç¤ºæ¨¡æ¿ï¼ˆWorking with prompt templatesï¼‰</h2>
<p>Spring AI æ”¯æŒ<strong>ä»æ¨¡æ¿åˆ›å»ºæç¤º</strong>ã€‚æ¨¡æ¿ç”±å›ºå®šæ–‡æœ¬ä¸ä¸€ä¸ªæˆ–å¤šä¸ª<strong>å ä½ç¬¦</strong>ç»„æˆã€‚å¦‚å›¾ 3.1 æ‰€ç¤ºï¼Œè¿™äº›æ¨¡æ¿çš„å ä½ç¬¦å°†ç”±â€œæ¨¡å‹æ•°æ®â€åœ¨æ¯æ¬¡è°ƒç”¨æ—¶å¡«å……ï¼Œä»¥ç”Ÿæˆè¦å‘é€ç»™ LLM çš„æç¤ºã€‚æ¨¡å‹æ•°æ®è¢«å¡«å…¥å ä½ç¬¦ï¼Œå¤–å±‚ç”±æç¤ºæ–‡æœ¬åŒ…è£¹ï¼Œå¼•å¯¼ LLM åº”å½“å¦‚ä½•ä½œç­”ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fe4e4863ad35460fa114d776132969b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=2FSRnk0GhyxxCAGTmkdzD7RccC8%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.1</strong> ä½¿ç”¨æç¤ºæ¨¡æ¿ç”±æ¨¡å‹æ•°æ®ç”Ÿæˆæç¤º</p>
<p>ä¸ºäº†æ¼”ç¤ºæç¤ºæ¨¡æ¿å¦‚ä½•å·¥ä½œï¼Œæˆ‘ä»¬ä»ç¬¬ 1 ç« çš„ç¤ºä¾‹å‡ºå‘ï¼ŒæŠŠå®ƒæ‰©å±•ä¸ºèƒ½å›ç­”å„ç±»<strong>æ¡Œé¢æ¸¸æˆ</strong>ï¼ˆå¦‚è·³æ£‹ã€Monopolyï¼Œæˆ–æ›´ç°ä»£çš„æ¬§å¼æ¡Œæ¸¸å¦‚ Catanã€Wingspanï¼‰çš„é—®ç­”ã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦åœ¨ <code>Question</code> è®°å½•ç±»å‹ä¸­åŠ å…¥<strong>æ¸¸æˆæ ‡é¢˜</strong>ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">package</span> <span class="hljs-selector-tag">com</span><span class="hljs-selector-class">.example</span><span class="hljs-selector-class">.boardgamebuddy</span>;

<span class="hljs-selector-tag">import</span> <span class="hljs-selector-tag">jakarta</span><span class="hljs-selector-class">.validation</span><span class="hljs-selector-class">.constraints</span><span class="hljs-selector-class">.NotBlank</span>;

<span class="hljs-selector-tag">public</span> <span class="hljs-selector-tag">record</span> <span class="hljs-selector-tag">Question</span>(
    <span class="hljs-variable">@NotBlank</span>(message = <span class="hljs-string">"Game title is required"</span>) String gameTitle,
    <span class="hljs-variable">@NotBlank</span>(message = <span class="hljs-string">"Question is required"</span>) String question) {
}
</code></pre>
<p>è¿™ä¸ªæ–°ç‰ˆ <code>Question</code> å¢åŠ äº† <code>gameTitle</code> å±æ€§ï¼Œç”¨äºæ‰¿è½½æ¸¸æˆåã€‚è¿™æ ·å³ä¾¿é—®é¢˜æœ¬èº«æœªæåˆ°æ¸¸æˆåï¼Œä¹Ÿèƒ½æä¾›è¶³å¤Ÿä¸Šä¸‹æ–‡æ¥å›ç­”å…³äºæŸæ¬¾æ¸¸æˆçš„æé—®ã€‚</p>
<p>ä½ ä¹Ÿä¼šæ³¨æ„åˆ°ä¸¤ä¸ªå±æ€§éƒ½æ ‡æ³¨äº† <code>@NotBlank</code>ã€‚è™½ç„¶<strong>æ ¡éªŒ</strong>ä¸æ˜¯ Spring AI çš„ç‰¹æ€§ï¼Œä½†å®ƒæ˜¯ Spring æœ¬èº«éå¸¸é‡è¦ä¸”æœ‰ç”¨çš„åŠŸèƒ½ã€‚ç”¨ <code>@NotBlank</code> å£°æ˜å®ƒä»¬éƒ½æ˜¯<strong>å¿…å¡«</strong>çš„ï¼Œä¸”ä¸èƒ½ä¸º <code>null</code> æˆ–å»ç©ºç™½åå˜æˆç©ºå­—ç¬¦ä¸²ã€‚</p>
<p>è¦å¯ç”¨ <code>@NotBlank</code> ä»¥åŠ Spring çš„æ ¡éªŒæ”¯æŒï¼Œéœ€è¦åœ¨æ„å»ºä¸­åŠ å…¥å¦‚ä¸‹ starter ä¾èµ–ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">implementation <span class="hljs-string">'org.springframework.boot:spring-boot-starter-validation'</span>
</code></pre>
<p>åŒæ—¶ï¼Œéœ€è¦åœ¨æ§åˆ¶å™¨çš„ <code>ask()</code> æ–¹æ³•é‡Œç»™ <code>Question</code> å‚æ•°æ·»åŠ  <code>@Valid</code>ï¼Œä»¥ä¾¿ Spring åœ¨å¤„ç†è¯¥æ§åˆ¶å™¨çš„è¯·æ±‚æ—¶æ‰§è¡Œæ ¡éªŒï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@PostMapping</span>(path=<span class="hljs-string">"/ask"</span>, produces=<span class="hljs-string">"application/json"</span>)
public Answer <span class="hljs-built_in">ask</span>(<span class="hljs-variable">@RequestBody</span> <span class="hljs-variable">@Valid</span> Question question) {
  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">boardGameService</span><span class="hljs-selector-class">.askQuestion</span>(question);
}
</code></pre>
<p>æœ€åï¼Œä¸ºäº†æŠŠæ ¡éªŒé”™è¯¯<strong>æ•´é½åœ°</strong>ä»¥ JSON å½¢å¼è¿”å›ï¼Œä¸‹é¢çš„æ§åˆ¶å™¨å¢å¼ºï¼ˆadviceï¼‰ç±»åˆ©ç”¨äº† Spring å¯¹ <strong>Problem Detailsï¼ˆRFC-7807ï¼‰</strong> çš„æ”¯æŒï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fdatatracker.ietf.org%2Fdoc%2Fhtml%2Frfc7807" target="_blank" title="https://datatracker.ietf.org/doc/html/rfc7807" ref="nofollow noopener noreferrer">datatracker.ietf.org/doc/html/rfâ€¦</a>ï¼‰ã€‚</p>
<p><strong>æ¸…å• 3.1 ä½¿ç”¨ Problem Details ä¼˜é›…è¿”å›æ ¡éªŒé”™è¯¯</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.context.MessageSourceResolvable;
<span class="hljs-keyword">import</span> org.springframework.http.HttpStatus;
<span class="hljs-keyword">import</span> org.springframework.http.ProblemDetail;
<span class="hljs-keyword">import</span> org.springframework.web.bind.MethodArgumentNotValidException;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.ExceptionHandler;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestControllerAdvice;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestControllerAdvice</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ExceptionHandlerAdvice</span> {

  <span class="hljs-meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span>
  <span class="hljs-keyword">public</span> ProblemDetail handleValidationExceptions(
                              MethodArgumentNotValidException ex) {
    <span class="hljs-keyword">var</span> problemDetail =  ProblemDetail
        .forStatusAndDetail(HttpStatus.BAD_REQUEST, <span class="hljs-string">"Validation failed"</span>);

    <span class="hljs-keyword">var</span> validationMessages = ex.getBindingResult().getAllErrors()
        .stream()
        .map(MessageSourceResolvable::getDefaultMessage)
        .toList();

    problemDetail.setProperty(<span class="hljs-string">"validationErrors"</span>, validationMessages);
    <span class="hljs-keyword">return</span> problemDetail;
  }

}
</code></pre>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<strong>Problem Details</strong> æ˜¯ä¸€ç§å¯¹ HTTP API é”™è¯¯è¿›è¡Œ<strong>æ ‡å‡†åŒ–ç»“æ„åŒ–</strong>çš„è§„èŒƒã€‚è‡ª Spring 6.0 èµ·ï¼ŒSpring å°±æä¾›äº†ä¸€ç­‰çš„ Problem Details æ”¯æŒã€‚å½“åº”ç”¨äº† Problem Details ä¸”<strong>æ ¡éªŒå¤±è´¥</strong>ï¼ˆä¾‹å¦‚è¯·æ±‚æœªæä¾›æ¸¸æˆåï¼‰æ—¶ï¼Œå®¢æˆ·ç«¯ä¼šæ”¶åˆ°ç±»ä¼¼è¿™æ ·çš„æ ‡å‡†å“åº”ï¼š</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"detail"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Validation failed"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"instance"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/ask"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"status"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">400</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bad Request"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"about:blank"</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"validationErrors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span>
        <span class="hljs-string">"Game title is required"</span>
    <span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>ç°åœ¨æŠŠæ³¨æ„åŠ›è½¬å‘<strong>å“åº”</strong>ã€‚ä¸ <code>Question</code> ä¸€æ ·ï¼Œä½ è¿˜å¸Œæœ›åœ¨ <code>Answer</code> è®°å½•ç±»å‹ä¸­åŠ å…¥<strong>æ¸¸æˆæ ‡é¢˜</strong>ï¼Œè®© API å®¢æˆ·ç«¯çŸ¥é“è¿™æ¡ç­”æ¡ˆå¯¹åº”çš„æ˜¯å“ªæ¬¾æ¸¸æˆï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">package com.example.boardgamebuddy;

<span class="hljs-function"><span class="hljs-keyword">public</span> record <span class="hljs-title">Answer</span><span class="hljs-params">(<span class="hljs-type">String</span> gameTitle, <span class="hljs-type">String</span> answer)</span> </span>{
}
</code></pre>
<p>æ—¢ç„¶ <code>Question</code> ä¸ <code>Answer</code> éƒ½åŒ…å«äº†æ¸¸æˆåï¼Œä½ å¯ä»¥æŠŠ <code>SpringAiBoardGameService</code> ä¸­çš„ <code>askQuestion()</code> ç®€åŒ–ä¸º<strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>ç”Ÿæˆæç¤ºï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-title class_">Answer</span> <span class="hljs-title function_">askQuestion</span>(<span class="hljs-params">Question question</span>) {
  <span class="hljs-title class_">String</span> prompt =
      <span class="hljs-string">"Answer this question about "</span> + question.<span class="hljs-title function_">gameTitle</span>() +
      <span class="hljs-string">": "</span> + question.<span class="hljs-title function_">question</span>();

  <span class="hljs-title class_">String</span> answerText = chatClient.<span class="hljs-title function_">prompt</span>()
      .<span class="hljs-title function_">user</span>(prompt)
      .<span class="hljs-title function_">call</span>()
      .<span class="hljs-title function_">content</span>();
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(question.<span class="hljs-title function_">gameTitle</span>(), answerText);
}
</code></pre>
<p>ç°åœ¨å¯ä»¥åœ¨è¯·æ±‚ä¸­å¸¦ä¸Šæ¸¸æˆåæ¥æé—®äº†ã€‚æ¯”å¦‚ç”¨ HTTPie å‘ç»å…¸çš„ <strong>checkersï¼ˆè·³æ£‹ï¼‰</strong> æé—®ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"checkers"</span> \
question=<span class="hljs-string">"How many pieces are there?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"In checkers, there are a total of 24 pieces-12 for each player."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"checkers"</span>
}
</code></pre>
<p>åº•å±‚ LLM èƒ½åŸºäºè‡ªèº«è®­ç»ƒå›ç­”å…³äºè·³æ£‹çš„é—®é¢˜ã€‚è¿™ç§æ–¹å¼é€‚ç”¨äº<strong>çŸ¥åæ¸¸æˆ</strong>ï¼ˆå¦‚è·³æ£‹ã€å›½é™…è±¡æ£‹ï¼‰ï¼›ä½†å¯¹äº<strong>è¾ƒæ–°/ä¸é‚£ä¹ˆå‡ºå</strong>çš„æ¸¸æˆå¯èƒ½ä¼šåƒåŠ›ã€‚ä¸‹ä¸€ç« æˆ‘ä»¬ä¼šçœ‹åˆ°å¦‚ä½•è®© LLM å›ç­”<strong>è¶…å‡ºå…¶è®­ç»ƒèŒƒå›´</strong>çš„é—®é¢˜ã€‚</p>
<p>è™½ç„¶èƒ½ç”¨ï¼Œä½†é€šè¿‡<strong>å­—ç¬¦ä¸²æ‹¼æ¥</strong>æ¥æ„å»ºæç¤ºå¾ˆç¬¨æ‹™ã€‚å³ä¾¿æ˜¯ <code>askQuestion()</code> ä¸­è¿™æ ·ç®€å•çš„æç¤ºï¼Œä¹Ÿä¼šè®©ä»£ç è¯»å†™ä¸ä¾¿ã€‚</p>
<h3 data-id="heading-2">3.1.1 å®šä¹‰æç¤ºæ¨¡æ¿ï¼ˆDefining a prompt templateï¼‰</h3>
<p>ä¸å…¶ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸å¦‚åˆ›å»ºä¸€ä¸ª<strong>æç¤ºæ¨¡æ¿</strong>ï¼ŒæŠŠâ€œåŸå§‹ã€æœªæ¸²æŸ“çš„æç¤ºâ€å†™æˆå¸¦å ä½ç¬¦çš„æ¨¡æ¿ã€‚ä¸‹é¢æ¸…å•å±•ç¤ºäº†ä¿®æ”¹åçš„ <code>SpringAiBoardGameService</code>ï¼Œå®ƒä½¿ç”¨äº†æ¨¡æ¿åŒ–æç¤ºã€‚</p>
<p><strong>æ¸…å• 3.2 ä½¿ç”¨æç¤ºæ¨¡æ¿ï¼Œé¿å…ç¬¨æ‹™çš„å­—ç¬¦ä¸²æ‹¼æ¥</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;

  <span class="hljs-keyword">public</span> <span class="hljs-title function_">SpringAiBoardGameService</span><span class="hljs-params">(ChatClient.Builder chatClientBuilder)</span> {
    <span class="hljs-built_in">this</span>.chatClient = chatClientBuilder.build();
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">questionPromptTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-string">"""
      Answer this question about {game}: {question}
      """</span>;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Answer <span class="hljs-title function_">askQuestion</span><span class="hljs-params">(Question question)</span> {
    <span class="hljs-type">var</span> <span class="hljs-variable">answerText</span> <span class="hljs-operator">=</span> chatClient.prompt()
        .user(userSpec -&gt; userSpec
            .text(questionPromptTemplate)
            .param(<span class="hljs-string">"gameTitle"</span>, question.gameTitle())
            .param(<span class="hljs-string">"question"</span>, question.question()))
        .call()
        .content();

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Answer</span>(question.gameTitle(), answerText);
  }

}
</code></pre>
<p>å¦‚ä½ æ‰€è§ï¼Œåä¸º <code>questionPromptTemplate</code> çš„æç¤ºæ¨¡æ¿çœ‹èµ·æ¥ä¸æ­¤å‰æ‹¼æ¥å‡ºæ¥çš„æç¤ºå¾ˆåƒï¼Œä½†å®ƒä¸ä»…ä»…æ˜¯æ–‡æœ¬ã€‚å®ƒæ˜¯ä¸€ä¸ª <strong>StringTemplate</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.stringtemplate.org%2F" target="_blank" title="https://www.stringtemplate.org/" ref="nofollow noopener noreferrer">www.stringtemplate.org/</a>ï¼‰ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªå‚æ•°çš„å ä½ç¬¦<code>{game}</code> ä¸ <code>{question}</code>ã€‚</p>
<p>ç”±äºå­˜åœ¨å ä½ç¬¦ï¼Œè¿™ä¸ªæ¨¡æ¿<strong>ä¸èƒ½</strong>ç›´æ¥ä½œä¸ºæ™®é€šå­—ç¬¦ä¸²æäº¤ï¼›ä½ è¿˜å¿…é¡»<strong>æä¾›ç”¨äºå¡«å……å ä½ç¬¦çš„å€¼</strong>ã€‚</p>
<p>å› æ­¤ï¼Œåœ¨ <code>askQuestion()</code> ä¸­ï¼Œ<code>user()</code> ä¸æ˜¯æ¥æ”¶æ¨¡æ¿å­—ç¬¦ä¸²æœ¬èº«ï¼Œè€Œæ˜¯æ¥æ”¶ä¸€ä¸ª<strong>lambda</strong>ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œè¿™ä¸ª lambda å®ç°äº† <code>Consumer&lt;UserSpec&gt;</code> æ¥å£ï¼Œè®©ä½ èƒ½<strong>å®šåˆ¶</strong>è¦å‘é€ç»™ LLM çš„æ¶ˆæ¯ã€‚</p>
<p>åœ¨æœ¬ä¾‹ä¸­ï¼Œé€šè¿‡åœ¨ <code>userSpec</code> ä¸Šè°ƒç”¨ <code>text()</code> æŒ‡å®šç”¨æˆ·æ¶ˆæ¯çš„æ­£æ–‡ï¼ˆä¹Ÿå°±æ˜¯æç¤ºæ¨¡æ¿ï¼‰ï¼Œå†é€šè¿‡å¤šæ¬¡è°ƒç”¨ <code>param()</code> ä¸ºæ¯ä¸ªå‚æ•°è®¾ç½®å€¼ã€‚åœ¨æç¤ºå‘é€ç»™ LLM ä¹‹å‰ï¼Œå ä½ç¬¦ä¼šè¢«è¿™äº›å‚æ•°å€¼<strong>å¡«å……</strong>ï¼Œä»è€Œå½¢æˆå®Œæ•´çš„æç¤ºæ¶ˆæ¯ã€‚å›¾ 3.2 æ¼”ç¤ºäº†è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3796ed3650564abf8d3a03690500a0dc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=y%2F72E1HNRGn4RHmbAwIYaQxATuQ%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.2</strong> æç¤ºæ¨¡æ¿æŠŠæ¨¡å‹æ•°æ®æ¸²æŸ“è¿›æç¤ºï¼Œå†æäº¤ç»™ LLM</p>
<p><code>askQuestion()</code> ä½™ä¸‹çš„ä»£ç ä¸ä¹‹å‰ç›¸åŒï¼š<code>call()</code> è¡¨ç¤ºæç¤ºå·²å‡†å¤‡å°±ç»ªå¹¶å‘é€ï¼›<code>content()</code> è¿”å›ç­”æ¡ˆæ–‡æœ¬ã€‚</p>
<p>é‡æ–°å¯åŠ¨åº”ç”¨ï¼Œå†æ¬¡æäº¤è¯·æ±‚ï¼Œå®ƒåº”å½“åƒä¹‹å‰ä¸€æ ·å·¥ä½œï¼ˆç”±äºç”Ÿæˆå¼ AI çš„<strong>éç¡®å®šæ€§</strong>ï¼Œå›ç­”çš„æªè¾å¯èƒ½ç•¥æœ‰å˜åŒ–ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥è¯•ç€è¯¢é—®<strong>å…¶ä»–æ¡Œæ¸¸</strong>æ¥çœ‹çœ‹å›ç­”æƒ…å†µã€‚</p>
<p>ç°åœ¨ï¼Œæç¤ºçš„æ ¸å¿ƒé›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹â€”â€”é‚£ä¸ª<strong>é™æ€å­—ç¬¦ä¸²å¸¸é‡</strong>â€”â€”å¯è¯»ä¸”æ˜“ç»´æŠ¤ï¼Œå°½ç®¡åœ¨ <code>askQuestion()</code> é‡Œå¤šäº†å‡ è¡Œä»£ç ã€‚æ—¢ç„¶æ›´æ˜“ç»´æŠ¤äº†ï¼Œæˆ‘ä»¬å°±åšç‚¹<strong>æç¤ºå·¥ç¨‹ï¼ˆprompt engineeringï¼‰</strong> ï¼ŒæŠŠæ¨¡æ¿å†ä¼˜åŒ–ä¸€ä¸‹ã€‚ä¾‹å¦‚æ”¹ä¸ºï¼š</p>
<pre><code class="hljs language-ini" lang="ini">private static final String <span class="hljs-attr">questionPromptTemplate</span> = <span class="hljs-string">"""
    You are a helpful assistant, answering questions about tabletop games.
    If you don't know anything about the game or don't know the answer,
    say "I don't know".

    The game is {game}.

    The question is: {question}.
    """</span><span class="hljs-comment">;</span>
</code></pre>
<p>è¿™ä¸ªæ–°æ¨¡æ¿ä¸º LLM è®¾ç½®äº†æ›´å¤š<strong>è§’è‰²ä¸æœŸæœ›ä¸Šä¸‹æ–‡</strong>ï¼šå‘Šè¯‰å®ƒè‡ªå·±æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠ©æ‰‹ã€è¦å›ç­”<strong>æ¡Œé¢æ¸¸æˆ</strong>ç›¸å…³çš„é—®é¢˜ï¼›è¿˜è¦æ±‚å®ƒåœ¨ä¸çŸ¥é“ç­”æ¡ˆæˆ–ä¸äº†è§£è¯¥æ¸¸æˆæ—¶<strong>æ˜ç¡®æ‰¿è®¤ä¸çŸ¥é“</strong>ã€‚</p>
<p>åƒè¿™æ ·çš„å°å°æç¤ºå·¥ç¨‹æŠ€å·§ï¼Œèƒ½å¸®åŠ©ä½ ä»æç¤ºä¸­è·å¾—æ›´å¥½çš„ç»“æœã€‚æ›´å¤šæç¤ºå·¥ç¨‹å»ºè®®å¯å‚è€ƒ <strong>Prompt Engineering Guide</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.promptingguide.ai%2F" target="_blank" title="https://www.promptingguide.ai/" ref="nofollow noopener noreferrer">www.promptingguide.ai/</a>ï¼‰ã€‚</p>
<h3 data-id="heading-3">3.1.2 å°†æ¨¡æ¿ä½œä¸ºèµ„æºå¯¼å…¥ï¼ˆImporting the template as a resourceï¼‰</h3>
<p>æŠŠæç¤ºæ¨¡æ¿çš„å­—ç¬¦ä¸²æå–æˆå¸¸é‡ï¼Œæœ‰åŠ©äºæ•´ç† <code>askQuestion()</code> æ–¹æ³•ï¼Œè®©ä»£ç æ›´æ˜“è¯»ã€ä¹Ÿæ›´ä¾¿äºè°ƒæ•´æç¤ºã€‚ä½†ä½ è¿˜èƒ½å†è¿›ä¸€æ­¥ï¼šæŠŠæ¨¡æ¿<strong>æŠ½åˆ°å¤–éƒ¨æ–‡ä»¶</strong>ã€‚è¿™æ ·æ—¢èƒ½è®©æ¨¡æ¿ä¸ Java æºç åˆ†ç¦»ï¼Œåˆä»å¯å°†æ¨¡æ¿çº³å…¥ä»£ç ä»“åº“ç®¡ç†ã€‚</p>
<p>ä¸ºæ­¤ï¼Œå…ˆåœ¨é¡¹ç›®çš„ <code>src/main/resources</code> ç›®å½•ä¸‹åˆ›å»ºåä¸º <strong><code>promptTemplates</code></strong> çš„æ–°ç›®å½•ã€‚åœ¨æ–°ç›®å½•é‡Œåˆ›å»ºæ–‡ä»¶ <strong><code>questionPromptTemplate.st</code></strong>ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">You are a helpful assistant, answering questions about tabletop games.
<span class="hljs-keyword">If</span> you don<span class="hljs-comment">'t know anything about the game or don't know the answer,</span>
say <span class="hljs-string">"I don't know"</span>.

Answer <span class="hljs-keyword">in</span> complete sentences.

The game <span class="hljs-built_in">is</span> {gameTitle}.

The question <span class="hljs-built_in">is</span>: {question}.
</code></pre>
<p><strong>NOTE</strong> ç›®å½•åä¸æ¨¡æ¿æ–‡ä»¶åå¯ä»¥éšæ„å–ï¼›åªè¦åœ¨æŠŠæ¨¡æ¿æ³¨å…¥åˆ° <code>SpringAiBoardGameService</code> æ—¶<strong>æ­£ç¡®å¼•ç”¨</strong>å³å¯ã€‚</p>
<p>ï¼ˆå°½ç®¡ä½ æŠŠä»£ç æäº¤åˆ° GitHub æ—¶å®ƒå¯èƒ½ä¼šæç¤ºåˆ«çš„ï¼‰ï¼Œæ‰©å±•å <strong><code>.st</code></strong> è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª <strong>StringTemplate</strong> æ–‡ä»¶ï¼ˆå¹¶ä¸æ˜¯ Smalltalk æ–‡ä»¶ï¼‰ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª StringTemplate æ–‡ä»¶çš„æ–‡æœ¬ä¸ä¹‹å‰å®šä¹‰çš„é™æ€å­—ç¬¦ä¸²å¸¸é‡ç›¸åŒã€‚ä½†ç°åœ¨æ¨¡æ¿åœ¨ç‹¬ç«‹æ–‡ä»¶ä¸­ï¼Œæ¨¡æ¿çš„ç»†èŠ‚å¯ä¸â€œæäº¤æç¤ºçš„ä»£ç â€åˆ†å¼€ç»´æŠ¤ã€‚</p>
<p>åŸºäºæ­¤ï¼Œä½ éœ€è¦ä¿®æ”¹ <code>SpringAiBoardGameService</code> æ¥å¼•ç”¨è¯¥æ¨¡æ¿æ–‡ä»¶ã€‚åˆ é™¤é™æ€å­—ç¬¦ä¸²å¸¸é‡ï¼Œæ”¹ä¸ºå¦‚ä¸‹å­—æ®µï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/questionPromptTemplate.st"</span>)</span>
Resource questionPromptTemplate;
</code></pre>
<p><code>@Value</code> æ³¨è§£ä½¿ç”¨ <code>classpath:</code> å‰ç¼€æ¥å¼•ç”¨æ¨¡æ¿æ–‡ä»¶ï¼Œæœ¬è´¨ä¸Šæ˜¯æŠŠå®ƒæ³¨å…¥åˆ°ä¸€ä¸ª <code>Resource</code> å±æ€§ä¸­ã€‚æ³¨æ„ï¼Œè¿™ä¸ª <code>Resource</code> å±æ€§çš„åå­—ä¸åŸå…ˆçš„å­—ç¬¦ä¸²å¸¸é‡ç›¸åŒã€‚<code>user</code> è§„æ ¼çš„ <code>text()</code> æ–¹æ³•æ˜¯<strong>é‡è½½</strong>çš„ï¼Œæ—¢å¯æ¥å— <code>String</code>ï¼Œä¹Ÿå¯æ¥å— <code>Resource</code>ã€‚å› æ­¤æŠŠè¯¥ <code>Resource</code> å‘½åä¸º <code>questionPromptTemplate</code> åï¼Œä½ <strong>æ— éœ€ä¿®æ”¹</strong> <code>askQuestion()</code> æ–¹æ³•é‡Œå¯¹æ¨¡æ¿çš„ä½¿ç”¨ã€‚</p>
<p>é‡å¯åº”ç”¨ï¼Œç»§ç»­å°±æ¸¸æˆæé—®ï¼›è¡Œä¸ºä¾æ—§ä¸ä¹‹å‰ç›¸åŒã€‚å°½ç®¡åº”ç”¨å¤–åœ¨è¡Œä¸ºæ²¡å˜ï¼Œä½†å†…éƒ¨å®ç°æ›´æ•´æ´ï¼›å¯¹æ¨¡æ¿çš„ä»»ä½•è°ƒæ•´ï¼Œéƒ½å¯ä»¥ä¸ <code>SpringAiBoardGameService</code> ä»£ç <strong>è§£è€¦</strong>åœ°å®Œæˆã€‚</p>
<p>å¦‚æœä½ è¯¢é—® checkersã€chess æˆ–å…¶ä»–çŸ¥åæ¸¸æˆï¼Œå¾ˆå¯èƒ½ä¼šå¾—åˆ°æ­£ç¡®ç­”æ¡ˆã€‚ä½†å‡è®¾ä½ é—®çš„æ˜¯æ¨¡å‹æœªè¢«è®­ç»ƒè¿‡çš„æ¸¸æˆã€‚ä¾‹å¦‚è¯•ç€è¯¢é—®çº¸ç‰Œæ¸¸æˆ <strong>Burger Battle</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.burgerbattlegame.com%2F" target="_blank" title="https://www.burgerbattlegame.com/" ref="nofollow noopener noreferrer">www.burgerbattlegame.com/</a>ï¼‰ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œå¦‚æœå®ƒä¸çŸ¥é“ç­”æ¡ˆï¼Œå®ƒä¼šè¯´ â€œI don't knowâ€ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
question=<span class="hljs-string">"What is the Grave Digger card?"</span> -b
{
    <span class="hljs-string">"answer"</span>: <span class="hljs-string">"I don't know."</span>,
    <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"Burger Battle"</span>
}
</code></pre>
<p>å°½ç®¡æ¨¡æ¿æ˜ç¡®è¦æ±‚â€œä¸ä¼šå°±è¯´ I don't knowâ€ï¼Œä½ ä»æœ‰ç›¸å½“æ¦‚ç‡å¾—åˆ°<strong>çç¼–</strong>çš„ç­”æ¡ˆï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
question=<span class="hljs-string">"What is the Destroy card?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"In Burger Battle, the Destroy card is a special card that allows
      players to eliminate one ingredient card from an opponent's burger."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"Burger Battle"</span>
}
</code></pre>
<p>å¦‚æœä½ ç©è¿‡â€”â€”æˆ–è¯»è¿‡â€”â€”Burger Battle çš„è§„åˆ™ï¼Œä½ ä¼šçŸ¥é“è¿™ç­”æ¡ˆæ˜¯<strong>é”™è¯¯çš„</strong>ã€‚è¿™å°±æ˜¯ä¸ LLM å…±äº‹æ—¶ä¸€ä¸ªä¸å¤ªå¦™ã€ä½†æœ‰æ—¶é¢‡å…·â€œå–œå‰§æ•ˆæœâ€çš„ç‰¹æ€§ï¼šå½“å®ƒå¯¹æŸè¯é¢˜è®­ç»ƒä¸è¶³æ—¶ï¼Œå¯èƒ½<strong>ç¼–é€ </strong>ä¸€ä¸ªå®Œå…¨ä¸çœŸå®çš„ç­”æ¡ˆâ€”â€”é€šå¸¸ç§°ä¸º<strong>å¹»è§‰ï¼ˆhallucinationsï¼‰</strong> ã€‚</p>
<p>é¿å…å¹»è§‰çš„å‡ ç§æ–¹å¼åŒ…æ‹¬ï¼š</p>
<ul>
<li>è®­ç»ƒä½ è‡ªå·±çš„æ¨¡å‹</li>
<li>å¯¹ç°æœ‰æ¨¡å‹è¿›è¡Œå¾®è°ƒï¼ˆfine-tuningï¼‰</li>
<li>åœ¨æç¤ºä¸­æä¾›<strong>é¢å¤–ä¸Šä¸‹æ–‡</strong></li>
</ul>
<p>ä»æ ¹æœ¬ä¸Šè¯´ï¼Œè®­ç»ƒæˆ–å¾®è°ƒï¼ˆæ›´ä¸ç”¨è¯´èƒ½åŸºäºç§æœ‰æ•°æ®å®šåˆ¶æ¨¡å‹ï¼‰æ˜¯é¿å…å¹»è§‰çš„ä¸Šç­–ï¼Œä½†è¿™å¾ˆéš¾ï¼Œä¸”éœ€è¦<strong>æ•°æ®ç§‘å­¦</strong>é¢†åŸŸçš„æŠ€èƒ½è€Œéè½¯ä»¶å¼€å‘æŠ€èƒ½ã€‚æ­¤å¤–ï¼Œè®­ç»ƒ/å¾®è°ƒè¦æƒ³åšå¾—å¥½ï¼Œéœ€è¦<strong>å¤§é‡æ•°æ®</strong>ï¼Œä¹Ÿéå¸¸è€—æ—¶â€”â€”å¯èƒ½æ˜¯æ•°å°æ—¶ã€æ•°å¤©ï¼Œç”šè‡³æ•°å‘¨ã€‚ä»¥æˆ‘ä»¬æ„å»ºçš„æ¡Œæ¸¸ç¤ºä¾‹ä¸ºä¾‹ï¼Œå› åº”æ–°å“å‘å¸ƒ<strong>ç«‹å³</strong>ä¸ºå…¶â€œåŠ å…¥ä¸€ä¸ªæ¸¸æˆâ€çš„åšæ³•å°±ä¸å¯è¡Œã€‚</p>
<p>ç›¸è¾ƒä¹‹ä¸‹ï¼Œåœ¨æç¤ºä¸­æ·»åŠ <strong>ä¸€äº›ä¸Šä¸‹æ–‡</strong>å‡ ä¹å°±åƒæ·»åŠ é—®é¢˜æœ¬èº«é‚£æ ·ç®€å•â€”â€”åœ¨æäº¤æç¤ºçš„<strong>å³æ—¶</strong>é˜¶æ®µå®Œæˆã€‚å› æ­¤ï¼Œå®ƒæ¯”è®­ç»ƒ/å¾®è°ƒè¦<strong>ç®€å•å¾—å¤š</strong>ã€‚</p>
<p>ä¸‹é¢çœ‹çœ‹å¦‚ä½•åœ¨æç¤ºä¸­è¿åŒé—®é¢˜ä¸€èµ·æä¾›<strong>é¢å¤–ä¸Šä¸‹æ–‡</strong>ã€‚è¿™å°†ä¸ºä¸‹ä¸€ç« çš„ <strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> åšé“ºå«â€”â€”RAG æ˜¯ä¸€ç§æ›´é«˜çº§çš„æ–¹æ³•ï¼Œèƒ½åœ¨ä¸è¶…é™çš„æƒ…å†µä¸‹ä¸ºæç¤ºæ·»åŠ ç›¸å…³ä¸Šä¸‹æ–‡ã€‚</p>
<h2 data-id="heading-4">3.2 ç”¨ä¸Šä¸‹æ–‡â€œå¡«å……â€æç¤ºï¼ˆStuffing the prompt with contextï¼‰</h2>
<p>å›æƒ³ä½ ä¸Šå­¦æ—¶ï¼Œå¯èƒ½é‡åˆ°è¿‡<strong>å¼€å·è€ƒè¯•</strong>ã€‚è¿™æ—¶ï¼Œä½ ä¸å¿…æŠŠæ‰€æœ‰å†…å®¹<strong>æ­»è®°</strong>åœ¨è„‘å­é‡Œï¼šå³ä¾¿ä½ æ²¡å¤ä¹ ï¼Œä¹Ÿèƒ½ç¿»ä¹¦æ‰¾åˆ°è¿‡å…³æ‰€éœ€çš„ç­”æ¡ˆã€‚</p>
<p>åœ¨ç”Ÿæˆå¼ AI ä¸­ï¼Œå¸¸è¢«ç§°ä¸º <strong>â€œstuffing the promptï¼ˆå¡«å……æç¤ºï¼‰â€</strong> çš„æŠ€å·§ï¼Œå°±åƒç»™ LLM è¿›è¡Œä¸€æ¬¡â€œå¼€å·è€ƒè¯•â€ã€‚é™¤äº†æŠŠé—®é¢˜æäº¤ç»™ LLM ç”Ÿæˆå¤–ï¼Œä½ è¿˜æä¾›ä¸€æ®µ<strong>é¢å¤–æ–‡æœ¬</strong>ä¾›å®ƒå‚è€ƒã€‚è¿™æ ·ï¼ŒLLM å³ä¾¿æœªåœ¨è¯¥ä¸»é¢˜ä¸Šé¢„è®­ç»ƒï¼Œä¹Ÿèƒ½å›ç­”ç›¸å…³é—®é¢˜ã€‚</p>
<p>ä¸ºäº†è®© <strong>Board Game Buddy</strong> èƒ½å‡†ç¡®å›ç­” <strong>Burger Battle</strong>ï¼ˆLLM æœªè®­ç»ƒè¿‡çš„æ¸¸æˆï¼‰çš„é—®é¢˜ï¼Œæˆ‘ä»¬ç»™å®ƒæ¥ä¸€åœºâ€œå¼€å·â€ï¼šæŠŠ<strong>æ¸¸æˆè§„åˆ™</strong>ä½œä¸ºä¸Šä¸‹æ–‡åŠ å…¥æç¤ºã€‚æœ€ç›´æ¥çš„æ–¹å¼æ˜¯åˆ›å»ºä¸€ä¸ª<strong>çº¯æ–‡æœ¬æ–‡ä»¶</strong>æ¥å­˜æ”¾è¯¥æ¸¸æˆè§„åˆ™ã€‚</p>
<p><strong>Burger Battle</strong> çš„è§„åˆ™ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fmng.bz%2FyNKo" target="_blank" title="https://mng.bz/yNKo" ref="nofollow noopener noreferrer">mng.bz/yNKo</a>ï¼‰ç›¸å¯¹è¾ƒçŸ­ï¼Œä½†ä»ç„¶å¤ªé•¿ï¼Œä¸é€‚åˆåŸæ–‡å°åœ¨ä¹¦é‡Œã€‚è‡³å°‘ï¼Œä¸ºäº†è®© LLM èƒ½å›ç­” Destroy å¡æˆ–å…¶ä»–æˆ˜æ–—å¡ç›¸å…³é—®é¢˜ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«ä»¥ä¸‹å†…å®¹çš„æ–‡ä»¶ï¼š</p>
<pre><code class="hljs language-python" lang="python">* Burger Bomb: Blow up another playe<span class="hljs-string">r's Burger by sending their ingredients
to the Graveyard.
* Burger Force Field: Your Burger is now protected from all Battle Cards
* Burgerpocalypse: Obliterate all players'</span> ingredients, including your own,
<span class="hljs-keyword">and</span> toss them <span class="hljs-keyword">in</span> the Graveyard.
* Destroy!: Destroy <span class="hljs-built_in">any</span> Battle Card of yours <span class="hljs-keyword">or</span> another playe<span class="hljs-string">r's and toss
it in the Graveyard.
* Gonna Eat That?: Steal another player'</span>s ingredient <span class="hljs-keyword">and</span> add it to your
Burger.
* Grave Digger: Dig through the Graveyard <span class="hljs-keyword">for</span> <span class="hljs-built_in">any</span> needed ingredient <span class="hljs-keyword">and</span> add
it to your Burger.
* I Got Nothin<span class="hljs-string">': Toss your hand in the Graveyard and draw 5 new cards
* More Meat!: Make another player'</span>s Burger a double-decker by adding an
extra Meat to their ingredients <span class="hljs-built_in">list</span>.
* Pickle Plague: Rain vengeance down upon another player by adding Pickles
to their ingredients <span class="hljs-built_in">list</span>.
* Picky Eater: Throw another playe<span class="hljs-string">r's Lettuce, Tomato, or Onion in the
Graveyard.
* The Old Switcheroo: Trade hands with another player.
* Yours Looks Good!: Trade your Burger and all of your ingredients with
another player, including added Battle Cards.
</span></code></pre>
<p>æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åˆ° <code>src/main/resources</code> ä¸‹æ–°å»ºçš„ <strong><code>gameRules</code></strong> ç›®å½•ï¼Œå‘½åä¸º <strong><code>burger_battle.txt</code></strong>ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹æ¨¡æ¿ï¼ŒåŠ å…¥ä¸€ä¸ª<strong>è§„åˆ™å ä½ç¬¦</strong>ï¼š</p>
<pre><code class="hljs language-vbnet" lang="vbnet">You are a helpful assistant, answering questions about tabletop games.
<span class="hljs-keyword">If</span> available, use the rules <span class="hljs-keyword">in</span> the RULES section below.
<span class="hljs-keyword">If</span> you don<span class="hljs-comment">'t know anything about the game or don't know the answer,</span>
say <span class="hljs-string">"I don't know"</span>.

Answer <span class="hljs-keyword">in</span> complete sentences.

The game <span class="hljs-built_in">is</span> {gameTitle}.

The question <span class="hljs-built_in">is</span>: {question}.

<span class="hljs-symbol">RULES:</span>
{rules}
</code></pre>
<p>æ³¨æ„ï¼Œé™¤äº†æ–°å¢ <code>{rules}</code> å ä½ç¬¦ä¹‹å¤–ï¼Œæ–‡æœ¬ä¸­è¿˜åŠ å…¥äº†<strong>æŒ‡ä»¤</strong>ï¼Œå‘Šè¯‰ LLMï¼šå¦‚æœæœ‰è§„åˆ™å¯ç”¨ï¼Œè¯·ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>åœ¨æŠŠè§„åˆ™æ³¨å…¥æç¤ºä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠè§„åˆ™<strong>è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²</strong>ã€‚ä¸ºæ­¤ï¼Œåˆ›å»ºä¸€ä¸ªç±»ä¼¼ä¸‹æ–¹æ¸…å•çš„æœåŠ¡ç±»ã€‚</p>
<p><strong>æ¸…å• 3.3 <code>GameRulesService</code> å°†æ¸¸æˆè§„åˆ™åŠ è½½ä¸ºå­—ç¬¦ä¸²</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.core.io.DefaultResourceLoader;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> java.nio.charset.Charset;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">GameRulesService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Logger</span> <span class="hljs-variable">LOG</span> <span class="hljs-operator">=</span>
      LoggerFactory.getLogger(GameRulesService.class);

  <span class="hljs-keyword">public</span> String <span class="hljs-title function_">getRulesFor</span><span class="hljs-params">(String gameName)</span> {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-type">var</span> <span class="hljs-variable">filename</span> <span class="hljs-operator">=</span> String.format(
          <span class="hljs-string">"classpath:/gameRules/%s.txt"</span>,
          gameName.toLowerCase().replace(<span class="hljs-string">" "</span>, <span class="hljs-string">"_"</span>));

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultResourceLoader</span>()
          .getResource(filename)
          .getContentAsString(Charset.defaultCharset()); \
           } <span class="hljs-keyword">catch</span> (IOException e) {
      LOG.info(<span class="hljs-string">"No rules found for game: "</span> + gameName);
      <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
    }
  }

}
</code></pre>
<p>ç®€è€Œè¨€ä¹‹ï¼Œ<code>getRulesFor()</code> ä¼šé€šè¿‡ <code>Resource</code> æŠŠæŸä¸ªæ¸¸æˆçš„è§„åˆ™<strong>åŠ è½½ä¸ºå­—ç¬¦ä¸²</strong>ã€‚ç”±äºèµ„æºè·¯å¾„ä¼šéšæ¸¸æˆåå˜åŒ–ï¼Œæ— æ³•åƒæ¨¡æ¿é‚£æ ·ç”¨ <code>@Value</code> å›ºå®šæ³¨å…¥ï¼Œå› æ­¤ <code>getRulesFor()</code> å€ŸåŠ©äº†ä¸€äº› Spring çš„å·¥å…·ç±»æ¥æ„é€  <code>Resource</code>ã€‚</p>
<p>åœ¨æ„é€ è§„åˆ™è·¯å¾„æ—¶ï¼Œ<code>getRulesFor()</code> ä¼šæŠŠæ¸¸æˆæ ‡é¢˜<strong>è½¬ä¸ºå°å†™</strong>å¹¶æŠŠç©ºæ ¼æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œé¿å…å› å¤§å°å†™æˆ–ç©ºæ ¼å·®å¼‚å¯¼è‡´æ ‡é¢˜ä¸æ–‡ä»¶åä¸ä¸€è‡´ã€‚ä¾‹å¦‚å¦‚æœ <code>Question</code> ä¸­ä¼ å…¥çš„æ¸¸æˆåæ˜¯ â€œBurger battleâ€ï¼Œå®ƒä¼šè¢«è§„èŒƒåŒ–ä¸º <code>burger_battle</code>ã€‚</p>
<p>ç°åœ¨å¯ä»¥ä¿®æ”¹ <code>SpringAiBoardGameService</code>ï¼ŒæŠŠè§„åˆ™åŠ å…¥æç¤ºã€‚é¦–å…ˆæŠŠ <code>GameRulesService</code> æ³¨å…¥è¿›æ¥ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-title">implements</span> <span class="hljs-title">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GameRulesService gameRulesService;

  <span class="hljs-keyword">public</span> SpringAiBoardGameService(
      ChatClient.Builder chatClientBuilder,
      GameRulesService gameRulesService) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    <span class="hljs-keyword">this</span>.gameRulesService = gameRulesService;
  }

  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>ç„¶åï¼Œä¿®æ”¹ <code>askQuestion()</code>ï¼Œè°ƒç”¨ <code>GameRulesService</code> è¯»å–è§„åˆ™ï¼Œå¹¶é€šè¿‡å†è°ƒç”¨ä¸€æ¬¡ <code>param()</code> æŠŠè§„åˆ™ä½œä¸ºå‚æ•°åŠ å…¥ç”¨æˆ·æ¶ˆæ¯è§„æ ¼ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Override</span>
public Answer <span class="hljs-built_in">askQuestion</span>(Question question) {
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">gameRules</span> = <span class="hljs-selector-tag">gameRulesService</span><span class="hljs-selector-class">.getRulesFor</span>(question.<span class="hljs-built_in">gameTitle</span>());

  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">answerText</span> = <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>()
      <span class="hljs-selector-class">.user</span>(userSpec -&gt; userSpec
          .<span class="hljs-built_in">text</span>(questionPromptTemplate)
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"gameTitle"</span>, question.<span class="hljs-built_in">gameTitle</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"question"</span>, question.<span class="hljs-built_in">question</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"rules"</span>, gameRules))
      <span class="hljs-selector-class">.call</span>()
      <span class="hljs-selector-class">.content</span>();

  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Answer</span>(question.<span class="hljs-built_in">gameTitle</span>(), answerText);
}
</code></pre>
<p>ç°åœ¨å¯ä»¥è¯•ä¸€è¯•äº†ã€‚é‡å¯åº”ç”¨ï¼Œå†æ¬¡è¯¢é—® Burger Battle çš„ <strong>Destroy</strong> å¡ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
question=<span class="hljs-string">"What is the Destroy card?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"The Destroy card in Burger Battle allows you to destroy any
      Battle Card, whether it belongs to you or another player, and then
      place it in the Graveyard."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"Burger Battle"</span>
}
</code></pre>
<p>å¤ªæ£’äº†ï¼è¿™æ¬¡ç­”æ¡ˆ<strong>æ­£ç¡®</strong>ï¼Œè€Œä¸”æ˜¾ç„¶æ˜¯ä»æç¤ºä¸­ç»™å®šçš„<strong>ä¸Šä¸‹æ–‡</strong>æŠ½å–å‡ºæ¥çš„ã€‚</p>
<p>ä¸ºç¡®ä¿å…¶ä»–æ¸¸æˆä¹Ÿèƒ½æ­£å¸¸å›ç­”ï¼Œå†è¯•ä¸€æ¬¡ã€‚è¿™æ¬¡é—® <strong>chess</strong>ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/ask gameTitle=<span class="hljs-string">"chess"</span> \
question=<span class="hljs-string">"How are knights allowed to move?"</span> -b
{
  <span class="hljs-string">"answer"</span>: <span class="hljs-string">"In chess, knights move in an L-shape: two squares in one
      direction, and then one square perpendicular to that. Knights are the
      only pieces that can jump over other pieces on the board."</span>,
  <span class="hljs-string">"gameTitle"</span>: <span class="hljs-string">"chess"</span>
}
</code></pre>
<p>å³ä½¿åº”ç”¨<strong>æ²¡æœ‰</strong>ä»èµ„æºä¸­åŠ è½½å›½é™…è±¡æ£‹çš„è§„åˆ™ï¼Œæ¨¡å‹ä¹Ÿèƒ½å›ç­”ï¼Œå› ä¸ºå®ƒå·²åœ¨è®­ç»ƒä¸­å­¦è¿‡å›½é™…è±¡æ£‹è§„åˆ™ã€‚</p>
<p>éœ€è¦ç†è§£çš„æ˜¯ï¼š<strong>æ›´å¤šä¸Šä¸‹æ–‡</strong>æ„å‘³ç€æç¤ºä¸­ä¼šæœ‰<strong>æ›´å¤šè¾“å…¥ token</strong>ã€‚ä¾‹å¦‚æé—®å›½é™…è±¡æ£‹æ—¶æ²¡æœ‰é¢å¤–ä¸Šä¸‹æ–‡ï¼Œæç¤ºåªæœ‰ <strong>75 ä¸ª token</strong>ï¼›è€Œ Burger Battle çš„é—®é¢˜ï¼ˆå³ä¾¿åªåŒ…å«ä¸€å°æ®µè§„åˆ™ï¼‰æç¤º token æ•°æ˜¯ <strong>315</strong> â€”â€” æ˜¯æ— ä¸Šä¸‹æ–‡æ—¶çš„ <strong>4 å€å¤š</strong>ã€‚</p>
<p>è‡³å°‘ï¼Œtoken æ•°ä¼šå½±å“<strong>æˆæœ¬</strong>ï¼šæç¤ºï¼ˆä»¥åŠå“åº”ï¼‰ä¸­çš„ token è¶Šå¤šï¼Œä»˜è´¹å°±è¶Šå¤šã€‚å¾ˆå¤š LLMï¼ˆå¦‚ GPT-4oï¼‰åœ¨æ¯ 1,000 token çš„ä»·æ ¼ä¸Šéå¸¸ä¾¿å®œï¼Œä½†éšç€ä½¿ç”¨æ—¶é—´å¢é•¿ï¼Œä¹Ÿä¼šç´¯ç§¯ã€‚</p>
<p>æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœæç¤ºé‡Œ token å¤ªå¤šï¼Œå¯èƒ½ä¼š<strong>è¶…å‡ºä¸Šä¸‹æ–‡çª—å£</strong>çš„é™åˆ¶ã€‚ä»¥ GPT-4o ä¸ºä¾‹ï¼Œçª—å£ä¸º <strong>128K</strong> tokenï¼Œè¿œè¶…æˆ‘ä»¬è¿™ä¸ªç®€å•ç¤ºä¾‹çš„éœ€æ±‚ã€‚å¤§å¤šæ•°æ¡Œæ¸¸çš„è§„åˆ™éƒ½èƒ½è½»æ¾è½åœ¨ 128K å†…ï¼Œä½†åœ¨å…¶ä»–é¢†åŸŸï¼ŒæŠŠå¤§ä½“é‡æ–‡æ¡£ä½œä¸ºä¸Šä¸‹æ–‡å°±<strong>å¾ˆå¯èƒ½</strong>è¶…é™ã€‚</p>
<p>åœ¨ä¸‹ä¸€ç« é‡Œï¼Œä½ å°†å­¦ä¹ å¦‚ä½•ä½¿ç”¨ <strong>RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰</strong> ï¼Œåœ¨ä¸è¶…é™çš„æƒ…å†µä¸‹ï¼Œä¸ºæç¤ºæä¾›<strong>ç›¸å…³çš„ä¸Šä¸‹æ–‡</strong>ã€‚åœ¨å¼•å…¥ RAG ä¹‹å‰ï¼Œå…³äºæç¤ºæˆ‘ä»¬è¿˜æœ‰ä¸€äº›å†…å®¹è¦æ¢ç´¢ï¼Œæ¯”å¦‚<strong>æç¤ºè§’è‰²ï¼ˆprompt rolesï¼‰</strong> çš„ç”¨æ³•ã€‚</p>
<h2 data-id="heading-5">3.3 ä¸ºæç¤ºåˆ†é…è§’è‰²ï¼ˆAssigning prompt rolesï¼‰</h2>
<p>åŒ…æ‹¬ OpenAIã€MistralAIã€Anthropic åœ¨å†…çš„è®¸å¤š LLMï¼Œéƒ½æ”¯æŒæŠŠä¸€ä¸ªæç¤ºåˆ‡åˆ†ä¸ºå¤šæ¡<strong>æ¶ˆæ¯</strong>ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½å½’å±äºæŸä¸ª<strong>è§’è‰²</strong>ï¼Œæ¨¡å‹åº”æŒ‰è¯¥è§’è‰²æ¥ç†è§£è¿™æ®µå†…å®¹ã€‚å¸¸è§çš„è§’è‰²åŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>Userï¼ˆç”¨æˆ·ï¼‰</strong> â€”â€”æ¥è‡ªåº”ç”¨ç”¨æˆ·ï¼ˆæˆ–ä»£è¡¨ç”¨æˆ·ï¼‰çš„æé—®æˆ–é™ˆè¿°ã€‚</li>
<li><strong>Systemï¼ˆç³»ç»Ÿï¼‰</strong> â€”â€”åº”ç”¨æœ¬èº«ç»™ LLM çš„æŒ‡ä»¤ã€‚</li>
<li><strong>Assistantï¼ˆåŠ©æ‰‹ï¼‰</strong> â€”â€”LLM çš„å“åº”å†…å®¹ã€‚</li>
<li><strong>Toolï¼ˆå·¥å…·ï¼‰</strong> â€”â€”è°ƒç”¨å¤–éƒ¨å·¥å…·ä»¥æ‰§è¡ŒæŸäº›æ“ä½œæˆ–è·å–é¢å¤–ä¸Šä¸‹æ–‡çš„æŒ‡ä»¤ã€‚</li>
</ul>
<p>ç°åœ¨æˆ‘ä»¬å…ˆèšç„¦ <strong>user</strong> ä¸ <strong>system</strong> æ¶ˆæ¯ã€‚<strong>assistant</strong> æ¶ˆæ¯åœ¨ä¸ LLM çš„<strong>å¤šè½®å¯¹è¯</strong>ä¸­æ‰ä¼šç”¨åˆ°ï¼Œç¬¬ 5 ç« ä¼šè¯¦ç»†è®¨è®ºã€‚ç¬¬ 6 ç« åˆ™ä¼šçœ‹åˆ° <strong>tool</strong> æ¶ˆæ¯å¦‚ä½•é€šè¿‡å¯¹æ¥ API è®© AI äº¤äº’æ›´å…·åŠ¨æ€æ€§ã€‚</p>
<blockquote>
<p><strong>NOTE</strong> å¹¶éæ‰€æœ‰ LLM API éƒ½æ”¯æŒç›¸åŒçš„æ¶ˆæ¯è§’è‰²é€‰æ‹©ã€‚å¦‚æœæŸä¸ª API ä¸æ”¯æŒ <strong>System</strong> è§’è‰²ï¼ŒSpring AI ä¼šæŠŠåŸæœ¬ç”¨äº System è§’è‰²çš„æ–‡æœ¬ç›´æ¥åˆå¹¶è¿› <strong>User</strong> æ¶ˆæ¯é‡Œã€‚</p>
</blockquote>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€ç›´é€šè¿‡ <code>user()</code> æ–¹æ³•æ¥æŒ‡å®šæç¤ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›æç¤ºåœ¨è¯­ä¹‰ä¸Šéƒ½å±äº<strong>ç”¨æˆ·æ¶ˆæ¯</strong>ã€‚ä¾‹å¦‚ï¼Œåœ¨å½“å‰ä»£ç åŸºç¡€ä¸Šè¯¢é—®â€œcheckersï¼ˆè·³æ£‹ï¼‰æœ‰å¤šå°‘æ£‹å­â€ï¼ŒSpring AI ä¼šå‘ OpenAI å‘é€å¦‚ä¸‹ JSONï¼ˆä½œä¸º POST è¯·æ±‚ä½“ï¼‰ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">{
  <span class="hljs-string">"messages"</span>: [
    {
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"You are a helpful assistant, answering questions about
          tabletop games.<span class="hljs-subst">\n</span>If available, use the rules in the RULES section
          below.<span class="hljs-subst">\n</span>If you don't know anything about the game or don't know the
          answer,<span class="hljs-subst">\n</span>say "</span><span class="hljs-type">I</span> don't know<span class="hljs-string">".<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>The game is checkers.<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>The
          question is: How many pieces are there?.<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>RULES:<span class="hljs-subst">\n</span>"</span>,
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>
    }
  ],
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4o"</span>,
  <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>
}
</code></pre>
<p>å¯ä»¥çœ‹åˆ°è¿™é‡Œåªæœ‰ä¸€æ¡æ¶ˆæ¯ï¼Œå†…å®¹æ˜¯æ•´ä¸ªæç¤ºï¼Œè§’è‰²æ˜¯ <strong>user</strong>ã€‚è¿™èƒ½å·¥ä½œï¼Œä½†<strong>è¿˜èƒ½æ›´å¥½</strong>ã€‚</p>
<h4 data-id="heading-6">æ£€æŸ¥ Spring AI çš„è¯·æ±‚ä¸å“åº”</h4>
<p>å¦‚æœä½ æƒ³æŸ¥çœ‹ä½¿ç”¨ Spring AI æäº¤æç¤ºæ—¶çš„<strong>åŸå§‹è¯·æ±‚ä¸å“åº” JSON</strong>ï¼Œå¯ä»¥åœ¨é¡¹ç›®é‡ŒåŠ å…¥ Logbookï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fzalando%2Flogbook" target="_blank" title="https://github.com/zalando/logbook" ref="nofollow noopener noreferrer">github.com/zalando/logâ€¦</a>ï¼‰ä¾èµ–ï¼š</p>
<pre><code class="hljs language-arduino" lang="arduino">implementation <span class="hljs-string">'org.zalando:logbook-spring-boot-starter:3.9.0'</span>
</code></pre>
<p>è¯¥ä¾èµ–ä¼šä¸º Spring è‡ªåŠ¨é…ç½®ä¸€äº›ç»„ä»¶ï¼Œç”¨æ¥æ‹¦æˆªå¹¶è®°å½•é€šè¿‡è¿™äº›ç»„ä»¶å‘èµ·çš„ HTTP è¯·æ±‚ä¸è¿”å›çš„å“åº”ã€‚</p>
<p>Spring AI çš„ <code>ChatClient</code> åº•å±‚ç”¨çš„æ˜¯ Spring çš„ <strong>RestClient</strong>ï¼Œå› æ­¤ä½ éœ€è¦å£°æ˜ä¸€ä¸ª <code>RestClientCustomizer</code> beanï¼ŒæŠŠ Logbook çš„ <code>LogbookClientHttpRequestInterceptor</code> åŠ ä¸ºè¯·æ±‚æ‹¦æˆªå™¨ï¼š</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-meta">@Bean</span>
<span class="hljs-title class_">RestClientCustomizer</span> <span class="hljs-title function_">logbookCustomizer</span>(<span class="hljs-params">
        LogbookClientHttpRequestInterceptor interceptor</span>) {
  <span class="hljs-keyword">return</span> restClient -&gt; restClient.<span class="hljs-title function_">requestInterceptor</span>(interceptor);
}
</code></pre>
<p>Logbook ä»¥ <strong>TRACE</strong> çº§åˆ«è®°å½•è¯·æ±‚ä¸å“åº”ç»†èŠ‚ï¼Œå› æ­¤éœ€è¦åœ¨ <code>application.properties</code> ä¸­è®¾ç½®æ—¥å¿—çº§åˆ«ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">logging.level.org.zalando.logbook: TRACE</span>
</code></pre>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒLogbook ä»¥ <strong>JSON</strong> æ ¼å¼è¾“å‡ºæ—¥å¿—ï¼Œå¯è¯»æ€§ä¸€èˆ¬ï¼›å¯é€‰åœ°ï¼Œä½ å¯ä»¥æŠŠ <code>logbook.format.style</code> è®¾ä¸º <code>http</code> æ¥æå‡å¯è¯»æ€§ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">logbook.format.style</span>=http
</code></pre>
<p>é…ç½®å®Œæˆåï¼ŒSpring AI ä¸å„ AI API ä¹‹é—´çš„è¯·æ±‚ä¸å“åº”éƒ½ä¼šè¢«è®°å½•ï¼Œä¾¿äºæ£€æŸ¥ã€‚éœ€è¦æ³¨æ„ï¼šSpring AI çš„ <strong>Gemini</strong> æ¨¡å—ä½¿ç”¨ Google è‡ªæœ‰çš„ HTTP å®¢æˆ·ç«¯åº“è€Œé RestClientï¼Œå› æ­¤å¦‚æœé€‰æ‹© Google Gemini ä½œä¸º LLMï¼ŒLogbook å°†<strong>æ— æ³•</strong>æ‹¦æˆªå…¶è¯·æ±‚ã€‚</p>
<p>å¦‚å›¾ 3.3 æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯å†…å®¹æ‹†æˆä¸¤æ¡ï¼šå…¶ä¸­å¤§éƒ¨åˆ†æ–‡æœ¬å®é™…æ˜¯<strong>ç»™ LLM çš„æŒ‡ä»¤</strong>ï¼Œç”¨äºæŒ‡å¯¼å®ƒå¦‚ä½•å›ç­”ç”¨æˆ·é—®é¢˜ï¼Œå› æ­¤æ›´åˆé€‚åšæˆ <strong>system</strong> æ¶ˆæ¯ï¼›çœŸæ­£æ¥è‡ªç”¨æˆ·çš„åªæœ‰<strong>é‚£ä¸ªé—®é¢˜æœ¬èº«</strong>ã€‚</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6dd859ae2d244eb3aacee01c0b90cc0d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=JCS2SqX8wZpL0QS%2FP%2BvHkWaPFcs%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.3</strong> å°†åŸå…ˆçš„ç”¨æˆ·æ¶ˆæ¯æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ system ä¸ user æ¶ˆæ¯</p>
<p>è¦æŠŠè¿™ä¸ªå˜æ›´åº”ç”¨åˆ°é¡¹ç›®ä¸­ï¼Œå…ˆåœ¨æ¨¡æ¿ç›®å½•æ–°å¢ä¸€ä¸ª <strong><code>systemPromptTemplate.st</code></strong> æ–‡ä»¶ï¼Œç”¨å®ƒæ›¿ä»£åŸå…ˆçš„ <code>questionPromptTemplate.st</code>ï¼ˆåè€…ä¸å†ä½¿ç”¨ï¼Œå¯ä»¥åˆ é™¤ï¼‰ã€‚æ–°çš„ system æ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-markdown" lang="markdown">You are a helpful assistant, answering questions about the tabletop
game named {gameTitle}. If available, use the rules in the RULES 
section below.

Answer in complete sentences.

<span class="hljs-section">RULES
-----</span>
{rules}
</code></pre>
<p>æ¥ä¸‹æ¥éœ€è¦è°ƒæ•´ <code>SpringAiBoardGameService</code>ï¼Œè®©å®ƒä½¿ç”¨è¿™ä¸ª<strong>æ–°æ¨¡æ¿</strong>è€Œéæ—§çš„ question æ¨¡æ¿ã€‚ç”¨ä¸‹é¢çš„å­—æ®µæ›¿æ¢æ‰ç±»ä¸­ç°æœ‰çš„æ¨¡æ¿ <code>Resource</code> å±æ€§ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/systemPromptTemplate.st"</span>)</span>
Resource promptTemplate;
</code></pre>
<p>æœ€åï¼Œå¯¹ <code>askQuestion()</code> æ–¹æ³•åšä¸€äº›å˜æ›´ä»¥ä½¿ç”¨æ–°æ¨¡æ¿ã€‚æ–°ç‰ˆæœ¬å¦‚ä¸‹ï¼ˆ<strong>æ¸…å• 3.4 å°†æç¤ºæ‹†åˆ†ä¸ºç‹¬ç«‹çš„ user ä¸ system æ¶ˆæ¯</strong>ï¼‰ï¼š</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Override</span>
public Answer <span class="hljs-built_in">askQuestion</span>(Question question) {
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">gameRules</span> = <span class="hljs-selector-tag">gameRulesService</span><span class="hljs-selector-class">.getRulesFor</span>(question.<span class="hljs-built_in">gameTitle</span>());

  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">answerText</span> = <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>()
      <span class="hljs-selector-class">.system</span>(systemSpec -&gt; systemSpec      #<span class="hljs-number">1</span>
          .<span class="hljs-built_in">text</span>(promptTemplate)
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"gameTitle"</span>, question.<span class="hljs-built_in">gameTitle</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"rules"</span>, gameRules))
      <span class="hljs-selector-class">.user</span>(question.<span class="hljs-built_in">question</span>())             <span class="hljs-selector-id">#2</span>
      <span class="hljs-selector-class">.call</span>()
      <span class="hljs-selector-class">.content</span>();

  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">new</span> <span class="hljs-selector-tag">Answer</span>(question.<span class="hljs-built_in">gameTitle</span>(), answerText);
}
</code></pre>
<p>å…·ä½“è€Œè¨€ï¼šæ¨¡æ¿é€šè¿‡ <strong>system</strong> æ¶ˆæ¯è§„æ ¼çš„ <code>text()</code> æä¾›ï¼ˆè€Œä¸æ˜¯å…ˆå‰çš„ <strong>user</strong> è§„æ ¼ï¼‰ï¼Œç”¨äºå¡«å……å ä½ç¬¦çš„å‚æ•°ä¹ŸåŒç†ã€‚è‡³äº <strong>user</strong> æ¶ˆæ¯ï¼Œå†æ¬¡ä»…ä½¿ç”¨<strong>ç”¨æˆ·é—®é¢˜çš„æ–‡æœ¬</strong>æœ¬èº«ã€‚</p>
<p><strong>user ä¸ system æ¶ˆæ¯çš„å…ˆåé¡ºåºå¹¶ä¸é‡è¦</strong>ï¼›æ— è®ºé¡ºåºå¦‚ä½•ï¼Œå®ƒä»¬æœ€ç»ˆéƒ½ä¼šå‡ºç°åœ¨å‘ç»™ LLM çš„è¯·æ±‚ä¸­ã€‚</p>
<p>å®Œæˆè¿™äº›ä¿®æ”¹åï¼Œé‡å¯åº”ç”¨å†è¯•ä¸€æ¬¡ã€‚è¡¨é¢ä¸Šä»ä¸ä¹‹å‰ä¸€è‡´ï¼Œä½†åº•å±‚å‘å¾€ OpenAI çš„è¯·æ±‚ç°åœ¨åŒ…å«ä¸¤æ¡æ˜ç¡®åˆ†ç¦»çš„æ¶ˆæ¯ï¼šä¸€æ¡æ˜¯ <strong>system æŒ‡ä»¤</strong>ï¼Œä¸€æ¡æ˜¯ <strong>user æé—®</strong>ï¼š</p>
<pre><code class="hljs language-swift" lang="swift">{
  <span class="hljs-string">"messages"</span>: [
    {
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"How many pieces are there?"</span>,
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>
    },
    {
      <span class="hljs-string">"content"</span>: <span class="hljs-string">"You are a helpful assistant, answering questions about the
          tabletop<span class="hljs-subst">\n</span>game named checkers. If available, use the rules in the
          RULES section below.<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>RULES<span class="hljs-subst">\n</span>-----<span class="hljs-subst">\n</span>"</span>,
      <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>
    }
  ],
  <span class="hljs-string">"model"</span>: <span class="hljs-string">"gpt-4o"</span>,
  <span class="hljs-string">"stream"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-string">"temperature"</span>: <span class="hljs-number">0.7</span>
}
</code></pre>
<p>å°½ç®¡æˆ‘ä»¬ç›®å‰çš„ç¤ºä¾‹å¯èƒ½è¿‡äºç®€å•ï¼Œä¸è¶³ä»¥ä½“ç°â€œè§’è‰²â€å¸¦æ¥çš„æ˜æ˜¾å·®å¼‚ï¼Œä½†æ€»ä½“è€Œè¨€ï¼Œ<strong>åˆç†ä½¿ç”¨è§’è‰²æœ‰åŠ©äº LLM ç”Ÿæˆæ›´ä¼˜çš„å“åº”</strong>ã€‚éšç€æç¤ºå¤æ‚åº¦æé«˜ï¼Œè¿™ç§ç§¯æä½œç”¨ä¼šæ›´åŠ æ˜¾è‘—ã€‚</p>
<p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬å…³æ³¨çš„æ˜¯å¦‚ä½•<strong>åˆ›å»ºå¹¶å‘é€</strong>æç¤ºç»™ LLM è¿›è¡Œç”Ÿæˆã€‚æ¥ä¸‹æ¥æŠŠæ³¨æ„åŠ›è½¬åˆ°å¯¹è¯çš„å¦ä¸€ç«¯ï¼šå­¦ä¹ <strong>å¦‚ä½•å‘ŠçŸ¥ LLM æˆ‘ä»¬å¸Œæœ›ä»¥ä½•ç§å½¢å¼æ¥æ”¶ç”Ÿæˆçš„å“åº”</strong>ã€‚</p>
<h2 data-id="heading-7">3.4 å½±å“å“åº”ç”Ÿæˆï¼ˆInfluencing response generationï¼‰</h2>
<p>Spring AI æä¾›äº†å‡ é¡¹å¾ˆå®ç”¨çš„åŠŸèƒ½ï¼Œç”¨æ¥å½±å“å“åº”è¿”å›çš„æ–¹å¼ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>è®¾ç½®ç”Ÿæˆé€‰é¡¹</strong>ï¼šåœ¨ç”Ÿæˆå“åº”æ—¶ï¼Œå¯¹â€œä¸‹ä¸€æš token çš„é€‰æ‹©â€æ–½åŠ ä¸€å®šæ§åˆ¶ã€‚</li>
<li><strong>è¾“å‡ºè½¬æ¢ï¼ˆoutput conversionï¼‰</strong> ï¼šåœ¨æç¤ºä¸­åŠ å…¥æ ¼å¼åŒ–æŒ‡ä»¤ï¼Œå‘Šè¯‰ LLM æŒ‰ç‰¹å®šæ ¼å¼è¿”å›ï¼Œä»¥ä¾¿æŠŠæ–‡æœ¬å“åº”è½¬æ¢æˆ Java å¯¹è±¡ã€‚</li>
<li><strong>æµå¼ä¼ è¾“</strong>ï¼šè®©ç»“æœ<strong>ä¸€ç‚¹ç‚¹</strong>è¿”å›ï¼Œè€Œä¸æ˜¯ç­‰å¾…<strong>ä¸€æ¬¡æ€§</strong>è¿”å›å®Œæ•´å“åº”ã€‚</li>
</ul>
<p>ä¸‹é¢ä»æŠŠå“åº”ç»‘å®šä¸º Java å¯¹è±¡å¼€å§‹ï¼Œé€ä¸€ä»‹ç»è¿™äº›åŠŸèƒ½ã€‚</p>
<h3 data-id="heading-8">3.4.1 æŒ‡å®šèŠå¤©é€‰é¡¹ï¼ˆSpecifying chat optionsï¼‰</h3>
<p>åœ¨ä½¿ç”¨ç”Ÿæˆå¼ AI æ—¶ï¼Œä½ å¯èƒ½ä¼šå‘ç° LLM çš„å›ç­”å¹¶ä¸æ€»å¦‚é¢„æœŸã€‚æ¨¡å‹å·¨å¤§çš„è®­ç»ƒè§„æ¨¡ï¼ŒåŠ ä¸Šç”Ÿæˆè¿‡ç¨‹çš„<strong>éç¡®å®šæ€§</strong>ï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿä¸é‚£ä¹ˆç†æƒ³çš„ç»“æœã€‚</p>
<p>Spring AI æä¾›äº†è‹¥å¹²å±æ€§ï¼Œè®©ä½ â€œè°ƒå‚â€ä»¥å½±å“ LLM å¤„ç†æç¤ºçš„æ–¹å¼ã€‚ä½ å·²åœ¨ç¬¬ 1 ç« è§è¿‡ä¸€ä¸ªï¼šåœ¨ <code>application.properties</code> ä¸­è¦†ç›–é»˜è®¤æ¨¡å‹ä¸º <code>gpt-4.1-nano</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.openai.chat.options.model</span>=gpt-<span class="hljs-number">4.1</span>-na<span class="hljs-literal">no</span>
</code></pre>
<p>Spring AI æ”¯æŒçš„å„ç±» API éƒ½æœ‰ç±»ä¼¼å±æ€§æ¥æŒ‡å®šæ¨¡å‹ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ Ollama æ—¶é€‰æ‹© <strong>Llama 3.2</strong>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.ollama.chat.options.model</span>=llama3.<span class="hljs-number">2</span>
</code></pre>
<p>è¿™ä¸¤è¡Œçš„å…³é”®åŒºåˆ«ï¼ˆé™¤æ¨¡å‹åå¤–ï¼‰åœ¨äºï¼šä¸€è¡Œå¯¹åº” <strong>OpenAI</strong> çš„ APIï¼Œå¦ä¸€è¡Œå¯¹åº” <strong>Ollama</strong> çš„ APIã€‚ä»¥è¿™ç§æ–¹å¼è®¾ç½®èŠå¤©é€‰é¡¹æ—¶ï¼Œè¯·ç¡®ä¿ä½¿ç”¨<strong>ä¸ä½ æ‰€ç”¨ API åŒ¹é…</strong>çš„å±æ€§å‰ç¼€ã€‚</p>
<p>å¤šæ•°èŠå¤©é€‰é¡¹éƒ½å¯ä»¥åœ¨ <code>application.properties</code> é‡Œè®¾ç½®ï¼›ä¹Ÿå¯ä»¥åœ¨åˆ›å»º <code>ChatClient</code> æ—¶é€šè¿‡ <code>defaultOptions()</code> è®¾ä¸ºé»˜è®¤å€¼ã€‚ä¾‹å¦‚ï¼Œåˆ›å»º <code>ChatClient</code> æ—¶æŒ‡å®š <code>gpt-4.1-nano</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .model("gpt-4.1-nano")
    .build()<span class="hljs-comment">;</span>

ChatClient <span class="hljs-attr">chatClient</span> = chatClientBuilder
    .defaultOptions(chatOptions)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<p>é€šè¿‡ <code>defaultOptions()</code> è®¾ç½®çš„é€‰é¡¹ä¼š<strong>è¦†ç›–</strong>åœ¨ <code>application.properties</code> é‡ŒåŒåçš„é…ç½®ï¼›è€Œè¿™äº›é»˜è®¤é€‰é¡¹åˆå¯ä»¥åœ¨<strong>åˆ›å»ºæç¤º</strong>æ—¶é€šè¿‡ <code>options()</code> <strong>ç»§ç»­è¦†ç›–</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-scss" lang="scss">String answerText = chatClient<span class="hljs-selector-class">.prompt</span>()
    <span class="hljs-selector-class">.user</span>(question.question())
    <span class="hljs-selector-class">.options</span>(chatOptions)
    <span class="hljs-selector-class">.call</span>()
    <span class="hljs-selector-class">.content</span>();
</code></pre>
<p>é€‰æ‹©æ¨¡å‹åªæ˜¯ä¼—å¤šèŠå¤©é€‰é¡¹ä¹‹ä¸€ã€‚ä¸åŒç”Ÿæˆå¼ API æ”¯æŒçš„é€‰é¡¹å¹¶ä¸å®Œå…¨ç›¸åŒï¼Œä½†æœ‰è‹¥å¹²<strong>æ ¸å¿ƒé€‰é¡¹</strong>æ˜¯æ™®éå­˜åœ¨çš„ã€‚å…ˆçœ‹ä¸€ç»„ä¼šå½±å“â€œå¦‚ä½•é€ token é€‰å–â€çš„é€‰é¡¹ã€‚</p>
<h4 data-id="heading-9">è°ƒæ•´â€œå¤šæ ·æ€§/éšæœºæ€§â€ï¼ˆAdjusting variabilityï¼‰</h4>
<p>å“åº”ç”Ÿæˆæ˜¯<strong>é€ token</strong>è¿›è¡Œçš„ï¼šå…ˆè€ƒè™‘åŸå§‹æç¤ºï¼Œç„¶åç”± API åŸºäºæ¨¡å‹é€‰æ‹©<strong>ä¸‹ä¸€æš token</strong>ï¼›æ¥ç€å†é€‰ä¸‹ä¸€æšï¼Œç›´åˆ°å®Œæ•´å“åº”ç”Ÿæˆå®Œæ¯•ã€‚</p>
<p>é€‰æ‹©â€œä¸‹ä¸€æš tokenâ€çš„æ–¹æ³•å¯ç†è§£ä¸º<strong>ç»Ÿè®¡æ¦‚ç‡ + éšæœºé€‰æ‹©</strong>çš„ç»„åˆã€‚æ¨¡å‹ä¼šç»™å‡ºè‹¥å¹²å€™é€‰ tokenï¼Œæ¯ä¸ªéƒ½æœ‰æˆä¸ºä¸‹ä¸€æš token çš„æ¦‚ç‡ã€‚ä»¥æ¦‚ç‡ä¸ºæƒé‡åšä¸€æ¬¡éšæœºé€‰æ‹©ï¼šæ¦‚ç‡é«˜çš„æ›´å®¹æ˜“è¢«é€‰ä¸­ï¼Œä½†<strong>æ‰€æœ‰å€™é€‰</strong>éƒ½æœ‰è¢«é€‰ä¸­çš„å¯èƒ½ã€‚</p>
<p>ä¾‹å¦‚æç¤ºä¸ºï¼šâ€œFinish this sentence: I have a large collection of.â€ ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å…ˆç”¨<strong>è¯</strong>ä»£æ›¿ <strong>token</strong> æ¥æ€è€ƒã€‚å‡è®¾å€™é€‰è¯åŠå…¶æ¦‚ç‡å¦‚ä¸‹ï¼š</p>
<ul>
<li>â€œbooksâ€ - 0.475</li>
<li>â€œcoinsâ€ - 0.236</li>
<li>â€œrecordsâ€ - 0.129</li>
<li>â€œartsâ€ - 0.096</li>
<li>â€œstampsâ€ - 0.064</li>
</ul>
<p>åŸºäºä»¥ä¸Šæƒé‡ï¼Œ<strong>books</strong> è¢«é€‰ä¸­çš„æ¦‚ç‡çº¦æ˜¯ <strong>coins</strong> çš„ä¸¤å€ã€æ˜¯ <strong>stamps</strong> çš„ä¸ƒå€å¤šã€‚å¤šæ¬¡æäº¤ç›¸åŒæç¤ºï¼Œå¤§å¤šæ•°ç»“æœä¼šä»¥ <strong>books</strong> å®Œæˆå¥å­ï¼Œ<strong>coins/records/arts/stamps</strong> å¶å°”å‡ºç°ï¼Œä¸”é¢‘ç‡é€æ­¥é™ä½ã€‚</p>
<p>é€šè¿‡ <strong>temperatureã€Top-pã€Top-k</strong> ç­‰é€‰é¡¹ï¼Œä½ å¯ä»¥å½±å“é€‰æ‹©çš„éšæœºæ€§ä»¥åŠä¸åŒ token è¢«é€‰ä¸­çš„ç›¸å¯¹å¯èƒ½æ€§ï¼š</p>
<ul>
<li><strong>temperatureï¼ˆæ¸©åº¦ï¼‰</strong> ï¼šèŒƒå›´ <strong>0â€“2</strong>ï¼Œå¯¹æ¦‚ç‡æ–½åŠ ç¼©æ”¾ã€‚ç›´è§‰ä¸Šï¼Œ<strong>æ¸©åº¦è¶Šé«˜</strong>ï¼Œç»“æœè¶Š<strong>éšæœº</strong>ï¼›<strong>æ¸©åº¦è¶Šä½</strong>ï¼Œç»“æœè¶Š<strong>ç¡®å®š</strong>ï¼ˆè§å›¾ 3.4ï¼‰ã€‚å½“æ¸©åº¦è¶‹è¿‘ 2ï¼Œå„ token æ¦‚ç‡è¶‹äºå¹³å‡ï¼›å½“æ¸©åº¦è¶‹è¿‘ 0ï¼Œæœ€é«˜æ¦‚ç‡ token çš„æ¦‚ç‡è¶‹è¿‘ 1ï¼Œå…¶ä»–è¶‹è¿‘ 0ï¼›æ¸©åº¦ä¸º 1 æ—¶æ¦‚ç‡ä¸å˜ã€‚
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e8f90d1d94e44d8b5cc06fb315ebcc9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=NGma5BUEeQGB5ddFaWaOFdGLSm8%3D" alt="image.png" loading="lazy"/></li>
</ul>
<p><strong>å›¾ 3.4</strong> æ¸©åº¦è¶Šé«˜ï¼Œæ¦‚ç‡è¶Šå‡åŒ€ï¼Œç»“æœæ›´éšæœºï¼›æ¸©åº¦è¶Šä½ï¼Œæ¦‚ç‡å·®å¼‚è¢«æ”¾å¤§ï¼Œç»“æœæ›´ç¡®å®šã€‚</p>
<p>åœ¨ <code>application.properties</code> ä¸­å¯æŒ‰æ‰€ç”¨ API è®¾ç½®æ¸©åº¦ã€‚ä¾‹å¦‚ OpenAI è®¾ä¸º 0.7ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.openai.chat.options.temperature</span>=<span class="hljs-number">0.7</span>
</code></pre>
<p>æˆ–åœ¨ä»£ç é‡Œé€šè¿‡ <code>ChatOptions</code> æŒ‡å®šï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .temperature(0.7)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<ul>
<li><strong>Top-Pï¼ˆæ ¸é‡‡æ ·ï¼‰</strong> ï¼šèŒƒå›´ <strong>0â€“1</strong>ï¼Œä¿ç•™<strong>ç´¯è®¡æ¦‚ç‡</strong>è¾¾åˆ°é˜ˆå€¼çš„<strong>æœ€å°å€™é€‰é›†åˆ</strong>ï¼Œå…¶ä½™å…¨éƒ¨å‰”é™¤ã€‚<br/>
ä¾‹å¦‚ Top-P=0.8ï¼Œå¦‚å›¾ 3.5ï¼Œ<code>books+coins+records</code> çš„ç´¯è®¡æ¦‚ç‡ä¸º 0.84ï¼Œè¾¾åˆ°é˜ˆå€¼ï¼Œäºæ˜¯ <strong>arts/stamps</strong> è¢«å‰”é™¤ï¼›éšåå¯¹ä¿ç•™é›†åˆçš„æ¦‚ç‡<strong>å½’ä¸€åŒ–</strong>å†åšåŠ æƒéšæœºé€‰æ‹©ã€‚</li>
</ul>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f3c4e6ef45ee4464ae14ccbe0748fbeb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWw5o2u5pm66IO96ICB5Y-45py6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1763373425&amp;x-signature=wbWngSrSb0rM2AmIlA22YsjCdC4%3D" alt="image.png" loading="lazy"/></p>
<p><strong>å›¾ 3.5</strong> Top-P æ ¹æ®é«˜æ’å token çš„ç´¯è®¡æ¦‚ç‡é˜ˆå€¼ï¼Œå‰”é™¤å…¶ä½™å€™é€‰ã€‚</p>
<p>åœ¨ OpenAI ä¸‹ç”¨å±æ€§è®¾ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.openai.chat.options.top-p</span>=<span class="hljs-number">0.8</span>
</code></pre>
<p>æˆ–ä»£ç è®¾ç½®ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .topP(0.8)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<p>é€šå¸¸å»ºè®®<strong>äºŒé€‰ä¸€</strong>ï¼šä½¿ç”¨ <strong>temperature</strong> æˆ– <strong>Top-P</strong>ã€‚ä¸¤è€…åŒæ—¶ä½¿ç”¨æ˜¯å…è®¸çš„ï¼Œä½†ä¸ä¸€å®šæ›´å¥½ã€‚</p>
<ul>
<li><strong>Top-K</strong>ï¼šä¸ Top-P ç±»ä¼¼ï¼Œä½†ç”¨<strong>è®¡æ•°</strong>è€Œéç´¯è®¡æ¦‚ç‡ï¼Œç›´æ¥ä¿ç•™<strong>å‰ K ä¸ª</strong>å€™é€‰ã€‚<strong>OpenAI ä¸æ”¯æŒ Top-K</strong>ï¼Œå› æ­¤æ— æ³•åœ¨ OpenAI ä¸Šè°ƒæ•´å®ƒï¼›<strong>Ollama æ”¯æŒ</strong>ï¼Œå¯åœ¨é…ç½®ä¸­è®¾ç½®ï¼š</li>
</ul>

<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">spring.ai.ollama.chat.options.top-k</span>=<span class="hljs-number">4</span>
</code></pre>
<p>æˆ–åœ¨ä»£ç ä¸­ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">ChatOptions <span class="hljs-attr">chatOptions</span> = ChatOptions.builder()
    .topK(4)
    .build()<span class="hljs-comment">;</span>
</code></pre>
<p>è‹¥ä½ åœ¨ <code>ChatOptions</code> é‡Œè®¾ç½®äº† Top-K å´æŠŠæç¤ºå‘ç»™ OpenAIï¼Œå°†ä¼šæ”¶åˆ°â€œä¸æ”¯æŒ Top-Kâ€çš„é”™è¯¯ã€‚</p>
<p>åº”ç”¨åˆ°å‰è¿°â€œæ”¶è—â€ç¤ºä¾‹ä¸Šï¼Œè‹¥ <code>top-k=4</code>ï¼Œåˆ™ <strong>books/coins/records/arts</strong> è¢«ä¿ç•™ï¼Œ<strong>stamps</strong> è¢«å‰”é™¤ï¼›éšååŒæ ·è¿›è¡Œæ¦‚ç‡å½’ä¸€åŒ–å¹¶éšæœºé€‰æ‹©ã€‚</p>
<p>åƒ <strong>temperatureã€Top-Pã€Top-K</strong> è¿™æ ·çš„é€‰é¡¹ï¼Œå¯ä»¥åœ¨ LLM ç”Ÿæˆå“åº”æ—¶å¯¹å…¶â€œé€‰æ‹©è¿‡ç¨‹â€æ–½åŠ ä¸€å®šæ§åˆ¶ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹<strong>è¾“å‡ºè½¬æ¢ï¼ˆoutput conversionï¼‰</strong> ï¼Œå¦‚ä½•è®©ç”Ÿæˆç»“æœç›´æ¥è½åœ°ä¸ºä¸€ä¸ª <strong>Java å¯¹è±¡</strong>ã€‚</p>
<h3 data-id="heading-10">3.4.2 æ ¼å¼åŒ–å“åº”è¾“å‡ºï¼ˆFormatting response outputï¼‰</h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„åº”ç”¨ä¼šæ˜¾å¼åœ°ä» LLM è¿”å›çš„å“åº”ä¸­æå–<strong>æ–‡æœ¬å†…å®¹</strong>ï¼Œå¹¶æ®æ­¤åˆ›å»ºä¸€ä¸ª <code>Answer</code> å¯¹è±¡ã€‚å°±ç›®å‰è¿™ä¸ªç®€å•çš„ <code>Answer</code> è®°å½•ç±»å‹è€Œè¨€ï¼Œè¿™å¹¶ä¸éš¾ã€‚ä½†å¯ä»¥æƒ³è§ï¼Œè‹¥å“åº”æ›´å¤æ‚ï¼Œâ€œå…ˆæå–å†å®ä¾‹åŒ–â€çš„ä»£ç ä¼šå˜å¾—è‡ƒè‚¿ã€‚å¹¸è¿çš„æ˜¯ï¼ŒSpring AI æä¾›äº†**è¾“å‡ºè½¬æ¢ï¼ˆoutput conversionï¼‰**è¾…åŠ©ï¼Œç”¨äºæŠŠ LLM çš„å“åº”æ˜ å°„ä¸º Java å¯¹è±¡ã€‚</p>
<p>ä¸ºäº†æ¼”ç¤ºè¾“å‡ºè½¬æ¢å¦‚ä½•å·¥ä½œï¼Œå…ˆçœ‹çœ‹å¦‚ä½•è®© <code>ChatClient</code> <strong>ç›´æ¥è¿”å› <code>Answer</code> å¯¹è±¡</strong>ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚ä¸ºæ­¤ï¼Œéœ€è¦æŠŠ <code>askQuestion()</code> æ–¹æ³•æ”¹ä¸ºè¯·æ±‚å®ä½“å¯¹è±¡ã€‚</p>
<p><strong>æ¸…å• 3.5 å°† LLM ç»“æœç›´æ¥è·å–ä¸º <code>Answer</code> å¯¹è±¡</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.core.io.Resource;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-title">implements</span> <span class="hljs-title">BoardGameService</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GameRulesService gameRulesService;

  <span class="hljs-keyword">public</span> SpringAiBoardGameService(
      ChatClient.Builder chatClientBuilder,
      GameRulesService gameRulesService) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    <span class="hljs-keyword">this</span>.gameRulesService = gameRulesService;
  }

  <span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/systemPromptTemplate.st"</span>)</span>
  Resource promptTemplate;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Answer askQuestion(Question question) {
    <span class="hljs-keyword">var</span> gameRules = gameRulesService.getRulesFor(question.gameTitle());

    <span class="hljs-keyword">return</span> chatClient.prompt()
        .system(systemSpec -&gt; systemSpec
            .text(promptTemplate)
            .param(<span class="hljs-string">"gameTitle"</span>, question.gameTitle())
            .param(<span class="hljs-string">"rules"</span>, gameRules))
        .user(question.question())
        .call()
        .entity(Answer.<span class="hljs-keyword">class</span>);
  }

}
</code></pre>
<p><code>askQuestion()</code> çš„å·¥ä½œæ–¹å¼å‡ ä¹ä¸ä¹‹å‰å®Œå…¨ç›¸åŒï¼Œåªæ˜¯æœ‰ä¸€ä¸ªä¸å¤ªæ˜¾çœ¼çš„å˜åŒ–ï¼šä¸å†è°ƒç”¨ <code>content()</code>ï¼Œè€Œæ˜¯è°ƒç”¨ <code>entity()</code>ï¼Œå¹¶ä¼ å…¥ <code>Answer.class</code> æŒ‡æ˜æœŸæœ›çš„å“åº”ç±»å‹ã€‚</p>
<p>è¿™ä¸ªå°æ”¹åŠ¨å¸¦æ¥ä¸¤ç‚¹å˜åŒ–ï¼š</p>
<ol>
<li><strong>æ ¼å¼åŒ–æŒ‡ä»¤</strong>ä¼šè¢«åŠ å…¥åˆ°æç¤ºä¸­ï¼›</li>
<li>è¿”å›çš„å“åº”ä¼šè¢«<strong>è§£æä¸ºå¯¹è±¡</strong>ã€‚</li>
</ol>
<p>åœ¨æç¤ºå‘é€ç»™ LLM ä¹‹å‰ï¼ŒSpring AI ä¼š<strong>è£…é¥°</strong>æç¤ºï¼ŒåŠ å…¥<strong>æ ¼å¼åŒ–æŒ‡ä»¤</strong>ï¼Œå‘Šè¯‰æ¨¡å‹å“åº”åº”é‡‡ç”¨ä½•ç§æ ¼å¼ã€‚è¯¥æ ¼å¼ç”± <code>Answer</code> è®°å½•åŠå…¶å±æ€§<strong>æ¨å¯¼</strong>è€Œæ¥ã€‚å¦‚æœä½ æ‹¦æˆªè¯·æ±‚å¹¶æŸ¥çœ‹ç»†èŠ‚ï¼Œä¼šçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„æ ¼å¼åŒ–æŒ‡ä»¤ï¼š</p>
<pre><code class="hljs language-vbscript" lang="vbscript">Your <span class="hljs-built_in">response</span> should be <span class="hljs-keyword">in</span> JSON format.
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> include any explanations, only provide a RFC8259 compliant JSON
<span class="hljs-built_in">response</span> following this format without deviation.
<span class="hljs-keyword">Do</span> <span class="hljs-keyword">not</span> include markdown code blocks <span class="hljs-keyword">in</span> your <span class="hljs-built_in">response</span>.
Here <span class="hljs-keyword">is</span> the JSON Schema instance your output must adhere <span class="hljs-keyword">to</span>:
```{
  <span class="hljs-string">"$schema"</span> : <span class="hljs-string">"https://json-schema.org/draft/2020-12/schema"</span>,
  <span class="hljs-string">"type"</span> : <span class="hljs-string">"object"</span>,
  <span class="hljs-string">"properties"</span> : {
    <span class="hljs-string">"answer"</span> : {
      <span class="hljs-string">"type"</span> : <span class="hljs-string">"string"</span>
    },
    <span class="hljs-string">"gameTitle"</span> : {
      <span class="hljs-string">"type"</span> : <span class="hljs-string">"string"</span>
    }
  }
}```
</code></pre>
<p>è¿™é‡Œçš„æ ¼å¼è¯´æ˜<strong>ç²¾ç¡®</strong>å‘ŠçŸ¥ LLMï¼šåº”æŒ‰ JSON å¯¹è±¡è¿”å›ï¼Œå¹¶é™„ä¸Šäº† JSON Schemaã€‚</p>
<p>å½“å“åº”è¿”å›æ—¶ï¼Œè¿™ä¸ª JSON å¯¹è±¡ä¼šè¢«<strong>è½¬æ¢</strong>æˆæ‰€éœ€ç±»å‹â€”â€”æ­¤å¤„ä¸º <code>Answer</code>ã€‚</p>
<blockquote>
<p><strong>NOTE</strong> å³ä½¿ Spring AI çš„è¾“å‡ºè½¬æ¢è´Ÿè´£ç”Ÿæˆäº†æ ¼å¼åŒ–æŒ‡ä»¤ï¼Œä¹Ÿ<strong>ä¸ä¿è¯</strong>ä¸€å®šæœ‰æ•ˆã€‚æœ‰äº› LLM å¹¶ä¸éµå¾ªæ ¼å¼è¦æ±‚ï¼Œä»ä¼šéšæ„è¿”å›ç­”æ¡ˆã€‚OpenAI çš„ GPT æ¨¡å‹é€šå¸¸æ‰§è¡Œå¾—ä¸é”™ï¼Œä½†å…¶ä»–æ¨¡å‹ï¼ˆå¦‚ <strong>Mistral 7B</strong>ï¼‰å¯èƒ½ä¸è¡Œã€‚å¦‚æœæ‰€ç”¨ LLM ä¸éµå®ˆæ ¼å¼ï¼Œç»“æœå°±<strong>æ— æ³•å¯é </strong>åœ°è½¬æ¢å¹¶ç»‘å®šåˆ°å¯¹è±¡ï¼›è¿™ç§æƒ…å†µä¸‹ï¼Œå½“ Spring AI å°è¯•æŠŠâ€œé JSON å“åº”â€ç»‘å®šåˆ°å¯¹è±¡æ—¶ï¼Œä¼šæŠ›å‡º <strong>JsonParseException</strong>ã€‚</p>
</blockquote>
<p>å°±æ˜¯è¿™æ ·ï¼ç°åœ¨ Spring AI çš„è¾“å‡ºè½¬æ¢ä¼šè´Ÿè´£åˆ›å»º <code>Answer</code> å¯¹è±¡â€”â€”å®ƒä¹‹æ‰€ä»¥èƒ½åšåˆ°ï¼Œæ˜¯å› ä¸ºå®ƒé¦–å…ˆç”Ÿæˆäº†<strong>æŒ‡ä»¤</strong>ï¼Œå‘Šè¯‰ LLM æŒ‰ JSON å¯¹è±¡æ ¼å¼è¿”å›ç»“æœã€‚</p>
<h4 data-id="heading-11">å°†è¾“å‡ºè§£æä¸ºåˆ—è¡¨ï¼ˆParsing output to a listï¼‰</h4>
<p>Spring AI ä¹Ÿèƒ½æŠŠå“åº”è§£æä¸º <code>List&lt;String&gt;</code>ã€‚å½“ä½ é¢„æœŸå“åº”æ˜¯ä¸€ä¸ªâ€œæ¡ç›®åˆ—è¡¨â€æ—¶ï¼Œè¿™å¾ˆé€‚åˆï¼Œæ¯”å¦‚æ¸¸ä¹å›­æ™¯ç‚¹æ¸…å•ã€è”èµ›çƒé˜Ÿåå•ã€æˆ– Billboard Hot 100 çš„å¹´åº¦åå¤§é‡‘æ›²ã€‚</p>
<p>ä¸ºæ¼”ç¤ºå¦‚ä½•æ‹¿åˆ°åˆ—è¡¨å“åº”ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨ï¼ˆå¦‚ä¸‹æ¸…å•ï¼‰ï¼ŒæŒ‰ç»™å®šå¹´ä»½è¿”å›å‰ 10 é¦–æ­Œæ›²ï¼š</p>
<p><strong>æ¸…å• 3.6 è¿”å›æŸå¹´ä»½çƒ­é—¨æ­Œæ›² Top 10 çš„æ§åˆ¶å™¨</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.topsongs;

<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.core.ParameterizedTypeReference;
<span class="hljs-keyword">import</span> org.springframework.core.io.Resource;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestParam;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TopSongsController</span> {

  <span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/top-songs-prompt.st"</span>)</span>
  Resource topSongPromptTemplate;  #<span class="hljs-number">1</span>

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;

  <span class="hljs-keyword">public</span> TopSongsController(ChatClient.Builder chatClientBuilder) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
  }

  <span class="hljs-meta">@GetMapping(path = <span class="hljs-string">"/topSongs"</span>, produces = <span class="hljs-string">"application/json"</span>)</span>
  <span class="hljs-keyword">public</span> List&lt;String&gt; topSongs(<span class="hljs-meta">@RequestParam(<span class="hljs-string">"year"</span>)</span> String year) {
    <span class="hljs-keyword">return</span> chatClient.prompt()
        .user(userSpec -&gt; userSpec
            .text(topSongPromptTemplate)
            .param(<span class="hljs-string">"year"</span>, year))
        .call()
        .entity(new ParameterizedTypeReference&lt;List&lt;String&gt;&gt;() {});  #<span class="hljs-number">2</span>
  }

}
</code></pre>
<p>ä¸ºç®€å•èµ·è§ï¼Œè¿™é‡Œç›´æ¥åœ¨æ§åˆ¶å™¨ä¸­ä½¿ç”¨ <code>ChatClient</code>ï¼Œè€Œä¸æ˜¯åƒ <code>SpringAiBoardGameService</code> é‚£æ ·æŠ½åˆ°å•ç‹¬çš„æœåŠ¡ç±»ã€‚</p>
<p>æç¤ºæ¨¡æ¿å®šä¹‰åœ¨ <code>src/main/resources/top-songs-prompt.st</code>ï¼Œå¹¶ä½œä¸º <code>Resource</code> æ³¨å…¥æ§åˆ¶å™¨ã€‚æ¨¡æ¿å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="hljs language-sql" lang="sql">What were the top <span class="hljs-number">10</span> songs <span class="hljs-keyword">on</span> the Billboard Hot <span class="hljs-number">100</span> <span class="hljs-keyword">in</span> {<span class="hljs-keyword">year</span>}?

<span class="hljs-keyword">Each</span> item should <span class="hljs-keyword">only</span> include the song title.
</code></pre>
<p>è¯¥æ§åˆ¶å™¨ä¸ä¹‹å‰åœ¨ <code>SpringAiBoardGameService</code> ä¸­è§åˆ°çš„ä»£ç å¾ˆç›¸ä¼¼ï¼Œä½†æœ‰ä¸€ç‚¹ä¸åŒï¼šè°ƒç”¨ <code>entity()</code> æ—¶ä¼ å…¥äº† <code>new ParameterizedTypeReference&lt;List&lt;String&gt;&gt;() {}</code>ã€‚æˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯ <code>List&lt;String&gt;</code>ï¼Œä½†ä¸èƒ½ç›´æ¥æŠŠ <code>List</code> æˆ– <code>List&lt;String&gt;</code> ä¼ ç»™ <code>entity()</code>ã€‚<code>ParameterizedTypeReference</code> æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»å‹å¼•ç”¨ï¼Œèƒ½åœ¨ Java çš„<strong>ç±»å‹æ“¦é™¤</strong>ä¸‹ï¼Œä»æºå¸¦<strong>æ³›å‹å®å‚</strong>ä¼ ç»™æ–¹æ³•ï¼ˆå¦‚ <code>entity()</code>ï¼‰ã€‚</p>
<p>ç”±äºå‘ <code>entity()</code> ä¼ å…¥äº† <code>new ParameterizedTypeReference&lt;List&lt;String&gt;&gt;() {}</code>ï¼Œæç¤ºä¼šè¢«èµ‹äºˆå¦‚ä¸‹çš„<strong>æ ¼å¼åŒ–æŒ‡ä»¤</strong>ï¼š</p>
<pre><code class="hljs language-makefile" lang="makefile"><span class="hljs-section">FORMAT: Your response should be a list of comma separated values</span>
<span class="hljs-section">eg: `foo, bar, baz`</span>
</code></pre>
<p>è¿è¡Œåº”ç”¨åï¼Œå¯ç”¨ HTTPie è¯•è¯•ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="hljs language-bash" lang="bash">$ http :8080/topSongs?year=1981 -b
[
    <span class="hljs-string">"Bette Davis Eyes"</span>,
    <span class="hljs-string">"Endless Love"</span>,
    <span class="hljs-string">"Lady"</span>,
    <span class="hljs-string">"(Just Like) Starting Over"</span>,
    <span class="hljs-string">"Jessie's Girl"</span>,
    <span class="hljs-string">"Celebration"</span>,
    <span class="hljs-string">"Kiss On My List"</span>,
    <span class="hljs-string">"I Love A Rainy Night"</span>,
    <span class="hljs-string">"9 To 5"</span>,
    <span class="hljs-string">"Keep On Loving You"</span>
]
</code></pre>
<p>å¤ªå¥½äº†ï¼å¿«é€Ÿæœä¸€ä¸‹å¯ç¡®è®¤è¿™äº›ç¡®å®æ˜¯ 1981 å¹´çš„å‰åçƒ­å•ã€‚å½“ç„¶ï¼Œ<strong>å‡†ç¡®æ€§</strong>å–å†³äºä½ æ‰€é€‰ LLM çš„è®­ç»ƒè´¨é‡ï¼ˆä¸Šè¿°åˆ—å•ç”± OpenAI çš„ <code>gpt-4o</code> è¿”å›ï¼‰ã€‚ä½†æ›´é‡è¦çš„æ˜¯ï¼Œå¾—ç›Šäº<strong>åˆ—è¡¨è¾“å‡ºè½¬æ¢</strong>ï¼Œå“åº”è¢«æ ¼å¼åŒ–ä¸ºä¸€ä¸ªå€¼åˆ—è¡¨ã€‚</p>
<p>è™½ç„¶æŠŠå“åº”æ ¼å¼åŒ–ä¸º Java å¯¹è±¡æˆ–åˆ—è¡¨å¾ˆæœ‰ç”¨ï¼Œä½†æœ‰æ—¶å€™<strong>çº¯æ–‡æœ¬</strong>å°±å¤Ÿäº†ï¼Œåªæ˜¯ä½ å¸Œæœ›å®ƒåœ¨ç”Ÿæˆæ—¶<strong>é€æ­¥è¿”å›</strong>ã€‚æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨å¦ä¸€ç§ Spring AI èŠå¤©å®¢æˆ·ç«¯ï¼ŒæŠŠç»“æœ<strong>æµå¼</strong>è¿”å›ç»™è°ƒç”¨æ–¹ã€‚</p>
<h3 data-id="heading-12">3.4.3 æµå¼è¿”å›å“åº”ï¼ˆStreaming the responseï¼‰</h3>
<p>å¦‚æœä½ ç”¨è¿‡ OpenAI çš„ ChatGPTã€å¾®è½¯ Copilot ç­‰èŠå¤©å®¢æˆ·ç«¯ï¼Œä½ å°±ä½“éªŒè¿‡â€œèŠå¤©å¼ç•Œé¢â€çš„ LLM äº¤äº’ã€‚ä½ ä¹Ÿä¼šæ³¨æ„åˆ°ï¼šLLM çš„å›ç­”åƒâ€œåœ¨æ‰“å­—â€ä¸€æ ·ï¼Œ<strong>é€æ­¥æµå…¥</strong>å¯¹è¯çª—å£ã€‚</p>
<p>æµå¼å“åº”çš„å…³é”®å¥½å¤„æ˜¯ï¼š<strong>æå‡èŠå¤©åº”ç”¨çš„ç”¨æˆ·ä½“éªŒ</strong>ã€‚ç®€å•å›ç­”å¯èƒ½å¾ˆå¿«è¿”å›ï¼Œä½†å¤æ‚å›ç­”éœ€è¦æ›´é•¿çš„ç”Ÿæˆæ—¶é—´ã€‚å¦‚æœèƒ½åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­<strong>é€æ­¥æ¸²æŸ“</strong>ï¼Œç”¨æˆ·å°±èƒ½ç¡®ä¿¡åº”ç”¨<strong>åœ¨å·¥ä½œ</strong>è€Œéâ€œå¡ä½â€ã€‚</p>
<p>Spring AI åœ¨ä½¿ç”¨ <code>ChatClient</code> æ—¶æ”¯æŒè¿™ç§<strong>æµå¼é£æ ¼</strong>ã€‚ä¸‹é¢çš„æ¸…å•å±•ç¤ºäº†ï¼šåªéœ€å¯¹ <code>askQuestion()</code> åšå°‘é‡ä¿®æ”¹ï¼Œå°±èƒ½ä»¥<strong>æµ</strong>çš„æ–¹å¼å–å›ç»“æœã€‚</p>
<p><strong>æ¸…å• 3.7 æµå¼è¿”å›çš„æ£‹ç›˜æ¸¸æˆæœåŠ¡</strong></p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Override</span>
public Flux&lt;String&gt; <span class="hljs-built_in">askQuestion</span>(Question question) {    <span class="hljs-selector-id">#1</span>
  <span class="hljs-selector-tag">var</span> <span class="hljs-selector-tag">gameRules</span> = <span class="hljs-selector-tag">gameRulesService</span><span class="hljs-selector-class">.getRulesFor</span>(question.<span class="hljs-built_in">gameTitle</span>());

  <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">chatClient</span><span class="hljs-selector-class">.prompt</span>()
      <span class="hljs-selector-class">.system</span>(systemSpec -&gt; systemSpec
          .<span class="hljs-built_in">text</span>(promptTemplate)
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"gameTitle"</span>, question.<span class="hljs-built_in">gameTitle</span>())
          .<span class="hljs-built_in">param</span>(<span class="hljs-string">"rules"</span>, gameRules))
      <span class="hljs-selector-class">.user</span>(question.<span class="hljs-built_in">question</span>())
      <span class="hljs-selector-class">.stream</span>()         <span class="hljs-selector-id">#2</span>
      <span class="hljs-selector-class">.content</span>();
}
</code></pre>
<p>ä¸å…ˆå‰ç‰ˆæœ¬ç›¸æ¯”ï¼Œå…³é”®å·®å¼‚åœ¨äºï¼šè¯¥æ–¹æ³•çš„è¿”å›ç±»å‹æ˜¯ <code>Flux&lt;String&gt;</code>ï¼Œä¸”ä¸å†è°ƒç”¨ <code>call()</code>ï¼Œè€Œæ˜¯è°ƒç”¨ <code>stream()</code>ã€‚ç­‰ç­‰ï¼Œ<code>Flux</code> æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p><code>Flux</code> æ¥è‡ª <strong>Project Reactor</strong>ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fprojectreactor.io%2F" target="_blank" title="https://projectreactor.io/" ref="nofollow noopener noreferrer">projectreactor.io/</a>ï¼‰ï¼Œæ˜¯ Spring å“åº”å¼æ ˆçš„åŸºç¡€åº“ã€‚æ›´å¤šå†…å®¹å¯å‚è€ƒã€ŠSpring in Actionã€‹ï¼ˆ<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.manning.com%2Fbooks%2Fspring-in-action-sixth-edition" target="_blank" title="https://www.manning.com/books/spring-in-action-sixth-edition" ref="nofollow noopener noreferrer">www.manning.com/books/sprinâ€¦</a>ï¼‰ï¼Œä»ç¬¬ 5 ç‰ˆèµ·å…¶ä¸­å°±æœ‰ä¸“ç« è®²è§£ Reactor ä»¥åŠ <code>Flux</code> / <code>Mono</code>ã€‚</p>
<p>æ­¤å¤„åªéœ€ç†è§£ï¼š<code>Flux</code> æ˜¯ä¸€ç§<strong>å“åº”å¼ç±»å‹</strong>ï¼Œä¼šåœ¨æ•°æ®å¯ç”¨æ—¶<strong>æµå¼</strong>åœ°äº§ç”Ÿ 0 åˆ°å¤šæ¡æ•°æ®ã€‚å¯¹ LLM çš„ç”Ÿæˆå“åº”è€Œè¨€ï¼Œ<code>Flux</code> é€šå¸¸ä¼šæŒ‰<strong>è¯ç²’åº¦</strong>ï¼ˆæˆ–çŸ­ç‰‡æ®µï¼‰ä¸æ–­æ¨é€å†…å®¹ã€‚</p>
<p>ä½ è¿˜éœ€è¦ä¿®æ”¹ <code>AskController</code>ï¼Œè®©å®ƒè¿”å›æœåŠ¡æ–¹æ³•è¿”å›çš„ <code>Flux</code>ã€‚å¦‚ä¸‹ï¼š</p>
<p><strong>æ¸…å• 3.8 æµå¼çš„ <code>AskController</code></strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.PostMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RequestBody;
<span class="hljs-keyword">import</span> org.springframework.web.bind.<span class="hljs-keyword">annotation</span>.RestController;
<span class="hljs-keyword">import</span> reactor.core.publisher.Flux;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AskController</span> {

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> BoardGameService boardGameService;

  <span class="hljs-keyword">public</span> AskController(BoardGameService boardGameService) {
    <span class="hljs-keyword">this</span>.boardGameService = boardGameService;
  }

  <span class="hljs-meta">@PostMapping(path=<span class="hljs-string">"/ask"</span>, produces=<span class="hljs-string">"application/json"</span>)</span>
  <span class="hljs-keyword">public</span> Flux&lt;String&gt; ask(<span class="hljs-meta">@RequestBody</span> Question question) {
    <span class="hljs-keyword">return</span> boardGameService.askQuestion(question);
  }

}
</code></pre>
<p><code>ask()</code> æ–¹æ³•è¿˜æœ‰ä¸€ä¸ªå°æ”¹åŠ¨ï¼š<code>@PostMapping</code> éœ€å£°æ˜è¿”å›<strong>æµå¼å“åº”</strong>ï¼Œå…¶ <strong>MIME</strong> ä¸€èˆ¬è®¾ä¸º <code>text/event-stream</code>ã€‚è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼šå¦‚æœä»æ˜¯ <code>application/json</code>ï¼Œç»“æœä¼š<strong>ä¸€æ¬¡æ€§</strong>è¿”å›ï¼Œè€Œä¸æ˜¯æµå¼è¿”å›ã€‚</p>
<p>ä½ å¯ä»¥åƒä¹‹å‰ä¸€æ ·ç”¨ HTTPie è¯•è¯•ã€‚å› ä¸ºæµå¼å“åº”é€šå¸¸å¾ˆå¿«è¿”å›ï¼Œé™¤éç­”æ¡ˆè¾ƒé•¿ï¼Œå¦åˆ™ä½ å¯èƒ½ä¸æ˜æ˜¾åœ°æ„Ÿå—åˆ°â€œæµåŠ¨â€ã€‚æ¯”å¦‚è¯¢é—® Burger Battle çš„<strong>æˆ˜æ–—å¡</strong>åˆ—è¡¨ï¼š</p>
<pre><code class="hljs language-kotlin" lang="kotlin">$ http :<span class="hljs-number">8080</span>/ask gameTitle=<span class="hljs-string">"Burger Battle"</span> \
       question=<span class="hljs-string">"What battle cards are there?"</span> -b
       <span class="hljs-keyword">data</span>:

       <span class="hljs-keyword">data</span>:Here

       <span class="hljs-keyword">data</span>: <span class="hljs-keyword">is</span>

       <span class="hljs-keyword">data</span>: a

       <span class="hljs-keyword">data</span>: list

       <span class="hljs-keyword">data</span>: of

       <span class="hljs-keyword">data</span>: the

       <span class="hljs-keyword">data</span>: Battle

       <span class="hljs-keyword">data</span>: Cards
...
</code></pre>
<p>ä¸ºé¿å…ç¯‡å¹…è¿‡é•¿ï¼Œè¿™é‡Œåªå±•ç¤ºå‰å‡ é¡¹ã€‚æ˜¾ç„¶ï¼Œå“åº”æ˜¯<strong>é€è¯</strong>æµå›ï¼Œè€Œéä¸€æ¬¡æ€§è¿”å›ã€‚å°½ç®¡è¾“å‡ºä¸å®¹æ˜“çœ‹å‡ºï¼Œä½†æ¯ä¸ªè¯ä¹‹é—´æœ‰<strong>å°å»¶è¿Ÿ</strong>ï¼Œå°±åƒ LLM æ­£åœ¨â€œæ‰“å­—â€ã€‚</p>
<p><code>text/event-stream</code> çš„ä¸€ä¸ªå‰¯ä½œç”¨æ˜¯ï¼šæ¯ä¸ªè¯å‰ä¼šå¸¦ä¸Š <code>data:</code> å‰ç¼€ï¼Œå› æ­¤è°ƒç”¨æ–¹éœ€è¦èƒ½å¤Ÿ<strong>å‰¥ç¦»</strong>è¯¥å‰ç¼€ä»¥å–å‡ºçœŸæ­£çš„è¯ã€‚</p>
<p>ä¸ºäº†é¿å…å¯¹æ¯ä¸ªè¯åšç‰¹æ®Šå¤„ç†ï¼Œå¯ä»¥æŠŠ <code>@PostMapping</code> çš„ <code>produces</code> æ”¹ä¸º <code>application/ndjson</code>ï¼ˆæ¢è¡Œåˆ†éš” JSONï¼‰ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">@PostMapping(<span class="hljs-attr">path</span> = <span class="hljs-string">"/ask"</span>, produces = <span class="hljs-string">"application/ndjson"</span>)
</code></pre>
<p>æ­¤æ—¶ï¼ŒLLM ä»ä¼š<strong>é€è¯</strong>æµå›ï¼Œä½†ä¸å†å¸¦ <code>data:</code> å‰ç¼€ã€‚</p>
<p>å¦‚æœç”¨ HTTPie æµ‹è¯•è¿™ä¸ª MIMEï¼Œæ›´å¯èƒ½ä¼šä»¥ä¸ºâ€œæµå¼åäº†â€ã€‚å› ä¸º HTTPie é‡åˆ° <code>text/event-stream</code> æ—¶ä¼š<strong>é»˜è®¤</strong>æŒ‰æµå¤„ç†ï¼Œä½†å¯¹ <code>application/ndjson</code> å¹¶ä¸ä¼šã€‚è¦å¯ç”¨æµå¼æ˜¾ç¤ºï¼Œéœ€åŠ  <code>--stream</code>ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">$ http :8080/ask <span class="hljs-attr">gameTitle</span>=<span class="hljs-string">"Burger Battle"</span> \
       <span class="hljs-attr">question</span>=<span class="hljs-string">"What battle cards are there?"</span> -b --stream --pretty none <span class="hljs-comment">#1</span>
</code></pre>
<p>è¾“å‡ºï¼ˆæ­¤å¤„ä¸ºèŠ‚é€‰ï¼‰ç±»ä¼¼ï¼š</p>
<pre><code class="hljs language-python" lang="python">In Burger Battle there are several Battle Cards that players can use. Here 
<span class="hljs-keyword">is</span> a <span class="hljs-built_in">list</span> of the standard Battle Cards:

<span class="hljs-number">1.</span> **Burger Bomb**: Blow up another playe<span class="hljs-string">r's Burger by sending their
ingredients to the Graveyard.
2. **Burger Force Field**: Your Burger is now protected from all Battle 
Cards.
3. **Burgerpocalypse**: Obliterate all players'</span> ingredients, including your
own, <span class="hljs-keyword">and</span> toss them <span class="hljs-keyword">in</span> the Graveyard.
<span class="hljs-number">4.</span> **Destroy!**: Destroy <span class="hljs-built_in">any</span> Battle Card of yours <span class="hljs-keyword">or</span> another playe<span class="hljs-string">r's and 
toss it in the Graveyard.
5. **Gonna Eat That?**: Steal another player'</span>s ingredient <span class="hljs-keyword">and</span> add it to your
Burger.
...
</code></pre>
<p>å†æ¬¡å¼ºè°ƒï¼šä¹¦é¡µé™æ€å±•ç¤ºä¸æ˜æ˜¾ï¼Œä½†å®é™…ä½¿ç”¨ HTTPie æ—¶ï¼Œå“åº”æ˜¯<strong>å¸¦å°å»¶è¿Ÿ</strong>åœ°æµå›çš„ã€‚è™½ç„¶åº•å±‚ä»æ˜¯<strong>é€è¯</strong>æµå¼ï¼ŒHTTPie ä¼š<strong>ç¼“å†²</strong>è¿™äº›è¯ï¼Œç›´åˆ°å‡‘æˆä¸€æ•´è¡Œå†æ‰“å°ã€‚</p>
<p>ä½ ä¹Ÿè®¸ä¼šé—®ï¼šèƒ½å¦æŠŠ<strong>æµå¼å“åº”</strong>ä¸å‰é¢ç”¨åˆ°çš„<strong>è¾“å‡ºè½¬æ¢</strong>ç»“åˆèµ·æ¥ï¼Ÿç†è®ºä¸Šï¼Œæµå¼å®¢æˆ·ç«¯å¯ä»¥åƒå¤„ç†çº¯æ–‡æœ¬ä¸€æ ·æµå¼è¿”å›<strong>JSON æ–‡æœ¬</strong>ï¼›ä½†æµå›çš„ JSON ä¼šè¢«<strong>æ‹†æˆè¯æˆ–ç¬¦å·</strong>ï¼Œåœ¨<strong>å®Œæ•´</strong>å“åº”ç»“æŸå‰ï¼Œä½ å¹¶æ²¡æœ‰ä¸€ä¸ª<strong>å®Œå¤‡çš„ JSON æ–‡æ¡£</strong>å¯ä»¥è§£æã€‚</p>
<p>å› æ­¤ï¼Œä½ å¿…é¡»<strong>å…ˆæ”¶é›†</strong>å®Œæ•´çš„æµå¼ JSON å­—ç¬¦ä¸²ï¼Œå†äº¤ç»™è¾“å‡ºè½¬æ¢å»å¤„ç†â€”â€”è¿™ç­‰äº<strong>è¿èƒŒ</strong>äº†ä½¿ç”¨æµå¼çš„åˆè¡·ã€‚ç®€è¨€ä¹‹ï¼Œ<strong>ä¸è¦æ··ç”¨</strong>â€œæµå¼ + è¾“å‡ºè½¬æ¢â€ã€‚</p>
<p>åœ¨æœ¬ç« ä¸­ï¼Œä½ å·²ç»çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ Spring AI å°†æç¤ºæäº¤ç»™ LLM è¿›è¡Œç”Ÿæˆï¼›ä½¿ç”¨<strong>æç¤ºæ¨¡æ¿</strong>å®ç°â€œå¡«ç©ºå¼â€æç¤ºï¼›ç”¨<strong>ä¸Šä¸‹æ–‡å¡«å……</strong>æç¤ºï¼›åˆ©ç”¨<strong>æç¤ºè§’è‰²</strong>ï¼›ä»¥åŠ<strong>å½±å“å“åº”ç”Ÿæˆ</strong>çš„æ–¹å¼ã€‚æ”¶å°¾ä¹‹å‰ï¼Œæˆ‘ä»¬å†çœ‹çœ‹å¦‚ä½•æ£€æŸ¥æ¨¡å‹å¯èƒ½éšå“åº”ä¸€å¹¶è¿”å›çš„<strong>å“åº”å…ƒæ•°æ®</strong>ã€‚</p>
<h2 data-id="heading-13">3.5 ä½¿ç”¨å“åº”å…ƒæ•°æ®ï¼ˆWorking with response metadataï¼‰</h2>
<p>é™¤äº†æ‹¿åˆ°ç”Ÿæˆç»“æœå¤–ï¼Œ<code>ChatClient</code> è¿˜å¯ä»¥æä¾›ä¸ LLM äº¤äº’çš„ä¸€äº›æœ‰ç”¨<strong>å…ƒæ•°æ®</strong>ã€‚å…¶ä¸­æœ€æœ‰ç”¨çš„æ˜¯<strong>ç”¨é‡ï¼ˆusageï¼‰ç»Ÿè®¡</strong>ã€‚æ¯ä¸ªæç¤ºå’Œæ¯æ®µç”Ÿæˆçš„å“åº”æœ€ç»ˆéƒ½ä¼šè¢«æ‹†åˆ†æˆè‹¥å¹² <strong>token</strong>ã€‚è¿™äº› tokenï¼ˆä»¥åŠå…¶ä»–å› ç´ ï¼‰ä¼šç”¨äºè®¡ç®—ä½ å‘ AI æœåŠ¡æ”¯ä»˜çš„è´¹ç”¨ã€‚å› æ­¤ï¼Œäº†è§£æ¯æ¬¡è¯·æ±‚æ¶ˆè€—äº†å¤šå°‘ tokenï¼Œæœ‰åŠ©äºä½ è¯„ä¼°ä¸ LLM çš„äº¤äº’æˆæœ¬ã€‚</p>
<p>å¦‚ä½•ä½¿ç”¨ token ç”¨é‡ä¿¡æ¯å–å†³äºä½ è‡ªå·±ã€‚æœ€åŸºæœ¬çš„åšæ³•æ˜¯æŠŠè¿™äº›ä¿¡æ¯ç®€å•åœ°<strong>å†™å…¥åº”ç”¨æ—¥å¿—</strong>ã€‚åœ¨ç¬¬ 9 ç« ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä½•å€ŸåŠ© Spring AI çš„<strong>å¯è§‚æµ‹æ€§</strong>åŠŸèƒ½ï¼Œå¯¹å¤–æš´éœ² token ç”¨é‡ä¸å…¶ä»–æŒ‡æ ‡ã€‚</p>
<p><strong>æ¸…å• 3.9 è®°å½• token ç”¨é‡åˆ°æ—¥å¿—</strong></p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">package</span> com.example.boardgamebuddy;

<span class="hljs-keyword">import</span> org.slf4j.Logger;
<span class="hljs-keyword">import</span> org.slf4j.LoggerFactory;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ChatClient;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.client.ResponseEntity;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.metadata.ChatResponseMetadata;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.metadata.Usage;
<span class="hljs-keyword">import</span> org.springframework.ai.chat.model.ChatResponse;
<span class="hljs-keyword">import</span> org.springframework.beans.factory.<span class="hljs-keyword">annotation</span>.Value;
<span class="hljs-keyword">import</span> org.springframework.core.io.Resource;
<span class="hljs-keyword">import</span> org.springframework.stereotype.Service;

<span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SpringAiBoardGameService</span> <span class="hljs-title">implements</span> <span class="hljs-title">BoardGameService</span> {

  <span class="hljs-keyword">private</span> static <span class="hljs-keyword">final</span> Logger log =
      LoggerFactory.getLogger(SpringAiBoardGameService.<span class="hljs-keyword">class</span>);

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ChatClient chatClient;
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> GameRulesService gameRulesService;

  <span class="hljs-keyword">public</span> SpringAiBoardGameService(
      ChatClient.Builder chatClientBuilder,
      GameRulesService gameRulesService) {
    <span class="hljs-keyword">this</span>.chatClient = chatClientBuilder.build();
    <span class="hljs-keyword">this</span>.gameRulesService = gameRulesService;
  }

  <span class="hljs-meta">@Value(<span class="hljs-string">"classpath:/promptTemplates/systemPromptTemplate.st"</span>)</span>
  Resource promptTemplate;

  <span class="hljs-meta">@Override</span>
  <span class="hljs-keyword">public</span> Answer askQuestion(Question question) {
    <span class="hljs-keyword">var</span> gameRules = gameRulesService.getRulesFor(question.gameTitle());

    <span class="hljs-keyword">var</span> responseEntity = chatClient.prompt()
        .system(systemSpec -&gt; systemSpec
            .text(promptTemplate)
            .param(<span class="hljs-string">"gameTitle"</span>, question.gameTitle())
            .param(<span class="hljs-string">"rules"</span>, gameRules))
        .user(question.question())
        .call()
        .responseEntity(Answer.<span class="hljs-keyword">class</span>);

    <span class="hljs-keyword">var</span> response = responseEntity.response();

    <span class="hljs-keyword">var</span> metadata = response.getMetadata();
    logUsage(metadata.getUsage());


    <span class="hljs-keyword">return</span> responseEntity.entity();
  }

  <span class="hljs-keyword">private</span> void logUsage(Usage usage) {
    log.info(<span class="hljs-string">"Token usage: prompt={}, generation={}, total={}"</span>,
        usage.getPromptTokens(),
        usage.getCompletionTokens(),
        usage.getTotalTokens());
  }

}
</code></pre>
<p><code>askQuestion()</code> æ–¹æ³•å’Œä¹‹å‰ç›¸æ¯”ç•¥æœ‰ä¸åŒã€‚å…³é”®å·®å¼‚åœ¨äºï¼šå®ƒä¸å†è°ƒç”¨ <code>content()</code> æˆ– <code>entity()</code> è·å–å“åº”ï¼Œè€Œæ˜¯è°ƒç”¨ <code>responseEntity()</code>ã€‚è¯¥æ–¹æ³•ä¸ <code>entity()</code> ç±»ä¼¼ï¼Œä¼šæŠŠå“åº”<strong>ç»‘å®š</strong>ä¸ºæŒ‡å®šç±»å‹çš„å¯¹è±¡ï¼ˆè¿™é‡Œæ˜¯ <code>Answer</code>ï¼‰ï¼›ä½†ä¸åŒçš„æ˜¯ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª <code>ResponseEntity&lt;ChatResponse, Answer&gt;</code>ï¼Œå…¶ä¸­æ—¢åŒ…å« <code>Answer</code>ï¼Œä¹Ÿæºå¸¦ä¸€ä¸ª <code>ChatResponse</code> å¯¹è±¡ã€‚</p>
<p><code>ChatResponse</code> å¯¹è±¡ä¸­å¯ä»¥æ‰¾åˆ°<strong>å…ƒæ•°æ®</strong>ã€‚è°ƒç”¨ <code>getMetadata()</code> å¯è·å–ç”¨é‡ä¿¡æ¯ï¼Œä»è€Œåœ¨ <code>ask()</code> æ–¹æ³•ï¼ˆæ­¤å¤„ä¸º <code>askQuestion()</code>ï¼‰ä¸­æŠŠå®ƒä¼ ç»™ <code>logUsage()</code> è¿›è¡Œæ—¥å¿—è®°å½•ã€‚éšåï¼Œ<code>askQuestion()</code> è¿”å› <code>ResponseEntity</code> ä¸­æ‰¿è½½çš„ <code>Answer</code>ã€‚</p>
<p>å®Œæˆè¿™äº›ä¿®æ”¹åï¼Œåƒä¹‹å‰ä¸€æ ·å¯åŠ¨åº”ç”¨å¹¶å‘ <code>/ask</code> å‘é€è¯·æ±‚ã€‚ä½ åº”è¯¥ä¼šåœ¨æ—¥å¿—é‡Œçœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è®°å½•ï¼š</p>
<pre><code class="hljs language-ini" lang="ini">Token usage: <span class="hljs-attr">prompt</span>=<span class="hljs-number">1618</span>, generation=<span class="hljs-number">35</span>, total=<span class="hljs-number">1653</span>
</code></pre>
<p>ä¸ºçªå‡ºé‡ç‚¹ï¼Œè¿™é‡Œåªå±•ç¤ºäº†æ—¥å¿—æ¶ˆæ¯æœ¬èº«ã€‚å®é™…çš„ token æ•°ä¼šå› æé—®ä¸å›ç­”è€Œå˜åŒ–ã€‚ä½†å¯ä»¥çœ‹åˆ°ï¼Œæ—¥å¿—ä¸ºä½ æä¾›äº†æœ‰ä»·å€¼çš„æ´å¯Ÿï¼šä½¿ç”¨äº†å¤šå°‘ tokenï¼ˆè¿›è€Œå¯ç”¨äº<strong>ä¼°ç®—è´¹ç”¨</strong>ï¼‰ã€‚</p>
<p>éœ€è¦æ³¨æ„ï¼šå¹¶éæ‰€æœ‰ AI æœåŠ¡éƒ½ä¼šè¿”å›ç”¨é‡æŒ‡æ ‡ã€‚ä¾‹å¦‚ï¼Œå‘é€ç»™æœ¬åœ° <strong>Ollama</strong> çš„ LLM æç¤ºä¸ä¼šæä¾›ç”¨é‡æ•°æ®ã€‚<strong>Mistral AI</strong> ä¹Ÿæ˜¯ä¸€ä¸ªä¼¼ä¹ä¸è¿”å›ç”¨é‡æ•°æ®çš„æœåŠ¡ã€‚ä½†ä½ é€šå¸¸å¯ä»¥ä» <strong>OpenAIã€Anthropicã€Google</strong>ï¼ˆä»¥åŠå¯èƒ½çš„å…¶ä»–æœåŠ¡ï¼‰æ‹¿åˆ°ç”¨é‡æ•°æ®ã€‚</p>
<h2 data-id="heading-14"><strong>æ€»ç»“</strong></h2>
<ul>
<li><strong>æç¤ºæ¨¡æ¿</strong>è®©ä½ å¯ä»¥å®šä¹‰å¹¶å¤–éƒ¨åŒ–é€šç”¨æç¤ºï¼Œåœ¨æäº¤ç”Ÿæˆå‰ç”¨å…·ä½“å†…å®¹å¡«å……ã€‚</li>
<li>æ¨¡æ¿ä¹Ÿæ”¯æŒå‘æç¤ºä¸­æä¾›<strong>é¢å¤–ä¸Šä¸‹æ–‡</strong>ï¼Œä»¥ä½¿ç”Ÿæˆæ›´èšç„¦ã€æ›´å‡†ç¡®ã€‚</li>
<li>ä¸Šä¸‹æ–‡å¯åŒ…å«<strong>è¾“å‡ºæ ¼å¼åŒ–æŒ‡ä»¤</strong>ï¼Œä¾‹å¦‚è¦æ±‚ä»¥ JSON è¿”å›ï¼Œä»¥ä¾¿ç»‘å®šåˆ° Java å¯¹è±¡ã€‚</li>
<li><strong>è¾“å‡ºè½¬æ¢</strong>å¯ä»¥æŠŠ LLM çš„ç”Ÿæˆç»“æœè§£æä¸º <strong>Java å¯¹è±¡</strong>æˆ–<strong>åˆ—è¡¨</strong>ã€‚</li>
<li>å“åº”å¯ä»¥<strong>æµå¼</strong>è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ¨¡æ‹Ÿâ€œæ€è€ƒä¸æ‰“å­—â€çš„ä½“éªŒã€‚</li>
<li>ç”Ÿæˆå“åº”ä¸­å¯èƒ½åŒ…å«<strong>æœ‰ç”¨çš„å…ƒæ•°æ®</strong>ï¼Œå¦‚ <strong>token ç”¨é‡</strong> ç­‰æŒ‡æ ‡ã€‚</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>