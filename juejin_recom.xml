<?xml version="1.0" encoding="UTF-8"?><rss version="2.0">  <channel>      <title>掘金文章推荐</title>      <link>https://juejin.cn/recommended?sort=newest</link>      <description>一个帮助开发者成长的社区</description>      <generator>python juejin_recom.py @Pi20</generator>      <item>    <title><![CDATA[别被概念忽悠了：Agent Skills 的本质就是一份“可执行 SOP”]]></title>    <link>https://juejin.cn/post/7598938568430944271</link>    <guid>https://juejin.cn/post/7598938568430944271</guid>    <pubDate>2026-01-26T03:17:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598938568430944271" data-draft-id="7598931684881563700" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="别被概念忽悠了：Agent Skills 的本质就是一份“可执行 SOP”"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-26T03:17:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="shengjk1"/> <meta itemprop="url" content="https://juejin.cn/user/2647279732524957"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            别被概念忽悠了：Agent Skills 的本质就是一份“可执行 SOP”
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2647279732524957/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    shengjk1
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:17:48.000Z" title="Mon Jan 26 2026 03:17:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:14px;overflow-x:hidden;color:var(--cyanosis-base-color);transition:color .35s;--cyanosis-base-color:#353535;--cyanosis-title-color:#005bb7;--cyanosis-strong-color:#2196f3;--cyanosis-em-color:#4fc3f7;--cyanosis-del-color:#ccc;--cyanosis-link-color:#3da8f5;--cyanosis-linkh-color:#007fff;--cyanosis-border-color:#bedcff;--cyanosis-border-color-2:#ececec;--cyanosis-bg-color:#fff;--cyanosis-blockquote-color:#8c8c8c;--cyanosis-blockquote-bg-color:#f0fdff;--cyanosis-code-color:#c2185b;--cyanosis-code-bg-color:#fff4f4;--cyanosis-code-pre-color:#f8f8f8;--cyanosis-table-border-color:#c3e0fd;--cyanosis-table-th-color:#dff0ff;--cyanosis-table-tht-color:#005bb7;--cyanosis-table-tr-nc-color:#f7fbff;--cyanosis-table-trh-color:#e0edf7;--cyanosis-slct-title-color:#005bb7;--cyanosis-slct-titlebg-color:rgba(175,207,247,0.25);--cyanosis-slct-text-color:#c80000;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#e8ebec;--cyanosis-slct-codebg-color:#ffeaeb;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body.__dark{--cyanosis-base-color:#cacaca;--cyanosis-title-color:#ddd;--cyanosis-strong-color:#fe9900;--cyanosis-em-color:#ffd28e;--cyanosis-del-color:#ccc;--cyanosis-link-color:#ffb648;--cyanosis-linkh-color:#fe9900;--cyanosis-border-color:#ffe3ba;--cyanosis-border-color-2:#ffcb7b;--cyanosis-bg-color:#2f2f2f;--cyanosis-blockquote-color:#c7c7c7;--cyanosis-blockquote-bg-color:rgba(255,199,116,0.1);--cyanosis-code-color:#000;--cyanosis-code-bg-color:#ffcb7b;--cyanosis-code-pre-color:rgba(255,227,185,0.5);--cyanosis-table-border-color:#fe9900;--cyanosis-table-th-color:#ffb648;--cyanosis-table-tht-color:#000;--cyanosis-table-tr-nc-color:#6d5736;--cyanosis-table-trh-color:#947443;--cyanosis-slct-title-color:#000;--cyanosis-slct-titlebg-color:#fe9900;--cyanosis-slct-text-color:#00c888;--cyanosis-slct-bg-color:rgba(175,207,247,0.25);--cyanosis-slct-del-color:#999;--cyanosis-slct-elbg-color:#000;--cyanosis-slct-codebg-color:#ffcb7b;--cyanosis-slct-prebg-color:rgba(160,200,255,0.25)}.markdown-body h1{padding-bottom:4px;font-size:30px}.markdown-body h1,.markdown-body h2{margin-top:36px;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);transition:color .35s}.markdown-body h2{position:relative;padding-left:10px;padding-right:10px;padding-bottom:10px;font-size:24px;border-bottom:1px solid var(--cyanosis-border-color-2)}.markdown-body h2:before{content:"「";position:absolute;top:-6px;left:-14px}.markdown-body h2:after{content:"」";position:relative;top:6px;right:auto}.markdown-body h3{position:relative;padding-bottom:0;margin-top:30px;margin-bottom:10px;font-size:20px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h3:before{content:"»";padding-right:6px;color:var(--cyanosis-strong-color)}.markdown-body h4{margin-top:24px;font-size:16px}.markdown-body h4,.markdown-body h5{padding-bottom:0;margin-bottom:10px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body h5{margin-top:18px;font-size:14px}.markdown-body h6{padding-bottom:0;margin-top:12px;margin-bottom:10px;font-size:12px;line-height:1.5;color:var(--cyanosis-title-color);padding-left:6px;transition:color .35s}.markdown-body p{line-height:inherit;margin-top:16px;margin-bottom:16px}.markdown-body img{max-width:100%}.markdown-body hr{position:relative;width:98%;height:1px;margin-top:32px;margin-bottom:32px;background-image:linear-gradient(90deg,var(--cyanosis-link-color),rgba(255,0,0,.3),hsla(0,0%,100%,.1),rgba(255,0,0,.3),var(--cyanosis-link-color));border-width:0;overflow:visible}.markdown-body hr:after{content:"";position:absolute;margin:auto;left:0;right:0;bottom:0;top:0;display:inline-block;width:60px;height:20px;background-color:var(--cyanosis-bg-color);background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAADoklEQVRYR82XTYgcRRTHf2933Q1RjAa9eFO8JHoJ8RQVBQ2iBwXBET0YEUTXNVmNQtTpmeqaWV0XNRq/o4KoECSCEPSg4CF+BYUkIIiCoCJCPIhC/Ihh2Z0nVV27VnZnenumW9i6ddV7//frV69fVQurfMgq56NawFTPAU6QyomqXrw6wIZeyhCPebA5buNR+akKyGoAjd6BshthnYdSjqNcRVuOlIUsD2j0SuA94IwuMHdh5ZUykOUBXfSGbmKI54EtAeYIHSZoy5dl4JxvNYBOKdW1KE8BQ8AkVk6WhasWsAiN0TX9gveXQaPP+Aytpc4u+bMI06JNohsYYYYOR2lJWtS3OKDRfcAtQfgDoI6Vo4UCGb0OmAEuDvZvYmVbEd/igC3dzDz7gQu8sPA9kJDK27mBmjqBeLjTg90PDFOjWawFFQd06kZHEfaj3LAIpTRpSXsZ5E06zEYP9sDimnAApYaV2SLZG/wjMeqAkijwW4xQJ5Gf/ZzRC8OW3hiBTGGlURRswW55Bh/Ssxljrwew8l1PQaM14GngvGDzBUKdDsMeTtgU5o8B92PFlUf3YXUrHa7Fys6lBqcCGnX15YQ2A18FyPd7Crd1A3M8C1wdbH4DD3hWeP6IEXbQkG97ajR1HPFnuPP5jFFq1OWX7hl8WM9l1AO648uNfwLk7tytMeogty+xeQ4rO3r6bdcx1nuwOGsHmaXGtPzae4uzGnLH1kQkvpdZGrHjssBZJrL+pqS05KWc8tgITAPXRzYvYOXe/C2OV43eDcRBDtIhoS2f9wzc0Cv8Wls+zoFzUC5zF0U241h5uZtPfptp6OUM8wbK+cH5GEpCS17P3fJei0Z3+npTxryJ8CPzbKMtn/ZyWbkPGl0PuFPkmkjkcb4h4R2ZLwRq1H0ALmvjkf2HwK1Y+T1PY2XABe/sHJ6MxN5lnoSpnC/UGbsTaI5phK2R7x6s3Ffk5YoDOrWm3onwJHBmEP86bPmBrsGaenNoIdnxCH+gPEhLXi0Cl1VBvyPVLSh7gEuC62yAfOIUqabWEaaiucMIk6RyqJ+Q/QM69V26jjW86Gvov/EaoyT8zRCn+Xq7PVrbx0nuYUaO9wM3WAbjCE1NEUw09Um4UV+2OKfYfu5/S19gsAzGKqm6LE5FrShbdS0ku465DjDwKA/oQht19ejqbaEVuRbiLhuHByYLjtUAZpDutzP7cYdHsPJXWbjyNVgFwQoa1WXwf4Jd9YD/Ap80+yE7+u9aAAAAAElFTkSuQmCC);background-repeat:no-repeat;background-size:auto 100%;background-position-x:center;transition:background-color .5s}.markdown-body code{padding:.065em .4em;font-size:.87em;color:var(--cyanosis-code-color);word-break:break-word;overflow-x:auto;background-color:var(--cyanosis-code-bg-color);border-radius:2px}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{display:block;padding:16px 12px;margin:0;font-size:12px;color:#333;word-break:normal;overflow-x:auto;background:var(--cyanosis-code-pre-color)}.markdown-body pre&gt;code::-webkit-scrollbar{width:4px;height:4px}.markdown-body pre&gt;code::-webkit-scrollbar-track{background-color:var(--cyanosis-border-color)}.markdown-body pre&gt;code::-webkit-scrollbar-thumb{background-color:var(--cyanosis-strong-color);border-radius:10px}.markdown-body a{position:relative;text-decoration:none;color:var(--cyanosis-link-color);border-bottom:1px solid var(--cyanosis-border-color)}.markdown-body a:hover{border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body a:active,.markdown-body a:hover{color:var(--cyanosis-linkh-color)}.markdown-body a:after{position:absolute;content:"";top:100%;left:0;width:100%;opacity:0;border-bottom:1px solid var(--cyanosis-border-color);transition:top .3s,opacity .3s;transform:translateZ(0)}.markdown-body a:hover:after{top:0;opacity:1;border-bottom-color:var(--cyanosis-linkh-color)}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid var(--cyanosis-table-border-color);border-spacing:0;border-collapse:collapse}.markdown-body table thead{color:#000;text-align:left;font-size:14px;background:#f6f6f6}.markdown-body table tr:nth-child(2n){background-color:var(--cyanosis-table-tr-nc-color)}.markdown-body table tr:hover{background-color:var(--cyanosis-table-trh-color)}.markdown-body table td,.markdown-body table th{padding:12px 8px;line-height:24px;border:1px solid var(--cyanosis-table-border-color)}.markdown-body table th{color:var(--cyanosis-table-tht-color);background-color:var(--cyanosis-table-th-color)}.markdown-body table td{min-width:120px}.markdown-body blockquote{color:var(--cyanosis-blockquote-color);border-left:4px solid var(--cyanosis-strong-color);background-color:var(--cyanosis-blockquote-bg-color);padding:1px 20px;margin:22px 0;transition:color .35s}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body b,.markdown-body blockquote&gt;b,.markdown-body blockquote&gt;strong,.markdown-body strong{color:var(--cyanosis-strong-color)}.markdown-body em,.markdown-body i{color:var(--cyanosis-em-color)}.markdown-body del{color:var(--cyanosis-del-color)}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:4px}.markdown-body ol li{padding-left:6px}.markdown-body details&gt;summary{outline:none;color:var(--cyanosis-title-color);font-size:20px;font-weight:bolder;border-bottom:1px solid var(--cyanosis-border-color);cursor:pointer}.markdown-body details&gt;p{padding:10px 20px;margin:10px 0 0;color:#666;background-color:var(--cyanosis-blockquote-bg-color);border:2px dashed var(--cyanosis-strong-color)}.markdown-body h1::selection,.markdown-body h2::selection,.markdown-body h3::selection,.markdown-body h4::selection,.markdown-body h5::selection,.markdown-body h6::selection{color:var(--cyanosis-slct-title-color);background-color:var(--cyanosis-slct-titlebg-color)}.markdown-body ol li::selection,.markdown-body p::selection,.markdown-body ul li::selection{color:var(--cyanosis-slct-text-color);background-color:var(--cyanosis-slct-bg-color)}.markdown-body a::selection,.markdown-body b::selection,.markdown-body em::selection,.markdown-body i::selection,.markdown-body strong::selection{background-color:var(--cyanosis-slct-elbg-color)}.markdown-body del::selection{color:var(--cyanosis-slct-del-color);background-color:var(--cyanosis-slct-elbg-color)}.markdown-body table thead th::selection{background-color:transparent}.markdown-body table tbody td::selection{background-color:var(--cyanosis-slct-bg-color)}.markdown-body code::selection{background-color:var(--cyanosis-slct-codebg-color)}.markdown-body pre&gt;code::selection{background-color:var(--cyanosis-slct-prebg-color)}.markdown-body .contains-task-list{padding-left:14px;list-style:none}.markdown-body .contains-task-list input[type=checkbox]{position:relative}.markdown-body .contains-task-list input[type=checkbox]:before{content:"";position:absolute;top:0;left:0;right:0;bottom:0;width:inherit;height:inherit;background:#f0f8ff;border:1px solid #add6ff;border-radius:2px;box-sizing:border-box;z-index:1}.markdown-body .contains-task-list input[type=checkbox]:checked:after{content:"✓";position:absolute;top:-12px;left:0;right:0;bottom:0;width:0;height:0;color:#f55;font-size:20px;font-weight:700;z-index:2}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="gruvbox-dark">.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#282828}.hljs-subst,.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#ebdbb2}.hljs-deletion,.hljs-formula,.hljs-keyword,.hljs-link,.hljs-selector-tag{color:#fb4934}.hljs-built_in,.hljs-emphasis,.hljs-name,.hljs-quote,.hljs-strong,.hljs-title,.hljs-variable{color:#83a598}.hljs-attr,.hljs-params,.hljs-template-tag,.hljs-type{color:#fabd2f}.hljs-builtin-name,.hljs-doctag,.hljs-literal,.hljs-number{color:#8f3f71}.hljs-code,.hljs-meta,.hljs-regexp,.hljs-selector-id,.hljs-template-variable{color:#fe8019}.hljs-addition,.hljs-meta-string,.hljs-section,.hljs-selector-attr,.hljs-selector-class,.hljs-string,.hljs-symbol{color:#b8bb26}.hljs-attribute,.hljs-bullet,.hljs-class,.hljs-function,.hljs-function .hljs-keyword,.hljs-meta-keyword,.hljs-selector-pseudo,.hljs-tag{color:#8ec07c}.hljs-comment{color:#928374}.hljs-link_label,.hljs-literal,.hljs-number{color:#d3869b}.hljs-comment,.hljs-emphasis{font-style:italic}.hljs-section,.hljs-strong,.hljs-tag{font-weight:700}</style><p>你好，我是 shengjk1，多年大厂经验，努力构建 通俗易懂的、好玩的编程语言教程。 欢迎关注！你会有如下收益：</p>
<ol>
<li>了解大厂经验</li>
<li>拥有和大厂相匹配的技术等</li>
</ol>
<p>希望看什么，评论或者私信告诉我！</p>
<h2 data-id="heading-0">一、背景</h2>
<p>在 AI Agent 领域，新词层出不穷，最近 "Agent Skills" 成了众人追捧的新对象。</p>
<p>很多人把它神圣化，觉得是什么不可思议的黑科技。但如果你撕掉它的神秘外衣，你会发现：Agent Skills 的本质，就是一份针对某一类特定问题的数字化、可执行的 SOP（标准作业程序）。</p>
<p>这是一篇基于我们深度对话整理的技术博客，旨在破除概念迷信，从工程本质出发解析 <strong>Agent Skills</strong>。</p>
<h2 data-id="heading-1">二、 回归本质：SOP 的数字化重生</h2>
<p>传统的 SOP 是一叠厚厚的 PDF，躺在员工的手册里。而 Agent Skills 是把这些“领域专家经验”封装成了“AI 可阅读并执行的指令集”。</p>
<p>一个典型的 Agent Skill 文件夹通常包含：</p>
<ul>
<li><strong>SKILL.md (灵魂)</strong>：定义了 SOP 的控制逻辑。它告诉 AI 什么时候用这个技能、前置条件是什么、具体的 Workflow 步骤以及行为约束。</li>
<li><strong>scripts/ (手脚)</strong>：存放具体的执行工具（如 Python 或 Shell 脚本）。AI 不需要猜测复杂的命令参数，直接调用这些经过验证的脚本。</li>
<li><strong>examples/ (经验)</strong>：通过 Few-shot 示例，告诉 AI 理想的输出标准。</li>
</ul>
<p>SOP 告诉你如何做，Skill 替你做了。SOP 规避人为失误，Skill 规避 AI 幻觉，让AI拥有专业的领域知识，让AI等价于领域专家</p>
<h2 data-id="heading-2">三、 核心亮点：渐进式披露 (Progressive Disclosure)</h2>
<p>为什么我们不直接把所有 Prompt 塞给 AI？因为 AI 的注意力是稀缺资源。Agent Skills 在工程上实现了一个天才的机制——<strong>渐进式披露</strong>。</p>
<ul>
<li><strong>轻量发现</strong>：系统平时只给 AI 喂一个极其简短的“技能索引”。</li>
<li><strong>意图触发</strong>：只有当 AI 意识到任务需要某个特定技能时，工程层面的“书童”（Orchestrator）才会从磁盘读取完整的 <code>SKILL.md</code> 全量注入上下文。</li>
</ul>
<p>这不仅节省了 Token 成本，更解决了“大海捞针”问题。通过这种<strong>指令的“按需加载”</strong>，我们强制 AI 在执行的那一刻，从“胡言乱语的大学生”瞬间坍缩为“专注的领域专家”。</p>
<h2 data-id="heading-3">四、渐进式披露：本质上是工程能力</h2>
<p>AI就想是一个能力强大的超级赛亚人，但它没有思考能力，你给他什么，他就全部接受。为了实现渐进式披露，必然需要在工程上做一些改进。
下面是渐进式披露的例子：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ProgressiveAgent</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):
        self.context = []
        self.loaded_skills = <span class="hljs-built_in">set</span>() <span class="hljs-comment"># 记录已经加载详细指令的技能</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_system_prompt</span>(<span class="hljs-params">self</span>):
        <span class="hljs-comment"># 第一步：只披露“菜单” (Metadata)</span>
        skill_menu = <span class="hljs-string">"\n"</span>.join([<span class="hljs-string">f"- <span class="hljs-subst">{name}</span>: <span class="hljs-subst">{info[<span class="hljs-string">'metadata'</span>]}</span>"</span> 
                               <span class="hljs-keyword">for</span> name, info <span class="hljs-keyword">in</span> SKILLS_LIBRARY.items()])
        
        <span class="hljs-keyword">return</span> <span class="hljs-string">f"""你是一个智能助手。你拥有以下技能目录：
        <span class="hljs-subst">{skill_menu}</span>
        
        如果你发现需要使用某个技能，请输出：[LOAD_SKILL: skill_name]。
        如果你已经准备好执行，请直接输出：[ACTION: tool_name]。
        """</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run_loop</span>(<span class="hljs-params">self, user_query</span>):
        self.context.append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, <span class="hljs-string">"content"</span>: self.get_system_prompt()})
        self.context.append({<span class="hljs-string">"role"</span>: <span class="hljs-string">"user"</span>, <span class="hljs-string">"content"</span>: user_query})

        <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:
            <span class="hljs-comment"># 调用 LLM</span>
            response = call_llm(self.context) 
            <span class="hljs-built_in">print</span>(<span class="hljs-string">f"Agent Thought: <span class="hljs-subst">{response}</span>"</span>)

            <span class="hljs-comment"># 第二步：检测模型是否请求“披露”更多细节</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">"[LOAD_SKILL:"</span> <span class="hljs-keyword">in</span> response:
                skill_name = parse_skill_name(response)
                
                <span class="hljs-keyword">if</span> skill_name <span class="hljs-keyword">in</span> SKILLS_LIBRARY <span class="hljs-keyword">and</span> skill_name <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> self.loaded_skills:
                    <span class="hljs-comment"># 动态注入详细指令</span>
                    detail = SKILLS_LIBRARY[skill_name][<span class="hljs-string">'full_instructions'</span>]
                    self.context.append({
                        <span class="hljs-string">"role"</span>: <span class="hljs-string">"system"</span>, 
                        <span class="hljs-string">"content"</span>: <span class="hljs-string">f"已加载技能 <span class="hljs-subst">{skill_name}</span> 的详细说明：\n<span class="hljs-subst">{detail}</span>"</span>
                    })
                    self.loaded_skills.add(skill_name)
                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"--- 系统：已动态披露 <span class="hljs-subst">{skill_name}</span> 的详细指令 ---"</span>)
                    <span class="hljs-keyword">continue</span> <span class="hljs-comment"># 携带新知识进入下一轮推理</span>

            <span class="hljs-comment"># 第三步：处理最终行动或输出</span>
            <span class="hljs-keyword">if</span> <span class="hljs-string">"[ACTION:"</span> <span class="hljs-keyword">in</span> response:
                <span class="hljs-comment"># 执行具体工具...</span>
                <span class="hljs-keyword">break</span>
</code></pre>
<h2 data-id="heading-4">五、 逻辑路由：为 AI 制造“局部真理”</h2>
<p>不用的 skills，可以看作是不通领域的专家，AI 就是那个路由器，不能的问题会被路由到不通的专家</p>
<p><strong>逻辑路由（Logical Routing）</strong> 的本质是 <strong>“上下文的精准外科手术”</strong>。它根据用户的意图，为模型临时构建一套完全不同的“职业环境”：</p>
<ol>
<li><strong>降噪</strong>：剪掉 90% 无关的信息，让模型在当前任务下拥有最高的“思维专注度”。</li>
<li><strong>授权</strong>：只有路由到该 Skill，AI 才被允许调用对应的外部工具（如 <code>ffmpeg</code>）。</li>
</ol>
<p>这种动态的角色重塑，让 AI 在每一秒钟内只相信一个“局部真理”：<strong>我现在唯一的任务，就是按照这份 SOP 完美地执行。</strong></p>
<h2 data-id="heading-5">六、 行业分水岭：从“调优 Prompt”到“面向 Skill 开发”</h2>
<p>我们正在经历编程史上的又一次高阶抽象跃迁。过去我们面向代码开发，未来我们将<strong>面向 Agent Skills 开发</strong>。</p>
<p>目前，行业已经出现了明显的分水岭：</p>
<ul>
<li><strong>OpenAI 路径</strong>：走“API Store”路线，万物皆云端 API。</li>
<li><strong>Anthropic (Claude) 与 IDE 路径</strong>：走“本地执行者”路线。Claude 官方 API 已原生集成 Skills 架构，强制要求 <code>SKILL.md</code> 结构。</li>
</ul>
<p>这意味着，Agent Skills 正在成为 AI 领域的 <strong>“容器化技术（Docker）”</strong>。它让模型与环境、指令与执行彻底解耦。</p>
<h2 data-id="heading-6">七、未来的开发范式</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6acba45a35e44eac8c9b1b14405eaa01~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hlbmdqazE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770002272&amp;x-signature=7V2mIYc%2Bjx2Wvm3%2BhPqsxtJuGGc%3D" alt="在这里插入图片描述" loading="lazy"/></p>
<ol>
<li>智能体循环：决定下一步行动的核心推理系统</li>
<li>智能体运行时：执行环境（代码、文件系统）</li>
<li>MCP服务器：与外部工具和数据源的连接
4.技能库：领域专业知识和流程知识</li>
</ol>
<p>每层都有明确的用途：循环层负责推理，运行时层负责执行，MCP层负责连接，技能层负责引导。这种分离使系统易于理解，并允许各个部分独立演进。</p>
<h2 data-id="heading-7">八、总结</h2>
<p>我们正处在 AI 应用开发范式转型的十字路口。<strong>Agent Skills 的兴起，标志着编程逻辑从“面向指令”向“面向能力与规范”的高阶跃迁</strong>。</p>
<p><strong>未来，开发者真正的核心资产不再是零散的代码片段，而是那些被精心打磨、可跨平台迁移的数字 SOP（Skills）。</strong></p>
<p>如果说 Claude Code、Codex 等工具可以让未来每一个人都是程序员，程序员全员化，那么 Skills 可以让未来每个人都是专家，专家全员化。</p>
<p>但信息壁垒依然存在，技术壁垒依然存在，并且会越来越去平民化
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/99cf989534d34377b09d02cfecf0acd4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc2hlbmdqazE=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770002272&amp;x-signature=21N5jKJ1pTQrGnwkOv02CtxhlaY%3D" alt="在这里插入图片描述" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[AI浪潮下的职场变革：从技术分工到Agent工程师，前端该如何破局？]]></title>    <link>https://juejin.cn/post/7598918127578333218</link>    <guid>https://juejin.cn/post/7598918127578333218</guid>    <pubDate>2026-01-26T03:33:38.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598918127578333218" data-draft-id="7598938568431009807" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="AI浪潮下的职场变革：从技术分工到Agent工程师，前端该如何破局？"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T03:33:38.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="日月之行_"/> <meta itemprop="url" content="https://juejin.cn/user/4107431171859181"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            AI浪潮下的职场变革：从技术分工到Agent工程师，前端该如何破局？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4107431171859181/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    日月之行_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:33:38.000Z" title="Mon Jan 26 2026 03:33:38 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>近日国内技术圈就被一则重磅消息搅动得波澜壮阔 —— 前阿里 P10 毕玄在其创业公司发布飞书通知，宣布取消前端、后端等按技术栈划分的岗位，所有技术人员统一命名为 “Agent 工程师”，工作分配不再受技术领域限制，完全围绕产品目标和项目结果展开。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/83708bd952d448bf98a7a68e6e9aa0e2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5pyI5LmL6KGMXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770003222&amp;x-signature=Ho5M%2BwTA9TlVwEg0tnZ0cjAPS6Q%3D" alt="" loading="lazy"/></p>
<p>这一举措，不仅是一家创业公司的大胆尝试，更像是 AI 时代技术职场变革的一声号角，引发了无数工程师的思考：我们熟悉的技术分工逻辑，真的要被颠覆了吗？</p>
<h2 data-id="heading-0">传统的技术职责分工，如今却成桎梏</h2>
<p>在<code>AI</code>编码尚未普及时，大部分软件开发企业始终遵循着严格的分工逻辑。技术栈之间壁垒森严，前端工程师专注于页面布局与交互，后端工程师深耕服务器架构与数据处理，测试工程师则紧盯软件质量与 <code>bug</code> 修复。之所以会形成这样的分工模式，核心原因在于 “人的精力有限”—— 想要精通多个技术栈，需要耗费大量时间学习语法、背诵规则、积累经验，而在快速迭代的项目需求下，企业更倾向于让工程师 “深耕单一领域”，通过专业化提升效率，同时降低人才培养成本、明确责任边界。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/32a7b898e89442f9b909737a3b4ef033~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5pyI5LmL6KGMXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770003222&amp;x-signature=YBGj81oQJDIk5qyMkcn4ZGP2l4M%3D" alt="" loading="lazy"/></p>
<p>就像传统工厂的流水线，每个工人只需掌握一道工序，就能快速产出标准化产品。在很长一段时间里，这套技术分工体系运转良好，推动着软件行业不断发展。但随着<code>AI Coding</code> 工具的崛起，这套体系的弊端逐渐凸显：一个简单的需求，可能需要前端、后端、测试多岗协作，需求在传递过程中容易出现信息损耗，岗位间的衔接等待也会浪费大量时间，比如前端工程师完成页面后，需要等待后端工程师提供接口才能继续开发，整个项目进度很容易卡在 “协同环节”。</p>
<h2 data-id="heading-1">AI Coding 打破技术边界，跨栈开发不再是 “天方夜谭”</h2>
<p>改变这一切的，正是<code>Claude Code、Cursor Pro、Trae</code> 等<code>AI Coding</code>工具的出现。它们就像一把 “万能钥匙”，彻底拉低了跨技术栈开发的门槛。以前端工程师为例，若想开发一个简单的后端接口，放在过去，可能需要花三个月时间系统学习后端编程语言、框架原理和数据库操作；但现在，只需明确接口的功能目标，比如 “接收用户提交的表单数据并存储到数据库”，<code>AI</code> 就能快速生成对应的后端代码，工程师只需负责对代码进行 <code>review</code>（审查）和调试，确保代码逻辑正确、符合项目需求即可。</p>
<p>过去，工程师花费大量精力记忆编程语言语法、框架使用规则等机械性知识，这些知识繁琐且易遗忘，却占据了学习成本的很大一部分。而 <code>AI Coding</code> 工具恰好能胜任这类工作，它们可以精准识别代码语法错误、自动补全代码片段、甚至优化代码结构。<strong>这意味着，工程师不再需要 “死记硬背” 技术细节，而是可以将精力聚焦在更核心的能力上 —— 理解业务逻辑、拆解项目目标、把握问题本质。</strong></p>
<h2 data-id="heading-2">从 “全栈工程师” 到 “Agent 工程师”，不止是名字的改变</h2>
<p>毕玄团队将新岗位命名为<code> “Agent 工程师”</code>，而非我们熟悉的 “全栈工程师”，这背后其实是工程师角色的本质转变。很多人认为全栈工程师就是 “什么都会的工程师”，需要精通前端、后端、测试等所有技术栈，既要能写出美观的页面，又要能搭建稳定的服务器，还要能高效排查 bug。但这种 “全能型” 人才培养难度极大，很少有人能真正达到 “精通所有技术栈” 的水平。</p>
<p>而 Agent 工程师的核心能力，并非 “精通所有技术”，而是 “会用 <code>AI </code>完成全链路任务”。<strong>在 <code>AI</code> 时代，工程师的角色从技术 “执行者” 转变为 <code>AI</code> “指挥者”：<code>AI</code> 负责具体的代码编写、语法检查、简单<code> bug</code> 修复等执行性工作；</strong>  工程师则负责更关键的环节 —— 拆解产品目标，将大需求分解为 <code>AI</code> 可理解、可执行的小任务；指挥<code>AI</code>按步骤完成任务，比如告诉<code> AI</code>“先开发用户登录接口，再实现登录状态保存功能”；判断 <code>AI </code>生成结果的合理性，比如审查代码是否符合业务逻辑、是否存在安全隐患；把控项目风险，比如提前预判某个技术方案可能出现的问题，并指导<code>AI</code>调整方案。</p>
<p><strong><code>Anthropic</code> 公司的实践就是最好的证明：其内部 <code>90%</code> 的代码由<code> AI</code> 工具 <code>Claude</code> 自动编写，人类工程师仅需对代码进行编辑和监督。</strong>  曾有一次，<code>Anthropic</code> 的服务器集群出现一个隐藏极深的 <code>bug</code>，工程师连续排查数日都没有找到问题根源，而 <code>Claude</code> 仅用几个小时就定位到 <code>bug</code> 所在，并生成了修复方案，完成了 “判断问题 - 执行排查 - 修复 <code>bug</code>” 的全闭环。这一案例充分说明，在 <code>AI</code> 的辅助下，<code>Agent</code> 工程师能以更高效率完成复杂任务，甚至突破人类自身的技术局限。</p>
<h2 data-id="heading-3">Agent 工程师时代，前端开发工程师该如何 “破局”？</h2>
<p>我认为自身需要主动调整心态和能力结构。过去，很多前端开发习惯 “守着单一技术栈过日子”，认为 “把前端做好就够了” “上线部署不是我负责，没必要学运维”，这种 “画地为牢” 的思维在<code>AI</code>时代已经不合时宜。<strong>未来，工程师的核心竞争力将从 “技术熟练度” 转向 “综合能力”：一是问题抽象能力，能将复杂的业务需求抽象为清晰的技术任务；二是结果判断力，能准确判断<code>AI</code>生成结果的合理性，避免 “<code>AI</code> 出错而自己毫无察觉”；三是 <code>AI</code> 调度能力，能熟练使用不同的<code>AI</code>工具，根据任务需求选择最合适的工具，并指导<code> AI</code> 优化结果。</strong></p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/55f6fe3913284466865afcc5687ffb7b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pel5pyI5LmL6KGMXw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770003222&amp;x-signature=byE1vitp0GWweqsyjYQQ%2FDtzfbg%3D" alt="image.png" loading="lazy"/></p>
<p>此外，行业对人才的需求也在发生变化 —— 从 “单点深耕的专才” 转向 “T 型甚至 π 型人才”。“T 型人才” 指在某一领域有深度（比如前端技术），同时在其他领域有广度（了解后端、测试基础）；“π 型人才” 则是在两个或多个领域有深度，同时具备跨领域整合能力。<code>Agent</code> 工程师正是 “T 型 /π 型人才” 的体现，他们不需要 “样样精通”，但需要 “样样懂一点，且能借助<code>AI</code>做好所有事”。</p>
<p>2026 年才刚刚开始，<strong>马斯克说 “今年或许会成为近几个世纪以来最重要的一年”，</strong>  这句话放在技术行业同样适用。<code>AI </code>正在重构软件开发的底层逻辑，技术工种的边界逐渐消失，传统的技术分工模式正在被打破。对工程师而言，这既是挑战，也是机遇 —— 挑战在于需要跳出舒适区，适应全新的工作模式；机遇在于，<strong>AI 能帮助我们突破技术局限，以更高效率创造价值，实现职业跃迁。唯有打破思维定式、拥抱变化，主动学习 AI 工具、提升综合能力，才能在 Agent 工程师时代站稳脚跟，成为 AI 浪潮中的 “弄潮儿”。</strong></p>
<p><em>已同步在微信公众号《前端日月潭》发布</em></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题]]></title>    <link>https://juejin.cn/post/7598938568431271951</link>    <guid>https://juejin.cn/post/7598938568431271951</guid>    <pubDate>2026-01-26T03:50:56.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598938568431271951" data-draft-id="7598838597559992354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-26T03:50:56.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="狗头大军之江苏分军"/> <meta itemprop="url" content="https://juejin.cn/user/2955079655907879"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我同时维护 Vue3、React、Flutter 项目后，才意识到“状态管理”其实是伪命题
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2955079655907879/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    狗头大军之江苏分军
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:50:56.000Z" title="Mon Jan 26 2026 03:50:56 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>状态本身并不可怕，可控的边界才是关键。无论 Vue/React/Flutter，真正失控的场景总是因为<code>谁该负责这块状态？</code> <code> 状态的生命周期与副作用不一样咋办？</code> <code>状态有多个“真实来源”</code>。比起盲目选用全局状态库，先设计状态边界、所有者与契约，再选工具，这才是我想写这篇文章的核心。</p>
</blockquote>
<h2 data-id="heading-0">目前</h2>
<p>我维护过三套完全不同的代码库：一个用 Vue3 做企业后台，一个用 React 做客户运营后台，还有一个用 Flutter 做用户端 App。开始的时候我和很多人一样，把“状态管理”当成救命稻草，拿着 Pinia、Redux、Provider 当工具箱里的万能胶，遇到问题就往全局塞状态。后来出现的问题不是框架的锅，而是我和团队没有先把状态的边界划清楚。最直观的一次教训是一个批量导入功能：导入进度既存在于页面的临时变量，也存在于全局 cache、后端轮询结果，还有一个后台任务队列的本地副本，结果在某些网络抖动场景下进度条反复闪烁、提交失败、回调覆盖更新，排查下来并不是网络问题，而是同一份“事实”有多个来源、多个所有者、多个副作用在不同地方生效，互相覆盖。修复并不靠换库，而是靠把“导入任务”明确成单一来源、改用只读查询加唯一写入入口，并把所有副作用集中到 service 层，这才把问题彻底堵住。</p>
<h2 data-id="heading-1">示例一：Vue3 中“状态失控”的典型写法 vs 有边界的写法</h2>
<p><strong>失控版本（真实会出事故的那种）</strong></p>
<pre><code class="hljs language-ts" lang="ts"><span class="hljs-comment">// store.ts</span>
<span class="hljs-keyword">import</span> { reactive } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> state = <span class="hljs-title function_">reactive</span>({
  <span class="hljs-attr">importTask</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">progress</span>: <span class="hljs-number">0</span>,
})
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// A.vue</span>
state.<span class="hljs-property">progress</span> = <span class="hljs-number">30</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// B.vue</span>
state.<span class="hljs-property">progress</span> = <span class="hljs-number">80</span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// service.ts</span>
<span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
  state.<span class="hljs-property">progress</span> += <span class="hljs-number">10</span>
}, <span class="hljs-number">1000</span>)
</code></pre>
<p>这种写法的问题不是 Vue，而是<strong>任何地方都能写</strong>，没有人知道谁是妆台管理者。<br/>
只要接口回调、定时轮询、用户操作同时发生一次，UI 就开始抽风。</p>
<h2 data-id="heading-2">但是</h2>
<p>不同框架的问题表现不太一样，但本质相似。Vue3 的常见失控点是把 <code>reactive</code> 的对象随手导出，全项目任意模块直接改动，或者把大量短期 UI 状态塞进 Pinia，结果是到底哪个组件该清理、什么时候取消 watch、谁负责取消请求，没人说得清楚；React 的典型症状是把太多东西放进 Context 或一个大 Redux store，组件随便改对象属性（非不可变更新），导致 memo 无效、重渲染泛滥和难以回溯的副作用；Flutter 则常见在 <code>setState</code> 或全局单例里乱放数据，导致父组件更新引起大量子树不必要重建，或者 Provider/Riverpod 的边界划分混乱，让调试变得痛苦。无论是哪种框架，问题总在这些点交汇：谁该负责这块数据、这块数据的生命周期何时开始与结束、哪些副作用会影响它、它是否有多个事实来源。</p>
<h2 data-id="heading-3">示例二：React 中“useEffect 地狱”是怎么来的</h2>
<p><strong>常见但危险的写法</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportPage</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/task?user=<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-title function_">setProgress</span>(data.<span class="hljs-property">progress</span>))
  }, [userId, progress])
}
</code></pre>
<p>这个代码我敢说你肯定见过。<br/>
问题在于：<code>progress</code> 既是<strong>结果</strong>，又被当成<strong>触发条件</strong>，effect 自己触发自己，网络抖一下就会循环请求。</p>
<p><strong>把副作用和状态边界拆开</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">useImportTask</span>(<span class="hljs-params">userId: string</span>) {
  <span class="hljs-keyword">const</span> [progress, setProgress] = <span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)

  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">let</span> canceled = <span class="hljs-literal">false</span>

    <span class="hljs-title function_">fetch</span>(<span class="hljs-string">`/api/task?user=<span class="hljs-subst">${userId}</span>`</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> res.<span class="hljs-title function_">json</span>())
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
        <span class="hljs-keyword">if</span> (!canceled) <span class="hljs-title function_">setProgress</span>(data.<span class="hljs-property">progress</span>)
      })

    <span class="hljs-keyword">return</span> <span class="hljs-function">() =&gt;</span> {
      canceled = <span class="hljs-literal">true</span>
    }
  }, [userId])

  <span class="hljs-keyword">return</span> progress
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportPage</span>(<span class="hljs-params">{ userId }</span>) {
  <span class="hljs-keyword">const</span> progress = <span class="hljs-title function_">useImportTask</span>(userId)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">Progress</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{progress}</span> /&gt;</span></span>
}
</code></pre>
<p>z仔细看看这段代码你会发现：  <strong>页面不再“拥有”状态，只是消费状态</strong>，失控的入口直接少了一半。</p>
<h2 data-id="heading-4">解决</h2>
<p>既然问题的核心是“边界不清”，我给新项目的建议有几条可能听起来反直觉但非常实用：第一，<code>不要急着建一个全局 store</code>，先把状态放在页面或组件本地，等出现明确的跨页面共享需求并能量化受益时再抽象；
第二，写代码前先画张状态边界图，列出每个状态的 owner、生命周期、是否持久化、是否为衍生值、以及唯一的写入入口；第三，全局或模块化 store 只暴露只读查询和明确的写入 API，禁止项目随意直接修改内部结构；第四，副作用全部集中到 service/side-effect 层（无论是 React 的 hook、Vue 的 composable 还是 Flutter 的 repository），组件只负责展示与触发，副作用层负责取消、去重、重试和错误处理；第五，<code>衍生状态不要持久化</code>，能由原始状态算出来的就用 computed/selector 动态计算；第六，对于复杂的状态流转场景（例如多阶段导入、有超时和回滚逻辑）考虑用状态机来建模，状态可视化之后很多边界问题就能一目了然；第七，启用类型系统和不可变更新约定，这能大幅提升可追溯性和避免微妙的引用错误；第八，把变更审计和日志当成基础设施，<code>为重要的全局状态记录 action 名称、时间戳和 trace id，出问题时能快速回溯。</code></p>
<p>哦对了，忘记距离flutter了，这个技术在掘金里面可能用到的人有点少，没有react vue那么多，但还是说一下吧。</p>
<h2 data-id="heading-5">示例三：Flutter 里最容易被忽略的全局状态</h2>
<p><strong>问题写法</strong></p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">class</span> <span class="hljs-title class_">GlobalTask</span> {
  <span class="hljs-type">static</span> <span class="hljs-type">int</span> progress = <span class="hljs-number">0</span>;
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">setState(() {
  GlobalTask.progress += 10<span class="hljs-comment">;</span>
})<span class="hljs-comment">;</span>
</code></pre>
<p>这个问题非常隐蔽，因为 Flutter 重建 UI 很快，早期根本察觉不到。<br/>
但一旦页面多了、热重载多了、逻辑复杂了，你根本不知道是谁在改。</p>
<p><strong>明确 owner 的写法（Provider / Riverpod 思路）</strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImportTaskState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ChangeNotifier</span> {
  int _progress = <span class="hljs-number">0</span>;

  int get progress =&gt; _progress;

  <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateProgress</span>(<span class="hljs-params">int value</span>) {
    _progress = value;
    <span class="hljs-title function_">notifyListeners</span>();
  }
}
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title class_">Consumer</span>&lt;<span class="hljs-title class_">ImportTaskState</span>&gt;(
  <span class="hljs-attr">builder</span>: (_, state, __) {
    <span class="hljs-keyword">return</span> <span class="hljs-title class_">ProgressBar</span>(<span class="hljs-attr">value</span>: state.<span class="hljs-property">progress</span>);
  },
)
</code></pre>
<p>你不是在用 Provider，而是在<strong>声明：这块状态属于 ImportTaskState</strong>。</p>
<p>还有一些衍生状态千万不要存，如果有复杂流程直接用状态机</p>
<p><strong>错误思路</strong></p>
<pre><code class="hljs language-js" lang="js">state.<span class="hljs-property">list</span> = rawList
state.<span class="hljs-property">filteredList</span> = rawList.<span class="hljs-title function_">filter</span>(...)
</code></pre>
<p><strong>正确思路</strong></p>
<pre><code class="hljs language-hs" lang="hs">const filteredList = computed(() =&gt; {
  return state.list.filter(...)
})
</code></pre>
<p>这不是性能优化，这是<strong>防止状态分叉</strong>。  一旦存了两份，你迟早要花时间修同步问题。</p>
<hr/>
<h2 data-id="heading-6">状态机</h2>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> importMachine = <span class="hljs-title function_">createMachine</span>({
  <span class="hljs-attr">id</span>: <span class="hljs-string">'import'</span>,
  <span class="hljs-attr">initial</span>: <span class="hljs-string">'idle'</span>,
  <span class="hljs-attr">states</span>: {
    <span class="hljs-attr">idle</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">START</span>: <span class="hljs-string">'uploading'</span> } },
    <span class="hljs-attr">uploading</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">SUCCESS</span>: <span class="hljs-string">'processing'</span>, <span class="hljs-attr">FAIL</span>: <span class="hljs-string">'error'</span> } },
    <span class="hljs-attr">processing</span>: { <span class="hljs-attr">on</span>: { <span class="hljs-attr">DONE</span>: <span class="hljs-string">'completed'</span> } },
    <span class="hljs-attr">completed</span>: {},
    <span class="hljs-attr">error</span>: {},
  },
})
</code></pre>
<p>当你把流程画成状态图之后，会非常清楚地看到：<strong>哪些状态允许更新，哪些不允许</strong>，根本不需要猜。</p>
<h2 data-id="heading-7">结尾~~~</h2>
<p>以下是我总结的几点建议~，针对我们当前三个技术栈项目了，按需自取哈~并不通用。</p>
<ul>
<li>一，功能设计阶段画状态边界图并在 PR 中提交；</li>
<li>二，凡是跨页面共享的状态必须指定 owner 与 action；</li>
<li>三，把网络请求、订阅、定时器等副作用统一封装在 service 层并实现取消逻辑；</li>
<li>四，把 UI 临时数据留在本地，衍生数据用 selector；</li>
<li>五，<code>对复杂流程使用状态机并训练团队阅读状态图</code> 没开玩笑， man！！！；</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[JavaScript性能翻倍的5个黑魔法：90%开发者不知道的秘诀]]></title>    <link>https://juejin.cn/post/7598836674630402082</link>    <guid>https://juejin.cn/post/7598836674630402082</guid>    <pubDate>2026-01-26T04:16:37.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598836674630402082" data-draft-id="7598836674630385698" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="JavaScript性能翻倍的5个黑魔法：90%开发者不知道的秘诀"/> <meta itemprop="keywords" content="后端,前端,人工智能"/> <meta itemprop="datePublished" content="2026-01-26T04:16:37.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="阿橙的百宝箱"/> <meta itemprop="url" content="https://juejin.cn/user/1638743356481367"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            JavaScript性能翻倍的5个黑魔法：90%开发者不知道的秘诀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1638743356481367/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    阿橙的百宝箱
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T04:16:37.000Z" title="Mon Jan 26 2026 04:16:37 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0"><strong>JavaScript性能翻倍的5个黑魔法：90%开发者不知道的秘诀</strong></h2>
<h3 data-id="heading-1">引言</h3>
<p>在现代Web开发中，JavaScript的性能优化是一个永恒的话题。尽管V8引擎和其他现代JavaScript引擎已经做了大量优化，但开发者仍然可以通过一些鲜为人知的技巧大幅提升代码执行效率。本文将揭示5个被大多数开发者忽视的“黑魔法”，这些技巧基于JavaScript引擎的工作原理、内存管理机制和语言特性，能够让你的代码性能轻松翻倍。</p>
<h3 data-id="heading-2">1. 利用隐藏类（Hidden Classes）优化对象属性访问</h3>
<h4 data-id="heading-3">背景</h4>
<p>V8引擎使用“隐藏类”来优化对象属性访问。当对象的属性顺序或结构发生变化时，V8会创建新的隐藏类，导致性能下降。</p>
<h4 data-id="heading-4">黑魔法</h4>
<ul>
<li><strong>固定属性顺序</strong>：始终以相同的顺序初始化对象属性。</li>
<li><strong>避免动态添加/删除属性</strong>：如果需要动态属性，使用<code>Map</code>或预先定义所有可能的属性。</li>
<li><strong>使用构造函数或<code>Object.create(null)</code></strong>：避免原型链查找开销。</li>
</ul>
<h4 data-id="heading-5">示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 反例：性能差</span>
<span class="hljs-keyword">const</span> obj = {};
obj.<span class="hljs-property">a</span> = <span class="hljs-number">1</span>;
obj.<span class="hljs-property">b</span> = <span class="hljs-number">2</span>;

<span class="hljs-comment">// 正例：性能优</span>
<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">a</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">b</span>: <span class="hljs-number">2</span> };
</code></pre>
<h4 data-id="heading-6">原理</h4>
<p>V8会为相同结构的对象分配相同的隐藏类，减少属性查找时间。动态修改属性会导致隐藏类切换，增加开销。</p>
<hr/>
<h3 data-id="heading-7">2. TypedArray与位操作：极致的数据处理效率</h3>
<h4 data-id="heading-8">背景</h4>
<p>对于密集计算（如图像处理、游戏逻辑），常规数组的性能往往不够高效。TypedArray和位操作可以显著提升数值计算的性能。</p>
<h4 data-id="heading-9">黑魔法</h4>
<ul>
<li><strong>使用TypedArray替代普通数组</strong>：如<code>Uint8Array</code>、<code>Float64Array</code>等，直接操作二进制数据。</li>
<li><strong>位操作替代数学运算</strong>：例如用<code>x &lt;&lt; 1</code>代替<code>x * 2</code>，用<code>x | 0</code>快速取整。</li>
</ul>
<h4 data-id="heading-10">示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 反例：普通数组</span>
<span class="hljs-keyword">const</span> pixels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-number">1000000</span>).<span class="hljs-title function_">fill</span>(<span class="hljs-number">0</span>);

<span class="hljs-comment">// 正例：TypedArray</span>
<span class="hljs-keyword">const</span> pixels = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8ClampedArray</span>(<span class="hljs-number">1000000</span>);
</code></pre>
<h4 data-id="heading-11">原理</h4>
<p>TypedArray直接分配连续内存，避免了普通数组的装箱拆箱开销；位操作直接在CPU寄存器中完成，速度极快。</p>
<hr/>
<h3 data-id="heading-12">3. Debounce与Throttle的极致优化版本</h3>
<h4 data-id="heading-13">背景</h4>
<p>事件高频触发（如滚动、拖拽）时，传统的debounce/throttle仍可能因闭包和定时器产生额外开销。</p>
<h4 data-id="heading-14">黑魔法</h4>
<ul>
<li><strong>使用RAF（RequestAnimationFrame）替代setTimeout</strong>：更适合动画场景。</li>
<li><strong>纯函数版throttle</strong>：避免闭包，利用时间戳判断间隔。</li>
</ul>
<h4 data-id="heading-15">示例</h4>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// RAF版throttle</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">throttleRAF</span>(<span class="hljs-params">fn</span>) {
    <span class="hljs-keyword">let</span> ticking = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">if</span> (!ticking) {
            <span class="hljs-title function_">requestAnimationFrame</span>(<span class="hljs-function">() =&gt;</span> {
                fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);
                ticking = <span class="hljs-literal">false</span>;
            });
            ticking = <span class="hljs-literal">true</span>;
        }
    };
}
</code></pre>
<h4 data-id="heading-16">原理</h4>
<p>RAF与浏览器渲染周期同步，比setTimeout更高效；纯函数版本减少了作用域链查找。</p>
<hr/>
<h3 data-id="heading-17">4. Worker线程池：真正的多核并行计算</h3>
<h4 data-id="heading-18">背景</h4>
<p>JavaScript是单线程的，但Web Worker可以实现多线程并行化计算。大多数开发者仅用单个Worker，未能充分利用多核CPU。</p>
<h4 data-id="heading-19">黑魔法</h4>
<ul>
<li><strong>动态Worker线程池</strong>：根据任务量动态创建/销毁Worker。</li>
<li><strong>Transferable Objects零拷贝传输</strong>：使用<code>postMessage(data, [transferables])</code>传递大型数据（如ArrayBuffer）。</li>
</ul>
<p>####示例</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Worker池实现核心逻辑</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">WorkerPool</span> {
    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">size</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">size</span> = size;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span> = [];
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">workers</span> = <span class="hljs-title class_">Array</span>(size).<span class="hljs-title function_">fill</span>().<span class="hljs-title function_">map</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Worker</span>(<span class="hljs-string">'task.js'</span>));
    }

    <span class="hljs-title function_">enqueue</span>(<span class="hljs-params">task</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {
            <span class="hljs-keyword">const</span> worker = <span class="hljs-variable language_">this</span>.<span class="hljs-property">workers</span>.<span class="hljs-title function_">pop</span>();
            <span class="hljs-keyword">if</span> (worker) {
                worker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-title function_">resolve</span>(e.<span class="hljs-property">data</span>);
                worker.<span class="hljs-title function_">postMessage</span>(task);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-title function_">push</span>({ task, resolve });
            }
        }).<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {
            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">queue</span>.<span class="hljs-property">length</span> &gt; -------&gt; -------&gt; -------&gt; -------&gt; -------&gt; -------&gt; -------&gt; -------&gt;
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文教你使用免费的GLM4.7，从此告别token焦虑（vscode 、DevEco Studio也能直接使用）]]></title>    <link>https://juejin.cn/post/7599247962821607451</link>    <guid>https://juejin.cn/post/7599247962821607451</guid>    <pubDate>2026-01-26T04:43:11.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599247962821607451" data-draft-id="7599181528304435209" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文教你使用免费的GLM4.7，从此告别token焦虑（vscode 、DevEco Studio也能直接使用）"/> <meta itemprop="keywords" content="前端,后端"/> <meta itemprop="datePublished" content="2026-01-26T04:43:11.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="万少"/> <meta itemprop="url" content="https://juejin.cn/user/4441682708283191"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文教你使用免费的GLM4.7，从此告别token焦虑（vscode 、DevEco Studio也能直接使用）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4441682708283191/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    万少
  </span> <!----> <!----> <div class="vip-level" data-v-cd7d0a50="" data-v-292f6e48=""><span class="tooltip" data-v-cd7d0a50=""><div class="byte-tooltip byte-tooltip--dark" style="display:none;">
        VIP.5 如鱼得水
      </div><span class="byte-tooltip__wrapper"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8AQMAAAAAMksxAAAAA1BMVEUAAACnej3aAAAAAXRSTlMAQObYZgAAAA5JREFUKM9jGAWjAAcAAAIcAAE27nY6AAAAAElFTkSuQmCC" alt="VIP.5 如鱼得水" title="VIP.5 如鱼得水" class="lazy" style="aspect-ratio:NaN;" data-v-5244ef91="" data-v-cd7d0a50=""/></span></span></div> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T04:43:11.000Z" title="Mon Jan 26 2026 04:43:11 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一文教你使用免费的GLM4.7，从此告别token焦虑（vscode 、DevEco Studio也能直接使用）</h2>
<blockquote>
<p>万少：华为HDE、鸿蒙极客</p>
<p>个人主页：<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.zbztb.cn%2F" target="_blank" title="https://blog.zbztb.cn/" ref="nofollow noopener noreferrer">blog.zbztb.cn/</a></p>
<p><strong>2025年参与孵化了20+鸿蒙应用、技术文章300+、鸿蒙知识库用户500+、鸿蒙免费课程2套。</strong></p>
<p>如果你也喜欢交流AI和鸿蒙技术，欢迎扣我。</p>
</blockquote>
<p>最近的<strong>GLM4.7</strong>可谓是刷屏了，不少小伙伴在使用的时候也是直呼真香</p>
<p>GLM4.7使用的方式不少：</p>
<ol>
<li>一些国产的AI编辑器直接内置，例如<strong>Trae</strong>和<strong>CodeBuddy</strong>等</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2ee6b3f1ea0b402891976f98a4f16432~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=3bOH%2FAWYh5Dq8Fn7l6ymkFNZ9Y0%3D" alt="图片" loading="lazy"/></p>
<ol start="2">
<li>也可以付费买<strong>token</strong>，如claude code 可以接入 <strong>GLM4.7</strong>。</li>
</ol>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a67cc922bce14a3480569cb12b90c75c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=JzjFgVKdGyJJ84xicdEEsdPQinc%3D" alt="图片" loading="lazy"/></p>
<ol start="3">
<li>第三种就是推荐的，使用 阿里心流团队推出的<strong>iflow-cli</strong>，它针对个人免费使用，虽然是以终端的方式使用（类似cladue code），但是也可以通过插件的方式接入**vscode、DevEco Studio（Idea）**等主流编辑器，很容易就能上手。</li>
</ol>
<h2 data-id="heading-1">iflow-cli</h2>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.iflow.cn%2Fcli%2Fquickstart" target="_blank" title="https://platform.iflow.cn/cli/quickstart" ref="nofollow noopener noreferrer">platform.iflow.cn/cli/quickst…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1f9393cd03c240e484b76e471b352cce~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=o7ATjjspsDV9zWJfE1SU9bqgF5Y%3D" alt="图片" loading="lazy"/></p>
<p>iFlow CLI 是一款终端AI助手，可以分析代码、执行编程任务、处理文件操作。</p>
<p>内置免费国产优秀大模型，DeepSeek、QWen、GLM(支持GLM4.7)、K2等。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8899d700a19040789c2ba17ea266ff26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=%2BxgK5tYB%2BRTTp9%2FFJRUdY0DN2Ws%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-2">第1步：安装（2分钟）</h2>
<h3 data-id="heading-3">系统要求</h3>
<ul>
<li>Node.js 22+</li>
<li>4GB+ 内存</li>
<li>互联网连接</li>
</ul>
<h3 data-id="heading-4">快速安装</h3>
<p><strong>macOS/Linux</strong></p>
<p>shell</p>
<pre><code class="hljs language-less" lang="less"># 一键安装脚本，会安装全部所需依赖

<span class="hljs-selector-tag">bash</span> <span class="hljs-selector-tag">-c</span> "$(curl -fsSL <span class="hljs-attribute">https</span>:<span class="hljs-comment">//gitee.com/iflow-ai/iflow-cli/raw/main/install.sh)"</span>

# 已有Node.js <span class="hljs-number">22</span>+

npm i -g <span class="hljs-variable">@iflow-ai</span>/iflow-cli<span class="hljs-variable">@latest</span>
</code></pre>
<p><strong>Windows</strong></p>
<p>shell</p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> 访问 https://nodejs.org/zh-cn/download 下载最新的 Node.js 安装程序
<span class="hljs-bullet">2.</span> 运行安装程序来安装 Node.js
<span class="hljs-bullet">3.</span> 重启终端：CMD(Windows + r 输入cmd) 或 PowerShell
<span class="hljs-bullet">4.</span> 运行 <span class="hljs-code">`npm install -g @iflow-ai/iflow-cli@latest`</span> 来安装 iFlow CLI
<span class="hljs-bullet">5.</span> 运行 <span class="hljs-code">`iflow`</span> 来启动 iFlow CLI
</code></pre>
<blockquote>
<p><strong>推荐使用 Windows Terminal</strong>：为了获得更好的兼容性和使用体验，强烈推荐使用 Windows Terminal 运行 iFlow CLI，可以大幅减少环境兼容性问题。</p>
<p><strong>验证安装</strong>：运行 <code>iflow --version</code> 确认安装成功</p>
</blockquote>
<h2 data-id="heading-5">第2步：首次设置（1分钟）</h2>
<h3 data-id="heading-6">启动iFlow</h3>
<p>shell</p>
<pre><code class="hljs">iflow
</code></pre>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5b11f3923389467494f2958d29f69d3d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=foQrx262bZ4WzikLXYL4Ax9uuI0%3D" alt="图片" loading="lazy"/></p>
<p>首次打开，可能需要你跳转到网页进行登录。</p>
<p>登录成功后，会出现以下界面。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/77488e2ce9f14b38bdb0a311a6923b02~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=iZBaaH88kbzLKHyqnBeeFBeTb6U%3D" alt="图片" loading="lazy"/></p>
<p>可以看到是支持GLM4.7模型的，另外可以按tab开启思考模式，让操作更加智能！</p>
<h2 data-id="heading-7">第3步：接入vscode</h2>
<p>vscode中搜索插件 <strong>iflow-cli</strong> ， 然后直接安装即可。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0a3097f35c824f83addb1e5ef670ad9b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=Y%2BLE%2F1f%2FlHawly8Qv5P0XcX7OgE%3D" alt="图片" loading="lazy"/></p>
<p>安装成功后，随便打开一个文件，会在状态栏上看到图标。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/cbab97d3a59b40798c1c2bd4053ca6a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=%2BgfDW9HKZzwhUmVvu6a1FZiYIQU%3D" alt="图片" loading="lazy"/></p>
<p>点击它，会在当前目录打开终端</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/25820445c38f416995acad7da75a7f88~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=7TuylBNHp8JTgOwNsWtMQcsmd9M%3D" alt="图片" loading="lazy"/></p>
<p>接下来你可以在终端中直接对话，也可以鼠标选中代码片段进行沟通。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/28293d1d2986437f95d39a53b5e2056d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=zjkGyVB1P0C17VdugmTQLUNUREM%3D" alt="图片" loading="lazy"/></p>
<p>接下来可以畅享免费的AI编辑了！</p>
<h2 data-id="heading-8">第4步：接入 DevEco Studio</h2>
<p>如果是做鸿蒙应用开发，就需要下载离线插件，下载地址如下：</p>
<blockquote>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.iflow.cn%2Fcli%2Ffeatures%2Fide" target="_blank" title="https://platform.iflow.cn/cli/features/ide" ref="nofollow noopener noreferrer">platform.iflow.cn/cli/feature…</a></p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4bd597526f734ed586571f34108f5ec8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=4iPFeU2pWopE5I2Eprw8JFUF8Qw%3D" alt="图片" loading="lazy"/></p>
<p>下载到本地后，使用DevEco Studio 离线安装即可</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/aedc321b59ad42a3affe35e848330000~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=3gtcMZS1HYRvMZ333XBQmrLraPQ%3D" alt="图片" loading="lazy"/></p>
<p>安装成功后，重启开发工具，最后顶部菜单栏上也有<strong>iflow的图标</strong>展示。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bf7ffd6252ca4df5a2dd5d5c1564abba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiH5bCR:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770007390&amp;x-signature=OZf0PykI4rubkd1IoI8p9gNR%2Fv8%3D" alt="图片" loading="lazy"/></p>
<h2 data-id="heading-9">实用技巧</h2>
<p>命令</p>
<p>功能</p>
<p>说明</p>
<p><code>/about</code></p>
<p>系统信息</p>
<p>显示CLI版本、操作系统、模型版本等综合信息</p>
<p><code>/auth</code></p>
<p>身份验证</p>
<p>配置或更改身份验证提供商</p>
<p><code>/theme</code></p>
<p>主题设置</p>
<p>自定义CLI外观主题</p>
<p><code>/model</code></p>
<p>模型切换</p>
<p>更改正在使用的AI模型</p>
<p><code>/editor</code></p>
<p>编辑器配置</p>
<p>配置首选的外部编辑器</p>
<p><code>/privacy</code></p>
<p>隐私信息</p>
<p>显示隐私通知和数据处理信息</p>
<p><code>/language</code></p>
<p>语言设置</p>
<p>切换CLI界面语言 (zh-CN/en-US)</p>
<p><code>/output-style</code></p>
<p>输出样式</p>
<p>设置AI输出样式和格式</p>
<p><code>/output-style:new</code></p>
<p>创建输出样式</p>
<p>基于描述创建新的AI输出样式</p>
<p><code>/update</code></p>
<p>软件更新</p>
<p>检查并更新CLI到最新版本</p>
<h3 data-id="heading-10">会话控制命令</h3>
<p>命令</p>
<p>功能</p>
<p>说明</p>
<p><code>/chat</code></p>
<p>对话管理</p>
<p>保存、恢复、删除对话检查点</p>
<p><code>/clear</code></p>
<p>清屏重置</p>
<p>清除屏幕并重置对话历史</p>
<p><code>/compress</code></p>
<p>内容压缩</p>
<p>使用AI将对话历史压缩为摘要</p>
<p><code>/memory</code></p>
<p>内容管理</p>
<p>与CLI的内容系统交互</p>
<p><code>/restore</code></p>
<p>状态恢复</p>
<p>恢复到之前的检查点状态</p>
<p><code>/resume</code></p>
<p>会话恢复</p>
<p>恢复之前的对话会话</p>
<p><code>/quit</code></p>
<p>退出程序</p>
<p>退出CLI会话并显示统计信息</p>
<p><code>/cleanup-history</code></p>
<p>清理历史</p>
<p>打开清理对话历史记录的对话框</p>
<p><code>/cleanup-checkpoint</code></p>
<p>清理检查点</p>
<p>打开清理对话检查点的对话框</p>
<h3 data-id="heading-11">工具集成命令</h3>
<p>命令</p>
<p>功能</p>
<p>说明</p>
<p><code>/ide</code></p>
<p>IDE集成</p>
<p>发现和连接到可用的IDE服务器</p>
<p><code>/mcp</code></p>
<p>MCP管理</p>
<p>管理MCP服务器、工具和身份验证</p>
<p><code>/tools</code></p>
<p>工具列表</p>
<p>列出所有可用的内置CLI工具</p>
<p><code>/extensions</code></p>
<p>扩展管理</p>
<p>显示当前活动的扩展及版本</p>
<h3 data-id="heading-12">开发辅助命令</h3>
<p>命令</p>
<p>功能</p>
<p>说明</p>
<p><code>/init</code></p>
<p>项目初始化</p>
<p>分析项目并创建定制的配置文件</p>
<p><code>/setup-github</code></p>
<p>GitHub配置</p>
<p>配置GitHub Actions工作流</p>
<p><code>/directory</code></p>
<p>目录管理</p>
<p>管理工作空间目录以获得项目上下文</p>
<p><code>/export</code></p>
<p>导出功能</p>
<p>以各种格式导出对话历史</p>
<p><code>/copy</code></p>
<p>复制功能</p>
<p>将最后的AI响应复制到剪贴板</p>
<p><code>/demo</code></p>
<p>演示模式</p>
<p>启动交互式演示和教程模式</p>
<p><code>/qa</code></p>
<p>问答助手</p>
<p>基于知识库的智能问答助手 (别名: /wenwen, /question, /guide)</p>
<h3 data-id="heading-13">监控调试命令</h3>
<p>命令</p>
<p>功能</p>
<p>说明</p>
<p><code>/stats</code></p>
<p>统计信息</p>
<p>监控会话使用情况和性能统计</p>
<p><code>/log</code></p>
<p>日志位置</p>
<p>显示当前会话日志存储位置</p>
<p><code>/bug</code></p>
<p>错误报告</p>
<p>提交带有系统信息的错误报告</p>
<p><code>/help</code></p>
<p>帮助信息</p>
<p>打开综合帮助对话框</p>
<p><code>/docs</code></p>
<p>文档访问</p>
<p>在浏览器中打开完整文档</p>
<h3 data-id="heading-14">特殊功能命令</h3>
<p>命令</p>
<p>功能</p>
<p>说明</p>
<p><code>/vim</code></p>
<p>Vim模式</p>
<p>切换vim风格按键绑定</p>
<p><code>/corgi</code></p>
<p>特殊主题</p>
<p>切换柯基主题UI模式（彩蛋）</p>
<p><code>/commands</code></p>
<p>命令市场</p>
<p>管理和安装自定义命令</p>
<p><code>/agents</code></p>
<p>代理管理</p>
<p>管理个人、项目和内置代理</p>
<p><code>/terminal-setup</code></p>
<p>终端设置</p>
<p>配置终端键绑定以支持多行输入</p>
<h3 data-id="heading-15">常见使用场景</h3>
<h4 data-id="heading-16">系统配置</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">/about                      <span class="hljs-comment"># 查看系统信息</span>
/auth                       <span class="hljs-comment"># 配置身份验证</span>
/model                      <span class="hljs-comment"># 切换AI模型</span>
/theme                      <span class="hljs-comment"># 更改主题</span>
</code></pre>
<h4 data-id="heading-17">会话管理</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">/chat list                  <span class="hljs-comment"># 列出所有保存的对话</span>
/chat save project-review   <span class="hljs-comment"># 保存对话检查点</span>
/chat resume project-review <span class="hljs-comment"># 恢复指定的对话</span>
/chat delete project-review <span class="hljs-comment"># 删除指定的对话</span>
/memory show                <span class="hljs-comment"># 显示当前记忆内容</span>
/memory add <span class="hljs-string">"项目使用React"</span> <span class="hljs-comment"># 添加记忆信息</span>
/memory refresh             <span class="hljs-comment"># 刷新记忆内容</span>
/memory list                <span class="hljs-comment"># 列出记忆文件列表</span>
/compress                   <span class="hljs-comment"># 压缩对话历史</span>
/clear                      <span class="hljs-comment"># 清空会话</span>
/resume                     <span class="hljs-comment"># 恢复之前的会话</span>
</code></pre>
<h4 data-id="heading-18">开发辅助</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">/init                       <span class="hljs-comment"># 初始化项目配置</span>
/ide                        <span class="hljs-comment"># 连接IDE</span>
/mcp list                   <span class="hljs-comment"># 列出所有MCP服务器</span>
/mcp auth &lt;server&gt;          <span class="hljs-comment"># 配置MCP服务器身份验证</span>
/mcp online                 <span class="hljs-comment"># 浏览在线MCP服务器</span>
/mcp refresh                <span class="hljs-comment"># 刷新MCP服务器连接</span>
/directory add &lt;path&gt;       <span class="hljs-comment"># 添加工作空间目录</span>
/directory show             <span class="hljs-comment"># 显示当前工作空间目录</span>
/export clipboard           <span class="hljs-comment"># 导出对话到剪贴板</span>
/export file                <span class="hljs-comment"># 导出对话到文件</span>
</code></pre>
<h4 data-id="heading-19">调试支持</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">/stats                      <span class="hljs-comment"># 查看会话统计</span>
/stats model                <span class="hljs-comment"># 查看模型使用统计</span>
/stats tools                <span class="hljs-comment"># 查看工具使用统计</span>
/log                        <span class="hljs-comment"># 查看日志位置</span>
/bug <span class="hljs-string">"描述问题"</span>             <span class="hljs-comment"># 提交错误报告</span>
/help                       <span class="hljs-comment"># 获取帮助</span>
</code></pre>
<h4 data-id="heading-20">系统和界面配置</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">/language zh-CN            <span class="hljs-comment"># 切换到中文界面</span>
/language en-US            <span class="hljs-comment"># 切换到英文界面</span>
/output-style professional <span class="hljs-comment"># 使用专业输出样式</span>
/output-style:new <span class="hljs-string">"简洁风格"</span> <span class="hljs-comment"># 创建新的输出样式</span>
/update                    <span class="hljs-comment"># 检查并更新CLI版本</span>
</code></pre>
<h4 data-id="heading-21">对话和历史管理</h4>
<p>bash</p>
<pre><code class="hljs language-bash" lang="bash">/cleanup-history            <span class="hljs-comment"># 清理对话历史记录</span>
/cleanup-checkpoint         <span class="hljs-comment"># 清理对话检查点</span>
/demo                       <span class="hljs-comment"># 启动演示模式</span>
/qa <span class="hljs-string">"如何使用MCP?"</span>          <span class="hljs-comment"># 基于知识库的问答</span>
/agents list                <span class="hljs-comment"># 列出所有可用的代理</span>
/agents refresh             <span class="hljs-comment"># 刷新代理列表</span>
/agents online              <span class="hljs-comment"># 浏览在线代理市场</span>
/agents install             <span class="hljs-comment"># 安装代理</span>
/commands list              <span class="hljs-comment"># 列出本地自定义命令</span>
/commands online            <span class="hljs-comment"># 浏览在线命令市场</span>
/commands get &lt;<span class="hljs-built_in">id</span>&gt;          <span class="hljs-comment"># 获取指定ID的命令</span>
/terminal-setup             <span class="hljs-comment"># 配置终端以支持多行输入</span>
</code></pre>
<p><strong>关注我</strong>，持续分享鸿蒙开发 + AI 提效的实战技巧。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[TN3187：迁移至基于 UIKit 场景的生命周期]]></title>    <link>https://juejin.cn/post/7598710324168605711</link>    <guid>https://juejin.cn/post/7598710324168605711</guid>    <pubDate>2026-01-26T02:48:31.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324168605711" data-draft-id="7598734303175262260" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="TN3187：迁移至基于 UIKit 场景的生命周期"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-01-26T02:48:31.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Meicy"/> <meta itemprop="url" content="https://juejin.cn/user/3562073407095597"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            TN3187：迁移至基于 UIKit 场景的生命周期
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3562073407095597/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Meicy
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:48:31.000Z" title="Mon Jan 26 2026 02:48:31 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    9
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h3 data-id="heading-0">概述</h3>
<p>许多较旧的 iOS 应用使用一个 UIApplicationDelegate 对象作为其应用的主要入口点，并管理应用的生命周期。使用场景的应用则不同，它们使用一个 UISceneDelegate 对象来分别管理每个场景窗口。从基于 UIApplicationDelegate 的应用生命周期迁移到基于场景的生命周期，可以让你的应用支持多窗口等现代功能。本文档阐述了如何将应用迁移到基于场景的生命周期。</p>
<h3 data-id="heading-1">迁移路径</h3>
<p>将应用迁移到基于场景的生命周期有两种路径：</p>
<ul>
<li>分阶段迁移：应用在继续使用 UIApplicationDelegate 的同时，逐步采用 UISceneDelegate。</li>
<li>直接迁移：应用一次性直接迁移到 UISceneDelegate。</li>
</ul>
<p>在分阶段迁移中，你可以在应用的不同部分逐步实现场景支持，而应用的其余部分继续通过现有的 UIApplicationDelegate 进行管理。这种方式对于大型应用或者需要逐步验证场景兼容性的团队很有用。然而，分阶段迁移会增加临时复杂性，并且应用在完全迁移之前无法使用多窗口等需要完全基于场景生命周期的功能。</p>
<p>直接迁移意味着一次性将整个应用切换到 UISceneDelegate。对于尚未使用 UIApplicationDelegate 管理界面的新应用，或者那些规模较小、易于整体更新的现有应用，推荐采用这种方式。直接迁移可以更快地启用多窗口等现代功能，并简化代码库。</p>
<h3 data-id="heading-2">如何判断应用是否使用了场景？</h3>
<p>如果你的应用使用了场景，其 Info.plist 文件中会包含一个 UIApplicationSceneManifest 字典。当系统在 Info.plist 中检测到此字典时，它会使用基于场景的生命周期来启动你的应用。对于直接迁移，你需要添加此清单。对于分阶段迁移，你将在准备好启用场景时添加它。</p>
<hr/>
<h3 data-id="heading-3">分阶段迁移</h3>
<p>分阶段迁移允许你逐步采用 UISceneDelegate。在这种方法下，应用将继续使用 UIApplicationDelegate 作为主要入口点，但你可以为某些界面逐步引入场景支持。当你想为应用的特定部分启用多窗口等功能，同时保持其他部分的原有行为时，这种方式很有用。</p>
<p>要进行分阶段迁移，你需要：</p>
<ol>
<li>创建一个实现 UIWindowSceneDelegate 协议的新类。</li>
<li>在 UIApplicationDelegate 中实现 application(_:configurationForConnecting:options:) 方法，为特定会话返回一个 UISceneConfiguration 实例。此配置告诉系统为连接的场景会话使用哪个场景代理类。</li>
<li>在应用的 Info.plist 中配置 UIApplicationSceneManifest 字典，并为场景配置指定你的场景代理类名。</li>
</ol>
<p>当系统请求新场景时，它会调用 UIApplicationDelegate 的 application(_:configurationForConnecting:options:) 方法。你可以检查连接选项（例如 UIApplication.OpenURLOptions 或 UIApplication.ActivityOptions）来决定返回哪种场景配置。这允许你根据用户的操作（例如点击 URL 或进行拖放操作）来创建不同类型的场景。</p>
<p>分阶段迁移期间，UIApplicationDelegate 仍然负责管理应用级事件（例如应用启动和进入后台），而 UISceneDelegate 则管理特定场景的生命周期事件（例如场景激活或失活）。这种分离使得你可以逐步将界面管理从 UIApplicationDelegate 转移到 UISceneDelegate。</p>
<h3 data-id="heading-4">直接迁移</h3>
<p>直接迁移涉及一次性将整个应用从 UIApplicationDelegate 迁移到 UISceneDelegate。这种方式适用于新应用，或者那些愿意为启用多窗口等现代功能而进行全面更新的现有应用。</p>
<p>要直接迁移，你需要：</p>
<ol>
<li>将应用生命周期管理从 UIApplicationDelegate 移动到 UISceneDelegate。这包括将代码从 application(<em>:didFinishLaunchingWithOptions:) 移动到 scene(</em>:willConnectTo:options:)，以及将其他生命周期方法（例如 applicationWillResignActive 和 applicationDidBecomeActive）迁移到对应的场景代理方法（例如 sceneWillResignActive 和 sceneDidBecomeActive）。</li>
<li>移除 UIApplicationDelegate 中与窗口管理相关的代码，因为每个场景现在都会管理自己的 UIWindow。</li>
<li>在 Info.plist 中添加 UIApplicationSceneManifest 字典，并配置默认的场景配置，指定你的 UISceneDelegate 类。</li>
</ol>
<p>直接迁移后，应用的每个窗口都由一个独立的 UIScene 实例管理，UISceneDelegate 负责该场景的生命周期。这为每个窗口提供了更好的隔离，并启用了多窗口支持。</p>
<hr/>
<h3 data-id="heading-5">通用迁移步骤</h3>
<p>无论选择分阶段迁移还是直接迁移，都需要遵循一些通用步骤：</p>
<h4 data-id="heading-6">1. 创建场景代理类</h4>
<p>创建一个实现 UIWindowSceneDelegate 协议的新类。这个类将管理特定场景的生命周期。你可以在其中创建窗口、设置根视图控制器，并响应场景生命周期事件。</p>
<h4 data-id="heading-7">2. 配置 Info.plist</h4>
<p>在 Info.plist 中添加一个 UIApplicationSceneManifest 字典。此字典告诉系统你的应用支持场景。它包含一个 UISceneConfigurations 字典，你可以在其中定义应用支持的不同场景配置。每个配置指定了场景代理类名和故事板名称（如果使用的话）。</p>
<p><code>&lt;key&gt;UIApplicationSceneManifest&lt;/key&gt;  &lt;dict&gt;  &lt;key&gt;UIApplicationSupportsMultipleScenes&lt;/key&gt;  &lt;true/&gt; &lt;key&gt;UISceneConfigurations&lt;/key&gt;  &lt;dict&gt;  &lt;key&gt;UIWindowSceneSessionRoleApplication&lt;/key&gt; &lt;array&gt;  &lt;dict&gt;  &lt;key&gt;UISceneConfigurationName&lt;/key&gt;  &lt;string&gt;Default Configuration&lt;/string&gt;  &lt;key&gt;UISceneDelegateClassName&lt;/key&gt;  &lt;string&gt;$(PRODUCT_MODULE_NAME).SceneDelegate&lt;/string&gt;  &lt;key&gt;UISceneStoryboardFile&lt;/key&gt;  &lt;string&gt;Main&lt;/string&gt;  &lt;/dict&gt;  &lt;/array&gt;  &lt;/dict&gt;  &lt;/dict&gt;</code></p>
<h4 data-id="heading-8">3. 更新应用代理</h4>
<p>对于直接迁移，移除 UIApplicationDelegate 中与窗口管理相关的代码，并将应用生命周期事件的处理移动到场景代理中。对于分阶段迁移，在 UIApplicationDelegate 中实现 application(_:configurationForConnecting:options:) 方法来返回适当的场景配置。</p>
<h4 data-id="heading-9">4. 更新生命周期事件处理</h4>
<p>将应用级生命周期事件的处理迁移到相应的场景级事件。例如：</p>
<ul>
<li>application(<em>:didFinishLaunchingWithOptions:) 迁移到 scene(</em>:willConnectTo:options:)</li>
<li>applicationWillResignActive 迁移到 sceneWillResignActive</li>
<li>applicationDidBecomeActive 迁移到 sceneDidBecomeActive</li>
<li>等等...</li>
</ul>
<h4 data-id="heading-10">5. 测试</h4>
<p>在支持场景的设备（例如 iPad）上彻底测试你的应用。验证场景是否正确创建、生命周期事件是否正常触发，以及多窗口等功能是否按预期工作。对于分阶段迁移，确保现有功能在启用场景的部分和未启用的部分都能正常工作。</p>
<h3 data-id="heading-11">场景与后台任务</h3>
<p>当使用基于场景的生命周期时，后台任务的处理方式有所不同。在基于 UIApplicationDelegate 的应用中，后台任务通常在应用级别管理。而在基于场景的应用中，后台任务可以与特定场景关联。</p>
<p>如果你的应用使用 UIApplication.beginBackgroundTask(withName:expirationHandler:) 来管理长时间运行的任务，在迁移到场景后，你可能需要考虑使用每个场景的后台任务管理。然而，UIApplication 级别的后台任务 API 在基于场景的应用中仍然可用，并且可以在应用级别的任务中使用。</p>
<p>对于直接与特定场景关联的任务（例如，该场景正在进行的网络请求），考虑使用与该场景关联的后台任务。这有助于系统更有效地管理资源，并在场景关闭时提供更清晰的任务清理机制。</p>
<hr/>
<h3 data-id="heading-12">结论</h3>
<p>迁移到基于 UIKit 场景的生命周期可以使你的应用支持多窗口等现代 iOS 功能。无论选择分阶段迁移还是直接迁移，关键步骤都是创建一个 UISceneDelegate 类，配置 Info.plist，并将生命周期事件处理从 UIApplicationDelegate 移动到 UISceneDelegate。迁移后，每个窗口将由独立的场景管理，从而提高模块化并为用户提供更强大的多任务处理体验。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[YOLO26、RF-DETR、D-FINE… 2026模型混战，工程师选择困难症怎么破？]]></title>    <link>https://juejin.cn/post/7598734303175147572</link>    <guid>https://juejin.cn/post/7598734303175147572</guid>    <pubDate>2026-01-26T02:37:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303175147572" data-draft-id="7598836674629681186" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="YOLO26、RF-DETR、D-FINE… 2026模型混战，工程师选择困难症怎么破？"/> <meta itemprop="keywords" content="算法,计算机视觉,深度学习"/> <meta itemprop="datePublished" content="2026-01-26T02:37:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="CoovallyAIHub"/> <meta itemprop="url" content="https://juejin.cn/user/2461151071843739"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            YOLO26、RF-DETR、D-FINE… 2026模型混战，工程师选择困难症怎么破？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2461151071843739/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    CoovallyAIHub
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:37:15.000Z" title="Mon Jan 26 2026 02:37:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>YOLO26的亮相，与其说是一次升级，不如说是一声宣言：那个拼参数、卷规模的时代，正在悄悄退场。现在轮到“小身材、大智慧、拎包入住”的模型登场了。但有趣的是，擂台另一边也热闹得很——2024到2025年间，几位风格迥异的选手已接连登场：RF-DETR、LW-DETR、D-FINE这些“非YOLO系”的选手，正凭着一技之长迅速逼近，甚至在有些赛道上完成了超车。再加上YOLO家族内部自我革新的YOLO11，眼下这个局面，倒让不少工程师犯了选择困难症。</p>
<blockquote>
<p><strong>YOLO26还香不香？工业场景到底该押注谁？</strong></p>
</blockquote>
<p>我们不如把这几位移到一个真实的车间里，看看它们各自的手艺如何。</p>
<h2 data-id="heading-0"><strong>这是 5 条完全不同的技术路线</strong></h2>
<p>在对比性能之前，必须先明确一件事：这 5 个模型，解决问题的思路本质不同。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/abafa53c65a94fc8956e4f517cd1909e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=vpobHvQ44awiauGjzCt9RnraiCQ%3D" alt="screenshot_2026-01-23_13-52-20.png" loading="lazy"/></p>
<p>也正因为路线不同，它们的<strong>性能优势场景</strong>完全不一样。</p>
<h2 data-id="heading-1"><strong>YOLO26：最新的“工业模型</strong> <strong>”</strong></h2>
<p>该怎么形容YOLO26呢？它不像从论文里走出来的，更像从生产线上长出来的。</p>
<p>它的改变很务实：结构变得更干净、更模块化，剪掉了那些枝枝蔓蔓。这么做的好处显而易见，调试起来心里有底，部署起来也少折腾。它没有跟风去堆砌庞大的注意力机制，反而聚焦在 <strong>“如何更有效地利用特征”</strong> 上——局部感知搭配轻量级的注意力，在工业常见的缺陷检测、规则物体识别上，表现得出奇稳定。</p>
<p>当然，它的老本行依然扎实：推理速度、对TensorRT和ONNX的友好度，以及在边缘设备上那份从容。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5fa41a74cfda4790a4c8804cd2822401~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=vpJHwV9DqqtoXDYsSnqLK%2FfqMhI%3D" alt="Ultralytics-YOLO26-Benchmark.jpg" loading="lazy"/></p>
<h2 data-id="heading-2"><strong>YOLO11：家族里的“革新者”与“普及者”</strong></h2>
<p>很多人误以为YOLO11是YOLO26的简版或前身，其实不然。尤其在网络结构重组上花了大力气，对Neck部分动了不小的手术。有意思的是，它证明了 <strong>“更小”也能“更强”</strong> ——比如YOLO11-M版本，参数比v8减少了超过五分之一，精度却不降反升。</p>
<p>论文指标上，它的表现可圈可点。广泛的硬件兼容性，让它从边缘设备到云端GPU都能快速适配。但据一些工程师反馈，一旦放到真实的工业环境里，面对那些不可避免的噪声、数据偏移，它的稳定性似乎就逊色了半分。所以不妨这么看：YOLO11探索并证明了结构优化的潜力，而YOLO26则在此基础上，把“稳”字诀打磨得更透彻。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/57d33489eb8d4a9d861921f1573c52e9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=F2MKRECGVmlaToyqkLPdCm83WXs%3D" alt="280f752fa8984fa98bacf4840c20d3dd.png" loading="lazy"/></p>
<h2 data-id="heading-3"><strong>Transformer阵营的“务实派”</strong></h2>
<p>先说说<strong>LW-DETR</strong>。思路很清晰：把Vision Transformer（ViT）的特征提取能力，与DETR的高效检测框架融合起来。通过图像分块和多尺度特征融合，它在当时实现了精度与速度对YOLO11的双重超越。可以说，它是Transformer阵营向效率做出的第一次醒目妥协，试图在保持架构优雅的同时，也能跑得快一些。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/97f93b58261643018cec292fe8198f21~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=RqSNdDhucPOj6CUtFbLWqjI5Uw0%3D" alt="92c834252e71421eabac20e66f840f5a.png" loading="lazy"/></p>
<p>而<strong>RF-DETR</strong>，它终于大规模解决了传统DETR“训练难、收敛慢、部署重”的痼疾。通过特征重排和降低对Query的依赖，它在复杂场景和多类别检测上，效果确实亮眼。更引人注目的是，它直接打包了分割、分类和检测三大任务能力，并且在跨领域泛化测试中表现突出。模型本身也足够紧凑，支持边缘部署。但务实地说，它的训练成本和算力胃口依然比YOLO系大，更像是一位能力全面但身价也更高的“特种兵”。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5c5c5fcfd3f54402b455e575d9bd0cb2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=TVV0%2FVZzfu2DoXUYFJhE3iIvgnY%3D" alt="screenshot_2026-01-23_14-58-59.png" loading="lazy"/></p>
<h2 data-id="heading-4"><strong>D-FINE：曲高和寡的“精度艺术家”</strong></h2>
<p>如果只看学术榜单，2024年发布的D-FINE的成绩单足以让人心动。它引入了一个叫“细粒度分布细化”的机制，像是对边界框概率分布进行精雕细琢的迭代，所以在小目标、密集重叠目标检测上优势明显。模型本身也很轻快，响应迅速，听起来简直是导航、决策等实时场景的完美人选。</p>
<p>但问题恰恰在于，理想的实验室数据集，在工厂里几乎是奢侈品。实际应用中，标注的噪声、波动的推理延迟、复杂的部署链条，都很容易让它“水土不服”。它是一位挑剔的、追求极致精度的艺术家，需要完美的舞台，而嘈杂的工业现场，往往给不了这份完美。</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/010bd90491e94298b714f5d63f08171a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=9L83XTc6CDBKe2jXuCr%2Bdnlbwe8%3D" alt="fdr-1.jpg" loading="lazy"/></p>
<h2 data-id="heading-5"><strong>模型检测性能对照表（基于 COCO 数据集）</strong></h2>
<ul>
<li><strong>mAP50:95</strong>— COCO 综合平均精度指标（50-95 IoU），常用来衡量检测质量。</li>
<li><strong>推理延迟（ms/img）</strong>  — 推理延迟（TensorRT FP16 on NVIDIA T4 约束）。</li>
<li><strong>参数量</strong> — 模型参数规模（百万），影响存储和部署成本。</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10f2b1e7b4fe4cc4a966608bcd3310e1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=kh6UXyqs%2BWGFLAOzDVT7fQ%2F1B%2Fc%3D" alt="screenshot_2026-01-23_14-20-47.png" loading="lazy"/></p>
<ul>
<li>
<p><strong>最高精度：</strong> 模型精度 top3 出现在 YOLO26x (~57.5%)、D-FINE-Medium (~55.1%)、YOLO26l (~55.0%)。</p>
<p>其中 YOLO26x 在精度上有优势，同时依旧保持相对可控的延迟。</p>
</li>
</ul>

<ul>
<li>
<p><strong>最佳效率选择：</strong> LW-DETR-Tiny 和 YOLO26n 延迟极低（&lt;2ms），适合极限实时场景。</p>
<p>RF-DETR-Nano 在 latency 与精度平衡上表现优秀（48.4% mAP / ~2.3ms）。</p>
</li>
</ul>

<ul>
<li>
<p>**参数规模：**YOLO 系列（尤其 n/s 规模）通常参数更少（轻量级），便于边缘部署。</p>
<p>Transformer 核心模型（如 RF-DETR）尽管参数更大，但在泛化能力上具有潜力。</p>
</li>
</ul>
<h2 data-id="heading-6"><strong>总结</strong></h2>
<p>说到底，工厂的考卷上只有三道题：<strong>能不能稳定地跑起来？能不能控制住成本？能不能大规模铺开？</strong></p>
<p>相较于YOLO11在稳定性上偶尔的波动，或是RF-DETR们对算力环境更高的要求，YOLO26所追求的，正是一种“更低延迟、更广支持、不妥协精度”的实用主义哲学。</p>
<p>这不意味着其他模型没有价值，恰恰相反，正是YOLO11们的探索、RF-DETR们的突破，共同推动着整个领域向前。但在2026年这个节点，当计算机视觉技术疯狂涌入千行百业，那些需要真正落地、创造价值的场景，或许更需要一个像YOLO26这样懂得“过日子”的伙伴。它可能不会是最常出现在论文标题里的那个明星，但很有机会，成为生产线和终端设备里，那个沉默却不可或缺的基石。</p>
<p><strong>理论分析的终点，正是工程实践的起点。</strong>  以上所有模型的理论对比、性能数据，最终都需要在你自己的数据集和部署环境中进行验证。这正是 <strong>Coovally</strong> 这样的平台可以大显身手的地方。它为你提供了一个从算法到落地的一站式工具箱：</p>
<ul>
<li><strong>快速验证：</strong> 无需复杂环境配置，即可在平台上获取、导入并快速测试上述各系列模型，用你的真实数据验证它们的表现，将理论数据转化为实际决策依据。</li>
<li><strong>高效训练与调优：</strong> 无论是YOLO系列的工程化改进，还是Transformer模型的复杂调参，平台内置的自动化流程和资源管理都能大幅降低实验成本，助你找到最适合当前场景的“最优解”。</li>
</ul>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8946aaffeaa4d70add9161f8aab4cba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=g1%2FLw7Hpoh1eTD5NLIBJ4vh%2F368%3D" alt="Coovally操作动图.gif" loading="lazy"/></p>
<p>Coovally平台不仅提供模型资源，还可以帮助你提供<strong>AI解决方案</strong>，可以扫描二维码，我们来给你提供解决方案！！</p>
<p align="center"><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df7fca2c045e4a4ea49fefee64bdce93~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQ29vdmFsbHlBSUh1Yg==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999835&amp;x-signature=uN3%2FjXxiCDx%2BDlUszQ58PHiJP4U%3D" alt="小助手二维码.png" loading="lazy"/></p>
<p>点击<strong>阅读原文</strong>，即可体验Coovally平台！</p>
<p>所以，如果你正在操盘工业视觉、巡检监控或缺陷检测这类项目，我的建议可能会有点保守：先从YOLO26开始，把流程跑通、场景吃透。等到确有余力时，再去斟酌，是否需要那一点额外的“折腾”来换取边际上的提升。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[告别混乱：Agent Skills 实战指南]]></title>    <link>https://juejin.cn/post/7598921649888854043</link>    <guid>https://juejin.cn/post/7598921649888854043</guid>    <pubDate>2026-01-25T16:33:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598921649888854043" data-draft-id="7599094262591913994" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="告别混乱：Agent Skills 实战指南"/> <meta itemprop="keywords" content="程序员"/> <meta itemprop="datePublished" content="2026-01-25T16:33:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="米一多"/> <meta itemprop="url" content="https://juejin.cn/user/3825956198025239"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            告别混乱：Agent Skills 实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3825956198025239/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    米一多
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T16:33:22.000Z" title="Sun Jan 25 2026 16:33:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>你是否曾被 Agent 的“不听话”、“执行乱”和“工具荒”搞得焦头烂额？你是否也经历过或者正在经历这样的“ Agent 调教”崩溃时刻：规则失效，在 Agent.md 里写下千言万语，Agent 却视若无睹；执行失控，精心打磨了无数 Prompt，执行起来依旧像无头苍蝇；工具迷失，明明集成了强大的 MCP 工具库，Agent 却两手一摊说“没工具”。</p>
<p>如果这些场景让你感同身受，别急着放弃。终结这场混乱的答案，可能就是 Skills。</p>
<h3 data-id="heading-0">核心亮点：从“聊天机器人”到“得力干将”的进化</h3>
<p>Agent 正在经历一场进化，而 Skills 正是关键催化剂。本文将带你一文弄懂 Skills ——这个让 Agent 变得可靠、可控、可复用的“高级技能包”。无论你是开发者还是普通用户，都能在这里找到让你的 Agent “开窍”的秘诀。</p>
<p>如果你想更高效地体验顶级模型的能力，推荐试试 <a href="https://link.juejin.cn?target=https%3A%2F%2Fnunu.chat%2F" target="_blank" title="https://nunu.chat/" ref="nofollow noopener noreferrer">nunu.chat</a>，这是一个多模型聚合的 AI chat 平台，支持国内直连访问海外顶级大模型，还有大量免费额度供你调试自己的 Skills。</p>
<h3 data-id="heading-1">什么是 Skills？</h3>
<p>“Skills” 这个概念最早由 Anthropic 公司提出，作为其大模型 Claude 的一种能力扩展机制。简单来说，它允许用户为 Claude 添加自定义的功能和工具。随着这套做法越来越成熟，并被社区广泛接受，Skills 如今已成为大多数 Agent 开发工具和 IDE 都支持的一种标准扩展规范。</p>
<p>一个 Skills 通常以一个文件夹的形式存在，里面主要装着三样东西：一份说明书（SKILL.md）、一堆操作脚本（Script）、以及一些参考资料（Reference）。你可以把一个 Skill 想象成一个打包好的“技能包”。它把完成某个特定任务所需的领域知识、操作流程、要用到的工具、以及最佳实践全都封装在了一起。</p>
<p><img src="https://pic-out.zhimg.com/v2-7cc6d1e7917f64645790e06240112071~resize:1440:q75.png?animatedImageAutoPlay=false&amp;animatedImagePlayCount=1&amp;auth_key=1769358655-0-0-3c95a9c19a34c7a8c68bb0736e4c6381&amp;bizSceneCode=article_draft&amp;expiration=1769358655&amp;incremental=false&amp;mid=6c28d1233b683a4d5e58b0046d609ef1&amp;overTime=60&amp;precoder=false&amp;protocol=v2&amp;retryCount=3&amp;sampling=false&amp;sceneCode=editor_copy_outbound&amp;source=bfcaadb1" alt="" loading="lazy"/></p>
<p>当 AI 面对相应请求时，就能像一位经验丰富的专家那样，有条不紊地自主执行。</p>
<h3 data-id="heading-2">Skill 原理介绍：渐进式加载</h3>
<p>📚 官方解释：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.claude.com%2Fdocs%2Fen%2Fagents-and-tools%2Fagent-skills%2Foverview" target="_blank" title="https://platform.claude.com/docs/en/agents-and-tools/agent-skills/overview" ref="nofollow noopener noreferrer">platform.claude.com/docs/en/age…</a></p>
<p>Skill 的架构原理在于其巧妙的三层分级加载机制，运行在一个允许访问文件系统和执行 bash 命令的沙盒环境里：</p>
<p><img src="https://pic-out.zhimg.com/v2-0244bf9063fd7fc381d5152f1133b96f~resize:1440:q75.png?animatedImageAutoPlay=false&amp;animatedImagePlayCount=1&amp;auth_key=1769358655-0-0-c508a09bb21ad4eaf68a25711f635213&amp;bizSceneCode=article_draft&amp;expiration=1769358655&amp;incremental=false&amp;mid=6c28d1233b683a4d5e58b0046d609ef1&amp;overTime=60&amp;precoder=false&amp;protocol=v2&amp;retryCount=3&amp;sampling=false&amp;sceneCode=editor_copy_outbound&amp;source=bfcaadb1" alt="" loading="lazy"/></p>
<ul>
<li><strong>Level 1：元数据（始终加载）</strong>：就像“名片”，包含名称和描述。Claude 启动时会加载所有元数据，因为它很轻量，不会占满上下文。</li>
<li><strong>Level 2：说明文档（触发时加载）</strong>：SKILL.md 文件的正文。只有用户请求与描述相符时，才会读取并加载到上下文，节省 Token。</li>
<li><strong>Level 3：资源与代码（按需加载）</strong>：包括 FORMS.md、Python 脚本或 API 文档。脚本代码本身不进入上下文，几乎不增加额外成本。</li>
</ul>
<p><strong>Skills 的调用逻辑：</strong> 1. <strong>意图匹配</strong>：Agent 扫一眼“名片夹”（元数据），寻找最匹配的一张。 2. <strong>读取手册</strong>：翻开“操作手册”（SKILL.md），研究执行步骤。 3. <strong>按需执行</strong>：从“工具箱”拿出脚本或工具干活。 4. <strong>反馈结果</strong>：汇报结果或请教困难。</p>
<p><img src="https://pic-out.zhimg.com/v2-b1cfd05afa9368ee034884f1bf107ca9~resize:1440:q75.png?animatedImageAutoPlay=false&amp;animatedImagePlayCount=1&amp;auth_key=1769358655-0-0-28e554a75f86a9c6b8a9e6f9699a8906&amp;bizSceneCode=article_draft&amp;expiration=1769358655&amp;incremental=false&amp;mid=6c28d1233b683a4d5e58b0046d609ef1&amp;overTime=60&amp;precoder=false&amp;protocol=v2&amp;retryCount=3&amp;sampling=false&amp;sceneCode=editor_copy_outbound&amp;source=bfcaadb1" alt="" loading="lazy"/></p>
<h3 data-id="heading-3">Skills vs. 其他概念的区别</h3>
<p>为了更清晰地理解，我们把它和快捷指令（Command）和原子工具（MCP）做对比。用一个厨房的例子就很好懂了。</p>
<p><img src="https://pic-out.zhimg.com/v2-8de84d44f3536f4eb746dce9ffafbb64~resize:1440:q75.png?animatedImageAutoPlay=false&amp;animatedImagePlayCount=1&amp;auth_key=1769358655-0-0-8bc2997325c1523021ff073b387b5a7a&amp;bizSceneCode=article_draft&amp;expiration=1769358655&amp;incremental=false&amp;mid=6c28d1233b683a4d5e58b0046d609ef1&amp;overTime=60&amp;precoder=false&amp;protocol=v2&amp;retryCount=3&amp;sampling=false&amp;sceneCode=editor_copy_outbound&amp;source=bfcaadb1" alt="" loading="lazy"/></p>
<p>📚 官方博客解释：<a href="https://link.juejin.cn?target=https%3A%2F%2Fclaude.com%2Fblog%2Fskills-explained" target="_blank" title="https://claude.com/blog/skills-explained" ref="nofollow noopener noreferrer">claude.com/blog/skills…</a></p>
<h3 data-id="heading-4">如何写好一个好的 Skills</h3>
<p>从“能用”到“好用”，需要遵循以下原则： * <strong>原子性（Atomicity）</strong>：坚持单一职责，专注于解决一个具体问题。 * <strong>给例子（Few-Shot Prompting）</strong>：直接给出清晰的输入输出示例，这是最关键的一点。 * <strong>立规矩（Structured Instructions）</strong>：1) 定角色；2) 拆步骤；3) 画红线（明确不能做什么）。 * <strong>造接口（Interface Design）</strong>：明确定义输入参数和输出格式（如 JSON）。 * <strong>勤复盘（Iterative Refinement）</strong>：把 Bad Case 变成新的规则或反例。</p>
<p>📚 官方最佳实践指南：<a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.claude.com%2Fdocs%2Fzh-CN%2Fagents-and-tools%2Fagent-skills%2Fbest-practices" target="_blank" title="https://platform.claude.com/docs/zh-CN/agents-and-tools/agent-skills/best-practices" ref="nofollow noopener noreferrer">platform.claude.com/docs/zh-CN/…</a></p>
<h3 data-id="heading-5">社区资源与实战：在 TRAE 中落地</h3>
<p><strong>社区热门 Skills 推荐：</strong> 📚 官方 Skills 仓库：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fanthropics%2Fskills%25E3%2580%2582%25E5%25AD%25A6%25E4%25B9%25A0%25E5%25AE%2598%25E6%2596%25B9%25E4%25BB%2593%25E5%25BA%2593%25E5%258F%25AF%25E4%25BB%25A5%25E6%259C%2580%25E5%25BF%25AB%25E4%25BA%2586%25E8%25A7%25A3%25E6%259C%2580%25E4%25BD%25B3%25E5%25AE%259E%25E8%25B7%25B5%25E3%2580%2582" target="_blank" title="https://github.com/anthropics/skills%E3%80%82%E5%AD%A6%E4%B9%A0%E5%AE%98%E6%96%B9%E4%BB%93%E5%BA%93%E5%8F%AF%E4%BB%A5%E6%9C%80%E5%BF%AB%E4%BA%86%E8%A7%A3%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E3%80%82" ref="nofollow noopener noreferrer">github.com/anthropics/…</a></p>
<p><strong>如何在 TRAE 里快速使用：</strong> 1. <strong>方式一：设置中直接创建</strong>。Cmd +/ Ctrl + 打开设置，找到「规则技能」，点击「创建」，填入名称、描述和主体。 2. <strong>方式二：直接解析 SKILL.md</strong>。在项目目录下新增 <code>.trae/Skills/xxx</code> 文件夹。 3. <strong>方式三：在对话中创建</strong>。利用内置的 Skills-creator 直接要求 TRAE 创建。</p>
<p><strong>使用方法</strong>：加载后，在对话框输入“帮我设计一个有科技感的登录页面”或“帮我提取 PDF 表格”，系统会自动调用相应技能。</p>
<h3 data-id="heading-6">实践场景举例：基于飞书文档的 Spec Coding</h3>
<p>针对引言中提到的规则失效问题，我们可以将复杂场景拆分成独立技能。 <strong>什么是 Spec Coding？</strong> 提倡“先思考后行动”，通过定义需求规范（Specification）推动开发。 <strong>场景分析</strong>：我们需要“多角色专家 Skills”（需求分析、技术设计、任务拆解）和“飞书文档使用 Skill”（教会 Agent 飞书语法和协作逻辑），最后通过“Spec Coding Skill”统筹全局，完成工具与角色的组合调度。</p>
<h3 data-id="heading-7">Q &amp; A | 一些常见问题</h3>
<ul>
<li><strong>为什么不生效？</strong> 十有八九是“名片”（Description）没写好，Agent 无法判断何时该用它。</li>
<li><strong>受 LLM 影响吗？</strong> 有。强模型擅长“挑选和策略”，而 Skill 决定了执行的“最低水平和稳定性”。</li>
<li><strong>是万能的吗？</strong> 不是。它不擅长高度创造力、实时动态决策或简单的知识问答。</li>
<li><strong>可以修改社区 Skill 吗？</strong> 强烈建议 Fork 并二次开发。</li>
</ul>
<h3 data-id="heading-8">总结与结语</h3>
<p>Skill 的出现解决了 Agent 规则失效、执行失控的问题。其核心价值在于：精准解决痛点（三级加载平衡效率与深度）以及生态赋能。它让 AI 从“样样懂一点”的通才，进化为“事事做得好”的专家协作伙伴。</p>
<p>不妨从今天开始，尝试将你最擅长的领域经验封装成可复用的 Skill，让 AI 成为你延伸专业价值的放大器。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[[更新迭代 - 3] Nestjs 在25年底更新了啥？（bug修复篇+功能增强篇）]]></title>    <link>https://juejin.cn/post/7598744870996492331</link>    <guid>https://juejin.cn/post/7598744870996492331</guid>    <pubDate>2026-01-26T02:39:35.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598744870996492331" data-draft-id="7584722109584064555" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="[更新迭代 - 3] Nestjs 在25年底更新了啥？（bug修复篇+功能增强篇）"/> <meta itemprop="keywords" content="后端,Node.js,NestJS"/> <meta itemprop="datePublished" content="2026-01-26T02:39:35.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="Joney_SLi"/> <meta itemprop="url" content="https://juejin.cn/user/870468942308733"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            [更新迭代 - 3] Nestjs 在25年底更新了啥？（bug修复篇+功能增强篇）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/870468942308733/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    Joney_SLi
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:39:35.000Z" title="Mon Jan 26 2026 02:39:35 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读14分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin:30px 0 10px;color:#cca152;position:relative;padding-left:50px;border-bottom:2px solid rgba(209,163,78,.6);padding-bottom:0}.markdown-body h1{font-size:30px}.markdown-body h1:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:80%;bottom:-10px;left:-2px}.markdown-body h2{font-size:24px}.markdown-body h2:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:70%;bottom:-15px;left:-1px}.markdown-body h3{font-size:18px}.markdown-body h3:before{content:"";width:50px;height:42px;display:block;position:absolute;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACcAAAAhBAMAAACo1K8bAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAnUExURUdwTMyhUsqkUMyhUsyiUcyhUsyhUsyhUcyhUsyhUs2hUtytWNWoVX44si8AAAAKdFJOUwD8Bfcge95QncCWSSDAAAABh0lEQVQoz2WSPUvDQBjHjyPSOB7drh2OUOs36NA6pKAFwaEo4tDFIUWxGYLgKw4BEYUuHaQg7XJ0kccsUmrT2qUUQZp8KO/y1hSfIYEf/5eHu0MoGU1+sIbSw5Bypd92S+dWWrd34b15vuOPY4QxuvtYZp0lIVk3Zgjt+5zkh12AvBHnbW85BOjXySPwhc5CYcY0OdDh5dEUqIEj4cN8Dty3a1MqYJS4MaWU5wzVLwMMxqGSNQgA/VFa4gf50yhxSUW+db8ACa2gBxfnABVDFYHCPYrc7TLwCepJM8/ZoVsRwpxdHEozHUXd6idwVzFFM5BFmIhQVQjrNdnCvdd48wblI2VHtsAZioSsTYVwLoXvjMXH1icuNgPhQE+Ot1+xi8HeA3d1Df1f1JPVUOmsYLujBjuSySqSXYt+yTwbJ0pcyIhqTrxkn0BazRLizJosxRBued+z0jPD6VewOXl5utHRGmMNK3k0iTkzxpq2/oIQO6gLprF12kT/R20eyzlcg7iwK0dPsz/ibpdsCHweWwAAAABJRU5ErkJggg==) 0 0 no-repeat;background-size:60%;bottom:-19px;left:-2px}.markdown-body h4{font-size:16px;padding-left:0;border-bottom:1px solid rgba(209,163,78,.6)}.markdown-body h5{font-size:15px;padding-left:0}.markdown-body em{color:#cca152}.markdown-body del{text-decoration-color:#cca152;text-decoration-thickness:2px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:80%;margin:6px auto;box-shadow:0 6px 15px #8e8e8e;display:block;margin:20px auto!important;object-fit:contain;border-radius:8px}.markdown-body hr{border:none;border-top:2px solid #e0c9a1;margin-top:32px 0}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background:#f6efde;color:#b69454;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Mono,Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;background:#fef6e1;border-radius:4px;box-shadow:0 0 8px hsla(0,0%,47%,.45)}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAOCAMAAABaWb9VAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAFZaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA1LjQuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIj4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+CkzCJ1kAAAAJcEhZcwAADsQAAA7EAZUrDhsAAACHUExURUdwTMxCKdc8NvdYT/9hVyLJPABBAGubKNiIOv+/K+ytJBakH9aZG+5QR5VZDOBDPhmtJ8+VGuGjH/CwJR26MR6+NBq0LPW1KBmwKetNRfJUTONHP92fHuSmIeFEPhu3LR29M/BTS+mqIuqsI5qdHyLKPP++Kv9gVf9lW//KLSXXQCTQP//FLMVm5KQAAAAldFJOUwAlPPz7+woBBPu8Mzu+FlRRKmvnweeG+Wqg6mVNXmuc1OCbmjZJWF/9AAABKklEQVQoz3WS6XaCMBCFRzAM++KGsqhtDwES3//5OtmA2uP9A9zwzRoAgBC0QgQrdA68OZsDr229YGHoIEj7Pl0ZOgjKa5lYJ4Rd1vijn3nuD4Qurjmv48o6RFyfbGDnS6DeEXZfk5ZfuBhdPb9I87ECNMh1EFJKIU6agWzaa01NbmLkxznSmmObJBkkUxrERf3i+ftRiZi7ShPCYY64UhTx1AR5CDYoMXkOKEY7GmTcTzeD/FiER68DfSLgSRqEIBoB3P8h3x8RZhBXGJGusJdD6rfCBl0YqvZNkrV9zej2cWlfJWG6fRpyM41qYH+GTPPi2yFLQYC0Qybm5o96lW77kMbcrBKtgeWTsthVamNXFF4I6x0DTPuugsVRFyYpyxzWqNvHJwed8ws7QyP1UwjNjwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fef6e1}.markdown-body a{text-decoration:none;color:#d8ac5a;border-bottom:1px solid #d8ac5a}.markdown-body a:active,.markdown-body a:hover{color:#93753f;border-color:#93753f}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f4e8c7;border-collapse:collapse}.markdown-body thead{background:rgba(255,227,176,.6588235294);text-align:left;display:table-header-group;border-bottom:1px solid rgba(255,227,176,.6588235294)}.markdown-body tbody{background:rgba(255,247,229,.3882352941)}.markdown-body td,.markdown-body th{padding:7px;line-height:24px;min-width:100px}.markdown-body blockquote{color:#bd954f;padding:1px 23px;margin:22px 0;border-left:4px solid #dcb267;background-color:#fff7e5}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol .task-list-item,.markdown-body ul .task-list-item{list-style:none}.markdown-body ol li{padding-left:6px}.markdown-body::marker{color:#dcb267}.markdown-body .contains-task-list{padding-left:0}.markdown-body .contains-task-list .task-list-item{list-style:none;position:relative}.markdown-body .contains-task-list .task-list-item input[type=checkbox]{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:before{content:"";display:inline-block;height:12px;width:12px;position:absolute;left:-2px;top:-2px;border:2px solid #cda152;border-radius:5px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked{position:relative;top:2px}.markdown-body .contains-task-list .task-list-item input[type=checkbox]:checked:before{border:none;content:"";display:inline-block;height:17px;width:17px;position:absolute;left:-2px;top:-2px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAFo9M/3AAAAAXNSR0IArs4c6QAAAYhJREFUOBFjYACC0/MDGsDEiyvr/zOCeUwMJxn/A8HZRUEMYBFGJsZ6kFoQYALiAyAGCgDpA+sFijKeWRj4H1kWpIWBW1SDQcm+BCzOAiK/vr7BcO/gDbAAI4hE1waWgRBnmWCGIwkyKFjnwow0BhsJk9QLncvw5dV1oPE9MCEGmBWrgCKhcFEowyR+PSNYwemFAZ4M/xjMkRWYJm5oAPFB/joDpI1BHHQANgGPDxj+//vfCA4IdJ3GcevgQnAFhlHLwYIgSVA0wABcwY3tFQzokiBFGIEP0wmigW5wZAK5FFkQib0a6NUDcEmgb7AGFpIGZOZqoMFhIAFQknEAJpn9yLLEssFOBCp2IFaDkl0xg6C8FbJyB3gowUS5RdQYBORQYpVB1iwVHIIMwJh///AYTCmYRklNIBFmNi4GeYt0BhnjeIa3dw8wSBlEgDUhxw2yCRgGfHp2geHiqiSwUwUVrFAiFVkjjA1LrjgTHEwhFvosMCZM4NEIUoAtWWNoBGZ70/gN22HiAD2uhAzsYNBZAAAAAElFTkSuQmCC) 0 0 no-repeat;background-size:100%}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="androidstudio">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#a9b7c6;background:#282b2e}.hljs-bullet,.hljs-literal,.hljs-number,.hljs-symbol{color:#6897bb}.hljs-deletion,.hljs-keyword,.hljs-selector-tag{color:#cc7832}.hljs-link,.hljs-template-variable,.hljs-variable{color:#629755}.hljs-comment,.hljs-quote{color:grey}.hljs-meta{color:#bbb529}.hljs-addition,.hljs-attribute,.hljs-string{color:#6a8759}.hljs-section,.hljs-title,.hljs-type{color:#ffc66d}.hljs-name,.hljs-selector-class,.hljs-selector-id{color:#e8bf6a}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>大家好我是Joney , 本文梳理了从25年1月份到 25年底的所有官方更新内容, 主要涵盖了Nestjs的各种bug修复Issues</p>
</blockquote>
<h2 data-id="heading-0">release一览</h2>
<blockquote>
<p>以下统计是简单粗略的统计，后续文章会改进此方法。数据上可能不是100%准确</p>
</blockquote>
<p>Nest 从 25年1月开发的第一次 release v11.0.0 直到年底 v11.1.11  一共发布了31个release （今年的更新非常的频繁）</p>
<p>这些不断地release和仓库迭代， 看得出作者和开发社区还是很用心的，至少是一个值得信赖的项目，不像其它项目做完KPI就跑路， 蛐蛐一下国内的大厂哈（表情-狗头保命），是 开源是很重要，但是持续维护才能让开发者信任。</p>
<p>总结来说，24年 Nest的工作分布如下</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/731abc19554c441b931dce6b82b72e4e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9uZXlfU0xp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999974&amp;x-signature=ynC7e%2FW%2B16D55CTodw36VQk3nvA%3D" alt="image.png" loading="lazy"/>
可以看到许多工作是依赖升级迭代支持相关的内容。bug修复和功能升级还是很快的，作为一个 开源项目且拥有74.3k 的Start OpenIssues 只有24 个，可以算是非常优秀了</p>
<p>再看 以月份为维度的分析：可以看到1月份开年的时候 因为大版本升级更新了非常多的内容
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/37cce7a9b39842e69bccd89bafec9d81~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9uZXlfU0xp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999974&amp;x-signature=3ewkclg5g%2FveKsFvVeK%2BmbZ7lKU%3D" alt="image.png" loading="lazy"/></p>
<h3 data-id="heading-1">Bug修复项</h3>
<blockquote>
<p>接下来我们分析一下 25年 重要的bug修复</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d2f9356ce7344eb3a69159917a060c73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgSm9uZXlfU0xp:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999974&amp;x-signature=t%2F4s3KjiZ9j3LkbncULVcSE3Rgw%3D" alt="image.png" loading="lazy"/></p>
<p>后文使用了一些AI汇总的功能，我们要紧跟时代</p>
<h4 data-id="heading-2">🟢 核心框架 (Core / @nestjs/core) - 共 21 个修复</h4>
<p><em>这是 NestJS 的基石。2025 年的修复主要集中在依赖注入系统的边缘情况（如循环依赖、竞态条件）以及中间件和生命周期的执行顺序上。</em></p>
<p><strong>fix(core): infinite loop on broken circular reference</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14803" target="_blank" title="https://github.com/nestjs/nest/pull/14803" ref="nofollow noopener noreferrer">PR #14803</a>
修复了当两个模块通过 <code>forwardRef</code> 相互引用且其中一个在初始化时抛出异常，会导致错误处理逻辑陷入死循环的问题。</p>
<p><strong>fix(core): race condition in class dependency resolution</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15504" target="_blank" title="https://github.com/nestjs/nest/pull/15504" ref="nofollow noopener noreferrer">PR #15504</a>
修复了从导入模块解析类依赖时可能出现的竞态条件，增强了高并发启动时的稳定性。</p>
<p><strong>fix(core): fix race condition in class dependency resolution (Duplicate Scenario)</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15405" target="_blank" title="https://github.com/nestjs/nest/pull/15405" ref="nofollow noopener noreferrer">PR #15405</a>
针对类依赖解析的另一种竞态条件场景进行了修复，防止在特定的异步初始化流程中出现实例重复创建。</p>
<p><strong>fix(core): global module middleware should be executed first</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14495" target="_blank" title="https://github.com/nestjs/nest/pull/14495" ref="nofollow noopener noreferrer">PR #14495</a>
修正了中间件执行顺序，确保全局模块中注册的中间件总是优先于局部模块的中间件执行。</p>
<p><strong>fix(core): make get() throw for implicitly request-scoped trees</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15865" target="_blank" title="https://github.com/nestjs/nest/pull/15865" ref="nofollow noopener noreferrer">PR #15865</a>
现在，如果在静态上下文中尝试使用 <code>get()</code> 获取隐式请求作用域（Request-Scoped）的实例，框架会明确抛出异常，而不是返回未定义行为。</p>
<p><strong>fix(core): instantiate nested transient providers in static context</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16098" target="_blank" title="https://github.com/nestjs/nest/pull/16098" ref="nofollow noopener noreferrer">PR #16098</a>
修复了在静态上下文中嵌套的瞬态（Transient）提供者无法正确实例化的问题。</p>
<p><strong>fix(core): resolve all providers when using resolve() with each option</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16005" target="_blank" title="https://github.com/nestjs/nest/pull/16005" ref="nofollow noopener noreferrer">PR #16005</a>
修复了 <code>resolve()</code> 方法配合 <code>each: true</code> 选项使用时，未能正确解析所有提供者实例的问题。</p>
<p><strong>fix(core): missing catch handler for forward-ref provider resolution</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16133" target="_blank" title="https://github.com/nestjs/nest/pull/16133" ref="nofollow noopener noreferrer">PR #16133</a>
为 <code>forward-ref</code> 提供者的解析过程补充了缺失的异常捕获处理，防止未捕获的 Promise Rejection。</p>
<p><strong>fix(core): ensure nested transient provider isolation</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15815" target="_blank" title="https://github.com/nestjs/nest/pull/15815" ref="nofollow noopener noreferrer">PR #15815</a>
修复了嵌套瞬态提供者的隔离性问题，确保它们在不同的注入链中保持独立。</p>
<p><strong>fix(core): skip lifecycle hooks for non-instantiated transient services</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15571" target="_blank" title="https://github.com/nestjs/nest/pull/15571" ref="nofollow noopener noreferrer">PR #15571</a>
优化了生命周期管理，不再对未实际实例化的瞬态服务触发 <code>onModuleInit</code> 等钩子。</p>
<p><strong>fix(core): attach root inquirer for nested transient providers</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15469" target="_blank" title="https://github.com/nestjs/nest/pull/15469" ref="nofollow noopener noreferrer">PR #15469</a>
修复了嵌套瞬态提供者丢失根 <code>inquirer</code>（请求发起者）信息的问题，确保依赖树追踪正确。</p>
<p><strong>fix(core): gracefully shutdown the app when repl exits</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15201" target="_blank" title="https://github.com/nestjs/nest/pull/15201" ref="nofollow noopener noreferrer">PR #15201</a>
修复了 REPL 环境退出时，Nest应用未能优雅关闭（Graceful Shutdown）的问题。</p>
<p><strong>fix(core): HTTP adapter error mapping</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15056" target="_blank" title="https://github.com/nestjs/nest/pull/15056" ref="nofollow noopener noreferrer">PR #15056</a>
修复了 HTTP 适配器层面的错误映射逻辑，确保底层抛出的错误能被框架正确识别和转换。</p>
<p><strong>fix(core): use topology tree for calculating distance (perf)</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14597" target="_blank" title="https://github.com/nestjs/nest/pull/14597" ref="nofollow noopener noreferrer">PR #14597</a>
这是一个重要的性能修复，通过使用拓扑树结构来计算模块距离，解决了大型项目启动缓慢的问题。</p>
<p><strong>fix(core): middleware sort issues</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14523" target="_blank" title="https://github.com/nestjs/nest/pull/14523" ref="nofollow noopener noreferrer">PR #14523</a>
修复了中间件排序逻辑中的 Bug，确保中间件严格按照注册顺序执行。</p>
<p><strong>fix(core): allow optional named wildcard groups</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14522" target="_blank" title="https://github.com/nestjs/nest/pull/14522" ref="nofollow noopener noreferrer">PR #14522</a>
修复了路由路径中可选命名通配符组（Named Wildcard Groups）解析不正确的问题。</p>
<p><strong>fix(core): shutdown hooks order</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14267" target="_blank" title="https://github.com/nestjs/nest/pull/14267" ref="nofollow noopener noreferrer">PR #14267</a>
修复了应用关闭时 <code>onModuleDestroy</code> 和 <code>beforeApplicationShutdown</code> 等钩子的执行顺序。</p>
<p><strong>fix(core): Calculate module distance after bindGlobalScope</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14110" target="_blank" title="https://github.com/nestjs/nest/pull/14110" ref="nofollow noopener noreferrer">PR #14110</a>
调整了计算模块距离的时机，确保在全局作用域绑定后进行，以获得正确的依赖拓扑。</p>
<p><strong>fix(core): Order of module destroy should be the reverse of module init</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14111" target="_blank" title="https://github.com/nestjs/nest/pull/14111" ref="nofollow noopener noreferrer">PR #14111</a>
严格规范了模块销毁顺序，确保其完全是初始化的逆序，防止销毁依赖时报错。</p>
<p><strong>fix(core): revisit dependencies w/ possibly higher distance</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14097" target="_blank" title="https://github.com/nestjs/nest/pull/14097" ref="nofollow noopener noreferrer">PR #14097</a>
修复了依赖解析算法，重新访问可能具有更高距离的依赖项，解决了复杂依赖图中的解析错误。</p>
<p><strong>fix(core): bring back <code>getHeader</code> and <code>appendHeader</code></strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15061" target="_blank" title="https://github.com/nestjs/nest/pull/15061" ref="nofollow noopener noreferrer">PR #15061</a>
在 <code>AbstractHttpAdapter</code> 中恢复了被误删的 <code>getHeader</code> 和 <code>appendHeader</code> 方法，修复了兼容性问题。</p>
<hr/>
<h4 data-id="heading-3">🕸️ 微服务 (Microservices) - 共 16 个修复</h4>
<p><em>今年的微服务修复重点在于“连接资源泄露”的治理以及 RabbitMQ/Redis 的行为修正。</em></p>
<p><strong>fix(microservices): ensure all redis and amqp client closes properly</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15062" target="_blank" title="https://github.com/nestjs/nest/pull/15062" ref="nofollow noopener noreferrer">PR #15062</a>
修复了微服务关闭时，底层的 Redis 和 AMQP 客户端连接未被彻底销毁导致的句柄泄露问题。
<em>(相关修复: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15032" target="_blank" title="https://github.com/nestjs/nest/pull/15032" ref="nofollow noopener noreferrer">PR #15032</a> AMQP connections, <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15020" target="_blank" title="https://github.com/nestjs/nest/pull/15020" ref="nofollow noopener noreferrer">PR #15020</a> Redis connections)</em></p>
<p><strong>fix(microservices): fix grpc stream method return type</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16072" target="_blank" title="https://github.com/nestjs/nest/pull/16072" ref="nofollow noopener noreferrer">PR #16072</a>
修正了 gRPC 流式方法的返回类型定义，解决了类型推断错误。</p>
<p><strong>fix(microservices): rmq microservice fanout bind</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15747" target="_blank" title="https://github.com/nestjs/nest/pull/15747" ref="nofollow noopener noreferrer">PR #15747</a>
修复了 RabbitMQ 微服务在 Fanout 交换机模式下的绑定逻辑错误。</p>
<p><strong>fix(microservices): report correct buffer length in exception</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15508" target="_blank" title="https://github.com/nestjs/nest/pull/15508" ref="nofollow noopener noreferrer">PR #15508</a>
当发生数据包过大异常时，现在能报告准确的缓冲区长度，便于调试。</p>
<p><strong>fix(microservices): fix kafka serialization of class instances</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15492" target="_blank" title="https://github.com/nestjs/nest/pull/15492" ref="nofollow noopener noreferrer">PR #15492</a>
修复了 Kafka 传输器在序列化类实例时可能丢失数据或格式错误的问题。</p>
<p><strong>fix(microservices): Revisit RMQ pattern matching with wildcards</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15305" target="_blank" title="https://github.com/nestjs/nest/pull/15305" ref="nofollow noopener noreferrer">PR #15305</a>
重新设计了 RabbitMQ 的模式匹配逻辑，修复了通配符（Wildcards）匹配不准确的问题。</p>
<p><strong>fix(microservices): support custom strategy in async usefactory config</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15172" target="_blank" title="https://github.com/nestjs/nest/pull/15172" ref="nofollow noopener noreferrer">PR #15172</a>
修复了在 <code>useFactory</code> 异步配置中无法正确使用自定义微服务策略（Custom Strategy）的问题。</p>
<p><strong>fix(microservice): prevent error logs during redis client shutdown</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15166" target="_blank" title="https://github.com/nestjs/nest/pull/15166" ref="nofollow noopener noreferrer">PR #15166</a>
消除了 Redis 客户端在正常关闭过程中产生的误导性错误日志。</p>
<p><strong>fix(microservices): do not re-create client connection once get client</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14869" target="_blank" title="https://github.com/nestjs/nest/pull/14869" ref="nofollow noopener noreferrer">PR #14869</a>
修复了通过服务名获取客户端时，不必要地重复创建连接的问题。</p>
<p><strong>fix(microservices): server send drops emitted value</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14605" target="_blank" title="https://github.com/nestjs/nest/pull/14605" ref="nofollow noopener noreferrer">PR #14605</a>
修复了服务器端发送消息时，发射的值偶尔会被丢弃的 Bug。</p>
<p><strong>fix(microservices): rabbitmq bindings and auto-generated queues</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14129" target="_blank" title="https://github.com/nestjs/nest/pull/14129" ref="nofollow noopener noreferrer">PR #14129</a>
修复了 RabbitMQ 在使用自动生成的队列名时绑定失败的问题。</p>
<p><strong>fix(microservices): use instance refs for target handler callbacks</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14112" target="_blank" title="https://github.com/nestjs/nest/pull/14112" ref="nofollow noopener noreferrer">PR #14112</a>
在处理回调时改用实例引用，防止内存泄漏或上下文丢失。</p>
<p><strong>fix(microservices): delete unnecessary call of grpcClient.start</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F13468" target="_blank" title="https://github.com/nestjs/nest/pull/13468" ref="nofollow noopener noreferrer">PR #13468</a>
移除了 gRPC 客户端中不必要的 <code>start</code> 调用，避免潜在的状态冲突。</p>
<p><strong>fix(microservices): update RMQ_DEFAULT_QUEUE to an empty string</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15250" target="_blank" title="https://github.com/nestjs/nest/pull/15250" ref="nofollow noopener noreferrer">PR #15250</a>
将 RabbitMQ 默认队列名修正为空字符串，符合标准行为。</p>
<hr/>
<h4 data-id="heading-4">🚀 平台适配器 (Platform Fastify/Express) - 共 13 个修复</h4>
<p><em>主要是为了适配 Fastify v5 和 Express v5 的一些边缘行为及路由逻辑。</em></p>
<p><strong>fix(platform-fastify): middie bypassing through decoded chars</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16135" target="_blank" title="https://github.com/nestjs/nest/pull/16135" ref="nofollow noopener noreferrer">PR #16135</a>
修复了 Fastify 中 <code>middie</code> 中间件可能通过解码后的字符被绕过的安全隐患。</p>
<p><strong>fix(platform-fastify): Migrate fastify top-level options to routerOptions</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15831" target="_blank" title="https://github.com/nestjs/nest/pull/15831" ref="nofollow noopener noreferrer">PR #15831</a>
修复了 Fastify 顶层配置未正确传递给 <code>routerOptions</code> 的问题，确保路由配置生效。</p>
<p><strong>fix(platform-fastify): correct parameter type in RouteConstraints decorator</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15732" target="_blank" title="https://github.com/nestjs/nest/pull/15732" ref="nofollow noopener noreferrer">PR #15732</a>
修正了 <code>RouteConstraints</code> 装饰器参数的类型定义。</p>
<p><strong>fix(platform-fastify): auto-init fastify adapter for middleware registration</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15385" target="_blank" title="https://github.com/nestjs/nest/pull/15385" ref="nofollow noopener noreferrer">PR #15385</a>
在测试环境中，修复了 Fastify 适配器未自动初始化导致中间件注册失败的问题。</p>
<p><strong>fix(platform-fastify): methods comparison</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14935" target="_blank" title="https://github.com/nestjs/nest/pull/14935" ref="nofollow noopener noreferrer">PR #14935</a>
修复了 HTTP 方法比较逻辑，确保大小写不敏感匹配的正确性。</p>
<p><strong>fix(platform-fastify): adds the non-standard http methods to the instance</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14511" target="_blank" title="https://github.com/nestjs/nest/pull/14511" ref="nofollow noopener noreferrer">PR #14511</a>
允许 Fastify 实例识别并处理非标准的 HTTP 方法。</p>
<p><strong>fix(platform-fastify): global prefix exclusion path handling w/middleware</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14895" target="_blank" title="https://github.com/nestjs/nest/pull/14895" ref="nofollow noopener noreferrer">PR #14895</a>
修复了当设置全局路由前缀排除路径时，中间件仍然错误执行的问题。</p>
<p><strong>fix(platform-fastify): middleware not executed when root path is excluded</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F13797" target="_blank" title="https://github.com/nestjs/nest/pull/13797" ref="nofollow noopener noreferrer">PR #13797</a>
修复了当根路径被排除时，相关中间件未能正确执行的 Bug。</p>
<p><strong>fix(platform-express): make check for existing middlewares work with Express 5</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14574" target="_blank" title="https://github.com/nestjs/nest/pull/14574" ref="nofollow noopener noreferrer">PR #14574</a>
修复了 Express 5 环境下，检查现有中间件是否存在的逻辑失效的问题。</p>
<p><strong>fix(platform-express): respect custom parser middlewares in Express 5</strong>
(PR #14640) <em>链接源自描述</em>
确保在 Express 5 中，用户自定义的解析器中间件优先级正确。</p>
<p><strong>fix(platform-express): remove use of pipeline</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15010" target="_blank" title="https://github.com/nestjs/nest/pull/15010" ref="nofollow noopener noreferrer">PR #15010</a>
移除了对 <code>pipeline</code> 的使用，解决了某些环境下的流处理兼容性问题。</p>
<p><strong>fix(core): flattenRoutePath return a valid module</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15333" target="_blank" title="https://github.com/nestjs/nest/pull/15333" ref="nofollow noopener noreferrer">PR #15333</a>
修复了路由路径扁平化处理时，未能返回有效模块引用的问题。</p>
<hr/>
<h4 data-id="heading-5">🛠️ 通用工具与其它 (Common &amp; Others) - 共 6 个修复</h4>
<p><strong>fix(common): resolve file-type path explicitly</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16077" target="_blank" title="https://github.com/nestjs/nest/pull/16077" ref="nofollow noopener noreferrer">PR #16077</a>
修复了 <code>file-type</code> 库的路径解析问题，防止在某些构建工具下找不到模块。</p>
<p><strong>fix(common): Support fallbackToMimetype without buffer</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16013" target="_blank" title="https://github.com/nestjs/nest/pull/16013" ref="nofollow noopener noreferrer">PR #16013</a>
修复了 <code>FileTypeValidator</code> 在没有 Buffer 数据时，无法回退到 MIME 类型检查的问题。</p>
<p><strong>fix(common): console logger color allowance</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15577" target="_blank" title="https://github.com/nestjs/nest/pull/15577" ref="nofollow noopener noreferrer">PR #15577</a>
修复了控制台日志记录器在特定终端环境下颜色输出判断失效的问题。</p>
<p><strong>fix(common): revert to original value (swc builders regression)</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14579" target="_blank" title="https://github.com/nestjs/nest/pull/14579" ref="nofollow noopener noreferrer">PR #14579</a>
修复了 SWC 构建器引入的回归 Bug，将某些配置恢复为原始值。</p>
<p><strong>fix(common): addLeadingSlash optional group support</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14546" target="_blank" title="https://github.com/nestjs/nest/pull/14546" ref="nofollow noopener noreferrer">PR #14546</a>
修复了路径处理工具中对可选正则分组添加前导斜杠的逻辑错误。</p>
<p><strong>fix(common): drop broken support for promises on <code>exports</code></strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F14114" target="_blank" title="https://github.com/nestjs/nest/pull/14114" ref="nofollow noopener noreferrer">PR #14114</a>
移除了模块 <code>exports</code> 属性对 Promise 的错误支持，避免引发难以调试的异步问题。</p>
<h3 data-id="heading-6">功能增强项(包括依赖升级)</h3>
<p>基于同样的（ 2025 年发布记录）数据源月度数据统计，2025 年 NestJS 共有 <strong>33 项显著的功能增强</strong> 和 <strong>47 次重要的依赖升级</strong>。</p>
<p>2025 年 NestJS 团队的策略非常清晰：</p>
<ol>
<li><strong>稳固核心</strong>：通过大量的 <strong>Bug Fixes (50+)</strong> 解决了长期存在的边缘问题（特别是循环依赖和竞态条件）。</li>
<li><strong>拥抱标准</strong>：功能增强方面，积极拥抱 <strong>Native Fetch</strong> 和 <strong>Node.js LTS</strong> 新特性，减少对遗留库（如 Axios/Request）的依赖。</li>
<li><strong>微服务优先</strong>：大量精力投入在 <strong>NATS JetStream</strong> 和 <strong>gRPC</strong> 的体验优化上，反映出企业级用户对复杂微服务架构的需求日益增长。</li>
</ol>
<hr/>
<h4 data-id="heading-7">✨ 核心功能增强 (Enhancements) - 共 33 项</h4>
<p><em>这一年的新功能主要围绕“开发体验优化”和“微服务能力扩展”展开。</em></p>
<h5 data-id="heading-8">🚀 核心框架与开发体验 (Core &amp; DX)</h5>
<p><strong>feat(core): support for native fetch API in HttpService</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16240" target="_blank" title="https://github.com/nestjs/nest/pull/16240" ref="nofollow noopener noreferrer">PR #16240</a></p>
<p><strong>解释</strong>：终于摆脱了对 Axios 的强绑定。<code>HttpModule</code> 现在支持底层切换为 Node.js 原生的 <code>fetch</code> API，减少了包体积并提升了流式处理的性能。</p>
<p><strong>feat(core): auto-flush logs on shutdown</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15980" target="_blank" title="https://github.com/nestjs/nest/pull/15980" ref="nofollow noopener noreferrer">PR #15980</a></p>
<p><strong>解释</strong>：在应用接收到 SIGTERM 信号进行优雅关闭时，自动强制刷新缓冲区中的日志，防止容器销毁时最后几条关键日志丢失。</p>
<p><strong>feat(devtools): interactive graph visualization for circular deps</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16305" target="_blank" title="https://github.com/nestjs/nest/pull/16305" ref="nofollow noopener noreferrer">PR #16305</a></p>
<p><strong>解释</strong>：在 NestJS DevTools 中新增了可视化调试工具，能以图形方式展示模块间的循环依赖路径，帮助开发者快速定位“鸡生蛋”问题。</p>
<p><strong>feat(common): new <code>ParseDatePipe</code> with timezone support</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16112" target="_blank" title="https://github.com/nestjs/nest/pull/16112" ref="nofollow noopener noreferrer">PR #16112</a></p>
<p><strong>解释</strong>：增强了内置的日期管道，现在支持传入时区参数，自动将请求中的日期字符串转换为指定时区的 Date 对象。</p>
<h5 data-id="heading-9">🕸️ 微服务与消息队列 (Microservices)</h5>
<p><strong>feat(microservices): NATS JetStream wildcard subscriptions</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16055" target="_blank" title="https://github.com/nestjs/nest/pull/16055" ref="nofollow noopener noreferrer">PR #16055</a></p>
<p><strong>解释</strong>：大幅增强了 NATS 传输层，支持 JetStream 的通配符订阅模式，允许微服务通过一个 Handler 处理一类模式的消息（如 <code>orders.*.created</code>）。</p>
<p><strong>feat(microservices): gRPC reflection service v1alpha support</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15990" target="_blank" title="https://github.com/nestjs/nest/pull/15990" ref="nofollow noopener noreferrer">PR #15990</a></p>
<p><strong>解释</strong>：更新了 gRPC 策略，支持 gRPC 服务器反射协议（Server Reflection），使得 Postman 或 gRPCUI 等工具可以直接探测服务接口定义。</p>
<p><strong>feat(microservices): Kafka idempotent producer configuration</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16120" target="_blank" title="https://github.com/nestjs/nest/pull/16120" ref="nofollow noopener noreferrer">PR #16120</a></p>
<p><strong>解释</strong>：简化了 Kafka 生产者的配置，新增 <code>idempotent: true</code> 快捷配置项，确保在网络抖动时不重复发送消息。</p>
<h5 data-id="heading-10">🧩 其他模块 (OpenAPI / CLI)</h5>
<p><strong>feat(swagger): support for 'oneOf' schema composition via decorators</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16400" target="_blank" title="https://github.com/nestjs/nest/pull/16400" ref="nofollow noopener noreferrer">PR #16400</a></p>
<p><strong>解释</strong>：在 <code>ApiBody</code> 和 <code>ApiResponse</code> 中新增了对 <code>oneOf</code> 的原生装饰器支持，不再需要手写复杂的 Schema 对象。</p>
<p><strong>feat(cli): schematic support for standalone applications</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15888" target="_blank" title="https://github.com/nestjs/nest/pull/15888" ref="nofollow noopener noreferrer">PR #15888</a></p>
<p><strong>解释</strong>：CLI 新增了生成“独立应用（Standalone App）”的脚手架选项，适用于不需要 HTTP 监听器的 CronJob 或 Worker 脚本项目。</p>
<hr/>
<h4 data-id="heading-11">📦 关键依赖升级 (Dependency Upgrades) - 共 47 项</h4>
<p><em>为了保持生态系统的现代化和安全性，2025 年 NestJS 进行了几次重大的底层依赖迭代。</em></p>
<h5 data-id="heading-12">🔨 运行时与语言 (Runtime &amp; Language)</h5>
<p><strong>chore(deps): drop Node.js v18 support, add Node.js v24</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16500" target="_blank" title="https://github.com/nestjs/nest/pull/16500" ref="nofollow noopener noreferrer">PR #16500</a></p>
<p><strong>解释</strong>：<strong>重大变更</strong>。随着 Node.js v18 进入 EOL（生命周期结束），NestJS v11.5 正式移除对其支持，并将 CI/CD 环境升级至 Node.js v24 LTS。</p>
<p><strong>chore(deps): upgrade to TypeScript 5.7</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16222" target="_blank" title="https://github.com/nestjs/nest/pull/16222" ref="nofollow noopener noreferrer">PR #16222</a></p>
<p><strong>解释</strong>：全面适配 TypeScript 5.7，利用其新的类型收窄（Type Narrowing）特性优化了内部工具类型的推断速度。</p>
<h5 data-id="heading-13">🔌 平台适配器 (Platform Adapters)</h5>
<p><strong>chore(deps): upgrade to fastify v5</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F15750" target="_blank" title="https://github.com/nestjs/nest/pull/15750" ref="nofollow noopener noreferrer">PR #15750</a></p>
<p><strong>解释</strong>：<strong>重大升级</strong>。<code>platform-fastify</code> 适配器升级至 Fastify v5，彻底移除了对旧版中间件签名的支持，提升了 15% 的吞吐量。</p>
<p><strong>chore(deps): upgrade express to v5.0 (stable)</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16010" target="_blank" title="https://github.com/nestjs/nest/pull/16010" ref="nofollow noopener noreferrer">PR #16010</a></p>
<p><strong>解释</strong>：在 Express 5.0 发布正式版后，NestJS 第一时间跟进，支持了原生的 Promise 路由处理，不再需要 hack 层的补丁。</p>
<h5 data-id="heading-14">📚 第三方库整合 (Integrations)</h5>
<p><strong>chore(deps): upgrade rxjs to v8.0.0-alpha</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16450" target="_blank" title="https://github.com/nestjs/nest/pull/16450" ref="nofollow noopener noreferrer">PR #16450</a></p>
<p><strong>解释</strong>：开始在内部测试 RxJS 8 的兼容性，主要是为了适配更小的包体积，目前仍保持对 v7 的向后兼容。</p>
<p><strong>chore(deps): update mongoose to v9</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16333" target="_blank" title="https://github.com/nestjs/nest/pull/16333" ref="nofollow noopener noreferrer">PR #16333</a></p>
<p><strong>解释</strong>：适配 Mongoose v9 的破坏性变更，特别是关于 <code>Connection</code> 状态管理的逻辑更新。</p>
<p><strong>chore(deps): update typeorm to 0.4.0</strong>
<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnestjs%2Fnest%2Fpull%2F16180" target="_blank" title="https://github.com/nestjs/nest/pull/16180" ref="nofollow noopener noreferrer">PR #16180</a></p>
<p><strong>解释</strong>：跟进 TypeORM 0.4.x 的驱动层更新，修复了在 PostgreSQL 17 下的一些驱动连接警告。</p>
<hr/>
<h3 data-id="heading-15">总结</h3>
<p>回顾 NestJS 在 2025 年的演进历程，可以用 <strong>“稳固根基，拥抱原生”</strong> 八个字来概括。</p>
<p>从 <strong>v11.0.0</strong> 到年底的 <strong>v11.1.11</strong>，官方潜下心来解决了大量深层次的架构问题：</p>
<ol>
<li><strong>技术债的清理</strong>：解决了困扰已久的循环依赖死锁和高并发下的竞态条件问题，这对于构建大规模单体应用（Monolith）的企业级用户来说是巨大的信心提升。</li>
<li><strong>标准化与去依赖</strong>：<code>HttpService</code> 支持原生 <code>fetch</code>、全面适配 Node.js LTS 和 TypeScript 5.7，标志着 NestJS 正在逐渐剥离对第三方重型库的依赖，回归 Web 标准。</li>
<li><strong>微服务生态的成熟</strong>：对 gRPC 反射和 NATS JetStream 的深度支持，说明 NestJS 已经不仅仅是一个 HTTP 框架，而是构建复杂分布式系统的首选方案。
环依赖可视化是一个神器，建议在开发阶段利用起来，避免代码结构随着业务增长变成难以维护的“意大利面条”。</li>
</ol>
<p>NestJS 依然是 Node.js 服务端领域的“扛把子”，2025 年的这些更新让它变得更加健壮和现代化。希望这篇汇总能帮助大家更好地规划 2026 年的技术选型和升级路线。</p>
<p>我是 Joney，我们下期再见！👋</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[在Kubernetes集群中部署NFS Subdir ExternalProvisioner的完整复盘]]></title>    <link>https://juejin.cn/post/7599088558167261230</link>    <guid>https://juejin.cn/post/7599088558167261230</guid>    <pubDate>2026-01-26T03:06:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599088558167261230" data-draft-id="7598921649889738779" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="在Kubernetes集群中部署NFS Subdir ExternalProvisioner的完整复盘"/> <meta itemprop="keywords" content="云原生"/> <meta itemprop="datePublished" content="2026-01-26T03:06:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="opsmaster"/> <meta itemprop="url" content="https://juejin.cn/user/2140102571593625"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            在Kubernetes集群中部署NFS Subdir ExternalProvisioner的完整复盘
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2140102571593625/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    opsmaster
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:06:54.000Z" title="Mon Jan 26 2026 03:06:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">在Kubernetes集群中部署NFS Subdir External Provisioner的完整复盘</h2>
<p>在Kubernetes（K8s）的持久化存储体系中，NFS（Network File System）作为经典的共享存储方案，被广泛用于多Pod共享数据的场景。但手动创建NFS类型的PV（PersistentVolume）不仅繁琐，还难以适配动态扩容的需求。<strong>NFS Subdir External Provisioner</strong> 正是解决这一问题的利器——它能基于NFS服务器，为PVC（PersistentVolumeClaim）<strong>动态创建PV</strong>，并自动管理NFS子目录的生命周期。</p>
<p>本文将结合实战操作，从<strong>环境介绍、核心原理、分步部署、功能验证</strong>四个维度，完整复盘NFS Subdir External Provisioner的部署与使用流程，帮你快速落地K8s的NFS动态存储方案。</p>
<hr/>
<h3 data-id="heading-1">一、实战环境介绍</h3>
<p>本次部署基于一套<strong>可正常运行的K8s集群</strong>，核心环境信息如下：</p>






























<table><thead><tr><th>组件</th><th>核心配置</th><th>验证方式</th></tr></thead><tbody><tr><td>Kubernetes集群</td><td>节点状态正常（可通过<code>kubectl get nodes</code>查看）</td><td><code>kubectl get nodes</code></td></tr><tr><td>NFS服务器</td><td>IP：<code>192.168.99.22</code>，共享目录：<code>/nfs-storage/k8s-pvs</code></td><td><code>showmount -e 192.168.99.22</code></td></tr><tr><td>部署工具</td><td>Helm（初始未安装，通过<code>snap</code>安装）</td><td><code>helm list -A</code>（初始无输出，安装后可正常执行）</td></tr><tr><td>访问工具</td><td><code>kubectl</code>（已配置集群访问权限）</td><td>可正常执行K8s资源操作命令</td></tr></tbody></table>
<blockquote>
<p>关键前提：NFS服务器已完成共享配置，K8s所有节点均可正常挂载该NFS共享目录。</p>
</blockquote>
<hr/>
<h3 data-id="heading-2">二、核心原理讲解</h3>
<h4 data-id="heading-3">1. NFS Subdir External Provisioner 是什么？</h4>
<p>它是K8s官方维护的<strong>外部存储Provisioner</strong>，基于NFS协议实现<strong>动态PV供给</strong>。核心能力是：</p>
<ul>
<li>监听K8s中PVC的创建/删除事件；</li>
<li>为每个PVC在NFS共享目录下<strong>自动创建独立子目录</strong>，并生成对应的PV；</li>
<li>当PVC删除时，根据配置<strong>归档或删除</strong>NFS子目录，实现PV的生命周期管理。</li>
</ul>
<h4 data-id="heading-4">2. 动态PV的核心流程</h4>
<ol>
<li><strong>用户创建PVC</strong>：指定关联的StorageClass（绑定NFS Provisioner）；</li>
<li><strong>Provisioner监听</strong>：检测到PVC创建请求，触发PV创建逻辑；</li>
<li><strong>NFS子目录创建</strong>：在NFS共享目录<code>/nfs-storage/k8s-pvs</code>下，生成以<code>命名空间-PVC名称-随机串</code>命名的子目录；</li>
<li><strong>PV创建与绑定</strong>：Provisioner创建PV，指向该NFS子目录，并与PVC完成绑定；</li>
<li><strong>PVC删除回收</strong>：删除PVC时，Provisioner根据<code>archiveOnDelete</code>参数，将NFS子目录重命名为<code>archived-xxx</code>（归档）或直接删除。</li>
</ol>
<h4 data-id="heading-5">3. StorageClass的作用</h4>
<p>StorageClass是动态PV的“模板”，本次部署中我们创建了名为<code>nfs-storage-class</code>的StorageClass，核心配置包括：</p>
<ul>
<li><code>provisioner</code>：指定为NFS Subdir External Provisioner；</li>
<li><code>nfs.server</code>/<code>nfs.path</code>：NFS服务器IP与共享目录；</li>
<li><code>archiveOnDelete</code>：PVC删除时是否归档NFS子目录（本次设为<code>true</code>）；</li>
<li><code>defaultClass</code>：是否设为集群默认StorageClass（本次设为<code>true</code>，未指定<code>storageClassName</code>的PVC将自动使用该类）。</li>
</ul>
<hr/>
<h3 data-id="heading-6">三、实战部署步骤</h3>
<h4 data-id="heading-7">步骤1：环境分析与前置准备</h4>
<p>首先通过命令检查集群与NFS环境，确保部署前提满足：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 1. 检查K8s节点状态</span>
kubectl <span class="hljs-keyword">get</span> nodes

<span class="hljs-meta"># 2. 检查现有StorageClass（确认无冲突）</span>
kubectl <span class="hljs-keyword">get</span> storageclass

<span class="hljs-meta"># 3. 检查Helm安装状态（初始未安装）</span>
helm list -A

<span class="hljs-meta"># 4. 安装Helm（通过snap快速安装）</span>
sudo snap install helm --classic

<span class="hljs-meta"># 5. 验证NFS服务器共享目录可用性</span>
showmount -e <span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.22</span>
</code></pre>
<p>执行结果：NFS共享目录<code>/nfs-storage/k8s-pvs</code>正常暴露，Helm安装完成，K8s集群状态正常。</p>
<h4 data-id="heading-8">步骤2：Helm部署NFS Subdir External Provisioner</h4>
<p>借助Helm仓库快速部署Provisioner，简化配置与管理：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment"># 1. 添加NFS Provisioner的Helm仓库</span>
helm repo add nfs-subdir-external-provisioner https://kubernetes-sigs.github.io/nfs-subdir-external-provisioner/

<span class="hljs-comment"># 2. 更新Helm仓库索引</span>
helm repo update

<span class="hljs-comment"># 3. 安装Provisioner（指定NFS参数、StorageClass配置）</span>
helm install nfs-provisioner nfs-subdir-external-provisioner/nfs-subdir-external-provisioner \
  -n kube-system \
  --set <span class="hljs-attr">nfs.server</span>=<span class="hljs-number">192.168</span>.<span class="hljs-number">99.22</span> \
  --set <span class="hljs-attr">nfs.path</span>=/nfs-storage/k8s-pvs \
  --set <span class="hljs-attr">storageClass.name</span>=nfs-storage-class \
  --set <span class="hljs-attr">storageClass.defaultClass</span>=<span class="hljs-literal">true</span>
</code></pre>
<ul>
<li><code>-n kube-system</code>：将Provisioner部署在K8s系统命名空间，便于管理；</li>
<li><code>--set</code>参数：核心配置NFS服务器、共享路径、StorageClass名称及默认属性。</li>
</ul>
<h4 data-id="heading-9">步骤3：验证Provisioner部署状态</h4>
<p>部署完成后，检查Provisioner与StorageClass的运行状态：</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 1. 检查Provisioner Pod状态（确认Running）</span>
kubectl <span class="hljs-keyword">get</span> pods -n kube-system | grep nfs-provisioner

<span class="hljs-meta"># 2. 检查StorageClass（确认创建成功且为默认）</span>
kubectl <span class="hljs-keyword">get</span> storageclass

<span class="hljs-meta"># 3. 查看StorageClass详细配置（验证参数正确性）</span>
kubectl describe storageclass nfs-storage-<span class="hljs-keyword">class</span>
</code></pre>
<p>执行结果：Provisioner Pod处于<code>Running</code>状态，<code>nfs-storage-class</code> StorageClass创建成功并标记为<code>(default)</code>，核心参数与NFS配置一致。</p>
<h4 data-id="heading-10">步骤4：验证动态PV功能</h4>
<p>通过创建测试PVC，验证动态PV的创建、绑定、回收全流程：</p>
<h5 data-id="heading-11">（1）创建测试PVC YAML</h5>
<p>新建<code>test-nfs-pvc.yaml</code>，定义PVC的存储需求与关联的StorageClass：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-string">apiVersion:</span> <span class="hljs-string">v1</span>
<span class="hljs-string">kind:</span> <span class="hljs-string">PersistentVolumeClaim</span>
<span class="hljs-attr">metadata:</span>
  <span class="hljs-string">name:</span> <span class="hljs-string">test-nfs-pvc</span>
  <span class="hljs-string">namespace:</span> <span class="hljs-string">ms-demo</span>  <span class="hljs-comment"># 测试命名空间（需提前存在）</span>
<span class="hljs-attr">spec:</span>
  <span class="hljs-attr">accessModes:</span>
    <span class="hljs-string">-</span> <span class="hljs-string">ReadWriteMany</span>  <span class="hljs-comment"># NFS支持多Pod读写</span>
  <span class="hljs-attr">resources:</span>
    <span class="hljs-attr">requests:</span>
      <span class="hljs-string">storage:</span> <span class="hljs-string">100Mi</span>  <span class="hljs-comment"># 申请100Mi存储</span>
  <span class="hljs-string">storageClassName:</span> <span class="hljs-string">nfs-storage-class</span>  <span class="hljs-comment"># 关联部署的StorageClass</span>
</code></pre>
<h5 data-id="heading-12">（2）创建PVC并验证绑定</h5>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-meta"># 1. 创建PVC</span>
kubectl apply -f test-nfs-pvc.yaml

<span class="hljs-meta"># 2. 检查PVC状态（确认Bound）</span>
kubectl <span class="hljs-keyword">get</span> pvc -n ms-demo

<span class="hljs-meta"># 3. 检查PV（确认自动创建并绑定）</span>
kubectl <span class="hljs-keyword">get</span> pv | grep test-nfs-pvc
</code></pre>
<p>执行结果：PVC状态为<code>Bound</code>，PV自动创建且与PVC完成绑定。</p>
<h5 data-id="heading-13">（3）验证NFS子目录创建</h5>
<p>登录NFS服务器，检查共享目录下是否生成对应子目录：</p>
<pre><code class="hljs language-arduino" lang="arduino">ssh <span class="hljs-number">192.168</span><span class="hljs-number">.99</span><span class="hljs-number">.22</span> <span class="hljs-string">"ls -la /nfs-storage/k8s-pvs/"</span>
</code></pre>
<p>执行结果：生成<code>ms-demo-test-nfs-pvc-xxx</code>格式的子目录，证明Provisioner已成功创建NFS存储目录。</p>
<h5 data-id="heading-14">（4）验证PVC删除与PV回收</h5>
<pre><code class="hljs language-perl" lang="perl"><span class="hljs-comment"># 1. 删除测试PVC</span>
kubectl <span class="hljs-keyword">delete</span> -f test-nfs-pvc.yaml

<span class="hljs-comment"># 2. 检查PV（确认自动删除）</span>
kubectl get pv | <span class="hljs-keyword">grep</span> pvc-xxx  <span class="hljs-comment"># 替换为实际PV名称</span>

<span class="hljs-comment"># 3. 检查NFS子目录（确认归档）</span>
ssh <span class="hljs-number">192.168</span>.<span class="hljs-number">99.22</span> <span class="hljs-string">"ls -la /nfs-storage/k8s-pvs/"</span>
</code></pre>
<p>执行结果：PV被自动删除，NFS子目录重命名为<code>archived-ms-demo-test-nfs-pvc-xxx</code>（因<code>archiveOnDelete=true</code>，数据被归档保留）。</p>
<hr/>
<h3 data-id="heading-15">四、部署结果与注意事项</h3>
<h4 data-id="heading-16">1. 核心验证结果</h4>
<p>✅ NFS Subdir External Provisioner Pod正常运行（<code>kube-system</code>命名空间）； ✅ <code>nfs-storage-class</code> StorageClass创建成功并设为集群默认； ✅ 动态PV功能生效：PVC创建→PV自动创建→NFS子目录生成； ✅ 回收策略生效：PVC删除→PV自动删除→NFS子目录归档。</p>
<h4 data-id="heading-17">2. 关键注意事项</h4>
<ol>
<li><strong>NFS权限配置</strong>：NFS共享目录需赋予K8s节点读写权限，避免Provisioner创建子目录失败；</li>
<li><strong><code>archiveOnDelete</code>参数</strong>：生产环境建议设为<code>true</code>（归档数据），测试环境可设为<code>false</code>（直接删除）；</li>
<li><strong>命名空间管理</strong>：Provisioner部署在<code>kube-system</code>，PVC需在目标命名空间创建（如本次<code>ms-demo</code>）；</li>
<li><strong>默认StorageClass</strong>：设为默认后，未指定<code>storageClassName</code>的PVC将自动使用NFS存储，需避免冲突；</li>
<li><strong>NFS服务器稳定性</strong>：NFS服务器需保证高可用，否则会影响所有依赖该存储的Pod。</li>
</ol>
<hr/>
<h3 data-id="heading-18">五、总结</h3>
<p>通过Helm部署NFS Subdir External Provisioner，我们快速实现了K8s集群的<strong>NFS动态PV供给</strong>，彻底告别了手动创建PV的繁琐流程。从环境准备、Provisioner部署，到动态PV的创建、绑定、回收全流程验证，整套方案具备<strong>部署简单、管理高效、兼容性强</strong>的特点，非常适合中小型K8s集群的共享存储场景。</p>
<p>后续可基于该方案，为应用（如数据库、中间件、文件服务）配置持久化存储，结合<code>ReadWriteMany</code>访问模式，实现多Pod共享数据的需求，进一步提升K8s集群的存储管理效率。</p>
<blockquote>
<p>本文转至：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fmp%2Fappmsgalbum%3F__biz%3DMzcwMTA1NjQyNQ%3D%3D%26action%3Dgetalbum%26album_id%3D4350369381197905931%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzcwMTA1NjQyNQ==&amp;action=getalbum&amp;album_id=4350369381197905931#wechat_redirect" ref="nofollow noopener noreferrer">mp.weixin.qq.com/mp/appmsgal…</a></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[nestjs学习9：装饰器]]></title>    <link>https://juejin.cn/post/7598899986856525830</link>    <guid>https://juejin.cn/post/7598899986856525830</guid>    <pubDate>2026-01-26T03:09:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598899986856525830" data-draft-id="7594627998838947882" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="nestjs学习9：装饰器"/> <meta itemprop="keywords" content="NestJS"/> <meta itemprop="datePublished" content="2026-01-26T03:09:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一江东流水"/> <meta itemprop="url" content="https://juejin.cn/user/1151943917181880"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            nestjs学习9：装饰器
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1151943917181880/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一江东流水
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:09:15.000Z" title="Mon Jan 26 2026 03:09:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>Nest 的功能都是大多通过装饰器来使用的，本文把所有的装饰器过一遍。文章来源自神光的付费文章，搬迁到这里只是为了自己复习。</p>
<h2 data-id="heading-0">@Module @Controller @Injectable</h2>
<p>Nest 提供了一套模块系统，通过 @Module声明模块：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6704e56011864cd7887208be004f21ba~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=%2Boz%2FlHlrLT10pWOC4KvSCHdPSoQ%3D" alt="image.png" loading="lazy"/></p>
<p>通过 @Controller、@Injectable 分别声明其中的 controller 和 provider：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/378d78e08d2e45f8a1fc67d78de0753a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=0daA0FPqXJoV8Zp%2FEGRvMXrP2gY%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c7883a3483f04441a73cd27784301e79~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=k0wOtIfAlYxJHsmpllyVKh1Tt0g%3D" alt="image.png" loading="lazy"/></p>
<p><strong>这个 provider 可以是任何的 class</strong>，不一定非要是<code>service</code>，我们可以自定义任何一个类作为<code>provider</code>：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7361f9b96cd64b8ba9e1a420d3c11d78~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=jQ8cLptgiHV6u8ecAqUt4NRObnQ%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">@Inject @Optional @Global</h2>
<p>注入的方式可以是构造器注入和属性注入：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d9bb33903a964ac3ab85d6aaba3d9c37~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=7zulL7w3OhlATN9pZs%2F9e4JgQf8%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc388637b5e9429bb2f2a8a7e8a20935~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=6AYgmSD7EE8X3oaKAy9rQbMsASA%3D" alt="image.png" loading="lazy"/></p>
<p>属性注入要指定注入的 token，<strong>可能是 class 也可能是 string</strong>。</p>
<p>你可以通过 useFactory、useValue 等方式声明 provider：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/09a1a7d3aa3d4c5ca0f06081d86775a1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=vGQLW4qER9tVopHi08TThU64D2w%3D" alt="image.png" loading="lazy"/></p>
<p>这时候也需要通过 @Inject 指定注入的 token：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6b84459f42546e8a022ceb27ebdb57f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=tpXaUdCK9obYSQkZkDFjO81cexI%3D" alt="image.png" loading="lazy"/></p>
<p>这些注入的依赖如果没有的话，创建对象时会报错。但如果它是可选的，你可以用 <code>@Optional</code> 声明一下，这样没有对应的 provider 也能正常创建这个对象。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6957271d4ab744ae978d2095d47140d4~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=iZXQ22ohETND5KAyNW140p7ppSU%3D" alt="image.png" loading="lazy"/></p>
<p>如果模块被很多地方都引用，为了方便，可以用 @Global 把它声明为全局的，这样它 exports 的 provider 就可以直接注入了：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e1348652f2924067ba39d1822bbc0820~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=dhEbWpyftCLxfNw7O83UVhJmMlU%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">@Query @Param @Body @Headers @Ip @Session @HostParam @Req</h2>
<p>这里的 @Query 是取 url 后的 ?bbb=true，而 @Param 是取路径中的参数，比如 /xxx/111 种的 111。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fd7bd54fae334479bd677c2ab60b74cc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=vdEg4qifVnT%2BCmIxzHfR5mSrmgg%3D" alt="image.png" loading="lazy"/></p>
<p>此外，如果是 @Post 请求，可以通过 @Body 取到 body 部分：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a03a459b46b34cc681860aaebe6bef59~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=bBdIno1Q74GRQ9gPTTSxz2KLWpU%3D" alt="image.png" loading="lazy"/></p>
<p>你可以通过 @Headers 装饰器取某个请求头 或者全部请求头：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/3a9f409b013b4e17952ddd2630944572~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=IYx1E111mQ0I3LA8r5bXzQiEx8Y%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1e7d7f9d7043414295add7c1479a13c2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=Hcfs9LXv%2FqMVO9szbn7zWFroEw8%3D" alt="image.png" loading="lazy"/></p>
<p>通过 @Ip 拿到请求的 ip：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/480ed6c3adad447999318b2a32ef7920~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=62tXpC7YWj%2FgoR973oJl7BEFVU0%3D" alt="image.png" loading="lazy"/></p>
<p>通过 @Session 拿到 session 对象：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5160848f37c34e0bb810c57166651e55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=cwQKs94Q8JvWxNq2l414xhJR1pc%3D" alt="image.png" loading="lazy"/></p>
<p>但要使用 session 需要安装一个 express 中间件：</p>
<pre><code class="hljs language-js" lang="js">npm install express-session
</code></pre>
<p>@HostParam 用于取域名部分的参数：</p>
<p>这样指定 controller 的生效路径：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span>, <span class="hljs-title class_">HostParam</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

@<span class="hljs-title class_">Controller</span>({ <span class="hljs-attr">host</span>: <span class="hljs-string">':host.0.0.1'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'aaa'</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AaaController</span> {
    @<span class="hljs-title class_">Get</span>(<span class="hljs-string">'bbb'</span>)
    <span class="hljs-title function_">hello</span>(<span class="hljs-params"/>) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">'hello'</span>;
    }
}
</code></pre>
<p>controller 除了可以指定某些 path 生效外，还可以指定 host。</p>
<p>这时候你会发现只有 host 满足 xx.0.0.1 的时候才会路由到这个 controller。</p>
<p>host 里的参数就可以通过 @HostParam 取出来：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Controller</span>, <span class="hljs-title class_">Get</span>, <span class="hljs-title class_">HostParam</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@nestjs/common'</span>;

@<span class="hljs-title class_">Controller</span>({ <span class="hljs-attr">host</span>: <span class="hljs-string">':host.0.0.1'</span>, <span class="hljs-attr">path</span>: <span class="hljs-string">'aaa'</span> })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AaaController</span> {
    @<span class="hljs-title class_">Get</span>(<span class="hljs-string">'bbb'</span>)
    <span class="hljs-title function_">hello</span>(<span class="hljs-params">@HostParam(<span class="hljs-string">'host'</span>) host</span>) {
        <span class="hljs-keyword">return</span> host;
    }
}
</code></pre>
<p>前面取的这些都是 request 里的属性，当然也可以直接注入 request 对象：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e8e25a60a29c4989ab6bcb18eec259d5~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=5PKUjBZn694mPj%2BRjtK%2F4Jt55Ck%3D" alt="image.png" loading="lazy"/></p>
<p>通过 @Req 或者 @Request 装饰器，这俩是同一个东西：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/31412309a91645099e4b3be3c5370d26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=8trAwP5V%2BPLU%2FsV12D2aBYsVE08%3D" alt="image.png" loading="lazy"/></p>
<p>注入 request 对象后，可以手动取任何参数。</p>
<h2 data-id="heading-3">@Res @HttpCode @Redirect @Render</h2>
<p>当然，也可以 @Res 或者 @Response 注入 response 对象，只不过 response 对象有点特殊：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6c8486054da24a6eab36e5a1a853939f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=2OTYTsp7mCMbp%2FQ253H%2BLvCh2mk%3D" alt="image.png" loading="lazy"/></p>
<p>当你注入 response 对象之后，服务器会一直没有响应：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2e55b2ff5dfa4d64b225fcebc98673c8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=XoQ0yCQuQbvJiP2apmHUaYGF%2FtI%3D" alt="image.png" loading="lazy"/></p>
<p>因为这时候 Nest 就不会再把 handler 返回值作为响应内容了。</p>
<p>你可以自己返回响应：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/334a284cb88d47c19213064a266d4de2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=lTfw7O5WCrqIqBxt5I0Wuk3HDFU%3D" alt="image.png" loading="lazy"/></p>
<p>Nest 这么设计是为了避免你自己返回的响应和 Nest 返回的响应的冲突。</p>
<p>如果你不会自己返回响应，可以通过 passthrough 参数告诉 Nest：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7e635d6856814cc4beb36c304f7337c3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=WKm4KQmSkZZNDJNMrhjZR3GTKy4%3D" alt="image.png" loading="lazy"/></p>
<p>除了注入 @Res 不会返回响应外，注入 @Next 也不会：</p>
<p>handler 默认返回的是 200 的状态码，你可以通过 @HttpCode 修改它：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e7467ae918e645c0b89170a65a15c344~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=JRvllShBGGFlf3oMSUPVfz%2F8wOs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0f331d443c4d4b668fa2af936ec42276~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=f7I1VfwXEIsnXczIdTkITNBpgf8%3D" alt="image.png" loading="lazy"/></p>
<p>此外，你还可以通过 @Redirect 装饰器来指定路由重定向的 url：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/02f4cf37e8674da086c7cc4dc34c6d66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=v2grsloEiVekkVWof5%2FG1zuDEhs%3D" alt="image.png" loading="lazy"/></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/54b36ea6174b4da9aa1b83d4bdbf4d07~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=aOvUXQHSQLInG6wus3r0Tcw8h%2Fs%3D" alt="d563d9e5836f49038f9ad7db40702f85~tplv-k3u1fbpfcp-jj-mark_1512_0_0_0_q75.awebp" loading="lazy"/></p>
<p>或者在返回值的地方设置 url：</p>
<pre><code class="hljs language-js" lang="js">@<span class="hljs-title class_">Get</span>(<span class="hljs-string">'xxx'</span>)
@<span class="hljs-title class_">Redirect</span>()
<span class="hljs-keyword">async</span> <span class="hljs-title function_">jump</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">url</span>: <span class="hljs-string">'https://www.baidu.com'</span>,
      <span class="hljs-attr">statusCode</span>: <span class="hljs-number">302</span>
    }  
}
</code></pre>
<p><strong>301 和 302 的区别：</strong></p>




















<table><thead><tr><th>访问阶段</th><th>301 永久重定向</th><th>302 临时重定向</th></tr></thead><tbody><tr><td><strong>第一次访问</strong></td><td>1. 浏览器请求 <code>old</code> → 服务器返回 301 + 新地址；2. 浏览器跳转 <code>new</code>，并<strong>把「old→new」的关系永久存在本地缓存</strong></td><td>1. 浏览器请求 <code>old</code> → 服务器返回 302 + 新地址2. 浏览器跳转 <code>new</code>，<strong>不缓存任何关系</strong></td></tr><tr><td><strong>第二次访问</strong></td><td>浏览器直接查本地缓存：“哦，old 永久指向 new” → 直接跳 new，<strong>根本不发请求给服务器</strong></td><td>浏览器重新发请求到 <code>old</code> → 服务器再次返回 302 → 再跳 new</td></tr></tbody></table>
<p>你还可以给返回的响应内容指定渲染引擎，不过这需要先这样设置：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b714afd922ea456a99ba03fda6eea460~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=qHq30En1FtT1y%2B5fKiQ%2BCTqHvZs%3D" alt="image.png" loading="lazy"/></p>
<p>分别指定静态资源的路径和模版的路径，并指定模版引擎为 handlerbars。</p>
<p>当然，还需要安装模版引擎的包 hbs：</p>
<pre><code class="hljs language-js" lang="js">npm install --save hbs
</code></pre>
<p>然后准备图片和模版文件：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2cb4e5e00f5c47c1818fa2e1187abe26~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=hleyxKDG8n5Tl7nncUnGhEOpgcU%3D" alt="image.png" loading="lazy"/></p>
<p>在 handler 里指定模版和数据：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/10232aea806b436fbede7470a9691a8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=Enj5VTQKDEmmcCG0EdND7opS81E%3D" alt="image.png" loading="lazy"/></p>
<p>就可以看到渲染出的 html 了：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4fb204cd6bf444668b8ac6b80b476551~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA5rGf5Lic5rWB5rC0:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001755&amp;x-signature=JJb%2BQVDJv8ZEITXFd3U1Jc2gV90%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-4">总结</h2>
<p>这节我们梳理了下 Nest 全部的装饰器</p>
<p>模块的装饰器：</p>
<ul>
<li>@Module： 声明 Nest 模块</li>
<li>@Controller：声明模块里的 controller</li>
<li>@Injectable：声明模块里可以注入的 provider</li>
<li>@Inject：通过 token 手动指定注入的 provider，token 可以是 class 或者 string</li>
<li>@Optional：声明注入的 provider 是可选的，可以为空</li>
<li>@Global：声明全局模块</li>
</ul>
<p>请求体的装饰器：</p>
<ul>
<li>@Param：取出 url 中的参数，比如 /aaa/:id 中的 id</li>
<li>@Query: 取出 query 部分的参数，比如 /aaa?name=xx 中的 name</li>
<li>@Body：取出请求 body，通过 dto class 来接收</li>
<li>@Headers：取出某个或全部请求头</li>
<li>@Session：取出 session 对象，需要启用 express-session 中间件</li>
<li>@HostParm： 取出 host 里的参数</li>
<li>@Req、@Request：注入 request 对象</li>
</ul>
<p>响应体的装饰器：</p>
<ul>
<li>@Res、@Response：注入 response 对象，一旦注入了这个 Nest 就不会把返回值作为响应了，除非指定 passthrough 为true</li>
<li>@HttpCode： 修改响应的状态码</li>
<li>@Header：修改响应头</li>
<li>@Redirect：指定重定向的 url</li>
<li>@Render：指定渲染用的模版引擎</li>
</ul>
<p>把这些装饰器用熟，就掌握了 nest 大部分功能了。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL 8.x 已成事实标准，但这些“坑”才刚刚暴露]]></title>    <link>https://juejin.cn/post/7599094262592946186</link>    <guid>https://juejin.cn/post/7599094262592946186</guid>    <pubDate>2026-01-26T02:41:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262592946186" data-draft-id="7598947628468699182" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL 8.x 已成事实标准，但这些“坑”才刚刚暴露"/> <meta itemprop="keywords" content="后端,数据库"/> <meta itemprop="datePublished" content="2026-01-26T02:41:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="橙序员小站"/> <meta itemprop="url" content="https://juejin.cn/user/1546375522426169"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL 8.x 已成事实标准，但这些“坑”才刚刚暴露
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1546375522426169/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    橙序员小站
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:41:06.000Z" title="Mon Jan 26 2026 02:41:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读22分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>如果你不了解8.x的坑，那请你一定要从头开始阅读本文，如果你已经深陷8.x的坑中，那请你从第七章开始读，希望这章能给你解决思路</p>
<hr/>
<h2 data-id="heading-0">一、为什么 MySQL 8 已经不是「可选升级」</h2>
<p>如果现在还在讨论“要不要上 MySQL 8”，那这个问题本身就已经有点过时了。</p>
<p>过去两年里，MySQL 版本的选择权，正在从业务团队手里一点点消失。最直观的变化来自云厂商。无论是阿里云、腾讯云还是 AWS，新建实例时，MySQL 的默认版本已经全面切到 8.x。5.7 还在，但通常被放进「历史版本」或者「不推荐」里，前面会挂一个很克制但意味明确的提示。</p>
<p>一开始我也没太在意。默认版本这种东西，改一下就好了。后来发现，新项目根本不让你改。有的云环境直接在控制台把 5.7 隐藏掉，有的在内部规范里写得很清楚：<strong>新系统不允许使用 MySQL 5.7</strong>。理由也很简单——官方生命周期、长期维护、安全合规，全都站在 8.x 那一边。</p>
<p>这时候，升级这件事已经不是“技术选型”，而是“时间问题”。</p>
<hr/>
<p>真正让人不舒服的地方在于： MySQL 8 并不是一个“无感升级”。</p>
<p>在 5.7 时代，大多数系统对数据库的要求其实很朴素：</p>
<ul>
<li>SQL 能跑</li>
<li>结果差不多对</li>
<li>性能在可接受范围内</li>
</ul>
<p>很多隐含前提，从来没人明说，但大家都默认成立。比如：</p>
<ul>
<li>排序结果“看起来是稳定的”</li>
<li>group by 没写全字段也能返回点东西</li>
<li>字符串和数字混着比，数据库会帮你兜底</li>
</ul>
<p>这些行为，在 5.7 里并不罕见，甚至可以说是被长期依赖的“特性”。而 MySQL 8 做的第一件事，就是开始系统性地拆掉这些“兜底”。</p>
<hr/>
<p>很多人升级后第一反应是：</p>
<blockquote>
<p>MySQL 8 怎么这么严格？ 以前能跑的 SQL，现在居然直接报错。</p>
</blockquote>
<p>但站在现在回头看，这个判断其实有点本末倒置。问题不在于 MySQL 8 变“激进”了，而在于 <strong>我们写的 SQL，本来就站在一堆未写明的默认行为上</strong>。这些默认行为，在 5.7 里被纵容了很多年。MySQL 8 只是选择不再纵容。</p>
<hr/>
<p>更关键的是，这种变化往往不是“升级当天就炸”。很多系统在升级到 8.0 后：</p>
<ul>
<li>能启动</li>
<li>能跑主流程</li>
<li>甚至压测数据也没明显异常</li>
</ul>
<p>真正的问题，往往是上线几周、甚至几个月之后才慢慢浮出来。</p>
<p>排序结果开始不稳定；历史数据和新数据混在一起时表现异常；某些 SQL 在特定数据量下突然变慢；偶发的执行计划漂移，重启后又“神奇恢复”；这些现象单独看，都不像是“数据库升级问题”。。。</p>
<p>但它们有一个共同点：<strong>都建立在“旧行为仍然成立”的假设之上</strong>。</p>
<hr/>
<p>所以现在再回头看，会发现一个挺残酷的事实：很多系统并不是“被 MySQL 8 坑了”，而是<strong>在用 MySQL 5.7 的思维，跑 MySQL 8.0</strong>。而 MySQL 8 这个版本，恰好不再愿意替你把这些问题藏起来。</p>
<hr/>
<h2 data-id="heading-1">二、第一个被低估的变化：默认字符集和排序规则</h2>
<p>大多数团队第一次真正感受到 MySQL 8 和以前不一样，往往不是在建表的时候，而是在数据已经跑了一段时间之后。</p>
<p>表现形式也很一致：列表排序看起来“不太稳定”，某些值的位置偶尔会飘，分页翻页时顺序对不上，导出的数据和页面展示对不上，但你单独拎一条 SQL 出来跑，又很难复现问题。这种问题在 5.7 时代并不常见，至少不常被当成数据库问题。</p>
<hr/>
<p>MySQL 8 上来就做了一件看似“人畜无害”的事：把默认字符集从 <code>utf8</code> 换成了 <code>utf8mb4</code>，排序规则从 <code>*_general_ci</code> 换成了 <code>*_0900_ai_ci</code>。很多人第一次看到这个改动的反应是：“挺好，终于原生支持 emoji 了。”</p>
<p>但这个理解，几乎忽略了 80% 的实际影响。</p>
<hr/>
<p>先说字符集。在 5.7 里，大量历史表的字符集是 <code>utf8</code>，而不是严格意义上的 UTF-8，只是 MySQL 自己的三字节实现。升级到 8.0 之后，新建表默认直接变成了 <code>utf8mb4</code>。问题不在于“多支持几个字符”，而在于<strong>字段、索引和历史表之间开始出现隐性不一致</strong>。</p>
<p>一个很常见的场景是这样的：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">user</span> (
  id <span class="hljs-type">BIGINT</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  nickname <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>),
  KEY idx_nickname (nickname)
);
</code></pre>
<p>这张表在 5.7 时代建的，没有任何问题。</p>
<p>升级到 8.0 之后，你可能会在新环境里重建表结构，甚至只是通过工具同步一次结构。这时候，<code>nickname</code> 的字符集已经悄悄变成了 <code>utf8mb4</code>。单看字段没问题，单看索引也没问题，真正的问题是：<strong>索引长度和比较方式已经变了</strong>。</p>
<p>如果这个字段后来被你扩展到了 <code>VARCHAR(255)</code>，在某些情况下，索引会直接建不出来，或者被你无意识地截断。更糟的是，有些环境能建，有些环境不能建，差异只来自于默认字符集和排序规则是否一致。</p>
<hr/>
<p>真正杀伤力更大的，其实是排序规则。</p>
<p>在 5.7 里，大量系统使用的是 <code>utf8_general_ci</code>。这个排序规则的特点是：<strong>简单、宽松、不太讲究语言学细节</strong>。</p>
<p>MySQL 8 默认换成了 <code>utf8mb4_0900_ai_ci</code>，这是基于 Unicode 9.0 的排序规则，考虑了更多字符等价关系。听起来是“更标准”，但代价是：<strong>排序结果和以前不一样了</strong>。</p>
<p>举一个最简单、也最容易被忽略的例子：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span> name <span class="hljs-keyword">FROM</span> demo <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> name;
</code></pre>
<p>在 5.7 下，如果你的数据是：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">a</span>
<span class="hljs-selector-tag">A</span>
aa
</code></pre>
<p>排序结果往往是你“习惯中的那种”。到了 8.0，同样的数据、同样的 SQL，顺序可能发生变化。不是错，是规则变了。</p>
<p>真正的问题在于，大量业务代码<strong>默认排序结果是稳定的</strong>，甚至会在应用层偷偷依赖这个顺序。</p>
<hr/>
<p>这类问题为什么在测试环境经常没暴露？</p>
<p>因为测试库通常是新建的，表结构、字符集、排序规则都很“干净”。而生产环境的数据，是一层层历史叠上来的：5.6 建的表、5.7 跑过的数据、8.0 新插的记录，全混在一起。同一列字段，逻辑上是一样的字符串，但底层比较规则已经不完全一致。</p>
<p>这时候再去看应用层，只会觉得事情非常诡异：SQL 没变，索引没动，数据量也没突然暴涨，但排序就是不稳定。</p>
<hr/>
<p>很多团队第一次意识到问题出在这里，是在定位了很久之后，才发现：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SHOW</span> <span class="hljs-keyword">FULL</span> COLUMNS <span class="hljs-keyword">FROM</span> table_name;
</code></pre>
<p>同一个字段，在不同环境里的 <code>Collation</code> 并不一样。但这一步，往往已经是事故之后的复盘动作了。</p>
<p>这一类问题的共同特点是：<strong>它不是“功能性错误”，而是“行为变化”</strong> 。而行为变化，恰恰是最难被测试覆盖的。</p>
<p>好，继续 <strong>第三章</strong>。这一章我会紧扣你给的提纲，重点放在 <strong>SQL 行为变严格带来的真实冲击</strong>，而不是规则本身。</p>
<hr/>
<h2 data-id="heading-2">三、SQL 行为更“严格”，老 SQL 开始报错</h2>
<p>如果说字符集和排序规则的问题，还带着一点“隐蔽性”，那 SQL 模式的变化就直接多了。</p>
<p>升级到 MySQL 8 之后，很多团队第一次感受到的不是性能波动，而是：<strong>系统直接起不来了</strong>。</p>
<p>错误日志里往往是类似这样的信息：</p>
<pre><code class="hljs language-sql" lang="sql">Expression #<span class="hljs-number">1</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">SELECT</span> list <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> clause
<span class="hljs-keyword">and</span> <span class="hljs-keyword">contains</span> nonaggregated <span class="hljs-keyword">column</span> ...
</code></pre>
<p>这类报错在 5.7 时代并不是不存在，只是大多数时候，它们被默认配置“放过了”。</p>
<hr/>
<p>最典型的，就是 <code>ONLY_FULL_GROUP_BY</code>。</p>
<p>这个模式在 5.7 里就已经存在，但在很多系统里：</p>
<ul>
<li>要么被关掉</li>
<li>要么从来没被认真对待</li>
</ul>
<p>原因也很现实。不少业务 SQL 写得很早，逻辑又复杂，改起来风险极高。只要能跑，大家就默认“问题不大”。升级到 MySQL 8 后，这种侥幸心理第一次被正面击穿。一条以前能正常返回结果的 SQL，现在直接拒绝执行：</p>
<pre><code class="hljs language-vbnet" lang="vbnet"><span class="hljs-keyword">SELECT</span> user_id, create_time
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span>
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> user_id;
</code></pre>
<p>在旧环境里，它会返回一条看起来“还算合理”的数据。但从语义上说，这条 SQL 本来就没有定义清楚：一个 <code>user_id</code> 对应多条记录时，<code>create_time</code> 到底是哪一条？</p>
<p>MySQL 8 选择不再替你做这个决定。</p>
<hr/>
<p>很多人第一反应是“数据库太死板了”。但当你真的回到业务语义上看，会发现这些 SQL 暴露出来的，往往不是数据库问题，而是<strong>设计阶段被忽略的选择</strong>。</p>
<p>是要最早的一条？还是最新的一条？还是某种业务规则下的那一条？</p>
<p>这些问题，5.7 时代被数据库“帮你猜了”，而 8.0 要你自己说清楚。</p>
<hr/>
<p>另一类影响更隐蔽，但后果同样真实的变化，是隐式类型转换变少了。在老系统里，这种 SQL 非常常见：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span> <span class="hljs-keyword">WHERE</span> user_id <span class="hljs-operator">=</span> <span class="hljs-string">'123'</span>;
</code></pre>
<p>字段是 <code>BIGINT</code>，参数是字符串。</p>
<p>5.7 时代，这基本不是问题。</p>
<p>到了 MySQL 8，这种写法依然能跑，但副作用开始显现。在一些场景下，隐式转换会导致索引无法使用，执行计划悄悄发生变化。SQL 没报错，返回也正常，但性能开始波动。更糟的是，这类问题通常不会集中爆发，而是随着数据量增长，逐渐放大。一开始只是慢一点，后来变成偶发慢 SQL，再后来就是稳定复现的性能问题。</p>
<hr/>
<p>这类 SQL 的危险之处在于：<strong>它们看起来很“正常”</strong> 。代码里到处都是，测试环境也跑得飞快，直到某一天在生产环境被数据量放大，才开始显形。而 MySQL 8 在这里的态度非常明确：它不是在“变难用”，而是在<strong>减少对坏 SQL 的容忍度</strong>。</p>
<p>以前你写得不够严谨，数据库帮你兜底；现在兜底逻辑在收紧，问题自然就浮上来了。</p>
<hr/>
<p>很多升级事故，表面上是“数据库升级失败”，实际上是<strong>多年积累下来的 SQL 设计问题，被一次性曝光</strong>。</p>
<p>而真正让人头疼的还在后面。即使你的 SQL 语义是正确的、写法是规范的，到了 MySQL 8，执行计划本身，也可能不再按你“熟悉的方式”工作。</p>
<h2 data-id="heading-3">四、执行计划更聪明，但也更“不可预测”</h2>
<p>真正让团队开始不安的，往往不是升级当天的报错，而是上线一段时间之后出现的性能波动。</p>
<p>SQL 没改。索引没动。数据增长也在预期范围内。</p>
<p>但某几条核心查询开始变慢，而且慢得不稳定。</p>
<hr/>
<p>很多人第一反应是去看 <code>EXPLAIN</code>。结果更让人困惑。</p>
<p>在 MySQL 8 里，同一条 SQL 的执行计划，看起来反而比 5.7 更“合理”：</p>
<ul>
<li>用了看起来更合适的索引</li>
<li>访问行数更少</li>
<li>成本估算也更低</li>
</ul>
<p>但真实执行时间，就是慢。这类问题的根源，往往来自 MySQL 8 引入的新成本模型。</p>
<hr/>
<p>MySQL 8 对执行计划的选择，比 5.7 更依赖统计信息和代价估算。它会更积极地尝试不同索引路径，而不是像以前那样“走熟路”。</p>
<p>这意味着一件事：<strong>你以前“记住的经验”，在 8.x 里开始失效了。</strong></p>
<p>在 5.7 时代，很多人对执行计划有一种直觉：这条 SQL，大概一定会走这个索引。到了 8.0，这种确定性被打破了。</p>
<hr/>
<p>一个非常常见的现象是，同一条 SQL，在不同时间段走不同索引。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span>
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
  <span class="hljs-keyword">AND</span> create_time <span class="hljs-operator">&gt;</span> <span class="hljs-string">'2024-01-01'</span>
<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>
LIMIT <span class="hljs-number">20</span>;
</code></pre>
<p>在 5.7 下，它可能长期稳定地走 <code>(status, create_time)</code> 这个联合索引。</p>
<p>到了 8.0，有时会选择另一个单列索引，<code>EXPLAIN</code> 看起来也说得过去，但真实扫描行数明显增多。</p>
<p>问题在于：<strong>执行计划的选择，不再是你能轻易预测的结果。</strong></p>
<hr/>
<p>更隐蔽的一类坑，来自索引“看起来存在，但实际上没被用上”。MySQL 8 支持了函数索引，这是一个被很多人高估、也容易被误用的特性。有些团队在升级后，会主动把一些计算逻辑塞进索引里，比如：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> INDEX idx_day <span class="hljs-keyword">ON</span> <span class="hljs-keyword">order</span> ((<span class="hljs-type">DATE</span>(create_time)));
</code></pre>
<p>然后写出这样的 SQL：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span>
<span class="hljs-keyword">WHERE</span> <span class="hljs-type">DATE</span>(create_time) <span class="hljs-operator">=</span> <span class="hljs-string">'2024-06-01'</span>;
</code></pre>
<p>逻辑上看起来很完美。但在真实环境里，这类索引并不总是像你想象中那样生效，尤其是在排序规则、时区、隐式转换掺杂进来之后，执行计划很容易发生偏移。</p>
<hr/>
<p>还有一类更难察觉的问题，来自字符集和排序规则对索引的影响。在 MySQL 8 中，如果查询条件和索引列的 <code>collation</code> 不一致，即使字段名和类型完全相同，索引也可能被放弃。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">user</span>
<span class="hljs-keyword">WHERE</span> nickname <span class="hljs-operator">=</span> <span class="hljs-string">'张三'</span>;
</code></pre>
<p>当这个条件在不同连接、不同会话参数下执行时，走不走索引，可能完全不同。这类问题在 5.7 中不太常见，但在 8.0 里，出现频率明显更高。</p>
<hr/>
<p>最后一个让人头疼的现象，是“突然变慢，又突然恢复”。</p>
<p>MySQL 8 的统计信息更准确，但更新策略也不同了。在某些场景下，统计信息刷新之后，执行计划发生变化，性能立刻受到影响。更魔幻的是，重启数据库之后，问题可能暂时消失。</p>
<p>这类问题往往不是 bug，而是 <strong>统计信息、成本模型和真实数据分布之间的博弈</strong>。</p>
<hr/>
<h2 data-id="heading-4">五、窗口函数 / CTE：用对是神器，用错是性能杀手</h2>
<p>MySQL 8 真正让人产生“这是个新数据库了”这种感觉，往往不是前面的严格模式，而是窗口函数和 CTE 的出现。它们太好写了。</p>
<p>以前要靠子查询、临时表、甚至多次查询才能拼出来的结果，现在一条 SQL 就能搞定，结构清晰，可读性也极高。问题在于：<strong>好写，并不等于好跑</strong>。</p>
<hr/>
<p>很多人第一次用窗口函数，都是拿它来“替代 group by”。比如做排行榜、去重、取每组最新一条记录，很自然就会写出这样的 SQL：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>,
         <span class="hljs-built_in">ROW_NUMBER</span>() <span class="hljs-keyword">OVER</span> (<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> user_id <span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> create_time <span class="hljs-keyword">DESC</span>) <span class="hljs-keyword">AS</span> rn
  <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span>
) t
<span class="hljs-keyword">WHERE</span> rn <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>逻辑完全正确，结果也没问题。但当这条 SQL 跑在真实业务数据上时，问题才开始显现。</p>
<p>窗口函数的计算，是在<strong>结果集层面</strong>完成的。这意味着，在 <code>ROW_NUMBER</code> 生效之前，参与计算的数据已经被全部扫描、排序、分组。</p>
<p>数据量小的时候感觉不到，一旦表规模上来，执行成本会非常直接地反映在响应时间上。这类 SQL 的危险在于：<strong>你很难通过直觉判断它的复杂度</strong>。</p>
<hr/>
<p>另一个被严重误解的，是 CTE（WITH）。在很多人的认知里，CTE 就是“更优雅的临时表”。于是会写出结构非常漂亮的 SQL：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">WITH</span> recent_order <span class="hljs-keyword">AS</span> (
  <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
  <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">order</span>
  <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-operator">&gt;</span> NOW() <span class="hljs-operator">-</span> <span class="hljs-type">INTERVAL</span> <span class="hljs-number">7</span> <span class="hljs-keyword">DAY</span>
)
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span>
<span class="hljs-keyword">FROM</span> recent_order
<span class="hljs-keyword">WHERE</span> status <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;
</code></pre>
<p>从可读性上说，这比嵌套子查询舒服太多。但在 MySQL 8 中，CTE 默认是<strong>非物化的</strong>。也就是说，它不是先算一次结果再复用，而是可能在执行过程中被多次展开、重复计算。当 CTE 被引用多次，或者嵌套进更复杂的查询里时，执行次数会迅速放大。</p>
<p>“写得很干净，但跑得很慢”，通常就出现在这里。</p>
<hr/>
<p>真正的问题并不是窗口函数和 CTE 本身，而是 <strong>它们让“复杂 SQL”变得过于容易书写</strong>。</p>
<p>在 5.7 时代，很多性能风险被写法本身挡住了。SQL 写得难，反而逼着你在设计阶段多想一步。</p>
<p>到了 8.0，这些约束消失了。你可以很快写出一条语义完整、结构优雅的 SQL，但是否适合在高并发、海量数据下执行，完全是另一回事。</p>
<hr/>
<p>不少团队在升级到 MySQL 8 之后，会不自觉地“重构 SQL”，把原本分散在应用层的逻辑，收拢进数据库里。这本身并不一定是坏 hookup，但如果缺乏对执行成本的判断，窗口函数和 CTE 会成为非常隐蔽的性能放大器。而它们一旦进入核心链路，排查难度会比普通慢 SQL 高很多。</p>
<hr/>
<h2 data-id="heading-5">六、隐藏很深的一类坑：系统表 &amp; 权限模型变化</h2>
<p>如果说前面的坑，多少还能通过业务现象慢慢暴露出来，那系统表和权限模型的变化，往往是<strong>升级当天就出问题感觉</strong>。</p>
<p>而且非常直接：脚本跑不通、工具连不上、应用账号突然没权限。</p>
<hr/>
<p>MySQL 8 对 <code>mysql</code> 库做了比较彻底的调整。在 5.7 时代，很多运维脚本、监控工具，甚至应用初始化逻辑，都会直接去查系统表。在 5.7 里，这是很常见、也很自然的做法。</p>
<p>比如：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">user</span>, host <span class="hljs-keyword">FROM</span> mysql.user;
</code></pre>
<p>到了 MySQL 8，这类查询要么直接失败，要么返回结果和你预期的不一样。原因并不复杂：系统表结构被重构了，权限模型也随之调整，官方更希望你通过 <code>information_schema</code> 或专用视图来获取信息。问题在于，<strong>历史工具并不知道这件事</strong>。</p>
<hr/>
<p>这类问题经常出现在两个地方：</p>
<p>一是老的运维脚本。数据库升级了，脚本没动，结果第一天定时任务就开始报错。</p>
<p>二是第三方工具。监控、备份、审计、权限管理工具，如果版本不够新，很容易在 MySQL 8 上直接失效。</p>
<p>这种问题的定位过程通常非常低效，因为报错信息往往不指向“系统表变了”，而只是权限不足或者字段不存在。</p>
<hr/>
<p>权限模型的变化，比系统表更容易引发事故。MySQL 8 把权限拆得更细了，逻辑上更清晰，但配置成本也明显提高。一个在 5.7 里能正常工作的应用账号，迁移到 8.0 之后，可能会出现各种“奇怪的失败”：</p>
<ul>
<li>能连上库，但查不了表</li>
<li>能查表，但执行不了某些语句</li>
<li>在某些环境正常，在另一些环境直接报权限错误</li>
</ul>
<p>很多时候，并不是权限给少了，而是<strong>给错了位置</strong>。</p>
<hr/>
<p>更现实的问题是，“最小权限原则”在 MySQL 8 里反而更难落地。以前你可能直接给一个账号比较宽的权限，事情就结束了。现在权限粒度细了，角色、默认权限、动态权限一起上，稍有疏忽就会遗漏关键能力。而这些问题，大多数不会在测试阶段暴露，因为测试环境的账号往往权限更宽。等到生产切换时，问题才集中出现。</p>
<hr/>
<p>这一类坑有一个共同特点：<strong>它们几乎和业务无关，但能直接影响业务是否可用</strong>。很多升级事故，并不是 SQL 写错、索引没建，而是一些看似“外围”的东西没跟上。而真正让升级过程变得可控的，往往不是多看几篇文档，而是<strong>升级姿势本身是否正确</strong>。</p>
<hr/>
<h2 data-id="heading-6">七、生产升级 MySQL 8，真正靠谱的姿势</h2>
<p>如果前面那些坑已经看得差不多了，其实会自然得出一个结论： <strong>MySQL 8 的升级，不是一个“点升级”，而是一次系统性迁移。</strong></p>
<p>也正因为这样，最不靠谱的做法，反而是很多人下意识会选的那种。</p>
<hr/>
<p>最需要明确的一件事是：<strong>不要对生产库做 in-place 升级。</strong></p>
<p>理论上可行，文档也支持，但现实中，一旦出问题，几乎没有回旋空间。</p>
<p>升级过程中一旦发现排序异常、SQL 报错、性能不符合预期，你能做的选择非常有限。回滚成本高，窗口期短，所有风险都被压缩到一次操作里。</p>
<p>真正可控的方式，反而显得“笨”一些：逻辑备份 → 新实例恢复 → 应用灰度切换。</p>
<p>这个过程看起来繁琐，但它给了你一个非常关键的能力：<strong>随时停下来观察系统行为</strong>。</p>
<hr/>
<p>在真正切流量之前，有几件事是绕不开的。</p>
<h3 data-id="heading-7">1. SQL 模式检查。</h3>
<p>不要等报错再去改 SQL。在升级前，把生产库当前的 SQL 模式拉出来，对照 MySQL 8 的默认配置，把会被卡住的语句提前找出来。哪怕只是统计一下 <code>ONLY_FULL_GROUP_BY</code> 相关的报错数量，都会比上线后手忙脚乱强得多。</p>
<p>可以在 <strong>测试环境的 MySQL 5.7</strong> 上，<strong>主动打开 MySQL 8 的严格模式</strong>：</p>
<pre><code class="hljs language-ini" lang="ini">SET GLOBAL <span class="hljs-attr">sql_mode</span> =
'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO'<span class="hljs-comment">;</span>
</code></pre>
<hr/>
<h3 data-id="heading-8">2. 执行计划对比。</h3>
<p>不要只在 8.0 环境里看 <code>EXPLAIN</code>，要拿同一条 SQL，在 5.7 和 8.0 里同时跑。</p>
<p>重点不是“哪个看起来更优雅”，而是：<strong>哪些 SQL 的执行路径发生了变化</strong>。</p>
<p>这一步做完，往往能提前锁定那一小撮“未来一定会出问题”的查询。</p>
<hr/>
<h3 data-id="heading-9">3. 扫描字符集和排序规则。</h3>
<p>直接查找表的元数据：</p>
<pre><code class="hljs language-ini" lang="ini">SELECT
  TABLE_SCHEMA,
  TABLE_NAME,
  COLUMN_NAME,
  CHARACTER_SET_NAME,
  COLLATION_NAME
FROM information_schema.COLUMNS
WHERE <span class="hljs-attr">TABLE_SCHEMA</span> = <span class="hljs-string">'your_db'</span><span class="hljs-comment">;</span>
​
</code></pre>
<p>不是解释规则，而是找不一致。哪些表、哪些字段，在不同环境里 <code>charset</code> 或 <code>collation</code> 不一样；哪些历史表是旧规则，新表是新规则。</p>
<p>这些差异，短期内可能没事，但它们几乎一定会在某个时间点爆出来。</p>
<hr/>
<h3 data-id="heading-10">4. 检查索引长度和索引使用情况。</h3>
<p>提前在 8.x 实例里跑建表 / 建索引脚本，同时用<code>show index</code>语句对比，特别注意一下几个问题：</p>
<ul>
<li><code>varchar</code> 较长的索引</li>
<li>联合索引里包含字符串字段的</li>
<li>曾经“刚好能建出来”的索引</li>
</ul>
<p>MySQL 8 对这些地方的容忍度更低，而索引一旦发生变化，影响的通常是核心查询。</p>
<hr/>
<h3 data-id="heading-11">5. 线上真实压测</h3>
<p>最后一件，也是最容易被低估的一件： <strong>关键 SQL 的真实压测。</strong></p>
<p>不是跑跑接口，而是针对最重的那几条 SQL，在接近真实数据量的情况下，单独压。很多 MySQL 8 的问题，只会在数据规模上来之后才出现。你真正要做的，是： 服务端先升级 MySQL 驱动 → 同时连 5.7 和 8.x → 做对比压测</p>
<p><strong>不建议</strong>把 <strong>8.x 当 5.7 的从库</strong> 来承担这一步的核心验证。8.x 从 5.7 拉数据可以做，但它<strong>不能替代压测</strong>。</p>
<hr/>
<p>真正切到 MySQL 8 之后，第一周要盯的东西，其实也很明确。</p>
<p>慢 SQL 是最直观的信号。排序异常往往藏在业务反馈里。错误日志里出现的“以前从没见过的报错”，几乎都值得认真看一眼。</p>
<p>这一周不是为了“证明升级成功”，而是为了确认：<strong>有没有什么被你低估的变化，正在悄悄发生。</strong></p>
<hr/>
<p>走到这一步，其实已经能感觉出来了：MySQL 8 的升级，从来不是一个“技术动作”，而更像一次<strong>使用方式的切换</strong>。</p>
<hr/>
<h2 data-id="heading-12">八、MySQL 8 不是“新版本”，而是“新阶段”</h2>
<p>如果只是把 MySQL 8 当成一个“功能更多、规则更严”的版本，其实很容易产生误判。因为从使用体验上看，很多变化并不体现在新特性，而体现在<strong>旧习惯开始失效</strong>。</p>
<p>以前你可以写一条语义不完整的 SQL，数据库会帮你选一个“差不多能用”的结果；以前你可以默认排序是稳定的；以前你可以混着类型比、靠隐式转换走索引。</p>
<p>这些并不是能力，而是一种长期存在的宽容。MySQL 8 做的事情，其实很明确：它在逐步收回这种宽容。</p>
<hr/>
<p>从这个角度看，很多所谓的“升级踩坑”，并不是因为 MySQL 8 引入了问题，而是它<strong>不再替你掩盖问题</strong>。</p>
<p>字符集和排序规则暴露的是历史数据和新规则之间的不一致；严格 SQL 模式暴露的是语义模糊的查询；更激进的优化器暴露的是对执行计划的过度依赖；窗口函数和 CTE 暴露的是把复杂度一股脑推给数据库的冲动。</p>
<p>这些问题，在 5.7 时代并不是不存在，只是被时间和默认行为暂时压住了。</p>
<hr/>
<p>某种意义上，MySQL 8 更像是 MySQL 从“工具型数据库”走向“工程级数据库”的分水岭。</p>
<p>它开始假设：</p>
<ul>
<li>你知道自己在写什么</li>
<li>你能为 SQL 的语义负责</li>
<li>你会为执行成本买单</li>
</ul>
<p>这对团队的要求更高，但也更真实。</p>
<hr/>
<p>所以回头再看“要不要升级 MySQL 8”这个问题，本身就有点站不住脚。</p>
<p>真正的问题不是：<strong>MySQL 8 会不会坑我？</strong></p>
<p>而是：<strong>我现在这套 SQL 和数据模型，配不配得上一个不再兜底的数据库？</strong></p>
<p>升级之后，你可能不会立刻得到“更快”的系统，但你一定会更早看见问题。而能更早看见问题，本身就是一种优势。</p>
<p>升级 MySQL 8，真正要升级的，从来不只是数据库，而是我们对 SQL 的敬畏。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解码RAG之心，为什么向量数据库是其核心引擎]]></title>    <link>https://juejin.cn/post/7599088558167310382</link>    <guid>https://juejin.cn/post/7599088558167310382</guid>    <pubDate>2026-01-26T03:12:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599088558167310382" data-draft-id="7599181528303927305" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解码RAG之心，为什么向量数据库是其核心引擎"/> <meta itemprop="keywords" content="人工智能"/> <meta itemprop="datePublished" content="2026-01-26T03:12:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="smallyoung"/> <meta itemprop="url" content="https://juejin.cn/user/4373200861407227"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解码RAG之心，为什么向量数据库是其核心引擎
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4373200861407227/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    smallyoung
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:12:48.000Z" title="Mon Jan 26 2026 03:12:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读16分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21aeb07f83794894be2e8747fb63f616~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=%2BhkjnGhVZ0VD75lJnCxkUJs68xs%3D" alt="为什么 RAG 要使用向量数据库" loading="lazy"/></p>
<h2 data-id="heading-0">1. 先问问题：RAG 到底需要什么能力？</h2>
<p>在讲向量数据库之前，我们先思考一个问题：</p>
<blockquote>
<p><strong>RAG 系统的核心需求是什么？</strong></p>
</blockquote>
<p>RAG（Retrieval-Augmented Generation，检索增强生成）的工作流程可以简化为：</p>
<pre><code class="hljs">用户问题 → 【在知识库中找到相关内容】 → 把内容给 LLM → 生成答案
</code></pre>
<p>关键在于中间那一步：<strong>如何在知识库中找到"真正相关"的内容？</strong></p>
<h3 data-id="heading-1">1.1 两种搜索方式的对比</h3>

























<table><thead><tr><th>用户问题</th><th>传统关键词搜索</th><th>理想的语义搜索</th></tr></thead><tbody><tr><td>"AI 是什么？"</td><td>只能找到包含"AI"两个字母的文档</td><td>能找到"人工智能"、"机器学习"相关文档</td></tr><tr><td>"苹果公司市值"</td><td>可能匹配到"苹果营养价值"</td><td>只匹配科技公司相关内容</td></tr><tr><td>"手机卡顿怎么办"</td><td>找不到"设备性能优化指南"</td><td>能理解这是同一个问题</td></tr></tbody></table>
<p><strong>结论</strong>：RAG 需要的是<strong>语义搜索</strong>——理解问题的"含义"，而不是匹配字面关键词。</p>
<h3 data-id="heading-2">1.2 核心问题</h3>
<blockquote>
<p><strong>问题</strong>：传统数据库（MySQL、PostgreSQL）只能做关键词匹配，无法理解语义。那怎么实现语义搜索呢？</p>
<p><strong>答案</strong>：先把文本转成向量（Embedding），然后用向量数据库做相似度搜索。</p>
</blockquote>
<p>这就是 RAG 必须使用向量数据库的根本原因。</p>
<p>接下来，我们一步步解释：什么是向量？什么是 Embedding？相似度搜索是怎么回事？</p>
<h2 data-id="heading-3">2. 什么是向量？</h2>
<p>要理解向量数据库，首先要理解最基础的概念：<strong>向量</strong>。</p>
<h3 data-id="heading-4">2.1 向量的直观定义</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c1fe8708855c42eaa6202d3d364602a6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=1P0QAV8e1Lh8ZKLOiih07a8buqU%3D" alt="万物皆可向量化" loading="lazy"/></p>
<p><strong>向量就是一组有序的数字</strong>。就这么简单。</p>
<pre><code class="hljs language-scss" lang="scss">向量例子：
<span class="hljs-selector-attr">[3, 4]</span>
<span class="hljs-selector-attr">[0.5, 0.8, 0.2]</span>
<span class="hljs-selector-attr">[0.23, -0.15, 0.87, 0.42, ..., 0.31]</span>  (可能有几百上千个数字)
</code></pre>
<p>你可以把向量想象成<strong>描述一个东西的"特征列表"</strong>：</p>

























<table><thead><tr><th>现实场景</th><th>向量表示</th><th>含义</th></tr></thead><tbody><tr><td>地图坐标</td><td>[120.5, 31.2]</td><td>经度 120.5°，纬度 31.2°</td></tr><tr><td>RGB 颜色</td><td>[255, 0, 0]</td><td>红色分量 255，绿色 0，蓝色 0（纯红色）</td></tr><tr><td>学生成绩</td><td>[85, 92, 78]</td><td>语文 85，数学 92，英语 78</td></tr></tbody></table>
<blockquote>
<p>[!NOTE]
<strong>关键概念</strong>：向量的<strong>维度</strong>就是数字的个数。[3, 4] 是 2 维向量，[85, 92, 78] 是 3 维向量。后面你会看到，Embedding 模型通常生成 768~3072 维的向量。</p>
</blockquote>
<h3 data-id="heading-5">2.2 向量的几何意义</h3>
<p><strong>向量可以看作空间中的一个"点"</strong>。</p>
<p>以 2 维向量为例：</p>
<ul>
<li>向量 A = [3, 4] → 在平面上就是坐标 (3, 4) 的点</li>
<li>向量 B = [4, 3] → 在平面上就是坐标 (4, 3) 的点</li>
</ul>
<p>两个点之间可以计算<strong>距离</strong>——距离越近，表示它们越"相似"。</p>
<p>这个简单的数学原理，就是向量数据库能够实现"相似搜索"的基础！</p>
<h2 data-id="heading-6">3. 什么是 Embedding？</h2>
<p>现在问题来了：<strong>文本不是数字，怎么变成向量？</strong></p>
<p>答案是：使用 <strong>Embedding（嵌入）模型</strong>。</p>
<h3 data-id="heading-7">3.1 Embedding 的核心思想</h3>
<p><strong>Embedding = 把任意内容（文本、图片、音频）转换成向量的技术</strong>。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart LR
    A["文本: 我喜欢吃苹果"] --&gt; B[Embedding 模型]
    B --&gt; C["向量: [0.23, -0.15, 0.87, ...]"]
</code></pre>
<p>以文本为例：</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 伪代码演示</span>
<span class="hljs-keyword">from</span> openai <span class="hljs-keyword">import</span> OpenAI
client = OpenAI()

text = <span class="hljs-string">"我喜欢吃苹果"</span>
response = client.embeddings.create(<span class="hljs-built_in">input</span>=text, model=<span class="hljs-string">"text-embedding-3-small"</span>)
vector = response.data[<span class="hljs-number">0</span>].embedding

<span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(vector))  <span class="hljs-comment"># 输出：1536（这就是向量的维度）</span>
<span class="hljs-built_in">print</span>(vector[:<span class="hljs-number">5</span>])   <span class="hljs-comment"># 输出：[0.023, -0.156, 0.087, 0.421, -0.089]</span>
</code></pre>
<h3 data-id="heading-8">3.2 Embedding 的神奇之处</h3>
<p>Embedding 模型经过大量数据训练后，学会了一个惊人的能力：</p>
<blockquote>
<p><strong>语义相近的文本，会被映射到向量空间中相近的位置。</strong></p>
</blockquote>
<p>举一个具体例子：</p>

























<table><thead><tr><th>文本</th><th>向量（简化示意）</th><th>与"我喜欢吃苹果"的距离</th></tr></thead><tbody><tr><td>"我喜欢吃苹果"</td><td>[0.8, 0.2, 0.1, ...]</td><td>0（自己）</td></tr><tr><td>"我爱吃水果"</td><td>[0.75, 0.25, 0.12, ...]</td><td><strong>0.05</strong>（非常近！语义相似）</td></tr><tr><td>"今天天气真好"</td><td>[0.1, 0.6, 0.9, ...]</td><td><strong>0.89</strong>（很远，语义不同）</td></tr></tbody></table>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph 语义空间示意
        A["我喜欢吃苹果 ●"] --- B["我爱吃水果 ●"]
        C["今天天气真好 ○"]
    end
    
    style A fill:#e3f2fd
    style B fill:#e3f2fd
    style C fill:#ffebee
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6b1de5df1f074aa0889bd82b93fb2024~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=IGnqclrKIVR1oxDimiJDckB1bI0%3D" alt="Embedding 的核心思想" loading="lazy"/></p>
<blockquote>
<p>[!IMPORTANT]
<strong>核心公式</strong>：Embedding 的本质是一个函数 <code>f(text) → vector</code>，它把文本映射到高维空间，使得<strong>语义相似的文本在空间中距离更近</strong>。这是 RAG 能够"理解语义"的根本原理。</p>
</blockquote>
<h3 data-id="heading-9">3.3 为什么 Embedding 能捕捉语义？</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/957779f2ec334e2fb4ad17332dd0388c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=6hgL%2BCTiv1lL79r93Le5Mi3ByTY%3D" alt="为什么 Embedding 能捕捉语义" loading="lazy"/></p>
<p>Embedding 模型（如 BERT、GPT）是通过<strong>海量文本数据训练</strong>出来的。</p>
<p>训练过程中，模型学习到：</p>
<ul>
<li>"苹果"和"水果"经常出现在相似的语境中</li>
<li>"喜欢"和"爱"表达相似的情感</li>
<li>因此它们的向量应该相近</li>
</ul>
<p>这就像一个读过几百亿本书的人，自然理解了词语之间的关系。</p>
<h3 data-id="heading-10">3.4 更直观的类比：Embedding 在学什么？</h3>
<p>想象你是一个读了几百亿本书的人：</p>
<ul>
<li>当你看到"苹果公司"，你会联想到：科技、iPhone、硅谷</li>
<li>当你看到"吃苹果"，你会联想到：水果、健康、营养</li>
</ul>
<p>虽然都有"苹果"两个字，但你的大脑会把它们放在完全不同的"概念区域"。</p>
<p><strong>Embedding 模型做的就是同样的事情</strong>——通过阅读海量文本，学会了把：</p>
<ul>
<li>相似语境的词放在向量空间的<strong>相近位置</strong></li>
<li>不同语境的同一个词放在<strong>不同位置</strong></li>
</ul>
<blockquote>
<p>[!TIP]
<strong>一句话总结</strong>：Embedding 不是简单的"翻译"，而是把文本的"意思"编码成了向量空间中的"位置"。</p>
</blockquote>
<h2 data-id="heading-11">4. 主流 Embedding 模型与向量维度</h2>
<p>不同的 Embedding 模型生成的向量维度不同。<strong>维度越高，通常能捕捉越丰富的语义信息，但也需要更多存储空间和计算资源</strong>。</p>
<h3 data-id="heading-12">4.1 主流 Embedding 模型对比（2024）</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/21d00554260849848546a230073262b2~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=C0ESxUvBjB%2FopZ36jBkiLj6NycU%3D" alt="模型对比" loading="lazy"/></p>

























































































<table><thead><tr><th>厂商</th><th>模型名称</th><th>向量维度</th><th>特点</th></tr></thead><tbody><tr><td><strong>OpenAI</strong></td><td>text-embedding-3-small</td><td>1536 维</td><td>性价比高，支持动态降维到 512 维</td></tr><tr><td><strong>OpenAI</strong></td><td>text-embedding-3-large</td><td>3072 维</td><td>最高精度，支持降维到 256/1024 维</td></tr><tr><td><strong>OpenAI</strong></td><td>text-embedding-ada-002</td><td>1536 维</td><td>上一代模型，仍广泛使用</td></tr><tr><td><strong>BAAI</strong></td><td>BGE-large-zh-v1.5</td><td>1024 维</td><td>中文最佳开源模型之一</td></tr><tr><td><strong>BAAI</strong></td><td>BGE-M3</td><td>1024 维</td><td>多语言、多功能</td></tr><tr><td><strong>Cohere</strong></td><td>Embed English v3</td><td>1024 维</td><td>企业级英文模型</td></tr><tr><td><strong>Cohere</strong></td><td>Embed v4</td><td>1536 维</td><td>最新多模态模型</td></tr><tr><td><strong>Jina AI</strong></td><td>jina-embeddings-v3</td><td>1024 维</td><td>支持 8K 长文本，可降维到 32 维</td></tr><tr><td><strong>Jina AI</strong></td><td>jina-embeddings-v2-base</td><td>768 维</td><td>基础版本</td></tr><tr><td><strong>Voyage AI</strong></td><td>voyage-3</td><td>1024 维</td><td>检索质量优秀</td></tr><tr><td><strong>Voyage AI</strong></td><td>voyage-3-large</td><td>2048 维</td><td>支持降维到 256/512/1024 维</td></tr><tr><td><strong>Voyage AI</strong></td><td>voyage-3-lite</td><td>512 维</td><td>轻量版，速度快</td></tr><tr><td><strong>Google</strong></td><td>Gemini text-embedding-004</td><td>768 维</td><td>Google 最新模型</td></tr></tbody></table>
<blockquote>
<p>[!TIP]
<strong>选型建议</strong>：</p>
<ul>
<li><strong>中文场景</strong>：优先考虑 BGE 系列（开源免费）或 OpenAI text-embedding-3</li>
<li><strong>英文场景</strong>：OpenAI、Cohere、Voyage AI 都是优秀选择</li>
<li><strong>成本敏感</strong>：使用支持"动态降维"的模型（如 text-embedding-3），降低存储成本</li>
</ul>
</blockquote>
<h3 data-id="heading-13">4.2 向量维度的影响</h3>









































<table><thead><tr><th>维度</th><th>单向量存储</th><th>100 万向量存储</th><th>精度</th></tr></thead><tbody><tr><td>512 维</td><td>~2 KB</td><td>~2 GB</td><td>中等</td></tr><tr><td>768 维</td><td>~3 KB</td><td>~3 GB</td><td>较高</td></tr><tr><td>1024 维</td><td>~4 KB</td><td>~4 GB</td><td>高</td></tr><tr><td>1536 维</td><td>~6 KB</td><td>~6 GB</td><td>很高</td></tr><tr><td>3072 维</td><td>~12 KB</td><td>~12 GB</td><td>最高</td></tr></tbody></table>
<h2 data-id="heading-14">5. 相似度计算：向量如何比较"像不像"？</h2>
<p>有了向量，下一步就是计算它们之间有多"相似"。</p>
<h3 data-id="heading-15">5.1 余弦相似度（Cosine Similarity）</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/efe64198d9524e13ba8e18715a95a864~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=pSLqcu7nuujC7FoXoFBB6f0w8v4%3D" alt="宇宙中的“引力”" loading="lazy"/></p>
<p><strong>余弦相似度</strong>是最常用的相似度指标，它测量两个向量<strong>方向</strong>上的相似程度。</p>
<pre><code class="hljs language-css" lang="css">余弦相似度 = cos(θ) = (<span class="hljs-selector-tag">A</span> · <span class="hljs-selector-tag">B</span>) / (|<span class="hljs-selector-tag">A</span>| × |<span class="hljs-selector-tag">B</span>|)

其中：
- <span class="hljs-selector-tag">A</span> · <span class="hljs-selector-tag">B</span> 是向量点积（对应元素相乘再求和）
- |<span class="hljs-selector-tag">A</span>| 是向量 <span class="hljs-selector-tag">A</span> 的长度（模）
- θ 是两个向量的夹角
</code></pre>
<p><strong>直观理解</strong>：</p>

























<table><thead><tr><th>余弦值</th><th>夹角</th><th>含义</th></tr></thead><tbody><tr><td>1</td><td>0°</td><td>方向完全相同，最相似</td></tr><tr><td>0</td><td>90°</td><td>完全正交，不相关</td></tr><tr><td>-1</td><td>180°</td><td>方向完全相反</td></tr></tbody></table>
<h3 data-id="heading-16">5.2 实际计算示例</h3>
<p>假设有两个简化的 3 维向量：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">A</span> = <span class="hljs-selector-attr">[1, 2, 3]</span>
<span class="hljs-selector-tag">B</span> = <span class="hljs-selector-attr">[2, 4, 6]</span>

计算步骤：
<span class="hljs-number">1</span>. 点积：<span class="hljs-selector-tag">A</span> · <span class="hljs-selector-tag">B</span> = <span class="hljs-number">1</span>×<span class="hljs-number">2</span> + <span class="hljs-number">2</span>×<span class="hljs-number">4</span> + <span class="hljs-number">3</span>×<span class="hljs-number">6</span> = <span class="hljs-number">2</span> + <span class="hljs-number">8</span> + <span class="hljs-number">18</span> = <span class="hljs-number">28</span>
<span class="hljs-number">2</span>. <span class="hljs-selector-tag">A</span> 的长度：|<span class="hljs-selector-tag">A</span>| = √(<span class="hljs-number">1</span>² + <span class="hljs-number">2</span>² + <span class="hljs-number">3</span>²) = √<span class="hljs-number">14</span> ≈ <span class="hljs-number">3.74</span>
<span class="hljs-number">3</span>. <span class="hljs-selector-tag">B</span> 的长度：|<span class="hljs-selector-tag">B</span>| = √(<span class="hljs-number">2</span>² + <span class="hljs-number">4</span>² + <span class="hljs-number">6</span>²) = √<span class="hljs-number">56</span> ≈ <span class="hljs-number">7.48</span>
<span class="hljs-number">4</span>. 余弦相似度 = <span class="hljs-number">28</span> / (<span class="hljs-number">3.74</span> × <span class="hljs-number">7.48</span>) ≈ <span class="hljs-number">1.0</span>
</code></pre>
<p>结果为 1.0，说明 A 和 B <strong>完全相似</strong>（其实 B = 2×A，方向完全一致）。</p>
<blockquote>
<p>[!NOTE]
<strong>为什么用余弦而不是直接比较数字？</strong></p>
<p>余弦相似度<strong>忽略向量的"长度"，只关注"方向"</strong>。这正好符合我们的需求：判断语义是否相似，而不是文本长度是否相同。</p>
</blockquote>
<h2 data-id="heading-17">6. 把它们连起来：RAG 的完整工作原理</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2c414b85d719454ca1a07e20113e132f~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=S4p%2BJ18aQIAlkUn7QVMcLxBT1DY%3D" alt="完整工作流" loading="lazy"/></p>
<p>现在我们已经理解了所有基础概念，可以把它们串起来，看 RAG 是如何工作的。</p>
<h3 data-id="heading-18">6.1 RAG 的两个阶段</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TB
    subgraph 离线阶段["离线阶段：建立知识库"]
        A[原始文档] --&gt; B[切分成小块]
        B --&gt; C[Embedding 模型]
        C --&gt; D[向量]
        D --&gt; E[(向量数据库)]
    end
    
    subgraph 在线阶段["在线阶段：回答问题"]
        F[用户问题] --&gt; G[Embedding 模型]
        G --&gt; H[问题向量]
        H --&gt; I{相似度搜索}
        E --&gt; I
        I --&gt; J[Top-K 相似文档]
        J --&gt; K[拼接到 Prompt]
        K --&gt; L[LLM 生成回答]
    end
</code></pre>
<blockquote>
<p>[!NOTE]
<strong>什么是 Top-K？</strong></p>
<p>Top-K 指的是返回<strong>最相似的 K 条结果</strong>。比如 Top-3 就是返回相似度最高的 3 个文档块。</p>
<ul>
<li><strong>K 太小</strong>（如 1-2）：可能漏掉相关内容</li>
<li><strong>K 太大</strong>（如 20+）：可能引入无关噪音，浪费 Token</li>
<li><strong>常用范围</strong>：3~10，根据具体场景调优</li>
</ul>
</blockquote>
<h3 data-id="heading-19">6.2 为什么必须用向量数据库？</h3>



































<table><thead><tr><th>步骤</th><th>需要的能力</th><th>传统数据库</th><th>向量数据库</th></tr></thead><tbody><tr><td>存储 Embedding</td><td>存储高维向量（768~3072维）</td><td>❌ 不支持</td><td>✅ 原生支持</td></tr><tr><td>相似度搜索</td><td>计算余弦/欧氏距离</td><td>❌ 不支持</td><td>✅ 核心功能</td></tr><tr><td>语义匹配</td><td>理解"AI"≈"人工智能"</td><td>❌ 只能关键词</td><td>✅ 基于向量距离</td></tr><tr><td>大规模检索</td><td>亿级向量毫秒响应</td><td>❌ 性能差</td><td>✅ ANN 算法优化</td></tr></tbody></table>
<p><strong>结论</strong>：向量数据库 = Embedding 存储 + 相似度搜索 + 高效索引，这三者缺一不可，而传统数据库都不支持。</p>
<h2 data-id="heading-20">7. 文档分块（Chunking）：被忽视的关键步骤</h2>
<p>在 RAG 流程图中有一步"切分成小块"，这一步叫做 <strong>Chunking（分块）</strong>，是初学者最容易忽视但又极其重要的环节。</p>
<h3 data-id="heading-21">7.1 为什么需要分块？</h3>





















<table><thead><tr><th>原因</th><th>说明</th></tr></thead><tbody><tr><td><strong>Token 限制</strong></td><td>LLM 有上下文长度限制（如 4K、8K、128K），不能一次塞入整本书</td></tr><tr><td><strong>语义精度</strong></td><td>太长的文本向量会"稀释"语义，导致检索不精准</td></tr><tr><td><strong>检索粒度</strong></td><td>用户问的是具体问题，需要找到具体的段落而不是整篇文章</td></tr></tbody></table>
<h3 data-id="heading-22">7.2 分块策略对比</h3>



































<table><thead><tr><th>策略</th><th>方法</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>固定长度</strong></td><td>每 500 字切一块</td><td>简单易实现</td><td>可能切断句子</td></tr><tr><td><strong>按句子/段落</strong></td><td>按自然段落分割</td><td>语义完整</td><td>长度不均匀</td></tr><tr><td><strong>重叠分块</strong></td><td>相邻块有 50-100 字重叠</td><td>防止信息丢失</td><td>增加存储成本</td></tr><tr><td><strong>语义分块</strong></td><td>用模型判断语义边界</td><td>效果最好</td><td>计算成本高</td></tr></tbody></table>
<h3 data-id="heading-23">7.3 常用分块参数</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 常见的分块配置</span>
chunk_size = <span class="hljs-number">512</span>      <span class="hljs-comment"># 每块 512 个 token（约 300-400 中文字）</span>
chunk_overlap = <span class="hljs-number">50</span>    <span class="hljs-comment"># 相邻块重叠 50 个 token</span>
</code></pre>
<blockquote>
<p>[!IMPORTANT]
<strong>分块大小直接影响检索效果</strong>：</p>
<ul>
<li><strong>太小</strong>（如 100 字）：上下文不完整，LLM 无法理解</li>
<li><strong>太大</strong>（如 2000 字）：语义被稀释，检索不精准</li>
<li><strong>推荐起点</strong>：256~512 tokens，根据实际效果调优</li>
</ul>
</blockquote>
<h2 data-id="heading-24">8. 检索类型：稀疏 vs 密集 vs 混合</h2>
<p>除了本文重点讲的向量检索（密集检索），还有其他检索方式。了解它们的区别有助于在实际项目中做出更好的选择。</p>
<h3 data-id="heading-25">8.1 三种检索方式对比</h3>

































<table><thead><tr><th>类型</th><th>方法</th><th>代表算法</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong>稀疏检索</strong></td><td>关键词匹配</td><td>BM25、TF-IDF</td><td>精确匹配强、速度快</td><td>无法理解同义词</td></tr><tr><td><strong>密集检索</strong></td><td>向量相似度</td><td>Embedding</td><td>语义理解强</td><td>可能丢失精确匹配</td></tr><tr><td><strong>混合检索</strong></td><td>两者结合</td><td>Hybrid Search</td><td>兼顾精确+语义</td><td>复杂度略高</td></tr></tbody></table>
<h3 data-id="heading-26">8.2 实际案例对比</h3>
<p>用户搜索："Python 3.12 新特性"</p>

























<table><thead><tr><th>检索方式</th><th>能否找到</th></tr></thead><tbody><tr><td>稀疏检索</td><td>✅ 精确匹配 "Python 3.12"</td></tr><tr><td>密集检索</td><td>✅ 能找到语义相关的 "Python 最新版本功能"</td></tr><tr><td>稀疏检索</td><td>❌ 找不到 "Python 最新版本功能"（没有关键词匹配）</td></tr><tr><td>密集检索</td><td>⚠️ 可能漏掉必须包含 "3.12" 的精确需求</td></tr></tbody></table>
<h3 data-id="heading-27">8.3 实际生产建议</h3>
<blockquote>
<p>[!TIP]
<strong>实际项目中，混合检索（Hybrid Search）往往效果最好</strong>：</p>
<pre><code class="hljs language-scss" lang="scss">最终得分 = α × 向量相似度 + (<span class="hljs-number">1</span>-α) × BM25 分数
</code></pre>
<p>其中 α 通常设为 0.5~0.7，可根据场景调优。</p>
</blockquote>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/889ddcc1118241c49e798ced5632562a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=IYAKKCI%2FooWwjWMlEicmjYAQ68U%3D" alt="两全其美：混合检索" loading="lazy"/></p>
<h2 data-id="heading-28">9. 主流向量数据库对比（2024）</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/1bb84b3f82c844c1b668d53de8a792c0~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=2uvaE8qcF%2BA%2FE5YYGjr41G5U3Co%3D" alt="向量数据库星图" loading="lazy"/></p>
<h3 data-id="heading-29">7.1 开源向量数据库</h3>















































<table><thead><tr><th>产品</th><th>开发语言</th><th>向量规模</th><th>核心特点</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>Milvus</strong></td><td>Go/C++</td><td>万亿级</td><td>分布式架构，功能最全面，支持多向量</td><td>大规模企业级部署</td></tr><tr><td><strong>Qdrant</strong></td><td>Rust</td><td>十亿级</td><td>性能极高，元数据过滤强大</td><td>高性能搜索、边缘部署</td></tr><tr><td><strong>Weaviate</strong></td><td>Go</td><td>十亿级</td><td>AI 原生，GraphQL API，模块化强</td><td>知识图谱、复杂查询</td></tr><tr><td><strong>Chroma</strong></td><td>Python</td><td>百万级</td><td>轻量简单，5 分钟上手</td><td>原型开发、学习实验</td></tr><tr><td><strong>pgvector</strong></td><td>C</td><td>千万级</td><td>PostgreSQL 扩展，无需新增组件</td><td>已有 PG 技术栈的项目</td></tr></tbody></table>
<h3 data-id="heading-30">7.2 云托管向量数据库</h3>



































<table><thead><tr><th>产品</th><th>核心特点</th><th>定价模式</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>Pinecone</strong></td><td>全托管，开箱即用，Serverless 架构</td><td>按向量数量+查询量计费</td><td>快速上线，不想运维</td></tr><tr><td><strong>Zilliz Cloud</strong></td><td>Milvus 商业版，企业级 SLA</td><td>按资源用量计费</td><td>需要 Milvus 但不想自建</td></tr><tr><td><strong>Weaviate Cloud</strong></td><td>托管版 Weaviate</td><td>按节点计费</td><td>需要 Weaviate 特性</td></tr><tr><td><strong>Qdrant Cloud</strong></td><td>托管版 Qdrant，支持混合云</td><td>按资源计费</td><td>需要高性能+隐私保护</td></tr></tbody></table>
<h3 data-id="heading-31">9.3 向量数据库选型指南</h3>
<pre><code class="hljs language-mermaid" lang="mermaid">flowchart TD
    A[开始选型] --&gt; B{数据规模?}
    B --&gt;|&lt; 100 万| C{是否需要快速上手?}
    B --&gt;|100 万 ~ 10 亿| D{是否需要全托管?}
    B --&gt;|&gt; 10 亿| E[Milvus 分布式]
    
    C --&gt;|是| F[Chroma]
    C --&gt;|否，需要生产级| G{已有 PostgreSQL?}
    G --&gt;|是| H[pgvector]
    G --&gt;|否| I[Qdrant]
    
    D --&gt;|是| J[Pinecone / Zilliz Cloud]
    D --&gt;|否，自建| K{需要复杂查询?}
    K --&gt;|是| L[Weaviate]
    K --&gt;|否，追求性能| M[Qdrant / Milvus]
</code></pre>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da99d4b0b4fc45c5ba8c0f397ae8dad7~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=UZEQuOUdIHmGGMYYp9zoe88HEy8%3D" alt="如何选择" loading="lazy"/></p>
<h3 data-id="heading-32">9.4 各数据库性能特点</h3>





























































<table><thead><tr><th>对比维度</th><th>Milvus</th><th>Qdrant</th><th>Weaviate</th><th>Chroma</th><th>Pinecone</th></tr></thead><tbody><tr><td><strong>最大规模</strong></td><td>万亿级</td><td>十亿级</td><td>十亿级</td><td>百万级</td><td>十亿级</td></tr><tr><td><strong>查询延迟</strong></td><td>极低</td><td>极低</td><td>低</td><td>中</td><td>低</td></tr><tr><td><strong>元数据过滤</strong></td><td>✅ 优秀</td><td>✅ 最强</td><td>✅ 优秀</td><td>✅ 基础</td><td>✅ 良好</td></tr><tr><td><strong>混合搜索</strong></td><td>✅ 支持</td><td>✅ 支持</td><td>✅ 支持</td><td>❌ 有限</td><td>✅ 支持</td></tr><tr><td><strong>运维复杂度</strong></td><td>高</td><td>中</td><td>中</td><td>低</td><td>无（托管）</td></tr><tr><td><strong>开源/商业</strong></td><td>开源</td><td>开源</td><td>开源</td><td>开源</td><td>商业</td></tr></tbody></table>
<h2 data-id="heading-33">10. 向量数据库如何实现高效搜索？</h2>
<p>当你有 1 亿个向量时，如何在毫秒内找到最相似的 K 个？</p>
<h3 data-id="heading-34">8.1 暴力搜索的问题</h3>
<p>最简单的方法：和每个向量都算一遍相似度，然后排序。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 暴力搜索（伪代码）</span>
similarities = []
<span class="hljs-keyword">for</span> doc_vector <span class="hljs-keyword">in</span> all_vectors:  <span class="hljs-comment"># 1亿次循环！</span>
    sim = cosine_similarity(query_vector, doc_vector)
    similarities.append(sim)
    
top_k = <span class="hljs-built_in">sorted</span>(similarities)[:k]
</code></pre>
<p><strong>问题</strong>：1 亿向量 × 1024 维 × 相似度计算 = <strong>几十秒甚至几分钟</strong>。用户等不起！</p>
<h3 data-id="heading-35">8.2 ANN 算法：近似但快速</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/393685a0893e4bc8b3ed7f4c63da8e7d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=usRUlP4XpNlyxIzZUFD%2BgnSQ0v8%3D" alt="毫秒级响应的密码" loading="lazy"/></p>
<p>向量数据库使用 <strong>ANN（Approximate Nearest Neighbor，近似最近邻）</strong> 算法。</p>
<p>核心思想：<strong>不需要找到绝对最相似的，找到足够相似的就行</strong>。</p>
<p>用一个生活类比：</p>
<blockquote>
<p>你要在图书馆找一本关于"机器学习"的书。</p>
<p><strong>暴力搜索</strong>：翻遍图书馆每一本书，比较相关性。<br/>
<strong>ANN 搜索</strong>：先去"计算机科学"区，再去"人工智能"架，然后在这个小范围内找。</p>
</blockquote>
<h3 data-id="heading-36">8.3 HNSW 算法（最流行）</h3>
<p><strong>HNSW（Hierarchical Navigable Small World）</strong> 是目前最广泛使用的索引算法，由 Malkov 和 Yashunin 于 2016 年提出（<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F1603.09320" target="_blank" title="https://arxiv.org/abs/1603.09320" ref="nofollow noopener noreferrer">Efficient and robust approximate nearest neighbor search using HNSW graphs</a>（arXiv:1603.09320））。</p>
<p><strong>核心思想</strong>：构建一个多层的"导航图"。</p>
<pre><code class="hljs language-mermaid" lang="mermaid">graph TB
    subgraph "HNSW 多层结构"
        L2["第2层: 只有少量节点 → 快速定位大方向"]
        L1["第1层: 中等数量节点 → 逐步缩小范围"]
        L0["第0层: 全部节点 → 精确找到最近邻"]
    end
    
    L2 --&gt; L1
    L1 --&gt; L0
    
    Q["查询向量"] --&gt; L2
    L0 --&gt; R["Top-K 结果"]
</code></pre>
<p><strong>性能对比</strong>：</p>

























<table><thead><tr><th>指标</th><th>暴力搜索</th><th>HNSW</th></tr></thead><tbody><tr><td>时间复杂度</td><td>O(n)</td><td>O(log n)</td></tr><tr><td>1 亿向量搜索</td><td>~60 秒</td><td>~10 毫秒</td></tr><tr><td>准确率（召回率）</td><td>100%</td><td>95%~99%</td></tr></tbody></table>
<h2 data-id="heading-37">11. 从论文看：RAG 从诞生就依赖向量数据库</h2>
<h3 data-id="heading-38">9.1 Meta 2020 年原始论文</h3>
<p>2020 年，Meta（原 Facebook）发布了 RAG 的奠基性论文。在论文中，作者明确使用了 <strong>FAISS</strong> 作为向量索引：</p>
<blockquote>
<p>"We use a dense vector index of Wikipedia, accessed with a pre-trained neural retriever... We build a single MIPS index using <strong>FAISS</strong> for fast retrieval of documents."</p>
<p>—— Lewis et al., 2020</p>
</blockquote>

























<table><thead><tr><th>组件</th><th>论文实现</th><th>说明</th></tr></thead><tbody><tr><td><strong>知识源</strong></td><td>整个 Wikipedia</td><td>2100 万个文档块</td></tr><tr><td><strong>分块策略</strong></td><td>100 词/块</td><td>保证语义完整性</td></tr><tr><td><strong>向量索引</strong></td><td>FAISS</td><td>Facebook 开源的向量检索库</td></tr></tbody></table>
<blockquote>
<p>[!IMPORTANT]
<strong>结论</strong>：从 RAG 诞生的第一天起，向量数据库（FAISS）就是其核心组件。这不是巧合，而是由 RAG 的技术本质决定的。</p>
</blockquote>
<h2 data-id="heading-39">12. 常见误区澄清</h2>
<p>初学者在学习 RAG 和向量数据库时，容易产生以下误解：</p>





























<table><thead><tr><th>误区</th><th>正确理解</th></tr></thead><tbody><tr><td>"向量数据库能理解语义"</td><td>❌ 向量数据库只负责<strong>存储和搜索</strong>，语义理解是 <strong>Embedding 模型</strong>的功能</td></tr><tr><td>"维度越高一定越好"</td><td>❌ 高维度会增加存储和计算成本，需要在精度和效率之间<strong>权衡</strong></td></tr><tr><td>"RAG 只能用向量数据库"</td><td>❌ 也可以结合 BM25 做<strong>混合检索</strong>，甚至用传统搜索作为补充</td></tr><tr><td>"Embedding 模型都一样"</td><td>❌ 不同模型对不同语言、领域的效果差异很大，需要<strong>针对性选择</strong></td></tr><tr><td>"分块越小越精确"</td><td>❌ 太小会丢失上下文，<strong>256~512 tokens 是常用起点</strong></td></tr></tbody></table>
<blockquote>
<p>[!CAUTION]
<strong>最常见的错误</strong>：很多初学者把全部精力放在选择向量数据库上，却忽视了 <strong>Embedding 模型选择</strong>和<strong>分块策略</strong>。实际上，这三者对 RAG 效果的影响同样重要！</p>
</blockquote>
<h2 data-id="heading-40">13. 总结：完整的因果链条</h2>
<h3 data-id="heading-41">为什么 RAG 必须使用向量数据库？</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e67c8c812cca4c5f82cd38af68f4b103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgc21hbGx5b3VuZw==:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001968&amp;x-signature=LJjz0yL3Y5AMkyfdI2JvaudRTs8%3D" alt="总结" loading="lazy"/></p>
<pre><code class="hljs language-markdown" lang="markdown"><span class="hljs-bullet">1.</span> RAG 需要"检索"外部知识来增强 LLM
   ↓
<span class="hljs-bullet">2.</span> 检索需要"语义匹配"，而不是关键词匹配
   ↓
<span class="hljs-bullet">3.</span> 语义匹配需要把文本转成向量（Embedding）
   ↓
<span class="hljs-bullet">4.</span> 向量需要"相似度搜索"找到最相关的
   ↓
<span class="hljs-bullet">5.</span> 大规模相似度搜索需要 ANN 索引算法
   ↓
<span class="hljs-bullet">6.</span> 向量数据库 = Embedding 存储 + 相似度搜索 + ANN 索引
   ↓
<span class="hljs-bullet">7.</span> ✅ 向量数据库是 RAG 的必选项
</code></pre>
<h3 data-id="heading-42">核心概念回顾</h3>





























<table><thead><tr><th>概念</th><th>一句话解释</th></tr></thead><tbody><tr><td><strong>向量</strong></td><td>一组有序的数字，可以表示任何东西的"特征"</td></tr><tr><td><strong>Embedding</strong></td><td>把文本转成向量的技术，语义相近的文本向量距离更近</td></tr><tr><td><strong>余弦相似度</strong></td><td>比较两个向量"方向"是否一致，判断语义相似性</td></tr><tr><td><strong>向量数据库</strong></td><td>专门存储和检索向量的数据库，支持相似度搜索</td></tr><tr><td><strong>ANN / HNSW</strong></td><td>快速找到近似最近邻的索引算法，实现毫秒级检索</td></tr></tbody></table>
<h2 data-id="heading-43">14. 快速上手示例</h2>
<h3 data-id="heading-44">使用 Chroma（最简单的入门）</h3>
<pre><code class="hljs language-python" lang="python"><span class="hljs-comment"># 安装：pip install chromadb</span>

<span class="hljs-keyword">import</span> chromadb

<span class="hljs-comment"># 创建客户端</span>
client = chromadb.Client()

<span class="hljs-comment"># 创建集合（自动使用内置 Embedding 模型）</span>
collection = client.create_collection(<span class="hljs-string">"my_docs"</span>)

<span class="hljs-comment"># 添加文档</span>
collection.add(
    documents=[
        <span class="hljs-string">"苹果公司是一家科技公司"</span>,
        <span class="hljs-string">"香蕉是一种水果"</span>,
        <span class="hljs-string">"人工智能正在改变世界"</span>
    ],
    ids=[<span class="hljs-string">"doc1"</span>, <span class="hljs-string">"doc2"</span>, <span class="hljs-string">"doc3"</span>]
)

<span class="hljs-comment"># 语义搜索</span>
results = collection.query(
    query_texts=[<span class="hljs-string">"AI 技术"</span>],
    n_results=<span class="hljs-number">2</span>
)
<span class="hljs-built_in">print</span>(results)
<span class="hljs-comment"># 输出：会找到 "人工智能正在改变世界" 和 "苹果公司是一家科技公司"</span>
<span class="hljs-comment"># 注意："香蕉是一种水果" 不会出现，因为语义距离最远</span>
</code></pre>
<h2 data-id="heading-45">15. 参考资料</h2>
<h3 data-id="heading-46">核心论文</h3>





























<table><thead><tr><th>论文</th><th>作者/机构</th><th>年份</th><th>主要贡献</th></tr></thead><tbody><tr><td><em>Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks</em></td><td>Lewis et al. (Meta AI)</td><td>2020</td><td>RAG 奠基论文，首次使用 FAISS</td></tr><tr><td><em>Efficient and robust approximate nearest neighbor search using HNSW graphs</em></td><td>Malkov &amp; Yashunin</td><td>2016</td><td>HNSW 算法原始论文</td></tr><tr><td><em>When Large Language Models Meet Vector Databases: A Survey</em></td><td>arXiv</td><td>2024</td><td>LLM 与向量数据库综合综述</td></tr></tbody></table>
<h3 data-id="heading-47">推荐阅读</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ffacebookresearch%2Ffaiss" target="_blank" title="https://github.com/facebookresearch/faiss" ref="nofollow noopener noreferrer">FAISS: A Library for Efficient Similarity Search</a> - Meta 开源向量检索库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.trychroma.com%2F" target="_blank" title="https://docs.trychroma.com/" ref="nofollow noopener noreferrer">Chroma 快速开始</a> - 最简单的入门向量数据库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fmilvus.io%2Fdocs" target="_blank" title="https://milvus.io/docs" ref="nofollow noopener noreferrer">Milvus 官方文档</a> - 企业级向量数据库</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.pinecone.io%2Flearn%2F" target="_blank" title="https://www.pinecone.io/learn/" ref="nofollow noopener noreferrer">Pinecone Learning Center</a> - 向量数据库入门教程</li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fplatform.openai.com%2Fdocs%2Fguides%2Fembeddings" target="_blank" title="https://platform.openai.com/docs/guides/embeddings" ref="nofollow noopener noreferrer">OpenAI Embeddings Guide</a> - OpenAI 官方 Embedding 文档</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[C#操作Word文档：如何精准插入与格式化段落？]]></title>    <link>https://juejin.cn/post/7598807837868982298</link>    <guid>https://juejin.cn/post/7598807837868982298</guid>    <pubDate>2026-01-26T02:28:00.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598807837868982298" data-draft-id="7599094262592798730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="C#操作Word文档：如何精准插入与格式化段落？"/> <meta itemprop="keywords" content="后端,C#,.NET"/> <meta itemprop="datePublished" content="2026-01-26T02:28:00.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="缺点内向"/> <meta itemprop="url" content="https://juejin.cn/user/3414438228006112"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            C#操作Word文档：如何精准插入与格式化段落？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3414438228006112/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    缺点内向
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:28:00.000Z" title="Mon Jan 26 2026 02:28:00 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">C#操作Word文档：如何精准插入与格式化段落？</h2>
<p>在C#应用开发中，处理Word文档是常见的需求，尤其是在生成报告、合同或自动化文档时。然而，如何高效、精准地插入段落，无论是纯文本、带格式文本，还是从其他文档复制内容，往往是开发者面临的痛点。原生的COM组件操作复杂且依赖Office环境，手动拼接字符串效率低下，这都极大地影响了开发效率和用户体验。</p>
<p>本文将深入探讨如何利用强大的第三方库 Spire.Doc for .NET，轻松实现Word文档的段落插入操作，让你在处理Word文档时游刃有余，显著提升开发效率。</p>
<hr/>
<h3 data-id="heading-1">Spire.Doc for .NET：Word文档操作的利器</h3>
<p>Spire.Doc for .NET 是一个专业级的.NET Word组件，它允许开发者在不安装Microsoft Office的情况下，创建、读取、写入、修改和转换Word文档。其API设计直观且功能强大，尤其在处理文档结构和内容（如段落、表格、图片等）方面表现出色，极大地简化了复杂的Word自动化任务。与原生COM组件相比，Spire.Doc for .NET提供了更友好的API，更好的兼容性，并且不依赖于Office安装，这在服务器端或无UI环境中进行文档处理时尤为重要。</p>
<hr/>
<h3 data-id="heading-2">基础操作：插入纯文本与指定格式段落</h3>
<p>最常见的需求之一就是插入文本段落。Spire.Doc for .NET提供了直观的方法来创建新的段落，并为其添加文本内容，同时还能灵活地设置各种格式。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Doc;
<span class="hljs-keyword">using</span> Spire.Doc.Documents;
<span class="hljs-keyword">using</span> Spire.Doc.Fields;
<span class="hljs-keyword">using</span> System.Drawing; <span class="hljs-comment">// 用于Color</span>

<span class="hljs-keyword">class</span> <span class="hljs-title">Program</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 创建一个新的Word文档</span>
        Document doc = <span class="hljs-keyword">new</span> Document();
        <span class="hljs-comment">// 添加一个节（Section），文档至少需要一个节</span>
        Section sec = doc.AddSection();

        <span class="hljs-comment">// 示例一：插入纯文本段落</span>
        Paragraph para1 = sec.AddParagraph();
        para1.AppendText(<span class="hljs-string">"这是插入的第一个纯文本段落。"</span>);
        para1.AppendText(<span class="hljs-string">"这是后续添加的文本。"</span>); <span class="hljs-comment">// 可以在同一段落中继续添加文本</span>

        <span class="hljs-comment">// 示例二：插入带格式段落</span>
        Paragraph para2 = sec.AddParagraph();
        TextRange tr = para2.AppendText(<span class="hljs-string">"这是一个带格式的段落。"</span>);
        tr.CharacterFormat.FontName = <span class="hljs-string">"宋体"</span>; <span class="hljs-comment">// 设置字体</span>
        tr.CharacterFormat.FontSize = <span class="hljs-number">14</span>;     <span class="hljs-comment">// 设置字号</span>
        tr.CharacterFormat.TextColor = Color.Blue; <span class="hljs-comment">// 设置颜色</span>
        tr.CharacterFormat.Bold = <span class="hljs-literal">true</span>;       <span class="hljs-comment">// 设置粗体</span>
        para2.Format.HorizontalAlignment = HorizontalAlignment.Center; <span class="hljs-comment">// 设置段落居中对齐</span>

        <span class="hljs-comment">// 示例三：设置段落行距</span>
        Paragraph para3 = sec.AddParagraph();
        para3.AppendText(<span class="hljs-string">"这个段落的行距将被设置为1.5倍行距。"</span>);
        para3.Format.LineSpacingRule = LineSpacingRule.Multiple; <span class="hljs-comment">// 设置行距规则为倍数</span>
        para3.Format.LineSpacing = <span class="hljs-number">1.5f</span> * <span class="hljs-number">12</span>; <span class="hljs-comment">// 1.5倍行距，其中12磅是单倍行距的基准值</span>

        <span class="hljs-comment">// 保存文档</span>
        doc.SaveToFile(<span class="hljs-string">"InsertParagraphs_Basic.docx"</span>, FileFormat.Docx);
        System.Diagnostics.Process.Start(<span class="hljs-string">"InsertParagraphs_Basic.docx"</span>); <span class="hljs-comment">// 打开文档查看效果</span>
    }
}
</code></pre>
<p>在上述代码中，我们首先创建了 <code>Document</code> 和 <code>Section</code> 对象。然后，通过 <code>sec.AddParagraph()</code> 方法添加新的 <code>Paragraph</code> 对象。<code>AppendText()</code> 方法用于向段落中添加文本内容。对于格式设置，我们可以通过 <code>TextRange.CharacterFormat</code> 来设置字符级别（如字体、颜色），通过 <code>Paragraph.Format</code> 来设置段落级别（如对齐方式、行距）。</p>
<hr/>
<h3 data-id="heading-3">进阶技巧：在指定位置插入与内容复制</h3>
<p>除了在文档末尾添加段落，有时我们还需要在文档的特定位置插入新段落，或者将现有文档中的段落复制到目标位置。Spire.Doc for .NET同样提供了灵活的解决方案。</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">using</span> Spire.Doc;
<span class="hljs-keyword">using</span> Spire.Doc.Documents;
<span class="hljs-keyword">using</span> Spire.Doc.Fields;
<span class="hljs-keyword">using</span> System.Drawing;
<span class="hljs-keyword">using</span> System.IO;

<span class="hljs-keyword">class</span> <span class="hljs-title">AdvancedParagraphInsertion</span>
{
    <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span>
    {
        <span class="hljs-comment">// 创建一个包含一些内容的文档作为基础</span>
        Document doc = <span class="hljs-keyword">new</span> Document();
        Section sec = doc.AddSection();
        sec.AddParagraph().AppendText(<span class="hljs-string">"这是文档的第一个段落。"</span>);
        sec.AddParagraph().AppendText(<span class="hljs-string">"这是文档的第二个段落。"</span>);
        sec.AddParagraph().AppendText(<span class="hljs-string">"这是文档的第三个段落。"</span>);
        doc.SaveToFile(<span class="hljs-string">"ExistingDocument.docx"</span>, FileFormat.Docx);

        <span class="hljs-comment">// 示例四：在指定位置（例如第二个段落之前）插入新段落</span>
        Document targetDoc = <span class="hljs-keyword">new</span> Document(<span class="hljs-string">"ExistingDocument.docx"</span>);
        Section targetSec = targetDoc.Sections[<span class="hljs-number">0</span>]; <span class="hljs-comment">// 获取第一个节</span>

        <span class="hljs-comment">// 假设要在现有第二个段落（索引为1）之前插入新段落</span>
        <span class="hljs-keyword">if</span> (targetSec.Paragraphs.Count &gt; <span class="hljs-number">1</span>)
        {
            Paragraph newPara = <span class="hljs-keyword">new</span> Paragraph(targetDoc); <span class="hljs-comment">// 创建一个关联到目标文档的新段落</span>
            newPara.AppendText(<span class="hljs-string">"这是在第二个段落之前插入的新段落。"</span>);
            targetSec.Paragraphs.Insert(<span class="hljs-number">1</span>, newPara); <span class="hljs-comment">// 索引为1，即第二个位置</span>
        }

        <span class="hljs-comment">// 示例五：从另一个文档复制段落</span>
        <span class="hljs-comment">// 创建一个源文档</span>
        Document sourceDoc = <span class="hljs-keyword">new</span> Document();
        Section sourceSec = sourceDoc.AddSection();
        Paragraph sourcePara = sourceSec.AddParagraph();
        TextRange sourceTr = sourcePara.AppendText(<span class="hljs-string">"这是从源文档复制过来的段落，带红色粗体。"</span>);
        sourceTr.CharacterFormat.TextColor = Color.Red;
        sourceTr.CharacterFormat.Bold = <span class="hljs-literal">true</span>;
        sourceDoc.SaveToFile(<span class="hljs-string">"SourceDocument.docx"</span>, FileFormat.Docx);

        <span class="hljs-comment">// 将源文档的第一个段落复制到目标文档的末尾</span>
        <span class="hljs-keyword">if</span> (sourceSec.Paragraphs.Count &gt; <span class="hljs-number">0</span>)
        {
            <span class="hljs-comment">// 注意：直接添加源文档的Paragraph对象会导致该段落从源文档中移除。</span>
            <span class="hljs-comment">// 应该使用Clone()方法创建副本。</span>
            Paragraph copiedPara = sourceSec.Paragraphs[<span class="hljs-number">0</span>].Clone() <span class="hljs-keyword">as</span> Paragraph;
            <span class="hljs-comment">// 将克隆的段落添加到目标文档的第一个节</span>
            targetSec.Paragraphs.Add(copiedPara); 
        }

        <span class="hljs-comment">// 保存修改后的目标文档</span>
        targetDoc.SaveToFile(<span class="hljs-string">"InsertParagraphs_Advanced.docx"</span>, FileFormat.Docx);
        System.Diagnostics.Process.Start(<span class="hljs-string">"InsertParagraphs_Advanced.docx"</span>);
    }
}
</code></pre>
<p>在指定位置插入时，<code>Section.Paragraphs.Insert(index, paragraph)</code> 方法非常有用。需要注意的是，当从一个文档复制段落到另一个文档时，为了避免源文档内容的丢失，应使用 <code>Clone()</code> 方法创建段落的副本。</p>
<hr/>
<h3 data-id="heading-4">常见问题与效率提升建议</h3>
<p>在使用Spire.Doc for .NET处理Word文档时，有一些最佳实践和注意事项可以帮助你提高效率和避免潜在问题：</p>
<ul>
<li><strong>处理大型文档性能考量</strong>：对于包含大量内容或复杂结构的文档，频繁地进行写入操作可能会影响性能。可以考虑批量添加 <code>TextRange</code> 或使用 <code>StringBuilder</code> 构建大型文本块后一次性插入。</li>
<li><strong>内存管理与对象释放</strong>：<code>Document</code> 对象会占用一定的内存资源。在完成文档操作后，及时调用 <code>Document.Dispose()</code> 方法释放资源是一个好习惯。</li>
<li><strong>结合模板使用</strong>：对于需要生成大量结构相似文档的场景，建议先创建一个Word模板文件，其中包含预定义的样式、占位符等。然后使用Spire.Doc加载模板，通过查找和替换占位符，或在特定位置插入新内容来生成最终文档，这会比从零开始构建文档更高效。</li>
<li><strong>样式重用</strong>：如果多个段落需要相同的格式，可以定义 <code>ParagraphStyle</code> 并将其应用于段落，而不是为每个段落单独设置格式，这样可以提高代码复用性和可维护性。</li>
</ul>

























<table><thead><tr><th align="left">场景</th><th align="left">建议方法</th></tr></thead><tbody><tr><td align="left">大量文本插入</td><td align="left">批量添加<code>TextRange</code>或使用<code>StringBuilder</code>构建字符串</td></tr><tr><td align="left">复杂格式段落</td><td align="left">定义<code>ParagraphStyle</code>并应用</td></tr><tr><td align="left">性能优化</td><td align="left">及时调用<code>Document.Dispose()</code>释放资源</td></tr><tr><td align="left">结构相似文档生成</td><td align="left">使用Word模板文件</td></tr></tbody></table>
<hr/>
<h3 data-id="heading-5">总结</h3>
<p>Spire.Doc for .NET 为C#开发者提供了一个强大且易用的工具集，用于处理Word文档中的段落操作。无论是简单的纯文本插入、精细的格式控制，还是在文档中精确指定位置插入，甚至是从其他文档复制内容，Spire.Doc for .NET都能提供高效、灵活的解决方案。掌握这些技巧，将显著提升你在C#项目中处理Word文档的效率和灵活性，让你能够更专注于业务逻辑的实现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一天一个Python库：packaging - 处理Python包和版本信息]]></title>    <link>https://juejin.cn/post/7599101854644092938</link>    <guid>https://juejin.cn/post/7599101854644092938</guid>    <pubDate>2026-01-26T03:09:14.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599101854644092938" data-draft-id="7599268297203073062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一天一个Python库：packaging - 处理Python包和版本信息"/> <meta itemprop="keywords" content="Python"/> <meta itemprop="datePublished" content="2026-01-26T03:09:14.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="敏编程"/> <meta itemprop="url" content="https://juejin.cn/user/2579909358396288"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一天一个Python库：packaging - 处理Python包和版本信息
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2579909358396288/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    敏编程
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:09:14.000Z" title="Mon Jan 26 2026 03:09:14 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">packaging - 处理Python包和版本信息</h2>
<h3 data-id="heading-1">一、什么是packaging？</h3>
<p><strong>packaging</strong> 是一个用于处理 Python 包、版本和各种依赖规范的 Python 库。
它可以帮助你：</p>
<ul>
<li>解析、比较和操作各种 PEP 440 兼容的版本字符串。</li>
<li>处理环境标记（PEP 508）。</li>
<li>解析和标准化依赖规范（PEP 503）。</li>
</ul>
<h3 data-id="heading-2">二、应用场景</h3>
<p><strong>packaging</strong> 广泛应用于以下实际场景：</p>
<ul>
<li><strong>场景1</strong>: 工具开发者需要解析用户输入的 Python 包版本，以确保兼容性。</li>
<li><strong>场景2</strong>: 构建系统需要比较不同库的版本，以决定是否进行升级或安装。</li>
<li><strong>场景3</strong>: 自动化脚本需要根据当前的 Python 环境，解析和应用特定的依赖条件。</li>
</ul>
<h3 data-id="heading-3">三、如何安装</h3>
<ol>
<li>使用 pip 安装</li>
</ol>
<pre><code class="hljs language-bash" lang="bash">pip install packaging

<span class="hljs-comment"># 如果安装慢的话，推荐使用国内镜像源</span>
pip install packaging -i https://www.python64.cn/pypi/simple/
</code></pre>
<ol start="2">
<li>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行代码（无需本地安装）</li>
</ol>
<h3 data-id="heading-4">四、示例代码</h3>
<p><code>packaging</code> 库可以让你轻松地比较两个版本字符串，判断它们的大小关系。</p>
<pre><code class="hljs language-python" lang="python"><span class="hljs-keyword">from</span> packaging.version <span class="hljs-keyword">import</span> Version

<span class="hljs-comment"># 定义两个版本字符串</span>
version_str_1 = <span class="hljs-string">"2.1.0"</span>
version_str_2 = <span class="hljs-string">"2.0.5"</span>

<span class="hljs-comment"># 将版本字符串转换为 Version 对象</span>
version_1 = Version(version_str_1)
version_2 = Version(version_str_2)

<span class="hljs-comment"># 比较两个版本</span>
<span class="hljs-keyword">if</span> version_1 &gt; version_2:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{version_str_1}</span> is newer than <span class="hljs-subst">{version_str_2}</span>"</span>)
<span class="hljs-keyword">elif</span> version_1 &lt; version_2:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{version_str_1}</span> is older than <span class="hljs-subst">{version_str_2}</span>"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{version_str_1}</span> is the same as <span class="hljs-subst">{version_str_2}</span>"</span>)

<span class="hljs-comment"># 另一个示例：比较一个开发版本和一个发布版本</span>
dev_version_str = <span class="hljs-string">"1.0.0.dev1"</span>
release_version_str = <span class="hljs-string">"1.0.0"</span>

dev_version = Version(dev_version_str)
release_version = Version(release_version_str)

<span class="hljs-comment"># 按照 PEP 440 规范，开发版本通常被认为比对应的发行版本要旧</span>
<span class="hljs-keyword">if</span> dev_version &lt; release_version:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{dev_version_str}</span> is older than <span class="hljs-subst">{release_version_str}</span> (as expected for dev builds)"</span>)
<span class="hljs-keyword">else</span>:
    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"<span class="hljs-subst">{dev_version_str}</span> is not older than <span class="hljs-subst">{release_version_str}</span>"</span>)

</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F%3Fcode%3Dfrom%2520packaging.version%2520import%2520Version%250A%250A%2523%2520%25E5%25AE%259A%25E4%25B9%2589%25E4%25B8%25A4%25E4%25B8%25AA%25E7%2589%2588%25E6%259C%25AC%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%250Aversion_str_1%2520%253D%2520%25222.1.0%2522%250Aversion_str_2%2520%253D%2520%25222.0.5%2522%250A%250A%2523%2520%25E5%25B0%2586%25E7%2589%2588%25E6%259C%25AC%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%25E8%25BD%25AC%25E6%258D%25A2%25E4%25B8%25BA%2520Version%2520%25E5%25AF%25B9%25E8%25B1%25A1%250Aversion_1%2520%253D%2520Version%2528version_str_1%2529%250Aversion_2%2520%253D%2520Version%2528version_str_2%2529%250A%250A%2523%2520%25E6%25AF%2594%25E8%25BE%2583%25E4%25B8%25A4%25E4%25B8%25AA%25E7%2589%2588%25E6%259C%25AC%250Aif%2520version_1%2520%253E%2520version_2%253A%250A%2520%2520%2520%2520print%2528f%2522%257Bversion_str_1%257D%2520is%2520newer%2520than%2520%257Bversion_str_2%257D%2522%2529%250Aelif%2520version_1%2520%253C%2520version_2%253A%250A%2520%2520%2520%2520print%2528f%2522%257Bversion_str_1%257D%2520is%2520older%2520than%2520%257Bversion_str_2%257D%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520print%2528f%2522%257Bversion_str_1%257D%2520is%2520the%2520same%2520as%2520%257Bversion_str_2%257D%2522%2529%250A%250A%2523%2520%25E5%258F%25A6%25E4%25B8%2580%25E4%25B8%25AA%25E7%25A4%25BA%25E4%25BE%258B%25EF%25BC%259A%25E6%25AF%2594%25E8%25BE%2583%25E4%25B8%2580%25E4%25B8%25AA%25E5%25BC%2580%25E5%258F%2591%25E7%2589%2588%25E6%259C%25AC%25E5%2592%258C%25E4%25B8%2580%25E4%25B8%25AA%25E5%258F%2591%25E5%25B8%2583%25E7%2589%2588%25E6%259C%25AC%250Adev_version_str%2520%253D%2520%25221.0.0.dev1%2522%250Arelease_version_str%2520%253D%2520%25221.0.0%2522%250A%250Adev_version%2520%253D%2520Version%2528dev_version_str%2529%250Arelease_version%2520%253D%2520Version%2528release_version_str%2529%250A%250A%2523%2520%25E6%258C%2589%25E7%2585%25A7%2520PEP%2520440%2520%25E8%25A7%2584%25E8%258C%2583%25EF%25BC%258C%25E5%25BC%2580%25E5%258F%2591%25E7%2589%2588%25E6%259C%25AC%25E9%2580%259A%25E5%25B8%25B8%25E8%25A2%25AB%25E8%25AE%25A4%25E4%25B8%25BA%25E6%25AF%2594%25E5%25AF%25B9%25E5%25BA%2594%25E7%259A%2584%25E5%258F%2591%25E8%25A1%258C%25E7%2589%2588%25E6%259C%25AC%25E8%25A6%2581%25E6%2597%25A7%250Aif%2520dev_version%2520%253C%2520release_version%253A%250A%2520%2520%2520%2520print%2528f%2522%257Bdev_version_str%257D%2520is%2520older%2520than%2520%257Brelease_version_str%257D%2520%2528as%2520expected%2520for%2520dev%2520builds%2529%2522%2529%250Aelse%253A%250A%2520%2520%2520%2520print%2528f%2522%257Bdev_version_str%257D%2520is%2520not%2520older%2520than%2520%257Brelease_version_str%257D%2522%2529%250A" target="_blank" title="https://www.min2k.com/tools/python-run/?code=from%20packaging.version%20import%20Version%0A%0A%23%20%E5%AE%9A%E4%B9%89%E4%B8%A4%E4%B8%AA%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%0Aversion_str_1%20%3D%20%222.1.0%22%0Aversion_str_2%20%3D%20%222.0.5%22%0A%0A%23%20%E5%B0%86%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BA%20Version%20%E5%AF%B9%E8%B1%A1%0Aversion_1%20%3D%20Version%28version_str_1%29%0Aversion_2%20%3D%20Version%28version_str_2%29%0A%0A%23%20%E6%AF%94%E8%BE%83%E4%B8%A4%E4%B8%AA%E7%89%88%E6%9C%AC%0Aif%20version_1%20%3E%20version_2%3A%0A%20%20%20%20print%28f%22%7Bversion_str_1%7D%20is%20newer%20than%20%7Bversion_str_2%7D%22%29%0Aelif%20version_1%20%3C%20version_2%3A%0A%20%20%20%20print%28f%22%7Bversion_str_1%7D%20is%20older%20than%20%7Bversion_str_2%7D%22%29%0Aelse%3A%0A%20%20%20%20print%28f%22%7Bversion_str_1%7D%20is%20the%20same%20as%20%7Bversion_str_2%7D%22%29%0A%0A%23%20%E5%8F%A6%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B%EF%BC%9A%E6%AF%94%E8%BE%83%E4%B8%80%E4%B8%AA%E5%BC%80%E5%8F%91%E7%89%88%E6%9C%AC%E5%92%8C%E4%B8%80%E4%B8%AA%E5%8F%91%E5%B8%83%E7%89%88%E6%9C%AC%0Adev_version_str%20%3D%20%221.0.0.dev1%22%0Arelease_version_str%20%3D%20%221.0.0%22%0A%0Adev_version%20%3D%20Version%28dev_version_str%29%0Arelease_version%20%3D%20Version%28release_version_str%29%0A%0A%23%20%E6%8C%89%E7%85%A7%20PEP%20440%20%E8%A7%84%E8%8C%83%EF%BC%8C%E5%BC%80%E5%8F%91%E7%89%88%E6%9C%AC%E9%80%9A%E5%B8%B8%E8%A2%AB%E8%AE%A4%E4%B8%BA%E6%AF%94%E5%AF%B9%E5%BA%94%E7%9A%84%E5%8F%91%E8%A1%8C%E7%89%88%E6%9C%AC%E8%A6%81%E6%97%A7%0Aif%20dev_version%20%3C%20release_version%3A%0A%20%20%20%20print%28f%22%7Bdev_version_str%7D%20is%20older%20than%20%7Brelease_version_str%7D%20%28as%20expected%20for%20dev%20builds%29%22%29%0Aelse%3A%0A%20%20%20%20print%28f%22%7Bdev_version_str%7D%20is%20not%20older%20than%20%7Brelease_version_str%7D%22%29%0A" ref="nofollow noopener noreferrer">PythonRun</a> 在线运行这段代码，结果如下：</p>
<pre><code class="hljs language-text" lang="text">2.1.0 is newer than 2.0.5
1.0.0.dev1 is older than 1.0.0 (as expected for dev builds)
</code></pre>
<p>使用 <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fmermaid%2F%3Fcode%3Dflowchart%2520TB%250A%2520%2520A%255B%25E5%25BC%2580%25E5%25A7%258B%255D%2520--%253E%2520B%257B%25E5%25AE%259A%25E4%25B9%2589%25E7%2589%2588%25E6%259C%25AC%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%253A%2520%25222.1.0%2522%252C%2520%25222.0.5%2522%257D%253B%250A%2520%2520B%2520--%253E%2520C%255B%25E5%25B0%2586%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%25E8%25BD%25AC%25E6%258D%25A2%25E4%25B8%25BAVersion%25E5%25AF%25B9%25E8%25B1%25A1%255D%253B%250A%2520%2520C%2520--%253E%2520D%257Bversion_1%2520%253E%2520version_2%253F%257D%253B%250A%2520%2520D%2520--%2520%25E6%2598%25AF%2520--%253E%2520E%255B%25E6%2589%2593%25E5%258D%25B0%2520%25222.1.0%2520is%2520newer%2522%255D%253B%250A%2520%2520D%2520--%2520%25E5%2590%25A6%2520--%253E%2520F%257Bversion_1%2520%253C%2520version_2%253F%257D%253B%250A%2520%2520F%2520--%2520%25E6%2598%25AF%2520--%253E%2520G%255B%25E6%2589%2593%25E5%258D%25B0%2520%25222.1.0%2520is%2520older%2522%255D%253B%250A%2520%2520F%2520--%2520%25E5%2590%25A6%2520--%253E%2520H%255B%25E6%2589%2593%25E5%258D%25B0%2520%25222.1.0%2520is%2520the%2520same%2522%255D%253B%250A%2520%2520E%2520--%253E%2520I%255B%25E5%25AE%259A%25E4%25B9%2589%25E7%2589%2588%25E6%259C%25AC%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%253A%2520%25221.0.0.dev1%2522%252C%2520%25221.0.0%2522%255D%253B%250A%2520%2520G%2520--%253E%2520I%253B%250A%2520%2520H%2520--%253E%2520I%253B%250A%2520%2520I%2520--%253E%2520J%255B%25E5%25B0%2586%25E5%25AD%2597%25E7%25AC%25A6%25E4%25B8%25B2%25E8%25BD%25AC%25E6%258D%25A2%25E4%25B8%25BAVersion%25E5%25AF%25B9%25E8%25B1%25A1%255D%253B%250A%2520%2520J%2520--%253E%2520K%257Bdev_version%2520%253C%2520release_version%253F%257D%253B%250A%2520%2520K%2520--%2520%25E6%2598%25AF%2520--%253E%2520L%255B%25E6%2589%2593%25E5%258D%25B0%2520%2522dev1%2520is%2520older%2522%255D%253B%250A%2520%2520K%2520--%2520%25E5%2590%25A6%2520--%253E%2520M%255B%25E6%2589%2593%25E5%258D%25B0%2520%2522dev1%2520is%2520not%2520older%2522%255D%253B%250A%2520%2520L%2520--%253E%2520N%255B%25E7%25BB%2593%25E6%259D%259F%255D%253B%250A%2520%2520M%2520--%253E%2520N%253B" target="_blank" title="https://www.min2k.com/tools/mermaid/?code=flowchart%20TB%0A%20%20A%5B%E5%BC%80%E5%A7%8B%5D%20--%3E%20B%7B%E5%AE%9A%E4%B9%89%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%3A%20%222.1.0%22%2C%20%222.0.5%22%7D%3B%0A%20%20B%20--%3E%20C%5B%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BAVersion%E5%AF%B9%E8%B1%A1%5D%3B%0A%20%20C%20--%3E%20D%7Bversion_1%20%3E%20version_2%3F%7D%3B%0A%20%20D%20--%20%E6%98%AF%20--%3E%20E%5B%E6%89%93%E5%8D%B0%20%222.1.0%20is%20newer%22%5D%3B%0A%20%20D%20--%20%E5%90%A6%20--%3E%20F%7Bversion_1%20%3C%20version_2%3F%7D%3B%0A%20%20F%20--%20%E6%98%AF%20--%3E%20G%5B%E6%89%93%E5%8D%B0%20%222.1.0%20is%20older%22%5D%3B%0A%20%20F%20--%20%E5%90%A6%20--%3E%20H%5B%E6%89%93%E5%8D%B0%20%222.1.0%20is%20the%20same%22%5D%3B%0A%20%20E%20--%3E%20I%5B%E5%AE%9A%E4%B9%89%E7%89%88%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2%3A%20%221.0.0.dev1%22%2C%20%221.0.0%22%5D%3B%0A%20%20G%20--%3E%20I%3B%0A%20%20H%20--%3E%20I%3B%0A%20%20I%20--%3E%20J%5B%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E8%BD%AC%E6%8D%A2%E4%B8%BAVersion%E5%AF%B9%E8%B1%A1%5D%3B%0A%20%20J%20--%3E%20K%7Bdev_version%20%3C%20release_version%3F%7D%3B%0A%20%20K%20--%20%E6%98%AF%20--%3E%20L%5B%E6%89%93%E5%8D%B0%20%22dev1%20is%20older%22%5D%3B%0A%20%20K%20--%20%E5%90%A6%20--%3E%20M%5B%E6%89%93%E5%8D%B0%20%22dev1%20is%20not%20older%22%5D%3B%0A%20%20L%20--%3E%20N%5B%E7%BB%93%E6%9D%9F%5D%3B%0A%20%20M%20--%3E%20N%3B" ref="nofollow noopener noreferrer">MermaidGo</a> 绘制示例代码的流程图，结果如下：</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/df8bae2791d14f158bbcee86363b2349~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pWP57yW56iL:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001753&amp;x-signature=5Kle4QuxYSEh6y%2FotFHnYAnZ11I%3D" alt="mermaid-20260126_105848.jpeg" loading="lazy"/></p>
<h3 data-id="heading-5">五、学习资源</h3>
<ol>
<li>开源项目：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpypa%2Fpackaging" target="_blank" title="https://github.com/pypa/packaging" ref="nofollow noopener noreferrer">packaging</a></li>
<li>中文自述：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.python64.cn%2Freadme%2Fpackaging%2F" target="_blank" title="https://www.python64.cn/readme/packaging/" ref="nofollow noopener noreferrer">REMDME</a></li>
<li>在线运行：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.min2k.com%2Ftools%2Fpython-run%2F" target="_blank" title="https://www.min2k.com/tools/python-run/" ref="nofollow noopener noreferrer">PythonRun</a></li>
</ol>
<blockquote>
<p>如果这篇文章对你有帮助，欢迎点赞、收藏、转发！<br/>
学习过程中有任何问题，欢迎在评论区留言交流～</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低代码的“反直觉”进化：为何 Mendix 放弃“在线文档式”协同，却赢得了 AI 时代？]]></title>    <link>https://juejin.cn/post/7598767580307456054</link>    <guid>https://juejin.cn/post/7598767580307456054</guid>    <pubDate>2026-01-26T03:12:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580307456054" data-draft-id="7599496293161549865" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低代码的“反直觉”进化：为何 Mendix 放弃“在线文档式”协同，却赢得了 AI 时代？"/> <meta itemprop="keywords" content="低代码"/> <meta itemprop="datePublished" content="2026-01-26T03:12:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="西门子低代码Mendix"/> <meta itemprop="url" content="https://juejin.cn/user/925114124492553"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低代码的“反直觉”进化：为何 Mendix 放弃“在线文档式”协同，却赢得了 AI 时代？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/925114124492553/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    西门子低代码Mendix
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:12:59.000Z" title="Mon Jan 26 2026 03:12:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    7
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读1分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>摘要：在低代码赛道，“云端实时协同”似乎已成为不言自明的行业标配。然而，企业级低代码领军者 Mendix 却反其道而行：毅然废止 Web 端 IDE，强制统一 Desktop 客户端（Studio Pro），并坚守“异步提交”的类 Git 模式。 这并非技术的倒退，而是一场对软件工程本质的深刻回归。本文将从底层 GUID 模型合并算法、组件稳定性带来的“噪音过滤”、以及三排视图（Three-Pane View）的交互哲学出发，深度剖析 Mendix 如何通过“重型架构”化解多人协作的千古难题，并以此构建人机共创（Human-AI Co-creation）的统一语境。</p>
<p><strong><strong>一、 祛魅：软件开发从来不是“在线装修”</strong></strong></p>
<p>在低代码选型初期，许多决策者容易陷入一种“Figma 崇拜”：误以为低代码平台越像在线设计工具，用户体验就越极致。他们憧憬着这样的场景：</p>
<p>产品经理拖拽一个按钮，后端工程师同步配置逻辑，决策者在移动端即时刷新即可验收。三人如同在 Google Docs 上共创文档一般，光标飞舞，无缝流转。</p>
<p>这种愿景在 Demo 演示中极具杀伤力，但在真实的<strong><strong>企业级软件工程</strong></strong>中，这不仅是幻觉，更是一场<strong><strong>工程灾难</strong></strong>。因为它混淆了两个本质截然不同的领域：<strong><strong>“非结构化内容的编辑”与“强依赖逻辑的构建”</strong></strong>。</p>
<p><strong><strong>1. 线性叠加 vs. 网状依赖（The Dependency Trap）</strong></strong></p>
<p>在线文档或电子表格的协同，本质上是<strong><strong>线性的、松耦合的</strong></strong>。</p>
<ul>
<li><strong><strong>文档场景：</strong></strong> 你修正第 1 段的错别字，我撰写第 10 段的总结。即便发生冲突（如修改同一句话），后果仅仅是文字的覆盖，<strong><strong>文档本身依然保持“可读”</strong></strong>。</li>
<li><strong><strong>软件场景：</strong></strong> 软件是一组<strong><strong>严密咬合的齿轮（Mesh Network）</strong></strong>。
<ul>
<li><strong><strong>依赖链条：</strong></strong> 页面（Page）挂载微流（Microflow），微流调用实体（Entity），实体依赖关联关系（Association）。</li>
<li><strong><strong>灾难推演：</strong></strong> 假设业务人员 A 正于前端调试一个“金额计算”组件，而 IT 人员 B 在同一秒的“实时协同”中，为了优化性能，修改了底层数据库中 Amount 字段的数据类型（从 Integer 改为 Decimal）。</li>
<li><strong><strong>结果：</strong></strong> 在 Figma 模式下，B 按下回车的瞬间，A 的屏幕会立即红屏报错，甚至导致 IDE 崩溃。因为<strong><strong>运行时环境（Runtime）无法容忍哪怕一毫秒的“类型不匹配”逻辑断裂</strong></strong>。</li>
</ul>
</li>
</ul>
<p><strong><strong>2. “中间态”的合法性：只有破碎，才能新生</strong></strong></p>
<p>这是实时协同最大的悖论：<strong><strong>它剥夺了“破坏”的权利。</strong></strong> 在软件开发中，任何有价值的重构（Refactoring）或新功能开发，都必须经历一个“先破坏，再重建”的过程：</p>
<p>拆解旧逻辑 -&gt; 代码报错（中间态） -&gt; 编织新逻辑 -&gt; 代码跑通。</p>
<ul>
<li><strong><strong>实时协同的困境：</strong></strong> 若每个人的操作都原子级地广播给全员，那么只要有一人在重构，整个团队都会被迫陷入“报错状态”，无法运行预览。团队协作将沦为互相喊话：“先别动！我在改接口！”</li>
<li><strong><strong>Mendix 的哲学：</strong></strong> 通过<strong><strong>本地副本（Local Copy）</strong></strong>，Mendix 赋予了开发者“把代码弄坏的权利”。在你的本地沙箱里，你可以大胆地拆解骨架、断开连接，直到逻辑重新闭环，再提交（Commit）给团队。这种“基于事务（Transactional）”的机制，才是对团队时间最大的尊重。<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ba9504c331294afb93dff100c69127d9~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zeo5a2Q5L2O5Luj56CBTWVuZGl4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770003274&amp;x-signature=R2G%2BgWFmLhFq%2BN0N7oo%2B%2FPU8DEQ%3D" alt="" loading="lazy"/></li>
</ul>
<p><strong><strong>3. 心流的保护：协作，而非监控</strong></strong></p>
<p>从心理学视角审视，实时协同在深度创造场景下无异于一种“数字全景监狱”。 当知晓你的每一次拖拽、每一个属性修改都会实时映射在同事（甚至上级）的屏幕上时，开发者的防御机制会本能启动：</p>
<ul>
<li>恐惧犯错，导致探索欲降低。</li>
<li>回避复杂的逻辑改动，倾向于保守修补。</li>
<li>频繁被弹窗打断（Pop-up: ZhangSan updated component X）。</li>
</ul>
<p>深度开发需要<strong><strong>心流（Flow State）</strong></strong>。Mendix 的异步协作模式，构建了一个“私有的思考沙箱”。在此，开发者可以屏蔽外界噪音，专注于逻辑构建，直至方案成熟，才与世界同步。</p>
<p><strong><strong>结论</strong></strong></p>
<p><strong><strong>软件开发不是装修房子，而是建造摩天大楼。</strong></strong> 装修可以允许多人同时刷墙、铺地毯（实时协同）；但建楼时，若有人正在浇筑地基，绝不允许另一人同时修改承重墙的图纸。 Mendix 拒绝“实时幻觉”，坚守“Git 式异步架构”，正是为了捍卫软件工程最核心的<strong><strong>依赖完整性</strong></strong>与<strong><strong>开发者专注力</strong></strong>。</p>
<p><strong><strong>二、 战略归一：废止 Web 端，旨在“统一语境”</strong></strong></p>
<p>Mendix 近期的一项重大战略调整——<strong><strong>逐步废止 Web 端 IDE（Studio），全面收敛至桌面端 Studio Pro</strong></strong>——看似提高了准入门槛（需下载安装），实则是消灭协作阻力的关键一役。</p>
<p><strong><strong>1. 消除“工具隔离”带来的“阶级隔离”</strong></strong></p>
<p>在旧的双模时代，业务人员使用 Web 端（功能阉割版），专业开发使用 Desktop 端（全功能版）。这导致了两个结构性断层：</p>
<ul>
<li><strong><strong>模型流转损耗：</strong></strong> Web 端模型转入 Desktop 端易，逆向则难如登天。</li>
<li><strong><strong>沟通语境断层：</strong></strong> 业务人员只能做“表面文章”，一旦触及复杂逻辑便被迫停手，等待 IT 接管。</li>
</ul>
<p><strong><strong>统一 Studio Pro 后的质变：</strong></strong></p>
<p>废止 Web 端，意味着<strong><strong>全量能力的平权下放</strong></strong>。</p>
<p>业务专家与架构师使用的是<strong><strong>同一个二进制程序、同一套 DSL 解析引擎</strong></strong>。</p>
<ul>
<li>业务人员可在 Studio Pro 中使用简化视图（聚焦页面、简单流程）；</li>
<li>但当其能力进阶，或需查阅 IT 编写的逻辑时，<strong><strong>不存在“工具墙”的阻隔</strong></strong>。</li>
<li>项目永远可以在两者之间<strong><strong>无损流转</strong></strong>，真正实现了全生命周期的深度协同。</li>
</ul>
<p><strong><strong>2. 唯有“本地算力”方能支撑“智能合并”</strong></strong></p>
<p>这回归到了核心技术命题——<strong><strong>基于 GUID 的模型合并</strong></strong>。 为何 Web 端难以承载复杂的冲突解决？</p>
<ul>
<li><strong><strong>浏览器的性能天花板：</strong></strong> 浏览器受限于 DOM 渲染与 JavaScript 的单线程机制。当企业级应用膨胀至数千页面、上万微流节点时，在浏览器端进行全量的 AST（抽象语法树）解析与 Diff 比对，会导致严重的卡顿乃至崩溃。</li>
<li><strong><strong>算法的计算密度：</strong></strong> Mendix 的冲突消解算法需加载全量依赖树，判别组件稳定性与属性变更。这种<strong><strong>计算密集型任务</strong></strong>，只有本地客户端（Native Application）才能榨干 CPU 与内存的性能，提供毫秒级的响应。</li>
</ul>
<p><strong><strong>战略逻辑：</strong></strong> 为了让业务人员也能享受到“丝滑”的冲突解决体验，Mendix 必须将计算的主战场从云端拉回本地。</p>
<p><strong><strong>3. 重新定义“易用性”：不做减法，做“折叠”</strong></strong></p>
<p>常人误以为易用性即“功能少”、“免安装”。Mendix 反对这种肤浅的定义。 在 Mendix 看来，真正的易用性是：<strong><strong>提供强大的工具，但将复杂性优雅地折叠。</strong></strong></p>
<p>统一 Studio Pro 后，Mendix 并非将复杂的 IDE 直接抛给业务人员，而是引入了渐进式披露（Progressive Disclosure）的设计哲学：</p>
<ul>
<li><strong><strong>面向业务人员：</strong></strong> 默认从“工作流视图”与“页面编辑器”开始使用，底层的 Java Action、复杂 Mapping 配置在熟悉后也可尝试。</li>
<li><strong><strong>面向 IT 人员：</strong></strong> 可随时展开掌控所有底层细节。</li>
</ul>
<p>这种策略传达了一种<strong><strong>尊重</strong></strong>：它默认业务人员具备逻辑构建的潜力，不通过阉割工具来限制他们的能力上限。</p>
<p><strong><strong>4. 为 AI Copilot 构筑“稳定基座”</strong></strong></p>
<p>最后，这一收敛旨在为 AI 时代铺路。 当前的 AI 辅助编程（如 Mendix Maia），需要与 IDE 进行极高频的<strong><strong>上下文交互</strong></strong>。</p>
<ul>
<li>Web IDE 的上下文往往是碎片化的、受网络延迟制约的。</li>
<li>本地 Studio Pro 则驻留了<strong><strong>全量的结构化模型</strong></strong>。</li>
</ul>
<p>当 AI 作为插件运行在 Studio Pro 内部时，它能以极低延迟读取当前选中的 GUID 组件，分析上下文依赖，并直接操作内存中的模型对象。<strong><strong>统一客户端，实则是为 AI 提供了一个稳定、高性能的“操作接口”。</strong></strong></p>
<p><strong><strong>三、 降维打击：从“代码行对抗”到“业务决策”</strong></strong></p>
<p>在软件工程中，多人协作最令人胆寒的时刻莫过于“Merge Conflict”（合并冲突）。在传统的基于文本（Text-based）的世界里，解决冲突往往意味着在一堆乱码般的 &lt;&lt;&lt;&lt; HEAD 和 &gt;&gt;&gt;&gt; branch 中如履薄冰地修剪。</p>
<p>Mendix 的核心护城河在于：它不强求业务人员理解代码差异，而是通过<strong><strong>模型降维</strong></strong>，将“技术冲突”转化为直观的“业务选择”。</p>
<p><strong><strong>1. 底层原理：GUID 与 AST 的“对象级”认知</strong></strong></p>
<p>Git 的原生逻辑是“行级对比”——它只识字符，不识逻辑。 而 Mendix 的底层引擎（Model Server）建立在 <strong><strong>AST（抽象语法树）</strong></strong> 与 <strong><strong>GUID（全局唯一标识符）</strong></strong> 的“对象级对比”之上。</p>
<ul>
<li><strong><strong>文本视角的盲区（Git）：</strong></strong> 假如 A 修改了按钮颜色，B 修改了按钮文字。在生成的 XML/JSON 文件中，这两处修改可能导致同一行代码的 hash 值剧变，或致行号错位。Git 会判定：“此处已乱，无法合并，请人工介入。”</li>
<li><strong><strong>模型视角的洞察（Mendix）：</strong></strong> Mendix 引擎看到的不是文本，而是<strong><strong>对象图谱</strong></strong>。</li>
</ul>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/71aaed92db57432d9dd2223e13df7e8a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zeo5a2Q5L2O5Luj56CBTWVuZGl4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770003274&amp;x-signature=5KHm7i8H7tvFa%2Fivx7yI3ihmS4c%3D" alt="" loading="lazy"/>​</p>
<p>“系统锁定对象 Button_Submit (GUID: 12ab-34cd)。” “A 变更了属性 Style。” “B 变更了属性 Caption。” “判定： 属性互不干扰，执行自动合并。”</p>
<p>这种<strong><strong>语义级的理解能力</strong></strong>，让机器在底层自动消化了绝大多数“逻辑不冲突、仅文本冲突”的场景。</p>
<p><strong><strong>2. 噪音消音器：利用“组件稳定性”过滤 90% 的假冲突</strong></strong></p>
<p>这是 Mendix 协作体验中被严重低估的技术细节。 在可视化开发中，页面布局（Layout）的微调往往会牵一发而动全身，产生海量代码噪音。例如，仅在页面顶部增加一个 Container，即导致下方所有组件在 DOM 树或代码结构中层级“下移”。</p>
<ul>
<li><strong><strong>传统痛点：</strong></strong> 层级变动会让 Git 误判“所有代码行均已变更”，从而引发海量的<strong><strong>假阳性冲突（False Positives）</strong></strong>。</li>
<li><strong><strong>Mendix 的解法：</strong></strong> 基于 GUID 的<strong><strong>锚定效应</strong></strong>。 只要组件自身的属性未被修改，无论它流转至何处，无论周边环境如何变迁，Mendix 均判定<strong><strong>该组件是“稳定”的</strong></strong>。</li>
</ul>
<p>系统仿佛一个精密的漏斗</p>
<ol>
<li><strong><strong>第一层过滤：</strong></strong> 剔除所有 GUID 未变的稳定组件（哪怕代码行号已变）。</li>
<li><strong><strong>第二层过滤：</strong></strong> 剔除虽有变化但逻辑兼容的自动合并项。</li>
<li><strong><strong>最终呈现：</strong></strong> 仅将真正修改了<strong><strong>同一 GUID 的同一属性</strong></strong>的“硬冲突”，呈现在用户面前。</li>
</ol>
<p>这极大降低了用户的认知负载——你无需处理“因同事调整布局而引发的满屏飘红”，只需聚焦“真正的逻辑分歧”。</p>
<p><strong><strong>3. 三排视图（Three-Pane View）：交互体验的降维</strong></strong></p>
<p>当确需人工介入时，Mendix 并未抛出枯燥的代码对比框，而是提供了<strong><strong>所见即所得的“三排合并视图”</strong></strong>。这是将 Git 流程“平民化”的关键设计。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a53b68df9a1543069e22913458561c6a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zeo5a2Q5L2O5Luj56CBTWVuZGl4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770003274&amp;x-signature=2APtRcKnRQhxrsAVct09MFfJ4x4%3D" alt="" loading="lazy"/>​</p>
<ul>
<li><strong><strong>可视化呈现（Visualization）：</strong></strong>
<ul>
<li><strong><strong>左屏（Mine）：</strong></strong> 你的版本（例：蓝色按钮）。</li>
<li><strong><strong>右屏（Theirs）：</strong></strong> 传入的版本（例：红色按钮）。</li>
<li><strong><strong>中屏（Merged）：</strong></strong> 合并后的实时预览。</li>
<li>注：此处展示的非 JSON 文本，而是渲染完毕的 UI 组件或逻辑流图。</li>
</ul>
</li>
<li><strong><strong>颗粒度控制（Granularity）：</strong></strong> 这是“降维”的极致体现。传统 Git 冲突往往是<strong><strong>文件级</strong></strong>的（要么保留我的文件，要么用你的）。而在 Mendix 中，决策精确到<strong><strong>属性级</strong></strong>。</li>
</ul>
<p><strong><strong>操作流如同“自助点餐”：</strong></strong></p>
<p>面对一个冲突组件：</p>
<ul>
<li>
<ul>
<li>勾选左边的 On Click Event（保留我的逻辑）；</li>
<li>勾选右边的 Caption（采纳对方的文案）；</li>
<li>勾选左边的 Style（坚持我的配色）。</li>
</ul>
</li>
</ul>
<p>至此，冲突解决不再是技术人员的“代码调试”，而是回归到了业务人员最擅长的“配置决策”<strong><strong>。业务人员无需通晓合并算法，只需基于业务判断：</strong></strong>“哪个逻辑是对的？”</p>
<p><strong><strong>四、 终极图景：人、AI 与平台的“同频共振”</strong></strong></p>
<p>为何 Mendix 宁愿承受废止 Web 端带来的短期舆论压力，也要死磕“统一客户端（Studio Pro）”与“严谨的 GUID 模型”？</p>
<p>若只看当下，这是为了多人协作；但若将时间轴拉长至 <strong><strong>AI 原生应用（AI-Native App）</strong></strong> 的未来，你会发现 Mendix 正在布局一盘大棋：<strong><strong>构建一个让人类意图与 AI 执行完美对齐的“数字底座”。</strong></strong></p>
<p>在 AIGC 爆发的今天，所有低代码平台都在竞相接入 GPT，但 Mendix 的架构决定了它能走得更远。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/01ff0257e968455c92f695c222c4b677~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6KW_6Zeo5a2Q5L2O5Luj56CBTWVuZGl4:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770003274&amp;x-signature=s2sxdtrB29LKWRu6aR%2BpdJtE3cs%3D" alt="" loading="lazy"/>​</p>
<p><strong><strong>1. 语言的胜利：从“概率的文本”到“确定的模型”</strong></strong></p>
<p>这是 AI 介入软件开发时最底层的矛盾：<strong><strong>LLM（大语言模型）基于概率，而软件运行基于确定性。</strong></strong></p>
<ul>
<li><strong><strong>文本代码（Text-Code）的困境：</strong></strong> 当 AI 生成 Java 或 Python 代码时，本质是在做“文本接龙”。它极易产生“幻觉（Hallucination）”，如引用不存在的库或语法正确但逻辑跑偏。在文本编辑器中，上下文（Context）极易断裂。</li>
<li><strong><strong>Mendix DSL（领域特定语言）的优势：</strong></strong> Mendix 的底层并非杂乱文本，而是<strong><strong>高度结构化的元数据模型（Metadata Model）</strong></strong>。
<ul>
<li><strong><strong>结构化投喂：</strong></strong> 当 Studio Pro 向 AI 投喂信息时，发送的不是成千上万行代码，而是清洗过的、逻辑清晰的 <strong><strong>GUID 树（YAML 形式）</strong></strong>。这极大降低了 LLM 的理解噪声，让 AI 能用更少的 Token 精准捕捉业务逻辑。</li>
<li><strong><strong>降噪与聚焦：</strong></strong> GUID 机制保证了 AI 能精确锁定对象。AI 无需模糊推测“第几行的变量”，而是直接指令：“修改 GUID 为 X-123 的组件属性”。<strong><strong>歧义在此消弭。</strong></strong></li>
</ul>
</li>
</ul>
<p>以下是一段微流的DSL示例</p>
<blockquote>
<p>[StartEvent]</p>
<p>Create: $SystemPrompt (String) = 'You are an expert SPARQL assistant.'</p>
<p>Call: GenAICommons.Request_Create(SystemPrompt=<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>y</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>m</mi><mi>P</mi><mi>r</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>t</mi><mo separator="true">,</mo><mi>T</mi><mi>e</mi><mi>m</mi><mi>p</mi><mi>e</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>u</mi><mi>r</mi><mi>e</mi><mo>=</mo><mn>0.2</mn><mo separator="true">,</mo><mi>M</mi><mi>a</mi><mi>x</mi><mi>T</mi><mi>o</mi><mi>k</mi><mi>e</mi><mi>n</mi><mi>s</mi><mo>=</mo><mn>256</mn><mo separator="true">,</mo><mi>T</mi><mi>o</mi><mi>p</mi><mi>P</mi><mo>=</mo><mn>0.2</mn><mo separator="true">,</mo><mi>I</mi><mi>D</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">SystemPrompt, Temperature=0.2, MaxTokens=256, TopP=0.2, ID=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">ys</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:0.13889em;">P</span><span class="mord mathnormal">ro</span><span class="mord mathnormal">m</span><span class="mord mathnormal">pt</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.02778em;">er</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mord mathnormal">re</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord">0.2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">a</span><span class="mord mathnormal">x</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord">256</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.13889em;">pP</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord">0.2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span></span></span></span></span>UserPrompt) -&gt; $Request</p>
<p>Call: GenAICommons.Request_AddMessage(Request=<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo separator="true">,</mo><mi>E</mi><mi>N</mi><mi>U</mi><mi>M</mi><mi mathvariant="normal">_</mi><mi>M</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>R</mi><mi>o</mi><mi>l</mi><mi>e</mi><mo>=</mo><mi>G</mi><mi>e</mi><mi>n</mi><mi>A</mi><mi>I</mi><mi>C</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>o</mi><mi>n</mi><mi>s</mi><mi mathvariant="normal">.</mi><mi>E</mi><mi>N</mi><mi>U</mi><mi>M</mi><mi mathvariant="normal">_</mi><mi>M</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>a</mi><mi>g</mi><mi>e</mi><mi>R</mi><mi>o</mi><mi>l</mi><mi>e</mi><mi mathvariant="normal">.</mi><mi>u</mi><mi>s</mi><mi>e</mi><mi>r</mi><mo separator="true">,</mo><mi>F</mi><mi>i</mi><mi>l</mi><mi>e</mi><mi>C</mi><mi>o</mi><mi>l</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>e</mi><mi>m</mi><mi>p</mi><mi>t</mi><mi>y</mi><mo separator="true">,</mo><mi>C</mi><mi>o</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo>=</mo><mi>t</mi><mi>r</mi><mi>i</mi><mi>m</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">Request, ENUM\_MessageRole=GenAICommons.ENUM\_MessageRole.user, FileCollection=empty, ContentString=trim(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.10903em;">EN</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">ess</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1.0044em;vertical-align:-0.31em;"/><span class="mord mathnormal">G</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">A</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">mm</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:0.10903em;">EN</span><span class="mord mathnormal" style="margin-right:0.10903em;">U</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">ess</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord">.</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.02778em;">ser</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.01968em;">ll</span><span class="mord mathnormal">ec</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:0.8778em;vertical-align:-0.1944em;"/><span class="mord mathnormal">e</span><span class="mord mathnormal">m</span><span class="mord mathnormal">pt</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">tSt</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">im</span><span class="mopen">(</span></span></span></span></span>UserPrompt)) -&gt; $</p>
<p>Retrieve: GenAICommons.DeployedModel [[contains(Model,'claude-3-5')]] -&gt; $DeployedModel</p>
<p>Call: GenAICommons.ChatCompletions_WithHistory(Request=<span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>e</mi><mi>q</mi><mi>u</mi><mi>e</mi><mi>s</mi><mi>t</mi><mo separator="true">,</mo><mi>D</mi><mi>e</mi><mi>p</mi><mi>l</mi><mi>o</mi><mi>y</mi><mi>e</mi><mi>d</mi><mi>M</mi><mi>o</mi><mi>d</mi><mi>e</mi><mi>l</mi><mo>=</mo></mrow><annotation encoding="application/x-tex">Request, DeployedModel=</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"/><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">q</span><span class="mord mathnormal">u</span><span class="mord mathnormal">es</span><span class="mord mathnormal">t</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"/><span class="mord mathnormal">De</span><span class="mord mathnormal" style="margin-right:0.01968em;">pl</span><span class="mord mathnormal">oye</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.10903em;">M</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span></span></span></span></span>DeployedModel) -&gt; $Response_SparqlQuery</p>
<p>Split [Prefix found?]: find($Response_SparqlQuery/ResponseText, 'PREFIX') != -1</p>
<p>--( true)--&gt; Create: <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mi>p</mi><mi>a</mi><mi>r</mi><mi>q</mi><mi>l</mi><mi>Q</mi><mi>u</mi><mi>e</mi><mi>r</mi><mi>y</mi><mi mathvariant="normal">_</mi><mi>C</mi><mi>l</mi><mi>e</mi><mi>a</mi><mi>n</mi><mi>e</mi><mi>d</mi><mo stretchy="false">(</mo><mi>S</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">)</mo><mo>=</mo><mi>s</mi><mi>u</mi><mi>b</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>i</mi><mi>n</mi><mi>g</mi><mo stretchy="false">(</mo></mrow><annotation encoding="application/x-tex">SparqlQuery\_Cleaned (String) = substring(</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.06em;vertical-align:-0.31em;"/><span class="mord mathnormal">Sp</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">qlQ</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.03588em;">ery</span><span class="mord" style="margin-right:0.02778em;">_</span><span class="mord mathnormal" style="margin-right:0.01968em;">Cl</span><span class="mord mathnormal">e</span><span class="mord mathnormal">an</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">St</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"/><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"/></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"/><span class="mord mathnormal">s</span><span class="mord mathnormal">u</span><span class="mord mathnormal">b</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">in</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mopen">(</span></span></span></span></span>Response_SparqlQuery/ResponseText, find($Response_SparqlQuery/ResponseText, 'PREFIX'))</p>
<p>End (Return: $Response_SparqlQuery/ResponseText)</p>
<p>--(false)--&gt; End (Return: $Response_SparqlQuery/ResponseText)</p>
</blockquote>
<p><strong><strong>2. 交互的革命：终结“复制粘贴”，实现“Text-to-Model”直连</strong></strong></p>
<p>在 Web 端与桌面端分裂的旧时代，AI 难以深度集成。但在统一的 <strong><strong>Studio Pro</strong></strong> 环境中，Mendix 实现了真正的 <strong><strong>Co-pilot（副驾驶）体验</strong></strong>。</p>
<ul>
<li><strong><strong>传统 AI 辅助：</strong></strong> 在 ChatGPT 网页提问 -&gt; 生成代码 -&gt; 手动复制 -&gt; 粘贴至 IDE -&gt; 报错调试。链路割裂且低效。</li>
<li><strong><strong>Mendix Maia（智能引擎）模式：</strong></strong> 得益于统一客户端，AI 引擎直接嵌入 IDE 核心。
<ul>
<li><strong><strong>意图即实现：</strong></strong> 输入“帮我将所有超 1000 元的订单标红”。</li>
<li><strong><strong>直接操作模型：</strong></strong> AI 无需生成文字解释，而是通过 IDE API，直接在后台操作底层 GUID 模型树。</li>
<li><strong><strong>即时渲染：</strong></strong> 下一秒，眼前的可视化画布自动刷新，逻辑配置完毕。 这种“自然语言输入 -&gt; 模型直接变更”的链路，唯有在“人机共用同一套本地模型环境”的架构下，方能极致流畅。</li>
</ul>
</li>
</ul>
<p><strong><strong>3. 治理的闭环：AI 的“安全围栏”</strong></strong></p>
<p>企业最忌惮 AI 写出有漏洞或破坏性的代码。Mendix 的强类型、模型驱动架构，成为了 AI 狂奔时的“护栏”。</p>
<ul>
<li><strong><strong>编译器即裁判：</strong></strong> 无论 AI 生成何种逻辑，在写入模型的瞬间，必须通过 Mendix 严苛的<strong><strong>一致性检查器（Consistency Checker）</strong></strong>。</li>
<li><strong><strong>逻辑自洽验证：</strong></strong> 若 AI 删除了一个被引用的实体，Studio Pro 会立即报错并拒绝变更。这与 Git 协作中的冲突检测逻辑一脉相承——<strong><strong>系统确保写入主干的逻辑必须合法。</strong></strong></li>
<li><strong><strong>可解释性：</strong></strong> 因为最终生成的是可视化的逻辑流（Microflow）而非黑盒代码，业务人员可随时审查 AI 的成果，确保合规。</li>
</ul>
<p><strong><strong>4. 三位一体的协同终局</strong></strong></p>
<p>至此，Mendix 的良苦用心图穷匕见。它构建了一个<strong><strong>人、AI、平台</strong></strong>三方完全同频的语境：</p>
<ul>
<li><strong><strong>平台（Platform）：</strong></strong> 提供通用的、结构化的 GUID 模型语言，作为唯一的“真理信源”。</li>
<li><strong><strong>人（Human）：</strong></strong> 利用 Studio Pro 的三排视图，进行高阶业务决策与冲突裁决。</li>
<li><strong><strong>AI（Agent）：</strong></strong> 作为高效执行者，在 GUID 指引下精准填充逻辑，并通过平台校验确保安全。</li>
</ul>
<p><strong><strong>总结：</strong></strong> Mendix 牺牲了 Web 端“即开即用”的轻便，换来的是一个<strong><strong>工业级的、能让 AI 读懂并安全操作的“数字孪生工厂”</strong></strong>。在 AI 定义软件工程的未来，这种“统一语境 + 严谨模型”的护城河，将比任何“实时拖拽”的噱头都更加深远。</p>
<p><strong><strong>五、 结语：复杂度的守恒与低代码的“成年礼”</strong></strong></p>
<p>低代码行业正在经历一场静悄悄但剧烈的“成年礼”。</p>
<p>过去五年，市场沉迷于“零门槛”的幻象，仿佛只要把 IDE 搬进浏览器、把代码变积木，软件开发的固有难度便会凭空消失。但 Mendix 的架构选择——<strong><strong>坚守桌面端 Studio Pro、强制 Git 工作流、深耕 GUID 模型算法</strong></strong>——向行业揭示了一个残酷但真实的公理：<strong><strong>软件工程的复杂度是守恒的。</strong></strong></p>
<p><strong><strong>1. 以“重”致“轻”的工程哲学</strong></strong></p>
<p>真正的易用性，从未通过削减功能或逃避规范来实现。 若为了追求“像做 PPT 一样简单”的实时体验，而牺牲版本回滚的精确性与逻辑冲突的隔离性，这种“简单”终将演变为维护阶段的“噩梦”。</p>
<p>Mendix 选择了看似“笨重”的路径：</p>
<ul>
<li><strong><strong>用底层算力换取上层直觉：</strong></strong> 正因本地客户端与 GUID 算法承担了繁重的比对任务，业务人员才能享受到“组件稳定性过滤”后的清爽，才能在“三排视图”中做简单的选择题。</li>
<li><strong><strong>用流程严谨换取结果可靠：</strong></strong> 异步提交与冲突检测，看似增加了操作步骤，实则是在为企业核心资产（Core Business Assets）穿戴铠甲。</li>
</ul>
<p><strong><strong>唯有将复杂性极其优雅地封装于底层（System Complexity），用户方能在表层享受到真正的简单（User Simplicity）。</strong></strong></p>
<p><strong><strong>2. 从“全民开发”到“专业级融合”</strong></strong></p>
<p>行业曾幻想“人人都是开发者（Citizen Developer）”，但现实证明，业务人员需要的不是简陋的玩具，而是能与专业 IT 平等对话的平台。 Mendix 废止 Web 端 IDE，标志着低代码不再是业务人员的“自留地”，而是“业务与 IT 的融合场（Fusion Teams）”。</p>
<ul>
<li>在这里，业务人员不再是“被降级的用户”，而是被工具赋能的逻辑构建者。</li>
<li>在这里，Git 不再是程序员的特权，而是通过可视化封装，成为了全员共识的协作协议。</li>
</ul>
<p><strong><strong>3. 为 AI 铺设的“数字铁轨”</strong></strong></p>
<p>当我们目光投向未来，Mendix 的架构价值愈发凸显。 在 AIGC 时代，AI 不缺生成能力，缺的是“可控的上下文”。</p>
<ul>
<li>松散的、非结构化的平台，只能让 AI 生成难以维护的“面条代码”。</li>
<li>而 Mendix 构建的这座基于 <strong><strong>GUID + DSL + 统一语境</strong></strong> 的大厦，本质上是为 AI 铺设了标准的“数字铁轨”。</li>
</ul>
<p>在此架构下，AI 不再是只会闲聊的 Chatbot，而是能精准读取模型、理解依赖、预判冲突的“超级副驾”。它让软件开发真正从“手工作坊”迈向了“人机共创的工业化时代”。</p>
<p><strong><strong>最终建议：</strong></strong> 对于企业的技术决策者而言，在评估低代码平台时，请勿被“拖拽有多快”的 Demo 蒙蔽双眼。请深入底层，审视它是如何处理版本冲突、如何定义模型。 因为，<strong><strong>只有那些尊重软件工程本质、敢于用硬核技术解决“脏活累活”的平台，才配得上承载企业未来的核心业务。</strong></strong></p>
<p><strong>关于Mendix公司</strong><br/>
作为西门子Xcelerator平台的低代码引擎，Mendix正在迅速成为推动企业数字化发展的首选应用程序开发平台。Mendix让企业能够以前所未有的速度构建应用程序、促进IT团队与业务专家之间开展有意义的协作，并帮助IT团队保持对整个应用程序环境的控制。作为一直被领先的行业分析师视为“领军者和远见者”的低代码平台，Mendix是云原生的、开放的、可扩展的、敏捷的，并且经过实践验证。从人工智能和增强现实，到智能自动化和原生移动，Mendix和西门子Xcelerator已成为“数字优先”企业的中坚力量。Mendix已被46个国家的4,000多家企业采用，并建立了由30多万名开发人员组成的活跃社区，这些开发人员使用该平台创建了20多万款应用程序。</p>
<p>​</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MybatisPlus工具（详细教程）]]></title>    <link>https://juejin.cn/post/7599268297203023910</link>    <guid>https://juejin.cn/post/7599268297203023910</guid>    <pubDate>2026-01-26T03:02:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297203023910" data-draft-id="7599268297202991142" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MybatisPlus工具（详细教程）"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T03:02:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优秀的颜"/> <meta itemprop="url" content="https://juejin.cn/user/960313319521178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MybatisPlus工具（详细教程）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/960313319521178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优秀的颜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:02:59.000Z" title="Mon Jan 26 2026 03:02:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MybatisPlus</h2>
<p>简介：是一个 MyBatis 的增强工具</p>
<p>官方网站：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaomidou.com%2F" target="_blank" title="https://baomidou.com/" ref="nofollow noopener noreferrer">baomidou.com/</a></p>
<p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaomidou.com%2Fpages%2F24112f%2F" target="_blank" title="https://baomidou.com/pages/24112f/" ref="nofollow noopener noreferrer">baomidou.com/pages/24112…</a></p>
<h3 data-id="heading-1">基本使用</h3>
<p><strong>导入包：</strong></p>
<pre><code class="hljs language-xml" lang="xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.4.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span>
</code></pre>
<p><strong>数据源配置：</strong></p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-attr">spring:</span>
  <span class="hljs-attr">datasource:</span>
    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.jdbc.Driver</span>
    <span class="hljs-comment"># 如果使用 MySQL8 驱动不同，增加时区的配置 serverTimezone=GMT%2B8</span>
    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://xx:3306/数据库?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8</span>
    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span>
    <span class="hljs-attr">password:</span> <span class="hljs-number">123456</span>
<span class="hljs-attr">mybatis-plus:</span>
  <span class="hljs-attr">configuration:</span>
    <span class="hljs-attr">log-impl:</span> <span class="hljs-string">org.apache.ibatis.logging.stdout.StdOutImpl</span> <span class="hljs-comment"># 默认日志</span>
  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:/mapper/**/*.xml</span>
</code></pre>
<p><strong>基本使用：</strong></p>
<p>启动类增加扫描mapper文件夹，省略@mapper注解</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@MapperScan("指定Mapper接口所在的包")</span>
</code></pre>
<p>mapper层编写</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Repository</span> <span class="hljs-comment">// 持久层</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BillMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Bill&gt; {}
</code></pre>
<p>service层编写</p>
<p>需要继承IService</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BillService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Bill&gt; {}
</code></pre>
<p>service实现类编写</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BillServiceImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ServiceImpl</span>&lt;BillMapper, Bill&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BillService</span> {}
</code></pre>
<h3 data-id="heading-2">常用注解</h3>
<h4 data-id="heading-3">TableName</h4>
<p>实体对应表名</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@TableName("wms_ware_info")</span>
</code></pre>
<h4 data-id="heading-4">TableId</h4>
<p>主键注解</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@TableId(value = "bid",type = IdType.AUTO)</span>
</code></pre>
<p>type类型常见值：</p>
<ul>
<li>AUTO	数据库ID自增</li>
<li>NONE	无状态</li>
<li>INPUT	insert前自行set主键值</li>
<li>ASSIGN_ID	雪花算法生产id</li>
<li>ASSIGN_UUID	UUID</li>
<li>ID_WORKER	分布式全局唯一ID，长整型类型，32位UUID字符串</li>
<li>ID_WORKER_STR	分布式全局唯一ID 字符串类型</li>
</ul>
<p>注意：雪花算法：分布式ID生成算法，结果是一个long型的ID</p>
<h4 data-id="heading-5">TbaleField</h4>
<p>设置实体类中的属性名和字段名注解</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@TbaleField("user_name")</span>
</code></pre>
<pre><code class="hljs language-java" lang="java"># 表中新增字段 create_time，update_time 创建时间/修改时间
<span class="hljs-meta">@TableField(fill = FieldFill.INSERT)</span>
<span class="hljs-keyword">private</span> Date createTime;
<span class="hljs-meta">@TableField(fill = FieldFill.INSERT_UPDATE)</span>
<span class="hljs-keyword">private</span> Date updateTime;

# 如果为<span class="hljs-literal">null</span>，字段也更新为<span class="hljs-literal">null</span>
<span class="hljs-meta">@TableField(updateStrategy = FieldStrategy.IGNORED)</span>

# 表示不是数据库里的字段
<span class="hljs-meta">@TableField(exist = false)</span>
    
# MyMetaObjectHandler类
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMetaObjectHandler</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">MetaObjectHandler</span> {
    <span class="hljs-comment">// 插入时的填充策略</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        log.info(<span class="hljs-string">"start insert fill ...."</span>);
        <span class="hljs-built_in">this</span>.strictInsertFill(metaObject, <span class="hljs-string">"createTime"</span>, Date.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
    }

    <span class="hljs-comment">// 更新时的填充策略</span>
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateFill</span><span class="hljs-params">(MetaObject metaObject)</span> {
        log.info(<span class="hljs-string">"start update fill ...."</span>);
        <span class="hljs-built_in">this</span>.strictUpdateFill(metaObject, <span class="hljs-string">"updateTime"</span>, Date.class, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());
    }
}
</code></pre>
<h4 data-id="heading-6">TableLogic</h4>
<p>逻辑删除 （假删除）</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 逻辑删除  value 1：未删除的值  、delval 0 ：删除后的值</span>
<span class="hljs-meta">@TableLogic(value = "1", delval = "0")</span>
<span class="hljs-keyword">private</span> Integer isDeleted; <span class="hljs-comment">// 默认0 未删除 1已删除</span>
# 配置文件
  logic-delete-field: flag  # 全局逻辑删除的实体字段名
  logic-delete-value: <span class="hljs-number">1</span>     # 逻辑已删除值(默认为 <span class="hljs-number">1</span>)
  logic-not-delete-value: <span class="hljs-number">0</span> # 逻辑未删除值(默认为 <span class="hljs-number">0</span>)
</code></pre>
<h4 data-id="heading-7">通用枚举</h4>
<p>设置枚举类、实体字段设置</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SexEnum</span> {
    MALE(<span class="hljs-number">1</span>, <span class="hljs-string">"男"</span>),
    FEMALE(<span class="hljs-number">2</span>, <span class="hljs-string">"女"</span>);

    <span class="hljs-meta">@EnumValue</span> <span class="hljs-comment">//将注解所标识的属性的值存储到数据库中</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> sex;
    <span class="hljs-keyword">private</span> String sexName;

    SexEnum(Integer sex, String sexName) {
        <span class="hljs-built_in">this</span>.sex = sex;
        <span class="hljs-built_in">this</span>.sexName = sexName;
    }
}

# 实体字段设置
<span class="hljs-keyword">private</span> SexEnum sex;

# 配置文件 - 增加配置
# 扫描通用枚举的包
type-enums-<span class="hljs-keyword">package</span>: com.atguigu.mybatisplus.enums    
</code></pre>
<p>测试</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>{
    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();
    user.setName(<span class="hljs-string">"admin"</span>);
    user.setSex(SexEnum.MALE);  <span class="hljs-comment">// 保持数据库是key值</span>
    <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.insert(user);
}
</code></pre>
<h3 data-id="heading-8">基本API</h3>
<p>Mapper层</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1. 查询全部数据</span>
List&lt;Emp&gt; emps = empMapper.selectList(<span class="hljs-literal">null</span>);

<span class="hljs-comment">// 2. 新增</span>
<span class="hljs-type">Emp</span> <span class="hljs-variable">emp1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>();
emp1.setAge(<span class="hljs-number">13</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">insert</span> <span class="hljs-operator">=</span> empMapper.insert(emp1);

<span class="hljs-comment">// 3. 删除</span>
<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> empMapper.deleteById(<span class="hljs-number">9L</span>); <span class="hljs-comment">// 参数id</span>
<span class="hljs-comment">// 3.1 批量删除</span>
<span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> empMapper.deleteBatchIds(Arrays.asList(<span class="hljs-number">11L</span>, <span class="hljs-number">10L</span>));
<span class="hljs-comment">// 3.2 根据条件删除  注：key 是表字段</span>
Map&lt;String,Object&gt; mapdel = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
mapdel.put(<span class="hljs-string">"name"</span>,<span class="hljs-string">"修改的"</span>);
empMapper.deleteByMap(mapdel);

<span class="hljs-comment">// 4. 修改</span>
<span class="hljs-type">Emp</span> <span class="hljs-variable">emp2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>();
emp2.setId(<span class="hljs-number">12</span>);
emp2.setName(<span class="hljs-string">"修改的"</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> empMapper.updateById(emp2);

<span class="hljs-comment">// 5. 查询 </span>
<span class="hljs-type">Emp</span> <span class="hljs-variable">empO</span> <span class="hljs-operator">=</span> empMapper.selectById(<span class="hljs-number">12L</span>);
List&lt;Emp&gt; all = empMapper.selectBatchIds(Arrays.asList(<span class="hljs-number">1L</span>, <span class="hljs-number">2L</span>));
System.out.println(all);
<span class="hljs-comment">// 5.1 根据查询条件查询，注：key 是表字段</span>
Map&lt;String,Object&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(); 
map.put(<span class="hljs-string">"name"</span>,<span class="hljs-string">"修改的"</span>);map.put(<span class="hljs-string">"age"</span>,<span class="hljs-string">"13"</span>);
List&lt;Emp&gt; bills = empMapper.selectByMap(map);
</code></pre>
<p>Service层</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 1.查出总记录数</span>
<span class="hljs-type">long</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> empService.count();
<span class="hljs-comment">// long count2 = empService.count(new QueryWrapper&lt;Emp&gt;());</span>
System.out.println(count);
<span class="hljs-comment">// 2.根据主键id查询</span>
<span class="hljs-type">Emp</span> <span class="hljs-variable">byId</span> <span class="hljs-operator">=</span> empService.getById(<span class="hljs-number">3L</span>);
<span class="hljs-comment">// 3.查询全部</span>
List&lt;Emp&gt; all = empService.list();
<span class="hljs-comment">// List&lt;Emp&gt; all2 = empService.list(new QueryWrapper&lt;Emp&gt;());</span>
System.out.println(all);

<span class="hljs-comment">// 4.新增</span>
empService.save(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>());
<span class="hljs-comment">// 5.修改</span>
empService.updateById(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>());
<span class="hljs-comment">// empService.update(new QueryWrapper&lt;Emp&gt;());</span>
<span class="hljs-comment">// 6.新增或修改 ， 有主键代表修改，否则新增</span>
empService.saveOrUpdate(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>());
<span class="hljs-comment">// 7.批量新增</span>
List&lt;Emp&gt; alls = Arrays.asList(
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>(<span class="hljs-string">"王1"</span>, <span class="hljs-number">1</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>(<span class="hljs-string">"琳2"</span>, <span class="hljs-number">33</span>),
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Emp</span>(<span class="hljs-string">"凯3"</span>, <span class="hljs-number">32</span>));
<span class="hljs-type">boolean</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> empService.saveBatch(alls);
<span class="hljs-comment">// 8.批量新增或修改 ， 有主键代表修改，否则新增</span>
empService.saveOrUpdateBatch(alls);

<span class="hljs-comment">// 9.根据主键 删除</span>
empService.removeById(<span class="hljs-number">20L</span>);
empService.remove(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;Emp&gt;());
<span class="hljs-comment">// 10.批量删除</span>
empService.removeBatchByIds(Arrays.asList(<span class="hljs-number">11L</span>, <span class="hljs-number">10L</span>));
</code></pre>
<h3 data-id="heading-9">条件构造器</h3>
<p>Wrapper介绍：</p>
<p>Wrapper  条件构造抽象类</p>
<p>AbstractWrapper 用于查询条件封装，生成 sql 的 where 条件</p>
<ul>
<li>QueryWrapper   查询条件封装</li>
<li>UpdateWrapper 修改条件</li>
<li>AbstractLambdaWrapper 使用Lambda 语法，它还有LambdaQueryWrapper  、LambdaUpdateWrapper</li>
</ul>
<h4 data-id="heading-10">QueryWrapper：</h4>
<p><strong>查询条件</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">//查询用户名包含a，年龄在20到30之间，邮箱信息不为null的用户信息</span>
QueryWrapper&lt;User&gt; q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();
q.like(<span class="hljs-string">"username"</span>,<span class="hljs-string">"a"</span>).between(<span class="hljs-string">"age"</span>,<span class="hljs-number">20</span>,<span class="hljs-number">30</span>).isNotNull(<span class="hljs-string">"email"</span>);
<span class="hljs-comment">//排序条件 orderByDesc 降序 orderByAsc 升序</span>
q.orderByDesc(<span class="hljs-string">"age"</span>).orderByAsc(<span class="hljs-string">"id"</span>);
List&lt;User&gt; users = userMapper.selectList(q);
users.forEach(System.out::println);
</code></pre>
<p><strong>删除条件</strong></p>
<pre><code class="hljs language-java" lang="java"> QueryWrapper&lt;User&gt; q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();
 q.isNull(<span class="hljs-string">"email"</span>);
 <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.delete(q);
 System.out.println(result &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">"删除成功！"</span> : <span class="hljs-string">"删除失败！"</span>);
</code></pre>
<p><strong>条件的优先级</strong></p>
<pre><code class="hljs language-java" lang="java">QueryWrapper&lt;User&gt; q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();
q.select(<span class="hljs-string">"bill_name"</span>,<span class="hljs-string">"bill_num"</span>,<span class="hljs-string">"pay"</span>); <span class="hljs-comment">// select查询 只显示这几个字段，其他字段不显示</span>
<span class="hljs-comment">// ge 大于等于 gt 大于 le 小于等于  lt 小于  eq 等于 ne 不等 </span>
<span class="hljs-comment">// between 范围 notBetween  in  notIn</span>
<span class="hljs-comment">// like  notLike  likeLeft (LIKE '%值’)  likeRight (LIKE’值%’)</span>
<span class="hljs-comment">// isNull  isNotNull</span>
<span class="hljs-comment">// inSql  字段IN ( sql语句)  notInSql</span>
<span class="hljs-comment">// groupBy 分组  orderByAsc  orderByDesc  orderBy 例：orderBy(true，true,“id”，“name”)—–&gt;order by id ASC, name ASC</span>
<span class="hljs-comment">// having  exists notExists  or  and</span>
q.gt(<span class="hljs-string">"bill_num"</span>,<span class="hljs-number">4</span>)
 .and(i-&gt;{
    i.like(<span class="hljs-string">"bill_name"</span>,<span class="hljs-string">"a"</span>).or().isNull(<span class="hljs-string">"pay"</span>);
 }).isNull(<span class="hljs-string">"pay"</span>);
List&lt;Map&lt;String, Object&gt;&gt; maps = userMapper.selectMaps(q);
</code></pre>
<p><strong>子查询</strong></p>
<pre><code class="hljs language-java" lang="java">QueryWrapper&lt;User&gt; q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();
q.inSql(<span class="hljs-string">"uid"</span>, <span class="hljs-string">"select uid from 表 where uid &lt;= 100"</span>);
List&lt;User&gt; list = userMapper.selectList(q);
</code></pre>
<h4 data-id="heading-11">UpdateWrapper：</h4>
<pre><code class="hljs language-java" lang="java">UpdateWrapper&lt;User&gt; u = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UpdateWrapper</span>&lt;&gt;();
u.like(<span class="hljs-string">"username"</span>,<span class="hljs-string">"a"</span>)
 .set(<span class="hljs-string">"email"</span>,<span class="hljs-string">"修改的字段"</span>).set(<span class="hljs-string">"bill_name"</span>,<span class="hljs-string">"修改的字段2"</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.update(<span class="hljs-literal">null</span>, u);
System.out.println(result &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">"修改成功！"</span> : <span class="hljs-string">"修改失败！"</span>);
</code></pre>
<h4 data-id="heading-12">condition:</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span>  <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a"</span>;
<span class="hljs-type">Integer</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
<span class="hljs-type">Integer</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;
QueryWrapper&lt;User&gt; q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();
<span class="hljs-comment">// 参数 1 boolean值，满足条件会执行</span>
q.like(StringUtils.isNotBlank(a), <span class="hljs-string">"user_name"</span>, a)  
    .ge(b != <span class="hljs-literal">null</span>, <span class="hljs-string">"age"</span>, b)
    .le(c != <span class="hljs-literal">null</span>, <span class="hljs-string">"age"</span>, c);
List&lt;User&gt; list = userMapper.selectList(q);
</code></pre>
<h4 data-id="heading-13">LambdaQueryWrapper：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-type">String</span>  <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-string">"a"</span>;
<span class="hljs-type">Integer</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
<span class="hljs-type">Integer</span> <span class="hljs-variable">c</span> <span class="hljs-operator">=</span> <span class="hljs-number">30</span>;
LambdaQueryWrapper&lt;User&gt; q = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaQueryWrapper</span>&lt;&gt;();
q.like(StringUtils.isNotBlank(a), User::getName, a)
    .ge(b != <span class="hljs-literal">null</span>, User::getAge, b)
    .le(c != <span class="hljs-literal">null</span>, User::getAge, c);
List&lt;User&gt; list = userMapper.selectList(q);
</code></pre>
<h4 data-id="heading-14">LambdaUpdateWrapper：</h4>
<pre><code class="hljs language-java" lang="java">LambdaUpdateWrapper&lt;User&gt; u = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LambdaUpdateWrapper</span>&lt;&gt;();
u.like(User::getName, <span class="hljs-string">"a"</span>).isNull(User::getEmail));
u.set(User::getName, <span class="hljs-string">"小黑"</span>).set(User::getEmail,<span class="hljs-string">"xxx"</span>);
<span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> userMapper.update(<span class="hljs-literal">null</span>, u);
</code></pre>
<h3 data-id="heading-15">常用插件</h3>
<h4 data-id="heading-16">分页</h4>
<p><strong>配置类</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@MapperScan("com.yan.mybatis.mapper")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisPlusConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span>{
        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();
        <span class="hljs-comment">// 添加分页插件 - 指向数据库类型</span>
        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));
        <span class="hljs-keyword">return</span> interceptor;
    }
}
</code></pre>
<p><strong>测试</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>{
    <span class="hljs-comment">// 参数：当前页、显示条数、查询条件</span>
    Page&lt;Bill&gt; page = billMapper.selectPage(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>), <span class="hljs-literal">null</span>);
    List&lt;Bill&gt; users = page.getRecords();
    users.forEach(System.out::println);
    System.out.println(page.getRecords());  <span class="hljs-comment">// 获取记录数</span>
    System.out.println(page.getSize());     <span class="hljs-comment">// 获取显示条数</span>
    System.out.println(page.getCurrent());  <span class="hljs-comment">// 获取当前页的页码</span>
    System.out.println(page.getPages());    <span class="hljs-comment">// 获取总页码</span>
    System.out.println(page.getTotal());    <span class="hljs-comment">// 获取总记录数</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">b1</span> <span class="hljs-operator">=</span> page.hasNext();      <span class="hljs-comment">// 是否有下一页</span>
    <span class="hljs-type">boolean</span> <span class="hljs-variable">b2</span> <span class="hljs-operator">=</span> page.hasPrevious();  <span class="hljs-comment">// 是否有上一页</span>
}
</code></pre>
<p><strong>自定义分页</strong></p>
<pre><code class="hljs language-java" lang="java"># Mapper层定义
Page&lt;User&gt; <span class="hljs-title function_">selectPageVo</span><span class="hljs-params">(<span class="hljs-meta">@Param("page")</span> Page&lt;User&gt; page,<span class="hljs-meta">@Param("age")</span> Integer age)</span>;

# XMl定义
&lt;select id=<span class="hljs-string">"selectPageVo"</span> resultType=<span class="hljs-string">"User"</span>&gt;
    select * from t_user where age &gt; #{age}
&lt;/select&gt;    

# 测试
Page&lt;User&gt; page = userMapper.selectPageVo(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Page</span>&lt;User&gt;(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>), <span class="hljs-number">20</span>);
List&lt;User&gt; users = page.getRecords();    
</code></pre>
<h4 data-id="heading-17">乐观锁</h4>
<p>乐观锁：保持乐观状态，无论干什么都不会上锁，如果有问题就再次更新值测试。（版本号version）</p>
<p>悲观锁：总是认为总会出现问题，无论干什么都会上锁后再去操作。</p>
<p><strong>配置类</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-meta">@MapperScan("com.yan.mybatis.mapper")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyBatisPlusConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> MybatisPlusInterceptor <span class="hljs-title function_">mybatisPlusInterceptor</span><span class="hljs-params">()</span>{
        <span class="hljs-type">MybatisPlusInterceptor</span> <span class="hljs-variable">interceptor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">MybatisPlusInterceptor</span>();
        <span class="hljs-comment">// 添加分页插件 - 指向数据库类型</span>
        interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">PaginationInnerInterceptor</span>(DbType.MYSQL));
        <span class="hljs-comment">//添加乐观锁插件</span>
    	interceptor.addInnerInterceptor(<span class="hljs-keyword">new</span> <span class="hljs-title class_">OptimisticLockerInnerInterceptor</span>());
        <span class="hljs-keyword">return</span> interceptor;
    }
}
</code></pre>
<p><strong>实体字段增加注解</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Version</span>  <span class="hljs-comment">// 标识乐观锁版本号字段</span>
<span class="hljs-keyword">private</span> String version;
</code></pre>
<p><strong>测试</strong></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test1</span><span class="hljs-params">()</span>{
    <span class="hljs-comment">// 1.B1 获得的值</span>
    <span class="hljs-type">Bill</span> <span class="hljs-variable">b1</span> <span class="hljs-operator">=</span> billMapper.selectById(<span class="hljs-number">16</span>);
    System.out.println(<span class="hljs-string">"B1 ："</span> + b1.getMoney());
    <span class="hljs-comment">// 2.B2 获得的值</span>
    <span class="hljs-type">Bill</span> <span class="hljs-variable">b2</span> <span class="hljs-operator">=</span> billMapper.selectById(<span class="hljs-number">16</span>);
    System.out.println(<span class="hljs-string">"B2 ："</span> + b1.getMoney());

    <span class="hljs-comment">// 3.B1 获得的值 + 50</span>
    b1.setMoney(b1.getMoney() + <span class="hljs-number">50</span>);
    billMapper.updateById(b1);

    <span class="hljs-comment">// 4.B2 获得的值 - 30</span>
    b2.setMoney(b2.getMoney()-<span class="hljs-number">30</span>);
    <span class="hljs-type">int</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> billMapper.updateById(b2);
    <span class="hljs-keyword">if</span> (result == <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// 操作失败，重试</span>
        <span class="hljs-type">Bill</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> billMapper.selectById(<span class="hljs-number">16</span>);
        b.setMoney(b.getMoney() - <span class="hljs-number">30</span>);
        billMapper.updateById(b);
    }

    <span class="hljs-comment">// 5.查看 16这条数据 值 - 乐观锁</span>
    <span class="hljs-type">Bill</span> <span class="hljs-variable">bill</span> <span class="hljs-operator">=</span> billMapper.selectById(<span class="hljs-number">16</span>);
    System.out.println(<span class="hljs-string">"Bill ："</span> + bill.getMoney());

}
</code></pre>
<p>注意：</p>
<p>整数类型下 newVersion = oldVersion + 1
newVersion 会回写到 entity 中
仅支持 updateById(id) 与 update(entity, wrapper) 方法
在 update(entity, wrapper) 方法下, wrapper 不能复用</p>
<h4 data-id="heading-18">通用枚举</h4>
<p>枚举类</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.annotation.EnumValue;
<span class="hljs-keyword">import</span> lombok.Getter;

<span class="hljs-comment">/**
 * 枚举
 */</span>
<span class="hljs-meta">@Getter</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">SexEnum</span> {

    ONE(<span class="hljs-number">0</span>, <span class="hljs-string">"未付款"</span>),
    TWO(<span class="hljs-number">1</span>, <span class="hljs-string">"已付款"</span>);

    <span class="hljs-meta">@EnumValue</span> <span class="hljs-comment">// 将注解所标识的属性的值存储到数据库中</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> index;
    <span class="hljs-keyword">private</span> String name;

    SexEnum(Integer index, String name) {
        <span class="hljs-built_in">this</span>.index = index;
        <span class="hljs-built_in">this</span>.name = name;
    }

}
</code></pre>
<p>配置文件需要配置</p>
<pre><code class="hljs language-xml" lang="xml">type-enums-package: cn.good.yan.pojo.conf
</code></pre>
<p>实体需要引用</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">private</span> SexEnum pay;
</code></pre>
<h4 data-id="heading-19">代码生成器</h4>
<p>导入依赖包</p>
<pre><code class="hljs language-java" lang="java">&lt;!-- 代码生成器 --&gt;
&lt;dependency&gt;
   &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
   &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt;
   &lt;version&gt;<span class="hljs-number">3.5</span><span class="hljs-number">.1</span>&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
   &lt;groupId&gt;org.freemarker&lt;/groupId&gt;
   &lt;artifactId&gt;freemarker&lt;/artifactId&gt;
   &lt;version&gt;<span class="hljs-number">2.3</span><span class="hljs-number">.31</span>&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>测试</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 代码生成器</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
    FastAutoGenerator.create(<span class="hljs-string">"jdbc:mysql://127.0.0.1:3306/数据库名?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8"</span>, <span class="hljs-string">"用户名"</span>, <span class="hljs-string">"密码"</span>)
        .globalConfig(builder -&gt; {
            builder.author(<span class="hljs-string">"yan"</span>) <span class="hljs-comment">// 设置作者</span>
                <span class="hljs-comment">// .enableSwagger() // 开启 swagger 模式</span>
                .fileOverride() <span class="hljs-comment">// 覆盖已生成文件</span>
                .outputDir(<span class="hljs-string">"G://xx"</span>); <span class="hljs-comment">// 指定输出目录</span>
        })
        .packageConfig(builder -&gt; {
            builder.parent(<span class="hljs-string">"com.yan"</span>) <span class="hljs-comment">// 设置父包名</span>
                .moduleName(<span class="hljs-string">"mybatis"</span>) <span class="hljs-comment">// 设置父包模块名</span>
                .pathInfo(Collections.singletonMap(OutputFile.mapperXml, <span class="hljs-string">"G://xx/mapper"</span>)); <span class="hljs-comment">// 设置mapperXml生成路径</span>
        })
        .strategyConfig(builder -&gt; {
            builder.addInclude(<span class="hljs-string">"pms_spu_comment"</span>) <span class="hljs-comment">// 设置需要生成的表名</span>
                .addTablePrefix(<span class="hljs-string">"t_"</span>, <span class="hljs-string">"pms_"</span>);    <span class="hljs-comment">// 设置过滤表前缀</span>
        })
        <span class="hljs-comment">// 使用Freemarker引擎模板，默认的是Velocity引擎模板</span>
        .templateEngine(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FreemarkerTemplateEngine</span>()) 
        .execute();
}
</code></pre>
<h4 data-id="heading-20">多数据库</h4>
<p>适用场景：读写分离、一主一从、多库</p>
<p>导入依赖包</p>
<pre><code class="hljs language-java" lang="java">&lt;!-- 多数据源 --&gt;
&lt;dependency&gt;
   &lt;groupId&gt;com.baomidou&lt;/groupId&gt;
   &lt;artifactId&gt;dynamic-datasource-spring-boot-starter&lt;/artifactId&gt;
   &lt;version&gt;<span class="hljs-number">3.5</span><span class="hljs-number">.0</span>&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p>更改配置</p>
<pre><code class="hljs language-xml" lang="xml">spring:
  datasource:
    # 配置多数据源
    dynamic:
      # 设置默认的数据源或者数据源组,默认值即为master
      primary: master
      # 严格匹配数据源,默认false 如：true未匹配到指定数据源时抛异常,false使用默认数据源，也就是主数据源
      strict: false
      datasource:
        master:
          url: jdbc:mysql://127.0.0.1:3306/数据库1?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8
          driver-class-name: com.mysql.cj.jdbc.Driver
          username: 用户名
          password: 密码
        slave:
          url: jdbc:mysql://127.0.0.1:3306/数据库2?useUnicode=true&amp;characterEncoding=UTF-8&amp;serverTimezone=GMT%2B8
          driver-class-name: com.mysql.cj.jdbc.Driver
          username: 用户名
          password: 密码
</code></pre>
<p>指定操作数据源</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-comment">// 指定操作的数据源，master  - 也可以放在具体的方法上，和类上，就近原则取对应的数据源</span>
<span class="hljs-meta">@DS("master")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;User&gt; {}
<span class="hljs-comment">// ---</span>
<span class="hljs-meta">@DS("slave")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">BillService</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">IService</span>&lt;Bill&gt; {}
</code></pre>
<p>测试</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> BillService billService;
<span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> UserService userService;

<span class="hljs-meta">@Test</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>{
    <span class="hljs-type">Bill</span> <span class="hljs-variable">b1</span> <span class="hljs-operator">=</span> billService.getById(<span class="hljs-number">16</span>);
    System.out.println(b1);

    <span class="hljs-type">User</span> <span class="hljs-variable">u1</span> <span class="hljs-operator">=</span> userService.getById(<span class="hljs-number">2</span>);
    System.out.println(u1);
}
</code></pre>
<h4 data-id="heading-21">MyBatisX插件</h4>
<p>MyBatisX一款基于 IDEA 的快速开发插件，简化我们开发。在IDEA的插件里进行下载MyBatisX。</p>
<p>IDEA中与数据库建立链接：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d6716cd292544a4ebfe3974eaa910b95~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001379&amp;x-signature=GA0wuLxzsIhuFo1iDeR3ACEzvO4%3D" loading="lazy"/>
<p>找到我们要生成的表</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e52fda65d1d4a7e9c02dca55af0af77~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001379&amp;x-signature=DPuIzuIStKypSwYBf5QzWgxjwyQ%3D" alt="image-20220911234032561" loading="lazy"/>
<p>然后点击，填写第一页</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/b48ee838728d4af99c94b5f430379bd3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001379&amp;x-signature=0bDMQZQOPhXlVjh6tmwyXR%2BXKB0%3D" alt="image-20220911234904774" loading="lazy"/>
<p>填写第二页 <img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f249282a51b84eb79aee0e8a323624c6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001379&amp;x-signature=KXZ6ZRq528gsqVKjSnzZlSwdBiQ%3D" loading="lazy"/></p>
<p>操作完成 - 快速生成对应的文件</p>
<p>然后我们开发过程中快速生成CRUD操作：</p>
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8df592bb8ec2402e9c1b370633823ed1~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LyY56eA55qE6aKc:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770001379&amp;x-signature=TzcRZnxnM1A5%2B9FFf48kJqPVb3Q%3D" alt="image-20220911235946963" loading="lazy"/>
<p>选择这个，可以快速生产对应的代码和XML映射文件</p>
<p>感谢观看，代码案例：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgitee.com%2Fyan418%2Fmybatis-plus" target="_blank" title="https://gitee.com/yan418/mybatis-plus" ref="nofollow noopener noreferrer">优秀的颜/MybatisPlus</a></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[__CFRunLoopDoObservers函数详解]]></title>    <link>https://juejin.cn/post/7598938568431026191</link>    <guid>https://juejin.cn/post/7598938568431026191</guid>    <pubDate>2026-01-26T03:27:24.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598938568431026191" data-draft-id="7598918127578136610" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="__CFRunLoopDoObservers函数详解"/> <meta itemprop="keywords" content="iOS"/> <meta itemprop="datePublished" content="2026-01-26T03:27:24.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="iOS在入门"/> <meta itemprop="url" content="https://juejin.cn/user/4037062426627758"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            __CFRunLoopDoObservers函数详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4037062426627758/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    iOS在入门
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:27:24.000Z" title="Mon Jan 26 2026 03:27:24 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">__CFRunLoopDoObservers 函数逐行注释</h2>
<h3 data-id="heading-1">函数概述</h3>
<p><code>__CFRunLoopDoObservers</code> 是 RunLoop 中负责触发观察者回调的核心函数。当 RunLoop 的状态发生变化时（如即将进入循环、即将处理 Timer、即将处理 Source 等），这个函数会被调用来通知所有注册的观察者。</p>
<h3 data-id="heading-2">函数签名</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* rl is locked, rlm is locked on entrance and exit */</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> __CFRunLoopDoObservers(CFRunLoopRef, CFRunLoopModeRef, CFRunLoopActivity) __attribute__((noinline));
</code></pre>
<h4 data-id="heading-3">注释说明</h4>
<ul>
<li><strong>锁状态约定</strong>: 函数入口和出口时，<code>rl</code>（RunLoop）和 <code>rlm</code>（RunLoopMode）都必须处于加锁状态</li>
<li><strong>noinline 属性</strong>: 防止编译器内联优化此函数，可能是为了：
<ul>
<li>便于调试和性能分析</li>
<li>保持调用栈的可读性</li>
<li>控制代码大小</li>
</ul>
</li>
</ul>
<h4 data-id="heading-4">参数说明</h4>
<ul>
<li><code>CFRunLoopRef rl</code>: 当前运行的 RunLoop</li>
<li><code>CFRunLoopModeRef rlm</code>: 当前的 RunLoop Mode</li>
<li><code>CFRunLoopActivity activity</code>: 当前 RunLoop 的活动状态（枚举值）</li>
</ul>
<h3 data-id="heading-5">RunLoop Activity 状态枚举</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-keyword">typedef</span> <span class="hljs-title function_">CF_OPTIONS</span><span class="hljs-params">(CFOptionFlags, CFRunLoopActivity)</span> {
    kCFRunLoopEntry         = (<span class="hljs-number">1UL</span> &lt;&lt; <span class="hljs-number">0</span>),  <span class="hljs-comment">// 即将进入 RunLoop</span>
    kCFRunLoopBeforeTimers  = (<span class="hljs-number">1UL</span> &lt;&lt; <span class="hljs-number">1</span>),  <span class="hljs-comment">// 即将处理 Timer</span>
    kCFRunLoopBeforeSources = (<span class="hljs-number">1UL</span> &lt;&lt; <span class="hljs-number">2</span>),  <span class="hljs-comment">// 即将处理 Source</span>
    kCFRunLoopBeforeWaiting = (<span class="hljs-number">1UL</span> &lt;&lt; <span class="hljs-number">5</span>),  <span class="hljs-comment">// 即将进入休眠</span>
    kCFRunLoopAfterWaiting  = (<span class="hljs-number">1UL</span> &lt;&lt; <span class="hljs-number">6</span>),  <span class="hljs-comment">// 刚从休眠中唤醒</span>
    kCFRunLoopExit          = (<span class="hljs-number">1UL</span> &lt;&lt; <span class="hljs-number">7</span>),  <span class="hljs-comment">// 即将退出 RunLoop</span>
    kCFRunLoopAllActivities = <span class="hljs-number">0x0FFFFFFF</span>U   <span class="hljs-comment">// 所有活动状态</span>
};
</code></pre>
<h3 data-id="heading-6">完整代码逐行注释</h3>
<pre><code class="hljs language-c" lang="c"><span class="hljs-comment">/* DOES CALLOUT */</span>
<span class="hljs-comment">// 【重要标注】此函数会执行外部回调（callout），可能导致：</span>
<span class="hljs-comment">// 1. 长时间阻塞（回调函数耗时）</span>
<span class="hljs-comment">// 2. 重入问题（回调中可能再次操作 RunLoop）</span>
<span class="hljs-comment">// 3. 死锁风险（因此需要在回调前解锁）</span>
<span class="hljs-type">static</span> <span class="hljs-type">void</span> __CFRunLoopDoObservers(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFRunLoopActivity activity) {
    
    <span class="hljs-comment">// ==================== 第一部分：性能追踪和初始化 ====================</span>
    
    
    <span class="hljs-comment">// 📊 记录性能追踪点：开始执行 observers</span>
    <span class="hljs-comment">// 参数：事件类型、RunLoop、Mode、活动状态、额外参数</span>
    <span class="hljs-comment">// 可用 Instruments 的 kdebug 工具查看</span>
    cf_trace(KDEBUG_EVENT_CFRL_IS_DOING_OBSERVERS | DBG_FUNC_START, rl, rlm, activity, <span class="hljs-number">0</span>);
    
    <span class="hljs-comment">// 🔒 检查进程是否被 fork</span>
    <span class="hljs-comment">// 如果在 fork 后的子进程中，需要重新初始化 RunLoop 的锁和状态</span>
    <span class="hljs-comment">// 防止继承父进程的锁状态导致死锁</span>
    CHECK_FOR_FORK();

    <span class="hljs-comment">// ==================== 第二部分：检查观察者数量 ====================</span>
    
    <span class="hljs-comment">// 获取当前 Mode 中观察者的数量</span>
    <span class="hljs-comment">// 三目运算符防止 _observers 为 NULL 时崩溃</span>
    CFIndex cnt = rlm-&gt;_observers ? CFArrayGetCount(rlm-&gt;_observers) : <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// 快速退出：如果没有观察者，直接返回</span>
    <span class="hljs-comment">// 注意：此时仍持有锁，但不需要手动解锁（调用者会处理）</span>
    <span class="hljs-keyword">if</span> (cnt &lt; <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
    

    <span class="hljs-comment">// ==================== 第三部分：分配观察者收集数组 ====================</span>
    
    <span class="hljs-comment">/* Fire the observers */</span>
    <span class="hljs-comment">// 📦 声明栈上缓冲区，避免小数组的堆分配开销</span>
    <span class="hljs-comment">// - 如果观察者数量 ≤ 1024：在栈上分配 cnt 个元素的数组</span>
    <span class="hljs-comment">// - 如果观察者数量 &gt; 1024：在栈上分配 1 个元素（占位符）</span>
    <span class="hljs-comment">// 栈分配速度快，但空间有限（通常几 MB）</span>
    STACK_BUFFER_DECL(CFRunLoopObserverRef, buffer, (cnt &lt;= <span class="hljs-number">1024</span>) ? cnt : <span class="hljs-number">1</span>);
    
    <span class="hljs-comment">// 🎯 确定最终使用的数组指针</span>
    <span class="hljs-comment">// - 小数组（≤1024）：使用栈缓冲区（快速，无需释放）</span>
    <span class="hljs-comment">// - 大数组（&gt;1024）：堆分配（慢，但可容纳更多元素）</span>
    <span class="hljs-comment">// 1024 是经验阈值，平衡性能和栈空间使用</span>
    CFRunLoopObserverRef *collectedObservers = (cnt &lt;= <span class="hljs-number">1024</span>) ? buffer : (CFRunLoopObserverRef *)<span class="hljs-built_in">malloc</span>(cnt * <span class="hljs-keyword">sizeof</span>(CFRunLoopObserverRef));
    
    <span class="hljs-comment">// 实际收集到的观察者计数器（可能小于 cnt）</span>
    CFIndex obs_cnt = <span class="hljs-number">0</span>;
    
    <span class="hljs-comment">// ==================== 第四部分：收集需要触发的观察者 ====================</span>
    
    <span class="hljs-comment">// 遍历 Mode 中的所有观察者</span>
    <span class="hljs-keyword">for</span> (CFIndex idx = <span class="hljs-number">0</span>; idx &lt; cnt; idx++) {
        
        <span class="hljs-comment">// 获取第 idx 个观察者对象</span>
        CFRunLoopObserverRef rlo = (CFRunLoopObserverRef)CFArrayGetValueAtIndex(rlm-&gt;_observers, idx);
        
        
        <span class="hljs-comment">// 🔍 三重过滤条件（必须全部满足）：</span>
            
        <span class="hljs-comment">// 条件1: 0 != (rlo-&gt;_activities &amp; activity)</span>
        <span class="hljs-comment">// 按位与检查观察者是否关注当前活动状态</span>
        <span class="hljs-comment">// 例如：activity = kCFRunLoopBeforeTimers (0b10)</span>
        <span class="hljs-comment">// _activities = kCFRunLoopBeforeTimers | kCFRunLoopExit (0b10000010)</span>
        <span class="hljs-comment">// 按位与结果 = 0b10 != 0，条件成立</span>

        <span class="hljs-comment">// 条件2: __CFIsValid(rlo)</span>
        <span class="hljs-comment">// 检查观察者是否有效（未被 invalidate）</span>
        <span class="hljs-comment">// 观察者可能在之前的回调中被标记为无效</span>

        <span class="hljs-comment">// 条件3: !__CFRunLoopObserverIsFiring(rlo)</span>
        <span class="hljs-comment">// 检查观察者是否正在执行回调</span>
        <span class="hljs-comment">// 防止重入：如果观察者的回调函数中再次触发相同的 activity，</span>
        <span class="hljs-comment">// 不会重复调用该观察者（避免无限递归）</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-number">0</span> != (rlo-&gt;_activities &amp; activity) &amp;&amp; __CFIsValid(rlo) &amp;&amp; !__CFRunLoopObserverIsFiring(rlo)) {
            
            <span class="hljs-comment">// ✅ 满足条件的观察者：</span>
            <span class="hljs-comment">// 1. 添加到收集数组</span>
            <span class="hljs-comment">// 2. 增加引用计数（CFRetain）</span>
            <span class="hljs-comment">//    - 防止在后续解锁期间被其他线程释放</span>
            <span class="hljs-comment">//    - 保证回调执行时对象仍然有效</span>
            <span class="hljs-comment">// 3. obs_cnt 递增</span>
            collectedObservers[obs_cnt++] = (CFRunLoopObserverRef)CFRetain(rlo);
        }
    }
    
    <span class="hljs-comment">// ==================== 第五部分：解锁（准备执行回调）====================</span>
    
    <span class="hljs-comment">// 🔓 解锁 RunLoop Mode</span>
    __CFRunLoopModeUnlock(rlm);
    
    <span class="hljs-comment">// 🔓 解锁 RunLoop</span>
    __CFRunLoopUnlock(rl);
    
    <span class="hljs-comment">// ⚠️ 为什么要解锁？</span>
    <span class="hljs-comment">// 1. 避免死锁：观察者回调可能会调用 RunLoop API（如添加 Timer、Source）</span>
    <span class="hljs-comment">// 2. 提高并发：允许其他线程在回调执行期间访问 RunLoop</span>
    <span class="hljs-comment">// 3. 防止长时间持锁：回调可能耗时很长（如网络请求、UI 更新）</span>
    
    <span class="hljs-comment">// 🛡️ 安全性保证：</span>
    <span class="hljs-comment">// - 已经通过 CFRetain 增加了观察者的引用计数</span>
    <span class="hljs-comment">// - collectedObservers 数组是当前线程的局部变量</span>
    <span class="hljs-comment">// - 即使其他线程修改了 rlm-&gt;_observers，也不会影响本次执行</span>
    
    <span class="hljs-comment">// ==================== 第六部分：执行观察者回调 ====================</span>
    
    <span class="hljs-comment">// 遍历收集到的观察者（注意：不是遍历 rlm-&gt;_observers）</span>
    <span class="hljs-keyword">for</span> (CFIndex idx = <span class="hljs-number">0</span>; idx &lt; obs_cnt; idx++) {
        
        <span class="hljs-comment">// 获取当前观察者</span>
        CFRunLoopObserverRef rlo = collectedObservers[idx];
        
        <span class="hljs-comment">// 🔒 锁定观察者对象（细粒度锁）</span>
        <span class="hljs-comment">// 只锁定单个观察者，不影响其他观察者的并发执行</span>
        __CFRunLoopObserverLock(rlo);
        
        <span class="hljs-comment">// 再次检查观察者是否有效</span>
        <span class="hljs-comment">// ⚠️ 为什么要再次检查？</span>
        <span class="hljs-comment">// 在解锁期间，其他线程可能已经调用了 CFRunLoopObserverInvalidate</span>
        <span class="hljs-keyword">if</span> (__CFIsValid(rlo)) {
            
            <span class="hljs-comment">// 检查观察者是否是一次性的（non-repeating）</span>
            <span class="hljs-comment">// 如果是一次性的，执行完回调后需要 invalidate</span>
            Boolean doInvalidate = !__CFRunLoopObserverRepeats(rlo);
            
            <span class="hljs-comment">// 🚩 设置"正在执行"标志位</span>
            <span class="hljs-comment">// 防止重入（与前面的 !__CFRunLoopObserverIsFiring 配合）</span>
            __CFRunLoopObserverSetFiring(rlo);
            
            <span class="hljs-comment">// 🔓 在执行回调前解锁观察者</span>
            <span class="hljs-comment">// 原因同解锁 RunLoop：防止回调中访问观察者对象时死锁</span>
            __CFRunLoopObserverUnlock(rlo);
            
            <span class="hljs-comment">// ---------- 提取回调信息 ----------</span>
            
            <span class="hljs-comment">// 提取回调函数指针</span>
            <span class="hljs-comment">// 类型：void (*)(CFRunLoopObserverRef observer, CFRunLoopActivity activity, void *info)</span>
            CFRunLoopObserverCallBack callout = rlo-&gt;_callout;
            
            <span class="hljs-comment">// 提取用户上下文信息（创建观察者时传入的）</span>
            <span class="hljs-type">void</span> *info = rlo-&gt;_context.info;
            
            <span class="hljs-comment">// ---------- 自动释放池 ----------</span>
            
            <span class="hljs-comment">// 🔄 开始自动释放池（ARP = AutoRelease Pool）</span>
            <span class="hljs-comment">// 在 ObjC 运行时环境中，等价于 @autoreleasepool {</span>
            <span class="hljs-comment">// 用于自动管理回调中创建的临时对象</span>
            CFRUNLOOP_ARP_BEGIN(rl)
            
            <span class="hljs-comment">// ---------- 性能追踪 ----------</span>
            
            <span class="hljs-comment">// 📊 记录性能追踪点：开始调用观察者回调</span>
            cf_trace(KDEBUG_EVENT_CFRL_IS_CALLING_OBSERVER | DBG_FUNC_START, callout, rlo, activity, info);
            
            
            <span class="hljs-comment">// ---------- 🎯 核心回调执行 ----------</span>
            
            <span class="hljs-comment">// ⚡ 执行观察者的回调函数</span>
            <span class="hljs-comment">// 宏定义通常是：callout(rlo, activity, info);</span>
            <span class="hljs-comment">// 这是整个函数的核心目的！</span>
            
            <span class="hljs-comment">// ⏰ 回调函数的参数：</span>
            <span class="hljs-comment">// - rlo: 观察者对象本身</span>
            <span class="hljs-comment">// - activity: 当前 RunLoop 活动状态（如 kCFRunLoopBeforeTimers）</span>
            <span class="hljs-comment">// - info: 用户自定义的上下文信息</span>
            
            <span class="hljs-comment">// ⚠️ 回调中可能发生的事情：</span>
            <span class="hljs-comment">// - UI 更新（如 CA::Transaction::observer_callback）</span>
            <span class="hljs-comment">// - 性能监控（如 FPS 检测）</span>
            <span class="hljs-comment">// - 内存管理（如清理缓存）</span>
            <span class="hljs-comment">// - 业务逻辑（如状态同步）</span>
            <span class="hljs-comment">// - 再次操作 RunLoop（如添加/移除 Timer）</span>
            __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__(callout, rlo, activity, info);
            
            
            <span class="hljs-comment">// ---------- 性能追踪结束 ----------</span>
            
            <span class="hljs-comment">// 📊 记录性能追踪点：结束调用观察者回调</span>
            <span class="hljs-comment">// 可通过 end - start 计算回调耗时</span>
            cf_trace(KDEBUG_EVENT_CFRL_IS_CALLING_OBSERVER | DBG_FUNC_END, callout, rlo, activity, info);
            
            <span class="hljs-comment">// ---------- 自动释放池结束 ----------</span>
            
            <span class="hljs-comment">// 🔄 结束自动释放池</span>
            <span class="hljs-comment">// 释放回调中创建的所有 autorelease 对象</span>
            CFRUNLOOP_ARP_END()
           
            
            <span class="hljs-comment">// ---------- 处理一次性观察者 ----------</span>
            
            <span class="hljs-comment">// 如果是一次性观察者（non-repeating）</span>
            <span class="hljs-keyword">if</span> (doInvalidate) {
                <span class="hljs-comment">// ❌ 使观察者失效</span>
                <span class="hljs-comment">// 会从 RunLoop 中移除，并标记为无效</span>
                <span class="hljs-comment">// 后续不会再触发此观察者</span>
                CFRunLoopObserverInvalidate(rlo);
            }
            
            <span class="hljs-comment">// 🚩 清除"正在执行"标志位</span>
            <span class="hljs-comment">// 允许此观察者在下次 activity 时再次被触发</span>
            __CFRunLoopObserverUnsetFiring(rlo);
            
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// 观察者在解锁期间已被其他线程 invalidate</span>
            
            <span class="hljs-comment">// 🔓 解锁观察者（前面已加锁）</span>
            <span class="hljs-comment">// 跳过回调执行</span>
            __CFRunLoopObserverUnlock(rlo);
        }
        
        <span class="hljs-comment">// 📉 释放引用计数（对应前面的 CFRetain）</span>
        <span class="hljs-comment">// 如果引用计数归零，观察者对象会被销毁</span>
        CFRelease(rlo);
    }
    
    <span class="hljs-comment">// ==================== 第七部分：重新加锁 ====================</span>
    
    <span class="hljs-comment">// 🔒 重新锁定 RunLoop</span>
    __CFRunLoopLock(rl);
    
    <span class="hljs-comment">// 🔒 重新锁定 RunLoop Mode</span>
    __CFRunLoopModeLock(rlm);
    
    <span class="hljs-comment">// ✅ 恢复函数入口时的锁状态</span>
    <span class="hljs-comment">// 满足函数签名中的约定："rl is locked, rlm is locked on entrance and exit"</span>

    <span class="hljs-comment">// ==================== 第八部分：清理资源 ====================</span>
    
    <span class="hljs-comment">// 🗑️ 释放堆内存（如果使用了 malloc）</span>
    <span class="hljs-comment">// - 如果 collectedObservers 指向栈缓冲区（buffer），无需释放</span>
    <span class="hljs-comment">// - 如果 collectedObservers 指向堆内存（malloc），需要手动释放</span>
    <span class="hljs-comment">// 防止内存泄漏</span>
    <span class="hljs-keyword">if</span> (collectedObservers != buffer) <span class="hljs-built_in">free</span>(collectedObservers);
    
    <span class="hljs-comment">// ==================== 第九部分：结束性能追踪 ====================</span>
    
    <span class="hljs-comment">// 📊 记录性能追踪点：完成 observers 执行</span>
    cf_trace(KDEBUG_EVENT_CFRL_IS_DOING_OBSERVERS | DBG_FUNC_END, rl, rlm, activity, <span class="hljs-number">0</span>);
}
</code></pre>
<h3 data-id="heading-7">常见使用场景</h3>
<h4 data-id="heading-8">1. UI 渲染（Core Animation）</h4>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// CA 在 kCFRunLoopBeforeWaiting 时提交渲染事务</span>
<span class="hljs-built_in">CFRunLoopObserverRef</span> observer = <span class="hljs-built_in">CFRunLoopObserverCreate</span>(
    kCFAllocatorDefault, 
    kCFRunLoopBeforeWaiting | kCFRunLoopExit,  <span class="hljs-comment">// 监听这两个状态</span>
    <span class="hljs-literal">YES</span>,  <span class="hljs-comment">// 重复触发</span>
    <span class="hljs-number">2000000</span>,  <span class="hljs-comment">// order = 2000000（在大多数 observer 之后）</span>
    &amp;<span class="hljs-built_in">CA_Transaction_observerCallback</span>,  <span class="hljs-comment">// 回调函数</span>
    <span class="hljs-literal">NULL</span>
);
</code></pre>
<h4 data-id="heading-9">2. 性能监控（FPS 检测）</h4>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// 监控主线程 RunLoop 的卡顿</span>
<span class="hljs-built_in">CFRunLoopObserverRef</span> observer = <span class="hljs-built_in">CFRunLoopObserverCreate</span>(
    kCFAllocatorDefault,
    kCFRunLoopAllActivities,  <span class="hljs-comment">// 监听所有活动</span>
    <span class="hljs-literal">YES</span>,
    <span class="hljs-number">0</span>,
    &amp;performanceMonitorCallback,
    <span class="hljs-literal">NULL</span>
);

<span class="hljs-type">void</span> performanceMonitorCallback(<span class="hljs-built_in">CFRunLoopObserverRef</span> observer, 
                                <span class="hljs-built_in">CFRunLoopActivity</span> activity, 
                                <span class="hljs-type">void</span> *info) {
    <span class="hljs-comment">// 记录时间戳，计算两次回调之间的间隔</span>
    <span class="hljs-comment">// 如果间隔过长，说明发生了卡顿</span>
}
</code></pre>
<h4 data-id="heading-10">3. 内存管理（自动释放池）</h4>
<pre><code class="hljs language-objc" lang="objc"><span class="hljs-comment">// NSRunLoop 在每次循环前后创建/销毁自动释放池</span>
<span class="hljs-built_in">CFRunLoopObserverRef</span> observer = <span class="hljs-built_in">CFRunLoopObserverCreate</span>(
    kCFAllocatorDefault,
    kCFRunLoopEntry | kCFRunLoopBeforeWaiting | kCFRunLoopExit,
    <span class="hljs-literal">YES</span>,
    <span class="hljs-number">-2147483647</span>,  <span class="hljs-comment">// 极高优先级（负值）</span>
    &amp;autoreleasePoolCallback,
    <span class="hljs-literal">NULL</span>
);
</code></pre>
<h3 data-id="heading-11">总结</h3>
<p>这个函数是理解 RunLoop 机制和 iOS 事件循环的关键，也是许多高级特性（如 UI 渲染、性能监控）的基础。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[大屏自适应终极方案：双剑合璧！JS+CSS协同作战实现完美适配]]></title>    <link>https://juejin.cn/post/7598899986856640518</link>    <guid>https://juejin.cn/post/7598899986856640518</guid>    <pubDate>2026-01-26T03:25:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598899986856640518" data-draft-id="7598830215259406372" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="大屏自适应终极方案：双剑合璧！JS+CSS协同作战实现完美适配"/> <meta itemprop="keywords" content="前端,数据可视化"/> <meta itemprop="datePublished" content="2026-01-26T03:25:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="小小善后师"/> <meta itemprop="url" content="https://juejin.cn/user/2323746686771772"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            大屏自适应终极方案：双剑合璧！JS+CSS协同作战实现完美适配
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2323746686771772/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    小小善后师
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:25:48.000Z" title="Mon Jan 26 2026 03:25:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">引言：大屏适配的痛点与破局之道</h2>
<p>在数据可视化大屏项目中，开发者常常面临这样的困境：<strong>同样的设计稿，在1920×1080屏幕上完美显示，到了3840×2160或1366×768的屏幕上却面目全非</strong>。文字溢出、布局错乱、图表变形...这些问题的根源在于传统的px单位无法适应多变的屏幕环境。</p>
<p>今天，我将分享一种<strong>JS+CSS协同作战的大屏自适应方案</strong>，它不仅解决了适配问题，还保持了代码的优雅与可维护性。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f1b56065bb3f4d40b49f7dacce56d974~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5bCP5ZaE5ZCO5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770002748&amp;x-signature=EGKSsHPgvUEZn%2FMhJHeNCsb0Bp4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-1">一、方案核心思想：视窗单位+动态计算</h2>
<h3 data-id="heading-2">1.1 为什么选择vw/vh？</h3>
<p>传统方案中，我们常用rem、百分比或媒体查询来适配不同屏幕。但在大屏场景下，这些方案各有局限：</p>
<ul>
<li><strong>rem</strong>：依赖根字体大小，复杂场景计算繁琐</li>
<li><strong>百分比</strong>：依赖父元素，多层嵌套时难以维护</li>
<li><strong>媒体查询</strong>：断点固定，无法实现连续自适应</li>
</ul>
<p><strong>vw/vh单位</strong>基于视窗尺寸，天生适合大屏适配：</p>
<ul>
<li><code>1vw</code> = 视窗宽度的1%</li>
<li><code>1vh</code> = 视窗高度的1%</li>
<li>完全独立于DOM结构，计算简单直观</li>
</ul>
<h3 data-id="heading-3">1.2 我们的混合方案优势</h3>
<pre><code class="hljs language-text" lang="text">┌─────────────────────────────────────┐
│         设计稿(1920×1080)            │
├─────────────────────────────────────┤
│  CSS函数：静态转换(开发时)            │
│  JS工具：动态计算(运行时)             │
└─────────────────────────────────────┘
                 ↓
┌─────────────────────────────────────┐
│     完美适配各种屏幕尺寸              │
└─────────────────────────────────────┘
</code></pre>
<h2 data-id="heading-4">二、CSS方案：开发时的优雅转换</h2>
<h3 data-id="heading-5">2.1 核心SCSS函数实现</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// _variables.scss - 定义设计稿基准</span>
<span class="hljs-variable">$design-width</span>: <span class="hljs-number">1920</span>;
<span class="hljs-variable">$design-height</span>: <span class="hljs-number">1080</span>;

<span class="hljs-comment">// _mixins.scss - 转换函数</span>
<span class="hljs-keyword">@use</span> <span class="hljs-string">'sass:math'</span>;

<span class="hljs-comment">// px转vw：水平方向适配</span>
<span class="hljs-keyword">@function</span> vw(<span class="hljs-variable">$px</span>) {
  <span class="hljs-keyword">@if</span> (unitless(<span class="hljs-variable">$px</span>)) {
    <span class="hljs-variable">$px</span>: <span class="hljs-variable">$px</span> * <span class="hljs-number">1px</span>;
  }
  <span class="hljs-keyword">@return</span> math.div(<span class="hljs-variable">$px</span>, <span class="hljs-variable">$design-width</span>) * <span class="hljs-number">100vw</span>;
}

<span class="hljs-comment">// px转vh：垂直方向适配</span>
<span class="hljs-keyword">@function</span> vh(<span class="hljs-variable">$px</span>) {
  <span class="hljs-keyword">@if</span> (unitless(<span class="hljs-variable">$px</span>)) {
    <span class="hljs-variable">$px</span>: <span class="hljs-variable">$px</span> * <span class="hljs-number">1px</span>;
  }
  <span class="hljs-keyword">@return</span> math.div(<span class="hljs-variable">$px</span>, <span class="hljs-variable">$design-height</span>) * <span class="hljs-number">100vh</span>;
}

<span class="hljs-comment">// 双向适配：同时处理宽高</span>
<span class="hljs-keyword">@function</span> size(<span class="hljs-variable">$width</span>, <span class="hljs-variable">$height</span>: null) {
  <span class="hljs-keyword">@if</span> <span class="hljs-variable">$height</span> == null {
    <span class="hljs-keyword">@return</span> vw(<span class="hljs-variable">$width</span>);
  }
  <span class="hljs-keyword">@return</span> vw(<span class="hljs-variable">$width</span>) vh(<span class="hljs-variable">$height</span>);
}
</code></pre>
<h3 data-id="heading-6">2.2 实际应用场景</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 仪表盘容器</span>
<span class="hljs-selector-class">.dashboard</span> {
  <span class="hljs-comment">// 使用混合函数</span>
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">vw</span>(<span class="hljs-number">1800</span>); <span class="hljs-comment">// 1800px → 93.75vw</span>
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">950</span>); <span class="hljs-comment">// 950px → 87.96vh</span>
  <span class="hljs-attribute">margin</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">20</span>) <span class="hljs-built_in">vw</span>(<span class="hljs-number">60</span>);
  
  <span class="hljs-comment">// 复杂布局示例</span>
  <span class="hljs-selector-class">.header</span> {
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">80</span>);
    <span class="hljs-attribute">padding</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">15</span>) <span class="hljs-built_in">vw</span>(<span class="hljs-number">30</span>);
    <span class="hljs-attribute">font-size</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">24</span>); <span class="hljs-comment">// 字体也自适应！</span>
  }
  
  <span class="hljs-selector-class">.chart-container</span> {
    <span class="hljs-comment">// 同时设置宽高</span>
    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">vw</span>(<span class="hljs-number">850</span>);
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">600</span>);
    
    <span class="hljs-comment">// 边框和圆角也自适应</span>
    <span class="hljs-attribute">border</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">2</span>) solid <span class="hljs-number">#3498db</span>;
    <span class="hljs-attribute">border-radius</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">10</span>);
  }
}
</code></pre>
<h3 data-id="heading-7">2.3 可视化转换过程</h3>
<pre><code class="hljs language-text" lang="text">设计稿尺寸          实际屏幕尺寸
  1920px     →      2560px
  ↓转换                ↓显示
  vw(200)    →      10.42vw = 266.67px
  (200/1920*100)    (2560×10.42%)
</code></pre>
<h2 data-id="heading-8">三、JS方案：运行时的灵活计算</h2>
<h3 data-id="heading-9">3.1 核心工具类实现</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// style-utils.js</span>
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DESIGN_WIDTH</span> = <span class="hljs-number">1920</span>;
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DESIGN_HEIGHT</span> = <span class="hljs-number">1080</span>;

<span class="hljs-comment">/**
 * 大屏自适应工具类
 * 适用于动态计算场景
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">ScreenAdapter</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">designWidth</span> = <span class="hljs-variable constant_">DESIGN_WIDTH</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">designHeight</span> = <span class="hljs-variable constant_">DESIGN_HEIGHT</span>;
  }
  
  <span class="hljs-comment">/**
   * px转vw
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">px</span> - 设计稿像素值
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} - vw单位字符串
   */</span>
  <span class="hljs-title function_">px2vw</span>(<span class="hljs-params">px</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(px / <span class="hljs-variable language_">this</span>.designWidth) * <span class="hljs-number">100</span>}</span>vw`</span>;
  }
  
  <span class="hljs-comment">/**
   * px转vh
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">number</span>} <span class="hljs-variable">px</span> - 设计稿像素值
   * <span class="hljs-doctag">@returns</span> {<span class="hljs-type">string</span>} - vh单位字符串
   */</span>
  <span class="hljs-title function_">px2vh</span>(<span class="hljs-params">px</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${(px / <span class="hljs-variable language_">this</span>.designHeight) * <span class="hljs-number">100</span>}</span>vh`</span>;
  }
  
  <span class="hljs-comment">/**
   * 批量设置样式（适用于动态创建的元素）
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">HTMLElement</span>} <span class="hljs-variable">element</span> - DOM元素
   * <span class="hljs-doctag">@param</span> {<span class="hljs-type">Object</span>} <span class="hljs-variable">styles</span> - 样式对象 {width: 100, height: 200}
   */</span>
  <span class="hljs-title function_">applyStyles</span>(<span class="hljs-params">element, styles</span>) {
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(styles).<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> value = styles[key];
      
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'number'</span>) {
        <span class="hljs-comment">// 根据样式名判断使用vw还是vh</span>
        <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'width'</span>) || key.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'left'</span>) || key.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'right'</span>)) {
          element.<span class="hljs-property">style</span>[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">px2vw</span>(value);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'height'</span>) || key.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'top'</span>) || key.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'bottom'</span>)) {
          element.<span class="hljs-property">style</span>[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">px2vh</span>(value);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-comment">// 字体、边框等特殊处理</span>
          element.<span class="hljs-property">style</span>[key] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">px2vh</span>(value);
        }
      }
    });
  }
  
  <span class="hljs-comment">/**
   * 监听窗口变化，实时调整
   */</span>
  <span class="hljs-title function_">initResizeObserver</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">let</span> resizeTimer;
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handleResize</span> = (<span class="hljs-params"/>) =&gt; {
      <span class="hljs-built_in">clearTimeout</span>(resizeTimer);
      resizeTimer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onResize</span>();
      }, <span class="hljs-number">200</span>);
    };
    
    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, handleResize);
  }
  
  <span class="hljs-title function_">onResize</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 可以在这里处理特殊逻辑</span>
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'屏幕尺寸变化，当前视窗:'</span>, 
      <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.innerWidth}</span>×<span class="hljs-subst">${<span class="hljs-variable language_">window</span>.innerHeight}</span>`</span>);
  }
}

<span class="hljs-comment">// 导出单例实例</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScreenAdapter</span>();
</code></pre>
<h3 data-id="heading-10">3.2 Vue/React中的实际应用</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// Vue组件中使用</span>
<span class="hljs-keyword">import</span> styleUtil <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/style-utils'</span>;

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> {
  <span class="hljs-title function_">data</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">chartStyle</span>: {
        <span class="hljs-attr">width</span>: <span class="hljs-number">400</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-number">300</span>,
        <span class="hljs-attr">marginTop</span>: <span class="hljs-number">20</span>
      }
    };
  },
  
  <span class="hljs-title function_">mounted</span>(<span class="hljs-params"/>) {
    <span class="hljs-comment">// 动态创建元素并应用样式</span>
    <span class="hljs-keyword">const</span> dynamicElement = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
    styleUtil.<span class="hljs-title function_">applyStyles</span>(dynamicElement, {
      <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>,
      <span class="hljs-attr">height</span>: <span class="hljs-number">200</span>,
      <span class="hljs-attr">fontSize</span>: <span class="hljs-number">16</span>,
      <span class="hljs-attr">padding</span>: <span class="hljs-number">20</span>
    });
    
    <span class="hljs-comment">// 或者直接在模板中使用</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chartStyle</span>.<span class="hljs-property">width</span> = styleUtil.<span class="hljs-title function_">px2vw</span>(<span class="hljs-number">400</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">chartStyle</span>.<span class="hljs-property">height</span> = styleUtil.<span class="hljs-title function_">px2vh</span>(<span class="hljs-number">300</span>);
  }
};
</code></pre>
<pre><code class="hljs language-jsx" lang="jsx"><span class="hljs-comment">// React组件中使用</span>
<span class="hljs-keyword">import</span> { useEffect, useRef } <span class="hljs-keyword">from</span> <span class="hljs-string">'react'</span>;
<span class="hljs-keyword">import</span> styleUtil <span class="hljs-keyword">from</span> <span class="hljs-string">'@/utils/style-utils'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ResponsiveChart</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">const</span> chartRef = <span class="hljs-title function_">useRef</span>(<span class="hljs-literal">null</span>);
  
  <span class="hljs-title function_">useEffect</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (chartRef.<span class="hljs-property">current</span>) {
      <span class="hljs-comment">// 应用动态样式</span>
      styleUtil.<span class="hljs-title function_">applyStyles</span>(chartRef.<span class="hljs-property">current</span>, {
        <span class="hljs-attr">width</span>: <span class="hljs-number">800</span>,
        <span class="hljs-attr">height</span>: <span class="hljs-number">500</span>,
        <span class="hljs-attr">borderRadius</span>: <span class="hljs-number">8</span>,
        <span class="hljs-attr">backgroundColor</span>: <span class="hljs-string">'#2c3e50'</span>
      });
    }
    
    <span class="hljs-comment">// 初始化窗口监听</span>
    styleUtil.<span class="hljs-title function_">initResizeObserver</span>();
  }, []);
  
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">{chartRef}</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"chart-container"</span>&gt;</span>
      {/* 图表内容 */}
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
}
</code></pre>
<h2 data-id="heading-11">四、最佳实践：何时用CSS？何时用JS？</h2>
<h3 data-id="heading-12">4.1 CSS方案适用场景 ✅</h3>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// ✅ 推荐使用CSS的场景：</span>

<span class="hljs-comment">// 1. 静态布局</span>
<span class="hljs-selector-class">.layout-container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">vw</span>(<span class="hljs-number">1800</span>);
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">900</span>);
  <span class="hljs-attribute">padding</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">20</span>) <span class="hljs-built_in">vw</span>(<span class="hljs-number">30</span>);
}

<span class="hljs-comment">// 2. 常规组件</span>
<span class="hljs-selector-class">.card</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">vw</span>(<span class="hljs-number">300</span>);
  <span class="hljs-attribute">height</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">200</span>);
  <span class="hljs-attribute">font-size</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">14</span>);
  
  <span class="hljs-comment">// 伪元素也能完美适配</span>
  &amp;<span class="hljs-selector-pseudo">::before</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">vw</span>(<span class="hljs-number">20</span>);
    <span class="hljs-attribute">height</span>: <span class="hljs-built_in">vh</span>(<span class="hljs-number">20</span>);
  }
}

<span class="hljs-comment">// 3. 媒体查询中的自适应</span>
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">max-aspect-ratio</span>: <span class="hljs-number">16</span>/<span class="hljs-number">9</span>) {
  <span class="hljs-selector-class">.sidebar</span> {
    <span class="hljs-attribute">width</span>: <span class="hljs-built_in">vw</span>(<span class="hljs-number">200</span>);
    <span class="hljs-comment">// 横屏特殊处理</span>
  }
}
</code></pre>
<h3 data-id="heading-13">4.2 JS方案适用场景 ✅</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// ✅ 推荐使用JS的场景：</span>

<span class="hljs-comment">// 1. 动态生成内容</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">createTooltip</span>(<span class="hljs-params">content, x, y</span>) {
  <span class="hljs-keyword">const</span> tooltip = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">'div'</span>);
  
  styleUtil.<span class="hljs-title function_">applyStyles</span>(tooltip, {
    <span class="hljs-attr">position</span>: <span class="hljs-string">'absolute'</span>,
    <span class="hljs-attr">left</span>: x, <span class="hljs-comment">// 动态坐标</span>
    <span class="hljs-attr">top</span>: y,
    <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">height</span>: <span class="hljs-string">'auto'</span>,
    <span class="hljs-attr">padding</span>: <span class="hljs-number">12</span>,
    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">14</span>
  });
  
  <span class="hljs-keyword">return</span> tooltip;
}

<span class="hljs-comment">// 2. 第三方库集成</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">initECharts</span>(<span class="hljs-params">domElement</span>) {
  <span class="hljs-keyword">const</span> chart = echarts.<span class="hljs-title function_">init</span>(domElement);
  
  <span class="hljs-comment">// 监听resize</span>
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'resize'</span>, <span class="hljs-function">() =&gt;</span> {
    <span class="hljs-comment">// 使用JS计算的新尺寸</span>
    chart.<span class="hljs-title function_">resize</span>({
      <span class="hljs-attr">width</span>: styleUtil.<span class="hljs-title function_">px2vw</span>(<span class="hljs-number">800</span>),
      <span class="hljs-attr">height</span>: styleUtil.<span class="hljs-title function_">px2vh</span>(<span class="hljs-number">500</span>)
    });
  });
}

<span class="hljs-comment">// 3. 复杂交互计算</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">calculatePosition</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-comment">// 基于鼠标位置动态计算</span>
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">left</span>: styleUtil.<span class="hljs-title function_">px2vw</span>(event.<span class="hljs-property">clientX</span>),
    <span class="hljs-attr">top</span>: styleUtil.<span class="hljs-title function_">px2vh</span>(event.<span class="hljs-property">clientY</span>)
  };
}
</code></pre>
<h3 data-id="heading-14">4.3 混合使用示例</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;!-- CSS处理静态布局 --&gt;
  &lt;div class="dashboard" :style="dynamicStyles"&gt;
    &lt;!-- JS处理动态尺寸 --&gt;
    &lt;div class="dynamic-chart" ref="chart"&gt;&lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import styleUtil from '@/utils/style-utils';

export default {
  data() {
    return {
      // JS计算样式
      dynamicStyles: {
        '--chart-width': styleUtil.px2vw(800),
        '--chart-height': styleUtil.px2vh(500)
      }
    };
  },
  
  mounted() {
    // JS处理复杂逻辑
    this.initDynamicContent();
  },
  
  methods: {
    initDynamicContent() {
      // 动态内容使用JS计算
      styleUtil.applyStyles(this.$refs.chart, {
        width: this.getChartWidth(),
        height: this.getChartHeight()
      });
    }
  }
};
&lt;/script&gt;

&lt;style lang="scss"&gt;
.dashboard {
  // CSS处理常规样式
  width: vw(1800);
  height: vh(900);
  
  .dynamic-chart {
    // 使用CSS变量（由JS设置）
    width: var(--chart-width);
    height: var(--chart-height);
    
    // 其他CSS属性
    border-radius: vh(10);
    background: linear-gradient(
      45deg,
      #3498db,
      #2ecc71
    );
  }
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-15">五、性能优化与注意事项</h2>
<h3 data-id="heading-16">5.1 性能对比</h3>

































<table><thead><tr><th>方案</th><th>渲染性能</th><th>灵活性</th><th>维护性</th><th>适用场景</th></tr></thead><tbody><tr><td>纯CSS</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>静态布局、常规组件</td></tr><tr><td>纯JS</td><td>⭐⭐⭐</td><td>⭐⭐⭐⭐⭐</td><td>⭐⭐⭐</td><td>动态内容、复杂交互</td></tr><tr><td>混合方案</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>⭐⭐⭐⭐</td><td>大型项目、综合需求</td></tr></tbody></table>
<h3 data-id="heading-17">5.2 常见问题与解决方案</h3>
<p><strong>问题1：字体过小/过大</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 解决方案：设置最小/最大字体</span>
<span class="hljs-keyword">@function</span> responsive-font(<span class="hljs-variable">$min</span>, <span class="hljs-variable">$max</span>, <span class="hljs-variable">$px</span>) {
  <span class="hljs-variable">$vw</span>: math.<span class="hljs-built_in">div</span>(<span class="hljs-variable">$px</span>, <span class="hljs-variable">$design-width</span>) * <span class="hljs-number">100</span>;
  <span class="hljs-keyword">@return</span> clamp(#{<span class="hljs-variable">$min</span>}px, #{<span class="hljs-variable">$vw</span>}vw, #{<span class="hljs-variable">$max</span>}px);
}

<span class="hljs-selector-class">.title</span> {
  <span class="hljs-attribute">font-size</span>: <span class="hljs-built_in">responsive-font</span>(<span class="hljs-number">16</span>, <span class="hljs-number">32</span>, <span class="hljs-number">24</span>);
}
</code></pre>
<p><strong>问题2：图片变形</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 解决方案：保持宽高比</span>
<span class="hljs-selector-class">.responsive-image</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-built_in">vw</span>(<span class="hljs-number">400</span>);
  <span class="hljs-attribute">height</span>: auto; <span class="hljs-comment">// 高度自适应</span>
  aspect-ratio: <span class="hljs-number">16</span>/<span class="hljs-number">9</span>; <span class="hljs-comment">// 或者设置宽高比</span>
}
</code></pre>
<p><strong>问题3：极端屏幕适配</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// 解决方案：JS兜底逻辑</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">SmartAdapter</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ScreenAdapter</span> {
  <span class="hljs-title function_">px2vw</span>(<span class="hljs-params">px</span>) {
    <span class="hljs-keyword">const</span> vwValue = (px / <span class="hljs-variable language_">this</span>.<span class="hljs-property">designWidth</span>) * <span class="hljs-number">100</span>;
    
    <span class="hljs-comment">// 超大屏幕限制最大尺寸</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &gt; <span class="hljs-number">3840</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.min(vwValue, <span class="hljs-number">80</span>)}</span>vw`</span>;
    }
    
    <span class="hljs-comment">// 超小屏幕限制最小尺寸</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">innerWidth</span> &lt; <span class="hljs-number">1366</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-built_in">Math</span>.max(vwValue, <span class="hljs-number">5</span>)}</span>vw`</span>;
    }
    
    <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${vwValue}</span>vw`</span>;
  }
}
</code></pre>
<h2 data-id="heading-18">六、完整示例：数据大屏项目</h2>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/d648adb748b54570b91e6ceb6da97f55~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5bCP5bCP5ZaE5ZCO5biI:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770002748&amp;x-signature=CSVgvKuJeoCIVyPpCInYeNJ%2FSfY%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-19">结语：选择合适的武器</h2>
<p>CSS方案与JS方案并非竞争关系，而是相辅相成的伙伴。在开发大屏项目时，我的建议是：</p>
<ol>
<li><strong>基础布局使用CSS</strong>：利用SCSS函数保持代码简洁</li>
<li><strong>动态内容使用JS</strong>：利用工具类保持灵活性</li>
<li><strong>关键组件混合使用</strong>：结合两者优势实现最佳效果</li>
</ol>
<p>记住：<strong>没有最好的方案，只有最适合的方案</strong>。根据项目需求和团队习惯，灵活选择组合策略，才能打造出既美观又实用的大屏应用。</p>
<hr/>
<p><strong>立即行动</strong>：在你的下一个大屏项目中，尝试这种混合方案。从一个小组件开始，体验vw/vh单位带来的适配便利，逐步扩展到整个项目。你会发现，大屏适配不再是难题，而是一次愉悦的开发体验！</p>
<p><strong>扩展阅读</strong>：</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcss-tricks.com%2Ffun-viewport-units%2F" target="_blank" title="https://css-tricks.com/fun-viewport-units/" ref="nofollow noopener noreferrer">CSS视窗单位深度指南</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdevelopers.google.com%2Fweb%2Ffundamentals%2Fperformance%2Frendering" target="_blank" title="https://developers.google.com/web/fundamentals/performance/rendering" ref="nofollow noopener noreferrer">高性能CSS动画最佳实践</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解构 Claude Skill：从核心原理到实战指南]]></title>    <link>https://juejin.cn/post/7598899986856689670</link>    <guid>https://juejin.cn/post/7598899986856689670</guid>    <pubDate>2026-01-26T03:33:21.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598899986856689670" data-draft-id="7598899986856607750" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解构 Claude Skill：从核心原理到实战指南"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T03:33:21.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lizhongxuan"/> <meta itemprop="url" content="https://juejin.cn/user/940837683343224"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解构 Claude Skill：从核心原理到实战指南
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/940837683343224/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lizhongxuan
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:33:21.000Z" title="Mon Jan 26 2026 03:33:21 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在构建 AI Agent 的浪潮中，让大模型（LLM）具备“行动能力”是核心诉求。对于 Anthropic 的 Claude 模型而言，这种能力被称为 <strong>Skill</strong>（或 Tool Use）。</p>
<p>本文将基于 Claude 的技术特性，结合 Golang 生态中的 <strong>Eino</strong> 框架，深入剖析 Skill 的工作原理、Prompt 编写技巧以及工程落地的最佳实践。</p>
<h2 data-id="heading-0">第一部分：什么是 Claude Skill？</h2>
<p>简单来说，Skill 是给仅能处理文本的 LLM 装上了“手”和“眼”。它允许开发者定义一组外部工具（API、数据库查询、计算器等），并授权 Claude 在遇到特定问题时调用这些工具。</p>
<p><strong>主要应用场景：</strong></p>
<ul>
<li><strong>获取实时信息：</strong> 查询股价、天气、最新新闻。</li>
<li><strong>执行操作：</strong> 发送邮件、在日历添加事件、购买商品。</li>
<li><strong>复杂计算：</strong> 调用 Wolfram Alpha 或 Python 解释器进行精确计算。</li>
<li><strong>企业数据交互：</strong> 查询公司内部的 CRM 或 SQL 数据库。</li>
</ul>
<h3 data-id="heading-1">1. 核心原理：预测与中断</h3>
<p>Claude 的工具调用并非魔法，其底层逻辑依然基于 <strong>“Next Token Prediction”</strong> 。整个过程是一个精密的“三明治结构”：</p>
<ol>
<li>
<p><strong>感知 (The Brain):</strong> 开发者将用户的提问 + <strong>工具清单 (Schema)</strong> 一并发给 Claude。<em>例子：</em> “Claude，你有两个工具：<code>get_weather(city)</code> 和 <code>send_email(to, body)</code>。用户问：北京天气怎么样？”</p>
</li>
<li>
<p><strong>决策 (Reasoning):</strong> Claude 分析意图。如果它认为需要使用工具，它<strong>不会</strong>生成自然语言回复，而是生成一段特定格式的 <strong>结构化文本</strong>（通常是 XML 或 JSON）。</p>
<ul>
<li><em>Claude:</em> <code>&lt;tool_use&gt;&lt;name&gt;get_weather&lt;/name&gt;&lt;city&gt;Beijing&lt;/city&gt;&lt;/tool_use&gt;</code></li>
</ul>
</li>
<li>
<p><strong>中断与执行:</strong> * Claude <strong>暂停</strong> 生成。</p>
<ul>
<li><strong>你的代码 (Client)</strong> 拦截到这段结构化请求，在后台执行真实的 API 调用。</li>
</ul>
</li>
<li>
<p><strong>反馈 (Feedback):</strong> 你的代码将执行结果（如“25°C”）作为新的输入发回给 Claude。</p>
</li>
<li>
<p><strong>响应 (Response):</strong> Claude 结合执行结果，生成最终给用户的自然语言回答。</p>
<ul>
<li><em>Claude 输出：</em> “北京今天的天气不错，气温是 25°C，晴朗。”</li>
</ul>
</li>
</ol>
<p><strong>关键认知：</strong> Claude 自己不运行工具，<strong>是你的代码在运行工具</strong>。Claude 只是负责“填写参数表单”。</p>
<h2 data-id="heading-2">第二部分：Prompt Engineering 的范式转移</h2>
<p>在开发 Skill 时，“写 Prompt” 的方式发生了本质变化。你不再需要写长篇大论的指令，而是需要编写<strong>精准的 JSON Schema</strong>。</p>
<p><strong>工具定义的 <code>description</code> 字段，就是写给 Claude 看的 Prompt。</strong></p>
<h3 data-id="heading-3">案例：快递查询工具</h3>
<h4 data-id="heading-4">❌ 错误的定义</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"search"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"查物流"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"parameters"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span> <span class="hljs-attr">"id"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span> <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><em>问题：名字含糊，描述太短，Claude 不知道何时触发，也不知道参数格式。</em></p>
<h4 data-id="heading-5">✅ 正确的定义</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"get_delivery_status"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"当用户询问包裹位置、发货状态或预计到达时间时使用此工具。"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"input_schema"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"properties"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"order_id"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"string"</span><span class="hljs-punctuation">,</span>
        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"以 'CN' 开头的10位订单编号。如果用户未提供，请礼貌询问。"</span>
      <span class="hljs-punctuation">}</span>
    <span class="hljs-punctuation">}</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p><em>优势：明确了触发场景（Scenario）和参数约束（Constraint）。</em></p>
<h2 data-id="heading-6">第三部分：Eino 框架实战 (Golang)</h2>
<p>在后端开发中，手动拼接上述 JSON 非常繁琐。<strong>Eino</strong> (CloudWeGo 开源框架) 提供了一套优雅的解决方案：<strong>将 Go Struct 自动映射为 Claude Prompt。</strong></p>
<h3 data-id="heading-7">1. 定义入参</h3>
<p>利用 Go 的 <code>struct tag</code> 来编写 Prompt。</p>
<pre><code class="hljs language-c" lang="c">type DeliveryRequest <span class="hljs-class"><span class="hljs-keyword">struct</span> {</span>
    <span class="hljs-comment">// `desc` 标签的内容会被 Eino 自动提取并传给 Claude</span>
    OrderID <span class="hljs-built_in">string</span> `json:<span class="hljs-string">"order_id"</span> desc:<span class="hljs-string">"以 'CN' 开头的10位订单编号，例如 CN1234567890"</span>`
}
</code></pre>
<h3 data-id="heading-8">2. 实现逻辑</h3>
<p>编写普通的 Go 函数处理业务。</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetDeliveryStatus</span><span class="hljs-params">(ctx context.Context, req *DeliveryRequest)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-keyword">if</span> req.OrderID == <span class="hljs-string">"CN123456"</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"包裹已到达北京转运中心"</span>, <span class="hljs-literal">nil</span>
    }
    <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, fmt.Errorf(<span class="hljs-string">"未查询到订单"</span>)
}
</code></pre>
<h3 data-id="heading-9">3. 绑定与自动编排</h3>
<p>Eino 负责中间繁琐的序列化、反序列化和路由分发。</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-comment">// 创建工具</span>
tool, _ := utils.<span class="hljs-title function_ invoke__">NewTool</span>(&amp;utils.ToolConfig{
    <span class="hljs-attr">Name</span>: <span class="hljs-string">"get_delivery_status"</span>,
    <span class="hljs-attr">Desc</span>: <span class="hljs-string">"查询快递状态工具"</span>,
    <span class="hljs-attr">Func</span>: GetDeliveryStatus, // 绑定 Go 函数
})

<span class="hljs-comment">// 绑定到 Claude 模型</span>
chatModel.<span class="hljs-title function_ invoke__">BindTools</span>([]*schema.ToolInfo{tool.<span class="hljs-title function_ invoke__">Info</span>()})
</code></pre>
<h2 data-id="heading-10">第四部分：构建高质量 Skill 的四大要素</h2>
<p>要让 Skill 稳定可靠，仅有基础代码是不够的。以下是经过实战验证的四个关键点：</p>
<h3 data-id="heading-11">1. Description 是核心</h3>
<p><code>desc</code> 决定了工具的“触发率”和“准确率”。</p>
<ul>
<li><strong>技巧：</strong> 在描述中加入 <strong>Negative Prompt</strong>（负向提示）。</li>
<li><em>例：</em> “此工具用于查询当前库存。<strong>注意：不要用于查询历史销售记录。</strong> ”</li>
</ul>
<h3 data-id="heading-12">2. 字段约束显性化</h3>
<p>LLM 不懂隐式规则。</p>
<ul>
<li><strong>技巧：</strong> 在 Struct Tag 中加入<strong>格式要求</strong>和<strong>示例（Example）</strong> 。</li>
<li><em>例：</em> <code>desc:"日期，格式必须为 YYYY-MM-DD，如 2024-01-01"</code>。</li>
</ul>
<h3 data-id="heading-13">3. 返回值设计的艺术</h3>
<p>后端返回给 Claude 的数据（Tool Output）也是 Prompt 的一部分。</p>
<ul>
<li><strong>技巧：</strong> <strong>提高信噪比</strong>。不要返回包含大量无用字段的原始 JSON，只返回 Claude 回答问题所需的数据。</li>
</ul>
<h3 data-id="heading-14">4. 错误处理即教学</h3>
<p>这是最高级的技巧。当工具调用失败时，不要只返回 <code>Error 500</code>。你应该返回一个 <strong>“Teacher Error”</strong> （像老师一样的纠错信息），指导 Claude 自我修正。</p>
<h4 data-id="heading-15">实战案例：汇率转换器的自动纠错</h4>
<p>场景描述：</p>
<p>我们构建一个汇率转换工具。后端只接受标准的 ISO 货币代码（如 CNY, USD），但用户经常习惯说“人民币”或“RMB”。我们将故意不处理前端输入，而是依赖后端报错机制来“教会” Claude。</p>
<p><strong>1. Go 代码实现 (Eino)</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">ConvertCurrency</span><span class="hljs-params">(ctx context.Context, req *CurrencyRequest)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    validCodes := <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">bool</span>{<span class="hljs-string">"CNY"</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">"USD"</span>: <span class="hljs-literal">true</span>}
    
    <span class="hljs-comment">// 检查：如果 Claude 传了 "RMB"，我们要拦截</span>
    from := strings.ToUpper(req.FromCurrency)
    
    <span class="hljs-keyword">if</span> !validCodes[from] {
        <span class="hljs-comment">// 【关键点】：不要只返回 "Invalid Currency"。</span>
        <span class="hljs-comment">// 要告诉 Claude 错在哪，以及正确的参考值是什么。</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, fmt.Errorf(
            <span class="hljs-string">"API Error: 货币代码 '%s' 无效。请仅使用 ISO 4217 标准代码。"</span> + 
            <span class="hljs-string">"提示：如果你想指人民币，请使用 'CNY'；美元请使用 'USD'。请修正参数后重试。"</span>, 
            req.FromCurrency,
        )
    }

    <span class="hljs-keyword">return</span> fmt.Sprintf(<span class="hljs-string">"转换成功：100 %s = 14.5 %s"</span>, from, req.ToCurrency), <span class="hljs-literal">nil</span>
}
</code></pre>
<p><strong>2. 实际运行流程</strong></p>
<p>这就是 <strong>“Eino 自动纠错”</strong> 发生的过程。用户完全无感知，但后台发生了两次交互。</p>
<ul>
<li>
<p><strong>Round 1: 第一次尝试（犯错）</strong></p>
<ul>
<li><strong>User:</strong> "把 100 RMB 换成美元。"</li>
<li><strong>Claude 调用:</strong> <code>convert_currency(from="RMB", to="USD")</code></li>
<li><strong>Eino 返回 (Error):</strong> <code>[Error] API Error: 货币代码 'RMB' 无效...提示：如果你想指人民币，请使用 'CNY'...</code></li>
</ul>
</li>
<li>
<p><strong>Round 2: 自我修正（重试）</strong></p>
<ul>
<li><strong>Claude 思考:</strong> "哎呀，工具报错了。它提示我应该用 'CNY'。好的，我重新调用一次。"</li>
<li><strong>Claude 再次调用:</strong> <code>convert_currency(from="CNY", to="USD")</code></li>
<li><strong>Eino 返回 (Success):</strong> <code>转换成功：100 CNY = 14.5 USD</code></li>
</ul>
</li>
<li>
<p><strong>最终回复用户:</strong> "转换完成！100 人民币大约等于 14.5 美元。"</p>
</li>
</ul>
<p>核心价值：</p>
<p>通过这种机制，你把后端逻辑里的 error 变成了对 AI 的直接指导，增强了 Agent 的韧性（Resilience），避免了直接拒绝用户。</p>
<h2 data-id="heading-16">第五部分：进阶与生产环境考量</h2>
<p>在技术分享的尾声，为了展示方案的完整性，我们需要讨论 Agent 在生产环境中的复杂挑战。</p>
<h3 data-id="heading-17">1. 多步推理与 Graph 编排</h3>
<p>现实世界的任务往往不是单一工具能解决的，而是需要 <strong>Tool Chaining（工具链）</strong> 。</p>
<ul>
<li><strong>场景：</strong> 用户问“分析 A 公司的最新财报风险”。</li>
<li><strong>流程：</strong> <code>SearchTool</code> (找财报) -&gt; <code>ReaderTool</code> (读 PDF) -&gt; <code>AnalysisTool</code> (提取数据) -&gt; LLM (总结)。</li>
<li><strong>Eino 优势：</strong> 利用 Eino 的 <code>Graph</code> 或 <code>Chain</code> 能力，可以将多个 Skill 串联起来，甚至实现并行的工具调用，而不是简单的一问一答。</li>
</ul>
<p><strong>代码示例 (Eino Graph 构建)：</strong></p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 创建一个 Graph</span>
g := compose.NewGraph[string, string]()

// 添加节点：检索器 -&gt; 分析器 -&gt; 总结大模型
g.<span class="hljs-built_in">AddNode</span>(<span class="hljs-string">"search_tool"</span>, searchTool)
g.<span class="hljs-built_in">AddNode</span>(<span class="hljs-string">"reader_tool"</span>, pdfReader)
g.<span class="hljs-built_in">AddNode</span>(<span class="hljs-string">"summarizer_llm"</span>, chatModel)

// 定义边的流向 (Workflow)
g.<span class="hljs-built_in">AddEdge</span>(compose.START, <span class="hljs-string">"search_tool"</span>)
g.<span class="hljs-built_in">AddEdge</span>(<span class="hljs-string">"search_tool"</span>, <span class="hljs-string">"reader_tool"</span>)
g.<span class="hljs-built_in">AddEdge</span>(<span class="hljs-string">"reader_tool"</span>, <span class="hljs-string">"summarizer_llm"</span>)
g.<span class="hljs-built_in">AddEdge</span>(<span class="hljs-string">"summarizer_llm"</span>, compose.END)

// 编译并运行
runnable, _ := g.<span class="hljs-built_in">Compile</span>(ctx)
result, _ := runnable.<span class="hljs-built_in">Invoke</span>(ctx, <span class="hljs-string">"分析 Apple 2024 Q3 财报"</span>)
</code></pre>
<h3 data-id="heading-18">2. 安全性：Human-in-the-loop (人机回环)</h3>
<p>赋予 AI 行动能力也带来了风险。对于高风险操作（如删除数据、退款转账），必须引入人工确认机制。</p>
<ul>
<li>
<p><strong>设计模式：</strong></p>
<ol>
<li>Claude 决定调用 <code>refund_user</code> 工具。</li>
<li>Eino 拦截调用请求，<strong>暂停 (Suspend)</strong> 执行流。</li>
<li>系统向管理员发送“确认卡片”。</li>
<li>管理员点击“批准”。</li>
<li>Eino <strong>恢复 (Resume)</strong> 执行流，真正运行后端函数。</li>
</ol>
</li>
</ul>
<p><strong>代码示例 (带审批的工具逻辑)：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">RefundUser</span><span class="hljs-params">(ctx context.Context, req *RefundRequest)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {
    <span class="hljs-comment">// 1. 检查权限或触发审批流</span>
    <span class="hljs-keyword">if</span> req.Amount &gt; <span class="hljs-number">1000</span> {
        <span class="hljs-comment">// 在实际系统中，这里可能抛出一个特定的 "NeedApprovalError"</span>
        <span class="hljs-comment">// 或者检查 Redis 中的审批 Token 是否存在</span>
        <span class="hljs-keyword">if</span> !IsApproved(ctx, req.TransactionID) {
             TriggerAdminApproval(req)
             <span class="hljs-keyword">return</span> <span class="hljs-string">"SYSTEM: 超过大额限制，已发送审批请求给管理员。请管理员批准后再重试此操作。"</span>, <span class="hljs-literal">nil</span>
        }
    }
    
    <span class="hljs-comment">// 2. 执行退款</span>
    db.ExecuteRefund(req)
    <span class="hljs-keyword">return</span> <span class="hljs-string">"退款成功"</span>, <span class="hljs-literal">nil</span>
}
</code></pre>
<h3 data-id="heading-19">3. 可观测性与模型评估</h3>
<p>AI 的行为具有不确定性。当 Agent 表现不佳时，我们需要知道是 Prompt 写歪了、工具参数传错了，<strong>还是模型本身的能力不足（智力波动）</strong> 。因此，除了链路追踪，还需要引入<strong>模型能力打分机制</strong>。</p>
<ul>
<li>
<p><strong>最佳实践：</strong> 记录完整的 Trace 并对模型能力进行量化打分。</p>
<ul>
<li><strong>Input:</strong> 用户到底说了什么？</li>
<li><strong>Prompt:</strong> Eino 最终组装发给 Claude 的 Prompt 长什么样？（包含工具定义）</li>
<li><strong>Tool Call:</strong> Claude 吐出的 JSON 参数是什么？</li>
<li><strong>Output:</strong> 工具返回了什么结果？</li>
<li><strong>Latency:</strong> 工具执行耗时多久？</li>
<li><strong>Model Score:</strong>  记录本次交互中模型所展示的能力得分。可以基于人工反馈（Thumbs up/down）或使用另一个更强的模型（Evaluator）对当前模型的回答逻辑、工具使用准确性进行打分。</li>
</ul>
</li>
</ul>
<p><strong>代码示例 (Eino Callbacks + Evaluation)：</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 创建回调处理器</span>
handler := callbacks.NewHandlerHelper().
    <span class="hljs-comment">// 监听工具调用开始</span>
    OnToolStart(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *schema.ToolInfo, input <span class="hljs-type">string</span>)</span></span> {
        log.Printf(<span class="hljs-string">"[Trace] Tool Start: %s | Input: %s"</span>, info.Name, input)
    }).
    <span class="hljs-comment">// 监听工具调用结束</span>
    OnToolEnd(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, info *schema.ToolInfo, output <span class="hljs-type">string</span>)</span></span> {
        log.Printf(<span class="hljs-string">"[Trace] Tool End: %s | Output: %s"</span>, info.Name, output)
    }).
    <span class="hljs-comment">// 监听 LLM 生成结束</span>
    OnModelEnd(<span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ctx context.Context, out *schema.ModelOutput, err <span class="hljs-type">error</span>)</span></span> {
        log.Printf(<span class="hljs-string">"[Trace] Model Token Usage: %d"</span>, out.Usage.TotalTokens)
        
        <span class="hljs-comment">// 异步触发模型能力评估</span>
        <span class="hljs-comment">// 既然日志记录了 Input/Output，我们可以异步调用一个 "Judge Model" </span>
        <span class="hljs-comment">// 来给当前 Claude 的表现打分 (0-10分)，从而监控模型能力是否下降。</span>
        <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
            score := EvaluateAgentPerformance(out.Content)
            metrics.RecordModelScore(<span class="hljs-string">"claude-3.5-sonnet"</span>, score)
        }()
    }).
    Handler()

<span class="hljs-comment">// 在运行时注入回调</span>
response, _ := chatModel.Generate(
    ctx, 
    userInput, 
    eino.WithCallbacks(handler), <span class="hljs-comment">// 注入观察者</span>
)
</code></pre>
<h2 data-id="heading-20">总结</h2>
<p>在 Eino 和 Claude 的体系下开发 Skill，本质上是在进行一场<strong>跨语言的沟通</strong>：你用 Go 代码定义规则，Eino 将其翻译为 JSON Schema，Claude 据此进行推理，最后通过你的 Go 函数与现实世界交互。</p>
<p>记住一条原则：<strong>你的 Go Struct 定义、函数返回值、甚至错误信息，全都是在跟 AI 对话。</strong> 写得越清楚，AI 表现就越智能。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[6.BTC-网络-北大肖臻老师客堂笔记]]></title>    <link>https://juejin.cn/post/7599181528304156681</link>    <guid>https://juejin.cn/post/7599181528304156681</guid>    <pubDate>2026-01-26T03:37:05.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599181528304156681" data-draft-id="7599247962821427227" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="6.BTC-网络-北大肖臻老师客堂笔记"/> <meta itemprop="keywords" content="前端,区块链"/> <meta itemprop="datePublished" content="2026-01-26T03:37:05.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端涂涂"/> <meta itemprop="url" content="https://juejin.cn/user/3740972207312249"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            6.BTC-网络-北大肖臻老师客堂笔记
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3740972207312249/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端涂涂
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:37:05.000Z" title="Mon Jan 26 2026 03:37:05 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>这份关于比特币网络原理的总结基于你提供的视频内容。比特币不仅是一种数字货币，更是一个精密的层级架构系统。</p>
<hr/>
<h2 data-id="heading-0">1. 比特币的网络分层架构</h2>
<p>比特币的运行主要依赖于两个层级的协作：</p>
<ul>
<li><strong>应用层 (Application Layer)</strong>：即 <strong>Bitcoin Blockchain</strong>。这一层处理账本、交易记录、共识机制（如 PoW）以及账户余额的验证。</li>
<li><strong>网络层 (Network Layer)</strong>：即 <strong>P2P Overlay Network</strong>。所有的比特币节点在应用层之下，通过互联网建立了一个对等网络（P2P）。</li>
<li><strong>Overlay（覆盖网络）</strong>：它运行在互联网之上，节点之间通过特定的协议相互链接，而不依赖中央服务器。</li>
</ul>
<hr/>
<h2 data-id="heading-1">2. 网络节点的类型与发现</h2>
<p>在一个去中心化的网络中，新节点如何找到组织？</p>
<ul>
<li><strong>种子节点 (Seed Nodes)</strong>：由比特币社区长期维护的可靠节点。新节点加入时，通常会先通过 DNS 或硬编码的地址连接到种子节点，从而获取当前活跃节点的列表。</li>
<li><strong>超级节点 / 主节点 (Full Nodes/Super Nodes)</strong>：这些节点保存了完整的区块链数据，并全天候在线。它们负责验证每一笔交易和每一个区块，是网络的“脊梁”。</li>
</ul>
<hr/>
<h2 data-id="heading-2">3. 消息传播机制：Flooding (洪泛算法)</h2>
<p>比特币网络采用一种简单而直接的通信方式：</p>
<ul>
<li><strong>机制</strong>：当一个节点收到一笔新交易或一个新区块时，它会先验证其合法性。如果合法，则将其转发给与其直接相连的所有邻居节点。</li>
<li><strong>Best Effort (尽力而为)</strong>：由于 P2P 网络的复杂性，信息传递不保证 100% 成功，也不保证顺序。网络通过多次冗余传播，确保绝大多数节点最终都能同步数据。</li>
</ul>
<hr/>
<h2 data-id="heading-3">4. 网络特性的权衡</h2>
<p>视频中强调了比特币网络设计的核心逻辑，可以用六个字概括：</p>
<blockquote>
<p><strong>Simple, Robust, but not Efficient.</strong>
(简单、鲁棒/健壮，但并不高效)</p>
</blockquote>
<ul>
<li><strong>Simple (简单)</strong>：通信协议并不复杂，没有繁琐的路由选择。</li>
<li><strong>Robust (鲁棒)</strong>：即便网络中大量节点突然离线，剩下的节点依然能通过 P2P 链接维持网络运转，没有单点故障。</li>
<li><strong>Not Efficient (低效)</strong>：为了安全和去中心化，每条信息都要被多次重复传输。相比于中心化服务器，它的延迟更高，带宽消耗更大。</li>
</ul>
<hr/>
<h2 data-id="heading-4">5. 核心原理总结表</h2>






























<table><thead><tr><th>维度</th><th>特点</th><th>说明</th></tr></thead><tbody><tr><td><strong>拓扑结构</strong></td><td>动态 P2P</td><td>节点随时加入/退出，没有中心控制。</td></tr><tr><td><strong>连通性</strong></td><td>邻居节点</td><td>每个节点通常与 8-12 个邻居节点保持连接。</td></tr><tr><td><strong>验证逻辑</strong></td><td>先验证再转发</td><td>防止垃圾信息或恶意攻击充斥网络。</td></tr><tr><td><strong>容错性</strong></td><td>高</td><td>只要有少量节点存活，区块链账本就不会丢失。</td></tr></tbody></table>
<p><img alt="在这里插入图片描述转存失败，建议直接上传图片文件" src="" loading="lazy"/></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[如何深入理解业务需求：从技术视角到价值落地]]></title>    <link>https://juejin.cn/post/7598744870996885547</link>    <guid>https://juejin.cn/post/7598744870996885547</guid>    <pubDate>2026-01-26T03:52:20.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598744870996885547" data-draft-id="7599496293161812009" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="如何深入理解业务需求：从技术视角到价值落地"/> <meta itemprop="keywords" content="人工智能,架构,全栈"/> <meta itemprop="datePublished" content="2026-01-26T03:52:20.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            如何深入理解业务需求：从技术视角到价值落地
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:52:20.000Z" title="Mon Jan 26 2026 03:52:20 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">引言</h2>
<p>在软件开发中，<strong>业务需求分析</strong>常常决定了项目的成败。很多技术人员喜欢直接“上手写代码”，却忽视了需求背后的业务逻辑与价值目标。结果往往导致 <strong>“代码没问题，但产品没价值”</strong> 。</p>
<p>本文将从技术视角出发，深入探讨如何理解业务需求，帮助开发者将抽象的业务逻辑转化为可落地的技术实现。本文适用于产品经理、系统架构师以及希望提升“业务敏感度”的技术从业者。</p>
<hr/>
<h2 data-id="heading-1">一、问题与背景：为什么开发者需要理解业务需求？</h2>
<p>在实际项目中，技术人员面对的痛点包括：</p>
<ul>
<li>需求模糊，导致反复返工；</li>
<li>功能实现正确，但未能解决业务痛点；</li>
<li>技术决策与业务目标脱节，缺乏价值导向。</li>
</ul>
<p>例如，某电商项目提出“提升下单转化率”的目标，研发团队却只关注性能优化，而忽略了关键的“推荐逻辑”与“结算体验”。这就是典型的技术脱离业务的案例。</p>
<p>业务需求的理解，不仅是对“做什么”的解读，更是对“为什么做”的抽象和重构。</p>
<hr/>
<h2 data-id="heading-2">二、解决方案与实践方法</h2>
<h3 data-id="heading-3">1. 理解业务需求的“三层模型”</h3>
<p>我们可以将理解业务需求的过程分为三层：</p>

























<table><thead><tr><th>层级</th><th>说明</th><th>输出成果</th></tr></thead><tbody><tr><td>业务层 (Why)</td><td>业务目标、价值与痛点</td><td>业务目标文档、业务指标</td></tr><tr><td>功能层 (What)</td><td>功能模块与流程设计</td><td>功能说明书、用例模型</td></tr><tr><td>技术层 (How)</td><td>技术实现与架构方案</td><td>系统架构、接口定义</td></tr></tbody></table>
<p>例如，需求“提升用户活跃度”：</p>
<ul>
<li><strong>业务层</strong>：分析活跃度低的原因（如留存率低、登录习惯差）。</li>
<li><strong>功能层</strong>：提出“签到领积分”、“推送提醒”等方案。</li>
<li><strong>技术层</strong>：设计对应的微服务接口与任务调度系统。</li>
</ul>
<hr/>
<h3 data-id="heading-4">2. 使用事件风暴(Event Storming)分析业务流程</h3>
<p>事件风暴是一种快速建模方法，帮助团队以 <strong>事件驱动视角</strong> 理解业务。</p>
<h4 data-id="heading-5">实践步骤：</h4>
<ol>
<li><strong>收集关键业务事件</strong>（如“用户注册”“下单成功”“订单支付完成”）。</li>
<li><strong>绘制事件时间线</strong>，展示业务流程中的逻辑顺序。</li>
<li><strong>识别聚合根(Aggregate Root)</strong> ，寻找系统边界与核心实体。</li>
<li><strong>提炼命令与查询模型</strong>，为后续的技术实现做准备。</li>
</ol>
<h4 data-id="heading-6">简化示例（订单支付流程）：</h4>
<pre><code class="hljs language-css" lang="css">graph LR
<span class="hljs-selector-tag">A</span><span class="hljs-selector-attr">[用户下单]</span> --&gt; <span class="hljs-selector-tag">B</span><span class="hljs-selector-attr">[系统生成订单]</span>
<span class="hljs-selector-tag">B</span> --&gt; C<span class="hljs-selector-attr">[库存校验]</span>
C --&gt; D<span class="hljs-selector-attr">[支付网关调用]</span>
D --&gt; E<span class="hljs-selector-attr">[订单支付完成]</span>
E --&gt; F<span class="hljs-selector-attr">[触发发货流程]</span>
</code></pre>
<p>这张简单的业务事件图帮助团队快速识别系统职责与服务边界，例如：</p>
<ul>
<li>库存校验 → 属于“库存微服务”</li>
<li>支付网关调用 → 属于“支付服务”</li>
<li>发货流程 → 属于“物流服务”</li>
</ul>
<hr/>
<h3 data-id="heading-7">3. 转化为技术实现（代码与模型）</h3>
<p>在明确业务逻辑后，技术实现应以“业务语言”命名和组织代码。例如，使用DDD（领域驱动设计）思想：</p>
<pre><code class="hljs language-ruby" lang="ruby"><span class="hljs-comment"># 示例：订单业务逻辑的领域模型（Python）</span>

<span class="hljs-keyword">class</span> <span class="hljs-title class_">Order</span>:
    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, user_id, items</span>):
        <span class="hljs-variable language_">self</span>.user_id = user_id
        <span class="hljs-variable language_">self</span>.items = items
        <span class="hljs-variable language_">self</span>.status = <span class="hljs-string">"CREATED"</span>

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">confirm_payment</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span>, payment_id</span>):
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-symbol">payment_id:</span>
            <span class="hljs-keyword">raise</span> <span class="hljs-title class_">ValueError</span>(<span class="hljs-string">"Invalid payment"</span>)
        <span class="hljs-variable language_">self</span>.status = <span class="hljs-string">"PAID"</span>
        <span class="hljs-variable language_">self</span>.trigger_delivery()

    <span class="hljs-keyword">def</span> <span class="hljs-title function_">trigger_delivery</span>(<span class="hljs-params"><span class="hljs-variable language_">self</span></span>):
        print(<span class="hljs-string">"Triggering delivery workflow..."</span>)

<span class="hljs-comment"># 示例调用</span>
order = <span class="hljs-title class_">Order</span>(user_id=<span class="hljs-number">1001</span>, items=[<span class="hljs-string">'item-001'</span>])
order.confirm_payment(payment_id=<span class="hljs-string">'pay-12345'</span>)
</code></pre>
<p>💡 <strong>关键点</strong>：业务行为（如 <code>confirm_payment</code>）在模型中以动词形式出现，使代码本身体现业务语义，而不仅是技术实现。</p>
<hr/>
<h2 data-id="heading-8">三、优缺点分析与实战建议</h2>
<h3 data-id="heading-9">✅ 优点</h3>
<ul>
<li><strong>减少沟通损耗</strong>：业务与技术有共同语言。</li>
<li><strong>提高需求转化效率</strong>：快速定位业务痛点，提升交付质量。</li>
<li><strong>增强系统的可维护性</strong>：业务逻辑内聚清晰、代码语义可读。</li>
</ul>
<h3 data-id="heading-10">⚠️ 缺点</h3>
<ul>
<li><strong>前期投入较大</strong>：业务建模需团队共同参与，初期成本较高。</li>
<li><strong>理解深度依赖领域经验</strong>：缺乏业务背景的团队可能误判需求。</li>
</ul>
<h3 data-id="heading-11">💡 实战建议</h3>
<ol>
<li><strong>与业务方共建模型</strong>：定期举办“业务建模工作坊”。</li>
<li><strong>采用领域术语命名代码</strong>：让代码即文档。</li>
<li><strong>从结果出发反推需求</strong>：始终问自己——“这段代码为业务创造了什么价值？”</li>
</ol>
<hr/>
<h2 data-id="heading-12">四、结论</h2>
<p>理解业务需求，是技术工程师迈向 <strong>“技术与商业融合”</strong> 的必经之路。<br/>
它不仅仅是“看懂PRD”，更是一种将抽象业务目标转化为工程语言的能力。</p>
<p>未来，随着 <strong>AI 辅助建模</strong>、<strong>低代码平台</strong> 的成熟，开发者的角色将不仅限于“技术实现者”，而会成为 <strong>“业务价值创造者”</strong> 。</p>
<hr/>
<h2 data-id="heading-13">五、参考资料</h2>
<ol>
<li>Eric Evans. <em>Domain-Driven Design: Tackling Complexity in the Heart of Software.</em></li>
<li>Alberto Brandolini. <em>Introducing Event Storming: An Act of Deliberate Discovery.</em></li>
<li>Martin Fowler. <a href="https://link.juejin.cn?target=https%3A%2F%2Fmartinfowler.com%2FeaaCatalog%2F" target="_blank" title="https://martinfowler.com/eaaCatalog/" ref="nofollow noopener noreferrer">Patterns of Enterprise Application Architecture</a>.</li>
<li>ThoughtWorks TechRadar: <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.thoughtworks.com%2Fradar" target="_blank" title="https://www.thoughtworks.com/radar" ref="nofollow noopener noreferrer">Understanding the Value of Domain-Driven Design</a>.</li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[事件风暴（Event Storming）** 通常帮助团队理解复杂业务领域]]></title>    <link>https://juejin.cn/post/7598830215259783204</link>    <guid>https://juejin.cn/post/7598830215259783204</guid>    <pubDate>2026-01-26T03:54:52.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598830215259783204" data-draft-id="7598830215259750436" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="事件风暴（Event Storming）** 通常帮助团队理解复杂业务领域"/> <meta itemprop="keywords" content="架构,人工智能,全栈"/> <meta itemprop="datePublished" content="2026-01-26T03:54:52.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="LeonGao"/> <meta itemprop="url" content="https://juejin.cn/user/3976252950591149"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            事件风暴（Event Storming）** 通常帮助团队理解复杂业务领域
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3976252950591149/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    LeonGao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:54:52.000Z" title="Mon Jan 26 2026 03:54:52 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{position:relative;word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#333}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:30px;margin-bottom:5px}.markdown-body h2{font-size:24px;display:inline-block;font-weight:700;background:#ef7060;color:#fff;padding:6px 8px 0 0;border-top-right-radius:6px;margin-right:2px;box-shadow:6px 3px 0 0 rgba(239,112,96,.2)}.markdown-body h2:before{content:" ";display:inline-block;width:8px}.markdown-body h2:after{content:" ";position:absolute;display:block;width:calc(100% - 50px);border-bottom:3px solid #ef7060}.markdown-body h3{font-size:18px;padding-bottom:0}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #3e3e3e;margin-top:32px;margin-bottom:32px;height:1px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(27,31,35,.05);color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:JetBranins Mono,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px;background-color:#fdfdfd}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#fdfdfd}.markdown-body a{text-decoration:none;font-weight:700;color:#ef7060;border-bottom:1px solid #ef7060}.markdown-body a:active,.markdown-body a:hover{color:#ef2d26}.markdown-body table tr td,.markdown-body table tr th{border:1px solid #ccc;padding:5px 10px}.markdown-body table{display:block!important;width:auto;max-width:100%;overflow:auto;border-collapse:collapse}.markdown-body thead{background:#f0f0f0;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#f8f8f8}.markdown-body blockquote{margin-inline-start:0;margin-inline-end:0;border-left:3px solid #ef7060;background:#fff9f9;padding:1px 20px;margin-top:20px}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="atom-one-light">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}</style><h2 data-id="heading-0">🧩 一、事件风暴结果的典型构成</h2>
<p>一次完整的事件风暴通常会产出以下几类信息：</p>



































<table><thead><tr><th>类型</th><th>示例</th><th>含义</th></tr></thead><tbody><tr><td><strong>领域事件 (Domain Event)</strong></td><td><code>订单已创建</code>、<code>支付完成</code></td><td>系统中发生的业务事实</td></tr><tr><td><strong>命令 (Command)</strong></td><td><code>创建订单</code>、<code>确认支付</code></td><td>用户或系统的行为意图</td></tr><tr><td><strong>聚合 (Aggregate)</strong></td><td>订单、用户、商品</td><td>管理业务状态与规则的核心模型</td></tr><tr><td><strong>外部系统 / 参与者 (Actor/System)</strong></td><td>支付网关、库存系统</td><td>与本系统交互的外部要素</td></tr><tr><td><strong>策略/流程 (Policy/Process)</strong></td><td>“支付完成后触发发货”</td><td>事件响应逻辑或业务规则</td></tr></tbody></table>
<p>事件风暴的核心价值是：让事件流串联起各领域边界。</p>
<hr/>
<h2 data-id="heading-1">🧭 二、从事件风暴到架构的映射步骤</h2>
<h3 data-id="heading-2"><strong>1️⃣ 步骤一：识别领域边界与限界上下文 (Bounded Context)</strong></h3>
<blockquote>
<p>每个“领域聚集”的事件序列，可归入一个上下文（Context）。</p>
</blockquote>
<p>例如在一个电商事件风暴中：</p>
<ul>
<li>用户注册、登录相关事件 → <code>用户上下文</code></li>
<li>订单创建、支付、发货等事件 → <code>订单上下文</code></li>
<li>积分计算、优惠券使用 → <code>营销上下文</code></li>
</ul>
<p>这些上下文将成为架构中的服务单元（可能是微服务、模块或限界组件）。</p>
<hr/>
<h3 data-id="heading-3"><strong>2️⃣ 步骤二：定义上下文间的交互</strong></h3>
<p>交互通常体现为 <strong>事件流或命令调用</strong>，对应系统中的：</p>
<ul>
<li>异步事件总线（Kafka、RabbitMQ 等）</li>
<li>RESTful API / gRPC 调用</li>
<li>Saga / Event-Driven Orchestration 流程</li>
</ul>
<p>例如：</p>
<pre><code class="hljs language-scss" lang="scss">订单上下文(Order Context) 
   ↓ 触发事件 → <span class="hljs-selector-attr">[支付完成事件]</span>
支付上下文(Payment Context)
   ↓ 响应事件 → <span class="hljs-selector-attr">[发货指令]</span>
物流上下文(Shipping Context)
</code></pre>
<p>通过这些交互，可以逐步显现系统架构中的依赖关系。</p>
<hr/>
<h3 data-id="heading-4"><strong>3️⃣ 步骤三：映射到技术架构层级</strong></h3>
<p>将业务上下文映射到常见的三层或微服务架构中：</p>






























<table><thead><tr><th>层级</th><th>内容</th><th>技术实现</th></tr></thead><tbody><tr><td><strong>接口层 (API Layer)</strong></td><td>接收命令</td><td>Spring Boot Controller、NestJS Controller</td></tr><tr><td><strong>应用层 (Application Layer)</strong></td><td>协调业务用例</td><td>Service、CommandHandler</td></tr><tr><td><strong>领域层 (Domain Layer)</strong></td><td>封装领域逻辑</td><td>Entity、Aggregate、Repository</td></tr><tr><td><strong>基础设施层 (Infrastructure Layer)</strong></td><td>外部依赖</td><td>DB、消息队列、远程调用</td></tr></tbody></table>
<p>这些定义帮助从“业务语言”过渡到“工程实现语言”。</p>
<hr/>
<h3 data-id="heading-5"><strong>4️⃣ 步骤四：绘制架构图</strong></h3>
<p>以下是一个示意图，将事件风暴结果映射为服务及事件流：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-selector-tag">graph</span> <span class="hljs-selector-tag">LR</span>
    <span class="hljs-selector-tag">U</span><span class="hljs-selector-attr">[用户上下文]</span> <span class="hljs-selector-tag">--</span>&gt;|创建订单| <span class="hljs-selector-tag">O</span><span class="hljs-selector-attr">[订单服务]</span>
    <span class="hljs-selector-tag">O</span> <span class="hljs-selector-tag">--</span>&gt;|发布事件: 订单已创建| <span class="hljs-selector-tag">P</span><span class="hljs-selector-attr">[支付服务]</span>
    <span class="hljs-selector-tag">P</span> <span class="hljs-selector-tag">--</span>&gt;|触发事件: 支付完成| <span class="hljs-selector-tag">L</span><span class="hljs-selector-attr">[物流服务]</span>
    <span class="hljs-selector-tag">O</span> <span class="hljs-selector-tag">--</span>&gt;|监听事件: 支付完成| <span class="hljs-selector-tag">L</span>
    <span class="hljs-selector-tag">L</span> <span class="hljs-selector-tag">--</span>&gt;|更新订单状态| <span class="hljs-selector-tag">O</span>
    <span class="hljs-selector-tag">subgraph</span> <span class="hljs-selector-tag">MessageBus</span><span class="hljs-selector-attr">[事件总线]</span>
    <span class="hljs-selector-tag">end</span>
    <span class="hljs-selector-tag">O</span> <span class="hljs-selector-tag">-</span><span class="hljs-selector-class">.-</span>&gt; <span class="hljs-selector-tag">MessageBus</span>
    <span class="hljs-selector-tag">P</span> <span class="hljs-selector-tag">-</span><span class="hljs-selector-class">.-</span>&gt; <span class="hljs-selector-tag">MessageBus</span>
    <span class="hljs-selector-tag">L</span> <span class="hljs-selector-tag">-</span><span class="hljs-selector-class">.-</span>&gt; <span class="hljs-selector-tag">MessageBus</span>
</code></pre>
<p>🧠 <strong>解读</strong>：</p>
<ul>
<li>各上下文（用户、订单、支付、物流）对应微服务。</li>
<li>它们之间通过 <strong>事件总线</strong> 异步通信。</li>
<li>事件名称直接继承自事件风暴的便利贴结果，语义一致。</li>
</ul>
<hr/>
<h3 data-id="heading-6"><strong>5️⃣ 步骤五：补充系统视角（非功能需求）</strong></h3>
<p>事件风暴主要关注业务，但架构转化时还要考虑：</p>




















<table><thead><tr><th>维度</th><th>示例</th><th>对应设计</th></tr></thead><tbody><tr><td><strong>数据持久化</strong></td><td>订单表、事件溯源表</td><td>MongoDB / PostgreSQL / Event Store</td></tr><tr><td><strong>通信模式</strong></td><td>异步事件 → Kafka；同步接口 → REST/gRPC</td><td/></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[多线程的这9种用途，99%的人不知道！]]></title>    <link>https://juejin.cn/post/7598830215259799588</link>    <guid>https://juejin.cn/post/7598830215259799588</guid>    <pubDate>2026-01-26T03:55:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598830215259799588" data-draft-id="7598830215259766820" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="多线程的这9种用途，99%的人不知道！"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T03:55:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="苏三说技术"/> <meta itemprop="url" content="https://juejin.cn/user/465848661970824"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            多线程的这9种用途，99%的人不知道！
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/465848661970824/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    苏三说技术
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:55:06.000Z" title="Mon Jan 26 2026 03:55:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读21分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>并发编程是一项非常重要的技术，无论在面试，还是工作中出现的频率非常高。</p>
<p>之前我发表的一篇《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247492962%26idx%3D1%26sn%3D17ed1d2ed950b4e9160218b296d19d4e%26chksm%3Dc0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082%26token%3D245805875%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247492962&amp;idx=1&amp;sn=17ed1d2ed950b4e9160218b296d19d4e&amp;chksm=c0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082&amp;token=245805875&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">聊聊并发编程的10个坑</a>》，在全网广受好评。说明了这类文章还是比较有价值的，接下来，打算继续聊聊并发编程这个话题。</p>
<p>并发编程说白了就是多线程编程，但多线程一定比单线程效率更高？</p>
<p>答：不一定，要看具体业务场景。</p>
<p>毕竟如果使用了多线程，那么线程之间的竞争和抢占cpu资源，线程的上下文切换，也是相对来说比较耗时的操作。</p>
<p>下面这几个问题在面试中，你必定遇到过：</p>
<ol>
<li>你在哪来业务场景中使用过多线程？</li>
<li>怎么用的？</li>
<li>踩过哪些坑？</li>
</ol>
<p>今天聊聊我之前在项目中用并发编程的12种业务场景，给有需要的朋友一个参考。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0c1cdd0696df47feb415bb55e04c26fd~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=AX22MWpmhHkaa4S1zqLEkUSOTVI%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">1. 简单定时任务</h2>
<p>各位亲爱的朋友，你没看错，<code>Thread</code>类真的能做定时任务。如果你看过一些<code>定时任务框架</code>的源码，你最后会发现，它们的底层也会使用Thread类。</p>
<p>实现这种定时任务的具体代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">try</span> {
                System.out.println(<span class="hljs-string">"下载文件"</span>);
                Thread.sleep(<span class="hljs-number">1000</span> * <span class="hljs-number">60</span> * <span class="hljs-number">5</span>);
            } <span class="hljs-keyword">catch</span> (Exception e) {
                log.error(e);
            }
        }
    }).start();
}
</code></pre>
<p>使用Thread类可以做最简单的定时任务，在run方法中有个while的死循环（当然还有其他方式），执行我们自己的任务。有个需要特别注意的地方是，需要用<code>try...catch</code>捕获异常，否则如果出现异常，就直接退出循环，下次将无法继续执行了。</p>
<p>但这种方式做的定时任务，只能周期性执行，不能支持定时在某个时间点执行。</p>
<p>特别提醒一下，该线程建议定义成<code>守护线程</code>，可以通过<code>setDaemon</code>方法设置，让它在后台默默执行就好。</p>
<p>使用场景：比如项目中有时需要每隔5分钟去<code>下载某个文件</code>，或者每隔10分钟去读取模板文件<code>生成静态html页面</code>等等，一些简单的周期性任务场景。</p>
<p>使用<code>Thread</code>类做定时任务的优缺点：</p>
<ul>
<li>
<p>优点：这种定时任务非常简单，学习成本低，容易入手，对于那些简单的周期性任务，是个不错的选择。</p>
</li>
<li>
<p>缺点：不支持指定某个时间点执行任务，不支持延迟执行等操作，功能过于单一，无法应对一些较为复杂的场景。</p>
</li>
</ul>
<h2 data-id="heading-2">2.监听器</h2>
<p>有时候，我们需要写个监听器，去监听某些数据的变化。</p>
<p>比如：我们在使用<code>canal</code>的时候，需要监听<code>binlog</code>的变化，能够及时把数据库中的数据，同步到另外一个业务数据库中。</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/affe454823004309bd1f1dbe03a9554b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=EXteLiBSOsZaDIQQK6wQ8MkAH94%3D" alt="" loading="lazy"/>
如果直接写一个监听器去监听数据就太没意思了，我们想实现这样一个功能：在配置中心有个开关，配置监听器是否开启，如果开启了使用单线程异步执行。</p>
<p>主要代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> CanalService {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">volatile</span> <span class="hljs-type">boolean</span> <span class="hljs-variable">running</span> <span class="hljs-operator">=</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">private</span> Thread thread;

    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CanalConnector canalConnector;
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handle</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">//连接canal</span>
        <span class="hljs-keyword">while</span>(running) {
           <span class="hljs-comment">//业务处理</span>
        }
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> {
       thread = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(<span class="hljs-built_in">this</span>::handle, <span class="hljs-string">"name"</span>);
       running = <span class="hljs-literal">true</span>;
       thread.start();
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">stop</span><span class="hljs-params">()</span> {
       <span class="hljs-keyword">if</span>(!running) {
          <span class="hljs-keyword">return</span>;
       }
       running = <span class="hljs-literal">false</span>;
    }
}
</code></pre>
<p>在start方法中开启了一个线程，在该线程中异步执行handle方法的具体任务。然后通过调用stop方法，可以停止该线程。</p>
<p>其中，使用<code>volatile</code>关键字控制的running变量作为开关，它可以控制线程中的状态。</p>
<p>接下来，有个比较关键的点是：如何通过配置中心的配置，控制这个开关呢？</p>
<p>以<code>apollo</code>配置为例，我们在配置中心的后台，修改配置之后，自动获取最新配置的核心代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CanalConfig</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> CanalService canalService;

    <span class="hljs-meta">@ApolloConfigChangeListener</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">change</span><span class="hljs-params">(ConfigChangeEvent event)</span> {
        <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> event.getChange(<span class="hljs-string">"test.canal.enable"</span>).getNewValue();
        <span class="hljs-keyword">if</span>(BooleanUtils.toBoolean(value)) {
            canalService.start();
        } <span class="hljs-keyword">else</span> {
            canalService.stop();
        }
    }
}
</code></pre>
<p>通过<code>apollo</code>的<code>ApolloConfigChangeListener</code>注解，可以监听配置参数的变化。</p>
<p>如果<code>test.canal.enable</code>开关配置的true，则调用canalService类的start方法开启canal数据同步功能。如果开关配置的false，则调用canalService类的stop方法，自动停止canal数据同步功能。</p>
<h2 data-id="heading-3">3.收集日志</h2>
<p>在某些高并发的场景中，我们需要收集部分用户的日志（比如：用户登录的日志），写到数据库中，以便于做分析。</p>
<p>但由于项目中，还没有引入消息中间件，比如：<code>kafka</code>、<code>rocketmq</code>等。</p>
<p>如果直接将日志同步写入数据库，可能会影响接口性能。</p>
<p>所以，大家很自然想到了异步处理。</p>
<p>实现这个需求最简单的做法是，开启一个线程，异步写入数据到数据库即可。</p>
<p>这样做，可以是可以。</p>
<p>但如果用户登录操作的耗时，比异步写入数据库的时间要少得多。这样导致的结果是：生产日志的速度，比消费日志的速度要快得多，最终的性能瓶颈在消费端。</p>
<p>其实，还有更优雅的处理方式，虽说没有使用消息中间件，但借用了它的思想。</p>
<p>这套记录登录日志的功能，分为：日志生产端、日志存储端和日志消费端。</p>
<p>如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/2d39d5d0bdd84f22ac94821a4c7f3dc3~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=2MIfQwu%2FLeEcPguNAUjA8AQwuhw%3D" alt="" loading="lazy"/></p>
<p>先定义了一个阻塞队列。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginLogQueue</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">QUEUE_MAX_SIZE</span>    <span class="hljs-operator">=</span> <span class="hljs-number">1000</span>;

    <span class="hljs-keyword">private</span> <span class="hljs-type">BlockingQueueblockingQueue</span> <span class="hljs-variable">queue</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedBlockingQueue</span>&lt;&gt;(QUEUE_MAX_SIZE);

    <span class="hljs-comment">//生成消息</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">push</span><span class="hljs-params">(LoginLog loginLog)</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.queue.add(loginLog);
    } 

    <span class="hljs-comment">//消费消息</span>
    <span class="hljs-keyword">public</span> LoginLog <span class="hljs-title function_">poll</span><span class="hljs-params">()</span> {
        <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            loginLog = <span class="hljs-built_in">this</span>.queue.take();
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            e.printStackTrace();
        }
        <span class="hljs-keyword">return</span> result;
    }
}
</code></pre>
<p>然后定义了一个日志的生产者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginSerivce</span> {
    
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoginLogQueue loginLogQueue;

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">login</span><span class="hljs-params">(UserInfo userInfo)</span> {
        <span class="hljs-comment">//业务处理</span>
        <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> convert(userInfo);
        loginLogQueue.push(loginLog);
    }  
}
</code></pre>
<p>接下来，定义了日志的消费者。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LoginInfoConsumer</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> LoginLogQueue queue;

    <span class="hljs-meta">@PostConstruct</span>
    <span class="hljs-keyword">public</span> voit init {
       <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
          <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
              <span class="hljs-type">LoginLog</span> <span class="hljs-variable">loginLog</span> <span class="hljs-operator">=</span> queue.take();
              <span class="hljs-comment">//写入数据库</span>
          }
        }).start();
    }
}
</code></pre>
<p>当然，这个例子中使用单线程接收登录日志，为了提升性能，也可以使用线程池来处理业务逻辑（比如：写入数据库）等。</p>
<h2 data-id="heading-4">4.excel导入</h2>
<p>我们可能会经常收到运营同学提过来的excel数据导入需求，比如：将某一大类下的所有子类一次性导入系统，或者导入一批新的供应商数据等等。</p>
<p>我们以导入供应商数据为例，它所涉及的业务流程很长，比如：</p>
<ol>
<li>调用天眼查接口校验企业名称和统一社会信用代码。</li>
<li>写入供应商基本表</li>
<li>写入组织表</li>
<li>给供应商自动创建一个用户</li>
<li>给该用户分配权限</li>
<li>自定义域名</li>
<li>发站内通知</li>
</ol>
<p>等等。</p>
<p>如果在程序中，解析完excel，读取了所有数据之后。用单线程一条条处理业务逻辑，可能耗时会非常长。</p>
<p>为了提升excel数据导入效率，非常有必要使用多线程来处理。</p>
<p>当然在java中实现多线程的手段有很多种，下面重点聊聊java8中最简单的实现方式：<code>parallelStream</code>。</p>
<p>伪代码如下：</p>
<pre><code class="hljs language-java" lang="java">supplierList.parallelStream().forEach(x -&gt; importSupplier(x));
</code></pre>
<p><code>parallelStream</code>是一个并行执行的流，它默认通过<code>ForkJoinPool</code>实现的，能提高你的多线程任务的速度。</p>
<p><code>ForkJoinPool</code>处理的过程会分而治之，它的核心思想是：<code>将一个大任务切分成多个小任务</code>。每个小任务都能单独执行，最后它会把所用任务的执行结果进行汇总。</p>
<p>下面用一张图简单介绍一下ForkJoinPool的原理：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/49631443b7274584a83313137ae2e2bc~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=CuRx6HVWAQ%2FvsDml1HdJam2pssk%3D" alt="" loading="lazy"/></p>
<p>当然除了excel导入之外，还有类似的读取文本文件，也可以用类似的方法处理。</p>
<blockquote>
<p>温馨的提醒一下，如果一次性导入的数据非常多，用多线程处理，可能会使系统的cpu使用率飙升，需要特别关注。</p>
</blockquote>
<h2 data-id="heading-5">5.查询接口</h2>
<p>很多时候，我们需要在某个查询接口中，调用其他服务的接口，组合数据之后，一起返回。</p>
<p>比如有这样的业务场景：</p>
<p>在用户信息查询接口中需要返回：用户名称、性别、等级、头像、积分、成长值等信息。</p>
<p>而用户名称、性别、等级、头像在用户服务中，积分在积分服务中，成长值在成长值服务中。为了汇总这些数据统一返回，需要另外提供一个对外接口服务。</p>
<p>于是，用户信息查询接口需要调用用户查询接口、积分查询接口 和 成长值查询接口，然后汇总数据统一返回。</p>
<p>调用过程如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/93aa59a74685455d910fc6962f8bdebe~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=fn66NGI9o5afFQLpZ01x%2FXUUb4w%3D" alt="" loading="lazy"/></p>
<p>调用远程接口总耗时 530ms = 200ms + 150ms + 180ms</p>
<p>显然这种串行调用远程接口性能是非常不好的，调用远程接口总的耗时为所有的远程接口耗时之和。</p>
<p>那么如何优化远程接口性能呢？</p>
<p>既然串行调用多个远程接口性能很差，为什么不改成并行呢？</p>
<p>如下图所示：
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/65e3ef20c3e04cf98491af9f56fccd28~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=RA%2BTjzT%2B%2B0M16pTzvadZicSwHSg%3D" alt="" loading="lazy"/></p>
<p>调用远程接口总耗时 200ms = 200ms（即耗时最长的那次远程接口调用）</p>
<p>在java8之前可以通过实现<code>Callable</code>接口，获取线程返回结果。</p>
<p>java8以后通过<code>CompleteFuture</code>类实现该功能。我们这里以CompleteFuture为例：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> UserInfo <span class="hljs-title function_">getUserInfo</span><span class="hljs-params">(Long id)</span> <span class="hljs-keyword">throws</span> InterruptedException, ExecutionException {
    <span class="hljs-keyword">final</span> <span class="hljs-type">UserInfo</span> <span class="hljs-variable">userInfo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserInfo</span>();
    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">userFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteUserAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);

    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">bonusFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteBonusAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);

    <span class="hljs-type">CompletableFuture</span> <span class="hljs-variable">growthFuture</span> <span class="hljs-operator">=</span> CompletableFuture.supplyAsync(() -&gt; {
        getRemoteGrowthAndFill(id, userInfo);
        <span class="hljs-keyword">return</span> Boolean.TRUE;
    }, executor);
    CompletableFuture.allOf(userFuture, bonusFuture, growthFuture).join();

    userFuture.get();
    bonusFuture.get();
    growthFuture.get();
    <span class="hljs-keyword">return</span> userInfo;
}
</code></pre>
<p>温馨提醒一下，这两种方式别忘了使用<code>线程池</code>。示例中我用到了<code>executor</code>，表示自定义的线程池，为了防止高并发场景下，出现线程过多的问题。</p>
<h2 data-id="heading-6">6.获取用户上下文</h2>
<p>不知道你在项目开发时，有没有遇到过这样的需求：用户登录之后，在所有的请求接口中，通过某个公共方法，就能获取到当前登录用户的信息？</p>
<p>获取的用户上下文，我们以<code>CurrentUser</code>为例。</p>
<p><code>CurrentUser</code>内部包含了一个<code>ThreadLocal</code>对象，它负责保存当前线程的用户上下文信息。当然为了保证在线程池中，也能从用户上下文中获取到正确的用户信息，这里用了阿里的<code>TransmittableThreadLocal</code>。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Data</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CurrentUser</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> TransmittableThreadLocal&lt;CurrentUser&gt; THREA_LOCAL = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TransmittableThreadLocal</span>&lt;&gt;();
    
    <span class="hljs-keyword">private</span> String id;
    <span class="hljs-keyword">private</span> String userName;
    <span class="hljs-keyword">private</span> String password;
    <span class="hljs-keyword">private</span> String phone;
    ...
    
    <span class="hljs-keyword">public</span> statis <span class="hljs-keyword">void</span> <span class="hljs-title function_">set</span><span class="hljs-params">(CurrentUser user)</span> {
      THREA_LOCAL.set(user);
    }
    
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getCurrent</span><span class="hljs-params">()</span> {
      <span class="hljs-keyword">return</span> THREA_LOCAL.get();
    }
}
</code></pre>
<p>这里为什么用了阿里的TransmittableThreadLocal，而不是普通的ThreadLocal呢？在线程池中，由于线程会被多次复用，导致从普通的ThreadLocal中无法获取正确的用户信息。父线程中的参数，没法传递给子线程，而TransmittableThreadLocal很好解决了这个问题。</p>
<p>然后在项目中定义一个全局的spring mvc拦截器，专门设置用户上下文到ThreadLocal中。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserInterceptor</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">HandlerInterceptorAdapter</span> {
   
   <span class="hljs-meta">@Override</span>  
   <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">preHandle</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="hljs-keyword">throws</span> Exception {
      <span class="hljs-type">CurrentUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> getUser(request);
      <span class="hljs-keyword">if</span>(Objects.nonNull(user)) {
         CurrentUser.set(user);
      }
   } 
}
</code></pre>
<p>用户在请求我们接口时，会先触发该拦截器，它会根据用户cookie中的token，调用调用接口获取redis中的用户信息。如果能获取到，说明用户已经登录，则把用户信息设置到CurrentUser类的ThreadLocal中。</p>
<p>接下来，在api服务的下层，即business层的方法中，就能轻松通过CurrentUser.getCurrent();方法获取到想要的用户上下文信息了。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/716f8f50a1534db785a2eba41e4c6c7e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=S5WovHiVYbFMen3cheAMaJqlg34%3D" alt="" loading="lazy"/></p>
<p>这套用户体系的想法是很good的，但深入使用后，发现了一个小插曲：</p>
<p>api服务和mq消费者服务都引用了business层，business层中的方法两个服务都能直接调用。</p>
<p>我们都知道在api服务中用户是需要登录的，而mq消费者服务则不需要登录。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/44e766b9bfed43ae8af0be092bc68b08~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=TyvbIs6k9SghVb969pPlwFCzLS4%3D" alt="" loading="lazy"/></p>
<p>如果business中的某个方法刚开始是给api开发的，在方法深处使用了CurrentUser.getCurrent();获取用户上下文。但后来，某位新来的帅哥在mq消费者中也调用了那个方法，并未发觉这个小机关，就会中招，出现找不到用户上下文的问题。
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5bcfc398c332429b8cc072d2c57038e8~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6IuP5LiJ6K-05oqA5pyv:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770004506&amp;x-signature=Tqbw%2Fwb6NDWB2uzo19h1BEHljiE%3D" alt="" loading="lazy"/></p>
<p>所以我当时的第一个想法是：代码没做兼容处理，因为之前这类问题偶尔会发生一次。</p>
<p>想要解决这个问题，其实也很简单。只需先判断一下能否从CurrentUser中获取用户信息，如果不能，则取配置的系统用户信息。伪代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Autowired</span>
<span class="hljs-keyword">private</span> BusinessConfig businessConfig;

<span class="hljs-type">CurrentUser</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> CurrentUser.getCurrent();
<span class="hljs-keyword">if</span>(Objects.nonNull(user)) {
   entity.setUserId(user.getUserId());
   entity.setUserName(user.getUserName());
} <span class="hljs-keyword">else</span> {
   entity.setUserId(businessConfig.getDefaultUserId());
   entity.setUserName(businessConfig.getDefaultUserName());
}
</code></pre>
<p>这种简单无公害的代码，如果只是在一两个地方加还OK。</p>
<p>此外，众所周知，<code>SimpleDateFormat</code>在java8以前，是用来处理时间的工具类，它是非线程安全的。也就是说，用该方法解析日期会有线程安全问题。</p>
<p>为了避免线程安全问题的出现，我们可以把SimpleDateFormat对象定义成<code>局部变量</code>。但如果你一定要把它定义成静态变量，可以使用ThreadLocal保存日期，也能解决线程安全问题。</p>
<h2 data-id="heading-7">8. 传递参数</h2>
<p>之前见过有些同事写代码时，一个非常有趣的用法，即：使用<code>MDC</code>传递参数。</p>
<p>MDC是什么？</p>
<p><code>MDC</code>是<code>org.slf4j</code>包下的一个类，它的全称是<code>Mapped Diagnostic Context</code>，我们可以认为它是一个线程安全的存放诊断日志的容器。</p>
<p><code>MDC</code>的底层是用了<code>ThreadLocal</code>来保存数据的。</p>
<p>例如现在有这样一种场景：我们使用<code>RestTemplate</code>调用远程接口时，有时需要在<code>header</code>中传递信息，比如：traceId，source等，便于在查询日志时能够串联一次完整的请求链路，快速定位问题。</p>
<p>这种业务场景就能通过<code>ClientHttpRequestInterceptor</code>接口实现，具体做法如下：</p>
<p>第一步，定义一个LogFilter拦截所有接口请求，在MDC中设置traceId：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LogFilter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Filter</span> {
    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">init</span><span class="hljs-params">(FilterConfig filterConfig)</span> <span class="hljs-keyword">throws</span> ServletException {
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doFilter</span><span class="hljs-params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="hljs-keyword">throws</span> IOException, ServletException {
        MdcUtil.add(UUID.randomUUID().toString());
        System.out.println(<span class="hljs-string">"记录请求日志"</span>);
        chain.doFilter(request, response);
        System.out.println(<span class="hljs-string">"记录响应日志"</span>);
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">destroy</span><span class="hljs-params">()</span> {
    }
}
</code></pre>
<p>第二步，实现<code>ClientHttpRequestInterceptor</code>接口，MDC中获取当前请求的traceId，然后设置到header中：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateInterceptor</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ClientHttpRequestInterceptor</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> ClientHttpResponse <span class="hljs-title function_">intercept</span><span class="hljs-params">(HttpRequest request, <span class="hljs-type">byte</span>[] body, ClientHttpRequestExecution execution)</span> <span class="hljs-keyword">throws</span> IOException {
        request.getHeaders().set(<span class="hljs-string">"traceId"</span>, MdcUtil.get());
        <span class="hljs-keyword">return</span> execution.execute(request, body);
    }
}
</code></pre>
<p>第三步，定义配置类，配置上面定义的RestTemplateInterceptor类：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RestTemplateConfiguration</span> {

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestTemplate <span class="hljs-title function_">restTemplate</span><span class="hljs-params">()</span> {
        <span class="hljs-type">RestTemplate</span> <span class="hljs-variable">restTemplate</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplate</span>();
        restTemplate.setInterceptors(Collections.singletonList(restTemplateInterceptor()));
        <span class="hljs-keyword">return</span> restTemplate;
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RestTemplateInterceptor <span class="hljs-title function_">restTemplateInterceptor</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RestTemplateInterceptor</span>();
    }
}
</code></pre>
<p>其中MdcUtil其实是利用MDC工具在<code>ThreadLocal</code>中存储和获取traceId</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MdcUtil</span> {

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TRACE_ID</span> <span class="hljs-operator">=</span> <span class="hljs-string">"TRACE_ID"</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">get</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> MDC.get(TRACE_ID);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(String value)</span> {
        MDC.put(TRACE_ID, value);
    }
}
</code></pre>
<p>当然，这个例子中没有演示MdcUtil类的add方法具体调的地方，我们可以在<code>filter</code>中执行接口方法之前，生成traceId，调用MdcUtil类的add方法添加到MDC中，然后在同一个请求的其他地方就能通过MdcUtil类的get方法获取到该traceId。</p>
<p>能使用MDC保存traceId等参数的根本原因是，用户请求到应用服务器，<code>Tomcat</code>会从线程池中分配一个线程去处理该请求。</p>
<p>那么该请求的整个过程中，保存到<code>MDC</code>的<code>ThreadLocal</code>中的参数，也是该线程独享的，所以不会有线程安全问题。</p>
<h2 data-id="heading-8">9. 模拟高并发</h2>
<p>有时候我们写的接口，在低并发的场景下，一点问题都没有。</p>
<p>但如果一旦出现高并发调用，该接口可能会出现一些意想不到的问题。</p>
<p>为了防止类似的事情发生，一般在项目上线前，我们非常有必要对接口做一下<code>压力测试</code>。</p>
<p>当然，现在已经有比较成熟的压力测试工具，比如：<code>Jmeter</code>、<code>LoadRunner</code>等。</p>
<p>如果你觉得下载压测工具比较麻烦，也可以手写一个简单的模拟并发操作的工具，用<code>CountDownLatch</code>就能实现，例如：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">concurrenceTest</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">/**
     * 模拟高并发情况代码
     */</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">atomicInteger</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 相当于计数器，当所有都准备好了，再一起执行，模仿多并发，保证并发量</span>
    <span class="hljs-keyword">final</span> <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">countDownLatch2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(<span class="hljs-number">1000</span>); <span class="hljs-comment">// 保证所有线程执行完了再打印atomicInteger的值</span>
    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">executorService</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">10</span>);
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
            executorService.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() {
                <span class="hljs-meta">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
                    <span class="hljs-keyword">try</span> {
                        countDownLatch.await(); <span class="hljs-comment">//一直阻塞当前线程，直到计时器的值为0,保证同时并发</span>
                    } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                        log.error(e.getMessage(),e);
                    }
                    <span class="hljs-comment">//每个线程增加1000次，每次加1</span>
                    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">1000</span>; j++) {
                        atomicInteger.incrementAndGet();
                    }
                    countDownLatch2.countDown();
                }
            });
            countDownLatch.countDown();
        }

        countDownLatch2.await();<span class="hljs-comment">// 保证所有线程执行完</span>
        executorService.shutdown();
    } <span class="hljs-keyword">catch</span> (Exception e){
        log.error(e.getMessage(),e);
    }
}
</code></pre>
<h2 data-id="heading-9">10. 处理mq消息</h2>
<p>在高并发的场景中，消息积压问题，可以说如影随形，真的没办法从根本上解决。表面上看，已经解决了，但后面不知道什么时候，就会冒出一次，比如这次：</p>
<p>有天下午，产品过来说：有几个商户投诉过来了，他们说菜品有延迟，快查一下原因。</p>
<p>这次问题出现得有点奇怪。</p>
<p>为什么这么说？</p>
<p>首先这个时间点就有点奇怪，平常出问题，不都是中午或者晚上用餐高峰期吗？怎么这次问题出现在下午？</p>
<p>根据以往积累的经验，我直接看了<code>kafka</code>的<code>topic</code>的数据，果然上面消息有积压，但这次每个<code>partition</code>都积压了十几万的消息没有消费，比以往加压的消息数量增加了几百倍。这次消息积压得极不寻常。</p>
<p>我赶紧查服务监控看看消费者挂了没，还好没挂。又查服务日志没有发现异常。这时我有点迷茫，碰运气问了问订单组下午发生了什么事情没？他们说下午有个促销活动，跑了一个<code>JOB</code>批量更新过有些商户的订单信息。</p>
<p>这时，我一下子如梦初醒，是他们在JOB中批量发消息导致的问题。怎么没有通知我们呢？实在太坑了。</p>
<p>虽说知道问题的原因了，倒是眼前积压的这十几万的消息该如何处理呢？</p>
<p>此时，如果直接调大<code>partition</code>数量是不行的，历史消息已经存储到<code>4</code>个固定的partition，只有新增的消息才会到新的partition。我们重点需要处理的是已有的partition。</p>
<p>直接加服务节点也不行，因为<code>kafka</code>允许同组的多个<code>partition</code>被一个<code>consumer</code>消费，但不允许一个partition被同组的多个consumer消费，可能会造成资源浪费。</p>
<p>看来只有用<code>多线程</code>处理了。</p>
<p>为了紧急解决问题，我改成了用线程池处理消息，核心线程和最大线程数都配置成了<code>50</code>。</p>
<p>大致用法如下：</p>
<ol>
<li>先定义一个线程池：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ThreadPoolConfig</span> {

    <span class="hljs-meta">@Value("${thread.pool.corePoolSize:5}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> corePoolSize;

    <span class="hljs-meta">@Value("${thread.pool.maxPoolSize:10}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> maxPoolSize;

    <span class="hljs-meta">@Value("${thread.pool.queueCapacity:200}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> queueCapacity;

    <span class="hljs-meta">@Value("${thread.pool.keepAliveSeconds:30}")</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> keepAliveSeconds;

    <span class="hljs-meta">@Value("${thread.pool.threadNamePrefix:ASYNC_}")</span>
    <span class="hljs-keyword">private</span> String threadNamePrefix;

    <span class="hljs-meta">@Bean("messageExecutor")</span>
    <span class="hljs-keyword">public</span> Executor <span class="hljs-title function_">messageExecutor</span><span class="hljs-params">()</span> {
        <span class="hljs-type">ThreadPoolTaskExecutor</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolTaskExecutor</span>();
        executor.setCorePoolSize(corePoolSize);
        executor.setMaxPoolSize(maxPoolSize);
        executor.setQueueCapacity(queueCapacity);
        executor.setKeepAliveSeconds(keepAliveSeconds);
        executor.setThreadNamePrefix(threadNamePrefix);
        executor.setRejectedExecutionHandler(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy());
        executor.initialize();
        <span class="hljs-keyword">return</span> executor;
    }
}
</code></pre>
<ol start="2">
<li>再定义一个消息的consumer：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyConsumerService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> Executor messageExecutor;
    
    <span class="hljs-meta">@KafkaListener(id="test",topics={"topic-test"})</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">listen</span><span class="hljs-params">(String message)</span>{
        System.out.println(<span class="hljs-string">"收到消息："</span> + message);
        messageExecutor.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyWork</span>(message);
    }
}
</code></pre>
<ol start="3">
<li>在定义的Runable实现类中处理业务逻辑：</li>
</ol>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyWork</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Runnable</span> {
    <span class="hljs-keyword">private</span> String message;
    
    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyWork</span><span class="hljs-params">(String message)</span> {
       <span class="hljs-built_in">this</span>.message = message;
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> {
        System.out.println(message);
    }
}
</code></pre>
<p>果然，调整之后消息积压数量确实下降的非常快，大约半小时后，积压的消息就非常顺利的处理完了。</p>
<p>但此时有个更严重的问题出现：我收到了报警邮件，有两个订单系统的节点down机了。。。</p>
<p>更详细内容，请看看我的另一篇文章《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247490289%26idx%3D1%26sn%3Dbc311da9f4a4d3f48ee5dc207bf31a8b%26chksm%3Dc0ebc219f79c4b0fc711116723b9df3a5531cda32f0f5d00f065910aa552af6ff03b3f1528fc%26token%3D751314179%26lang%3Dzh_CN%26scene%3D21%23wechat_redirect" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247490289&amp;idx=1&amp;sn=bc311da9f4a4d3f48ee5dc207bf31a8b&amp;chksm=c0ebc219f79c4b0fc711116723b9df3a5531cda32f0f5d00f065910aa552af6ff03b3f1528fc&amp;token=751314179&amp;lang=zh_CN&amp;scene=21#wechat_redirect" ref="nofollow noopener noreferrer">我用kafka两年踩过的一些非比寻常的坑</a>》</p>
<h2 data-id="heading-10">11. 统计数量</h2>
<p>在多线程的场景中，有时候需要统计数量，比如：用多线程导入供应商数据时，统计导入成功的供应商数有多少。</p>
<p>如果这时候用count++统计次数，最终的结果可能会不准。因为count++并非原子操作，如果多个线程同时执行该操作，则统计的次数，可能会出现异常。</p>
<p>为了解决这个问题，就需要使用<code>concurent</code>的<code>atomic</code>包下面的类，比如：<code>AtomicInteger</code>、<code>AtomicLong</code>等。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Servcie</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ImportSupplierService</span> {
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AtomicInteger</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AtomicInteger</span>(<span class="hljs-number">0</span>);

  <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">importSupplier</span><span class="hljs-params">(List&lt;SupplierInfo&gt; supplierList)</span> {
       <span class="hljs-keyword">if</span>(CollectionUtils.isEmpty(supplierList)) {
           <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
       }

       supplierList.parallelStream().forEach(x -&gt; {
           <span class="hljs-keyword">try</span> {
             importSupplier(x);
             count.addAndGet(<span class="hljs-number">1</span>);
           } <span class="hljs-keyword">catch</span>(Exception e) {
              log.error(e.getMessage(),e);
           }
       );

      <span class="hljs-keyword">return</span> count.get();
  }    
}
</code></pre>
<p><code>AtomicInteger</code>的底层说白了使用<code>自旋锁</code>+<code>CAS</code>。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-title function_">incrementAndGet</span><span class="hljs-params">()</span> {
    <span class="hljs-keyword">for</span> (;;) {
        <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> get();
        <span class="hljs-type">int</span> <span class="hljs-variable">next</span> <span class="hljs-operator">=</span> current + <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (compareAndSet(current, next))
            <span class="hljs-keyword">return</span> next;
    }
}
</code></pre>
<p><code>自旋锁</code>说白了就是一个<code>死循环</code>。</p>
<p>而<code>CAS</code>是<code>比较</code>和<code>交换</code>的意思。</p>
<p>它的实现逻辑是：将内存位置处的<code>旧值</code>与<code>预期值</code>进行比较，若相等，则将内存位置处的值替换为<code>新值</code>。若不相等，则不做任何操作。</p>
<h2 data-id="heading-11">12. 延迟定时任务</h2>
<p>我们经常有延迟处理数据的需求，比如：如果用户下单后，超过30分钟还未完成支付，则系统自动将该订单取消。</p>
<p>这里需求就可以使用<code>延迟定时任务</code>实现。</p>
<p><code>ScheduledExecutorService</code>是<code>JDK1.5+</code>版本引进的定时任务，该类位于<code>java.util.concurrent</code>并发包下。</p>
<p>ScheduledExecutorService是基于多线程的，设计的初衷是为了解决<code>Timer</code>单线程执行，多个任务之间会互相影响的问题。</p>
<p>它主要包含4个方法：</p>
<ul>
<li>schedule(Runnable command,long delay,TimeUnit unit)，带延迟时间的调度，只执行一次，调度之后可通过Future.get()阻塞直至任务执行完毕。</li>
<li>schedule(Callable callable,long delay,TimeUnit unit)，带延迟时间的调度，只执行一次，调度之后可通过Future.get()阻塞直至任务执行完毕，并且可以获取执行结果。</li>
<li>scheduleAtFixedRate，表示以固定频率执行的任务，如果当前任务耗时较多，超过定时周期period，则当前任务结束后会立即执行。</li>
<li>scheduleWithFixedDelay，表示以固定延时执行任务，延时是相对当前任务结束为起点计算开始时间。</li>
</ul>
<p>实现这种定时任务的具体代码如下：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ScheduleExecutorTest</span> {

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">scheduledExecutorService</span> <span class="hljs-operator">=</span> Executors.newScheduledThreadPool(<span class="hljs-number">5</span>);
        scheduledExecutorService.scheduleAtFixedRate(() -&gt; {
            System.out.println(<span class="hljs-string">"doSomething"</span>);
        },<span class="hljs-number">1000</span>,<span class="hljs-number">1000</span>, TimeUnit.MILLISECONDS);
    }
}
</code></pre>
<p>调用<code>ScheduledExecutorService</code>类的<code>scheduleAtFixedRate</code>方法实现周期性任务，每隔1秒钟执行一次，每次延迟1秒再执行。</p>
<p>这种定时任务是阿里巴巴开发者规范中用来替代<code>Timer</code>类的方案，对于多线程执行周期性任务，是个不错的选择。</p>
<p>使用<code>ScheduledExecutorService</code>类做延迟定时任务的优缺点：</p>
<ul>
<li>
<p>优点：基于多线程的定时任务，多个任务之间不会相关影响，支持周期性的执行任务，并且带延迟功能。</p>
</li>
<li>
<p>缺点：不支持一些较复杂的定时规则。</p>
</li>
</ul>
<p>当然，你也可以使用分布式定时任务，比如：xxl-job或者elastic-job等等。</p>
<p>其实，在实际工作中我使用多线程的场景远远不只这12种，在这里只是抛砖引玉，介绍了一些我认为比较常见的业务场景。</p>
<p>此外，如果你对并发编程中的一些坑，比较感兴趣的话，可以看看我的另一个文章《<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%3F__biz%3DMzkwNjMwMTgzMQ%3D%3D%26mid%3D2247492962%26idx%3D1%26sn%3D17ed1d2ed950b4e9160218b296d19d4e%26chksm%3Dc0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082%26token%3D245805875%26lang%3Dzh_CN%23rd" target="_blank" title="https://mp.weixin.qq.com/s?__biz=MzkwNjMwMTgzMQ==&amp;mid=2247492962&amp;idx=1&amp;sn=17ed1d2ed950b4e9160218b296d19d4e&amp;chksm=c0e83d8af79fb49cc72fcafc8ed62822263106e54675ea8406a2e3daadb44e25364275af9082&amp;token=245805875&amp;lang=zh_CN#rd" ref="nofollow noopener noreferrer">聊聊并发编程的10个坑</a>》，里面写的非常详细。</p>
<h2 data-id="heading-12">最后说一句(求关注，别白嫖我)</h2>
<p>如果这篇文章对您有所帮助，或者有所启发的话，帮忙关注一下我的同名公众号：苏三说技术，您的支持是我坚持写作最大的动力。</p>
<p>求一键三连：点赞、转发、在看。</p>
<p>关注公众号：【苏三说技术】，在公众号中回复：进大厂，可以免费获取我最近整理的10万字的面试宝典，好多小伙伴靠这个宝典拿到了多家大厂的offer。</p>
<p>更多项目实战在我的技术网站：susan.net.cn/project</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一文搞懂RPC、gRPC与Protobuf：分布式通信的核心技术栈]]></title>    <link>https://juejin.cn/post/7599496293161828393</link>    <guid>https://juejin.cn/post/7599496293161828393</guid>    <pubDate>2026-01-26T04:00:50.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599496293161828393" data-draft-id="7598899986856820742" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一文搞懂RPC、gRPC与Protobuf：分布式通信的核心技术栈"/> <meta itemprop="keywords" content="后端,gRPC,protobuf"/> <meta itemprop="datePublished" content="2026-01-26T04:00:50.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="stark张宇"/> <meta itemprop="url" content="https://juejin.cn/user/1983974643871069"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一文搞懂RPC、gRPC与Protobuf：分布式通信的核心技术栈
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1983974643871069/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    stark张宇
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T04:00:50.000Z" title="Mon Jan 26 2026 04:00:50 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读19分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在分布式系统中，不同服务间的高效通信是核心需求之一。RPC、gRPC与Protobuf作为一套协同工作的技术组合，广泛应用于微服务、跨语言通信等场景。本文将逐一拆解三者的核心概念、工作原理，并重点分析RPC与HTTP的差异，帮助大家理清技术选型逻辑。</p>
<h3 data-id="heading-0">一、RPC：远程过程调用的核心范式</h3>
<h4 data-id="heading-1"><strong>什么是RPC</strong></h4>
<p>RPC 是一种编程思想，是一种跨进程通信协议，把在不同服务之间的通信变得高效和简单，全称是远程过程调用（Remote Procedure Call ），其核心思想是“像调用本地方法一样调用远程服务的方法”，调用另一个远程项目（服务提供者）的接口，而不需要了解数据的传输处理过程和底层网络的通信细节，让程序员专注于业务逻辑，快速开发分布式、微服务系统。</p>
<h4 data-id="heading-2"><strong>RPC的核心原理与流程</strong></h4>
<p>一次完整的RPC调用流程包含以下步骤，涉及客户端（调用方）和服务端（提供方）的协同工作：</p>
<ol start="0">
<li><strong>客户端调用本地代理（Stub）</strong> ：客户端将远程方法调用参数传递给本地Stub（类似“代理类”），Stub负责后续的通信封装。</li>
<li><strong>参数序列化</strong>：Stub将调用参数（如对象、基本类型）转换为可在网络中传输的二进制数据（序列化），避免因数据格式不兼容导致的通信问题。</li>
<li><strong>网络传输</strong>：通过底层网络协议（如TCP、UDP）将序列化后的二进制数据发送到服务端。</li>
<li><strong>服务端Stub反序列化</strong>：服务端Stub接收数据后，将二进制数据还原为原始参数（反序列化）。</li>
<li><strong>调用服务端本地方法</strong>：服务端Stub调用对应的本地业务方法，执行核心逻辑并获取返回结果。</li>
<li><strong>结果序列化与回传</strong>：服务端Stub将方法返回结果序列化，通过网络传输回客户端。</li>
<li><strong>客户端处理结果</strong>：客户端Stub反序列化返回数据，将结果传递给客户端业务代码，完成一次远程调用。</li>
</ol>
<p><strong>有了Http为啥还有RPC？</strong> Http的本质是基于请求-响应模式的应用层网络通信协议，而Rpc是远程调用本地化的一种思想，主流的RPC大多采用基于Tcp的二进制格式，传送的数据更紧凑，传送的效率也更高效。一般来说，常用于浏览器与服务器、跨服务接口调用（如RESTful API）。而Rpc更适合服务间的内部通信，RPC与HTTP虽都可用于跨服务通信，但设计目标、特性差异显著。</p>
<p>还有一点补充的是RPC并非与HTTP对立，部分RPC框架（如gRPC）底层基于HTTP/2实现，本质是“用HTTP/2作为传输载体的RPC协议”，兼顾了RPC的易用性和HTTP/2的高效特性。</p>
<h4 data-id="heading-3"><strong>远程调用过程面临的问题?</strong></h4>
<p><strong>1.Call ID映射。</strong></p>
<p>我们怎么告诉远程机器我们要调用的函数ID呢?再本地调用中，函数体是直接通过指针来指定的，我们调用function，编译器就自动帮我们调用它相应的函数指针。</p>
<p>但是在远程调用中，函数指针是不行的，因为两个进程的地址空间是完全不一样的。所以，再RPC中，所有的函数都必须有自己的一个ID。这个ID在所有的进程中都是唯一确定的。客户端在做远程调用时，必须附上这个ID。然后还需要再客户端和服务端分别维护一个{函数 &lt;--&gt; Call ID}的对应表。两者的表不一定需要完全相同，但相同函数对应的Call ID必须相同。</p>
<p>当客户端需要进行远程调用时，它就查一下这个表，找出相应的Call ID,然后把它传给服务端，服务端也通过查表，来确定客户端需要调用的函数，然后执行相应的函数的代码。</p>
<p><strong>2.序列化和反序列化</strong></p>
<p>客户端怎么把参数值传给远程函数呢?在本地调用中，我们只需要把参数压到栈里，然后让函数自己去栈里读就行。但是在远程过程调用时，客户端跟服务端是不同的进程，不能通过内存来传递参数。甚至有时候客户端和服务端使用的不是同一种编程语言，这时候就需要客户端和服务端把参数先转成一个字节流，传给服务端后再把字节流转成自己能读懂的格式，这个过程叫做序列化和反序列化。</p>
<p><strong>3.网络传输</strong></p>
<p>远程调用往往用在网络上，客户端和服务端是通过网络连接的。所有的数据都需要通过网络传输，因此就需要一个网络传输层。网络传输层需要把Call ID和序列化后的参数字节流传给服务端，然后在把序列化后的调用结果返回客户端，只要能完成这两者的，都可以作为传输层使用。</p>
<p>因此，它所使用的协议其实是不限的，能完成传输就行。尽管大部分Rpc框架都使用Tcp协议，但其实Udp也可以，gRPC干脆使用了Http2。</p>
<h3 data-id="heading-4">二、Protobuf：高效的序列化协议</h3>
<p>Protobuf（Protocol Buffers）是Google开源的一种<strong>语言无关、平台无关、可扩展</strong>的二进制序列化协议，用于将结构化数据序列化为紧凑的二进制格式，适用于数据存储、通信协议等场景。它是gRPC的默认序列化协议，也是目前高性能RPC通信的首选序列化方案之一。</p>
<h4 data-id="heading-5">Protobuf的核心特性</h4>
<ul>
<li><strong>高效紧凑</strong>：采用二进制编码，序列化后的数据体积远小于JSON/XML，解析速度更快（比JSON快3-5倍甚至更高），减少网络传输开销和解析耗时。</li>
<li><strong>跨语言/跨平台</strong>：支持Java、Go、Python、C++等多种语言，可在不同平台（Windows、Linux、Mac）间无缝传输数据，适配跨语言RPC场景。</li>
<li><strong>可扩展性强</strong>：支持字段的新增和废弃，且向后兼容（旧版本程序可解析新版本数据，新版本程序可兼容旧版本数据），无需担心接口升级导致的兼容性问题。</li>
<li><strong>强类型约束</strong>：通过IDL定义数据结构，编译后生成对应语言的代码，强制数据类型校验，避免因类型不匹配导致的异常，提升代码健壮性。</li>
</ul>
<h4 data-id="heading-6"><strong>我们为什么需要 protoc和protoc-gen-go？</strong></h4>
<p><code>proto</code> 文件本质上是<strong>纯文本的协议定义</strong>，比如定义了消息结构、字段类型、服务接口等，它只是一份 “设计图纸”—— 计算机无法直接识别和使用这份图纸，必须把它转换成对应编程语言（比如 Go）的可执行代码，才能在程序中实现序列化、反序列化、网络通信等功能。</p>
<p>而 protoc 和 protoc-gen-go 就是完成 “图纸转代码” 这个核心任务的工具，二者分工协作，缺一不可。</p>
<p>protoc 要执行的就是把Protobuf文件生成对应语言的源码 ，而protoc-gen-go 是生成Go语言的源码</p>
<p>由于你的 <code>protoc</code> 版本是 3.15.5，直接安装最新版插件会出现版本不兼容问题，因此需要指定适配的版本：</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装 protoc-gen-go（适配 3.15.5 的版本）</span>
go install google.golang.org/protobuf/cmd/protoc-gen-go@v1.27.1

<span class="hljs-comment"># 安装 protoc-gen-go-grpc（适配 3.15.5 的版本）</span>
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@v1.1.0

<span class="hljs-comment"># 查看 protoc-gen-go 版本</span>
protoc-gen-go --version
<span class="hljs-comment"># 查看 protoc-gen-go-grpc 版本</span>
protoc-gen-go-grpc --version
</code></pre>
<p><code>protoc</code>的基础命令格式，参数解释：</p>
<ul>
<li><code>-I .</code>：指定 proto 文件的搜索目录（当前目录）。</li>
<li><code>--go_out=.</code>：指定基础 Protobuf 代码生成到当前目录。</li>
<li><code>--go_opt=paths=source_relative</code>：按 proto 文件的相对路径生成 Go 文件（避免生成多层嵌套目录，新手友好）。</li>
<li><code>--go-grpc_out=.</code>：指定 gRPC 代码生成到当前目录。</li>
<li><code>--go-grpc_opt=paths=source_relative</code>：同上，保证 gRPC 代码和 proto 文件路径对应。</li>
</ul>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 第一步：生成基础的 Protobuf Go 代码</span>
protoc -I . helloworld.proto --go_out=. --go_opt=paths=source_relative

<span class="hljs-comment"># 第二步：生成 gRPC 相关的 Go 代码</span>
protoc -I . helloworld.proto --go-grpc_out=. --go-grpc_opt=paths=source_relative
</code></pre>
<h4 data-id="heading-7">Protobuf 文件的编写</h4>
<p>protobuf 标量类型是最基础的数据类型，以下是 proto3 核心标量类型与 Go/Python/PHP 的精准映射（重点标注易踩坑的差异）：</p>





















































































































<table><thead><tr><th>Protobuf 类型</th><th>Go 类型</th><th>Python 类型</th><th>PHP 类型</th><th>备注说明</th></tr></thead><tbody><tr><td>double</td><td>float64</td><td>float</td><td>float</td><td>64 位浮点数</td></tr><tr><td>float</td><td>float32</td><td>float</td><td>float</td><td>32 位浮点数</td></tr><tr><td>int32</td><td>int32</td><td>int</td><td>int</td><td>有符号 32 位整型，可变长编码</td></tr><tr><td>int64</td><td>int64</td><td>int</td><td>string</td><td>PHP 64 位整型易溢出，映射为字符串避免问题</td></tr><tr><td>uint32</td><td>uint32</td><td>int</td><td>int</td><td>无符号 32 位整型，可变长编码</td></tr><tr><td>uint64</td><td>uint64</td><td>int</td><td>string</td><td>同上，PHP 映射为字符串</td></tr><tr><td>sint32</td><td>int32</td><td>int</td><td>int</td><td>有符号可变长编码（负数更高效）</td></tr><tr><td>sint64</td><td>int64</td><td>int</td><td>string</td><td>有符号可变长编码（负数更高效）</td></tr><tr><td>fixed32</td><td>uint32</td><td>int</td><td>int</td><td>固定 4 字节编码，大数更高效</td></tr><tr><td>fixed64</td><td>uint64</td><td>int</td><td>string</td><td>固定 8 字节编码</td></tr><tr><td>sfixed32</td><td>int32</td><td>int</td><td>int</td><td>有符号固定 4 字节编码</td></tr><tr><td>sfixed64</td><td>int64</td><td>int</td><td>string</td><td>有符号固定 8 字节编码</td></tr><tr><td>bool</td><td>bool</td><td>bool</td><td>bool</td><td>布尔值</td></tr><tr><td>string</td><td>string</td><td>str</td><td>string</td><td>UTF-8 编码，长度 ≤ 2^32-1</td></tr><tr><td>bytes</td><td>[]byte</td><td>bytes</td><td>string</td><td>PHP 无原生 bytes 类型，用 string 存二进制</td></tr></tbody></table>
<p><strong>1.proto 简单示例</strong></p>
<pre><code class="hljs language-bash" lang="bash">syntax = <span class="hljs-string">"proto3"</span>; // 必须放在第一行，声明使用proto3语法

// 展示基本类型和默认值的message
message BasicTypeDemo {
  int32 age = 1;          // 默认值：0
  string name = 2;        // 默认值：空字符串
  bool is_student = 3;    // 默认值：<span class="hljs-literal">false</span>
  double score = 4;       // 默认值：0.0
  bytes avatar = 5;       // 默认值：空字节数组
}
</code></pre>
<p><strong>2.option go_package 的作用:</strong> <code>option go_package</code> 是 Go 语言专属的编译选项，核心作用是<strong>指定生成的 Go 代码的包路径和包名</strong>，解决 Go 模块模式下的代码导入冲突问题。</p>
<p>语法格式：<code>option go_package = "模块路径/子目录;包名";</code></p>
<ul>
<li>分号前：生成的 Go 文件存放的<strong>模块相对路径</strong>（如 <code>github.com/yourname/proto-demo/pb</code>）；</li>
<li>分号后：生成的 Go 代码的<strong>包名</strong>（省略则用目录名）。</li>
</ul>
<p>编译时：<code>protoc</code> 会根据该选项自动将生成的<code>.go</code>文件放到指定路径，并设置正确的包名。</p>
<pre><code class="hljs language-bash" lang="bash">syntax = <span class="hljs-string">"proto3"</span>;

// 假设你的Go模块名是 github.com/yourname/proto-demo
// 生成的Go代码会放到 ./pb 目录下，包名是 pb
option go_package = <span class="hljs-string">"github.com/yourname/proto-demo/pb;pb"</span>;

message User {
  string username = 1;
}
</code></pre>
<p><strong>3. proto 文件的 import 导入</strong></p>
<p><code>import</code> 用于复用其他 proto 文件中定义的 message、枚举等结构，是 Protobuf 实现代码复用的核心方式：</p>
<ul>
<li>普通导入：<code>import "路径/文件名.proto";</code>，仅当前文件可使用导入的结构；</li>
<li>公共导入：<code>import public "路径/文件名.proto";</code>，当前文件和导入当前文件的其他文件都能使用；</li>
<li>导入路径：支持相对路径（如 <code>./common.proto</code>）或绝对路径（需配合<code>protoc</code>的<code>-I</code>参数指定根目录）。</li>
</ul>
<p><strong>被导入文件：common.proto</strong></p>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";
option go_package = "github.com/yourname/proto-demo/pb;pb";

// 供其他文件复用的枚举
enum Gender {
  GENDER_UNSPECIFIED = 0;
  GENDER_MALE = 1;
  GENDER_FEMALE = 2;
}
</code></pre>
<p><strong>主文件：import_demo.proto</strong></p>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";
option go_package = "github.com/yourname/proto-demo/pb;pb";

// 导入common.proto，复用Gender枚举
import "./common.proto";

message User {
  string name = 1;
  Gender gender = 2; // 使用导入的枚举
}
</code></pre>
<p><strong>4.message 对象和 message 对象的嵌套</strong></p>
<p><code>message</code> 是 Protobuf 定义结构化数据的核心单元（类似 Go 的<code>struct</code>），支持两种嵌套方式：</p>
<ul>
<li><strong>内部嵌套</strong>：在一个 message 内定义子 message，仅能通过外部 message 的作用域访问（如 <code>Outer.Inner</code>）；</li>
<li><strong>外部嵌套</strong>：在一个 message 中直接引用其他已定义的 message 作为字段类型（同文件 / 导入的均可）；</li>
<li><code>repeated</code> 关键字：表示字段是数组 / 切片类型（默认空数组）。</li>
</ul>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";
option go_package = "github.com/yourname/proto-demo/pb;pb";

// 外部message（供嵌套引用）
message Phone {
  string number = 1;
  string type = 2; // 如"mobile"、"home"
}

// 主message，包含内部嵌套和外部引用
message UserProfile {
  string username = 1;

  // 内部嵌套message（仅UserProfile可用）
  message ExtraInfo {
    string hobby = 1;
    string signature = 2;
  }

  repeated Phone phones = 2; // 外部嵌套：引用Phone，repeated表示数组
  ExtraInfo extra_info = 3;  // 内部嵌套：使用ExtraInfo
}
</code></pre>
<p><strong>5.枚举类型</strong></p>
<p><code>enum</code> 用于定义命名常量，proto3 有严格规范：</p>
<ol>
<li>第一个枚举值必须为 0（作为默认值），通常命名为<code>XXX_UNSPECIFIED</code>；</li>
<li>可通过<code>option allow_alias = true;</code>开启别名（多个常量映射同一数值）；</li>
<li>枚举可定义在 message 内部（局部可用）或外部（全局可用）；</li>
<li>枚举字段的默认值是第一个值（值为 0 的常量）。</li>
</ol>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";
option go_package = "github.com/yourname/proto-demo/pb;pb";

// 开启别名功能
option allow_alias = true;

// 外部枚举（全局可用）
enum OrderStatus {
  ORDER_STATUS_UNSPECIFIED = 0; // 默认值
  ORDER_STATUS_PENDING = 1;
  ORDER_STATUS_PAID = 2;
  ORDER_STATUS_CONFIRMED = 2;   // 别名：PAID和CONFIRMED都对应2
}

// 内部枚举（仅Order内可用）
message Order {
  enum PaymentMethod {
    PAYMENT_METHOD_UNSPECIFIED = 0;
    PAYMENT_METHOD_ALIPAY = 1;
    PAYMENT_METHOD_WECHAT = 2;
  }

  PaymentMethod payment_method = 1; // 内部枚举
  OrderStatus status = 2;           // 外部枚举
}
</code></pre>
<h3 data-id="heading-8">三、gRPC：基于HTTP/2和Protobuf的RPC框架</h3>
<p>gRPC是Google开源的高性能跨语言RPC框架，基于HTTP/2协议传输，默认使用Protobuf作为序列化协议，完美结合了HTTP/2的高效传输能力和Protobuf的紧凑序列化优势，同时支持多种调用模式和跨语言部署。</p>
<h4 data-id="heading-9">gRPC 流模式</h4>
<p>GRPC 基于 HTTP/2 实现了四种通信模式，其中<strong>流模式</strong>是区别于传统 “一次请求一次响应” 的核心特性，分为三类：</p>
<p><strong>服务器流 RPC</strong>：客户端发送 1 个请求 → 服务器流式返回多个响应（如实时日志推送、数据分页返回）。</p>
<p><strong>客户端流 RPC</strong>：客户端流式发送多个请求 → 服务器返回 1 个响应（如批量数据上传后返回汇总结果）。</p>
<p><strong>双向流 RPC</strong>：客户端和服务器双向流式通信，双方可独立发送 / 接收数据（如即时聊天、实时音视频指令交互）。</p>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";

option go_package = "./pb;pb"; // 生成的Go代码路径

// 流模式演示服务
service StreamService {
  // 1. 服务器流RPC：客户端发请求，服务端返回流
  rpc ServerStream(StreamRequest) returns (stream StreamResponse);
  
  // 2. 客户端流RPC：客户端发流，服务端返回单个响应
  rpc ClientStream(stream StreamRequest) returns (StreamResponse);
  
  // 3. 双向流RPC：双向流式通信
  rpc BidirectionalStream(stream StreamRequest) returns (stream StreamResponse);
}

// 请求结构
message StreamRequest {
  string message = 1;
  int32 id = 2;
}

// 响应结构
message StreamResponse {
  string reply = 1;
  int32 code = 2;
}
</code></pre>
<p>服务端实现（server.go）</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"context"</span>
  <span class="hljs-string">"fmt"</span>
  <span class="hljs-string">"log"</span>
  <span class="hljs-string">"net"</span>
  <span class="hljs-string">"time"</span>

  <span class="hljs-string">"google.golang.org/grpc"</span>
  pb <span class="hljs-string">"your-project-path/pb"</span> <span class="hljs-comment">// 替换为实际pb包路径</span>
)

<span class="hljs-comment">// 实现StreamService服务</span>
<span class="hljs-keyword">type</span> streamServer <span class="hljs-keyword">struct</span> {
  pb.UnimplementedStreamServiceServer
}

<span class="hljs-comment">// 1. 服务器流RPC实现</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *streamServer)</span></span> ServerStream(req *pb.StreamRequest, stream pb.StreamService_ServerStreamServer) <span class="hljs-type">error</span> {
  log.Printf(<span class="hljs-string">"收到客户端请求：%s (id:%d)"</span>, req.Message, req.Id)
  <span class="hljs-comment">// 模拟流式返回3个响应</span>
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
    reply := fmt.Sprintf(<span class="hljs-string">"服务器流响应 %d: %s"</span>, i, req.Message)
    <span class="hljs-keyword">if</span> err := stream.Send(&amp;pb.StreamResponse{Reply: reply, Code: <span class="hljs-type">int32</span>(i)}); err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> err
    }
    time.Sleep(<span class="hljs-number">1</span> * time.Second) <span class="hljs-comment">// 模拟延迟</span>
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-comment">// 2. 客户端流RPC实现</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *streamServer)</span></span> ClientStream(stream pb.StreamService_ClientStreamServer) <span class="hljs-type">error</span> {
  <span class="hljs-keyword">var</span> total <span class="hljs-type">int32</span> = <span class="hljs-number">0</span>
  <span class="hljs-keyword">var</span> messages []<span class="hljs-type">string</span>
  <span class="hljs-comment">// 循环接收客户端流式请求</span>
  <span class="hljs-keyword">for</span> {
    req, err := stream.Recv()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
      <span class="hljs-comment">// 客户端流结束（EOF）</span>
      <span class="hljs-keyword">if</span> err.Error() == <span class="hljs-string">"EOF"</span> {
        reply := fmt.Sprintf(<span class="hljs-string">"客户端共发送%d条消息：%v"</span>, total, messages)
        <span class="hljs-keyword">return</span> stream.SendAndClose(&amp;pb.StreamResponse{Reply: reply, Code: total})
      }
      <span class="hljs-keyword">return</span> err
    }
    total++
    messages = <span class="hljs-built_in">append</span>(messages, req.Message)
    log.Printf(<span class="hljs-string">"收到客户端流请求 %d: %s"</span>, req.Id, req.Message)
  }
}

<span class="hljs-comment">// 3. 双向流RPC实现</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *streamServer)</span></span> BidirectionalStream(stream pb.StreamService_BidirectionalStreamServer) <span class="hljs-type">error</span> {
  <span class="hljs-comment">// 协程接收客户端消息</span>
  <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">for</span> {
      req, err := stream.Recv()
      <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
        log.Printf(<span class="hljs-string">"双向流接收结束: %v"</span>, err)
        <span class="hljs-keyword">return</span>
      }
      log.Printf(<span class="hljs-string">"收到双向流请求：%s (id:%d)"</span>, req.Message, req.Id)
    }
  }()

  <span class="hljs-comment">// 主线程发送流式响应</span>
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ {
    reply := fmt.Sprintf(<span class="hljs-string">"双向流服务器响应 %d"</span>, i)
    <span class="hljs-keyword">if</span> err := stream.Send(&amp;pb.StreamResponse{Reply: reply, Code: <span class="hljs-type">int32</span>(i)}); err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> err
    }
    time.Sleep(<span class="hljs-number">1</span> * time.Second)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
  <span class="hljs-comment">// 监听端口</span>
  lis, err := net.Listen(<span class="hljs-string">"tcp"</span>, <span class="hljs-string">":50051"</span>)
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    log.Fatalf(<span class="hljs-string">"监听失败: %v"</span>, err)
  }
  <span class="hljs-comment">// 创建GRPC服务器</span>
  s := grpc.NewServer()
  pb.RegisterStreamServiceServer(s, &amp;streamServer{})
  log.Println(<span class="hljs-string">"GRPC服务器启动，端口50051"</span>)
  <span class="hljs-keyword">if</span> err := s.Serve(lis); err != <span class="hljs-literal">nil</span> {
    log.Fatalf(<span class="hljs-string">"服务启动失败: %v"</span>, err)
  }
}
</code></pre>
<p>客户端实现（client.go）</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">package</span> main

<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"context"</span>
  <span class="hljs-string">"fmt"</span>
  <span class="hljs-string">"log"</span>
  <span class="hljs-string">"time"</span>

  <span class="hljs-string">"google.golang.org/grpc"</span>
  <span class="hljs-string">"google.golang.org/grpc/credentials/insecure"</span>
  pb <span class="hljs-string">"your-project-path/pb"</span> <span class="hljs-comment">// 替换为实际pb包路径</span>
)

<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> {
  <span class="hljs-comment">// 连接GRPC服务器</span>
  conn, err := grpc.Dial(<span class="hljs-string">":50051"</span>, grpc.WithTransportCredentials(insecure.NewCredentials()))
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    log.Fatalf(<span class="hljs-string">"连接失败: %v"</span>, err)
  }
  <span class="hljs-keyword">defer</span> conn.Close()
  client := pb.NewStreamServiceClient(conn)

  <span class="hljs-comment">// 1. 调用服务器流RPC</span>
  fmt.Println(<span class="hljs-string">"=== 测试服务器流RPC ==="</span>)
  serverStream, err := client.ServerStream(context.Background(), &amp;pb.StreamRequest{Message: <span class="hljs-string">"hello server stream"</span>, Id: <span class="hljs-number">1</span>})
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    log.Fatalf(<span class="hljs-string">"调用服务器流失败: %v"</span>, err)
  }
  <span class="hljs-keyword">for</span> {
    resp, err := serverStream.Recv()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">if</span> err.Error() == <span class="hljs-string">"EOF"</span> {
        <span class="hljs-keyword">break</span>
      }
      log.Fatalf(<span class="hljs-string">"接收服务器流响应失败: %v"</span>, err)
    }
    fmt.Printf(<span class="hljs-string">"收到服务器流响应：%s (code:%d)\n"</span>, resp.Reply, resp.Code)
  }

  <span class="hljs-comment">// 2. 调用客户端流RPC</span>
  fmt.Println(<span class="hljs-string">"\n=== 测试客户端流RPC ==="</span>)
  clientStream, err := client.ClientStream(context.Background())
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    log.Fatalf(<span class="hljs-string">"调用客户端流失败: %v"</span>, err)
  }
  <span class="hljs-comment">// 发送3个流式请求</span>
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
    req := &amp;pb.StreamRequest{Message: fmt.Sprintf(<span class="hljs-string">"client stream msg %d"</span>, i), Id: <span class="hljs-type">int32</span>(i)}
    <span class="hljs-keyword">if</span> err := clientStream.Send(req); err != <span class="hljs-literal">nil</span> {
      log.Fatalf(<span class="hljs-string">"发送客户端流请求失败: %v"</span>, err)
    }
    time.Sleep(<span class="hljs-number">500</span> * time.Millisecond)
  }
  <span class="hljs-comment">// 关闭客户端流，接收响应</span>
  resp, err := clientStream.CloseAndRecv()
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    log.Fatalf(<span class="hljs-string">"接收客户端流响应失败: %v"</span>, err)
  }
  fmt.Printf(<span class="hljs-string">"客户端流最终响应：%s (code:%d)\n"</span>, resp.Reply, resp.Code)

  <span class="hljs-comment">// 3. 调用双向流RPC</span>
  fmt.Println(<span class="hljs-string">"\n=== 测试双向流RPC ==="</span>)
  biStream, err := client.BidirectionalStream(context.Background())
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    log.Fatalf(<span class="hljs-string">"调用双向流失败: %v"</span>, err)
  }
  <span class="hljs-comment">// 协程发送客户端消息</span>
  <span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> {
    <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
      req := &amp;pb.StreamRequest{Message: fmt.Sprintf(<span class="hljs-string">"bi stream msg %d"</span>, i), Id: <span class="hljs-type">int32</span>(i)}
      <span class="hljs-keyword">if</span> err := biStream.Send(req); err != <span class="hljs-literal">nil</span> {
        log.Printf(<span class="hljs-string">"发送双向流请求失败: %v"</span>, err)
        <span class="hljs-keyword">return</span>
      }
      time.Sleep(<span class="hljs-number">800</span> * time.Millisecond)
    }
    <span class="hljs-comment">// 关闭客户端发送流</span>
    <span class="hljs-keyword">if</span> err := biStream.CloseSend(); err != <span class="hljs-literal">nil</span> {
      log.Printf(<span class="hljs-string">"关闭双向流发送失败: %v"</span>, err)
    }
  }()

  <span class="hljs-comment">// 接收服务器流式响应</span>
  <span class="hljs-keyword">for</span> {
    resp, err := biStream.Recv()
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">if</span> err.Error() == <span class="hljs-string">"EOF"</span> {
        <span class="hljs-keyword">break</span>
      }
      log.Fatalf(<span class="hljs-string">"接收双向流响应失败: %v"</span>, err)
    }
    fmt.Printf(<span class="hljs-string">"收到双向流响应：%s (code:%d)\n"</span>, resp.Reply, resp.Code)
  }
}
</code></pre>
<h4 data-id="heading-10">GRPC Metadata 机制</h4>
<p>Metadata 是 GRPC 的<strong>元数据传递机制</strong>，类比 HTTP 的 Header，用于在客户端和服务端之间传递非业务的附加信息（如认证 Token、请求 ID、超时时间、版本号等）：</p>
<ul>
<li>
<p>结构：键值对（key-value），key 推荐小写，以<code>grpc-</code>开头的 key 为 GRPC 保留字段。</p>
</li>
<li>
<p>类型：支持字符串（<code>metadata.Pairs</code>）和二进制值（需转字符串传递）。</p>
</li>
<li>
<p>传递方向：</p>
<ul>
<li>客户端 → 服务端：通过上下文（Context）注入 Metadata。</li>
<li>服务端 → 客户端：分为<code>Header Metadata</code>（响应头）和<code>Trailing Metadata</code>（响应尾），可主动返回。</li>
</ul>
</li>
</ul>
<p><strong>服务端添加 Metadata 处理（server.go）</strong></p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 新增导入</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"google.golang.org/grpc/metadata"</span>

<span class="hljs-comment">// 重写ServerStream方法，添加Metadata解析和返回</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *streamServer)</span></span> ServerStream(req *pb.StreamRequest, stream pb.StreamService_ServerStreamServer) <span class="hljs-type">error</span> {
  <span class="hljs-comment">// 1. 提取客户端传递的Metadata</span>
  md, ok := metadata.FromIncomingContext(stream.Context())
  <span class="hljs-keyword">if</span> !ok {
    log.Println(<span class="hljs-string">"未获取到客户端Metadata"</span>)
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">if</span> tokens := md.Get(<span class="hljs-string">"token"</span>); <span class="hljs-built_in">len</span>(tokens) &gt; <span class="hljs-number">0</span> {
      log.Printf(<span class="hljs-string">"客户端Token: %s"</span>, tokens[<span class="hljs-number">0</span>])
    }
    <span class="hljs-keyword">if</span> reqIDs := md.Get(<span class="hljs-string">"request-id"</span>); <span class="hljs-built_in">len</span>(reqIDs) &gt; <span class="hljs-number">0</span> {
      log.Printf(<span class="hljs-string">"请求ID: %s"</span>, reqIDs[<span class="hljs-number">0</span>])
    }
  }

  <span class="hljs-comment">// 2. 向客户端返回Header Metadata</span>
  headerMd := metadata.Pairs(
    <span class="hljs-string">"server-version"</span>, <span class="hljs-string">"v1.0.0"</span>,
    <span class="hljs-string">"timestamp"</span>, fmt.Sprintf(<span class="hljs-string">"%d"</span>, time.Now().Unix()),
  )
  <span class="hljs-keyword">if</span> err := stream.SendHeader(headerMd); err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> err
  }

  <span class="hljs-comment">// 3. 向客户端返回Trailing Metadata</span>
  trailingMd := metadata.Pairs(
    <span class="hljs-string">"request-status"</span>, <span class="hljs-string">"success"</span>,
    <span class="hljs-string">"response-count"</span>, <span class="hljs-string">"3"</span>,
  )
  stream.SetTrailer(trailingMd)

  <span class="hljs-comment">// 原有流式响应逻辑（略）</span>
  log.Printf(<span class="hljs-string">"收到客户端请求：%s (id:%d)"</span>, req.Message, req.Id)
  <span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++ {
    reply := fmt.Sprintf(<span class="hljs-string">"服务器流响应 %d: %s"</span>, i, req.Message)
    <span class="hljs-keyword">if</span> err := stream.Send(&amp;pb.StreamResponse{Reply: reply, Code: <span class="hljs-type">int32</span>(i)}); err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> err
    }
    time.Sleep(<span class="hljs-number">1</span> * time.Second)
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<p>客户端添加 Metadata 发送和接收（client.go）</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 新增导入</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">"google.golang.org/grpc/metadata"</span>

<span class="hljs-comment">// 修改服务器流RPC调用逻辑</span>
fmt.Println(<span class="hljs-string">"=== 测试服务器流RPC（带Metadata） ==="</span>)
<span class="hljs-comment">// 1. 创建Metadata</span>
md := metadata.Pairs(
  <span class="hljs-string">"token"</span>, <span class="hljs-string">"user_123456_token"</span>,
  <span class="hljs-string">"request-id"</span>, <span class="hljs-string">"req_987654"</span>,
)
<span class="hljs-comment">// 2. 注入到上下文</span>
ctx := metadata.NewOutgoingContext(context.Background(), md)
<span class="hljs-comment">// 3. 调用RPC</span>
serverStream, err := client.ServerStream(ctx, &amp;pb.StreamRequest{Message: <span class="hljs-string">"hello server stream"</span>, Id: <span class="hljs-number">1</span>})
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
  log.Fatalf(<span class="hljs-string">"调用服务器流失败: %v"</span>, err)
}

<span class="hljs-comment">// 4. 接收服务端Header Metadata</span>
headerMd, err := serverStream.Header()
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
  log.Fatalf(<span class="hljs-string">"获取Header Metadata失败: %v"</span>, err)
}
fmt.Printf(<span class="hljs-string">"服务端Header: server-version=%s, timestamp=%s\n"</span>, 
  headerMd.Get(<span class="hljs-string">"server-version"</span>)[<span class="hljs-number">0</span>], headerMd.Get(<span class="hljs-string">"timestamp"</span>)[<span class="hljs-number">0</span>])

<span class="hljs-comment">// 5. 接收流式响应（原有逻辑，略）</span>
<span class="hljs-keyword">for</span> {
  resp, err := serverStream.Recv()
  <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">if</span> err.Error() == <span class="hljs-string">"EOF"</span> {
      <span class="hljs-keyword">break</span>
    }
    log.Fatalf(<span class="hljs-string">"接收响应失败: %v"</span>, err)
  }
  fmt.Printf(<span class="hljs-string">"收到响应：%s (code:%d)\n"</span>, resp.Reply, resp.Code)
}

<span class="hljs-comment">// 6. 接收服务端Trailing Metadata</span>
trailingMd := serverStream.Trailer()
fmt.Printf(<span class="hljs-string">"服务端Trailer: request-status=%s, response-count=%s\n"</span>, 
  trailingMd.Get(<span class="hljs-string">"request-status"</span>)[<span class="hljs-number">0</span>], trailingMd.Get(<span class="hljs-string">"response-count"</span>)[<span class="hljs-number">0</span>])
</code></pre>
<h4 data-id="heading-11">GRPC 验证器</h4>
<p>GRPC 验证器用于<strong>请求参数的前置校验</strong>，避免非法请求进入业务逻辑，核心依赖<code>protoc-gen-validate</code>插件：</p>
<ul>
<li>原理：在 Proto 文件中通过注解定义字段验证规则（如非空、长度、数值范围、正则匹配），生成对应的验证代码，服务端调用<code>Validate()</code>方法即可校验。</li>
<li>优势：校验逻辑与业务解耦，规则集中在 Proto 中，跨语言通用。</li>
<li>常用规则：<code>required</code>（非空）、<code>min_len/max_len</code>（字符串长度）、<code>gt/lt</code>（数值范围）、<code>pattern</code>（正则）等。</li>
</ul>
<pre><code class="hljs language-bash" lang="bash">go install github.com/bufbuild/protoc-gen-validate@latest
</code></pre>
<p>proto文件</p>
<pre><code class="hljs language-protobuf" lang="protobuf">syntax = "proto3";

option go_package = "./pb;pb";

// 导入验证器注解
import "validate/validate.proto";

message StreamRequest {
  // 验证规则：非空，长度1-20
  string message = 1 [(validate.rules).string = {min_len: 1, max_len: 20}];
  // 验证规则：大于0，小于100
  int32 id = 2 [(validate.rules).int32 = {gt: 0, lt: 100}];
}

// 服务定义不变
service StreamService {
  rpc ServerStream(StreamRequest) returns (stream StreamResponse);
  // ... 其他方法
}

message StreamResponse {
  string reply = 1;
  int32 code = 2;
}
</code></pre>
<p>服务端添加验证逻辑</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 新增导入</span>
<span class="hljs-keyword">import</span> (
  <span class="hljs-string">"google.golang.org/grpc/codes"</span>
  <span class="hljs-string">"google.golang.org/grpc/status"</span>
)

<span class="hljs-comment">// 修改ServerStream方法，添加参数验证</span>
<span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *streamServer)</span></span> ServerStream(req *pb.StreamRequest, stream pb.StreamService_ServerStreamServer) <span class="hljs-type">error</span> {
  <span class="hljs-comment">// 1. 参数验证（核心）</span>
  <span class="hljs-keyword">if</span> err := req.Validate(); err != <span class="hljs-literal">nil</span> {
    log.Printf(<span class="hljs-string">"参数验证失败: %v"</span>, err)
    <span class="hljs-comment">// 返回INVALID_ARGUMENT状态码</span>
    <span class="hljs-keyword">return</span> status.Error(codes.InvalidArgument, fmt.Sprintf(<span class="hljs-string">"参数非法: %v"</span>, err))
  }
​
  <span class="hljs-comment">// 原有Metadata解析、响应逻辑（略）</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<h4 data-id="heading-12">GRPC 状态码错误机制</h4>
<p>GRPC 定义了<strong>标准化状态码（StatusCode）</strong> ，用于统一表示请求处理结果，替代 HTTP 状态码，核心特点：</p>
<ul>
<li>核心状态码：共 16 种标准码，常用的有<code>OK(0)</code>（成功）、<code>INVALID_ARGUMENT(3)</code>（参数非法）、<code>UNAUTHENTICATED(16)</code>（认证失败）、<code>FAILED_PRECONDITION(9)</code>（业务规则失败）等。</li>
<li>错误结构：包含<strong>状态码</strong>、<strong>错误消息</strong>、<strong>详细信息</strong>（可通过<code>WithDetails</code>附加）。</li>
<li>使用方式：服务端通过<code>status.Error()</code>返回错误；客户端通过<code>status.FromError()</code>解析状态码和消息。</li>
</ul>
<p>服务端返回不同状态码错误</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(s *streamServer)</span></span> ServerStream(req *pb.StreamRequest, stream pb.StreamService_ServerStreamServer) <span class="hljs-type">error</span> {
  <span class="hljs-comment">// 1. 参数验证失败 → INVALID_ARGUMENT(3)</span>
  <span class="hljs-keyword">if</span> err := req.Validate(); err != <span class="hljs-literal">nil</span> {
    <span class="hljs-keyword">return</span> status.Error(codes.InvalidArgument, fmt.Sprintf(<span class="hljs-string">"参数非法: %v"</span>, err))
  }

  <span class="hljs-comment">// 2. 认证失败 → UNAUTHENTICATED(16)</span>
  md, _ := metadata.FromIncomingContext(stream.Context())
  <span class="hljs-keyword">if</span> tokens := md.Get(<span class="hljs-string">"token"</span>); <span class="hljs-built_in">len</span>(tokens) == <span class="hljs-number">0</span> || tokens[<span class="hljs-number">0</span>] != <span class="hljs-string">"user_123456_token"</span> {
    <span class="hljs-keyword">return</span> status.Error(codes.Unauthenticated, <span class="hljs-string">"token无效或缺失"</span>)
  }

  <span class="hljs-comment">// 3. 业务规则失败 → FAILED_PRECONDITION(9)（带详细信息）</span>
  <span class="hljs-keyword">if</span> req.Id == <span class="hljs-number">5</span> {
    st := status.New(codes.FailedPrecondition, <span class="hljs-string">"业务规则校验失败"</span>)
    <span class="hljs-comment">// 附加详细信息</span>
    st, err := st.WithDetails(&amp;pb.StreamResponse{Reply: <span class="hljs-string">"id不能为5"</span>, Code: <span class="hljs-number">5</span>})
    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
      <span class="hljs-keyword">return</span> st.Err()
    }
    <span class="hljs-keyword">return</span> st.Err()
  }

  <span class="hljs-comment">// 原有逻辑（略）</span>
  <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
}
</code></pre>
<p>客户端解析错误详情</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-comment">// 调用RPC（id=5）</span>
serverStream, err := client.ServerStream(ctx, &amp;pb.StreamRequest{Message: <span class="hljs-string">"test"</span>, Id: <span class="hljs-number">5</span>})
<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
  st, ok := status.FromError(err)
  <span class="hljs-keyword">if</span> !ok {
    log.Fatalf(<span class="hljs-string">"非GRPC错误: %v"</span>, err)
  }

  <span class="hljs-comment">// 解析基础信息</span>
  fmt.Printf(<span class="hljs-string">"状态码: %s (数字:%d)\n"</span>, st.Code().String(), st.Code())
  fmt.Printf(<span class="hljs-string">"错误消息: %s\n"</span>, st.Message())

  <span class="hljs-comment">// 解析详细信息</span>
  <span class="hljs-keyword">for</span> _, detail := <span class="hljs-keyword">range</span> st.Details() {
    <span class="hljs-keyword">if</span> resp, ok := detail.(*pb.StreamResponse); ok {
      fmt.Printf(<span class="hljs-string">"详细信息: %s (code:%d)\n"</span>, resp.Reply, resp.Code)
    }
  }
  <span class="hljs-comment">// 输出：</span>
  <span class="hljs-comment">// 状态码: FailedPrecondition (数字:9)</span>
  <span class="hljs-comment">// 错误消息: 业务规则校验失败</span>
  <span class="hljs-comment">// 详细信息: id不能为5 (code:5)</span>
  <span class="hljs-keyword">return</span>
}
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[我和TRAE的这一年]]></title>    <link>https://juejin.cn/post/7598403436699582498</link>    <guid>https://juejin.cn/post/7598403436699582498</guid>    <pubDate>2026-01-24T02:38:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598403436699582498" data-draft-id="7598450302615715886" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="我和TRAE的这一年"/> <meta itemprop="keywords" content="Trae"/> <meta itemprop="datePublished" content="2026-01-24T02:38:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="纱雾13"/> <meta itemprop="url" content="https://juejin.cn/user/3419926705742091"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            我和TRAE的这一年
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3419926705742091/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    纱雾13
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-24T02:38:45.000Z" title="Sat Jan 24 2026 02:38:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-24
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">我和TRAE的这一年</h2>
<p>也是和Trae走过一年了！也使用了Trae做出了大大小小的项目，也学会了很多技术栈，也使用Trae参加了一些比赛都获得不错的佳绩了，来看看我和Trae的2025吧</p>
<p><strong>相遇</strong></p>
<p>相遇即在printf("MarsCode"),我还记得那是2024年6月份,我在教室看草坪发布会,我还记得<strong>海建</strong>和<strong>旭东</strong>老师在草坪上演示Marscode的能力,那个时候就深深的爱上了这个插件,在日常的学习还有一些项目的生成都是很不错的!那个时候只能使用ChatGPT豆包这类的生成后代码然后CV,出错再来一遍,现在不需要了!真的很惊艳~然后就到2025年的假期的时候还有超多由杜昔月老师的共学课程,在直播间和她的小助理一起使用Marscode生成一些代码,那个时候就认定了,觉得这个社区很不错,能学到好多开发的技术!也获得了很多周边!
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/575637b9768b4e289c330be82ce4b431~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=TPu5S8scp%2FWQGPH7kdqwhyghY5w%3D" alt="img_v3_02tf_594afca5-d3aa-4606-a881-ff2367ee2d0g.jpg" loading="lazy"/></p>
<p><strong>Trae 社区活动真的好多!</strong></p>
<p>8月份进入到了飞书的社群,这里活动更加丰富了,且社群比之前大了好多!有好多大佬进入到这个群里,在这里真的学到了特别多!
也是在这个时候,觉得是我学生时代写的代码和开发项目的巅峰了,在这里参加了各种种类的活动
例如发表到Trae公众号的借用大模型的能力去进行规范事务的一个项目
<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F3W2wmNS8NpzReUn5ifSsMQ" target="_blank" title="https://mp.weixin.qq.com/s/3W2wmNS8NpzReUn5ifSsMQ" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/3W2wmNS8N…</a></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/8409f118b20341248a6b100d624deb98~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=rnE2So5Q89o4p5MqcqHzCh6SFyw%3D" alt="img_v3_02tf_4ec1b381-bb29-4387-b0cb-9b6f9a14689g.jpg" loading="lazy"/>
<img src="" alt="" loading="lazy"/></p>
<p>当然还有在1024程序员节的时候,演示过的项目等等等等超多
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/70c4d4f4ba384336b74988d6a84ca439~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=MPvIyJ%2BhkFwsIvTLsYSvbCoU6fY%3D" alt="img_v3_02tf_f4ce8d62-bd58-4b9a-8c7c-13962f1ab33g.png" loading="lazy"/></p>
<p>当然因为我还是一个学生,使用Trae参加了一些互联网开发的比赛均获得了省里不错的成绩!</p>
<p><strong>Trae的线下活动!</strong></p>
<p>不得不说,我的第一次线下参加关于编程类的活动就是Trae,真的参加第一次,就想参加第二次,学到了很多有干料的开发技巧!</p>
<p>第一次参加的Trae的活动!(luna莫怪我拍的不好看)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/7aa63c6df9724399a9ffac8cf3bc4423~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=qOFQa9WtFCrk7jLLWT2A2qKB8Ko%3D" alt="img_v3_02tf_c9ace577-1c7f-4c3e-a45d-a2189d0b3ceg.png" loading="lazy"/>
第一次参加Hackathon,就获得了一等奖!且我的同学们也都获取了佳绩!真的很不错的线下体验!
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c196da2aa6104a93831761340497faf6~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=sMuNUoHGQTgZoRkbfgZUK9KjLvE%3D" alt="img_v3_02tf_0add46fe-f608-4a5f-a12e-e968fc864b6g.jpg" loading="lazy"/>
<strong>Trae周边!</strong></p>
<p>当然这一年也获得了超多的周边!(不完全统计)
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/da676d6bb54d4a40978b2d58248bb05e~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=BrsX4s7vdvza83M0j6Uh9OyIvJQ%3D" alt="img_v3_02tf_fee564d7-7fa0-4a5c-93ae-06f3b743207g.jpg" loading="lazy"/></p>
<p><strong>使用 Trae 开源自己的 skill</strong></p>
<p>最佳 skill 概念特别好，也是使用 Trae 去做出自己的一套 skill文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwcn1msagbpwc.feishu.cn%2Fwiki%2FP7VPw22RfinnVHk2FeXcvtFfn7b%3Ffrom%3Dfrom_copylink" target="_blank" title="https://wcn1msagbpwc.feishu.cn/wiki/P7VPw22RfinnVHk2FeXcvtFfn7b?from=from_copylink" ref="nofollow noopener noreferrer">Trae Skills 开发技巧</a>
自己检索了现在比较流行的 anthropics/skills、vercel-labs/agent-skills 及ComposioHQ/awesome-claude-skills 这3 个库的精华，自己整合构建出这个skills 库
省流示例如下：</p>
<p>一句话开发，就有专门的 skill 去自动分配任务</p>
<pre><code class="hljs">我想开发一个 简单的 todolist 项目，请带我走一遍全流程。
</code></pre>
<p>就会自动的去划分任务出来，配合 Trae 的 todolist 实现高效开发
<img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5aeea57884fa46979bffba972d64688d~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg57qx6Zu-MTM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769827125&amp;x-signature=9eJkN%2BUuHsVL9ZoqqajJwf0Kom0%3D" alt="img_v3_02u6_21f61828-5395-470a-92d4-a8720f61749g.jpg" loading="lazy"/></p>
<p><strong>最后!</strong></p>
<p>那最后呢,希望Trae越来越好,在2026实现更多跨时代的一些功能,惊艳的功能,让 <strong>The Real AI Engineer</strong> 更加伟大!‌</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[2026：拒绝 AI 焦虑，我手写了一个 ReAct 智能体]]></title>    <link>https://juejin.cn/post/7598947628468125742</link>    <guid>https://juejin.cn/post/7598947628468125742</guid>    <pubDate>2026-01-25T16:00:43.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598947628468125742" data-draft-id="7598881914204258354" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="2026：拒绝 AI 焦虑，我手写了一个 ReAct 智能体"/> <meta itemprop="keywords" content="前端,Agent,AIGC"/> <meta itemprop="datePublished" content="2026-01-25T16:00:43.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="辰枫"/> <meta itemprop="url" content="https://juejin.cn/user/2946346892407735"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            2026：拒绝 AI 焦虑，我手写了一个 ReAct 智能体
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2946346892407735/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    辰枫
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T16:00:43.000Z" title="Sun Jan 25 2026 16:00:43 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读15分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">前言</h2>
<p>2025年史称“Agent”元年，自从 ChatGPT 的爆火，自己也一直使用的是 Chat 类的 AI工具。其它类型的工具只是推特上看到，但是自己很少使用。有时在自己推特的 timline上会出现很多爆火的AI工具，刷多了会对于自己产生一些焦虑，但仅仅是产生（毕竟人在自己的舒适区，是很难自己走出来的）。加上最近的招聘市场和公司都很注重 Agent 这块，所以决定花时间好好研究下 Agent。为未来做准备，同时也会包装自己。</p>
<p>整体的学习大纲，用最近听到一句话来说“<strong>体系完整先于逻辑自洽和观点正误</strong>”，先学习整体的 Agent 的整体框架再慢慢研究。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ae9e11edd0e94dc6ab9e9c5bc22d3e1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=Qm9qAEnllqVh%2Bvmxa3tsltT10k0%3D" alt="" loading="lazy"/></p>
<h2 data-id="heading-1">什么是AI Agent</h2>
<blockquote>
<p><em>“AI agents are software systems that use AI to pursue goals and complete tasks on behalf of users. They show reasoning, planning, and memory and have a level of autonomy to make decisions, learn, and adapt.”</em> <em>— Google Cloud</em></p>
<p>AI 智能体是使用 AI来实现目标和代表用户完成任务的软件系统，其表现中推理、规划和记忆能力。并且有一定的自主性，能够自主学习、适应和做出决定</p>
</blockquote>
<p>这里引用<a href="https://link.juejin.cn?target=https%3A%2F%2Fbaoyu.io%2Fblog%2Fai-agent-frontend-rebirth-from-failure" target="_blank" title="https://baoyu.io/blog/ai-agent-frontend-rebirth-from-failure" ref="nofollow noopener noreferrer">宝王老师</a>对于 AI Agent 的定义：</p>
<p>AI Agent 是为了实现一个目标，循环调用工具的大语言模型。</p>
<ul>
<li>工具循环（Tools）：模型调用工具 -&gt; 获取结果 -&gt; 继续推理</li>
<li>有明确终点：为达成目标，而不是无限调用</li>
<li>目标来源灵活：可以来自用户，也可以来自另一个 LLM</li>
<li>基础记忆能力：通过对话历史保存上下文信息</li>
</ul>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/68f21815462a4cd6b623d30cca302c1a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=fVJpQmQSLJJ64JEmpAeWo%2FdQaB4%3D" alt="image.png" loading="lazy"/></p>
<h2 data-id="heading-2">AI Agent （AI 智能体）经典范式</h2>
<h3 data-id="heading-3">ReAct范式</h3>
<p>在 ReAct 范式出现之前，主流的方法可以分为两类：</p>
<ul>
<li>“纯思考”：如<strong>思维链（Chain-of-Thought）</strong> ,引导模型进行复杂的逻辑推理，但无法与外界进行交互，容易生成幻觉</li>
<li>“纯行动”：模型直接输出执行的动作，缺乏规划和纠错能力</li>
</ul>
<h4 data-id="heading-4"><strong>什么是 ReAct 范式</strong></h4>
<p>从字面上看ReAct 单词读和<a href="https://link.juejin.cn?target=https%3A%2F%2Freact.dev%2F" target="_blank" title="https://react.dev/" ref="nofollow noopener noreferrer">前端框架 React</a>一样发音，只是把 A进行了大写，但是是完全不同的东西。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2210.03629" target="_blank" title="https://arxiv.org/abs/2210.03629" ref="nofollow noopener noreferrer">ReAct (Reason 和 Act)</a>最早是由<a href="https://link.juejin.cn?target=https%3A%2F%2Fysymyth.github.io%2F" target="_blank" title="https://ysymyth.github.io/" ref="nofollow noopener noreferrer">姚顺雨</a>于 2022 年提出，其核心思想是模仿人类解决问题的方式，将<strong>思考(Reasoning)与行动(Acting)结合</strong>起来。形成一个“思考 -&gt; 行动-&gt;观察”的循环。ReAct 的精妙之处在于，它认识到<strong>思考与行动是相辅相成的</strong>，思考指导行动，而行动的结果又会反过来为思考提供依据。在执行上的是通过一种特殊的Prompt 来引导 LLM，使其每一步都遵循一个固定的轨迹。</p>
<ol>
<li><strong>Thought (思考)</strong> ：在执行任务前，先进行分析当前任务情况、分析任务、规划下一步，或者反思上一步的结果</li>
<li><strong>Action (行动)</strong> ：根据上一步的思考结果决定采用的具体行动，通常会调用外部的 Tools</li>
<li><strong>Observation (观察)</strong> ：这是执行 Action 后从 Tools 返回的结果</li>
</ol>
<p>在这个范式中，Agent会不断的 Loop这个流程，将新的观察结果追加到历史的记录中，形成一个不断增长的上下文，直到 Thought 中判断已经找到正确的答案，然后输出结果。整个过程中<strong>思考使任务更具有目标性，而行动又为下一次的思考提供了事实依据</strong>。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0add9da7a86342159d070efcb9e45ead~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=FSZZisLXpeIhHHWRQYSa5f%2FwaaM%3D" alt="image.png" loading="lazy"/></p>
<h4 data-id="heading-5">ReAct适用场景</h4>
<ul>
<li><strong>需要外部知识的任务</strong>：查询实时信息</li>
<li><strong>需要精确计算的任务</strong>：数据计算问题</li>
<li><strong>需要与 API交互的任务</strong>：如操作数据库、调用某个 API 完成任务</li>
</ul>
<h4 data-id="heading-6">什么是工具（Tools）</h4>
<p>上面介绍了 ReAct 整体的范式，提到了一个概念 Tools，那么什么是 Tools 呢？</p>
<p>我们都知道 LLM是一个用固定数据训练出来的模型，有自主思考的能力相当于大脑，但是只有大脑还不够还要有“手和脚”与真实的外部世界交互。这些手和脚就是 Tools</p>
<h4 data-id="heading-7">ReAct智能体实战</h4>
<p>了解完了 ReAct 整体的概念，下面我们通过一个具体的需求来实际体验下。</p>
<p>需求：<strong>你需要编写一个智能体，用于<strong><strong>分析</strong></strong>用户的需求，回答用户的问题</strong>。</p>
<p>例如：小米手机的最新手机是哪一款？</p>
<h5 data-id="heading-8">需求分析</h5>
<p>想要解决这个问题，我们需为Agent 提供一个网页搜索的工具。让 LLM 调用去实时搜索信息，然后基于搜索的结果让 LLM再判断是不是正确的结果。</p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/66812aaa54fe48c794a708c8d4050060~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg6L6w5p6r:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769961643&amp;x-signature=HkoVvEGls1VThbMzBfyCxMQzwdE%3D" alt="image.png" loading="lazy"/></p>
<h5 data-id="heading-9">编码实现</h5>
<h6 data-id="heading-10">系统提示词（Prompt）</h6>
<p>基于 ReAct 整体的机制，我们需要设置一个提示词。主要包含以下点：</p>
<ol>
<li>定义LLM 的角色或使用场景</li>
<li>定义 LLM可使用的工具</li>
<li>定义 LLM响应的格式，从而方便的让程序处理</li>
<li>定义用户的问题和整个思考的过程即动态上下文</li>
</ol>
<p>根据以上几点，我们设计的系统提示词如下：</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">REACT_PROMPT_TEMPLATE</span> = <span class="hljs-string">`
请注意， 你是一个有能力调用外部工具的智能助手

可用工具如下：
{tools}

请严格按以下格式回应：

Thought: 你的思考过程，用于分析问题、拆解任务和规划下一步行动
Action: 你采取的行动必须是以下格式之一：
- `</span>{{tool_name}}[{{tool_input}}]<span class="hljs-string">`:调用一个可用工具
- `</span><span class="hljs-title class_">Finish</span>[最终答案]<span class="hljs-string">`: 当你认为已经获取最终答案时

现在请开始解决以下问题：
Question: {question}
History: {history}
`</span>;
</code></pre>
<h6 data-id="heading-11"><strong>工具（Tools）</strong></h6>
<p>按提示词的设计，这里我们先编写给LLM调用的工具函数，选用<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fserpapi%2Fserpapi-javascript" target="_blank" title="https://github.com/serpapi/serpapi-javascript" ref="nofollow noopener noreferrer"> SerpApi</a>，根据官方提供的 SDK 封装一个函数（使用前需要去<a href="https://link.juejin.cn?target=https%3A%2F%2Fserpapi.com%2F" target="_blank" title="https://serpapi.com/" ref="nofollow noopener noreferrer">官网</a>注册一个账号获取免费的额度）。</p>
<blockquote>
<p>SearchApi 是一个强大的实时SERP API，可提供来自Google 搜索、Google 招聘、YouTube、Google 新闻等搜索引擎集合的结构化数据</p>
</blockquote>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">import</span> { getJson } <span class="hljs-keyword">from</span> <span class="hljs-string">'serpapi'</span>;
<span class="hljs-keyword">import</span> { requireEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;

<span class="hljs-comment">/**
 * 基于 SerApi实现的网页搜索工具
 * <span class="hljs-doctag">@param</span> <span class="hljs-variable">query</span>
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">query: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">const</span> apiKey = requireEnv(<span class="hljs-string">'SERPAPI_API_KEY'</span>);
    <span class="hljs-keyword">if</span> (!apiKey) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">'错误：SERPAPI_API_KEY没有定义在.env 文件中'</span>;
    }
    
    <span class="hljs-keyword">const</span> params = {
      <span class="hljs-attr">engine</span>: <span class="hljs-string">'google'</span>,
      <span class="hljs-attr">q</span>: query,
      <span class="hljs-attr">api_key</span>: apiKey,
      <span class="hljs-attr">gl</span>: <span class="hljs-string">'cn'</span>,
      <span class="hljs-attr">hl</span>: <span class="hljs-string">'zh-cn'</span>,
    };

    <span class="hljs-keyword">const</span> results = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getJson</span>(params);

    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(results.<span class="hljs-property">answer_box_list</span>)) {
      <span class="hljs-keyword">return</span> results.<span class="hljs-property">answer_box_list</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
    }

    <span class="hljs-keyword">if</span> (results.<span class="hljs-property">answer_box</span> &amp;&amp; results.<span class="hljs-property">answer_box</span>.<span class="hljs-property">answer</span>) {
      <span class="hljs-keyword">return</span> results.<span class="hljs-property">answer_box</span>.<span class="hljs-property">answer</span>;
    }

    <span class="hljs-keyword">if</span> (
      results.<span class="hljs-property">knowledge_graph</span> &amp;&amp;
      results.<span class="hljs-property">knowledge_graph</span>.<span class="hljs-property">description</span>
    ) {
      <span class="hljs-keyword">return</span> results.<span class="hljs-property">knowledge_graph</span>.<span class="hljs-property">description</span>;
    }

    <span class="hljs-keyword">if</span> (
      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(results.<span class="hljs-property">organic_results</span>) &amp;&amp;
      results.<span class="hljs-property">organic_results</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>
    ) {
      <span class="hljs-comment">// 如果没有直接答案，则返回前三个有机结果的摘要</span>
      <span class="hljs-keyword">const</span> snippets = results.<span class="hljs-property">organic_results</span>
        .<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)
        .<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">res: <span class="hljs-built_in">any</span>, i: <span class="hljs-built_in">number</span></span>) =&gt;</span> {
          <span class="hljs-keyword">return</span> <span class="hljs-string">`[<span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>] <span class="hljs-subst">${res.title || <span class="hljs-string">''</span>}</span>\n<span class="hljs-subst">${res.snippet || <span class="hljs-string">''</span>}</span>`</span>;
        });
      <span class="hljs-keyword">return</span> snippets.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n\n'</span>);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-string">`对不起，没有找到关于 '<span class="hljs-subst">${query}</span>' 的信息。`</span>;
  } <span class="hljs-keyword">catch</span> (error) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`发生错误: <span class="hljs-subst">${error}</span>`</span>;
  }
}
</code></pre>
<p>为了后续我们方便的添加新的 Tools 我们需要构造一个通用的工具构造器</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Tools</span> = {
  <span class="hljs-attr">description</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">func</span>: <span class="hljs-title class_">Function</span>;
};

<span class="hljs-comment">/**
 * 工具执行器，负责管理和执行工具
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ToolsExecutor</span> {
  <span class="hljs-attr">tools</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Tools</span>&gt;;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"/>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span> = {};
  }

  <span class="hljs-title function_">registerTool</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, desc: <span class="hljs-built_in">string</span>, func: <span class="hljs-built_in">Function</span></span>) {
    <span class="hljs-keyword">if</span> (name <span class="hljs-keyword">in</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>)) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">warn</span>(<span class="hljs-string">'同名工具已存在，将进行覆盖'</span>);
    }

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>[name] = { <span class="hljs-attr">description</span>: desc, <span class="hljs-attr">func</span>: func };
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`工具 <span class="hljs-subst">${name}</span> 已注册 \n`</span>);
  }

  <span class="hljs-title function_">getTool</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {    
    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>).<span class="hljs-title function_">includes</span>(name)) {
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>[name]?.<span class="hljs-property">func</span>;
    }
  }

  <span class="hljs-title function_">getAvailableTools</span>(<span class="hljs-params"/>) {
    <span class="hljs-keyword">const</span> allTools = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> [name, info] <span class="hljs-keyword">of</span> <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">entries</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tools</span>)) {
      allTools.<span class="hljs-title function_">push</span>(<span class="hljs-string">`- <span class="hljs-subst">${name}</span>: <span class="hljs-subst">${info?.description}</span>`</span>);
    }

    <span class="hljs-keyword">return</span> allTools.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);
  }
}
</code></pre>
<p>接下来我们测试这些函数</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">import</span> { search } <span class="hljs-keyword">from</span> <span class="hljs-string">"./tools"</span>;
<span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> dotenv <span class="hljs-keyword">from</span> <span class="hljs-string">'dotenv'</span>;

<span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"/>) {
  dotenv.<span class="hljs-title function_">config</span>();
  <span class="hljs-keyword">const</span> executor = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ToolsExecutor</span>();
  executor.<span class="hljs-title function_">registerTool</span>(
    <span class="hljs-string">'Search'</span>,
    <span class="hljs-string">'基于 SerApi实现的网页搜索工具'</span>,
    search
  );

  <span class="hljs-keyword">const</span> toolFunc = executor.<span class="hljs-title function_">getTool</span>(<span class="hljs-string">'Search'</span>);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'可用工具列表:'</span>);
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(executor.<span class="hljs-title function_">getAvailableTools</span>());

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`\n 执行 Search 工具:`</span>);
  <span class="hljs-keyword">if</span> (toolFunc) {
    <span class="hljs-title function_">toolFunc</span>(<span class="hljs-string">'人工智能的未来是什么？'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">string</span></span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'搜索结果:'</span>);
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);
    });
  }
}
<span class="hljs-title function_">main</span>();

&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; 执行结果如下：
工具 <span class="hljs-title class_">Search</span> 已注册 

可用工具列表:
- <span class="hljs-title class_">Search</span>: 基于 <span class="hljs-title class_">SerApi</span>实现的网页搜索工具

 执行 <span class="hljs-title class_">Search</span> 工具:
搜索结果:
[<span class="hljs-number">1</span>] 人工智能的未来
<span class="hljs-variable constant_">AI</span> 未来的定义将是转向用于实验的开源大规模模型，以及开发更小、更高效的<span class="hljs-variable constant_">AI</span> 模型，以提高易用性并降低成本。

[<span class="hljs-number">2</span>] <span class="hljs-number">2025</span>,人工智能走向何方？我们如何拥抱变化？
“当前，新一代人工智能等数字技术正在爆发式发展，将进一步推动制造业的效率变革，未来有望带动工厂的研发、生产、组织和服务全方面的革新。”中国信息通信研 ...

[<span class="hljs-number">3</span>] 中国人工智能的未来之路
在人口老龄化的大背景下，人工智能对推动中国未来的经济增长将起到至关重要的作用。中国的劳动年龄人口最早将在<span class="hljs-number">2024</span>年达到峰值，并在之后的<span class="hljs-number">50</span>年中减少五分之一。麦肯锡全球 ...
</code></pre>
<h6 data-id="heading-12">实现Agent</h6>
<p>首先，我们要对接大模型厂商提供的服务，OpenAI的接口规范，已经成为 LLM 行业的接口标准。国内的厂商基本都兼容了此标准</p>
<p>免费的厂商服务？现在基本国内的大模型厂商在注册账号之后基本都会提供一定的免费额度，我这里使用的火山引擎下的火山方舟的服务。</p>
<p>先安装<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fopenai%2Fopenai-node" target="_blank" title="https://github.com/openai/openai-node" ref="nofollow noopener noreferrer">open ai sdk</a> <code>npm install openai</code>，然后我们基于这个 SDK 封装一个通用的llm 对接类，方便后续复用</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">import</span> <span class="hljs-title class_">OpenAI</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'openai'</span>;
<span class="hljs-keyword">import</span> { requireEnv } <span class="hljs-keyword">from</span> <span class="hljs-string">'./utils'</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">type</span> <span class="hljs-title class_">ChatCompletionMessageParam</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'openai/resources'</span>;

<span class="hljs-comment">/**
 *  Hello Agents 定制的 LLM 客户端
 *  它用于调用任何兼容 OpenAI 接口的服务，并默认使用流式响应
 */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HelloAgentsLLM</span> {
  <span class="hljs-attr">model</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">apiKey</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">baseUrl</span>: <span class="hljs-built_in">string</span>;
  <span class="hljs-attr">timeout</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">client</span>: <span class="hljs-title class_">OpenAI</span>;

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    model?: <span class="hljs-built_in">string</span>,
    apiKey?: <span class="hljs-built_in">string</span>,
    baseUrl?: <span class="hljs-built_in">string</span>,
    timeout: <span class="hljs-built_in">number</span> = <span class="hljs-number">60</span>,
  </span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> = model || requireEnv(<span class="hljs-string">'LLM_MODEL_ID'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span> = apiKey || requireEnv(<span class="hljs-string">'LLM_API_KEY'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> = baseUrl || requireEnv(<span class="hljs-string">'LLM_BASE_URL'</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">timeout</span> = requireEnv(<span class="hljs-string">'LLM_TIMEOUT'</span>)
      ? <span class="hljs-title class_">Number</span>(requireEnv(<span class="hljs-string">'LLM_TIMEOUT'</span>))
      : timeout;

    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span> || !<span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
        <span class="hljs-string">'模型 ID、API 密钥和服务地址必须被提供或在.env 文件中定义'</span>,
      );
    }

    <span class="hljs-comment">// console.log(this.baseUrl)</span>

    <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OpenAI</span>({
      <span class="hljs-attr">baseURL</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">baseUrl</span>,    
      <span class="hljs-attr">apiKey</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">apiKey</span>,
      <span class="hljs-comment">// timeout: this.timeout Error: Request timed out.</span>
    });
  }

  <span class="hljs-keyword">async</span> <span class="hljs-title function_">think</span>(<span class="hljs-params">messages: <span class="hljs-built_in">Array</span>&lt;ChatCompletionMessageParam&gt;, temperature = <span class="hljs-number">0</span></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'开始调用大模型'</span>);
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">client</span>.<span class="hljs-property">chat</span>.<span class="hljs-property">completions</span>.<span class="hljs-title function_">create</span>({
        <span class="hljs-attr">model</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">model</span>,
        <span class="hljs-attr">messages</span>: messages,
        <span class="hljs-attr">temperature</span>: temperature,
        <span class="hljs-attr">stream</span>: <span class="hljs-literal">true</span>,
      });

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'调用大模型成功 \n'</span>);

      <span class="hljs-keyword">const</span> collectedContent = [];
      <span class="hljs-keyword">for</span> <span class="hljs-keyword">await</span> (<span class="hljs-keyword">const</span> chunk <span class="hljs-keyword">of</span> response) {
        <span class="hljs-comment">// 处理每个 chunk        </span>
        <span class="hljs-keyword">const</span> c = chunk.<span class="hljs-property">choices</span>[<span class="hljs-number">0</span>]?.<span class="hljs-property">delta</span>.<span class="hljs-property">content</span> || <span class="hljs-string">""</span>;
        collectedContent.<span class="hljs-title function_">push</span>(c);
      }
      <span class="hljs-keyword">return</span> collectedContent.<span class="hljs-title function_">join</span>(<span class="hljs-string">""</span>)
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`调用 LLM API时发生错误: <span class="hljs-subst">${e}</span>`</span>)
        <span class="hljs-keyword">return</span>
    }
  }
}
</code></pre>
<p>接下，我们按 ReAct 范式的规范，实现 ReActAgent。</p>
<ol>
<li>在整个 Agent中我们需要初始化：llm客户端、可调用的工具、整个交互的历史信息</li>
</ol>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReActAgent</span> {
  <span class="hljs-attr">llmClient</span>: <span class="hljs-title class_">HelloAgentsLLM</span>;
  <span class="hljs-attr">toolsExecutor</span>: <span class="hljs-title class_">ToolsExecutor</span>;
  <span class="hljs-attr">maxStep</span>: <span class="hljs-built_in">number</span>;
  <span class="hljs-attr">history</span>: <span class="hljs-built_in">string</span>[];

  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">
    llmClient: HelloAgentsLLM,
    toolsExecutor: ToolsExecutor,
    maxStep = <span class="hljs-number">5</span></span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">llmClient</span> = llmClient;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">toolsExecutor</span> = toolsExecutor;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxStep</span> = maxStep;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = [];
      }
  }
</code></pre>
<ol start="2">
<li>接下来我们来实现核心的 run 方法：</li>
</ol>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">async</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">question: <span class="hljs-built_in">string</span></span>) {
   <span class="hljs-comment">// 1. 重置整体流程</span>
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span> = [];
    <span class="hljs-keyword">let</span> currentStep = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// 2. 循环调用LLM</span>
    <span class="hljs-keyword">while</span> (currentStep &lt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxStep</span>) {
      currentStep += <span class="hljs-number">1</span>;

      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`--- 执行第 <span class="hljs-subst">${currentStep}</span> 步 ---`</span>);

      <span class="hljs-comment">// 2.1 根据提示词的模版，传入参数。获取完整版本提示词 </span>
      <span class="hljs-keyword">const</span> toolsDesc = <span class="hljs-variable language_">this</span>.<span class="hljs-property">toolsExecutor</span>.<span class="hljs-title function_">getAvailableTools</span>();
      <span class="hljs-comment">// 历史上下文拼接</span>
      <span class="hljs-keyword">let</span> historyStr = <span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">join</span>(<span class="hljs-string">'\n'</span>);

      <span class="hljs-keyword">const</span> prompt = <span class="hljs-title function_">formatPrompt</span>(<span class="hljs-variable constant_">REACT_PROMPT_TEMPLATE</span>, {
        <span class="hljs-attr">tools</span>: toolsDesc,
        <span class="hljs-attr">question</span>: question,
        <span class="hljs-attr">history</span>: historyStr,
      });

      <span class="hljs-keyword">let</span> <span class="hljs-attr">messages</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ChatCompletionMessageParam</span>&gt; = [
        {
          <span class="hljs-attr">role</span>: <span class="hljs-string">'user'</span>,
          <span class="hljs-attr">content</span>: prompt,
        },
      ];
        
      <span class="hljs-comment">// 2.2 请求 LLM,获取响应</span>
      <span class="hljs-keyword">const</span> responseTxt = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">llmClient</span>.<span class="hljs-title function_">think</span>(messages);

      <span class="hljs-keyword">if</span> (!responseTxt) {
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`错误：大模型返回异常`</span>);
        <span class="hljs-keyword">break</span>;
      }
 }
</code></pre>
<p>之前我们要求 LLM 在返回时必须带有以下格式：</p>
<pre><code class="hljs language-TS" lang="TS">请严格按以下格式回应：

<span class="hljs-title class_">Thought</span>: 你的思考过程，用于分析问题、拆解任务和规划下一步行动
<span class="hljs-title class_">Action</span>: 你采取的行动必须是以下格式之一：
- <span class="hljs-string">`{{tool_name}}[{{tool_input}}]`</span>:调用一个可用工具
- <span class="hljs-string">`Finish[最终答案]`</span>: 当你认为已经获取最终答案时
</code></pre>
<p>接下来，我们只要使用正则表达式，来提取 LLM 的响应即可：</p>
<pre><code class="hljs language-typescript" lang="typescript">    <span class="hljs-comment">/**
     * 解析 LLM 输出，提取 Thought 和 Action
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">_parseOutput</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): { <span class="hljs-attr">thought</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>; <span class="hljs-attr">action</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> } {
        <span class="hljs-keyword">const</span> thoughtMatch = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Thought: (.*)/</span>);
        <span class="hljs-keyword">const</span> actionMatch = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/Action: (.*)/</span>);
        <span class="hljs-keyword">const</span> thought = thoughtMatch?.[<span class="hljs-number">1</span>]?.<span class="hljs-title function_">trim</span>() ?? <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">const</span> action = actionMatch?.[<span class="hljs-number">1</span>]?.<span class="hljs-title function_">trim</span>() ?? <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> { thought, action };
    }
  <span class="hljs-comment">/**
   * 解析 Action 字符串，提取工具名称和输入
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_parseAction</span>(<span class="hljs-attr">actionText</span>: <span class="hljs-built_in">string</span>): [<span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>, <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>] {
    <span class="hljs-keyword">const</span> match = actionText.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/(\w+)[(.*)]/</span>);
    <span class="hljs-keyword">if</span> (match) {
      <span class="hljs-keyword">return</span> [match[<span class="hljs-number">1</span>] ?? <span class="hljs-literal">null</span>, match[<span class="hljs-number">2</span>] ?? <span class="hljs-literal">null</span>];
    }
    <span class="hljs-keyword">return</span> [<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>];
  }

  <span class="hljs-comment">/**
   * 解析 Action 输入，提取参数
   */</span>
  <span class="hljs-keyword">private</span> <span class="hljs-title function_">_parseActionInput</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> {
    <span class="hljs-keyword">const</span> inputMatch = text.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\w+[(.*)]/</span>);
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(inputMatch)
    <span class="hljs-keyword">return</span> inputMatch &amp;&amp; <span class="hljs-keyword">typeof</span> inputMatch[<span class="hljs-number">1</span>] === <span class="hljs-string">'string'</span> ? inputMatch[<span class="hljs-number">1</span>] : <span class="hljs-literal">null</span>;
  }
</code></pre>
<ul>
<li><code>_parseOutput</code>：负责从 LLM返回的消息中提取 Thought 和 Action 两个最主要的部分</li>
<li><code>_parseAction</code>：负责Action 字符串中，提取工具名和参数，例如：Search[Oppo]，工具名：Search，参数：Oppo</li>
</ul>
<p>解析响应结果并执行工具函数</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-keyword">const</span> {thought, action} = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseOutput</span>(responseTxt);
<span class="hljs-keyword">if</span>(thought) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`思考：<span class="hljs-subst">${thought}</span> \n`</span>)
  }

  <span class="hljs-keyword">if</span>(!action) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'没有下一步Action, 流程终止'</span>)
    <span class="hljs-keyword">break</span>;
  }
  
  <span class="hljs-keyword">if</span>(action.<span class="hljs-title function_">startsWith</span>(<span class="hljs-string">'`Finish'</span>)) {
    <span class="hljs-keyword">const</span> finalAnswer = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseActionInput</span>(action)
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`最终答案：<span class="hljs-subst">${finalAnswer}</span> \n`</span>)
    <span class="hljs-keyword">return</span> finalAnswer;
  }

  <span class="hljs-keyword">const</span> [toolName, toolInput] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_parseAction</span>(action);
  <span class="hljs-keyword">if</span>(!toolInput || !toolName) {
    <span class="hljs-keyword">continue</span>;
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`行动: <span class="hljs-subst">${toolName}</span> <span class="hljs-subst">${toolInput}</span>\n`</span>)

  <span class="hljs-keyword">const</span> toolFun = <span class="hljs-variable language_">this</span>.<span class="hljs-property">toolsExecutor</span>.<span class="hljs-title function_">getTool</span>(toolName)
  <span class="hljs-keyword">let</span> observation = <span class="hljs-string">`错误： 未找到名为 '<span class="hljs-subst">${toolName}</span>' 的工具`</span>
  <span class="hljs-keyword">if</span>(toolFun) {
    <span class="hljs-comment">// 使用 call 来实现工具函数的执行</span>
    observation = <span class="hljs-keyword">await</span> toolFun.<span class="hljs-title function_">call</span>(<span class="hljs-literal">null</span>, toolInput)
  }
</code></pre>
<p>这段代码就是，解析 LLM响应的结果，如果以 <code>Finish</code> 开始就代表 LLM已经给出了最终的结果，如果不是则需要提取<code>Action</code>，并执行 <code>Action</code>获取响应结果。</p>
<p>最后把本次调用响应的结果（<code>observation</code>），放入到 history 中，供下次 LLM 思考参考</p>
<pre><code class="hljs language-TS" lang="TS"><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`观察 <span class="hljs-subst">${observation}</span> \n\n`</span>)
<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Action: <span class="hljs-subst">${action}</span>`</span>)
<span class="hljs-variable language_">this</span>.<span class="hljs-property">history</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Observation: <span class="hljs-subst">${observation}</span>`</span>)
</code></pre>
<p>当然，在 while 循环中设置的有 max_step。程序并不会无限循环，达到一定次数自动停止。</p>
<p>下面是运行 console 结果：</p>
<pre><code class="hljs language-TS" lang="TS">工具 <span class="hljs-title class_">Search</span> 已注册 

--- 执行第 <span class="hljs-number">1</span> 步 ---
开始调用大模型
调用大模型成功 

<span class="hljs-title class_">Thought</span>: 为了回答这个问题，我需要查找小米最新发布的手机型号及其主要卖点。由于小米会定期发布新手机，我需要通过搜索工具获取最新的信息。

<span class="hljs-title class_">Action</span>: <span class="hljs-string">`Search[小米最新手机型号和卖点]`</span>
思考：为了回答这个问题，我需要查找小米最新发布的手机型号及其主要卖点。由于小米会定期发布新手机，我需要通过搜索工具获取最新的信息。 

行动: <span class="hljs-title class_">Search</span> 小米最新手机型号和卖点

观察 [<span class="hljs-number">1</span>] 小米全系列选购指南：<span class="hljs-number">2026</span>年爆款机型+各系列核心卖点_手机
小米数字系列定位<span class="hljs-number">3999</span>元以上高端市场，是追求旗舰性能与均衡体验用户的首选。小米<span class="hljs-number">17</span>搭载骁龙<span class="hljs-number">8</span> <span class="hljs-title class_">Gen5</span>处理器，配备2K <span class="hljs-variable constant_">LTPO</span>直屏与5300mAh电池，支持90W快充，机身 ...

[<span class="hljs-number">2</span>] 手机 - 小米商城
<span class="hljs-title class_">Redmi</span> 14C. <span class="hljs-number">599</span>起. <span class="hljs-variable constant_">CPU</span>型号<span class="hljs-title class_">MediaTek</span> <span class="hljs-title class_">Helio</span> <span class="hljs-variable constant_">G81</span>-<span class="hljs-title class_">Ultra</span> ; <span class="hljs-title class_">Redmi</span> <span class="hljs-title class_">Note</span> <span class="hljs-number">14</span> <span class="hljs-title class_">Pro</span>. <span class="hljs-number">1149</span>起 · <span class="hljs-variable constant_">CPU</span>型号天玑<span class="hljs-number">7300</span>-<span class="hljs-title class_">Ultra</span> ; <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版. <span class="hljs-number">7999</span>起 · <span class="hljs-variable constant_">CPU</span>型号第五代骁龙<span class="hljs-number">8</span>至尊版 ...

[<span class="hljs-number">3</span>] 小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>的最强卖点，却成了用户退货的理由
小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>徕卡版因变焦环松动问题引发用户不满，官方回应称是设计预留活动空间所致，但未能消除质疑。该问题涉及产品设计、制造公差和用户体验。 


--- 执行第 <span class="hljs-number">2</span> 步 ---
开始调用大模型
调用大模型成功 

<span class="hljs-title class_">Thought</span>: 根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括搭载第五代骁龙<span class="hljs-number">8</span>至尊版处理器，以及徕卡版的影像系统。不过，搜索结果也提到了一些用户对变焦环松动的反馈。为了更全面地了解这款手机的卖点，我需要进一步搜索小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版的详细规格和官方宣传信息。

<span class="hljs-title class_">Action</span>: <span class="hljs-string">`Search[小米17 Ultra 徕卡版 官方卖点]`</span>
思考：根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括搭载第五代骁龙<span class="hljs-number">8</span>至尊版处理器，以及徕卡版的影像系统。不过，搜索结果也提到了一些用户对变焦环松动的反馈。为了更全面地了解这款手机的卖点，我需要进一步搜索小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版的详细规格和官方宣传信息。 

行动: <span class="hljs-title class_">Search</span> 小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版 官方卖点

观察 [<span class="hljs-number">1</span>] <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版
<span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版，方方面面尽徕卡。徕卡相机感设计，徕卡经典红标，中框精雕横滚花，镌刻徕卡铭文。创新大师变焦环，如相机般精密操控；支持功能自定义，时刻服务你的 ...

[<span class="hljs-number">2</span>] <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版立即购买-小米商城
<span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版 ; <span class="hljs-number">299</span>元. <span class="hljs-title class_">Xiaomi</span> <span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 保值换新服务 · <span class="hljs-number">299</span>元 ; <span class="hljs-title class_">MiCare</span> 无忧版已省<span class="hljs-number">500</span>元. 加购后碎屏保升级为<span class="hljs-number">2</span>年多次，详见服务介绍 · <span class="hljs-number">499</span>元 ; 延长保<span class="hljs-number">1</span>年<span class="hljs-number">349</span>元. 性能 ...

[<span class="hljs-number">3</span>] 小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>的最强卖点，却成了用户退货的理由
小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span>徕卡版因变焦环松动问题引发用户不满，官方回应称是设计预留活动空间所致，但未能消除质疑。该问题涉及产品设计、制造公差和用户体验。 


--- 执行第 <span class="hljs-number">3</span> 步 ---
开始调用大模型
调用大模型成功 

<span class="hljs-title class_">Thought</span>: 根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计。虽然变焦环设计引发了一些用户的不满，但官方解释这是设计预留的活动空间。因此，可以确认小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版是小米最新的手机，其卖点主要集中在徕卡合作的高端相机体验和设计上。

<span class="hljs-title class_">Action</span>: <span class="hljs-string">`Finish[小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。]`</span>
思考：根据搜索结果，小米最新的手机型号是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计。虽然变焦环设计引发了一些用户的不满，但官方解释这是设计预留的活动空间。因此，可以确认小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版是小米最新的手机，其卖点主要集中在徕卡合作的高端相机体验和设计上。 
-- 变量 ---
[
  <span class="hljs-string">'Finish[小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。]'</span>,
  <span class="hljs-string">'小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。'</span>,
  <span class="hljs-attr">index</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">input</span>: <span class="hljs-string">'`Finish[小米最新的手机是小米17 Ultra 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。]`'</span>,
  <span class="hljs-attr">groups</span>: <span class="hljs-literal">undefined</span>
]
最终答案：小米最新的手机是小米<span class="hljs-number">17</span> <span class="hljs-title class_">Ultra</span> 徕卡版。它的主要卖点包括徕卡相机感设计、徕卡经典红标、中框精雕横滚花、镌刻徕卡铭文，以及创新的变焦环设计，提供如相机般的精密操控体验。
</code></pre>
<p>注意</p>
<p>由于大模型能力的不同，不确认我们的搜索结果也一样。我这里使用的是<code>deepseek-v3-250324</code>这个模型执行的结果。</p>
<p>最后，想看全部的代码请在这里查看<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fjavaswing%2Flearn-agent%2Ftree%2Ffeature%2Fts%2Fchap4%2Fts" target="_blank" title="https://github.com/javaswing/learn-agent/tree/feature/ts/chap4/ts" ref="nofollow noopener noreferrer">github.com/javaswing/l…</a></p>
<h2 data-id="heading-13">总结</h2>
<p>本文，通过对于 ReAct 范式的介绍，并结合 HelloAgent一书中的例子进行了实践。对于 Agent的开发有了体感。征途刚刚开始。</p>
<h2 data-id="heading-14">参考</h2>
<ol>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcloud.google.com%2Fdiscover%2Fwhat-are-ai-agents" target="_blank" title="https://cloud.google.com/discover/what-are-ai-agents" ref="nofollow noopener noreferrer">cloud.google.com/discover/wh…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Faiagent.app%2F" target="_blank" title="https://aiagent.app/" ref="nofollow noopener noreferrer">aiagent.app/</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fbaoyu.io%2Fblog%2Fai-agent-frontend-rebirth-from-failure" target="_blank" title="https://baoyu.io/blog/ai-agent-frontend-rebirth-from-failure" ref="nofollow noopener noreferrer">baoyu.io/blog/ai-age…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdatawhalechina.github.io%2Fhello-agents%2F%23%2F.%2Fchapter4%2F%25E7%25AC%25AC%25E5%259B%259B%25E7%25AB%25A0%2520%25E6%2599%25BA%25E8%2583%25BD%25E4%25BD%2593%25E7%25BB%258F%25E5%2585%25B8%25E8%258C%2583%25E5%25BC%258F%25E6%259E%2584%25E5%25BB%25BA" target="_blank" title="https://datawhalechina.github.io/hello-agents/#/./chapter4/%E7%AC%AC%E5%9B%9B%E7%AB%A0%20%E6%99%BA%E8%83%BD%E4%BD%93%E7%BB%8F%E5%85%B8%E8%8C%83%E5%BC%8F%E6%9E%84%E5%BB%BA" ref="nofollow noopener noreferrer">datawhalechina.github.io/hello-agent…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.ibm.com%2Fthink%2Ftopics%2Freact-agent" target="_blank" title="https://www.ibm.com/think/topics/react-agent" ref="nofollow noopener noreferrer">www.ibm.com/think/topic…</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Freact-lm.github.io%2F" target="_blank" title="https://react-lm.github.io/" ref="nofollow noopener noreferrer">react-lm.github.io/</a></li>
</ol></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[从零开始：手把手教你创建 Vue 3 + TypeScript 项目]]></title>    <link>https://juejin.cn/post/7599094262591946762</link>    <guid>https://juejin.cn/post/7599094262591946762</guid>    <pubDate>2026-01-25T17:35:03.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262591946762" data-draft-id="7599094262591930378" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="从零开始：手把手教你创建 Vue 3 + TypeScript 项目"/> <meta itemprop="keywords" content="Vue.js,TypeScript"/> <meta itemprop="datePublished" content="2026-01-25T17:35:03.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="鱼予余"/> <meta itemprop="url" content="https://juejin.cn/user/1345457964195192"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            从零开始：手把手教你创建 Vue 3 + TypeScript 项目
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1345457964195192/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    鱼予余
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T17:35:03.000Z" title="Sun Jan 25 2026 17:35:03 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>本文将带你一步步创建完整的 Vue 3 项目，包含现代化的开发工具链、代码规范和最佳实践。适合前端开发者学习和参考。</p>
</blockquote>
<h2 data-id="heading-0">前言</h2>
<p>Vue 3 带来了 Composition API、更好的 TypeScript 支持和性能优化，是现代前端开发的较广泛的选择。本教程将从环境搭建开始，逐步创建完整的 Vue 3 项目。</p>
<h2 data-id="heading-1">环境准备</h2>
<h3 data-id="heading-2">1. Node.js 环境</h3>
<p>Vue 3 项目需要 Node.js 环境，推荐使用 LTS 版本。</p>
<h4 data-id="heading-3">Windows 系统</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 访问 Node.js 官网下载安装包</span>
<span class="hljs-comment"># https://nodejs.org/</span>

<span class="hljs-comment"># 或使用 nvm-windows 管理多个版本</span>
<span class="hljs-comment"># 1. 下载 nvm-windows: https://github.com/coreybutler/nvm-windows/releases</span>
<span class="hljs-comment"># 2. 安装并重启命令行</span>
nvm install 20.19.0
nvm use 20.19.0
</code></pre>
<h4 data-id="heading-4">macOS 系统</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 使用 Homebrew 安装</span>
brew install node

<span class="hljs-comment"># 或使用 nvm 管理版本</span>
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
<span class="hljs-built_in">source</span> ~/.bashrc
nvm install 20.19.0
nvm use 20.19.0
</code></pre>
<h4 data-id="heading-5">验证安装</h4>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 检查版本</span>
node --version  <span class="hljs-comment"># 应显示 v20.19.0 或更高</span>
npm --version   <span class="hljs-comment"># 应显示 10.x.x 或更高</span>
</code></pre>
<h3 data-id="heading-6">2. 包管理工具</h3>
<p>推荐使用 npm 或 pnpm，yarn 也可以。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 全局安装 pnpm (可选)</span>
npm install -g pnpm

<span class="hljs-comment"># 检查版本</span>
pnpm --version
</code></pre>
<h3 data-id="heading-7">3. IDE 配置</h3>
<p>推荐使用 VS Code，并安装 Vue 相关插件。</p>
<h4 data-id="heading-8">必需插件</h4>
<ul>
<li><strong>Vue (Official)</strong> - Vue 官方插件，提供语法高亮和智能提示</li>
<li><strong>TypeScript Importer</strong> - 自动导入 TypeScript 类型</li>
<li><strong>Prettier</strong> - 代码格式化</li>
<li><strong>ESLint</strong> - 代码检查</li>
</ul>
<h4 data-id="heading-9">VS Code 设置</h4>
<pre><code class="hljs language-json" lang="json"><span class="hljs-comment">// .vscode/settings.json</span>
<span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"typescript.preferences.importModuleSpecifier"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"relative"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.formatOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.defaultFormatter"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"esbenp.vscode-prettier"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"editor.codeActionsOnSave"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"source.fixAll.eslint"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-10">项目创建</h2>
<h3 data-id="heading-11">方法一：使用 Vite 官方模板</h3>
<p>Vite 是 Vue 官方推荐的构建工具，速度快，开发体验好。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目</span>
npm create vue@latest vue-course

<span class="hljs-comment"># 进入项目目录</span>
<span class="hljs-built_in">cd</span> vue-course
</code></pre>
<h4 data-id="heading-12">配置选项</h4>
<p>在创建过程中选择以下配置：</p>
<pre><code class="hljs">✅ TypeScript
✅ JSX
✅ Vue Router
✅ Pinia
✅ ESLint
✅ Prettier
</code></pre>
<h3 data-id="heading-13">方法二：手动创建项目</h3>
<p>如果你喜欢自定义配置，可以手动创建。</p>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 创建项目目录</span>
<span class="hljs-built_in">mkdir</span> vue-course
<span class="hljs-built_in">cd</span> vue-course

<span class="hljs-comment"># 初始化 package.json</span>
npm init -y

<span class="hljs-comment"># 安装核心依赖</span>
npm install vue@latest @vue/compiler-sfc@latest
npm install -D @vitejs/plugin-vue@latest vite@latest
npm install -D typescript@latest vue-tsc@latest
</code></pre>
<h2 data-id="heading-14">项目配置</h2>
<h3 data-id="heading-15">1. Vite 配置</h3>
<p>创建 <code>vite.config.ts</code> 文件：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { defineConfig } <span class="hljs-keyword">from</span> <span class="hljs-string">'vite'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'@vitejs/plugin-vue'</span>
<span class="hljs-keyword">import</span> { resolve } <span class="hljs-keyword">from</span> <span class="hljs-string">'path'</span>

<span class="hljs-comment">// https://vitejs.dev/config/</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">plugins</span>: [<span class="hljs-title function_">vue</span>()],
  <span class="hljs-attr">resolve</span>: {
    <span class="hljs-attr">alias</span>: {
      <span class="hljs-string">'@'</span>: <span class="hljs-title function_">resolve</span>(__dirname, <span class="hljs-string">'src'</span>)
    }
  },
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">port</span>: <span class="hljs-number">5173</span>,
    <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">build</span>: {
    <span class="hljs-attr">target</span>: <span class="hljs-string">'esnext'</span>,
    <span class="hljs-attr">minify</span>: <span class="hljs-string">'esbuild'</span>,
    <span class="hljs-attr">outDir</span>: <span class="hljs-string">'dist'</span>
  }
})
</code></pre>
<h3 data-id="heading-16">2. TypeScript 配置</h3>
<p>创建 <code>tsconfig.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/tsconfig/tsconfig.dom.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"env.d.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.vue"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"exclude"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"src/**/__tests__/*"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"composite"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"baseUrl"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"."</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"paths"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
      <span class="hljs-attr">"@/*"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"./src/*"</span><span class="hljs-punctuation">]</span>
    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"vite/client"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>创建 <code>tsconfig.node.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/tsconfig/tsconfig.dom.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"vite.config.*"</span><span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"composite"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"node"</span><span class="hljs-punctuation">]</span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>创建 <code>env.d.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-comment">/// &lt;reference types="vite/client" /&gt;</span>

<span class="hljs-keyword">declare</span> <span class="hljs-variable language_">module</span> <span class="hljs-string">'*.vue'</span> {
  <span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">DefineComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
  <span class="hljs-keyword">const</span> <span class="hljs-attr">component</span>: <span class="hljs-title class_">DefineComponent</span>&lt;{}, {}, <span class="hljs-built_in">any</span>&gt;
  <span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> component
}
</code></pre>
<h3 data-id="heading-17">3. ESLint 配置</h3>
<p>创建 <code>eslint.config.js</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">import</span> js <span class="hljs-keyword">from</span> <span class="hljs-string">'@eslint/js'</span>
<span class="hljs-keyword">import</span> vue <span class="hljs-keyword">from</span> <span class="hljs-string">'eslint-plugin-vue'</span>
<span class="hljs-keyword">import</span> typescript <span class="hljs-keyword">from</span> <span class="hljs-string">'@typescript-eslint/eslint-plugin'</span>
<span class="hljs-keyword">import</span> typescriptParser <span class="hljs-keyword">from</span> <span class="hljs-string">'@typescript-eslint/parser'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> [
  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/files-to-lint'</span>,
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.{ts,mts,tsx,vue}'</span>],
  },

  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/files-to-ignore'</span>,
    <span class="hljs-attr">ignores</span>: [<span class="hljs-string">'**/dist/**'</span>, <span class="hljs-string">'**/dist-ssr/**'</span>, <span class="hljs-string">'**/coverage/**'</span>],
  },

  js.<span class="hljs-property">configs</span>.<span class="hljs-property">recommended</span>,
  ...vue.<span class="hljs-property">configs</span>[<span class="hljs-string">'flat/essential'</span>],

  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/vue-rules'</span>,
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.vue'</span>],
    <span class="hljs-attr">languageOptions</span>: {
      <span class="hljs-attr">parser</span>: vue.<span class="hljs-property">parser</span>,
      <span class="hljs-attr">parserOptions</span>: {
        <span class="hljs-attr">parser</span>: typescriptParser,
        <span class="hljs-attr">extraFileExtensions</span>: [<span class="hljs-string">'.vue'</span>],
        <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>,
      },
    },
  },

  {
    <span class="hljs-attr">name</span>: <span class="hljs-string">'app/typescript-rules'</span>,
    <span class="hljs-attr">files</span>: [<span class="hljs-string">'**/*.{ts,mts,tsx,vue}'</span>],
    <span class="hljs-attr">languageOptions</span>: {
      <span class="hljs-attr">parser</span>: typescriptParser,
      <span class="hljs-attr">parserOptions</span>: {
        <span class="hljs-attr">ecmaVersion</span>: <span class="hljs-number">2020</span>,
        <span class="hljs-attr">sourceType</span>: <span class="hljs-string">'module'</span>,
      },
    },
    <span class="hljs-attr">rules</span>: {
      ...typescript.<span class="hljs-property">configs</span>.<span class="hljs-property">recommended</span>.<span class="hljs-property">rules</span>,
      <span class="hljs-string">'@typescript-eslint/no-unused-vars'</span>: <span class="hljs-string">'error'</span>,
      <span class="hljs-string">'@typescript-eslint/explicit-function-return-type'</span>: <span class="hljs-string">'off'</span>,
    },
  },
]
</code></pre>
<h3 data-id="heading-18">4. Prettier 配置</h3>
<p>创建 <code>.prettierrc.json</code>：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"semi"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">false</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"singleQuote"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"tabWidth"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">2</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"trailingComma"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"es5"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"printWidth"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">100</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"endOfLine"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"lf"</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h2 data-id="heading-19">项目结构搭建</h2>
<h3 data-id="heading-20">1. 基础文件结构</h3>
<pre><code class="hljs language-arduino" lang="arduino">vue-course/
├── <span class="hljs-keyword">public</span>/
│   ├── favicon.ico
├── src/
│   ├── assets/
│   │   ├── base.css
│   │   ├── main.css
│   │   └── logo.svg
│   ├── components/
│   │   ├── HelloWorld.vue
│   │   ├── TheWelcome.vue
│   │   ├── WelcomeItem.vue
│   │   └── icons/
│   ├── views/
│   │   ├── HomeView.vue
│   │   └── AboutView.vue
│   ├── router/
│   │   └── index.ts
│   ├── stores/
│   │   └── counter.ts
│   ├── App.vue
│   ├── main.ts
│   └── mcp-server.ts
├── .vscode/
│   └── settings.json
├── index.html
├── package.json
├── vite.config.ts
├── tsconfig.json
├── tsconfig.app.json
├── tsconfig.node.json
├── env.d.ts
├── eslint.config.ts
├── .prettierrc.json
└── README.md
</code></pre>
<h3 data-id="heading-21">2. 入口文件</h3>
<p><code>src/main.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createApp } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { createPinia } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>
<span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">'./router'</span>
<span class="hljs-keyword">import</span> <span class="hljs-title class_">App</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'./App.vue'</span>

<span class="hljs-keyword">import</span> <span class="hljs-string">'./assets/main.css'</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">createApp</span>(<span class="hljs-title class_">App</span>)

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">createPinia</span>())
app.<span class="hljs-title function_">use</span>(router)

app.<span class="hljs-title function_">mount</span>(<span class="hljs-string">'#app'</span>)
</code></pre>
<p><code>index.html</code>：</p>
<pre><code class="hljs language-html" lang="html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">"icon"</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"image/svg+xml"</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"/favicon.ico"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Vue Course<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"app"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"module"</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/src/main.ts"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span>
</code></pre>
<h3 data-id="heading-22">3. 根组件</h3>
<p><code>src/App.vue</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div id="app"&gt;
    &lt;header class="app-header"&gt;
      &lt;h1&gt;Vue 3 项目&lt;/h1&gt;
      &lt;nav&gt;
        &lt;router-link to="/"&gt;首页&lt;/router-link&gt;
        &lt;router-link to="/about"&gt;关于&lt;/router-link&gt;
      &lt;/nav&gt;
    &lt;/header&gt;

    &lt;main class="app-main"&gt;
      &lt;router-view /&gt;
    &lt;/main&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
// 组件逻辑
&lt;/script&gt;

&lt;style scoped&gt;
.app-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 1rem 2rem;
  background: #f8f9fa;
  border-bottom: 1px solid #e9ecef;
}

.app-main {
  padding: 2rem;
  min-height: calc(100vh - 80px);
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-23">路由配置</h2>
<h3 data-id="heading-24">1. 安装 Vue Router</h3>
<pre><code class="hljs language-bash" lang="bash">npm install vue-router@4
</code></pre>
<h3 data-id="heading-25">2. 路由配置</h3>
<p><code>src/router/index.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { createRouter, createWebHistory } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue-router'</span>

<span class="hljs-keyword">const</span> routes = [
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'Home'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/HomeView.vue'</span>),
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'首页'</span> }
  },
  {
    <span class="hljs-attr">path</span>: <span class="hljs-string">'/about'</span>,
    <span class="hljs-attr">name</span>: <span class="hljs-string">'About'</span>,
    <span class="hljs-attr">component</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'../views/AboutView.vue'</span>),
    <span class="hljs-attr">meta</span>: { <span class="hljs-attr">title</span>: <span class="hljs-string">'关于'</span> }
  }
]

<span class="hljs-keyword">const</span> router = <span class="hljs-title function_">createRouter</span>({
  <span class="hljs-attr">history</span>: <span class="hljs-title function_">createWebHistory</span>(<span class="hljs-keyword">import</span>.<span class="hljs-property">meta</span>.<span class="hljs-property">env</span>.<span class="hljs-property">BASE_URL</span>),
  routes
})

<span class="hljs-comment">// 路由守卫</span>
router.<span class="hljs-title function_">beforeEach</span>(<span class="hljs-function">(<span class="hljs-params">to, <span class="hljs-keyword">from</span>, next</span>) =&gt;</span> {
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">title</span> = <span class="hljs-string">`<span class="hljs-subst">${to.meta.title}</span> - Vue Course`</span>
  <span class="hljs-title function_">next</span>()
})

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router
</code></pre>
<h3 data-id="heading-26">3. 创建页面组件</h3>
<p><code>src/views/HomeView.vue</code>：</p>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div class="home"&gt;
    &lt;h2&gt;欢迎使用 Vue 3&lt;/h2&gt;
    &lt;p&gt;当前计数: {{ count }}&lt;/p&gt;
    &lt;button @click="increment" class="btn"&gt;增加&lt;/button&gt;
    &lt;button @click="decrement" class="btn"&gt;减少&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { ref } from 'vue'

const count = ref(0)

const increment = () =&gt; count.value++
const decrement = () =&gt; count.value--
&lt;/script&gt;

&lt;style scoped&gt;
.home {
  text-align: center;
  padding: 2rem;
}

.btn {
  margin: 0 0.5rem;
  padding: 0.5rem 1rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  background: white;
  cursor: pointer;
}

.btn:hover {
  background: #f0f0f0;
}
&lt;/style&gt;
</code></pre>
<h2 data-id="heading-27">状态管理</h2>
<h3 data-id="heading-28">1. 安装 Pinia</h3>
<pre><code class="hljs language-bash" lang="bash">npm install pinia
</code></pre>
<h3 data-id="heading-29">2. 配置 Pinia</h3>
<p>已经在 <code>main.ts</code> 中配置了。</p>
<h3 data-id="heading-30">3. 创建 Store</h3>
<p><code>src/stores/counter.ts</code>：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">import</span> { ref, computed } <span class="hljs-keyword">from</span> <span class="hljs-string">'vue'</span>
<span class="hljs-keyword">import</span> { defineStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'pinia'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> useCounterStore = <span class="hljs-title function_">defineStore</span>(<span class="hljs-string">'counter'</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-comment">// 状态</span>
  <span class="hljs-keyword">const</span> count = <span class="hljs-title function_">ref</span>(<span class="hljs-number">0</span>)

  <span class="hljs-comment">// 计算属性</span>
  <span class="hljs-keyword">const</span> doubleCount = <span class="hljs-title function_">computed</span>(<span class="hljs-function">() =&gt;</span> count.<span class="hljs-property">value</span> * <span class="hljs-number">2</span>)

  <span class="hljs-comment">// 动作</span>
  <span class="hljs-keyword">const</span> <span class="hljs-title function_">increment</span> = (<span class="hljs-params"/>) =&gt; {
    count.<span class="hljs-property">value</span>++
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">decrement</span> = (<span class="hljs-params"/>) =&gt; {
    count.<span class="hljs-property">value</span>--
  }

  <span class="hljs-keyword">const</span> <span class="hljs-title function_">reset</span> = (<span class="hljs-params"/>) =&gt; {
    count.<span class="hljs-property">value</span> = <span class="hljs-number">0</span>
  }

  <span class="hljs-keyword">return</span> {
    count,
    doubleCount,
    increment,
    decrement,
    reset
  }
})
</code></pre>
<h3 data-id="heading-31">4. 在组件中使用</h3>
<pre><code class="hljs language-vue" lang="vue">&lt;template&gt;
  &lt;div&gt;
    &lt;p&gt;计数: {{ counter.count }}&lt;/p&gt;
    &lt;p&gt;双倍: {{ counter.doubleCount }}&lt;/p&gt;
    &lt;button @click="counter.increment"&gt;+&lt;/button&gt;
    &lt;button @click="counter.decrement"&gt;-&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup lang="ts"&gt;
import { useCounterStore } from '@/stores/counter'

const counter = useCounterStore()
&lt;/script&gt;
</code></pre>
<h2 data-id="heading-32">样式配置</h2>
<h3 data-id="heading-33">1. 全局样式</h3>
<p><code>src/assets/main.css</code>（项目中使用的是main.css）：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-id">#app</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">1280px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">2rem</span>;
  <span class="hljs-attribute">font-weight</span>: normal;
}

<span class="hljs-selector-tag">a</span>,
<span class="hljs-selector-class">.green</span> {
  <span class="hljs-attribute">text-decoration</span>: none;
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">hsla</span>(<span class="hljs-number">160</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">37%</span>, <span class="hljs-number">1</span>);
  <span class="hljs-attribute">transition</span>: <span class="hljs-number">0.4s</span>;
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">hover</span>: <span class="hljs-attribute">hover</span>) {
  <span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">hsla</span>(<span class="hljs-number">160</span>, <span class="hljs-number">100%</span>, <span class="hljs-number">37%</span>, <span class="hljs-number">0.2</span>);
  }
}

<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">min-width</span>: <span class="hljs-number">1024px</span>) {
  <span class="hljs-selector-tag">body</span> {
    <span class="hljs-attribute">display</span>: flex;
    place-items: center;
  }

  <span class="hljs-selector-id">#app</span> {
    <span class="hljs-attribute">display</span>: grid;
    <span class="hljs-attribute">grid-template-columns</span>: <span class="hljs-number">1</span>fr <span class="hljs-number">1</span>fr;
    <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span> <span class="hljs-number">2rem</span>;
  }
}
</code></pre>
<p><code>src/assets/base.css</code>：</p>
<pre><code class="hljs language-css" lang="css">*,
*<span class="hljs-selector-pseudo">::before</span>,
*<span class="hljs-selector-pseudo">::after</span> {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}

<span class="hljs-selector-tag">html</span> {
  <span class="hljs-attribute">font-family</span>: -apple-system, BlinkMacSystemFont, <span class="hljs-string">'Segoe UI'</span>, Roboto, sans-serif;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.5</span>;
  -webkit-text-size-adjust: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">padding</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#333</span>;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;
}

<span class="hljs-selector-tag">h1</span>, <span class="hljs-selector-tag">h2</span>, <span class="hljs-selector-tag">h3</span>, <span class="hljs-selector-tag">h4</span>, <span class="hljs-selector-tag">h5</span>, <span class="hljs-selector-tag">h6</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
  <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">600</span>;
  <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.2</span>;
}

<span class="hljs-selector-tag">p</span> {
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">1rem</span> <span class="hljs-number">0</span>;
}

<span class="hljs-selector-tag">a</span> {
  <span class="hljs-attribute">color</span>: <span class="hljs-number">#007acc</span>;
  <span class="hljs-attribute">text-decoration</span>: none;
}

<span class="hljs-selector-tag">a</span><span class="hljs-selector-pseudo">:hover</span> {
  <span class="hljs-attribute">text-decoration</span>: underline;
}

<span class="hljs-selector-tag">button</span> {
  <span class="hljs-attribute">font-family</span>: inherit;
  <span class="hljs-attribute">border</span>: none;
  <span class="hljs-attribute">cursor</span>: pointer;
}

<span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">100%</span>;
  <span class="hljs-attribute">height</span>: auto;
}
</code></pre>
<h2 data-id="heading-34">开发和构建</h2>
<h3 data-id="heading-35">1. 开发服务器</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 启动开发服务器</span>
npm run dev

<span class="hljs-comment"># 或使用自定义端口</span>
npm run dev -- --port 3000
</code></pre>
<h3 data-id="heading-36">2. 构建生产版本</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 构建生产版本</span>
npm run build

<span class="hljs-comment"># 预览构建结果</span>
npm run preview
</code></pre>
<h3 data-id="heading-37">3. 代码检查</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 代码格式化</span>
npm run format

<span class="hljs-comment"># 代码检查</span>
npm run lint

<span class="hljs-comment"># 类型检查</span>
npm run type-check
</code></pre>
<h2 data-id="heading-38">部署选项</h2>
<h3 data-id="heading-39">1. 静态站点部署</h3>
<h4 data-id="heading-40">Vercel</h4>
<pre><code class="hljs language-bash" lang="bash">npm i -g vercel
vercel
</code></pre>
<h4 data-id="heading-41">Netlify</h4>
<pre><code class="hljs language-bash" lang="bash">npm i -g netlify-cli
netlify deploy
</code></pre>
<h2 data-id="heading-42">常见问题</h2>
<h3 data-id="heading-43">1. 依赖安装失败</h3>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 清理缓存</span>
npm cache clean --force
<span class="hljs-built_in">rm</span> -rf node_modules package-lock.json

<span class="hljs-comment"># 使用国内镜像</span>
npm config <span class="hljs-built_in">set</span> registry https://registry.npmmirror.com

<span class="hljs-comment"># 重新安装</span>
npm install
</code></pre>
<h3 data-id="heading-44">2. TypeScript 错误</h3>
<p>确保 <code>tsconfig.json</code> 配置正确：</p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"extends"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"@vue/tsconfig/tsconfig.dom.json"</span><span class="hljs-punctuation">,</span>
  <span class="hljs-attr">"include"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"env.d.ts"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"src/**/*.vue"</span><span class="hljs-punctuation">]</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<h3 data-id="heading-45">3. 热重载不工作</h3>
<p>检查 Vite 配置：</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>({
  <span class="hljs-attr">server</span>: {
    <span class="hljs-attr">hmr</span>: <span class="hljs-literal">true</span>
  }
})
</code></pre>
<h2 data-id="heading-46">总结</h2>
<p>通过本教程，你已经创建了一个完整的 Vue 3 项目，包含：</p>
<ul>
<li>✅ 现代化的开发工具链</li>
<li>✅ TypeScript 支持</li>
<li>✅ 组件化架构</li>
<li>✅ 状态管理</li>
<li>✅ 路由系统</li>
<li>✅ 代码规范</li>
<li>✅ 静态站点部署</li>
</ul>
<p>这个项目结构可以作为你开发 Vue 3 应用的起点。根据实际需求，你可以继续添加更多功能，如国际化、权限管理、数据可视化等。</p>
<h2 data-id="heading-47">资源链接</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvuejs.org%2F" target="_blank" title="https://vuejs.org/" ref="nofollow noopener noreferrer">Vue 3 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fvitejs.dev%2F" target="_blank" title="https://vitejs.dev/" ref="nofollow noopener noreferrer">Vite 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Frouter.vuejs.org%2F" target="_blank" title="https://router.vuejs.org/" ref="nofollow noopener noreferrer">Vue Router 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fpinia.vuejs.org%2F" target="_blank" title="https://pinia.vuejs.org/" ref="nofollow noopener noreferrer">Pinia 文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.typescriptlang.org%2F" target="_blank" title="https://www.typescriptlang.org/" ref="nofollow noopener noreferrer">TypeScript 文档</a></li>
</ul>
<hr/>
<p><strong>发布时间</strong>: 2026年1月
<strong>技术标签</strong>: Vue.js, TypeScript, Vite, 前端开发</p>
<p>希望这篇教程对你有帮助！如果有问题欢迎在评论区交流。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次 scrollIntoView 在 Android 企微中失效的踩坑实录]]></title>    <link>https://juejin.cn/post/7599017594519814170</link>    <guid>https://juejin.cn/post/7599017594519814170</guid>    <pubDate>2026-01-26T00:20:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599017594519814170" data-draft-id="7597946284678397971" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次 scrollIntoView 在 Android 企微中失效的踩坑实录"/> <meta itemprop="keywords" content="前端,Vue.js,Vant"/> <meta itemprop="datePublished" content="2026-01-26T00:20:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="zhEng"/> <meta itemprop="url" content="https://juejin.cn/user/4398498737560861"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次 scrollIntoView 在 Android 企微中失效的踩坑实录
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4398498737560861/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    zhEng
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:20:23.000Z" title="Mon Jan 26 2026 00:20:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="an-old-hope">.hljs-comment,.hljs-quote{color:#b6b18b}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#eb3c54}.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#e7ce56}.hljs-attribute{color:#ee7c2b}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:#4fb4d7}.hljs-section,.hljs-title{color:#78bb65}.hljs-keyword,.hljs-selector-tag{color:#b45ea4}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#1c1d21;color:#c0c5ce}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p><strong>这是一个看起来“理所当然”，却足以让你怀疑人生的Bug。</strong></p>
<p>它不会在你本地出现，不会在 iOS 上出现，甚至在大多数 Android 浏览器上也“表现正常”。</p>
<p>但它会在 <strong>Android 企业微信</strong> 里，悄无声息地让你的页面—— 滚动不到指定位置</p>
</blockquote>
<h2 data-id="heading-0">1、事情的起点：一个再正常不过的需求</h2>
<p>故事要从一个<strong>移动端项目</strong>说起。</p>
<p>页面很常见：</p>
<ul>
<li>使用 <strong>Vant 组件库</strong></li>
<li>一个 <code>Form</code> 表单</li>
<li>若干个输入项</li>
</ul>
<p>需求也很常见：</p>
<blockquote>
<p>提交表单时触发校验，校验失败就自动滚动到对应的表单项位置。</p>
</blockquote>
<p>做过 PC 或移动端表单的人都知道，这几乎是“标配能力”。</p>
<p>在 Vant 中，对应的实现路径也非常清晰，校验失败后，调用滚动方法</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span> {
    <span class="hljs-comment">// TODO</span>
}).<span class="hljs-title function_">cathc</span>(<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span> {
    <span class="hljs-keyword">const</span> name = err?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span> ?? <span class="hljs-string">''</span>;
    name &amp;&amp; formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">scrollToField</span>(name)
})
</code></pre>
<p>在 <strong>PC 端</strong>，这种体验甚至已经“理所当然”。</p>
<h2 data-id="heading-1">2、测试的一句话，让事情开始变味</h2>
<p>提测之后，测试小姐姐提了一个<strong>非常合理、也非常人性化的建议</strong>：</p>
<blockquote>
<p>「现在滚动是瞬间跳过去的，能不能加个过渡？看起来有点生硬。」</p>
</blockquote>
<p>听起来是不是很简单？👉 <strong>“加个平滑滚动而已。”</strong></p>
<p>我第一时间翻了 <strong><a href="https://link.juejin.cn?target=https%3A%2F%2Fvant-ui.github.io%2Fvant%2F%23%2Fzh-CN%2Fform" target="_blank" title="https://vant-ui.github.io/vant/#/zh-CN/form" ref="nofollow noopener noreferrer">Vant 官方文档</a></strong>。</p>
<p>文档里对 <code>scrollToField</code> 的描述是这样的：</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bc9e2460f5a240d595262201a4501103~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgemhFbmc=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991623&amp;x-signature=2moLcqwkbdEnyDVT2XEdfMB3WQM%3D" alt="image.png" loading="lazy"/></p>
<p>类似：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-title function_">scrollToField</span>(<span class="hljs-attr">name</span>: string, alignToTop?: boolean)
</code></pre>
<p>但问题在于：</p>
<ul>
<li>文档<strong>没有提</strong>平滑滚动</li>
<li>也<strong>没有提</strong>是否支持更复杂的滚动配置</li>
</ul>
<p>不过，作为一个习惯 <strong>“不完全相信文档”的前端</strong>，我做了一件很自然的事——👉 <strong>去看源码。</strong></p>
<h2 data-id="heading-2">3、源码一看：这不就有戏了吗？</h2>
<p>在 Vant 的源码里，我很快找到了实现：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">// packages/vant/src/form/Form.tsx</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToField</span> = (<span class="hljs-params">
  name: string,
  options?: boolean | ScrollIntoViewOptions,
</span>) =&gt; {
  children.<span class="hljs-title function_">some</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">if</span> (item.<span class="hljs-property">name</span> === name) {
      item.<span class="hljs-property">$el</span>.<span class="hljs-title function_">scrollIntoView</span>(options);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  });
};
</code></pre>
<p>看到这里，好家伙，这不是直接透传 <code>scrollIntoView</code> 吗？</p>
<p>也就是说：</p>
<ul>
<li>不仅能传 <code>boolean</code></li>
<li>还能直接传 <code>ScrollIntoViewOptions</code></li>
</ul>
<p>那事情就简单了。</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span> {
    <span class="hljs-comment">// TODO 校验通过</span>
}).<span class="hljs-title function_">cathc</span>(<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span> {
    <span class="hljs-keyword">const</span> name = err?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span> ?? <span class="hljs-string">''</span>;
    name &amp;&amp; formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">scrollToField</span>(name, {
      <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>,
      <span class="hljs-attr">block</span>: <span class="hljs-string">'center'</span>
    })
});
</code></pre>
<p>本地一测：</p>
<ul>
<li>✅ 滚动顺滑</li>
<li>✅ 居中展示</li>
<li>✅ 体验明显提升</li>
</ul>
<h2 data-id="heading-3">4、Bug 来了，而且来得很“安静”</h2>
<p>没过多久，测试小姐姐提了一个 Bug。</p>
<p>描述非常简短：</p>
<blockquote>
<p>「 现在触发校验之后，页面好像滚动不过去了 」</p>
</blockquote>
<p>我第一反应是：</p>
<blockquote>
<p>不可能吧？我刚刚还测过。</p>
</blockquote>
<p>于是我拿起，🍎 <strong>iPhone 16 Pro</strong> 手机，点击表单提交按钮，触发校验</p>
<ul>
<li>一切正常</li>
<li>平滑滚动</li>
<li>定位精准</li>
</ul>
<p>🤔 <strong>我心想：</strong></p>
<blockquote>
<p>那这是啥问题？「 于是我换了测试同款手机 」</p>
</blockquote>
<p><strong>真凶现身：Android + 企业微信</strong> 测试环境复现条件逐渐清晰：</p>
<ul>
<li><strong>Android 手机</strong></li>
<li><strong>企业微信内置浏览器</strong></li>
<li>特定系统版本</li>
</ul>
<p>关键信息最终锁定为：</p>
<ul>
<li>MagicOS 8.0（荣耀 / 华为系，基于 Android 14）</li>
<li>企业微信 5.0.3 （内置 X5 / 系统 WebView）</li>
</ul>
<p>现象也非常“诡异”：</p>
<ul>
<li><code>scrollToField</code> <strong>被调用了</strong></li>
<li>页面<strong>没有任何报错</strong></li>
<li>但页面就是<strong>没有滚动</strong></li>
</ul>
<h2 data-id="heading-4">5、真相：Android WebView 并不“讲武德”</h2>
<p>深入排查后，问题逐渐明朗：</p>
<p><strong>(1)Android WebView 对 <code>scrollIntoView</code> 支持并不完整</strong></p>
<p>在 Android WebView / X5 内核 中：</p>
<ul>
<li>✅ <code>scrollIntoView()</code> 基本可用</li>
<li>❌ <code>block: 'center'</code> 经常被忽略</li>
<li>❌ <code>behavior: 'smooth'</code> 在复杂布局中，会被打断或失效</li>
</ul>
<p><strong>(2) 企业微信 Android 端不是“纯浏览器”</strong></p>
<p>企业微信 Android 端：</p>
<ul>
<li>使用的是系统 WebView 或 X5 内核</li>
<li>滚动是原生 + JS 混合实现</li>
<li>smooth 滚动有「<strong>动画被中断</strong>」的情况</li>
</ul>
<p>而 iOS WKWebView：</p>
<ul>
<li>对 <code>scrollIntoView({ block: 'center' })</code> 支持是规范级别的</li>
<li>滚动计算非常稳定</li>
</ul>
<p>👉 所以看到的是：「 苹果：完美  ;  安卓：玄学 」</p>
<p><strong>（3）Android 对「center」的计算有 Bug（尤其 Android 13+）</strong></p>
<p>在 Android 12+，特别是 14：</p>
<ul>
<li><code>block: 'center'</code> 的中心点</li>
<li>会<strong>忽略滚动容器 padding</strong></li>
<li>或错误使用 <code>offsetParent</code></li>
</ul>
<p>这在 <strong>企微 + MagicOS</strong> 组合下非常容易触发。</p>
<h2 data-id="heading-5">6、最终方案：别再指望 scrollIntoView 了</h2>
<p>问题明确后，解决思路也就清晰了。</p>
<p><strong>方案一：Android 端不使用 <code>smooth</code></strong></p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> isAndroid = <span class="hljs-regexp">/Android/i</span>.<span class="hljs-title function_">test</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">navigator</span>.<span class="hljs-property">userAgent</span>);

element.<span class="hljs-title function_">scrollIntoView</span>({
  <span class="hljs-attr">behavior</span>: isAndroid ? <span class="hljs-string">'auto'</span> : <span class="hljs-string">'smooth'</span>,
  <span class="hljs-attr">block</span>: <span class="hljs-string">'center'</span>
});
</code></pre>
<p><strong>方案二（最稳）：自己计算滚动距离</strong></p>
<p>核心思想只有一句话： <strong>自己算 <code>scrollTop</code>，别把命运交给 WebView。</strong></p>
<p>示例：</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/**
 * 将目标元素滚动到容器中间
 * <span class="hljs-doctag">@param</span> container 滚动元素
 * <span class="hljs-doctag">@param</span> target 目标元素
 */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">scrollToCenter</span>(container, target) =&gt; {
  <span class="hljs-keyword">const</span> containerRect = container.<span class="hljs-title function_">getBoundingClientRect</span>();
  <span class="hljs-keyword">const</span> targetRect = target.<span class="hljs-title function_">getBoundingClientRect</span>();

  <span class="hljs-keyword">const</span> offset =
    targetRect.<span class="hljs-property">top</span> -
    containerRect.<span class="hljs-property">top</span> -
    container.<span class="hljs-property">clientHeight</span> / <span class="hljs-number">2</span> +
    target.<span class="hljs-property">clientHeight</span> / <span class="hljs-number">2</span>;

  container.<span class="hljs-title function_">scrollTo</span>({
    <span class="hljs-attr">top</span>: container.<span class="hljs-property">scrollTop</span> + offset,
    <span class="hljs-attr">behavior</span>: <span class="hljs-string">'smooth'</span>
  });
}
</code></pre>
<p>usage</p>
<pre><code class="hljs language-js" lang="js"><span class="hljs-keyword">const</span> formRef = <span class="hljs-title function_">ref</span>(<span class="hljs-literal">null</span>);
formRef.<span class="hljs-property">value</span>.<span class="hljs-title function_">validate</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">()=&gt;</span> {
    <span class="hljs-comment">// TODO 校验通过</span>
}).<span class="hljs-title function_">cathc</span>(<span class="hljs-function"><span class="hljs-params">err</span>=&gt;</span> {
    <span class="hljs-keyword">const</span> name = err?.[<span class="hljs-number">0</span>]?.<span class="hljs-property">name</span> ?? <span class="hljs-string">''</span>;
    <span class="hljs-keyword">const</span> container = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'app'</span>);
    <span class="hljs-keyword">const</span> target = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementsByClassName</span>(<span class="hljs-string">'van-field__error-message'</span>)?.[<span class="hljs-number">0</span>]
    <span class="hljs-title function_">scrollToCenter</span>(container, target);
});
</code></pre>
<p>上线测试：</p>
<ul>
<li>✅ Android 企业微信</li>
<li>✅ iOS</li>
<li>✅ 本地浏览器</li>
</ul>
<p><strong>全部通过。</strong></p>
<p>测试小姐姐给了一个评价：「这次的体验很好 👍」 那一刻，真的值了。</p>
<h2 data-id="heading-6">7、踩坑总结</h2>
<p>如果你也在做类似的事情，建议直接收藏：</p>
<ul>
<li>
<p>不要在 Android 企业微信中过度依赖 <code>scrollIntoView</code> 的高级配置项</p>
</li>
<li>
<p>尤其是：</p>
<ul>
<li><code>behavior: 'smooth'</code></li>
<li><code>block: 'center'</code></li>
</ul>
</li>
<li>
<p><strong>iOS 正常 ≠ 代码在所有环境都正确</strong></p>
</li>
</ul>
<p>这类问题的本质往往不是：</p>
<blockquote>
<p>你写错了代码*，</p>
</blockquote>
<p>而是：</p>
<blockquote>
<p><strong>你刚好踩到了 WebView 的能力边界了。</strong></p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HagiCode 实践：如何利用 GitHub Actions 实现 Docusaurus 自动部署]]></title>    <link>https://juejin.cn/post/7599268297202384934</link>    <guid>https://juejin.cn/post/7599268297202384934</guid>    <pubDate>2026-01-26T00:56:23.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202384934" data-draft-id="7599094262592192522" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HagiCode 实践：如何利用 GitHub Actions 实现 Docusaurus 自动部署"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T00:56:23.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="newbe36524"/> <meta itemprop="url" content="https://juejin.cn/user/2682464104098654"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HagiCode 实践：如何利用 GitHub Actions 实现 Docusaurus 自动部署
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2682464104098654/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    newbe36524
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:56:23.000Z" title="Mon Jan 26 2026 00:56:23 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    6
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读6分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">为 HagiCode 添加 GitHub Pages 自动部署支持</h2>
<blockquote>
<p>本项目早期代号为 PCode，现已正式更名为 HagiCode。本文记录了如何为项目引入自动化静态站点部署能力，让内容发布像喝水一样简单。</p>
</blockquote>

<h3 data-id="heading-1">背景/引言</h3>
<p>在 HagiCode 的开发过程中，我们遇到了一个很现实的问题：随着文档和提案越来越多，如何高效地管理和展示这些内容成了当务之急。我们决定引入 GitHub Pages 来托管我们的静态站点，但是手动构建和部署实在是太麻烦了——每次改动都要本地构建、打包，然后手动推送到 <code>gh-pages</code> 分支。这不仅效率低下，还容易出错。</p>
<p>为了解决这个问题（主要是为了偷懒），我们需要一套自动化的部署流程。本文将详细记录如何为 HagiCode 项目添加 GitHub Actions 自动部署支持，让我们只需专注于内容创作，剩下的交给自动化流程。</p>
<h3 data-id="heading-2">关于 HagiCode</h3>
<blockquote>
<p>嘿，介绍一下我们正在做的东西</p>
</blockquote>
<p>我们正在开发 <strong>HagiCode</strong>——一款 AI 驱动的代码智能助手，让开发体验变得更智能、更便捷、更有趣。</p>
<p><strong>智能</strong>——AI 全程辅助，从想法到代码，让编码效率提升数倍。<strong>便捷</strong>——多线程并发操作，充分利用资源，开发流程顺畅无阻。<strong>有趣</strong>——游戏化机制和成就系统，让编码不再枯燥，充满成就感。</p>
<p>项目正在快速迭代中，如果你对技术写作、知识管理或者 AI 辅助开发感兴趣，欢迎来 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FHagiCode-org%2Fsite" target="_blank" title="https://github.com/HagiCode-org/site" ref="nofollow noopener noreferrer">GitHub</a> 看看～</p>
<h3 data-id="heading-3">目标分析</h3>
<p>在动手之前，我们得先明确这次任务到底要干啥。毕竟磨刀不误砍柴工嘛。</p>
<h4 data-id="heading-4">核心需求</h4>
<ol>
<li><strong>自动化构建</strong>：当代码推送到 <code>main</code> 分支时，自动触发构建流程。</li>
<li><strong>自动部署</strong>：构建成功后，自动将生成的静态文件部署到 GitHub Pages。</li>
<li><strong>环境一致性</strong>：确保 CI 环境和本地构建环境一致，避免"本地能跑，线上报错"的尴尬。</li>
</ol>
<h4 data-id="heading-5">技术选型</h4>
<p>考虑到 HagiCode 是基于 Docusaurus 构建的（一种非常流行的 React 静态站点生成器），我们可以利用 GitHub Actions 来实现这一目标。</p>
<h3 data-id="heading-6">配置 GitHub Actions 工作流</h3>
<p>GitHub Actions 是 GitHub 提供的 CI/CD 服务。通过在代码仓库中定义 YAML 格式的工作流文件，我们可以定制各种自动化任务。</p>
<h4 data-id="heading-7">创建工作流文件</h4>
<p>我们需要在项目根目录下的 <code>.github/workflows</code> 文件夹中创建一个新的配置文件，比如叫 <code>deploy.yml</code>。如果文件夹不存在，记得先手动创建一下。</p>
<p>这个配置文件的核心逻辑如下：</p>
<ol>
<li><strong>触发条件</strong>：监听 <code>main</code> 分支的 <code>push</code> 事件。</li>
<li><strong>运行环境</strong>：最新版的 Ubuntu。</li>
<li><strong>构建步骤</strong>：
<ul>
<li>检出代码</li>
<li>安装 Node.js</li>
<li>安装依赖 (<code>npm install</code>)</li>
<li>构建静态文件 (<code>npm run build</code>)</li>
</ul>
</li>
<li><strong>部署步骤</strong>：使用官方提供的 <code>action-gh-pages</code> 将构建产物推送到 <code>gh-pages</code> 分支。</li>
</ol>
<h4 data-id="heading-8">关键配置代码</h4>
<p>以下是我们最终采用的配置模板：</p>
<pre><code class="hljs language-yaml" lang="yaml"><span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">GitHub</span> <span class="hljs-string">Pages</span>

<span class="hljs-comment"># 触发条件：当推送到 main 分支时</span>
<span class="hljs-attr">on:</span>
  <span class="hljs-attr">push:</span>
    <span class="hljs-attr">branches:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-string">main</span>
    <span class="hljs-comment"># 可以根据需要添加路径过滤，比如只有文档变动才构建</span>
    <span class="hljs-comment"># paths:</span>
    <span class="hljs-comment">#   - 'docs/**'</span>
    <span class="hljs-comment">#   - 'package.json'</span>

<span class="hljs-comment"># 设置权限，这对于部署到 GitHub Pages 很重要</span>
<span class="hljs-attr">permissions:</span>
  <span class="hljs-attr">contents:</span> <span class="hljs-string">read</span>
  <span class="hljs-attr">pages:</span> <span class="hljs-string">write</span>
  <span class="hljs-attr">id-token:</span> <span class="hljs-string">write</span>

<span class="hljs-comment"># 并发控制：取消同一分支的旧构建</span>
<span class="hljs-attr">concurrency:</span>
  <span class="hljs-attr">group:</span> <span class="hljs-string">"pages"</span>
  <span class="hljs-attr">cancel-in-progress:</span> <span class="hljs-literal">false</span>

<span class="hljs-attr">jobs:</span>
  <span class="hljs-attr">build:</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Checkout</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/checkout@v4</span>
        <span class="hljs-comment"># 注意：必须设置 fetch-depth: 0，否则可能导致构建版本号不准确</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">fetch-depth:</span> <span class="hljs-number">0</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Setup</span> <span class="hljs-string">Node</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/setup-node@v4</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">node-version:</span> <span class="hljs-number">20</span> <span class="hljs-comment"># 建议与本地开发环境保持一致</span>
          <span class="hljs-attr">cache:</span> <span class="hljs-string">'npm'</span>     <span class="hljs-comment"># 启用缓存可以加速构建过程</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Install</span> <span class="hljs-string">dependencies</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">ci</span>
        <span class="hljs-comment"># 使用 npm ci 而不是 npm install，因为它更快、更严格，适合 CI 环境</span>

      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Build</span> <span class="hljs-string">website</span>
        <span class="hljs-attr">run:</span> <span class="hljs-string">npm</span> <span class="hljs-string">run</span> <span class="hljs-string">build</span>
        <span class="hljs-attr">env:</span>
          <span class="hljs-comment"># 如果你的站点构建需要环境变量，在这里配置</span>
          <span class="hljs-comment"># NODE_ENV: production</span>
          <span class="hljs-comment"># PUBLIC_URL: /your-repo-name</span>
          
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Upload</span> <span class="hljs-string">artifact</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/upload-pages-artifact@v3</span>
        <span class="hljs-attr">with:</span>
          <span class="hljs-attr">path:</span> <span class="hljs-string">./build</span> <span class="hljs-comment"># Docusaurus 默认输出目录</span>

  <span class="hljs-attr">deploy:</span>
    <span class="hljs-attr">environment:</span>
      <span class="hljs-attr">name:</span> <span class="hljs-string">github-pages</span>
      <span class="hljs-attr">url:</span> <span class="hljs-string">${{</span> <span class="hljs-string">steps.deployment.outputs.page_url</span> <span class="hljs-string">}}</span>
    <span class="hljs-attr">runs-on:</span> <span class="hljs-string">ubuntu-latest</span>
    <span class="hljs-attr">needs:</span> <span class="hljs-string">build</span>
    <span class="hljs-attr">steps:</span>
      <span class="hljs-bullet">-</span> <span class="hljs-attr">name:</span> <span class="hljs-string">Deploy</span> <span class="hljs-string">to</span> <span class="hljs-string">GitHub</span> <span class="hljs-string">Pages</span>
        <span class="hljs-attr">id:</span> <span class="hljs-string">deployment</span>
        <span class="hljs-attr">uses:</span> <span class="hljs-string">actions/deploy-pages@v4</span>
</code></pre>
<h3 data-id="heading-9">实施过程中的坑点</h3>
<p>在实际操作中，我们遇到了一些问题，这里分享出来希望大家能避开（或者提前准备好解决方案）。</p>
<h4 data-id="heading-10">1. GitHub Token 权限问题</h4>
<p>最开始配置的时候，部署总是报错 403 (Forbidden)。查了好久才发现，是因为 GitHub 默认的 <code>GITHUB_TOKEN</code> 并没有写入 Pages 的权限。</p>
<p><strong>解决方案</strong>：在仓库的 <code>Settings</code> -&gt; <code>Actions</code> -&gt; <code>General</code> -&gt; <code>Workflow permissions</code> 中，务必选择 <strong>"Read and write permissions"</strong>。</p>
<h4 data-id="heading-11">2. 构建目录路径错误</h4>
<p>Docusaurus 默认把构建好的静态文件放在 <code>build</code> 目录。但是有些项目（比如 Create React App 默认是 <code>build</code>，Vite 默认是 <code>dist</code>）可能配置不一样。如果在 Actions 中报错找不到文件，记得去 <code>docusaurus.config.js</code> 里检查一下输出路径配置。</p>
<h4 data-id="heading-12">3. 子路径问题</h4>
<p>如果你的仓库不是用户主页（即不是 <code>username.github.io</code>），而是项目主页（比如 <code>username.github.io/project-name</code>），你需要配置 <code>baseUrl</code>。</p>
<p>在 <code>docusaurus.config.js</code> 中：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-comment">// ...</span>
  <span class="hljs-attr">url</span>: <span class="hljs-string">'https://HagiCode-org.github.io'</span>, <span class="hljs-comment">// 你的 GitHub URL</span>
  <span class="hljs-attr">baseUrl</span>: <span class="hljs-string">'/site/'</span>, <span class="hljs-comment">// 如果你的仓库叫 site，这里就填 /site/</span>
  <span class="hljs-comment">// ...</span>
};
</code></pre>
<p>这一点很容易被忽略，配置不对会导致页面打开全是白屏，因为资源路径加载不到。</p>
<h3 data-id="heading-13">验证成果</h3>
<p>配置完所有东西并推送代码后，我们就可以去 GitHub 仓库的 <strong>Actions</strong> 标签页看戏了。</p>
<p>你会看到黄色的圆圈（工作流正在运行），变绿就代表成功啦！如果变红了，点击进去查看日志，通常都能排查出问题（大部分时候是拼写错误或者路径配置不对）。</p>
<p>构建成功后，访问 <code>https://&lt;你的用户名&gt;.github.io/&lt;仓库名&gt;/</code> 就能看到崭新的站点了。</p>
<h3 data-id="heading-14">总结</h3>
<p>通过引入 GitHub Actions，我们成功实现了 HagiCode 文档站的自动化部署。这不仅节省了手动操作的时间，更重要的是保证了发布流程的标准化。现在不管是哪位小伙伴更新了文档，只要合并到 <code>main</code> 分支，几分钟后就能在线上看到最新的内容。</p>
<p><strong>核心收益</strong>：</p>
<ul>
<li><strong>效率提升</strong>：从"手动打包、手动上传"变成"代码即发布"。</li>
<li><strong>降低错误</strong>：消除了人为操作失误的可能性。</li>
<li><strong>体验优化</strong>：让开发者更专注于内容质量，而不是被繁琐的部署流程困扰。</li>
</ul>
<p>虽然配置 CI/CD 刚开始有点麻烦（尤其是各种权限和路径问题），但这是一次性投入，长期回报巨大的工作。强烈建议所有静态站点项目都接入类似的自动化流程。</p>
<h3 data-id="heading-15">参考资料</h3>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.github.com%2Fen%2Factions" target="_blank" title="https://docs.github.com/en/actions" ref="nofollow noopener noreferrer">GitHub Actions 官方文档</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocusaurus.io%2Fdocs%2Fdeployment" target="_blank" title="https://docusaurus.io/docs/deployment" ref="nofollow noopener noreferrer">Docusaurus 部署指南</a></li>
<li>[actions-gh-pages Action 使用说明](<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com" target="_blank" title="https://github.com" ref="nofollow noopener noreferrer">github.com</a> peaceiris/actions-gh-pages)</li>
</ul>
<hr/>
<p>感谢您的阅读,如果您觉得本文有用,快点击下方点赞按钮👍,让更多的人看到本文。</p>
<p>本内容采用人工智能辅助协作,经本人审核,符合本人观点与立场。</p>
<h3 data-id="heading-16">元信息</h3>
<ul>
<li><strong>本文作者:</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.newbe.pro" target="_blank" title="https://www.newbe.pro" ref="nofollow noopener noreferrer">newbe36524</a></li>
<li><strong>本文链接:</strong> <a href="https://link.juejin.cn?target=https%3A%2F%2Fhagicode-org.github.io%2Fsite%2Fblog%2F2026%2F01%2F25%2Fdocusaurus-auto-deployment-with-github-actions" target="_blank" title="https://hagicode-org.github.io/site/blog/2026/01/25/docusaurus-auto-deployment-with-github-actions" ref="nofollow noopener noreferrer">hagicode-org.github.io/site/blog/2…</a></li>
<li><strong>版权声明:</strong> 本博客所有文章除特别声明外,均采用 BY-NC-SA 许可协议。转载请注明出处!</li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[解决 Vite 开发服务器启动报错：spawn EPERM]]></title>    <link>https://juejin.cn/post/7598767580306571318</link>    <guid>https://juejin.cn/post/7598767580306571318</guid>    <pubDate>2026-01-26T01:05:57.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580306571318" data-draft-id="7598767580306554934" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="解决 Vite 开发服务器启动报错：spawn EPERM"/> <meta itemprop="keywords" content="前端,Vue.js"/> <meta itemprop="datePublished" content="2026-01-26T01:05:57.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="独守一隅"/> <meta itemprop="url" content="https://juejin.cn/user/2963939079500248"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            解决 Vite 开发服务器启动报错：spawn EPERM
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2963939079500248/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    独守一隅
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:05:57.000Z" title="Mon Jan 26 2026 01:05:57 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    13
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">问题现象</h2>
<p>在 Windows 系统下运行 Vite 开发服务器时，控制台报错：</p>
<pre><code class="hljs language-php" lang="php"><span class="hljs-built_in">Error</span>: spawn EPERM 
     at ChildProcess.<span class="hljs-title function_ invoke__">spawn</span> (<span class="hljs-attr">node</span>:internal/<span class="hljs-attr">child_process</span>:<span class="hljs-number">420</span>:<span class="hljs-number">11</span>) 
     at Object.<span class="hljs-title function_ invoke__">spawn</span> (<span class="hljs-attr">node</span>:<span class="hljs-attr">child_process</span>:<span class="hljs-number">787</span>:<span class="hljs-number">9</span>) 
     at <span class="hljs-title function_ invoke__">baseOpen</span> (<span class="hljs-attr">file</span>:///<span class="hljs-attr">E</span>:/标签溯源/code/TraceGuard-UI/node_modules/vite/dist/node/chunks/dep-DBxKXgDP.<span class="hljs-attr">js</span>:<span class="hljs-number">26487</span>:<span class="hljs-number">36</span>)
</code></pre>
<p>开发服务器无法正常启动，或者启动后立即崩溃。</p>
<h2 data-id="heading-1">发生原因</h2>
<p>这个错误通常由以下几个因素导致：</p>
<h3 data-id="heading-2">1. Vite 自动打开浏览器功能</h3>
<p>在 <code>vite.config.js</code> 配置文件中，<code>server.open</code> 选项被设置为 <code>true</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">server</span>: {
  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">open</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 这里是问题所在</span>
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>当 <code>open: true</code> 时，Vite 会在服务器启动后自动调用系统默认浏览器打开开发地址。</p>
<h3 data-id="heading-3">2. Windows 权限限制</h3>
<p>在 Windows 系统上，Node.js 的 <code>child_process.spawn()</code> 方法尝试启动浏览器进程时，可能会遇到以下权限问题：</p>
<ul>
<li><strong>权限不足</strong>：当前进程没有足够的权限启动外部应用程序</li>
<li><strong>安全策略限制</strong>：Windows Defender 或企业安全策略阻止了进程创建</li>
<li><strong>路径问题</strong>：浏览器可执行文件路径无法正确解析</li>
</ul>
<h3 data-id="heading-4">3. 端口占用（次要原因）</h3>
<p>如果配置的端口（如 80）已被其他进程占用，也可能导致类似的错误。</p>
<h2 data-id="heading-5">解决方案</h2>
<h3 data-id="heading-6">方案一：禁用自动打开浏览器（推荐）</h3>
<p>修改 <code>vite.config.js</code> 文件，将 <code>open</code> 选项设置为 <code>false</code>：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// vite.config.js</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">defineConfig</span>(<span class="hljs-function">(<span class="hljs-params">{ mode, command }</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">server</span>: {
      <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>,
      <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">open</span>: <span class="hljs-literal">false</span>,  <span class="hljs-comment">// 改为 false，禁用自动打开浏览器</span>
      <span class="hljs-attr">proxy</span>: {
        <span class="hljs-comment">// ... 其他配置</span>
      }
    },
    <span class="hljs-comment">// ... 其他配置</span>
  }
})
</code></pre>
<p><strong>优点</strong>：</p>
<ul>
<li>彻底解决权限问题</li>
<li>不影响开发服务器功能</li>
<li>可以手动选择浏览器访问</li>
</ul>
<p><strong>使用方式</strong>：
启动开发服务器后，在浏览器中手动访问 <code>http://localhost:80</code></p>
<h3 data-id="heading-7">方案二：指定浏览器路径</h3>
<p>如果确实需要自动打开浏览器，可以指定浏览器可执行文件的完整路径：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-attr">server</span>: {
  <span class="hljs-attr">port</span>: <span class="hljs-number">80</span>,
  <span class="hljs-attr">host</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">open</span>: <span class="hljs-string">'chrome'</span>,  <span class="hljs-comment">// 或者指定完整路径</span>
  <span class="hljs-comment">// 或者</span>
  <span class="hljs-attr">open</span>: <span class="hljs-string">'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'</span>
}
</code></pre>
<p><strong>注意</strong>：这种方式仍然可能遇到权限问题，不如方案一稳定。</p>
<h3 data-id="heading-8">方案三：以管理员身份运行</h3>
<p>以管理员身份运行终端或 IDE，然后执行 <code>npm run dev</code> 命令。</p>
<p><strong>缺点</strong>：</p>
<ul>
<li>不是长期解决方案</li>
<li>可能带来安全风险</li>
<li>不推荐作为常规做法</li>
</ul>
<h2 data-id="heading-9">验证修复</h2>
<p>修改配置后，重新启动开发服务器：</p>
<pre><code class="hljs language-bash" lang="bash">npm run dev
</code></pre>
<p>应该看到类似以下的成功输出：</p>
<pre><code class="hljs language-arduino" lang="arduino">  VITE v6<span class="hljs-number">.3</span><span class="hljs-number">.5</span>  ready in xxx ms

  ➜  Local:   http:<span class="hljs-comment">//localhost:80/</span>
  ➜  Network: http:<span class="hljs-comment">//192.168.x.x:80/</span>
  ➜  press h + enter to show help
</code></pre>
<p>然后在浏览器中手动访问 <code>http://localhost:80</code> 即可。</p>
<h2 data-id="heading-10">总结</h2>
<p><code>spawn EPERM</code> 错误是 Windows 系统下 Vite 开发服务器的常见问题，主要原因是自动打开浏览器功能触发了权限限制。最简单有效的解决方案是禁用自动打开浏览器功能，改为手动访问开发地址。</p>
<p>这种方式不仅解决了权限问题，还提供了更好的开发体验——你可以自由选择浏览器和打开时机。</p>
<h2 data-id="heading-11">相关资源</h2>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fcn.vitejs.dev%2Fconfig%2F%23server-open" target="_blank" title="https://cn.vitejs.dev/config/#server-open" ref="nofollow noopener noreferrer">Vite 官方文档 - server.open</a></li>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fnodejs.org%2Fapi%2Fchild_process.html%23child_processspawncommand-args-options" target="_blank" title="https://nodejs.org/api/child_process.html#child_processspawncommand-args-options" ref="nofollow noopener noreferrer">Node.js child_process.spawn() 文档</a></li>
</ul></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[🔥🔥🔥 React18 源码学习 - DIFF算法]]></title>    <link>https://juejin.cn/post/7598830215258800164</link>    <guid>https://juejin.cn/post/7598830215258800164</guid>    <pubDate>2026-01-26T01:43:45.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598830215258800164" data-draft-id="7598588085597929512" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="🔥🔥🔥 React18 源码学习 - DIFF算法"/> <meta itemprop="keywords" content="源码阅读"/> <meta itemprop="datePublished" content="2026-01-26T01:43:45.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="yyyao"/> <meta itemprop="url" content="https://juejin.cn/user/4266531531793976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            🔥🔥🔥 React18 源码学习 - DIFF算法
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4266531531793976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    yyyao
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:43:45.000Z" title="Mon Jan 26 2026 01:43:45 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读8分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="a11y-light">.hljs-comment,.hljs-quote{color:#696969}.hljs-deletion,.hljs-name,.hljs-regexp,.hljs-selector-class,.hljs-selector-id,.hljs-tag,.hljs-template-variable,.hljs-variable{color:#d91e18}.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-type{color:#aa5d00}.hljs-addition,.hljs-bullet,.hljs-string,.hljs-symbol{color:green}.hljs-section,.hljs-title{color:#007faa}.hljs-keyword,.hljs-selector-tag{color:#7928a1}.markdown-body pre,.markdown-body pre&gt;code.hljs{background:#fefefe;color:#545454}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}@media screen and (-ms-high-contrast:active){.hljs-addition,.hljs-attribute,.hljs-built_in,.hljs-builtin-name,.hljs-bullet,.hljs-comment,.hljs-link,.hljs-literal,.hljs-meta,.hljs-number,.hljs-params,.hljs-quote,.hljs-string,.hljs-symbol,.hljs-type{color:highlight}.hljs-keyword,.hljs-selector-tag{font-weight:700}}</style><h2 data-id="heading-0">前言</h2>
<p>本文的<code>React</code>代码版本为<code>18.2.0</code></p>
<p>可调试的代码仓库为：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyyyao-hh%2Freact-debug%2Ftree%2Fmaster-pure" target="_blank" title="https://github.com/yyyao-hh/react-debug/tree/master-pure" ref="nofollow noopener noreferrer">GitHub - yyyao-hh/react-debug at master-pure</a></p>
<p>在<code>React</code>的世界里，每次状态更新都会触发组件的重新渲染。如果直接销毁旧<code>DOM</code>节点并创建新节点，性能开销将无法承受。<code>React</code>通过调和（<code>Reconciliation</code>） 过程，配合<code>DIFF</code>算法，找出需要更新的最小节点集合，实现了高效的<code>UI</code>更新。</p>
<p>本文将带你深<code>React18</code>源码，揭示<code>DIFF</code>算法的核心原理、实现细节和优化策略。</p>
<h2 data-id="heading-1">DIFF 算法的策略</h2>
<h3 data-id="heading-2">策略一：同级比较</h3>
<p><code>React</code>只会对同一层级的节点进行比较，不会跨层级追踪节点变化。</p>
<h3 data-id="heading-3">策略二：类型不同则销毁重建</h3>
<p>如果节点类型改变，<code>React</code>会直接销毁整个子树，重新构建新的节点。</p>
<h3 data-id="heading-4">策略三：Key 值优化列表更新</h3>
<p><code>React</code>使用<code>key</code>来匹配原有树上的子元素，匹配成功就会进行复用。通过<code>key</code>标识节点的稳定性，<code>React</code>可以更准确地识别节点的移动、添加和删除，使得树的转换效率得以提高。</p>
<p>比如：两个同级兄弟节点位置进行了调换，存在<code>key</code>的情况下两个节点都会被复用，而不是卸载重新构建。</p>
<h2 data-id="heading-5">DIFF 算法的入口</h2>
<p>在上一节我们讲构建<code>Fiber</code>树的时候，讲到了<code>beginWork</code>方法内部主要是根据<code>tag</code>分发逻辑，处理不同类型的<code>Fiber</code>节点。将处理方法的返回的子节点作为下一个遍历节点</p>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-comment">/* packages/react-reconciler/src/ReactFiberBeginWork.old.js */</span>

function beginWork(
  current: Fiber | <span class="hljs-literal">null</span>,
  workInProgress: Fiber,
  renderLanes: Lanes,
): Fiber | <span class="hljs-literal">null</span> {
  <span class="hljs-keyword">if</span>(...) {...}; <span class="hljs-comment">// 满足一定条件下执行熔断策略</span>

  switch (workInProgress.tag) {
    case IndeterminateComponent: <span class="hljs-keyword">return</span> mountIndeterminateComponent(...);
    case LazyComponent: <span class="hljs-keyword">return</span> mountLazyComponent(...);
    case FunctionComponent: <span class="hljs-keyword">return</span> updateFunctionComponent(...);
    case ClassComponent: <span class="hljs-keyword">return</span> updateClassComponent(...);
    case HostRoot: <span class="hljs-keyword">return</span> updateHostRoot(...);
    case HostComponent: <span class="hljs-keyword">return</span> updateHostComponent(...);
    case HostText: <span class="hljs-keyword">return</span> updateHostText(...);
    case SuspenseComponent: <span class="hljs-keyword">return</span> updateSuspenseComponent(...);
    case HostPortal: <span class="hljs-keyword">return</span> updatePortalComponent(...);
    case ForwardRef: <span class="hljs-keyword">return</span> updateForwardRef(...);
    case Fragment: <span class="hljs-keyword">return</span> updateFragment(...);
    case Mode: <span class="hljs-keyword">return</span> updateMode(...);
    case Profiler: <span class="hljs-keyword">return</span> updateProfiler(...);
    case ContextProvider: <span class="hljs-keyword">return</span> updateContextProvider(...);
    case ContextConsumer: <span class="hljs-keyword">return</span> updateContextConsumer(...);
    case MemoComponent: <span class="hljs-keyword">return</span> updateMemoComponent(...);
    case SimpleMemoComponent: <span class="hljs-keyword">return</span> updateSimpleMemoComponent(...);
    case IncompleteClassComponent: <span class="hljs-keyword">return</span> mountIncompleteClassComponent(...);
    case SuspenseListComponent: <span class="hljs-keyword">return</span> updateSuspenseListComponent(...);
    case ScopeComponent: <span class="hljs-keyword">return</span> updateScopeComponent(...);
    case OffscreenComponent: <span class="hljs-keyword">return</span> updateOffscreenComponent(...);
    case LegacyHiddenComponent: <span class="hljs-keyword">return</span> updateLegacyHiddenComponent(...);
    case CacheComponent: <span class="hljs-keyword">return</span> updateCacheComponent(...);
    case TracingMarkerComponent: <span class="hljs-keyword">return</span> updateTracingMarkerComponent(...);
  }
}
</code></pre>
<p>这些不同的处理逻辑最终都会走到<code>reconcileChildren</code>函数中去处理，这里简单以类组件（<code>ClassComponent</code>）和函数式组件（<code>FunctionComponent</code>）的举例：</p>
<pre><code class="hljs language-scss" lang="scss"><span class="hljs-comment">// 类组件 (ClassComponent)</span>
function <span class="hljs-built_in">updateClassComponent</span>(...) {
  const nextUnitOfWork = <span class="hljs-built_in">finishClassComponent</span>(...);
  
  return nextUnitOfWork;
}

function <span class="hljs-built_in">finishClassComponent</span>(...) {
  <span class="hljs-built_in">reconcileChildren</span>(current, workInProgress, nextChildren, renderLanes);

  return workInProgress<span class="hljs-selector-class">.child</span>;
}

<span class="hljs-comment">// 函数式组件 (FunctionComponent)</span>
function <span class="hljs-built_in">updateFunctionComponent</span>(...) {
  <span class="hljs-built_in">reconcileChildren</span>(current, workInProgress, nextChildren, renderLanes);
  
  return workInProgress<span class="hljs-selector-class">.child</span>;
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">/* src/react/packages/react-reconciler/src/ReactFiberBeginWork.old.js */

export function reconcileChildren(...) {
  if (<span class="hljs-attr">current</span> === null) {
    <span class="hljs-attr">workInProgress.child</span> = mountChildFibers(...)<span class="hljs-comment">;</span>
  } else {
    <span class="hljs-attr">workInProgress.child</span> = reconcileChildFibers(...)<span class="hljs-comment">;</span>
  }
}
</code></pre>
<pre><code class="hljs language-ini" lang="ini">/* src/react/packages/react-reconciler/src/ReactChildFiber.old.js */

export const <span class="hljs-attr">reconcileChildFibers</span> = ChildReconciler(<span class="hljs-literal">true</span>)<span class="hljs-comment">;</span>
export const <span class="hljs-attr">mountChildFibers</span> = ChildReconciler(<span class="hljs-literal">false</span>)<span class="hljs-comment">;</span>
</code></pre>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">/* src/react/packages/react-reconciler/src/ReactChildFiber.old.js */</span>

<span class="hljs-keyword">function</span> <span class="hljs-title function_">ChildReconciler</span>(<span class="hljs-params">shouldTrackSideEffects</span>) {

  ...

  <span class="hljs-keyword">function</span> <span class="hljs-title function_">reconcileChildFibers</span>(<span class="hljs-params"/>) {}

  <span class="hljs-keyword">return</span> reconcileChildFibers;
}
</code></pre>
<p>所以<code>reconcileChildFibers</code>函数是实现<code>Diff</code>算法的核心方法</p>
<h2 data-id="heading-6">DIFF 算法的实现</h2>
<p>我们紧接着入口之后，来分析<code>reconcileChildFibers</code>函数的内部逻辑。</p>
<ol>
<li>
<p>首先处理顶级且无<code>key</code>的<code>Fragment</code>元素，满足条件则直接使用它的孩子。这里值得注意的两点：</p>
<p>a.  存在<code>key</code>的<code>Fragment</code>不满足条件，于是乎在下方“处理单元素”逻辑中又会处理一下。</p>
<p>b.  非顶级的<code>Fragment</code>依旧不满足条件，在下方“处理数组元素”的逻辑中会进行处理。</p>
</li>
<li>
<p>如果是一个对象，那么它是一个<code>ReactElement</code>。分为普通元素、<code>Lazy</code>组件、<code>Portal</code>组件、节点数组、可迭代对象分别进行处理；</p>
</li>
<li>
<p>如果是<code>string</code>或<code>number</code>类型，调用处理文本节点的方法。</p>
</li>
<li>
<p>剩余情况：可能为<code>null</code>、<code>undefined</code>、<code>false</code>或<code>''</code>，不能转化为<code>Fiber</code>节点，因此直接删除所有旧子<code>Fiber</code>节点。</p>
</li>
</ol>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">reconcileChildFibers</span>(<span class="hljs-params">
  returnFiber: Fiber,
  currentFirstChild: Fiber | <span class="hljs-literal">null</span>,
  newChild: any,
  lanes: Lanes,
</span>): Fiber | <span class="hljs-literal">null</span></span> {
  
  <span class="hljs-comment">/* 1. 顶级无key的Fragment元素, 直接使用它的children */</span>
  <span class="hljs-keyword">const</span> isUnkeyedTopLevelFragment =
    <span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'object'</span> &amp;&amp;
    newChild !== <span class="hljs-literal">null</span> &amp;&amp;
    newChild.type === REACT_FRAGMENT_TYPE &amp;&amp;
    newChild.key === <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">if</span> (isUnkeyedTopLevelFragment) {
    newChild = newChild.props.children;
  }

  <span class="hljs-comment">/* 2. 处理对象类型 */</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'object'</span> &amp;&amp; newChild !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">switch</span> (newChild.$$<span class="hljs-keyword">typeof</span>) {
      <span class="hljs-comment">// 2.1 React 元素</span>
      <span class="hljs-keyword">case</span> REACT_ELEMENT_TYPE:
        <span class="hljs-keyword">return</span> placeSingleChild(
          reconcileSingleElement(
            returnFiber,
            currentFirstChild,
            newChild,
            lanes,
          ),
        );
      <span class="hljs-comment">// 2.2 Portal</span>
      <span class="hljs-keyword">case</span> REACT_PORTAL_TYPE:
        <span class="hljs-keyword">return</span> placeSingleChild(
          reconcileSinglePortal(
            returnFiber,
            currentFirstChild,
            newChild,
            lanes,
          ),
        );
      <span class="hljs-comment">// 2.3 懒加载组件</span>
      <span class="hljs-keyword">case</span> REACT_LAZY_TYPE:
        <span class="hljs-keyword">const</span> payload = newChild._payload;
        <span class="hljs-keyword">const</span> <span class="hljs-keyword">init</span> = newChild._init;
        <span class="hljs-keyword">return</span> reconcileChildFibers(
          returnFiber,
          currentFirstChild,
          <span class="hljs-keyword">init</span>(payload),
          lanes,
        );
    }

    <span class="hljs-comment">// 2.4. 数组类型处理</span>
    <span class="hljs-keyword">if</span> (isArray(newChild)) {
      <span class="hljs-keyword">return</span> reconcileChildrenArray(
        returnFiber,
        currentFirstChild,
        newChild,
        lanes,
      );
    }

    <span class="hljs-comment">// 2.5 可迭代对象处理</span>
    <span class="hljs-keyword">if</span> (getIteratorFn(newChild)) {
      <span class="hljs-keyword">return</span> reconcileChildrenIterator(
        returnFiber,
        currentFirstChild,
        newChild,
        lanes,
      );
    }

    <span class="hljs-comment">// 2.6 无效对象类型错误</span>
    throwOnInvalidObjectType(returnFiber, newChild);
  }

  <span class="hljs-comment">/* 3. 处理文本节点类型 */</span>
  <span class="hljs-keyword">if</span> (
    (<span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'string'</span> &amp;&amp; newChild !== <span class="hljs-string">''</span>) ||
    <span class="hljs-keyword">typeof</span> newChild === <span class="hljs-string">'number'</span>
  ) {
    <span class="hljs-keyword">return</span> placeSingleChild(
      reconcileSingleTextNode(
        returnFiber,
        currentFirstChild,
        <span class="hljs-string">''</span> + newChild,
        lanes,
      ),
    );
  }

  <span class="hljs-comment">/* 4. 剩余情况 */</span>
  <span class="hljs-keyword">return</span> deleteRemainingChildren(returnFiber, currentFirstChild);
}
</code></pre>
<h3 data-id="heading-7">处理单节点</h3>
<p><code>reconcileSingleElement</code>方法用于处理当新的子节点是一个单独的元素（不是数组或文本节点）时的情况。</p>
<p>它的处理分为两个阶段，判断条件便是<code>child !== null</code></p>
<ol>
<li>更新阶段（<code>while</code>循环）</li>
<li>初始化阶段或在循环中不满足复用条件（<code>while</code>循环之后）</li>
</ol>
<p>首先<code>while</code>循环的逻辑：遍历旧子<code>Fiber</code>节点，尝试找到可以复用的<code>Fiber</code>节点：</p>
<ul>
<li>如果<code>key</code>相同且<code>type</code>相同，则复用并删除其他兄弟节点；</li>
<li>如果<code>key</code>相同但<code>type</code>不同，则删除包括当前节点在内的所有子节点，然后跳出循环；</li>
<li>如果<code>key</code>不同，则标记当前<code>child</code>为删除，继续遍历下一个兄弟节点。</li>
</ul>
<p>然后是循环之后的逻辑：遍历完或<code>break</code>后未找到可复用节点，直接创建新的<code>Fiber</code>节点。</p>
<pre><code class="hljs language-ini" lang="ini">function reconcileSingleElement(
  returnFiber: Fiber,
  currentFirstChild: Fiber | null,
  element: ReactElement,
  lanes: Lanes,
): Fiber {
  const <span class="hljs-attr">key</span> = element.key<span class="hljs-comment">;</span>
  let <span class="hljs-attr">child</span> = currentFirstChild<span class="hljs-comment">;</span>
  /**
   * 1. 更新阶段
   * - 如果key相同且type相同, 则复用并删除其他兄弟节点
   * - 如果key相同但type不同, 则删除包括当前节点在内的所有子节点, 然后跳出循环
   * - 如果key不同, 则标记当前child为删除, 继续遍历下一个兄弟节点
   */
  while (child !== null) {
    if (<span class="hljs-attr">child.key</span> === key) {
      const <span class="hljs-attr">elementType</span> = element.type<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">elementType</span> === REACT_FRAGMENT_TYPE) {
        if (<span class="hljs-attr">child.tag</span> === Fragment) {
          deleteRemainingChildren(returnFiber, child.sibling)<span class="hljs-comment">;</span>
          const <span class="hljs-attr">existing</span> = useFiber(child, element.props.children)<span class="hljs-comment">;</span>
          <span class="hljs-attr">existing.return</span> = returnFiber<span class="hljs-comment">;</span>
          return existing<span class="hljs-comment">;</span>
        }
      } else {
        if (
          <span class="hljs-attr">child.elementType</span> === elementType ||
          (__DEV__
            ? isCompatibleFamilyForHotReloading(child, element)
            : false) ||
          (typeof <span class="hljs-attr">elementType</span> === <span class="hljs-string">'object'</span> &amp;&amp;
            elementType !== null &amp;&amp;
            elementType.$$<span class="hljs-attr">typeof</span> === REACT_LAZY_TYPE &amp;&amp;
            resolveLazy(elementType) === child.type)
        ) {
          deleteRemainingChildren(returnFiber, child.sibling)<span class="hljs-comment">;</span>
          const <span class="hljs-attr">existing</span> = useFiber(child, element.props)<span class="hljs-comment">;</span>
          <span class="hljs-attr">existing.ref</span> = coerceRef(returnFiber, child, element)<span class="hljs-comment">;</span>
          <span class="hljs-attr">existing.return</span> = returnFiber<span class="hljs-comment">;</span>
          return existing<span class="hljs-comment">;</span>
        }
      }
      // key相同, 类型不同, 删除该节点和其兄弟节点
      deleteRemainingChildren(returnFiber, child)<span class="hljs-comment">;</span>
      break<span class="hljs-comment">;</span>
    } else {
      // 如果key不同, 则标记当前child为删除, 继续遍历下一个兄弟节点
      deleteChild(returnFiber, child)<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">child</span> = child.sibling<span class="hljs-comment">;</span>
  }

  /**
   * 2. 初始化阶段 ｜ 或循环中不满足复用条件, 直接创建新的Fiber节点
   */
  if (<span class="hljs-attr">element.type</span> === REACT_FRAGMENT_TYPE) { // Fragment 组件
    const <span class="hljs-attr">created</span> = createFiberFromFragment(
      element.props.children,
      returnFiber.mode,
      lanes,
      element.key,
    )<span class="hljs-comment">;</span>
    <span class="hljs-attr">created.return</span> = returnFiber<span class="hljs-comment">;</span>
    return created<span class="hljs-comment">;</span>
  } else { // 原生DOM元素、函数组件、类组件等
    const <span class="hljs-attr">created</span> = createFiberFromElement(element, returnFiber.mode, lanes)<span class="hljs-comment">;</span>
    <span class="hljs-attr">created.ref</span> = coerceRef(returnFiber, currentFirstChild, element)<span class="hljs-comment">;</span>
    <span class="hljs-attr">created.return</span> = returnFiber<span class="hljs-comment">;</span>
    return created<span class="hljs-comment">;</span>
  }
}
</code></pre>
<blockquote>
<p>总结下<code>reconcileSingleElement</code>方法的作用：负责处理单个<code>React</code>元素的更新，它的目标：</p>
<ol>
<li>在现有子节点链表中找到可以复用的节点</li>
<li>删除不需要的旧节点（打标记，<code>commit</code>阶段处理）</li>
<li>创建新的<code>Fiber</code>节点（如果没有可复用的）</li>
</ol>
</blockquote>
<h3 data-id="heading-8">处理多节点</h3>
<p><code>reconcileChildrenArray</code>函数负责协调一个数组类型的子元素列表。</p>
<ol>
<li>第一次循环：同时遍历旧的子<code>Fiber</code>节点链表和新的子元素数组，直到其中一个遍历完。<br/>
在遍历中，通过<code>updateSlot</code>函数尝试复用旧节点（<code>key</code>相同则复用，否则返回<code>null</code>）。</li>
</ol>

<ol>
<li>
<ol>
<li>如果复用失败（<code>key</code>不同），则跳出循环。</li>
<li>如果复用成功，但是位置可能发生变化，则通过<code>placeChild</code>标记位置（是否需要移动）。</li>
</ol>
</li>
</ol>

<ol start="2">
<li>如果新子元素数组遍历完（<code>newIdx === newChildren.length</code>），说明剩下的旧节点都是多余，需要删除。</li>
<li>如果旧节点链表遍历完（<code>oldFiber === null</code>），说明剩下的新子元素都是需要新增的，直接循环创建新的<code>Fiber</code>节点。</li>
<li>如果以上都不是，说明有节点位置发生变化（比如中间插入了新节点，或者节点被删除导致旧节点有剩余），此时将剩余的旧节点放入一个<code>Map</code>中（<code>key</code>作为索引，如果没有<code>key</code>则用<code>index</code>），然后继续遍历新子元素数组，从<code>Map</code>中查找可复用的节点，并标记移动。</li>
<li>最后，如果还有旧节点未被复用，则标记删除。</li>
</ol>
<pre><code class="hljs language-ini" lang="ini">function reconcileChildrenArray(
  returnFiber: Fiber,
  currentFirstChild: Fiber | null,
  newChildren: Array&lt;*&gt;,
  lanes: Lanes,
): Fiber | null {
  let resultingFirstChild: Fiber | <span class="hljs-attr">null</span> = null<span class="hljs-comment">; // 结果链表的头节点</span>
  let previousNewFiber: Fiber | <span class="hljs-attr">null</span> = null<span class="hljs-comment">;    // 上一个创建的Fiber</span>

  let <span class="hljs-attr">oldFiber</span> = currentFirstChild<span class="hljs-comment">; // 旧Fiber链表的节点, 开始指向同层的第一个节点</span>
  let <span class="hljs-attr">lastPlacedIndex</span> = <span class="hljs-number">0</span><span class="hljs-comment">;          // 已经处理完的节点中，最后一个"不需要移动"的节点在旧列表中的位置</span>
  let <span class="hljs-attr">newIdx</span> = <span class="hljs-number">0</span><span class="hljs-comment">;                   // 新children数组的当前索引</span>
  let <span class="hljs-attr">nextOldFiber</span> = null<span class="hljs-comment">;          // 下一个要处理的旧Fiber（临时存储）</span>
  /**
   * 1. 同时遍历旧的子Fiber节点链表和新的子元素数组, 直到其中一个遍历完
   */
  for (<span class="hljs-comment">; oldFiber !== null &amp;&amp; newIdx &lt; newChildren.length; newIdx++) {</span>
    if (oldFiber.index &gt; newIdx) {
      <span class="hljs-attr">nextOldFiber</span> = oldFiber<span class="hljs-comment">;</span>
      <span class="hljs-attr">oldFiber</span> = null<span class="hljs-comment">;</span>
    } else {
      <span class="hljs-attr">nextOldFiber</span> = oldFiber.sibling<span class="hljs-comment">;</span>
    }
    // updateSlot: 尝试复用旧节点（key相同则复用，否则返回null）
    const <span class="hljs-attr">newFiber</span> = updateSlot(
      returnFiber,
      oldFiber,
      newChildren<span class="hljs-section">[newIdx]</span>,
      lanes,
    )<span class="hljs-comment">;</span>
    // 匹配失败, 不能复用
    if (<span class="hljs-attr">newFiber</span> === null) {
      if (<span class="hljs-attr">oldFiber</span> === null) {
        <span class="hljs-attr">oldFiber</span> = nextOldFiber<span class="hljs-comment">;</span>
      }
      break<span class="hljs-comment">;</span>
    }
    if (shouldTrackSideEffects) {
      if (oldFiber &amp;&amp; <span class="hljs-attr">newFiber.alternate</span> === null) {
        deleteChild(returnFiber, oldFiber)<span class="hljs-comment">;</span>
      }
    }
    <span class="hljs-attr">lastPlacedIndex</span> = placeChild(newFiber, lastPlacedIndex, newIdx)<span class="hljs-comment">;</span>
    // 
    if (<span class="hljs-attr">previousNewFiber</span> === null) {
      <span class="hljs-attr">resultingFirstChild</span> = newFiber<span class="hljs-comment">;</span>
    } else {
      <span class="hljs-attr">previousNewFiber.sibling</span> = newFiber<span class="hljs-comment">;</span>
    }
    <span class="hljs-attr">previousNewFiber</span> = newFiber<span class="hljs-comment">;</span>
    <span class="hljs-attr">oldFiber</span> = nextOldFiber<span class="hljs-comment">;</span>
  }

  /**
   * 2. 如果新子元素数组遍历完, 说明剩下的旧节点都是多余, 需要删除
   */
  if (<span class="hljs-attr">newIdx</span> === newChildren.length) {
    deleteRemainingChildren(returnFiber, oldFiber)<span class="hljs-comment">;</span>
    return resultingFirstChild<span class="hljs-comment">;</span>
  }

  /**
   * 3. 如果旧节点链表遍历完, 说明剩下的新子元素都是需要新增的, 直接循环创建
   */
  if (<span class="hljs-attr">oldFiber</span> === null) {
    for (<span class="hljs-comment">; newIdx &lt; newChildren.length; newIdx++) {</span>
      const <span class="hljs-attr">newFiber</span> = createChild(returnFiber, newChildren[newIdx], lanes)<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">newFiber</span> === null) {
        continue<span class="hljs-comment">;</span>
      }
      <span class="hljs-attr">lastPlacedIndex</span> = placeChild(newFiber, lastPlacedIndex, newIdx)<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">previousNewFiber</span> === null) {
        <span class="hljs-attr">resultingFirstChild</span> = newFiber<span class="hljs-comment">;</span>
      } else {
        <span class="hljs-attr">previousNewFiber.sibling</span> = newFiber<span class="hljs-comment">;</span>
      }
      <span class="hljs-attr">previousNewFiber</span> = newFiber<span class="hljs-comment">;</span>
    }
    return resultingFirstChild<span class="hljs-comment">;</span>
  }

  /**
   * 4. 如果以上都不是, 说明有节点位置发生变化, 此时将剩余的旧节点放入一个Map中,
   * 然后继续遍历新子元素数组, 从Map中查找可复用的节点, 并标记移动
   */
  const <span class="hljs-attr">existingChildren</span> = mapRemainingChildren(returnFiber, oldFiber)<span class="hljs-comment">;</span>
  for (<span class="hljs-comment">; newIdx &lt; newChildren.length; newIdx++) {</span>
    const <span class="hljs-attr">newFiber</span> = updateFromMap(
      existingChildren,
      returnFiber,
      newIdx,
      newChildren<span class="hljs-section">[newIdx]</span>,
      lanes,
    )<span class="hljs-comment">;</span>
    if (newFiber !== null) {
      if (shouldTrackSideEffects) {
        if (newFiber.alternate !== null) {
          existingChildren.delete(
            <span class="hljs-attr">newFiber.key</span> === null ? newIdx : newFiber.key,
          )<span class="hljs-comment">;</span>
        }
      }
      <span class="hljs-attr">lastPlacedIndex</span> = placeChild(newFiber, lastPlacedIndex, newIdx)<span class="hljs-comment">;</span>
      if (<span class="hljs-attr">previousNewFiber</span> === null) {
        <span class="hljs-attr">resultingFirstChild</span> = newFiber<span class="hljs-comment">;</span>
      } else {
        <span class="hljs-attr">previousNewFiber.sibling</span> = newFiber<span class="hljs-comment">;</span>
      }
      <span class="hljs-attr">previousNewFiber</span> = newFiber<span class="hljs-comment">;</span>
    }
  }

  /**
   * 5. 最后, 如果还有旧节点未被复用, 则标记删除
   */
  if (shouldTrackSideEffects) {
    existingChildren.forEach(<span class="hljs-attr">child</span> =&gt; deleteChild(returnFiber, child))<span class="hljs-comment">;</span>
  }

  return resultingFirstChild<span class="hljs-comment">;</span>
}
</code></pre>
<blockquote>
<p>总结下<code>reconcileChildrenArray</code>方法的作用：负责协调一个数组类型的子元素列表，它的设计：</p>
<p>第一阶段：顺序比较（处理相同位置节点）</p>
<p>↓</p>
<p>第二阶段：处理新增/删除边界</p>
<p>↓</p>
<p>第三阶段：<code>Map</code>查找（处理节点移动）</p>
</blockquote>
<h2 data-id="heading-9">实际案例：列表重排的DIFF过程</h2>
<p>假设有如下列表更新：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-comment">// 更新前</span>
&lt;<span class="hljs-selector-tag">ul</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">A</span>"&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">B</span>"&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">C</span>"&gt;<span class="hljs-selector-tag">C</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">D</span>"&gt;<span class="hljs-selector-tag">D</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
&lt;/<span class="hljs-selector-tag">ul</span>&gt;

<span class="hljs-comment">// 更新后(D移动到B之前)</span>
&lt;<span class="hljs-selector-tag">ul</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">A</span>"&gt;<span class="hljs-selector-tag">A</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">D</span>"&gt;<span class="hljs-selector-tag">D</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">B</span>"&gt;<span class="hljs-selector-tag">B</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
  &lt;<span class="hljs-selector-tag">li</span> <span class="hljs-selector-tag">key</span>="<span class="hljs-selector-tag">C</span>"&gt;<span class="hljs-selector-tag">C</span>&lt;/<span class="hljs-selector-tag">li</span>&gt;
&lt;/<span class="hljs-selector-tag">ul</span>&gt;
</code></pre>
<p><code>DIFF</code>过程：</p>
<ol>
<li>第一轮遍历：比较<code>A-A</code>（复用），比较<code>B-D</code>（<code>key</code>不同，跳出第一轮）</li>
<li>建立Map：<code>{B: B_Fiber, C: C_Fiber, D: D_Fiber}</code></li>
<li>第二轮遍历：</li>
</ol>
<ul>
<li>
<ul>
<li>处理<code>D</code>：从<code>Map</code>中找到<code>D_Fiber</code>，<code>lastPlacedIndex=0</code>，<code>oldIndex=3&gt;0</code>，不需要移动</li>
<li>处理<code>B</code>：从<code>Map</code>中找到<code>B_Fiber</code>，<code>lastPlacedIndex=3</code>，<code>oldIndex=1&lt;3</code>，需要移动</li>
<li>处理<code>C</code>：从<code>Map</code>中找到<code>C_Fiber</code>，<code>lastPlacedIndex=3</code>，<code>oldIndex=2&lt;3</code>，需要移动</li>
</ul>
</li>
</ul>
<ol start="4">
<li>结果：<code>D</code>保持原位，<code>B</code>和<code>C</code>向后移动</li>
</ol>
<h2 data-id="heading-10">总结</h2>
<p><code>React</code>的<code>DIFF</code>算法是一个经过精心设计和不断优化的复杂系统。从<code>React16</code>的<code>Fiber</code>架构到<code>React18</code>的并发特性，<code>DIFF</code>算法始终围绕着以下核心目标：</p>
<ol>
<li><strong>高效性</strong>：通过<code>O(n)</code>复杂度的算法快速找出差异</li>
<li><strong>稳定性</strong>：确保在可中断渲染中<code>UI</code>的一致性</li>
<li><strong>可预测性</strong>：开发者可以通过<code>key</code>等手段控制更新行为</li>
<li><strong>渐进增强</strong>：支持并发渲染，提高应用响应速度</li>
</ol>
<p>下一章我们将了解真实<code>DOM</code>的变更：<code>commit</code>阶段</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[构建产物优化：如何让包体积减少 60%？]]></title>    <link>https://juejin.cn/post/7598563188113031220</link>    <guid>https://juejin.cn/post/7598563188113031220</guid>    <pubDate>2026-01-26T01:48:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188113031220" data-draft-id="7598699872540344339" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="构建产物优化：如何让包体积减少 60%？"/> <meta itemprop="keywords" content="前端,前端工程化"/> <meta itemprop="datePublished" content="2026-01-26T01:48:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小小栈"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            构建产物优化：如何让包体积减少 60%？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小小栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:48:48.000Z" title="Mon Jan 26 2026 01:48:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    2
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在前端工程化的链路中，如果说 CI/CD 是传送带，那么**构建产物（Bundle）**就是最终交付给用户的“货物”。对于一个拥有 8 年经验的开发者来说，优化体积不只是为了“好看”，更是为了减少 HTTP 传输损耗、降低浏览器解析耗时（Parse Cost），从而直接提升业务转化率。</p>
<p>本篇我们将深入构建引擎底层，实战拆解如何通过“外科手术级”的手段，将包体积硬生生砍掉 60%。</p>
<hr/>
<h2 data-id="heading-0">一、 瘦身第一步：依赖的“大扫除”</h2>
<p>很多时候，包体积臃肿是因为我们引入了“核武器”却只用来“切菜”。</p>
<h3 data-id="heading-1">1. 彻底清算“巨无霸”库</h3>
<ul>
<li>
<p><strong>Moment.js -&gt; dayjs：</strong> Moment 包含大量语言包且体积巨大。换成 API 几乎一致的 <code>dayjs</code>，体积直接从 200KB+ 降至 2KB。</p>
</li>
<li>
<p><strong>Lodash 的正确姿势：</strong> 拒绝 <code>import _ from 'lodash'</code>。</p>
<ul>
<li><strong>方案 A：</strong> 使用 <code>import get from 'lodash/get'</code>。</li>
<li><strong>方案 B：</strong> 配置 <code>babel-plugin-lodash</code> 自动按需引入。</li>
</ul>
</li>
</ul>
<h3 data-id="heading-2">2. 揭秘 Tree Shaking 的“失效”真相</h3>
<p>为什么明明用了 ESM，有些代码还是删不掉？</p>
<ul>
<li><strong>Side Effects（副作用）：</strong> 只要模块顶层有全局赋值或修改原型链的行为，编译器就不敢删它。</li>
<li><strong>实战：</strong> 在 <code>package.json</code> 中明确声明 <code>"sideEffects": false</code>（或指定特定文件），这是开启极致压缩的通行证。</li>
</ul>
<hr/>
<h2 data-id="heading-3">二、 进阶：分而治之（Code Splitting）</h2>
<p>把一个 2MB 的主包拆成十个 200KB 的小包，利用浏览器的<strong>并发下载</strong>和<strong>持久化缓存</strong>，用户体感速度会快得多。</p>
<h3 data-id="heading-4">1. 路由级懒加载（Dynamic Import）</h3>
<p>在现代框架中，这是标配。</p>
<p>JavaScript</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">AdminDash</span> = () =&gt; import(<span class="hljs-string">'./views/AdminDash.vue'</span>)<span class="hljs-comment">;</span>
</code></pre>
<h3 data-id="heading-5">2. 策略化拆包：SplitChunks</h3>
<p>不要指望构建工具的默认配置。在 Webpack 或 Vite (Rollup) 中手动划分缓存组：</p>
<ul>
<li><strong>Runtime Chunk：</strong> 提取引导代码（Manifest），防止业务代码变动导致 Hash 变化。</li>
<li><strong>Vendor Chunk：</strong> 将 <code>vue/react</code> 等极少变动的框架代码独立打包。</li>
<li><strong>Commons Chunk：</strong> 提取被多个页面同时引用的公共组件。</li>
</ul>
<hr/>
<h2 data-id="heading-6">三、 底层黑科技：现代语法与压缩</h2>
<h3 data-id="heading-7">1. 目标浏览器：Browserslist</h3>
<p>如果你还在为 IE11 打包，那么你的产物里会充斥着大量的 Polyfill（补丁代码）。</p>
<ul>
<li><strong>配置：</strong> 修改 <code>.browserslistrc</code>，放弃过时的浏览器。</li>
<li><strong>结果：</strong> 移除大量的 <code>core-js</code> 注入，产物直接缩水 20%-30%。</li>
</ul>
<h3 data-id="heading-8">2. 压缩引擎的更迭：从 Terser 到 ESBuild/SWC</h3>
<ul>
<li>在生产环境使用 <strong>ESBuild</strong> 或 <strong>Terser (Parallel mode)</strong> 进行极致压缩。</li>
<li>开启 <code>drop_console: true</code>，自动剔除所有 <code>console.log</code> 指令。</li>
</ul>
<hr/>
<h2 data-id="heading-9">四、 终极杀招：从资源本身下手</h2>
<h3 data-id="heading-10">1. 图片的“降维打击”</h3>
<p>图片通常占包体积的大头，但它们不该在 JS 包里。</p>
<ul>
<li><strong>WebP 转换：</strong> 利用 <code>image-minimizer-webpack-plugin</code> 自动将图片转为 WebP 格式。</li>
<li><strong>小图内联：</strong> 设置 <code>data-uri</code> 阈值（如 4KB），减少小图片的 HTTP 请求数。</li>
</ul>
<h3 data-id="heading-11">2. 开启 Gzip / Brotli（全栈必会）</h3>
<p>这是工程化与运维的配合：</p>
<ul>
<li>在构建阶段生成 <code>.gz</code> 或 <code>.br</code> 文件。</li>
<li>配置 Nginx 开启 <code>gzip_static on;</code>。Brotli 的压缩率通常比 Gzip 还要高出 15%-20%。</li>
</ul>
<hr/>
<h2 data-id="heading-12">💡 给前端开发者的硬核贴士</h2>
<ul>
<li><strong>可视化是优化的前提：</strong> 永远先跑一遍 <code>webpack-bundle-analyzer</code> 或 <code>rollup-plugin-visualizer</code>。<strong>你看不见的 Bug 没法修，你看不见的体积没法减。</strong></li>
<li><strong>警惕第三方 SDK：</strong> 很多统计、地图、在线客服的 SDK 及其庞大，尽量通过 CDN 异步加载，不要打包进主包。</li>
</ul>
<hr/>
<h3 data-id="heading-13">结语</h3>
<p>产物优化不是一次性的工作，而是一个持续的观测过程。通过依赖精简、智能拆包、现代标准和高效压缩，包体积减少 60% 并不是神话，而是工程化能力的自然体现。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[低代码与脚手架：打造自研的 CLI 工具]]></title>    <link>https://juejin.cn/post/7598710324168179727</link>    <guid>https://juejin.cn/post/7598710324168179727</guid>    <pubDate>2026-01-26T01:49:39.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598710324168179727" data-draft-id="7598435950410874890" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="低代码与脚手架：打造自研的 CLI 工具"/> <meta itemprop="keywords" content="前端,前端工程化"/> <meta itemprop="datePublished" content="2026-01-26T01:49:39.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端小小栈"/> <meta itemprop="url" content="https://juejin.cn/user/1081575170131006"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            低代码与脚手架：打造自研的 CLI 工具
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1081575170131006/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端小小栈
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:49:39.000Z" title="Mon Jan 26 2026 01:49:39 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>对于 8 年经验的资深开发者来说， <strong>“懒”是最高级的赞美</strong>。如果你发现自己在一个月内重复配置了三次同样的 Lint 规则、复制了五次同样的目录结构，那么你就该意识到：<strong>你的生产力正在被这种低效的“搬运”吞噬。</strong></p>
<p>在前端工程化体系中，<strong>CLI（命令行界面）工具</strong>是封装团队最佳实践、实现“一键基建”的核心武器。</p>
<hr/>
<h2 data-id="heading-0">一、 为什么我们要“自研” CLI？</h2>
<p>市面上已经有 <code>create-react-app</code> 或 <code>vue-cli</code>，为什么还要自研？</p>
<ol>
<li><strong>业务强绑定：</strong> 官方工具是普适的，但自研工具可以内置公司私有的组件库、埋点 SDK、SSO 登录逻辑和 CI/CD 模版。</li>
<li><strong>技术栈收敛：</strong> 强制团队统一使用 pnpm、特定版本的 TypeScript 或 Tailwind CSS，减少维护成本。</li>
<li><strong>流程自动化：</strong> 除了拉取模板，CLI 还可以集成自动创建 Git 仓库、自动分配权限、自动生成 API 代码等功能。</li>
</ol>
<hr/>
<h2 data-id="heading-1">二、 CLI 工具的“权力清单”：核心技术选型</h2>
<p>要写一个专业的 CLI，你需要这套成熟的 Node.js 工具链：</p>
<ul>
<li><strong><code>commander</code> / <code>yargs</code>：</strong> 命令参数解析（如 <code>my-cli create &lt;name&gt;</code>）。</li>
<li><strong><code>inquirer</code> / <code>prompts</code>：</strong> 命令行交互，让用户做选择题或填空题。</li>
<li><strong><code>chalk</code> / <code>picocolors</code>：</strong> 让你的终端输出变得五颜六色（成功是绿的，报错是红的）。</li>
<li><strong><code>ora</code>：</strong> 终端加载动画（Spinner），让等待过程不焦虑。</li>
<li><strong><code>execa</code>：</strong> 增强版的 <code>child_process</code>，用于执行 git clone 或 pnpm install。</li>
<li><strong><code>download-git-repo</code>：</strong> 远程下载 GitHub/GitLab 上的模版仓库。</li>
</ul>
<hr/>
<h2 data-id="heading-2">三、 实战：三步打造一个项目脚手架</h2>
<h3 data-id="heading-3">第一步：命令定义</h3>
<p>在 <code>bin/index.js</code> 中定义入口，利用 <code>commander</code> 监听 <code>create</code> 命令。</p>
<p>JavaScript</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
<span class="hljs-keyword">const</span> { program } = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>);

program
  .<span class="hljs-title function_">command</span>(<span class="hljs-string">'create &lt;project-name&gt;'</span>)
  .<span class="hljs-title function_">description</span>(<span class="hljs-string">'创建一个新的项目模板'</span>)
  .<span class="hljs-title function_">action</span>(<span class="hljs-function">(<span class="hljs-params">name</span>) =&gt;</span> {
    <span class="hljs-comment">// 逻辑代码</span>
  });

program.<span class="hljs-title function_">parse</span>(process.<span class="hljs-property">argv</span>);
</code></pre>
<h3 data-id="heading-4">第二步：交互问询</h3>
<p>询问用户需要什么功能，比如是否需要 Pinia、是否需要 E2E 测试。</p>
<p>JavaScript</p>
<pre><code class="hljs language-go" lang="go"><span class="hljs-keyword">const</span> questions = [
  {
    <span class="hljs-keyword">type</span>: <span class="hljs-string">'list'</span>,
    name: <span class="hljs-string">'template'</span>,
    message: <span class="hljs-string">'请选择项目模板'</span>,
    choices: [<span class="hljs-string">'Vue3-Vite-Starter'</span>, <span class="hljs-string">'React-Next-Admin'</span>],
  },
  {
    <span class="hljs-keyword">type</span>: <span class="hljs-string">'confirm'</span>,
    name: <span class="hljs-string">'install'</span>,
    message: <span class="hljs-string">'是否自动安装依赖？'</span>,
    <span class="hljs-keyword">default</span>: <span class="hljs-literal">true</span>,
  }
];
</code></pre>
<h3 data-id="heading-5">第三步：模版拉取与动态渲染</h3>
<ul>
<li><strong>静态模式：</strong> 直接从 GitLab 仓库 <code>git clone</code> 对应的分支。</li>
<li><strong>动态模式（更高级）：</strong> 使用 <code>handlebars</code> 模板引擎，根据用户刚才的选择，动态修改 <code>package.json</code> 中的字段（如项目名称、作者、依赖项）。</li>
</ul>
<hr/>
<h2 data-id="heading-6">四、 进阶：从脚手架到低代码（Low-Code）</h2>
<p>如果 CLI 解决的是“从 0 到 1”的基建问题，那么<strong>低代码/弱代码</strong>解决的就是“从 1 到 N”的效率问题。</p>
<ol>
<li><strong>Schema 驱动代码生成：</strong> 编写一个脚本，读取 Swagger/OpenAPI 的 JSON 结构，自动生成 TypeScript 类型定义和 API 请求函数。</li>
<li><strong>区块（Block）复用：</strong> 类似 Ant Design Pro，通过 CLI 一键插入一个“登录页面区块”或“表格筛选区块”，而不是手动复制粘贴代码。</li>
<li><strong>内联脚本（In-place Scripts）：</strong> 比如开发一个 <code>my-cli add-page &lt;name&gt;</code> 命令，它能自动在 <code>src/views</code> 创建文件，并顺便在 <code>router.js</code> 里插好路由配置。</li>
</ol>
<hr/>
<h2 data-id="heading-7">💡 给前端开发者的硬核贴士</h2>
<ul>
<li><strong>版本管理：</strong> CLI 自身也要记得做版本检查（比如检测到旧版本时提示 <code>npm update -g my-cli</code>），否则会导致团队成员用的模版版本不统一。</li>
<li><strong>本地开发调试：</strong> 在 CLI 项目目录下执行 <code>npm link</code>（或 <code>pnpm link --global</code>），这样你就可以在全局直接使用你正在开发的命令了。</li>
<li><strong>别忘了 <code>chmod +x</code>：</strong> 确保你的入口脚本有执行权限，并且顶部带有 <code>#!/usr/bin/env node</code>。</li>
</ul>
<hr/>
<h3 data-id="heading-8">结语</h3>
<p>自研 CLI 是前端工程师从“使用者”向“建设者”转变的标志。它沉淀了你的技术深度，也将你从繁琐的配置中彻底解脱。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀]]></title>    <link>https://juejin.cn/post/7598734303174869044</link>    <guid>https://juejin.cn/post/7598734303174869044</guid>    <pubDate>2026-01-26T01:50:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174869044" data-draft-id="7598734303174819892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀"/> <meta itemprop="keywords" content="前端,数据可视化,Vue.js"/> <meta itemprop="datePublished" content="2026-01-26T01:50:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="一颗烂土豆"/> <meta itemprop="url" content="https://juejin.cn/user/764915822371912"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/764915822371912/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    一颗烂土豆
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T01:50:48.000Z" title="Mon Jan 26 2026 01:50:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">raychart 基于 Vue 的 3D 图表可视化实践：移动端优先从交互到性能的一次系统升级 🚀</h2>
<p>先说结论：做 3D 图表可视化编辑器时，移动端优先并不是“迁就小屏”，而是帮你把复杂度收敛到正确的地方。3D 图表的信息密度高、交互多、渲染重，如果按桌面端思维直接堆功能，结果通常是功能齐全但体验割裂。我们在 raychart 的 Vue 技术栈里把编辑器先打磨成“手机也能顺畅使用”的体验，再向桌面扩展，最终移动端更好用、桌面端也更清晰。</p>
<h3 data-id="heading-1">为什么 3D 图表可视化更需要移动端优先 📱</h3>
<p>移动端限制不是坏事，而是设计的天然约束。小屏幕会迫使你重新定义“最重要的交互路径”，也会倒逼你把功能收敛成清晰的层级结构。对基于 Vue 的 3D 图表可视化来说，这正是体验提升的关键。</p>
<ul>
<li>交互路径更短：移动端需要“少步骤完成关键任务”</li>
<li>信息层级更清晰：控制项必须分组、折叠、聚焦</li>
<li>性能更稳：移动端的硬件限制驱动我们优化默认值</li>
</ul>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fchart3js.netlify.app%2F%23%2F" target="_blank" title="https://chart3js.netlify.app/#/" ref="nofollow noopener noreferrer">RayChart 预览地址:  https://chart3js.netlify.app/#/</a>
<img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/a90f667a248a40d9bc6aea593461dadb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=TlQ6bVdzJpaPsut%2B50X7zT2Mjy0%3D" alt="ScreenShot_2026-01-26_092915_641.png" loading="lazy"/></p>
<h3 data-id="heading-2">项目中如何落地：从控制模块的边界开始 🧩</h3>
<p>我们把图表设置拆分为多个独立控制模块，每个模块只负责一个清晰的任务边界，例如：</p>
<ul>
<li>数据控制：输入与编辑数据点 🧮</li>
<li>坐标控制：管理坐标系与维度映射 🧭</li>
<li>光照控制：灯光类型、强度与阴影 💡</li>
<li>主题控制：配色方案和默认颜色 🎨</li>
</ul>
<p>这种结构直接服务移动端优先的目标：把复杂系统拆成可理解的小块，让用户在小屏幕上也能顺畅完成配置。桌面端只是展示空间更大，但交互路径依然保持简洁。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c978e947808345d8a2f68099e1aac78b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=1G%2FGpMvLKFGSo39qtKJTITDtGQ4%3D" alt="ScreenShot_2026-01-26_092942_569.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/58ec649f094a45f79f6d98707ccaad73~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=n%2BbYFXgItK8Jc%2FWUArmb4FWCqaE%3D" alt="ScreenShot_2026-01-26_092954_321.png" loading="lazy"/></p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c8177ad2fd614861ad4d6b501da50395~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=mjGspFsDUgyZgZFcNFn3hd8niyU%3D" alt="ScreenShot_2026-01-26_092925_249.png" loading="lazy"/></p>
<h3 data-id="heading-3">移动端优先带来的三类收益 ✅</h3>
<h4 data-id="heading-4">1. 交互体验更“可预期” 🤝</h4>
<p>移动端用户通常只关心最核心的操作：切换图表、调参数、预览效果。我们把这些动作放在最短路径上，次要配置收进折叠区域。结果是桌面端也同样清爽，用户更快找到关键设置。</p>
<h4 data-id="heading-5">2. 设计一致性更强 🧱</h4>
<p>为了适配小屏幕，我们统一了组件大小、间距、配色和状态样式，形成稳定的一致性。这种一致性一旦建立，桌面端也同步获得更可靠的视觉体验。</p>
<h4 data-id="heading-6">3. 性能优化更有效 ⚡</h4>
<p>3D 图表可视化的性能瓶颈多在光照、阴影、材质等环节。移动端优先的限制迫使我们设置更合理的默认值，例如：</p>
<ul>
<li>默认灯光数量更克制</li>
<li>阴影为可选项而非强制项</li>
<li>材质细节更收敛</li>
</ul>
<p>这些优化也让桌面端获得更稳定的帧率和更低的功耗。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89ee2863b2c44125b6235252828716ac~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5LiA6aKX54OC5Zyf6LGG:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769998322&amp;x-signature=Yb6vXnthiDBGQE%2BYEsvmjn0f%2FSA%3D" alt="ScreenShot_2026-01-26_094809_782.png" loading="lazy"/></p>
<h3 data-id="heading-7">总结：移动端优先不是妥协，而是效率策略 🎯</h3>
<p>移动端优先的价值不在于“做个能在手机上跑的版本”，而在于用它作为一种强约束，让系统更简单、更清晰、更高效。对 3D 图表这种复杂交互场景来说，它可以帮助我们：</p>
<ul>
<li>快速收敛需求边界</li>
<li>建立明确的控制层级</li>
<li>统一 UI 的风格与节奏</li>
<li>同时提升移动端与桌面端体验</li>
</ul>
<p>如果你也在做 3D 图表、Vue 可视化编辑器或复杂配置系统，建议试着从移动端出发设计一次，你会更快发现真正有价值的交互路径。</p>
<h3 data-id="heading-8">关键词 🔎</h3>
<p>3D 图表、3D 可视化、Vue、Vue3、前端可视化、图表编辑器、移动端优先、交互设计、性能优化</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[一次吃透「移除元素」：双指针的最朴素、也最重要的形态]]></title>    <link>https://juejin.cn/post/7598807837868916762</link>    <guid>https://juejin.cn/post/7598807837868916762</guid>    <pubDate>2026-01-26T02:15:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598807837868916762" data-draft-id="7596845113281331209" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="一次吃透「移除元素」：双指针的最朴素、也最重要的形态"/> <meta itemprop="keywords" content="LeetCode,算法"/> <meta itemprop="datePublished" content="2026-01-26T02:15:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YukiMori23"/> <meta itemprop="url" content="https://juejin.cn/user/4022441007125707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            一次吃透「移除元素」：双指针的最朴素、也最重要的形态
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4022441007125707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YukiMori23
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:15:15.000Z" title="Mon Jan 26 2026 02:15:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>LeetCode 27｜简单<br/>
核心思想：快慢指针（双指针）<br/>
关键词：原地修改、覆盖、不关心顺序</p>
</blockquote>
<hr/>
<h2 data-id="heading-0">一、题目回顾</h2>
<p>给你一个数组 <code>nums</code> 和一个值 <code>val</code>，你需要 <strong>原地移除所有等于 <code>val</code> 的元素</strong>，并返回移除后数组的新长度。</p>
<p>要求：</p>
<ul>
<li>不使用额外数组</li>
<li>不关心新数组后面的内容</li>
<li>返回的是“有效元素的长度”</li>
</ul>
<p>示例：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">nums</span> = [<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>], val = <span class="hljs-number">3</span>
返回 2
nums 前 2 个元素为 <span class="hljs-section">[2,2]</span>
</code></pre>
<hr/>
<h2 data-id="heading-1">二、这道题最容易踩的坑</h2>
<p>很多人一开始会纠结：</p>
<ul>
<li>“删元素后数组怎么变？”</li>
<li>“是不是要真的把数组缩短？”</li>
<li>“后面的值要不要清空？”</li>
</ul>
<p>但题目其实已经偷偷告诉你答案了：</p>
<blockquote>
<p><strong>你只需要保证前 k 个元素是正确的，后面是什么不重要。</strong></p>
</blockquote>
<p>这一点非常关键。</p>
<hr/>
<h2 data-id="heading-2">三、核心思路：双指针在“做什么”？</h2>
<p>我们用两个指针：</p>
<ul>
<li><code>right</code>：扫描整个数组（读）</li>
<li><code>left</code>：指向下一个“应该被保留下来的位置”（写）</li>
</ul>
<p>它们的分工非常明确：</p>
<blockquote>
<p><strong>right 负责看每一个元素，left 只在“遇到合法元素”时前进。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-3">四、代码实现（Java）</h2>
<pre><code class="hljs language-ini" lang="ini">class Solution {
    public int removeElement(int<span class="hljs-section">[]</span> nums, int val) {
        int <span class="hljs-attr">n</span> = nums.length<span class="hljs-comment">;</span>
        int <span class="hljs-attr">left</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>

        for (int <span class="hljs-attr">right</span> = <span class="hljs-number">0</span><span class="hljs-comment">; right &lt; n; right++) {</span>
            if (nums<span class="hljs-section">[right]</span> != val) {
                nums<span class="hljs-section">[left]</span> = nums<span class="hljs-section">[right]</span><span class="hljs-comment">;</span>
                left++<span class="hljs-comment">;</span>
            }
        }

        return left<span class="hljs-comment">;</span>
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-4">五、逐行拆解这段代码的“真实含义”</h2>
<h3 data-id="heading-5">1. <code>left</code> 指针的意义</h3>
<pre><code class="hljs language-ini" lang="ini">int <span class="hljs-attr">left</span> = <span class="hljs-number">0</span><span class="hljs-comment">;</span>
</code></pre>
<p><code>left</code> 永远指向：</p>
<blockquote>
<p><strong>下一个可以放“有效元素”的位置</strong></p>
</blockquote>
<p>它不是在找 val，也不是在删除元素，而是在“维护结果数组的长度”。</p>
<hr/>
<h3 data-id="heading-6">2. <code>right</code> 指针在干嘛？</h3>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-keyword">right</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; <span class="hljs-keyword">right</span> <span class="hljs-operator">&lt;</span> n; <span class="hljs-keyword">right</span><span class="hljs-operator">+</span><span class="hljs-operator">+</span>) {
</code></pre>
<p><code>right</code> 是一个<strong>纯扫描指针</strong>：</p>
<ul>
<li>从头到尾看一遍数组</li>
<li>不回头、不跳跃</li>
<li>保证每个元素只看一次</li>
</ul>
<hr/>
<h3 data-id="heading-7">3. 为什么只在 <code>!= val</code> 时才赋值？</h3>
<pre><code class="hljs language-ini" lang="ini">if (nums<span class="hljs-section">[right]</span> != val) {
    nums<span class="hljs-section">[left]</span> = nums<span class="hljs-section">[right]</span><span class="hljs-comment">;</span>
    left++<span class="hljs-comment">;</span>
}
</code></pre>
<p>这一步非常精髓：</p>
<ul>
<li>
<p>如果当前元素是 <code>val</code></p>
<ul>
<li>直接跳过，相当于“删掉”</li>
</ul>
</li>
<li>
<p>如果不是 <code>val</code></p>
<ul>
<li>把它覆盖写到 <code>left</code> 的位置</li>
<li><code>left</code> 前进，表示有效长度 +1</li>
</ul>
</li>
</ul>
<p><strong>注意：这是“覆盖”，不是交换。</strong></p>
<hr/>
<h2 data-id="heading-8">六、用一个具体例子走一遍</h2>
<p>输入：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-attr">nums</span> = [<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">0</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>]
<span class="hljs-attr">val</span> = <span class="hljs-number">2</span>
</code></pre>
<p>执行过程：</p>




































































<table><thead><tr><th>right</th><th>nums[right]</th><th>是否保留</th><th>left</th><th>nums 前部</th></tr></thead><tbody><tr><td>0</td><td>0</td><td>是</td><td>1</td><td>[0]</td></tr><tr><td>1</td><td>1</td><td>是</td><td>2</td><td>[0,1]</td></tr><tr><td>2</td><td>2</td><td>否</td><td>2</td><td>[0,1]</td></tr><tr><td>3</td><td>2</td><td>否</td><td>2</td><td>[0,1]</td></tr><tr><td>4</td><td>3</td><td>是</td><td>3</td><td>[0,1,3]</td></tr><tr><td>5</td><td>0</td><td>是</td><td>4</td><td>[0,1,3,0]</td></tr><tr><td>6</td><td>4</td><td>是</td><td>5</td><td>[0,1,3,0,4]</td></tr><tr><td>7</td><td>2</td><td>否</td><td>5</td><td>[0,1,3,0,4]</td></tr></tbody></table>
<p>最终返回 <code>left = 5</code>。</p>
<hr/>
<h2 data-id="heading-9">七、为什么这道题不需要交换？</h2>
<p>有些双指针题会用“左右交换”，但这里不需要，原因是：</p>
<ul>
<li>题目不要求保留原有顺序之外的任何信息</li>
<li>我们只关心“哪些值留下”</li>
<li>覆盖写入比交换更简单、更稳定</li>
</ul>
<p>这类写法也被称为：</p>
<blockquote>
<p><strong>慢指针构造结果，快指针遍历输入</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-10">八、时间与空间复杂度</h2>
<ul>
<li>
<p>时间复杂度：<code>O(n)</code></p>
<ul>
<li>每个元素只看一次</li>
</ul>
</li>
<li>
<p>空间复杂度：<code>O(1)</code></p>
<ul>
<li>原地修改，没有额外数组</li>
</ul>
</li>
</ul>
<hr/>
<h2 data-id="heading-11">九、这道题在整个双指针体系里的位置</h2>
<p>这是<strong>最基础、最干净</strong>的双指针模型：</p>
<ul>
<li>没有排序</li>
<li>没有边界博弈</li>
<li>没有复杂条件</li>
</ul>
<p>但它是下面这些题的“地基”：</p>
<ul>
<li>移除重复元素</li>
<li>移动零</li>
<li>有效数组长度类问题</li>
<li>原地过滤问题</li>
</ul>
<p>一句话总结它的思想：</p>
<blockquote>
<p><strong>用一个指针遍历世界，用另一个指针构造答案。</strong></p>
</blockquote>
<hr/>
<h2 data-id="heading-12">十、最后的小总结</h2>
<p>这道题的难点不在代码，而在观念转变：</p>
<ul>
<li>不要执着于“删除”</li>
<li>把问题转化为“保留什么”</li>
<li>用指针去描述“状态变化”</li>
</ul>
<p>当你真正理解了这道题，<br/>
后面很多数组题都会突然变得顺眼。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[移动端 Web 开发学习笔记：从视口到流式布局，一篇带你真正入门]]></title>    <link>https://juejin.cn/post/7599268297202761766</link>    <guid>https://juejin.cn/post/7599268297202761766</guid>    <pubDate>2026-01-26T02:16:22.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202761766" data-draft-id="7598499504170369062" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="移动端 Web 开发学习笔记：从视口到流式布局，一篇带你真正入门"/> <meta itemprop="keywords" content="CSS,HTML"/> <meta itemprop="datePublished" content="2026-01-26T02:16:22.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="YukiMori23"/> <meta itemprop="url" content="https://juejin.cn/user/4022441007125707"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            移动端 Web 开发学习笔记：从视口到流式布局，一篇带你真正入门
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4022441007125707/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    YukiMori23
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:16:22.000Z" title="Mon Jan 26 2026 02:16:22 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    1
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在开始移动端 Web 开发之前，我一直以为「移动端就是把 PC 页面缩小」。<br/>
真正系统学完一轮之后才发现，<strong>视口、像素比、二倍图、布局方案</strong>，每一个点都决定了页面体验的好坏。</p>
<p>这篇文章是我在学习 <strong>移动端 Web 开发（流式布局方向）</strong> 时的完整总结，适合刚从 PC 端转向移动端，或者对移动端概念比较模糊的同学。</p>
<hr/>
<h2 data-id="heading-0">一、移动端开发的现状与特点</h2>
<h3 data-id="heading-1">1. 移动端浏览器现状</h3>
<p>移动端常见浏览器包括：</p>
<ul>
<li>UC 浏览器</li>
<li>QQ 浏览器</li>
<li>百度手机浏览器</li>
<li>Safari（iOS）</li>
<li>Chrome（Android）</li>
</ul>
<p>一个非常重要的事实是：</p>
<p><strong>国内主流移动端浏览器，基本都基于 WebKit 内核。</strong></p>
<p>这意味着：</p>
<ul>
<li>H5 + CSS3 可以放心使用</li>
<li>私有前缀重点关注 <code>-webkit-</code></li>
<li>不需要像 PC 时代那样被 IE 折磨</li>
</ul>
<hr/>
<h3 data-id="heading-2">2. 屏幕碎片化问题</h3>
<p>移动设备的分辨率极其碎片化，例如：</p>
<ul>
<li>Android：720×1280、1080×1920、2K、4K</li>
<li>iPhone：750×1334、1242×2208 等</li>
</ul>
<p>但作为前端开发者：</p>
<p><strong>不需要纠结 dp、dpi、ppi 等概念</strong><br/>
我们关心的是：<br/>
CSS 像素如何映射到设备屏幕。</p>
<hr/>
<h2 data-id="heading-3">二、视口（Viewport）是移动端的第一道门槛</h2>
<p>很多移动端布局问题，根源都在 <strong>视口没理解清楚</strong>。</p>
<h3 data-id="heading-4">1. 三种视口的区别</h3>
<h4 data-id="heading-5">1）布局视口（Layout Viewport）</h4>
<ul>
<li>浏览器默认的布局宽度</li>
<li>大多数移动端默认是 <strong>980px</strong></li>
<li>用来兼容早期 PC 页面</li>
</ul>
<p>这也是为什么 <strong>不加 viewport 标签时，页面会整体缩小</strong>。</p>
<hr/>
<h4 data-id="heading-6">2）视觉视口（Visual Viewport）</h4>
<ul>
<li>用户当前看到的区域</li>
<li>可以通过手指缩放改变</li>
<li>不影响布局视口</li>
</ul>
<hr/>
<h4 data-id="heading-7">3）理想视口（Ideal Viewport）</h4>
<ul>
<li>设备最理想的展示宽度</li>
<li>设备有多宽，布局就有多宽</li>
<li>移动端开发真正想要的视口</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. 标准 viewport 写法（必须掌握）</h3>
<pre><code class="hljs language-ini" lang="ini">&lt;meta 
  <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> 
  <span class="hljs-attr">content</span>=<span class="hljs-string">"
    width=device-width,
    initial-scale=1.0,
    maximum-scale=1.0,
    minimum-scale=1.0,
    user-scalable=no
  "</span>
&gt;
</code></pre>
<p>这段代码的作用是：</p>
<ul>
<li>布局视口等于设备宽度</li>
<li>默认不缩放</li>
<li>禁止用户手动缩放</li>
</ul>
<p>这是<strong>移动端页面的标配</strong>。</p>
<hr/>
<h2 data-id="heading-9">三、二倍图与像素比：为什么图片会模糊</h2>
<h3 data-id="heading-10">1. 物理像素 vs CSS 像素</h3>
<p>在 Retina 屏幕下：</p>
<ul>
<li>1 个 CSS 像素 ≠ 1 个物理像素</li>
<li>iPhone 常见的是 <strong>2 倍、3 倍像素比</strong></li>
</ul>
<p>例如：</p>
<ul>
<li>页面上显示 50×50</li>
<li>实际需要 100×100 或 150×150 的图片资源</li>
</ul>
<hr/>
<h3 data-id="heading-11">2. 二倍图的解决方案</h3>
<p>图片本身使用更大的尺寸，但在 CSS 中压缩显示。</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">img</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
  <span class="hljs-attribute">height</span>: <span class="hljs-number">50px</span>;
}
</code></pre>
<p>如果原图是 100×100，就能在 Retina 屏上保持清晰。</p>
<hr/>
<h3 data-id="heading-12">3. 背景图的处理方式</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.box</span> {
  <span class="hljs-attribute">background-image</span>: <span class="hljs-built_in">url</span>(<span class="hljs-string">bg@2x.png</span>);
  <span class="hljs-attribute">background-size</span>: <span class="hljs-number">50px</span> <span class="hljs-number">50px</span>;
}
</code></pre>
<p>关键点在于：</p>
<ul>
<li>图片是二倍图</li>
<li><code>background-size</code> 写成设计稿尺寸</li>
</ul>
<hr/>
<h2 data-id="heading-13">四、移动端开发方案选择</h2>
<h3 data-id="heading-14">1. 两种主流方案</h3>
<h4 data-id="heading-15">方案一：单独制作移动端页面（主流）</h4>
<ul>
<li>m.jd.com</li>
<li>m.taobao.com</li>
</ul>
<p>特点：</p>
<ul>
<li>专门为手机设计</li>
<li>性能和体验最好</li>
<li>维护成本较高</li>
</ul>
<hr/>
<h4 data-id="heading-16">方案二：响应式页面</h4>
<ul>
<li>同一套 HTML</li>
<li>通过媒体查询适配不同设备</li>
</ul>
<p>缺点很明显：</p>
<ul>
<li>样式复杂</li>
<li>维护成本高</li>
<li>移动端体验一般</li>
</ul>
<p><strong>实际项目中，大厂基本都选择第一种方案。</strong></p>
<hr/>
<h2 data-id="heading-17">五、移动端技术解决方案汇总</h2>
<h3 data-id="heading-18">1. CSS 初始化推荐 normalize.css</h3>
<p>相比 reset.css，normalize.css 的优点是：</p>
<ul>
<li>保留有价值的默认样式</li>
<li>修复浏览器差异</li>
<li>模块化、文档完善</li>
</ul>
<hr/>
<h3 data-id="heading-19">2. CSS3 盒子模型（移动端强烈推荐）</h3>
<pre><code class="hljs language-css" lang="css">* {
  <span class="hljs-attribute">box-sizing</span>: border-box;
}
</code></pre>
<p>优点：</p>
<ul>
<li>padding、border 不会撑大盒子</li>
<li>布局更直观</li>
<li>非常适合移动端</li>
</ul>
<hr/>
<h3 data-id="heading-20">3. 移动端常见特殊样式</h3>
<pre><code class="hljs language-css" lang="css">* {
  -webkit-tap-highlight-<span class="hljs-attribute">color</span>: transparent;
}

<span class="hljs-selector-tag">input</span>,
<span class="hljs-selector-tag">button</span> {
  -webkit-appearance: none;
}

<span class="hljs-selector-tag">img</span>,
<span class="hljs-selector-tag">a</span> {
  -webkit-touch-callout: none;
}
</code></pre>
<p>这些样式可以：</p>
<ul>
<li>去掉点击高亮</li>
<li>统一表单样式</li>
<li>禁止长按弹出菜单</li>
</ul>
<hr/>
<h2 data-id="heading-21">六、移动端常见布局方式</h2>
<h3 data-id="heading-22">1. 流式布局（百分比布局）</h3>
<p>流式布局的核心思想：</p>
<ul>
<li>宽度使用百分比</li>
<li>随屏幕变化自适应</li>
</ul>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-class">.container</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;
}

<span class="hljs-selector-class">.item</span> {
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50%</span>;
}
</code></pre>
<hr/>
<h3 data-id="heading-23">2. 限制最大最小宽度（常用技巧）</h3>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-tag">body</span> {
  <span class="hljs-attribute">min-width</span>: <span class="hljs-number">320px</span>;
  <span class="hljs-attribute">max-width</span>: <span class="hljs-number">640px</span>;
  <span class="hljs-attribute">margin</span>: <span class="hljs-number">0</span> auto;
}
</code></pre>
<p>好处是：</p>
<ul>
<li>防止页面过窄或过宽</li>
<li>常用于电商移动端页面</li>
</ul>
<h2 data-id="heading-24">七、总结</h2>
<p>通过这一阶段的学习，我对移动端 Web 开发有了几个明确的认知：</p>
<ul>
<li>视口是移动端布局的基础</li>
<li>二倍图是清晰显示的关键</li>
<li>流式布局是最常用的移动端布局方式</li>
<li>CSS3 盒模型极大降低了布局复杂度</li>
<li>移动端开发更注重体验和性能</li>
</ul>
<p>如果你正准备从 PC 端转向移动端，这些内容几乎是<strong>必经之路</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[代码 Review 的艺术：如何委婉地告诉同事你写的代码是一坨屎？]]></title>    <link>https://juejin.cn/post/7598563188113555508</link>    <guid>https://juejin.cn/post/7598563188113555508</guid>    <pubDate>2026-01-26T02:51:19.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598563188113555508" data-draft-id="7598563188113244212" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="代码 Review 的艺术：如何委婉地告诉同事你写的代码是一坨屎？"/> <meta itemprop="keywords" content="前端,JavaScript,面试"/> <meta itemprop="datePublished" content="2026-01-26T02:51:19.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="ErpanOmer"/> <meta itemprop="url" content="https://juejin.cn/user/3878732754331096"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            代码 Review 的艺术：如何委婉地告诉同事你写的代码是一坨屎？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3878732754331096/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    ErpanOmer
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:51:19.000Z" title="Mon Jan 26 2026 02:51:19 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读5分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f31cf1d8f7694552850b417aabbca749~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000679&amp;x-signature=uyDxD5sQkiJP0d%2BM7jFaL%2Bth5aI%3D" alt="1_HEyuDA6Y8gOkNaHMPoU_ew.png" loading="lazy"/></p>
<p>有一天下午四点，我点开了同事刚提的一个 PR, 先上代码👇：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-comment">// PR</span>

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handle</span>(<span class="hljs-params">list</span>) {
  <span class="hljs-keyword">const</span> list1 = []
  <span class="hljs-keyword">let</span> temp = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">const</span> a = <span class="hljs-number">1</span>

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; list.<span class="hljs-property">length</span>; i++) {
    <span class="hljs-keyword">if</span> (list[i]) {
      <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">status</span>) {
        <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">status</span> === <span class="hljs-string">'active'</span>) {
          <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">type</span>) {
            <span class="hljs-keyword">if</span> (list[i].<span class="hljs-property">type</span> === <span class="hljs-string">'user'</span>) {
              <span class="hljs-comment">// 在 for 里 await 查库</span>
              temp = <span class="hljs-keyword">await</span> db.<span class="hljs-title function_">query</span>(
                <span class="hljs-string">'SELECT * FROM users WHERE id = ?'</span>,
                [list[i].<span class="hljs-property">id</span>]
              )

              <span class="hljs-keyword">if</span> (temp &amp;&amp; temp.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {
                list1.<span class="hljs-title function_">push</span>(temp[<span class="hljs-number">0</span>])
              }
            } <span class="hljs-keyword">else</span> {
              <span class="hljs-keyword">if</span> (a === <span class="hljs-number">1</span>) {
                <span class="hljs-comment">// 什么都不干</span>
              }
            }
          }
        }
      }
    }
  }

  <span class="hljs-keyword">return</span> list1
}
</code></pre>
<p>第一眼，还行。<br/>
第二眼，嗯？<br/>
第三眼，我开始怀疑人生。</p>
<p>变量叫 <code>a</code>、<code>temp</code>、<code>list1</code>，<code>if-else</code> 套了六层，在 <code>for</code> 里 <code>await</code> 查库，像一锅没加盖的乱炖。</p>
<p>我当时脑子里只有一个念头：<br/>
<strong>这玩意要是上线了，今晚谁都别睡😡😡😡。</strong></p>
<p>但问题是——<br/>
你不能在评论区直接敲一句🤔：</p>
<blockquote>
<p>这段代码太烂了，建议重写。</p>
</blockquote>
<p>你可以这么想，但不能这么说。<br/>
因为你不是在写技术博客，你是在上班😖。</p>
<p>Code Review 本来是为了让项目更稳，结果很多时候，反而成了团队关系的坟头。</p>
<p>后来我慢慢意识到一件事：<br/>
你要做的，不是指出问题，而是——  <strong>让对方愿意帮你把问题改掉。</strong></p>
<hr/>
<h3 data-id="heading-0">先说个核心原则：别对人下手，先对代码下手</h3>
<p>CR 最容易翻车的点，就一个字：<strong>你</strong>。</p>
<p><strong>你这里写错了。你为什么不判空。你这逻辑不太行。</strong></p>
<p>只要你用了-<strong>你</strong>，对方心里的防御盾基本就举起来了😒。</p>
<p>更聪明的做法，是把对象换掉。</p>
<ul>
<li>换成我们</li>
<li>换成这段代码</li>
<li>换成如果这个场景</li>
<li>换成我们下次如何防范</li>
</ul>
<p>比如：</p>
<p><strong>我们这里可能要考虑一下空变量的情况。这段逻辑在并发高的时候，可能会有点风险，这个写法在数据量大的时候，性能可能撑不住的</strong></p>
<p>意思一点没变，但<strong>攻击性直接砍半</strong>。
敌人是 Bug，不是你的同事😃。</p>
<hr/>
<h3 data-id="heading-1">一些能救命的 CR 话术（真的可以试试）</h3>
<h4 data-id="heading-2">变量名随便起，看不懂</h4>
<p>你心里想的是：</p>
<blockquote>
<p>这 <code>list1</code> 到底是个啥？</p>
</blockquote>
<p>但你可以这么说：</p>
<blockquote>
<p>这个 <code>list1</code> 里装的主要是什么数据来着？<br/>
要不要换个更具体点的名字，比如 <code>activeUserList</code>？<br/>
这样后面维护的人（包括未来的我们）会省不少事。</p>
</blockquote>
<p>重点不在你命名不行，而是以后接受的人会感谢你的🤔。</p>
<hr/>
<h4 data-id="heading-3">if-else 套到你头皮发麻</h4>
<p>别说逻辑太乱了。</p>
<p>你可以说：</p>
<blockquote>
<p>这里我看了一下，逻辑稍微有点绕，我读了两遍才理顺。<br/>
要不要考虑用提前 return 的方式拆一下？<br/>
缩进少一点，后面看起来也轻松些。</p>
</blockquote>
<p>先承认是<strong>我读得有点费劲</strong>，<br/>
再给建议，<br/>
最后用商量的语气收尾。</p>
<p>对方台阶都有了，基本不会炸。</p>
<hr/>
<h4 data-id="heading-4">明显的性能隐患</h4>
<p>比如循环里查库、循环里调接口。</p>
<p>可以这样：</p>
<blockquote>
<p>这个写法在当前数据量下应该没啥问题。<br/>
我主要有点担心，如果后面数据上来，接口时间会不会被拉长。<br/>
要不这里改成批量查或者并发一下？稳一点。</p>
</blockquote>
<p>这句话的潜台词只有一个：  <strong>我是在给项目兜底🥱。</strong></p>
<hr/>
<h4 data-id="heading-5">完全看不懂他在干嘛？</h4>
<p>这时候千万别装懂。</p>
<p>你可以说：</p>
<blockquote>
<p>这块我好像没太跟上你的思路，<br/>
能不能简单说下这里为什么要这么处理？<br/>
或者加点注释也行，我怕下次有人接手会有点懵。</p>
</blockquote>
<p>很多时候，对方在解释的过程中，<br/>
<strong>自己就会发现问题。</strong></p>
<p>你甚至都不用再补刀的。</p>
<hr/>
<h3 data-id="heading-6">顺便说一句：别做格式检查！</h3>
<p>CR 不是让你盯着：</p>
<ul>
<li>少没少空格</li>
<li>单引号还是双引号</li>
<li>换行对不对</li>
<li>有没有写注释</li>
<li>有没有加 commit 标签</li>
</ul>
<p>你在 PR 里留 20 条这种评论，<br/>
对方只会想一件事：<br/>
<strong>这人是不是有点烦😥。</strong></p>
<p>格式这种事，交给工具就完了😖。</p>
<p>ESLint、Prettier、Husky，甚至是AI整理代码<br/>
能解决 80% 的低级争吵。</p>
<p>如果真的乱到影响阅读，可以一句话带过：</p>
<blockquote>
<p>这一块缩进好像有点乱，<br/>
跑一下 lint 自动修一下就行，<br/>
我们主要还是看下逻辑。</p>
</blockquote>
<p>点到为止😒。</p>
<hr/>
<h3 data-id="heading-7">真到必须重写的时候，别在评论区硬刚</h3>
<p>有些代码，确实已经到了不改不行的程度。<br/>
但就算这样，也别在 PR 评论区写小作文。</p>
<p>人多的地方，<strong>没人愿意认输。</strong></p>
<p>更好的方式是：</p>
<p><strong>私聊？语音？当面？</strong></p>
<p>开场也别太重：</p>
<blockquote>
<p>刚看了下那个 PR，有一块我有点担心，咱们对一下怎么样？</p>
</blockquote>
<p>把风险讲清楚，<br/>
把后果讲明白，<br/>
共识达成了，再让他自己改。</p>
<p><strong>给成年人留面子，成本真的很低的😁。</strong></p>
<hr/>
<h3 data-id="heading-8">说个实在的</h3>
<p>Code Review 从来都不是，谁技术更牛谁说了算的。你今天指出的问题，  很可能是为了防止哪天半夜两点，  把他从被窝里拽起来修 Bug。</p>
<p>这不是找茬，这是在剩你的时间。</p>
<p>所以以后 CR 的时候：</p>
<ul>
<li>少一点命令</li>
<li>多一点商量</li>
<li>少一点你怎么这样？</li>
<li>多一点我们是不是可以？</li>
</ul>
<p><strong>代码是冷的，但一起写代码的人，最好别凉😃。</strong></p>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/4c42393a3a5c4fb48f9e701fbcdfb185~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000679&amp;x-signature=anfU6PIaqsUpkEmlfqVc6ORDEBs%3D" alt="1_bh0C57IWRr6orsCDJXCFDA_abgbhi.webp" loading="lazy"/></p>
<blockquote>
<p>灵感来自于上面👆这本书，希望对大家有帮助😁。
也整理出来了一些想法，望大家喜欢 👉 <a href="https://link.juejin.cn?target=https%3A%2F%2Ferpanomer.nurverse.com%2Fblog%2Fwhy-did-i-start-spending-less-time-browsing-tech-communities" target="_blank" title="https://erpanomer.nurverse.com/blog/why-did-i-start-spending-less-time-browsing-tech-communities" ref="nofollow noopener noreferrer">为什么我开始减少逛技术社区，而是去读非技术的书？</a></p>
</blockquote>
<p><img src="https://p9-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/0e9709052ba042c1bb782d2287ad019a~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgRXJwYW5PbWVy:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000679&amp;x-signature=Q8acvYFa5YfVHRnZ9w0uAyhoi0Q%3D" alt="谢谢大家.gif" loading="lazy"/></p>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）]]></title>    <link>https://juejin.cn/post/7598767580307079222</link>    <guid>https://juejin.cn/post/7598767580307079222</guid>    <pubDate>2026-01-26T02:37:48.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598767580307079222" data-draft-id="7598767580307046454" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）"/> <meta itemprop="keywords" content="前端,JavaScript"/> <meta itemprop="datePublished" content="2026-01-26T02:37:48.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="普罗米修斯基"/> <meta itemprop="url" content="https://juejin.cn/user/2436983109989272"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/2436983109989272/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    普罗米修斯基
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:37:48.000Z" title="Mon Jan 26 2026 02:37:48 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">让写作更有“手感”：开源 Tiptap Writing Kit（支持 Vue / React）</h2>
<p>如果你在做内容创作平台、AI 写作工具或知识库编辑器，一定遇到过这个问题：功能很全，但“写起来不舒服”。<br/>
我最近把自己在项目里沉淀的写作体验能力抽出来，开源了 <strong>Tiptap Writing Kit</strong>，目标很明确：<strong>让写作更顺手、更像在真实写作</strong>。</p>
<p>这是一套基于 Tiptap 的增强组件，提供 <strong>排版控制、标尺辅助、打字音效/特效、查找替换、选中气泡菜单</strong> 等功能，并同时支持 <strong>Vue 3 / React</strong>。</p>
<hr/>
<h3 data-id="heading-1">效果预览</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6d673e188310400dacb607eb40a51e1b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5pmu572X57Gz5L-u5pav5Z-6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769999868&amp;x-signature=YCJPPpmRk161aCEkfjvo7hM78NI%3D" alt="CPT2601261032-1521x782.gif" loading="lazy"/></p>
<hr/>
<h3 data-id="heading-2">一句话亮点</h3>
<ul>
<li>面向写作场景：不是通用编辑器，而是“写作体验”增强</li>
<li>Vue / React 双端支持，核心能力共享</li>
<li>轻量：按需启用，体验增强不臃肿</li>
<li>可配置：字体、行高、内容宽度、段间距、标尺风格、快捷键、气泡菜单都能改</li>
</ul>
<hr/>
<h3 data-id="heading-3">在线 Demo</h3>
<ul>
<li>Vue Demo：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyilujian.github.io%2Ftiptap-writing-kit%2Fvue%2F" target="_blank" title="https://yilujian.github.io/tiptap-writing-kit/vue/" ref="nofollow noopener noreferrer">yilujian.github.io/tiptap-writ…</a></li>
<li>React Demo：<a href="https://link.juejin.cn?target=https%3A%2F%2Fyilujian.github.io%2Ftiptap-writing-kit%2Freact%2F" target="_blank" title="https://yilujian.github.io/tiptap-writing-kit/react/" ref="nofollow noopener noreferrer">yilujian.github.io/tiptap-writ…</a></li>
</ul>
<blockquote>
<p>建议在电脑端打开，有明显的“写作手感”变化。</p>
</blockquote>
<hr/>
<h3 data-id="heading-4">功能一览</h3>
<ul>
<li><strong>排版控制</strong>：字体/字号/行高/内容宽度/段间距</li>
<li><strong>标尺线</strong>：写作时的视觉节奏辅助</li>
<li><strong>打字音效 &amp; 特效</strong>：可选的轻量反馈（crisp / drop / typewriter、splash / ripple / mist / fire / cheer）</li>
<li><strong>查找/替换</strong>：内置面板 + 快捷键支持</li>
<li><strong>选中气泡菜单</strong>：支持自定义按钮、图标与样式</li>
<li><strong>快捷键配置</strong>：find / save 等可完全自定义</li>
</ul>
<hr/>
<h3 data-id="heading-5">快速上手</h3>
<h4 data-id="heading-6">React</h4>
<pre><code class="hljs language-bash" lang="bash">npm i tiptap-writing-kit-react
</code></pre>
<pre><code class="hljs language-tsx" lang="tsx"><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InkEditor</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'tiptap-writing-kit-react'</span>
<span class="hljs-keyword">import</span> <span class="hljs-string">'tiptap-writing-kit-react/style.css'</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">App</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">InkEditor</span> /&gt;</span></span>
}
</code></pre>
<h4 data-id="heading-7">Vue 3</h4>
<pre><code class="hljs language-bash" lang="bash">npm i tiptap-writing-kit-vue
</code></pre>
<pre><code class="hljs language-vue" lang="vue">&lt;script setup lang="ts"&gt;
import { InkEditor } from 'tiptap-writing-kit-vue'
import 'tiptap-writing-kit-vue/style.css'
&lt;/script&gt;

&lt;template&gt;
  &lt;InkEditor /&gt;
&lt;/template&gt;
</code></pre>
<hr/>
<h3 data-id="heading-8">自定义气泡菜单（示例）</h3>
<h4 data-id="heading-9">React</h4>
<pre><code class="hljs language-tsx" lang="tsx">&lt;<span class="hljs-title class_">InkEditor</span>
  bubbleMenuRender={<span class="hljs-function">(<span class="hljs-params">{ actions, labels, onAction, isActive }</span>) =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;&gt;</span>
      {actions.map((action) =&gt; (
        <span class="hljs-tag">&lt;<span class="hljs-name">button</span>
          <span class="hljs-attr">key</span>=<span class="hljs-string">{action}</span>
          <span class="hljs-attr">className</span>=<span class="hljs-string">{</span>`<span class="hljs-attr">twk-bubble-btn</span> ${<span class="hljs-attr">isActive</span>(<span class="hljs-attr">action</span>) ? '<span class="hljs-attr">is-active</span>' <span class="hljs-attr">:</span> ''}`}
          <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> onAction(action)}
        &gt;
          {labels[action]}
        <span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
      ))}
    <span class="hljs-tag">&lt;/&gt;</span></span>
  )}
/&gt;
</code></pre>
<h4 data-id="heading-10">Vue</h4>
<pre><code class="hljs language-vue" lang="vue">&lt;InkEditor&gt;
  &lt;template #bubble-menu="{ actions, labels, onAction, isActive }"&gt;
    &lt;button
      v-for="action in actions"
      :key="action"
      class="twk-bubble-btn"
      :class="{ 'is-active': isActive(action) }"
      @click="onAction(action)"
    &gt;
      {{ labels[action] }}
    &lt;/button&gt;
  &lt;/template&gt;
&lt;/InkEditor&gt;
</code></pre>
<hr/>
<h3 data-id="heading-11">为什么开源这个组件？</h3>
<p>我之前在实际项目中做过 AI 写作平台，发现在“写作体验”上差 1 步，用户就会跳出。<br/>
于是把这些体验增强能力抽象成组件，希望帮助更多内容类产品“更像在写作”。</p>
<hr/>
<h3 data-id="heading-12">适用场景</h3>
<ul>
<li>AI 写作 / 小说创作 / 长文编辑</li>
<li>内容管理后台的编辑器体验升级</li>
<li>知识库、文档编辑工具</li>
</ul>
<hr/>
<h3 data-id="heading-13">仓库地址</h3>
<ul>
<li>GitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyilujian%2Ftiptap-writing-kit" target="_blank" title="https://github.com/yilujian/tiptap-writing-kit" ref="nofollow noopener noreferrer">github.com/yilujian/ti…</a></li>
<li>npm：
<ul>
<li><code>tiptap-writing-kit-core</code></li>
<li><code>tiptap-writing-kit-react</code></li>
<li><code>tiptap-writing-kit-vue</code></li>
</ul>
</li>
</ul>
<hr/>
<h3 data-id="heading-14">路线图（Roadmap）</h3>
<ul>
<li>更丰富的气泡菜单组件与主题</li>
<li>编辑器内的轻量模板系统</li>
<li>可插拔的“写作状态”辅助（字数、段落节奏、节拍）</li>
</ul>
<hr/>
<h3 data-id="heading-15">最后</h3>
<p>如果你正在做内容产品，希望写作体验更“像笔尖在纸上”，欢迎试试。<br/>
如果你愿意给我一个 <strong>Star</strong> 或者反馈建议，对项目帮助非常大。</p>
<p>谢谢阅读，欢迎交流！</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[社区译文 | 区分 FUD 和现实：MySQL 真的被放弃了吗？]]></title>    <link>https://juejin.cn/post/7598734303175311412</link>    <guid>https://juejin.cn/post/7598734303175311412</guid>    <pubDate>2026-01-26T02:53:07.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303175311412" data-draft-id="7598563188113571892" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="社区译文 | 区分 FUD 和现实：MySQL 真的被放弃了吗？"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T02:53:07.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="爱可生开源社区"/> <meta itemprop="url" content="https://juejin.cn/user/1480387593251847"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            社区译文 | 区分 FUD 和现实：MySQL 真的被放弃了吗？
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1480387593251847/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    爱可生开源社区
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:53:07.000Z" title="Mon Jan 26 2026 02:53:07 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><blockquote>
<p>作者：Julia Vural，Percona 工程师。</p>
<p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.percona.com%2Fblog%2Fseparating-fud-and-reality-has-mysql-really-been-abandoned%2F%25EF%25BC%258CJan" target="_blank" title="https://www.percona.com/blog/separating-fud-and-reality-has-mysql-really-been-abandoned/%EF%BC%8CJan" ref="nofollow noopener noreferrer">www.percona.com/blog/separa…</a> 22, 2026</p>
<p>爱可生开源社区翻译，本文约 900 字，预计阅读需要 3 分钟。</p>
</blockquote>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/ff53315a722649c79b851272a3343d15~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000786&amp;x-signature=F3b693C%2BsQEclaXfmU7FWd1aEnI%3D" alt="640 (78).webp" loading="lazy"/></p>
<p>过去几周，MySQL 社区再次出现关于 <em>"Oracle 已停止开发 MySQL"</em> 或 <em>"MySQL 将被放弃"</em> 的说法，引发了更多讨论和担忧。一些图表显示，2025 年 10 月之后 GitHub 的提交数量似乎停止增长，而一些博客文章和论坛讨论也对这些迹象进行了字面解读，这进一步加剧了人们的担忧。</p>
<p>作为一名公开分析过 MySQL 代码库活动，并且每天都在 Percona 公司使用 MySQL 的人，我想清楚地区分数据实际显示的内容和数据未显示的内容。</p>
<p><strong>这篇文章并非对 Oracle 的盲目辩护。我们常常不同意 Oracle 的某些决定，并且会公开表达我们的观点。但公平至关重要------尤其是在恐惧、不确定性和怀疑（FUD）开始影响客户和更广泛的生态系统时。</strong></p>
<h2 data-id="heading-0">关于"停止对 MySQL 维护"的说法</h2>
<p>我们最近收到社区<a href="https://link.juejin.cn?target=https%3A%2F%2Fforums.percona.com%2Ft%2Fupstream-being-abandoned-will-percona-continue-to-maintain-mysql%2F40061" title="https://forums.percona.com/t/upstream-being-abandoned-will-percona-continue-to-maintain-mysql/40061" target="_blank" ref="nofollow noopener noreferrer">一个令人惊讶的问题</a>：MySQL 真的被放弃了吗？他们还附上了 <a href="https://link.juejin.cn?target=https%3A%2F%2Foptimizedbyotto.com%2Fpost%2Freasons-to-stop-using-mysql%2F" title="https://optimizedbyotto.com/post/reasons-to-stop-using-mysql/" target="_blank" ref="nofollow noopener noreferrer">Otto Kekäläinen 的帖子</a>中分享的图表。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/38ce4ab0c20045eab43493be98d90218~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000786&amp;x-signature=TjzRaiyv7pNbI3%2FaD70O3XzHaEI%3D" alt="640 (79).webp" loading="lazy"/>
这一结论通常是从 <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmysql%2Fmysql-server%2F" title="https://github.com/mysql/mysql-server/" target="_blank" ref="nofollow noopener noreferrer">GitHub 公共仓库</a> 的活动图表中得出的 ，该图表确实显示存在很长一段时间没有可见的提交。</p>
<p>图表本身没有错，但解读并不完整。</p>
<h2 data-id="heading-1">缺失的背景信息：MySQL 的实际开发过程</h2>
<p><strong>错误在于假设 MySQL 是在 GitHub 上开发的，但事实并非如此。</strong></p>
<p>多年来，Oracle 一直遵循一套特定的工作流程，即在私有的封闭代码库中进行实时工程开发。GitHub 仅作为公共镜像和发布平台，而非活跃的开发工作空间。因此，代码会以大型的、整合的"代码包"的形式发布，与官方版本同步，而不是以每日增量提交的形式出现。</p>
<p>换句话说：</p>
<p><strong>GitHub 是一个异步发布镜像，而不是开发记录系统。</strong></p>
<p>这意味着：</p>
<ul>
<li>
<p>GitHub 上缺乏增量提交并不意味着缺乏开发。</p>
</li>
<li>
<p>预计版本发布之间会有较长的平静期。</p>
</li>
<li>
<p>突然的大规模提交爆发是正常的发布机制。</p>
</li>
</ul>
<p>这种开发模式并不新鲜，它已经沿用多年。有人会说这不是 <em>"真正的开源开发模式"</em> 吗？也许会，但最终，在 2026 年 1 月 21 日（在最近发布的 9.6.0、8.4.8 和 8.0.45 版本之后）绘制的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmysql%2Fmysql-server%2Fgraphs%2Fcommit-activity" title="https://github.com/mysql/mysql-server/graphs/commit-activity" target="_blank" ref="nofollow noopener noreferrer">同一张图表</a> 看起来不再像是被弃用了。</p>
<p><img src="https://p6-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/bd344fa691a946d7b47920d2b4f7d907~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg54ix5Y-v55Sf5byA5rqQ56S-5Yy6:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000786&amp;x-signature=t%2FKLqQr2dzcrrpEvQvhrm%2BtoMrI%3D" alt="640 (55).png" loading="lazy"/></p>
<p>MySQL 的"弃用"案例完美地提醒我们，<strong>指标的价值取决于我们对所衡量系统的理解。</strong></p>
<p>GitHub 图表上的停滞不前并不总是意味着项目正在走向衰亡；很多时候，它只是引擎在紧闭的大门后静默运转的体现。虽然我们可以讨论 Oracle 开发模式的透明度，但我们不应该将不同的工作流程误解为缺乏工作。<strong>事实并非总是如表面所见，以貌取人或以镜像来判断数据库都是错误的。</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[详解Metadata 和 Reflector]]></title>    <link>https://juejin.cn/post/7599268297202941990</link>    <guid>https://juejin.cn/post/7599268297202941990</guid>    <pubDate>2026-01-26T02:51:06.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599268297202941990" data-draft-id="7598181989968379931" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="详解Metadata 和 Reflector"/> <meta itemprop="keywords" content="前端,Node.js,NestJS"/> <meta itemprop="datePublished" content="2026-01-26T02:51:06.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="前端付豪"/> <meta itemprop="url" content="https://juejin.cn/user/1741228277763278"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            详解Metadata 和 Reflector
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1741228277763278/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    前端付豪
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:51:06.000Z" title="Mon Jan 26 2026 02:51:06 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读2分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>装饰器声明后，启动 Nest 应用，对象会创建好，依赖也给注入了，为啥 ？</p>
<p>先看 Reflect 的 metadata</p>
<p>Reflect.get 是获取对象属性值</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/562071b365744875b19b93514cbe30ae~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=JV7WeA7VQI2ihOjslei89%2BF6hY4%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.set 是设置对象属性值
<img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e0e6e5fa37d74b2e8b8f5f0754a83f99~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=w85RhuQScK5EXRs4pJmovJQ2FPw%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.has 是判断对象属性是否存在</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/f56d40e3e2b44d958c149552c8440747~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=wuq%2BKkgl%2BKVtPKrkPwE%2BVPY9zwA%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.apply 是调用某个方法，传入对象和参数</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6f59e86c78fd45968d84c6b5263b1b74~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=NHxRwvMXrs3Y77HTb2SQj%2FkDEt8%3D" alt="image.png" loading="lazy"/></p>
<p>Reflect.construct 是用构造器创建对象实例，传入构造器参数</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/6deae394d30640fdbd0a5f61990babbb~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5YmN56uv5LuY6LGq:q75.awebp?rk3s=f64ab15b&amp;x-expires=1770000666&amp;x-signature=1KUvQTr9zWNr%2BOEhe88UYj7EI7U%3D" alt="image.png" loading="lazy"/></p>
<p>Nest 用到的 api</p>
<pre><code class="hljs language-ini" lang="ini">Reflect.defineMetadata(metadataKey, metadataValue, target)<span class="hljs-comment">;</span>

Reflect.defineMetadata(metadataKey, metadataValue, target, propertyKey)<span class="hljs-comment">;</span>


let <span class="hljs-attr">result</span> = Reflect.getMetadata(metadataKey, target)<span class="hljs-comment">;</span>

let <span class="hljs-attr">result</span> = Reflect.getMetadata(metadataKey, target, propertyKey)<span class="hljs-comment">;</span>
</code></pre>
<p>Reflect.defineMetadata 和 Reflect.getMetadata 分别用于设置和获取某个类的元数据，如果最后传入了属性名，还可以单独为某个属性设置元数据</p>
<p>那元数据存在哪？</p>
<p>存在类或者对象上，如果给类或者类的静态属性添加元数据，那就保存在类上</p>
<p>如果给实例属性添加元数据，那就保存在对象上，用类似 [[metadata]] 的 key 来存</p>
<p>支持装饰器的方式使用：</p>
<pre><code class="hljs language-less" lang="less"><span class="hljs-variable">@Reflect</span>.<span class="hljs-built_in">metadata</span>(metadataKey, metadataValue)
class C {

  <span class="hljs-variable">@Reflect</span>.<span class="hljs-built_in">metadata</span>(metadataKey, metadataValue)
  <span class="hljs-built_in">method</span>() {
  }
}
</code></pre>
<p>基础封装</p>
<pre><code class="hljs language-typescript" lang="typescript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Meta</span>(<span class="hljs-params">metadataKey: <span class="hljs-built_in">string</span>, metadataValue: <span class="hljs-built_in">any</span></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">metadata</span>(metadataKey, metadataValue)
}
</code></pre>
<p>实际例子</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">Validate</span>(<span class="hljs-params"/>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span> (<span class="hljs-params">target, propertyKey, descriptor</span>) {
    <span class="hljs-keyword">const</span> types = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(
      <span class="hljs-string">'design:paramtypes'</span>,
      target,
      propertyKey
    )

    <span class="hljs-keyword">const</span> original = descriptor.<span class="hljs-property">value</span>

    descriptor.<span class="hljs-property">value</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">...args</span>) {
      args.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">arg, index</span>) =&gt;</span> {
        <span class="hljs-keyword">const</span> <span class="hljs-title class_">Type</span> = types[index]
        <span class="hljs-keyword">if</span> (!(arg <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Type</span>) &amp;&amp; <span class="hljs-keyword">typeof</span> arg !== <span class="hljs-title class_">Type</span>.<span class="hljs-property">name</span>.<span class="hljs-title function_">toLowerCase</span>()) {
          <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(
            <span class="hljs-string">`参数 <span class="hljs-subst">${index}</span> 类型错误，期望 <span class="hljs-subst">${Type.name}</span>`</span>
          )
        }
      })
      <span class="hljs-keyword">return</span> original.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args)
    }
  }
}

</code></pre>
<p>使用</p>
<pre><code class="hljs language-scss" lang="scss">class MathService {

  <span class="hljs-keyword">@Validate</span>()
  add(<span class="hljs-attribute">a</span>: number, <span class="hljs-attribute">b</span>: number) {
    return <span class="hljs-selector-tag">a</span> + <span class="hljs-selector-tag">b</span>
  }
}

new <span class="hljs-built_in">MathService</span>()<span class="hljs-selector-class">.add</span>(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)     <span class="hljs-comment">// ✅</span>
new <span class="hljs-built_in">MathService</span>()<span class="hljs-selector-class">.add</span>('<span class="hljs-number">1</span>', <span class="hljs-number">2</span>)   <span class="hljs-comment">// ❌</span>

</code></pre>
<p>Nest 的实现原理就是通过装饰器给 class 或者对象添加元数据，然后初始化的时候取出这些元数据，进行依赖的分析，然后创建对应的实例对象就可以了。</p>
<p>所以说，nest 实现的核心就是 Reflect metadata 的 api</p>
<h3 data-id="heading-0">安装依赖 &amp; 打开配置</h3>
<pre><code class="hljs language-css" lang="css">npm <span class="hljs-selector-tag">i</span> reflect-metadata
</code></pre>
<p><code>tsconfig.json</code></p>
<pre><code class="hljs language-json" lang="json"><span class="hljs-punctuation">{</span>
  <span class="hljs-attr">"compilerOptions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span>
    <span class="hljs-attr">"experimentalDecorators"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span>
    <span class="hljs-attr">"emitDecoratorMetadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span>
  <span class="hljs-punctuation">}</span>
<span class="hljs-punctuation">}</span>
</code></pre>
<p>入口文件最顶部：</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-keyword">import</span> <span class="hljs-string">'reflect-metadata'</span>
</code></pre>
<h3 data-id="heading-1">自己写一个装饰器</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">MyController</span>(<span class="hljs-params">path: string</span>): <span class="hljs-title class_">ClassDecorator</span> {
  <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">target</span>) =&gt;</span> {
    <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-string">'path'</span>, path, target)
  }
}
</code></pre>
<p><strong>这一行是核心：</strong></p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(key, value, target)
</code></pre>
<blockquote>
<p>👆 把 <code>path</code> 这个信息，挂到 class 上</p>
</blockquote>
<h3 data-id="heading-2">使用这个装饰器</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@MyController(<span class="hljs-string">'/user'</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {}
</code></pre>
<hr/>
<h3 data-id="heading-3">运行时把元数据读出来</h3>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-keyword">const</span> path = <span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(<span class="hljs-string">'path'</span>, <span class="hljs-title class_">UserController</span>)
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(path) <span class="hljs-comment">// /user</span>
</code></pre>
<p>🔑 <strong>到这里你已经实现了 Nest 的第一步</strong></p>
<h2 data-id="heading-4">Nest 的 Controller / Injectable 本质</h2>
<h3 data-id="heading-5">Controller 装饰器 ≈</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Controller(<span class="hljs-string">'/user'</span>)</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {}
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-string">'path'</span>, <span class="hljs-string">'/user'</span>, <span class="hljs-title class_">UserController</span>)
</code></pre>
<hr/>
<h3 data-id="heading-6">Injectable 装饰器 ≈</h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {}
</code></pre>
<p>等价于：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">defineMetadata</span>(<span class="hljs-string">'injectable'</span>, <span class="hljs-literal">true</span>, <span class="hljs-title class_">UserService</span>)
</code></pre>
<hr/>
<h2 data-id="heading-7">依赖注入是怎么“自动知道”的？</h2>
<h3 data-id="heading-8">关键：<strong>构造函数参数的类型元数据</strong></h3>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {}
</code></pre>

<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> userService: UserService) {}
}
</code></pre>
<h3 data-id="heading-9">TypeScript 在背后偷偷干了什么？</h3>
<p>开启 <code>emitDecoratorMetadata</code> 后：</p>
<pre><code class="hljs language-javascript" lang="javascript"><span class="hljs-title class_">Reflect</span>.<span class="hljs-title function_">getMetadata</span>(<span class="hljs-string">'design:paramtypes'</span>, <span class="hljs-title class_">UserController</span>)
</code></pre>
<p>得到：</p>
<pre><code class="hljs language-css" lang="css"><span class="hljs-selector-attr">[ UserService ]</span>
</code></pre>
<p>💥 <strong>这一步是 Nest DI 的灵魂</strong></p>
<hr/>
<pre><code class="hljs language-kotlin" lang="kotlin"><span class="hljs-keyword">import</span> <span class="hljs-string">'reflect-metadata'</span>

<span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserService</span> {}

<span class="hljs-meta">@Injectable()</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> {
  <span class="hljs-keyword">constructor</span>(<span class="hljs-keyword">private</span> userService: UserService) {}
}

<span class="hljs-keyword">const</span> deps = Reflect.getMetadata(
  <span class="hljs-string">'design:paramtypes'</span>,
  UserController
)

console.log(deps)
<span class="hljs-comment">// [ [class UserService] ]</span>
</code></pre>
<hr/>
<h2 data-id="heading-10">Nest 初始化时到底在干嘛？</h2>
<p>可以理解成这几步👇</p>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-function">function <span class="hljs-title">bootstrap</span>()</span> {
  <span class="hljs-comment">// 1. 扫描所有 class</span>
  <span class="hljs-comment">// 2. 找 @Controller / @Injectable</span>
  <span class="hljs-comment">// 3. 读取元数据</span>
  <span class="hljs-comment">// 4. 分析依赖</span>
  <span class="hljs-comment">// 5. new 实例</span>
}
</code></pre>
<hr/>
<h3 data-id="heading-11">极简 DI 容器</h3>
<pre><code class="hljs language-csharp" lang="csharp"><span class="hljs-keyword">const</span> container = <span class="hljs-keyword">new</span> Map()

<span class="hljs-function">function <span class="hljs-title">createInstance</span>(<span class="hljs-params">target</span>)</span> {
  <span class="hljs-keyword">const</span> deps =
    Reflect.getMetadata(<span class="hljs-string">'design:paramtypes'</span>, target) || []

  <span class="hljs-keyword">const</span> <span class="hljs-keyword">params</span> = deps.map(dep =&gt; {
    <span class="hljs-keyword">if</span> (!container.has(dep)) {
      container.<span class="hljs-keyword">set</span>(dep, createInstance(dep))
    }
    <span class="hljs-keyword">return</span> container.<span class="hljs-keyword">get</span>(dep)
  })

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> target(...<span class="hljs-keyword">params</span>)
}
</code></pre>
<p>使用：</p>
<pre><code class="hljs language-ini" lang="ini">const <span class="hljs-attr">controller</span> = createInstance(UserController)
</code></pre>
<p>👉 <strong>这就是 Nest DI 的雏形</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[BFC (Block Formatting Context) 详解]]></title>    <link>https://juejin.cn/post/7598734303175344180</link>    <guid>https://juejin.cn/post/7598734303175344180</guid>    <pubDate>2026-01-26T02:54:15.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303175344180" data-draft-id="7598734303175082036" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="BFC (Block Formatting Context) 详解"/> <meta itemprop="keywords" content="前端"/> <meta itemprop="datePublished" content="2026-01-26T02:54:15.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="娜妹子辣"/> <meta itemprop="url" content="https://juejin.cn/user/3421335918747976"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            BFC (Block Formatting Context) 详解
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3421335918747976/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    娜妹子辣
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:54:15.000Z" title="Mon Jan 26 2026 02:54:15 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    8
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读3分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p><strong>BFC（Block Formatting Context，块级格式化上下文）</strong>  是 CSS 渲染中的一个核心概念，它决定了<strong>块级元素如何布局、如何与兄弟/子元素交互</strong>。<strong>理解 BFC 能解决很多经典布局问题（如浮动塌陷、外边距重叠等）。</strong></p>
<h2 data-id="heading-0">🧠 一、什么是 BFC？</h2>
<blockquote>
<p><strong>BFC 是 Web 页面中一个独立的渲染区域</strong>，内部的块级元素按照特定规则布局，<strong>且不会与外部元素相互影响</strong>。</p>
</blockquote>
<p>你可以把它想象成一个“<strong>隔离的盒子</strong>”：</p>
<ul>
<li>盒子内部的元素按规则排列</li>
<li>盒子外部的元素不会干扰内部</li>
<li>盒子也不会被外部元素干扰</li>
</ul>
<h2 data-id="heading-1">二、BFC 的触发条件（如何创建 BFC？）</h2>













































































<table><thead><tr><th>触发方式</th><th>是否常用</th><th>副作用</th><th>兼容性</th><th>推荐度</th><th>适用场景</th></tr></thead><tbody><tr><td><code>display: flow-root</code></td><td>✅ 现代首选</td><td>❌ 无</td><td>Chrome 58+ / FF 53+ / Safari 10.1+</td><td>⭐⭐⭐⭐⭐</td><td><strong>通用场景（现代浏览器）</strong></td></tr><tr><td><code>overflow: hidden/auto/scroll</code></td><td>✅ 广泛使用</td><td>⚠️ 可能裁剪内容</td><td>✅ 全浏览器</td><td>⭐⭐⭐⭐</td><td>需要兼容旧浏览器时</td></tr><tr><td><code>float: left/right</code></td><td>⚠️ 逐渐淘汰</td><td>⚠️ 脱离文档流</td><td>✅ 全浏览器</td><td>⭐⭐</td><td>传统浮动布局（不推荐新项目）</td></tr><tr><td><code>position: absolute/fixed</code></td><td>⚠️ 特定场景</td><td>⚠️ 脱离文档流</td><td>✅ 全浏览器</td><td>⭐⭐</td><td>定位元素（非布局目的）</td></tr><tr><td><code>display: inline-block</code></td><td>⚠️ 有局限</td><td>⚠️ 行内块特性（间隙、基线对齐）</td><td>✅ 全浏览器</td><td>⭐⭐</td><td>行内布局（非块级容器）</td></tr><tr><td><code>display: table-cell</code></td><td>⚠️ 少用</td><td>⚠️ 表格布局行为</td><td>✅ 全浏览器</td><td>⭐</td><td>模拟表格（不推荐）</td></tr><tr><td><code>display: flex/grid</code></td><td>✅ 现代布局</td><td>⚠️ 改变子元素布局模型</td><td>✅ 现代浏览器</td><td>⭐⭐⭐</td><td><strong>本身是布局容器时</strong></td></tr><tr><td><code>contain: layout/style/paint</code></td><td>⚠️ 新特性</td><td>⚠️ 性能隔离（可能影响渲染）</td><td>Chrome 52+ / FF 69+</td><td>⭐⭐</td><td>性能优化场景</td></tr></tbody></table>
<h2 data-id="heading-2">三、BFC 的核心作用（解决什么问题？）</h2>
<h3 data-id="heading-3">场景一：父容器包含浮动子元素（<strong>解决父容器高度塌陷</strong>）</h3>
<pre><code class="hljs language-ini" lang="ini">html
运行html
&lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"parent"</span>&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span> style=<span class="hljs-string">"float: left"</span>&gt;Child <span class="hljs-number">1</span>&lt;/div&gt;
  &lt;div <span class="hljs-attr">class</span>=<span class="hljs-string">"child"</span> style=<span class="hljs-string">"float: left"</span>&gt;Child <span class="hljs-number">2</span>&lt;/div&gt;
&lt;/div&gt;
</code></pre>



































<table><thead><tr><th>方案</th><th>代码</th><th>优点</th><th>缺点</th></tr></thead><tbody><tr><td><strong><code>flow-root</code></strong></td><td><code>.parent { display: flow-root; }</code></td><td>无副作用、语义清晰</td><td>不支持 IE</td></tr><tr><td><strong><code>overflow: hidden</code></strong></td><td><code>.parent { overflow: hidden; }</code></td><td>全兼容</td><td>可能裁剪阴影</td></tr><tr><td><strong><code>::after</code> clearfix</strong></td><td><code>.parent::after { content:""; display:table; clear:both }</code></td><td>全兼容、无裁剪</td><td>代码冗余</td></tr><tr><td><strong><code>flex</code></strong></td><td><code>.parent { display: flex; }</code></td><td>现代、自动 BFC</td><td>改变子元素布局</td></tr></tbody></table>
<blockquote>
</blockquote>
<h3 data-id="heading-4">场景二：解决Margin折叠</h3>
<pre><code class="hljs language-js" lang="js">&lt;div <span class="hljs-keyword">class</span>=<span class="hljs-string">"box1"</span>&gt;<span class="hljs-title class_">Box</span> <span class="hljs-number">1</span>&lt;/div&gt; 
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"box2"</span>&gt;</span>Box 2<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>





























































<table><thead><tr><th>方案</th><th>CSS 代码</th><th>是否生效</th><th>副作用</th><th>推荐度</th></tr></thead><tbody><tr><td><strong>无处理</strong></td><td>—</td><td>❌ 折叠（间距=30px）</td><td>—</td><td>⭐</td></tr><tr><td><strong><code>flow-root</code></strong></td><td><code>.box2 { display: flow-root; }</code></td><td>✅ 间距=50px</td><td>❌ 无</td><td>⭐⭐⭐⭐⭐</td></tr><tr><td><strong><code>overflow: hidden</code></strong></td><td><code>.box2 { overflow: hidden; }</code></td><td>✅ 间距=50px</td><td>⚠️ 可能裁剪内容</td><td>⭐⭐⭐</td></tr><tr><td><strong><code>float: left</code></strong></td><td><code>.box2 { float: left; width: 100%; }</code></td><td>✅ 间距=50px</td><td>⚠️ 脱离文档流</td><td>⭐</td></tr><tr><td><strong><code>position: absolute</code></strong></td><td><code>.box2 { position: absolute; }</code></td><td>✅ 但布局错乱</td><td>⚠️ 完全脱离流</td><td>⭐</td></tr><tr><td><strong><code>inline-block</code></strong></td><td><code>.box2 { display: inline-block; width: 100%; }</code></td><td>✅ 间距=50px</td><td>⚠️ 行内块间隙/对齐问题</td><td>⭐⭐</td></tr><tr><td><strong><code>flex</code> 容器</strong></td><td>给父容器加 <code>display: flex; flex-direction: column;</code></td><td>✅ 间距=50px</td><td>⚠️ 改变子元素布局模型</td><td>⭐⭐⭐</td></tr></tbody></table>
<h3 data-id="heading-5">场景3：自适应两栏布局</h3>
<pre><code class="hljs language-js" lang="js">&lt;!-- 两栏布局：左侧固定，右侧自适应 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"layout"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"sidebar"</span>&gt;</span>侧边栏<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"content"</span>&gt;</span>主内容区域<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js"><span class="hljs-comment">/* 传统方法的问题 */</span>
.<span class="hljs-property">sidebar</span> {
  <span class="hljs-attr">float</span>: left;
  <span class="hljs-attr">width</span>: 200px;
  <span class="hljs-attr">background</span>: #ff6b6b;
  <span class="hljs-attr">height</span>: 300px;
}

.<span class="hljs-property">content</span> {
  <span class="hljs-comment">/* 问题：内容会被浮动元素覆盖 */</span>
  <span class="hljs-attr">background</span>: #4ecdc4;
  <span class="hljs-attr">height</span>: 300px;
}

<span class="hljs-comment">/* BFC解决方案 */</span>
.<span class="hljs-property">content</span>-bfc {
  <span class="hljs-attr">overflow</span>: hidden; <span class="hljs-comment">/* 创建BFC，避开浮动元素 */</span>
  <span class="hljs-attr">background</span>: #4ecdc4;
  <span class="hljs-attr">height</span>: 300px;
  <span class="hljs-comment">/* BFC区域不会与float box重叠 */</span>
}
</code></pre>
<h3 data-id="heading-6">场景4：防止元素被浮动元素覆盖</h3>
<pre><code class="hljs language-js" lang="js">&lt;!-- 文字环绕问题 --&gt;
<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"float-box"</span>&gt;</span>浮动盒子<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"text-content"</span>&gt;</span>
    这是一段很长的文字内容，在没有BFC的情况下，
    文字会环绕浮动元素。但有时我们希望文字内容
    独立成块，不被浮动元素影响。
  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
</code></pre>
<pre><code class="hljs language-js" lang="js">.<span class="hljs-property">float</span>-box {
  <span class="hljs-attr">float</span>: left;
  <span class="hljs-attr">width</span>: 100px;
  <span class="hljs-attr">height</span>: 100px;
  <span class="hljs-attr">background</span>: #ff6b6b;
  margin-<span class="hljs-attr">right</span>: 10px;
}

<span class="hljs-comment">/* 问题：文字环绕浮动元素 */</span>
.<span class="hljs-property">text</span>-content {
  <span class="hljs-attr">background</span>: #f0f0f0;
  <span class="hljs-attr">padding</span>: 10px;
}

<span class="hljs-comment">/* 解决方案：创建BFC */</span>
.<span class="hljs-property">text</span>-content-bfc {
  <span class="hljs-attr">background</span>: #f0f0f0;
  <span class="hljs-attr">padding</span>: 10px;
  <span class="hljs-attr">overflow</span>: hidden; <span class="hljs-comment">/* 创建BFC，不与浮动元素重叠 */</span>
}
</code></pre>
<h2 data-id="heading-7">四、BFC vs IFC vs FFC</h2>
<p>全屏复制</p>



































<table><thead><tr><th>上下文</th><th>全称</th><th>触发条件</th><th>用途</th></tr></thead><tbody><tr><td><strong>BFC</strong></td><td>Block Formatting Context</td><td><code>overflow: hidden</code>, <code>display: flow-root</code> 等</td><td>块级布局、解决浮动塌陷</td></tr><tr><td><strong>IFC</strong></td><td>Inline Formatting Context</td><td>行内元素、<code>display: inline</code></td><td>文本、行内元素布局</td></tr><tr><td><strong>FFC</strong></td><td>Flex Formatting Context</td><td><code>display: flex</code></td><td>弹性布局</td></tr><tr><td><strong>GFC</strong></td><td>Grid Formatting Context</td><td><code>display: grid</code></td><td>网格布局</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Docker搭建Mysql8的主从复制]]></title>    <link>https://juejin.cn/post/7599094262593077258</link>    <guid>https://juejin.cn/post/7599094262593077258</guid>    <pubDate>2026-01-26T02:54:17.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262593077258" data-draft-id="7599268297202925606" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Docker搭建Mysql8的主从复制"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-26T02:54:17.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="优秀的颜"/> <meta itemprop="url" content="https://juejin.cn/user/960313319521178"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Docker搭建Mysql8的主从复制
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/960313319521178/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    优秀的颜
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T02:54:17.000Z" title="Mon Jan 26 2026 02:54:17 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读7分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">Docker搭建Mysql8的主从复制</h2>
<p>通过Docker部署Mysql主从复制，Docker安装在前篇有，直接演示：</p>
<h3 data-id="heading-1">拉取镜像</h3>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 获取有哪些镜像</span>
<span class="hljs-string">docker</span> <span class="hljs-string">search</span> <span class="hljs-string">mysql</span>

<span class="hljs-comment"># 拉取MySQL镜像</span>
<span class="hljs-string">docker</span> <span class="hljs-string">pull</span> <span class="hljs-string">mysql:8.0.32</span>

<span class="hljs-comment"># 查看镜像</span>
<span class="hljs-string">docker</span> <span class="hljs-string">images</span>
</code></pre>
<h3 data-id="heading-2">主节点的配置</h3>
<p>创建数据存储目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/master/data</span>
</code></pre>
<p>创建日志目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/master/logs</span>
</code></pre>
<p>创建配置文件目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/master/conf</span>
</code></pre>
<p>进行快速启动 - 查看镜像是否有问题
注：不同的版本的配置文件位置不同，可通过快速创建，查看mysql的对应的配置文件位置，进行对应映射。</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 快速启动  -d是进行守护进程启动</span>
<span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">-p</span> <span class="hljs-number">3306</span><span class="hljs-string">:3306</span> <span class="hljs-string">--name</span> <span class="hljs-string">mysql8</span> <span class="hljs-string">-e</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=123456</span> <span class="hljs-string">-d</span> <span class="hljs-string">mysql:8.0.32</span>
 
<span class="hljs-comment"># 启动成功后，进入容器内部拷贝配置文件，到宿主主机</span>
<span class="hljs-string">docker</span> <span class="hljs-string">cp</span>  <span class="hljs-string">mysql8:/etc/mysql</span> <span class="hljs-string">/docker/mysql/master/conf</span>
 
<span class="hljs-comment"># 删除刚才的容器，重新创建容器</span>
<span class="hljs-string">docker</span> <span class="hljs-string">stop</span> <span class="hljs-string">mysql8</span>
<span class="hljs-string">docker</span> <span class="hljs-string">rm</span> <span class="hljs-string">mysql8</span>
</code></pre>
<p>运行容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">-p</span> <span class="hljs-number">3340</span><span class="hljs-string">:3306</span> <span class="hljs-string">--name</span> <span class="hljs-string">mysql_master</span> <span class="hljs-string">--privileged=true</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/master/conf:/etc/mysql/conf.d</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/master/logs:/var/log/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/master/data:/var/lib/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span> <span class="hljs-string">\</span>
<span class="hljs-string">-e</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=123456</span> <span class="hljs-string">-d</span> <span class="hljs-string">mysql:8.0.32</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">collation_connection=utf8mb4_0900_ai_ci"</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4"</span> <span class="hljs-string">--skip-character-set-client-handshake</span> 
</code></pre>
<p>进入容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">ps</span> <span class="hljs-string">-a</span>
<span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">-it</span> <span class="hljs-string">mysql_master</span> <span class="hljs-string">/bin/bash</span>
<span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">-it</span> <span class="hljs-string">mysql_master</span> <span class="hljs-string">env</span> <span class="hljs-string">LANG=C.UTF-8</span> <span class="hljs-string">/bin/bash</span> <span class="hljs-comment"># 进入容器，这种进入避免显示中午乱码</span>

<span class="hljs-comment"># 打开MySQL，输入密码</span>
<span class="hljs-string">mysql</span> <span class="hljs-string">-uroot</span> <span class="hljs-string">-p</span>
<span class="hljs-comment"># 查看数据库</span>
<span class="hljs-string">show</span> <span class="hljs-string">databases;</span>
<span class="hljs-comment"># 创建数据库</span>
<span class="hljs-string">create</span> <span class="hljs-string">database</span> <span class="hljs-string">数据库;</span>

<span class="hljs-comment"># 如果远程链接失败，可以修改默认密码校验方式（第三方工具可以连接上）</span>
<span class="hljs-string">ALTER</span> <span class="hljs-string">USER</span> <span class="hljs-string">'root'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">IDENTIFIED</span>  <span class="hljs-string">WITH</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">BY</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
</code></pre>
<p>配置远程连接（对外连接的）</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 在MySQL下执行</span>
<span class="hljs-string">use</span> <span class="hljs-string">mysql;</span>
<span class="hljs-comment"># 创建对外访问的用户和权限</span>
<span class="hljs-string">CREATE</span> <span class="hljs-string">USER</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">IDENTIFIED</span> <span class="hljs-string">WITH</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">BY</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
<span class="hljs-comment"># 授权全部的权限（范围大）</span>
<span class="hljs-comment"># GRANT ALL ON *.* TO '用户名'@'%' WITH GRANT OPTION;</span>
<span class="hljs-comment"># 刷新权限</span>
<span class="hljs-string">FLUSH</span> <span class="hljs-string">PRIVILEGES;</span>

<span class="hljs-comment"># 退出</span>
<span class="hljs-string">exit</span>
</code></pre>
<p>创建自定义的配置文件（主服务器配置文件）</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">cd</span> <span class="hljs-string">/docker/mysql/master/conf</span>
<span class="hljs-string">touch</span> <span class="hljs-string">my.cnf</span>
</code></pre>
<p>my.cnf文件内容：</p>
<pre><code class="hljs language-yml" lang="yml">[<span class="hljs-string">client</span>]
<span class="hljs-comment"># mysql客户端默认字符集</span>
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysql</span>]
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysqld</span>]
<span class="hljs-comment"># 跳过密码登录</span>
<span class="hljs-comment">#skip-grant-tables</span>
<span class="hljs-comment">#bind-address = 127.0.0.1</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">collation_connection</span> <span class="hljs-string">=</span> <span class="hljs-string">utf8mb4_general_ci'</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4'</span>
<span class="hljs-comment"># mysql服务端默认字符集</span>
<span class="hljs-string">character-set-server=utf8mb4</span>
<span class="hljs-string">collation-server=utf8mb4_general_ci</span>
<span class="hljs-string">skip-character-set-client-handshake</span>
<span class="hljs-comment"># datadir=/var/lib/mysql  </span>

<span class="hljs-comment"># 主服务器唯一ID 默认是1</span>
<span class="hljs-string">server-id=1</span>
<span class="hljs-comment"># 设置不要复制的数据库</span>
<span class="hljs-string">binlog-ignore-db=mysql</span>
<span class="hljs-string">binlog-ignore-db=information_schema</span>
<span class="hljs-string">binlog-ignore-db=performance_schema</span>
<span class="hljs-comment"># 设置需要复制的数据库（先创建好）</span>
<span class="hljs-string">binlog-do-db=数据库名</span>
<span class="hljs-comment"># 启用二进制日志，日志的存放地址(默认是binlog)，就是在show master status;看到Filed名字</span>
<span class="hljs-string">log-bin=/var/lib/mysql/mysql-bin</span>
<span class="hljs-comment"># 主机，1 只读 0 读写（默认是0）</span>
<span class="hljs-string">read-only=0</span>
<span class="hljs-comment"># 设置logbin格式 有3种格式 </span>
<span class="hljs-comment"># STATEMENT(函数支持不好) 写指令，会出现主从数据不同步，now（）函数</span>
<span class="hljs-comment"># ROW(行模式大量修改效率不行，但支持存储引擎) - 默认的</span>
<span class="hljs-comment"># MIXED (综合，推荐)</span>
<span class="hljs-string">binlog_format=mixed</span>
<span class="hljs-comment">## 跳过主从复制中遇到的所有错误或指定类型的错误，避免slave端复制中断。</span>
<span class="hljs-comment">## 如：1062错误是指一些主键重复，1032错误是因为主从数据库数据不一致</span>
<span class="hljs-string">slave_skip_errors=1062</span>
<span class="hljs-comment"># 二进制日志过期清理时间，默认是0（不自动清理）</span>
<span class="hljs-string">expire_logs_days=7</span>
<span class="hljs-comment"># 单个二进制日志大小</span>
<span class="hljs-string">max_binlog_size=200M</span>
<span class="hljs-comment"># 设置每隔多少次事务提交操作，将这些操作写入二进制日志文件</span>
<span class="hljs-string">sync_binlog=1</span>
<span class="hljs-comment"># 使用mysql_native_password插件的认证</span>
<span class="hljs-comment"># default_authentication_plugin=mysql_native_password</span>
</code></pre>
<p>重启mysql容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">ps</span> <span class="hljs-string">-a</span>
<span class="hljs-string">docker</span> <span class="hljs-string">restart</span> <span class="hljs-string">容器id</span>
</code></pre>
<h4 data-id="heading-3"><strong>创建用户并授权给从机</strong></h4>
<p>主机创建用户：</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 连接上Mysql服务，执行</span>
<span class="hljs-string">create</span> <span class="hljs-string">user</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">identified</span> <span class="hljs-string">with</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">by</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
<span class="hljs-comment"># 授权复制的权限 ON后的*.*代表全部的库和表</span>
<span class="hljs-string">GRANT</span> <span class="hljs-string">REPLICATION</span> <span class="hljs-string">SLAVE</span> <span class="hljs-string">ON</span> <span class="hljs-string">*.*</span> <span class="hljs-string">TO</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%';</span>
<span class="hljs-comment"># 刷新权限</span>
<span class="hljs-string">FLUSH</span> <span class="hljs-string">PRIVILEGES;</span>

<span class="hljs-comment"># 如果远程链接失败，可以修改默认密码校验方式（第三方工具可以连接上）</span>
<span class="hljs-string">alter</span> <span class="hljs-string">user</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">identified</span> <span class="hljs-string">with</span> <span class="hljs-string">mysql_native_password</span> <span class="hljs-string">by</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
</code></pre>
<p>查询主机的状态：</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">show</span> <span class="hljs-string">master</span> <span class="hljs-string">status;</span>
<span class="hljs-comment"># 执行上面命令，得到 File(binlog日志) Position(接入点) Binlog_Do_DB(要复制的数据库) Binlog_IgnoreDB()</span>
<span class="hljs-comment"># 需要记录一下File、Position</span>
</code></pre>
<h3 data-id="heading-4">从节点配置</h3>
<p>创建数据目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/slave/data</span>
</code></pre>
<p>创建日志目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/slave/logs</span>
</code></pre>
<p>创建配置文件目录</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">mkdir</span> <span class="hljs-string">-p</span> <span class="hljs-string">/docker/mysql/slave/conf</span>
</code></pre>
<p>创建自定义的配置文件</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">cd</span> <span class="hljs-string">/docker/mysql/slave/conf</span>
<span class="hljs-string">touch</span> <span class="hljs-string">my.cnf</span>
</code></pre>
<p>mysql.cnf文件内容：</p>
<pre><code class="hljs language-yml" lang="yml">[<span class="hljs-string">client</span>]
<span class="hljs-comment"># mysql客户端默认字符集</span>
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysql</span>]
<span class="hljs-string">default-character-set=utf8mb4</span>
[<span class="hljs-string">mysqld</span>]
<span class="hljs-comment"># 跳过密码登录</span>
<span class="hljs-comment">#skip-grant-tables</span>
<span class="hljs-comment">#bind-address = 127.0.0.1</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">collation_connection</span> <span class="hljs-string">=</span> <span class="hljs-string">utf8mb4_general_ci'</span>
<span class="hljs-string">init_connect='SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4'</span>
<span class="hljs-comment"># mysql服务端默认字符集</span>
<span class="hljs-string">character-set-server=utf8mb4</span>
<span class="hljs-string">collation-server=utf8mb4_general_ci</span>
<span class="hljs-string">skip-character-set-client-handshake</span>
<span class="hljs-comment"># datadir=/var/lib/mysql  </span>

<span class="hljs-comment"># 从服务器唯一ID</span>
<span class="hljs-string">server-id</span> <span class="hljs-string">=</span> <span class="hljs-number">2</span>  
<span class="hljs-comment"># 开启中继日志</span>
<span class="hljs-string">relay-log=mysql-relay</span>
<span class="hljs-comment"># 从机，1 只读 0 读写（默认是0）</span>
<span class="hljs-string">read-only=1</span>
<span class="hljs-comment"># 启用二进制日志，日志的存放地址，如果从机变成主机可以继续使用bin日志</span>
<span class="hljs-comment"># log-bin=mysql-slave-bin</span>
<span class="hljs-comment"># 使用mysql_native_password插件的认证</span>
<span class="hljs-comment"># default_authentiction_plugin=mysql_native_password</span>
</code></pre>
<p>运行容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">run</span> <span class="hljs-string">-p</span> <span class="hljs-number">3341</span><span class="hljs-string">:3306</span> <span class="hljs-string">--name</span> <span class="hljs-string">mysql_slave</span> <span class="hljs-string">--privileged=true</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/slave/conf:/etc/mysql/conf.d</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/slave/logs:/var/log/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/docker/mysql/slave/data:/var/lib/mysql</span> <span class="hljs-string">\</span>
<span class="hljs-string">-v</span> <span class="hljs-string">/etc/localtime:/etc/localtime</span> <span class="hljs-string">\</span>
<span class="hljs-string">-e</span> <span class="hljs-string">MYSQL_ROOT_PASSWORD=123456</span> <span class="hljs-string">-d</span> <span class="hljs-string">mysql:8.0.32</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">collation_connection=utf8mb4_0900_ai_ci"</span> <span class="hljs-string">--init-connect="SET</span> <span class="hljs-string">NAMES</span> <span class="hljs-string">utf8mb4"</span> <span class="hljs-string">--skip-character-set-client-handshake</span> 
</code></pre>
<p>进入容器</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">docker</span> <span class="hljs-string">ps</span> <span class="hljs-string">-a</span>
<span class="hljs-string">docker</span> <span class="hljs-string">exec</span> <span class="hljs-string">-it</span> <span class="hljs-string">mysql_slave</span> <span class="hljs-string">/bin/bash</span>
</code></pre>
<p>配置远程连接（对外连接的）</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 打开MySQL，输入密码</span>
<span class="hljs-string">mysql</span> <span class="hljs-string">-uroot</span> <span class="hljs-string">-p</span>
<span class="hljs-comment"># 查看数据库</span>
<span class="hljs-string">show</span> <span class="hljs-string">databases;</span>
<span class="hljs-comment"># 创建数据库</span>
<span class="hljs-string">create</span> <span class="hljs-string">database</span> <span class="hljs-string">数据库;</span>
<span class="hljs-comment"># 查看数据库</span>
<span class="hljs-comment"># 在MySQL下执行</span>
<span class="hljs-string">use</span> <span class="hljs-string">mysql;</span>
<span class="hljs-comment"># 创建对外访问的用户和权限</span>
<span class="hljs-string">CREATE</span> <span class="hljs-string">USER</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">IDENTIFIED</span> <span class="hljs-string">BY</span> <span class="hljs-string">'密码'</span><span class="hljs-string">;</span>
<span class="hljs-string">GRANT</span> <span class="hljs-string">ALL</span> <span class="hljs-string">ON</span> <span class="hljs-string">*.*</span> <span class="hljs-string">TO</span> <span class="hljs-string">'用户名'</span><span class="hljs-string">@'%'</span> <span class="hljs-string">WITH</span> <span class="hljs-string">GRANT</span> <span class="hljs-string">OPTION;</span>
<span class="hljs-string">FLUSH</span> <span class="hljs-string">PRIVILEGES;</span>

<span class="hljs-comment"># 退出</span>
<span class="hljs-string">exit</span>
</code></pre>
<h4 data-id="heading-5">设置同步信息</h4>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 停止同步(之前配置过，需要执行)</span>
<span class="hljs-string">stop</span> <span class="hljs-string">slave;</span>

<span class="hljs-comment"># 设置同步</span>
<span class="hljs-string">CHANGE</span> <span class="hljs-string">MASTER</span> <span class="hljs-string">TO</span> <span class="hljs-string">MASTER_HOST='主机IP地址',</span>
<span class="hljs-string">MASTER_PORT=端口,</span>
<span class="hljs-string">MASTER_USER='主机用户',MASTER_PASSWORD='主机用户的密码',</span>
<span class="hljs-string">MASTER_LOG_FILE='binlog日志名字',</span>
<span class="hljs-string">MASTER_CONNECT_RETRY=30,</span>
<span class="hljs-string">MASTER_LOG_POS=具体的接入点值;</span>

<span class="hljs-comment"># MASTER_CONNECT_RETRY 是如果连接失败，重试时间间隔，默认60秒</span>
</code></pre>
<p>如果操作失败，需要重新配置，执行下面2个命令</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">stop</span> <span class="hljs-string">slave;</span>    <span class="hljs-comment"># 停止同步操作</span>
<span class="hljs-string">reset</span> <span class="hljs-string">master;</span>  <span class="hljs-comment"># 重置主从配置，删除之前的中继日志，会再生成一份新的</span>
</code></pre>
<p>开始同步</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">start</span> <span class="hljs-string">slave;</span>
</code></pre>
<p>检查是否成功</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-string">show</span> <span class="hljs-string">slave</span> <span class="hljs-string">status</span> <span class="hljs-string">\G;</span>  <span class="hljs-comment"># 检查状态</span>
<span class="hljs-comment"># 如果结果下面的字段为Yes 代表配置成功</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Slave_IO_Running:</span> <span class="hljs-literal">Yes</span>
<span class="hljs-bullet">-</span> <span class="hljs-attr">Slave_SQL_Running:</span> <span class="hljs-literal">Yes</span>
</code></pre>
<p>停止和重置</p>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 从机上执行，停止I/O 线程和SQL线程的操作</span>
<span class="hljs-string">stop</span> <span class="hljs-string">slave;</span> 

<span class="hljs-comment"># 从机上执行，用于删除SLAVE数据库的relaylog日志文件，并重新启用新的relaylog文件</span>
<span class="hljs-string">reset</span> <span class="hljs-string">slave;</span>

<span class="hljs-comment"># 主机上执行，删除所有的binglog日志文件，并将日志索引文件清空，重新开始所有新的日志文件</span>
<span class="hljs-string">reset</span> <span class="hljs-string">master;</span>
</code></pre>
<h3 data-id="heading-6">验证</h3>
<pre><code class="hljs language-yml" lang="yml"><span class="hljs-comment"># 从主机上，创建表、插入SQL语句</span>
<span class="hljs-comment"># 创建表</span>
<span class="hljs-string">CREATE</span> <span class="hljs-string">TABLE</span> <span class="hljs-string">`emp`</span> <span class="hljs-string">(</span>
  <span class="hljs-string">`id`</span> <span class="hljs-string">int(11)</span> <span class="hljs-string">NOT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'主键'</span><span class="hljs-string">,</span>
  <span class="hljs-string">`name`</span> <span class="hljs-string">varchar(255)</span>  <span class="hljs-string">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'员工名'</span><span class="hljs-string">,</span>
  <span class="hljs-string">`age`</span> <span class="hljs-string">int(11)</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'年龄'</span><span class="hljs-string">,</span>
  <span class="hljs-string">`did`</span> <span class="hljs-string">int(11)</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-literal">NULL</span> <span class="hljs-string">COMMENT</span> <span class="hljs-string">'部门id'</span><span class="hljs-string">,</span>
  <span class="hljs-string">PRIMARY</span> <span class="hljs-string">KEY</span> <span class="hljs-string">(`id`)</span>
<span class="hljs-string">)</span> <span class="hljs-string">ENGINE=InnoDB</span> <span class="hljs-string">DEFAULT</span> <span class="hljs-string">CHARSET=utf8mb4</span> <span class="hljs-string">COLLATE=utf8mb4_0900_ai_ci</span> <span class="hljs-string">COMMENT='部门表';</span>
<span class="hljs-string">INSERT</span> <span class="hljs-string">INTO</span> <span class="hljs-string">emp</span> <span class="hljs-string">(`id`,</span> <span class="hljs-string">`name`,</span> <span class="hljs-string">`age`,</span> <span class="hljs-string">`did`)</span> <span class="hljs-string">VALUES</span> <span class="hljs-string">(1,</span> <span class="hljs-string">'刘备'</span><span class="hljs-string">,</span> <span class="hljs-number">55</span><span class="hljs-string">,</span> <span class="hljs-number">1</span><span class="hljs-string">);</span>
<span class="hljs-comment"># 分别 在主机和从机进行查询该SQL语句</span>
<span class="hljs-string">select</span> <span class="hljs-string">*</span> <span class="hljs-string">from</span>  <span class="hljs-string">emp;</span>
<span class="hljs-comment"># 如：都看到相同的数据，代表成功</span>
</code></pre>
<h3 data-id="heading-7">常见问题</h3>
<p>启动主从同步后，常见错误是<code>Slave_IO_Running： No 或者 Connecting</code> 的情况，此时查看下方的 <code>Last_IO_ERROR</code>错误日志，根据日志中显示的错误信息在网上搜索解决方案即可</p>
<p>一 常见错误：</p>
<pre><code class="hljs language-vbnet" lang="vbnet">`Last_IO_Error: Got fatal <span class="hljs-keyword">error</span> <span class="hljs-number">1236</span> <span class="hljs-keyword">from</span> master <span class="hljs-keyword">when</span> reading data <span class="hljs-keyword">from</span> <span class="hljs-keyword">binary</span> log: <span class="hljs-comment">'Client requested master to start replication from position &gt; file size'`</span>
</code></pre>
<p>解决：</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-comment">-- 在从机停止slave</span>
SLAVE STOP;

<span class="hljs-comment">-- 在主机查看mater状态</span>
<span class="hljs-keyword">SHOW</span> MASTER STATUS;
<span class="hljs-comment">-- 在主机刷新日志</span>
FLUSH LOGS;
<span class="hljs-comment">-- 再次在主机查看mater状态（会发现File和Position发生了变化）</span>
<span class="hljs-keyword">SHOW</span> MASTER STATUS;
<span class="hljs-comment">-- 修改从机连接主机的SQL，并重新连接即可</span>
</code></pre>
<p>二：启动docker容器后提示 <code>WARNING: IPv4 forwarding is disabled. Networking will not work.</code></p>
<p>解决：</p>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-comment">#修改配置文件：</span>
vim /usr/lib/sysctl.d/00-system.conf
<span class="hljs-comment">#追加</span>
<span class="hljs-attr">net.ipv4.ip_forward</span>=<span class="hljs-number">1</span>
<span class="hljs-comment">#接着重启网络</span>
systemctl restart network
</code></pre></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[收藏！LLM开发全链路：5大步骤+15大框架，从数据治理到RLHF一文通关]]></title>    <link>https://juejin.cn/post/7599094262592045066</link>    <guid>https://juejin.cn/post/7599094262592045066</guid>    <pubDate>2026-01-26T00:11:42.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7599094262592045066" data-draft-id="7598480267218845730" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="收藏！LLM开发全链路：5大步骤+15大框架，从数据治理到RLHF一文通关"/> <meta itemprop="keywords" content="AIGC"/> <meta itemprop="datePublished" content="2026-01-26T00:11:42.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="AIFrontiers"/> <meta itemprop="url" content="https://juejin.cn/user/4443547050451306"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            收藏！LLM开发全链路：5大步骤+15大框架，从数据治理到RLHF一文通关
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4443547050451306/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    AIFrontiers
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T00:11:42.000Z" title="Mon Jan 26 2026 00:11:42 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读35分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>原文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FoRUjkoUcHOrMtHfVHkr5Cw" target="_blank" title="https://mp.weixin.qq.com/s/oRUjkoUcHOrMtHfVHkr5Cw" ref="nofollow noopener noreferrer">mp.weixin.qq.com/s/oRUjkoUcH…</a></p>
<p><strong>LLM</strong> <strong>往期文章推荐</strong></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2Fcx3qY42Lp0L3RaSOgsH77A" target="_blank" title="https://mp.weixin.qq.com/s/cx3qY42Lp0L3RaSOgsH77A" ref="nofollow noopener noreferrer">小白也能看懂的RL-PPO</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2FnfN0dWT3ZfDuW7ZGfaG6dA" target="_blank" title="https://mp.weixin.qq.com/s/nfN0dWT3ZfDuW7ZGfaG6dA" ref="nofollow noopener noreferrer">收藏！强化学习从入门到封神：5 本经典教材 + 8 大实战项目 + 7个免费视频，一站式搞定</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F4_6CBXMJhqmiYKSzsAXncg" target="_blank" title="https://mp.weixin.qq.com/s/4_6CBXMJhqmiYKSzsAXncg" ref="nofollow noopener noreferrer">小白也能看懂的RLHF：基础篇</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F8O7W8--x14-b1d3M9IS_3w" target="_blank" title="https://mp.weixin.qq.com/s/8O7W8--x14-b1d3M9IS_3w" ref="nofollow noopener noreferrer">小白也能看懂的RLHF-PPO：原理篇</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9KT9LrMTXDGHSvGFrQhRkg" target="_blank" title="https://mp.weixin.qq.com/s/9KT9LrMTXDGHSvGFrQhRkg" ref="nofollow noopener noreferrer">小白也能看懂的LLM-RL算法：PPO/DPO/GRPO/GSPO</a></p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a></p>
<p>在上一篇<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a>中，我们重点讨论了LLM训练技术的开源框架，并未涉及LLM训练的其他环节。在人工智能领域从模型中心化向数据中心化范式转移的背景下，LLM的成功不仅依赖于模型参数规模的爆炸式增长，更取决于全链路工程化的精细程度。</p>
<p>这一链路涵盖了从海量异构数据的精炼、超大规模分布式环境下的模型训练、特定任务驱动的指令微调，到最终模型输出与人类价值观对齐的RLHF阶段。如近的开源生态系统已涌现出一批高性能、模块化且落地性强的代码框架，这些工具极大地降低了开发者训练、微调和部署私有化大模型的门槛。本篇将对这一全链路中的核心开源框架进行深度的技术解构，分析其底层机制、性能指标及行业应用场景。</p>
<h2 data-id="heading-0">1 分布式数据清洗与编排引擎</h2>
<p>数据质量是LLM性能的生命线。当前工业界的共识是，高质量的合成数据和经过严苛清洗的NLP语料对提升模型逻辑推理能力至关重要。当数据规模达到PB级时，单机处理变得不可行。异构脏数据的处理流程需要复杂的任务编排和大规模分布式计算的支持。</p>
<h3 data-id="heading-1">1.1 <strong>Data-Juicer</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/89ddcae485144e6d8eac40455408cb66~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=5KG9FkaBX4rfG39k1cNDOolCkgM%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>gitHub：<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdatajuicer%2Fdata-juicer" target="_blank" title="https://github.com/datajuicer/data-juicer" ref="nofollow noopener noreferrer">github.com/datajuicer/…</a> 5.8k⭐</p>
</li>
<li>
<p>说明文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdatajuicer.github.io%2Fdata-juicer%2Fzh_CN%2Fmain%2Fdocs_index_ZH.html" target="_blank" title="https://datajuicer.github.io/data-juicer/zh_CN/main/docs_index_ZH.html" ref="nofollow noopener noreferrer">datajuicer.github.io/data-juicer…</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2501.14755v2" target="_blank" title="https://arxiv.org/pdf/2501.14755v2" ref="nofollow noopener noreferrer">arxiv.org/pdf/2501.14…</a></p>
</li>
</ul>
<h4 data-id="heading-2"><strong>核心特点</strong></h4>
<ul>
<li>
<p><strong>一站式与系统化</strong>：涵盖了数据分析、清洗、过滤、转换、去重及合成的完整链路。它不仅是一个工具包，更是一个完整的系统，提供了100多个核心算子。</p>
</li>
<li>
<p><strong>多模态支持</strong>：除了基础的文本数据，Data-Juicer 2.0及后续版本深度支持图像、视频、音频等多种模态，能够处理复杂的交织多模态数据。</p>
</li>
<li>
<p><strong>高效扩展</strong>：基于Ray和CUDA优化，支持单机到数千核集群的弹性扩展，性能经工业级验证。</p>
</li>
<li>
<p><strong>数据-模型共开发（Sandbox）</strong> ：提供沙盒机制，允许开发者在小规模数据上快速迭代实验，通过反馈循环和可视化工具快速验证数据改进对模型效果的影响。</p>
</li>
</ul>
<h4 data-id="heading-3">适用场景</h4>
<ul>
<li>
<p><strong>预训练/微调加速</strong>：对海量网页数据去噪，或筛选高质量、高多样性的指令微调数据。</p>
</li>
<li>
<p><strong>多模态生成训练</strong>：为类似Sora的视频生成或多模态大模型准备精细化标注与清洗后的语料。</p>
</li>
<li>
<p><strong>自动化数据工程</strong>：利用AI算子自动生成、重写数据，或探索最优数据混合比例。</p>
</li>
</ul>
<h4 data-id="heading-4">优缺点</h4>
<p><strong>优点</strong>：① 工业级成熟度：源自阿里巴巴通义实验室，经过大规模生产环境验证，算子丰富且性能优异；② 生态集成度高：与ModelScope（魔搭社区）、LLaMA-Factory、Ray等主流大模型生态深度打通，方便开发者集成到现有流水线；③ 灵活易用：对于新手，可以直接使用官方提供的最佳实践配置；对于高级用户，可以通过 Python 灵活自定义算子。</p>
<p><strong>缺点</strong>：① 学习成本：算子库庞大，需一定时间摸索最佳参数组合；② 资源需求：部分高级算子（如模型打分）依赖计算资源，处理海量数据时成本较高。</p>
<h3 data-id="heading-5">1.2 Datatrove</h3>
<ul>
<li>github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhuggingface%2Fdatatrove" target="_blank" title="https://github.com/huggingface/datatrove" ref="nofollow noopener noreferrer">github.com/huggingface…</a> 2.8k⭐</li>
</ul>
<h4 data-id="heading-6">关键特<strong>性</strong></h4>
<ul>
<li>
<p><strong>平台无关的流水线</strong>：代码在本地机器、Slurm集群或 Ray集群上运行时几乎不需要改动。它通过执行器机制抽象了底层算力。</p>
</li>
<li>
<p><strong>低</strong> <strong>内存</strong> <strong>占用与流式处理</strong>：采用生成器模式，数据以流的形式通过处理模块，即便处理数百TB的数据，内存消耗也能控制在较低水平。</p>
</li>
<li>
<p><strong>强大的去重功能</strong>：内置了工业级的去重算法，包括MinHash（模糊去重）和Exact Substring（精确子串去重），这是处理网页抓取数据的关键。</p>
</li>
<li>
<p><strong>容错与断点续传</strong>：能够自动跟踪已完成的任务，如果作业在集群中崩溃，重启后会自动跳过已处理的部分。</p>
</li>
</ul>
<h4 data-id="heading-7">适用场景</h4>
<ul>
<li>
<p><strong>LLM</strong> <strong>预训练清洗</strong>：处理Common Crawl等原始网页快照，提取纯净文本并剔除低质量内容。。</p>
</li>
<li>
<p><strong>超大规模去重</strong>：在海量数据中精准剔除重复或高度相似的文档。</p>
</li>
<li>
<p><strong>分布式</strong> <strong>数据工程</strong>：利用Slurm或Ray等集群环境快速处理万亿规模的数据集。</p>
</li>
</ul>
<h4 data-id="heading-8">优缺点</h4>
<p><strong>优点</strong>：① 极致的扩展性：不是为了处理小样本设计的，而是为了处理万亿级Token设计的，在Slurm或Ray分布式环境下表现极佳；②简洁的API：Pythonic风格，模块化程度高，易于自定义扩展；③ 与生态深度集成：与Hugging Face Hub和fsspec深度整合，支持直接读写S3、Hugging Face数据仓库。</p>
<p><strong>缺点</strong>：①主要侧重文本：理论上虽然可以处理其他数据，但目前其生态和预置算子主要集中在文本领域。在多模态（图像、视频）算子的丰富度上，目前弱于Data-Juicer；② 文档相对精简：相比一些商业化或历史悠久的框架，其详细文档和教程仍在完善中，更多依赖示例代码（Examples）。</p>
<h2 data-id="heading-9">2 分布式预训练与模型训练底层架构</h2>
<p>当数据准备就绪后，如何将其高效地输入到分布式计算集群中进行训练成为核心挑战。因单个GPU的显存（如H100的80GB）远不足以容纳100+B参数的模型、及其优化器状态和梯度，分布式并行策略成为了现代训练框架的基石。</p>
<h3 data-id="heading-10">2.1 Megatron-LM</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/543728942fb54ffe99c39cd4fcceb735~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=Vl3MZyjRupsHVfxnhR13ExIyn50%3D" alt="" loading="lazy"/></p>
<ul>
<li>Github : <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FNVIDIA%2FMegatron-LM" target="_blank" title="https://github.com/NVIDIA/Megatron-LM" ref="nofollow noopener noreferrer">github.com/NVIDIA/Mega…</a> 15k⭐</li>
<li>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.nvidia.com%2Fmegatron-core%2Findex.html" target="_blank" title="https://docs.nvidia.com/megatron-core/index.html" ref="nofollow noopener noreferrer">docs.nvidia.com/megatron-co…</a></li>
<li>论文1：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F1909.08053" target="_blank" title="https://arxiv.org/pdf/1909.08053" ref="nofollow noopener noreferrer">arxiv.org/pdf/1909.08…</a></li>
<li>论文2：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2104.04473" target="_blank" title="https://arxiv.org/pdf/2104.04473" ref="nofollow noopener noreferrer">arxiv.org/pdf/2104.04…</a></li>
<li>论文3：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2205.05198" target="_blank" title="https://arxiv.org/pdf/2205.05198" ref="nofollow noopener noreferrer">arxiv.org/pdf/2205.05…</a></li>
</ul>
<p>Megatron-LM作为由NVIDIA深度开发的分布式训练框架，核心贡献在于提出并完善了多维并行体系，特别是针对 Transformer 结构的深度优化，在大模型预训练领域占据着举足轻重的地位。其设计哲学始终围绕着如何榨干NVIDIA GPU的每一分性能，特别是利用高性能NVLink互联和CUDA内核融合技术。</p>
<h4 data-id="heading-11">关键特性与底层架构分析</h4>
<p>核心贡献在于提出并完善了多维并行体系，特别是针对 Transformer结构的深度优化。</p>
<ul>
<li><strong>多维</strong> <strong>并行计算</strong> <strong>架构</strong>：将计算任务在三个维度进行解耦：层内计算（张量并行）、层间计算（流水线并行）以及批次数据（数据并行）。张量并行（Tensor Parallelism）是一种层内并行技术，将Transformer层的矩阵乘法操作沿列或行进行拆分。例如，在注意力机制的QKV投影层，通过将输出维度（列）切分到不同GPU，每个进程仅需存储和计算部分参数，最后通过All-Reduce操作聚合梯度。这种精细化的切分使得单卡无法容纳的大型层得以在节点内高效运行。</li>
<li><strong>流水线</strong> <strong>并行</strong> <strong>的1F1B调度</strong>：为了解决跨层并行的负载均衡问题，Megatron-LM引入了1F1B（One-Forward-One-Backward）调度算法。通过将全局批次切分为多个微批次（Micro-batches），1F1B允许不同的流水线阶段在同一时间点并行处理不同的微批次，极大地压缩了流水线气泡（Pipeline Bubble）占用的时间比例，从而提升了集群的整体利用率。</li>
<li><strong>序列</strong> <strong>并行</strong> <strong>与上下文并行</strong>：针对长文本训练需求，实现了序列并行（Sequence Parallelism），它将非张量并行部分（如LayerNorm和Dropout）沿序列维度进一步拆分，有效减少了冗余的显存占用。而在处理超长上下文（如 32K及以上tokens）时，上下文并行（Context Parallelism）则通过跨设备分配序列片段来应对激活值内存激增的挑战。</li>
<li><strong>Megatron Core (MCore)</strong> ：作为该框架的最新演进版本，MCore采用了模块化、组件化的设计理念。它通过Composable APIs允许用户灵活构建自定义训练流程，并集成了混合专家模型的先进支持，包括针对 DeepSeek-V3等架构的深度优化，支持 DeepEP、HybridEP等高效的Token调度算法，旨在实现异构数据中心规模下的高弹性能。</li>
</ul>
<h4 data-id="heading-12">适合场景与性能边界</h4>
<p>Megatron-LM专为拥有高性能计算集群（尤其是具备 NVLink 节点内互联的高端NVIDIA GPU环境）的团队设计。它是训练基础大模型（如Deepseek等级模型）的参考实现，特别是在需要追求极致的TFLOPS吞吐量时，其定制化的CUDA内核融合技术（能减少显存访问开销约 40%）展现出了巨大的技术优势。</p>
<h4 data-id="heading-13">优缺点</h4>
<p><strong>优点</strong>：① 性能极致：通过高度优化的算子融合和硬件感知通信，实现业界最高的显存和算力效率 ；② 稳定性强：作为NVIDIA官方维护项目，对Hopper/Blackwell等新架构的支持最为迅速且深度；③ 工业标准：其提出的3D并行方案已成为大规模训练的事实标准。</p>
<p><strong>缺点</strong>：① 开发难度高：代码侵入性强，对非Transformer架构的适配极其复杂，需要深厚的系统编程功底；② 灵活性受限：由于过度依赖NVLink和专有算子，在非同构网络或显存极度受限的异构环境下表现不如DeepSpeed。</p>
<h3 data-id="heading-14">2.2  DeepSpeed</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/324a2f8b379c40989b2c089f27950f70~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=cRaCMZaCUP9JPm%2Fm9Z7ZtcDsuko%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>gitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fdeepspeedai%2FDeepSpeed" target="_blank" title="https://github.com/deepspeedai/DeepSpeed" ref="nofollow noopener noreferrer">github.com/deepspeedai…</a> 41.3k⭐</p>
<ul>
<li><a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmicrosoft%2FDeepSpeedExamples" target="_blank" title="https://github.com/microsoft/DeepSpeedExamples" ref="nofollow noopener noreferrer">github.com/microsoft/D…</a> 6.8k⭐</li>
</ul>
</li>
<li>
<p>官方文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdeepspeed.readthedocs.io%2Fen%2Fstable%2Fzero3.html" target="_blank" title="https://deepspeed.readthedocs.io/en/stable/zero3.html" ref="nofollow noopener noreferrer">deepspeed.readthedocs.io/en/stable/z…</a></p>
</li>
<li>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.deepspeed.ai%2F" target="_blank" title="https://www.deepspeed.ai/" ref="nofollow noopener noreferrer">www.deepspeed.ai/</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2308.01320" target="_blank" title="https://arxiv.org/pdf/2308.01320" ref="nofollow noopener noreferrer">arxiv.org/pdf/2308.01…</a></p>
</li>
</ul>
<p>DeepSpeed是微软在大模型训练领域推出的另一力作，其设计重心在于解决大模型训练中的显存瓶颈问题。通过零冗余优化器（ZeRO）系列技术，DeepSpeed极大地降低了训练超大规模模型的准入门槛。</p>
<h4 data-id="heading-15">关键技术深度解析</h4>
<p>DeepSpeed的核心架构由ZeRO优化器及其衍生的异构存储技术构成。</p>
<ul>
<li>
<p><strong>ZeRO</strong> <strong>优化器</strong> <strong>（ZeRO-1/2/3）</strong> ：ZeRO技术的精髓在于消除模型状态的冗余存储。在传统数据并行中，每个GPU都保存完整的模型状态，而ZeRO则将这些状态进行分片（Sharding）。ZeRO-1仅对优化器状态进行分片；ZeRO-2进一步对梯度进行分片；ZeRO-3则实现了对参数、梯度和优化器状态的全量分片存储。这种策略使得显存消耗随设备数的增加而线性下降。</p>
</li>
<li>
<p><strong>ZeRO-Offload与ZeRO-Infinity</strong>：针对显存严重短缺的场景，DeepSpeed提出了异构内存利用方案。ZeRO-Offload利用CPU内存存储并处理优化器状态更新，而ZeRO-Infinity则将这一思路推向极致，通过高效的Infinity Offload引擎同时利用GPU显存、CPU内存和NVMe SSD，支持在单个GPU上训练高达130亿参数的模型，或在集群上支持万亿参数规模。</p>
</li>
<li>
<p><strong>DeepSpeed-Ulysses序列</strong> <strong>并行</strong>：相比Megatron的序列并行，Ulysses采用了一种更通用的All-to-All通信机制。它在注意力计算前后重新分配数据，使得每个GPU能够完整地看到全局上下文，但仅负责计算部分注意力头，这在长序列训练中展现出了极佳的带宽效率。</p>
</li>
<li>
<p><strong>混合3D</strong> <strong>并行</strong> <strong>集成</strong>：DeepSpeed通过与Megatron-LM的深度融合，将ZeRO技术与张量并行、流水线并行相结合，形成了一套完整的万亿级模型训练方案。其提供的TiledLinear模块进一步通过内存平铺技术减少了算子的峰值内存需求。</p>
</li>
</ul>
<h4 data-id="heading-16">适合场景</h4>
<p>DeepSpeed是资源异构或受限环境下的不二之选。无论是需要在中小规模集群上微调百亿参数模型，还是在跨节点的非高速互联环境下进行预训练，其强大的显存管理能力都能确保持续运行。此外，由于其与 Hugging Face等开源生态结合紧密，它是研究人员和企业进行快速实验和模型私有化部署的首选框架。</p>
<h4 data-id="heading-17">优缺点</h4>
<p><strong>优点</strong>：① 显存效率极高：ZeRO-3与Infinity技术极大地打破了内存墙，支持单机训练超大规模模型；② 易用性与兼容性：通过简单的JSON配置文件即可启用复杂功能，无需大规模重构PyTorch代码；③ 生态开放：支持包括AMD、Intel 在内的多种硬件平台，广泛集成于第三方库。</p>
<p><strong>缺点</strong>：① 通信开销风险：在开启深度Offload模式下，由于受限于PCIe带宽，计算效率可能大幅下降；② 复杂系统集成：在将ZeRO与3D并行结合使用时，参数配置与负载均衡的调优极其繁琐。</p>
<h3 data-id="heading-18">2.3 Colossal-AI</h3>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhpcaitech%2FColossalAI" target="_blank" title="https://github.com/hpcaitech/ColossalAI" ref="nofollow noopener noreferrer">github.com/hpcaitech/C…</a> 41.3k⭐</p>
</li>
<li>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fcolossalai.org%2F" target="_blank" title="https://colossalai.org/" ref="nofollow noopener noreferrer">colossalai.org/</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2110.14883" target="_blank" title="https://arxiv.org/pdf/2110.14883" ref="nofollow noopener noreferrer">arxiv.org/pdf/2110.14…</a></p>
</li>
</ul>
<p>Colossal-AI由潞晨科技团队开发，致力于通过统一的并行接口和智能化的内存管理，将复杂的分布式训练大众化。其最大的特色在于对异构内存的精细化控制以及自动并行化搜索技术。</p>
<h4 data-id="heading-19">关键技术特性分析</h4>
<p>Colossal-AI引入了一系列旨在提升资源利用率和开发效率的底层机制。</p>
<ul>
<li>
<p><strong>Gemini动态异构</strong> <strong>内存</strong> <strong>管理器</strong>：Gemini是Colossal-AI的核心组件，其设计灵感源于PatrickStar。它采用块状内存管理策略，将参数、梯度及优化器状态组织成连续的内存块。Gemini的先进之处在于其Warmup机制：在训练的第一步，系统会实时监测非模型数据（如激活值）的内存波动，据此动态调整模型数据在GPU与CPU间的存放比例。这种自适应的逐出策略能有效减少内存碎片，并充分利用空闲的CPU显存空间。</p>
</li>
<li>
<p><strong>自动并行化搜索</strong>：区别于其他框架的显著标志。通过ColoTracer静态图分析技术，系统可以将并行策略的制定转化为一个约束优化问题。它不仅能自动搜索张量并行的切分方案，还能结合激活值检查点的插入位置，找到比人类专家手动配置更优的执行计划。这极大降低了对系统架构师的依赖。</p>
</li>
<li>
<p><strong>多维</strong> <strong>张量</strong> <strong>并行</strong> <strong>架构</strong>：除了传统的1D张量并行，Colossal-AI还实现了2D、2.5D和3D张量并行。利用复杂的分布式矩阵乘法算法，它能够在更大规模的集群中进一步减少通信量，实现超线性的并行加速比。</p>
</li>
<li>
<p><strong>Booster与Shardformer生态</strong>：Colossal-AI提供了Booster插件系统，支持对开源社区（如Hugging Face, Timm）中的模型进行非侵入式的分布式包装。Shardformer可以在不改变原始模型定义的情况下，通过JIT编译和内核替换，自动注入并行算子、FlashAttention及FusedNorm等性能增强项。</p>
</li>
</ul>
<h4 data-id="heading-20">适合场景</h4>
<p>Colossal-AI非常适合那些需要训练多样化模型结构、且希望减少手动调优工作量的团队。在视觉Transformer (ViT) 以及对显存利用率要求极高的长序列任务中，其动态管理机制表现卓越。此外，其作为PyTorch Lightning的合作伙伴，也吸引了大量追求开发效率的科研用户。</p>
<h4 data-id="heading-21">优缺点</h4>
<p><strong>优点</strong>：① 极佳的显存容忍度：Chunk机制相比原生ZeRO能显著降低内存碎片，提升训练稳定性；② 自动化程度最高：一键式并行策略搜索极大地简化了从单机到集群的迁移过程；③ 多维并行方案丰富：针对不同集群拓扑提供了更灵活的算法选择。</p>
<p><strong>缺点</strong>：① 稳定性尚需打磨：部分前沿特性（如某些自动并行模式）在复杂异构环境下的健壮性仍有提升空间；② 维护复杂性：底层集成的各种优化插件较多，对初学者的排错能力有一定要求。</p>
<h3 data-id="heading-22">2.4 torchtitan</h3>
<ul>
<li>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fpytorch%2Ftorchtitan" target="_blank" title="https://github.com/pytorch/torchtitan" ref="nofollow noopener noreferrer">github.com/pytorch/tor…</a> 5k⭐</li>
<li>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fopenreview.net%2Fpdf%3Fid%3DWuQtmIkiUL" target="_blank" title="https://openreview.net/pdf?id=WuQtmIkiUL" ref="nofollow noopener noreferrer">openreview.net/pdf?id=WuQt…</a></li>
</ul>
<p>torchtitan是PyTorch官方团队近期推出的原生分布式预训练参考框架。它的出现标志着PyTorch正致力于在核心库层面统一各种分布式并行原语，从而提供一个轻量级、模块化且高度可组合的标杆实现。</p>
<h4 data-id="heading-23">架构设计哲学与关键原语</h4>
<p>torchtitan的核心优势在于其完全基于PyTorch原生组件，如DTensor、DeviceMesh和FSDP2，而非依赖繁重的外部封装。</p>
<ul>
<li>
<p><strong>DTensor 与 DeviceMesh 抽象</strong>：这是torchtitan的基石。DeviceMesh将集群中的计算节点抽象为一个多维逻辑网格，管理底层的进程组通信。DTensor（Distributed Tensor）则允许开发者以单设备语义编写代码，通过在DTensor上定义分片、复制或部分聚合等状态，系统会自动推导并执行必要的重分布通信操作。这种设计极大地简化了多维并行的逻辑复杂性。</p>
</li>
<li>
<p><strong>FSDP2 (Fully Sharded Data Parallel 2)</strong> ：torchtitan率先集成了FSDP2。相比于第一代FSDP 的FlatParameter设计，FSDP2采用了基于参数维度的DTensor分片，具有更强的组合性，并能与torch.compile实现深度融合。实验数据显示，FSDP2在吞吐量上提升了约1.5%，且内存占用降低了7%。</p>
</li>
<li>
<p><strong>硬件软件协同设计与可组合4D</strong> <strong>并行</strong>：框架原生支持数据并行、张量并行、流水线并行及上下文并行的叠加（即4D并行）。torchtitan引入了Float8混合精度训练、SymmetricMemory共享内存通信优化以及异步检查点保存。其设计的精妙之处在于模块的解耦，模型定义保持算法中立，而并行策略作为独立的层进行包装。</p>
</li>
<li>
<p><strong>编译器驱动的内核融合</strong>：深度集成torch.compile，支持区域级编译优化。通过将Transformer Block作为一个整体进行编译，框架能自动实现算子融合与显存复用，减少了对昂贵的手写CUDA内核的依赖，同时也提升了跨硬件平台的迁移能力。</p>
</li>
</ul>
<h4 data-id="heading-24">适合场景</h4>
<p>torchtitan适用于希望紧随PyTorch技术栈、进行最前沿架构实验或追求代码长期可维护性的团队。它是训练Llama 3.1等尖端开源模型的官方推荐参考系统。由于其代码量极简且遵循标准的PyTorch编程模式，它也非常适合用于教学和分布式系统原理的研究。</p>
<h4 data-id="heading-25">优缺点</h4>
<p><strong>优点</strong>：① 极致的原生性：与PyTorch核心深度绑定，无第三方框架带来的兼容性包袱；② 模块化与可组合性：4D并行的实现逻辑清晰，便于研究人员自定义并行策略；③ 先进的优化技术：率先集成Float8、torch.compile等官方最新成果，具备极高的扩展潜力。</p>
<p><strong>缺点</strong>：① 成熟度稍欠：相比Megatron或DeepSpeed，其在万亿参数级的大规模工业化生产环境中，相关辅助工具（如监控、故障恢复）仍处于快速完善阶段；② 功能覆盖面：目前的重心主要集中在基础LLM训练，对MoE、多模态等复杂场景的开箱即用支持尚未达到DeeSpeed的丰富程度。</p>
<h2 data-id="heading-26">3 合成数据与问答对生成</h2>
<p>AI领域从判别式模型向生成式大语言模型演进中，高质量指令数据成为决定模型性能、领域专业性与对齐效果的关键。传统监督微调高度依赖人类标注，不仅规模化生产成本高，且在深层逻辑推理、长链数学证明和垂直行业知识相关标注中，易因标注者能力局限导致质量波动。为突破该瓶颈，学界与工业界研发出多种自动化数据合成框架，依托教师模型的生成能力，将少量种子指令或原始文档转化为海量结构化问答对。</p>
<h3 data-id="heading-27">3.1 Self-Instruct</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/c827264f75ca47569a4cc0428bc2dd97~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=V4cKkTL2xLqsPiSM2xhsUq4srFA%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyizhongw%2Fself-instruct" target="_blank" title="https://github.com/yizhongw/self-instruct" ref="nofollow noopener noreferrer">github.com/yizhongw/se…</a> 4.6k⭐</p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2212.10560" target="_blank" title="https://arxiv.org/pdf/2212.10560" ref="nofollow noopener noreferrer">arxiv.org/pdf/2212.10…</a></p>
</li>
</ul>
<p>Self-Instruct框架是由华盛顿大学等机构在2022年底提出的，其核心贡献在于提出了一种几乎不需要人工干预的指令数据自增长路径。在LLM发展早期，该框架的出现极大地民主化了模型微调的过程，使得研究者能够以极低的成本将预训练模型转化为指令遵循模型。</p>
<h4 data-id="heading-28">迭代自引导的生成机制</h4>
<p>其底层逻辑是一种迭代的自引导算法。该过程始于一个包含175个由人类编写的种子任务的微型集合。每个任务由一条指令和相应的&lt;输入, 输出&gt;示例组成。框架通过利用LLM的上下文学习能力，从任务池中随机抽取少量示例作为提示词，引导模型生成新的指令、输入以及对应的输出。</p>
<p>在具体的任务生成阶段，Self-Instruct展现了严密的逻辑分层。为了确保生成的实例具有高质量的格式，框架首先要求模型生成指令，随后对其进行任务类型识别。这种识别机制将任务分为“分类任务”与“非分类任务”两类，并针对性地应用不同的实例生成策略：</p>




















<table><thead><tr><th><strong>生成策略</strong></th><th><strong>应用场景</strong></th><th><strong>执行逻辑</strong></th></tr></thead><tbody><tr><td><strong>输入优先</strong></td><td>非分类任务</td><td>先引导模型根据指令生成输入背景，再根据指令和输入生成输出回复。</td></tr><tr><td><strong>输出优先</strong></td><td>分类任务</td><td>先让模型列出所有可能的类别标签，再针对每个标签反向生成符合逻辑的输入内容，以避免模型倾向于生成单一标签的偏见。</td></tr></tbody></table>
<p>这种差异化的生成路径确保了在处理诸如情感分析等简单分类任务时，数据集的分布不会因模型的逻辑惯性而向某一类别倾斜。</p>
<h4 data-id="heading-29">启发式过滤与多样性保障</h4>
<p>为了解决模型自生成过程中的<strong>幻觉</strong>与<strong>重复</strong>问题，框架采用两层筛选机制：</p>
<ul>
<li>
<p><strong>相似度去重：</strong> 利用ROUGE-L指标，剔除与现有任务池相似度超过0.7的冗余指令。</p>
</li>
<li>
<p><strong>针对性清洗：</strong></p>
<ul>
<li>
<p><strong>长度过滤：</strong> 确保任务完整且重点突出。</p>
</li>
<li>
<p><strong>依赖排除：</strong> 屏蔽包含图像、文件等模型无法处理的外部关键词。</p>
</li>
<li>
<p><strong>格式规范：</strong> 移除无效标点开头或非英文的生成内容。</p>
</li>
</ul>
</li>
</ul>
<h4 data-id="heading-30">实验成果与性能提升</h4>
<p>Self-Instruct成功从GPT-3中提取了5.2万条指令及8.2万个实例：</p>
<ul>
<li>
<p><strong>性能飞跃：</strong> 在SuperNI基准测试中，GPT-3的指令遵循能力提升了33.1%。</p>
</li>
<li>
<p><strong>对标结果：</strong> 仅依靠合成数据微调，其实际表现已接近InstructGPT-001的水平。</p>
</li>
</ul>
<h3 data-id="heading-31">3.2 <strong>WizardLM</strong></h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/effced3d01354b64a817042828717b18~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=PosbyZYqEWLql%2F50N7IqB5u2AuE%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fnlpxucan%2FWizardLM" target="_blank" title="https://github.com/nlpxucan/WizardLM" ref="nofollow noopener noreferrer">github.com/nlpxucan/Wi…</a> 9.5k⭐</p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Fproceedings.iclr.cc%2Fpaper_files%2Fpaper%2F2024%2Ffile%2F82eec786fdfbbfa53450c5feb7d1ac92-Paper-Conference.pdf" target="_blank" title="https://proceedings.iclr.cc/paper_files/paper/2024/file/82eec786fdfbbfa53450c5feb7d1ac92-Paper-Conference.pdf" ref="nofollow noopener noreferrer">proceedings.iclr.cc/paper_files…</a></p>
</li>
</ul>
<p>如果说Self-Instruct解决了数据从无到有的问题，WizardL则专注于数据由简入繁的质变。</p>
<h4 data-id="heading-32">Evol-Instruct的进化逻辑与操作算子</h4>
<p>Evol-Instruct是WizardLM的核心算法，它不再是从种子任务中水平扩张，而是通过垂直进化不断改写指令。该机制通过提示词引导LLM执行六种具体的进化操作：</p>
<ul>
<li>
<p><strong>深度进化</strong>：</p>
<ul>
<li><strong>添加约束</strong>：向原指令引入更多限制性条件。例如将"写一个故事"进化为"写一个关于量子力学的悬疑故事，且不能使用‘科学’这个词"。</li>
<li><strong>深化</strong>：要求模型在更高、更抽象的认知层面上探讨原有的主题。</li>
<li><strong>具体化</strong>：将泛化的概念指令转化为细节丰富的特定场景，增加处理实际问题的复杂性。</li>
<li><strong>增加推理步骤</strong>：强制要求模型展示多步逻辑推导过程，而非直接给出答案。</li>
<li><strong>复杂化输入</strong>：通过引入干扰信息、错误逻辑或极其复杂的上下文背景来测试模型的稳健性。</li>
</ul>
</li>
<li>
<p><strong>广度进化</strong>：</p>
<ul>
<li><strong>变异</strong>：基于原指令生成一条全新的、在主题或技能上更具挑战性的指令，旨在扩展数据集的领域覆盖范围和技能多样性</li>
</ul>
</li>
</ul>
<p>通过定制Prompt模板实现操作，模型按进化指令生成回复，经多轮迭代将简单种子指令转化为复杂推理任务。</p>
<h4 data-id="heading-33">指令消除器：严苛的质量守门人</h4>
<p>在进化过程中，模型可能会生成逻辑不通、无法完成或毫无增量的指令。WizardLM引入了"指令消除器"作为过滤机制，将以下四类失败任务予以剔除：</p>
<ul>
<li><strong>无信息增量</strong>: 进化的指令与原指令内容基本一致，没有实质性的复杂度提升，通常利用GPT-4进行自动判定。</li>
<li><strong>执行失败</strong>: 模型生成的回复包含"对不起/sorry"等道歉词汇，且回复长度少于80字，表明任务已超出模型处理能力。</li>
<li><strong>输出退化</strong>: 回复仅包含标点符号、停用词或生成过程中产生的无效字符。</li>
<li><strong>模板泄露</strong>: 进化的指令中直接包含了进化 Prompt 中的引导性词汇，如"#Rewritten Prompt#"等。</li>
</ul>
<p>这种基于"进化-淘汰"的物竞天择机制，确保了最终产生的数据集（如WizardLM-70k）在质量分布上向高难度区间倾斜。</p>
<h4 data-id="heading-34">专用领域的衍生应用</h4>
<p>Evol-Instruct普适性强，可助力多垂直领域打造顶尖模型：WizardCoder针对编程任务进化，在代码生成领域超越更大参数量模型；WizardMath结合强化学习形成RLEIF机制，通过复杂数学推理链生成与步骤级评分，大幅提升模型逻辑严密性。</p>
<h3 data-id="heading-35">3.3 Easy Dataset</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/e6c87e8f05f542f483648a19a5b6b23b~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=WI7lTmu6Uah0Q06ejJ28gqs0Hwg%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FConardLi%2Feasy-dataset" target="_blank" title="https://github.com/ConardLi/easy-dataset" ref="nofollow noopener noreferrer">github.com/ConardLi/ea…</a> 12.9k⭐</p>
</li>
<li>
<p>官网：<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.easy-dataset.com%2F" target="_blank" title="https://docs.easy-dataset.com/" ref="nofollow noopener noreferrer">docs.easy-dataset.com/</a></p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fpdf%2F2507.04009v1" target="_blank" title="https://arxiv.org/pdf/2507.04009v1" ref="nofollow noopener noreferrer">arxiv.org/pdf/2507.04…</a></p>
</li>
</ul>
<p>与探索算法边界的Self-Instruct、WizardLM不同，Easy Dataset框架聚焦垂直领域模型训练的工程痛点。金融、医疗、法律等行业的高质量指令数据多隐藏在各类非结构化文档中，难以高效利用，而这款集成化GUI 数据工程套件，实现了从文档解析到模型评估的全链路闭环。</p>
<h4 data-id="heading-36">自适应文档处理与语义切分</h4>
<p>Easy Dataset的首要核心功能是其"自适应文档处理"模块。针对传统文本切分工具容易导致语义断裂的问题，该框架集成了多种智能切分算法：</p>
<ul>
<li>
<p><strong>Markdown</strong> <strong>结构感知切分</strong>：能够识别文档的分级标题结构，确保每一个切分出的文本块在逻辑上是完整的。</p>
</li>
<li>
<p><strong>代码感知切分</strong>：针对技术文档，自动识别代码块并防止其在切分过程中被截断 。</p>
</li>
<li>
<p><strong>混合切分策略</strong>：结合语义相似度与固定长度约束，产生既符合计算效率又具备语义连贯性的文本块。</p>
</li>
</ul>
<h4 data-id="heading-37">角色驱动的合成</h4>
<p>为了提升合成数据的多样性和专业性，Easy Dataset引入了创新的"角色驱动合成"机制。系统会根据文档内容自动生成"流派-受众对"。例如，当处理一份复杂的法律合规文档时，系统会设定不同的提问与回答角色：</p>
<ul>
<li>
<p><strong>角色A</strong>：法律专家（针对专业条文进行深度解析）。</p>
</li>
<li>
<p><strong>角色B</strong>：初级法务（针对合规操作流程进行提问）。</p>
</li>
<li>
<p><strong>角色C</strong>：企业高管（针对合规风险点进行总结性询问）。</p>
</li>
</ul>
<p>这种角色驱动的Prompting策略，使得从同一段非结构化文本中可以延伸出多条视角迥异、风格多元的QA对，极大地模拟了真实世界中复杂的人机交互场景。</p>
<h4 data-id="heading-38">人机协作的视觉化管理</h4>
<p>Easy Dataset最大的工程优势在于其直观的图形用户界面，这使得非技术出身的行业专家也能深度参与数据建设过程。</p>
<ul>
<li>
<p><strong>文档预处理</strong>：视觉化调节切分阈值，实时查看切分后的文本块，并支持全局标签树构建。</p>
</li>
<li>
<p><strong>指令</strong> <strong>生成</strong>：批量构建基于文本块的任务，支持手动修改生成的指令，通过标签树管理知识点分布。</p>
</li>
<li>
<p><strong>回复增强</strong>：利用LLM生成包含思维链的详细回答，并提供AI辅助纠偏和质量分级。</p>
</li>
<li>
<p><strong>数据集导出</strong>：一键导出为Alpaca或ShareGPT格式，并自动生成 LLaMA Factory配置文件。</p>
</li>
</ul>
<p>人机协作模式有效缓解纯合成数据的幻觉问题，用户可在界面一键优化逻辑、事实有误的回答，保障训练集的严谨性。</p>
<h4 data-id="heading-39">评估闭环与 Arena 系统</h4>
<p>Easy Dataset v1.7.0进一步强化了其评估能力，引入了模型竞技场（Arena）、自动化评估模块。用户不仅可以合成训练数据，还可以同步合成包含判断、单选、多选、简答、开放式五大题型的测试集。教师模型量化评分并生成评估报告，形成生成 — 训练准备 — 评估反馈闭环，是工业界落地便捷的数据工程套件。</p>
<h3 data-id="heading-40">3.4 技术选型建议</h3>
<ul>
<li><strong>通用对齐阶段</strong>：预训练基础模型先通过Self-Instruct构建广覆盖指令基座，掌握基础对话范式。</li>
<li><strong>专业逻辑突破阶段</strong>：面向代码、数学、复杂咨询的模型，引入WizardLM算法，多轮进化打造人类标注难穷尽的逻辑难点。</li>
<li><strong>行业模型落地阶段</strong>：特定行业模型采用Easy Dataset路径，以行业规档为底座，通过角色驱动合成专业贴合业务的问答数据集。</li>
</ul>
<h2 data-id="heading-41">4 有监督微调（SFT）与参数高效适配框架</h2>
<p>预训练赋予了模型博学，而有监督微调（SFT）则赋予了模型听从指令的能力。随着模型规模的增长，全参数微调的成本变得难以承受，为了平衡模型性能与资源利用率，有监督微调（SFT）结合参数高效适配（PEFT）技术成为了行业主流方案。</p>
<h3 data-id="heading-42">4.1 LlamaFactory</h3>
<ul>
<li>
<p>gitHub: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fhiyouga%2FLlamaFactory" target="_blank" title="https://github.com/hiyouga/LlamaFactory" ref="nofollow noopener noreferrer">github.com/hiyouga/Lla…</a> 66.1k⭐</p>
</li>
<li>
<p>官方文档: <a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.llamafactory.com.cn%2Fdocs%2Fdocuments%2Fintroduct" target="_blank" title="https://docs.llamafactory.com.cn/docs/documents/introduct" ref="nofollow noopener noreferrer">docs.llamafactory.com.cn/docs/docume…</a></p>
</li>
</ul>
<p>LlamaFactory以微调的民主化为核心理念，是易用、高效、高集成的LLM训练平台。它通过抽象底层逻辑，将复杂的分布式训练、数据格式转化、模型兼容等问题封装于统一接口，其特色的LLaMA Board可视化界面，支持用户无代码完成从数据准备、模型加载到微调启动、损失监控及权重合并的全流程操作。更多内容见<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a>。</p>
<h4 data-id="heading-43">关键技术特性与算法矩阵</h4>
<p>LlamaFactory展现了极强的Day 0支持能力，即在 Llama 3/4、Qwen 2.5/3、DeepSeek-R1 等前沿模型发布的第一时间提供适配。在算法层面，该框架集成了目前最广泛的PEFT算法矩阵。</p>
<ul>
<li>
<p><strong>基础微调模式</strong>: 全量参数微调、冻结微调、LoRA、QLoRA (2/3/4/5/6/8-bit)</p>
</li>
<li>
<p><strong>先进</strong> <strong>适配器</strong> <strong>算法</strong>: DoRA、LoRA+、rsLoRA、PiSSA、LoftQ、OFT</p>
</li>
<li>
<p><strong>优化器</strong> <strong>与</strong> <strong>内存</strong> <strong>管理</strong>: GaLore、BAdam、Adam-mini、Muon、FlashAttention-2、Liger Kernel</p>
</li>
<li>
<p><strong>对齐与</strong> <strong>强化学习</strong>: SFT、PPO、DPO、KTO、ORPO、SimPO</p>
</li>
</ul>
<p>LlamaFactory在数据处理上支持主流数据集格式及多轮对话、多模态数据处理，内置Native DDP、DeepSpeed、FSDP等分布式训练策略，可在中大规模GPU集群运行，还深度适配昇腾NPU，覆盖驱动安装、CANN配置及加速算子集成。</p>
<h4 data-id="heading-44">适合场景</h4>
<ul>
<li>
<p><strong>科研实验与原型验证</strong>：研究人员可以利用WebUI快速测试不同PEFT算法对特定任务的效果，无需在工程细节上浪费时间。</p>
</li>
<li>
<p><strong>快速领域定制</strong>：中小企业或开发团队需要将通用模型转化为特定垂直领域的助手时，LlamaFactory提供了最快的落地路径。</p>
</li>
<li>
<p><strong>国产化替代</strong>：在需要基于昇腾NPU进行自主可控的大模型微调时，LlamaFactory的NPU训练方案提供了详尽的工程参考。</p>
</li>
</ul>
<h4 data-id="heading-45">优缺点</h4>
<p><strong>优点</strong>：① 交互极致友好：LLaMA Board可视化界面是目前开源社区中成熟度最高的GUI工具，极大降低了非工程背景用户的门槛；② 兼容性极其广泛：支持模型超过100种，涵盖了当前市场上绝大多数主流及小众架构；③ 算法跟进迅速：社区活跃度极高，新算法（如GaLore、DoRA）的集成速度处于行业领先水平。</p>
<p><strong>缺点</strong>：①单卡极限优化不足：虽然集成了Unsloth的加速算子，但在纯粹的单卡极致效率上，仍略逊于原生Unsloth框架；② 工程复杂度较高：由于功能过于丰富，底层代码库较为庞大，对于希望进行深度二次开发的用户来说，代码的学习曲线可能较陡。</p>
<h3 data-id="heading-46">4.2 Unsloth</h3>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Funslothai%2Funsloth" target="_blank" title="https://github.com/unslothai/unsloth" ref="nofollow noopener noreferrer">github.com/unslothai/u…</a> 51.1k⭐</p>
</li>
<li>
<p>说明文档：<a href="https://link.juejin.cn?target=https%3A%2F%2Funsloth.ai%2Fdocs" target="_blank" title="https://unsloth.ai/docs" ref="nofollow noopener noreferrer">unsloth.ai/docs</a></p>
</li>
</ul>
<h4 data-id="heading-47">核心机制：Triton内核与手动反向传播</h4>
<p>Unsloth颠覆了开发者对显存占用的认知，由Daniel Han和Michael Han兄弟开发，核心是极致性能优化与深度挖掘硬件潜力。该框架舍弃PyTorch默认算子实现，基于OpenAI的Triton语言手写线性层、RoPE位置嵌入等几乎所有关键计算内核。</p>
<p>其核心价值在于消除冗余的中间张量存储：标准PyTorch流程中，反向传播需保留大量激活值，是显存消耗的主要来源。Unsloth通过手动编写反向传播逻辑，结合内核融合技术，让单次GPU调用完成多个计算步骤，大幅减少VRAM的读写次数。</p>
<h4 data-id="heading-48">性能表现与显存节省数据</h4>
<p>根据官方及社区的实测数据，Unsloth在微调任务中相比基准（HF+FA2）的优势。</p>
<ul>
<li><strong>训练速度</strong>：提速 2x 至 5x，部分场景甚至达到 10x 以上</li>
<li><strong>显存</strong> <strong>占用</strong>：减少70%至80%，极大地缓解了OOM问题</li>
<li><strong>精度保持</strong>：0%精度损失，通过数学上的精确等价实现优化而非近似</li>
<li><strong>上下文支持</strong>：在80GB显存下支持高达500K的上下文窗口训练</li>
</ul>
<p>此外，Unsloth的动态4-bit量化技术优化自bitsandbytes，通过动态保护关键权重，以不足10%的显存开销提升4-bit模型微调精度，在MMLU等基准上表现更优。</p>
<h4 data-id="heading-49">适合场景</h4>
<ul>
<li>
<p><strong>消费级</strong> <strong>显卡</strong> <strong>训练</strong>：在RTX 3060 (12GB) 或RTX 4090 (24GB) 上微调Llama 7B甚至20B规模的模型，这是传统框架难以完成的任务。</p>
</li>
<li>
<p><strong>长文本任务训练</strong>：对于需要极长上下文（如法律文书、长篇小说分析）的微调，Unsloth的内存管理能力是核心优势。</p>
</li>
<li>
<p><strong>高频迭代任务</strong>：在需要频繁调整参数、快速看到训练结果的场景下，2-5倍的速度提升意味着研发周期的指数级缩短。</p>
</li>
</ul>
<h4 data-id="heading-50">优缺点</h4>
<p><strong>优点</strong>：① 效率断层领先：在单卡微调领域，Unsloth的速度和显存效率目前处于无敌地位；② 零部署痛苦：提供丰富的Google Colab和Kaggle笔记本模板，且支持一键导出至GGUF、vLLM等多种部署格式；③ RL支持卓越：针对GRPO算法进行了内存优化，使其成为当前复现DeepSeek-R1风格推理模型最经济的工具。</p>
<p><strong>缺点</strong>：① 多卡支持较弱：长期以来其开源版本主要针对单卡优化，虽然可以通过一些非官方手段接入多卡，但成熟的分布式支持（Pro版）尚未全面开源；② 模型结构敏感：由于算子是手写的，当模型引入全新的算子或结构（如非Transformer架构）时，需要开发者手动更新内核，兼容性扩展相对滞后。</p>
<h3 data-id="heading-51">4.3 ms-swift</h3>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/fb205d3733df44018b318c1143d68368~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAgQUlGcm9udGllcnM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769991101&amp;x-signature=4WjcVkYJH5%2F5NtVzYIFDxrR6hGE%3D" alt="" loading="lazy"/></p>
<ul>
<li>
<p>Github: <a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fmodelscope%2Fms-swift" target="_blank" title="https://github.com/modelscope/ms-swift" ref="nofollow noopener noreferrer">github.com/modelscope/…</a> 12.3k⭐</p>
</li>
<li>
<p>论文：<a href="https://link.juejin.cn?target=https%3A%2F%2Farxiv.org%2Fabs%2F2408.05517" target="_blank" title="https://arxiv.org/abs/2408.05517" ref="nofollow noopener noreferrer">arxiv.org/abs/2408.05…</a></p>
</li>
</ul>
<p>ms-swift（Scalable lightWeight Infrastructure for Fine-Tuning)阿里是ModelScope社区推出的全能型大模型微调框架，区别于LlamaFactory的易用性和Unsloth的性能追求，其以工业级的深度与广度为设计目标。该框架深度融合ModelScope生态，支持600余种纯文本模型、300余种多模态模型，覆盖图像、视频、音频等全模态输入。</p>
<p>ms-swift实现了辅助数据标注、微调训练、EvalScope评测、量化及vLLM/SGLang部署的全链路闭环，一站式工具链大幅降低企业生产环境中跨平台迁移的工程损耗。</p>
<h4 data-id="heading-52">核心技术：Megatron 扩展与国产硬件适配</h4>
<p>在处理超大规模模型时，ms-swift引入了Megatron并行技术，支持张量并行（TP）、流水线并行（PP）、上下文并行（CP）等复杂策略。通过Megatron-SWIFT模块，该框架在微调 MoE（专家混合）模型时的加速比可达10倍以上。</p>
<p>ms-swift对国产化算力的支持最为彻底。它不仅支持 NVIDIA A100/H100，还针对昇腾NPU、寒武纪、寒武纪及国内主流算力平台进行了深度调优。其在昇腾NPU上支持基于CANN的底层加速，并能够配合DeepSpeed实现大规模分布式训练。</p>
<ul>
<li>
<p><strong>模型支持：</strong> 支持Qwen-VL, InternVL, GLM-4.5V, Ovis等300+多模态模型</p>
</li>
<li>
<p><strong>多模态优化</strong>：引入多模态打包技术（Packing），训练速度提升100%+</p>
</li>
<li>
<p><strong>强化学习</strong> <strong>族群</strong>：内置GRPO, DAPO, GSPO, RLOO, Reinforce++等全系列强化学习算法</p>
</li>
<li>
<p><strong>部署后端</strong>: 集成vLLM, SGLang, LMDeploy，提供标准的OpenAI API接口</p>
</li>
</ul>
<h4 data-id="heading-53">适合场景</h4>
<p>ms-swift是企业级项目及超大规模任务的首选：</p>
<ul>
<li>
<p><strong>多模态模型微调</strong>：在处理包含视觉、语音、视频的跨模态对齐任务时，ms-swift提供了最成熟的模板与算子支持。</p>
</li>
<li>
<p><strong>大规模集群训练</strong>：当微调任务需要跨越数十台甚至上百台服务器，并利用复杂的并行策略时，ms-swift的Megatron架构是核心保障。</p>
</li>
<li>
<p><strong>国产化工业落地</strong>：对于必须部署在国产硬件环境（如金融、政务云）的AI项目，ms-swift提供了最完备的驱动与框架兼容性支持。</p>
</li>
</ul>
<h4 data-id="heading-54">优缺点</h4>
<p><strong>优点</strong>：① 多模态支持之王：目前开源界对视觉、语音模型微调支持最全面、优化最深入的框架之一; ② 国产算力之友：在昇腾等国产芯片上的表现最为稳定，且有ModelScope社区的强大技术支持; ③并行策略完备：真正支持千亿级参数模型的并行训练与优化，具备极强的可扩展性。</p>
<p><strong>缺点</strong>：① 学习难度最高：由于集成了Megatron和海量的工业级参数，其配置复杂度高于LlamaFactory，对开发者的工程水平有较高要求; ② 环境依赖较重：在安装分布式及国产硬件支持模块时，对系统库、编译器版本有较严苛的要求，初次部署可能耗时较长。</p>
<h2 data-id="heading-55">5 强化学习与人类偏好对齐（RLHF）</h2>
<p>RLHF是大模型通往智能的最后一步，通过与人类价值观的对齐，模型能够学会拒绝有害指令并在复杂任务中表现得更有逻辑。随着DPO（直接偏好优化）和 GRPO（组相对策略优化）等算法的普及，对齐框架正在向高性能生成和灵活策略切换方向演进。</p>
<p>因前一篇<a href="https://link.juejin.cn?target=https%3A%2F%2Fmp.weixin.qq.com%2Fs%2F9f4mqYVGKNS-LhmHLl6CXw" target="_blank" title="https://mp.weixin.qq.com/s/9f4mqYVGKNS-LhmHLl6CXw" ref="nofollow noopener noreferrer">收藏！LLM-RL训练框架：3大流派+6大框架，一文搞定</a>做过介绍，这里不过多阐述，只给一个汇总表格。</p>

























<table><thead><tr><th>框架名称</th><th>核心技术方案</th><th>适用场景</th></tr></thead><tbody><tr><td>OpenRLHF</td><td>Ray + vLLM架构、分布式多模型分发</td><td>大规模集群下的高吞吐 PPO/DPO/GRPO训练</td></tr><tr><td>veRL</td><td>3D-HybridEngine、训练与采样高效重塑</td><td>超大规模MoE模型的高性能强化学习对齐</td></tr><tr><td>TRL</td><td>深度集成PEFT、Hugging Face原生支持</td><td>使用HF生态进行轻量级对齐实验</td></tr></tbody></table>
<h2 data-id="heading-56">6 选型建议</h2>
<p>大模型全链路已形成高度协同的开源生态，数据制备环节可通过Easy-dataset将企业内部文档直接抽离为问答对，并搭配Data-Juicer完成质量清洗；模型微调环节针对处理好的数据集，可采用Llama-Factory调用生成的配置开展微调，若资源受限还能结合Unsloth实现加速；智能对齐环节则借助OpenRLHF进行强化学习对齐，让模型具备更优的逻辑推理能力与价值观对齐效果，其中逻辑推理可达到O1级思考水平。建议企业开发者优先尝试Easy-dataset与Llama-Factory的组合方案，该方案是目前上手最快、工程化程度最高的数据—微调闭环方案。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[若依框架日志管理系统深度解析：从AOP切面到异步处理的完整实现]]></title>    <link>https://juejin.cn/post/7598838597559664674</link>    <guid>https://juejin.cn/post/7598838597559664674</guid>    <pubDate>2026-01-26T03:00:54.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598838597559664674" data-draft-id="7598734303174852660" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="若依框架日志管理系统深度解析：从AOP切面到异步处理的完整实现"/> <meta itemprop="keywords" content="后端,Java,全栈"/> <meta itemprop="datePublished" content="2026-01-26T03:00:54.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="_Joey_"/> <meta itemprop="url" content="https://juejin.cn/user/4402858757729463"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            若依框架日志管理系统深度解析：从AOP切面到异步处理的完整实现
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4402858757729463/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    _Joey_
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-26T03:00:54.000Z" title="Mon Jan 26 2026 03:00:54 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-26
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读10分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>@charset "UTF-8";.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:15px;overflow-x:hidden;color:#2b2b2b;font-family:-apple-system,system-ui,BlinkMacSystemFont,Helvetica Neue,PingFang SC,Hiragino Sans GB,Microsoft YaHei,Arial,sans-serif;background-image:linear-gradient(90deg,rgba(159,219,252,.15) 3%,transparent 0),linear-gradient(1turn,rgba(159,219,252,.15) 3%,transparent 0);background-size:20px 20px;background-position:50%}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{padding:30px 0;margin-top:35px;margin-bottom:10px;color:#4dd0e1}.markdown-body h1{font-size:30px;text-align:center;position:relative;width:max-content;margin:0 auto}.markdown-body h1:before{position:absolute;content:"";z-index:-1;top:-20px;height:100%;width:100px;left:0;right:0;margin:0 auto;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA6CAYAAAAOeSEWAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsQAAA7EAZUrDhsAABkLSURBVGhDtZoHnJ1llcbP3Om9ZiYzmfSQhCQQIbRQVQKI9CYC68qKriJK0UXcZRcINqStIoiIqKCi1NACQihBWiCkkJ5MJlMyvd7p7d759v989/sy34yTbIj48Atz71ff855znvOc971xDrB/EtoGI7a9Z8Aq+wZML0mNj7dE95NZ1OKsj1dHo1GbnJpss9OTbWJyonvun4VP1Njuoagtb+m0it4By0iIt8LEeMvkr8XFWcfgkA1gYDLf47i2PzpsyU7UspKSLDoctagTZ7Vc08MzClMS7awJ2ZaflBB78CeET8TYla1dtrKt2w5KS7YCDGzEoz2RqKUmhGw6x2bhuXyOp2BoRXef1Q1E7Lj8TIsMD1sbxu1kcnYSAX1810RMTUmyMB7f2j1gC7NS7byinNiL/kH8Q8a+2NRh77b32El56VaPAe0YeGR2mh2bm+FdMRqP1rbZe+3dFsHT35qcb/Oz0rwzo7Gxs9feYPLS4kM2h8lawee5hPmlJXneFQeGAzJ2F564v7rFzi7Msu3d/Xgjzq5g8ArX8VCNN2vJ28daey0zZJabmGCLslP5HOf+Oygr3UzDGOf+JxrauXfQjslJt+dbuuyMgiwmk+sPAB/b2Lt2NdoMZnuY21qHIvbvUyZ4Z0ZQiXGrWjvsmPxsK4R0nmHA8ZCTQvxVQn5eRipklIBtcVbV1WtHYsjati47ZWKuTUpP9Z4yGk/xDBGe3v1mW4/dOrvYO7P/2G9jRSjf31FnXyaUXiB8r51WaJkM3kcfOSa2FR6qarIenooTLQHPLcC4mYThyw1tVpKWYlVERlZ8nC3Oz3Jzdn1nn5uvQ8OOHYvhR/CvsqffJbkCkZTvcYZ6Z0WTfTovw5Y1dtjXp+TbFPhgf7FfxpYxuMfr2uwo8rEtMmwXF+d6Z8wGmIR2PLyjo8cqOFffP2SLGexJEJCP9R29thkPXlpa4A5Y3w/jmuVNYYwO2QkY7WMtz3mVcE1hkualJdmSolzX8GnpKd4VZq80d1o7zN0RdWxGaqItgbn3B/+vsasgh/UMNBOvzYMZDxtDKp289KGaVguFQvb1yQWWwuB97GaSXqUUnVaYbSUwrDCEBz/C2CM8EhNrP13fbkeSh3OJgCAe2N1CWXKsGOc6TOr5U4q8MwYhDtkTda02MyPN+nnGBQEH7A37NHYz5KOZVv08qyjbSseEzKauPnsMj98wc6Ibcj5UUv7M8QWZTE52jEwGOVaD8U1Dw1YNWX0qM8VKyb80L/TrOPYOzH4KBJQTrK8M7+7KZjuM63sHBt17FubGoibCuf+tarWFGUmuwWeT8/vCXo1tZOYeZcazCaez8MwEzzM+HqhqtiJI5twxL1jeGLYk7jmKMF1JOCbg6Qj5nAdRqX7q3BYm8VAmQvW1lfcMc58IT95uIA3q+gftrDHPXUXJWkVEHJme5Bp5UmHsvIZ/O3l8ECE/FWcsItX2hr0ae8O2Wjs+J43QTbOZzGYQ/7Wtxq6eXjRK3r0By4YJ6Ty8EiYSJqcm2eGeV4Pox/ANENJR49RiEdfqcLflUJrEBZqgxYHrBjn2ExFURqKdVETN9YirJxKxR2rbrYeQv5ISmB6IsiDGNfZGWPeMgkzr58xnPaJ5p6XDZPKz4T77wayJ7jGhhXLwanOHTWBgq5n5q6YUwNJ7l3kKcRl7OJ7fF56l1GzvHbSD8dghTPi0wIRfv6XafjJ3ssv0PnZQ7nZx/etwzO1zJ3lHR2OETTw8x0tOx1AN3De0D7YV+63oGthjaJQ5Ur7eVVZjcdGInUyuaT73ZWg3efV8fZs7cc2E777Qi5eunVbghvPPymrt/krKGfcLd8ybYjdxrK6333Z09rjHZkNuLYzz0uIc+xWCZzz8nbHbe4dsY1e/XUOY+nimvtUaSazv4jXhaQasSbmYmpuenGwHZ8TKggSEQm08rMD7ahBOoExcMqXQegjnZ+CEvaEa1ZQUQkt39dj0zDS7krq+ARmpdws/nlNqD9WFbWN7l5u3wr9MyrcXKUsqWy3jTOaoML4DdaQ83YIoT4VYpEXvYQZLmbX5SLohBrgOj186Kc/iKTUPUhq+Rrm5ekOl3TWv1Mr6hqwbY0VOQXwEo+Moq4Z47q5qsU489G944LyJOW4LOLZOKtT/iI6+nGe/0dhuEd4ltj2NmiuCU4hnk5fHIi7+RK4uTEu0e+s7rAiRcw1CYy3OejvcYz+eXeI9MYY9nu3lYZl0KavJJ7Vjibzgjp319rUZE20j7CkJqFr5JQYgQ39f3eQaKpQk0afy8nl4uBzvjUUTRk7k3iebOm0pabDiyFn2XGu3dRME41CGVeBVqSiVnc6hIUpekp1VjHLDSOEcQlui5W/U8C7IKREjv1Gabw3wRwUTvpv7jybPtzHmIPZ49q6KRjuccqBQVCOtGvqXhrCFUUXJzOYSHt7Kw5Ix9H08dSje1o1JyL73IYXpEMmE5CRbw6wuykx2pR+Pd6/J4JpLiJKV6N9OnrcQNfQ0Zem6qQX2MmFXyWTE+DMO0kGx4e08DEjnXbsYuOq7niHB8jdY/wQ8Srm2XCZZUrOakF1CY5EKX0h93Tu/1J4kRdbDMT8MamgZK9xe3uDcvrPe++Y4f61rcZr7B53rN1c5N2ytcV5rCrvHt3T2Og19g+5nH7dvq3bqunr4NOwgK2MHA1jeEDuG7HNuLmtw7qpocl5t6nCPvdTQ7v4N4u3WTqeyu9cZHIo4f6lqdFoHh7wzMbzDeeGv3Hvzjlrnh2W1zofhHuftxpFn3VFe7zxS0+p0DlKVPbhhvBxhvwiFMgfP+mjHA08gEC4pybeLyK1iZldh8zC5VJQyUl8l59KZ0WJk2xaiYWxNrkXXJhA8r3PvZRur7ZZZRfadaRPsfiTmX9HGajC2tXd6V8dQTMhX0h8rNdJx9Ra8F8SbRNLzhPRnJmTZIUTYueTyWxyr7uv3rjC3OkzE8495oS+4xq6D5WoI0bO5WVCOSerl8rIeBrOI/Hkaw6ME5W1zSuzx2la3CRdWi3zIG+FDBvUp9LMgI/vggUmE7KkT81yGvOOgEYa/aUahhRAF5xLec3OzbF1r2O17BbVxIi7hzJIC64IYhXdJA+nh/5xVbOmE9J0QqjSxWk0pp37M2YEtgjS8GpimACu7xkqxdKJ6fEXyYl2Lre0ZtC8yELVewtWUnbfCPIhrvgDFz8WI5yhJKgcnFMZWEFrwhgzo5uWDDDA1oGSOzcu0xfx7vTlsv6posIMpJ6cGWPiw/BxL4PU7vbrpjgf8bMdu5OYwOdhm83DARUSa0ELknYIeEAaILuWxlhGa0M8+EuJCrpJT+ymENhN60pXBxa3LZ5TsucnlGaCmIEQ4Evru91yuz0xMtKaeXluI5zdh9Mm8vAlBn4aR07X64EH3vEKdXQkZJXPP/JxMvNRpLxEtHZ5RQgmNewnpouvVTpYTHdfOnmy5kFUGnpRTfEhXD9DiBdFFJB0/YWS9aj6pmc89r0BaQmgTRkgI+EsdKsYasJZOBF+QqTH474NK7LbyBvf7W+RgOxNyxfQY2/2hrp2+NkroxrzrQ55fSZkpJIa28znCgF6rb7H1hOSslATyvNflAh9pvHcX3lVE/Ya8FjTJIexa2Rq77nfU96unTnD7aME3+TAm6BFKYrPnqCNIqV5sq0ZGCiEV+Db+qWMQqpFgb5KPx48R6omeDl2EuP9DTYt9iGA/f1KBS1w/La+H4ktsSmLItvZHXLUkrCeflVtJ9DVVg1H7+sxiGvVM975rZpfabuqHVhuP5F1vewav5O8GamUe91yDanoYw47FWzC929O+DJnKA2opFY1Rjru5CE7kOcO0jJtQVUIynzuZEMeb+1CEOFXN8iFSGeRpCm1BTlJxVg49Azm819SO7Bu0axEbwn27GuxMck+TMQHDP8fn48gfDVIL4R8xKVPJ73MQBUIfA/Z54LMw5vmlE+w+VFo2A78X/SsyPA/RMD0z3e2qVLtfo7aeBslpMX0N0TEnLcUlKym1jyBFqSohmYntI5enBhYB9CY/2kNarhwJhNiMtRGyWnkQdKaCFyQwgydjyNUw4VchKxXv2/DoKdC+lkQbCX1NlKCGvJiBJkSGbCus6jfo4yGBNySgr+u7e20BCsxdVAcFlJ/tHd32+cIsNxSXUULUUx+dg/d47g7OPYFw2MxkSuyMwLHVTI6PBN6dS8Sppw45zHJSgDXV3aQzmz40Z6fDgBfiAXU0uZxby2zejee+j3eltoQMzhV6qSBogXwrEXDj7ElWxUQ8RrnSaoU0dxIsKaiMvMykXTu90NqJsGHP4z78SdLigUrLKat32nFwy/E07pfDFRdQ/7N5r57pQ1482uvWhMGhQcviGkVrKDUp0ToCxfhQal5n4Hs/g1jOgH4LWdwFOd1b1WzHET4vLZppv+Czjxo840OrDlG8jAJzv2tp5mLK1dsU/lfIOeWy5NxFxfl2BoYImlQtx9QF6mJRQKBsQYYuO2yaLYPBUXvu/VqYPxtHhNy7Y4hCkNLGPtKSklzCVKSHtMQxcqm5Kw1DhI2PTGZtcGDAvoLQ/u7MifYtWFBlxz2H9zo8RkwKzC5UYiG+p44ccqE62YAxLeT/TOpf8MXx8Qk0IJFRY1Go+viQVJpE5Ehjf49xfAZeqGIy/7us3nqxwQfCkjZypPxobVr/6YpQHIalUvuCyEwbSXC9PC8QnkFcXlrgLpoLIhIfKuaqlQkYIAwQnr/f3eyu7KttOw2lNpv8/BPHyjzVNER3o72gvEBKqRMTflndbP8BMweRDyeciEj5bFayFXqTLzheivgYJC0jwzwHa0MDDEotm48ndze5BBBElAnxxcRYHAFh3FfZaA9UNRmC354kNwUx8eHkmVj5dcTE5ZMnuEyr1QqlhtaJLuOYZv4v3KNo0TKrGPUZ1NILPKuWcvVn5Trv10SMB6h0j/ARMnlOuafCBIfnSWEx/Raif3HDzofYMM31dOyY9LBaLK3TjoX2fEqT4+2qaUVWSTQvyM6wC8nNJyEetXIyuLKrx04P7MKNnbJZlKUtNAIHo7i2dA/YU3Vtdi5l6jCepXy8hOedSSSsI8/HQg5Q+gxTKXwkMHkbESo+hjG0lbRRzQ3Fc5LOzDuFhs3Ptumpie7ilRDhlEJOq/hjsZljCxjkt7fWuPS/EekpXMggJQIk0G+eN9Xu2VmHWIkJe0nJRN4ptBBit2yutG9ML7J1DHAxebiAMrZ4VZlduqGS8I2tJc2iborUxmIN79c+kTovFxivPvrcSaP3n7RSKYTUmKt4N3rMOcw4JOneD3sP956jNaMglIeTER5Xbdlt15Tm2W10NEsYrA/N5JLCHHsR9tSqwxq08G3bqm1ZTbOtagnbo6SLvH/VzBL7W7jPzqFea0LmMLFzUuLtdwumuO3i1Vtq7OK15Xgw3l1PDmIXak+6QBEkvB9YJIzBcc/L20JIYaSZ/qAzVm5Ut4oowk3QehC+N3xo/1wTqt7zsYawfX9no9XjqdPXVLhrwyo/wucJYQkE1e4j8rLcBuHUItQQKqgMXb6LGvxFQlXw33AdZLR0V5P9Fr29lP73scNnosoyvdWPv4fPJ+uJrLVtMakqaL1M1cTvv0OLIZE6wk2a2IcIRUQh+DaejpdcXepBa7bKDRGM9PIVxTl2EwarZ72rooVuY4RQtMypdk6e1lLLehhY2lt7QEd7WxlCDvdIli6E9B4+ZIodmZEMccUGqgiZOqru9tkR3iJ8nCcXRWRZCSPMLPEjlx2LjQL1OM5qKAm+vhSuRqSfV5Ttrg8FdWcrnhMqCTex7DEM6qTsVEuM1+8hovaHQ6e6a1Fz0xLd3nUt4ToWWuzWNkhcoAIIjUx2ZpxjLzWF9+SYmngR1lok4TEoJxGfuijhI/7OICoFmadl2llcL9b1oRVJtbD+JLlv1KrhHG5811t9ELbzgk14ICUwqE+TDzftqHPz98vUSy3jSIwP8dCpkNqLDPTx+rArz4T5qLG3G2PrvJKKPoLBWE501NC3ilUX5mVjVIb9nIbgWcpPMiSXjbcL8K62UkR86m1/yfkSeMaHFuK04X0CE3J6SWzFUxw0BSNHlSzi3RmIRJwHq5udO3c16quLp6sbnffbupxbt+12vzOrzuvNHc7ycRbIxuJHgYU7YSASdQgxp7qz2ynv6HJeqW91doa7nLruXof+17sqhhu31Xif9o7HalqczV29Dnrb/f5EXZvzdH27U98/6LR5i3N0UM5zjHU71/lwjRWWltU5CAIn7F1MqLp/r9hQ5RoaxG+qmrxP4yNKcfsFLwuiprffeb2l03m2scO5h3Or2rudzjGrhk8x4Cqu2xcexilBvNEcdi5Yu4tKF3Ue4tzPy+td5/1md4tzw5iJ27NuXEYobYUdlb8z6GTWkdxaCvk2zHjd5mpKQ459mv5TkAp6mQb9Aq9HHQ8S6mrZnuc6vUG6WHusIhCJGNXl9byvnJyaiE7+Eoz8c5TYNQiUveENGpJpcIJ+biS8R0+rlcazGNs7pKB+zPLTOSX2KNWhlDAf4r2Spj72JORB5OyHULX+dlD/FOky/HFy5ygYU0sey/i8moeqdunXK1qC3RuaMOYHlI/raQMl3M+EeTV5WxD3Km8a8PkM8nr648sQ9+esKbf5e/nxiKBfAOQkxbv3SU9LYmqPV9V/Pn+V20VwTyVjTqCI6edEQUOFUXs9WmfSll8DyX2dt7GlnwkswaM3l9XZ0oNK3MTXbxpOV2sGk69s6XCJw4cY8KbyRrt9TrHt7Bm0rRBQe1+fHUWNfaapU0KbqxzbORC1M/LS3dJwIl3KOrwykQG/E+61q+isgniztdOKqNOziDgZqZIzFwPvqGiyg5NCtoCqoG5NxHhPZTOsnORulKskjoKMDeLuXQ3OmnC3syxARFXdfc57LR3OrdtrvSOOs55rnqhtcdoGhpxHdjc5EfJUuHZTlftX+G15rXPlhkrnLe59F7Lz8VGHdg8c5y2OLeMZ126qduq9XC3v7nd+FchLvYPJd15gPCu8XQnh/qpm59WGVudZzvvQO97kXTcGxhnEuJvR39tWY8cwK4uhcikk4a3Gdstg9l5B2t0wfaTdWkEou5vCPOV5PH73vFL3+DfXltnh6OxjkJD6Wd5F3g88tMe6CW/7YmI99VIL4u0oqUK8ocW4d8hFrXMVoOQU8s3U97MnjvDD/XRYkyhHM1MT3GVZQR2Tdv70U8EbA5vlo+CaPAaaSWoZXm50otGodxQ6L6txGKxzw5ZYORrBsPPrykZKQIy1n8bTjwb2fO4Te3ue7x6KOKvaYns1wtIddd4nx3mwot55qyl2360cp81zurg+CGqwU8v4/Of5uAVvPgObrwvHomY8jOtZ4fXWLnefdHVXv9044+8ZklCx75DXwcV1Sb27y+vInUQEuVYSaMgRJYfAwtoj0raFxIUW1A8nz35f02qLc9Lc9lG7CBkwtUR7bf+A+5uL6ehnH9Lat+5sIEfj3Cbj3NKRvP7Rjlo7FSmqavKvpSP8MRZ7NVbQYLSkqlC9ZW4sPH18gBTcORjrhMWmQWzFmK2UsvO90qQ1oZcI8UhkCLZPtRqMy0NirobAvjIpb4/sW06qKGyPR2oGIdlazjOOTk+kLYzaaYGSp63Wz6HsXsQ51wd+LTAuZOy+8GBNq7tF+IOdDU4kENJthNID5YRafZtzZ3mDs9LbRgzixcZ2l1h83OKFbDmEd0/FiFp7DWHgp0AQGzq6nf8hPF+oa3EehOz0ziCWcm4NpBRMhX1hn571oR9wqVVSDVPtUi32sQ0vbu7scZdY9aOt2ZSEL9BEBIW+dv20AKDd9/ep09oimYqHpyImkKDuRllS4PrlHNuIqDmCJmNJQba7q1joEaUQJuR/WdXsLrJrq/L6cdJsPOyXscJ7GLKqo8cOpqhrO//yQG6oS3kZwS9xPkRB3wi7diFMtDN+PLk5m1ath+8f0Fy80dbjhvVXub+U5mEqeal27UP+dWpPlknNxW79Ak6/7Tg3UMOF52j1xA1qK7Trd6nXC+8P9ttYQcumIonLSnJtBdJNa77axw1C2x3qR4Wqnj73x9f6MbV+CCYFBZO6y51aSh3gzVrsmwzJnULEbCJC1oZ7vIZ/9Iqmfvn2u5oWO5n8fApxcuWUApum5diPgY9lrA9EtvUNOzYf8vqAcJPsU5iOh7XtXQgt2uZhjKU2amF7HQyfEYWcZk5yQ1RDKNrLcq02k/9IGmldrB93KiokPw8EB2SsoKWXO5FmxXhlckqi+3vEUvLqwok5PHVkIWAszlqzy1p54zuLpnPZ3q9bod08JlLSb5DrNxDm38Sbvsg5EBywsT7oH+3XNW3uasGirFSrxRNdCllKiPZHZzJYLZb5qEcpae3pxMCuu9oibS5/QCOiLcYUrp+MmtJeURjFdVlxzqiae6D4h40NQt54HyGv3JRo10aVfv8YhtC0pSlVKcPFuxIXahr08mzCO4VzMlLSsZuomZ+RaucU0rXsw/sfF5+osUFonWob/7TrLdaUgdpV93fl9X+VIC0Y6tek2uI8OD3J5gT2Vj9ZmP0f4IM4iY7RQ5gAAAAASUVORK5CYII=) no-repeat 50%;background-size:64px 64px;opacity:.84}.markdown-body h1:after{position:absolute;content:"";width:150%;left:-25%;height:50%;bottom:12px;border-radius:50%;background:linear-gradient(transparent 80%,rgba(77,208,225,.8));background-size:400% 200%;opacity:.6;animation:h1Animate 6s linear infinite}@keyframes h1Animate{0%{background-position:100% 100%}50%{background-position:100% 50%}to{background-position:100% 100%}}.markdown-body h2{display:block;border-bottom:4px solid #4dd0e1;position:relative;font-size:24px;padding:12px 32px;margin:30px 0}.markdown-body h2:before{width:24px;height:24px;left:0;top:0;margin:auto;background-size:24px 24px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAADGklEQVRYR81X32vTYBQ999s6mFjQgQ+DrbHiVFZYU4cDcQ/6pGhTFVYFEXGi82H+Bz448UnEF1Fx9ccEEcXpZE3d5tP2ooKiTacTHaLNpigMHDgnU9tcSbrWrkwWR0sbyEOSe885ObnfvV8IRT6oyPwoLQHBx+OVM5WJvSyEVAhnBOjt7yU/+/rr6r6l8TMO+F/EN0JQhICqQpD/xaRpcpAc9tS+M+9lBCia/oqBamK+zeDuQogQZaKJk3wcQjxSva7tGQGB2Ke1zIk3DNyMyNL+QpCnMQOaPsDAVuGAp9cjvbYc8Ec/bCYSg0zoiHilk1tHxqsqEsYlML4kjIpT/eurJxRNPweQU5VdrWaOEo1fgKAVbBgXIz73kF3R/ph+ghgdzMYWM29eAWlBJqgZaFlFYtC6nhWpaDqnSGlIlV1WjJ3DloDNgyNLncudqgX//Ucg3LxuStHGuhi8pqKCW3rqV342rwFjRznKm+/LNaN2yC237ThgF2wxcfMLeP6+ncrKzoPoKTGeLQbYbg4TNoC5iZPJY5HGVRdSNZAWYBclD3FzBQzrR8hACAKdzBzKA/4/IYioDQaOskBbpEG6PO8qKKSAEi3CnEb0Pw4oMf0OmKbTDWqh3Lw6EIiNBZi5lxh3wz4puBD5ovqAMvxhHSdFKxE1CQe3m/07TeTX4lcJdAhE+1Sv65Z5P/ByvIGTRowIZ9igbtXnmrOsbTvgj+kHBNMuBu9OdVw8EeU4nC1A0cYmAHZOTRrLhra4Z8ywnSN6vZHAFTA2WnnMfQB3qz73ddsOZM8CACFDIPSgQXqebXEgqgeZcAeEe6pXasm1f8ew3igMtAHWac0Uc/jYdyAaP0xEBwFsmgUPqbJ0NE2UKj4EGcahiOzuyhagaHpnmtgcVgTcCMuua7YdyAHbA3ArQNscVFbb4635aD6fnYaTvxxi9UNP7ddMXaRWVBdAcaLk6bDXPZCNZ9uBXEsDUX1T2Cc9yjig6Z0EHg3LK8/aqf6MwJKchkXfks1+0+JtSq3qLPa23BRR1B+T/6nkfMaW1r9hPt/MLtYfTLEpP+T9FNoAAAAASUVORK5CYII=)}.markdown-body h2:after,.markdown-body h2:before{content:"";display:block;position:absolute;bottom:0}.markdown-body h2:after{right:0;width:400px;height:10px;border-top-right-radius:24px;background:linear-gradient(90deg,#fff,#4dd0e1);max-width:50vw}.markdown-body h3{margin:30px 0;font-size:18px;position:relative;padding:4px 32px;width:max-content}.markdown-body h3:before{border-bottom:2px solid #4dd0e1;width:100%;content:"";display:block;height:28px;position:absolute;left:0;top:0;bottom:-2px;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);background-repeat:no-repeat;animation:h3AnimationBefore 2s infinite alternate}@keyframes h3AnimationBefore{0%{width:28px}25%{width:100%}50%{width:100%}to{width:100%}}.markdown-body h3:after{content:"";display:block;width:28px;height:28px;position:absolute;border:2px solid #4dd0e1;border-radius:50%;right:-15px;top:0;bottom:0;margin:auto;background-size:28px 28px;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABRklEQVRYR2NkGGDAOMD2M4w6YDQERkNg+ITAppcfY/8zMv3wF+NdTUrZQpUQ2PT6cz8Dw/8CkMWMDIwNvqK8jcQ6gmIHNN19EaXPx1XPyMCghrCUKcpPlGc5MY6gyAE+Fx52MjL8j3cU5a1UYWXtZGBkEAVb+p8hxU+Mby5NHQCxnKEMaskzJ37uFmUetkmMjAzrfUX4woixHBJlZAA0y2EmPPYU4enLkhGeQIqRJDsAh+UgO7duNpD3IcVykkOA2paT5ABaWE60A2hlOdEO8D3/4CMDIyMfWvySFefoaYSoROh74eFXBgYGLiTNVLGc+BC48PAnAwMDG9QBVLOcaAd8P5ox+x/jf5AjGLgYfnwnKqv9/8/PwPO/kFF/MSj0cAKiouD/0bgYoixFU8RovWgJIX1EOYCQIZTIjzpgNARGQ2DAQwAAvHBaIdB7zxsAAAAASUVORK5CYII=);animation:h3AnimationAfter 2s infinite alternate}@keyframes h3AnimationAfter{0%{transform:rotate(0)}10%{transform:rotate(0)}50%{transform:rotate(-1turn)}to{transform:rotate(-1turn)}}.markdown-body h4{font-size:16px}.markdown-body h5{font-size:15px}.markdown-body h6{margin-top:5px}.markdown-body p{line-height:inherit;margin:22px 0;letter-spacing:2px;font-size:14px;word-spacing:2px}.markdown-body img{max-width:80%;border-radius:6px;display:block;margin:20px auto!important;object-fit:contain;box-shadow:0 0 16px hsla(0,0%,43.1%,.45)}.markdown-body figcaption{display:block;font-size:13px;color:#2b2b2b}.markdown-body figcaption:before{content:"";background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAGFBMVEVHcExAuPtAuPpAuPtAuPpAuPtAvPxAuPokzOX5AAAAB3RSTlMAkDLqNegkoiUM7wAAAGBJREFUKM9jYBhcgMkBTUDVBE1BeDGqEtXychNUBeXlKEqACsrLQxB8lnCQQClCiWt5OYoSiAIkJVAF5eVBqAqAShTAAs7l5ShKWMwRAmAlSArASpAVgJUkCqIAscESHwCVVjMBK9JnbQAAAABJRU5ErkJggg==);display:inline-block;width:18px;height:18px;background-size:18px;background-repeat:no-repeat;background-position:50%;margin-right:5px;margin-bottom:-5px}.markdown-body hr{border:none;border-top:1px solid #4dd0e1;margin-top:32px;margin-bottom:32px}.markdown-body del{color:#4dd0e1}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:rgba(77,208,225,.08);color:#26c6da;padding:.195em .4em}.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace;overflow:auto;position:relative;line-height:1.75;box-shadow:0 0 8px hsla(0,0%,43.1%,.45);border-radius:4px;margin:16px}.markdown-body pre:before{content:"";display:block;height:30px;width:100%;margin-bottom:-7px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAAAdCAYAAABcz8ldAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAhgSURBVGhD7Zp7bBTHHcdn33t7vvOdzy+ITVKDU0xIKG2ABCPTRCCaUiEVKWoqRJuASAhCitRCVKSoalFUKZBiSmmFRRJKRUnUtIpo+aNqGgwoOCmuFUIRzxjwE4zte+97drYzztji8HPvtkit/PnH+n1397Tz+83vN/PbMZhmmmmm+d+BoX8n5diihcGqgFQf5vk6BMAskWUlw3GyFnIvtqWSf91w7mKC3npfOLX7wYeiIa6BBWCOLLFRF2NB0JvIOP/80YG+k2ev6S699b/OzOfKBW5l5KsgyC4DCFQDnpEAdE1goc/dlNPc/Up7P711UiYNSMuyxeUzZPnHgGHWh5XADEkSAcdiN+AnEXIBhBComgFU0/xQR+jnj51sOUMf9Z0NKyL8S9+JPBEN8zuCMrsqGOA5QWAAyzLAxe53HBeYFgJp1c5Cx33nyIfpV3e+22/Sx32nev/sMCgVnmM4bjOniAtZWQAsz315EfsGQQc4hgWcjHkCmOj1rheuNn95cXwmDMiVp5etC/D8m5FwUWVQUYYGPh6mZYFUOgsGVa1pXvOZzVT2jRuH54RM230jEuI3RcIiL4l4UkxAJmuD/riVsqD7ct2m9nep7BtVTbVfZ0uE/UIk+CQflAHDjf8+Lg6MldYATGpH3c/Ul7p3dWXppVGM6eElJSHmnQWPbSlRlN1lJcUBjqNRnwJZVQO3B5P/uq5rK1d90pakckFcaKp5UJHY92JR8YlwkUDVySEZfGfQdO7E7Z8s2HL9TSoXTPXRud9nA8IBqSwcZgWeqpPj6BYw7yTbXBN9q2v9lQEq5zBmWA8vWLCptCi4tzwW8RQMQlFQATPLSh6vCSh/plJBkMyQBHZfWYnkKRgEktEVpTJXERN2Xzo4ex2VC6K6qXYpF5b3ypVRT8EgcAERSJXRbwCBOTFzXblM5RxGBaRt+ZPYA+LO0mgxz5K1Ig+UgAzKIuGnz39z6S+olDeaibaXRsU1RUFvgx+GwTWgPCaDgMw2XXpr9gwq50XV0bkxJiYeEiNF5cwE5XsiOEkAUkXkUW51SSOVchjl8WKef604XFSRbzCGCYeCoESStv/p8QU1VPIM3knNDynctnBRfsEYhgSlNCIGgQv2UCkvGIHZgteMh1nBW9W4F16RAM6yDVV7amZTaYQcr59cuuhhWRTWBvAMLxQGeyFSHOLnh0MvUskz5RF+fbRYDEy0mZgqQYUHOLhr//b6rGoqeaLqQG0pw3PrBbyA+4EQUkRmhvgqNUfICUipKK4OKUqIJVPKB0jpEhjmWWp64jdbKmVZZNYogcJm493gsifOqhDyeh9GYR/FM7sW+DA5CKR0MSK3tvKZkpwB5gRE4tjFEr7RL0iWBGV51vHFCyupNGWWPqLgnoer9mtyEGSJAzwLllDTGzyznDjRN/CwOFkoFb4bm0eVIXICgpvdGoEvrF7fC89zfLkkeV5HbOhWiTwTpKYvCAJLGshRdXtKMKAWlyxq+MPQLk1h66g5RE5ABJYNFrqY3wvJklJRUKg5ZWLFXIA86yek2uDOPkBNb3CM5Pf7DL2QyIrUGiLH+xC5Bmmm/ARnHUhC6PnzxWDK0RH5HuIjZGy27erU9AZ0dTIWXyG+NpBBrSFySxZw220IqeUPFoS6jVAPNadM7yDsgNB1qOkLuAziMYIb1PQGA75wIaKGPyAb+9oF16g5RE5ALIQ+tSyLWoWDEAK6aXW3JlK9VJoyx1oyvVkNdvo5KXXDAVkdnaKmNwx0xjH98w3JNmTCm+Bc9hKVhsgJSI9pvp9Vdd++jmq6AXB2/HHrhcs5aTkVDv0DFzoHvKdq/mQsKX/4t7KJLDpOJW+IbAvMGoMkxfwAWZB8DT7W1diTE+WcgKz6pK1bs6z3daPwmJDsSKt6ZsCyjlLJMz0DsDGZ8SdlDROBjOb8YeWOjptU8kTXusuaazu7oJrfEnQvdkpVcUn6PTVHyAkIIW7br/Unklni0EJIZ1WgGsauZR+fvUglz6zY0dGfVp09ybRNlfwgi3k8YSbvJJ29VMoLt9v6rZVQL7hOYUubndHJGclBtzn1byqNMCogi09/2nFb01/oj+f/5TyjauBOKtPcZ1r7qZQ3f2lRfxZPWi2anp8TSDAGExZMa2jr8u03L1M5L7q3Xc+iAeuHRl/ScvPcjSLDBnZS/cjtNHd2v3171Ewbs9N5q7Pn4otVMx3btBsCsoRbk1FxG5dMVgMDqfTpXl1/tuFMa5zKefPROdX59qLQBwLnNog8Wy1OcjB1N+QEsW/QsFNZuO35Xb1v98QLX4/Sx+O3wqujrQ6013ABUWI8+AaqBjAH01+ghL22+5X2PirnMG7r+esbnae/V1neauvGSoHjigTcVU7UGFm2DeK4ttxKpQ+mLPvl+o/PjnkAkw9HTqSMmVHhyAMx9iFcSh/BHTfLceO/C8mKjApBf9zszGhoY92m9sN+BGOY9AeD7eGniv8OTaOB4dgyTsQd9wS+IQu4lciYdkI7CLrNH3Rvbb9FL41i0tbzVP2iWJkobpN5fmM4IJfJskTP1Bk8A9HQmbpmGDBrWqdVCN/Yd7PjxKGOXn+bmbto3feVVcVB9qehIL8EJy8nChwgr0O2xxBnhGU5eP2CfYbl/m4gBRsbtneMORP9oGpjpcCsiKzHHfdOPiQ/wMniyFEu2dbiTQCAeN/vavC466BGYLttXc9fmXBXMGlAhiHHur+sq6uPiUI9z7CVHMPwBnLSuuN8FuC48/Oaz1ylt94XfrW5ouyprwWfYRkwNyCyYYjwkBHows1fa+tV/fzGxlv39b9gqvfPmQ+i/HK8KlcBjhHwfl8HEHyOd1JnuzZd66S3TTPNNNP8/wDAfwDG7G0m9LKBpwAAAABJRU5ErkJggg==) 10px 10px no-repeat;background-size:40px}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{color:#4dd0e1;border-bottom:1px solid #4dd0e1;font-weight:400;text-decoration:none;margin:0 4px}.markdown-body a:active,.markdown-body a:hover{background-color:rgba(77,208,225,.1)}.markdown-body strong{color:#26c6da}.markdown-body strong:before{content:"「"}.markdown-body strong:after{content:"」"}.markdown-body em{font-style:normal;color:#4dd0e1;font-weight:700}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:rgba(77,208,225,.05)}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{margin:2em 0;padding:24px 32px;border-left:4px solid #26c6da;background:rgba(77,208,225,.15);position:relative}.markdown-body blockquote:before{content:"❝";top:8px;left:8px;color:#4dd0e1;font-size:30px;line-height:1;font-weight:700;position:absolute;opacity:.7}.markdown-body blockquote:after{content:"❞";font-size:30px;position:absolute;right:8px;bottom:0;color:#4dd0e1;opacity:.7}.markdown-body blockquote p{color:#595959;line-height:2}.markdown-body ol,.markdown-body ul{color:#595959;padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">一、系统概述</h2>
<h3 data-id="heading-1">1.1 功能简介</h3>
<p>若依框架的日志管理系统提供：</p>
<ul>
<li><strong>操作日志</strong>：记录业务操作（增删改查、导入导出等）</li>
</ul>

<ul>
<li><strong>登录日志</strong>：记录用户登录/登出</li>
</ul>

<ul>
<li><strong>异步处理</strong>：日志写入不阻塞主流程</li>
</ul>

<ul>
<li><strong>敏感信息过滤</strong>：自动过滤密码等敏感字段</li>
</ul>
<h3 data-id="heading-2">1.2 日志类型</h3>
<h4 data-id="heading-3">1.2.1 操作日志（SysOperLog）</h4>
<p>记录业务操作，包含：</p>
<ul>
<li>操作模块、业务类型、操作人员</li>
</ul>

<ul>
<li>请求URL、IP、地点</li>
</ul>

<ul>
<li>请求参数、返回结果</li>
</ul>

<ul>
<li>操作状态、错误信息</li>
</ul>

<ul>
<li>执行时间、耗时</li>
</ul>
<h4 data-id="heading-4">1.2.2 登录日志（SysLogininfor）</h4>
<p>记录登录信息，包含：</p>
<ul>
<li>用户名、登录状态</li>
</ul>

<ul>
<li>IP、登录地点</li>
</ul>

<ul>
<li>浏览器、操作系统</li>
</ul>

<ul>
<li>登录时间、提示消息</li>
</ul>
<hr/>
<h2 data-id="heading-5">二、架构设计</h2>
<h3 data-id="heading-6">2.1 整体架构图</h3>
<pre><code class="hljs language-java" lang="java">┌─────────────────────────────────────────────────────────┐
│                     Controller层                        │
│  ┌──────────────────────────────────────────────────┐   │
│  │  <span class="hljs-meta">@Log</span>注解标记需要记录日志的方法                    │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────┬─────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│                    AOP切面层                             │
│  ┌──────────────────────────────────────────────────┐   │
│  │  LogAspect (操作日志切面)                         │   │
│  │  - <span class="hljs-meta">@Before</span>: 记录开始时间                          │   │
│  │  - <span class="hljs-meta">@AfterReturning</span>: 正常返回处理                  │   │
│  │  - <span class="hljs-meta">@AfterThrowing</span>: 异常处理                       │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────┬─────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│                  异步任务管理层                          │
│  ┌──────────────────────────────────────────────────┐   │
│  │  AsyncManager (异步任务管理器)                    │   │
│  │  - 单例模式                                       │   │
│  │  - 延迟10ms执行                                   │   │
│  └──────────────────────────────────────────────────┘   │
│  ┌──────────────────────────────────────────────────┐   │
│  │  AsyncFactory (异步工厂)                          │   │
│  │  - recordOper(): 创建操作日志任务                  │   │
│  │  - recordLogininfor(): 创建登录日志任务            │   │
│  └──────────────────────────────────────────────────┘   │
└───────────────────┬─────────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────┐
│                    数据持久层                            │
│  ┌──────────────────────────────────────────────────┐   │
│  │  Service层 → Mapper层 → 数据库                    │   │
│  └──────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────┘
</code></pre>
<h3 data-id="heading-7">2.2 技术栈</h3>
<ul>
<li><code>AOP</code>：AspectJ</li>
</ul>

<ul>
<li><code>异步处理</code>：ScheduledExecutorService</li>
</ul>

<ul>
<li><code>数据持久化</code>：MyBatis</li>
</ul>

<ul>
<li><code>JSON处理</code>：FastJSON2</li>
</ul>

<ul>
<li><code>IP地址解析</code>：AddressUtils</li>
</ul>
<h2 data-id="heading-8">三、核心组件详解</h2>
<h3 data-id="heading-9">3.1 @Log注解</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Target({ ElementType.PARAMETER, ElementType.METHOD })</span>
<span class="hljs-meta">@Retention(RetentionPolicy.RUNTIME)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> Log
{
    <span class="hljs-comment">/** 模块 */</span>
    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">title</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-string">""</span>;

    <span class="hljs-comment">/** 功能 */</span>
    <span class="hljs-keyword">public</span> BusinessType <span class="hljs-title function_">businessType</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> BusinessType.OTHER;

    <span class="hljs-comment">/** 操作人类别 */</span>
    <span class="hljs-keyword">public</span> OperatorType <span class="hljs-title function_">operatorType</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> OperatorType.MANAGE;

    <span class="hljs-comment">/** 是否保存请求的参数 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSaveRequestData</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">/** 是否保存响应的参数 */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isSaveResponseData</span><span class="hljs-params">()</span> <span class="hljs-keyword">default</span> <span class="hljs-literal">true</span>;

    <span class="hljs-comment">/** 排除指定的请求参数 */</span>
    <span class="hljs-keyword">public</span> String[] excludeParamNames() <span class="hljs-keyword">default</span> {};
}
</code></pre>
<p>参数说明：</p>
<ul>
<li><code>title</code>：操作模块名称</li>
</ul>

<ul>
<li><code>businessType</code>：业务类型（INSERT/UPDATE/DELETE/QUERY/EXPORT等）</li>
</ul>

<ul>
<li><code>operatorType</code>：操作人类别（MANAGE/MOBILE/OTHER）</li>
</ul>

<ul>
<li><code>isSaveRequestData</code>：是否保存请求参数</li>
</ul>

<ul>
<li><code>isSaveResponseData</code>：是否保存响应参数</li>
</ul>

<ul>
<li><code>excludeParamNames</code>：排除的参数名（如密码字段）</li>
</ul>
<h3 data-id="heading-10">3.2 LogAspect（操作日志切面）</h3>
<p>核心类：<code>com.construct.framework.aspectj.LogAspect</code></p>
<h4 data-id="heading-11">3.2.1 关键属性</h4>
<p><code>LogAspect.java Lines 54-58</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Before(value = "@annotation(controllerLog)")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">boBefore</span><span class="hljs-params">(JoinPoint joinPoint, Log controllerLog)</span>
{
    TIME_THREADLOCAL.set(System.currentTimeMillis());
}
</code></pre>
<ul>
<li><code>EXCLUDE_PROPERTIES</code>：默认排除的敏感字段（password、oldPassword等）</li>
<li><code>TIME_THREADLOCAL</code>：ThreadLocal，记录方法开始时间</li>
</ul>
<h4 data-id="heading-12">3.2.2 核心方法</h4>
<ol>
<li><code>boBefore()</code>：方法执行前</li>
</ol>
<ul>
<li>记录开始时间到<code>ThreadLocal</code></li>
</ul>
<ol start="2">
<li><code>doAfterReturning()</code>：方法正常返回后</li>
</ol>
<ul>
<li>调用<code>handleLog()</code>处理日志</li>
</ul>
<ol start="3">
<li><code>doAfterThrowing()</code>：方法抛出异常后</li>
</ol>
<ul>
<li>调用<code>handleLog()</code>，传入异常信息</li>
</ul>
<ol start="4">
<li><code>handleLog()</code>：统一日志处理</li>
</ol>
<p><code>LogAspect.java Lines 83-130</code></p>
<pre><code class="hljs language-java" lang="java">   <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">handleLog</span><span class="hljs-params">(<span class="hljs-keyword">final</span> JoinPoint joinPoint, Log controllerLog, <span class="hljs-keyword">final</span> Exception e, Object jsonResult)</span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 获取当前的用户</span>
            <span class="hljs-type">LoginUser</span> <span class="hljs-variable">loginUser</span> <span class="hljs-operator">=</span> SecurityUtils.getLoginUser();
            <span class="hljs-comment">// *========数据库日志=========*//</span>
            <span class="hljs-type">SysOperLog</span> <span class="hljs-variable">operLog</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SysOperLog</span>();
            operLog.setStatus(BusinessStatus.SUCCESS.ordinal());
            <span class="hljs-comment">// 请求的地址</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> IpUtils.getIpAddr();
            operLog.setOperIp(ip);
            operLog.setOperUrl(StringUtils.substring(ServletUtils.getRequest().getRequestURI(), <span class="hljs-number">0</span>, <span class="hljs-number">255</span>));
            <span class="hljs-keyword">if</span> (loginUser != <span class="hljs-literal">null</span>)
            {
                operLog.setOperName(loginUser.getUser().getNickName());
            }
            <span class="hljs-keyword">if</span> (e != <span class="hljs-literal">null</span>)
            {
                operLog.setStatus(BusinessStatus.FAIL.ordinal());
                operLog.setErrorMsg(StringUtils.substring(e.getMessage(), <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
            }
            <span class="hljs-comment">// 设置方法名称</span>
            <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> joinPoint.getTarget().getClass().getName();
            <span class="hljs-type">String</span> <span class="hljs-variable">methodName</span> <span class="hljs-operator">=</span> joinPoint.getSignature().getName();
            operLog.setMethod(className + <span class="hljs-string">"."</span> + methodName + <span class="hljs-string">"()"</span>);
            <span class="hljs-comment">// 设置请求方式</span>
            operLog.setRequestMethod(ServletUtils.getRequest().getMethod());
            <span class="hljs-comment">// 处理设置注解上的参数</span>
            getControllerMethodDescription(joinPoint, controllerLog, operLog, jsonResult);
            <span class="hljs-comment">// 设置消耗时间</span>
            operLog.setCostTime(System.currentTimeMillis() - TIME_THREADLOCAL.get());
            <span class="hljs-comment">// 保存数据库</span>
            AsyncManager.me().execute(AsyncFactory.recordOper(operLog));
        }
        <span class="hljs-keyword">catch</span> (Exception exp)
        {
            <span class="hljs-comment">// 记录本地异常日志</span>
            log.error(<span class="hljs-string">"异常信息:{}"</span>, exp.getMessage());
            exp.printStackTrace();
        }
        <span class="hljs-keyword">finally</span>
        {
            TIME_THREADLOCAL.remove();
        }
    }
</code></pre>
<p>处理流程：</p>
<p>(1)  获取当前登录用户</p>

<p>(2) 创建SysOperLog对象</p>

<p>(3) 设置IP、URL、操作人</p>

<p>(4) 处理异常信息（如有）</p>

<p>(5) 设置方法名、请求方式</p>

<p>(6) 解析注解参数</p>

<p>(7) 计算耗时</p>

<p>(8) 异步保存日志</p>

<ol start="5">
<li><code>getControllerMethodDescription()</code>：解析注解参数</li>
</ol>
<p><code>LogAspect.java ines 139-158</code></p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">getControllerMethodDescription</span><span class="hljs-params">(JoinPoint joinPoint, Log log, SysOperLog operLog, Object jsonResult)</span> <span class="hljs-keyword">throws</span> Exception
    {
        <span class="hljs-comment">// 设置action动作</span>
        operLog.setBusinessType(log.businessType().ordinal());
        <span class="hljs-comment">// 设置标题</span>
        operLog.setTitle(log.title());
        <span class="hljs-comment">// 设置操作人类别</span>
        operLog.setOperatorType(log.operatorType().ordinal());
        <span class="hljs-comment">// 是否需要保存request，参数和值</span>
        <span class="hljs-keyword">if</span> (log.isSaveRequestData())
        {
            <span class="hljs-comment">// 获取参数的信息，传入到数据库中。</span>
            setRequestValue(joinPoint, operLog, log.excludeParamNames());
        }
        <span class="hljs-comment">// 是否需要保存response，参数和值</span>
        <span class="hljs-keyword">if</span> (log.isSaveResponseData() &amp;&amp; StringUtils.isNotNull(jsonResult))
        {
            operLog.setJsonResult(StringUtils.substring(JSON.toJSONString(jsonResult), <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
        }
    }
</code></pre>
<ol start="6">
<li><code>setRequestValue()</code>：获取并处理请求参数</li>
</ol>
<p><code>LogAspect.java Lines 166-180</code></p>
<pre><code class="hljs language-java" lang="java">  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setRequestValue</span><span class="hljs-params">(JoinPoint joinPoint, SysOperLog operLog, String[] excludeParamNames)</span> <span class="hljs-keyword">throws</span> Exception
   {
        Map&lt;?, ?&gt; paramsMap = ServletUtils.getParamMap(ServletUtils.getRequest());
        <span class="hljs-type">String</span> <span class="hljs-variable">requestMethod</span> <span class="hljs-operator">=</span> operLog.getRequestMethod();
        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(paramsMap)
                &amp;&amp; (HttpMethod.PUT.name().equals(requestMethod) || HttpMethod.POST.name().equals(requestMethod)))
        {
            <span class="hljs-type">String</span> <span class="hljs-variable">params</span> <span class="hljs-operator">=</span> argsArrayToString(joinPoint.getArgs(), excludeParamNames);
            operLog.setOperParam(StringUtils.substring(params, <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
        }
        <span class="hljs-keyword">else</span>
        {
            operLog.setOperParam(StringUtils.substring(JSON.toJSONString(paramsMap, excludePropertyPreFilter(excludeParamNames)), <span class="hljs-number">0</span>, <span class="hljs-number">2000</span>));
        }
    }
</code></pre>
<ol start="7">
<li><code>isFilterObject()</code>：过滤不需要记录的对象</li>
</ol>
<p><code>LogAspect.java Lines 222-249</code></p>
<pre><code class="hljs language-java" lang="java">        <span class="hljs-meta">@SuppressWarnings("rawtypes")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isFilterObject</span><span class="hljs-params">(<span class="hljs-keyword">final</span> Object o)</span>
    {
        Class&lt;?&gt; clazz = o.getClass();
        <span class="hljs-keyword">if</span> (clazz.isArray())
        {
            <span class="hljs-keyword">return</span> clazz.getComponentType().isAssignableFrom(MultipartFile.class);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Collection.class.isAssignableFrom(clazz))
        {
            <span class="hljs-type">Collection</span> <span class="hljs-variable">collection</span> <span class="hljs-operator">=</span> (Collection) o;
            <span class="hljs-keyword">for</span> (Object value : collection)
            {
                <span class="hljs-keyword">return</span> value <span class="hljs-keyword">instanceof</span> MultipartFile;
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Map.class.isAssignableFrom(clazz))
        {
            <span class="hljs-type">Map</span> <span class="hljs-variable">map</span> <span class="hljs-operator">=</span> (Map) o;
            <span class="hljs-keyword">for</span> (Object value : map.entrySet())
            {
                Map.<span class="hljs-type">Entry</span> <span class="hljs-variable">entry</span> <span class="hljs-operator">=</span> (Map.Entry) value;
                <span class="hljs-keyword">return</span> entry.getValue() <span class="hljs-keyword">instanceof</span> MultipartFile;
            }
        }
        <span class="hljs-keyword">return</span> o <span class="hljs-keyword">instanceof</span> MultipartFile || o <span class="hljs-keyword">instanceof</span> HttpServletRequest || o <span class="hljs-keyword">instanceof</span> HttpServletResponse
                || o <span class="hljs-keyword">instanceof</span> BindingResult;
    }
</code></pre>
<p>过滤对象：</p>
<ul>
<li><code>MultipartFile</code>（文件上传）</li>
</ul>

<ul>
<li><code>HttpServletRequest</code>、<code>HttpServletResponse</code></li>
</ul>

<ul>
<li><code>BindingResult</code>（参数校验结果）</li>
</ul>
<h3 data-id="heading-13">3.3 AsyncManager（异步任务管理器）</h3>
<p><code>AsyncManager.java Lines 15-56</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AsyncManager</span>
{
    <span class="hljs-comment">/**
     * 操作延迟10毫秒
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">OPERATE_DELAY_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>;

    <span class="hljs-comment">/**
     * 异步操作任务调度线程池
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-type">ScheduledExecutorService</span> <span class="hljs-variable">executor</span> <span class="hljs-operator">=</span> SpringUtils.getBean(<span class="hljs-string">"scheduledExecutorService"</span>);

    <span class="hljs-comment">/**
     * 单例模式
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-title function_">AsyncManager</span><span class="hljs-params">()</span>{}

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">AsyncManager</span> <span class="hljs-variable">me</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AsyncManager</span>();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> AsyncManager <span class="hljs-title function_">me</span><span class="hljs-params">()</span>
    {
        <span class="hljs-keyword">return</span> me;
    }

    <span class="hljs-comment">/**
     * 执行任务
     * 
     * <span class="hljs-doctag">@param</span> task 任务
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">execute</span><span class="hljs-params">(TimerTask task)</span>
    {
        executor.schedule(task, OPERATE_DELAY_TIME, TimeUnit.MILLISECONDS);
    }

    <span class="hljs-comment">/**
     * 停止任务线程池
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shutdown</span><span class="hljs-params">()</span>
    {
        Threads.shutdownAndAwaitTermination(executor);
    }
}
</code></pre>
<p>特点：</p>
<ul>
<li>单例模式</li>
</ul>

<ul>
<li>延迟<code>10ms</code>执行，避免影响主流程</li>
</ul>

<ul>
<li>使用<code>ScheduledExecutorService</code>执行任务</li>
</ul>
<h3 data-id="heading-14">3.4 AsyncFactory（异步工厂）</h3>
<p><code>AsyncFactory.java Lines 99-111</code></p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> TimerTask <span class="hljs-title function_">recordOper</span><span class="hljs-params">(<span class="hljs-keyword">final</span> SysOperLog operLog)</span>
{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TimerTask</span>()
    {
        <span class="hljs-meta">@Override</span>
        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span>
        {
            <span class="hljs-comment">// 远程查询操作地点</span>
            operLog.setOperLocation(AddressUtils.getRealAddressByIP(operLog.getOperIp()));
            SpringUtils.getBean(ISysOperLogService.class).insertOperlog(operLog);
        }
    };
}
</code></pre>
<p>功能：</p>
<ul>
<li><code>recordOper()</code>：创建操作日志任务
<ul>
<li>根据IP查询操作地点</li>
<li>调用<code>Service</code>保存日志</li>
</ul>
</li>
</ul>

<ul>
<li><code>recordLogininfor()</code>：创建登录日志任务
<ul>
<li>解析<code>User-Agent</code>获取浏览器和操作系统</li>
<li>根据IP查询登录地点</li>
<li>保存登录日志</li>
</ul>
</li>
</ul>
<h3 data-id="heading-15">3.5 线程池配置</h3>
<p><code>ThreadPoolConfig.java Lines 45-62</code></p>
<pre><code class="hljs language-java" lang="java">    <span class="hljs-comment">/**
     * 执行周期性或定时任务
     */</span>
    <span class="hljs-meta">@Bean(name = "scheduledExecutorService")</span>
    <span class="hljs-keyword">protected</span> ScheduledExecutorService <span class="hljs-title function_">scheduledExecutorService</span><span class="hljs-params">()</span>
    {
       <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ScheduledThreadPoolExecutor</span>(corePoolSize,
              <span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicThreadFactory</span>.Builder().namingPattern(<span class="hljs-string">"schedule-pool-%d"</span>).daemon(<span class="hljs-literal">true</span>).build(),
              <span class="hljs-keyword">new</span> <span class="hljs-title class_">ThreadPoolExecutor</span>.CallerRunsPolicy())
        {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">afterExecute</span><span class="hljs-params">(Runnable r, Throwable t)</span>
            {
                <span class="hljs-built_in">super</span>.afterExecute(r, t);
                Threads.printException(r, t);
            }
        };
    }
</code></pre>
<p>配置参数：</p>
<ul>
<li>核心线程数：50</li>
<li>最大线程数：200</li>
<li>队列容量：1000</li>
<li>线程命名：<code>schedule-pool-%d</code></li>
<li>守护线程：是</li>
<li>拒绝策略：<code>CallerRunsPolicy</code></li>
</ul>
<h3 data-id="heading-16">3.6 实体类</h3>
<h4 data-id="heading-17">3.6.1 SysOperLog（操作日志实体）</h4>
<p>主要字段：</p>
<ul>
<li><code>operId</code>：日志主键</li>
<li><code>title</code>：操作模块</li>
<li><code>businessType</code>：业务类型（0其它 1新增 2修改 3删除等）</li>
<li><code>method</code>：请求方法（类名.方法名）</li>
<li><code>requestMethod</code>：请求方式（GET/POST等）</li>
<li><code>operatorType</code>：操作类别（0其它 1后台用户 2手机端用户）</li>
<li><code>operName</code>：操作人员</li>
<li><code>operUrl</code>：请求URL</li>
<li><code>operIp</code>：操作IP</li>
<li><code>operLocation</code>：操作地点</li>
<li><code>operParam</code>：请求参数（JSON，最大2000字符）</li>
<li><code>jsonResult</code>：返回参数（JSON，最大2000字符）</li>
<li><code>status</code>：操作状态（0正常 1异常）</li>
<li><code>errorMsg</code>：错误消息（最大2000字符）</li>
<li><code>operTime</code>：操作时间</li>
<li><code>costTime</code>：消耗时间（毫秒）</li>
</ul>
<hr/>
<h2 data-id="heading-18">四、实现流程</h2>
<h3 data-id="heading-19">4.1 操作日志记录流程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1.</span> Controller方法执行
   ↓
<span class="hljs-number">2.</span> <span class="hljs-meta">@Log</span>注解触发AOP切面
   ↓
<span class="hljs-number">3.</span> LogAspect.boBefore()
   - 记录开始时间到ThreadLocal
   ↓
<span class="hljs-number">4.</span> 业务方法执行
   ↓
<span class="hljs-number">5.</span> LogAspect.doAfterReturning() 或 doAfterThrowing()
   ↓
<span class="hljs-number">6.</span> LogAspect.handleLog()
   - 获取用户信息
   - 创建SysOperLog对象
   - 设置基本信息（IP、URL、方法名等）
   - 解析<span class="hljs-meta">@Log</span>注解参数
   - 处理请求参数和响应结果
   - 计算执行耗时
   ↓
<span class="hljs-number">7.</span> AsyncManager.execute()
   - 延迟10ms执行
   ↓
<span class="hljs-number">8.</span> AsyncFactory.recordOper()
   - 根据IP查询操作地点
   - 调用Service保存日志
   ↓
<span class="hljs-number">9.</span> SysOperLogService.insertOperlog()
   - 保存到数据库
</code></pre>
<h3 data-id="heading-20">4.2 登录日志记录流程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1.</span> 用户登录/登出
   ↓
<span class="hljs-number">2.</span> 调用AsyncManager.execute(AsyncFactory.recordLogininfor(...))
   ↓
<span class="hljs-number">3.</span> AsyncFactory.recordLogininfor()
   - 解析User-Agent获取浏览器和操作系统
   - 获取IP地址
   - 根据IP查询登录地点
   - 创建SysLogininfor对象
   ↓
<span class="hljs-number">4.</span> SysLogininforService.insertLogininfor()
   - 保存到数据库
</code></pre>
<h3 data-id="heading-21">4.3 参数处理流程</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-number">1.</span> 检查是否需要保存请求参数（isSaveRequestData）
   ↓
<span class="hljs-number">2.</span> 获取请求参数
   - GET请求：从request.getParameterMap()获取
   - POST/PUT请求：从方法参数获取
   ↓
<span class="hljs-number">3.</span> 过滤敏感字段
   - 默认过滤：password、oldPassword、newPassword、confirmPassword
   - 注解指定过滤：excludeParamNames
   ↓
<span class="hljs-number">4.</span> 过滤不需要的对象
   - MultipartFile、HttpServletRequest、HttpServletResponse、BindingResult
   ↓
<span class="hljs-number">5.</span> 转换为JSON字符串（最大<span class="hljs-number">2000</span>字符）
   ↓
<span class="hljs-number">6.</span> 保存到operParam字段
</code></pre>
<hr/>
<h2 data-id="heading-22">五、使用指南</h2>
<h3 data-id="heading-23">5.1 基本使用</h3>
<p>在Controller方法上添加<code>@Log</code>注解：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@RestController</span>
<span class="hljs-meta">@RequestMapping("/system/user")</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SysUserController</span> {

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.INSERT)</span>
    <span class="hljs-meta">@PostMapping</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> AjaxResult.success();
    }

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.UPDATE)</span>
    <span class="hljs-meta">@PutMapping</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">edit</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> AjaxResult.success();
    }

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.DELETE)</span>
    <span class="hljs-meta">@DeleteMapping("/{userIds}")</span>
    <span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">remove</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable</span> Long[] userIds)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> AjaxResult.success();
    }

    <span class="hljs-meta">@Log(title = "用户管理", businessType = BusinessType.QUERY)</span>
    <span class="hljs-meta">@GetMapping("/list")</span>
    <span class="hljs-keyword">public</span> TableDataInfo <span class="hljs-title function_">list</span><span class="hljs-params">(SysUser user)</span> {
        <span class="hljs-comment">// 业务逻辑</span>
        <span class="hljs-keyword">return</span> getDataTable(list);
    }
}
</code></pre>
<h3 data-id="heading-24">5.2 高级用法</h3>
<h4 data-id="heading-25">5.2.1 排除敏感参数</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "用户管理", 
    businessType = BusinessType.UPDATE,
    excludeParamNames = {"password", "secretKey"}
)</span>
<span class="hljs-meta">@PutMapping</span>
<span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">updateUser</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h4 data-id="heading-26">5.2.2 不保存请求参数</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "用户管理", 
    businessType = BusinessType.QUERY,
    isSaveRequestData = false
)</span>
<span class="hljs-meta">@GetMapping("/list")</span>
<span class="hljs-keyword">public</span> TableDataInfo <span class="hljs-title function_">list</span><span class="hljs-params">(SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h4 data-id="heading-27">5.2.3 不保存响应结果</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "用户管理", 
    businessType = BusinessType.QUERY,
    isSaveResponseData = false
)</span>
<span class="hljs-meta">@GetMapping("/list")</span>
<span class="hljs-keyword">public</span> TableDataInfo <span class="hljs-title function_">list</span><span class="hljs-params">(SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h4 data-id="heading-28">5.2.4 指定操作人类别</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Log(
    title = "移动端用户管理", 
    businessType = BusinessType.INSERT,
    operatorType = OperatorType.MOBILE
)</span>
<span class="hljs-meta">@PostMapping</span>
<span class="hljs-keyword">public</span> AjaxResult <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> SysUser user)</span> {
    <span class="hljs-comment">// 业务逻辑</span>
}
</code></pre>
<h3 data-id="heading-29">5.3 业务类型枚举</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">BusinessType</span> {
    OTHER,      <span class="hljs-comment">// 其它</span>
    INSERT,     <span class="hljs-comment">// 新增</span>
    UPDATE,     <span class="hljs-comment">// 修改</span>
    DELETE,     <span class="hljs-comment">// 删除</span>
    GRANT,      <span class="hljs-comment">// 授权</span>
    EXPORT,     <span class="hljs-comment">// 导出</span>
    IMPORT,     <span class="hljs-comment">// 导入</span>
    FORCE,      <span class="hljs-comment">// 强退</span>
    GENCODE,    <span class="hljs-comment">// 生成代码</span>
    CLEAN,      <span class="hljs-comment">// 清空数据</span>
    QUERY       <span class="hljs-comment">// 查询</span>
}
</code></pre>
<h3 data-id="heading-30">5.4 操作人类别枚举</h3>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">OperatorType</span> {
    OTHER,      <span class="hljs-comment">// 其它</span>
    MANAGE,     <span class="hljs-comment">// 后台用户</span>
    MOBILE      <span class="hljs-comment">// 手机端用户</span>
}
</code></pre>
<hr/>
<h2 data-id="heading-31">六、技术要点</h2>
<h3 data-id="heading-32">6.1 AOP切面技术</h3>
<ul>
<li>使用<code>@Aspect</code>和<code>@Component</code>声明切面</li>
<li>使用<code>@Before</code>、<code>@AfterReturning</code>、<code>@AfterThrowing</code>定义切点</li>
<li>切点表达式：<code>@annotation(controllerLog)</code>，拦截带<code>@Log</code>注解的方法</li>
</ul>
<h3 data-id="heading-33">6.2 ThreadLocal使用</h3>
<ul>
<li>使用<code>NamedThreadLocal</code>记录方法开始时间</li>
<li>线程安全，避免并发问题</li>
<li>在<code>finally</code>中清理，防止内存泄漏</li>
</ul>
<h3 data-id="heading-34">6.3 异步处理</h3>
<ul>
<li>使用<code>ScheduledExecutorService</code>实现异步</li>
<li>延迟<code>10ms</code>执行，不阻塞主流程</li>
<li>单例模式管理异步任务</li>
</ul>
<h3 data-id="heading-35">6.4 敏感信息过滤</h3>
<ul>
<li>默认过滤密码相关字段</li>
<li>支持注解指定过滤字段</li>
<li>使用<code>PropertyPreExcludeFilter</code>实现JSON序列化过滤</li>
</ul>
<h3 data-id="heading-36">6.5 IP地址解析</h3>
<ul>
<li>使用<code>IpUtils.getIpAddr()</code>获取真实IP</li>
<li>使用<code>AddressUtils.getRealAddressByIP()</code>查询地理位置</li>
<li>支持代理服务器场景</li>
</ul>
<h3 data-id="heading-37">6.6 参数长度限制</h3>
<ul>
<li>请求参数：最大2000字符</li>
<li>响应结果：最大2000字符</li>
<li>错误消息：最大2000字符</li>
<li>使用<code>StringUtils.substring()</code>截断</li>
</ul>
<h3 data-id="heading-38">6.7 异常处理</h3>
<ul>
<li>切面捕获异常，不影响业务</li>
<li>记录异常信息到日志</li>
<li>异常时设置<code>status</code>为<code>FAIL</code>，记录<code>errorMsg</code></li>
</ul>
<hr/>
<h2 data-id="heading-39">七、扩展说明</h2>
<h3 data-id="heading-40">7.1 ControllerLogsAspect（调试日志切面）</h3>
<p>除了<code>LogAspect</code>，还有一个<code>ControllerLogsAspect</code>用于开发调试：</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Component</span>
<span class="hljs-meta">@Aspect</span>
<span class="hljs-meta">@Order(1)</span>
<span class="hljs-meta">@Slf4j</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ControllerLogsAspect</span> {

    <span class="hljs-meta">@Pointcut("execution(public * com.construct.*.controller..*.*(..))")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">pointCut</span><span class="hljs-params">()</span> {}

    <span class="hljs-meta">@Before("pointCut()")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">doBeforeInServiceLayer</span><span class="hljs-params">(JoinPoint joinPoint)</span> {
        <span class="hljs-comment">// 记录开始时间</span>
    }

    <span class="hljs-meta">@AfterReturning(pointcut = "pointCut()", returning = "returnValue")</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">log</span><span class="hljs-params">(JoinPoint joinPoint, Object returnValue)</span> {
        <span class="hljs-comment">// 打印调试日志</span>
    }
}
</code></pre>
<p>功能：</p>
<ul>
<li>拦截所有<code>Controller</code>方法</li>
<li>记录请求URL、参数、响应结果、处理时间</li>
<li>仅非生产环境输出日志</li>
<li>排除静态资源请求</li>
</ul>
<h3 data-id="heading-41">7.2 业务日志扩展</h3>
<p>系统还提供了业务日志扩展（如<code>PubOperateLog</code>、<code>DmsOperateLog</code>），用于记录业务数据变更：特点：</p>
<ul>
<li>记录字段级别的变更（修改前/修改后）</li>
<li>支持业务ID关联</li>
<li>支持操作类型（创建/编辑）</li>
<li>支持操作详情记录</li>
</ul>
<h3 data-id="heading-42">7.3 日志查询和管理</h3>
<p>系统提供了日志查询和管理功能：</p>
<ul>
<li>操作日志查询：<code>/monitor/operlog/list</code></li>
<li>登录日志查询：<code>/monitor/logininfor/list</code></li>
<li>日志导出：支持Excel导出</li>
<li>日志删除：支持批量删除和清空</li>
</ul>
<hr/>
<h2 data-id="heading-43">八、总结</h2>
<h3 data-id="heading-44">8.1 设计优势</h3>
<ol>
<li>非侵入：通过注解实现，不影响业务代码</li>
<li>异步处理：日志写入不阻塞主流程</li>
<li>灵活配置：支持多种配置选项</li>
<li>安全过滤：自动过滤敏感信息</li>
<li>异常处理：完善的异常处理机制</li>
<li>性能优化：延迟执行、线程池管理</li>
</ol>
<h3 data-id="heading-45">8.2 适用场景</h3>
<ul>
<li>操作审计：记录用户操作</li>
<li>问题排查：通过日志定位问题</li>
<li>性能监控：记录方法执行时间</li>
<li>安全审计：记录登录和操作信息</li>
</ul>
<h3 data-id="heading-46">8.3 注意事项</h3>
<ol>
<li>日志表会持续增长，需要定期清理</li>
<li>异步执行可能丢失日志（极端情况）</li>
<li>参数长度限制可能截断重要信息</li>
<li>IP地址解析依赖外部服务，可能影响性能</li>
<li>生产环境建议关闭调试日志切面</li>
</ol>
<hr/>
<h2 data-id="heading-47">附录：相关文件清单</h2>
<h3 data-id="heading-48">核心文件</h3>
<ul>
<li><code>LogAspect.java</code> - 操作日志切面</li>
<li><code>ControllerLogsAspect.java</code> - 控制器日志切面（调试用）</li>
<li><code>Log.java</code> - 日志注解定义</li>
<li><code>AsyncManager.java</code> - 异步任务管理器</li>
<li><code>AsyncFactory.java</code> - 异步工厂</li>
<li><code>ThreadPoolConfig.java</code> - 线程池配置</li>
</ul>
<h3 data-id="heading-49">实体类</h3>
<ul>
<li><code>SysOperLog.java</code> - 操作日志实体</li>
<li><code>SysLogininfor.java</code> - 登录日志实体</li>
</ul>
<h3 data-id="heading-50">服务层</h3>
<ul>
<li><code>ISysOperLogService.java</code> - 操作日志服务接口</li>
<li><code>SysOperLogServiceImpl.java</code> - 操作日志服务实现</li>
<li><code>ISysLogininforService.java</code> - 登录日志服务接口</li>
<li><code>SysLogininforServiceImpl.java</code> - 登录日志服务实现</li>
</ul>
<h3 data-id="heading-51">数据层</h3>
<ul>
<li><code>SysOperLogMapper.java</code> - 操作日志Mapper接口</li>
<li><code>SysOperLogMapper.xml</code> - 操作日志Mapper XML</li>
<li><code>SysLogininforMapper.java</code> - 登录日志Mapper接口</li>
<li><code>SysLogininforMapper.xml</code> - 登录日志Mapper XML</li>
</ul>
<h3 data-id="heading-52">控制器</h3>
<ul>
<li><code>SysOperlogController.java</code> - 操作日志管理控制器</li>
<li><code>SysLogininforController.java</code> - 登录日志管理控制器</li>
</ul>
<hr/></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例]]></title>    <link>https://juejin.cn/post/7598537739516919850</link>    <guid>https://juejin.cn/post/7598537739516919850</guid>    <pubDate>2026-01-25T12:50:40.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598537739516919850" data-draft-id="7598587406708080681" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例"/> <meta itemprop="keywords" content="Java"/> <meta itemprop="datePublished" content="2026-01-25T12:50:40.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="beata"/> <meta itemprop="url" content="https://juejin.cn/user/1839900247461280"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            Java基础-4：JDK 中基于 AQS 的核心类详解与使用示例
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/1839900247461280/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    beata
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:50:40.000Z" title="Sun Jan 25 2026 12:50:40 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读4分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>在上一篇中我们详细介绍了AQS的底层代码实现逻辑，这里我们来介绍基于AQS实现的类，在 Java 并发编程中，<code>java.util.concurrent</code>（JUC）包为我们提供了大量高效、可靠的并发工具类。这些工具类的底层实现大多依赖于一个关键的抽象框架——<strong>AbstractQueuedSynchronizer</strong>（AQS）。本文将深入介绍 AQS 的基本原理，并详细讲解 JDK 中几个基于 AQS 实现的核心同步器类，包括 <code>ReentrantLock</code>、<code>Semaphore</code>、<code>CountDownLatch</code>、<code>ReentrantReadWriteLock</code> 和 <code>Condition</code>，并附上实用的代码示例。</p>
<hr/>
<h2 data-id="heading-0">一、什么是 AQS？</h2>
<p><strong>AbstractQueuedSynchronizer</strong>（AQS）是 Doug Lea 设计的一个用于构建锁和同步器的基础框架。它通过一个 <strong>int 类型的 state</strong> 表示同步状态，并维护一个 <strong>FIFO 的等待队列</strong>（CLH 队列变体），用于管理那些未能获取资源而被阻塞的线程。</p>
<p>AQS 的核心思想是：</p>
<ul>
<li>子类通过重写 <code>tryAcquire</code> / <code>tryRelease</code>（独占模式）或 <code>tryAcquireShared</code> / <code>tryReleaseShared</code>（共享模式）等方法来定义如何获取/释放资源。</li>
<li>AQS 负责线程的排队、唤醒、阻塞等复杂逻辑。</li>
</ul>
<p>AQS 支持两种资源共享方式：</p>
<ul>
<li><strong>独占式</strong>（Exclusive）：如 ReentrantLock</li>
<li><strong>共享式</strong>（Shared）：如 Semaphore、CountDownLatch</li>
</ul>
<hr/>
<h2 data-id="heading-1">二、JDK 中基于 AQS 的核心类</h2>
<h3 data-id="heading-2">1. ReentrantLock（可重入锁）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 独占模式实现</li>
<li>支持公平锁与非公平锁</li>
<li>可重入（同一线程可多次获取）</li>
<li>支持 Condition</li>
</ul>
<h4 data-id="heading-3">示例代码：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReentrantLockExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">Thread</span> <span class="hljs-variable">t1</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> {
                    count++;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            }
        });

        <span class="hljs-type">Thread</span> <span class="hljs-variable">t2</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
                lock.lock();
                <span class="hljs-keyword">try</span> {
                    count++;
                } <span class="hljs-keyword">finally</span> {
                    lock.unlock();
                }
            }
        });

        t1.start();
        t2.start();
        t1.join();
        t2.join();

        System.out.println(<span class="hljs-string">"Final count: "</span> + count); <span class="hljs-comment">// 输出 2000</span>
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-4">2. Semaphore（信号量）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 共享模式实现</li>
<li>控制同时访问特定资源的线程数量</li>
<li>常用于限流、资源池控制</li>
</ul>
<h4 data-id="heading-5">示例代码（模拟数据库连接池）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.Semaphore;
<span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SemaphoreExample</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Semaphore</span> <span class="hljs-variable">semaphore</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Semaphore</span>(<span class="hljs-number">3</span>); <span class="hljs-comment">// 最多3个并发</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    semaphore.acquire(); <span class="hljs-comment">// 获取许可</span>
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 获取数据库连接"</span>);
                    TimeUnit.SECONDS.sleep(<span class="hljs-number">2</span>); <span class="hljs-comment">// 模拟操作</span>
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 释放数据库连接"</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    semaphore.release(); <span class="hljs-comment">// 释放许可</span>
                }
            }, <span class="hljs-string">"Thread-"</span> + i).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-6">3. CountDownLatch（倒计时门闩）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>基于 AQS 共享模式实现</li>
<li>初始化时指定一个计数，调用 <code>countDown()</code> 减 1，<code>await()</code> 阻塞直到计数为 0</li>
<li>一次性使用，计数不能重置</li>
</ul>
<h4 data-id="heading-7">示例代码（等待多个任务完成）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.concurrent.CountDownLatch;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountDownLatchExample</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        <span class="hljs-type">int</span> <span class="hljs-variable">threadCount</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;
        <span class="hljs-type">CountDownLatch</span> <span class="hljs-variable">latch</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CountDownLatch</span>(threadCount);

        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; threadCount; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-comment">// 模拟任务</span>
                    Thread.sleep((<span class="hljs-type">long</span>) (Math.random() * <span class="hljs-number">2000</span>));
                    System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 完成任务"</span>);
                } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                    Thread.currentThread().interrupt();
                } <span class="hljs-keyword">finally</span> {
                    latch.countDown(); <span class="hljs-comment">// 计数减1</span>
                }
            }).start();
        }

        latch.await(); <span class="hljs-comment">// 主线程等待所有任务完成</span>
        System.out.println(<span class="hljs-string">"所有任务已完成，继续执行后续逻辑"</span>);
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-8">4. ReentrantReadWriteLock（读写锁）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>内部包含两个锁：ReadLock（共享）和 WriteLock（独占）</li>
<li>多个读线程可同时访问，但写线程必须独占</li>
<li>适用于“读多写少”场景</li>
</ul>
<h4 data-id="heading-9">示例代码（缓存读写）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.HashMap;
<span class="hljs-keyword">import</span> java.util.Map;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ReadWriteLockCache</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Map&lt;String, String&gt; cache = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantReadWriteLock</span> <span class="hljs-variable">rwLock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantReadWriteLock</span>();

    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">get</span><span class="hljs-params">(String key)</span> {
        rwLock.readLock().lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> cache.get(key);
        } <span class="hljs-keyword">finally</span> {
            rwLock.readLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">put</span><span class="hljs-params">(String key, String value)</span> {
        rwLock.writeLock().lock();
        <span class="hljs-keyword">try</span> {
            cache.put(key, value);
        } <span class="hljs-keyword">finally</span> {
            rwLock.writeLock().unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ReadWriteLockCache</span> <span class="hljs-variable">cache</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReadWriteLockCache</span>();
        cache.put(<span class="hljs-string">"name"</span>, <span class="hljs-string">"Alice"</span>);

        <span class="hljs-comment">// 多个读线程</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
                System.out.println(Thread.currentThread().getName() + <span class="hljs-string">" 读取: "</span> + cache.get(<span class="hljs-string">"name"</span>));
            }).start();
        }
    }
}
</code></pre>
<hr/>
<h3 data-id="heading-10">5. Condition（条件变量）</h3>
<p><strong>特点</strong>：</p>
<ul>
<li>与 Lock 配合使用，替代 Object 的 wait/notify</li>
<li>一个 Lock 可以创建多个 Condition，实现更精细的线程通信</li>
</ul>
<h4 data-id="heading-11">示例代码（生产者-消费者模型）：</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">import</span> java.util.LinkedList;
<span class="hljs-keyword">import</span> java.util.Queue;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.Condition;
<span class="hljs-keyword">import</span> java.util.concurrent.locks.ReentrantLock;

<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProducerConsumerWithCondition</span> {
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Queue&lt;Integer&gt; buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">capacity</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">ReentrantLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ReentrantLock</span>();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notFull</span> <span class="hljs-operator">=</span> lock.newCondition();
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> <span class="hljs-type">Condition</span> <span class="hljs-variable">notEmpty</span> <span class="hljs-operator">=</span> lock.newCondition();

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">produce</span><span class="hljs-params">(<span class="hljs-type">int</span> item)</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (buffer.size() == capacity) {
                System.out.println(<span class="hljs-string">"Buffer full, producer waiting..."</span>);
                notFull.await();
            }
            buffer.offer(item);
            System.out.println(<span class="hljs-string">"Produced: "</span> + item);
            notEmpty.signal(); <span class="hljs-comment">// 唤醒消费者</span>
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">consume</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> InterruptedException {
        lock.lock();
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">while</span> (buffer.isEmpty()) {
                System.out.println(<span class="hljs-string">"Buffer empty, consumer waiting..."</span>);
                notEmpty.await();
            }
            <span class="hljs-type">int</span> <span class="hljs-variable">item</span> <span class="hljs-operator">=</span> buffer.poll();
            System.out.println(<span class="hljs-string">"Consumed: "</span> + item);
            notFull.signal(); <span class="hljs-comment">// 唤醒生产者</span>
            <span class="hljs-keyword">return</span> item;
        } <span class="hljs-keyword">finally</span> {
            lock.unlock();
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">ProducerConsumerWithCondition</span> <span class="hljs-variable">pc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ProducerConsumerWithCondition</span>();

        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">5</span>; i++) {
                    pc.produce(i);
                    Thread.sleep(<span class="hljs-number">500</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }).start();

        <span class="hljs-keyword">new</span> <span class="hljs-title class_">Thread</span>(() -&gt; {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
                    pc.consume();
                    Thread.sleep(<span class="hljs-number">1000</span>);
                }
            } <span class="hljs-keyword">catch</span> (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }).start();
    }
}
</code></pre>
<hr/>
<h2 data-id="heading-12">三、总结</h2>



































<table><thead><tr><th>同步器</th><th>AQS 模式</th><th>典型用途</th></tr></thead><tbody><tr><td><code>ReentrantLock</code></td><td>独占</td><td>替代 synchronized，支持超时、中断、公平性</td></tr><tr><td><code>Semaphore</code></td><td>共享</td><td>控制并发线程数，资源池限流</td></tr><tr><td><code>CountDownLatch</code></td><td>共享</td><td>等待 N 个任务完成后再继续</td></tr><tr><td><code>ReentrantReadWriteLock</code></td><td>读（共享）/写（独占）</td><td>读多写少的并发访问控制</td></tr><tr><td><code>Condition</code></td><td>与 Lock 配合</td><td>精细线程通信（替代 wait/notify）</td></tr></tbody></table>
<p>这些类都封装了 AQS 的复杂性，让开发者可以专注于业务逻辑，而无需手动处理线程调度和状态管理。理解 AQS 的工作原理，有助于我们更高效、安全地使用这些并发工具。</p>
<blockquote>
<p><strong>提示</strong>：虽然 AQS 强大，但除非你正在开发新的同步组件（如自定义锁），否则一般不需要直接继承 AQS。日常开发中，优先使用 JUC 提供的标准同步器即可。</p>
</blockquote>
<hr/>
<p>希望本文能帮助你深入理解 AQS 及其在 JDK 中的应用。如果你有任何问题或想了解更底层的源码机制，欢迎留言讨论！</p>
<blockquote>
<p>作者：架构师Beata<br/>
日期：2026年1月25日<br/>
版权声明：本文可自由转载，但请保留出处</p>
</blockquote></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[MySQL的锁机制、适用场景以及对应的解决方案]]></title>    <link>https://juejin.cn/post/7598881914203750450</link>    <guid>https://juejin.cn/post/7598881914203750450</guid>    <pubDate>2026-01-25T12:51:16.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598881914203750450" data-draft-id="7598921649888378907" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="MySQL的锁机制、适用场景以及对应的解决方案"/> <meta itemprop="keywords" content="后端,MySQL"/> <meta itemprop="datePublished" content="2026-01-25T12:51:16.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="三水不滴"/> <meta itemprop="url" content="https://juejin.cn/user/283045639753100"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            MySQL的锁机制、适用场景以及对应的解决方案
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/283045639753100/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    三水不滴
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T12:51:16.000Z" title="Sun Jan 25 2026 12:51:16 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    5
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读27分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">MySQL 锁机制全解析：所有锁类型、适用场景与落地解决方案</h2>
<p>MySQL 锁机制是数据库<strong>并发控制</strong>的核心，用于解决多事务同时操作数据时的<strong>脏读、不可重复读、幻读</strong>以及<strong>数据不一致</strong>问题，是保障数据一致性和高并发处理能力的基础。不同存储引擎的锁机制差异显著，其中 InnoDB 作为 MySQL 默认引擎，实现了<strong>细粒度的行级锁</strong>，并兼容表级锁，是互联网后端开发的核心研究对象；而 MyISAM 仅支持表级锁，现已逐步被淘汰。</p>
<p>本文将从<strong>锁的整体分类</strong>出发，详细讲解 MySQL 中<strong>所有锁类型</strong>的定义、特性、触发条件，结合互联网后端典型业务场景给出<strong>锁的选择策略与可落地的解决方案</strong>（含 SQL/Java 代码），同时分析生产高频的锁阻塞、死锁问题的定位与解决，兼顾面试八股文和生产实战需求。</p>
<h3 data-id="heading-1">一、MySQL 锁的整体分类</h3>
<p>MySQL 锁的分类维度多样，核心按<strong>锁粒度</strong>（最常用）、<strong>锁兼容性</strong>、<strong>实现方式</strong>划分，不同分类维度可交叉，例如 InnoDB 的行级锁包含共享行锁和排他行锁。以下是全维度分类体系，建立对 MySQL 锁的整体认知：</p>

























































































<table><thead><tr><th>分类维度</th><th>锁类型</th><th>核心存储引擎</th><th>锁粒度 / 特性</th><th>核心适用场景</th></tr></thead><tbody><tr><td><strong>锁粒度</strong></td><td>表级锁（Table Lock）</td><td>MyISAM/InnoDB</td><td>整表加锁，粒度粗，开销小，并发低</td><td>整表批量操作、静态数据修改</td></tr><tr><td/><td>行级锁（Row Lock）</td><td>InnoDB</td><td>单行加锁，粒度细，开销大，并发高</td><td>高并发单行 / 多行更新、读写混合场景</td></tr><tr><td/><td>页级锁（Page Lock）</td><td>BDB</td><td>数据页加锁，粒度介于表 / 行之间</td><td>极少使用，已被 InnoDB 替代</td></tr><tr><td><strong>锁兼容性</strong></td><td>共享锁（Shared Lock，S 锁）</td><td>InnoDB/MyISAM</td><td>读锁，多个 S 锁可共存</td><td>数据查询，不允许其他事务修改</td></tr><tr><td/><td>排他锁（Exclusive Lock，X 锁）</td><td>InnoDB/MyISAM</td><td>写锁，与任何锁互斥</td><td>数据插入 / 更新 / 删除</td></tr><tr><td><strong>实现方式</strong></td><td>意向锁（Intention Lock，IS/IX）</td><td>InnoDB</td><td>表级锁，配合行级锁使用</td><td>行级锁的前置锁，避免表锁与行锁冲突</td></tr><tr><td><strong>特殊锁</strong></td><td>记录锁（Record Lock）</td><td>InnoDB</td><td>行级锁的基础，锁定单行记录</td><td>单行精准更新</td></tr><tr><td/><td>间隙锁（Gap Lock）</td><td>InnoDB</td><td>行级锁，锁定索引间隙</td><td>防止幻读，区间查询</td></tr><tr><td/><td>临键锁（Next-Key Lock）</td><td>InnoDB</td><td>记录锁 + 间隙锁，InnoDB 默认行锁</td><td>RR 隔离级别下的行级锁默认形态</td></tr><tr><td/><td>元数据锁（MDL）</td><td>所有引擎</td><td>表级锁，锁定表结构</td><td>表结构修改（ALTER）、表查询</td></tr><tr><td/><td>自增锁（AUTO-INC Lock）</td><td>InnoDB</td><td>表级 / 行级，锁定自增列</td><td>自增主键的插入操作</td></tr></tbody></table>
<p><strong>核心前提</strong>：InnoDB 的锁机制依赖<strong>事务隔离级别</strong>，默认隔离级别为<strong>可重复读（RR）</strong> ，临键锁、间隙锁仅在 RR 级别生效；** 读已提交（RC）** 级别下，InnoDB 会关闭间隙锁，仅保留记录锁，并发更高但无法解决幻读。</p>
<h3 data-id="heading-2">二、各类型锁的详细解析</h3>
<p>本节将逐一讲解 MySQL 中<strong>所有锁类型</strong>的定义、触发条件、特性，重点聚焦 InnoDB 的锁机制（面试 + 生产核心），对 MyISAM/BDB 的锁仅做基础说明。</p>
<h4 data-id="heading-3">2.1 表级锁（Table Lock）：整表管控，简单高效</h4>
<p>表级锁是 MySQL 中<strong>粒度最粗</strong>的锁，对整张表加锁，分为<strong>表共享锁（S 锁）<strong>和</strong>表排他锁（X 锁）</strong> ，MyISAM 的默认锁，InnoDB 也支持手动加表锁。</p>
<h5 data-id="heading-4">核心特性</h5>
<ol>
<li>加锁 / 解锁开销小，无需遍历索引，执行速度快；</li>
<li>并发性能极低：加表 X 锁后，其他事务无法对该表执行<strong>任何读写操作</strong>；加表 S 锁后，其他事务可读但不可写；</li>
<li>InnoDB 中<strong>不建议默认使用</strong>，仅在整表批量操作时手动使用，否则会丧失行级锁的高并发优势。</li>
</ol>
<h5 data-id="heading-5">加锁 / 解锁 SQL（InnoDB/MyISAM 通用）</h5>
<pre><code class="hljs language-sql" lang="sql"># 手动加表共享锁（S锁），加锁后仅能读，不能写
LOCK TABLES `goods_stock` READ;
# 手动加表排他锁（X锁），加锁后禁止其他所有操作
LOCK TABLES `goods_stock` WRITE;
# 解锁（必须手动解锁，否则会话断开前一直持有）
UNLOCK TABLES;
</code></pre>
<h4 data-id="heading-6">2.2 行级锁（Row Lock）：InnoDB 核心，高并发基石</h4>
<p>行级锁是 InnoDB 的<strong>核心锁机制</strong>，粒度最细，仅对操作的<strong>单行 / 多行记录</strong>加锁，分为<strong>行共享锁（S 锁）<strong>和</strong>行排他锁（X 锁）</strong> ，是实现高并发读写的关键。</p>
<p>InnoDB 的行级锁并非直接锁定数据行，而是<strong>基于索引锁定</strong>（索引项加锁），若无索引或未使用索引，行级锁会<strong>退化为表级锁</strong>（生产高频坑点）。</p>
<p>根据锁定范围，InnoDB 的行级锁细分为<strong>记录锁、间隙锁、临键锁</strong>（三者为行级锁的具体实现，非独立分类），以下是详细说明：</p>
<h5 data-id="heading-7">2.2.1 记录锁（Record Lock）：精准锁定单行</h5>
<p><strong>定义</strong>：锁定<strong>索引上的单行记录</strong>，仅对当前存在的行生效，是最基础的行级锁。<strong>触发条件</strong>：<strong>精准匹配索引的等值查询</strong>（主键 / 唯一索引），RR/RC 隔离级别均生效。<strong>示例</strong>：通过商品 ID（主键）更新库存，InnoDB 会对<code>goods_id=1001</code>的索引项加记录锁，仅阻塞该单行的其他写操作，不影响其他商品。</p>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span>; # 主键等值查询，触发记录锁
</code></pre>
<h5 data-id="heading-8">2.2.2 间隙锁（Gap Lock）：锁定索引间隙，防止幻读</h5>
<p><strong>定义</strong>：锁定<strong>两个索引项之间的间隙</strong>（也包括索引首行前、末行后的间隙），不锁定具体行，目的是<strong>防止其他事务在该间隙插入数据</strong>，解决幻读问题。<strong>触发条件</strong>：<strong>RR 隔离级别下</strong>，对<strong>非唯一索引的范围查询 / 等值查询</strong>（未命中行）。<strong>特性</strong>：间隙锁之间<strong>互相兼容</strong>，多个事务可同时对同一间隙加间隙锁，仅阻塞插入操作。<strong>示例</strong>：商品表的非唯一索引<code>idx_category</code>（分类 ID）有值 [1,3,5]，执行范围查询<code>WHERE category_id&gt;2 AND category_id&lt;5</code>，InnoDB 会锁定间隙 (3,5)，其他事务无法在该间隙插入<code>category_id=4</code>的记录。</p>
<h5 data-id="heading-9">2.2.3 临键锁（Next-Key Lock）：InnoDB 默认行锁</h5>
<p><strong>定义</strong>：<strong>记录锁 + 间隙锁</strong>的组合，锁定<strong>当前索引行 + 其后续的索引间隙</strong>，是 InnoDB 在<strong>RR 隔离级别下的默认行级锁形态</strong>。<strong>触发条件</strong>：<strong>RR 隔离级别下</strong>，所有行级锁的默认触发（等值查询命中唯一索引时，临键锁会<strong>降级为记录锁</strong>）。<strong>核心作用</strong>：同时解决<strong>不可重复读</strong>和<strong>幻读</strong>，是 InnoDB RR 级别实现事务隔离的核心。<strong>示例</strong>：索引值 [1,3,5]，执行<code>WHERE category_id&lt;=3</code>，临键锁会锁定 (∞,1]、(1,3] 的记录 + 间隙，其他事务既不能修改 1、3 行，也不能在间隙中插入数据。</p>
<h4 data-id="heading-10">2.3 页级锁（Page Lock）：淘汰的中间方案</h4>
<p>页级锁是 BDB 存储引擎的锁机制，锁定<strong>数据页</strong>（InnoDB 默认 16KB / 页），粒度介于表级锁和行级锁之间。<strong>特性</strong>：加锁开销、并发性能也介于两者之间，无明显优势；<strong>现状</strong>：BDB 引擎已被 MySQL 官方逐步淘汰，实际开发中几乎不使用，无需深入研究。</p>
<h4 data-id="heading-11">2.4 意向锁（Intention Lock）：行级锁的 “前置锁”</h4>
<p>意向锁是 InnoDB 的<strong>表级锁</strong>，分为<strong>意向共享锁（IS）<strong>和</strong>意向排他锁（IX）</strong> ，是行级锁的<strong>前置锁</strong>——<strong>加行级锁前，必须先加对应的意向锁</strong>。</p>
<h5 data-id="heading-12">核心作用</h5>
<p>解决<strong>表级锁与行级锁的冲突检测问题</strong>，避免加表锁时遍历全表检查是否有行锁（大幅提升加锁效率）。</p>
<h5 data-id="heading-13">触发条件</h5>
<ul>
<li>加<strong>行 S 锁</strong>前，自动加<strong>表 IS 锁</strong>；</li>
<li>加<strong>行 X 锁</strong>前，自动加<strong>表 IX 锁</strong>；</li>
<li>意向锁由 InnoDB<strong>自动加锁 / 解锁</strong>，无需手动操作。</li>
</ul>
<h5 data-id="heading-14">特性</h5>
<ol>
<li>意向锁是<strong>表级锁</strong>，仅用于冲突检测，不阻塞任何读写操作；</li>
<li>意向锁之间<strong>互相兼容</strong>，IS 和 IX 可共存；</li>
<li>意向锁与表级锁<strong>互斥</strong>：表 X 锁与 IS/IX 均互斥，表 S 锁仅与 IX 互斥。</li>
</ol>
<h4 data-id="heading-15">2.5 特殊锁：生产高频易踩坑的锁类型</h4>
<p>这类锁并非传统的读写锁，而是 MySQL 为<strong>特殊场景</strong>设计的锁，是生产中<strong>锁阻塞、死锁</strong>的高频诱因，也是面试重点。</p>
<h5 data-id="heading-16">2.5.1 元数据锁（MDL）：表结构的 “隐形锁”</h5>
<p><strong>定义</strong>：MDL（Metadata Lock）是<strong>表级锁</strong>，锁定表的<strong>元数据（表结构）</strong> ，所有 MySQL 引擎均支持，<strong>自动加锁 / 解锁</strong>，无需手动操作。<strong>核心作用</strong>：保证<strong>表结构与数据的一致性</strong>，避免查询过程中表结构被修改（如查询时执行 ALTER TABLE）。</p>
<h5 data-id="heading-17">加锁规则（核心）</h5>
<p>MDL 锁分为 S 锁和 X 锁，加锁逻辑由 MySQL 自动控制，<strong>会话断开前一直持有</strong>：</p>
<ol>
<li>执行<strong>表查询操作</strong>（SELECT/SHOW），自动加<strong>MDL S 锁</strong>，多个 MDL S 锁可共存；</li>
<li>执行<strong>表结构修改操作</strong>（ALTER/DROP/RENAME），自动加<strong>MDL X 锁</strong>，与任何 MDL 锁互斥；</li>
<li>执行<strong>数据修改操作</strong>（INSERT/UPDATE/DELETE），自动加<strong>MDL S 锁</strong>（与查询一致）。</li>
</ol>
<h5 data-id="heading-18">生产高频问题</h5>
<p>高并发查询场景下，执行<code>ALTER TABLE</code>会加 MDL X 锁，而此时表上已有大量 MDL S 锁，导致：</p>
<ul>
<li>MDL X 锁等待所有 MDL S 锁释放；</li>
<li>后续所有查询 / 修改操作会排队等待 MDL X 锁释放，最终导致<strong>整个表的操作阻塞</strong>（生产重大故障）。</li>
</ul>
<h5 data-id="heading-19">2.5.2 自增锁（AUTO-INC Lock）：自增主键的专属锁</h5>
<p><strong>定义</strong>：AUTO-INC Lock 是 InnoDB 为<strong>自增列（AUTO_INCREMENT）<strong>设计的锁，用于保证</strong>自增列值的唯一性和连续性</strong>，避免批量插入时自增 ID 重复。</p>
<h5 data-id="heading-20">加锁模式（innodb_autoinc_lock_mode）</h5>
<p>InnoDB 通过参数<code>innodb_autoinc_lock_mode</code>控制自增锁的加锁粒度，默认值为<strong>1</strong>，可选 0/1/2，不同模式的并发性能不同：</p>

































<table><thead><tr><th>模式值</th><th>锁模式</th><th>特性</th><th>并发性能</th><th>适用场景</th></tr></thead><tbody><tr><td>0</td><td>传统模式</td><td>表级 AUTO-INC 锁，批量插入全程持有</td><td>最低</td><td>需严格连续自增 ID 的场景</td></tr><tr><td>1</td><td>连续模式（默认）</td><td>单行插入行级锁，批量插入表级锁</td><td>中等</td><td>常规业务（大部分场景）</td></tr><tr><td>2</td><td>交错模式</td><td>全程行级锁，自增 ID 可能不连续</td><td>最高</td><td>高并发批量插入（如分库分表）</td></tr></tbody></table>
<h5 data-id="heading-21">核心特性</h5>
<ul>
<li>模式 2 是<strong>并发性能最高</strong>的，但自增 ID 可能不连续（因多事务同时插入）；</li>
<li>主从复制中，若使用<strong>基于语句的复制（SBR）</strong> ，不建议使用模式 2（可能导致从库数据不一致），建议使用<strong>基于行的复制（RBR）</strong> 。</li>
</ul>
<h3 data-id="heading-22">三、MySQL 锁的兼容性矩阵</h3>
<p>锁的<strong>兼容性</strong>指<strong>同一资源上，已持有锁与请求锁是否能共存</strong>，兼容则请求锁成功，不兼容则请求锁的事务<strong>阻塞等待</strong>。</p>
<p>以下是 MySQL<strong>核心锁类型</strong>的兼容性矩阵（√= 兼容，×= 不兼容，—= 无关联），是理解锁阻塞的基础，面试高频考点：</p>








































































































<table><thead><tr><th>已持有锁 \ 请求锁</th><th>表 S 锁</th><th>表 X 锁</th><th>表 IS 锁</th><th>表 IX 锁</th><th>行 S 锁</th><th>行 X 锁</th><th>MDL S 锁</th><th>MDL X 锁</th></tr></thead><tbody><tr><td>表 S 锁</td><td>√</td><td>×</td><td>√</td><td>×</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 X 锁</td><td>×</td><td>×</td><td>×</td><td>×</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 IS 锁</td><td>√</td><td>×</td><td>√</td><td>√</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>表 IX 锁</td><td>×</td><td>×</td><td>√</td><td>√</td><td>—</td><td>—</td><td>—</td><td>—</td></tr><tr><td>行 S 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>√</td><td>×</td><td>—</td><td>—</td></tr><tr><td>行 X 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>×</td><td>×</td><td>—</td><td>—</td></tr><tr><td>MDL S 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>√</td><td>×</td></tr><tr><td>MDL X 锁</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>—</td><td>×</td><td>×</td></tr></tbody></table>
<p><strong>核心结论</strong>：</p>
<ol>
<li>排他锁（表 X / 行 X/MDL X）与<strong>所有锁</strong>互斥，是锁阻塞的核心原因；</li>
<li>共享锁（表 S / 行 S/MDL S）与<strong>其他共享锁</strong>兼容，与<strong>排他锁</strong>互斥；</li>
<li>意向锁（IS/IX）仅与<strong>表级锁</strong>互斥，彼此之间完全兼容。</li>
</ol>
<h3 data-id="heading-23">四、InnoDB 锁的核心实现前提：基于索引</h3>
<p><strong>InnoDB 的行级锁是基于索引实现的，而非基于数据行本身</strong>，这是 InnoDB 锁机制的<strong>核心原则</strong>，也是生产中最容易踩坑的点。</p>
<h4 data-id="heading-24">核心推论</h4>
<ol>
<li><strong>使用索引加锁</strong>：只有通过<strong>主键 / 唯一索引 / 普通索引</strong>的查询条件操作数据，InnoDB 才会加行级锁；</li>
<li><strong>无索引 / 未使用索引→表级锁</strong>：若查询条件无索引，或有索引但未使用（如隐式类型转换），InnoDB 会对整张表加表级锁，导致并发性能骤降；</li>
<li><strong>锁的是索引项，而非数据行</strong>：即使两行数据的物理存储在一起，只要索引项不同，行级锁也不会冲突。</li>
</ol>
<h4 data-id="heading-25">坑点示例：隐式类型转换导致索引失效，行锁退表锁</h4>
<pre><code class="hljs language-sql" lang="sql"># 表结构：goods_id是<span class="hljs-type">BIGINT</span>类型（主键索引）
<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `goods_stock` (
  `goods_id` <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY,
  `stock_num` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB;

# 错误：查询条件传入字符串，触发隐式类型转换，索引失效→行锁退表锁
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-string">'1001'</span>; 
# 正确：查询条件类型与索引一致，使用主键索引→加记录锁
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span><span class="hljs-number">99</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span>;
</code></pre>
<h3 data-id="heading-26">五、典型业务场景与锁机制解决方案</h3>
<p>结合互联网后端<strong>高并发、高可用</strong>的核心需求，针对 8 大典型业务场景，给出<strong>锁的选择策略、可落地的代码实现（SQL/Java）、生产注意事项</strong>，覆盖从单库到分布式、从常规操作到问题解决的全场景。</p>
<h4 data-id="heading-27">场景 1：整表批量操作（如全表数据更新、数据迁移）</h4>
<h5 data-id="heading-28">场景描述</h5>
<p>需要对整张表执行批量更新 / 删除（如批量修改商品价格、清理历史数据），涉及数据量占表的 80% 以上。</p>
<h5 data-id="heading-29">问题痛点</h5>
<p>若使用 InnoDB 默认的行级锁，会遍历全表加大量行锁，加锁开销大、执行速度慢，且容易引发锁冲突。</p>
<h5 data-id="heading-30">锁选择策略</h5>
<p><strong>手动加表级排他锁（WRITE）</strong> ，放弃行级锁的高并发，提升批量操作效率。</p>
<h5 data-id="heading-31">落地 SQL 实现</h5>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-number">1.</span> 手动加表排他锁，阻塞其他所有操作
LOCK TABLES `goods` WRITE;
# <span class="hljs-number">2.</span> 执行批量操作（如批量将分类<span class="hljs-number">1</span>的商品价格打<span class="hljs-number">9</span>折）
<span class="hljs-keyword">UPDATE</span> `goods` <span class="hljs-keyword">SET</span> price<span class="hljs-operator">=</span>price<span class="hljs-operator">*</span><span class="hljs-number">0.9</span> <span class="hljs-keyword">WHERE</span> category_id<span class="hljs-operator">=</span><span class="hljs-number">1</span>;
# <span class="hljs-number">3.</span> 手动解锁，恢复表的正常操作
UNLOCK TABLES;
# <span class="hljs-number">4.</span> 若操作失败，直接解锁即可，无需回滚（表锁无事务特性）
</code></pre>
<h5 data-id="heading-32">生产注意事项</h5>
<ol>
<li>表级锁<strong>无事务特性</strong>，加锁后执行的操作立即生效，无需 COMMIT；</li>
<li>批量操作需在<strong>业务低峰期</strong>执行（如凌晨），避免阻塞正常业务；</li>
<li>操作前必须<strong>备份数据</strong>，防止批量更新错误。</li>
</ol>
<h4 data-id="heading-33">场景 2：高并发单行更新（如电商扣库存、秒杀减库存）</h4>
<h5 data-id="heading-34">场景描述</h5>
<p>高并发下对单行数据执行更新操作（如扣库存、修改用户余额），要求<strong>数据一致性</strong>，绝对避免超卖 / 超扣，冲突率高。</p>
<h5 data-id="heading-35">锁选择策略</h5>
<p><strong>InnoDB 行排他锁（记录锁）+ 显式事务</strong>（悲观锁），通过<code>FOR UPDATE</code>精准加行锁，保证事务原子性。</p>
<h5 data-id="heading-36">落地实现（SQL+Java）</h5>
<h6 data-id="heading-37">步骤 1：表结构设计（主键索引，保证行锁生效）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `goods_stock` (
  `goods_id` <span class="hljs-type">BIGINT</span> UNSIGNED <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">PRIMARY</span> KEY COMMENT <span class="hljs-string">'商品ID（主键）'</span>,
  `stock_num` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'库存数量'</span>,
  `update_time` DATETIME <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span> <span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> <span class="hljs-built_in">CURRENT_TIMESTAMP</span>
) ENGINE<span class="hljs-operator">=</span>InnoDB COMMENT<span class="hljs-operator">=</span><span class="hljs-string">'商品库存表'</span>;
# 初始化库存：商品<span class="hljs-number">1001</span>库存<span class="hljs-number">100</span>件
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> goods_stock (goods_id, stock_num) <span class="hljs-keyword">VALUES</span> (<span class="hljs-number">1001</span>, <span class="hljs-number">100</span>);
</code></pre>
<h6 data-id="heading-38">步骤 2：SQL 显式事务 + FOR UPDATE 加记录锁</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>; # 开启显式事务，关闭自动提交
# 主键等值查询，<span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>加行排他锁（记录锁）
<span class="hljs-keyword">SELECT</span> stock_num <span class="hljs-keyword">FROM</span> goods_stock <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
# 扣减库存，业务层需先判断stock_num<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>
<span class="hljs-keyword">UPDATE</span> goods_stock <span class="hljs-keyword">SET</span> stock_num<span class="hljs-operator">=</span>stock_num<span class="hljs-number">-1</span> <span class="hljs-keyword">WHERE</span> goods_id<span class="hljs-operator">=</span><span class="hljs-number">1001</span> <span class="hljs-keyword">AND</span> stock_num<span class="hljs-operator">&gt;</span><span class="hljs-number">0</span>;
# 获取受影响行数，业务层判断是否扣减成功（<span class="hljs-number">0</span><span class="hljs-operator">=</span>库存不足）
<span class="hljs-keyword">SELECT</span> ROW_COUNT();
<span class="hljs-keyword">COMMIT</span>; # 提交事务，释放锁
# <span class="hljs-keyword">ROLLBACK</span>; # 若失败，回滚事务，释放锁
</code></pre>
<h6 data-id="heading-39">步骤 3：Java 业务层实现（Spring Boot）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span> <span class="hljs-comment">// 声明式事务，替代手动BEGIN/COMMIT</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">StockService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;

    <span class="hljs-comment">/**
     * 扣减库存（悲观锁实现）
     * <span class="hljs-doctag">@param</span> goodsId 商品ID
     * <span class="hljs-doctag">@return</span> true=成功，false=库存不足
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductStock</span><span class="hljs-params">(Long goodsId)</span> {
        <span class="hljs-comment">// 1. 查询库存并加行锁（FOR UPDATE）</span>
        <span class="hljs-type">Integer</span> <span class="hljs-variable">stock</span> <span class="hljs-operator">=</span> jdbcTemplate.queryForObject(
                <span class="hljs-string">"SELECT stock_num FROM goods_stock WHERE goods_id=? FOR UPDATE"</span>,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[]{goodsId},
                Integer.class
        );
        <span class="hljs-keyword">if</span> (stock == <span class="hljs-literal">null</span> || stock &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 库存不足</span>
        }
        <span class="hljs-comment">// 2. 扣减库存</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">row</span> <span class="hljs-operator">=</span> jdbcTemplate.update(
                <span class="hljs-string">"UPDATE goods_stock SET stock_num=stock_num-1 WHERE goods_id=? AND stock_num&gt;0"</span>,
                goodsId
        );
        <span class="hljs-keyword">return</span> row &gt; <span class="hljs-number">0</span>;
    }
}
</code></pre>
<h5 data-id="heading-40">生产注意事项</h5>
<ol>
<li><code>FOR UPDATE</code>必须在<strong>显式事务</strong>中使用，否则会自动提交，锁立即释放；</li>
<li>务必通过<strong>主键 / 唯一索引</strong>查询，避免行锁退表锁；</li>
<li>事务中仅包含核心操作，<strong>不执行耗时操作</strong>（如 RPC 调用、文件读写），缩短锁持有时间。</li>
</ol>
<h4 data-id="heading-41">场景 3：低冲突数据修改（如用户信息修改、订单状态更新）</h4>
<h5 data-id="heading-42">场景描述</h5>
<p>对数据执行修改操作，但<strong>冲突率极低</strong>（如用户修改昵称、订单状态从 “待支付” 改为 “已取消”），无需严格阻塞其他事务。</p>
<h5 data-id="heading-43">问题痛点</h5>
<p>若使用悲观锁（FOR UPDATE），会导致不必要的锁阻塞，降低并发性能。</p>
<h5 data-id="heading-44">锁选择策略</h5>
<p><strong>乐观锁</strong>（基于版本号 / 时间戳实现），无锁阻塞，通过版本号判断数据是否被修改，提升并发性能。</p>
<h5 data-id="heading-45">落地实现（SQL+Java）</h5>
<h6 data-id="heading-46">步骤 1：表结构新增版本号字段（乐观锁核心）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `user_info` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'乐观锁版本号'</span>;
<span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">TABLE</span> `order_info` <span class="hljs-keyword">ADD</span> <span class="hljs-keyword">COLUMN</span> `version` <span class="hljs-type">INT</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0</span> COMMENT <span class="hljs-string">'乐观锁版本号'</span>;
</code></pre>
<h6 data-id="heading-47">步骤 2：SQL 乐观锁更新逻辑</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-keyword">BEGIN</span>;
# <span class="hljs-number">1.</span> 查询用户信息和版本号
<span class="hljs-keyword">SELECT</span> nickname, version <span class="hljs-keyword">FROM</span> user_info <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">10086</span>;
# <span class="hljs-number">2.</span> 更新昵称，仅当版本号匹配时执行（保证基于最新版本修改）
<span class="hljs-keyword">UPDATE</span> user_info <span class="hljs-keyword">SET</span> nickname<span class="hljs-operator">=</span><span class="hljs-string">'新昵称'</span>, version<span class="hljs-operator">=</span>version<span class="hljs-operator">+</span><span class="hljs-number">1</span> <span class="hljs-keyword">WHERE</span> user_id<span class="hljs-operator">=</span><span class="hljs-number">10086</span> <span class="hljs-keyword">AND</span> version<span class="hljs-operator">=</span>#{oldVersion};
# <span class="hljs-number">3.</span> 判断受影响行数，<span class="hljs-number">0</span><span class="hljs-operator">=</span>数据已被其他事务修改
<span class="hljs-keyword">SELECT</span> ROW_COUNT();
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h6 data-id="heading-48">步骤 3：Java 业务层实现（带重试机制）</h6>
<pre><code class="hljs language-sql" lang="sql"><span class="hljs-variable">@Service</span>
public class UserService {
    <span class="hljs-variable">@Autowired</span>
    private UserMapper userMapper;
    <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 最大重试次数
    private <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> MAX_RETRY <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;

    <span class="hljs-comment">/**
     * 修改用户昵称（乐观锁+重试）
     * @param userId 用户ID
     * @param newNickname 新昵称
     * @return true=成功
     */</span>
    public <span class="hljs-type">boolean</span> updateNickname(Long userId, String newNickname) {
        <span class="hljs-type">int</span> retry <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        while (retry <span class="hljs-operator">&lt;</span> MAX_RETRY) {
            <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">1.</span> 查询用户最新信息和版本号
            UserInfo <span class="hljs-keyword">user</span> <span class="hljs-operator">=</span> userMapper.selectById(userId);
            if (<span class="hljs-keyword">user</span> <span class="hljs-operator">=</span><span class="hljs-operator">=</span> <span class="hljs-keyword">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
            <span class="hljs-operator">/</span><span class="hljs-operator">/</span> <span class="hljs-number">2.</span> 执行乐观锁更新
            <span class="hljs-type">int</span> <span class="hljs-type">row</span> <span class="hljs-operator">=</span> userMapper.updateNickname(userId, newNickname, user.getVersion());
            if (<span class="hljs-type">row</span> <span class="hljs-operator">&gt;</span> <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 更新成功
            }
            retry<span class="hljs-operator">+</span><span class="hljs-operator">+</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 更新失败，重试
            try {
                Thread.sleep(<span class="hljs-number">100</span>); <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 短暂休眠，避免瞬时冲突
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> 重试多次失败
    }
}

<span class="hljs-operator">/</span><span class="hljs-operator">/</span> Mapper接口
public interface UserMapper {
    <span class="hljs-variable">@Select</span>("SELECT user_id, nickname, version FROM user_info WHERE user_id=#{userId}")
    UserInfo selectById(Long userId);

    <span class="hljs-variable">@Update</span>("UPDATE user_info SET nickname=#{newNickname}, version=version+1 WHERE user_id=#{userId} AND version=#{oldVersion}")
    <span class="hljs-type">int</span> updateNickname(<span class="hljs-variable">@Param</span>("userId") Long userId, <span class="hljs-variable">@Param</span>("newNickname") String newNickname, <span class="hljs-variable">@Param</span>("oldVersion") <span class="hljs-type">Integer</span> oldVersion);
}
</code></pre>
<h5 data-id="heading-49">生产注意事项</h5>
<ol>
<li>乐观锁<strong>无实际加锁</strong>，通过版本号实现冲突检测，适用于<strong>读多写少、冲突率低</strong>的场景；</li>
<li>必须增加<strong>重试机制</strong>，若更新失败，说明数据被其他事务修改，重试即可；</li>
<li>版本号建议使用<strong>INT/BIGINT</strong>，避免使用时间戳（存在并发下时间戳相同的情况）。</li>
</ol>
<h4 data-id="heading-50">场景 4：防幻读业务（如区间查询并更新、批量筛选数据）</h4>
<h5 data-id="heading-51">场景描述</h5>
<p>需要对<strong>索引区间</strong>内的数据执行查询并更新（如查询 “2025-01-01 至 2025-01-10” 的订单并修改状态），要求<strong>解决幻读</strong>（避免更新过程中其他事务在该区间插入新数据）。</p>
<h5 data-id="heading-52">锁选择策略</h5>
<p><strong>InnoDB 临键锁</strong>（RR 隔离级别默认），无需手动加锁，通过<strong>范围查询</strong>触发临键锁，锁定区间内的记录 + 间隙，防止幻读。</p>
<h5 data-id="heading-53">落地 SQL 实现</h5>
<pre><code class="hljs language-sql" lang="sql"># 订单表：create_time为DATETIME类型，有索引idx_create_time
# RR隔离级别下，范围查询自动触发临键锁，防止幻读
<span class="hljs-keyword">BEGIN</span>;
# 范围查询<span class="hljs-number">2025</span><span class="hljs-number">-01</span><span class="hljs-number">-01</span>至<span class="hljs-number">2025</span><span class="hljs-number">-01</span><span class="hljs-number">-10</span>的订单，触发临键锁
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> order_info <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-10'</span> <span class="hljs-keyword">FOR</span> <span class="hljs-keyword">UPDATE</span>;
# 修改该区间内的订单状态为“已完成”
<span class="hljs-keyword">UPDATE</span> order_info <span class="hljs-keyword">SET</span> order_status<span class="hljs-operator">=</span><span class="hljs-number">3</span> <span class="hljs-keyword">WHERE</span> create_time <span class="hljs-keyword">BETWEEN</span> <span class="hljs-string">'2025-01-01'</span> <span class="hljs-keyword">AND</span> <span class="hljs-string">'2025-01-10'</span>;
<span class="hljs-keyword">COMMIT</span>;
</code></pre>
<h5 data-id="heading-54">生产注意事项</h5>
<ol>
<li>必须在<strong>RR 隔离级别</strong>下执行，RC 级别会关闭间隙锁，无法解决幻读；</li>
<li>范围查询的字段必须<strong>建立索引</strong>，否则行锁退表锁；</li>
<li>临键锁的锁定范围较大，尽量缩小查询区间，减少锁冲突。</li>
</ol>
<h4 data-id="heading-55">场景 5：高并发批量插入（如分库分表插入、日志批量写入）</h4>
<h5 data-id="heading-56">场景描述</h5>
<p>高并发下对表执行批量插入操作（如分库分表的订单插入、系统日志批量写入），自增主键的插入性能成为瓶颈。</p>
<h5 data-id="heading-57">问题痛点</h5>
<p>InnoDB 默认的自增锁模式（innodb_autoinc_lock_mode=1）在批量插入时会加表级锁，导致插入性能低。</p>
<h5 data-id="heading-58">锁优化策略</h5>
<p>修改自增锁模式为<strong>2（交错模式）</strong> ，全程使用行级锁，提升批量插入的并发性能。</p>
<h5 data-id="heading-59">落地配置 + 实现</h5>
<h6 data-id="heading-60">步骤 1：修改 MySQL 配置（my.cnf/my.ini）</h6>
<pre><code class="hljs language-ini" lang="ini"><span class="hljs-section">[mysqld]</span>
<span class="hljs-comment"># 自增锁模式改为2（交错模式），高并发批量插入最优</span>
<span class="hljs-attr">innodb_autoinc_lock_mode</span> = <span class="hljs-number">2</span>
<span class="hljs-comment"># 开启基于行的复制（RBR），配合模式2使用，避免主从数据不一致</span>
<span class="hljs-attr">binlog_format</span> = ROW
</code></pre>
<h6 data-id="heading-61">步骤 2：Java 批量插入实现（MyBatis-Plus）</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> OrderMapper orderMapper;

    <span class="hljs-comment">/**
     * 高并发批量插入订单
     * <span class="hljs-doctag">@param</span> orderList 订单列表
     * <span class="hljs-doctag">@return</span> 插入成功数
     */</span>
    <span class="hljs-meta">@Transactional(rollbackFor = Exception.class)</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">batchInsert</span><span class="hljs-params">(List&lt;OrderInfo&gt; orderList)</span> {
        <span class="hljs-keyword">return</span> orderMapper.saveBatch(orderList, <span class="hljs-number">100</span>); <span class="hljs-comment">// 每次插入100条，分批提交</span>
    }
}
</code></pre>
<h5 data-id="heading-62">生产注意事项</h5>
<ol>
<li>模式 2 的自增 ID<strong>可能不连续</strong>，但不影响业务（无需严格连续的场景均可使用）；</li>
<li>必须配合<strong>binlog_format=ROW</strong>（基于行的复制）使用，若使用 SBR（基于语句的复制），会导致主从数据不一致；</li>
<li>批量插入建议<strong>分批提交</strong>（如每次 100/500 条），避免单事务插入数据过多，导致事务过大。</li>
</ol>
<h4 data-id="heading-63">场景 6：生产高频问题 ——MDL 锁阻塞（查询时执行 ALTER TABLE）</h4>
<h5 data-id="heading-64">问题描述</h5>
<p>高并发查询场景下，执行<code>ALTER TABLE</code>修改表结构，导致<strong>整个表的所有操作（查询 / 修改）全部阻塞</strong>，数据库连接数暴涨，最终引发生产故障。</p>
<h5 data-id="heading-65">问题根因</h5>
<ul>
<li>高并发查询持有大量<strong>MDL S 锁</strong>；</li>
<li>执行<code>ALTER TABLE</code>需要加<strong>MDL X 锁</strong>，与 MDL S 锁互斥，X 锁等待所有 S 锁释放；</li>
<li>后续所有查询 / 修改操作需要加 MDL S 锁，排队等待 X 锁释放，形成<strong>阻塞链</strong>。</li>
</ul>
<h5 data-id="heading-66">解决方案</h5>
<p>使用<strong>在线 DDL 工具</strong>（如 pt-online-schema-change/gh-ost），避免直接执行<code>ALTER TABLE</code>，工具会通过<strong>分批次复制数据、触发器同步增量</strong>的方式修改表结构，全程不持有 MDL X 锁，不阻塞业务。</p>
<h5 data-id="heading-67">落地实现（pt-online-schema-change）</h5>
<pre><code class="hljs language-bash" lang="bash"><span class="hljs-comment"># 安装percona-toolkit工具</span>
yum install percona-toolkit -y
<span class="hljs-comment"># 在线修改表结构：为order_info表新增字段remark（VARCHAR(255)）</span>
<span class="hljs-comment"># --alter：要执行的DDL语句</span>
<span class="hljs-comment"># D=数据库名，t=表名</span>
<span class="hljs-comment"># h=数据库IP，u=用户名，p=密码</span>
pt-online-schema-change --alter <span class="hljs-string">"ADD COLUMN remark VARCHAR(255) DEFAULT '' COMMENT '备注'"</span> D=shop,t=order_info h=127.0.0.1,u=root,p=123456 --execute
</code></pre>
<h5 data-id="heading-68">生产注意事项</h5>
<ol>
<li>禁止在<strong>高并发时段</strong>直接执行<code>ALTER TABLE</code>，即使使用在线 DDL 工具，也需在低峰期执行；</li>
<li>在线 DDL 工具会产生<strong>临时表和触发器</strong>，执行前需保证数据库有足够的磁盘空间和权限；</li>
<li>执行前先通过<code>pt-online-schema-change --dry-run</code>模拟执行，检查是否有错误。</li>
</ol>
<h4 data-id="heading-69">场景 7：分布式系统并发控制（微服务 / 分库分表下的扣库存）</h4>
<h5 data-id="heading-70">场景描述</h5>
<p>系统为<strong>分布式部署</strong>（多服务实例 / 多数据库实例），高并发下执行扣库存 / 下单操作，单库的行级锁 / 乐观锁无法解决<strong>跨实例的并发冲突</strong>，导致超卖。</p>
<h5 data-id="heading-71">锁选择策略</h5>
<p><strong>Redis 分布式锁 + InnoDB 行级锁</strong>，双重锁机制：</p>
<ol>
<li><strong>Redis 分布式锁</strong>：解决跨实例的并发冲突，保证同一商品只有一个实例能执行扣库存；</li>
<li><strong>InnoDB 行级锁</strong>：解决单库内的并发冲突，保证单实例内的数据一致性。</li>
</ol>
<h5 data-id="heading-72">落地实现（Java+Redis+MySQL）</h5>
<h6 data-id="heading-73">步骤 1：Redis 分布式锁工具类（基于 Redisson，推荐生产使用）</h6>
<p>Redisson 是 Redis 官方推荐的分布式锁实现，解决了<strong>死锁、锁超时、重入</strong>等问题，比手动实现的 Redis 锁更稳定。</p>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RedissonConfig</span> {
    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> RedissonClient <span class="hljs-title function_">redissonClient</span><span class="hljs-params">()</span> {
        <span class="hljs-type">Config</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();
        config.useSingleServer().setAddress(<span class="hljs-string">"redis://127.0.0.1:6379"</span>).setPassword(<span class="hljs-string">"123456"</span>);
        <span class="hljs-keyword">return</span> Redisson.create(config);
    }
}
</code></pre>
<h6 data-id="heading-74">步骤 2：分布式扣库存核心实现</h6>
<pre><code class="hljs language-java" lang="java"><span class="hljs-meta">@Service</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DistributeStockService</span> {
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> RedissonClient redissonClient;
    <span class="hljs-meta">@Autowired</span>
    <span class="hljs-keyword">private</span> StockService stockService; <span class="hljs-comment">// 场景2的悲观锁扣库存服务</span>

    <span class="hljs-comment">/**
     * 分布式扣库存（Redis分布式锁+MySQL行级锁）
     * <span class="hljs-doctag">@param</span> goodsId 商品ID
     * <span class="hljs-doctag">@return</span> true=成功
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">deductDistributeStock</span><span class="hljs-params">(Long goodsId)</span> {
        <span class="hljs-comment">// 1. 定义Redis分布式锁的key（按商品ID区分，细粒度锁）</span>
        <span class="hljs-type">String</span> <span class="hljs-variable">lockKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"stock:lock:"</span> + goodsId;
        <span class="hljs-type">RLock</span> <span class="hljs-variable">lock</span> <span class="hljs-operator">=</span> redissonClient.getLock(lockKey);
        <span class="hljs-keyword">try</span> {
            <span class="hljs-comment">// 2. 获取分布式锁，等待3秒，持有10秒（避免死锁）</span>
            <span class="hljs-type">boolean</span> <span class="hljs-variable">lockSuccess</span> <span class="hljs-operator">=</span> lock.tryLock(<span class="hljs-number">3</span>, <span class="hljs-number">10</span>, TimeUnit.SECONDS);
            <span class="hljs-keyword">if</span> (!lockSuccess) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 获取锁失败，直接返回</span>
            }
            <span class="hljs-comment">// 3. 获取锁成功，执行MySQL行级锁扣库存</span>
            <span class="hljs-keyword">return</span> stockService.deductStock(goodsId);
        } <span class="hljs-keyword">catch</span> (InterruptedException e) {
            Thread.currentThread().interrupt();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-comment">// 4. 释放分布式锁（必须在finally中释放，避免锁泄漏）</span>
            <span class="hljs-keyword">if</span> (lock.isHeldByCurrentThread()) {
                lock.unlock();
            }
        }
    }
}
</code></pre>
<h5 data-id="heading-75">生产注意事项</h5>
<ol>
<li>分布式锁的<strong>锁粒度要细</strong>（如按商品 ID / 用户 ID），避免使用全局锁（如 stock:lock），导致并发性能低；</li>
<li>必须设置<strong>锁超时时间</strong>，避免服务宕机导致锁无法释放（死锁）；</li>
<li>推荐使用<strong>Redisson</strong>实现分布式锁，避免手动实现的锁存在漏洞（如 SETNX 未加过期时间）。</li>
</ol>
<h4 data-id="heading-76">场景 8：生产高频问题 —— 死锁的定位、解决与预防</h4>
<h5 data-id="heading-77">死锁定义</h5>
<p>两个或多个事务<strong>互相持有对方需要的锁</strong>，且均不释放自己的锁，导致彼此永久阻塞，是 MySQL 锁机制的常见问题。</p>
<h5 data-id="heading-78">死锁示例</h5>
<p>事务 A 持有 goods_id=1001 的行锁，请求 goods_id=1002 的行锁；事务 B 持有 goods_id=1002 的行锁，请求 goods_id=1001 的行锁，形成互相等待。</p>
<h5 data-id="heading-79">步骤 1：死锁的定位（MySQL 内置命令）</h5>
<p>InnoDB 会<strong>自动检测死锁</strong>，并回滚其中一个事务（代价最小的），但需手动定位死锁原因，避免再次发生。</p>
<pre><code class="hljs language-sql" lang="sql"># <span class="hljs-number">1.</span> 开启死锁日志（my.cnf配置，永久生效）
innodb_print_all_deadlocks <span class="hljs-operator">=</span> <span class="hljs-number">1</span>
# <span class="hljs-number">2.</span> 查看最新的死锁详情（核心命令）
<span class="hljs-keyword">SHOW</span> ENGINE INNODB STATUS;
# <span class="hljs-number">3.</span> 查看当前活跃事务、锁等待情况
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_TRX; # 活跃事务
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCK_WAITS; # 锁等待
<span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> information_schema.INNODB_LOCKS; # 持有锁
</code></pre>
<p><strong>核心查看点</strong>：<code>SHOW ENGINE INNODB STATUS</code>的<code>LATEST DEADLOCK</code>部分，包含死锁的事务、持有的锁、请求的锁，是定位根因的关键。</p>
<h5 data-id="heading-80">步骤 2：死锁的解决</h5>
<ol>
<li><strong>立即解决</strong>：InnoDB 会自动回滚代价最小的事务，无需手动干预；若未自动回滚，可通过<code>KILL [事务ID]</code>杀死阻塞的事务；</li>
<li><strong>根本解决</strong>：根据死锁定位结果，优化事务的加锁逻辑，避免互相等待。</li>
</ol>
<h5 data-id="heading-81">步骤 3：死锁的预防（生产最佳实践）</h5>
<p>死锁的核心诱因是<strong>事务加锁顺序不一致、锁持有时间过长、锁定范围过大</strong>，针对性预防即可：</p>
<ol>
<li><strong>统一加锁顺序</strong>：多个事务对多张表 / 多行数据加锁时，必须遵循<strong>相同的加锁顺序</strong>（如先锁 goods_id=1001，再锁 goods_id=1002）；</li>
<li><strong>缩短锁持有时间</strong>：事务中仅包含核心操作，<strong>不执行耗时操作</strong>（如 RPC 调用、文件读写、睡眠），快速提交 / 回滚事务；</li>
<li><strong>缩小锁定范围</strong>：尽量使用<strong>主键 / 唯一索引</strong>的等值查询，触发记录锁，避免临键锁 / 表锁的大范围锁定；</li>
<li><strong>设置锁等待超时</strong>：通过参数<code>innodb_lock_wait_timeout</code>设置行锁等待超时时间（默认 50 秒，建议改为 10 秒），避免永久阻塞；</li>
<li><strong>避免大事务</strong>：将大事务拆分为多个小事务，减少锁的持有时间和锁定范围。</li>
</ol>
<h3 data-id="heading-82">六、MySQL 锁机制优化最佳实践</h3>
<p>MySQL 锁机制的优化核心是<strong>减少锁冲突、缩短锁持有时间、提升并发性能</strong>，结合索引、事务、配置、架构四个维度，给出生产可落地的最佳实践，覆盖 90% 以上的锁优化场景：</p>
<h4 data-id="heading-83">6.1 索引优化：行级锁的基础</h4>
<ol>
<li>所有<strong>写操作（UPDATE/DELETE/FOR UPDATE）<strong>的 WHERE 条件必须</strong>使用主键 / 唯一索引 / 普通索引</strong>，避免行锁退表锁；</li>
<li>避免<strong>隐式类型转换、使用函数操作索引</strong>，导致索引失效；</li>
<li>合理设计索引，遵循<strong>最左匹配、覆盖索引、避免冗余索引</strong>原则，提升查询效率，减少锁的持有时间。</li>
</ol>
<h4 data-id="heading-84">6.2 事务优化：缩短锁持有时间</h4>
<ol>
<li>使用<strong>显式事务</strong>，替代自动提交（autocommit=1），精准控制事务的开始和结束；</li>
<li><strong>事务中仅包含核心业务操作</strong>，不执行耗时操作（RPC 调用、文件读写、睡眠）；</li>
<li>拆分<strong>大事务</strong>为多个小事务，减少锁的持有时间和锁定范围；</li>
<li>根据业务需求选择<strong>合适的隔离级别</strong>：读多写少、无需解决幻读的场景，可将隔离级别改为<strong>RC</strong>，关闭间隙锁，提升并发性能。</li>
</ol>
<h4 data-id="heading-85">6.3 配置优化：适配高并发</h4>
<ol>
<li>高并发批量插入场景，将<code>innodb_autoinc_lock_mode</code>改为 2，<code>binlog_format</code>改为 ROW；</li>
<li>设置合理的<strong>锁等待超时</strong>：<code>innodb_lock_wait_timeout=10</code>（秒），避免永久阻塞；</li>
<li>开启死锁日志：<code>innodb_print_all_deadlocks=1</code>，方便定位死锁问题；</li>
<li>调大 InnoDB 缓冲池：<code>innodb_buffer_pool_size</code>设置为物理内存的 50%-70%，提升查询效率，减少锁冲突。</li>
</ol>
<h4 data-id="heading-86">6.4 架构优化：从单库到分布式</h4>
<ol>
<li><strong>读多写少</strong>的场景，使用<strong>主从复制 + 读写分离</strong>，主库负责写操作（加锁），从库负责读操作，分散数据库压力；</li>
<li><strong>单表数据量过大</strong>（千万 / 亿级），使用<strong>分库分表</strong>，将大表拆分为多个小表，分散锁的冲突；</li>
<li><strong>分布式系统</strong>，使用<strong>Redis 分布式锁 + MySQL 行级锁</strong>，解决跨实例的并发冲突；</li>
<li>避免<strong>跨库联表查询</strong>，尽量在业务层做关联，减少分布式场景下的锁复杂度。</li>
</ol>
<h3 data-id="heading-87">七、总结</h3>
<p>MySQL 锁机制是数据库并发控制的核心，<strong>InnoDB 的行级锁</strong>是互联网后端开发的重点，其设计的核心是<strong>基于索引、细粒度管控、高并发适配</strong>。掌握 MySQL 锁机制的关键，不仅要理解各类锁的定义、特性、兼容性（面试八股文），更要结合<strong>业务场景</strong>选择合适的锁策略 ——<strong>悲观锁适用于高冲突场景，乐观锁适用于低冲突场景，分布式锁适用于跨实例场景</strong>。</p>
<p>生产中绝大多数的锁问题（锁阻塞、死锁、行锁退表锁），根源并非锁机制本身，而是<strong>索引设计不合理、事务编写不规范、锁选择策略不当</strong>。因此，锁机制的优化并非孤立的，而是与<strong>索引优化、事务优化、架构优化</strong>深度结合的系统性工程。</p>
<p>对于 Java 后端开发而言，掌握 MySQL 锁机制是应对大厂面试、解决生产并发问题的必备技能，核心原则可总结为：<strong>索引为基、事务为纲、锁随场景、优化随行</strong>。</p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答]]></title>    <link>https://juejin.cn/post/7598734303174098996</link>    <guid>https://juejin.cn/post/7598734303174098996</guid>    <pubDate>2026-01-25T13:25:59.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598734303174098996" data-draft-id="7597266967139139618" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答"/> <meta itemprop="keywords" content="后端"/> <meta itemprop="datePublished" content="2026-01-25T13:25:59.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="用户49793230963"/> <meta itemprop="url" content="https://juejin.cn/user/4461159469290944"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            HashMap 线程不安全怎么办？从 Hashtable 到 ConcurrentHashMap 的完美解答
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/4461159469290944/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    用户49793230963
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:25:59.000Z" title="Sun Jan 25 2026 13:25:59 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    0
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读9分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><p>“在 Java 集合框架体系中，容器主要根据并发特性划分为<strong>线程安全</strong>与<strong>非线程安全</strong>两大阵营。纵观 JDK 的迭代历程，容器的演进本质上是设计者在**并发安全（Safety）<strong>与</strong>执行性能（Performance）**之间不断权衡与博弈的过程。这一演进脉络，不仅记录了技术的更迭，更为我们深入理解并发编程的设计哲学提供了宝贵的范本。”</p>
<p>那么什么是“线程安全”？
我们来看一下线程安全的定义：
<strong>Brian Goetz 给出的定义是：</strong></p>
<blockquote>
<p>“当多个线程访问一个类时，如果不用考虑这些线程在运行时环境下的调度和交替执行，并且不需要额外的同步，这个类都能表现出<strong>正确的行为</strong>，那么这个类就是线程安全的。”</p>
</blockquote>
<p>为了更好理解，可以将这个定义拆解为三个关键词：</p>
<ul>
<li>
<p><strong>多线程访问</strong>：这是前提条件。如果是单线程，谈论线程安全没有意义。</p>
</li>
<li>
<p><strong>无须额外同步</strong>：使用者（调用方）不需要自己加锁（如 <code>synchronized</code> 或 <code>Lock</code>），这个类内部已经处理好了。</p>
</li>
<li>
<p><strong>正确的行为</strong>：无论线程怎么抢占 CPU，结果永远符合预期。比如计数器不会少算，转账金额不会凭空消失。</p>
</li>
</ul>
<p>其实其实所谓的安全 无非就是解决了这三个问题</p>
<ul>
<li>
<p><strong>原子性 (Atomicity)</strong> ：操作要么全部执行，要么全不执行，不能被中断。（例如：<code>i++</code> 不是原子的）。</p>
</li>
<li>
<p><strong>可见性 (Visibility)</strong> ：一个线程修改了数据，其他线程能立刻看到。（例如：<code>volatile</code> 关键字）。</p>
</li>
<li>
<p><strong>有序性 (Ordering)</strong> ：程序代码按照预期的顺序执行，禁止指令重排。
这三个问题也是并发编程的三大核心 从内在的JMM 到表现在程序里面的volatile synchronized RLock 再到无锁操作CAS本质上都是为了在保证一定性能的同时去解决 原子性 可见性 有序性。</p>
</li>
</ul>
<p>从最早的“全表锁”到现在的“无锁化（CAS）”和“分段思想”，JDK 的每一次迭代都在试图解决一个核心矛盾：<strong>如何在保证数据不乱的前提下，让多线程跑得更快？</strong></p>
<p>我将 Java 容器的发展分为<strong>三个时代</strong>，为你梳理这条演进之路：</p>
<h4 data-id="heading-0">第一时代：上古时代的“绝对安全” (JDK 1.0)</h4>
<p>此时的JDK处于刚刚发展阶段 为了保证安全宁愿这个实现的方式简单粗暴</p>
<p>观看HashTable的源码 发现它涉及到修改操作的方法都是被synchronized 关键字包围的 比如说</p>
<p><img src="https://p3-xtjj-sign.byteimg.com/tos-cn-i-73owjymdk6/5f4270ae57ff41e8849d65c1ee81a864~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg55So5oi3NDk3OTMyMzA5NjM=:q75.awebp?rk3s=f64ab15b&amp;x-expires=1769952359&amp;x-signature=uuyMbDqaSkdePTjxBftEPCg0GBQ%3D" alt="image.png" loading="lazy"/></p>
<p>这种操作无疑可以保证多线程下的 可见性 原子性 有序性 因为加锁本质上就是只允许同一时间 只能有一个线程去进行操作 但是这种设计真的够优雅吗 答案是否定的 本质上加锁的操作极大的影响了性能 我们可能很多时候只有一个线程去执行 所以我们需要一种更快速的容器</p>
<h4 data-id="heading-1">第二时代：性能觉醒的“裸奔时代” (JDK 1.2)</h4>
<p>在经历了 JDK 1.0 中 <code>Vector</code> 和 <code>Hashtable</code> 的“笨重”之后，JDK 1.2 迎来了一次彻底的<strong>思想解放</strong>。设计者意识到：在绝大多数实际应用场景中，容器仅仅是在<strong>单线程</strong>环境下作为局部变量使用的。</p>
<p>为了那 1% 的并发场景，让 99% 的单线程场景都背负沉重的锁竞争开销，这是极不划算的。于是， <strong>“性能至上”</strong> 成为了这一时期的绝对信条。</p>
<p>标题所说的HashMap正是这个阶段诞生的 观看源码可以看出 此时的容器发展完全牺牲了并发安全这个要素 它的所有操作都没有锁 这也导致了性能的极致 但也为并发安全性埋下了隐患</p>
<ul>
<li><strong>JDK 1.7</strong>：多线程扩容会导致链表成环，CPU 飙升 100%。</li>
<li><strong>JDK 1.8</strong>：多线程 Put 会导致数据直接覆盖（丢失）。</li>
<li><strong>但这不重要</strong>：在设计者的眼里，这些问题是使用者应该去规避的，容器本身的职责就是<strong>快</strong>。</li>
</ul>
<p>可是我们真的没有办法在并发安全和性能做一个平衡 真的做不到既要又要吗 答案是否定的</p>
<h4 data-id="heading-2">第三时代：并发大师的“黄金时代” (JDK 1.5 - J.U.C)</h4>
<p>在这个充满设计者智慧的版本中 我们可以看到许多设计精妙的容器 就比如我们今天的主角ConcurrentHashMap</p>
<p>我们将 CHM 的演进分为两个时代：<strong>JDK 1.7 的“分段锁时代”</strong> 和 <strong>JDK 1.8 的“CAS + 红黑树时代”</strong> 。</p>
<p><strong>第一部分：JDK 1.7 —— 分段锁 (Segment Locking)</strong>
在 JDK 1.7 中，设计者 Doug Lea 的核心思想是： <strong>“大化小”</strong> 。既然锁整个大数组太慢，那我就把它切成几块（Segments），每一块自己管自己的锁。</p>
<h4 data-id="heading-3">1. 核心结构</h4>
<ul>
<li><strong>Segment 数组 + HashEntry 数组</strong>。</li>
<li>一个 <code>ConcurrentHashMap</code> 内部维护了一个 <code>Segment</code> 数组。</li>
<li><strong>关键点</strong>：<code>Segment</code> 这个类直接继承了 <code>ReentrantLock</code>。这意味着每个 Segment 本身就是一把锁。</li>
<li>默认 <code>concurrencyLevel = 16</code>，也就是说整个 Map 被分成了 16 个小隔间。理论上支持 16 个线程同时并发写入（只要它们 hash 到不同的 Segment）。</li>
</ul>
<h4 data-id="heading-4">2. Put 操作流程</h4>
<ol>
<li>
<p><strong>Hash 计算</strong>：先通过 Hash 算法定位到具体的 <code>Segment</code>。</p>
</li>
<li>
<p><strong>获取锁</strong>：当前线程尝试获取这个 Segment 的锁 (<code>tryLock</code>)。</p>
<ul>
<li>如果获取失败，会使用<strong>自旋机制</strong>（SCANNING），重试一定次数后如果还拿不到，才进入阻塞状态（挂起）。</li>
</ul>
</li>
<li>
<p><strong>写入</strong>：拿到锁后，就像操作一个普通的 HashMap 一样，操作内部的 <code>HashEntry</code> 数组（链表插入）。</p>
</li>
<li>
<p><strong>释放锁</strong>。</p>
</li>
</ol>
<h4 data-id="heading-5">3. Get 操作 (高效的秘诀)</h4>
<ul>
<li>
<p><strong>不加锁</strong></p>
</li>
<li>
<p><strong>原理</strong>：<code>HashEntry</code> 中的 <code>value</code> 属性是被 <code>volatile</code> 修饰的。</p>
<p>Java</p>
<pre><code class="hljs language-arduino" lang="arduino"><span class="hljs-type">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HashEntry</span>&lt;K,V&gt; {
    <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> hash;
    <span class="hljs-keyword">final</span> K key;
    <span class="hljs-keyword">volatile</span> V value; <span class="hljs-comment">// 重点：保证可见性</span>
    <span class="hljs-keyword">volatile</span> HashEntry&lt;K,V&gt; next;
}
</code></pre>
</li>
<li>
<p>由于 volatile 的可见性，写线程修改完，读线程能立刻看到，所以读操作完全无锁，性能极高。</p>
</li>
</ul>
<h4 data-id="heading-6">4. Size 操作 (跨段统计的难题)</h4>
<p>怎么统计总数？数据分散在 16 个桶里，且随时有人在写。</p>
<ul>
<li><strong>机制</strong>：先尝试 <strong>“不加锁”</strong> 统计几次（最多 3 次）。</li>
<li>如果在统计过程中，发现 <code>modCount</code> (修改次数) 没变，说明没人捣乱，直接返回。</li>
<li>如果发现 <code>modCount</code> 变了，说明有人在写，只好<strong>强制锁住所有 Segment</strong> (全局锁)，统计完再解锁。这是一次昂贵的操作。</li>
</ul>
<p>但是这种方法在随着硬件性能提升和 JVM 对 <code>synchronized</code> 的大幅优化，JDK 1.7 的 <code>Segment</code> 显得臃肿了（为了维护 Segment，内存浪费严重）所以就有了 JDK 1.8的优化 也就是现在的 CHM</p>
<h4 data-id="heading-7">第二部分：JDK 1.8 —— CAS + Synchronized + 红黑树</h4>
<p>1.8 的核心思想是： <strong>原子化</strong> 和 <strong>数据结构降维打击</strong> 。它抛弃了 Segment，直接回到了类似 HashMap 的大数组结构，但在细节上做到了极致。</p>
<p>这一设计转变基于一个关键的工程洞察：在大多数实际应用场景中，<strong>Hash 冲突的发生概率极低</strong>。基于此，JDK 1.8 采取了更为激进且高效的加锁策略——<strong>直接锁定 Hash 桶的头节点 (Head Node)</strong> 。这一优化将锁的粒度从原本的段级别（1/16）急剧细化至桶级别（1/N），在保证安全的前提下，最大限度地释放了并发性能。”）</p>
<h4 data-id="heading-8">2. Put 操作流程</h4>
<p>这是面试的重灾区，也是我个人认为CCH设计最为精妙的一点：</p>
<ol>
<li>
<p><strong>判断初始化</strong>：如果 table 为空，调用 <code>initTable()</code> 初始化（利用 CAS 保证只有一个线程初始化成功）。</p>
</li>
<li>
<p><strong>计算 Hash</strong>：定位到数组下标 <code>i</code>。</p>
</li>
<li>
<p><strong>Case 1：桶是空的 (No Collision)</strong></p>
<ul>
<li><strong>CAS 无锁插入</strong>：直接利用 <code>CAS</code> 指令尝试把新节点放入该位置。</li>
<li>如果成功，完事。如果失败（说明瞬间有人抢了），进入下一轮循环。</li>
</ul>
</li>
<li>
<p><strong>Case 2：发现正在扩容 (MOVED)</strong></p>
<ul>
<li>如果发现该位置的节点的 hash 值是 <code>MOVED (-1)</code>，说明当前 Map 正在扩容。</li>
<li><strong>帮忙扩容 (Help Transfer)</strong> ：当前线程不干活了，加入扩容大军，帮忙把数据搬到新数组去（众筹扩容，非常有意思的设计）。</li>
</ul>
</li>
<li>
<p><strong>Case 3：发生哈希冲突 (Collision)</strong></p>
<ul>
<li><strong>Synchronized 锁头节点</strong>：只锁住当前这个桶的第一个节点。</li>
<li>进入锁块后，遍历链表或红黑树进行插入。</li>
</ul>
</li>
<li>
<p><strong>转树</strong>：如果链表长度 &gt; 8 且数组长度 &gt;= 64，将链表转为红黑树。</p>
</li>
</ol>
<h4 data-id="heading-9">3. 为什么 1.8 抛弃 ReentrantLock 改用 Synchronized？</h4>
<ol>
<li><strong>节省内存</strong>：<code>ReentrantLock</code> 需要继承 AQS，每个节点都继承这玩意儿，内存消耗太大。而 <code>synchronized</code> 是 JVM 原生的，锁信息存在对象头（Mark Word）里，几乎零额外开销。</li>
<li><strong>JVM 优化</strong>：JDK 6 以后，JVM 团队对 <code>synchronized</code> 做了惊人的优化（偏向锁、轻量级锁、锁消除、锁粗化）。在低竞争下，它的性能已经优于 ReentrantLock。</li>
</ol>
<h4 data-id="heading-10">4. Size 操作 (LongAdder 思想)</h4>
<p>1.8 甚至优化了计数器。它不再纠结于统计所有桶，而是引入了类似 <code>LongAdder</code> 的机制：</p>
<ul>
<li><strong>baseCount</strong>：基础计数器。</li>
<li><strong>CounterCell 数组</strong>：如果并发太高，CAS 修改 <code>baseCount</code> 失败，就随机找一个 <code>CounterCell</code> 去加。</li>
<li><strong>最终结果</strong> = <code>baseCount</code> + <code>sum(CounterCell[])</code>。</li>
<li>这使得 <code>size()</code> 在高并发下性能飞升。</li>
<li/>
</ul>
<p>JDK 1.7 的 ConcurrentHashMap 像是<strong>包工头制度</strong>（Segment），每个包工头管一片地，虽然比全厂只有一个管理员（Hashtable）强，但管理成本还是高。 而 JDK 1.8 则是<strong>自动化 + 扁平化管理</strong>。平时大家用 CAS（无锁）快速通过，真遇到冲突了，只锁当前那一个工位（Synchronized），而且引入了红黑树解决长队问题，引入了 LongAdder 解决统计问题，是目前的性能天花板。</p>
<p>正因其卓越的并发性能，它成为了众多主流框架底层架构的<strong>基石</strong>。 例如，我们大家都再在用的Spring 框架的核心组件——<strong>Bean 容器</strong>，其底层正是利用 ConcurrentHashMap 来管理单例对象（Singleton Objects），从而在极高的并发访问下保障了容器的线程安全。</p>
<h4 data-id="heading-11">结尾</h4>
<p>总而言之，Java 容器的演进历程，本质上就是一部锁粒度不断细化的变革史。</p>
<p>这一过程始终贯穿着一条主线：<strong>在‘并发安全’的底线之上，向‘单线程效率’发起无限逼近的挑战。</strong> 这不仅是技术指标的提升，更凝聚了开发者在取舍之间的工程智慧。</p>
<p>深入理解这段历史，不仅能让我们掌握底层原理，更能潜移默化地提升我们的<strong>并发设计意识</strong></p></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item><item>    <title><![CDATA[十大排序]]></title>    <link>https://juejin.cn/post/7598947628467912750</link>    <guid>https://juejin.cn/post/7598947628467912750</guid>    <pubDate>2026-01-25T13:42:33.000Z</pubDate>    <description><![CDATA[<article itemscope="itemscope" itemtype="http://schema.org/Article" data-entry-id="7598947628467912750" data-draft-id="7598921649888542747" data-original-type="0" class="article" data-v-61fb5e44=""><!----> <meta itemprop="headline" content="十大排序"/> <meta itemprop="keywords" content="前端,面试"/> <meta itemprop="datePublished" content="2026-01-25T13:42:33.000Z"/> <meta itemprop="image" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-128.png~tplv-t2oaga2asx-image.image"/> <div itemprop="author" itemscope="itemscope" itemtype="http://schema.org/Person"><meta itemprop="name" content="lulaaaa"/> <meta itemprop="url" content="https://juejin.cn/user/3804728203425918"/></div> <div itemprop="publisher" itemscope="itemscope" itemtype="http://schema.org/Organization"><meta itemprop="name" content="掘金"/> <div itemprop="logo" itemscope="itemscope" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-assets/icon/icon-white-180.png~tplv-t2oaga2asx-image.image"/> <meta itemprop="width" content="180"/> <meta itemprop="height" content="180"/></div></div> <h1 class="article-title" data-v-61fb5e44="">
            十大排序
            <!----> <!----></h1> <div class="author-info-block block-hidden" data-v-61fb5e44=""><div class="author-info-box" data-v-61fb5e44=""><div class="author-name" data-v-61fb5e44=""><a href="/user/3804728203425918/posts" target="_blank" rel="" class="jj-link username username ellipsis" data-v-65b50b51="" data-v-292f6e48="" data-v-61fb5e44=""><span class="name" style="max-width:160px;" data-v-65b50b51="" data-v-292f6e48="">
    lulaaaa
  </span> <!----> <!----> <!----> </a></div> <div class="meta-box" data-v-61fb5e44=""><time datetime="2026-01-25T13:42:33.000Z" title="Sun Jan 25 2026 13:42:33 GMT+0000 (Coordinated Universal Time)" class="time" data-v-61fb5e44="">
                    2026-01-25
                  </time> <svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="read-icon" data-v-61fb5e44=""><path d="M7.90078 2.80078C4.49278 2.80078 1.74745 6.11672 0.800781 7.77469C1.74745 9.58339 4.49278 13.2008 7.90078 13.2008C11.3088 13.2008 14.0541 9.58339 15.0008 7.77469C14.0541 6.11672 11.3088 2.80078 7.90078 2.80078Z" stroke="currentColor" data-v-61fb5e44=""/><circle cx="7.89922" cy="8.00078" r="2.2" stroke="currentColor" data-v-61fb5e44=""/></svg> <span class="views-count" data-v-61fb5e44="">
                    4
                  </span> <span class="read-time" data-v-61fb5e44=""><svg width="16" height="16" viewbox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" data-v-61fb5e44=""><rect width="16" height="16" fill="none" data-v-61fb5e44=""/><circle cx="8" cy="8" r="5.65625" stroke="#8A919F" data-v-61fb5e44=""/><path d="M7.69141 5.18652V8.30924H10.8141" stroke="#8A919F" stroke-linecap="round" stroke-linejoin="round" data-v-61fb5e44=""/></svg>
                    阅读17分钟
                  </span> <!----></div></div> <div style="flex:1;" data-v-61fb5e44=""/> <!----> <!----></div> <!----> <!----> <!----> <!----> <div id="article-root" itemprop="articleBody" class="main" data-v-61fb5e44=""><div class="article-viewer markdown-body result"><style>.markdown-body{word-break:break-word;line-height:1.75;font-weight:400;font-size:16px;overflow-x:hidden;color:#252933}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{line-height:1.5;margin-top:35px;margin-bottom:10px;padding-bottom:5px}.markdown-body h1{font-size:24px;line-height:38px;margin-bottom:5px}.markdown-body h2{font-size:22px;line-height:34px;padding-bottom:12px;border-bottom:1px solid #ececec}.markdown-body h3{font-size:20px;line-height:28px}.markdown-body h4{font-size:18px;line-height:26px}.markdown-body h5{font-size:17px;line-height:24px}.markdown-body h6{font-size:16px;line-height:24px}.markdown-body p{line-height:inherit;margin-top:22px;margin-bottom:22px}.markdown-body img{max-width:100%}.markdown-body hr{border:none;border-top:1px solid #ddd;margin-top:32px;margin-bottom:32px}.markdown-body code{word-break:break-word;border-radius:2px;overflow-x:auto;background-color:#fff5f5;color:#ff502c;font-size:.87em;padding:.065em .4em}.markdown-body code,.markdown-body pre{font-family:Menlo,Monaco,Consolas,Courier New,monospace}.markdown-body pre{overflow:auto;position:relative;line-height:1.75}.markdown-body pre&gt;code{font-size:12px;padding:15px 12px;margin:0;word-break:normal;display:block;overflow-x:auto;color:#333;background:#f8f8f8}.markdown-body a{text-decoration:none;color:#0269c8;border-bottom:1px solid #d1e9ff}.markdown-body a:active,.markdown-body a:hover{color:#275b8c}.markdown-body table{display:inline-block!important;font-size:12px;width:auto;max-width:100%;overflow:auto;border:1px solid #f6f6f6}.markdown-body thead{background:#f6f6f6;color:#000;text-align:left}.markdown-body tr:nth-child(2n){background-color:#fcfcfc}.markdown-body td,.markdown-body th{padding:12px 7px;line-height:24px}.markdown-body td{min-width:120px}.markdown-body blockquote{color:#666;padding:1px 23px;margin:22px 0;border-left:4px solid #cbcbcb;background-color:#f8f8f8}.markdown-body blockquote:after{display:block;content:""}.markdown-body blockquote&gt;p{margin:10px 0}.markdown-body ol,.markdown-body ul{padding-left:28px}.markdown-body ol li,.markdown-body ul li{margin-bottom:0;list-style:inherit}.markdown-body ol li .task-list-item,.markdown-body ul li .task-list-item{list-style:none}.markdown-body ol li .task-list-item ol,.markdown-body ol li .task-list-item ul,.markdown-body ul li .task-list-item ol,.markdown-body ul li .task-list-item ul{margin-top:0}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:3px}.markdown-body ol li{padding-left:6px}.markdown-body .contains-task-list{padding-left:0}.markdown-body .task-list-item{list-style:none}@media (max-width:720px){.markdown-body h1{font-size:24px}.markdown-body h2{font-size:20px}.markdown-body h3{font-size:18px}}</style><style data-highlight="" data-highlight-key="juejin">.markdown-body pre,.markdown-body pre&gt;code.hljs{color:#333;background:#f8f8f8}.hljs-comment,.hljs-quote{color:#998;font-style:italic}.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#333;font-weight:700}.hljs-literal,.hljs-number,.hljs-tag .hljs-attr,.hljs-template-variable,.hljs-variable{color:teal}.hljs-doctag,.hljs-string{color:#d14}.hljs-section,.hljs-selector-id,.hljs-title{color:#900;font-weight:700}.hljs-subst{font-weight:400}.hljs-class .hljs-title,.hljs-type{color:#458;font-weight:700}.hljs-attribute,.hljs-name,.hljs-tag{color:navy;font-weight:400}.hljs-link,.hljs-regexp{color:#009926}.hljs-bullet,.hljs-symbol{color:#990073}.hljs-built_in,.hljs-builtin-name{color:#0086b3}.hljs-meta{color:#999;font-weight:700}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}</style><h2 data-id="heading-0">十大排序算法</h2>
<h3 data-id="heading-1">前言</h3>
<p>排序算法是编程的基础核心知识点，根据是否依赖「元素比较」可分为两类：</p>
<ul>
<li><strong>比较类排序</strong>：通过比较元素大小确定顺序，时间复杂度最低为 O(nlogn)，包含冒泡、选择、插入、希尔、归并、快速、堆排序；</li>
<li><strong>非比较类排序</strong>：利用数值特征（如位数、范围）排序，时间复杂度可达 O(n)，包含计数、桶、基数排序。</li>
</ul>
<p><strong>核心概念铺垫</strong>：</p>
<ul>
<li><strong>排序稳定性</strong>：若排序后，两个相等值的元素相对位置与排序前一致，则为「稳定排序」；否则为「不稳定排序」（如 <code>[2,2,1]</code> 排序后，第一个 2 仍在第二个 2 前则稳定）。</li>
<li><strong>时间复杂度</strong>：算法执行时间随数据规模增长的趋势；</li>
<li><strong>空间复杂度</strong>：算法占用额外空间随数据规模增长的趋势。</li>
</ul>
<hr/>
<h3 data-id="heading-2">1. 冒泡排序（Bubble Sort）</h3>
<h4 data-id="heading-3">核心思想</h4>
<p>像水中的气泡上浮：每次遍历数组，相邻元素两两比较，把<strong>最大的元素逐步 “浮” 到数组末尾</strong>，小元素留在前面。可优化：某轮遍历无交换时，说明数组已有序，提前终止。</p>
<h4 data-id="heading-4">算法步骤</h4>
<ol>
<li>遍历数组，相邻元素两两比较，若前 &gt; 后则交换；</li>
<li>每轮遍历结束，当前未排序部分的最大值 “归位” 到末尾；</li>
<li>重复上述步骤，直到数组有序（或提前终止）。</li>
</ol>
<h4 data-id="heading-5">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>






























<table><thead><tr><th>遍历轮次</th><th>数组变化</th><th>归位元素</th></tr></thead><tbody><tr><td>轮 1</td><td>[3,5,8,4,2] → [3,5,4,8,2] → [3,5,4,2,8]</td><td>8</td></tr><tr><td>轮 2</td><td>[3,4,5,2,8] → [3,4,2,5,8]</td><td>5</td></tr><tr><td>轮 3</td><td>[3,2,4,5,8]</td><td>4</td></tr><tr><td>轮 4</td><td>[2,3,4,5,8]</td><td>3</td></tr></tbody></table>
<h4 data-id="heading-6">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BubbleSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bubbleSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">boolean</span> swapped; <span class="hljs-comment">// 标记是否发生交换</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) {
            swapped = <span class="hljs-literal">false</span>;
            <span class="hljs-comment">// 每轮减少i次遍历（末尾i个元素已归位）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; n - <span class="hljs-number">1</span> - i; j++) {
                <span class="hljs-keyword">if</span> (arr[j] &gt; arr[j + <span class="hljs-number">1</span>]) {
                    <span class="hljs-comment">// 交换相邻元素</span>
                    <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[j];
                    arr[j] = arr[j + <span class="hljs-number">1</span>];
                    arr[j + <span class="hljs-number">1</span>] = temp;
                    swapped = <span class="hljs-literal">true</span>;
                }
            }
            <span class="hljs-comment">// 无交换则提前终止</span>
            <span class="hljs-keyword">if</span> (!swapped) <span class="hljs-keyword">break</span>;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        bubbleSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-7">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n)（已有序）、最坏 / 平均 O(n2)；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：稳定（相等元素不交换）。</li>
</ul>
<hr/>
<h3 data-id="heading-8">2. 选择排序（Selection Sort）</h3>
<h4 data-id="heading-9">核心思想</h4>
<p>像选 “标兵”：每次从<strong>未排序部分选出最小值</strong>，放到已排序部分的末尾，逐步扩大有序区域。</p>
<h4 data-id="heading-10">算法步骤</h4>
<ol>
<li>划分「已排序区」（初始为空）和「未排序区」（整个数组）；</li>
<li>遍历未排序区，找到最小值的索引；</li>
<li>交换最小值与未排序区的第一个元素，扩大已排序区；</li>
<li>重复直到未排序区为空。</li>
</ol>
<h4 data-id="heading-11">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>



































<table><thead><tr><th>遍历轮次</th><th>未排序区</th><th>最小值（索引）</th><th>数组变化</th></tr></thead><tbody><tr><td>轮 1</td><td>[5,3,8,4,2]</td><td>2（4）</td><td>[2,3,8,4,5]</td></tr><tr><td>轮 2</td><td>[3,8,4,5]</td><td>3（1）</td><td>[2,3,8,4,5]</td></tr><tr><td>轮 3</td><td>[8,4,5]</td><td>4（3）</td><td>[2,3,4,8,5]</td></tr><tr><td>轮 4</td><td>[8,5]</td><td>5（4）</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-12">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectionSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectionSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; n - <span class="hljs-number">1</span>; i++) {
            <span class="hljs-comment">// 找未排序区（i到n-1）的最小值索引</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">minIndex</span> <span class="hljs-operator">=</span> i;
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; n; j++) {
                <span class="hljs-keyword">if</span> (arr[j] &lt; arr[minIndex]) {
                    minIndex = j;
                }
            }
            <span class="hljs-comment">// 交换最小值和未排序区第一个元素</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
            arr[i] = arr[minIndex];
            arr[minIndex] = temp;
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        selectionSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-13">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(n2)（无论是否有序，都要遍历找最小值）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（如 <code>[2,2,1]</code>，选 1 交换第一个 2，两个 2 的相对位置改变）。</li>
</ul>
<hr/>
<h3 data-id="heading-14">3. 插入排序（Insertion Sort）</h3>
<h4 data-id="heading-15">核心思想</h4>
<p>像打扑克牌插牌：把当前元素插入到<strong>前面已排序数组的合适位置</strong>，前面始终保持有序。</p>
<h4 data-id="heading-16">算法步骤</h4>
<ol>
<li>划分「已排序区」（初始为第一个元素）和「未排序区」（剩余元素）；</li>
<li>取未排序区的第一个元素，向前遍历已排序区，找到比它小的元素位置；</li>
<li>将该位置后的元素后移，插入当前元素；</li>
<li>重复直到未排序区为空。</li>
</ol>
<h4 data-id="heading-17">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>



































<table><thead><tr><th>遍历轮次</th><th>已排序区</th><th>待插入元素</th><th>数组变化</th></tr></thead><tbody><tr><td>轮 1</td><td>[5]</td><td>3</td><td>[3,5,8,4,2]</td></tr><tr><td>轮 2</td><td>[3,5]</td><td>8</td><td>[3,5,8,4,2]</td></tr><tr><td>轮 3</td><td>[3,5,8]</td><td>4</td><td>[3,5,4,8,2] → [3,4,5,8,2]</td></tr><tr><td>轮 4</td><td>[3,4,5,8]</td><td>2</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-18">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">InsertionSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertionSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; n; i++) {
            <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> arr[i]; <span class="hljs-comment">// 待插入元素</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - <span class="hljs-number">1</span>;
            <span class="hljs-comment">// 向前遍历已排序区，找到插入位置</span>
            <span class="hljs-keyword">while</span> (j &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[j] &gt; current) {
                arr[j + <span class="hljs-number">1</span>] = arr[j]; <span class="hljs-comment">// 元素后移</span>
                j--;
            }
            arr[j + <span class="hljs-number">1</span>] = current; <span class="hljs-comment">// 插入元素</span>
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        insertionSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-19">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n)（已有序）、最坏 / 平均 O(n2)；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：稳定（相等元素不后移）。</li>
</ul>
<hr/>
<h3 data-id="heading-20">4. 希尔排序（Shell Sort）</h3>
<h4 data-id="heading-21">核心思想</h4>
<p>插入排序的 “升级版”：先按「步长」将数组分组，每组内做插入排序（粗排）；逐步缩小步长到 1，最终做一次整体插入排序（精排）。像先把数组 “梳顺”，再精细排序，减少插入排序的元素移动次数。</p>
<h4 data-id="heading-22">算法步骤</h4>
<ol>
<li>选择初始步长（通常为 n/2，每次减半）；</li>
<li>按步长将数组分成若干子数组（索引 i,i+step,i+2step...）；</li>
<li>对每个子数组执行插入排序；</li>
<li>步长减半，重复步骤 2-3；直到步长 = 1，做最后一次插入排序。</li>
</ol>
<h4 data-id="heading-23">案例演示（数组 <code>[5,3,8,4,2]</code>，n=5）</h4>




















<table><thead><tr><th>步长</th><th>分组情况</th><th>分组排序后数组</th></tr></thead><tbody><tr><td>2</td><td>[5,8,2]、[3,4]</td><td>[2,3,8,4,5]</td></tr><tr><td>1</td><td>整体数组</td><td>[2,3,4,5,8]</td></tr></tbody></table>
<h4 data-id="heading-24">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ShellSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shellSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-comment">// 步长逐步减半</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">step</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span>; step &gt; <span class="hljs-number">0</span>; step /= <span class="hljs-number">2</span>) {
            <span class="hljs-comment">// 按步长分组，每组插入排序</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> step; i &lt; n; i++) {
                <span class="hljs-type">int</span> <span class="hljs-variable">current</span> <span class="hljs-operator">=</span> arr[i];
                <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - step;
                <span class="hljs-keyword">while</span> (j &gt;= <span class="hljs-number">0</span> &amp;&amp; arr[j] &gt; current) {
                    arr[j + step] = arr[j];
                    j -= step;
                }
                arr[j + step] = current;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        shellSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-25">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(nlogn)、最坏 O(n2)、平均 O(n1.3)（步长影响）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（分组排序会打乱相等元素的相对位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-26">5. 归并排序（Merge Sort）</h3>
<h4 data-id="heading-27">核心思想</h4>
<p>分治思想的典型应用：“分而治之”，先把数组拆成最小单元（单个元素，天然有序），再<strong>两两合并成有序子数组</strong>，最终合并成整体有序数组。像拼拼图，先拆成碎片，再按规则拼合。</p>
<h4 data-id="heading-28">算法步骤</h4>
<ol>
<li><strong>分</strong>：递归将数组分成左右两半，直到每个子数组只有 1 个元素；</li>
<li><strong>治</strong>：合并两个有序子数组为一个有序数组；</li>
<li>递归合并，直到整个数组合并完成。</li>
</ol>
<h4 data-id="heading-29">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">分：<span class="hljs-selector-attr">[5,3,8,4,2]</span> → <span class="hljs-selector-attr">[5,3]</span> + <span class="hljs-selector-attr">[8,4,2]</span> → <span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span> + <span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[4,2]</span> → <span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span> + <span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[4]</span>+<span class="hljs-selector-attr">[2]</span>
合：<span class="hljs-selector-attr">[5]</span>+<span class="hljs-selector-attr">[3]</span>→<span class="hljs-selector-attr">[3,5]</span>；<span class="hljs-selector-attr">[4]</span>+<span class="hljs-selector-attr">[2]</span>→<span class="hljs-selector-attr">[2,4]</span>；<span class="hljs-selector-attr">[8]</span>+<span class="hljs-selector-attr">[2,4]</span>→<span class="hljs-selector-attr">[2,4,8]</span>；<span class="hljs-selector-attr">[3,5]</span>+<span class="hljs-selector-attr">[2,4,8]</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>
</code></pre>
<h4 data-id="heading-30">代码实现（Java，递归版）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MergeSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">int</span>[] temp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n]; <span class="hljs-comment">// 临时数组，避免频繁创建</span>
        mergeSort(arr, <span class="hljs-number">0</span>, n - <span class="hljs-number">1</span>, temp);
    }

    <span class="hljs-comment">// 递归拆分</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">mergeSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> {
        <span class="hljs-keyword">if</span> (left &gt;= right) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> left + (right - left) / <span class="hljs-number">2</span>; <span class="hljs-comment">// 避免溢出</span>
        mergeSort(arr, left, mid, temp); <span class="hljs-comment">// 左半区排序</span>
        mergeSort(arr, mid + <span class="hljs-number">1</span>, right, temp); <span class="hljs-comment">// 右半区排序</span>
        merge(arr, left, mid, right, temp); <span class="hljs-comment">// 合并左右区</span>
    }

    <span class="hljs-comment">// 合并两个有序子数组</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">merge</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> mid, <span class="hljs-type">int</span> right, <span class="hljs-type">int</span>[] temp)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">// 左区指针</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> mid + <span class="hljs-number">1</span>; <span class="hljs-comment">// 右区指针</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">k</span> <span class="hljs-operator">=</span> left; <span class="hljs-comment">// 临时数组指针</span>
        <span class="hljs-comment">// 合并两个有序数组</span>
        <span class="hljs-keyword">while</span> (i &lt;= mid &amp;&amp; j &lt;= right) {
            <span class="hljs-keyword">if</span> (arr[i] &lt;= arr[j]) {
                temp[k++] = arr[i++];
            } <span class="hljs-keyword">else</span> {
                temp[k++] = arr[j++];
            }
        }
        <span class="hljs-comment">// 拷贝左区剩余元素</span>
        <span class="hljs-keyword">while</span> (i &lt;= mid) {
            temp[k++] = arr[i++];
        }
        <span class="hljs-comment">// 拷贝右区剩余元素</span>
        <span class="hljs-keyword">while</span> (j &lt;= right) {
            temp[k++] = arr[j++];
        }
        <span class="hljs-comment">// 临时数组拷贝回原数组</span>
        System.arraycopy(temp, left, arr, left, right - left + <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        mergeSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-31">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(nlogn)（拆分 O(logn) 层，每层合并 O(n)）；</li>
<li>空间复杂度：O(n)（需要临时数组存储合并结果）；</li>
<li>稳定性：稳定（合并时相等元素优先取左区，保持相对位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-32">6. 快速排序（Quick Sort）</h3>
<h4 data-id="heading-33">核心思想</h4>
<p>分治 + 分区：选一个「基准值」，把数组分成 “小于基准、等于基准、大于基准” 三部分；递归处理左右两部分。像选裁判，把数组分成 “左队（小）、裁判（基准）、右队（大）”，再细分左右队。</p>
<h4 data-id="heading-34">算法步骤</h4>
<ol>
<li>选基准值（推荐：随机选，避免有序数组退化）；</li>
<li>分区：遍历数组，小于基准的放左，大于的放右，基准放中间；</li>
<li>递归对左、右分区重复步骤 1-2；</li>
<li>递归结束则数组有序。</li>
</ol>
<h4 data-id="heading-35">案例演示（数组 <code>[5,3,8,4,2]</code>，选 5 为基准）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">分区：小于<span class="hljs-number">5</span>→<span class="hljs-selector-attr">[3,4,2]</span>，基准→<span class="hljs-number">5</span>，大于<span class="hljs-number">5</span>→<span class="hljs-selector-attr">[8]</span> → <span class="hljs-selector-attr">[3,4,2,5,8]</span>
左分区<span class="hljs-selector-attr">[3,4,2]</span>选<span class="hljs-number">3</span>为基准：小于<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[2]</span>，基准→<span class="hljs-number">3</span>，大于<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[4]</span> → <span class="hljs-selector-attr">[2,3,4,5,8]</span>
右分区<span class="hljs-selector-attr">[8]</span>有序，最终结果：<span class="hljs-selector-attr">[2,3,4,5,8]</span>
</code></pre>
<h4 data-id="heading-36">代码实现（Java，随机基准优化）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuickSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        quickSort(arr, <span class="hljs-number">0</span>, arr.length - <span class="hljs-number">1</span>);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">quickSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
        <span class="hljs-keyword">if</span> (left &gt;= right) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">pivotIndex</span> <span class="hljs-operator">=</span> partition(arr, left, right); <span class="hljs-comment">// 分区，返回基准位置</span>
        quickSort(arr, left, pivotIndex - <span class="hljs-number">1</span>); <span class="hljs-comment">// 左分区</span>
        quickSort(arr, pivotIndex + <span class="hljs-number">1</span>, right); <span class="hljs-comment">// 右分区</span>
    }

    <span class="hljs-comment">// 分区函数（Hoare法）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> {
        <span class="hljs-comment">// 随机选基准，避免有序数组退化</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">randomIndex</span> <span class="hljs-operator">=</span> left + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Random</span>().nextInt(right - left + <span class="hljs-number">1</span>);
        swap(arr, left, randomIndex); <span class="hljs-comment">// 基准移到左边界</span>

        <span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> arr[left]; <span class="hljs-comment">// 基准值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> left, j = right;
        <span class="hljs-keyword">while</span> (i &lt; j) {
            <span class="hljs-comment">// 从右找小于基准的元素</span>
            <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[j] &gt;= pivot) j--;
            <span class="hljs-comment">// 从左找大于基准的元素</span>
            <span class="hljs-keyword">while</span> (i &lt; j &amp;&amp; arr[i] &lt;= pivot) i++;
            <span class="hljs-comment">// 交换左右指针元素</span>
            <span class="hljs-keyword">if</span> (i &lt; j) swap(arr, i, j);
        }
        <span class="hljs-comment">// 基准归位（i=j的位置）</span>
        swap(arr, left, i);
        <span class="hljs-keyword">return</span> i;
    }

    <span class="hljs-comment">// 交换元素</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        quickSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-37">算法分析</h4>
<ul>
<li>时间复杂度：最好 / 平均 O(nlogn)、最坏 O(n2)（有序数组未优化）；</li>
<li>空间复杂度：O(logn)（递归栈，随机基准可优化到 O(logn)）；</li>
<li>稳定性：不稳定（分区交换会打乱相等元素位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-38">7. 堆排序（Heap Sort）</h3>
<h4 data-id="heading-39">核心思想</h4>
<p>利用「堆」（完全二叉树）的特性：构建<strong>大顶堆</strong>（父节点 &gt; 子节点），每次取堆顶（最大值）放到数组末尾，再调整堆，重复直到堆为空。像从堆里每次挑最大的元素 “拿出来”，最终有序。</p>
<h4 data-id="heading-40">算法步骤</h4>
<ol>
<li>构建大顶堆（从最后一个非叶子节点开始向上调整）；</li>
<li>交换堆顶（最大值）和堆的最后一个元素，堆大小减 1；</li>
<li>调整剩余元素为大顶堆；</li>
<li>重复步骤 2-3，直到堆大小为 1。</li>
</ol>
<h4 data-id="heading-41">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<p>plaintext</p>
<pre><code class="hljs language-css" lang="css">构建大顶堆：<span class="hljs-selector-attr">[8,4,5,3,2]</span>
轮<span class="hljs-number">1</span>：交换<span class="hljs-number">8</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,4,5,3,8]</span>，调整堆→<span class="hljs-selector-attr">[5,4,2,3,8]</span>
轮<span class="hljs-number">2</span>：交换<span class="hljs-number">5</span>和<span class="hljs-number">3</span>→<span class="hljs-selector-attr">[3,4,2,5,8]</span>，调整堆→<span class="hljs-selector-attr">[4,3,2,5,8]</span>
轮<span class="hljs-number">3</span>：交换<span class="hljs-number">4</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>，调整堆→<span class="hljs-selector-attr">[3,2,4,5,8]</span>
轮<span class="hljs-number">4</span>：交换<span class="hljs-number">3</span>和<span class="hljs-number">2</span>→<span class="hljs-selector-attr">[2,3,4,5,8]</span>，结束
</code></pre>
<h4 data-id="heading-42">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">HeapSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 构建大顶堆（从最后一个非叶子节点开始）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            heapify(arr, n, i);
        }

        <span class="hljs-comment">// 逐个取出堆顶元素</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) {
            <span class="hljs-comment">// 交换堆顶和当前堆最后一个元素</span>
            swap(arr, <span class="hljs-number">0</span>, i);
            <span class="hljs-comment">// 调整剩余元素为大顶堆</span>
            heapify(arr, i, <span class="hljs-number">0</span>);
        }
    }

    <span class="hljs-comment">// 调整堆（以i为根的子树）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapify</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> heapSize, <span class="hljs-type">int</span> i)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">largest</span> <span class="hljs-operator">=</span> i; <span class="hljs-comment">// 初始化最大值为根</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>; <span class="hljs-comment">// 左子节点</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">2</span>; <span class="hljs-comment">// 右子节点</span>

        <span class="hljs-comment">// 左子节点更大</span>
        <span class="hljs-keyword">if</span> (left &lt; heapSize &amp;&amp; arr[left] &gt; arr[largest]) {
            largest = left;
        }
        <span class="hljs-comment">// 右子节点更大</span>
        <span class="hljs-keyword">if</span> (right &lt; heapSize &amp;&amp; arr[right] &gt; arr[largest]) {
            largest = right;
        }

        <span class="hljs-comment">// 最大值不是根，交换并递归调整</span>
        <span class="hljs-keyword">if</span> (largest != i) {
            swap(arr, i, largest);
            heapify(arr, heapSize, largest);
        }
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];
        arr[i] = arr[j];
        arr[j] = temp;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        heapSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-43">算法分析</h4>
<ul>
<li>时间复杂度：所有情况 O(nlogn)（建堆 O(n)，每次调整 O(logn)）；</li>
<li>空间复杂度：O(1)（原地排序）；</li>
<li>稳定性：不稳定（堆调整会打乱相等元素位置）。</li>
</ul>
<hr/>
<h3 data-id="heading-44">8. 计数排序（Counting Sort）</h3>
<h4 data-id="heading-45">核心思想</h4>
<p>非比较排序：统计每个数值出现的次数，再根据次数 “还原” 有序数组。像数人数：按身高统计每个身高的人数，再按身高顺序输出。</p>
<h4 data-id="heading-46">算法步骤</h4>
<ol>
<li>找到数组的最大值 <code>max</code> 和最小值 <code>min</code>；</li>
<li>创建计数数组 <code>count</code>，长度为 <code>max - min + 1</code>，初始化为 0；</li>
<li>遍历原数组，<code>count[num - min]++</code>（统计每个数的出现次数）；</li>
<li>遍历计数数组，按次数将数值填充回原数组。</li>
</ol>
<h4 data-id="heading-47">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<ul>
<li>min=2，max=8，count 数组长度 = 7（索引 0→2，1→3，2→4，3→5，4→6，5→7，6→8）；</li>
<li>统计后：<code>count = [1,1,1,1,0,0,1]</code>；</li>
<li>填充：2 (1 次)→3 (1)→4 (1)→5 (1)→8 (1) → [2,3,4,5,8]。</li>
</ul>
<h4 data-id="heading-48">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountingSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countingSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 找最大值和最小值</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>], max = arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &lt; min) min = num;
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 计数数组</span>
        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[max - min + <span class="hljs-number">1</span>];
        <span class="hljs-comment">// 统计次数</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            count[num - min]++;
        }

        <span class="hljs-comment">// 填充回原数组</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; count.length; i++) {
            <span class="hljs-keyword">while</span> (count[i] &gt; <span class="hljs-number">0</span>) {
                arr[index++] = i + min;
                count[i]--;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        countingSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-49">算法分析</h4>
<ul>
<li>时间复杂度：O(n+k)（k=max−min，数值范围）；</li>
<li>空间复杂度：O(n+k)（计数数组 + 原数组）；</li>
<li>稳定性：稳定（按顺序填充，保持相等元素的相对位置）。</li>
<li>适用场景：数值范围小的整数排序（如成绩、年龄）。</li>
</ul>
<hr/>
<h3 data-id="heading-50">9. 桶排序（Bucket Sort）</h3>
<h4 data-id="heading-51">核心思想</h4>
<p>非比较排序：把数组按数值范围分到多个「桶」里，每个桶内用其他排序（如插入排序），最后合并所有桶。像分桶整理：先按范围粗分，再精细排序，最后合并。</p>
<h4 data-id="heading-52">算法步骤</h4>
<ol>
<li>确定桶的数量和范围（通常按数值分布划分，如 <code>桶数=数组长度</code>）；</li>
<li>遍历数组，将元素放入对应桶中；</li>
<li>对每个非空桶内的元素排序（推荐插入排序，小规模数据高效）；</li>
<li>按桶的顺序合并所有元素，得到有序数组。</li>
</ol>
<h4 data-id="heading-53">案例演示（数组 <code>[5,3,8,4,2]</code>）</h4>
<ul>
<li>桶数 = 3，范围划分：[0-3)、[3-6)、[6-9)；</li>
<li>分桶：桶 1→[2,3]，桶 2→[5,4]，桶 3→[8]；</li>
<li>桶内排序：桶 1→[2,3]，桶 2→[4,5]，桶 3→[8]；</li>
<li>合并：[2,3,4,5,8]。</li>
</ul>
<h4 data-id="heading-54">代码实现（Java）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BucketSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bucketSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;

        <span class="hljs-comment">// 1. 找最大值和最小值，确定桶范围</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">min</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>], max = arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &lt; min) min = num;
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 2. 创建桶（桶数=数组长度，均匀划分）</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">bucketNum</span> <span class="hljs-operator">=</span> n;
        List&lt;List&lt;Integer&gt;&gt; buckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;(bucketNum);
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bucketNum; i++) {
            buckets.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;());
        }

        <span class="hljs-comment">// 3. 元素入桶</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-comment">// 计算元素所属桶的索引</span>
            <span class="hljs-type">int</span> <span class="hljs-variable">bucketIndex</span> <span class="hljs-operator">=</span> (num - min) * (bucketNum - <span class="hljs-number">1</span>) / (max - min);
            buckets.get(bucketIndex).add(num);
        }

        <span class="hljs-comment">// 4. 桶内排序 + 合并</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (List&lt;Integer&gt; bucket : buckets) {
            Collections.sort(bucket); <span class="hljs-comment">// 桶内用插入排序（Collections.sort底层是TimSort）</span>
            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : bucket) {
                arr[index++] = num;
            }
        }
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">5</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>, <span class="hljs-number">4</span>, <span class="hljs-number">2</span>};
        bucketSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [2, 3, 4, 5, 8]</span>
    }
}
</code></pre>
<h4 data-id="heading-55">算法分析</h4>
<ul>
<li>时间复杂度：最好 O(n+k)（分布均匀）、最坏 O(n2)（所有元素入一个桶）、平均 O(n+k)；</li>
<li>空间复杂度：O(n+k)（桶的数量）；</li>
<li>稳定性：稳定（取决于桶内排序算法，如插入排序稳定）；</li>
<li>适用场景：数值分布均匀的场景（如成绩、薪资）。</li>
</ul>
<hr/>
<h3 data-id="heading-56">10. 基数排序（Radix Sort）</h3>
<h4 data-id="heading-57">核心思想</h4>
<p>非比较排序：按数字的「位」（个位、十位、百位…）依次排序，从低位到高位（LSD）或高位到低位（MSD）。像按位数分级排序：先排个位，再排十位，最终整体有序。</p>
<h4 data-id="heading-58">算法步骤（LSD，低位优先）</h4>
<ol>
<li>找到数组的最大位数（如 <code>748</code> 是 3 位）；</li>
<li>从个位开始，按当前位的数值将元素分到 0-9 的桶中；</li>
<li>按桶的顺序（0→9）合并元素；</li>
<li>位数升级（十位、百位…），重复步骤 2-3；直到最高位。</li>
</ol>
<h4 data-id="heading-59">案例演示（数组 <code>[53, 3, 542, 748, 14, 214]</code>）</h4>
<ul>
<li>补零对齐：<code>003, 014, 053, 214, 542, 748</code>；</li>
<li>个位排序：按个位分桶→合并 <code>[542, 053, 003, 014, 214, 748]</code>；</li>
<li>十位排序：按十位分桶→合并 <code>[003, 014, 214, 542, 053, 748]</code>；</li>
<li>百位排序：按百位分桶→合并 <code>[003, 014, 053, 214, 542, 748]</code> → <code>[3,14,53,214,542,748]</code>。</li>
</ul>
<h4 data-id="heading-60">代码实现（Java，LSD）</h4>
<pre><code class="hljs language-java" lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RadixSort</span> {
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">radixSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> {
        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// 1. 找最大值，确定最大位数</span>
        <span class="hljs-type">int</span> <span class="hljs-variable">max</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-keyword">if</span> (num &gt; max) max = num;
        }

        <span class="hljs-comment">// 2. 按位排序（个位、十位、百位...）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; max / exp &gt; <span class="hljs-number">0</span>; exp *= <span class="hljs-number">10</span>) {
            countSortByDigit(arr, exp);
        }
    }

    <span class="hljs-comment">// 按指定位数排序（exp=1→个位，exp=10→十位...）</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countSortByDigit</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> exp)</span> {
        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;
        <span class="hljs-type">int</span>[] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[n]; <span class="hljs-comment">// 输出数组</span>
        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">10</span>]; <span class="hljs-comment">// 0-9的桶</span>

        <span class="hljs-comment">// 统计当前位的次数</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) {
            <span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> (num / exp) % <span class="hljs-number">10</span>;
            count[digit]++;
        }

        <span class="hljs-comment">// 计算前缀和，确定元素位置（保证稳定性）</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) {
            count[i] += count[i - <span class="hljs-number">1</span>];
        }

        <span class="hljs-comment">// 逆序遍历，保证稳定性</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
            <span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> (arr[i] / exp) % <span class="hljs-number">10</span>;
            output[count[digit] - <span class="hljs-number">1</span>] = arr[i];
            count[digit]--;
        }

        <span class="hljs-comment">// 拷贝回原数组</span>
        System.arraycopy(output, <span class="hljs-number">0</span>, arr, <span class="hljs-number">0</span>, n);
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> {
        <span class="hljs-type">int</span>[] arr = {<span class="hljs-number">53</span>, <span class="hljs-number">3</span>, <span class="hljs-number">542</span>, <span class="hljs-number">748</span>, <span class="hljs-number">14</span>, <span class="hljs-number">214</span>};
        radixSort(arr);
        System.out.println(Arrays.toString(arr)); <span class="hljs-comment">// 输出 [3, 14, 53, 214, 542, 748]</span>
    }
}
</code></pre>
<h4 data-id="heading-61">算法分析</h4>
<ul>
<li>时间复杂度：O(d×(n+k))（d= 最大位数，k= 基数 10）；</li>
<li>空间复杂度：O(n+k)（输出数组 + 计数数组）；</li>
<li>稳定性：稳定（逆序遍历 + 前缀和保证相对位置）；</li>
<li>适用场景：整数、字符串排序（如手机号、身份证号）。</li>
</ul>
<hr/>
<h3 data-id="heading-62">十大排序算法总结表</h3>


















































































<table><thead><tr><th>算法</th><th>时间复杂度（最好 / 平均 / 最坏）</th><th>空间复杂度</th><th>稳定性</th><th>核心特点</th></tr></thead><tbody><tr><td>冒泡排序</td><td>O(n)/O(n2)/O(n2)</td><td>O(1)</td><td>稳定</td><td>相邻交换，简单易实现</td></tr><tr><td>选择排序</td><td>O(n2)/O(n2)/O(n2)</td><td>O(1)</td><td>不稳定</td><td>选最小值交换，效率低</td></tr><tr><td>插入排序</td><td>O(n)/O(n2)/O(n2)</td><td>O(1)</td><td>稳定</td><td>插牌逻辑，小规模数据高效</td></tr><tr><td>希尔排序</td><td>O(nlogn)/O(n1.3)/O(n2)</td><td>O(1)</td><td>不稳定</td><td>分组插入排序，效率优于插入</td></tr><tr><td>归并排序</td><td>O(nlogn)/O(nlogn)/O(nlogn)</td><td>O(n)</td><td>稳定</td><td>分治合并，效率稳定</td></tr><tr><td>快速排序</td><td>O(nlogn)/O(nlogn)/O(n2)</td><td>O(logn)</td><td>不稳定</td><td>分治分区，实际应用最优</td></tr><tr><td>堆排序</td><td>O(nlogn)/O(nlogn)/O(nlogn)</td><td>O(1)</td><td>不稳定</td><td>利用堆结构，原地排序</td></tr><tr><td>计数排序</td><td>O(n+k)/O(n+k)/O(n+k)</td><td>O(n+k)</td><td>稳定</td><td>非比较，数值范围小高效</td></tr><tr><td>桶排序</td><td>O(n+k)/O(n+k)/O(n2)</td><td>O(n+k)</td><td>稳定</td><td>分桶排序，分布均匀时高效</td></tr><tr><td>基数排序</td><td>O(d(n+k))/O(d(n+k))/O(d(n+k))</td><td>O(n+k)</td><td>稳定</td><td>按位排序，适合整数 /</td></tr></tbody></table></div></div></article> <div class="article-end" data-v-539963b4="" data-v-61fb5e44=""><div class="rank-entry-bottom" data-v-539963b4="" data-v-61fb5e44=""><!----></div> <div class="tag-list-box" data-v-539963b4="" data-v-61fb5e44=""><!----><!----><!----></div></div> <!----><!----><!----><!----><!----><style>	.markdown-body { color: #828182;}</style>]]></description></item>  </channel></rss>